From mik77 at mail.berlios.de  Wed Jun  1 04:47:09 2011
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed,  1 Jun 2011 04:47:09 PM +0200
Subject: [Cachewolf-svn] r3023 - trunk/src/CacheWolf/navi
Message-ID: <20110601144709.48646480B12@sheep.berlios.de>

Author: mik77
Date: 2011-06-01 16:47:08 +0200 (Wed, 01 Jun 2011)
New Revision: 3023

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Set caches found in map context menu.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2011-05-31 10:23:53 UTC (rev 3022)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2011-06-01 14:47:08 UTC (rev 3023)
@@ -61,6 +61,7 @@
 import ewe.sys.Double;
 import ewe.sys.SystemResourceException;
 import ewe.sys.Vm;
+import ewe.sys.Time;
 import ewe.ui.CellConstants;
 import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
@@ -1132,6 +1133,7 @@
 			}
 		}
 		// mark Selected
+		removeMapSymbol("selectedCache");
 		ch = cacheDB.get(Global.mainTab.tbP.getSelectedCache());
 		if (ch != null) {
 			if (screenArea.isInBound(ch.pos)) {
@@ -2149,7 +2151,7 @@
 	Menu kontextMenu;
 	MenuItem gotoMenuItem = new MenuItem(MyLocale.getMsg(4230, "Goto here$g"), 0, null);
 	MenuItem newWayPointMenuItem = new MenuItem(MyLocale.getMsg(4232, "Create new Waypoint here$n"), 0, null);;
-	MenuItem openCacheDescMenuItem, openCacheDetailMenuItem, addCachetoListMenuItem, gotoCacheMenuItem, hintMenuItem, missionMenuItem;
+	MenuItem openCacheDescMenuItem, openCacheDetailMenuItem, addCachetoListMenuItem, gotoCacheMenuItem, markFoundMenuItem, hintMenuItem, missionMenuItem;
 
 	MenuItem miLuminary[];
 
@@ -2383,6 +2385,13 @@
 						kontextMenu.addItem(openCacheDetailMenuItem);
 						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto") + " '" + (clickedCache.getCacheName().length() > 0 ? clickedCache.getCacheName() : clickedCache.getWayPoint()) + "'$g");
 						kontextMenu.addItem(gotoCacheMenuItem);
+						if (!clickedCache.is_found()) {
+							int msgNr=318; // normal found
+							if (clickedCache.getType() == CacheType.CW_TYPE_WEBCAM) { msgNr=361;}
+							else if (clickedCache.getType() == CacheType.CW_TYPE_EVENT || clickedCache.getType() == CacheType.CW_TYPE_MEGA_EVENT) { msgNr=355;}
+							markFoundMenuItem = new MenuItem(MyLocale.getMsg(msgNr, "Found") + " '" + (clickedCache.getCacheName().length() > 0 ? clickedCache.getCacheName() : clickedCache.getWayPoint()) + "'$m");
+							kontextMenu.addItem(markFoundMenuItem);
+						}
 						if (Global.mainForm.cacheListVisible) {
 							addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199, "Add to cachetour"));
 							kontextMenu.addItem(addCachetoListMenuItem);
@@ -2478,6 +2487,19 @@
 						closeKontextMenu();
 						mm.myNavigation.setDestination(clickedCache);
 					}
+					if (action == markFoundMenuItem) {
+						closeKontextMenu();
+						final Time dtm = new Time();
+						dtm.setFormat("yyyy-MM-dd HH:mm");
+						clickedCache.setCacheStatus(dtm.toString());
+						clickedCache.setFound(true);
+						if ( Global.mainTab.detP.cache.getWayPoint().equals(clickedCache.getWayPoint()) ) {
+							Global.mainTab.detP.setDetails(clickedCache, false);
+						}
+						mm.removeMapSymbol(clickedCache.getWayPoint());
+						mm.updateSymbolPositions();
+						this.repaintNow();
+					}
 					if (action == newWayPointMenuItem) {
 						leaveMovingMap();
 						final CacheHolder newWP = new CacheHolder();



From araber95 at mail.berlios.de  Mon Jun  6 03:34:52 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon,  6 Jun 2011 03:34:52 PM +0200
Subject: [Cachewolf-svn] r3024 - trunk/src/CacheWolf/navi
Message-ID: <20110606133452.9600F480482@sheep.berlios.de>

Author: araber95
Date: 2011-06-06 15:34:52 +0200 (Mon, 06 Jun 2011)
New Revision: 3024

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
1. changed / more info on cache kontext view
2. finds to xml and to waypoints

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2011-06-01 14:47:08 UTC (rev 3023)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2011-06-06 13:34:52 UTC (rev 3024)
@@ -60,8 +60,8 @@
 import ewe.sys.Convert;
 import ewe.sys.Double;
 import ewe.sys.SystemResourceException;
+import ewe.sys.Time;
 import ewe.sys.Vm;
-import ewe.sys.Time;
 import ewe.ui.CellConstants;
 import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
@@ -2379,17 +2379,42 @@
 					clickedCache = (CacheHolder) (((MapSymbol) clickedOnImage).mapObject);
 					// clickedCache == null can happen if clicked on the goto-symbol
 					if (clickedCache != null) {
-						openCacheDescMenuItem = new MenuItem(MyLocale.getMsg(201, "Open Desctiption") + " '" + (clickedCache.getCacheName().length() > 0 ? clickedCache.getCacheName() : clickedCache.getWayPoint()) + "'$o");
+						CacheHolder ch = clickedCache;
+						if (clickedCache.isAddiWpt()) {
+							ch = clickedCache.mainCache;
+						}
+						if (ch != null) {
+							kontextMenu.addItem(new MenuItem(ch.getWayPoint() + " '" + ch.getCacheName() + "'"));
+							if (!ch.isCustomWpt()) {
+								kontextMenu.addItem(new MenuItem( //
+										CacheSize.cw2ExportString(ch.getCacheSize()) + //
+												" D: " + CacheTerrDiff.longDT(ch.getHard()) + //
+												" T: " + CacheTerrDiff.longDT(ch.getTerrain()) + //
+												""));
+								kontextMenu.addItem(new MenuItem( //
+										"" + ch.getCacheOwner() + //
+												" " + ch.getDateHidden() + //
+												""));
+							}
+						}
+						if (clickedCache.isAddiWpt()) {
+							kontextMenu.addItem(new MenuItem(clickedCache.getWayPoint() + " '" + clickedCache.getCacheName() + "'"));
+						}
+						kontextMenu.addItem(new MenuItem("-"));
+						openCacheDescMenuItem = new MenuItem(MyLocale.getMsg(201, "Open Desctiption") + "$o");
 						kontextMenu.addItem(openCacheDescMenuItem);
-						openCacheDetailMenuItem = new MenuItem(MyLocale.getMsg(200, "Open Details") + " '" + (clickedCache.getCacheName().length() > 0 ? clickedCache.getCacheName() : clickedCache.getWayPoint()) + "'$e");
+						openCacheDetailMenuItem = new MenuItem(MyLocale.getMsg(200, "Open Details") + "$e");
 						kontextMenu.addItem(openCacheDetailMenuItem);
-						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto") + " '" + (clickedCache.getCacheName().length() > 0 ? clickedCache.getCacheName() : clickedCache.getWayPoint()) + "'$g");
+						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto") + "$g");
 						kontextMenu.addItem(gotoCacheMenuItem);
 						if (!clickedCache.is_found()) {
-							int msgNr=318; // normal found
-							if (clickedCache.getType() == CacheType.CW_TYPE_WEBCAM) { msgNr=361;}
-							else if (clickedCache.getType() == CacheType.CW_TYPE_EVENT || clickedCache.getType() == CacheType.CW_TYPE_MEGA_EVENT) { msgNr=355;}
-							markFoundMenuItem = new MenuItem(MyLocale.getMsg(msgNr, "Found") + " '" + (clickedCache.getCacheName().length() > 0 ? clickedCache.getCacheName() : clickedCache.getWayPoint()) + "'$m");
+							int msgNr = 318; // normal found
+							if (clickedCache.getType() == CacheType.CW_TYPE_WEBCAM) {
+								msgNr = 361;
+							} else if (clickedCache.getType() == CacheType.CW_TYPE_EVENT || clickedCache.getType() == CacheType.CW_TYPE_MEGA_EVENT) {
+								msgNr = 355;
+							}
+							markFoundMenuItem = new MenuItem(MyLocale.getMsg(msgNr, "Found") + "$m");
 							kontextMenu.addItem(markFoundMenuItem);
 						}
 						if (Global.mainForm.cacheListVisible) {
@@ -2407,11 +2432,6 @@
 								kontextMenu.addItem(missionMenuItem = new MenuItem("?: "));
 							}
 						}
-						kontextMenu.addItem(new MenuItem("-"));
-						kontextMenu.addItem(new MenuItem(clickedCache.getWayPoint() + " Info:"));
-						kontextMenu.addItem(new MenuItem("Difficulty: " + CacheTerrDiff.longDT(clickedCache.getHard())));
-						kontextMenu.addItem(new MenuItem("Terrain: " + CacheTerrDiff.longDT(clickedCache.getTerrain())));
-						kontextMenu.addItem(new MenuItem("Size: " + CacheSize.cw2ExportString(clickedCache.getCacheSize())));
 					}
 				}
 			}
@@ -2440,11 +2460,7 @@
 		if (which instanceof MapSymbol) {
 			if (((MapSymbol) which).mapObject instanceof CacheHolder) {
 				final CacheHolder ch = (CacheHolder) ((MapSymbol) which).mapObject;
-				this.toolTip = ch.getWayPoint() + "\n" + ch.getCacheName() + "\n" + "Difficulty: " + CacheTerrDiff.longDT(ch.getHard()) + "\n" + "Terrain: " + CacheTerrDiff.longDT(ch.getTerrain()) + "\n" + "Size: "
-						+ CacheSize.cw2ExportString(ch.getCacheSize()) + "\n";
-				if (ch.getType() == CacheType.CW_TYPE_QUESTION) {
-					this.toolTip = this.toolTip + ch.getCacheDetails(false).LongDescription;
-				}
+				this.toolTip = ch.getWayPoint() + "\n" + ch.getCacheName();
 			}
 		}
 		return true;
@@ -2493,8 +2509,16 @@
 						dtm.setFormat("yyyy-MM-dd HH:mm");
 						clickedCache.setCacheStatus(dtm.toString());
 						clickedCache.setFound(true);
-						if ( Global.mainTab.detP.cache.getWayPoint().equals(clickedCache.getWayPoint()) ) {
-							Global.mainTab.detP.setDetails(clickedCache, false);
+						clickedCache.save();
+						if (clickedCache.hasAddiWpt()) {
+							CacheHolder addiWpt;
+							for (int i = clickedCache.addiWpts.getCount() - 1; i >= 0; i--) {
+								addiWpt = (CacheHolder) clickedCache.addiWpts.get(i);
+								addiWpt.setCacheStatus(dtm.toString());
+								addiWpt.setFound(true);
+								addiWpt.save();
+								mm.removeMapSymbol(addiWpt.getWayPoint());
+							}
 						}
 						mm.removeMapSymbol(clickedCache.getWayPoint());
 						mm.updateSymbolPositions();



From araber95 at mail.berlios.de  Mon Jun 13 07:55:20 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 13 Jun 2011 07:55:20 PM +0200
Subject: [Cachewolf-svn] r3025 - trunk/res_noewe/webmapservices
Message-ID: <20110613175520.2C14A480FDB@sheep.berlios.de>

Author: araber95
Date: 2011-06-13 19:55:19 +0200 (Mon, 13 Jun 2011)
New Revision: 3025

Removed:
   trunk/res_noewe/webmapservices/de-ni_p.wms
   trunk/res_noewe/webmapservices/de-ni_t100.wms
   trunk/res_noewe/webmapservices/de-ni_t100_lv.wms
   trunk/res_noewe/webmapservices/de-ni_t25.wms
Log:
will be replaced

Deleted: trunk/res_noewe/webmapservices/de-ni_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_p.wms	2011-06-06 13:34:52 UTC (rev 3024)
+++ trunk/res_noewe/webmapservices/de-ni_p.wms	2011-06-13 17:55:19 UTC (rev 3025)
@@ -1,43 +0,0 @@
-TakenFromUrl:       http://www.umwelt.niedersachsen.de/master/C7089178_N7088657_L20_D0_I598.html
-GetCapabilitiesUrl: http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               de.Niedersachsen photo c SF=0..1,95
-MapType:                        photo
-#MainUrl:            http://www.umweltkarten.niedersachsen.de/arcgis/services/GR_Gebiete/MapServer/WMSServer?
-MainUrl:            http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  31467
-CoordinateReferenceSystemUrlPart: SRS=EPSG:31467 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=0|Gebiete mit gesamtstaatlicher repr?sentativer Bedeutung|2.772396|Infinity
-#LayersUrlPart:     LAYERS=1|Flie?gew?sserschutzsystem Verbindungsgew?sser|2.772396|Infinity
-#LayersUrlPart:     LAYERS=2|Flie?gew?sserschutzsystem Hauptgew?sser und Auen|2.772396|Infinity
-#LayersUrlPart:     LAYERS=3|Moorschutzprogramm Neubewertung|2,772396|Infinity
-#LayersUrlPart:     LAYERS=4|Moorschutzprogramm Teil II|2.772396|Infinity
-#LayersUrlPart:     LAYERS=5|Abgrenzung des Hochmoorkomplexes MSP Teil I|2.772396|Infinity
-#LayersUrlPart:     LAYERS=6|Moorschutzprogramm (MSP) Teil I|2.772396|Infinity
-#LayersUrlPart:     LAYERS=7|Untere  Naturschutzbeh?rden|2.772396|Infinity
-#LayersUrlPart:     LAYERS=8|Landkreise||
-#LayersUrlPart:     LAYERS=9|Ortslagen|99.000000|237.600000
-#LayersUrlPart:     LAYERS=10|Grosse Seen|198.000000|Infinity
-#LayersUrlPart:     LAYERS=11|Gro?e Fl?sse|198.000000|Infinity
-#LayersUrlPart:     LAYERS=12|Orthophoto Farbe|0.0|2.772000
-#LayersUrlPart:     LAYERS=13|DTK 25|2.772396|4.950000
-#LayersUrlPart:     LAYERS=14|TK 50|4.950396|9.900000
-#LayersUrlPart:     LAYERS=15|TK 100|9.900396|29.700000
-#LayersUrlPart:     LAYERS=16|TK 500|29.700396|99.000000
-#LayersUrlPart:     LAYERS=17|Autobahnen||
-#LayersUrlPart:     LAYERS=18|Schrift: Gro?e Orte||
-#LayersUrlPart:     LAYERS=19|Schrift: Kleine Orte||
-LayersUrlPart:     LAYERS=12
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/jpeg
-BoundingBoxTopLeftWGS84: N 53.898485 E 6.600296
-BoundingBoxBottomRightWGS84: N 51.265165 E 11.665345
-MinScale:   0
-MaxScale:   2.772396
-RecommendedScale:   1
-#MinSFInput:0
-#MaxSFInput:1,9586
-ImageFileExtension: .jpg
-#weitere Overlays hinzuf?gen geht bei Photo nicht.
\ No newline at end of file

Deleted: trunk/res_noewe/webmapservices/de-ni_t100.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t100.wms	2011-06-06 13:34:52 UTC (rev 3024)
+++ trunk/res_noewe/webmapservices/de-ni_t100.wms	2011-06-13 17:55:19 UTC (rev 3025)
@@ -1,23 +0,0 @@
-TakenFromUrl:       http://www.lgn.de
-GetCapabilitiesUrl: http://www.mapserver.niedersachsen.de/freezoneogc/mapserverogc?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               de.Niedersachsen t100 c SF=4.78..37.35
-MapType:                        topo
-MainUrl:            http://www.mapserver.niedersachsen.de/freezoneogc/mapserverogc?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  31467
-CoordinateReferenceSystemUrlPart: SRS=EPSG:31467 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=DUEKN5000|Uebersichtskarte 1:5000000|232.14267523852232|4887.214215547839
-#LayersUrlPart:     LAYERS=DUEKN1000|Uebersichtskarte 1:1000000|52.82503600628914|422.6002880503131
-#LayersUrlPart:     LAYERS=DUEKN500|Uebersichtskarte 1:500000|17.86128289273423|198.4586988081581
-#LayersUrlPart:     LAYERS=TK100|Topographische Karte 1:100000|6,76160460880501|52.82503600628914
-LayersUrlPart:     LAYERS=TK100
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 54.9403 E 6.1804
-BoundingBoxBottomRightWGS84: N 50.5028 E 13.6833
-MinScale:   6.76160460880501
-MaxScale:   52.82503600628914
-RecommendedScale:   15 5 10 20
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/de-ni_t100_lv.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t100_lv.wms	2011-06-06 13:34:52 UTC (rev 3024)
+++ trunk/res_noewe/webmapservices/de-ni_t100_lv.wms	2011-06-13 17:55:19 UTC (rev 3025)
@@ -1,37 +0,0 @@
-TakenFromUrl:       http://www.geobasisdaten.niedersachsen.de/bestand?
-GetCapabilitiesUrl: http://www.geobasisdaten.niedersachsen.de/bestand?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               de.Niedersachsen t100 c SF=~0,7 .. 400 LV NI
-MapType:                        topo
-MainUrl:            http://www.geobasisdaten.niedersachsen.de/bestand?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  31466 31467 31468 31469
-CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469
-#CoordinateReferenceSystemCacheWolf:  4326
-#CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=geodatenbasisbestand|Bestands?bersicht||
-#LayersUrlPart:     LAYERS=navigation_f|Navigation, farbig||
-#LayersUrlPart:     LAYERS=ueb5000_nf|?bersichtskarte 1:5.000.000|407.859199979508|9899.49490168847
-#LayersUrlPart:     LAYERS=ueb1000_nf|?bersichtskarte 1:1.000.000|126.713500006|407.859199979508
-#LayersUrlPart:     LAYERS=ukn500_nf|?bersichtskarte 1:500.000|44.901280999479|126.713500006
-#LayersUrlPart:     LAYERS=dtk100_v_nf|Topographische Karte 1:100.000|0.498902848429637|44.901280999479
-#LayersUrlPart:     LAYERS=dtk100_v_b|Topographische Karte 1:100.000||
-#LayersUrlPart:     LAYERS=dtk50_v_b|Topographische Karte 1:50.000||
-#LayersUrlPart:     LAYERS=dtk50_b|Digitale Topographische Karte 1:50.000||
-#LayersUrlPart:     LAYERS=dtk25_b|Digitale Topographische Karte 1:25.000||
-#LayersUrlPart:     LAYERS=pl25_b|Preu?ische Landesaufnahme 1:25.000||
-#LayersUrlPart:     LAYERS=dsk10_b|Digitale Stra?enkarte 1:10.000||
-#LayersUrlPart:     LAYERS=ak5_b|Amtliche Karte 1:5.000||
-#LayersUrlPart:     LAYERS=dop40_b|Digitales Orthophoto||
-LayersUrlPart:     LAYERS=navigation_f
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/jpeg
-BoundingBoxTopLeftWGS84: N 54.5549 E 5.8986
-BoundingBoxBottomRightWGS84: N 50.6539 E 12.6239
-#BBox_Mitte: N 52.6044 E 9.261245
-MinScale:   0.7
-MaxScale:   14000
-RecommendedScale:   5 1 10 15
-ImageFileExtension: .jpg
-#SF von 0.4989 bis 9899.4949 * sqrt(2)

Deleted: trunk/res_noewe/webmapservices/de-ni_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t25.wms	2011-06-06 13:34:52 UTC (rev 3024)
+++ trunk/res_noewe/webmapservices/de-ni_t25.wms	2011-06-13 17:55:19 UTC (rev 3025)
@@ -1,44 +0,0 @@
-TakenFromUrl:       http://www.umwelt.niedersachsen.de/master/C7089178_N7088657_L20_D0_I598.html
-GetCapabilitiesUrl: http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               de.Niedersachsen t25 b/w ?c SF=1,95..3,5
-MapType:                        topo
-#MainUrl:            http://www.umweltkarten.niedersachsen.de/arcgis/services/GR_Gebiete/MapServer/WMSServer?
-MainUrl:            http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  31467
-CoordinateReferenceSystemUrlPart: SRS=EPSG:31467 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=0|Gebiete mit gesamtstaatlicher repr?sentativer Bedeutung|2.772396|Infinity
-#LayersUrlPart:     LAYERS=1|Flie?gew?sserschutzsystem Verbindungsgew?sser|2.772396|Infinity
-#LayersUrlPart:     LAYERS=2|Flie?gew?sserschutzsystem Hauptgew?sser und Auen|2.772396|Infinity
-#LayersUrlPart:     LAYERS=3|Moorschutzprogramm Neubewertung|2,772396|Infinity
-#LayersUrlPart:     LAYERS=4|Moorschutzprogramm Teil II|2.772396|Infinity
-#LayersUrlPart:     LAYERS=5|Abgrenzung des Hochmoorkomplexes MSP Teil I|2.772396|Infinity
-#LayersUrlPart:     LAYERS=6|Moorschutzprogramm (MSP) Teil I|2.772396|Infinity
-#LayersUrlPart:     LAYERS=7|Untere  Naturschutzbeh?rden|2.772396|Infinity
-#LayersUrlPart:     LAYERS=8|Landkreise||
-#LayersUrlPart:     LAYERS=9|Ortslagen|99.000000|237.600000
-#LayersUrlPart:     LAYERS=10|Grosse Seen|198.000000|Infinity
-#LayersUrlPart:     LAYERS=11|Gro?e Fl?sse|198.000000|Infinity
-#LayersUrlPart:     LAYERS=12|Orthophoto Farbe|0.0|2.772000
-#LayersUrlPart:     LAYERS=13|DTK 25|2.772396|4.950000
-#LayersUrlPart:     LAYERS=14|TK 50|4.950396|9.900000
-#LayersUrlPart:     LAYERS=15|TK 100|9.900396|29.700000
-#LayersUrlPart:     LAYERS=16|TK 500|29.700396|99.000000
-#LayersUrlPart:     LAYERS=17|Autobahnen||
-#LayersUrlPart:     LAYERS=18|Schrift: Gro?e Orte||
-#LayersUrlPart:     LAYERS=19|Schrift: Kleine Orte||
-#LayersUrlPart:     LAYERS=13,1,3,4,5,6,17,18,19
-#LayersUrlPart:     LAYERS=13
-LayersUrlPart:     LAYERS=13,17,18,19
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 54.001848 E 6.579380
-BoundingBoxBottomRightWGS84: N 51.372735 E 11.734608
-MinScale:   0
-MaxScale:   100
-RecommendedScale:   2,5
-#MinSFInput:1,9586
-#MaxSFInput:3,5001
-ImageFileExtension: .png



From araber95 at mail.berlios.de  Mon Jun 13 07:58:00 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 13 Jun 2011 07:58:00 PM +0200
Subject: [Cachewolf-svn] r3026 - trunk/res_noewe/webmapservices
Message-ID: <20110613175801.382FD480FDB@sheep.berlios.de>

Author: araber95
Date: 2011-06-13 19:58:00 +0200 (Mon, 13 Jun 2011)
New Revision: 3026

Added:
   trunk/res_noewe/webmapservices/de-ni_p.wms
   trunk/res_noewe/webmapservices/de-ni_t50.wms
   trunk/res_noewe/webmapservices/de-ni_t_lv.wms
Log:
wms for NIedersachsen changed

Added: trunk/res_noewe/webmapservices/de-ni_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_p.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/de-ni_p.wms	2011-06-13 17:58:00 UTC (rev 3026)
@@ -0,0 +1,43 @@
+?TakenFromUrl:       http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer
+GetCapabilitiesUrl: http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               de.Niedersachsen p
+MapType:                        photo
+MainUrl:            http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31466 31467 31468 31469
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=0|Gebiete mit gesamtstaatlicher repr?sentativer Bedeutung|2.772396|Infinity
+#LayersUrlPart:     LAYERS=1|Flie?gew?sserschutzsystem Verbindungsgew?sser|2.772396|Infinity
+#LayersUrlPart:     LAYERS=2|Flie?gew?sserschutzsystem Hauptgew?sser und Auen|2.772396|Infinity
+#LayersUrlPart:     LAYERS=3|Moorschutzprogramm Neubewertung|2.772396|Infinity
+#LayersUrlPart:     LAYERS=4|Moorschutzprogramm Teil II|2.772396|Infinity
+#LayersUrlPart:     LAYERS=5|Abgrenzung des Hochmoorkomplexes MSP Teil I|2.772396|Infinity
+#LayersUrlPart:     LAYERS=6|Moorschutzprogramm (MSP) Teil I|2.772396|Infinity
+#LayersUrlPart:     LAYERS=7|Untere  Naturschutzbeh?rden|2.772396|Infinity
+#LayersUrlPart:     LAYERS=8|Naturr?umliche Regionen und Unterregionen DTK50||
+#LayersUrlPart:     LAYERS=9|Naturr?umliche Regionen DTK50||
+#LayersUrlPart:     LAYERS=10|Landesgrenze inkl. 12 Seemeilen-Zone||
+#LayersUrlPart:     LAYERS=11|Landkreise||
+#LayersUrlPart:     LAYERS=12|Ortslagen|99.000000|237.600000
+#LayersUrlPart:     LAYERS=13|Grosse Seen|198.000000|Infinity
+#LayersUrlPart:     LAYERS=14|Gro?e Fl?sse|198.000000|Infinity
+#LayersUrlPart:     LAYERS=15|Orthophoto Farbe|0.0|2.772000
+#LayersUrlPart:     LAYERS=16|DTK 25|2.772396|4.950000
+#LayersUrlPart:     LAYERS=17|TK 50 |4.950396|9.900000
+#LayersUrlPart:     LAYERS=18|TK 100|9.900396|29.700000
+#LayersUrlPart:     LAYERS=19|DTK 500 |29.700396|99.000000
+#LayersUrlPart:     LAYERS=20|Autobahnen||
+#LayersUrlPart:     LAYERS=21|Schrift: Gro?e Orte||
+#LayersUrlPart:     LAYERS=22|Schrift: Kleine Orte||
+LayersUrlPart:     LAYERS=15
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 54.0098 E 6.4705
+BoundingBoxBottomRightWGS84: N 51.2325 E 11.6591
+#BBox_Mitte: N 52.6211685 E 9.0647625
+MinScale:   0.2
+MaxScale:   3
+RecommendedScale:    1
+ImageFileExtension: .jpg

Added: trunk/res_noewe/webmapservices/de-ni_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t50.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/de-ni_t50.wms	2011-06-13 17:58:00 UTC (rev 3026)
@@ -0,0 +1,43 @@
+?TakenFromUrl:       http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer
+GetCapabilitiesUrl: http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               de.Niedersachsen t5
+MapType:                        topo
+MainUrl:            http://www.umweltkarten.niedersachsen.de/arcgis/services/Programme/MapServer/WMSServer?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31466 31467 31468 31469
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=0|Gebiete mit gesamtstaatlicher repr?sentativer Bedeutung|2.772396|Infinity
+#LayersUrlPart:     LAYERS=1|Flie?gew?sserschutzsystem Verbindungsgew?sser|2.772396|Infinity
+#LayersUrlPart:     LAYERS=2|Flie?gew?sserschutzsystem Hauptgew?sser und Auen|2.772396|Infinity
+#LayersUrlPart:     LAYERS=3|Moorschutzprogramm Neubewertung|2.772396|Infinity
+#LayersUrlPart:     LAYERS=4|Moorschutzprogramm Teil II|2.772396|Infinity
+#LayersUrlPart:     LAYERS=5|Abgrenzung des Hochmoorkomplexes MSP Teil I|2.772396|Infinity
+#LayersUrlPart:     LAYERS=6|Moorschutzprogramm (MSP) Teil I|2.772396|Infinity
+#LayersUrlPart:     LAYERS=7|Untere  Naturschutzbeh?rden|2.772396|Infinity
+#LayersUrlPart:     LAYERS=8|Naturr?umliche Regionen und Unterregionen DTK50||
+#LayersUrlPart:     LAYERS=9|Naturr?umliche Regionen DTK50||
+#LayersUrlPart:     LAYERS=10|Landesgrenze inkl. 12 Seemeilen-Zone||
+#LayersUrlPart:     LAYERS=11|Landkreise||
+#LayersUrlPart:     LAYERS=12|Ortslagen|99.000000|237.600000
+#LayersUrlPart:     LAYERS=13|Grosse Seen|198.000000|Infinity
+#LayersUrlPart:     LAYERS=14|Gro?e Fl?sse|198.000000|Infinity
+#LayersUrlPart:     LAYERS=15|Orthophoto Farbe|0.0|2.772000
+#LayersUrlPart:     LAYERS=16|DTK 25|2.772396|4.950000
+#LayersUrlPart:     LAYERS=17|TK 50 |4.950396|9.900000
+#LayersUrlPart:     LAYERS=18|TK 100|9.900396|29.700000
+#LayersUrlPart:     LAYERS=19|DTK 500 |29.700396|99.000000
+#LayersUrlPart:     LAYERS=20|Autobahnen||
+#LayersUrlPart:     LAYERS=21|Schrift: Gro?e Orte||
+#LayersUrlPart:     LAYERS=22|Schrift: Kleine Orte||
+LayersUrlPart:     LAYERS=17
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 54.0018 E 6.5794
+BoundingBoxBottomRightWGS84: N 51.3727 E 11.7346
+#BBox_Mitte: N 52.6872895 E 9.156994
+MinScale:   2
+MaxScale:   10
+RecommendedScale:    2 3 5
+ImageFileExtension: .jpg

Added: trunk/res_noewe/webmapservices/de-ni_t_lv.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t_lv.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/de-ni_t_lv.wms	2011-06-13 17:58:00 UTC (rev 3026)
@@ -0,0 +1,36 @@
+?TakenFromUrl:       http://www.lgln.niedersachsen.de?
+GetCapabilitiesUrl: http://www.geobasisdaten.niedersachsen.de/bestand?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               de.Niedersachsen t25
+MapType:                        topo
+MainUrl:            http://www.geobasisdaten.niedersachsen.de/bestand?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31466 31467 31468 31469
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=bestand|LGLN-Bestand||
+#LayersUrlPart:     LAYERS=rasterdaten|?bersichtskarten||
+#LayersUrlPart:     LAYERS=ueb5000_gd|UKN 5.000|633.499852296075|9899.49490168847
+#LayersUrlPart:     LAYERS=ukn2500_gd|UKN 2.500|296.999859087254|633.499852296075
+#LayersUrlPart:     LAYERS=ueb1000_gd|UKN 1.000|126.713500006|296.999859087254
+#LayersUrlPart:     LAYERS=ukn500_gd|UKN 500|44.901280999479|126.713500006
+#LayersUrlPart:     LAYERS=dtk100_v_gd|TK 100|0|44.901280999479
+#LayersUrlPart:     LAYERS=dtk100_v_b|Topographischen Karte 1:100.000||
+#LayersUrlPart:     LAYERS=dtk50_b|Topographischen Karte 1:50.000||
+#LayersUrlPart:     LAYERS=dtk25_b|Topographischen Karte 1:25.000||
+#LayersUrlPart:     LAYERS=pl25_b|Preu?ischen Landesaufnahme 1:25.000||
+#LayersUrlPart:     LAYERS=dsk10_b|Digitalen Stra?enkarte 1:10.000||
+#LayersUrlPart:     LAYERS=dgk5g_b|Deutsche Grundkarte 1:5.000||
+#LayersUrlPart:     LAYERS=ak5_b|Amtlichen Karte 1:5.000||
+#LayersUrlPart:     LAYERS=dop_b|Digitales Orthophoto||
+#LayersUrlPart:     LAYERS=landkreise_umringe|Landkreisgrenzen|0|9899.49490168847
+#LayersUrlPart:     LAYERS=gemeinden_umringe|Gemeindegrenzen|0|126.713500006
+LayersUrlPart:     LAYERS=rasterdaten
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 54.5532 E 5.8980
+BoundingBoxBottomRightWGS84: N 50.6527 E 12.6222
+MinScale:   2
+MaxScale:   60
+RecommendedScale:    2.5 1 5 7.5
+ImageFileExtension: .jpg



From araber95 at mail.berlios.de  Wed Jun 15 10:53:02 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 15 Jun 2011 10:53:02 PM +0200
Subject: [Cachewolf-svn] r3027 - in trunk/src/CacheWolf: . imp navi
Message-ID: <20110615205302.20F3E481259@sheep.berlios.de>

Author: araber95
Date: 2011-06-15 22:53:01 +0200 (Wed, 15 Jun 2011)
New Revision: 3027

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
direct map access

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2011-06-13 17:58:00 UTC (rev 3026)
+++ trunk/src/CacheWolf/MainTab.java	2011-06-15 20:53:01 UTC (rev 3027)
@@ -1,28 +1,28 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See http://developer.berlios.de/projects/cachewolf/
-    for more information.
-    Contact: 	bilbowolf at users.berlios.de
-    			kalli at users.berlios.de
+Copyright (C) 2006  CacheWolf development team
+See http://developer.berlios.de/projects/cachewolf/
+for more information.
+Contact: 	bilbowolf at users.berlios.de
+			kalli at users.berlios.de
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
 
 import CacheWolf.navi.GotoPanel;
@@ -41,90 +41,131 @@
 import ewe.ui.mTabbedPanel;
 
 /**
- *	This class creates the tabbed panel and sets the tabs to the respective
- *	other panels. Important is to have a look at the event handler!<br>
- *	Class ID = 1200
- *	@see MainForm
- *	@see MainMenu
+ * This class creates the tabbed panel and sets the tabs to the respective other panels. Important is to have a look at
+ * the event handler!<br>
+ * Class ID = 1200
+ * 
+ * @see MainForm
+ * @see MainMenu
  */
 public class MainTab extends mTabbedPanel {
-	DescriptionPanel descP= new DescriptionPanel();
+	static int LIST_CARD;
+	static int DETAILS_CARD;
+	static int DESCRIPTION_CARD;
+	static int IMAGES_CARD;
+	static int HINTSANSLOGS_CARD;
+	static int SOLVER_CARD;
+	static int CALC_CARD;
+	static int GOTO_CARD;
+	static int RADAR_CARD;
+	static int MAP_CARD;
+
+	TableForm listP;
+	public DetailsPanel detP = new DetailsPanel();
+	DescriptionPanel descP = new DescriptionPanel();
 	HintLogPanel hintLP = new HintLogPanel();
 	public TablePanel tbP;
-	CacheDB cacheDB;
-	public DetailsPanel detP = new DetailsPanel();
 	CalcPanel calcP;
-	Preferences pref;
-	Profile profile;
 	GotoPanel gotoP;
 	RadarPanel radarP = new RadarPanel();
 	ImagePanel imageP;
 	SolverPanel solverP;
+	ewe.ui.CellPanel mapP;
+
+	Preferences pref;
+	Profile profile;
+
+	CacheDB cacheDB;
 	String lastselected = "";
-	public CacheHolder ch=null, chMain=null;
-	CacheHolderDetail chD =null;
+	public CacheHolder ch = null, chMain = null;
+	CacheHolderDetail chD = null;
 	MainMenu mnuMain;
+
 	public StatusBar statBar;
 	public MovingMap mm;
 	public Navigate nav;
-	public String mainCache="";
-	int oldCard=0;
-	boolean cacheDirty=false;
+	public String mainCache = "";
+	int oldCard;
+	boolean cacheDirty = false;
 
-	public MainTab(MainMenu mainMenu,StatusBar statBar){
-		Global.mainTab=this;
-		mnuMain=mainMenu;
+	public MainTab(MainMenu mainMenu, StatusBar statBar) {
+		// Init here so that Global.MainT is already set
+		Global.mainTab = this;
+		mnuMain = mainMenu;
 		pref = Global.getPref();
-		profile=Global.getProfile();
-		if (!pref.tabsAtTop) tabLocation=SOUTH;
+		profile = Global.getProfile();
+		if (!pref.tabsAtTop)
+			tabLocation = SOUTH;
 		cacheDB = profile.cacheDB;
-		this.statBar=statBar;
+		this.statBar = statBar;
 		MyLocale.setSIPButton();
-		//Don't expand tabs if the screen is very narrow, i.e. HP IPAQ 65xx, 69xx
+		// Don't expand tabs if the screen is very narrow, i.e. HP IPAQ
+		// 65xx, 69xx
 		int sw = MyLocale.getScreenWidth();
-		if ( sw <= 240) this.dontExpandTabs=true;
-		String imagesize="";
-		if (pref.useBigIcons) imagesize="_vga";
-		calcP = new CalcPanel(); // Init here so that Global.MainT is already set
+		if (sw <= 240)
+			this.dontExpandTabs = true;
+		String imagesize = "";
+		if (pref.useBigIcons)
+			imagesize = "_vga";
+
 		tbP = new TablePanel(pref, profile, statBar);
-		Card c = this.addCard(new TableForm(tbP), MyLocale.getMsg(1200,"List"), null);
+		Card c = this.addCard(listP = new TableForm(tbP), MyLocale.getMsg(1200, "List"), null);
+		LIST_CARD = this.cardPanel.cards.size() - 1;
+		oldCard = LIST_CARD;
 
-		c = this.addCard(detP, MyLocale.getMsg(1201,"Details"), null);
-		c.iconize(new Image("details"+imagesize+".gif"),true);
+		c = this.addCard(detP, MyLocale.getMsg(1201, "Details"), null);
+		DETAILS_CARD = this.cardPanel.cards.size() - 1;
+		c.iconize(new Image("details" + imagesize + ".gif"), true);
 
-		c = this.addCard(descP, MyLocale.getMsg(1202,"Description"), null);
-		c.iconize(new Image("descr"+imagesize+".gif"),true);
+		c = this.addCard(descP, MyLocale.getMsg(1202, "Description"), null);
+		DESCRIPTION_CARD = this.cardPanel.cards.size() - 1;
+		c.iconize(new Image("descr" + imagesize + ".gif"), true);
 
-		c = this.addCard(new MyScrollBarPanel(imageP = new ImagePanel()), MyLocale.getMsg(1203,"Images"), null);
-		c.iconize(new Image("images"+imagesize+".gif"),true);
+		c = this.addCard(new MyScrollBarPanel(imageP = new ImagePanel()), MyLocale.getMsg(1203, "Images"), null);
+		IMAGES_CARD = this.cardPanel.cards.size() - 1;
+		c.iconize(new Image("images" + imagesize + ".gif"), true);
 
-		c = this.addCard(hintLP, MyLocale.getMsg(1204,"Hints & Logs"), null);
-		c.iconize(new Image("more"+imagesize+".gif"),true);
+		c = this.addCard(hintLP, MyLocale.getMsg(1204, "Hints & Logs"), null);
+		HINTSANSLOGS_CARD = this.cardPanel.cards.size() - 1;
+		c.iconize(new Image("more" + imagesize + ".gif"), true);
 
-		c = this.addCard(solverP = new SolverPanel(pref, profile), MyLocale.getMsg(1205,"Solver"), null);
-		c.iconize(new Image("solver"+imagesize+".gif"),true);
+		c = this.addCard(solverP = new SolverPanel(pref, profile), MyLocale.getMsg(1205, "Solver"), null);
+		SOLVER_CARD = this.cardPanel.cards.size() - 1;
+		c.iconize(new Image("solver" + imagesize + ".gif"), true);
 
-		c = this.addCard(calcP, MyLocale.getMsg(1206,"Calc"), null);
-		mImage imgCalc=new mImage("projecttab"+imagesize+".gif"); imgCalc.transparentColor=new Color(0,255,0);
-		c.iconize(imgCalc,true);
+		c = this.addCard(calcP = new CalcPanel(), MyLocale.getMsg(1206, "Calc"), null);
+		CALC_CARD = this.cardPanel.cards.size() - 1;
+		mImage imgCalc = new mImage("projecttab" + imagesize + ".gif");
+		imgCalc.transparentColor = new Color(0, 255, 0);
+		c.iconize(imgCalc, true);
 
 		nav = new Navigate();
-		c = this.addCard(gotoP = new GotoPanel(nav), "Goto", null);
-		c.iconize(new Image("goto"+imagesize+".gif"),true);
+		c = this.addCard(gotoP = new GotoPanel(nav), MyLocale.getMsg(345, "Goto these coordinates"), null);
+		GOTO_CARD = this.cardPanel.cards.size() - 1;
+		c.iconize(new Image("goto" + imagesize + ".gif"), true);
 		nav.setGotoPanel(gotoP);
 
-		c = this.addCard(radarP, "Radar", null);
-		radarP.setMainTab(this);
-		c.iconize(new Image("radar"+imagesize+".gif"),true);
+		c = this.addCard(mapP = new ewe.ui.CellPanel(), MyLocale.getMsg(347, "Show map"), null);
+		MAP_CARD = this.cardPanel.cards.size() - 1;
+		c.iconize(new Image("globe_small" + imagesize + ".gif"), true);
+
+		if (pref.useBigIcons) {
+			c = this.addCard(radarP, "Radar", null);
+			RADAR_CARD = this.cardPanel.cards.size() - 1;
+			radarP.setMainTab(this);
+			c.iconize(new Image("radar" + imagesize + ".gif"), true);
+		}
+
 		mnuMain.allowProfileChange(true);
-//		if (pref.noTabs) top.modify(ShrinkToNothing,0);//TODO
+		// if (pref.noTabs) top.modify(ShrinkToNothing,0);//TODO
 	}
 
-	public TablePanel getTablePanel(){
+	public TablePanel getTablePanel() {
 		return tbP;
 	}
 
-	public void selectAndActive(int rownum){// Called from myInteractivePanel.imageClicked
+	public void selectAndActive(int rownum) {// Called from
+		// myInteractivePanel.imageClicked
 		tbP.selectRow(rownum);
 		this.selectAndExpand(0);
 	}
@@ -138,79 +179,86 @@
 	}
 
 	public void onEvent(Event ev) {
-		// This section clears old data when a new line is selected in the table
+		// This section clears old data when a new line is selected in the
+		// table
 		if (ev instanceof TableEvent) {
 			clearDetails();
 		}
-		if(ev instanceof MultiPanelEvent){
-			// Check whether a profile change is allowed, if not disable the relevant options
+		if (ev instanceof MultiPanelEvent) {
+			// Check whether a profile change is allowed, if not disable the
+			// relevant options
 			checkProfileChange();
 			// Perform clean up actions for the panel we are leaving
 			onLeavingPanel(oldCard);
 			// Prepare actions for the panel we are about to enter
-			onEnteringPanel(((MultiPanelEvent)ev).selectedIndex);
-			oldCard=((MultiPanelEvent)ev).selectedIndex;
+			onEnteringPanel(((MultiPanelEvent) ev).selectedIndex);
 		}
-		super.onEvent(ev); //Make sure you call this.
-		// If we are in Listview update status
-//		if (this.getSelectedItem()==0 && statBar!=null) statBar.updateDisplay();
+		super.onEvent(ev); // Make sure you call this.
 	}
 
 	/**
 	 * Code to execute when leaving a panel (oldCard is the panel number)
-	 *
+	 * 
 	 */
 	private void onLeavingPanel(int panelNo) {
-		if (panelNo==0) { // Leaving the list view
+		if (panelNo == MainTab.LIST_CARD) { // Leaving the list view
 			// Get the cache for the current line (ch)
 			// Get the details for the current line (chD)
 			// If it is Addi get details of main Wpt (chMain)
-			chMain=null;
-			cacheDirty=false;
-			if (tbP.getSelectedCache()>=Global.mainTab.tbP.myMod.numRows || tbP.getSelectedCache()<0) {
-				ch=null;
-				chD=null;
-				lastselected="";
+			chMain = null;
+			cacheDirty = false;
+			if (tbP.getSelectedCache() >= Global.mainTab.tbP.myMod.numRows || tbP.getSelectedCache() < 0) {
+				ch = null;
+				chD = null;
+				lastselected = "";
 			} else {
 				ch = cacheDB.get(tbP.getSelectedCache());
-				lastselected=ch.getWayPoint();  // Used in Parser.Skeleton
+				lastselected = ch.getWayPoint(); // Used in
+				// Parser.Skeleton
 				chD = ch.getCacheDetails(true);
 			}
 		}
-		if (panelNo==1) { // Leaving the Details Panel
-			detP.evWaypointChanged=false;
+		if (panelNo == MainTab.DETAILS_CARD) { // Leaving the Details Panel
+			detP.evWaypointChanged = false;
 			// Update chD with Details
-			if(detP.isDirty()) {
-				cacheDirty=true;
+			if (detP.isDirty()) {
+				cacheDirty = true;
 				boolean needTableUpdate = detP.getNeedsTableUpdate();
 				detP.saveDirtyWaypoint();
 				if (needTableUpdate) {
-					tbP.myMod.updateRows();// This sorts the waypoint (if it is new) into the right position
+					tbP.myMod.updateRows();// This sorts the waypoint (if
+					// it is new) into the right
+					// position
 					tbP.selectRow(profile.getCacheIndex(detP.cache.getWayPoint()));
 				}
-				//was tbP.refreshTable();
+				// was tbP.refreshTable();
 				tbP.tc.update(true); // Update and repaint
-				if (statBar!=null) statBar.updateDisplay("");
+				if (statBar != null)
+					statBar.updateDisplay("");
 			}
 		}
-		if (panelNo==5) { // Leaving the Solver Panel
+		if (panelNo == MainTab.SOLVER_CARD) { // Leaving the Solver Panel
 			// Update chD or chMain with Solver
-			// If chMain is set (i.e. if it is an addi Wpt) save it immediately
-			if (chD!=null && solverP.isDirty()) {
-				if (chMain==null) {
-					cacheDirty=true;
+			// If chMain is set (i.e. if it is an addi Wpt) save it
+			// immediately
+			if (chD != null && solverP.isDirty()) {
+				if (chMain == null) {
+					cacheDirty = true;
 					boolean oldHasSolver = chD.getParent().hasSolver();
 					chD.setSolver(solverP.getInstructions());
-					if (oldHasSolver != chD.getParent().hasSolver()) tbP.tc.update(true);
-					// For safety reasons: Immediately save solver instructions when
+					if (oldHasSolver != chD.getParent().hasSolver())
+						tbP.tc.update(true);
+					// For safety reasons: Immediately save solver
+					// instructions when
 					// switching panels
 					updatePendingChanges();
 				} else {
 					boolean oldHasSolver = chMain.hasSolver();
 					chMain.getCacheDetails(true).setSolver(solverP.getInstructions());
-					if (oldHasSolver != chMain.hasSolver()) tbP.tc.update(true);
+					if (oldHasSolver != chMain.hasSolver())
+						tbP.tc.update(true);
 					chMain.save();
-					chMain=null;
+					chMain = null;
 				}
 			}
 		}
@@ -218,120 +266,122 @@
 
 	/**
 	 * Code to execute when entering a panel (getSelectedItem() is the panel number)
-	 *
+	 * 
 	 */
 	private void onEnteringPanel(int panelNo) {
-		switch (panelNo) {// Switch by panel number
-		case 0:  //MainPanel
-			MyLocale.setSIPOff();
+		MyLocale.setSIPOff();
+		if (panelNo == LIST_CARD) {
 			// If Solver or Details has changed, save Cache
 			updatePendingChanges();
 			if (detP.hasBlackStatusChanged()) {
 				tbP.refreshTable();
 			}
 			updateCurCentrePtFromGPS();
-			break;
-		case 1:  // DetailsPanel
+		} else if (panelNo == DETAILS_CARD) {
 			boolean newCache = false;
-			if (chD==null) { // Empty DB - show a dummy detail
-				newWaypoint(ch=new CacheHolder());
+			if (chD == null) { // Empty DB - show a dummy detail
+				newWaypoint(ch = new CacheHolder());
 				newCache = true;
 			}
-			MyLocale.setSIPOff();
 			detP.setDetails(ch, newCache);
-			break;
-		case 2: // Description Panel
-			MyLocale.setSIPOff();
+		} else if (panelNo == DESCRIPTION_CARD) {
 			descP.setText(ch);
-			break;
-		case 3: // Picture Panel
-			MyLocale.setSIPOff();
+		} else if (panelNo == IMAGES_CARD) {
 			if (ch.isAddiWpt()) {
 				imageP.setImages(ch.mainCache.getCacheDetails(true));
 			} else {
 				imageP.setImages(chD);
 			}
-			break;
-		case 4:  // Log Hint Panel
-			MyLocale.setSIPOff();
+		} else if (panelNo == HINTSANSLOGS_CARD) {
 			if (ch.isAddiWpt()) {
 				hintLP.setText(ch.mainCache.getCacheDetails(true));
 			} else {
 				hintLP.setText(chD);
 			}
-			break;
-		case 5:  // Solver Panel
-			MyLocale.setSIPOff();
+		} else if (panelNo == SOLVER_CARD) {
 			if (ch.isAddiWpt()) {
-				chMain=ch.mainCache;
+				chMain = ch.mainCache;
 				solverP.setInstructions(ch.mainCache);
 			} else {
 				solverP.setInstructions(ch);
 			}
-			break;
-		case 6:  // CalcPanel
-			MyLocale.setSIPOff();
-			if (ch != null) calcP.setFields(ch);
-			break;
-		case 7: // GotoPanel
-			MyLocale.setSIPOff();
-			break;
-		case 8:  // Cache Radar Panel
-			MyLocale.setSIPOff();
+		} else if (panelNo == CALC_CARD) {
+			if (ch != null)
+				calcP.setFields(ch);
+		} else if (panelNo == MAP_CARD) {
+			gotoP.switchToMovingMap();
+			if (oldCard == LIST_CARD) {
+				select(listP);
+			} else if (oldCard == DETAILS_CARD) {
+				select(detP);
+			} else if (oldCard == DESCRIPTION_CARD) {
+				select(descP);
+			} else if (oldCard == IMAGES_CARD) {
+				select(imageP);
+			} else if (oldCard == HINTSANSLOGS_CARD) {
+				select(hintLP);
+			} else if (oldCard == SOLVER_CARD) {
+				select(solverP);
+			} else if (oldCard == CALC_CARD) {
+				select(calcP);
+			} else if (oldCard == GOTO_CARD) {
+				select(gotoP);
+			} else if (oldCard == RADAR_CARD) {
+				select(radarP);
+			}
+		} else if (panelNo == RADAR_CARD) {
 			radarP.setParam(pref, cacheDB, ch);
 			radarP.drawThePanel();
 			updateCurCentrePtFromGPS();
-			break;
 		}
+		oldCard = panelNo;
 	}
+
 	/**
 	 * this is called from MovingMap Cache context menu
-	 * @param chi , the CacheHolder for the Cache to switch to
-	 * @param panelNo 1=DetailsPanel 2=Description Panel
+	 * 
+	 * @param chi ,
+	 *            the CacheHolder for the Cache to switch to
+	 * @param panelNo
+	 *            1=DetailsPanel 2=Description Panel
 	 */
 	public void openPanel(CacheHolder chi, int panelNo) {
-		MyLocale.setSIPOff();
-		// To change cache we need to be in panel 0
-		onLeavingPanel(oldCard); // is 7 or 1
-		onEnteringPanel(0); oldCard=0;
+		// To change cache we need to be in panel LIST_CARD
+		onLeavingPanel(oldCard);
+		onEnteringPanel(LIST_CARD);
 		int row = profile.getCacheIndex(chi.getWayPoint());
 		tbP.selectRow(row);
-	switch (panelNo) {// Switch by panel number
-		case 1:  // DetailsPanel
-			ch=chi; //possibly wrong (old) detail if map is called directly
-			onEnteringPanel(1);
-			oldCard=1;
+		if (panelNo == DETAILS_CARD) {
+			ch = chi; // possibly wrong (old) detail if map is called
+			// directly
+			onEnteringPanel(DETAILS_CARD);
 			select(detP);
-			break;
-		case 2: // Description Panel
+		} else if (panelNo == DESCRIPTION_CARD) {
+			onEnteringPanel(DESCRIPTION_CARD);
 			select(descP);
-			break;
-		}		
+		}
+
 	}
 
-
 	/**
-	 * this is called from goto / MovingMap / CalcPanel / DetailsPanel and so on to
-	 * offer the user the possibility of entering an new waypoint
-	 * at a given position. pCh must already been preset with a valid
-	 * CacheHolder object
-	 *
+	 * this is called from goto / MovingMap / CalcPanel / DetailsPanel and so on to offer the user the possibility of
+	 * entering an new waypoint at a given position. pCh must already been preset with a valid CacheHolder object
+	 * 
 	 * @param pCh
 	 */
-	public void newWaypoint(CacheHolder pCh){
-		//When creating a new waypoint, simulate a change to the list view
-		//if we are currently NOT in the list view
-		if (oldCard != 0)
-		{
+	public void newWaypoint(CacheHolder pCh) {
+		// When creating a new waypoint, simulate a change to the list view
+		// if we are currently NOT in the list view
+		if (oldCard != LIST_CARD) {
 			onLeavingPanel(oldCard);
 		}
 		updatePendingChanges(); // was: onEnteringPanel(0); oldCard=0;
 
-		mainCache=lastselected;
-		int selectedIndex = profile.getCacheIndex( lastselected );
+		mainCache = lastselected;
+		int selectedIndex = profile.getCacheIndex(lastselected);
 		if (selectedIndex >= 0) {
-			CacheHolder selectedCache = profile.cacheDB.get( selectedIndex );
-			if ( selectedCache.isAddiWpt() ) {
+			CacheHolder selectedCache = profile.cacheDB.get(selectedIndex);
+			if (selectedCache.isAddiWpt()) {
 				if (selectedCache.mainCache != null) {
 					mainCache = selectedCache.mainCache.getWayPoint();
 				} else {
@@ -339,12 +389,12 @@
 				}
 			}
 		}
-		if (CacheType.isAddiWpt(pCh.getType()) && mainCache!=null && mainCache.length()>2) {
+		if (CacheType.isAddiWpt(pCh.getType()) && mainCache != null && mainCache.length() > 2) {
 			pCh.setWayPoint(profile.getNewAddiWayPointName(mainCache));
 			profile.setAddiRef(pCh);
 		} else {
 			pCh.setWayPoint(profile.getNewWayPointName());
-			lastselected=pCh.getWayPoint();
+			lastselected = pCh.getWayPoint();
 		}
 		pCh.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
 		chD = pCh.getCacheDetails(false);
@@ -353,18 +403,20 @@
 		Global.getProfile().notifyUnsavedChanges(true); // Just to be sure
 		tbP.myMod.numRows++;
 		detP.setDetails(pCh, true);
-		oldCard=1;
-		if (this.cardPanel.selectedItem != 1) select(detP);
+		oldCard = DETAILS_CARD;
+		if (this.cardPanel.selectedItem != 1)
+			select(detP);
 		solverP.setInstructions(pCh);
-		//tbP.refreshTable(); // moved this instruction to onLeavingPanel
+		// tbP.refreshTable(); // moved this instruction to onLeavingPanel
 
 	}
 
-
 	/**
 	 * sets posCircle Lat/Lon to centerTo
-	 *
-	 * @param centerTo true: centers centerTo on the screen and disconnects MovingMap from GPS if Gps-pos is not on the loaded map
+	 * 
+	 * @param centerTo
+	 *            true: centers centerTo on the screen and disconnects MovingMap from GPS if Gps-pos is not on the
+	 *            loaded map
 	 * @param forceCenter
 	 */
 	public void SwitchToMovingMap(CWPoint centerTo, boolean forceCenter) {
@@ -377,19 +429,29 @@
 				mm = new MovingMap(nav, profile.cacheDB);
 				nav.setMovingMap(mm);
 			}
-			
+
 			mm.myExec(centerTo, forceCenter);
-			
+
 			if (forceCenter) {
 				try {
 					int i = 0;
-					while (MapImage.screenDim.width == 0 && i < 10*60) { i++; ewe.sys.mThread.sleep(100);} // wait until the window size of the moving map is known note: ewe.sys.sleep() will pause the whole vm - no other thread will run
-					if (i >= 10*60) {(new MessageBox("Error", "MovingMap cannot be displayed - this is most likely a bug - plaese report it on www.geoclub.de", FormBase.OKB)).execute(); return;}
-					//If white Areas are filled there is a problem with painting the image. We force painting here.
-					mm.repaint ();
-				}catch (InterruptedException e) {
+					while (MapImage.screenDim.width == 0 && i < 10 * 60) {
+						i++;
+						ewe.sys.mThread.sleep(100);
+					} // wait until the window size of the moving map is
+					// known note: ewe.sys.sleep() will pause the whole
+					// vm - no other thread will run
+					if (i >= 10 * 60) {
+						(new MessageBox("Error", "MovingMap cannot be displayed - this is most likely a bug - plaese report it on www.geoclub.de", FormBase.OKB)).execute();
+						return;
+					}
+					// If white Areas are filled there is a problem with
+					// painting the image. We force painting here.
+					mm.repaint();
+				} catch (InterruptedException e) {
 					Global.getPref().log("Error starting mavoing map (1): ", e, true);
-					(new MessageBox("Error", "This must not happen please report to pfeffer how to produce this error message", FormBase.OKB)).execute(); }
+					(new MessageBox("Error", "This must not happen please report to pfeffer how to produce this error message", FormBase.OKB)).execute();
+				}
 			}
 		} catch (Exception e) { // TODO swith waiting indication clock off
 			Global.getPref().log("Error starting moving map (2): ", e, true);
@@ -405,39 +467,41 @@
 		}
 	}
 
-	/** Save the index file
-	 *
-	 * @param askForConfirmation is ignored, old: If true, the save can be cancelled by user
+	/**
+	 * Save the index file
+	 * 
+	 * @param askForConfirmation
+	 *            is ignored, old: If true, the save can be cancelled by user
 	 */
 	public void saveUnsavedChanges(boolean askForConfirmation) {
-		if (oldCard!=0) {
+		if (oldCard != LIST_CARD) {
 			onLeavingPanel(oldCard);
-			onEnteringPanel(0);
-			oldCard=0;
+			onEnteringPanel(LIST_CARD);
+			oldCard = LIST_CARD;
 		}
 		updatePendingChanges();
-		if (profile.hasUnsavedChanges()) profile.saveIndex(Global.getPref(),true);
-	    this.tbP.saveColWidth(pref);
+		if (profile.hasUnsavedChanges())
+			profile.saveIndex(Global.getPref(), true);
+		this.tbP.saveColWidth(pref);
 		Global.getPref().savePreferences();
 	}
 
 	private void checkProfileChange() {
 		// A panel is selected. Could be the same panel twice
 		mnuMain.allowProfileChange(false);
-		if(this.getSelectedItem() == 0){// List view selected
+		if (this.getSelectedItem() == 0) {// List view selected
 			mnuMain.allowProfileChange(true);
 			MyLocale.setSIPOff();
 		}
 	}
 
-	private void  updateCurCentrePtFromGPS() {
-		if (pref.setCurrentCentreFromGPSPosition){
+	private void updateCurCentrePtFromGPS() {
+		if (pref.setCurrentCentreFromGPSPosition) {
 			if (nav.gpsRunning) {
 				CWPoint whereAmI = nav.gpsPos;
 				if (whereAmI.isValid()) {
 					CWPoint curCentr = pref.getCurCentrePt();
-					if (whereAmI.latDec != curCentr.latDec ||
-						whereAmI.lonDec != curCentr.lonDec ) {
+					if (whereAmI.latDec != curCentr.latDec || whereAmI.lonDec != curCentr.lonDec) {
 						pref.setCurCentrePt(whereAmI);
 					}
 				}
@@ -447,7 +511,3 @@
 }
 //
 
-
-
-
-

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-06-13 17:58:00 UTC (rev 3026)
+++ trunk/src/CacheWolf/Preferences.java	2011-06-15 20:53:01 UTC (rev 3027)
@@ -51,14 +51,16 @@
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.Iterator;
-import ewe.util.Map.MapEntry;
 import ewe.util.StringTokenizer;
 import ewe.util.Utils;
+import ewe.util.Map.MapEntry;
 import ewesoft.xml.MinML;
 import ewesoft.xml.sax.AttributeList;
 
 /**
- * A class to hold the preferences that were loaded upon start up of CacheWolf. This class is also capable of parsing the prefs.xml file as well as saving the current settings of preferences.
+ * A class to hold the preferences that were loaded upon start up of
+ * CacheWolf. This class is also capable of parsing the prefs.xml file as
+ * well as saving the current settings of preferences.
  */
 public class Preferences extends MinML {
 
@@ -68,7 +70,8 @@
 	public final int DEFAULT_GPSD_PORT = 2947;
 	public static final int GPSD_DISABLED = 0; // do not use gpsd
 	public static final int GPSD_FORMAT_OLD = 1; // use old protocol
-	public static final int GPSD_FORMAT_NEW = 2; // use new protocol (JSON)
+	public static final int GPSD_FORMAT_NEW = 2; // use new protocol
+													// (JSON)
 	public static final int YES = 0;
 	public static final int NO = 1;
 	public static final int ASK = 2;
@@ -103,7 +106,8 @@
 
 	/**
 	 * Call this method to set the path of the config file <br>
-	 * If you call it with null it defaults to [program-dir]/pref.xml if p is a directory "pref.xml" will automatically appended
+	 * If you call it with null it defaults to [program-dir]/pref.xml if p
+	 * is a directory "pref.xml" will automatically appended
 	 * 
 	 * @param p
 	 */
@@ -111,10 +115,21 @@
 		String p_;
 		if (p == null) {
 			/*
-			 * String test; test = Vm.getenv("APPDATA", "/"); // returns in java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application data> log("Vm.getenv(APPDATA: " + test); // this works also in win32.exe (ewe-vm on win xp) test =
-			 * Vm.getenv("HOME", "/"); // This should return on *nix system the home dir log("Vm.getenv(HOME: " + test); test = System.getProperty("user.dir"); // return in java-vm on win xp: <working dir> or maybe <program dir>
-			 * log("System.getProperty(user.dir: " + test); // in win32.exe -> null test = System.getProperty("user.home"); // in MS-java-VM env variable $HOME is ignored and always <windir>\java returned, see
-			 * http://support.microsoft.com/kb/177181/en-us/ log("System.getProperty(user.home: " + test); // in win32.exe -> null // "user.dir" User's current working directory // "user.home" User home directory (taken from
+			 * String test; test = Vm.getenv("APPDATA", "/"); // returns in
+			 * java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application
+			 * data> log("Vm.getenv(APPDATA: " + test); // this works also
+			 * in win32.exe (ewe-vm on win xp) test = Vm.getenv("HOME",
+			 * "/"); // This should return on *nix system the home dir
+			 * log("Vm.getenv(HOME: " + test); test =
+			 * System.getProperty("user.dir"); // return in java-vm on win
+			 * xp: <working dir> or maybe <program dir>
+			 * log("System.getProperty(user.dir: " + test); // in win32.exe ->
+			 * null test = System.getProperty("user.home"); // in MS-java-VM
+			 * env variable $HOME is ignored and always <windir>\java
+			 * returned, see http://support.microsoft.com/kb/177181/en-us/
+			 * log("System.getProperty(user.home: " + test); // in win32.exe ->
+			 * null // "user.dir" User's current working directory //
+			 * "user.home" User home directory (taken from
 			 * http://scv.bu.edu/Doc/Java/tutorial/java/system/properties.html )
 			 */
 			p_ = FileBase.makePath(FileBase.getProgramDirectory(), "pref.xml");
@@ -124,7 +139,16 @@
 			else
 				p_ = p;
 		}
-		pathToConfigFile = STRreplace.replace(p_, "//", "/"); // this is necessary in case that the root dir is the dir where the pref.xml is stored
+		pathToConfigFile = STRreplace.replace(p_, "//", "/"); // this is
+																// necessary
+																// in case
+																// that the
+																// root dir
+																// is the
+																// dir where
+																// the
+																// pref.xml
+																// is stored
 		pathToConfigFile = pathToConfigFile.replace('\\', '/');
 		p = System.getProperty("os.name");
 		if (p == null || p.indexOf("indows") != -1) {
@@ -164,7 +188,10 @@
 	public String absoluteBaseDir = "";
 	/** Name of last used profile */
 	public String lastProfile = "";
-	/** If true, the last profile is reloaded automatically without a dialogue */
+	/**
+	 * If true, the last profile is reloaded automatically without a
+	 * dialogue
+	 */
 	public boolean autoReloadLastProfile = false;
 	/** If true current cetre will be set from gps position */
 	public boolean setCurrentCentreFromGPSPosition = true;
@@ -172,7 +199,10 @@
 	public String myAlias = "";
 	/** Optional password */
 	public String password = "";
-	/** This is an alternative alias used to identify found caches (i.e. if using multiple IDs) */
+	/**
+	 * This is an alternative alias used to identify found caches (i.e. if
+	 * using multiple IDs)
+	 */
 	public String myAlias2 = "";
 	/** The path to the browser */
 	public String browser = "";
@@ -201,7 +231,8 @@
 	/** The default font size */
 	public int fontSize;
 	public String fontName;
-	// These settings govern where the menu and the tabs are displayed and whether the statusbas is shown
+	// These settings govern where the menu and the tabs are displayed and
+	// whether the statusbas is shown
 	/** True if the menu is to be displayed at the top of the screen */
 	public boolean menuAtTop = true;
 	/** True if the tabs are to be displayed at the top of the screen */
@@ -210,7 +241,9 @@
 	public boolean showStatus = true;
 	// public boolean noTabs=false;
 	/**
-	 * True if the application can be closed by clicking on the close button in the top line. This can be set to avoid accidental closing of the application
+	 * True if the application can be closed by clicking on the close button
+	 * in the top line. This can be set to avoid accidental closing of the
+	 * application
 	 */
 	public boolean hasCloseButton = true;
 	/** True if the SIP is always visible */
@@ -219,15 +252,24 @@
 	public String listColMap = "0,1,2,3,4,5,6,7,8,9,10,11,12";
 	/** The widths for each column in list view */
 	public String listColWidth = "15,20,20,25,92,177,144,83,60,105,50,104,22,30,30,30,30,30,30,30";
-	/** The columns which are to be displayed in TravelbugsJourneyScreen. See also TravelbugJourney */
+	/**
+	 * The columns which are to be displayed in TravelbugsJourneyScreen. See
+	 * also TravelbugJourney
+	 */
 	public String travelbugColMap = "1,4,5,6,8,9,10,7";
 	/** The column widths for the travelbug journeys. */
 	public String travelbugColWidth = "212,136,62,90,50,56,90,38,50,50,94,50";
-	/** If this flag is true, only non-logged travelbug journeys will be shown */
+	/**
+	 * If this flag is true, only non-logged travelbug journeys will be
+	 * shown
+	 */
 	public boolean travelbugShowOnlyNonLogged = false;
 	/** If this is true, deleted images are shown with a ? in the imagepanel */
 	public boolean showDeletedImages = true;
-	/** This setting determines how many logs are shown per page of hintlogs (default 5) */
+	/**
+	 * This setting determines how many logs are shown per page of hintlogs
+	 * (default 5)
+	 */
 	public int logsPerPage = DEFAULT_LOGS_PER_PAGE;
 	/** Initial height of hints field (set to 0 to hide them initially) */
 	public int initialHintHeight = DEFAULT_INITIAL_HINT_HEIGHT;
@@ -235,7 +277,10 @@
 	public int maxLogsToSpider = DEFAULT_MAX_LOGS_TO_SPIDER;
 	/** True if the Solver should ignore the case of variables */
 	public boolean solverIgnoreCase = true;
-	/** True if the solver expects arguments for trigonometric functions in degrees */
+	/**
+	 * True if the solver expects arguments for trigonometric functions in
+	 * degrees
+	 */
 	public boolean solverDegMode = true;
 	/** True if the description panel should show images */
 	public boolean descShowImg = true;
@@ -243,13 +288,17 @@
 	public String garminConn = "com1";
 	/** Additional options for GPSBabel, i.e. -s to synthethise short names */
 	public String garminGPSBabelOptions = "";
-	/** Max. length for Garmin waypoint names (for etrex which can only accept 6 chars) */
+	/**
+	 * Max. length for Garmin waypoint names (for etrex which can only
+	 * accept 6 chars)
+	 */
 	public int garminMaxLen = 0;
 	/** OC true = alle neu Laden false = wenn ?nderungsdatum neuer */
 	public boolean downloadAllOC = false;
 	public String lastOCSite = OC.OCSites[0][OC.OC_HOSTNAME];
 	/**
-	 * The currently used centre point, can be different from the profile's centrepoint. This is used for spidering
+	 * The currently used centre point, can be different from the profile's
+	 * centrepoint. This is used for spidering
 	 */
 	private CWPoint curCentrePt = new CWPoint();
 	/** True if a login screen is displayed on each spider operation */
@@ -260,7 +309,10 @@
 	private String customMapsPath = null;
 	/** Number of CacheHolder details that are kept in memory */
 	public int maxDetails = 50;
-	/** Number of details to delete when maxDetails have been stored in cachesWithLoadedDetails */
+	/**
+	 * Number of details to delete when maxDetails have been stored in
+	 * cachesWithLoadedDetails
+	 */
 	public int deleteDetails = 5;
 	/** The locale code (DE, EN, ...) */
 	public String language = "";
@@ -320,7 +372,7 @@
 	public boolean SortingGroupedByCache = true;
 	/** useOwnSymbols */
 	public boolean useOwnSymbols = true;
-	/** TRUE if we want automatic sorting **/
+	/** TRUE if we want automatic sorting * */
 	public boolean sortAutomatic = true;
 	//
 	public String oldLanguageCtl = "";
@@ -328,10 +380,11 @@
 
 	// ////////////////////////////////////////////
 	/**
-	 * The debug switch (Can be used to activate dormant code) by adding the line:
+	 * The debug switch (Can be used to activate dormant code) by adding the
+	 * line:
 	 * 
 	 * <pre>
-	 * <debug value="true" />
+	 * &lt;debug value=&quot;true&quot; /&gt;
 	 * </pre>
 	 * 
 	 * to the pref.xml file.
@@ -340,7 +393,10 @@
 	// ////////////////////////////////////////////
 
 	/**
-	 * This switches the behaviour of GUI-Element factories. If set to true, it will construct alternative Forms. It can only be set in the Preference-File directly, not by user-interaction now. Add <MobileGui value="true"/> to your pref.xml
+	 * This switches the behaviour of GUI-Element factories. If set to true,
+	 * it will construct alternative Forms. It can only be set in the
+	 * Preference-File directly, not by user-interaction now. Add <MobileGui
+	 * value="true"/> to your pref.xml
 	 */
 	public boolean mobileGUI = false;
 
@@ -362,7 +418,9 @@
 	// ////////////////////////////////////////////////////////////////////////////////////
 
 	/**
-	 * Method to open and parse the config file (pref.xml). Results are stored in the public variables of this class. If you want to specify a non default config file call setPathToConfigFile() first.
+	 * Method to open and parse the config file (pref.xml). Results are
+	 * stored in the public variables of this class. If you want to specify
+	 * a non default config file call setPathToConfigFile() first.
 	 */
 	public void readPrefFile() {
 		if (pathToConfigFile == null)
@@ -381,7 +439,7 @@
 			else
 				log("Error reading pref.xml: ", e);
 		}
-		useBigIcons = Vm.isMobile() && MyLocale.getScreenWidth() >= 400;
+		useBigIcons = MyLocale.getScreenWidth() >= 400; // && Vm.isMobile()
 		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
 	}
 
@@ -394,7 +452,11 @@
 		String pf = Vm.getPlatform();
 		String testlist[] = null;
 		if (pf.equals("Java") || pf.equals("Win32")) {
-			String progdir = Vm.getenv("ProgramFiles", null); // at least in java-Win XP this is set
+			String progdir = Vm.getenv("ProgramFiles", null); // at least
+																// in
+																// java-Win
+																// XP this
+																// is set
 			String homedir = Vm.getenv("HOMEPATH", "");
 			if (progdir != null) {
 				String test[] = { homedir + "/Lokale Einstellungen/Anwendungsdaten/Google/Chrome/Application/chrome.exe", progdir + "/Firefox/firefox.exe", progdir + "/Opera/opera.exe", progdir + "/Internet Explorer/iexplore.exe" };
@@ -421,7 +483,8 @@
 
 	/** Helper variables for XML parser */
 	private StringBuffer collectElement = null;
-	private String lastName; // The string to the last XML that was processed
+	private String lastName; // The string to the last XML that was
+								// processed
 
 	private long getLongAttr(AttributeList atts, String name) {
 		String stmp = atts.getValue(name);
@@ -433,7 +496,8 @@
 	}
 
 	/**
-	 * Method that gets called when a new element has been identified in pref.xml
+	 * Method that gets called when a new element has been identified in
+	 * pref.xml
 	 */
 	public void startElement(String name, AttributeList atts) {
 		lastName = name;
@@ -683,12 +747,15 @@
 
 	public void characters(char ch[], int start, int length) {
 		if (collectElement != null) {
-			collectElement.append(ch, start, length); // Collect the name of the last profile
+			collectElement.append(ch, start, length); // Collect the name
+														// of the last
+														// profile
 		}
 	}
 
 	/**
-	 * Method that gets called when the end of an element has been identified in pref.xml
+	 * Method that gets called when the end of an element has been
+	 * identified in pref.xml
 	 */
 	public void endElement(String tag) {
 		if (tag.equals("lastprofile")) {
@@ -837,7 +904,10 @@
 				outp.print(this.getFilter(filterIDs[i]).toXML(filterIDs[i]));
 			}
 			if (debug)
-				outp.print("    <debug value=\"true\" />\n"); // Keep the debug switch if it is set
+				outp.print("    <debug value=\"true\" />\n"); // Keep the
+																// debug
+																// switch if
+																// it is set
 			// save last path of different exporters
 			Iterator itPath = exporterPaths.entries();
 			MapEntry entry;
@@ -858,7 +928,13 @@
 			outp.print("    <SortingGroupedByCache on=\"" + SafeXML.strxmlencode(SortingGroupedByCache) + "\"/>\n");
 			outp.print("    <Symbols useOwnSymbols=\"" + SafeXML.strxmlencode(useOwnSymbols) + "\"/>\n");
 			if (mobileGUI)
-				outp.print("    <MobileGui value=\"true\" />\n"); // Keep the vmgui switch if it is set
+				outp.print("    <MobileGui value=\"true\" />\n"); // Keep
+																	// the
+																	// vmgui
+																	// switch
+																	// if it
+																	// is
+																	// set
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {
@@ -928,8 +1004,11 @@
 	}
 
 	/**
-	 * gets the path to the calibrated maps it first tries if there are manually imported maps in <baseDir>/maps/standard then it tries the legacy dir: <program-dir>/maps In case in both locations are no .wfl-files it returns <baseDir>/maps/expedia - the
-	 * place where the automatically downloaded maps are placed.
+	 * gets the path to the calibrated maps it first tries if there are
+	 * manually imported maps in <baseDir>/maps/standard then it tries the
+	 * legacy dir: <program-dir>/maps In case in both locations are no
+	 * .wfl-files it returns <baseDir>/maps/expedia - the place where the
+	 * automatically downloaded maps are placed.
 	 * 
 	 * 
 	 */
@@ -950,7 +1029,9 @@
 		if (f != null && f.length > 0)
 			return absoluteBaseDir + mapsPath;
 		f = t.list("*.wfl", FileBase.LIST_DIRECTORIES_ONLY | FileBase.LIST_ALWAYS_INCLUDE_DIRECTORIES);
-		if (f != null && f.length > 0) { // see if in a subdir of <baseDir>/maps/standard are .wfl files
+		if (f != null && f.length > 0) { // see if in a subdir of
+											// <baseDir>/maps/standard are
+											// .wfl files
 			String[] f2;
 			for (int i = 0; i < f.length; i++) {
 				t.set(null, ret + "/" + f[i]);
@@ -998,12 +1079,15 @@
 	/**
 	 * @param create
 	 *            if true the directory if it doesn't exist will be created
-	 * @return the path where manually imported maps should be stored this should be adjustable in preferences...
+	 * @return the path where manually imported maps should be stored this
+	 *         should be adjustable in preferences...
 	 */
 	public String getMapManuallySavePath(boolean create) {
 		String mapsDir = absoluteBaseDir + mapsPath;
-		if (create && !(new FileBugfix(mapsDir).isDirectory())) { // dir exists?
-			if (new FileBugfix(mapsDir).mkdirs() == false) {// dir creation failed?
+		if (create && !(new FileBugfix(mapsDir).isDirectory())) { // dir
+																	// exists?
+			if (new FileBugfix(mapsDir).mkdirs() == false) {// dir creation
+															// failed?
 				(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(172, "Error: cannot create maps directory: \n") + mapsDir, FormBase.OKB)).exec();
 				return null;
 			}
@@ -1018,7 +1102,8 @@
 		String subdir = Global.getProfile().dataDir.substring(Global.getPref().absoluteBaseDir.length()).replace('\\', '/');
 		String mapsDir = Global.getPref().absoluteBaseDir + "maps/" + Common.ClearForFileName(mapkind) + "/" + subdir;
 		if (!(new FileBugfix(mapsDir).isDirectory())) { // dir exists?
-			if (new FileBugfix(mapsDir).mkdirs() == false) // dir creation failed?
+			if (new FileBugfix(mapsDir).mkdirs() == false) // dir creation
+															// failed?
 			{
 				(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(172, "Error: cannot create maps directory: \n") + new FileBugfix(mapsDir).getParentFile(), FormBase.OKB)).exec();
 				return null;
@@ -1028,7 +1113,10 @@
 	}
 
 	public String getMapExpediaLoadPath() {
-		return Global.getPref().absoluteBaseDir.replace('\\', '/') + "maps/expedia"; // baseDir has trailing /
+		return Global.getPref().absoluteBaseDir.replace('\\', '/') + "maps/expedia"; // baseDir
+																						// has
+																						// trailing
+																						// /
 	}
 
 	// ////////////////////////////////////////////////////////////////////////////////////
@@ -1040,18 +1128,31 @@
 	static protected final int PROFILE_SELECTOR_ONOROFF = 2;
 
 	/**
-	 * tries to get the home data dir of the user e.g. "c:\documents and...\<user>\my documents" or "/home/<user>" in linux if none could be identified, "/" is returned.
+	 * tries to get the home data dir of the user e.g. "c:\documents and...\<user>\my
+	 * documents" or "/home/<user>" in linux if none could be identified,
+	 * "/" is returned.
 	 * 
 	 * @return
 	 */
 	public String getHomeDir() {
 		String test;
-		test = Vm.getenv("HOMEDRIVE", ""); // returns in java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application data>
-		log("[Preferences:getHomeDir]" + test); // this works also in win32.exe (ewe-vm on win xp)
-		test += Vm.getenv("HOMEPATH", ""); // returns in java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application data>
-		log("[Preferences:getHomeDir]" + test); // this works also in win32.exe (ewe-vm on win xp)
+		test = Vm.getenv("HOMEDRIVE", ""); // returns in java-vm on win xp:
+											// c:\<dokumente und
+											// Einstellungen>\<username>\<application
+											// data>
+		log("[Preferences:getHomeDir]" + test); // this works also in
+												// win32.exe (ewe-vm on win
+												// xp)
+		test += Vm.getenv("HOMEPATH", ""); // returns in java-vm on win xp:
+											// c:\<dokumente und
+											// Einstellungen>\<username>\<application
+											// data>
+		log("[Preferences:getHomeDir]" + test); // this works also in
+												// win32.exe (ewe-vm on win
+												// xp)
 		if (test.length() == 0)
-			test = Vm.getenv("HOME", ""); // This should return on *nix system the home dir
+			test = Vm.getenv("HOME", ""); // This should return on *nix
+											// system the home dir
 		if (test.length() == 0)
 			test = "/";
 		return test;
@@ -1082,7 +1183,10 @@
 		checkAbsoluteBaseDir();
 		boolean profileExists = true; // Assume that the profile exists
 		do {
-			if (!profileExists || (showProfileSelector == PROFILE_SELECTOR_FORCED_ON) || (showProfileSelector == PROFILE_SELECTOR_ONOROFF && !autoReloadLastProfile)) { // Ask for the profile
+			if (!profileExists || (showProfileSelector == PROFILE_SELECTOR_FORCED_ON) || (showProfileSelector == PROFILE_SELECTOR_ONOROFF && !autoReloadLastProfile)) { // Ask
+																																										// for
+																																										// the
+																																										// profile
 				ProfilesForm f = new ProfilesForm(absoluteBaseDir, lastProfile, !profileExists || hasNewButton ? 0 : 1);
 				int code = f.execute();
 				// If no profile chosen (includes a new one), terminate
@@ -1176,7 +1280,9 @@
 	private final String LOGFILENAME = FileBase.getProgramDirectory() + "/log.txt";
 
 	/**
-	 * Method to delete an existing log file. Called on every SpiderGC. The log file is also cleared when Preferences is created and the filesize > 60KB
+	 * Method to delete an existing log file. Called on every SpiderGC. The
+	 * log file is also cleared when Preferences is created and the filesize >
+	 * 60KB
 	 */
 	public void logInit() {
 		File logFile = new FileBugfix(LOGFILENAME);
@@ -1193,10 +1299,12 @@
 	boolean forceLog = false;
 
 	/**
-	 * Method to log messages to a file called log.txt It will always append to an existing file. To show the message on the console, the global variable debug must be set. This can be done by adding
+	 * Method to log messages to a file called log.txt It will always append
+	 * to an existing file. To show the message on the console, the global
+	 * variable debug must be set. This can be done by adding
 	 * 
 	 * <pre>
-	 * &lt;debug value="true"&gt;
+	 * &lt;debug value=&quot;true&quot;&gt;
 	 * </pre>
 	 * 
 	 * to the pref.xml file
@@ -1239,14 +1347,18 @@
 	 * @param e
 	 *            The exception
 	 * @param withStackTrace
-	 *            If true and the debug switch is true, the stack trace is appended to the log The debug switch can be set by including the line <i>&lt;debug value="true"&gt;&lt;/debug&gt;</i> in the pref.xml file or by manually setting it (i.e. in BE
-	 *            versions or RC versions) by including the line
+	 *            If true and the debug switch is true, the stack trace is
+	 *            appended to the log The debug switch can be set by
+	 *            including the line <i>&lt;debug
+	 *            value="true"&gt;&lt;/debug&gt;</i> in the pref.xml file
+	 *            or by manually setting it (i.e. in BE versions or RC
+	 *            versions) by including the line
 	 * 
-	 *            <pre>
+	 * <pre>
 	 * Global.getPref().debug = true;
 	 * </pre>
 	 * 
-	 *            in Version.getRelease()
+	 * in Version.getRelease()
 	 */
 	public void log(String text, Throwable e, boolean withStackTrace) {
 		if (e != null) {
@@ -1262,7 +1374,9 @@
 	}
 
 	/**
-	 * Log an exception to the log file without a stack trace, i.e. where a stack trace is not needed because the location/cause of the error is clear
+	 * Log an exception to the log file without a stack trace, i.e. where a
+	 * stack trace is not needed because the location/cause of the error is
+	 * clear
 	 * 
 	 * @param message
 	 *            Optional message (Can be empty string)
@@ -1314,7 +1428,8 @@
 	}
 
 	/**
-	 * <code>True</code> or <code>false</code>, depending if a filter with the given ID is saved in the preferences.
+	 * <code>True</code> or <code>false</code>, depending if a filter
+	 * with the given ID is saved in the preferences.
 	 * 
 	 * @param filterID
 	 *            ID of the filter to check
@@ -1325,7 +1440,8 @@
 	}
 
 	/**
-	 * Returns the FilterData object saved with the given ID. The ID is not saved in the object, so it may be resaved under another ID.
+	 * Returns the FilterData object saved with the given ID. The ID is not
+	 * saved in the object, so it may be resaved under another ID.
 	 * 
 	 * @param filterID
 	 *            ID of the FilterData object
@@ -1336,7 +1452,9 @@
 	}
 
 	/**
-	 * Adds a FilterData object to the list. If a FilterData object is already saved unter the given ID, the old object is removed and the new one is set at its place.
+	 * Adds a FilterData object to the list. If a FilterData object is
+	 * already saved unter the given ID, the old object is removed and the
+	 * new one is set at its place.
 	 * 
 	 * @param filterID
 	 *            ID to associate with the filter object
@@ -1348,7 +1466,8 @@
 	}
 
 	/**
-	 * Removed the FilterData object which is saved with the given ID. If no such FilterData object exists, nothing happens.
+	 * Removed the FilterData object which is saved with the given ID. If no
+	 * such FilterData object exists, nothing happens.
 	 * 
 	 * @param filterID
 	 *            ID of FilterData object to remove
@@ -1358,7 +1477,8 @@
 	}
 
 	/**
-	 * Returns a alphabetically sorted array of ID of saved FilterData objects.
+	 * Returns a alphabetically sorted array of ID of saved FilterData
+	 * objects.
 	 * 
 	 * @return Array of IDs
 	 */
@@ -1388,7 +1508,8 @@
 			p.waitFor();
 			gpsbabel = "gpsbabel";
 		} catch (IOException ioex) {
-			// Most of the time there will be an exception, so don't complain
+			// Most of the time there will be an exception, so don't
+			// complain
 		}
 		if (gpsbabel == null) {
 			try {
@@ -1396,14 +1517,16 @@
 				p.waitFor();
 				gpsbabel = "gpsbabel.exe";
 			} catch (IOException ioex) {
-				// Most of the time there will be an exception, so don't complain
+				// Most of the time there will be an exception, so don't
+				// complain
 			}
 		}
 	}
 
 	/**
 	 * get directory where pref.xml is stored<br>
-	 * use this if you need a path where the user has sufficient rights to create a file
+	 * use this if you need a path where the user has sufficient rights to
+	 * create a file
 	 */
 	public String getPathToConfigFile() {
 		return pathToConfigFile;

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-06-13 17:58:00 UTC (rev 3026)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-06-15 20:53:01 UTC (rev 3027)
@@ -205,15 +205,14 @@
 	public void doIt(boolean _spiderAllFinds) {
 		cachesToLoad.clear();
 		spiderAllFinds = _spiderAllFinds;
-		origin = pref.getCurCentrePt(); // No need to copy curCentrePt as it is
-										// only read and not written
+		// No need to copy curCentrePt as it is only read and not written
+		origin = pref.getCurCentrePt();
 		if (!spiderAllFinds && !origin.isValid()) {
 			(new MessageBox(MyLocale.getMsg(5500, "Error"), MyLocale.getMsg(5509, "Coordinates for centre must be set"), FormBase.OKB)).execute();
 			return;
 		}
 
-		// Reset states for all caches when spidering
-		// (http://tinyurl.com/dzjh7p)
+		// Reset states for all caches when spidering (http://tinyurl.com/dzjh7p)
 		for (int i = 0; i < cacheDB.size(); i++) {
 			final CacheHolder ch = cacheDB.get(i);
 			if (ch.mainCache == null)
@@ -320,12 +319,8 @@
 					for (int i = 0; i < points.size(); i++) {
 						try {
 							nav.curTrack.add((TrackPoint) points.get(i));
-						} catch (final IndexOutOfBoundsException e) { // track
-																		// full
-																		// ->
-																		// create
-																		// a new
-																		// one
+						} catch (final IndexOutOfBoundsException e) {
+							// track full -> create a new one
 							nav.curTrack = new Track(nav.trackColor);
 							nav.curTrack.add((TrackPoint) points.get(i));
 							if (mm != null)
@@ -528,16 +523,15 @@
 		infB = new InfoBox("Status", MyLocale.getMsg(1609, "getting the caches."));
 		infB.exec();
 
-		// Reset states for all caches when spidering
-		// (http://tinyurl.com/dzjh7p)
+		// Reset states for all caches when spidering (http://tinyurl.com/dzjh7p)
 		for (int i = 0; i < cacheDB.size(); i++) {
 			final CacheHolder ch = cacheDB.get(i);
 			if (ch.mainCache == null)
 				ch.initStates(false);
 		}
 
-		double halfSideLength = maxDistance; // halbe Seitenl????nge eines Quadrats
-												// ums Zentrum in km
+		// halbe Seitenl?nge eines Quadrats ums Zentrum in km
+		double halfSideLength = maxDistance;
 		if (pref.metricSystem == Metrics.IMPERIAL) {
 			halfSideLength = Metrics.convertUnit(maxDistance, Metrics.MILES, Metrics.KILOMETER);
 		}
@@ -702,12 +696,11 @@
 			doNotgetFound = options.foundCheckBox.getState();
 			profile.setDirectionGC(direction);
 
-		} else if (menu == 1) { // menu = 1 input values for get Caches along a
-								// route
+		} else if (menu == 1) {
+			// menu = 1 input values for get Caches along a route
 			options = new OCXMLImporterScreen(MyLocale.getMsg(137, "Download along a Route from geocaching.com"), OCXMLImporterScreen.ISGC | OCXMLImporterScreen.DIST | OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.TRAVELBUGS
 					| OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.MAXLOGS | OCXMLImporterScreen.FILENAME | OCXMLImporterScreen.TYPE);
-			// setting defaults for input
-			// doing the input
+			// setting defaults for input doing the input
 			if (options.execute() == FormBase.IDCANCEL) {
 				return false;
 			}
@@ -756,9 +749,10 @@
 			maxDistance = Common.parseDouble(maxDist);
 			if (maxDistance == 0)
 				return false;
+			// zur Sicherheit bei "along the route"
+			// mindenstens 500 meter Umkreis
 			if (maxDistance < 0.5)
-				maxDistance = 0.5; // zur Sicherheit bei "along the route"
-									// mindenstens 500 meter Umkreis
+				maxDistance = 0.5;
 			profile.setDistGC(Double.toString(maxDistance));
 		}
 
@@ -778,8 +772,7 @@
 
 		int numFinds;
 		int startPage = 1;
-		// get pagenumber of page with fromDistance , to skip reading of pages <
-		// fromDistance
+		// get pagenumber of page with fromDistance , to skip reading of pages < fromDistance
 		if (fromDistance > 0) {
 			// distance in miles for URL
 			int fromDistanceInMiles = (int) java.lang.Math.ceil(fromDistance);
@@ -788,9 +781,8 @@
 			}
 			// - a mile to be save to get a page with fromDistance
 			getFirstListPage(java.lang.Math.max(fromDistanceInMiles - 1, 1));
-			numFinds = getNumFound(htmlListPage); // Number of caches from gc
-													// Listpage
-			// calc the number of the startpage
+			// Number of caches from gc Listpage calc the number of the startpage
+			numFinds = getNumFound(htmlListPage);
 			startPage = (int) java.lang.Math.ceil(numFinds / 20);
 		}
 
@@ -799,12 +791,11 @@
 		if (pref.metricSystem != Metrics.IMPERIAL) {
 			toDistanceInMiles = (int) java.lang.Math.ceil(Metrics.convertUnit(toDistance, Metrics.KILOMETER, Metrics.MILES));
 		}
-		// add a mile to be save from different distance calculations in CW and
-		// at GC
+		// add a mile to be save from different distance calculations in CW and at GC
 		toDistanceInMiles++;
 		getFirstListPage(toDistanceInMiles);
-		numFinds = getNumFound(htmlListPage); // Number of caches from gc first
-												// Listpage
+		// Number of caches from gcfirst Listpage
+		numFinds = getNumFound(htmlListPage);
 
 		if (fromDistance > 0) {
 			// skip (most of) the pages with distance < fromDistance
@@ -847,15 +838,15 @@
 				}
 			}
 		}
-		final int startSize = cExpectedForUpdate.size(); // for save reasons
+		// for save reasons
+		final int startSize = cExpectedForUpdate.size();
 
 		// for don't loose the already done work
 		final Hashtable cFoundForUpdate = new Hashtable(cacheDB.size());
 		page_number = 1;
 		int found_on_page = 0;
 		try {
-			// Loop pages till maximum distance has been found or no more caches
-			// are in the list
+			// Loop pages till maximum distance has been found or no more caches are in the list
 			while (toDistance > 0) {
 				RexPropListBlock.search(htmlListPage);
 				String tableOfHtmlListPage;
@@ -888,12 +879,13 @@
 									cachesToLoad.add(chWaypoint);
 								}
 							} else {
-								// pref.log("no load of (Premium Cache/other direction/short Distance ?) "
-								// + chWaypoint);
+								// pref.log("no load of (Premium Cache/other direction/short
+								// Distance ?) " + chWaypoint);
 								cExpectedForUpdate.remove(chWaypoint);
 							}
 						} else {
-							if (maxUpdate > 0) { // regardless of fromDistance
+							if (maxUpdate > 0) {
+								// regardless of fromDistance
 								if (!ch.is_black()) {
 									if (doPMCache(chWaypoint, CacheDescriptionGC) && updateExists(ch, CacheDescriptionGC)) {
 										if (cFoundForUpdate.size() < maxUpdate) {
@@ -917,9 +909,8 @@
 							}
 						}
 					} else
-						toDistance = 0; // finish listing
-					// get next row of table (next Cache Description) of this
-					// htmlListPage
+						// finish listing get next row of table (next Cache Description) of this htmlListPage
+						toDistance = 0;
 					RexPropLine.searchFrom(tableOfHtmlListPage, RexPropLine.matchedTo());
 					if (infB.isClosed) {
 						toDistance = 0;
@@ -929,14 +920,12 @@
 				infB.setInfo(MyLocale.getMsg(5511, "Found ") + cachesToLoad.size() + " / " + cFoundForUpdate.size() + MyLocale.getMsg(5512, " caches"));
 				if (found_on_page < 20) {
 					if (spiderAllFinds) {
-						// check all pages ( seen a gc-account with
-						// found_on_page less 20 and not on end )
+						// check all pages ( seen a gc-account with found_on_page less 20 and not on end )
 						if (((page_number - 1) * 20 + found_on_page) >= numFinds) {
 							toDistance = 0;
 						}
 					} else
-						toDistance = 0; // last page (has less than 20
-										// entries!?) to check reached
+						toDistance = 0; // last page (has less than 20 entries!?) to check reached
 				}
 				if (toDistance > 0) {
 					getAListPage(toDistanceInMiles, gotoNextPage);
@@ -989,8 +978,7 @@
 				} else if (test == SPIDER_OK) {
 					cacheDB.add(holder);
 					holder.save();
-				} // For test == SPIDER_IGNORE_PREMIUM and SPIDER_IGNORE there
-					// is nothing to do
+				} // For test == SPIDER_IGNORE_PREMIUM and SPIDER_IGNORE there is nothing to do
 			}
 		}
 		return spiderErrors;
@@ -1021,7 +1009,8 @@
 	/**
 	 * Method to spider a single cache. It assumes a login has already been performed!
 	 * 
-	 * @return 1 if spider was successful, -1 if spider was cancelled by closing the infobox, 0 error, but continue with next cache
+	 * @return 1 if spider was successful, -1 if spider was cancelled by closing the infobox, 0 error, but continue with
+	 *         next cache
 	 */
 	public int spiderSingle(int number, InfoBox pInfB, boolean forceLogin, boolean loadAllLogs) {
 		int ret = -1;
@@ -1029,8 +1018,7 @@
 		final CacheHolder ch = new CacheHolder(); // cacheDB.get(number);
 		ch.setWayPoint(cacheDB.get(number).getWayPoint());
 		if (ch.isAddiWpt())
-			return -1; // No point re-spidering an addi waypoint, comes with
-						// parent
+			return -1; // No point re-spidering an addi waypoint, comes with parent
 
 		if (!login())
 			return -1;
@@ -1042,11 +1030,9 @@
 				final CacheHolder cacheInDB = cacheDB.get(number);
 				cacheInDB.initStates(false);
 				if (cacheInDB.is_found() && !ch.is_found() && !loadAllLogs) {
-					// If the number of logs to spider is 5 or less, then the
-					// "not found" information
-					// of the spidered cache is not credible. In this case it
-					// should not overwrite
-					// the "found" state of an existing cache.
+					// If the number of logs to spider is 5 or less,
+					// then the "not found" information of the spidered cache is not credible.
+					// In this case it should not overwrite the "found" state of an existing cache.
 					ch.setFound(true);
 				}
 				// preserve rating information
@@ -1076,8 +1062,8 @@
 	 */
 	public String getCacheCoordinates(String wayPoint) {
 		String completeWebPage;
-		// Check whether spider definitions could be loaded, if not issue
-		// appropriate message and terminate
+		// Check whether spider definitions could be loaded,
+		// if not issue appropriate message and terminate
 		// Try to login. If login fails, issue appropriate message and terminate
 		if (!login())
 			return "";
@@ -1101,7 +1087,8 @@
 	} // getCacheCoordinates
 
 	/**
-	 * Method to login the user to gc.com It will request a password and use the alias defined in preferences If the login page cannot be fetched, the password is cleared. If the login fails, an appropriate message is displayed.
+	 * Method to login the user to gc.com It will request a password and use the alias defined in preferences If the
+	 * login page cannot be fetched, the password is cleared. If the login fails, an appropriate message is displayed.
 	 */
 	private boolean login() {
 		if (loggedIn && !pref.forceLogin) {
@@ -1194,8 +1181,7 @@
 					} else {
 						localInfB.close(0);
 						pref.log("[login]:__VIEWSTATE not found (before login): no login possible.", null);
-						// we need the __VIEWSTATE for sending loginData, so we
-						// should abort here
+						// we need the __VIEWSTATE for sending loginData, so we should abort here
 						return false;
 					}
 					final StringBuffer sb = new StringBuffer(1000);
@@ -1212,8 +1198,7 @@
 					loginPage = UrlFetcher.fetch(loginPageUrl);
 					if (loginPage.indexOf(loginSuccess) > 0) {
 						pref.log("Login successful: " + pref.myAlias);
-						// **3 now we are logged in and get the Cookie (there
-						// are two)
+						// **3 now we are logged in and get the Cookie (there are two)
 						final PropertyList pl = UrlFetcher.getDocumentProperties();
 						String docprops = "";
 						for (int i = 0; i < pl.size(); i++) {
@@ -1321,8 +1306,10 @@
 			pref.oldLanguageCtl = ""; // nothing to reset
 			return true;
 		}
-		// switch to english now goes into gc account Display Preferences (is permanent, must be reset)
-		// todo as long as Textfile Encoding is CP1252 we compare with substring(1) and think koreanisch if no merge at all
+		// switch to english now goes into gc account Display Preferences
+		// (is permanent, must be reset)
+		// todo as long as Textfile Encoding is CP1252 we compare with
+		// substring(1) and think koreanisch if no merge at all
 		String languages[] = { "English", "Deutsch", "Fran?ais", "Portugu?s", "Ce?tina", "Svenska", "Nederlands", "Catal?", "Polski", "Eesti", "Norsk, Bokm?l", "???", "Espa?ol" };
 		for (int i = 0; i < languages.length; i++) {
 			if (oldLanguage.substring(1).equals(languages[i].substring(1))) {
@@ -1354,7 +1341,7 @@
 	}
 
 	/*
-	 *
+	 * 
 	 */
 	private void initialiseProperties() {
 		try {
@@ -1397,7 +1384,7 @@
 	}
 
 	/*
-	 *
+	 * 
 	 */
 	private void getFirstListPage(int distance) {
 		// Get first page
@@ -1533,7 +1520,8 @@
 				ch.initStates(false);
 		}
 
-		double halfSideLength = maxDistance; // halbe Seitenl????nge eines Quadrats ums Zentrum in km
+		// halbe Seitenl?nge eines Quadrats ums Zentrum in km
+		double halfSideLength = maxDistance;
 		if (pref.metricSystem == Metrics.IMPERIAL) {
 			halfSideLength = Metrics.convertUnit(maxDistance, Metrics.MILES, Metrics.KILOMETER);
 		}
@@ -1633,7 +1621,8 @@
 		final int f = 1 << scale; // 2**scale
 		lat = lat * f;
 		lon = lon * f;
-		return new TrackPoint(lat, lon); // TrackPoint only for returning values
+		return new TrackPoint(lat, lon); // TrackPoint only for returning
+		// values
 	}
 
 	private CWPoint getLatLon(double basex, double basey, int offsetx, int offsety, int scale) {
@@ -1900,9 +1889,7 @@
 				return distanceAndDirection; // zur Zeit " Here -1"
 			// Versuch den DistanceCodeKey automatisch zu bestimmen
 			// da dieser von gc mal wieder ge????ndert wurde.
-			// todo Ben????tigt ev noch weitere Anpassungen: | am Anfang, and calc
-			// of keylength
-
+			// todo Ben?tigt ev noch weitere Anpassungen: | am Anfang, and calc of keylength
 			// String thereitis="|0.34 km|102.698";
 			// String page =
 			// fetchText("http://www.geocaching.com/seek/nearest.aspx?lat=48.48973&lng=009.26313&dist=2&f=1",false);
@@ -2032,19 +2019,27 @@
 			}
 			final Image idoc = new Image(doc, 0, null, 0, 0);
 			/*
-			 * FileOutputStream fos; try { fos = new FileOutputStream(new File("temp.png")); fos.write(doc.toBytes()); fos.close(); } catch (IOException e) { } finally { }
+			 * FileOutputStream fos; try { fos = new FileOutputStream(new File("temp.png")); fos.write(doc.toBytes());
+			 * fos.close(); } catch (IOException e) { } finally { }
 			 */
 			final String ret = getDTfromImage(idoc) + "/" + getSizeFromImage(idoc);
 			return ret;
 			// */
 
 			/*
-			 * int decoded = 0; int pwr = 1; for (int i = code.length()-1 ; i >= 0; i--) { decoded = decoded + DTSCodeKey.indexOf(code.substring(i,i+1)) * pwr; pwr = pwr * 42; } decoded = (decoded - 1386) % 16777216; // size 0=not choosen 1=Micro
-			 * 3=Regular 5=Large 7=Virtual 8=Unknown 12=Small int sizecode = decoded / 74088; // 42 ^ 3 int sizeremove; byte size; switch (sizecode) { case 0: size=CacheSize.CW_SIZE_NOTCHOSEN; sizeremove=0; break; case 1: size=CacheSize.CW_SIZE_MICRO;
-			 * sizeremove=131072; break; case 3: size=CacheSize.CW_SIZE_REGULAR; sizeremove=262144; break; case 5: size=CacheSize.CW_SIZE_LARGE; sizeremove=393217; break; case 7: size=CacheSize.CW_SIZE_VIRTUAL; sizeremove=524288; break; case 8:
-			 * size=CacheSize.CW_SIZE_OTHER; sizeremove=655360; break; case 12: size=CacheSize.CW_SIZE_SMALL; sizeremove=917504; break; default: size=CacheSize.CW_SIZE_ERROR; sizeremove=0; break; } decoded = decoded - sizeremove; int terraincode =
-			 * decoded / 252; // terrain 0=1 1=1.5 2=2 3=2.5 4=3 5=3.5 6=4 7=4.5 8=5 String terrain = "" + (1 + terraincode / 2.0 ); // difficulty 0=1 1=1.5 2=2 3=2.5 4=3 5=3.5 6=4 7=4.5 8=5 String difficulty = "" + (1+((decoded % 42) - (terraincode *
-			 * 4)) / 2.0); if (difficulty.equals("0.5")) { difficulty = "5"; } return difficulty+"/"+terrain+"/"+size;
+			 * int decoded = 0; int pwr = 1; for (int i = code.length()-1 ; i >= 0; i--) { decoded = decoded +
+			 * DTSCodeKey.indexOf(code.substring(i,i+1)) * pwr; pwr = pwr * 42; } decoded = (decoded - 1386) % 16777216; //
+			 * size 0=not choosen 1=Micro 3=Regular 5=Large 7=Virtual 8=Unknown 12=Small int sizecode = decoded / 74088; //
+			 * 42 ^ 3 int sizeremove; byte size; switch (sizecode) { case 0: size=CacheSize.CW_SIZE_NOTCHOSEN;
+			 * sizeremove=0; break; case 1: size=CacheSize.CW_SIZE_MICRO; sizeremove=131072; break; case 3:
+			 * size=CacheSize.CW_SIZE_REGULAR; sizeremove=262144; break; case 5: size=CacheSize.CW_SIZE_LARGE;
+			 * sizeremove=393217; break; case 7: size=CacheSize.CW_SIZE_VIRTUAL; sizeremove=524288; break; case 8:
+			 * size=CacheSize.CW_SIZE_OTHER; sizeremove=655360; break; case 12: size=CacheSize.CW_SIZE_SMALL;
+			 * sizeremove=917504; break; default: size=CacheSize.CW_SIZE_ERROR; sizeremove=0; break; } decoded = decoded -
+			 * sizeremove; int terraincode = decoded / 252; // terrain 0=1 1=1.5 2=2 3=2.5 4=3 5=3.5 6=4 7=4.5 8=5
+			 * String terrain = "" + (1 + terraincode / 2.0 ); // difficulty 0=1 1=1.5 2=2 3=2.5 4=3 5=3.5 6=4 7=4.5 8=5
+			 * String difficulty = "" + (1+((decoded % 42) - (terraincode * 4)) / 2.0); if (difficulty.equals("0.5")) {
+			 * difficulty = "5"; } return difficulty+"/"+terrain+"/"+size;
 			 */
 		}
 		pref.log("[SpiderGC.java:getDTS]check DTSRex!", null);
@@ -2103,9 +2098,7 @@
 			if (bild.getHeight() > startY + y) {
 				for (int x = 0; x < validChar[0].length; x++) {
 					if (bild.getWidth() > startX + x) {
-						// int[] alpha =
-						// bild.getAlphaRaster().getPixel(startX+x, startY+y,
-						// new int[1]);
+						// int[] alpha = bild.getAlphaRaster().getPixel(startX+x, startY+y, new int[1]);
 						final int[] argb = bild.getPixels(null, 0, startX + x, startY + y, 1, 1, 0);
 						if ((argb[0] == 0 && validChar[y][x] == 0) || (argb[0] != 0 && validChar[y][x] > 0)) {
 							// matches
@@ -2225,18 +2218,27 @@
 	}
 
 	/**
-	 * Read a complete cachepage from geocaching.com including all logs. This is used both when updating already existing caches (via spiderSingle) and when spidering around a centre. It is also used when reading a GPX file and fetching the images.
+	 * Read a complete cachepage from geocaching.com including all logs. This is used both when updating already
+	 * existing caches (via spiderSingle) and when spidering around a centre. It is also used when reading a GPX file
+	 * and fetching the images.
 	 * 
 	 * This is the workhorse function of the spider.
 	 * 
 	 * @param CacheHolderDetail
 	 *            chD The element wayPoint must be set to the name of a waypoint
-	 * @param boolean isUpdate True if an existing cache is being updated, false if it is a new cache
-	 * @param boolean fetchImages True if the pictures are to be fetched
-	 * @param boolean fetchTBs True if the TBs are to be fetched
-	 * @param boolean doNotGetFound True if the cache is not to be spidered if it has already been found
-	 * @param boolean fetchAllLogs True if all logs are to be fetched (by adding option '&logs=y' to command line). This is normally false when spidering from GPXImport as the logs are part of the GPX file, and true otherwise
-	 * @return -1 if the infoBox was closed (cancel spidering), 0 if there was an error (continue with next cache), 1 if everything ok
+	 * @param boolean
+	 *            isUpdate True if an existing cache is being updated, false if it is a new cache
+	 * @param boolean
+	 *            fetchImages True if the pictures are to be fetched
+	 * @param boolean
+	 *            fetchTBs True if the TBs are to be fetched
+	 * @param boolean
+	 *            doNotGetFound True if the cache is not to be spidered if it has already been found
+	 * @param boolean
+	 *            fetchAllLogs True if all logs are to be fetched (by adding option '&logs=y' to command line). This is
+	 *            normally false when spidering from GPXImport as the logs are part of the GPX file, and true otherwise
+	 * @return -1 if the infoBox was closed (cancel spidering), 0 if there was an error (continue with next cache), 1 if
+	 *         everything ok
 	 */
 	private int getCacheByWaypointName(CacheHolder ch, boolean isUpdate, boolean fetchImages, boolean fetchTBs, boolean doNotGetFound, boolean fetchAllLogs) {
 		int ret = SPIDER_OK; // initialize value;
@@ -2269,14 +2271,12 @@
 						return SPIDER_CANCEL;
 					}
 				}
-				// Only analyse the cache data and fetch pictures if user has
-				// not closed the progress window
+				// Only analyse the cache data and fetch pictures if user has not closed the progress window
 				if (!infB.isClosed) {
 					try {
 						ch.initStates(!isUpdate);
 
-						// first check if coordinates are available to prevent
-						// deleting existing coordinates
+						// first check if coordinates are available to prevent deleting existing coordinates
 						final String latLon = getLatLon(completeWebPage);
 						if (latLon.equals("???")) {
 							if (completeWebPage.indexOf(p.getProp("premiumCachepage")) > 0) {
@@ -2287,7 +2287,7 @@
 								continue;
 							} else {
 								if (spiderTrys == MAX_SPIDER_TRYS)
-									pref.log(">>>> Failed to spider Cache. Retry." + completeWebPage, null);
+									pref.log(">>>> Failed to spider Cache. Retry.", null);
 								ret = SPIDER_ERROR;
 								continue; // Restart the spider
 							}
@@ -2295,8 +2295,7 @@
 
 						ch.setHTML(true);
 						ch.setIncomplete(true);
-						// Save size of logs to be able to check whether any new
-						// logs were added
+						// Save size of logs to be able to check whether any new logs were added
 						// int logsz = chD.CacheLogs.size();
 						// chD.CacheLogs.clear();
 						ch.addiWpts.clear();
@@ -2309,8 +2308,7 @@
 						// ==========
 						getLogs(completeWebPage, ch.getCacheDetails(false));
 						pref.log("Got logs");
-						// If the switch is set to not store found caches and we
-						// found the cache => return
+						// If the switch is set to not store found caches and we found the cache => return
 						if (ch.is_found() && doNotGetFound) {
 							if (infB.isClosed) {
 								return SPIDER_CANCEL;
@@ -2422,8 +2420,8 @@
 			}
 			break;
 		}// while(true) // retry even if failure
-		if (infB.isClosed) {// If the infoBox was closed before getting here, we
-							// return -1
+		if (infB.isClosed) {
+			// If the infoBox was closed before getting here, we return -1
 			return SPIDER_CANCEL;
 		}
 		return ret;
@@ -2479,9 +2477,8 @@
 		if (spanEnd >= 0) {
 			res = res.substring(0, spanEnd);
 		}
-		return SafeXML.cleanback(res); // since internal viewer doesn't show
-										// html-entities that are now in
-										// cacheDescription
+		// since internal viewer doesn't show html-entities that are now in cacheDescription
+		return SafeXML.cleanback(res);
 	}
 
 	/**
@@ -2725,7 +2722,8 @@
 	}
 
 	/**
-	 * Read the travelbug names from a previously fetched Cache page and then read the travelbug purpose for each travelbug
+	 * Read the travelbug names from a previously fetched Cache page and then read the travelbug purpose for each
+	 * travelbug
 	 * 
 	 * @param doc
 	 *            The previously fetched cachepage
@@ -2761,7 +2759,8 @@
 					try {
 						infB.setInfo(oldInfoBox + MyLocale.getMsg(5514, "\nGetting bug: ") + SafeXML.cleanback(bug));
 						bugDetails = UrlFetcher.fetch(link);
-						exBugName.set(bugDetails, p.getProp("bugDetailsStart"), p.getProp("bugDetailsEnd"), 0, Extractor.EXCLUDESTARTEND); // reusing exBugName
+						exBugName.set(bugDetails, p.getProp("bugDetailsStart"), p.getProp("bugDetailsEnd"), 0, Extractor.EXCLUDESTARTEND); // reusing
+						// exBugName
 						chD.Travelbugs.add(new Travelbug(link.substring(1 + link.indexOf("=")), bug, exBugName.findNext()));
 					} catch (final Exception ex) {
 						pref.log("[SpiderGC.java:getBugs] Could not fetch buginfo from " + link, ex);
@@ -2777,7 +2776,8 @@
 	}
 
 	/**
-	 * Get the images for a previously fetched cache page. Images are extracted from two areas: The long description and the pictures section (including the spoiler)
+	 * Get the images for a previously fetched cache page. Images are extracted from two areas: The long description and
+	 * the pictures section (including the spoiler)
 	 * 
 	 * @param doc
 	 *            The previously fetched cachepage
@@ -2816,16 +2816,14 @@
 		String tst;
 		Extractor exImgSrc = new Extractor("", "http://", "\"", 0, true);
 		while ((tst = exImgBlock.findNext()).length() > 0) {
-			// Optimize: img.groundspeak.com -> img.geocaching.com (for
-			// better caching purposes)
+			// Optimize: img.groundspeak.com -> img.geocaching.com (for better caching purposes)
 			imgUrl = exImgSrc.findFirst(tst);
 			imgUrl = CacheImages.optimizeLink("http://" + imgUrl);
 			try {
 				imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase() + "    ").substring(0, 4).trim();
 				// imgType is now max 4 chars, starting with .
 				if (imgType.startsWith(".png") || imgType.startsWith(".jpg") || imgType.startsWith(".gif")) {
-					// Check whether image was already spidered for this
-					// cache
+					// Check whether image was already spidered for this cache
 					idxUrl = spideredUrls.find(imgUrl);
 					imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 					imageInfo = null;
@@ -2881,8 +2879,7 @@
 				imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase() + "    ").substring(0, 4).trim();
 				// imgType is now max 4 chars, starting with .
 				if (imgType.startsWith(".png") || imgType.startsWith(".jpg") || imgType.startsWith(".gif")) {
-					// Check whether image was already spidered for this
-					// cache
+					// Check whether image was already spidered for this cache
 					idxUrl = spideredUrls.find(imgUrl);
 					imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 					imageInfo = null;
@@ -2927,17 +2924,15 @@
 		// ========
 		final Extractor exFinal = new Extractor(longDesc, "http://", "\"", 0, true);
 		while ((imgUrl = exFinal.findNext()).length() > 0) {
-			// Optimize: img.groundspeak.com -> img.geocaching.com (for
-			// better caching purposes)
+			// Optimize: img.groundspeak.com -> img.geocaching.com (for better caching purposes)
 			imgUrl = CacheImages.optimizeLink("http://" + imgUrl);
 			try {
 				imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase() + "    ").substring(0, 4).trim();
-				// imgType is now max 4 chars, starting with . Delete
-				// characters in URL after the image extension
+				// imgType is now max 4 chars, starting with .
+				// Delete characters in URL after the image extension
 				imgUrl = imgUrl.substring(0, imgUrl.lastIndexOf('.') + imgType.length());
 				if (imgType.startsWith(".jpg") || imgType.startsWith(".bmp") || imgType.startsWith(".png") || imgType.startsWith(".gif")) {
-					// Check whether image was already spidered for this
-					// cache
+					// Check whether image was already spidered for this cache
 					idxUrl = spideredUrls.find(imgUrl);
 					if (idxUrl < 0) { // New image
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
@@ -3108,9 +3103,8 @@
 
 	public String encodeUTF8URL(byte[] what) {
 		final int max = what.length;
-		final char[] dest = new char[6 * max]; // Assume each char is a UTF char
-												// and
-												// encoded into 6 chars
+		// Assume each char is a UTF char and encoded into 6 chars
+		final char[] dest = new char[6 * max];
 		char d = 0;
 		for (int i = 0; i < max; i++) {
 			final char c = (char) what[i];
@@ -3125,7 +3119,8 @@
 	}
 
 	/**
-	 * Load the bug id for a given name. This method is not ideal, as there are sometimes several bugs with identical names but different IDs. Normally the bug GUID is used which can be obtained from the cache page.<br>
+	 * Load the bug id for a given name. This method is not ideal, as there are sometimes several bugs with identical
+	 * names but different IDs. Normally the bug GUID is used which can be obtained from the cache page.<br>
 	 * Note that each bug has both an ID and a GUID.
 	 * 
 	 * @param name
@@ -3161,7 +3156,8 @@
 	}
 
 	/**
-	 * Fetch a bug's mission for a given GUID or ID. If the guid String is longer than 10 characters it is assumed to be a GUID, otherwise it is an ID.
+	 * Fetch a bug's mission for a given GUID or ID. If the guid String is longer than 10 characters it is assumed to be
+	 * a GUID, otherwise it is an ID.
 	 * 
 	 * @param guid
 	 *            the guid or id of the travelbug

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2011-06-13 17:58:00 UTC (rev 3026)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2011-06-15 20:53:01 UTC (rev 3027)
@@ -92,8 +92,13 @@
 	public final static int gotFix = 4; // green
 	public final static int lostFix = 3; // yellow
 	public final static int noGPSData = 2; // red
-	public final static int noGPS = 1; // no GPS-Position marker, manually disconnected
-	public final static int ignoreGPS = -1; // ignore even changes in GPS-signal (eg. from lost fix to gotFix) this is wanted when the map is moved manually
+	public final static int noGPS = 1; // no GPS-Position marker, manually
+										// disconnected
+	public final static int ignoreGPS = -1; // ignore even changes in
+											// GPS-signal (eg. from lost fix
+											// to gotFix) this is wanted
+											// when the map is moved
+											// manually
 
 	public MapSymbol gotoPos = null;
 	public int GpsStatus;
@@ -122,10 +127,14 @@
 	// double posCircleLat, posCircleLon;
 	FontMetrics fm;
 
-	boolean dontUpdatePos = false; // this is only internaly used to avoid multi-threading problems
+	boolean dontUpdatePos = false; // this is only internaly used to avoid
+									// multi-threading problems
 	boolean ignoreGps = false; // ignores updateGps-calls if true
 	boolean autoSelectMap = true;
-	boolean forceMapLoad = true; // only needed to force updateposition to try to load the best map again after OutOfMemoryError after an repeated click on snap-to-gps
+	boolean forceMapLoad = true; // only needed to force updateposition
+									// to try to load the best map again
+									// after OutOfMemoryError after an
+									// repeated click on snap-to-gps
 	public boolean mapHidden = false;
 	boolean noMapsAvailable;
 	boolean zoomingMode = false;
@@ -143,7 +152,8 @@
 	public static final int tileWidth = 100;
 	public static final int tileHeight = 100;
 
-	// Needed by updatePosition to decide if a recalculation of map-tiles is needed:
+	// Needed by updatePosition to decide if a recalculation of map-tiles is
+	// needed:
 	private int lastXPos;
 	private int lastYPos;
 	private int lastWidth;
@@ -194,15 +204,26 @@
 		this.pref = Global.getPref();
 		if (pref.myAppHeight <= 640 && pref.myAppWidth <= 640)
 			this.windowFlagsToSet = WindowConstants.FLAG_FULL_SCREEN;
-		// The following line is commented out, because this caused trouble under ewe-vm v1.49 on win-xp
+		// The following line is commented out, because this caused trouble
+		// under ewe-vm v1.49 on win-xp
 		// when MovingMap was started with maximized CacheWolf-Window
-		// this.windowFlagsToClear = WindowConstants.FLAG_HAS_TITLE | UIConstants.BDR_NOBORDER;
+		// this.windowFlagsToClear = WindowConstants.FLAG_HAS_TITLE |
+		// UIConstants.BDR_NOBORDER;
 		this.hasTopBar = false;
 		this.noBorder = true;
 		this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
 		// this.setPreferredSize(240,320);
 		this.title = "Moving Map";
-		this.backGround = new Color(254, 254, 254); // background must not be black because black is interpreted as transparent and transparent images above (eg trackoverlay) want be drawn in windows-VM, so be care, don|t use white either
+		this.backGround = new Color(254, 254, 254); // background must not
+													// be black because
+													// black is interpreted
+													// as transparent and
+													// transparent images
+													// above (eg
+													// trackoverlay) want be
+													// drawn in windows-VM,
+													// so be care, don|t use
+													// white either
 
 		mmp = new MovingMapPanel(this);
 		this.addLast(mmp);
@@ -254,7 +275,8 @@
 			posCircle.screenDimChanged();
 		if (tracks != null)
 			rebuildOverlaySet();
-		if (symbols != null) { // TODO: see if the rest of the code works with symbols = null
+		if (symbols != null) { // TODO: see if the rest of the code works
+								// with symbols = null
 			for (int i = symbols.size() - 1; i >= 0; i--) {
 				((MapSymbol) symbols.get(i)).screenDimChanged();
 			}
@@ -272,7 +294,8 @@
 	 * @param mapsPath
 	 *            must not have a trailing end "/"
 	 * @param lat
-	 *            used to create empty maps with correct conversion from lon to meters the latitude must be known
+	 *            used to create empty maps with correct conversion from lon
+	 *            to meters the latitude must be known
 	 */
 	public void loadMaps(String mapsPath, double lat) {
 		if (loadingMapList)
@@ -292,7 +315,10 @@
 			noMapsAvailable = true;
 		} else
 			noMapsAvailable = false;
-		maps.addEmptyMaps(lat); // the empty maps must be added last, otherwise in method setBestMap, when no map is available, a malfunction will happen, see there
+		maps.addEmptyMaps(lat); // the empty maps must be added last,
+								// otherwise in method setBestMap, when no
+								// map is available, a malfunction will
+								// happen, see there
 		maps.onCompletedRead();
 		dontUpdatePos = saveGpsIgnoreStatus;
 		inf.close(0);
@@ -348,7 +374,8 @@
 				final int decimals = (int) (-1 * digits);
 
 				lineLengthString = tmp.toString(decimals + 2, decimals, 0) + Metrics.getUnit(currentUnit);
-				// lineLengthString = MyLocale.formatDouble(tmp,"0.000") + Metrics.getUnit(currentUnit);
+				// lineLengthString = MyLocale.formatDouble(tmp,"0.000") +
+				// Metrics.getUnit(currentUnit);
 			}
 
 			lineLengthMeters = Metrics.convertUnit(localizedLineLength, currentUnit, Metrics.METER);
@@ -406,17 +433,21 @@
 
 	public void forceMapLoad() {
 		forceMapLoad = true;
-		updatePosition(posCircle.where); // this sets forceMapLoad to false after loading a map
+		updatePosition(posCircle.where); // this sets forceMapLoad to
+											// false after loading a map
 	}
 
 	public final FormFrame myExec(CWPoint centerTo, boolean forceCenter) {
 		final FormFrame ret = exec();
 		running = true;
-		// disconnect movingMap from GPS TODO only if GPS-pos is not on the screen
+		// disconnect movingMap from GPS TODO only if GPS-pos is not on the
+		// screen
 		if (forceCenter)
 			setGpsStatus(noGPS);
-		// to load maplist + place a map on screen otherwise no symbol can be placed
-		ignoreGps = true; // else overlay symbols are removed on started gps
+		// to load maplist + place a map on screen otherwise no symbol can
+		// be placed
+		ignoreGps = true; // else overlay symbols are removed on started
+							// gps
 
 		rebuildOverlaySet(); // show tracks , even if reentering map
 
@@ -432,7 +463,8 @@
 			// this means marking has changed
 			Global.getProfile().selectionChanged = false;
 			if (pref.showCachesOnMap)
-				removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap
+				removeAllMapSymbols(); // not really needed: hopefully
+										// removed by showCachesOnMap
 		}
 		showCachesOnMap();
 
@@ -483,7 +515,9 @@
 		} catch (final NullPointerException e) {
 			// hapens if currentmap == null or PosCircle not valid
 		} catch (final IllegalArgumentException e) {
-			// happens if screensize is still not known ---> in both cases creation of Overlayset will be done in updateOverlayPos if tracks != null
+			// happens if screensize is still not known ---> in both cases
+			// creation of Overlayset will be done in updateOverlayPos if
+			// tracks != null
 		}
 	}
 
@@ -504,16 +538,25 @@
 
 	public void addMissingOverlays() {
 		if (currentMap == null || (!posCircle.where.isValid()) || width == 0 || height == 0)
-			return; // height == 0 happens if this is called before the form ist displayed on the screen
+			return; // height == 0 happens if this is called before the form
+					// ist displayed on the screen
 		if (TrackOverlays == null) {
 			TrackOverlays = new TrackOverlay[9];
 			TrackOverlaySetCenterTopLeft = ScreenXY2LatLon(100, 100);
 		}
-		final boolean saveGPSIgnoreStatus = dontUpdatePos; // avoid multi-threading problems
+		final boolean saveGPSIgnoreStatus = dontUpdatePos; // avoid
+															// multi-threading
+															// problems
 		dontUpdatePos = true;
-		final Point upperleftOf4 = getXYonScreen(TrackOverlaySetCenterTopLeft); // TrackOverlay[4] == center of Trackoverlays
-		// upperleftOf4.x = (upperleftOf4.x + 1* width) % (width * 2) - 1 * width;
-		// upperleftOf4.y = (upperleftOf4.y + 1* height) % (height * 2) - 1 * height;
+		final Point upperleftOf4 = getXYonScreen(TrackOverlaySetCenterTopLeft); // TrackOverlay[4]
+																				// ==
+																				// center
+																				// of
+																				// Trackoverlays
+		// upperleftOf4.x = (upperleftOf4.x + 1* width) % (width * 2) - 1 *
+		// width;
+		// upperleftOf4.y = (upperleftOf4.y + 1* height) % (height * 2) - 1
+		// * height;
 		int i;
 		for (int yi = 0; yi < 3; yi++) {
 			for (int xi = 0; xi < 3; xi++) {
@@ -521,7 +564,22 @@
 				if (TrackOverlays[i] == null) {
 					pref.log("addMissingOverlays: widht: " + width + ", height: " + height);
 					TrackOverlays[i] = new TrackOverlay(ScreenXY2LatLon(upperleftOf4.x + (xi - 1) * width, upperleftOf4.y + (yi - 1) * height), width, height, currentMap);
-					TrackOverlays[i].setLocation(width + 1, height + 1); // outside of the screen will hide it automatically it will get the correct position in upadteOverlayposition
+					TrackOverlays[i].setLocation(width + 1, height + 1); // outside
+																			// of
+																			// the
+																			// screen
+																			// will
+																			// hide
+																			// it
+																			// automatically
+																			// it
+																			// will
+																			// get
+																			// the
+																			// correct
+																			// position
+																			// in
+																			// upadteOverlayposition
 					TrackOverlays[i].tracks = this.tracks;
 					TrackOverlays[i].paintTracks();
 					mmp.addImage(TrackOverlays[i]);
@@ -627,8 +685,10 @@
 						destroyOverlay(3);
 						destroyOverlay(4);
 						destroyOverlay(5);
-					} else { // it is important to test for diagonal only if the other didn't match
-						if (TrackOverlays[0].isOnScreen()) { // links oben raus
+					} else { // it is important to test for diagonal only
+								// if the other didn't match
+						if (TrackOverlays[0].isOnScreen()) { // links
+																// oben raus
 							TrackOverlaySetCenterTopLeft.set(ScreenXY2LatLon(oldp.x - 2 * width, oldp.y - 2 * height));
 							destroyOverlay(8);
 							mmp.removeImage(TrackOverlays[0]);
@@ -643,7 +703,9 @@
 							destroyOverlay(6);
 							destroyOverlay(7);
 						} else {
-							if (TrackOverlays[2].isOnScreen()) { // rechts oben raus
+							if (TrackOverlays[2].isOnScreen()) { // rechts
+																	// oben
+																	// raus
 								TrackOverlaySetCenterTopLeft.set(ScreenXY2LatLon(oldp.x + 2 * width, oldp.y - 2 * height));
 								destroyOverlay(6);
 								mmp.removeImage(TrackOverlays[2]);
@@ -658,7 +720,9 @@
 								destroyOverlay(7);
 								destroyOverlay(8);
 							} else {
-								if (TrackOverlays[6].isOnScreen()) { // links unten raus
+								if (TrackOverlays[6].isOnScreen()) { // links
+																		// unten
+																		// raus
 									TrackOverlaySetCenterTopLeft.set(ScreenXY2LatLon(oldp.x - 2 * width, oldp.y + 2 * height));
 									destroyOverlay(2);
 									mmp.removeImage(TrackOverlays[6]);
@@ -673,7 +737,9 @@
 									destroyOverlay(7);
 									destroyOverlay(8);
 								} else {
-									if (TrackOverlays[8].isOnScreen()) { // rechts unten raus
+									if (TrackOverlays[8].isOnScreen()) { // rechts
+																			// unten
+																			// raus
 										TrackOverlaySetCenterTopLeft.set(ScreenXY2LatLon(oldp.x + 2 * width, oldp.y + 2 * height));
 										destroyOverlay(0);
 										mmp.removeImage(TrackOverlays[8]);
@@ -691,7 +757,8 @@
 										for (int i = 0; i < TrackOverlays.length; i++) {
 											destroyOverlay(i);
 											TrackOverlaySetCenterTopLeft = ScreenXY2LatLon(100, 100);
-										} // this happens if a position jump occured
+										} // this happens if a position
+											// jump occured
 								}
 							}
 						}
@@ -719,7 +786,8 @@
 		final Dimension ws = mmp.getSize(null);
 		final int ww = ws.width;
 		final int wh = ws.height;
-		// Vm.sleep(100); // this is necessary because the ewe vm ist not multi-threaded and the serial thread also needs time
+		// Vm.sleep(100); // this is necessary because the ewe vm ist not
+		// multi-threaded and the serial thread also needs time
 		int num, pX, pY;
 		for (int yi = 0; yi < 3; yi++) {
 			for (int xi = 0; xi < 3; xi++) {
@@ -755,11 +823,23 @@
 			posCircleX = width / 2;
 			posCircleY = height / 2;
 		} else {
-			posCircleX = pref.myAppWidth / 2; // maybe this could /should be repleced to windows size
+			posCircleX = pref.myAppWidth / 2; // maybe this could /should
+												// be repleced to windows
+												// size
 			posCircleY = pref.myAppHeight / 2;
 		}
 		posCircle.hidden = false;
-		posCircle.move(posCircleX - posCircle.getWidth() / 2, posCircleY - posCircle.getHeight() / 2); // posCircle.setLocation caused a problem -> hiding the posCircle in some situation
+		posCircle.move(posCircleX - posCircle.getWidth() / 2, posCircleY - posCircle.getHeight() / 2); // posCircle.setLocation
+																										// caused
+																										// a
+																										// problem
+																										// ->
+																										// hiding
+																										// the
+																										// posCircle
+																										// in
+																										// some
+																										// situation
 	}
 
 	public void movePosCircleToLatLon(CWPoint p, boolean repaint) {
@@ -781,8 +861,8 @@
 	}
 
 	/**
-	 * call this if the map moved on the screen (by dragging)
-	 * this routine will adjust (move accordingly) all other symbols on the screen
+	 * call this if the map moved on the screen (by dragging) this routine
+	 * will adjust (move accordingly) all other symbols on the screen
 	 * 
 	 * @param diffX
 	 * @param diffY
@@ -799,23 +879,25 @@
 			dontUpdatePos = false;
 			updatePosition(posCircle.where);
 		} else
-			updateSymbolPositions(); // will also be done in updatePosition
+			updateSymbolPositions(); // will also be done in
+										// updatePosition
 		updateOverlayPos();
 	}
 
 	/**
-	 * get upper left corner of map on window
-	 * this is called when the map needs to be moved / the position of the map is wanted
-	 * the map-position is calculated relativ to posCircle (x,y and lat/lon)
-	 * returns the same as mmp.mapImage.getLocation(mapPos);
-	 * but also works if mmp == null and is used to move the map to the correct point
+	 * get upper left corner of map on window this is called when the map
+	 * needs to be moved / the position of the map is wanted the
+	 * map-position is calculated relativ to posCircle (x,y and lat/lon)
+	 * returns the same as mmp.mapImage.getLocation(mapPos); but also works
+	 * if mmp == null and is used to move the map to the correct point
 	 * 
 	 * @return
 	 */
 	public Point getMapPositionOnScreen() {
 		if (currentMap == null || !posCircle.where.isValid())
 			return new Point(pref.myAppWidth + 1, pref.myAppHeight + 1);
-		// in case no calculation is possible return somthing outside of the screen
+		// in case no calculation is possible return somthing outside of the
+		// screen
 		final Point mapPos = new Point();
 		// if (mmp.mapImage != null) mmp.mapImage.getLocation(mapPos);
 		// else {
@@ -926,7 +1008,8 @@
 			return;
 		gotoPos = addSymbol("goto", "goto_map.png", d);
 		forceMapLoad = true;
-		// dirty hack: if this.width == 0, then the symbols are not on the screen
+		// dirty hack: if this.width == 0, then the symbols are not on the
+		// screen
 		// and get hidden by updateSymbolPositions
 		if (this.width != 0)
 			updatePosition(posCircle.where);
@@ -941,7 +1024,8 @@
 			return;
 		gotoPos = addSymbol("goto", ch, "goto_map.png", d);
 		forceMapLoad = true;
-		// dirty hack: if this.width == 0, then the symbols are not on the screen
+		// dirty hack: if this.width == 0, then the symbols are not on the
+		// screen
 		// and get hidden by updateSymbolPositions
 		if (this.width != 0)
 			updatePosition(posCircle.where);
@@ -1037,7 +1121,8 @@
 	}
 
 	/**
-	 * Method to laod the best map for lat/lon and move the map so that the posCircle is at lat/lon
+	 * Method to laod the best map for lat/lon and move the map so that the
+	 * posCircle is at lat/lon
 	 */
 	public void updatePosition(CWPoint where) {
 		if (dontUpdatePos || loadingMapList)
@@ -1052,9 +1137,20 @@
 		final boolean screenNotCompletlyCovered = (mmp.mapImage == null) || (mmp.mapImage != null && (mapPos.y > 0 || mapPos.x > 0 || mapPos.y + mmp.mapImage.getHeight() < this.height || mapPos.x + mmp.mapImage.getWidth() < this.width));
 		// if screendimensions changed also force reload of map
 		forceMapLoad |= lastWidth != width || lastHeight != height;
-		if (forceMapLoad || wantMapTest || screenNotCompletlyCovered) { // if force || want || map doesn't cover the screen completly
+		if (forceMapLoad || wantMapTest || screenNotCompletlyCovered) { // if
+																		// force
+																		// ||
+																		// want
+																		// ||
+																		// map
+																		// doesn't
+																		// cover
+																		// the
+																		// screen
+																		// completly
 			if (forceMapLoad || (java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
-				// more then 1/10 of screen moved since last time we tried to find a better map
+				// more then 1/10 of screen moved since last time we tried
+				// to find a better map
 				if (autoSelectMap) {
 					setBestMap(where, screenNotCompletlyCovered);
 					forceMapLoad = false;
@@ -1071,7 +1167,8 @@
 					final AniImage im = (AniImage) mmp.images.get(i);
 					if ((im instanceof MapImage) && (!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im))) {
 						// locAlways contains the real coordinates while
-						// location is only correct if the image is on the screen.
+						// location is only correct if the image is on the
+						// screen.
 						final Point p = ((MapImage) im).locAlways;
 						p.x += deltaX;
 						p.y += deltaY;
@@ -1094,7 +1191,8 @@
 		for (int i = cacheDB.size() - 1; i >= 0; i--) {
 			ch = cacheDB.get(i);
 			if (screenArea.isInBound(ch.pos)) {
-				// because visible and valid don't change while showing map -->need no remove
+				// because visible and valid don't change while showing map
+				// -->need no remove
 				if (ch.isVisible() && ch.pos.isValid()) {
 					if (pref.showCachesOnMap) {
 						if (addSymbolIsNecessary(ch.getWayPoint())) {
@@ -1117,7 +1215,8 @@
 		// adding target and selected
 		// show target
 		if (gotoPos != null) {
-			// the CacheHolder Symbol must be inserted too, even if not marked (if it is Cache)
+			// the CacheHolder Symbol must be inserted too, even if not
+			// marked (if it is Cache)
 			// anywhere there if all Caches shown on map
 			CacheHolder gotoPosCH = null;
 			if (gotoPos.mapObject instanceof CacheHolder) {
@@ -1154,7 +1253,8 @@
 			Vm.showWait(true);
 			dontUpdatePos = true; // no new Position while filling
 
-			final int s = mmp.images.size(); // avoid calling size() in each iteration
+			final int s = mmp.images.size(); // avoid calling size() in
+												// each iteration
 			for (int i = 0; i < s; i++) {
 				final AniImage im = (AniImage) mmp.images.get(i);
 				if (!(im instanceof MapImage) || (im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) {
@@ -1169,10 +1269,39 @@
 			final Vector rectangles = new Vector();
 			// calculate areas which will not drawn
 			final Point mapPosx = getMapPositionOnScreen();
-			if (screenNotCompletlyCovered && ( // screen not completely covered is only used, because it is already calculated
-					mapPosx.x > this.width || mapPosx.y > this.height // map doesn't overlap with the screen
+			if (screenNotCompletlyCovered && ( // screen not completely
+												// covered is only used,
+												// because it is already
+												// calculated
+					mapPosx.x > this.width || mapPosx.y > this.height // map
+																		// doesn't
+																		// overlap
+																		// with
+																		// the
+																		// screen
 							|| mapPosx.x + mmp.mapImage.getWidth() < 0 || mapPosx.y + mmp.mapImage.getHeight() < 0)) {
-				rectangles.add(new Rect(0, 0, this.width, this.height)); // if the map is completely outside the screen, just fill the screen, nit all the space beteween the map and the screen
+				rectangles.add(new Rect(0, 0, this.width, this.height)); // if
+																			// the
+																			// map
+																			// is
+																			// completely
+																			// outside
+																			// the
+																			// screen,
+																			// just
+																			// fill
+																			// the
+																			// screen,
+																			// nit
+																			// all
+																			// the
+																			// space
+																			// beteween
+																			// the
+																			// map
+																			// and
+																			// the
+																			// screen
 			} else {
 				final Rect whiteArea = new Rect((-width / 10), (-height / 10), (int) (width * 1.1), (int) (height * 1.1));
 				final Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
@@ -1213,7 +1342,8 @@
 		Rect blackArea;
 		final Rect r = (Rect) rectangles.get(0);
 		rectangles.removeElementAt(0);
-		// calculate the center of the rectangle and try to get an map for it
+		// calculate the center of the rectangle and try to get an map for
+		// it
 		final int middlewidth = r.x + (r.width) / 2;
 		final int middleheight = r.y + (r.height) / 2;
 		final CWPoint centerPoint = ScreenXY2LatLon(middlewidth, middleheight);
@@ -1225,14 +1355,16 @@
 			// No map found, area must be left white
 			return;
 		}
-		// A map was found, but it does not contain the previously calculated center
+		// A map was found, but it does not contain the previously
+		// calculated center
 		if (!(bestMap.bottomright.latDec <= centerPoint.latDec && centerPoint.latDec <= bestMap.topleft.latDec)) {
 			return;
 		}
 		if (!(bestMap.topleft.lonDec <= centerPoint.lonDec && centerPoint.lonDec <= bestMap.bottomright.lonDec)) {
 			return;
 		}
-		// Pfeffer got an NPE in the following if-statement. I think the image-filename has got not the correct extension.
+		// Pfeffer got an NPE in the following if-statement. I think the
+		// image-filename has got not the correct extension.
 		// For me, showing a message seems better than throwing the NPE
 		final String imagefilename = bestMap.getImageFilename();
 		if (imagefilename == null) {
@@ -1252,7 +1384,8 @@
 				blackArea = new Rect(mapPos.x, mapPos.y, mapDimension.x, mapDimension.y);
 				// Are there any white areas left?
 				calculateRectangles(blackArea, r, rectangles);
-				// Not all maps have the dimension 1000x1000 Pixels, we cache this information:
+				// Not all maps have the dimension 1000x1000 Pixels, we
+				// cache this information:
 				Dimension rect2 = MovingMapCache.getCache().getDimension(filename);
 				MapImage fullImage = null;
 				if (rect2 == null) {
@@ -1275,7 +1408,8 @@
 				if (!isCoveredByBlackArea(mapPos, row, column, blackArea, rect2)) {
 					continue;
 				}
-				// Get tile from cache or if not found, put all tiles for this image into the cache.
+				// Get tile from cache or if not found, put all tiles for
+				// this image into the cache.
 				MapImage im = MovingMapCache.getCache().get(filename, row, column);
 				if (im == null) {
 					if (fullImage == null) {
@@ -1286,7 +1420,8 @@
 				}
 				// If a tile has been found, draw it on the screen
 				if (im != null) {
-					// Check if not already added. this might happen if the map for horizontal and vertical stripe is the same
+					// Check if not already added. this might happen if the
+					// map for horizontal and vertical stripe is the same
 					boolean added = false;
 					for (int i = mmp.images.size() - 1; i >= 0; i--) {
 						final MapImage m = (MapImage) mmp.images.get(i);
@@ -1344,12 +1479,10 @@
 	}
 
 	/*
-	 * private String SRect(Rect r){
-	 * String OL, UR ;
-	 * OL= " ("+String.valueOf(r.x)+","+String.valueOf(r.y)+")";
-	 * UR= " ("+String.valueOf(r.x+r.width)+","+String.valueOf(r.y+r.height)+") ";
-	 * return OL+" :"+UR;
-	 * }
+	 * private String SRect(Rect r){ String OL, UR ; OL= "
+	 * ("+String.valueOf(r.x)+","+String.valueOf(r.y)+")"; UR= "
+	 * ("+String.valueOf(r.x+r.width)+","+String.valueOf(r.y+r.height)+") ";
+	 * return OL+" :"+UR; }
 	 */
 	private void calculateRectangles(Rect blackArea, Rect whiteArea, Vector rectangles) {
 		if (width == 0 || height == 0)
@@ -1415,7 +1548,11 @@
 			return;
 		// runMovingMap neccessary in case of multi-threaded Java-VM:
 		// ticked could be called during load of mmp
-		if ((fix > 0) && (myNavigation.gpsPos.getSats() >= 0)) { // TODO is getSats really necessary?
+		if ((fix > 0) && (myNavigation.gpsPos.getSats() >= 0)) { // TODO
+																	// is
+																	// getSats
+																	// really
+																	// necessary?
 			directionArrows.setDirections((float) myNavigation.gpsPos.getBearing(myNavigation.destination), (float) myNavigation.skyOrientationDir.lonDec, (float) myNavigation.gpsPos.getBear());
 			setGpsStatus(MovingMap.gotFix);
 			updatePosition(myNavigation.gpsPos);
@@ -1440,28 +1577,43 @@
 
 	int mapChangeModus = HIGHEST_RESOLUTION_GPS_DEST;
 	float scaleWanted;
-	boolean wantMapTest = true; // if true updateposition calls setBestMap regulary even if the currentmap covers the whole screen
-	public final static int NORMAL_KEEP_RESOLUTION = 1; // keeps the choosen resolution as long as a map is available that overlaps with the screen and with the PosCircle - it changes the resolution if no such map is available. It wil cahnge back to the
-														// wanted scale as soon as a map becomes available (through movement of the GPS-receiver)
+	boolean wantMapTest = true; // if true updateposition calls setBestMap
+								// regulary even if the currentmap covers
+								// the whole screen
+	public final static int NORMAL_KEEP_RESOLUTION = 1; // keeps the choosen
+														// resolution as
+														// long as a map is
+														// available that
+														// overlaps with the
+														// screen and with
+														// the PosCircle -
+														// it changes the
+														// resolution if no
+														// such map is
+														// available. It wil
+														// cahnge back to
+														// the
+	// wanted scale as soon as a map becomes available (through movement of
+	// the GPS-receiver)
 	public final static int HIGHEST_RESOLUTION = 2;
 	public final static int HIGHEST_RESOLUTION_GPS_DEST = 3;
 	boolean inBestMap = false; // to avoid multi-threading problems
 
 	/**
-	 * loads the best map for lat/lon according to mapChangeModus
-	 * lat/lon will be at the screen-pos of posCircle
-	 * when posCircle is not on the screen (shifted outside my the user)
-	 * then this routine uses the centre of the screen to find the best map
-	 * but anyway the map will be adjusted (moved) relativ to posCircle
-	 * when a better map was found the called method updateposition will set
-	 * posCirleLat/-Lon to lat/lon.
+	 * loads the best map for lat/lon according to mapChangeModus lat/lon
+	 * will be at the screen-pos of posCircle when posCircle is not on the
+	 * screen (shifted outside my the user) then this routine uses the
+	 * centre of the screen to find the best map but anyway the map will be
+	 * adjusted (moved) relativ to posCircle when a better map was found the
+	 * called method updateposition will set posCirleLat/-Lon to lat/lon.
 	 * 
 	 * @param lat
 	 * @param lon
 	 * @param loadIfSameScale
-	 *            false: will not change the map if the better map has the same scale as the current
-	 *            - this is used not to change the map if it covers already the screen completely
-	 *            true: willchange the map, regardless of change in scale
+	 *            false: will not change the map if the better map has the
+	 *            same scale as the current - this is used not to change the
+	 *            map if it covers already the screen completely true:
+	 *            willchange the map, regardless of change in scale
 	 */
 	public void setBestMap(CWPoint where, boolean loadIfSameScale) {
 		if (inBestMap)
@@ -1491,9 +1643,37 @@
 				if ((!posCircleOnScreen) && (lastHighestResolutionGPSDestScale > 0)) {
 					newmap = maps.getBestMap(cll, screen, lastHighestResolutionGPSDestScale, false, true);
 				} else {
-					newmap = maps.getMapForArea(posCircle.where, gotoPos.where); // TODO use home-coos if no gps? - consider start from details panel and from gotopanel
+					newmap = maps.getMapForArea(posCircle.where, gotoPos.where); // TODO
+																					// use
+																					// home-coos
+																					// if
+																					// no
+																					// gps?
+																					// -
+																					// consider
+																					// start
+																					// from
+																					// details
+																					// panel
+																					// and
+																					// from
+																					// gotopanel
 					if (newmap == null)
-						newmap = maps.getBestMap(cll, screen, 10000000000000000000000000000000000f, false, true); // use map with most available overview if no map containing PosCircle and GotoPos is available
+						newmap = maps.getBestMap(cll, screen, 10000000000000000000000000000000000f, false, true); // use
+																													// map
+																													// with
+																													// most
+																													// available
+																													// overview
+																													// if
+																													// no
+																													// map
+																													// containing
+																													// PosCircle
+																													// and
+																													// GotoPos
+																													// is
+																													// available
 
 					if (newmap != null) {
 						lastHighestResolutionGPSDestScale = newmap.scale;
@@ -1525,13 +1705,29 @@
 		}
 		if (currentMap == null && newmap == null) {
 			// F?r die aktuelle Position steht keine Karte zur Verf?ng
-			posCircle.where.set(cll); // choosemap calls setmap with posCircle-coos
+			posCircle.where.set(cll); // choosemap calls setmap with
+										// posCircle-coos
 			try {
-				setMap(((MapListEntry) maps.elementAt(maps.getCount() - 4)).getMap(), where); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
+				setMap(((MapListEntry) maps.elementAt(maps.getCount() - 4)).getMap(), where); // beware:
+																								// "-4"
+																								// only
+																								// works
+																								// if
+																								// the
+																								// empty
+																								// maps
+																								// were
+																								// added
+																								// last
+																								// see
+																								// MapsList.addEmptyMaps
 			} catch (final IOException e) {
 				(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4209, "setBestMap: problem in: setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), lat, lon) lat/lon:") + where.toString(), FormBase.OKB)).exec();
 			}
-			while (currentMap == null) { // this actually cannot happen, but maybe in case of an inconstistent code change (esp. regarding empty maps)
+			while (currentMap == null) { // this actually cannot happen,
+											// but maybe in case of an
+											// inconstistent code change
+											// (esp. regarding empty maps)
 				mmp.chooseMap(); // force the user to select a scale
 				if (currentMap == null)
 					(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4210, "Moving map cannot run without a map - please select one. \n You can select an empty map"), FormBase.OKB)).execute();
@@ -1553,17 +1749,28 @@
 
 	/**
 	 * method to get a point on the screen which must be included in the map
-	 * the map methods are looking for. If the poscircle is on the screen this will be
-	 * that point. If it is outside then the centre of the screen will be used.
+	 * the map methods are looking for. If the poscircle is on the screen
+	 * this will be that point. If it is outside then the centre of the
+	 * screen will be used.
 	 * 
-	 * returns [0] = CWPoint of that point, [1] Rect describing the screen around it
+	 * returns [0] = CWPoint of that point, [1] Rect describing the screen
+	 * around it
 	 * 
 	 * @param lat
 	 * @param lon
 	 * @return
 	 */
 	public Object[] getRectForMapChange(CWPoint ll) {
-		final int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
+		final int w = (width != 0 ? width : pref.myAppWidth); // width ==
+																// 0 happens
+																// if this
+																// routine
+																// is run
+																// before
+																// the
+																// windows
+																// is on the
+																// screen
 		final int h = (height != 0 ? height : pref.myAppHeight);
 		int pX, pY;
 		CWPoint cll;
@@ -1571,10 +1778,16 @@
 		if (posCircleX >= 0 && posCircleX <= w && posCircleY >= 0 && posCircleY <= h && ll.isValid()) {
 			posCircleOnScreen = java.lang.Boolean.TRUE;
 			pX = posCircleX; // posCircle is inside the screen
-			pY = posCircleY; // TODO eigentlich interessiert, ob nach dem evtl. Kartenwechsel PosCircle on Screen ist. So wie es jetzt ist, kann 2mal der gleiche Aufruf zum laden unterschiedlicher Karten f???hren, wenn vorher PosCircle nicht auf dem
-								// SChirm war, nach dem ersten Laden aber schon.
+			pY = posCircleY; // TODO eigentlich interessiert, ob nach dem
+								// evtl. Kartenwechsel PosCircle on Screen
+								// ist. So wie es jetzt ist, kann 2mal der
+								// gleiche Aufruf zum laden
+								// unterschiedlicher Karten f???hren, wenn
+								// vorher PosCircle nicht auf dem
+			// SChirm war, nach dem ersten Laden aber schon.
 			cll = new CWPoint(ll);
-		} else { // when posCircle out of screen - use centre of screen as point which as to be included in the map
+		} else { // when posCircle out of screen - use centre of screen
+					// as point which as to be included in the map
 			cll = ScreenXY2LatLon(w / 2, h / 2);
 			pX = w / 2;
 			pY = h / 2;
@@ -1593,7 +1806,16 @@
 	 * @return
 	 */
 	public void loadMoreDetailedMap(boolean betterOverview) {
-		final int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
+		final int w = (width != 0 ? width : pref.myAppWidth); // width ==
+																// 0 happens
+																// if this
+																// routine
+																// is run
+																// before
+																// the
+																// windows
+																// is on the
+																// screen
 		final int h = (height != 0 ? height : pref.myAppHeight);
 		final Rect screen = new Rect(w / 2, h / 2, w, h);
 
@@ -1625,20 +1847,50 @@
 			return;
 		}
 		MapInfoObject newmap = maps.getMapForArea(sur.topleft, sur.bottomright);
-		if (newmap == null) { // no map that includs all caches is available -> load map with lowest resolution
+		if (newmap == null) { // no map that includs all caches is
+								// available -> load map with lowest
+								// resolution
 			final Object[] s = getRectForMapChange(posCircle.where);
 			final CWPoint cll = (CWPoint) s[0];
 			final Rect screen = (Rect) s[1];
 			newmap = maps.getBestMap(cll, screen, Float.MAX_VALUE - 1, false, true);
 		}
-		if (newmap == null) { // no map is covering any area of the caches -> zoom an empty map to cover all caches on screen
+		if (newmap == null) { // no map is covering any area of the caches
+								// -> zoom an empty map to cover all caches
+								// on screen
 			try {
 				final Object[] s = getRectForMapChange(posCircle.where);
 				// CWPoint cll = (CWPoint) s[0];
 				final Rect screen = (Rect) s[1];
-				final float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.bottomright.lonDec) * 1000 / (screen.width - 15)); // 15 for the size of the cache image
-				final float neededscaley = (float) (sur.topleft.getDistance(sur.bottomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height - 15)); // 15 for the size of the cache image
-				newmap = ((MapListEntry) maps.elementAt(maps.getCount() - 4)).getMap(); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
+				final float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.bottomright.lonDec) * 1000 / (screen.width - 15)); // 15
+																																						// for
+																																						// the
+																																						// size
+																																						// of
+																																						// the
+																																						// cache
+																																						// image
+				final float neededscaley = (float) (sur.topleft.getDistance(sur.bottomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height - 15)); // 15
+																																						// for
+																																						// the
+																																						// size
+																																						// of
+																																						// the
+																																						// cache
+																																						// image
+				newmap = ((MapListEntry) maps.elementAt(maps.getCount() - 4)).getMap(); // beware:
+																						// "-4"
+																						// only
+																						// works
+																						// if
+																						// the
+																						// empty
+																						// maps
+																						// were
+																						// added
+																						// last
+																						// see
+																						// MapsList.addEmptyMaps
 				newmap.zoom(newmap.scale * newmap.zoomFactor / (neededscalex > neededscaley ? neededscalex : neededscaley), 0, 0);
 				forceMapLoad = true;
 			} catch (final IOException e) {
@@ -1654,7 +1906,8 @@
 
 	public void setGpsStatus(int status) {
 		if (status == GpsStatus)
-			return; // if ignoreGpsStatutsChanges == true than the Map is in manual-mode
+			return; // if ignoreGpsStatutsChanges == true than the Map is in
+					// manual-mode
 		GpsStatus = status;
 		dontUpdatePos = false;
 		ignoreGps = false;
@@ -1677,7 +1930,9 @@
 			break;
 		}
 		}
-		mapMoved(0, 0); // positions the posCircle correctly accourding to its size (which can change when the image changes, e.g. from null to something else
+		mapMoved(0, 0); // positions the posCircle correctly accourding to
+						// its size (which can change when the image
+						// changes, e.g. from null to something else
 		posCircle.refreshNow();
 	}
 
@@ -1685,7 +1940,10 @@
 		resetCenterOfMap();
 		dontUpdatePos = false;
 		ignoreGps = false;
-		lastCompareX = Integer.MAX_VALUE; // neccessary to make updateposition to test if the current map is the best one for the GPS-Position
+		lastCompareX = Integer.MAX_VALUE; // neccessary to make
+											// updateposition to test if the
+											// current map is the best one
+											// for the GPS-Position
 		lastCompareY = Integer.MAX_VALUE;
 		autoSelectMap = true;
 		forceMapLoad = true;
@@ -1701,7 +1959,8 @@
 	 * 
 	 * @param newmap
 	 * @param lat
-	 *            move map so that lat/lon is in the centre / -361: don't adust to lat/lon
+	 *            move map so that lat/lon is in the centre / -361: don't
+	 *            adust to lat/lon
 	 * @param lon
 	 *            -361: don't adust to lat/lon
 	 */
@@ -1714,12 +1973,14 @@
 			Vm.showWait(true);
 			boolean saveIgnoreStatus;
 			saveIgnoreStatus = dontUpdatePos;
-			dontUpdatePos = true; // make updatePosition ignore calls during loading new map
+			dontUpdatePos = true; // make updatePosition ignore calls
+									// during loading new map
 			pref.log(MyLocale.getMsg(4216, "Loading map...") + newmap.mapName);
 			try {
 				this.currentMap = newmap;
 				this.title = currentMap.mapName;
-				// neccessary to make updateposition to test if the current map is the best one for the GPS-Position
+				// neccessary to make updateposition to test if the current
+				// map is the best one for the GPS-Position
 				lastCompareX = Integer.MAX_VALUE;
 				lastCompareY = Integer.MAX_VALUE;
 				if (mmp.mapImage != null) {
@@ -1730,7 +1991,8 @@
 					// calls the garbage collection
 					Vm.getUsedMemory(true);
 				}
-				// give memory free before loading the new map to avoid out of memory error
+				// give memory free before loading the new map to avoid out
+				// of memory error
 				final String ImageFilename = currentMap.getImageFilename();
 				if (ImageFilename == null) {
 					mmp.mapImage = new MapImage();
@@ -1739,10 +2001,15 @@
 				} else {
 					if (ImageFilename.length() > 0) {
 						// attention: when running in native java-vm,
-						// no exception will be thrown, not even OutOfMemeoryError
+						// no exception will be thrown, not even
+						// OutOfMemeoryError
 						mmp.mapImage = new MapImage(ImageFilename);
 					} else
-						mmp.mapImage = new MapImage(); // no image associated with the calibration info ("empty map")
+						mmp.mapImage = new MapImage(); // no image
+														// associated with
+														// the calibration
+														// info ("empty
+														// map")
 				}
 				mapImage1to1 = mmp.mapImage;
 				mmp.mapImage.properties = mmp.mapImage.properties | mImage.IsMoveable;
@@ -1752,7 +2019,8 @@
 				mmp.addImage(mmp.mapImage);
 				mmp.images.moveToBack(mmp.mapImage);
 				rebuildOverlaySet();
-				forceMapLoad = true; // forces updateOnlyPosition to redraw
+				forceMapLoad = true; // forces updateOnlyPosition to
+										// redraw
 				updateAfterMapChange(where);
 				forceMapLoad = false;
 				directionArrows.setMap(currentMap);
@@ -1795,8 +2063,19 @@
 					mapImage1to1 = mmp.mapImage;
 				}
 				rebuildOverlaySet();
-				updateOnlyPosition(where, false); // TODO this doesn't work correctly if the resolution changed, I guess because the pixels of PosCircle will be interpreted from the new resolution, but should be interpreted using the old resolution to
-													// test: select a map with a much greater value of m per pixel manually
+				updateOnlyPosition(where, false); // TODO this doesn't
+													// work correctly if the
+													// resolution changed, I
+													// guess because the
+													// pixels of PosCircle
+													// will be interpreted
+													// from the new
+													// resolution, but
+													// should be interpreted
+													// using the old
+													// resolution to
+				// test: select a map with a much greater value of m per
+				// pixel manually
 				(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4221, "Not enough ressources to load map: ") + newmap.getImageFilename() + MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"),
 						FormBase.OKB)).execute();
 				dontUpdatePos = saveIgnoreStatus;
@@ -1812,7 +2091,16 @@
 		}
 		final Point circlePosOnMap = currentMap.calcMapXY(posCircle.where);
 		final Point centerOnMap = currentMap.calcMapXY(newCenter);
-		final int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
+		final int w = (width != 0 ? width : pref.myAppWidth); // width ==
+																// 0 happens
+																// if this
+																// routine
+																// is run
+																// before
+																// the
+																// windows
+																// is on the
+																// screen
 		final int h = (height != 0 ? height : pref.myAppHeight);
 		final int mapPosX = w / 2 - centerOnMap.x;
 		final int mapPosY = h / 2 - centerOnMap.y;
@@ -1860,10 +2148,7 @@
 	}
 
 	/*
-	 * public void setZoomingMode() {
-	 * repaintNow();
-	 * zoomingMode = true;
-	 * }
+	 * public void setZoomingMode() { repaintNow(); zoomingMode = true; }
 	 */
 	/**
 	 * zommes in if w>0 and out if w<0
@@ -1873,8 +2158,24 @@
 	 * @param h
 	 */
 	public void zoomScreenRect(Point firstclickpoint, int w, int h) {
-		int newImageWidth = (int) (this.width * (this.width < 481 ? 2 : 1.6)); // (maximal) size of the zoomed image
-		int newImageHeight = (int) (this.height * (this.width < 481 ? 2 : 1.6)); // dont make this to big, otherwise it causes out of memory errors
+		int newImageWidth = (int) (this.width * (this.width < 481 ? 2 : 1.6)); // (maximal)
+																				// size
+																				// of
+																				// the
+																				// zoomed
+																				// image
+		int newImageHeight = (int) (this.height * (this.width < 481 ? 2 : 1.6)); // dont
+																					// make
+																					// this
+																					// to
+																					// big,
+																					// otherwise
+																					// it
+																					// causes
+																					// out
+																					// of
+																					// memory
+																					// errors
 		final CWPoint center = ScreenXY2LatLon(firstclickpoint.x + w / 2, firstclickpoint.y + h / 2);
 		float zoomFactor;
 		if (h < 0) {
@@ -1885,10 +2186,15 @@
 			zoomFactor = java.lang.Math.min((float) this.width / (float) w, (float) this.height / (float) h);
 		} else { // zoom out
 			w = java.lang.Math.abs(w);
-			firstclickpoint.x = firstclickpoint.x - w; // make firstclickedpoint the upper left corner
+			firstclickpoint.x = firstclickpoint.x - w; // make
+														// firstclickedpoint
+														// the upper left
+														// corner
 			zoomFactor = java.lang.Math.max((float) w / (float) this.width, (float) h / (float) this.height);
 		}
-		// calculate rect in unzoomed image in a way that the centre of the new image is the centre of selected area but give priority to the prefered image size of the scaled image
+		// calculate rect in unzoomed image in a way that the centre of the
+		// new image is the centre of selected area but give priority to the
+		// prefered image size of the scaled image
 		newImageHeight = (int) (newImageHeight / zoomFactor / currentMap.zoomFactor);
 		newImageWidth = (int) (newImageWidth / zoomFactor / currentMap.zoomFactor);
 		final Point mappos = getMapPositionOnScreen();
@@ -1902,7 +2208,11 @@
 			if (newImageRect.y < 0)
 				newImageRect.y = 0;
 			if (newImageRect.x + newImageRect.width >= mapImage1to1.getWidth())
-				newImageRect.x = mapImage1to1.getWidth() - newImageWidth; // align right if right overlaping
+				newImageRect.x = mapImage1to1.getWidth() - newImageWidth; // align
+																			// right
+																			// if
+																			// right
+																			// overlaping
 			if (newImageRect.y + newImageRect.height >= mapImage1to1.getHeight())
 				newImageRect.y = mapImage1to1.getHeight() - newImageHeight;
 			// crop if after shifting still overlapping
@@ -1952,7 +2262,8 @@
 	 * @param zoomFactor
 	 *            relative to original image
 	 * @param newImageRect
-	 *            Rect in the 1:1 image that contains the area to be zoomed into
+	 *            Rect in the 1:1 image that contains the area to be zoomed
+	 *            into
 	 * @param center
 	 */
 	public void zoomFromUnscaled(float zoomFactor, Rect newImageRect, CWPoint center) {
@@ -1984,7 +2295,8 @@
 				// tmp = mapImage1to1;
 			} // if (tmp != null) currentMap.zoom();}
 			Vm.getUsedMemory(true);
-			mmp.mapImage = tmp; // use unscaled or no image in case of OutOfMemoryError
+			mmp.mapImage = tmp; // use unscaled or no image in case of
+								// OutOfMemoryError
 			mmp.mapImage.properties = saveprop;
 			if (mapHidden)
 				mmp.mapImage.hide();
@@ -1998,7 +2310,8 @@
 		{
 			currentMap.zoom(zoomFactor, newImageRect.x, newImageRect.y);
 		}
-		// scaleWanted = currentMap.scale; use this if you want to change automatically to a map scale that best fits the zooming
+		// scaleWanted = currentMap.scale; use this if you want to change
+		// automatically to a map scale that best fits the zooming
 		destroyOverlaySet();
 		Vm.getUsedMemory(true); // call garbage collection
 		setCenterOfScreen(center, false);
@@ -2013,7 +2326,10 @@
 		if (ev instanceof FormEvent && (ev.type == FormEvent.CLOSED)) {
 			running = false;
 		}
-		if (ev instanceof KeyEvent && ev.target == this && ((((KeyEvent) ev).key == IKeys.ESCAPE) || (((KeyEvent) ev).key == IKeys.ENTER) || (((KeyEvent) ev).key == IKeys.ACTION))) {
+		if (ev instanceof KeyEvent && ev.target == this && //
+				((((KeyEvent) ev).key == IKeys.ESCAPE) || //
+						(((KeyEvent) ev).key == IKeys.ENTER) || //
+				(((KeyEvent) ev).key == IKeys.ACTION))) {
 			this.close(0);
 			ev.consumed = true;
 		}
@@ -2174,7 +2490,8 @@
 		for (int i = 0; i < SkyOrientation.LUMINARY_NAMES.length; i++) {
 			miLuminary[i] = new MenuItem(SkyOrientation.getLuminaryName(i));
 		}
-		set(ControlConstants.WantHoldDown, true); // want to get simulated right-clicks
+		set(ControlConstants.WantHoldDown, true); // want to get simulated
+													// right-clicks
 	}
 
 	public boolean imageBeginDragged(AniImage which, Point pos) {
@@ -2188,7 +2505,8 @@
 			return false;
 		}
 		// move (drag) map
-		// if (!(which == null || which == mapImage || which instanceof TrackOverlay || which == mm.directionArrows) ) return false;
+		// if (!(which == null || which == mapImage || which instanceof
+		// TrackOverlay || which == mm.directionArrows) ) return false;
 		saveGpsIgnoreStatus = mm.dontUpdatePos;
 		mm.dontUpdatePos = true;
 		saveMapLoc = pos;
@@ -2213,7 +2531,8 @@
 
 	public void onPenEvent(PenEvent ev) {
 		if (ignoreNextDrag) {
-			// On PDA next event after a Kontext ist a drag, that will move the map unwanted
+			// On PDA next event after a Kontext ist a drag, that will move
+			// the map unwanted
 			ignoreNextDrag = false;
 			if (ev.type == PenEvent.PEN_DRAG)
 				return; // ignoring now
@@ -2228,7 +2547,8 @@
 			} else {
 				saveMapLoc = new Point(ev.x, ev.y);
 				if (ev.modifiers == PenEvent.RIGHT_BUTTON) {
-					// context penHeld is fired directly on PDA (cause WantHoldDown Control Modifier)
+					// context penHeld is fired directly on PDA (cause
+					// WantHoldDown Control Modifier)
 					// but not on PC (Java) , therefor it is here
 					penHeld(new Point(ev.x, ev.y));
 				} else {
@@ -2246,7 +2566,8 @@
 					mm.dontUpdatePos = saveGpsIgnoreStatus;
 					if (java.lang.Math.abs(lastZoomWidth) < 15 || java.lang.Math.abs(lastZoomHeight) < 15) {
 						repaintNow();
-						return; // dont make to big zoom jumps - it is most probable not an intentional zoom
+						return; // dont make to big zoom jumps - it is most
+								// probable not an intentional zoom
 					}
 					mm.zoomScreenRect(saveMapLoc, lastZoomWidth, lastZoomHeight);
 				}
@@ -2279,7 +2600,13 @@
 					else
 						top = saveMapLoc.y;
 					dr.setPen(new Pen(new Color(255, 0, 0), Pen.SOLID, 3));
-					dr.drawRect(left, top, java.lang.Math.abs(lastZoomWidth), java.lang.Math.abs(lastZoomHeight), 0); // bug in ewe: thickness parameter is ignored
+					dr.drawRect(left, top, java.lang.Math.abs(lastZoomWidth), java.lang.Math.abs(lastZoomHeight), 0); // bug
+																														// in
+																														// ewe:
+																														// thickness
+																														// parameter
+																														// is
+																														// ignored
 				}
 			}
 		}
@@ -2309,7 +2636,9 @@
 		if (mapImage != null) {
 			p = mapImage.locAlways;
 			mapImage.move(p.x + diffX, p.y + diffY);
-			// if (mm.mapHidden) mapImage.properties |= AniImage.IsInvisible; // this is neccesarry because move will unhide the map if the coos show that the map is on the screen
+			// if (mm.mapHidden) mapImage.properties |=
+			// AniImage.IsInvisible; // this is neccesarry because move will
+			// unhide the map if the coos show that the map is on the screen
 		}
 		mapMoved(diffX, diffY);
 	}
@@ -2346,13 +2675,22 @@
 				mm.ignoreGps = true;
 				mm.setMap(l.selectedMap, mm.posCircle.where);
 				if (mm.currentMap.fileNameWFL.length() > 0)
-					mm.setCenterOfScreen(l.selectedMap.center, true); // if map has an image
+					mm.setCenterOfScreen(l.selectedMap.center, true); // if
+																		// map
+																		// has
+																		// an
+																		// image
 				mm.setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
-				// Point posCXY = new Point (0,0); mm.getXYinMap(mm.posCircleLat, mm.posCircleLat);
-				// double lat = mm.currentMap.affine[0]*posCXY.x + mm.currentMap.affine[2]*posCXY.y + mm.currentMap.affine[4];
-				// mm.posCircleX = 0; // place map to the upper left corner of windows
+				// Point posCXY = new Point (0,0);
+				// mm.getXYinMap(mm.posCircleLat, mm.posCircleLat);
+				// double lat = mm.currentMap.affine[0]*posCXY.x +
+				// mm.currentMap.affine[2]*posCXY.y +
+				// mm.currentMap.affine[4];
+				// mm.posCircleX = 0; // place map to the upper left corner
+				// of windows
 				// mm.posCircleY = 0;
-				// mm.updateOnlyPosition(mm.currentMap.affine[4], mm.currentMap.affine[5], true);
+				// mm.updateOnlyPosition(mm.currentMap.affine[4],
+				// mm.currentMap.affine[5], true);
 			}
 		}
 	}
@@ -2377,7 +2715,8 @@
 			if (clickedOnImage != null && clickedOnImage instanceof MapSymbol) {
 				if (((MapSymbol) clickedOnImage).mapObject instanceof CacheHolder) {
 					clickedCache = (CacheHolder) (((MapSymbol) clickedOnImage).mapObject);
-					// clickedCache == null can happen if clicked on the goto-symbol
+					// clickedCache == null can happen if clicked on the
+					// goto-symbol
 					if (clickedCache != null) {
 						CacheHolder ch = clickedCache;
 						if (clickedCache.isAddiWpt()) {
@@ -2436,17 +2775,15 @@
 				}
 			}
 			/*
-			 * this kontext will be replaced by the settings of the rose in the goto panel
+			 * this kontext will be replaced by the settings of the rose in
+			 * the goto panel
 			 * 
-			 * if ( !(mm.directionArrows.onHotArea(p.x, p.y)) ) {
-			 * }
-			 * else {
+			 * if ( !(mm.directionArrows.onHotArea(p.x, p.y)) ) { } else {
 			 * for (int i=0; i<SkyOrientation.LUMINARY_NAMES.length; i++) {
-			 * kontextMenu.addItem(miLuminary[i]);
-			 * if (i == mm.myNavigation.luminary) miLuminary[i].modifiers |= MenuItem.Checked;
-			 * else miLuminary[i].modifiers &= MenuItem.Checked;
-			 * }
-			 * }
+			 * kontextMenu.addItem(miLuminary[i]); if (i ==
+			 * mm.myNavigation.luminary) miLuminary[i].modifiers |=
+			 * MenuItem.Checked; else miLuminary[i].modifiers &=
+			 * MenuItem.Checked; } }
 			 */
 			onlyIfCache = false;
 			if (kontextMenu.items.size() > 0) {
@@ -2542,14 +2879,12 @@
 						(new MessageBox("Mission", STRreplace.replace(clickedCache.getCacheDetails(false).LongDescription, "<br>", "\n"), FormBase.OKB)).execute();
 					}
 					/*
-					 * for (int i=0; i<miLuminary.length; i++) {
-					 * if (action == miLuminary[i]) {
-					 * kontextMenu.close();
+					 * for (int i=0; i<miLuminary.length; i++) { if (action ==
+					 * miLuminary[i]) { kontextMenu.close();
 					 * mm.myNavigation.setLuminary(i);
 					 * mm.updateGps(mm.myNavigation.gpsPos.getFix());
-					 * miLuminary[i].modifiers |= MenuItem.Checked;
-					 * } else miLuminary[i].modifiers &= ~MenuItem.Checked;
-					 * }
+					 * miLuminary[i].modifiers |= MenuItem.Checked; } else
+					 * miLuminary[i].modifiers &= ~MenuItem.Checked; }
 					 */
 				}
 			} // if (ev.target == kontextMenu)
@@ -2589,8 +2924,10 @@
 
 	public ListBox(Vector maps, CWPoint Gps, CWPoint gotopos, MapInfoObject curMap) {
 		this.title = MyLocale.getMsg(4271, "Maps");
-		// if (Gui.screenIs(Gui.PDA_SCREEN)) this.setPreferredSize(200,100); else
-		// set width to screenwidth *3/4 but to at least 240 if the screen is big engough for 240px width
+		// if (Gui.screenIs(Gui.PDA_SCREEN)) this.setPreferredSize(200,100);
+		// else
+		// set width to screenwidth *3/4 but to at least 240 if the screen
+		// is big engough for 240px width
 		this.setPreferredSize(java.lang.Math.max(MyLocale.getScreenWidth() * 3 / 4, java.lang.Math.min(240, MyLocale.getScreenWidth())), MyLocale.getScreenHeight() * 3 / 4);
 		this.maps = maps;
 		MapInfoObject map;
@@ -2737,7 +3074,15 @@
 				selected = false;
 				this.close(FormBase.IDCANCEL);
 			}
-			if (ev.target == okButton || ev.target == list) { // ev.target == list is posted by mList if a selection was double clicked
+			if (ev.target == okButton || ev.target == list) { // ev.target
+																// == list
+																// is posted
+																// by mList
+																// if a
+																// selection
+																// was
+																// double
+																// clicked
 				mapSelected();
 			}
 		}
@@ -2796,7 +3141,11 @@
 	}
 
 	public void setDirections(float gd, float sd, float md) {
-		if (java.lang.Math.abs(gotoDir - gd) > 1 // to save cpu-usage only update if the is a change of directions of more than 1 degree
+		if (java.lang.Math.abs(gotoDir - gd) > 1 // to save cpu-usage
+													// only update if the is
+													// a change of
+													// directions of more
+													// than 1 degree
 				|| java.lang.Math.abs(sunDir - sd) > 1 || java.lang.Math.abs(moveDir - md) > 1) {
 			// dirsChanged = false;
 			gotoDir = gd;
@@ -2824,16 +3173,14 @@
 		return;
 		/*
 		 * if (!dirsChanged) {
-		 * g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height); // the transparency with a transparent color doesn't work in ewe-vm for pocketpc, it works in java-vm, ewe-vm on pocketpc2003
-		 * return;
-		 * }
-		 * dirsChanged = false;
-		 * //super.doDraw(g, options);
-		 * draw.setColor(Color.White);
-		 * draw.fillRect(0, 0, location.width, location.height);
-		 * minY = Integer.MAX_VALUE;
-		 * drawArrows(draw);
-		 * draw.drawImage(image,mask,Color.DarkBlue,0,0,location.width,location.height); // this trick (note: wrong transparentColor) forces a redraw
+		 * g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height); //
+		 * the transparency with a transparent color doesn't work in ewe-vm
+		 * for pocketpc, it works in java-vm, ewe-vm on pocketpc2003 return; }
+		 * dirsChanged = false; //super.doDraw(g, options);
+		 * draw.setColor(Color.White); draw.fillRect(0, 0, location.width,
+		 * location.height); minY = Integer.MAX_VALUE; drawArrows(draw);
+		 * draw.drawImage(image,mask,Color.DarkBlue,0,0,location.width,location.height); //
+		 * this trick (note: wrong transparentColor) forces a redraw
 		 * g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height);
 		 */}
 
@@ -2857,7 +3204,21 @@
 			makeArrow(sunDirArrow, sunDir, 0.75f);
 		} else
 			sunDirArrow = null;
-		if (map != null && java.lang.Math.abs(map.rotationRad) > 1.5 / 180 * java.lang.Math.PI) { // show northth arrow only if it has more than 1.5 degree deviation from vertical direction
+		if (map != null && java.lang.Math.abs(map.rotationRad) > 1.5 / 180 * java.lang.Math.PI) { // show
+																									// northth
+																									// arrow
+																									// only
+																									// if
+																									// it
+																									// has
+																									// more
+																									// than
+																									// 1.5
+																									// degree
+																									// deviation
+																									// from
+																									// vertical
+																									// direction
 			if (northDirArrow == null)
 				northDirArrow = new Point[2];
 			makeArrow(northDirArrow, 0, 1.0f); // north direction



From araber95 at mail.berlios.de  Thu Jun 16 10:35:47 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 16 Jun 2011 10:35:47 PM +0200
Subject: [Cachewolf-svn] r3028 - in trunk/src/CacheWolf: . exp imp
Message-ID: <20110616203547.CF157481297@sheep.berlios.de>

Author: araber95
Date: 2011-06-16 22:35:47 +0200 (Thu, 16 Jun 2011)
New Revision: 3028

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/exp/GpxExportNg.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
1. test for gpx-Export to POI to see if the exe works(and the jar)
2. correct import from gc if picture url redirect sets cookie
3. use big Icons setup in preferences

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-06-15 20:53:01 UTC (rev 3027)
+++ trunk/src/CacheWolf/Preferences.java	2011-06-16 20:35:47 UTC (rev 3028)
@@ -58,9 +58,8 @@
 import ewesoft.xml.sax.AttributeList;
 
 /**
- * A class to hold the preferences that were loaded upon start up of
- * CacheWolf. This class is also capable of parsing the prefs.xml file as
- * well as saving the current settings of preferences.
+ * A class to hold the preferences that were loaded upon start up of CacheWolf. This class is also capable of parsing
+ * the prefs.xml file as well as saving the current settings of preferences.
  */
 public class Preferences extends MinML {
 
@@ -71,7 +70,7 @@
 	public static final int GPSD_DISABLED = 0; // do not use gpsd
 	public static final int GPSD_FORMAT_OLD = 1; // use old protocol
 	public static final int GPSD_FORMAT_NEW = 2; // use new protocol
-													// (JSON)
+	// (JSON)
 	public static final int YES = 0;
 	public static final int NO = 1;
 	public static final int ASK = 2;
@@ -106,8 +105,8 @@
 
 	/**
 	 * Call this method to set the path of the config file <br>
-	 * If you call it with null it defaults to [program-dir]/pref.xml if p
-	 * is a directory "pref.xml" will automatically appended
+	 * If you call it with null it defaults to [program-dir]/pref.xml if p is a directory "pref.xml" will automatically
+	 * appended
 	 * 
 	 * @param p
 	 */
@@ -115,10 +114,9 @@
 		String p_;
 		if (p == null) {
 			/*
-			 * String test; test = Vm.getenv("APPDATA", "/"); // returns in
-			 * java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application
-			 * data> log("Vm.getenv(APPDATA: " + test); // this works also
-			 * in win32.exe (ewe-vm on win xp) test = Vm.getenv("HOME",
+			 * String test; test = Vm.getenv("APPDATA", "/");
+			 * // returns in java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application data> log("Vm.getenv(APPDATA: " + test);
+			 * // this works also in win32.exe (ewe-vm on win xp) test = Vm.getenv("HOME",
 			 * "/"); // This should return on *nix system the home dir
 			 * log("Vm.getenv(HOME: " + test); test =
 			 * System.getProperty("user.dir"); // return in java-vm on win
@@ -139,16 +137,8 @@
 			else
 				p_ = p;
 		}
-		pathToConfigFile = STRreplace.replace(p_, "//", "/"); // this is
-																// necessary
-																// in case
-																// that the
-																// root dir
-																// is the
-																// dir where
-																// the
-																// pref.xml
-																// is stored
+		// this is necessary in case that the root dir is the dir where the pref.xml is stored
+		pathToConfigFile = STRreplace.replace(p_, "//", "/");
 		pathToConfigFile = pathToConfigFile.replace('\\', '/');
 		p = System.getProperty("os.name");
 		if (p == null || p.indexOf("indows") != -1) {
@@ -189,8 +179,7 @@
 	/** Name of last used profile */
 	public String lastProfile = "";
 	/**
-	 * If true, the last profile is reloaded automatically without a
-	 * dialogue
+	 * If true, the last profile is reloaded automatically without a dialogue
 	 */
 	public boolean autoReloadLastProfile = false;
 	/** If true current cetre will be set from gps position */
@@ -200,8 +189,7 @@
 	/** Optional password */
 	public String password = "";
 	/**
-	 * This is an alternative alias used to identify found caches (i.e. if
-	 * using multiple IDs)
+	 * This is an alternative alias used to identify found caches (i.e. if using multiple IDs)
 	 */
 	public String myAlias2 = "";
 	/** The path to the browser */
@@ -241,9 +229,8 @@
 	public boolean showStatus = true;
 	// public boolean noTabs=false;
 	/**
-	 * True if the application can be closed by clicking on the close button
-	 * in the top line. This can be set to avoid accidental closing of the
-	 * application
+	 * True if the application can be closed by clicking on the close button in the top line. This can be set to avoid
+	 * accidental closing of the application
 	 */
 	public boolean hasCloseButton = true;
 	/** True if the SIP is always visible */
@@ -253,22 +240,19 @@
 	/** The widths for each column in list view */
 	public String listColWidth = "15,20,20,25,92,177,144,83,60,105,50,104,22,30,30,30,30,30,30,30";
 	/**
-	 * The columns which are to be displayed in TravelbugsJourneyScreen. See
-	 * also TravelbugJourney
+	 * The columns which are to be displayed in TravelbugsJourneyScreen. See also TravelbugJourney
 	 */
 	public String travelbugColMap = "1,4,5,6,8,9,10,7";
 	/** The column widths for the travelbug journeys. */
 	public String travelbugColWidth = "212,136,62,90,50,56,90,38,50,50,94,50";
 	/**
-	 * If this flag is true, only non-logged travelbug journeys will be
-	 * shown
+	 * If this flag is true, only non-logged travelbug journeys will be shown
 	 */
 	public boolean travelbugShowOnlyNonLogged = false;
 	/** If this is true, deleted images are shown with a ? in the imagepanel */
 	public boolean showDeletedImages = true;
 	/**
-	 * This setting determines how many logs are shown per page of hintlogs
-	 * (default 5)
+	 * This setting determines how many logs are shown per page of hintlogs (default 5)
 	 */
 	public int logsPerPage = DEFAULT_LOGS_PER_PAGE;
 	/** Initial height of hints field (set to 0 to hide them initially) */
@@ -278,8 +262,7 @@
 	/** True if the Solver should ignore the case of variables */
 	public boolean solverIgnoreCase = true;
 	/**
-	 * True if the solver expects arguments for trigonometric functions in
-	 * degrees
+	 * True if the solver expects arguments for trigonometric functions in degrees
 	 */
 	public boolean solverDegMode = true;
 	/** True if the description panel should show images */
@@ -289,16 +272,14 @@
 	/** Additional options for GPSBabel, i.e. -s to synthethise short names */
 	public String garminGPSBabelOptions = "";
 	/**
-	 * Max. length for Garmin waypoint names (for etrex which can only
-	 * accept 6 chars)
+	 * Max. length for Garmin waypoint names (for etrex which can only accept 6 chars)
 	 */
 	public int garminMaxLen = 0;
 	/** OC true = alle neu Laden false = wenn ?nderungsdatum neuer */
 	public boolean downloadAllOC = false;
 	public String lastOCSite = OC.OCSites[0][OC.OC_HOSTNAME];
 	/**
-	 * The currently used centre point, can be different from the profile's
-	 * centrepoint. This is used for spidering
+	 * The currently used centre point, can be different from the profile's centrepoint. This is used for spidering
 	 */
 	private CWPoint curCentrePt = new CWPoint();
 	/** True if a login screen is displayed on each spider operation */
@@ -310,8 +291,7 @@
 	/** Number of CacheHolder details that are kept in memory */
 	public int maxDetails = 50;
 	/**
-	 * Number of details to delete when maxDetails have been stored in
-	 * cachesWithLoadedDetails
+	 * Number of details to delete when maxDetails have been stored in cachesWithLoadedDetails
 	 */
 	public int deleteDetails = 5;
 	/** The locale code (DE, EN, ...) */
@@ -380,8 +360,7 @@
 
 	// ////////////////////////////////////////////
 	/**
-	 * The debug switch (Can be used to activate dormant code) by adding the
-	 * line:
+	 * The debug switch (Can be used to activate dormant code) by adding the line:
 	 * 
 	 * <pre>
 	 * &lt;debug value=&quot;true&quot; /&gt;
@@ -393,10 +372,9 @@
 	// ////////////////////////////////////////////
 
 	/**
-	 * This switches the behaviour of GUI-Element factories. If set to true,
-	 * it will construct alternative Forms. It can only be set in the
-	 * Preference-File directly, not by user-interaction now. Add <MobileGui
-	 * value="true"/> to your pref.xml
+	 * This switches the behaviour of GUI-Element factories. If set to true, it will construct alternative Forms. It can
+	 * only be set in the Preference-File directly, not by user-interaction now. Add <MobileGui value="true"/> to your
+	 * pref.xml
 	 */
 	public boolean mobileGUI = false;
 
@@ -418,9 +396,8 @@
 	// ////////////////////////////////////////////////////////////////////////////////////
 
 	/**
-	 * Method to open and parse the config file (pref.xml). Results are
-	 * stored in the public variables of this class. If you want to specify
-	 * a non default config file call setPathToConfigFile() first.
+	 * Method to open and parse the config file (pref.xml). Results are stored in the public variables of this class. If
+	 * you want to specify a non default config file call setPathToConfigFile() first.
 	 */
 	public void readPrefFile() {
 		if (pathToConfigFile == null)
@@ -439,7 +416,6 @@
 			else
 				log("Error reading pref.xml: ", e);
 		}
-		useBigIcons = MyLocale.getScreenWidth() >= 400; // && Vm.isMobile()
 		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
 	}
 
@@ -452,11 +428,8 @@
 		String pf = Vm.getPlatform();
 		String testlist[] = null;
 		if (pf.equals("Java") || pf.equals("Win32")) {
-			String progdir = Vm.getenv("ProgramFiles", null); // at least
-																// in
-																// java-Win
-																// XP this
-																// is set
+			// at least in java-Win XP this is set
+			String progdir = Vm.getenv("ProgramFiles", null);
 			String homedir = Vm.getenv("HOMEPATH", "");
 			if (progdir != null) {
 				String test[] = { homedir + "/Lokale Einstellungen/Anwendungsdaten/Google/Chrome/Application/chrome.exe", progdir + "/Firefox/firefox.exe", progdir + "/Opera/opera.exe", progdir + "/Internet Explorer/iexplore.exe" };
@@ -483,8 +456,8 @@
 
 	/** Helper variables for XML parser */
 	private StringBuffer collectElement = null;
-	private String lastName; // The string to the last XML that was
-								// processed
+	// The string to the last XML that was processed
+	private String lastName;
 
 	private long getLongAttr(AttributeList atts, String name) {
 		String stmp = atts.getValue(name);
@@ -496,8 +469,7 @@
 	}
 
 	/**
-	 * Method that gets called when a new element has been identified in
-	 * pref.xml
+	 * Method that gets called when a new element has been identified in pref.xml
 	 */
 	public void startElement(String name, AttributeList atts) {
 		lastName = name;
@@ -596,6 +568,11 @@
 				myAppHeight = Convert.toInt(atts.getValue("h"));
 				myAppWidth = Convert.toInt(atts.getValue("w"));
 			}
+			if (atts.getValue("useBigIcons") != null)
+				useBigIcons = Boolean.valueOf(atts.getValue("useBigIcons")).booleanValue();
+			else {
+				useBigIcons = MyLocale.getScreenWidth() >= 400 && Vm.isMobile();
+			}
 		} else if (name.equals("hintlogpanel")) {
 			logsPerPage = Convert.parseInt(atts.getValue("logsperpage"));
 			String strInitialHintHeight = atts.getValue("initialhintheight");
@@ -747,15 +724,13 @@
 
 	public void characters(char ch[], int start, int length) {
 		if (collectElement != null) {
-			collectElement.append(ch, start, length); // Collect the name
-														// of the last
-														// profile
+			// Collect the name of the last profile
+			collectElement.append(ch, start, length);
 		}
 	}
 
 	/**
-	 * Method that gets called when the end of an element has been
-	 * identified in pref.xml
+	 * Method that gets called when the end of an element has been identified in pref.xml
 	 */
 	public void endElement(String tag) {
 		if (tag.equals("lastprofile")) {
@@ -845,6 +820,7 @@
 					+ " hasclosebutton=\"" + hasCloseButton + "\"" //
 					+ " h=\"" + myAppHeight + "\"" //
 					+ " w=\"" + myAppWidth + "\"" //
+					+ " useBigIcons=\"" + useBigIcons + "\"" //
 					+ "/>\n" //
 
 					+ "    <fixedsip state=\"" + SafeXML.strxmlencode(fixSIP) + "\"/>\n" //
@@ -904,10 +880,8 @@
 				outp.print(this.getFilter(filterIDs[i]).toXML(filterIDs[i]));
 			}
 			if (debug)
-				outp.print("    <debug value=\"true\" />\n"); // Keep the
-																// debug
-																// switch if
-																// it is set
+				// Keep the debug switch if it is set
+				outp.print("    <debug value=\"true\" />\n");
 			// save last path of different exporters
 			Iterator itPath = exporterPaths.entries();
 			MapEntry entry;
@@ -928,13 +902,8 @@
 			outp.print("    <SortingGroupedByCache on=\"" + SafeXML.strxmlencode(SortingGroupedByCache) + "\"/>\n");
 			outp.print("    <Symbols useOwnSymbols=\"" + SafeXML.strxmlencode(useOwnSymbols) + "\"/>\n");
 			if (mobileGUI)
-				outp.print("    <MobileGui value=\"true\" />\n"); // Keep
-																	// the
-																	// vmgui
-																	// switch
-																	// if it
-																	// is
-																	// set
+				// Keep the vmgui switch if it is set
+				outp.print("    <MobileGui value=\"true\" />\n");
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {
@@ -1004,11 +973,9 @@
 	}
 
 	/**
-	 * gets the path to the calibrated maps it first tries if there are
-	 * manually imported maps in <baseDir>/maps/standard then it tries the
-	 * legacy dir: <program-dir>/maps In case in both locations are no
-	 * .wfl-files it returns <baseDir>/maps/expedia - the place where the
-	 * automatically downloaded maps are placed.
+	 * gets the path to the calibrated maps it first tries if there are manually imported maps in
+	 * <baseDir>/maps/standard then it tries the legacy dir: <program-dir>/maps In case in both locations are no
+	 * .wfl-files it returns <baseDir>/maps/expedia - the place where the automatically downloaded maps are placed.
 	 * 
 	 * 
 	 */
@@ -1030,8 +997,8 @@
 			return absoluteBaseDir + mapsPath;
 		f = t.list("*.wfl", FileBase.LIST_DIRECTORIES_ONLY | FileBase.LIST_ALWAYS_INCLUDE_DIRECTORIES);
 		if (f != null && f.length > 0) { // see if in a subdir of
-											// <baseDir>/maps/standard are
-											// .wfl files
+			// <baseDir>/maps/standard are
+			// .wfl files
 			String[] f2;
 			for (int i = 0; i < f.length; i++) {
 				t.set(null, ret + "/" + f[i]);
@@ -1079,15 +1046,14 @@
 	/**
 	 * @param create
 	 *            if true the directory if it doesn't exist will be created
-	 * @return the path where manually imported maps should be stored this
-	 *         should be adjustable in preferences...
+	 * @return the path where manually imported maps should be stored this should be adjustable in preferences...
 	 */
 	public String getMapManuallySavePath(boolean create) {
 		String mapsDir = absoluteBaseDir + mapsPath;
 		if (create && !(new FileBugfix(mapsDir).isDirectory())) { // dir
-																	// exists?
+			// exists?
 			if (new FileBugfix(mapsDir).mkdirs() == false) {// dir creation
-															// failed?
+				// failed?
 				(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(172, "Error: cannot create maps directory: \n") + mapsDir, FormBase.OKB)).exec();
 				return null;
 			}
@@ -1102,9 +1068,8 @@
 		String subdir = Global.getProfile().dataDir.substring(Global.getPref().absoluteBaseDir.length()).replace('\\', '/');
 		String mapsDir = Global.getPref().absoluteBaseDir + "maps/" + Common.ClearForFileName(mapkind) + "/" + subdir;
 		if (!(new FileBugfix(mapsDir).isDirectory())) { // dir exists?
-			if (new FileBugfix(mapsDir).mkdirs() == false) // dir creation
-															// failed?
-			{
+			if (new FileBugfix(mapsDir).mkdirs() == false) {
+				// dir creation failed?
 				(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(172, "Error: cannot create maps directory: \n") + new FileBugfix(mapsDir).getParentFile(), FormBase.OKB)).exec();
 				return null;
 			}
@@ -1113,10 +1078,8 @@
 	}
 
 	public String getMapExpediaLoadPath() {
-		return Global.getPref().absoluteBaseDir.replace('\\', '/') + "maps/expedia"; // baseDir
-																						// has
-																						// trailing
-																						// /
+		// baseDir has trailing /
+		return Global.getPref().absoluteBaseDir.replace('\\', '/') + "maps/expedia";
 	}
 
 	// ////////////////////////////////////////////////////////////////////////////////////
@@ -1128,31 +1091,26 @@
 	static protected final int PROFILE_SELECTOR_ONOROFF = 2;
 
 	/**
-	 * tries to get the home data dir of the user e.g. "c:\documents and...\<user>\my
-	 * documents" or "/home/<user>" in linux if none could be identified,
-	 * "/" is returned.
+	 * tries to get the home data dir of the user e.g. "c:\documents and...\<user>\my documents" or "/home/<user>" in
+	 * linux if none could be identified, "/" is returned.
 	 * 
 	 * @return
 	 */
 	public String getHomeDir() {
 		String test;
-		test = Vm.getenv("HOMEDRIVE", ""); // returns in java-vm on win xp:
-											// c:\<dokumente und
-											// Einstellungen>\<username>\<application
-											// data>
-		log("[Preferences:getHomeDir]" + test); // this works also in
-												// win32.exe (ewe-vm on win
-												// xp)
-		test += Vm.getenv("HOMEPATH", ""); // returns in java-vm on win xp:
-											// c:\<dokumente und
-											// Einstellungen>\<username>\<application
-											// data>
-		log("[Preferences:getHomeDir]" + test); // this works also in
-												// win32.exe (ewe-vm on win
-												// xp)
+		// returns in java-vm on win xp:
+		// c:\<dokumente und Einstellungen>\<username>\<application data>
+		test = Vm.getenv("HOMEDRIVE", "");
+		log("[Preferences:getHomeDir]" + test);
+		// this works also in win32.exe (ewe-vm on win xp)
+		test += Vm.getenv("HOMEPATH", "");
+		// returns in java-vm on win xp:
+		// c:\<dokumente und Einstellungen>\<username>\<application data>
+		log("[Preferences:getHomeDir]" + test);
+		// this works also in win32.exe (ewe-vm on win xp)
 		if (test.length() == 0)
-			test = Vm.getenv("HOME", ""); // This should return on *nix
-											// system the home dir
+			// This should return on *nix system the home dir
+			test = Vm.getenv("HOME", "");
 		if (test.length() == 0)
 			test = "/";
 		return test;
@@ -1183,10 +1141,10 @@
 		checkAbsoluteBaseDir();
 		boolean profileExists = true; // Assume that the profile exists
 		do {
-			if (!profileExists || (showProfileSelector == PROFILE_SELECTOR_FORCED_ON) || (showProfileSelector == PROFILE_SELECTOR_ONOROFF && !autoReloadLastProfile)) { // Ask
-																																										// for
-																																										// the
-																																										// profile
+			if (!profileExists//
+					|| (showProfileSelector == PROFILE_SELECTOR_FORCED_ON)//
+					|| (showProfileSelector == PROFILE_SELECTOR_ONOROFF && !autoReloadLastProfile)//
+			) {
 				ProfilesForm f = new ProfilesForm(absoluteBaseDir, lastProfile, !profileExists || hasNewButton ? 0 : 1);
 				int code = f.execute();
 				// If no profile chosen (includes a new one), terminate
@@ -1196,7 +1154,8 @@
 				prof.clearProfile();
 				prof.setCenterCoords(savecenter);
 				// prof.hasUnsavedChanges = true;
-				// curCentrePt.set(0,0); // No centre yet
+				// curCentrePt.set(0,0);
+				// No centre yet
 				lastProfile = f.newSelectedProfile;
 			}
 			profileExists = (new FileBugfix(absoluteBaseDir + lastProfile)).exists();
@@ -1280,9 +1239,8 @@
 	private final String LOGFILENAME = FileBase.getProgramDirectory() + "/log.txt";
 
 	/**
-	 * Method to delete an existing log file. Called on every SpiderGC. The
-	 * log file is also cleared when Preferences is created and the filesize >
-	 * 60KB
+	 * Method to delete an existing log file. Called on every SpiderGC. The log file is also cleared when Preferences is
+	 * created and the filesize > 60KB
 	 */
 	public void logInit() {
 		File logFile = new FileBugfix(LOGFILENAME);
@@ -1299,9 +1257,8 @@
 	boolean forceLog = false;
 
 	/**
-	 * Method to log messages to a file called log.txt It will always append
-	 * to an existing file. To show the message on the console, the global
-	 * variable debug must be set. This can be done by adding
+	 * Method to log messages to a file called log.txt It will always append to an existing file. To show the message on
+	 * the console, the global variable debug must be set. This can be done by adding
 	 * 
 	 * <pre>
 	 * &lt;debug value=&quot;true&quot;&gt;
@@ -1347,12 +1304,9 @@
 	 * @param e
 	 *            The exception
 	 * @param withStackTrace
-	 *            If true and the debug switch is true, the stack trace is
-	 *            appended to the log The debug switch can be set by
-	 *            including the line <i>&lt;debug
-	 *            value="true"&gt;&lt;/debug&gt;</i> in the pref.xml file
-	 *            or by manually setting it (i.e. in BE versions or RC
-	 *            versions) by including the line
+	 *            If true and the debug switch is true, the stack trace is appended to the log The debug switch can be
+	 *            set by including the line <i>&lt;debug value="true"&gt;&lt;/debug&gt;</i> in the pref.xml file or by
+	 *            manually setting it (i.e. in BE versions or RC versions) by including the line
 	 * 
 	 * <pre>
 	 * Global.getPref().debug = true;
@@ -1374,9 +1328,8 @@
 	}
 
 	/**
-	 * Log an exception to the log file without a stack trace, i.e. where a
-	 * stack trace is not needed because the location/cause of the error is
-	 * clear
+	 * Log an exception to the log file without a stack trace, i.e. where a stack trace is not needed because the
+	 * location/cause of the error is clear
 	 * 
 	 * @param message
 	 *            Optional message (Can be empty string)
@@ -1428,8 +1381,8 @@
 	}
 
 	/**
-	 * <code>True</code> or <code>false</code>, depending if a filter
-	 * with the given ID is saved in the preferences.
+	 * <code>True</code> or <code>false</code>, depending if a filter with the given ID is saved in the
+	 * preferences.
 	 * 
 	 * @param filterID
 	 *            ID of the filter to check
@@ -1440,8 +1393,8 @@
 	}
 
 	/**
-	 * Returns the FilterData object saved with the given ID. The ID is not
-	 * saved in the object, so it may be resaved under another ID.
+	 * Returns the FilterData object saved with the given ID. The ID is not saved in the object, so it may be resaved
+	 * under another ID.
 	 * 
 	 * @param filterID
 	 *            ID of the FilterData object
@@ -1452,9 +1405,8 @@
 	}
 
 	/**
-	 * Adds a FilterData object to the list. If a FilterData object is
-	 * already saved unter the given ID, the old object is removed and the
-	 * new one is set at its place.
+	 * Adds a FilterData object to the list. If a FilterData object is already saved unter the given ID, the old object
+	 * is removed and the new one is set at its place.
 	 * 
 	 * @param filterID
 	 *            ID to associate with the filter object
@@ -1466,8 +1418,8 @@
 	}
 
 	/**
-	 * Removed the FilterData object which is saved with the given ID. If no
-	 * such FilterData object exists, nothing happens.
+	 * Removed the FilterData object which is saved with the given ID. If no such FilterData object exists, nothing
+	 * happens.
 	 * 
 	 * @param filterID
 	 *            ID of FilterData object to remove
@@ -1477,8 +1429,7 @@
 	}
 
 	/**
-	 * Returns a alphabetically sorted array of ID of saved FilterData
-	 * objects.
+	 * Returns a alphabetically sorted array of ID of saved FilterData objects.
 	 * 
 	 * @return Array of IDs
 	 */
@@ -1508,25 +1459,18 @@
 			p.waitFor();
 			gpsbabel = "gpsbabel";
 		} catch (IOException ioex) {
-			// Most of the time there will be an exception, so don't
-			// complain
-		}
-		if (gpsbabel == null) {
 			try {
 				ewe.sys.Process p = Vm.exec("gpsbabel.exe -V");
 				p.waitFor();
 				gpsbabel = "gpsbabel.exe";
-			} catch (IOException ioex) {
-				// Most of the time there will be an exception, so don't
-				// complain
+			} catch (IOException io_ex) {
 			}
 		}
 	}
 
 	/**
 	 * get directory where pref.xml is stored<br>
-	 * use this if you need a path where the user has sufficient rights to
-	 * create a file
+	 * use this if you need a path where the user has sufficient rights to create a file
 	 */
 	public String getPathToConfigFile() {
 		return pathToConfigFile;

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2011-06-15 20:53:01 UTC (rev 3027)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2011-06-16 20:35:47 UTC (rev 3028)
@@ -54,13 +54,14 @@
 import ewe.ui.mTabbedPanel;
 
 /**
- * This class displays a user interface allowing the user to change and set preferences. It also provides a method to save the changed preferences that are saved immediatly when the user presses "Apply". Class ID=600
+ * This class displays a user interface allowing the user to change and set preferences. It also provides a method to
+ * save the changed preferences that are saved immediatly when the user presses "Apply". Class ID=600
  */
 public class PreferencesScreen extends Form {
 	mButton cancelB, applyB, brwBt, gpsB;
 	mChoice inpLanguage, inpMetric, inpSpiderUpdates;
 	mInput DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontName, fontSize, inpLogsPerPage, inpMaxLogsToSpider, inpPassword, inpGcMemberID, inpUserID;
-	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus, chkHasCloseButton, chkSynthShort, chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName, chkSetCurrentCentreFromGPSPosition,
+	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus, chkHasCloseButton, chkUseBigIcons, chkSynthShort, chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName, chkSetCurrentCentreFromGPSPosition,
 			chkSortingGroupedByCache, chkuseOwnSymbols, chkDebug, chkPM;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
@@ -183,7 +184,6 @@
 		frmScreen.addLast(pnlScreen, HSTRETCH, HFILL);
 
 		frmScreen.addLast(chkHasCloseButton = new mCheckBox(MyLocale.getMsg(631, "PDA has close Button")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
-		// lblTitle.setTag(INSETS,new Insets(2,0,0,0));
 		chkHasCloseButton.setState(pref.hasCloseButton);
 		frmScreen.addNext(chkMenuAtTop = new mCheckBox(MyLocale.getMsg(626, "Menu top")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
 		chkMenuAtTop.setTag(INSETS, new Insets(0, 0, 2, 0));
@@ -194,17 +194,21 @@
 		frmScreen.addLast(chkShowStatus = new mCheckBox(MyLocale.getMsg(628, "Status")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
 		chkShowStatus.setState(pref.showStatus);
 		chkShowStatus.setTag(INSETS, new Insets(0, 0, 2, 0));
+		frmScreen.addLast(chkUseBigIcons = new mCheckBox("use big Icons"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
+		chkUseBigIcons.setState(pref.useBigIcons);
 		pnlDisplay.addLast(frmScreen, CellConstants.HSTRETCH, CellConstants.FILL);
 
 		Frame frmImages = new Frame();
 		frmImages.borderStyle = UIConstants.BDR_RAISEDOUTER | UIConstants.BDR_SUNKENINNER | UIConstants.BF_TOP | UIConstants.BF_BOTTOM;
-		// frmImages.addNext(new mLabel(MyLocale.getMsg(623,"Images:")),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.LEFT));
+		// frmImages.addNext(new mLabel(MyLocale.getMsg(623,"Images:")),CellConstants.VSTRETCH,
+		// (CellConstants.DONTFILL|CellConstants.LEFT));
 		frmImages.addLast(chkShowDeletedImg = new mCheckBox(MyLocale.getMsg(624, "Show deleted images")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
 		chkShowDeletedImg.setTag(INSETS, new Insets(2, 0, 0, 0));
 		if (pref.showDeletedImages)
 			chkShowDeletedImg.setState(true);
 		// mLabel dummy;
-		// frmImages.addNext(dummy=new mLabel(""),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.LEFT|CellConstants.NORTH));
+		// frmImages.addNext(dummy=new mLabel(""),CellConstants.VSTRETCH,
+		// (CellConstants.DONTFILL|CellConstants.LEFT|CellConstants.NORTH));
 		// dummy.setTag(INSETS,new Insets(0,0,2,0));
 		frmImages.addLast(chkDescShowImg = new mCheckBox(MyLocale.getMsg(638, "Show pictures in description")), CellConstants.VSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT | CellConstants.NORTH));
 		chkDescShowImg.setTag(INSETS, new Insets(0, 0, 2, 0));
@@ -246,7 +250,8 @@
 		chkProxyActive.setState(pref.proxyActive);
 		pnlMore.addLast(pnlProxy, HSTRETCH, HFILL);
 		pnlMore.addNext(new mLabel(MyLocale.getMsg(592, "Language (needs restart)")), DONTSTRETCH, DONTFILL | LEFT);
-		String[] tmp = (new FileBugfix(FileBase.getProgramDirectory() + "/languages").list("*.cfg", FileBase.LIST_FILES_ONLY)); // "*.xyz" doesn't work on some systems -> use FileBugFix
+		// "*.xyz" doesn't work on some systems -> use FileBugFix
+		String[] tmp = (new FileBugfix(FileBase.getProgramDirectory() + "/languages").list("*.cfg", FileBase.LIST_FILES_ONLY));
 		if (tmp == null)
 			tmp = new String[0];
 		String[] langs = new String[tmp.length + 1];
@@ -340,7 +345,8 @@
 				pref.myproxy = Proxy.getText();
 				pref.myproxyport = ProxyPort.getText();
 				pref.proxyActive = chkProxyActive.getState();
-				HttpConnection.setProxy(pref.myproxy, Common.parseInt(pref.myproxyport), pref.proxyActive); // TODO generate an error message if proxy port is not a number
+				// TODO generate an error message if proxy port is not a number
+				HttpConnection.setProxy(pref.myproxy, Common.parseInt(pref.myproxyport), pref.proxyActive);
 				pref.autoReloadLastProfile = chkAutoLoad.getState();
 				pref.isPremium = chkPM.getState();
 				pref.setCurrentCentreFromGPSPosition = chkSetCurrentCentreFromGPSPosition.getState();
@@ -351,6 +357,7 @@
 				pref.tabsAtTop = chkTabsAtTop.getState();
 				pref.showStatus = chkShowStatus.getState();
 				pref.hasCloseButton = chkHasCloseButton.getState();
+				pref.useBigIcons = chkUseBigIcons.getState();
 				pref.travelbugColMap = tccBugs.getSelectedCols();
 				pref.listColMap = tccList.getSelectedCols();
 				pref.descShowImg = chkDescShowImg.getState();

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-06-15 20:53:01 UTC (rev 3027)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-06-16 20:35:47 UTC (rev 3028)
@@ -77,6 +77,7 @@
 	private static void initPermanentRequestorProperty() {
 		permanentRequestorProperties = new PropertyList();
 		permanentRequestorProperties.add("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
+		// permanentRequestorProperties.add("Connection", "close");
 		permanentRequestorProperties.add("Connection", "keep-alive");
 	}
 
@@ -168,11 +169,20 @@
 			urltmp = conn.getRedirectTo();
 			if (urltmp != null) {
 				conn.disconnect();
+				// mainly implemented for opencaching.de ... login
 				final PropertyList pl = UrlFetcher.getDocumentProperties();
 				if (pl != null) {
 					String cookie = (String) pl.getValue("Set-Cookie", "");
-					if (!cookie.equals(""))
-						setPermanentRequestorProperty("Cookie", cookie);
+					if (cookie.length() > 0) {
+						if (postData == null)
+							// do not overwrite existing cookie (mostly for geocaching.com)
+							// normally a cookie exists for a website
+							// we do not handle that correct
+							setRequestorProperty("Cookie", cookie);
+						else
+							// needed for opencaching.de ... login
+							setPermanentRequestorProperty("Cookie", cookie);
+					}
 				}
 				conn = conn.getRedirectedConnection(urltmp);
 				forceRedirect = false; // one time or more redirected
@@ -195,7 +205,8 @@
 
 	/**
 	 * @param url
-	 * @return true, if the string seems to be already URL encoded (that is, it contains only url-allowd chars), false otherwise
+	 * @return true, if the string seems to be already URL encoded (that is, it contains only url-allowd chars), false
+	 *         otherwise
 	 */
 	private static boolean isUrlEncoded(String url) {
 		final String allowed = new String("-_.~!*'();:@&=+$,/?%#[]");
@@ -213,7 +224,8 @@
 
 	/**
 	 * This method encodes an URL containing special characters using the UTF-8 codec in %nn%nn notation<br>
-	 * Note that the encoding for URLs is not generally defined. Usually cp1252 or UTF-8 is used. It depends on what the server expects, what encoding you must use.
+	 * Note that the encoding for URLs is not generally defined. Usually cp1252 or UTF-8 is used. It depends on what the
+	 * server expects, what encoding you must use.
 	 * 
 	 * @param cc
 	 * @return
@@ -232,7 +244,8 @@
 	final static String hex = ewe.util.TextEncoder.hex;
 
 	/**
-	 * Encode the URL using %## notation. Note: this fixes a bug in ewe.net.URL.encodeURL(): that routine assumes all chars to be < 127. This method is mainly copied from there
+	 * Encode the URL using %## notation. Note: this fixes a bug in ewe.net.URL.encodeURL(): that routine assumes all
+	 * chars to be < 127. This method is mainly copied from there
 	 * 
 	 * @param url
 	 *            The unencoded URL.

Modified: trunk/src/CacheWolf/exp/GpxExportNg.java
===================================================================
--- trunk/src/CacheWolf/exp/GpxExportNg.java	2011-06-15 20:53:01 UTC (rev 3027)
+++ trunk/src/CacheWolf/exp/GpxExportNg.java	2011-06-16 20:35:47 UTC (rev 3028)
@@ -1,28 +1,28 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See http://developer.berlios.de/projects/cachewolf/
-    for more information.
-    Contact: 	bilbowolf at users.berlios.de
-    			kalli at users.berlios.de
+Copyright (C) 2006  CacheWolf development team
+See http://developer.berlios.de/projects/cachewolf/
+for more information.
+Contact: 	bilbowolf at users.berlios.de
+			kalli at users.berlios.de
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf.exp;
 
 import CacheWolf.Attribute;
@@ -85,12 +85,11 @@
 import ewe.util.zip.ZipFile;
 
 /**
- * experimental GPX exporter that should better handle the various tasks that
- * can be accomplished with GPX
+ * experimental GPX exporter that should better handle the various tasks that can be accomplished with GPX
  */
 public class GpxExportNg {
 	/** new line */
-	final static String newLine="\r\n";
+	final static String newLine = "\r\n";
 	/** decimal separator for lat- and lon-String */
 	// final static char decimalSeparator='.';
 	/** export is in compact format */
@@ -119,7 +118,7 @@
 	final static String FALSE = "False";
 	/** object used to determine custom symbols and POI categories */
 	private static GarminMap poiMapper = new GarminMap();
-	/** maximum number of logs to export. can be overwritten with preferences, default unlimited*/
+	/** maximum number of logs to export. can be overwritten with preferences, default unlimited */
 	private int maxLogs = ewe.math.Number.INTEGER_MAX_VALUE;
 	/** number of errors / warnings during export */
 	private int exportErrors = 0;
@@ -127,48 +126,48 @@
 	private String finderid;
 
 	// we need to fake desc to make clients like GSAK accept additional waypoints together with caches
-	final static String GPXHEADER = "<?xml version=\"1.0\" encoding=\"utf-8\"?>"+(newLine)
-			+("<gpx")
-			+(" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"")
-			+(" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"")
-			+(" version=\"1.0\"")
-			+(" creator=\"CacheWolf\"")
-			+(" xsi:schemaLocation=\"")
-				+("http://www.topografix.com/GPX/1/0 ")
-				+("http://www.topografix.com/GPX/1/0/gpx.xsd ")
-				+("http://www.groundspeak.com/cache/1/0/1 ")
-				+("http://www.groundspeak.com/cache/1/0/1/cache.xsd")
-			+("\"")
-			+(" xmlns=\"http://www.topografix.com/GPX/1/0\"")
-			+(">")
-			+(newLine)
-			+("<name>@@NAME@@</name>")+(newLine)
-			+("<desc>This is an individual cache generated from Geocaching.com</desc>")+(newLine)
-			+("<author>Various users from geocaching.com and/or opencaching.de</author>")+(newLine)
-			+("<email>contact at cachewolf.de</email>")+(newLine)
-			+("<url>http://www.cachewolf.de/</url>")+(newLine)
-			+("<urlname>CacheWolf - Paperless Geocaching</urlname>")+(newLine)
-			+("<time>@@CREATEDATE@@T07:00:00Z</time>")+(newLine)
-			+("<keywords>cache, geocache, waypoints</keywords>")+(newLine)
+	final static String GPXHEADER = "<?xml version=\"1.0\" encoding=\"utf-8\"?>" + (newLine)//
+			+ ("<gpx")//
+			+ (" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"")//
+			+ (" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"")//
+			+ (" version=\"1.0\"")//
+			+ (" creator=\"CacheWolf\"")//
+			+ (" xsi:schemaLocation=\"")//
+			+ ("http://www.topografix.com/GPX/1/0 ")//
+			+ ("http://www.topografix.com/GPX/1/0/gpx.xsd ")//
+			+ ("http://www.groundspeak.com/cache/1/0/1 ")//
+			+ ("http://www.groundspeak.com/cache/1/0/1/cache.xsd")//
+			+ ("\"")//
+			+ (" xmlns=\"http://www.topografix.com/GPX/1/0\"")//
+			+ (">")//
+			+ (newLine)//
+			+ ("<name>@@NAME@@</name>") + (newLine)//
+			+ ("<desc>This is an individual cache generated from Geocaching.com</desc>") + (newLine)//
+			+ ("<author>Various users from geocaching.com and/or opencaching.de</author>") + (newLine)//
+			+ ("<email>contact at cachewolf.de</email>") + (newLine)//
+			+ ("<url>http://www.cachewolf.de/</url>") + (newLine)//
+			+ ("<urlname>CacheWolf - Paperless Geocaching</urlname>") + (newLine)//
+			+ ("<time>@@CREATEDATE@@T07:00:00Z</time>") + (newLine)//
+			+ ("<keywords>cache, geocache, waypoints</keywords>") + (newLine)//
 	// TODO: is it worth a second loop?
 	// +("<bounds minlat=\"50.91695\" minlon=\"6.876383\" maxlat=\"50.935183\" maxlon=\"6.918817\" />")
 	;
 
-	final static String GPXLOG = "\t\t\t\t<groundspeak:log id=\"@@LOGID@@\">"+(newLine)
-			+("\t\t\t\t\t<groundspeak:date>@@LOGDATE@@T00:00:00</groundspeak:date>")+(newLine)
-			+("\t\t\t\t\t<groundspeak:type>@@LOGTYPE@@</groundspeak:type>")+(newLine)
-			+("\t\t\t\t\t<groundspeak:finder id=\"@@LOGFINDERID@@\">@@LOGFINDER@@</groundspeak:finder>")+(newLine)
-			+("\t\t\t\t\t<groundspeak:text encoded=\"@@LOGENCODE@@\">@@LOGTEXT@@</groundspeak:text>")+(newLine)
-			+("\t\t\t\t</groundspeak:log>")+(newLine);
+	final static String GPXLOG = "\t\t\t\t<groundspeak:log id=\"@@LOGID@@\">" + (newLine)//
+			+ ("\t\t\t\t\t<groundspeak:date>@@LOGDATE@@T00:00:00</groundspeak:date>") + (newLine)//
+			+ ("\t\t\t\t\t<groundspeak:type>@@LOGTYPE@@</groundspeak:type>") + (newLine)//
+			+ ("\t\t\t\t\t<groundspeak:finder id=\"@@LOGFINDERID@@\">@@LOGFINDER@@</groundspeak:finder>") + (newLine)//
+			+ ("\t\t\t\t\t<groundspeak:text encoded=\"@@LOGENCODE@@\">@@LOGTEXT@@</groundspeak:text>") + (newLine)//
+			+ ("\t\t\t\t</groundspeak:log>") + (newLine);//
 
-	final static String GPXTB = "\t\t\t\t<groundspeak:travelbug id=\"@@TBID@@\" ref=\"@@TBREF@@\">"+(newLine)
-			+("\t\t\t\t\t<groundspeak:name>@@TBNAME@@</groundspeak:name>")+(newLine)
-			+("\t\t\t\t</groundspeak:travelbug>")+(newLine);
+	final static String GPXTB = "\t\t\t\t<groundspeak:travelbug id=\"@@TBID@@\" ref=\"@@TBREF@@\">" + (newLine)//
+			+ ("\t\t\t\t\t<groundspeak:name>@@TBNAME@@</groundspeak:name>") + (newLine)//
+			+ ("\t\t\t\t</groundspeak:travelbug>") + (newLine);//
 
 	// FIXME: don't use this until GPX import can strip this off as well
-	final static String GPXADDIINMAIN = "@@ADDIID@@ - @@ADDISHORT@@@@ADDIDELIM@@"
-			+("@@ADDILAT@@ @@ADDILON@@@@ADDIDELIM@@")
-			+("@@ADDILONG@@@@ADDIDELIM@@");
+	final static String GPXADDIINMAIN = "@@ADDIID@@ - @@ADDISHORT@@@@ADDIDELIM@@"//
+			+ ("@@ADDILAT@@ @@ADDILON@@@@ADDIDELIM@@")//
+			+ ("@@ADDILONG@@@@ADDIDELIM@@");//
 
 	private static boolean customIcons;
 	private static boolean sendToGarmin;
@@ -184,16 +183,18 @@
 	private static String bitmapFileName;
 
 	public GpxExportNg() {
-		bitmapFileName = FileBase.getProgramDirectory() + "/exporticons/GarminPOI.zip"; //own version
-		if (!(hasBitmaps=new File(bitmapFileName).exists())) {
-			bitmapFileName=FileBase.getProgramDirectory() + "/exporticons/exporticons/GarminPOI.zip"; //cw default version
-			hasBitmaps=new File(bitmapFileName).exists();			
+		bitmapFileName = FileBase.getProgramDirectory() + "/exporticons/GarminPOI.zip"; // own version
+		if (!(hasBitmaps = new File(bitmapFileName).exists())) {
+			// cw default version
+			bitmapFileName = FileBase.getProgramDirectory() + "/exporticons/exporticons/GarminPOI.zip";
+			hasBitmaps = new File(bitmapFileName).exists();
 		}
 
 		hasGpsbabel = Global.getPref().gpsbabel != null;
 
 		finderid = Global.getPref().gcMemberId;
-		if (finderid.equals("")) Global.getPref().log("GPX Export: warning gcmemberid not set, check pref.xml",null);
+		if (finderid.equals(""))
+			Global.getPref().log("GPX Export: warning gcmemberid not set, check pref.xml", null);
 	}
 
 	public void doit() {
@@ -224,11 +225,9 @@
 			ZipFile poiZip = null;
 
 			if (exportTarget == OUTPUT_POI) {
-				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT,
-						Global.getPref().getExportPath(expName + "-POI"));
+				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().getExportPath(expName + "-POI"));
 			} else {
-				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT,
-						Global.getPref().getExportPath(expName + "-GPI"));
+				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().getExportPath(expName + "-GPI"));
 			}
 
 			fc.setTitle("Select target directory:");
@@ -244,9 +243,8 @@
 			}
 
 			if (!poiMapper.exists) {
-				Global.getPref().log("GPX Export: unable to load garminmap.xml",null);
-				new MessageBox("Export Error", "unable to load garminmap.xml",
-						FormBase.OKB).execute();
+				Global.getPref().log("GPX Export: unable to load garminmap.xml", null);
+				new MessageBox("Export Error", "unable to load garminmap.xml", FormBase.OKB).execute();
 				return;
 			}
 
@@ -258,12 +256,12 @@
 				tempDir = outDir;
 				String tmp[] = new FileBugfix(tempDir).list(prefix + "*.gpx", ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i = 0; i < tmp.length; i++) {
-					FileBugfix tmpFile = new FileBugfix(tempDir	+ FileBase.separator + tmp[i]);
+					FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
 				tmp = new FileBugfix(tempDir).list(prefix + "*.bmp", ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i = 0; i < tmp.length; i++) {
-					FileBugfix tmpFile = new FileBugfix(tempDir	+ FileBase.separator + tmp[i]);
+					FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
 			}
@@ -286,30 +284,22 @@
 					if (!ch.isVisible()) {
 						continue;
 					} else if (ch.is_incomplete()) {
-						Global.getPref().log(
-								"skipping export of incomplete waypoint "
-								+ ch.getWayPoint(),null);
+						Global.getPref().log("skipping export of incomplete waypoint " + ch.getWayPoint(), null);
 					} else {
 						String poiId = poiMapper.getPoiId(ch);
 						if (null == poiId) {
-							Global.getPref().log(
-									"GPX Export: unmatched POI ID for "
-									+ ch.getWayPoint() + " of type "
-									+ ch.getType(),null);
+							Global.getPref().log("GPX Export: unmatched POI ID for " + ch.getWayPoint() + " of type " + ch.getType(), null);
 							exportErrors++;
 						} else {
 							PrintWriter writer;
 							if (fileHandles.containsKey(poiId)) {
 								writer = (PrintWriter) fileHandles.get(poiId);
 							} else {
-								writer = new PrintWriter(new BufferedWriter(
-										new FileWriter(new File(tempDir
-												+ FileBase.separator + prefix
-												+ poiId + ".gpx"))));
+								writer = new PrintWriter(new BufferedWriter(new FileWriter(new File(tempDir + FileBase.separator + prefix + poiId + ".gpx"))));
 								fileHandles.put(poiId, writer);
 								writer.print(formatHeader());
 							}
-							String strOut=formatCache(ch);
+							String strOut = formatCache(ch);
 							if (!strOut.equals("")) {
 								writer.print(strOut);
 							}
@@ -331,16 +321,15 @@
 				if (exportTarget == OUTPUT_POI) {
 					// only clean up output directory if user has chosen non empty prefix,
 					// since otherwise all present POI would be deleted
-					if (! prefix.equals("")) {
-						String tmp[] = new FileBugfix(outDir).list(
-								prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
+					if (!prefix.equals("")) {
+						String tmp[] = new FileBugfix(outDir).list(prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
 						for (int i = 0; i < tmp.length; i++) {
 							FileBugfix tmpFile = new FileBugfix(outDir + FileBase.separator + tmp[i]);
 							tmpFile.delete();
 						}
 					}
 					pbf.exit(0);
-					poiCategories=fileHandles.size();
+					poiCategories = fileHandles.size();
 					pbf.setTask(h, "Transfer");
 					pbf.exec();
 				}
@@ -351,7 +340,7 @@
 					String key = (String) keys.nextElement();
 					PrintWriter writer = (PrintWriter) fileHandles.get(key);
 
-					writer.print("</gpx>"+newLine);
+					writer.print("</gpx>" + newLine);
 					writer.close();
 					if (exportTarget == OUTPUT_POI) {
 						poiCounter++;
@@ -366,42 +355,35 @@
 
 						if (exportTarget == OUTPUT_POI) {
 							String[] cmdStack = new String[9];
-							cmdStack[0]=Global.getPref().gpsbabel;
-							cmdStack[1]="-i";
-							cmdStack[2]="gpx";
-							cmdStack[3]="-f";
-							cmdStack[4]=tempDir + FileBase.separator + prefix + key + ".gpx";
-							cmdStack[5]="-o";
-							cmdStack[6]="garmin_gpi,sleep=1,category="+prefix + key+",bitmap="+tempDir + FileBase.separator + prefix + key	+ ".bmp";
-							cmdStack[7]="-F";
-							cmdStack[8]=outDir + FileBase.separator + prefix + key + ".gpi";
+							cmdStack[0] = Global.getPref().gpsbabel;
+							cmdStack[1] = "-i";
+							cmdStack[2] = "gpx";
+							cmdStack[3] = "-f";
+							cmdStack[4] = tempDir + FileBase.separator + prefix + key + ".gpx";
+							cmdStack[5] = "-o";
+							cmdStack[6] = "garmin_gpi,sleep=1,category=" + prefix + key + ",bitmap=" + tempDir + FileBase.separator + prefix + key + ".bmp";
+							cmdStack[7] = "-F";
+							cmdStack[8] = outDir + FileBase.separator + prefix + key + ".gpi";
 
-							Process babelProcess = startProcess(cmdStack);
+							Process babelProcess = null;
+							babelProcess = startProcess(cmdStack);
 							StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
-							while (errorStream.isOpen()) {
-								String errorMsg = errorStream.readALine();
-								if (errorMsg != null) {
-									Global.getPref().log("GPX Export: " + errorMsg,null);
-									exportErrors++;
-								}
-								try {
-									babelProcess.exitValue();
-									errorStream.close();
-								} catch (IllegalThreadStateException e) {
-									// still running
-								}
+							babelProcess.waitFor();
+							String errorMsg = errorStream.readALine();
+							if (errorMsg != null) {
+								Global.getPref().log("GPX Export: " + errorMsg, null);
+								exportErrors++;
 							}
+							errorStream.close();
 						}
-
 					}
 				}
 
 				if (exportTarget == OUTPUT_POI) {
 					FileBugfix tmpdir = new FileBugfix(tempDir);
-					String tmp[] = new FileBugfix(tempDir).list(prefix + "*.*",
-							ewe.io.FileBase.LIST_FILES_ONLY);
+					String tmp[] = new FileBugfix(tempDir).list(prefix + "*.*", ewe.io.FileBase.LIST_FILES_ONLY);
 					for (int i = 0; i < tmp.length; i++) {
-						FileBugfix tmpFile = new FileBugfix(tempDir	+ FileBase.separator + tmp[i]);
+						FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
 						tmpFile.delete();
 					}
 					tmpdir.delete();
@@ -418,7 +400,7 @@
 			if (customIcons) {
 				if (!poiMapper.exists) {
 					customIcons = false;
-					Global.getPref().log("unable to load garminmap.xml",null);
+					Global.getPref().log("unable to load garminmap.xml", null);
 				}
 			}
 
@@ -433,8 +415,7 @@
 			final File file;
 
 			if (!sendToGarmin) {
-				final FileChooser fc = new FileChooser(FileChooserBase.SAVE,
-						Global.getPref().getExportPath(expName + "-GPX"));
+				final FileChooser fc = new FileChooser(FileChooserBase.SAVE, Global.getPref().getExportPath(expName + "-GPX"));
 
 				fc.setTitle("Select target GPX file:");
 				fc.addMask("*.gpx");
@@ -443,8 +424,7 @@
 					return;
 
 				file = fc.getChosenFile();
-				Global.getPref()
-						.setExportPath(expName + "-GPX", file.getPath());
+				Global.getPref().setExportPath(expName + "-GPX", file.getPath());
 			} else {
 				file = new File("").createTempFile("gpxexport", null, null);
 			}
@@ -459,12 +439,12 @@
 
 				outp.print(formatHeader());
 
-				//pbf.showMainTask = false;
-				//pbf.setTask(h, "Exporting ...");
-				//pbf.exec();
-				//h.progressResolution=0;
+				// pbf.showMainTask = false;
+				// pbf.setTask(h, "Exporting ...");
+				// pbf.exec();
+				// h.progressResolution=0;
 
-				Global.getPref().log("start: "+new Time().getTime());
+				Global.getPref().log("start: " + new Time().getTime());
 				CacheDB cDB = Global.getProfile().cacheDB;
 				for (int i = 0; i < cDB.size(); i++) {
 					CacheHolder ch = cDB.get(i);
@@ -472,68 +452,60 @@
 						continue;
 					} else if (ch.is_incomplete()) {
 						exportErrors++;
-						Global.getPref().log("GPX Export: skipping export of incomplete waypoint " + ch.getWayPoint(),null);
+						Global.getPref().log("GPX Export: skipping export of incomplete waypoint " + ch.getWayPoint(), null);
 					} else {
-						String strOut=formatCache(ch);
+						String strOut = formatCache(ch);
 						if (!strOut.equals("")) {
 							outp.print(strOut);
 							expCount++;
 						}
 					}
-					
-					//h.progress = expCount / totalCount;
-					//h.changed();
-					
-					if (Global.mainTab.statBar!=null) Global.mainTab.statBar.updateDisplay(" "+((expCount * 100) / totalCount)+"% ");
+
+					// h.progress = expCount / totalCount;
+					// h.changed();
+
+					if (Global.mainTab.statBar != null)
+						Global.mainTab.statBar.updateDisplay(" " + ((expCount * 100) / totalCount) + "% ");
 				}
 
-				Global.getPref().log("stop: "+new Time().getTime());
-				if (Global.mainTab.statBar!=null) Global.mainTab.statBar.updateDisplay("done:"+expCount);
+				Global.getPref().log("stop: " + new Time().getTime());
+				if (Global.mainTab.statBar != null)
+					Global.mainTab.statBar.updateDisplay("done:" + expCount);
 				// pbf.exit(0);
 
-				outp.print("</gpx>"+newLine);
+				outp.print("</gpx>" + newLine);
 				outp.close();
 			} catch (Exception ex) {
 				exportErrors++;
 				Global.getPref().log("GPX Export: unable to write output to " + file.toString(), ex, true);
-				new MessageBox("Export Error", "unable to write output to "	+ file.toString(), FormBase.OKB).execute();
+				new MessageBox("Export Error", "unable to write output to " + file.toString(), FormBase.OKB).execute();
 				return;
-			}
-			finally {
+			} finally {
 				Vm.showWait(false);
 			}
 
-
 			if (sendToGarmin) {
 				try {
 					String[] cmdStack = new String[9];
-					cmdStack[0]=Global.getPref().gpsbabel;
-					cmdStack[1]="-i";
-					cmdStack[2]="gpx";
-					cmdStack[3]="-f";
-					cmdStack[4]=file.getCreationName();
-					cmdStack[5]="-o";
-					cmdStack[6]="garmin";
-					cmdStack[7]="-F";
-					cmdStack[8]=Global.getPref().garminConn+(":");
-
-					Process babelProcess = this.startProcess(cmdStack);
-					if (babelProcess != null) {
-						StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
-						while (errorStream.isOpen()) {
-							String errorMsg = errorStream.readALine();
-							if (errorMsg != null) {
-								Global.getPref().log("[GPX Export:sendToGarmin] " + errorMsg,null);
-								exportErrors++;
-							}
-							try {
-								babelProcess.exitValue();
-								errorStream.close();
-							} catch (IllegalThreadStateException e) {
-								// still running
-							}
-						}
+					cmdStack[0] = Global.getPref().gpsbabel;
+					cmdStack[1] = "-i";
+					cmdStack[2] = "gpx";
+					cmdStack[3] = "-f";
+					cmdStack[4] = file.getCreationName();
+					cmdStack[5] = "-o";
+					cmdStack[6] = "garmin";
+					cmdStack[7] = "-F";
+					cmdStack[8] = Global.getPref().garminConn + (":");
+					Process babelProcess = null;
+					babelProcess = startProcess(cmdStack);
+					StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
+					babelProcess.waitFor();
+					String errorMsg = errorStream.readALine();
+					if (errorMsg != null) {
+						Global.getPref().log("GPX Export: " + errorMsg, null);
+						exportErrors++;
 					}
+					errorStream.close();
 				} catch (Exception ex) {
 					Global.getPref().log("GPX Export error :", ex, true);
 				}
@@ -541,13 +513,13 @@
 			}
 		}
 		if (exportErrors > 0) {
-			new MessageBox("Export Error", exportErrors	+ " errors during export. Check log for details.",
-					FormBase.OKB).execute();
+			new MessageBox("Export Error", exportErrors + " errors during export. Check log for details.", FormBase.OKB).execute();
 		}
 	}
 
 	/**
 	 * wrapper for formatting a cache. will call some subroutines to do the actual work
+	 * 
 	 * @param ch
 	 * @return
 	 */
@@ -573,12 +545,12 @@
 			ret.append("  </wpt>").append(newLine);
 		} catch (IllegalArgumentException e) {
 			exportErrors++;
-			ch.checkIncomplete();  // ch.setIncomplete(true);
-			Global.getPref().log("GPX Export: " + ch.getWayPoint() + " check incomplete ",	e, true);
+			ch.checkIncomplete(); // ch.setIncomplete(true);
+			Global.getPref().log("GPX Export: " + ch.getWayPoint() + " check incomplete ", e, true);
 			return "";
 		} catch (Exception e) {
 			exportErrors++;
-			Global.getPref().log("GPX Export: " + ch.getWayPoint() + " caused ", e,	true);
+			Global.getPref().log("GPX Export: " + ch.getWayPoint() + " caused ", e, true);
 			return "";
 		}
 
@@ -587,6 +559,7 @@
 
 	/**
 	 * generate minimal waypoint information according to GPX specification
+	 * 
 	 * @param ch
 	 * @return
 	 */
@@ -594,23 +567,23 @@
 
 		StringBuffer ret = new StringBuffer();
 
-//			.append("\t\t<desc>@@WPDESC@@</desc>").append(newLine)
+		// .append("\t\t<desc>@@WPDESC@@</desc>").append(newLine)
 
-		ret.append("  <wpt lat=\""+ch.pos.getLatDeg(CWPoint.DD)+"\" lon=\""+ch.pos.getLonDeg(CWPoint.DD)+"\">").append(newLine);
+		ret.append("  <wpt lat=\"" + ch.pos.getLatDeg(CWPoint.DD) + "\" lon=\"" + ch.pos.getLonDeg(CWPoint.DD) + "\">").append(newLine);
 
 		if (exportStyle != STYLE_GPX_COMPACT) {
 			if (ch.isAddiWpt()) {
 				try {
-					ret.append("    <time>"+ch.mainCache.getDateHidden()+"T07:00:00Z</time>").append(newLine);
+					ret.append("    <time>" + ch.mainCache.getDateHidden() + "T07:00:00Z</time>").append(newLine);
 				} catch (Exception e) {
-					Global.getPref().log(ch.getWayPoint() + " has no parent",null);
+					Global.getPref().log(ch.getWayPoint() + " has no parent", null);
 					exportErrors++;
 					ret.append("    <time>1970-01-01T00:00:00</time>").append(newLine);
 				}
 			} else if (ch.isCustomWpt()) {
 				ret.append("    <time>1970-01-01T00:00:00</time>").append(newLine);
 			} else {
-				ret.append("    <time>"+ch.getDateHidden()+"T00:00:00</time>").append(newLine);
+				ret.append("    <time>" + ch.getDateHidden() + "T00:00:00</time>").append(newLine);
 			}
 		}
 
@@ -620,13 +593,13 @@
 			} else if (ch.isCustomWpt()) {
 				ret.append("    <name>").append(SafeXML.cleanGPX(ch.getWayPoint())).append("</name>").append(newLine);
 			} else {
-				ret.append("    <name>").append(SafeXML.cleanGPX(ch.getWayPoint()))
-						.append(" ")
-						.append(CacheType.getExportShortId(ch.getType()))
-						.append(String.valueOf(ch.getHard()))
-						.append(String.valueOf(ch.getTerrain()))
-						.append(CacheSize.getExportShortId(ch.getCacheSize()))
-						.append(String.valueOf(ch.getNoFindLogs()))
+				ret.append("    <name>").append(SafeXML.cleanGPX(ch.getWayPoint()))//
+						.append(" ")//
+						.append(CacheType.getExportShortId(ch.getType()))//
+						.append(String.valueOf(ch.getHard()))//
+						.append(String.valueOf(ch.getTerrain()))//
+						.append(CacheSize.getExportShortId(ch.getCacheSize()))//
+						.append(String.valueOf(ch.getNoFindLogs()))//
 						.append("</name>").append(newLine);
 			}
 		} else if (exportIds == WPNAME_NAME_SMART) {
@@ -655,17 +628,17 @@
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
 			ret.append("    <desc>").append(SafeXML.cleanGPX(ch.getCacheName())).append("</desc>").append(newLine);
 		} else {
-			ret.append("    <desc>").append(SafeXML.cleanGPX(ch.getCacheName()))
-					.append(" by ")
-					.append(SafeXML.cleanGPX(ch.getCacheOwner()))
-					.append(", ")
-					.append(CacheType.type2GSTypeTag(ch.getType()))
-					.append(" (")
-					.append(CacheTerrDiff.shortDT(ch.getHard()))
-					.append("/")
-					.append(CacheTerrDiff.shortDT(ch.getTerrain()))
-					.append(")")
-					.append("</desc>").append(newLine);					
+			ret.append("    <desc>").append(SafeXML.cleanGPX(ch.getCacheName()))//
+					.append(" by ")//
+					.append(SafeXML.cleanGPX(ch.getCacheOwner()))//
+					.append(", ")//
+					.append(CacheType.type2GSTypeTag(ch.getType()))//
+					.append(" (")//
+					.append(CacheTerrDiff.shortDT(ch.getHard()))//
+					.append("/")//
+					.append(CacheTerrDiff.shortDT(ch.getTerrain()))//
+					.append(")")//
+					.append("</desc>").append(newLine);
 		}
 
 		if (exportStyle != STYLE_GPX_COMPACT) {
@@ -698,40 +671,47 @@
 
 	/**
 	 * format gc.com extended cache information as found in a PQ
-	 * @param ch cacheholder
-	 * @return formatted cache information for cache waypoints or emty string for all other waypoints (additional / custom)
+	 * 
+	 * @param ch
+	 *            cacheholder
+	 * @return formatted cache information for cache waypoints or emty string for all other waypoints (additional /
+	 *         custom)
 	 */
 	private String formatPqExtensions(CacheHolder ch) {
 
-		// no  details for addis or custom waypoints
+		// no details for addis or custom waypoints
 		if (ch.isCustomWpt() || ch.isAddiWpt())
 			return "";
 		StringBuffer ret = new StringBuffer();
-		ret.append("    <groundspeak:cache id=\"").append(ch.GetCacheID()).append("\" available=\"").append(ch.is_available() ? TRUE : FALSE).append("\" archived=\"").append(ch.is_archived() ? TRUE : FALSE).append("\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">").append(newLine)
-		.append("      <groundspeak:name>").append(SafeXML.cleanGPX(ch.getCacheName())).append("</groundspeak:name>").append(newLine)
-		.append("      <groundspeak:placed_by>").append(SafeXML.cleanGPX(ch.getCacheOwner())).append("</groundspeak:placed_by>").append(newLine)
-		.append("      <groundspeak:owner id=\"").append("31415").append("\">").append(SafeXML.cleanGPX(ch.getCacheOwner())).append("</groundspeak:owner>").append(newLine)
-		.append("      <groundspeak:type>").append(CacheType.type2GSTypeTag(ch.getType())).append("</groundspeak:type>").append(newLine)
-		.append("      <groundspeak:container>").append(CacheSize.cw2ExportString(ch.getCacheSize())).append("</groundspeak:container>").append(newLine)
-		.append("      <groundspeak:attributes>").append(newLine)
-		.append(formatAttributes(ch))
-		.append("      </groundspeak:attributes>").append(newLine)
-		.append("      <groundspeak:difficulty>").append(CacheTerrDiff.shortDT(ch.getHard())).append("</groundspeak:difficulty>").append(newLine)
-		.append("      <groundspeak:terrain>").append(CacheTerrDiff.shortDT(ch.getTerrain())).append("</groundspeak:terrain>").append(newLine)
-		.append("      <groundspeak:country>").append(SafeXML.cleanGPX(ch.getCacheDetails(true).Country)).append("</groundspeak:country>").append(newLine)
-		.append("      <groundspeak:state>").append(SafeXML.cleanGPX(ch.getCacheDetails(true).State)).append("</groundspeak:state>").append(newLine)
-		.append("      <groundspeak:short_description html=\"").append(ch.is_HTML() ? TRUE : FALSE).append("\"></groundspeak:short_description>").append(newLine)
-		.append("      <groundspeak:long_description html=\"").append(ch.is_HTML() ? TRUE : FALSE).append("\">").append(SafeXML.cleanGPX(formatLongDescription(ch))).append("</groundspeak:long_description>").append(newLine)
-		.append("      <groundspeak:encoded_hints>").append(SafeXML.cleanGPX(Common.rot13(ch.getCacheDetails(true).Hints))).append("</groundspeak:encoded_hints>").append(newLine)
-		.append("      <groundspeak:logs>").append(newLine)
-		.append(formatLogs(ch))
-		.append("      </groundspeak:logs>").append(newLine)
-		.append("      <groundspeak:travelbugs>").append(newLine)
-		.append(formatTbs(ch))
-		.append("      </groundspeak:travelbugs>").append(newLine)
-		.append("    </groundspeak:cache>").append(newLine);
+		ret.append("    <groundspeak:cache id=\"").append(ch.GetCacheID())//
+				.append("\" available=\"").append(ch.is_available() ? TRUE : FALSE)//
+				.append("\" archived=\"").append(ch.is_archived() ? TRUE : FALSE)//
+				.append("\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">").append(newLine)//
+				.append("      <groundspeak:name>").append(SafeXML.cleanGPX(ch.getCacheName())).append("</groundspeak:name>").append(newLine)//
+				.append("      <groundspeak:placed_by>").append(SafeXML.cleanGPX(ch.getCacheOwner())).append("</groundspeak:placed_by>").append(newLine)//
+				.append("      <groundspeak:owner id=\"").append("31415").append("\">").append(SafeXML.cleanGPX(ch.getCacheOwner())).append("</groundspeak:owner>").append(newLine)//
+				.append("      <groundspeak:type>").append(CacheType.type2GSTypeTag(ch.getType())).append("</groundspeak:type>").append(newLine)//
+				.append("      <groundspeak:container>").append(CacheSize.cw2ExportString(ch.getCacheSize())).append("</groundspeak:container>").append(newLine)//
+				.append("      <groundspeak:attributes>").append(newLine)//
+				.append(formatAttributes(ch))//
+				.append("      </groundspeak:attributes>").append(newLine)//
+				.append("      <groundspeak:difficulty>").append(CacheTerrDiff.shortDT(ch.getHard())).append("</groundspeak:difficulty>").append(newLine)//
+				.append("      <groundspeak:terrain>").append(CacheTerrDiff.shortDT(ch.getTerrain())).append("</groundspeak:terrain>").append(newLine)//
+				.append("      <groundspeak:country>").append(SafeXML.cleanGPX(ch.getCacheDetails(true).Country)).append("</groundspeak:country>").append(newLine)//
+				.append("      <groundspeak:state>").append(SafeXML.cleanGPX(ch.getCacheDetails(true).State)).append("</groundspeak:state>").append(newLine)//
+				.append("      <groundspeak:short_description html=\"").append(ch.is_HTML() ? TRUE : FALSE).append("\"></groundspeak:short_description>").append(newLine)//
+				.append("      <groundspeak:long_description html=\"").append(ch.is_HTML() ? TRUE : FALSE).append("\">").append(SafeXML.cleanGPX(formatLongDescription(ch))).append("</groundspeak:long_description>").append(newLine)//
+				.append("      <groundspeak:encoded_hints>").append(SafeXML.cleanGPX(Common.rot13(ch.getCacheDetails(true).Hints))).append("</groundspeak:encoded_hints>").append(newLine)//
+				.append("      <groundspeak:logs>").append(newLine)//
+				.append(formatLogs(ch))//
+				.append("      </groundspeak:logs>").append(newLine)//
+				.append("      <groundspeak:travelbugs>").append(newLine)//
+				.append(formatTbs(ch))//
+				.append("      </groundspeak:travelbugs>").append(newLine)//
+				.append("    </groundspeak:cache>").append(newLine);//
 		return ret.toString();
 	}
+
 	/**
 	 * 
 	 */
@@ -739,95 +719,97 @@
 		StringBuffer ret = new StringBuffer();
 		Travelbug Tb;
 		for (int i = 0; i < ch.getCacheDetails(true).Travelbugs.size(); i++) {
-			Tb=ch.getCacheDetails(true).Travelbugs.getTB(i);
-			ret.append("        <groundspeak:travelbug id=\"").
-			append(Integer.toString(i)).
-			append("\" ref=\"TB\">").
-			// append(newLine).
-			// append("          <groundspeak:name>").
-			append("<groundspeak:name>").
-			append(SafeXML.cleanGPX(Tb.getName())).
-			append("</groundspeak:name>").
-			// append(newLine).
-			// append("        </groundspeak:travelbug>\r\n");
-			append("</groundspeak:travelbug>\r\n");
+			Tb = ch.getCacheDetails(true).Travelbugs.getTB(i);
+			ret.append("        <groundspeak:travelbug id=\"").//
+					append(Integer.toString(i)).//
+					append("\" ref=\"TB\">").//
+					// append(newLine).//
+					// append(" <groundspeak:name>").//
+					append("<groundspeak:name>").//
+					append(SafeXML.cleanGPX(Tb.getName())).//
+					append("</groundspeak:name>").//
+					// append(newLine).//
+					// append(" </groundspeak:travelbug>\r\n");//
+					append("</groundspeak:travelbug>\r\n");//
 		}
 		return ret.toString();
 	}
+
 	/**
 	 * 
 	 */
-	private String formatAttributes(CacheHolder ch){
+	private String formatAttributes(CacheHolder ch) {
 		StringBuffer ret = new StringBuffer();
 		Attribute attrib;
 		for (int i = 0; i < ch.getCacheDetails(true).attributes.count(); i++) {
 			// <groundspeak:attribute id="X" inc="Y">text f?r X</groundspeak:attribute>
-			attrib=ch.getCacheDetails(true).attributes.getAttribute(i);
+			attrib = ch.getCacheDetails(true).attributes.getAttribute(i);
 			if (attrib.getGCId().length() > 0) {
-				ret.append("        <groundspeak:attribute id=\"").
-				append(attrib.getGCId()).
-				append("\" inc=\"").
-				append(attrib.getInc()).
-				append("\">").
-				append(attrib.getGCText()).
-				append("</groundspeak:attribute>").
-				append(newLine);
+				ret.append("        <groundspeak:attribute id=\"").//
+						append(attrib.getGCId()).//
+						append("\" inc=\"").//
+						append(attrib.getInc()).//
+						append("\">").//
+						append(attrib.getGCText()).//
+						append("</groundspeak:attribute>").//
+						append(newLine);//
 			}
 		}
 		return ret.toString();
 	}
+
 	/**
 	 * format cache logs as found in a gc.com GPX file
-	 * @param ch CacheHolder containing the logs
+	 * 
+	 * @param ch
+	 *            CacheHolder containing the logs
 	 * @return formatted logs or empty string if no logs are present
 	 */
 	private String formatLogs(CacheHolder ch) {
-		CacheHolderDetail chD=ch.getCacheDetails(false);
+		CacheHolderDetail chD = ch.getCacheDetails(false);
 		LogList logs = chD.CacheLogs;
 		StringBuffer ret = new StringBuffer();
 		int exportlogs;
-		if (exportStyle == STYLE_GPX_PQLIKE && maxLogs < logs.size())
-			{exportlogs = maxLogs;}
-		else {exportlogs = logs.size();}
+		if (exportStyle == STYLE_GPX_PQLIKE && maxLogs < logs.size()) {
+			exportlogs = maxLogs;
+		} else {
+			exportlogs = logs.size();
+		}
 		if (exportStyle == STYLE_GPX_MYFINDS) {
 			// only own log
 			if (chD.OwnLogId.equals("") || chD.OwnLog == null) {
-				Global.getPref().log(chD.getParent().getWayPoint()+" missing own LogID", null);
-				return "";				
+				Global.getPref().log(chD.getParent().getWayPoint() + " missing own LogID", null);
+				return "";
 			}
-			addLog(chD.OwnLogId, chD.OwnLog, finderid ,ret);
-		}
-		else {
+			addLog(chD.OwnLogId, chD.OwnLog, finderid, ret);
+		} else {
 			// add log with attributes
-			if (attrib2Log){
-				addLog (ch.GetCacheID()+Integer.toString(exportlogs), createAttrLog(ch),"",ret);
+			if (attrib2Log) {
+				addLog(ch.GetCacheID() + Integer.toString(exportlogs), createAttrLog(ch), "", ret);
 			}
 			for (int i = 0; i < exportlogs; i++) {
-				addLog(ch.GetCacheID()+Integer.toString(i), logs.getLog(i),"" ,ret);
+				addLog(ch.GetCacheID() + Integer.toString(i), logs.getLog(i), "", ret);
 			}
 		}
 		return ret.toString();
 	}
+
 	private Log createAttrLog(CacheHolder ch) {
 		Attribute attrib;
 		StringBuffer logText = new StringBuffer();
 		for (int i = 0; i < ch.getCacheDetails(true).attributes.count(); i++) {
-			attrib=ch.getCacheDetails(true).attributes.getAttribute(i);
-			logText.append(attrib.getInc()==1?"Yes: ":"No: ").
-			append(attrib.getMsg()).
-			append("<br />").
-			append(newLine);
+			attrib = ch.getCacheDetails(true).attributes.getAttribute(i);
+			logText.append(attrib.getInc() == 1 ? "Yes: " : "No: ").append(attrib.getMsg()).append("<br />").append(newLine);
 		}
 		if (ch.hasNote()) {
-			logText.append(SafeXML.cleanGPX(ch.getCacheDetails(true).getCacheNotes())).
-			append("<br />").
-			append(newLine);
+			logText.append(SafeXML.cleanGPX(ch.getCacheDetails(true).getCacheNotes())).append("<br />").append(newLine);
 		}
-		if (logText.length() == 0 && !ch.getLastSync().equals("")) logText.append(MyLocale.getMsg(1051,"Last sync date"));
+		if (logText.length() == 0 && !ch.getLastSync().equals(""))
+			logText.append(MyLocale.getMsg(1051, "Last sync date"));
 		Log log = new Log("icon_note.gif", DateFormat.yyyyMMddHHmmss2gpxLogdate(ch.getLastSync()), "CacheWolf", logText.toString());
 		return log;
 	}
-	
+
 	private StringBuffer addLog(String logId, Log log, String FinderID, StringBuffer ret) {
 		Transformer trans = new Transformer(true);
 		trans.add(new Regex("@@LOGID@@", logId));
@@ -843,16 +825,20 @@
 
 	/**
 	 * format the header of the GPX file
+	 * 
 	 * @return
 	 */
 	private String formatHeader() {
-		//FIXME: extend profile to add <bounds minlat=\"50.91695\" minlon=\"6.876383\" maxlat=\"50.935183\" maxlon=\"6.918817\" />
-		//Global.getProfile().getSourroundingArea(false);
+		// FIXME: extend profile to add <bounds minlat=\"50.91695\" minlon=\"6.876383\" maxlat=\"50.935183\"
+		// maxlon=\"6.918817\" />
+		// Global.getProfile().getSourroundingArea(false);
 		Transformer trans = new Transformer(true);
 		trans.add(new Regex("@@CREATEDATE@@", new Date().setToCurrentTime().setFormat("yyyy-MM-dd").toString()));
-		if (exportStyle==STYLE_GPX_MYFINDS)
-			 {trans.add(new Regex("@@NAME@@","My Finds Pocket Query"));}
-		else {trans.add(new Regex("@@NAME@@","Waypoints for Cache Listings, Generated by CacheWolf"));}
+		if (exportStyle == STYLE_GPX_MYFINDS) {
+			trans.add(new Regex("@@NAME@@", "My Finds Pocket Query"));
+		} else {
+			trans.add(new Regex("@@NAME@@", "Waypoints for Cache Listings, Generated by CacheWolf"));
+		}
 		return trans.replaceFirst(GPXHEADER);
 		/*
 		String ret = STRreplace.replace(GPXHEADER,"@@CREATEDATE@@", new Date().setToCurrentTime().setFormat("yyyy-MM-dd").toString());
@@ -865,7 +851,9 @@
 
 	/**
 	 * format a long description as found in the gc.com GPX files
-	 * @param ch CacheHolder to format
+	 * 
+	 * @param ch
+	 *            CacheHolder to format
 	 * @return formatted output
 	 */
 	private String formatLongDescription(CacheHolder ch) {
@@ -896,9 +884,9 @@
 					trans.add(new Regex("@@ADDIID@@", addi.getWayPoint()));
 					trans.add(new Regex("@@ADDISHORT@@", addi.getCacheName()));
 					trans.add(new Regex("@@ADDIDELIM@@", delim));
-					trans.add(new Regex("@@ADDILAT@@",formatAddiLatLon(addi.pos)));
+					trans.add(new Regex("@@ADDILAT@@", formatAddiLatLon(addi.pos)));
 					trans.add(new Regex("@@ADDILON@@", ""));
-					trans.add(new Regex("@@ADDILONG@@",addi.getCacheDetails(true).LongDescription));
+					trans.add(new Regex("@@ADDILONG@@", addi.getCacheDetails(true).LongDescription));
 					ret.append(trans.replaceAll(GPXADDIINMAIN));
 				}
 				ret.append(delim).append(newLine);
@@ -909,11 +897,10 @@
 
 	/**
 	 * create a position information suitable for a gc.com PQlike export
-	 *
+	 * 
 	 * @param pos
 	 *            position
-	 * @return if position is valid return the cachewolf formatted position,
-	 *         otherwise return teh string used in PQs
+	 * @return if position is valid return the cachewolf formatted position, otherwise return teh string used in PQs
 	 */
 	private String formatAddiLatLon(CWPoint pos) {
 		if (pos.isValid()) {
@@ -924,7 +911,9 @@
 	}
 
 	/**
-	 * copy the bitmap identified by <code>prefix</code> and <code>type</code> from <code>poiZip</code> to <code>outdir</code>
+	 * copy the bitmap identified by <code>prefix</code> and <code>type</code> from <code>poiZip</code> to
+	 * <code>outdir</code>
+	 * 
 	 * @param outdir
 	 * @param type
 	 * @param prefix
@@ -943,7 +932,7 @@
 
 			buff = new byte[icon.getSize()];
 			InputStream fis = poiZip.getInputStream(icon);
-			FileOutputStream fos = new FileOutputStream(outdir+(FileBase.separator)+prefix+type+".bmp");
+			FileOutputStream fos = new FileOutputStream(outdir + (FileBase.separator) + prefix + type + ".bmp");
 			while (0 < (len = fis.read(buff)))
 				fos.write(buff, 0, len);
 			fos.flush();
@@ -961,28 +950,31 @@
 
 	/**
 	 * Execute the command defined by cmd
-	 * @param cmd command and options to execute. if command or options include a space quatation marks are added. this will not wirk with the java version on unix systems
+	 * 
+	 * @param cmd
+	 *            command and options to execute. if command or options include a space quatation marks are added. this
+	 *            will not wirk with the java version on unix systems
 	 * @return a handle to the process on success or null otherwise
 	 */
 	Process startProcess(String[] cmd) {
 		String command = "";
 		if (cmd.length == 0) {
 			exportErrors++;
-			Global.getPref().log("GPX Export: empty gpsbabel command",null);
+			Global.getPref().log("GPX Export: empty gpsbabel command", null);
 			return null;
 		}
 
 		for (int i = 0; i < cmd.length; i++) {
 			if (cmd[i].indexOf(" ") > -1) {
-				cmd[i]="\""+cmd[i]+"\"";
+				cmd[i] = "\"" + cmd[i] + "\"";
 			}
-			command = command+cmd[i]+" ";
+			command = command + cmd[i] + " ";
 		}
 
 		try {
 			return Vm.exec(command);
 		} catch (IOException e) {
-			Global.getPref().log("error excuting "+command, e, true);
+			Global.getPref().log("error excuting " + command, e, true);
 			exportErrors++;
 			return null;
 		}
@@ -1020,32 +1012,32 @@
 			this.setTitle("GPX Export");
 			this.resizable = false;
 
-			btnOk = new mButton(MyLocale.getMsg(1605,"OK"));
-			btnCancel = new mButton(MyLocale.getMsg(1604,"Cancel"));
+			btnOk = new mButton(MyLocale.getMsg(1605, "OK"));
+			btnCancel = new mButton(MyLocale.getMsg(1604, "Cancel"));
 
 			chIds = new mChoice();
 			chIds.dontSearchForKeys = true;
 			// if you change the order of strings make sure to fix the event handler as well
-			chIds.addItem(MyLocale.getMsg(31415,"Classic IDs")); // index 0
-			chIds.addItem(MyLocale.getMsg(31415,"Smart IDs")); // index 1
-//			chIds.addItem(MyLocale.getMsg(31415,"Smart Names")); // index 2
+			chIds.addItem(MyLocale.getMsg(31415, "Classic IDs")); // index 0
+			chIds.addItem(MyLocale.getMsg(31415, "Smart IDs")); // index 1
+			// chIds.addItem(MyLocale.getMsg(31415,"Smart Names")); // index 2
 			chIds.select(chosenIds);
 
 			chStyle = new mChoice();
 			chStyle.dontSearchForKeys = true;
 			// if you change the order of strings make sure to fix the event handler as well
-			chStyle.addItem(MyLocale.getMsg(31415,"Compact")); // index 0
-			chStyle.addItem(MyLocale.getMsg(31415,"PQ like")); // index 1
-			chStyle.addItem(MyLocale.getMsg(31415,"MyFinds")); // index 2
+			chStyle.addItem(MyLocale.getMsg(31415, "Compact")); // index 0
+			chStyle.addItem(MyLocale.getMsg(31415, "PQ like")); // index 1
+			chStyle.addItem(MyLocale.getMsg(31415, "MyFinds")); // index 2
 			chStyle.select(chosenStyle);
 
 			chTarget = new mChoice();
 			chTarget.dontSearchForKeys = true;
 			// if you change the order of strings make sure to fix the event handler as well
-			chTarget.addItem(MyLocale.getMsg(31415,"Single GPX")); // index 0
-			chTarget.addItem(MyLocale.getMsg(31415,"Separate GPX")); // index 1
+			chTarget.addItem(MyLocale.getMsg(31415, "Single GPX")); // index 0
+			chTarget.addItem(MyLocale.getMsg(31415, "Separate GPX")); // index 1
 			if (hasBitmaps && hasGarminMap && hasGpsbabel) {
-				chTarget.addItem(MyLocale.getMsg(31415,"POI")); // index 2
+				chTarget.addItem(MyLocale.getMsg(31415, "POI")); // index 2
 			}
 			chTarget.select(chosenTarget);
 
@@ -1055,39 +1047,41 @@
 			ibMaxLogs = new mInput(String.valueOf(Global.getPref().numberOfLogsToExport));
 			ibMaxLogs.modify(ControlConstants.Disabled, 0);
 
-			cbSeperateHints = new mCheckBox(MyLocale.getMsg(31415,"Separate Hints"));
+			cbSeperateHints = new mCheckBox(MyLocale.getMsg(31415, "Separate Hints"));
 			cbSeperateHints.modify(ControlConstants.Disabled, 0);
 
-			cbSendToGarmin = new mCheckBox(MyLocale.getMsg(31415,"send to Garmin"));
-			if (!hasGpsbabel) cbSendToGarmin.modify(ControlConstants.Disabled, 0);
+			cbSendToGarmin = new mCheckBox(MyLocale.getMsg(31415, "send to Garmin"));
+			if (!hasGpsbabel)
+				cbSendToGarmin.modify(ControlConstants.Disabled, 0);
 
-			cbCustomIcons = new mCheckBox(MyLocale.getMsg(31415,"Custom Icons"));
-			if (!hasGarminMap) cbCustomIcons.modify(ControlConstants.Disabled, 0);
+			cbCustomIcons = new mCheckBox(MyLocale.getMsg(31415, "Custom Icons"));
+			if (!hasGarminMap)
+				cbCustomIcons.modify(ControlConstants.Disabled, 0);
 
-			cbAttrib2Log = new mCheckBox(MyLocale.getMsg(31415,"Attrib.->Log"));
-			
-			addNext(new mLabel(MyLocale.getMsg(31415,"GPX Style")));
+			cbAttrib2Log = new mCheckBox(MyLocale.getMsg(31415, "Attrib.->Log"));
+
+			addNext(new mLabel(MyLocale.getMsg(31415, "GPX Style")));
 			addLast(chStyle);
 
-			addNext(new mLabel(MyLocale.getMsg(31415,"WP Names")));
+			addNext(new mLabel(MyLocale.getMsg(31415, "WP Names")));
 			addLast(chIds);
 
-			addNext(new mLabel(MyLocale.getMsg(31415,"Output")));
+			addNext(new mLabel(MyLocale.getMsg(31415, "Output")));
 			addLast(chTarget);
 
 			addNext(cbCustomIcons);
 			addLast(cbSendToGarmin);
 
-//			addLast(cbSeperateHints);
+			// addLast(cbSeperateHints);
 
-            addNext(new mLabel(MyLocale.getMsg(31415,"Prefix")));
-            addLast(ibPrefix);
-            
-            addLast(cbAttrib2Log);
-            
-            addNext(new mLabel(MyLocale.getMsg(31415,"Max Logs")));
-            addLast(ibMaxLogs);
+			addNext(new mLabel(MyLocale.getMsg(31415, "Prefix")));
+			addLast(ibPrefix);
 
+			addLast(cbAttrib2Log);
+
+			addNext(new mLabel(MyLocale.getMsg(31415, "Max Logs")));
+			addLast(ibMaxLogs);
+
 			addButton(btnOk);
 			addButton(btnCancel);
 
@@ -1095,10 +1089,9 @@
 			checkTarget();
 			checkIds();
 		}
-		
+
 		/**
-		 * in  : chStyle.selectedIndex;
-		 * out : chosenStyle
+		 * in : chStyle.selectedIndex; out : chosenStyle
 		 */
 		private void checkStyle() {
 			if (chStyle.selectedIndex == 2) { // my finds export
@@ -1127,7 +1120,7 @@
 				cbAttrib2Log.state = false;
 				if (cbAttrib2Log.change(ControlConstants.Disabled, 0))
 					cbAttrib2Log.repaint();
-				
+
 				cbSeperateHints.state = false;
 				if (cbSeperateHints.change(ControlConstants.Disabled, 0))
 					cbSeperateHints.repaint();
@@ -1153,7 +1146,7 @@
 
 				if (cbAttrib2Log.change(0, ControlConstants.Disabled))
 					cbAttrib2Log.repaint();
-				
+
 				cbSeperateHints.state = false;
 				if (cbSeperateHints.change(ControlConstants.Disabled, 0))
 					cbSeperateHints.repaint();
@@ -1178,7 +1171,7 @@
 
 				if (cbAttrib2Log.change(ControlConstants.Disabled, 0))
 					cbAttrib2Log.repaint();
-		
+
 				cbSeperateHints.state = false;
 				if (cbSeperateHints.change(ControlConstants.Disabled, 0))
 					cbSeperateHints.repaint();
@@ -1192,8 +1185,7 @@
 		}
 
 		/**
-		 * in : chTarget.selectedIndex
-		 * out: chosenTarget
+		 * in : chTarget.selectedIndex out: chosenTarget
 		 */
 		private void checkTarget() {
 			if (chTarget.selectedIndex == 2) { // POI
@@ -1230,7 +1222,7 @@
 				if (hasGarminMapFrm && cbCustomIcons.change(0, ControlConstants.Disabled))
 					cbCustomIcons.repaint();
 
-				cbSeperateHints.state=false;
+				cbSeperateHints.state = false;
 				if (cbSeperateHints.change(ControlConstants.Disabled, 0))
 					cbSeperateHints.repaint();
 
@@ -1247,10 +1239,10 @@
 			chosenTarget = chTarget.selectedIndex;
 			chosenIds = chIds.selectedIndex;
 		}
-		
+
 		/**
-		 * react to GUI events and toogle access to the checkboxes according to
-		 * radio button settings pass everything else to <code>super()</code>
+		 * react to GUI events and toogle access to the checkboxes according to radio button settings pass everything
+		 * else to <code>super()</code>
 		 */
 		public void onEvent(Event ev) {
 			if (ev instanceof DataChangeEvent && ev.type == DataChangeEvent.DATA_CHANGED) {
@@ -1294,14 +1286,16 @@
 
 		/**
 		 * amount of data to be exported
+		 * 
 		 * @return 0 Compact, 1 PQ like, 2 MyFinds
 		 */
-		private int getExportStyle () {
+		private int getExportStyle() {
 			return chosenStyle;
 		}
 
 		/**
 		 * style of waypoint identifiers
+		 * 
 		 * @return 0 Classic IDs, 1 Smart IDs, 3 Smart Names (should only be used with gpsbabel)
 		 */
 		private int getWpNameStyle() {
@@ -1310,6 +1304,7 @@
 
 		/**
 		 * what kind of output should be generated
+		 * 
 		 * @return 0 single file, 1 separate files, 2 POI (GPI) files
 		 */
 		private int getOutputTarget() {
@@ -1318,7 +1313,7 @@
 
 		/**
 		 * check if user wants to send output straight to a Garmin GPSr
-		 *
+		 * 
 		 * @return true for GPSr transfer, false otherwise
 		 */
 		private boolean getSendToGarmin() {
@@ -1327,7 +1322,7 @@
 
 		/**
 		 * check if user wants custom icons
-		 *
+		 * 
 		 * @return true if user wants custom icons, false otherwise
 		 */
 		private boolean getCustomIcons() {
@@ -1336,7 +1331,7 @@
 
 		/**
 		 * get the number of logs to export. used in PQlike export.
-		 *
+		 * 
 		 * @return number of logs to export
 		 */
 		private int getMaxLogs() {
@@ -1345,19 +1340,19 @@
 
 		/**
 		 * get prefix for separate file export
-		 *
+		 * 
 		 * @return prefix for separate file export
 		 */
 		private String getPrefix() {
 			return ibPrefix.getText();
 		}
-		
+
 		/**
 		 * check if user wants to export attributes as log
 		 * 
 		 * @return true if attributes should exported as log, false otherwise
 		 */
-		private boolean getAttrib2Log (){
+		private boolean getAttrib2Log() {
 			return cbAttrib2Log.state;
 		}
 	}

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-06-15 20:53:01 UTC (rev 3027)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-06-16 20:35:47 UTC (rev 3028)
@@ -1008,7 +1008,7 @@
 
 	/**
 	 * Method to spider a single cache. It assumes a login has already been performed!
-	 * 
+	 *
 	 * @return 1 if spider was successful, -1 if spider was cancelled by closing the infobox, 0 error, but continue with
 	 *         next cache
 	 */
@@ -1055,7 +1055,7 @@
 
 	/**
 	 * Fetch the coordinates of a waypoint from GC
-	 * 
+	 *
 	 * @param wayPoint
 	 *            the name of the waypoint
 	 * @return the cache coordinates
@@ -1100,13 +1100,13 @@
 			if (loggedIn)
 				return true;
 			else {
-				(new MessageBox("Login", "Check UserID in preferences | Einstellungen.", FormBase.OKB)).execute();
+				(new MessageBox("Login", "Check UserID in preferences | Einstellungen.\nsee http://cachewolf.aldos.de/userid.html", FormBase.OKB)).execute();
 				return false;
 			}
 		} else {
 			UrlFetcher.setPermanentRequestorProperty("Cookie", null);
 			if (true) {
-				(new MessageBox("Login", "Check UserID in preferences| Einstellungen.", FormBase.OKB)).execute();
+				(new MessageBox("Login", "Check UserID in preferences| Einstellungen.\nsee http://cachewolf.aldos.de/userid.html", FormBase.OKB)).execute();
 				return false; // until SSL/https works
 			}
 		}
@@ -1341,7 +1341,7 @@
 	}
 
 	/*
-	 * 
+	 *
 	 */
 	private void initialiseProperties() {
 		try {
@@ -1384,7 +1384,7 @@
 	}
 
 	/*
-	 * 
+	 *
 	 */
 	private void getFirstListPage(int distance) {
 		// Get first page
@@ -1747,7 +1747,7 @@
 
 	/**
 	 * check if new Update exists
-	 * 
+	 *
 	 * @param ch
 	 *            CacheHolder
 	 * @param CacheDescription
@@ -1832,7 +1832,7 @@
 
 	/**
 	 * Get num found
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return numFound
@@ -1952,7 +1952,7 @@
 
 	/**
 	 * Get the waypoint name
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return Name of waypoint to add to list
@@ -2177,9 +2177,9 @@
 
 	/*
 	 * @param CacheHolder ch
-	 * 
+	 *
 	 * @param String cacheDescGC
-	 * 
+	 *
 	 * @return boolean newLogExists
 	 */
 	private boolean newFoundExists(CacheHolder ch, String cacheDescription) {
@@ -2221,9 +2221,9 @@
 	 * Read a complete cachepage from geocaching.com including all logs. This is used both when updating already
 	 * existing caches (via spiderSingle) and when spidering around a centre. It is also used when reading a GPX file
 	 * and fetching the images.
-	 * 
+	 *
 	 * This is the workhorse function of the spider.
-	 * 
+	 *
 	 * @param CacheHolderDetail
 	 *            chD The element wayPoint must be set to the name of a waypoint
 	 * @param boolean
@@ -2429,7 +2429,7 @@
 
 	/**
 	 * Get the coordinates of the cache
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return Cache coordinates
@@ -2448,7 +2448,7 @@
 
 	/**
 	 * Get the long description
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return the long description
@@ -2483,7 +2483,7 @@
 
 	/**
 	 * Get the cache location (country and state)
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return the location (country and state) of the cache
@@ -2500,7 +2500,7 @@
 
 	/**
 	 * Get the cache name
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return the name of the cache
@@ -2517,7 +2517,7 @@
 
 	/**
 	 * Get the cache owner
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return the cache owner
@@ -2534,7 +2534,7 @@
 
 	/**
 	 * Get the date when the cache was hidden
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return Hidden date
@@ -2551,7 +2551,7 @@
 
 	/**
 	 * Get the hints
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return Cachehints
@@ -2568,7 +2568,7 @@
 
 	/**
 	 * Get the cache size
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return Cache size
@@ -2586,7 +2586,7 @@
 
 	/**
 	 * Get the Difficulty
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return The cache difficulty
@@ -2604,7 +2604,7 @@
 
 	/**
 	 * Get the terrain rating
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return Terrain rating
@@ -2622,7 +2622,7 @@
 
 	/**
 	 * Get the waypoint type
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @return the waypoint type (Tradi, Multi, etc.)
@@ -2639,7 +2639,7 @@
 
 	/**
 	 * Get the logs
-	 * 
+	 *
 	 * @param doc
 	 *            A previously fetched cachepage
 	 * @param chD
@@ -2706,7 +2706,7 @@
 
 	/**
 	 * This methods cleans up the path for inlined smilies in logtexts.
-	 * 
+	 *
 	 * @param logText
 	 * @return
 	 */
@@ -2724,7 +2724,7 @@
 	/**
 	 * Read the travelbug names from a previously fetched Cache page and then read the travelbug purpose for each
 	 * travelbug
-	 * 
+	 *
 	 * @param doc
 	 *            The previously fetched cachepage
 	 * @return A HTML formatted string with bug names and there purpose
@@ -2778,7 +2778,7 @@
 	/**
 	 * Get the images for a previously fetched cache page. Images are extracted from two areas: The long description and
 	 * the pictures section (including the spoiler)
-	 * 
+	 *
 	 * @param doc
 	 *            The previously fetched cachepage
 	 * @param chD
@@ -2965,7 +2965,7 @@
 
 	/**
 	 * Read an image from the server
-	 * 
+	 *
 	 * @param imgUrl
 	 *            The Url of the image
 	 * @param target
@@ -2987,7 +2987,7 @@
 
 	/**
 	 * Read all additional waypoints from a previously fetched cachepage.
-	 * 
+	 *
 	 * @param doc
 	 *            The previously fetched cachepage
 	 * @param wayPoint
@@ -3122,7 +3122,7 @@
 	 * Load the bug id for a given name. This method is not ideal, as there are sometimes several bugs with identical
 	 * names but different IDs. Normally the bug GUID is used which can be obtained from the cache page.<br>
 	 * Note that each bug has both an ID and a GUID.
-	 * 
+	 *
 	 * @param name
 	 *            The name (or partial name) of a travelbug
 	 * @return the id of the bug
@@ -3158,7 +3158,7 @@
 	/**
 	 * Fetch a bug's mission for a given GUID or ID. If the guid String is longer than 10 characters it is assumed to be
 	 * a GUID, otherwise it is an ID.
-	 * 
+	 *
 	 * @param guid
 	 *            the guid or id of the travelbug
 	 * @return The mission
@@ -3191,7 +3191,7 @@
 
 	/**
 	 * Fetch a bug's mission for a given tracking number
-	 * 
+	 *
 	 * @param trackNr
 	 *            the tracking number of the travelbug
 	 * @return The mission
@@ -3223,7 +3223,7 @@
 
 	/**
 	 * Fetch a bug's mission and namefor a given tracking number
-	 * 
+	 *
 	 * @param TB
 	 *            the travelbug
 	 * @return true if suceeded
@@ -3270,7 +3270,7 @@
 
 		/**
 		 * Gets an entry in spider.def by its key (tag)
-		 * 
+		 *
 		 * @param key
 		 *            The key which is attributed to a specific entry
 		 * @return The value for the key



From araber95 at mail.berlios.de  Fri Jun 17 12:12:02 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 17 Jun 2011 12:12:02 AM +0200
Subject: [Cachewolf-svn] r3029 - trunk/src/CacheWolf
Message-ID: <20110616221202.6AD68481297@sheep.berlios.de>

Author: araber95
Date: 2011-06-17 00:12:02 +0200 (Fri, 17 Jun 2011)
New Revision: 3029

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
readding radar

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2011-06-16 20:35:47 UTC (rev 3028)
+++ trunk/src/CacheWolf/MainTab.java	2011-06-16 22:12:02 UTC (rev 3029)
@@ -149,7 +149,7 @@
 		MAP_CARD = this.cardPanel.cards.size() - 1;
 		c.iconize(new Image("globe_small" + imagesize + ".gif"), true);
 
-		if (pref.useBigIcons) {
+		if (pref.isBigScreen) {
 			c = this.addCard(radarP, "Radar", null);
 			RADAR_CARD = this.cardPanel.cards.size() - 1;
 			radarP.setMainTab(this);



From araber95 at mail.berlios.de  Tue Jun 21 04:51:39 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 21 Jun 2011 04:51:39 PM +0200
Subject: [Cachewolf-svn] r3030 - trunk/src/CacheWolf
Message-ID: <20110621145140.3DA86481275@sheep.berlios.de>

Author: araber95
Date: 2011-06-21 16:51:39 +0200 (Tue, 21 Jun 2011)
New Revision: 3030

Modified:
   trunk/src/CacheWolf/OC.java
Log:
adding the new OC sites

Modified: trunk/src/CacheWolf/OC.java
===================================================================
--- trunk/src/CacheWolf/OC.java	2011-06-16 22:12:02 UTC (rev 3029)
+++ trunk/src/CacheWolf/OC.java	2011-06-21 14:51:39 UTC (rev 3030)
@@ -25,7 +25,6 @@
  */
 package CacheWolf;
 
-
 public final class OC {
 
 	/** thou shallst not instantiate this object */
@@ -35,8 +34,19 @@
 
 	public final static int OC_HOSTNAME = 0;
 	public final static int OC_PREFIX = 1;
-	public final static String[][] OCSites = { { "www.opencaching.de", "OC" }, { "www.opencaching.pl", "OP" }, { "www.opencaching.cz", "OZ" }, { "www.opencaching.org.uk", "OK" }, { "www.opencaching.se", "OS" }, { "www.opencaching.no", "ON" },
-			{ "www.opencaching.us", "OU" } };
+	public final static String[][] OCSites = {//
+	{ "www.opencaching.de", "OC" },// 1
+			{ "www.opencaching.pl", "OP" },// 2
+			{ "www.opencaching.cz", "OZ" },// 3
+			{ "www.opencaching.org.uk", "OK" },// 4
+			{ "www.opencaching.se", "OS" },// 5
+			{ "www.opencaching.no", "ON" },// 6
+			{ "www.opencaching.us", "OU" },// 7
+			{ "www.opencachingspain.es", "OC" },// 8 !!!
+			{ "www.opencaching.it", "OC" },// 9 !!!
+			{ "www.opencaching.jp", "OJ" },// 10
+			{ "www.opencaching.nl", "OB" },// 11
+	};
 
 	public final static String[] OCHostNames() {
 		String[] ret = new String[OCSites.length];



From araber95 at mail.berlios.de  Fri Jun 24 06:04:05 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 24 Jun 2011 06:04:05 PM +0200
Subject: [Cachewolf-svn] r3031 - in trunk: res_noewe/templates
	src/CacheWolf/exp
Message-ID: <20110624160405.7885D48293F@sheep.berlios.de>

Author: araber95
Date: 2011-06-24 18:04:04 +0200 (Fri, 24 Jun 2011)
New Revision: 3031

Added:
   trunk/res_noewe/templates/Parking.tpl
Modified:
   trunk/res_noewe/templates/Short documentation for the export via templates.htm
   trunk/src/CacheWolf/exp/TPLExporter.java
Log:
expanding the TPLExporter with selection "parking" and an example templates/Parking.tpl for loc file generation.

Added: trunk/res_noewe/templates/Parking.tpl
===================================================================
--- trunk/res_noewe/templates/Parking.tpl	                        (rev 0)
+++ trunk/res_noewe/templates/Parking.tpl	2011-06-24 16:04:04 UTC (rev 3031)
@@ -0,0 +1,14 @@
+???<tmpl_par name="decsep" value=".">
+<tmpl_par name="Out" value="*.loc">
+<tmpl_par name="charset" value="UTF8">
+<tmpl_par name="newline" value="CRLF">
+<tmpl_par name="takeOnlyWp" value="parking">
+<?xml version="1.0"?><loc version="1.0" src="EasyGPS"><br/>
+<tmpl_loop cache_index>
+<waypoint><br/>
+   <name id="<tmpl_var WAYPOINT>"><![CDATA[<tmpl_var NAME>]]></name><br/>
+   <coord lat="<tmpl_var LAT>" lon="<tmpl_var LON>"/><br/>
+   <type><tmpl_var GMTYPE></type><br/>
+</waypoint><br/>
+</tmpl_loop>
+</loc><br/>

Modified: trunk/res_noewe/templates/Short documentation for the export via templates.htm
===================================================================
--- trunk/res_noewe/templates/Short documentation for the export via templates.htm	2011-06-21 14:51:39 UTC (rev 3030)
+++ trunk/res_noewe/templates/Short documentation for the export via templates.htm	2011-06-24 16:04:04 UTC (rev 3031)
@@ -43,7 +43,7 @@
 	mso-font-charset:0;
 	mso-generic-font-family:swiss;
 	mso-font-pitch:variable;
-	mso-font-signature:-520078593 -1073717157 41 0 66047 0;}
+	mso-font-signature:-520077569 -1073717157 41 0 66047 0;}
  /* Style Definitions */
  p.MsoNormal, li.MsoNormal, div.MsoNormal
 	{mso-style-parent:"";
@@ -77,9 +77,6 @@
 span.SpellE
 	{mso-style-name:"";
 	mso-spl-e:yes;}
-span.GramE
-	{mso-style-name:"";
-	mso-gram-e:yes;}
 @page Section1
 	{size:595.3pt 841.9pt;
 	margin:70.85pt 70.85pt 2.0cm 70.85pt;
@@ -165,80 +162,71 @@
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>&lt;#--
-<span class=SpellE>TomTom</span> ASC or POI --&gt;<span style='mso-tab-count:
-5'>??????????????????????????????????????????????????? </span>Anything between
-&quot;&lt;#--&quot; and &quot;--&gt;&quot; is handled as a comment</span><span
+TomTom ASC or POI --&gt;<span style='mso-tab-count:5'>??????????????????????????????????????????????????? </span>Anything
+between &quot;&lt;#--&quot; and &quot;--&gt;&quot; is handled as a comment</span><span
 lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>Configuration
 section </span></u><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span
-class=SpellE>NameOfParameter</span>&quot; value=&quot;<span class=SpellE>ValueOfParameter</span>&quot;&gt;</span><span
-lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
+mso-ansi-language:EN-GB'>&lt;tmpl_par name=&quot;NameOfParameter&quot;
+value=&quot;ValueOfParameter&quot;&gt;</span><span lang=EN-GB style='mso-ansi-language:
+EN-GB'><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>&lt;<span
-class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>charset</span>&quot;
-value=&quot;ASCII&quot;&gt;<span style='mso-tab-count:3'>??????????????????????????????? </span><span
-class=SpellE>Charsets</span>: &nbsp;values ASCII or UTF8 or UNICODE<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>badchars</span>&quot;
-value=&quot;,&quot;&gt;<span style='mso-tab-count:4'>???????????????????????????????????? </span><span
-class=SpellE><span class=GramE>BadChars</span></span><span class=GramE> :</span>
-These chars are removed from the <span class=SpellE>cachename</span>, hints and
-notes. <br>
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>&lt;tmpl_par
+name=&quot;charset&quot; value=&quot;ASCII&quot;&gt;<span style='mso-tab-count:
+3'>??????????????????????????????? </span>Charsets: &nbsp;values ASCII or UTF8
+or UNICODE<br>
+&lt;tmpl_par name=&quot;badchars&quot; value=&quot;,&quot;&gt;<span
+style='mso-tab-count:4'>???????????????????????????????????? </span>BadChars :
+These chars are removed from the cachename, hints and notes. <br>
 <span style='mso-spacerun:yes'>?</span><span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????????? </span>for
-example the value=&quot;,&quot; if ',' is used as a separator. <span
-class=GramE>Regular expressions possible.</span><br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>newline</span>&quot;
-value=&quot;CRLF&quot;&gt;<span style='mso-tab-count:3'>??????????????????????????????? </span><span
-class=SpellE><span class=GramE>Newline</span></span><span class=GramE> :</span>
-values are CR, LF or CRLF . These defines, what should be used for replacing<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>decsep</span>&quot;
-value=&quot;,&quot;&gt;<span style='mso-tab-count:4'>??????????????????????????????????????? </span>Decimal
+example the value=&quot;,&quot; if ',' is used as a separator. Regular
+expressions possible.<br>
+&lt;tmpl_par name=&quot;newline&quot; value=&quot;CRLF&quot;&gt;<span
+style='mso-tab-count:3'>??????????????????????????????? </span>Newline : values
+are CR, LF or CRLF . These defines, what should be used for replacing<br>
+&lt;tmpl_par name=&quot;decsep&quot; value=&quot;,&quot;&gt;<span
+style='mso-tab-count:4'>??????????????????????????????????????? </span>Decimal
 separator : Defines, which decimal separator is used , values &quot;.&quot; or ','<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>ShortNameLength</span>&quot;
-value=&quot;30&quot;&gt;<span style='mso-tab-count:2'>????????????????????? </span>Number
-of characters for Variable SHORTNAME <br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>WaypointLength</span>&quot;
-value=&quot;3&quot;&gt;<span style='mso-tab-count:3'>????????????????????????? </span>Number
-of characters for Variable SHORTWAYPOINT<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;Out&quot; value=&quot;.<span
-class=SpellE>gpx</span>&quot;&gt;<span style='mso-tab-count:4'>??????????????????????????????????????? </span>Output
+&lt;tmpl_par name=&quot;ShortNameLength&quot; value=&quot;30&quot;&gt;<span
+style='mso-tab-count:2'>????????????????????? </span>Number of characters for
+Variable SHORTNAME <br>
+&lt;tmpl_par name=&quot;WaypointLength&quot; value=&quot;3&quot;&gt;<span
+style='mso-tab-count:3'>????????????????????????? </span>Number of characters
+for Variable SHORTWAYPOINT<br>
+&lt;tmpl_par name=&quot;Out&quot; value=&quot;.gpx&quot;&gt;<span
+style='mso-tab-count:4'>??????????????????????????????????????? </span>Output
 Filename or Extension<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>NrLogs</span>&quot;
-value=&quot;-1&quot;&gt;<span style='mso-tab-count:4'>????????????????????????????????????? </span><span
-class=SpellE>Anzahl</span> logs (-1 = alle)<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>singleFile</span>&quot;
-value=&quot;yes&quot;&gt;<span style='mso-tab-count:3'>??????????????????????????????? </span>one
-<span class=SpellE>outputfile</span> value=?yes? or one file per cache
-value=?no? (use a dummy / not existing name for Out par)<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>formatModifier</span>&quot;
-value=&quot;0&quot;&gt;<span style='mso-tab-count:3'>???????????????????????????? </span>0
-is xml as <span class=SpellE>gpx</span> generation before, 1 is html for local
-use 2 is html for export use<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>takeOnlyWp</span>&quot;
-value=&quot;all&quot;&gt;<span style='mso-tab-count:3'>????????????????????????????? </span>process
-only this <span class=SpellE>Cachetypegroups</span> value is either ?main? or ?<span
-class=SpellE>addi</span>? else both (here all = default ) is assumed<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>CopyCacheImages</span>&quot;
-value=&quot;yes&quot;&gt;<span style='mso-tab-count:2'>?????????????????? </span><span
-class=SpellE>CacheImages</span> are copied to the output directory (copy <span
-class=SpellE>attribs</span> and icons manually, they are fix)<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>inputEingabe</span>&quot;
-value=&quot;default&quot;&gt;<span style='mso-tab-count:2'>?????????????????????? </span>calls
-input with a ?default? value and makes a <span class=SpellE>tmpl_var</span>
-with the name <span class=SpellE>Eingabe</span> (<span class=SpellE>Eingabe</span>
-is placeholder) (!<span class=SpellE>dont</span> use umlauts in defaults)<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>constKonstante</span>&quot;
-value=&quot;value&quot;&gt;<span style='mso-tab-count:2'>???????????????????? </span>sets
-a <span class=SpellE>tmpl_var</span> with the name <span class=SpellE>Konstante</span>
-(<span class=SpellE>Konstante</span> is placeholder) (!<span class=SpellE>dont</span>
-use umlauts in value)<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>sortedBy</span>&quot;
-value=&quot;-1&quot;&gt;<span style='mso-tab-count:3'>??????????????????????????????????? </span>sets
-a <span class=SpellE>tmpl_var</span> with the name <span class=SpellE>sortedBy</span>:
-values are 1..19. (4=Waypoint,5=Name,9=Status,10=Distance? see myComparer.java)<o:p></o:p></span></p>
+&lt;tmpl_par name=&quot;NrLogs&quot; value=&quot;-1&quot;&gt;<span
+style='mso-tab-count:4'>????????????????????????????????????? </span>Anzahl
+logs (-1 = alle)<br>
+&lt;tmpl_par name=&quot;singleFile&quot; value=&quot;yes&quot;&gt;<span
+style='mso-tab-count:3'>??????????????????????????????? </span>one outputfile
+value=?yes? or one file per cache value=?no? (use a dummy / not existing name
+for Out par)<br>
+&lt;tmpl_par name=&quot;formatModifier&quot; value=&quot;0&quot;&gt;<span
+style='mso-tab-count:3'>???????????????????????????? </span>0 is xml as gpx
+generation before, 1 is html for local use 2 is html for export use<br>
+&lt;tmpl_par name=&quot;takeOnlyWp&quot; value=&quot;all&quot;&gt;<span
+style='mso-tab-count:3'>????????????????????????????? </span>process only this
+Cachetypegroups value is either ?main? or ?addi? or ?parking? else all (here
+all = default ) is assumed<br>
+&lt;tmpl_par name=&quot;CopyCacheImages&quot; value=&quot;yes&quot;&gt;<span
+style='mso-tab-count:2'>?????????????????? </span>CacheImages are copied to the
+output directory (copy attribs and icons manually, they are fix)<br>
+&lt;tmpl_par name=&quot;inputEingabe&quot; value=&quot;default&quot;&gt;<span
+style='mso-tab-count:2'>?????????????????????? </span>calls input with a
+?default? value and makes a tmpl_var with the name Eingabe (Eingabe is
+placeholder) (!dont use umlauts in defaults)<br>
+&lt;tmpl_par name=&quot;constKonstante&quot; value=&quot;value&quot;&gt;<span
+style='mso-tab-count:2'>???????????????????? </span>sets a tmpl_var with the
+name Konstante (Konstante is placeholder) (!dont use umlauts in value)<br>
+&lt;tmpl_par name=&quot;sortedBy&quot; value=&quot;-1&quot;&gt;<span
+style='mso-tab-count:3'>??????????????????????????????????? </span>sets a
+tmpl_var with the name sortedBy: values are 1..19.
+(4=Waypoint,5=Name,9=Status,10=Distance? see myComparer.java)<o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>Output
@@ -247,23 +235,20 @@
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>Anything
 (except comments and variables) is written to the output file.<br>
-The <span class=SpellE>cachedata</span> <span class=SpellE><span class=GramE>ist</span></span>
-placed between &lt;<span class=SpellE>tmpl_loop</span> <span class=SpellE>cache_index</span>&gt;
-and &lt;/<span class=SpellE>tmpl_loop</span>&gt;. <br>
-Variables defined like this: &lt;<span class=SpellE>tmpl_var</span>
-name=LON&gt;. <br>
-At the end of the line &lt;<span class=SpellE>br</span> /&gt; has to be placed,
-this is replaced by CR.<o:p></o:p></span></p>
+The cachedata ist placed between &lt;tmpl_loop cache_index&gt; and
+&lt;/tmpl_loop&gt;. <br>
+Variables defined like this: &lt;tmpl_var name=LON&gt;. <br>
+At the end of the line &lt;br /&gt; has to be placed, this is replaced by CR.<o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>Variables
-&lt;<span class=SpellE>tmpl_var</span> <span class=SpellE>NameOfVariable</span>&gt;</span></u><u><span
-lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
+&lt;tmpl_var NameOfVariable&gt;</span></u><u><span lang=EN-GB style='mso-ansi-language:
+EN-GB'><o:p></o:p></span></u></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>PROGDIR<span
 style='mso-tab-count:8'>?????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>FileBase.getProgramDirectory</span>()<br>
+FileBase.getProgramDirectory()<br>
 PROFILDIR<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????? </span>:<span
 style='mso-tab-count:6'>????????????????????????????????????????????????????????????????????? </span><span
 style='mso-tab-count:2'>??????????????????????? </span>: <br>
@@ -271,13 +256,12 @@
 TYPE<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 &lt;type&gt; Type of cache, e.g. Regular, Multi<br>
 TYPENO<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????????? </span>:
-&lt;type&gt; as number string (see <span class=SpellE>CacheType.java</span> <span
-class=SpellE>e.g</span> : 0=Custom , 2=<span class=SpellE>Tradi</span>
+&lt;type&gt; as number string (see CacheType.java e.g : 0=Custom , 2=Tradi
 ,50=Parking 104=Earth)<br>
 SYM<span style='mso-tab-count:9'>?????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 &lt;sym&gt;<br>
 GSTYPE<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????????? </span>:
-&lt;<span class=SpellE>groundspeak:type</span>&gt;<br>
+&lt;groundspeak:type&gt;<br>
 SHORTTYPE<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????? </span>:
 First Letter of &lt;type&gt; ???<br>
 SIZE<span style='mso-tab-count:9'>?????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
@@ -286,57 +270,49 @@
 First letter of size<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Helvetica;
 mso-ansi-language:EN-GB'>MAINWP<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????????? </span>:
-?? if is <span class=SpellE>Mainwaypoint</span>, <span class=SpellE>Mainwaypoint</span>
-if is <span class=SpellE>Addi</span> Waypoint<br>
+?? if is Mainwaypoint, Mainwaypoint if is Addi Waypoint<br>
 MAINWPNAME<span style='mso-tab-count:8'>?????????????????????????????????????????????????????????????????????????????????? </span>:
-?? if is <span class=SpellE>Mainwaypoint</span>, <span class=SpellE>Mainwaypoint</span>
-name if is <span class=SpellE>Addi</span> Waypoint<br>
+?? if is Mainwaypoint, Mainwaypoint name if is Addi Waypoint<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:
 EN-GB'>WAYPOINT<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????? </span>:
 &lt;name&gt; GCXXXX, OCXXXX<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Helvetica;
 mso-ansi-language:EN-GB'>SHORTWAYPOINT<span style='mso-tab-count:7'>????????????????????????????????????????????????????????????????????????????? </span>:
-</span><span class=SpellE><span lang=EN-GB style='font-size:10.0pt;font-family:
-Arial;mso-ansi-language:EN-GB'>ShortNameLength</span></span><span lang=EN-GB
-style='font-size:10.0pt;font-family:Helvetica;mso-ansi-language:EN-GB'> <span
-class=SpellE>Zeichen</span> des Waypoints (<span class=SpellE>f?r</span> <span
-class=SpellE>Benutzer</span> alter <span class=SpellE>Ger?te</span> <span
-class=SpellE>mit</span> <span class=SpellE>nur</span> 6 <span class=SpellE>Waypointzeichen</span>,
-<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:
+EN-GB'>ShortNameLength</span><span lang=EN-GB style='font-size:10.0pt;
+font-family:Helvetica;mso-ansi-language:EN-GB'> Zeichen des Waypoints (f?r
+Benutzer alter Ger?te mit nur 6 Waypointzeichen, <br>
+</span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:
 EN-GB'>OWNER<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>Cacheowner</span><br>
+Cacheowner<br>
 DIFFICULTY<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????? </span>:<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Helvetica;
 mso-ansi-language:EN-GB'>SHORTDIFFICULTY<span style='mso-tab-count:7'>???????????????????????????????????????????????????????????????????????????? </span>:
-Difficulty mal 10 also 15 <span class=SpellE>statt</span> 1.5<br>
+Difficulty mal 10 also 15 statt 1.5<br>
 SHDIFFICULTY<span style='mso-tab-count:8'>?????????????????????????????????????????????????????????????????????????????????? </span>:
-Difficulty <span class=SpellE>abgerundet</span> also 1 <span class=SpellE>statt</span>
-1.5<br>
+Difficulty abgerundet also 1 statt 1.5<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:
 EN-GB'>TERRAIN<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????????? </span>:<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Helvetica;
 mso-ansi-language:EN-GB'>SHORTTERRAIN<span style='mso-tab-count:7'>???????????????????????????????????????????????????????????????????????????????? </span>:
 Terrain mal 10<br>
 SHTERRAIN<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????? </span>:
-Terrain <span class=SpellE>abgerundet</span><br>
+Terrain abgerundet<br>
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:
 EN-GB'>DISTANCE<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Distance calculated in <span class=SpellE>cachelist</span><br>
+Distance calculated in cachelist<br>
 BEARING<span style='mso-tab-count:8'>?????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Bearing calculated in <span class=SpellE>cachelist</span><br>
+Bearing calculated in cachelist<br>
 LATLON<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 Coordinates in long format, e.g. N 50? 31.234 E 008? 45.267<br>
 LAT<span style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-&lt;<span class=SpellE>wpt</span> lat=?<span class=SpellE>xx.yyyy</span>?
-??..&gt; Latitude in decimal format, e.g. 50.20147<br>
+&lt;wpt lat=?xx.yyyy? ??..&gt; Latitude in decimal format, e.g. 50.20147<br>
 LON<span style='mso-tab-count:9'>?????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-&lt;<span class=SpellE>wpt</span> ?? <span class=SpellE>lon</span>=?<span
-class=SpellE>xx.yyyy</span>? &gt; Longitude in decimal format, e.g. 008.58132<br>
+&lt;wpt ?? lon=?xx.yyyy? &gt; Longitude in decimal format, e.g. 008.58132<br>
 STATUS<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????????? </span>:<span
 style='mso-spacerun:yes'>? </span>means found<br>
 GC_LOGTYPE<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????? </span>:
-the English Status texts (for <span class=SpellE>gpx</span> ? export)<br>
+the English Status texts (for gpx ? export)<br>
 STATUS_DATE<span style='mso-tab-count:8'>?????????????????????????????????????????????????????????????????????????????????? </span>:
 Get the date part of the status <br>
 STATUS_TIME<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????? </span>:
@@ -346,44 +322,30 @@
 CACHE_NAME<span style='mso-tab-count:8'>?????????????????????????????????????????????????????????????????????????????????? </span>:
 original Name of cache<br>
 NAME<span style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Name of cache (<span class=SpellE>badchars</span> are removed, see below) (<span
-class=SpellE>neuerdings</span> <span class=SpellE>bei</span> ASCII <span
-class=SpellE>Simplifizierung</span> von <span class=SpellE>Zeichen</span>)<br>
+Name of cache (badchars are removed, see below) (neuerdings bei ASCII
+Simplifizierung von Zeichen)<br>
 SHORTNAME<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????? </span>:
 </span><span lang=EN-GB style='font-size:10.0pt;font-family:Helvetica;
-mso-ansi-language:EN-GB'>Name <span class=SpellE>der</span> <span class=SpellE>durch</span>
-<span class=SpellE>Weglassen</span> von <span class=SpellE>Vokalen</span> von <span
-class=SpellE>hinten</span> und <span class=SpellE>wenn</span> <span
-class=SpellE>das</span> <span class=SpellE>nicht</span> <span class=SpellE>reicht</span>
-<span class=SpellE>durch</span> <span class=SpellE>Weglassen</span> von<span
-style='mso-spacerun:yes'>???? </span><span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????????? </span><span
+mso-ansi-language:EN-GB'>Name der durch Weglassen von Vokalen von hinten und
+wenn das nicht reicht durch Weglassen von<span style='mso-spacerun:yes'>????
+</span><span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????????? </span><span
 style='mso-tab-count:5'>?????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>Kleinbuchstaben</span> von <span class=SpellE>hinten</span>
-auf <span class=SpellE>eine</span> in den <span class=SpellE>Einstellungen</span>
-<span class=SpellE>vorgegebene</span> <span class=SpellE>L?nge</span> <span
-class=SpellE>gek?rzt</span> <span class=SpellE>wird</span>. <br>
+Kleinbuchstaben von hinten auf eine in den Einstellungen vorgegebene L?nge
+gek?rzt wird. <br>
 <span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-(<span class=SpellE>Hintergrund</span>: <span class=SpellE>das</span> Notes -<span
-class=SpellE>Feld</span> <span class=SpellE>der</span> <span class=SpellE>meisten</span>
-<span class=SpellE>Garmins</span> <span class=SpellE>kann</span> <span
-class=SpellE>nur</span> 30 <span class=SpellE>Buchstaben</span>)<br>
+(Hintergrund: das Notes -Feld der meisten Garmins kann nur 30 Buchstaben)<br>
 <span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>dann</span> <span class=SpellE>kriegen</span> <span
-class=SpellE>sie</span> <span class=SpellE>noch</span> <span class=SpellE>Infos</span>
-<span class=SpellE>wie</span> Difficulty etc. rein)<br>
+dann kriegen sie noch Infos wie Difficulty etc. rein)<br>
 CACHEID<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????????? </span>:<br>
 ARCHIVED<span style='mso-tab-count:4'>????????????????????????????????????????? </span><span
 style='mso-tab-count:4'>?????????????????????????????????????????????? </span>:<br>
 AVAILABLE<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????? </span>:
 <br>
 TRAVELBUG<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????? </span>:
-Y or N <span class=SpellE>f?r</span> <span class=SpellE>Anwesenheit/Abwesenheit</span>
-von <span class=SpellE>TBs</span> <span class=SpellE>im</span> Cache&nbsp;<br>
+Y or N f?r Anwesenheit/Abwesenheit von TBs im Cache&nbsp;<br>
 GMTYPE<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Type <span class=SpellE>aus</span> <span class=SpellE>der</span> <span
-class=SpellE>Garminmap.xml</span>, also <span class=SpellE>z.B</span>. Custom
-1, <span class=SpellE>zur</span> <span class=SpellE>Verwendung</span> <span
-class=SpellE>der</span> <span class=SpellE>Benutzerdefinierten</span> Icons<br>
+Type aus der Garminmap.xml, also z.B. Custom 1, zur Verwendung der
+Benutzerdefinierten Icons<br>
 NOW</span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
 mso-ansi-language:EN-GB'>_DATE<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????? </span>:
 Get the date part of now<br>
@@ -393,47 +355,42 @@
 DESCRIPTION<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????? </span>:
 Cache Description (possibly in HTML Format)<br>
 NOTES<span style='mso-tab-count:9'>?????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-User Notes&nbsp;&nbsp; (<span class=SpellE>badchars</span> are removed, see
-below)<br>
+User Notes&nbsp;&nbsp; (badchars are removed, see below)<br>
 HINTS<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Encrypted hints&nbsp;&nbsp; (<span class=SpellE>badchars</span> are removed,
-see below)<br>
+Encrypted hints&nbsp;&nbsp; (badchars are removed, see below)<br>
 DECRYPTEDHINTS<span style='mso-tab-count:7'>???????????????????????????????????????????????????????????????????????????? </span>:
-Decrypted hints&nbsp;&nbsp;&nbsp; (<span class=SpellE>badchars</span> are
-removed, see below) <br>
+Decrypted hints&nbsp;&nbsp;&nbsp; (badchars are removed, see below) <br>
 BUGS<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>Liste</span> <span class=SpellE>der</span> <span
-class=SpellE>TBs</span> : <br>
+Liste der TBs : <br>
 SOLVER<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Solver <span class=SpellE>Infos</span><br>
+Solver Infos<br>
 COUNTRY<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>Staat</span> <br>
+Staat <br>
 STATE<span style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>Bundesland</span><br>
+Bundesland<br>
 HTML<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 TRUE / FALSE if description is html<br>
 VOTE<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>gcvote</span> / OC<br style='mso-special-character:line-break'>
+gcvote / OC<br style='mso-special-character:line-break'>
 <![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
 <![endif]><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>ATTRIBUTES<span
 style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????? </span>:
-the &lt;<span class=SpellE>tmpl_loop</span> ATTRIBUTES&gt;, example see
-GCTemplate.html / show cache in browser offline<br>
+the &lt;tmpl_loop ATTRIBUTES&gt;, example see GCTemplate.html / show cache in
+browser offline<br>
 PATHANDIMAGE<span style='mso-tab-count:7'>??????????????????????????????????????????????????????????????????????????????? </span>:
-path an <span class=SpellE>imagename</span> of the attribute<br>
+path an imagename of the attribute<br>
 IMAGE<span style='mso-tab-count:9'>?????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>imagename</span> of the attribute<br>
+imagename of the attribute<br>
 INFO<span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-description of the attribute from language <span class=SpellE>config</span><br>
+description of the attribute from language config<br>
 GCINFO<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 description of the attribute as from gc.com<br>
 BR<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-contains &lt;<span class=SpellE>br</span>/&gt; every 5<sup>th</sup> attribute
-else empty (can be used with &lt;<span class=SpellE>tmp_if</span>&gt;<span
-class=GramE>)</span><br>
+contains &lt;br/&gt; every 5<sup>th</sup> attribute else empty (can be used
+with &lt;tmp_if&gt;)<br>
 GCID<span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 ID of gc.com<br>
 INC<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
@@ -445,21 +402,21 @@
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>LOGS<span
 style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-the &lt;<span class=SpellE>tmpl_loop</span> LOGS &gt;, example see
-GCTemplate.html / show cache in browser offline<br>
+the &lt;tmpl_loop LOGS &gt;, example see GCTemplate.html / show cache in
+browser offline<br>
 ICON<span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 name of the log picture<br>
 LOGTYPE<span style='mso-tab-count:8'>?????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=GramE>Text :</span> found it<span style='mso-spacerun:yes'>?
-</span>etc?.(</span><span lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span
-lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>gc.com
+Text : found it<span style='mso-spacerun:yes'>? </span>etc?.(</span><span
+lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
+style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>gc.com
 compatible string representation)<br>
 DATE<span style='mso-tab-count:9'>???????????????????????????????????????????????????????????????????????????????????????????????? </span>:
 date of the log<br>
 LOGGER<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????????? </span>:
 name<br>
 MESSAGE<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>logtext</span><o:p></o:p></span></p>
+logtext<o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
@@ -467,23 +424,19 @@
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>ADDIS<span
 style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-the &lt;<span class=SpellE>tmpl_loop</span> ADDIS&gt; example see
-GCTemplate.html<br>
+the &lt;tmpl_loop ADDIS&gt; example see GCTemplate.html<br>
 WAYPOINT<span style='mso-tab-count:8'>???????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>der</span> <span class=SpellE>Addi</span><br>
+der Addi<br>
 NAME<span style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Name des <span class=SpellE>Addi</span><br>
+Name des Addi<br>
 LATLON<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-<span class=SpellE>Koordinaten</span> des <span class=SpellE>Addi</span><br>
-LAT<span style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????????? </span><span
-class=GramE>:</span><br>
+Koordinaten des Addi<br>
+LAT<span style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????????? </span>:<br>
 LON<span style='mso-tab-count:9'>?????????????????????????????????????????????????????????????????????????????????????????????????? </span>:<br>
 IMG<span style='mso-tab-count:9'>??????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-Name des <span class=SpellE>Addi</span> Icons <span class=SpellE>png</span>
-(resources <span class=SpellE>oder</span> <span class=SpellE>exporticons</span>)<br>
+Name des Addi Icons png (resources oder exporticons)<br>
 ICON<span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
-&lt;type&gt; as number string (see <span class=SpellE>CacheType.java</span> <span
-class=SpellE>e.g</span> : ?,50=Parking ?.)<br>
+&lt;type&gt; as number string (see CacheType.java e.g : ?,50=Parking ?.)<br>
 </span><span style='font-size:10.0pt;font-family:Arial'>TYPENAME<span
 style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????? </span>:
 Typename des Addi wie in der GUI<br>
@@ -500,11 +453,9 @@
 mso-outline-level:1'><span style='font-size:10.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
-mso-outline-level:1'><span class=SpellE><span class=GramE><span lang=EN-GB
-style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>cacheImg</span></span></span><span
-lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'><span
-style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????????? </span>:
-the &lt;<span class=SpellE>tmpl_loop</span> <span class=SpellE>cacheImg</span>&gt;<br>
+mso-outline-level:1'><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
+mso-ansi-language:EN-GB'>cacheImg<span style='mso-tab-count:8'>??????????????????????????????????????????????????????????????????????????????????????????? </span>:
+the &lt;tmpl_loop cacheImg&gt;<br>
 FILENAME<span style='mso-tab-count:8'>????????????????????????????????????????????????????????????????????????????????????????? </span>:
 the filename in the profile directory<br>
 TEXT<span style='mso-tab-count:9'>????????????????????????????????????????????????????????????????????????????????????????????????? </span>:
@@ -528,34 +479,24 @@
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>&lt;#--
 Microsoft AutoRoute --&gt;<br>
-&lt;#-- <span class=SpellE>Codecs</span>: ASCII, UTF8 --&gt;<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>charset</span>&quot;
-value=&quot;ASCII&quot;&gt;<br>
-&lt;#-- <span class=SpellE>somme</span> chars should not appear in the <span
-class=SpellE>cachename</span> --&gt;<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>badchars</span>&quot;
-value=&quot;;&quot;&quot;<span class=GramE>&gt;</span><br>
-&lt;#-- <span class=SpellE>newline</span>: CR, LF, CRLF --&gt;<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>newline</span>&quot;
-value=&quot;CRLF&quot;&gt;<br>
-&lt;#-- decimal <span class=SpellE>seperator</span>: . or , --&gt;<br>
-&lt;<span class=SpellE>tmpl_par</span> name=&quot;<span class=SpellE>decsep</span>&quot;
-value=&quot;,&quot;&gt;<br>
+&lt;#-- Codecs: ASCII, UTF8 --&gt;<br>
+&lt;tmpl_par name=&quot;charset&quot; value=&quot;ASCII&quot;&gt;<br>
+&lt;#-- somme chars should not appear in the cachename --&gt;<br>
+&lt;tmpl_par name=&quot;badchars&quot; value=&quot;;&quot;&quot;&gt;<br>
+&lt;#-- newline: CR, LF, CRLF --&gt;<br>
+&lt;tmpl_par name=&quot;newline&quot; value=&quot;CRLF&quot;&gt;<br>
+&lt;#-- decimal seperator: . or , --&gt;<br>
+&lt;tmpl_par name=&quot;decsep&quot; value=&quot;,&quot;&gt;<br>
 Name;Breitengrad;L?ngengrad;Typ1;Typ2;Waypoint;Datum;Hyperlink&lt;br /&gt;<br>
-&lt;<span class=SpellE>tmpl_loop</span> <span class=SpellE>cache_index</span>&gt;<br>
-&quot;&lt;<span class=SpellE>tmpl_var</span> name=SHORTTYPE&gt;-&lt;<span
-class=SpellE>tmpl_var</span> name=SHORTSIZE&gt;-&lt;<span class=SpellE>tmpl_var</span>
-name=DIFFICULTY&gt;-&lt;<span class=SpellE>tmpl_var</span> name=TERRAIN&gt;
-&lt;<span class=SpellE>tmpl_var</span> name=NAME&gt;&quot;;&lt;<span
-class=SpellE>tmpl_var</span> name=LAT&gt;;&lt;<span class=SpellE>tmpl_var</span>
-name=LON&gt;;&quot;&lt;<span class=SpellE>tmpl_var</span>
-name=TYPE&gt;&quot;;&quot;&lt;<span class=SpellE>tmpl_var</span>
-name=SIZE&gt;&quot;;&quot;&lt;<span class=SpellE>tmpl_var</span>
-name=WAYPOINT&gt;&quot;;&quot;&lt;<span class=SpellE>tmpl_var</span>
-name=DATE&gt;&quot;;&quot;&lt;<span class=SpellE>tmpl_var</span>
-name=URL&gt;&quot;&lt;<span class=SpellE>br</span> /&gt;<br>
-&lt;/<span class=SpellE>tmpl_loop</span>&gt;<br style='mso-special-character:
-line-break'>
+&lt;tmpl_loop cache_index&gt;<br>
+&quot;&lt;tmpl_var name=SHORTTYPE&gt;-&lt;tmpl_var
+name=SHORTSIZE&gt;-&lt;tmpl_var name=DIFFICULTY&gt;-&lt;tmpl_var
+name=TERRAIN&gt; &lt;tmpl_var name=NAME&gt;&quot;;&lt;tmpl_var
+name=LAT&gt;;&lt;tmpl_var name=LON&gt;;&quot;&lt;tmpl_var
+name=TYPE&gt;&quot;;&quot;&lt;tmpl_var name=SIZE&gt;&quot;;&quot;&lt;tmpl_var
+name=WAYPOINT&gt;&quot;;&quot;&lt;tmpl_var name=DATE&gt;&quot;;&quot;&lt;tmpl_var
+name=URL&gt;&quot;&lt;br /&gt;<br>
+&lt;/tmpl_loop&gt;<br style='mso-special-character:line-break'>
 <![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
 <![endif]></span><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
@@ -564,22 +505,19 @@
 Arial;mso-ansi-language:EN-GB'>Tags</span></u><u><span lang=EN-GB
 style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
 
-<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-class=SpellE><u><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>tmpl_var</span></u></span><u><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
+<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>tmpl_var</span></u><u><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>You
 can set default values for your template variables, which</span><span
 lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
 style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>will be used
-if no value has been set through the <span class=SpellE>setParam</span> method.<br>
-&lt;TMPL_VAR name=&quot;<span class=SpellE>var_name</span>&quot;
-default=&quot;my value&quot;&gt;<br>
-If <span class=SpellE>var_name</span> is set using <span class=SpellE>setParam</span>
-(or <span class=SpellE>setParams</span>), then it's value will be whatever it
-was set to<span class=GramE>,<span style='mso-spacerun:yes'>? </span>else</span></span><span
+if no value has been set through the setParam method.<br>
+&lt;TMPL_VAR name=&quot;var_name&quot; default=&quot;my value&quot;&gt;<br>
+If var_name is set using setParam (or setParams), then it's value will be
+whatever it was set to,<span style='mso-spacerun:yes'>? </span>else</span><span
 lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
 style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>it will be
 &quot;my value&quot; (without the quotes).<o:p></o:p></span></p>
@@ -589,21 +527,15 @@
 can also &quot;escape&quot; certain strings. The following escape modes are
 possible.<br>
 </span><span lang=EN-GB style='mso-ansi-language:EN-GB'>&nbsp; </span><span
-class=GramE><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>none</span></span><span lang=EN-GB style='font-size:
-10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>:&nbsp;&nbsp; String
-unchanged (this is the default if escape is not specified)<br>
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>none:&nbsp;&nbsp;
+String unchanged (this is the default if escape is not specified)<br>
 </span><span lang=EN-GB style='mso-ansi-language:EN-GB'>&nbsp; </span><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>html:&nbsp;&nbsp;
 Encode special characters: &amp; &gt; &lt; &quot;.&nbsp; They are changed to
-&amp;amp; &amp;<span class=SpellE>lt</span>;<span class=GramE>&nbsp; &amp;</span><span
-class=SpellE>gt</span>;&nbsp; and &amp;<span class=SpellE>quot</span>;
-respectively<br>
+&amp;amp; &amp;lt;&nbsp; &amp;gt;&nbsp; and &amp;quot; respectively<br>
 </span><span lang=EN-GB style='mso-ansi-language:EN-GB'>&nbsp; </span><span
-class=SpellE><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>url</span></span><span lang=EN-GB style='font-size:
-10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>:&nbsp;&nbsp;&nbsp; Encode
-special characters in URL, e.g. space becomes %20<br>
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>url:&nbsp;&nbsp;&nbsp;
+Encode special characters in URL, e.g. space becomes %20<br>
 </span><span lang=EN-GB style='mso-ansi-language:EN-GB'>&nbsp; </span><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>quote:&nbsp;
 Change quotation marks:&nbsp;&nbsp; &quot; becomes \&quot;&nbsp; and ' becomes
@@ -613,47 +545,41 @@
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>Example:
-&lt;TMPL_VAR name=&quot;<span class=SpellE>var_name</span>&quot;
-escape=&quot;html&quot;&gt;</span><span lang=EN-GB style='mso-ansi-language:
-EN-GB'><o:p></o:p></span></p>
+&lt;TMPL_VAR name=&quot;var_name&quot; escape=&quot;html&quot;&gt;</span><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='mso-ansi-language:EN-GB'>&nbsp;<o:p></o:p></span></p>
 
-<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-class=SpellE><u><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>tmpl_if</span></u></span><u><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
+<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>tmpl_if</span></u><u><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>The
-&lt;<span class=SpellE>tmpl_if</span>&gt; tag allows you to include or not
-include a block of the template based on the <span class=GramE>value<span
-style='mso-spacerun:yes'>? </span>of</span></span><span lang=EN-GB
-style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;
-font-family:Arial;mso-ansi-language:EN-GB'>a given parameter name. If the
-parameter is given a value that is true, then the block is included in</span><span
+&lt;tmpl_if&gt; tag allows you to include or not include a block of the
+template based on the value<span style='mso-spacerun:yes'>? </span>of</span><span
 lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
-style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>the output.
-If the value is false, then it is skipped.<br>
-The <span class=SpellE>tmpl_if</span> must be closed with a corresponding /<span
-class=SpellE>tmpl_if</span>, e.g.</span><span lang=EN-GB style='mso-ansi-language:
-EN-GB'><o:p></o:p></span></p>
+style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>a given
+parameter name. If the parameter is given a value that is true, then the block
+is included in</span><span lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>the
+output. If the value is false, then it is skipped.<br>
+The tmpl_if must be closed with a corresponding /tmpl_if, e.g.</span><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>&lt;<span
-class=SpellE>tmpl_if</span> ...&gt;<br>
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>&lt;tmpl_if
+...&gt;<br>
 ...<br>
-&lt;/<span class=SpellE>tmpl_if</span>&gt;</span><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
+&lt;/tmpl_if&gt;</span><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>Parameter
-values for conditions are Strings in java, and not <span class=SpellE><span
-class=GramE>boolean</span></span> values, hence, what evaluates to true and</span><span
-lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
-style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>false needs
-to be specifically defined.<br>
+values for conditions are Strings in java, and not boolean values, hence, what
+evaluates to true and</span><span lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>false
+needs to be specifically defined.<br>
 As of now, the following values evaluate to false:<br>
 &quot;&quot; - the empty string<br>
 &quot;0&quot; - the string containing only the number zero<br>
@@ -663,58 +589,52 @@
 <![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
 <![endif]></span><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
-<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-class=SpellE><u><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>tmpl_else</span></u></span><u><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
+<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>tmpl_else</span></u><u><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>While
-the if block allows us to display some output if a condition is true<span
-class=GramE>,<span style='mso-spacerun:yes'>? </span>we</span></span><span
-lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
-style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>may also
-need to display content if the condition is false. This can be done by using
-the optional else</span><span lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span
-lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>branch
-of <span class=GramE>the if</span> block.</span><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
+the if block allows us to display some output if a condition is true,<span
+style='mso-spacerun:yes'>? </span>we</span><span lang=EN-GB style='mso-ansi-language:
+EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
+mso-ansi-language:EN-GB'>may also need to display content if the condition is
+false. This can be done by using the optional else</span><span lang=EN-GB
+style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;
+font-family:Arial;mso-ansi-language:EN-GB'>branch of the if block.</span><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
-<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-class=SpellE><u><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>tmpl_unless</span></u></span><u><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
+<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>tmpl_unless</span></u><u><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>This
-tag is the exact opposite of the &lt;<span class=SpellE>tmpl_if</span>&gt; tag.
-A &lt;<span class=SpellE>tmpl_unless</span>&gt; block is displayed if its
-control variable</span><span lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span
-lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>evaluates
-to false. If the control variable evaluates to true, then the else block, if</span><span
-lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
-style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>any, is
-displayed instead.</span><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
+tag is the exact opposite of the &lt;tmpl_if&gt; tag. A &lt;tmpl_unless&gt;
+block is displayed if its control variable</span><span lang=EN-GB
+style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;
+font-family:Arial;mso-ansi-language:EN-GB'>evaluates to false. If the control
+variable evaluates to true, then the else block, if</span><span lang=EN-GB
+style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;
+font-family:Arial;mso-ansi-language:EN-GB'>any, is displayed instead.</span><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
-<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-class=SpellE><u><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>tmpl_loop</span></u></span><u><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
+<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>tmpl_loop</span></u><u><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>The
-&lt;<span class=SpellE>tmpl_loop</span>&gt; tag is a bit more complicated than
-the other tags. It allows you to create a section of text that</span><span
-lang=EN-GB style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB
-style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>will be
-displayed repeatedly for every item in the loop control variable. Inside the
-&lt;<span class=SpellE>tmpl_loop</span>&gt;<span class=GramE>,<span
-style='mso-spacerun:yes'>? </span>you</span></span><span lang=EN-GB
-style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;
-font-family:Arial;mso-ansi-language:EN-GB'>place &lt;<span class=SpellE>tmpl_var</span>&gt;s.<b
-style='mso-bidi-font-weight:normal'> The only loop used by the template
-exporter is '<span class=SpellE>cache_index</span>', see example above. </b></span><span
-lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
+&lt;tmpl_loop&gt; tag is a bit more complicated than the other tags. It allows
+you to create a section of text that</span><span lang=EN-GB style='mso-ansi-language:
+EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
+mso-ansi-language:EN-GB'>will be displayed repeatedly for every item in the
+loop control variable. Inside the &lt;tmpl_loop&gt;,<span
+style='mso-spacerun:yes'>? </span>you</span><span lang=EN-GB style='mso-ansi-language:
+EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
+mso-ansi-language:EN-GB'>place &lt;tmpl_var&gt;s.<b style='mso-bidi-font-weight:
+normal'> The only loop used by the template exporter is 'cache_index', see
+example above. </b></span><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
 mso-outline-level:1'><st1:place><u><span lang=EN-GB style='font-size:10.0pt;
@@ -725,11 +645,11 @@
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>If
-you set <span class=SpellE>loop_context_vars</span> to true in your Template's
-constructor, then you will have access to five special</span><span lang=EN-GB
-style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;
-font-family:Arial;mso-ansi-language:EN-GB'>variables in all your loops. These
-are:</span><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
+you set loop_context_vars to true in your Template's constructor, then you will
+have access to five special</span><span lang=EN-GB style='mso-ansi-language:
+EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
+mso-ansi-language:EN-GB'>variables in all your loops. These are:</span><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>__FIRST__<span
@@ -761,20 +681,18 @@
 mso-ansi-language:EN-GB'>You may use these like any other &lt;TMPL_VAR&gt;
 inside your loop.</span><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></p>
 
-<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
-class=SpellE><u><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>tmpl_include</span></u></span><u><span lang=EN-GB
-style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
+<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><u><span
+lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>tmpl_include</span></u><u><span
+lang=EN-GB style='mso-ansi-language:EN-GB'><o:p></o:p></span></u></p>
 
 <p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'>The
-&lt;<span class=SpellE>tmpl_include</span>&gt; tag is the next simplest tag
-after &lt;<span class=SpellE>tmpl_var</span>&gt;, however, it will not do what
-you expect it to do inside</span><span lang=EN-GB style='mso-ansi-language:
-EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
-mso-ansi-language:EN-GB'>a &lt;<span class=SpellE>tmpl_if</span>&gt;<br>
-&lt;<span class=SpellE>tmpl_include</span>&gt; is used to include the contents
-of another template within this template, at the position of the tag. <br>
+&lt;tmpl_include&gt; tag is the next simplest tag after &lt;tmpl_var&gt;,
+however, it will not do what you expect it to do inside</span><span lang=EN-GB
+style='mso-ansi-language:EN-GB'> </span><span lang=EN-GB style='font-size:10.0pt;
+font-family:Arial;mso-ansi-language:EN-GB'>a &lt;tmpl_if&gt;<br>
+&lt;tmpl_include&gt; is used to include the contents of another template within
+this template, at the position of the tag. <br>
 Processing then continues, as if the included template were always a part of
 the current template. <o:p></o:p></span></p>
 

Modified: trunk/src/CacheWolf/exp/TPLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/TPLExporter.java	2011-06-21 14:51:39 UTC (rev 3030)
+++ trunk/src/CacheWolf/exp/TPLExporter.java	2011-06-24 16:04:04 UTC (rev 3031)
@@ -21,11 +21,12 @@
     You should have received a copy of the GNU General Public License
     along with this program; if not, write to the Free Software
     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+ */
 package CacheWolf.exp;
 
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
+import CacheWolf.CacheType;
 import CacheWolf.Global;
 import CacheWolf.InfoBox;
 import CacheWolf.Preferences;
@@ -54,31 +55,29 @@
 import ewe.util.Vector;
 
 /**
- * @author Kalle
- * class to export cachedata using a template
+ * @author Kalle class to export cachedata using a template
  */
-class TplFilter implements HTML.Tmpl.Filter
-{
-	private int type=SCALAR;
-	private String newLine="\n";
+class TplFilter implements HTML.Tmpl.Filter {
+	private int type = SCALAR;
+	private String newLine = "\n";
 	TextCodec codec = new AsciiCodec(); // codec = new AsciiCodec(AsciiCodec.STRIP_CR);
 	String badChars;
 	String decSep = ".";
-	int shortNameLength=30;
-	int shortWaypointLength=3;
-	int noOfLogs=-1; // means all
+	int shortNameLength = 30;
+	int shortWaypointLength = 3;
+	int noOfLogs = -1; // means all
 	boolean single = true;
 	int formatModifier = 0;
 	int sortedBy = -1;
-	boolean getAddiWp = true;
-	boolean getMainWp = true;
+	boolean getAddiWp = false;
+	boolean getMainWp = false;
+	boolean getParking = false;
 	boolean copyCacheImages = false;
 	Hashtable additionalVarParams = new Hashtable();
 	String userValue = "";
-	String out="*.gpx";
+	String out = "*.gpx";
 
-
-	public TplFilter(){
+	public TplFilter() {
 		return;
 	}
 
@@ -94,7 +93,7 @@
 		// search for parameters
 		rex = new Regex("(?i)<tmpl_par.*>");
 		rex.search(t);
-		if (rex.didMatch()){
+		if (rex.didMatch()) {
 			// get parameter
 			rex1 = new Regex("(?i)name=\"(.*)\"\\svalue=\"(.*)\"[?\\s>]");
 			rex1.search(t);
@@ -102,83 +101,77 @@
 			value = rex1.stringMatched(2);
 
 			if (param.equals("charset")) {
-				if (value.equals("ASCII")) {codec = new AsciiCodec();}
-				else if (value.equals("UTF8")) {codec = new JavaUtf8Codec();}
-				else {codec = new NoCodec();}
-			}
-			else if (param.equals("badchars")) {
+				if (value.equals("ASCII")) {
+					codec = new AsciiCodec();
+				} else if (value.equals("UTF8")) {
+					codec = new JavaUtf8Codec();
+				} else {
+					codec = new NoCodec();
+				}
+			} else if (param.equals("badchars")) {
 				badChars = value;
-			}
-			else if (param.equals("newline")){
+			} else if (param.equals("newline")) {
 				newLine = "";
-				if (value.indexOf("CR") >= 0) newLine += "\r";
-				if (value.indexOf("LF") >= 0) newLine += "\n";
-			}
-			else if (param.equals("decsep")) {
+				if (value.indexOf("CR") >= 0)
+					newLine += "\r";
+				if (value.indexOf("LF") >= 0)
+					newLine += "\n";
+			} else if (param.equals("decsep")) {
 				decSep = value;
-			}
-			else if (param.equals("ShortNameLength")) {
+			} else if (param.equals("ShortNameLength")) {
 				shortNameLength = Integer.valueOf(value).intValue();
-			}
-			else if (param.equals("WaypointLength")) {
+			} else if (param.equals("WaypointLength")) {
 				shortWaypointLength = Integer.valueOf(value).intValue();
-			}
-			else if (param.equals("NrLogs")) {
+			} else if (param.equals("NrLogs")) {
 				noOfLogs = Integer.valueOf(value).intValue();
-			}
-			else if (param.equals("singleFile")) {
-				single = value.equals("yes") ? true : false ;
-			}
-			else if (param.equals("formatModifier")) {
+			} else if (param.equals("singleFile")) {
+				single = value.equals("yes") ? true : false;
+			} else if (param.equals("formatModifier")) {
 				formatModifier = Integer.valueOf(value).intValue();
-			}
-			else if (param.equals("Out")) {
+			} else if (param.equals("Out")) {
 				out = value;
-			}
-			else if (param.equals("takeOnlyWp")) {
+			} else if (param.equals("takeOnlyWp")) {
 				if (value.equals("main")) {
-					getAddiWp=false;
+					getMainWp = true;
+				} else if (value.equals("addi")) {
+					getAddiWp = true;
+				} else if (value.equals("parking")) {
+					getParking = true;
 				}
-				else if (value.equals("addi")) {
-					getMainWp=false;
-				}
-			}
-			else if (param.equals("sortedBy")) {
-				sortedBy=Integer.valueOf(value).intValue();
-			}
-			else if (param.equals("CopyCacheImages")) {
-				if (value.equals("yes")) copyCacheImages=true;
-			}
-			else if (param.startsWith("input")) {
+			} else if (param.equals("sortedBy")) {
+				sortedBy = Integer.valueOf(value).intValue();
+			} else if (param.equals("CopyCacheImages")) {
+				if (value.equals("yes"))
+					copyCacheImages = true;
+			} else if (param.startsWith("input")) {
 				String par = param.substring(5);
 				InfoBox inf = new InfoBox("Eingabe", par, InfoBox.INPUT);
 				inf.feedback.setText(value);
 				String res;
 				if (inf.execute() == FormBase.IDOK) {
 					res = inf.getInput();
-					additionalVarParams.put(par,res);
+					additionalVarParams.put(par, res);
 				}
+			} else if (param.startsWith("const")) {
+				additionalVarParams.put(param.substring(5), value);
 			}
-			else if (param.startsWith("const")) {
-				additionalVarParams.put(param.substring(5),value);
-			}
 			return "";
 		}
 
 		if (formatModifier == 0) {
 			// for gpx output
 			// Filter newlines
-			rex = new Regex("(?m)\n$","");
+			rex = new Regex("(?m)\n$", "");
 			t = rex.replaceAll(t);
 
 			// Filter comments <#-- and -->
-			rex = new Regex("<#--.*-->","");
+			rex = new Regex("<#--.*-->", "");
 			t = rex.replaceAll(t);
 
 			// replace <br> or <br /> with newline
-			rex = new Regex("<br.*>","");
+			rex = new Regex("<br.*>", "");
 			rex.search(t);
-			if (rex.didMatch()){
+			if (rex.didMatch()) {
 				t = rex.replaceAll(t);
 				t += newLine;
 			}
@@ -187,46 +180,44 @@
 		return t;
 	}
 
-
-	public String [] parse(String [] t) {
+	public String[] parse(String[] t) {
 		throw new UnsupportedOperationException();
 	}
 }
 
-
 public class TPLExporter {
 	CacheDB cacheDB;
 	Preferences pref;
 	Profile profile;
 	String tplFile;
 	String expName;
-	Regex rex=null;
-	private static GarminMap gm=null;
+	Regex rex = null;
+	private static GarminMap gm = null;
 
-	public TPLExporter(Preferences p, Profile prof, String tpl){
+	public TPLExporter(Preferences p, Profile prof, String tpl) {
 		pref = p;
-		profile=prof;
+		profile = prof;
 		cacheDB = profile.cacheDB;
 		tplFile = tpl;
 		File tmpFile = new File(tpl);
 		expName = tmpFile.getName();
 		expName = expName.substring(0, expName.indexOf("."));
-		gm=new GarminMap();
+		gm = new GarminMap();
 	}
 
-	public void doIt(){
+	public void doIt() {
 
 		ProgressBarForm pbf = new ProgressBarForm();
 		ewe.sys.Handle h = new ewe.sys.Handle();
 		int counter = cacheDB.countVisible();
 		pbf.showMainTask = false;
-		pbf.setTask(h,"Exporting ...");
+		pbf.setTask(h, "Exporting ...");
 		pbf.exec();
 
 		try {
-			TplFilter myFilter = new TplFilter();			
+			TplFilter myFilter = new TplFilter();
 			Hashtable args = new Hashtable();
-			//args.put("debug", "true");
+			// args.put("debug", "true");
 			args.put("filename", tplFile);
 			args.put("case_sensitive", "true");
 			args.put("loop_context_vars", Boolean.TRUE);
@@ -237,50 +228,64 @@
 			FileChooser fc = new FileChooser(FileChooserBase.SAVE, pref.getExportPath(expName));
 			fc.setTitle("Select target file:");
 			fc.addMask(myFilter.out);
-			if(fc.execute() == FormBase.IDCANCEL) {pbf.exit(0); return; }
+			if (fc.execute() == FormBase.IDCANCEL) {
+				pbf.exit(0);
+				return;
+			}
 			File saveTo = fc.getChosenFile();
 			pref.setExportPath(expName, saveTo.getPath());
 
-			if (myFilter.sortedBy!=-1) {
+			if (myFilter.sortedBy != -1) {
 				Global.mainTab.tbP.myMod.sortTable(myFilter.sortedBy, true);
 			}
-			
-			Regex dec = new Regex("[,.]",myFilter.decSep);
-			if (myFilter.badChars != null) rex = new Regex("["+myFilter.badChars+"]","");
-			
+
+			Regex dec = new Regex("[,.]", myFilter.decSep);
+			if (myFilter.badChars != null)
+				rex = new Regex("[" + myFilter.badChars + "]", "");
+
 			Vector cache_index = new Vector();
-			String imgExpName="";
-			if (myFilter.copyCacheImages) imgExpName=expName;
-			for(int i = 0; i<counter;i++){
+			String imgExpName = "";
+			if (myFilter.copyCacheImages)
+				imgExpName = expName;
+			for (int i = 0; i < counter; i++) {
 				CacheHolder ch = cacheDB.get(i);
-				if (ch.isVisible() && (ch.pos.isValid() || myFilter.formatModifier>0) ){
-					if (myFilter.getAddiWp == ch.isAddiWpt() || myFilter.getMainWp == !ch.isAddiWpt()) {
-						h.progress = (float)i/(float)counter;
+				if (ch.isVisible() && (ch.pos.isValid() || myFilter.formatModifier > 0)) {
+					boolean get = true;
+					if (myFilter.getAddiWp) {
+						get = ch.isAddiWpt();
+					} else if (myFilter.getMainWp) {
+						get = !ch.isAddiWpt();
+					} else if (myFilter.getParking) {
+						get = (ch.getType() == CacheType.CW_TYPE_PARKING)// parking
+								|| (!ch.isAddiWpt() && !hasParking(ch));// oder main ohne Parkplatz
+					}
+					if (get) {
+						h.progress = (float) i / (float) counter;
 						h.changed();
 						try {
-							Hashtable varParams=ch.toHashtable(dec, rex, myFilter.shortWaypointLength, myFilter.shortNameLength, myFilter.noOfLogs, myFilter.codec, gm, false, myFilter.formatModifier, imgExpName);
-							
+							Hashtable varParams = ch.toHashtable(dec, rex, myFilter.shortWaypointLength, myFilter.shortNameLength, myFilter.noOfLogs, myFilter.codec, gm, false, myFilter.formatModifier, imgExpName);
+
 							Enumeration e = myFilter.additionalVarParams.keys();
-							while(e.hasMoreElements()) {
-								String key = (String)e.nextElement();
+							while (e.hasMoreElements()) {
+								String key = (String) e.nextElement();
 								Object value = myFilter.additionalVarParams.get(key);
 								varParams.put(key, value);
 							}
-							
+
 							if (myFilter.single) {
 								cache_index.add(varParams);
 							}
 
 							else {
 								tpl.setParams(varParams);
-								String ext = (myFilter.out.substring(myFilter.out.lastIndexOf(".")).toLowerCase()+"    ").trim();
+								String ext = (myFilter.out.substring(myFilter.out.lastIndexOf(".")).toLowerCase() + "    ").trim();
 								FileWriter fw = new FileWriter(saveTo.getPath() + ch.getWayPoint() + ext);
 								fw.codec = myFilter.codec;
 								PrintWriter detfile = new PrintWriter(new BufferedWriter(fw));
 								tpl.printTo(detfile);
 								detfile.close();
 							}
-						}catch(Exception e){
+						} catch (Exception e) {
 							pref.log("[TplExporter:doIt]" + ch.getWayPoint(), e, true);
 						}
 					}
@@ -298,91 +303,106 @@
 		} catch (Exception e) {
 			pref.log("[TplExporter:doIt]", e, true);
 		} catch (OutOfMemoryError e) {
-			(new MessageBox("Error", "Not enough memory available to load all cache data (incl. description and logs)\nexport aborted\nFilter caches to minimise memory needed for TPL-Export\nWe recommend to restart CacheWolf now", FormBase.OKB)).execute();
+			(new MessageBox("Error", "Not enough memory available to load all cache data (incl. description and logs)\nexport aborted\nFilter caches to minimise memory needed for TPL-Export\nWe recommend to restart CacheWolf now", FormBase.OKB))
+					.execute();
 		}
 		pbf.exit(0);
 	}
+
+	private boolean hasParking(CacheHolder ch) {
+		boolean ret = false;
+		if (ch.hasAddiWpt()) {
+			for (int i = 0; i < ch.addiWpts.size(); i++) {
+				CacheHolder chwp = (CacheHolder) ch.addiWpts.get(i);
+				if (chwp.getType() == CacheType.CW_TYPE_PARKING)
+					return true;
+			}
+		}
+		return ret;
+	}
 }
 
-//##################################################################
-class NoCodec implements TextCodec{
-//##################################################################
+// ##################################################################
+class NoCodec implements TextCodec {
+	// ##################################################################
 
-/**
-* This is a creation option. It specifies that CR characters should be removed when
-* encoding text into UTF.
-**/
-public static final int STRIP_CR_ON_DECODE = 0x1;
-/**
-* This is a creation option. It specifies that CR characters should be removed when
-* decoding text from UTF.
-**/
-public static final int STRIP_CR_ON_ENCODE = 0x2;
-/**
-* This is a creation option. It specifies that CR characters should be removed when
-* decoding text from UTF AND encoding text to UTF.
-**/
-public static final int STRIP_CR = STRIP_CR_ON_DECODE|STRIP_CR_ON_ENCODE;
+	/**
+	 * This is a creation option. It specifies that CR characters should be removed when encoding text into UTF.
+	 */
+	public static final int STRIP_CR_ON_DECODE = 0x1;
+	/**
+	 * This is a creation option. It specifies that CR characters should be removed when decoding text from UTF.
+	 */
+	public static final int STRIP_CR_ON_ENCODE = 0x2;
+	/**
+	 * This is a creation option. It specifies that CR characters should be removed when decoding text from UTF AND encoding text to UTF.
+	 */
+	public static final int STRIP_CR = STRIP_CR_ON_DECODE | STRIP_CR_ON_ENCODE;
 
-private int flags = 0;
+	private int flags = 0;
 
-//===================================================================
-public NoCodec(int options)
-//===================================================================
-{
-	flags = options;
-}
-//===================================================================
-public NoCodec()
-//===================================================================
-{
-	this(0);
-}
-//===================================================================
-public ByteArray encodeText(char [] text, int start, int length, boolean endOfData, ByteArray dest) throws IOException
-//===================================================================
-{
-	if (dest == null) dest = new ByteArray();
-	int size = length == 0 ? 2 : 2+text.length*2;
-	if (dest.data == null || dest.data.length < size)
-		dest.data = new byte[size];
-	byte [] destination = dest.data;
-	int s = 0;
-	if (length>0){
-		destination[s++] = (byte) 0xFF;
-		destination[s++] = (byte) 0xFE;
+	// ===================================================================
+	public NoCodec(int options)
+	// ===================================================================
+	{
+		flags = options;
 	}
-	for (int i = 0; i<length; i++){
-		char c = text[i+start];
-		if (c == 13 && ((flags & STRIP_CR_ON_ENCODE) != 0)) continue;
-		destination[s++] = (byte)(c & 0xFF);
-		destination[s++] = (byte)((c>>8) & 0xFF);
+
+	// ===================================================================
+	public NoCodec()
+	// ===================================================================
+	{
+		this(0);
 	}
-	dest.length = s;
-	return dest;
-}
 
-//===================================================================
-public CharArray decodeText(byte [] encoded, int start, int length, boolean endOfData, CharArray dest) throws IOException
-//===================================================================
-{
-	if (dest == null) dest = new CharArray();
-	dest.length = 0;
-	return dest;
-}
+	// ===================================================================
+	public ByteArray encodeText(char[] text, int start, int length, boolean endOfData, ByteArray dest) throws IOException
+	// ===================================================================
+	{
+		if (dest == null)
+			dest = new ByteArray();
+		int size = length == 0 ? 2 : 2 + text.length * 2;
+		if (dest.data == null || dest.data.length < size)
+			dest.data = new byte[size];
+		byte[] destination = dest.data;
+		int s = 0;
+		if (length > 0) {
+			destination[s++] = (byte) 0xFF;
+			destination[s++] = (byte) 0xFE;
+		}
+		for (int i = 0; i < length; i++) {
+			char c = text[i + start];
+			if (c == 13 && ((flags & STRIP_CR_ON_ENCODE) != 0))
+				continue;
+			destination[s++] = (byte) (c & 0xFF);
+			destination[s++] = (byte) ((c >> 8) & 0xFF);
+		}
+		dest.length = s;
+		return dest;
+	}
 
-//===================================================================
-public void closeCodec() throws IOException
-//===================================================================
-{
-}
+	// ===================================================================
+	public CharArray decodeText(byte[] encoded, int start, int length, boolean endOfData, CharArray dest) throws IOException
+	// ===================================================================
+	{
+		if (dest == null)
+			dest = new CharArray();
+		dest.length = 0;
+		return dest;
+	}
 
-//===================================================================
-public Object getCopy()
-//===================================================================
-{
-	return new NoCodec(flags);
+	// ===================================================================
+	public void closeCodec() throws IOException
+	// ===================================================================
+	{
+	}
+
+	// ===================================================================
+	public Object getCopy()
+	// ===================================================================
+	{
+		return new NoCodec(flags);
+	}
+	// ##################################################################
 }
-//##################################################################
-}
-//##################################################################
+// ##################################################################



From araber95 at mail.berlios.de  Mon Jun 27 07:29:22 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 27 Jun 2011 07:29:22 PM +0200
Subject: [Cachewolf-svn] r3032 - trunk/src/CacheWolf
Message-ID: <20110627172922.8F8D048294F@sheep.berlios.de>

Author: araber95
Date: 2011-06-27 19:29:22 +0200 (Mon, 27 Jun 2011)
New Revision: 3032

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
reading alias with ampersand correct

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-06-24 16:04:04 UTC (rev 3031)
+++ trunk/src/CacheWolf/Preferences.java	2011-06-27 17:29:22 UTC (rev 3032)
@@ -51,9 +51,9 @@
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.Iterator;
+import ewe.util.Map.MapEntry;
 import ewe.util.StringTokenizer;
 import ewe.util.Utils;
-import ewe.util.Map.MapEntry;
 import ewesoft.xml.MinML;
 import ewesoft.xml.sax.AttributeList;
 
@@ -754,9 +754,9 @@
 			PrintWriter outp = new PrintWriter(new BufferedWriter(new FileWriter(pathToConfigFile)));
 			outp.print("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" //
 					+ "<preferences>\n" //
-					+ "    <locale language=\"" + SafeXML.clean(language) + "\"/>\n" //
+					+ "    <locale language=\"" + SafeXML.clean(language) + "\" />\n" //
 
-					+ "    <basedir dir=\"" + SafeXML.clean(getBaseDir()) + "\"/>\n"//
+					+ "    <basedir dir=\"" + SafeXML.clean(getBaseDir()) + "\" />\n"//
 
 					+ "    <lastprofile" //
 					+ " autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\"" //
@@ -765,53 +765,53 @@
 
 					+ "    <CurrentCentre" //
 					+ " FromGPSPosition=\"" + SafeXML.strxmlencode(setCurrentCentreFromGPSPosition) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <alias" //
 					+ " name=\"" + SafeXML.clean(myAlias) + "\"" //
 					+ " password=\"" + SafeXML.clean(password) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
-					+ "    <alias2 name=\"" + SafeXML.clean(myAlias2) + "\"/>\n" //
+					+ "    <alias2 name=\"" + SafeXML.clean(myAlias2) + "\" />\n" //
 
 					+ "    <gcmemberid" //
 					+ " name=\"" + SafeXML.clean(gcMemberId) + "\"" //
 					+ " Premium=\"" + SafeXML.strxmlencode(isPremium) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
-					+ "    <browser name=\"" + SafeXML.clean(browser) + "\"/>\n" //
+					+ "    <browser name=\"" + SafeXML.clean(browser) + "\" />\n" //
 
 					+ "    <proxy" //
 					+ " prx=\"" + SafeXML.clean(myproxy) + "\"" //
 					+ " prt=\"" + SafeXML.clean(myproxyport) + "\"" //
 					+ " active=\"" + SafeXML.strxmlencode(proxyActive) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <port" //
 					+ " portname=\"" + SafeXML.clean(mySPO.portName) + "\"" //
 					+ " baud=\"" + SafeXML.strxmlencode(mySPO.baudRate) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <portforward" //
 					+ " active=\"" + SafeXML.strxmlencode(forwardGPS) + "\"" //
 					+ " destinationHost=\"" + SafeXML.clean(forwardGpsHost) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <gpsd" //
 					+ " active=\"" + SafeXML.strxmlencode(useGPSD) + "\"" //
 					+ " host=\"" + SafeXML.clean(gpsdHost) + "\"" //
 					+ " port=\"" + SafeXML.strxmlencode(gpsdPort) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <portlog" //
 					+ " active=\"" + SafeXML.strxmlencode(logGPS) + "\"" //
 					+ " logTimer=\"" + SafeXML.clean(logGPSTimer) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <font" //
 					+ " name=\"" + fontName + "\"" //
 					+ " size=\"" + SafeXML.strxmlencode(fontSize) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <screen" //
 					+ " menuattop=\"" + menuAtTop + "\"" //
@@ -821,28 +821,28 @@
 					+ " h=\"" + myAppHeight + "\"" //
 					+ " w=\"" + myAppWidth + "\"" //
 					+ " useBigIcons=\"" + useBigIcons + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
-					+ "    <fixedsip state=\"" + SafeXML.strxmlencode(fixSIP) + "\"/>\n" //
+					+ "    <fixedsip state=\"" + SafeXML.strxmlencode(fixSIP) + "\" />\n" //
 
 					+ "    <listview" //
 					+ " colmap=\"" + SafeXML.clean(listColMap) + "\"" //
 					+ " colwidths=\"" + SafeXML.clean(listColWidth) + "\"" //
-					+ "/>\n" //
+					+ " />\n" //
 
 					+ "    <travelbugs" //
 					+ " colmap=\"" + SafeXML.clean(travelbugColMap) + "\"" //
 					+ " colwidths=\"" + SafeXML.clean(travelbugColWidth) + "\"" //
 					+ " shownonlogged=\"" + SafeXML.strxmlencode(travelbugShowOnlyNonLogged) + "\"" //
-					+ "/>\n");
+					+ " />\n");
 
 			outp.print("    <descpanel showimages=\"" + SafeXML.strxmlencode(descShowImg) + "\" />\n");
-			outp.print("    <imagepanel showdeletedimages=\"" + SafeXML.strxmlencode(showDeletedImages) + "\"/>\n");
+			outp.print("    <imagepanel showdeletedimages=\"" + SafeXML.strxmlencode(showDeletedImages) + "\" />\n");
 			outp.print("    <hintlogpanel"//
 					+ " logsperpage=\"" + SafeXML.strxmlencode(logsPerPage) + "\"" //
 					+ " initialhintheight=\"" + SafeXML.strxmlencode(initialHintHeight) + "\"" //
 					+ " maxspiderlogs=\"" + SafeXML.strxmlencode(maxLogsToSpider) + "\"" //
-					+ "/>\n");
+					+ " />\n");
 			outp.print("    <solver ignorevariablecase=\"" + SafeXML.strxmlencode(solverIgnoreCase) + "\" degMode=\"" + SafeXML.strxmlencode(solverDegMode) + "\" />\n");
 			outp.print("    <garmin" //
 					+ " connection=\"" + SafeXML.clean(garminConn) + "\"" //
@@ -850,9 +850,9 @@
 					+ " MaxWaypointLength=\"" + SafeXML.strxmlencode(garminMaxLen) + "\"" //
 					+ " addDetailsToWaypoint=\"" + SafeXML.strxmlencode(addDetailsToWaypoint) + "\"" //
 					+ " addDetailsToName=\"" + SafeXML.strxmlencode(addDetailsToName) + "\"" //
-					+ "/>\n");
-			outp.print("    <opencaching lastSite=\"" + lastOCSite + "\" downloadMissing=\"" + SafeXML.strxmlencode(downloadAllOC) + "\"/>\n");
-			outp.print("    <location lat=\"" + SafeXML.clean(curCentrePt.getLatDeg(TransformCoordinates.DD)) + "\" long=\"" + SafeXML.clean(curCentrePt.getLonDeg(TransformCoordinates.DD)) + "\"/>\n");
+					+ " />\n");
+			outp.print("    <opencaching lastSite=\"" + lastOCSite + "\" downloadMissing=\"" + SafeXML.strxmlencode(downloadAllOC) + "\" />\n");
+			outp.print("    <location lat=\"" + SafeXML.clean(curCentrePt.getLatDeg(TransformCoordinates.DD)) + "\" long=\"" + SafeXML.clean(curCentrePt.getLonDeg(TransformCoordinates.DD)) + "\" />\n");
 			outp.print("    <spider" //
 					+ " forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\"" //
 					+ " spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\"" //
@@ -865,15 +865,15 @@
 					+ " downloadTBs=\"" + SafeXML.strxmlencode(downloadTBs) + "\"" //
 					+ " UserID=\"" + SafeXML.clean(userID) + "\"" //
 					+ " getFinds=\"" + SafeXML.strxmlencode(!doNotGetFound) + "\"" //
-					+ "/>\n");
+					+ " />\n");
 			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
-			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
-			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\"/>\n");
+			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\" />\n");
+			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\" />\n");
 			outp.print("    <export numberOfLogsToExport=\"" + SafeXML.strxmlencode(numberOfLogsToExport) + "\" exportTravelbugs=\"" + SafeXML.strxmlencode(exportTravelbugs) + "\" exportGpxAsMyFinds=\"" + SafeXML.strxmlencode(exportGpxAsMyFinds)
-					+ "\"/>\n");
+					+ "\" />\n");
 			outp.print("    <datamover processorMode=\"" + SafeXML.strxmlencode(processorMode) + "\" />\n");
 			if (customMapsPath != null)
-				outp.print("    <mapspath dir=\"" + SafeXML.clean(customMapsPath.replace('\\', '/')) + "\"/>\n");
+				outp.print("    <mapspath dir=\"" + SafeXML.clean(customMapsPath.replace('\\', '/')) + "\" />\n");
 			// Saving filters
 			String[] filterIDs = this.getFilterIDs();
 			for (int i = 0; i < filterIDs.length; i++) {
@@ -887,20 +887,20 @@
 			MapEntry entry;
 			while (itPath.hasNext()) {
 				entry = (MapEntry) itPath.next();
-				outp.print("    <expPath key = \"" + SafeXML.clean(entry.getKey().toString()) + "\" value = \"" + SafeXML.clean(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
+				outp.print("    <expPath key = \"" + SafeXML.clean(entry.getKey().toString()) + "\" value = \"" + SafeXML.clean(entry.getValue().toString().replace('\\', '/')) + "\" />\n");
 			}
 			itPath = importerPaths.entries();
 			while (itPath.hasNext()) {
 				entry = (MapEntry) itPath.next();
-				outp.print("    <impPath key = \"" + SafeXML.clean(entry.getKey().toString()) + "\" value = \"" + SafeXML.clean(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
+				outp.print("    <impPath key = \"" + SafeXML.clean(entry.getKey().toString()) + "\" value = \"" + SafeXML.clean(entry.getValue().toString().replace('\\', '/')) + "\" />\n");
 			}
 			outp.print("    <logkeeping maximum=\"" + SafeXML.strxmlencode(maxLogsToKeep) + "\" keepown=\"" + SafeXML.strxmlencode(alwaysKeepOwnLogs) + "\" />\n");
-			outp.print("    <fillWhiteArea on=\"" + SafeXML.strxmlencode(fillWhiteArea) + "\"/>\n");
+			outp.print("    <fillWhiteArea on=\"" + SafeXML.strxmlencode(fillWhiteArea) + "\" />\n");
 			outp.print("    <mapLoader tileSize=\"" + SafeXML.strxmlencode(mapTileSize) + "\" overlapping=\"" + SafeXML.strxmlencode(mapOverlapping) + "\" tilewidth=\"" + SafeXML.strxmlencode(tilewidth) + "\" tileheight=\""
-					+ SafeXML.strxmlencode(tileheight) + "\"/>\n");
-			outp.print("    <showCachesOnMap on=\"" + SafeXML.strxmlencode(showCachesOnMap) + "\"/>\n");
-			outp.print("    <SortingGroupedByCache on=\"" + SafeXML.strxmlencode(SortingGroupedByCache) + "\"/>\n");
-			outp.print("    <Symbols useOwnSymbols=\"" + SafeXML.strxmlencode(useOwnSymbols) + "\"/>\n");
+					+ SafeXML.strxmlencode(tileheight) + "\" />\n");
+			outp.print("    <showCachesOnMap on=\"" + SafeXML.strxmlencode(showCachesOnMap) + "\" />\n");
+			outp.print("    <SortingGroupedByCache on=\"" + SafeXML.strxmlencode(SortingGroupedByCache) + "\" />\n");
+			outp.print("    <Symbols useOwnSymbols=\"" + SafeXML.strxmlencode(useOwnSymbols) + "\" />\n");
 			if (mobileGUI)
 				// Keep the vmgui switch if it is set
 				outp.print("    <MobileGui value=\"true\" />\n");
@@ -1308,11 +1308,11 @@
 	 *            set by including the line <i>&lt;debug value="true"&gt;&lt;/debug&gt;</i> in the pref.xml file or by
 	 *            manually setting it (i.e. in BE versions or RC versions) by including the line
 	 * 
-	 * <pre>
+	 *            <pre>
 	 * Global.getPref().debug = true;
 	 * </pre>
 	 * 
-	 * in Version.getRelease()
+	 *            in Version.getRelease()
 	 */
 	public void log(String text, Throwable e, boolean withStackTrace) {
 		if (e != null) {



