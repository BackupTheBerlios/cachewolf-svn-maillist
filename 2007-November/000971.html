<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r1078 - in trunk: res_noewe/webmapservices	src/CacheWolf/navi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2007-November/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r1078%20-%20in%20trunk%3A%20res_noewe/webmapservices%0A%09src/CacheWolf/navi&In-Reply-To=%3C200711181420.lAIEKUn1004347%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000970.html">
   <LINK REL="Next"  HREF="000972.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r1078 - in trunk: res_noewe/webmapservices	src/CacheWolf/navi</H1>
    <B>pfeffer at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r1078%20-%20in%20trunk%3A%20res_noewe/webmapservices%0A%09src/CacheWolf/navi&In-Reply-To=%3C200711181420.lAIEKUn1004347%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r1078 - in trunk: res_noewe/webmapservices	src/CacheWolf/navi">pfeffer at mail.berlios.de
       </A><BR>
    <I>Sun Nov 18 15:20:30 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000970.html">[Cachewolf-svn] r1077 - trunk
</A></li>
        <LI>Next message: <A HREF="000972.html">[Cachewolf-svn] r1079 - in trunk/res_noewe: . webmapservices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#971">[ date ]</a>
              <a href="thread.html#971">[ thread ]</a>
              <a href="subject.html#971">[ subject ]</a>
              <a href="author.html#971">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pfeffer
Date: 2007-11-18 15:20:19 +0100 (Sun, 18 Nov 2007)
New Revision: 1078

Modified:
   trunk/res_noewe/webmapservices/de-bw_topo_50.wms
   trunk/res_noewe/webmapservices/de-nrw_topo_25.wms
   trunk/res_noewe/webmapservices/de-rlp_topo_50.wms
   trunk/res_noewe/webmapservices/de_topo_200.wms
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
WMS: now uses the filename of the .wms file in order to create an image filename instead of the friendly name of the service
WMS: friendly name now uniform

Modified: trunk/res_noewe/webmapservices/de-bw_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-bw_topo_50.wms	2007-11-18 13:34:37 UTC (rev 1077)
+++ trunk/res_noewe/webmapservices/de-bw_topo_50.wms	2007-11-18 14:20:19 UTC (rev 1078)
@@ -1,6 +1,6 @@
 TakenFromUrl:	<A HREF="http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten">http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten</A>
 GetCapabilitiesUrl:	<A HREF="http://www.lv-bw.de/dv/capabilities.xml?login=dv&amp;pw=anonymous&amp;REQUEST=GetCapabilities&amp;VERSION=1.1.0&amp;SERVICE=WMS">http://www.lv-bw.de/dv/capabilities.xml?login=dv&amp;pw=anonymous&amp;REQUEST=GetCapabilities&amp;VERSION=1.1.0&amp;SERVICE=WMS</A>
-Name:	de.bw topo 50
+Name:	de.bw Topo 50
 MapType:	topo
 MainUrl:	<A HREF="http://www.lv-bw.de/dv/service/getrds2.asp?login=dv&amp;pw=anonymous&amp;">http://www.lv-bw.de/dv/service/getrds2.asp?login=dv&amp;pw=anonymous&amp;</A>
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de-nrw_topo_25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-nrw_topo_25.wms	2007-11-18 13:34:37 UTC (rev 1077)
+++ trunk/res_noewe/webmapservices/de-nrw_topo_25.wms	2007-11-18 14:20:19 UTC (rev 1078)
@@ -10,7 +10,7 @@
 # 
 TakenFromUrl:	<A HREF="http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten">http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten</A>
 GetCapabilitiesUrl:	<A HREF="http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?REQUEST=GetCapabilities&amp;VERSION=1.1.0&amp;SERVICE=WMS">http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?REQUEST=GetCapabilities&amp;VERSION=1.1.0&amp;SERVICE=WMS</A>
-Name:   de.nrw topo 25
+Name:   de.nrw Topo 25
 MapType:	topo
 MainUrl:	<A HREF="http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/TK25?">http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/TK25?</A>
 ServiceTypeUrlPart:	SERVICE=WMS

Modified: trunk/res_noewe/webmapservices/de-rlp_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-rlp_topo_50.wms	2007-11-18 13:34:37 UTC (rev 1077)
+++ trunk/res_noewe/webmapservices/de-rlp_topo_50.wms	2007-11-18 14:20:19 UTC (rev 1078)
@@ -1,7 +1,7 @@
 # please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	<A HREF="http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten">http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten</A>
 GetCapabilitiesUrl:	<A HREF="http://geodaten.service24.rlp.de/cgi/wms.cgi?REQUEST=GetCapabilities&amp;VERSION=1.1.0&amp;SERVICE=WMS">http://geodaten.service24.rlp.de/cgi/wms.cgi?REQUEST=GetCapabilities&amp;VERSION=1.1.0&amp;SERVICE=WMS</A>
-Name:	de.rlp topo 50
+Name:	de.rlp Topo 50
 MapType:	topo
 MainUrl:	<A HREF="http://geodaten.service24.rlp.de/cgi/wms.cgi?">http://geodaten.service24.rlp.de/cgi/wms.cgi?</A>
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de_topo_200.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_topo_200.wms	2007-11-18 13:34:37 UTC (rev 1077)
+++ trunk/res_noewe/webmapservices/de_topo_200.wms	2007-11-18 14:20:19 UTC (rev 1078)
@@ -10,9 +10,9 @@
 # 
 TakenFromUrl:	<A HREF="http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten">http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten</A>
 GetCapabilitiesUrl:	<A HREF="http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&amp;service=WMS&amp;version=1.1.1&amp;request=GetCapabilities">http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&amp;service=WMS&amp;version=1.1.1&amp;request=GetCapabilities</A>
-Name:	de topo 200
+Name:	de Topo 200
 MainUrl:	<A HREF="http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&amp;">http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&amp;</A>
-MapType: 
+MapType:	topo
 ServiceTypeUrlPart:	SERVICE=WMS
 VersionUrlPart:	VERSION=1.1.0
 CoordinateReferenceSystemCacheWolf:	31468 

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2007-11-18 13:34:37 UTC (rev 1077)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2007-11-18 14:20:19 UTC (rev 1078)
@@ -188,18 +188,25 @@
 	public void setProgressInfoBox (InfoBox progrssInfoboxi) {
 		progressInfobox = progrssInfoboxi;
 	}
-
+	/**
+	 * 
+	 * @param center
+	 * @param scale
+	 * @param pixelsize
+	 * @param path must include trailing &quot;/&quot;
+	 * @throws Exception
+	 */
 	public void downloadMap(CWPoint center, float scale, Point pixelsize, String path) throws Exception {
 		MapInfoObject mio = currentOnlineMapService.getMapInfoObject(center, scale, pixelsize);
 		String filename = createFilename(mio.getCenter(), mio.scale);
 		String imagename = mio.setName(path, filename) + currentOnlineMapService.getImageFileExt();
 		String url = currentOnlineMapService.getUrlForCenterScale(center, scale, pixelsize);
-		downloadImage(url, path+&quot;/&quot;+imagename);
+		downloadImage(url, path+imagename);
 		mio.saveWFL();
 	}
 
 	public String createFilename(CWPoint center, float scale) {
-		String filename = Common.ClearForFileName(currentOnlineMapService.getName()+&quot;_s&quot;+Common.DoubleToString(scale, 1)
+		String filename = Common.ClearForFileName(currentOnlineMapService.getNameForFileSystem()+&quot;_s&quot;+Common.DoubleToString(scale, 1)
 				+ &quot;_c&quot; + center.toString(CWPoint.LAT_LON).replace(',', '-'));
 		return filename;
 	}
@@ -272,8 +279,12 @@
 }
 
 class OnlineMapService {
+	/** Friendly name of the service */
 	String name;
+	/** Type of map (used as directory name when downloading maps. We currently have &quot;topo&quot; and &quot;photo&quot; defined as map types */
 	String mapType;
+	/** Esentially the same as name, but used for the file system. It will be part of the names of the downloaded images */ 
+	String filename;
 	String MainUrl; //<A HREF="http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS">http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS</A>
 	/** including &quot;.&quot; */
 	String imageFileExt; // &quot;.gif&quot;, &quot;.jpg&quot;...
@@ -305,6 +316,17 @@
 	public String getName() {
 		return name;
 	}
+
+	/** 
+	 * This method is called to get a name of the 
+	 * online map service which will be part of the filename
+	 * used for the downloaded image
+	 * @return friendly service name
+	 */
+	public String getNameForFileSystem() {
+		return filename;
+	}
+
 	public String getMapType() {
 		return mapType;
 	}
@@ -390,11 +412,13 @@
 	 * @throws IOException
 	 * @throws IllegalArgumentException
 	 */
-	public WebMapService (String filename) throws IOException, IllegalArgumentException{
-		FileInputStream in = new FileInputStream(filename);
+	public WebMapService (String filename_) throws IOException, IllegalArgumentException{
+		FileInputStream in = new FileInputStream(filename_);
 		Properties wms = new Properties();
 		wms.load(in);
 		in.close();
+		String tmp = File.getFileExt(filename_);
+		this.filename = File.getFileExt(tmp).substring(0, tmp.lastIndexOf('.'));
 		name = wms.getProperty(&quot;Name&quot;, &quot;&quot;).trim();
 		if (name == &quot;&quot;) throw new IllegalArgumentException(&quot;WebMapService: property &gt;Name:&lt; missing in file:\n&quot; + filename);
 		MainUrl = wms.getProperty(&quot;MainUrl&quot;, &quot;&quot;).trim();;
@@ -403,7 +427,7 @@
 		serviceTypeUrlPart = wms.getProperty(&quot;ServiceTypeUrlPart&quot;, &quot;SERVICE=WMS&quot;).trim();
 		layersUrlPart = wms.getProperty(&quot;LayersUrlPart&quot;, &quot;&quot;).trim();;
 		versionUrlPart = wms.getProperty(&quot;VersionUrlPart&quot;, &quot;&quot;).trim();;
-		String tmp = wms.getProperty(&quot;CoordinateReferenceSystemCacheWolf&quot;, &quot;&quot;).trim();
+		tmp = wms.getProperty(&quot;CoordinateReferenceSystemCacheWolf&quot;, &quot;&quot;).trim();
 		if (tmp.equals(&quot;&quot;)) throw new IllegalArgumentException(&quot;WebMapService: no CoordinateReferenceSystemCacheWolf given&quot;);
 		String[] tmp2 = mString.split(tmp, ' ');
 		coordinateReferenceSystem = new int[tmp2.length];
@@ -594,6 +618,7 @@
 
 	public ExpediaMapService() {
 		name = &quot;Expedia&quot;;
+		filename = &quot;expedia&quot;;
 		MainUrl = &quot;<A HREF="Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&amp;ID=3kQaz.">Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&amp;ID=3kQaz.</A>&quot;; //&quot;<A HREF="Rhttp://">Rhttp://</A>&quot; forces doenloadUrl to retry the URL until it gets an http-redirect and then downloads from there 
 		imageFileExt = &quot;.gif&quot;;
 		mapType = &quot;expedia&quot;;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000970.html">[Cachewolf-svn] r1077 - trunk
</A></li>
	<LI>Next message: <A HREF="000972.html">[Cachewolf-svn] r1079 - in trunk/res_noewe: . webmapservices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#971">[ date ]</a>
              <a href="thread.html#971">[ thread ]</a>
              <a href="subject.html#971">[ subject ]</a>
              <a href="author.html#971">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
