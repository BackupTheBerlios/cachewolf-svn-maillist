From admin at berlios.de  Fri May  4 07:58:30 2007
From: admin at berlios.de (admin at berlios.de)
Date: Thu, 3 May 2007 21:58:30 -0800 (AKDT)
Subject: [Cachewolf-svn] [Feature #3379] markieren des ersten Caches in Liste
Message-ID: <200705040558.l445wUtD025671@unicorn.berlios.de>

Feature Request #3379, was updated on 2007-May-03 21:58
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3379&group_id=2211

Category: None
Status: Open
Priority: 5
Summary: markieren des ersten Caches in Liste

By: cw-tester
Date: 2007-May-03 21:58

Message:
Logged In: YES 
user_id=30505
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

um  ein korrektes Zusammenspiel Listansicht-Radar zu
erhalten ist es notwendig beim Start von CW den ersten
Cache automatisch zu markieren. Nur wenn ein Cache in
der Liste markiert ist wird bei Klick im Radar richtig
zur?ck in die Liste gesprungen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3379&group_id=2211


From salzkammergut at mail.berlios.de  Sat May  5 16:46:32 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 5 May 2007 16:46:32 +0200
Subject: [Cachewolf-svn] r676 - in trunk: resources src/CacheWolf
Message-ID: <200705051446.l45EkWn3001495@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-05 16:46:21 +0200 (Sat, 05 May 2007)
New Revision: 676

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
Log:
Export zu Garmin: Die Generierung von Kurznamen anstatt der geocaching.com Namen (GCxxxxx) kann ueber die Praeferenzen eingestellt werden

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-04-29 17:50:03 UTC (rev 675)
+++ trunk/resources/cachewolf.Languages.cfg	2007-05-05 14:46:21 UTC (rev 676)
@@ -59,6 +59,8 @@
 		170=Basisverzeichnis f%fc die Profile w%e4hlen
 		171=Profil existiert nicht:+
 		172=Kann das Kartenverzeichnis nicht erstellen:%0a
+		173=Garmin: PC Port:
+		174=Kurznamen
 		200=Details
 		201=Beschreibung
 		202=Bilder
@@ -402,6 +404,8 @@
 		170=Select base directory for cache data
 		171=Profile does not exist:+
 		172=Error: cannot create maps directory:%0a
+		173=Garmin: PC Port:
+		174=Short Names
 		200=Details
 		201=Description
 		202=Images

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2007-04-29 17:50:03 UTC (rev 675)
+++ trunk/src/CacheWolf/MainMenu.java	2007-05-05 14:46:21 UTC (rev 676)
@@ -264,10 +264,12 @@
 				loc.doIt(LocExporter.MODE_AUTO);
 				ProgressBarForm.display(MyLocale.getMsg(950,"Transfer"),MyLocale.getMsg(951,"Sending to GPS"), null);
 				try{
-					ewe.sys.Process p = Vm.exec("gpsbabel -s -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
-					Vm.debug("gpsbabel -i geo -f  \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					ewe.sys.Process p = Vm.exec("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					Vm.debug("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f  \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
 					p.waitFor();
-				}catch(IOException ioex){};
+				}catch(IOException ioex){
+					(new MessageBox("Error", "Garmin export unsuccessful", MessageBox.OKB)).execute();
+				};
 				ProgressBarForm.clear();
 				Vm.showWait(false);
 			}

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2007-04-29 17:50:03 UTC (rev 675)
+++ trunk/src/CacheWolf/Preferences.java	2007-05-05 14:46:21 UTC (rev 676)
@@ -56,6 +56,7 @@
 	public String lastSyncOC[] = {"","","",""};
 	public String lastDistOC[] = {"","","",""};
 	public String garminConn="com1";  // The type of connection which GPSBABEL uses: com1 OR usb.
+	public String garminGPSBabelOptions=""; // Additional options for GPSBabel, i.e. -s to synthethize short names
 	// These settings govern where the menu and the tabs are displayed and whether the statusbas is shown
 	public boolean menuAtTop=true;
 	public boolean tabsAtTop=true;
@@ -411,8 +412,8 @@
 		}
 		if (name.equals("garmin")) {
 			garminConn=atts.getValue("connection");
+			garminGPSBabelOptions=atts.getValue("GPSBabelOptions");
 		}
-
 		if(name.equals("tableType")){ 
 			tablePrefs[1] = Convert.parseInt(atts.getValue("active"));
 			tmp = atts.getValue("width");
@@ -555,7 +556,7 @@
 			outp.print("    <font size =\""+fontSize+"\"/>\n");
 			outp.print("	<browser name = \""+browser+"\"/>\n");
 			outp.print("    <fixedsip state = \""+fixSIP+"\"/>\n");
-			outp.print("    <garmin connection = \""+garminConn+"\"/>\n");
+			outp.print("    <garmin connection = \""+garminConn+"\" GPSBabelOptions = \""+garminGPSBabelOptions+"\" />\n");
 			outp.print("    <lastprofile autoreload=\""+autoReloadLastProfile+"\">"+lastProfile+"</lastprofile>\n"); //RB
 			outp.print("    <screen menuattop=\""+menuAtTop+"\" tabsattop=\""+tabsAtTop+"\" showstatus=\""+showStatus+"\" hasclosebutton=\""+hasCloseButton+"\"/>\n");
 			outp.print("    <imagepanel showdeletedimages=\""+showDeletedImages+"\"/>\n");

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2007-04-29 17:50:03 UTC (rev 675)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2007-05-05 14:46:21 UTC (rev 676)
@@ -17,15 +17,17 @@
 	mChoice NS, EW;
 	mInput NSDeg, NSm, EWDeg, EWm, DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, inpGPS, inpLogsPerPage;
 	mCheckBox dif, ter, loc, own, hid, stat, dist, bear, chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, 
-	          chkTabsAtTop, chkShowStatus,chkHasCloseButton;
+	          chkTabsAtTop, chkShowStatus,chkHasCloseButton,chkSynthShort;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
+	mLabel lblGarmin;
 	
 	Preferences pref;
 	
 	CellPanel pnlGeneral = new CellPanel();
 	CellPanel pnlDisplay = new CellPanel();
 	CellPanel pnlMore = new CellPanel();
+	Frame frmGarmin = new Frame();
 	ScrollBarPanel scp;
 	String [] garminPorts= new String[]{"com1","com2","com3","com4","com5","com6","com7","usb"};
 	
@@ -74,9 +76,18 @@
 		pnlGeneral.addLast(fontSize = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		ProxyPort.setText(pref.myproxyport);
 		fontSize.setText(Convert.toString(pref.fontSize));
-		pnlGeneral.addNext(new mLabel("Garmin PC Port"));
-		pnlGeneral.addNext(chcGarminPort=new mChoice(garminPorts,0));
+		// Garmin and GPSBabel
+		frmGarmin.addNext(lblGarmin=new mLabel(MyLocale.getMsg(173,"Garmin:  PC Port:")),DONTSTRETCH,LEFT);
+		lblGarmin.setTag(INSETS,new Insets(4,0,0,0));
+		frmGarmin.addNext(chcGarminPort=new mChoice(garminPorts,0),DONTSTRETCH,LEFT);
+		chcGarminPort.setTag(INSETS,new Insets(4,0,0,0));
 		chcGarminPort.selectItem(pref.garminConn);
+		frmGarmin.addLast(chkSynthShort=new mCheckBox(MyLocale.getMsg(174,"Short Names")),STRETCH,RIGHT);
+		chkSynthShort.setTag(INSETS,new Insets(4,0,0,0));
+		chkSynthShort.setState(!pref.garminGPSBabelOptions.equals(""));
+		frmGarmin.borderStyle=CellPanel.BDR_RAISEDOUTER|CellPanel.BDR_SUNKENINNER|CellPanel.BF_TOP;
+		frmGarmin.setTag(INSETS,new Insets(4,0,0,0));
+		pnlGeneral.addLast(frmGarmin);
 		pnlGeneral.addLast(new mLabel(""));
 		
 		/////////////////////////////////////////////////////////
@@ -188,6 +199,7 @@
 				pref.autoReloadLastProfile=chkAutoLoad.getState();
 				pref.showDeletedImages=chkShowDeletedImg.getState();
 				pref.garminConn=chcGarminPort.getSelectedItem().toString();
+				pref.garminGPSBabelOptions=chkSynthShort.state?"-s":"";
 				pref.menuAtTop=chkMenuAtTop.getState();
 				pref.tabsAtTop=chkTabsAtTop.getState();
 				pref.showStatus=chkShowStatus.getState();



From salzkammergut at mail.berlios.de  Sun May  6 23:18:58 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 6 May 2007 23:18:58 +0200
Subject: [Cachewolf-svn] r677 - trunk/src/CacheWolf
Message-ID: <200705062118.l46LIwN5009858@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-06 23:18:49 +0200 (Sun, 06 May 2007)
New Revision: 677

Modified:
   trunk/src/CacheWolf/MainMenu.java
Log:
Garmin Export: Bessere Fehlermeldungen

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2007-05-05 14:46:21 UTC (rev 676)
+++ trunk/src/CacheWolf/MainMenu.java	2007-05-06 21:18:49 UTC (rev 677)
@@ -264,11 +264,13 @@
 				loc.doIt(LocExporter.MODE_AUTO);
 				ProgressBarForm.display(MyLocale.getMsg(950,"Transfer"),MyLocale.getMsg(951,"Sending to GPS"), null);
 				try{
-					ewe.sys.Process p = Vm.exec("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
-					Vm.debug("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f  \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					pref.log("gpsbabel.exe "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					ewe.sys.Process p = Vm.exec("gpsbabel.exe "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
 					p.waitFor();
 				}catch(IOException ioex){
+					Vm.showWait(false);
 					(new MessageBox("Error", "Garmin export unsuccessful", MessageBox.OKB)).execute();
+					pref.log("Error exporting to Garmin",ioex);
 				};
 				ProgressBarForm.clear();
 				Vm.showWait(false);



From salzkammergut at mail.berlios.de  Sat May 12 19:26:30 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 12 May 2007 19:26:30 +0200
Subject: [Cachewolf-svn] r678 - trunk/src/CacheWolf
Message-ID: <200705121726.l4CHQUpJ020019@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-12 19:26:26 +0200 (Sat, 12 May 2007)
New Revision: 678

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Nachtrag zur GPSBabelOption (vermeidet die Fehlermeldung beim erstmaligen Erstellen)

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2007-05-06 21:18:49 UTC (rev 677)
+++ trunk/src/CacheWolf/Preferences.java	2007-05-12 17:26:26 UTC (rev 678)
@@ -412,7 +412,8 @@
 		}
 		if (name.equals("garmin")) {
 			garminConn=atts.getValue("connection");
-			garminGPSBabelOptions=atts.getValue("GPSBabelOptions");
+			tmp = atts.getValue("GPSBabelOptions");
+			if (tmp != null) garminGPSBabelOptions=tmp;
 		}
 		if(name.equals("tableType")){ 
 			tablePrefs[1] = Convert.parseInt(atts.getValue("active"));



From salzkammergut at mail.berlios.de  Sat May 12 22:39:22 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 12 May 2007 22:39:22 +0200
Subject: [Cachewolf-svn] r679 - trunk/src/CacheWolf
Message-ID: <200705122039.l4CKdMY3003669@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-12 22:39:17 +0200 (Sat, 12 May 2007)
New Revision: 679

Modified:
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/TablePanel.java
Log:
Beim Start von CW die erste Zeile grau hinterlegen

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2007-05-12 17:26:26 UTC (rev 678)
+++ trunk/src/CacheWolf/MainForm.java	2007-05-12 20:39:17 UTC (rev 679)
@@ -92,6 +92,7 @@
 		}
 		mMenu.setTablePanel(mTab.getTablePanel());
 		infB.close(0);
+		mTab.tbP.selectFirstRow();
 		Vm.showWait(false);
 	}
 

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2007-05-12 17:26:26 UTC (rev 678)
+++ trunk/src/CacheWolf/TablePanel.java	2007-05-12 20:39:17 UTC (rev 679)
@@ -54,14 +54,23 @@
 	/** Mark the row as selected so that myTableModel can color it grey */
 	public void selectRow(int row) {
 		setSelectedCache(row);
+		tc.scrollToVisible(row,0);
 		tc.cursorTo(row, tc.cursor.x+tc.listMode, true);
-		//tc.scrollToVisible(row,0);
 		/*tc.clearSelection(null);
 		tc.addToSelection(row,0); 
 		tc.addToSelection(row,myMod.MAXCOLUMNS-1);*/ 
 		//tc.paintSelectedCells();
 	}
 	
+	/** Highlight the first row in grey. It can be unhighlighted by clicking */
+	public void selectFirstRow() {
+		myMod.cursorSize=new Dimension(-1,1);
+		if (cacheDB.size()>0) {
+			tc.addToSelection(0,0); 
+			tc.addToSelection(0,myMod.MAXCOLUMNS-1);
+		}
+	}
+	
 	/** Returns the index of the currently selected cache or -1 of the cache is no longer visible
 	 * due to a sort/filter or search operation
 	 * @return index of selected cache (-1 if not visible)



From admin at berlios.de  Sat May 12 22:55:09 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 12 May 2007 22:55:09 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3379] markieren des ersten Caches in Liste
Message-ID: <200705122055.l4CKt95V026537@unicorn.berlios.de>

Feature Request #3379, was updated on 2007-May-04 07:58
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3379&group_id=2211

Category: None
Status: Closed
Priority: 5
Summary: markieren des ersten Caches in Liste

By: salzkammergut
Date: 2007-May-12 22:55

Message:
Logged In: YES 
user_id=33713
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

Mit Rev 679 gefixt

----------------------------------------------------------------------

By: cw-tester
Date: 2007-May-04 07:58

Message:
Logged In: YES 
user_id=30505
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

um  ein korrektes Zusammenspiel Listansicht-Radar zu
erhalten ist es notwendig beim Start von CW den ersten
Cache automatisch zu markieren. Nur wenn ein Cache in
der Liste markiert ist wird bei Klick im Radar richtig
zur?ck in die Liste gesprungen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3379&group_id=2211


From salzkammergut at mail.berlios.de  Wed May 16 00:06:05 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 16 May 2007 00:06:05 +0200
Subject: [Cachewolf-svn] r680 - trunk/src/CacheWolf
Message-ID: <200705152206.l4FM65dS002186@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-16 00:06:01 +0200 (Wed, 16 May 2007)
New Revision: 680

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Bessere Fehlermeldung im Spider bei erster Seite

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-12 20:39:17 UTC (rev 679)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-15 22:06:01 UTC (rev 680)
@@ -95,7 +95,7 @@
 				doc += "&" + URL.encodeURL("cookie",false) +"="+ URL.encodeURL("on",false);
 				doc += "&" + URL.encodeURL("Button1",false) +"="+ URL.encodeURL("Login",false);
 				start = fetch_post("http://www.geocaching.com/login/Default.aspx", doc, "/login/default.aspx");
-				pref.log("Login successfull");
+				pref.log("Login successful");
 			}catch(Exception ex){
 				//Vm.debug("Could not login: gc.com start page");
 				pref.log("Login failed.");
@@ -260,7 +260,7 @@
 		String postStr = new String();
 		String dummy = "";
 		Regex rexLine;
-		String ln;
+		String ln=null;
 		String wpt = "";
 		String loganal;
 		CacheHolder ch;
@@ -301,10 +301,11 @@
 		infB.exec();
 		//Get first page
 		try{
-			ln = new String("http://www.geocaching.com/seek/nearest.aspx?lat=" + origin.getLatDeg(CWPoint.DD) + "&lon=" +origin.getLonDeg(CWPoint.DD));
+			ln = "http://www.geocaching.com/seek/nearest.aspx?lat=" + origin.getLatDeg(CWPoint.DD) + "&lon=" +origin.getLonDeg(CWPoint.DD);
 			if(doNotgetFound) ln = ln + "&f=1";
+			pref.log("Getting first page: "+ln);
 			start = fetch(ln);
-			pref.log("Got first page: " + ln);
+			pref.log("Got first page");
 		}catch(Exception ex){
 			infB.close(0);
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5503,"Error fetching first list page."), MessageBox.OKB)).execute();
@@ -917,7 +918,7 @@
 				////Vm.debug(c_data.toString());
 				sock.close();
 			}catch(IOException ioex){
-				pref.log("IOException in fetch");
+				pref.log("IOException in fetch", ioex);
 			}finally{
 				//continue
 			}



From salzkammergut at mail.berlios.de  Thu May 17 23:11:04 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 17 May 2007 23:11:04 +0200
Subject: [Cachewolf-svn] r681 - trunk/src/CacheWolf
Message-ID: <200705172111.l4HLB4kL025107@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-17 23:11:02 +0200 (Thu, 17 May 2007)
New Revision: 681

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Aenderung wegen Update von GC

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-15 22:06:01 UTC (rev 680)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-17 21:11:02 UTC (rev 681)
@@ -652,8 +652,8 @@
 
 		Extractor spanBlock = new Extractor(doc, "<span id=\"Images\"", "</span>", 0 , true);
 		tst = spanBlock.findNext();
-		Extractor exImgName = new Extractor(tst, "style='text-decoration: underline;'>", "</A><br>", 0 , true);
-		exImgSrc = new Extractor(tst, "&nbsp;<A HREF='http://", "' target=", 0, true);
+		Extractor exImgName = new Extractor(tst, "align=absmiddle border=0>", "</a><br/>", 0 , true);
+		exImgSrc = new Extractor(tst, "<A HREF='http://", "' rel='lightbox'", 0, true);
 		while(exImgSrc.endOfSearch() == false){
 			imgUrl = exImgSrc.findNext();
 			//Vm.debug("Img Url: " +imgUrl);



From salzkammergut at mail.berlios.de  Fri May 18 21:02:42 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Fri, 18 May 2007 21:02:42 +0200
Subject: [Cachewolf-svn] r682 - trunk/src/CacheWolf
Message-ID: <200705181902.l4IJ2gph021831@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-18 21:02:36 +0200 (Fri, 18 May 2007)
New Revision: 682

Modified:
   trunk/src/CacheWolf/FilterScreen.java
Log:
FilterScreen: Bugfix: Aktualisierung der Farbe des Richtungs-Panels

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2007-05-17 21:11:02 UTC (rev 681)
+++ trunk/src/CacheWolf/FilterScreen.java	2007-05-18 19:02:36 UTC (rev 682)
@@ -624,6 +624,7 @@
 				chkNE.state   = chkENE.state  = chkE.state    = chkESE.state  = 
 				chkSE.state   = chkSSE.state  = chkS.state    = chkSSW.state  = 
 				chkSW.state   = chkWSW.state  = chkW.state    = chkWNW.state = false; 
+				setColors();
 				repaint();
 					
 			} else if (ev.target == btnSelect) {
@@ -631,6 +632,7 @@
 				chkNE.state   = chkENE.state  = chkE.state    = chkESE.state  = 
 				chkSE.state   = chkSSE.state  = chkS.state    = chkSSW.state  = 
 				chkSW.state   = chkWSW.state  = chkW.state    = chkWNW.state = true; 
+				setColors();
 				repaint();	
 			}
 		}



From salzkammergut at mail.berlios.de  Sun May 20 23:08:26 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 20 May 2007 23:08:26 +0200
Subject: [Cachewolf-svn] r683 - in trunk: resources src/CacheWolf src/exp
Message-ID: <200705202108.l4KL8QDT006554@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-20 23:08:14 +0200 (Sun, 20 May 2007)
New Revision: 683

Added:
   trunk/resources/calendar.png
   trunk/src/CacheWolf/DateFormat.java
Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/GPXImporter.java
   trunk/src/CacheWolf/MyComparer.java
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SpiderGC.java
   trunk/src/exp/GPXExporter.java
Log:
Ueberarbeitung der Datumsdarstellung:
- Einheitliches format yyyy-mm-dd fuer versteckt und gefunden Datum
  (Die Index.xml wird dynamisch auf dieses Format umgestellt)
- Wenn im Cachestatus ein Datum steht, ist dies das Gefunden Datum
  (Dadurch kann jetzt nach Gefunden Datum sortiert werden)
- Im Detailspanel Verwendung von DatumsPicker zur leichteren Auswahl
  des versteckt/gefunden Datums
- GCSpider, Opencaching Import und GPX Import setzten ueber die Logs 
  automatisch das Gefunden Datum

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/resources/cachewolf.Languages.cfg	2007-05-20 21:08:14 UTC (rev 683)
@@ -56,7 +56,7 @@
 		160=Selektierte
 		161=Zeige Blacklist
 		162=kalibrierte herunterladen
-		170=Basisverzeichnis f%fc die Profile w%e4hlen
+		170=Basisverzeichnis f%fcr die Profile w%e4hlen
 		171=Profil existiert nicht:+
 		172=Kann das Kartenverzeichnis nicht erstellen:%0a
 		173=Garmin: PC Port:
@@ -96,6 +96,8 @@
 		325=Zuwenige Referenzpunkte, Karte nicht kalibriert
 		326=Es steht keine kalibrierte Karte zur Verf%fcgung %0a Bitte w%e4hlen Sie einen Ma%dfstab,%0a in dem der Track und die markierten Caches angezeigt werden sollen
 		327=Information
+		328=Gefunden am
+		329=Versteckt am
 		340=Cachebilder:
 		341=Eigene Bilder:
 		342=Gel%f6scht
@@ -442,6 +444,8 @@
 		325=Not enough reference points, map not calibrated
 		326=No calibrated map available. %0a Please select a scale to display the track and caches.
 		327=Information
+		328=Date found
+		329=Hidden on
 		340=Cache Images:
 		341=User Images:
 		342=Deleted

Added: trunk/resources/calendar.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/calendar.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/CacheWolf/DateFormat.java
===================================================================
--- trunk/src/CacheWolf/DateFormat.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/CacheWolf/DateFormat.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -0,0 +1,53 @@
+package CacheWolf;
+/* Several date formats are used by GC.COM
+ *    2/27/2004   - Hidden dates are in format mm/dd/yyyy (=US style)
+ *    February 27 - Found dates which happened this year
+ *    February 27, 2004 - Found date in previous year
+ * The internal standard is sortable:
+ *    2004-02-27    - YYYY-MM-DD   
+ */
+import ewe.sys.*;
+
+public class DateFormat {
+
+/** Convert the US Format into a sortable format */
+static String MDY2YMD(String date) {
+	// Dates are in format M/D/Y
+	int p1,p2=-1;
+	p1=date.indexOf("/");
+	if (p1>0) p2=date.indexOf("/",p1+1);
+	if (p1>0 && p2>0) {
+		return date.substring(p2+1)+"-"+
+		        (p1==1?"0":"")+date.substring(0,p1)+"-"+
+		        (p1+2==p2?"0":"")+date.substring(p1+1,p2);
+	} else
+		return date;
+}
+
+/* Convert the sortable date into a US date */
+//static String YMD2MDY(String date) {
+//	return date.substring(4,6)+"/"+date.substring(6,8)+"/"+date.substring(0,4);
+//}
+
+/** Convert the log format into a sortable format */
+static String logdate2YMD(String logdate) {
+   String monthNames[]={"January","February","March","April","May","June","July","August","September","October","November","December"};
+   Time t=new Time();
+   String year,month,day;
+   int i,m;
+   logdate+=", "+t.year; // If logdate already has a year, this one is ignored
+   i=logdate.indexOf(',');
+   year=logdate.substring(i+2,i+6);
+   for (m=0; m<12; m++) {
+	   if (logdate.startsWith(monthNames[m])) {
+		   month=(m<9?"0":"")+Convert.formatInt(m+1);
+		   day=logdate.substring(monthNames[m].length()+1,i);
+		   if (day.length()==1)day="0"+day;
+		   return year+"-"+month+"-"+day;
+	   }
+   }
+   return "";
+}
+
+
+}

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -23,6 +23,7 @@
 	mChoice chcSize = new mChoice(new String[]{"", "Micro", "Small", "Regular", "Large","Other","Very Large","None"},0);
 	mComboBox chcStatus = new mComboBox(new String[]{"", MyLocale.getMsg(313,"Flag 1"), MyLocale.getMsg(314,"Flag 2"), MyLocale.getMsg(315,"Flag 3"), MyLocale.getMsg(316,"Flag 4"), MyLocale.getMsg(317,"Search"), MyLocale.getMsg(318,"Found"), MyLocale.getMsg(319,"Not Found"), MyLocale.getMsg(320,"Owner")},0);
 	mButton btnNewWpt, btnShowBug, btnShowMap, btnGoto, btnAddPicture, btnBlack, btnNotes, btnSave, btnCancel;
+	mButton btnFoundDate,btnHiddenDate;
 	Vector cacheDB;
 	CacheHolder thisCache;
 	CellPanel pnlTools = new CellPanel(); 
@@ -96,13 +97,21 @@
 		this.addLast(btnWayLoc.setTag(Control.SPAN, new Dimension(2,1)),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		
 		this.addNext(new mLabel(MyLocale.getMsg(305,"Hidden on:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		this.addLast(inpHidden.setTag(Control.SPAN, new Dimension(2,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		
+		CellPanel ip=new CellPanel();
+		ip.addNext(inpHidden,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		ip.addLast(btnHiddenDate=new mButton(new mImage("calendar.png")),DONTSTRETCH,DONTFILL);
+		this.addLast(ip,DONTSTRETCH,HFILL).setTag(Control.SPAN, new Dimension(2,1));
+		inpHidden.modifyAll(DisplayOnly,0);
+		
 		this.addNext(new mLabel(MyLocale.getMsg(306,"Owner:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		this.addLast(inpOwner.setTag(Control.SPAN, new Dimension(2,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		
 		this.addNext(new mLabel(MyLocale.getMsg(307,"Status:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		this.addLast(chcStatus.setTag(Control.SPAN, new Dimension(2,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		CellPanel cp=new CellPanel();
+		cp.addNext(chcStatus,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		cp.addLast(btnFoundDate=new mButton(new mImage("calendar.png")),DONTSTRETCH,DONTFILL);
+		this.addLast(cp,DONTSTRETCH,HFILL).setTag(Control.SPAN, new Dimension(2,1));
 		
 		btnNotes = new mButton("Notes");
 		this.addLast(btnNotes.setTag(Control.SPAN, new Dimension(3,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
@@ -129,8 +138,13 @@
 	    btnWayLoc.setText(ch.pos.toString());
 		inpHidden.setText(ch.DateHidden);
 		inpOwner.setText(ch.CacheOwner);
-		chcStatus.setText(ch.CacheStatus);
-		
+		if (ch.CacheStatus.length()>=10 && ch.CacheStatus.charAt(4)=='-')
+			chcStatus.setText(MyLocale.getMsg(318,"Found")+" "+ch.CacheStatus);
+		else {
+			chcStatus.setText(ch.CacheStatus);
+			// If the cache status contains a date, do not overwrite it with 'found' message
+			if(ch.is_found == true) chcStatus.setText(MyLocale.getMsg(318,"Found"));
+		}
 		chcType.setInt(transType(ch.type));
 		if(ch.is_black){
 			btnBlack.image = imgBlack;
@@ -155,8 +169,6 @@
 		if(ch.CacheSize.equals("Very Large")) chcSize.setInt(6);
 		if(ch.CacheSize.equals("None")) chcSize.setInt(7);
 		if(ch.CacheSize.equals("Not chosen")) chcSize.setInt(7);
-
-		if(ch.is_found == true) chcStatus.setText(MyLocale.getMsg(318,"Found"));
 	}
 	
 	
@@ -317,6 +329,35 @@
 					if (center.isValid()) thisCache.calcDistance(center);
 				}
 			}
+			else if (ev.target==btnFoundDate) {
+				DateChooser.dayFirst=true;
+				DateChooser dc=new DateChooser(Vm.getLocale());
+				dc.title=MyLocale.getMsg(328,"Date found"); 
+				dc.setPreferredSize(240,240);
+				if (dc.execute()==ewe.ui.FormBase.IDOK) {
+				  chcStatus.setText(MyLocale.getMsg(318,"Found")+" "+Convert.toString(dc.year)+"-"+MyLocale.formatLong(dc.month,"00")+"-"+MyLocale.formatLong(dc.day,"00"));
+				  dirty_details=true;
+				}
+			}
+			else if (ev.target==btnHiddenDate) {
+				DateChooser.dayFirst=true;
+				DateChooser dc=new DateChooser(Vm.getLocale());
+				dc.title=MyLocale.getMsg(329,"Hidden date"); 
+				dc.setPreferredSize(240,240);
+				if (inpHidden.getText().length()==10)
+				try {
+					dc.setDate(new Time(
+						Convert.parseInt(inpHidden.getText().substring(8)),
+					    Convert.parseInt(inpHidden.getText().substring(5,7)),
+						Convert.parseInt(inpHidden.getText().substring(0,4))));
+				} catch (NumberFormatException e) {
+					dc.reset(new Time());
+				}
+				if (dc.execute()==ewe.ui.FormBase.IDOK) {
+				  inpHidden.setText(Convert.toString(dc.year)+"-"+MyLocale.formatLong(dc.month,"00")+"-"+MyLocale.formatLong(dc.day,"00"));
+				  dirty_details=true;
+				}
+			}
 			ev.consumed=true;
 		}
 	}
@@ -324,13 +365,18 @@
 	public void saveDirtyWaypoint() {
 		CacheHolder ch;
 		  ch = (CacheHolder)cacheDB.get(Global.mainTab.tbP.getSelectedCache());
-		  ch.CacheStatus = chcStatus.getText();
-		  ch.is_found = ch.CacheStatus.equals(MyLocale.getMsg(318,"Found"));
+		  // Strip the found message if the status contains a date
+		  if (chcStatus.getText().startsWith(MyLocale.getMsg(318,"Found")) && 
+				  chcStatus.getText().length()==MyLocale.getMsg(318,"Found").length()+11)
+			  ch.CacheStatus = chcStatus.getText().substring(MyLocale.getMsg(318,"Found").length()+1);
+		  else	  
+			  ch.CacheStatus = chcStatus.getText();
+		  ch.is_found = chcStatus.getText().startsWith(MyLocale.getMsg(318,"Found"));
 		  ch.is_owned = ch.CacheStatus.equals(MyLocale.getMsg(320,"Owner"));
 		  // Avoid setting is_owned if alias is empty and username is empty
 		  if(ch.is_owned == false){
-		  ch.is_owned = (!pref.myAlias.equals("") && pref.myAlias.equals(ch.CacheOwner)) || 
-				        (!pref.myAlias2.equals("") && pref.myAlias2.equals(ch.CacheOwner));
+			  ch.is_owned = (!pref.myAlias.equals("") && pref.myAlias.equals(ch.CacheOwner)) || 
+					        (!pref.myAlias2.equals("") && pref.myAlias2.equals(ch.CacheOwner));
 		  }
 		  ch.is_black = blackStatus;
 		  ch.wayPoint = inpWaypoint.getText().trim();

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -231,6 +231,11 @@
 			}
 			if (name.equals("groundspeak:finder")|| name.equals("geocacher")){
 				logFinder = new String(strData);
+				if(logIcon.equals("<img src='icon_smile.gif'>&nbsp;") && 
+				  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
+					holder.CacheStatus=logDate;
+					holder.is_found=true;
+				}
 				return;
 			}
 			if (name.equals("groundspeak:text") || name.equals("text")){ 
@@ -262,7 +267,7 @@
 				}
 				holder.noFindLogs = z;
 				zaehlerGel++;
-				infB.setInfo( (MyLocale.getMsg(4000,"Loaded caches") + ":" + zaehlerGel));
+				if (zaehlerGel % 5==1) infB.setInfo( (MyLocale.getMsg(4000,"Loaded caches") + ":" + zaehlerGel));
 				holder.is_new = true;
 				cacheDB.add(holder);
 				//Vm.debug("here B");
@@ -341,11 +346,11 @@
 		}
 		
 		if (name.equals("time") && inWpt) {
-			String Date = new String();
-			Date = strData.substring(5,7); // month
-			Date += "/" + strData.substring(8,10); // day
-			Date += "/" + strData.substring(0,4); // year
-			holder.DateHidden = Date;
+			//String Date = new String();
+			//Date = strData.substring(5,7); // month
+			//Date += "/" + strData.substring(8,10); // day
+			//Date += "/" + strData.substring(0,4); // year
+			holder.DateHidden = strData.substring(0,10); //Date;
 			return;
 		}
 		// cache information

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/CacheWolf/MyComparer.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -71,16 +71,7 @@
 		} else if (what.equals(nmHid)) {
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=(CacheHolder) cacheDB.get(i);
-				// Dates are in format M/D/Y
-				int p1,p2=-1;
-				p1=ch.DateHidden.indexOf("/");
-				if (p1>0) p2=ch.DateHidden.indexOf("/",p1+1);
-				if (p1>0 && p2>0) {
-					ch.sort=ch.DateHidden.substring(p2+1)+
-					        (p1==1?"0":"")+ch.DateHidden.substring(0,p1)+
-					        (p1+2==p2?"0":"")+ch.DateHidden.substring(p1+1,p2);
-				} else
-					ch.sort="";
+				ch.sort=ch.DateHidden;
 			}
 		} else if (what.equals(nmStat)) {
 			for (int i=0; i<visibleSize; i++) {

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -311,8 +311,8 @@
 			switch (logtype) {
 			case 1: 
 				logIcon = GPXImporter.typeText2Image("Found"); 
-				if (logFinder.equalsIgnoreCase(user)) { // see also endCacheLog
-					holder.is_found = true;
+				if (logFinder.equalsIgnoreCase(user) || logFinder.equalsIgnoreCase(pref.myAlias2)) { // see also endCacheLog
+					holder.is_found = true; 
 					holder.CacheStatus = MyLocale.getMsg(318,"Found");
 				}
 				break;
@@ -419,11 +419,11 @@
 			return;
 		}
 		if(name.equals("datehidden")) {
-			String Date = new String();
-			Date = strData.substring(5,7); // month
-			Date += "/" + strData.substring(8,10); // day
-			Date += "/" + strData.substring(0,4); // year
-			holder.DateHidden = Date;
+			//String Date = new String();
+			//Date = strData.substring(5,7); // month
+			//Date += "/" + strData.substring(8,10); // day
+			//Date += "/" + strData.substring(0,4); // year
+			holder.DateHidden = strData.substring(0,10); //Date;
 			return;
 		}
 	}
@@ -565,11 +565,14 @@
 
 		if (name.equals("date"))  {
 			logDate = new String(strData);
+			if (holder.is_found) {
+				holder.CacheStatus=strData.substring(0,10);
+			}
 			return;
 		}
 		if (name.equals("userid")){
 			logFinder = new String(strData);
-			if(logFinder.toLowerCase().compareTo(user) == 0 && logtype == 1){
+			if((logFinder.toLowerCase().compareTo(user) == 0 || logFinder.equalsIgnoreCase(pref.myAlias2)) && logtype == 1){
 				holder.is_found = true; // see startCacheLog - in the current .xml this is set by startCacheLog but we sequence in the xml from opencaching might change, so I leave this also here
 				holder.CacheStatus = MyLocale.getMsg(318,"Found");
 			}

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/CacheWolf/Profile.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -289,7 +289,9 @@
 						ch.LatLon = SafeXML.cleanback(ex.findNext());
 						ch.pos.set(ch.LatLon,CWPoint.CW);
 					}
-					ch.DateHidden = ex.findNext();
+					ch.DateHidden = ex.findNext(); 
+					// Convert the US format to YYYY-MM-DD if necessary
+					if (ch.DateHidden.indexOf('/')>-1) ch.DateHidden=DateFormat.MDY2YMD(ch.DateHidden);
 					ch.wayPoint = SafeXML.cleanback(ex.findNext());
 					ch.CacheStatus = ex.findNext();
 					ch.type = ex.findNext();

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -200,7 +200,7 @@
 				pref.log("Got owner");
 				//Vm.debug("Owner: " + ch.CacheOwner);
 				pref.log("Trying date hidden");
-				ch.DateHidden = getDateHidden(start);
+				ch.DateHidden = DateFormat.MDY2YMD(getDateHidden(start));
 				pref.log("Got date hidden");
 				//Vm.debug("Hidden: " + ch.DateHidden);
 				pref.log("Trying hints");
@@ -846,12 +846,13 @@
 			//Vm.debug("--------------------------------------------");
 			icon = exIcon.findNext();
 			name = exName.findNext();
+			String d=DateFormat.logdate2YMD(exDate.findNext());
 			if((icon.equals("icon_smile.gif") || icon.equals("icon_camera.gif")) && 
 				(name.equals(pref.myAlias) || (pref.myAlias2.length()>0 && name.equals(pref.myAlias2))) )  {
 				ch.is_found = true;
-				ch.CacheStatus = MyLocale.getMsg(318,"Found");
+				ch.CacheStatus = d;
 			}
-			reslts.add("<img src='"+ icon +"'>&nbsp;" + exDate.findNext()+ " " + name + exLog.findNext());
+			reslts.add("<img src='"+ icon +"'>&nbsp;" + d + " " + name + exLog.findNext());
 			
 			singleLog = exSingleLog.findNext();
 			exIcon.setSource(singleLog);

Modified: trunk/src/exp/GPXExporter.java
===================================================================
--- trunk/src/exp/GPXExporter.java	2007-05-18 19:02:36 UTC (rev 682)
+++ trunk/src/exp/GPXExporter.java	2007-05-20 21:08:14 UTC (rev 683)
@@ -51,7 +51,7 @@
 		try{
 			strBuf.append("  <wpt lat=\""+lat+"\" lon=\""+lon+"\">\r\n");
 			if (ch.DateHidden.length()> 0){
-				tim.parse(ch.DateHidden, "M/d/y");
+				tim.parse(ch.DateHidden, "y-M-d");
 			}
 			else {
 				tim.setText("2000-01-01");



From salzkammergut at mail.berlios.de  Tue May 22 18:02:57 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 22 May 2007 18:02:57 +0200
Subject: [Cachewolf-svn] r684 - trunk/src/CacheWolf
Message-ID: <200705221602.l4MG2vvN030670@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-22 18:02:50 +0200 (Tue, 22 May 2007)
New Revision: 684

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Das Warte-Icon, das das Loginfenster ueberlagerte wurde entfernt

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-20 21:08:14 UTC (rev 683)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-22 16:02:50 UTC (rev 684)
@@ -88,7 +88,7 @@
 			}
 			//Ok now login!
 			try{
-				pref.log("Logging in");
+				pref.log("Logging in as "+pref.myAlias);
 				doc = URL.encodeURL("__VIEWSTATE",false) +"="+ URL.encodeURL(viewstate,false);
 				doc += "&" + URL.encodeURL("myUsername",false) +"="+ URL.encodeURL(pref.myAlias,false);
 				doc += "&" + URL.encodeURL("myPassword",false) +"="+ URL.encodeURL(passwort,false);
@@ -269,24 +269,21 @@
 			(new MessageBox("Error", "Coordinates for center must be set", MessageBox.OKB)).execute();
 			return;
 		}
-		Vm.showWait(true);
 		String start = "";
 		Regex rex = new Regex("name=\"__VIEWSTATE\" value=\"(.*)\" />");
 		String doc = "";
 		
 		int ok = login();
 		if(ok == Form.IDCANCEL) {
-			Vm.showWait(false);
 			return;
 		}
 		if(ok == ERR_LOGIN){
-			Vm.showWait(false);
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5501,"Login failed!"), MessageBox.OKB)).execute();
 			return;
 		}
 		OCXMLImporterScreen options = new OCXMLImporterScreen("Spider Options", OCXMLImporterScreen.INCLUDEFOUND);
 		options.distanceInput.setText("");
-		if (options.execute() == OCXMLImporterScreen.IDCANCEL) {Vm.showWait(false);	return; }
+		if (options.execute() == OCXMLImporterScreen.IDCANCEL) {return; }
 		String dist = options.distanceInput.getText();
 		if (dist.length()== 0) return;
 		distance = Convert.toDouble(dist);
@@ -296,7 +293,7 @@
 		boolean getImages = options.imagesCheckBox.getState();
 		options.close(0);
 		
-		
+		Vm.showWait(true);
 		infB = new InfoBox("Status", MyLocale.getMsg(5502,"Fetching first page..."));
 		infB.exec();
 		//Get first page



From salzkammergut at mail.berlios.de  Tue May 22 18:11:42 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 22 May 2007 18:11:42 +0200
Subject: [Cachewolf-svn] r685 - trunk/src/CacheWolf
Message-ID: <200705221611.l4MGBgoL032475@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-22 18:11:40 +0200 (Tue, 22 May 2007)
New Revision: 685

Modified:
   trunk/src/CacheWolf/TablePanel.java
Log:
TablePanel: Fix fuer graue Hinterlegung des aktiven Caches (hoffentlich jetzt endgueltig)


Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2007-05-22 16:02:50 UTC (rev 684)
+++ trunk/src/CacheWolf/TablePanel.java	2007-05-22 16:11:40 UTC (rev 685)
@@ -54,12 +54,12 @@
 	/** Mark the row as selected so that myTableModel can color it grey */
 	public void selectRow(int row) {
 		setSelectedCache(row);
+		tc.addToSelection(row,0); 
+		tc.addToSelection(row,myMod.MAXCOLUMNS-1);
+		// Ensure that the highlighted row is visible (e.g. when coming from radar panel)
 		tc.scrollToVisible(row,0);
+		// Next line needed for key scrolling 
 		tc.cursorTo(row, tc.cursor.x+tc.listMode, true);
-		/*tc.clearSelection(null);
-		tc.addToSelection(row,0); 
-		tc.addToSelection(row,myMod.MAXCOLUMNS-1);*/ 
-		//tc.paintSelectedCells();
 	}
 	
 	/** Highlight the first row in grey. It can be unhighlighted by clicking */



From kalli at mail.berlios.de  Tue May 22 22:09:47 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Tue, 22 May 2007 22:09:47 +0200
Subject: [Cachewolf-svn] r686 - trunk/src/CacheWolf
Message-ID: <200705222009.l4MK9lUR003889@sheep.berlios.de>

Author: kalli
Date: 2007-05-22 22:08:54 +0200 (Tue, 22 May 2007)
New Revision: 686

Modified:
   trunk/src/CacheWolf/GPXImporter.java
   trunk/src/CacheWolf/ImagePanel.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Laden von Bildern beim GPX-Import geht wieder, es werden die Methoden von SpiderGC genutzt.
Kleiner Hack, damit die ?\195?\156berschrift "Eigene Bilder" nicht den Titel "Cachebilder" ?\195?\188berschreibt.

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-05-22 16:11:40 UTC (rev 685)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-05-22 20:08:54 UTC (rev 686)
@@ -37,6 +37,7 @@
 	public static final int DOIT_NOSPOILER = 1;
 	public static final int DOIT_WITHSPOILER = 2;
 	boolean getMaps = false;
+	SpiderGC imgSpider;
 		
 	public GPXImporter(Preferences p, Profile prof, String f )
 	{
@@ -99,7 +100,10 @@
 			//getMaps = options.mapsCheckBox.getState();
 			boolean getImages = options.imagesCheckBox.getState();
 			doSpider = false;
-			if(getImages){doSpider = true;}
+			if(getImages){
+				doSpider = true;
+				imgSpider = new SpiderGC(pref, profile, false);
+			}
 			options.close(0);
 			
 			//Vm.debug("State of: " + doSpider);
@@ -287,7 +291,8 @@
 							}
 						}
 					if(holder.wayPoint.startsWith("GC")) {
-						spiderImages();
+						//spiderImages();
+						spiderImagesUsingSpider();
 						//Rename image sources
 						String text = new String();
 						String orig = new String();
@@ -548,172 +553,19 @@
 			return INTR.intValue();
 		} else return -1;
 	}
-	
-	private void spiderImages(){
-		//Vm.debug("Spider now: " + holder.wayPoint);
-		Extractor cacheEx;
+	private void spiderImagesUsingSpider(){
 		String addr = new String();
-		String longDesc = new String();
-		String dummy = new String();
-		String dummy2 = new String();
-		String imageType = new String();
-		String datei = new String();
-		int imgCounter = 0;
-		HttpConnection connImg;
-		Socket sockImg;
-		//InputStream is;
-		FileOutputStream fos;
-		//int bytes_read;
-		//byte[] buffer = new byte[9000];
-		ByteArray daten;
 		String cacheText = new String();
 		
+		// just to be sure to have a spider object
+		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile, false);
+		
 		addr = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + holder.wayPoint ;
-		try{
 			//Vm.debug(addr + "|");
-			cacheText = fetch(addr);
-		}catch(IOException iox){
-			Vm.debug("Error fetching cache page from gc.com");
-			Vm.debug(iox.toString());
-			spiderOK = false;
-			cacheText = "";
-		}
-		cacheText = replace(cacheText, "<strong>", "<STRONG>");
-		// Images in the cache long description
-		cacheEx = new Extractor(cacheText, "<span id=\"ShortDescription\">", "<STRONG>Additional Hints&nbsp;",0,true);
-		longDesc = cacheEx.findNext();
-		//Vm.debug(longDesc);
-		if(longDesc.length() == 0) {
-			cacheEx = new Extractor(cacheText, "<span id=\"LongDescription\">", "<STRONG>Additional Hints&nbsp;",0,true);
-			longDesc = cacheEx.findNext();
-		}
-		longDesc = STRreplace.replace(longDesc, "IMG", "img");
-		longDesc = STRreplace.replace(longDesc, "SRC", "src");
-		cacheEx = new Extractor(longDesc, "<img", ">", 0, true);
-		String dummySrc = new String();
-		dummySrc = cacheEx.findNext();
-		dummySrc = replace(dummySrc, "SRC", "src");
-		dummySrc =dummySrc.replace('\'', '\"');
-		Extractor dummySrcExt;
-		while(cacheEx.endOfSearch() == false){
-			dummySrcExt = new Extractor(dummySrc, "src=\"", "\"",0,true);
-			dummy = dummySrcExt.findNext();
-			if(dummy.length() == 0){
-				dummySrcExt = new Extractor(dummySrc, "src = \"", "\"",0,true);
-				dummy = dummySrcExt.findNext();
-			}
-			//Vm.debug("Trying for: " + holder.wayPoint + " / " + dummySrc);
-			//Vm.debug("Url = " + dummy);
-			if(dummy.length()>0){
-				if(pref.myproxy.length()>0){
-					connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), dummy);
-				}else{
-					connImg = new HttpConnection(dummy);
-				}
-				connImg.setRequestorProperty("Connection", "close");
-				imageType = dummy.substring(dummy.lastIndexOf("."), dummy.lastIndexOf(".")+4);
-				if(!imageType.equals("com") && !imageType.equals("php") && !imageType.equals("exe")){
-					datei = profile.dataDir + holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType;
-					//if(imageType.equals(".png") || imageType.equals(".gif") || imageType.equals(".tif") || imageType.equals(".jpg")){
-						try{
-							sockImg = connImg.connect();
-							daten = connImg.readData(connImg.connect());
-							fos = new FileOutputStream(new File(datei));
-							fos.write(daten.toBytes());
-							fos.close();
-							sockImg.close();
-							holder.Images.add(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-							//Vm.debug(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-							holder.ImagesText.add(dummy.substring(dummy.lastIndexOf("/")+1, dummy.lastIndexOf("/")+1+dummy.length()-dummy.lastIndexOf("/")-1));
-							//Vm.debug("adding...." +dummy.substring(dummy.lastIndexOf("/")+1, dummy.lastIndexOf("/")+1+dummy.length()-dummy.lastIndexOf("/")-1));
-						} catch (UnknownHostException e) { 
-							Vm.debug("Host not there...");
-						}catch(IOException ioex){
-							Vm.debug("File not found!");
-						} catch (Exception ex){
-							Vm.debug("Some kind of problem!");
-						} finally {
-							//Vm.debug("This is stupid!!");
-						}
-						imgCounter++;
-				}
-			}
-			dummySrc = cacheEx.findNext();
-			//Vm.debug("Dummy SRC = " + dummySrc);
-			dummySrc = replace(dummySrc, "SRC", "src");
-			dummySrc =dummySrc.replace('\'', '\"');
-		}
-		
-		// Images in the image span
-		cacheEx = new Extractor(cacheText, "<span id=\"Images\"", "</span>",0,true);
-		longDesc = cacheEx.findNext();
-		//Vm.debug("In image span: " + longDesc);
-		cacheEx = new Extractor(longDesc, ";<A HREF='http://img.geocaching.com/cache/", "' target='_blank'", 0, true);
-		dummy = cacheEx.findNext();
-		//Vm.debug("And this is the target: " + dummy);
-		Extractor imgEx = new Extractor(longDesc, "style='text-decoration: underline;'>","</A>",0,true);
-		dummy2 = imgEx.findNext();
-		while(cacheEx.endOfSearch() == false){
-			dummy = "http://img.geocaching.com/cache/"+dummy;
-			//Vm.debug("Target= " +dummy);
-			if(pref.myproxy.length()>0){
-				connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), dummy);
-			}else{
-				connImg = new HttpConnection(dummy);
-			}
-			connImg.setRequestorProperty("Connection", "close");
-			imageType = dummy.substring(dummy.lastIndexOf("."), dummy.lastIndexOf(".")+4);
-			if(!imageType.equals("com") && !imageType.equals("php") && !imageType.equals("exe")){
-				datei = profile.dataDir + holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType;
-				try{
-					sockImg = connImg.connect();
-					daten = connImg.readData(sockImg);
-					fos = new FileOutputStream(new File(datei));
-					fos.write(daten.toBytes());
-					fos.close();
-					sockImg.close();
-					holder.Images.add(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-					holder.ImagesText.add(dummy2);
-					//Vm.debug(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-					//Vm.debug(dummy2);
-				}catch(IOException ioex){
-					Vm.debug("File not found!");
-				}
-				imgCounter++;
-			}
-			dummy = cacheEx.findNext();
-			dummy2 = imgEx.findNext();
-		}
-		
+		cacheText = SpiderGC.fetch(addr);
+		imgSpider.getImages(cacheText, holder);
 	}
 	
-	private static String fetch(String address) throws IOException
-	   	{
-			HttpConnection conn;
-			if(pref.myproxy.length() > 0){
-				conn = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), address);
-				//Vm.debug(address);
-			} else {
-				conn = new HttpConnection(address);
-			}
-			
-			conn.setRequestorProperty("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-			
-			conn.setRequestorProperty("Connection", "close");
-			
-			conn.documentIsEncoded = true;
-			
-			Socket sock = conn.connect();
-			
-			ByteArray daten = conn.readData(sock);
-			
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			//Vm.debug(c_data.toString());
-			sock.close();
-			return c_data.toString();
-		}
-	
 	public static String replace(String source, String pattern, String replace){
 		if (source!=null)
 		{

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2007-05-22 16:11:40 UTC (rev 685)
+++ trunk/src/CacheWolf/ImagePanel.java	2007-05-22 20:08:54 UTC (rev 686)
@@ -63,11 +63,13 @@
 		if(locCounter==1 || locCounter ==2) locY = locY + thumb_size;
 		//Vm.debug("thumb_size: " + Convert.toString(thumb_size));
 		//Vm.debug("locy after: " + Convert.toString(locY));
-		addTitle(MyLocale.getMsg(341,"User Images:"));
-		locY = locY + 20;
-		locX = padding;
-		locCounter = 0;
-		addImages(cache.UserImages,cache.UserImagesText);
+		if (cache.UserImages.getCount()> 0){
+			addTitle(MyLocale.getMsg(341,"User Images:"));
+			locY = locY + 20;
+			locX = padding;
+			locCounter = 0;
+			addImages(cache.UserImages,cache.UserImagesText);
+		}
 		
 		this.refresh();
 		Vm.showWait(false);

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-22 16:11:40 UTC (rev 685)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-22 20:08:54 UTC (rev 686)
@@ -884,7 +884,7 @@
 	*	it will be a gc.com address. This method is used to obtain
 	*	the result of a search for caches screen.
 	*/
-	private static String fetch(String address)
+	public static String fetch(String address)
 	   	{	
 			CharArray c_data;
 			String data = new String();



From bilbowolf at mail.berlios.de  Tue May 22 22:37:51 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Tue, 22 May 2007 22:37:51 +0200
Subject: [Cachewolf-svn] r687 - trunk/src/CacheWolf
Message-ID: <200705222037.l4MKbptS006314@sheep.berlios.de>

Author: bilbowolf
Date: 2007-05-22 22:37:48 +0200 (Tue, 22 May 2007)
New Revision: 687

Modified:
   trunk/src/CacheWolf/GPXImporter.java
   trunk/src/CacheWolf/Version.java
Log:


Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-05-22 20:08:54 UTC (rev 686)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-05-22 20:37:48 UTC (rev 687)
@@ -562,8 +562,127 @@
 		
 		addr = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + holder.wayPoint ;
 			//Vm.debug(addr + "|");
+<<<<<<< .mine
+			cacheText = fetch(addr);
+		}catch(IOException iox){
+			Vm.debug("Error fetching cache page from gc.com");
+			Vm.debug(iox.toString());
+			spiderOK = false;
+			cacheText = "";
+		}
+		cacheText = replace(cacheText, "<strong>", "<STRONG>");
+		// Images in the cache long description
+		cacheEx = new Extractor(cacheText, "<span id=\"ShortDescription\">", "<STRONG>Additional Hints&nbsp;",0,true);
+		longDesc = cacheEx.findNext();
+		//Vm.debug(longDesc);
+		if(longDesc.length() == 0) {
+			cacheEx = new Extractor(cacheText, "<span id=\"LongDescription\">", "<STRONG>Additional Hints&nbsp;",0,true);
+			longDesc = cacheEx.findNext();
+		}
+		longDesc = STRreplace.replace(longDesc, "IMG", "img");
+		longDesc = STRreplace.replace(longDesc, "SRC", "src");
+		cacheEx = new Extractor(longDesc, "<img", ">", 0, true);
+		String dummySrc = new String();
+		dummySrc = cacheEx.findNext();
+		dummySrc = replace(dummySrc, "SRC", "src");
+		dummySrc =dummySrc.replace('\'', '\"');
+		Extractor dummySrcExt;
+		while(cacheEx.endOfSearch() == false){
+			dummySrc = STRreplace.replace(dummySrc, " ", "");
+			dummySrc = STRreplace.replace(dummySrc, "\n", "");
+			dummySrcExt = new Extractor(dummySrc, "src=\"", "\"",0,true);
+			dummy = dummySrcExt.findNext();
+			if(dummy.length() == 0){
+				dummySrcExt = new Extractor(dummySrc, "src = \"", "\"",0,true);
+				dummy = dummySrcExt.findNext();
+			}
+			Vm.debug("Trying for: " + holder.wayPoint + " / " + dummySrc);
+			Vm.debug("Url = " + dummy);
+			if(dummy.length()>0){
+				if(pref.myproxy.length()>0){
+					connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), dummy);
+				}else{
+					connImg = new HttpConnection(dummy);
+				}
+				connImg.setRequestorProperty("Connection", "close");
+				imageType = dummy.substring(dummy.lastIndexOf("."), dummy.lastIndexOf(".")+4);
+				if(!imageType.equals("com") && !imageType.equals("php") && !imageType.equals("exe")){
+					datei = profile.dataDir + holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType;
+					//if(imageType.equals(".png") || imageType.equals(".gif") || imageType.equals(".tif") || imageType.equals(".jpg")){
+						try{
+							sockImg = connImg.connect();
+							daten = connImg.readData(connImg.connect());
+							fos = new FileOutputStream(new File(datei));
+							fos.write(daten.toBytes());
+							fos.close();
+							sockImg.close();
+							holder.Images.add(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
+							//Vm.debug(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
+							holder.ImagesText.add(dummy.substring(dummy.lastIndexOf("/")+1, dummy.lastIndexOf("/")+1+dummy.length()-dummy.lastIndexOf("/")-1));
+							//Vm.debug("adding...." +dummy.substring(dummy.lastIndexOf("/")+1, dummy.lastIndexOf("/")+1+dummy.length()-dummy.lastIndexOf("/")-1));
+						} catch (UnknownHostException e) { 
+							Vm.debug("Host not there...");
+						}catch(IOException ioex){
+							Vm.debug("File not found!");
+						} catch (Exception ex){
+							Vm.debug("Some kind of problem!");
+						} finally {
+							//Vm.debug("This is stupid!!");
+						}
+						imgCounter++;
+				}
+			}
+			dummySrc = cacheEx.findNext();
+			//Vm.debug("Dummy SRC = " + dummySrc);
+			dummySrc = replace(dummySrc, "SRC", "src");
+			dummySrc =dummySrc.replace('\'', '\"');
+		}
+		
+		// Images in the image span
+		cacheEx = new Extractor(cacheText, "<span id=\"Images\"", "</span>",0,true);
+		longDesc = cacheEx.findNext();
+		//Vm.debug("In image span: " + longDesc);
+		cacheEx = new Extractor(longDesc, ";<A HREF='http://img.geocaching.com/cache/", "' target='_blank'", 0, true);
+		dummy = cacheEx.findNext();
+		//Vm.debug("And this is the target: " + dummy);
+		Extractor imgEx = new Extractor(longDesc, "style='text-decoration: underline;'>","</A>",0,true);
+		dummy2 = imgEx.findNext();
+		while(cacheEx.endOfSearch() == false){
+			dummy = "http://img.geocaching.com/cache/"+dummy;
+			//Vm.debug("Target= " +dummy);
+			if(pref.myproxy.length()>0){
+				connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), dummy);
+			}else{
+				connImg = new HttpConnection(dummy);
+			}
+			connImg.setRequestorProperty("Connection", "close");
+			imageType = dummy.substring(dummy.lastIndexOf("."), dummy.lastIndexOf(".")+4);
+			if(!imageType.equals("com") && !imageType.equals("php") && !imageType.equals("exe")){
+				datei = profile.dataDir + holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType;
+				try{
+					sockImg = connImg.connect();
+					daten = connImg.readData(sockImg);
+					fos = new FileOutputStream(new File(datei));
+					fos.write(daten.toBytes());
+					fos.close();
+					sockImg.close();
+					holder.Images.add(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
+					holder.ImagesText.add(dummy2);
+					//Vm.debug(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
+					//Vm.debug(dummy2);
+				}catch(IOException ioex){
+					Vm.debug("File not found!");
+				}
+				imgCounter++;
+			}
+			dummy = cacheEx.findNext();
+			dummy2 = imgEx.findNext();
+		}
+		
+=======
 		cacheText = SpiderGC.fetch(addr);
 		imgSpider.getImages(cacheText, holder);
+>>>>>>> .r686
 	}
 	
 	public static String replace(String source, String pattern, String replace){

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2007-05-22 20:08:54 UTC (rev 686)
+++ trunk/src/CacheWolf/Version.java	2007-05-22 20:37:48 UTC (rev 687)
@@ -18,7 +18,7 @@
 	public static String getRelease() {
 		 // habe die SVN-Nummer doch aus der Anzeige erstmal wieder herausgenommen, weil es in einem final Release doch recht seltsam auss?he.
 		 // Sinnvoll w?re daher vielleicht, eine Methode getReleaseDatail, die die SVN-Versionnummer mit angibt und z.B. im "?ber"-Dialog angezeigt werden k?nnte.
-		return VER_MAJOR + VER_MINOR + VER_BUILD + VER_SVN.substring(VER_SVN.indexOf(" "), VER_SVN.lastIndexOf(" "));
+		return VER_MAJOR + VER_MINOR; //+ VER_BUILD + VER_SVN.substring(VER_SVN.indexOf(" "), VER_SVN.lastIndexOf(" "));
 	}
 	
 	public boolean newVersionAvailable(Preferences pref){



From bilbowolf at mail.berlios.de  Tue May 22 22:54:25 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Tue, 22 May 2007 22:54:25 +0200
Subject: [Cachewolf-svn] r688 - trunk/src/CacheWolf
Message-ID: <200705222054.l4MKsPUm007807@sheep.berlios.de>

Author: bilbowolf
Date: 2007-05-22 22:54:20 +0200 (Tue, 22 May 2007)
New Revision: 688

Modified:
   trunk/src/CacheWolf/GPXImporter.java
Log:
Musste einen conflict beheben. Diese version ist identisch mit der 686 von Kalli

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-05-22 20:37:48 UTC (rev 687)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-05-22 20:54:20 UTC (rev 688)
@@ -562,127 +562,8 @@
 		
 		addr = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + holder.wayPoint ;
 			//Vm.debug(addr + "|");
-<<<<<<< .mine
-			cacheText = fetch(addr);
-		}catch(IOException iox){
-			Vm.debug("Error fetching cache page from gc.com");
-			Vm.debug(iox.toString());
-			spiderOK = false;
-			cacheText = "";
-		}
-		cacheText = replace(cacheText, "<strong>", "<STRONG>");
-		// Images in the cache long description
-		cacheEx = new Extractor(cacheText, "<span id=\"ShortDescription\">", "<STRONG>Additional Hints&nbsp;",0,true);
-		longDesc = cacheEx.findNext();
-		//Vm.debug(longDesc);
-		if(longDesc.length() == 0) {
-			cacheEx = new Extractor(cacheText, "<span id=\"LongDescription\">", "<STRONG>Additional Hints&nbsp;",0,true);
-			longDesc = cacheEx.findNext();
-		}
-		longDesc = STRreplace.replace(longDesc, "IMG", "img");
-		longDesc = STRreplace.replace(longDesc, "SRC", "src");
-		cacheEx = new Extractor(longDesc, "<img", ">", 0, true);
-		String dummySrc = new String();
-		dummySrc = cacheEx.findNext();
-		dummySrc = replace(dummySrc, "SRC", "src");
-		dummySrc =dummySrc.replace('\'', '\"');
-		Extractor dummySrcExt;
-		while(cacheEx.endOfSearch() == false){
-			dummySrc = STRreplace.replace(dummySrc, " ", "");
-			dummySrc = STRreplace.replace(dummySrc, "\n", "");
-			dummySrcExt = new Extractor(dummySrc, "src=\"", "\"",0,true);
-			dummy = dummySrcExt.findNext();
-			if(dummy.length() == 0){
-				dummySrcExt = new Extractor(dummySrc, "src = \"", "\"",0,true);
-				dummy = dummySrcExt.findNext();
-			}
-			Vm.debug("Trying for: " + holder.wayPoint + " / " + dummySrc);
-			Vm.debug("Url = " + dummy);
-			if(dummy.length()>0){
-				if(pref.myproxy.length()>0){
-					connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), dummy);
-				}else{
-					connImg = new HttpConnection(dummy);
-				}
-				connImg.setRequestorProperty("Connection", "close");
-				imageType = dummy.substring(dummy.lastIndexOf("."), dummy.lastIndexOf(".")+4);
-				if(!imageType.equals("com") && !imageType.equals("php") && !imageType.equals("exe")){
-					datei = profile.dataDir + holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType;
-					//if(imageType.equals(".png") || imageType.equals(".gif") || imageType.equals(".tif") || imageType.equals(".jpg")){
-						try{
-							sockImg = connImg.connect();
-							daten = connImg.readData(connImg.connect());
-							fos = new FileOutputStream(new File(datei));
-							fos.write(daten.toBytes());
-							fos.close();
-							sockImg.close();
-							holder.Images.add(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-							//Vm.debug(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-							holder.ImagesText.add(dummy.substring(dummy.lastIndexOf("/")+1, dummy.lastIndexOf("/")+1+dummy.length()-dummy.lastIndexOf("/")-1));
-							//Vm.debug("adding...." +dummy.substring(dummy.lastIndexOf("/")+1, dummy.lastIndexOf("/")+1+dummy.length()-dummy.lastIndexOf("/")-1));
-						} catch (UnknownHostException e) { 
-							Vm.debug("Host not there...");
-						}catch(IOException ioex){
-							Vm.debug("File not found!");
-						} catch (Exception ex){
-							Vm.debug("Some kind of problem!");
-						} finally {
-							//Vm.debug("This is stupid!!");
-						}
-						imgCounter++;
-				}
-			}
-			dummySrc = cacheEx.findNext();
-			//Vm.debug("Dummy SRC = " + dummySrc);
-			dummySrc = replace(dummySrc, "SRC", "src");
-			dummySrc =dummySrc.replace('\'', '\"');
-		}
-		
-		// Images in the image span
-		cacheEx = new Extractor(cacheText, "<span id=\"Images\"", "</span>",0,true);
-		longDesc = cacheEx.findNext();
-		//Vm.debug("In image span: " + longDesc);
-		cacheEx = new Extractor(longDesc, ";<A HREF='http://img.geocaching.com/cache/", "' target='_blank'", 0, true);
-		dummy = cacheEx.findNext();
-		//Vm.debug("And this is the target: " + dummy);
-		Extractor imgEx = new Extractor(longDesc, "style='text-decoration: underline;'>","</A>",0,true);
-		dummy2 = imgEx.findNext();
-		while(cacheEx.endOfSearch() == false){
-			dummy = "http://img.geocaching.com/cache/"+dummy;
-			//Vm.debug("Target= " +dummy);
-			if(pref.myproxy.length()>0){
-				connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), dummy);
-			}else{
-				connImg = new HttpConnection(dummy);
-			}
-			connImg.setRequestorProperty("Connection", "close");
-			imageType = dummy.substring(dummy.lastIndexOf("."), dummy.lastIndexOf(".")+4);
-			if(!imageType.equals("com") && !imageType.equals("php") && !imageType.equals("exe")){
-				datei = profile.dataDir + holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType;
-				try{
-					sockImg = connImg.connect();
-					daten = connImg.readData(sockImg);
-					fos = new FileOutputStream(new File(datei));
-					fos.write(daten.toBytes());
-					fos.close();
-					sockImg.close();
-					holder.Images.add(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-					holder.ImagesText.add(dummy2);
-					//Vm.debug(holder.wayPoint + "_" + Convert.toString(imgCounter)+ imageType);
-					//Vm.debug(dummy2);
-				}catch(IOException ioex){
-					Vm.debug("File not found!");
-				}
-				imgCounter++;
-			}
-			dummy = cacheEx.findNext();
-			dummy2 = imgEx.findNext();
-		}
-		
-=======
 		cacheText = SpiderGC.fetch(addr);
 		imgSpider.getImages(cacheText, holder);
->>>>>>> .r686
 	}
 	
 	public static String replace(String source, String pattern, String replace){



From bilbowolf at mail.berlios.de  Wed May 23 08:12:11 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Wed, 23 May 2007 08:12:11 +0200
Subject: [Cachewolf-svn] r689 - trunk/src
Message-ID: <200705230612.l4N6CB8O008425@sheep.berlios.de>

Author: bilbowolf
Date: 2007-05-23 08:12:09 +0200 (Wed, 23 May 2007)
New Revision: 689

Added:
   trunk/src/src/
Log:
Die Entwicklung zur 1.0 geh?\195?\182rt hier hin.

Copied: trunk/src/src (from rev 688, trunk/src)



From bilbowolf at mail.berlios.de  Wed May 23 08:15:42 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Wed, 23 May 2007 08:15:42 +0200
Subject: [Cachewolf-svn] r690 - branches
Message-ID: <200705230615.l4N6Fg7F008645@sheep.berlios.de>

Author: bilbowolf
Date: 2007-05-23 08:15:36 +0200 (Wed, 23 May 2007)
New Revision: 690

Added:
   branches/1.0/
Log:
Entwicklungstrang f?\195?\188r die 1.0

Copied: branches/1.0 (from rev 689, trunk/src)



From admin at berlios.de  Wed May 23 16:58:36 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 16:58:36 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1976] Meilen
Message-ID: <200705231458.l4NEwane029040@unicorn.berlios.de>

Feature Request #1976, was updated on 2006-Mar-16 21:19
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211

Category: 0.9n
Status: Open
Priority: 4
Summary: Meilen

By: bilbowolf
Date: 2006-Mar-16 21:19

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.1) Gecko/20060111 Firefox/1.5.0.1

Cachewolf sollte auch mit Meilen umgehen k?nnen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211


From admin at berlios.de  Wed May 23 17:01:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:01:16 +0200 (CEST)
Subject: [Feature #3171] Linkshnder und die Stiftbedienung...
Message-ID: <200705231501.l4NF1G4a003296@unicorn.berlios.de>

Feature Request #3171, was updated on 2007-Feb-22 12:27
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3171&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Linksh?nder und die Stiftbedienung...

By: cw-tester
Date: 2007-Feb-22 12:27

Message:
Logged In: YES 
user_id=30505
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

Ist es m?glich, die Scroll-Leiste von der rechten
Bildschirmseite auf die linke Seite zu verlegen?

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3171&group_id=2211


From admin at berlios.de  Wed May 23 17:01:11 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:01:11 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3220] mehrere Caches in die Blcckliste
Message-ID: <200705231501.l4NF1Bpm003159@unicorn.berlios.de>

Feature Request #3220, was updated on 2007-Mar-10 10:57
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3220&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: mehrere Caches in die Blcckliste

By: cw-tester
Date: 2007-Mar-10 10:57

Message:
Logged In: YES 
user_id=30505
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.0.3705; .NET CLR 2.0.50727)

Mittels markieren von Caches in der Listansicht und 
entsprechendem Kontextmen? mehrere Caches 
gleichzeitig in die Blackliste aufnehmen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3220&group_id=2211


From admin at berlios.de  Wed May 23 17:01:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:01:16 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3164] PQ "my Founds" richtig verarbeiten
Message-ID: <200705231501.l4NF1G7h003316@unicorn.berlios.de>

Feature Request #3164, was updated on 2007-Feb-18 21:37
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3164&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: PQ "my Founds" richtig verarbeiten

By: kalli
Date: 2007-Feb-18 21:37

Message:
Logged In: YES 
user_id=24621
Browser: Opera/9.00 (Windows NT 5.1; U; de)

Eigenes Men?, mit dem die PQ mit den eignenen 
Founds eingelesen wird. Es werden die Caches und 
addi wpts als gefunden markiert, die schon in der 
DB drin sind.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3164&group_id=2211


From admin at berlios.de  Wed May 23 17:01:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:01:16 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3112] Abgleich von Profilen
Message-ID: <200705231501.l4NF1GRq003346@unicorn.berlios.de>

Feature Request #3112, was updated on 2007-Feb-03 16:23
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3112&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Abgleich von Profilen

By: salzkammergut
Date: 2007-Feb-03 16:23

Message:
Logged In: YES 
user_id=33713
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

Es sollte m?glich sein zwei Profile abzugleichen, d.h.
alle Daten, die in einem Profil aktueller sind in das
ander Profil zu ?bertragen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3112&group_id=2211


From admin at berlios.de  Wed May 23 17:01:17 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:01:17 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3062] MovingMap: Kartendownload von
	Expedia
Message-ID: <200705231501.l4NF1HOG003356@unicorn.berlios.de>

Feature Request #3062, was updated on 2007-Jan-19 03:09
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3062&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: MovingMap: Kartendownload von Expedia

By: pfeffer
Date: 2007-Jan-19 03:09

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

MovingMap: automatischer Kartendownload von 
Expedia

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3062&group_id=2211


From admin at berlios.de  Wed May 23 17:01:17 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:01:17 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3032] Hint verschieben in Beschreibung
	als But
Message-ID: <200705231501.l4NF1H3G003366@unicorn.berlios.de>

Feature Request #3032, was updated on 2007-Jan-09 13:03
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3032&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Hint verschieben in Beschreibung als But

By: salzkammergut
Date: 2007-Jan-09 13:38

Message:
Logged In: YES 
user_id=33713
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

Ich habe vor Kurzem den Balken zwischen Hint und Logs
verschiebbar gemacht. Dadurch kann die Buttonreihe ganz nach
oben geschoben werden um Platz f?r mehr Logs zu machen.

Reicht das ?

----------------------------------------------------------------------

By: pfeffer
Date: 2007-Jan-09 13:03

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

siehe: http://www.geoclub.de/
viewtopic.php?p=209832#209832

Ich bin daf?r, den verschl?sselten Hint (deutsch: 
Tipp) als Button, der eine Messagebox ?ffnet, in der 
Cachebeschreibung zwichen die Button +/- zu 
machen. Dadurch bekommt man auf der Seite mit 
den Logs mehr Platz. 
Die MessageBox sollte den hint zun?chst 
verschl?sselt anzeigen und erst bei einem Klick auf 
"entschl?sseln" entschl?sseln.

Gru?,
  Pfeffer.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3032&group_id=2211


From admin at berlios.de  Wed May 23 17:01:22 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:01:22 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3028] MovingMap: Download von GoogleEarth
Message-ID: <200705231501.l4NF1MmM003512@unicorn.berlios.de>

Feature Request #3028, was updated on 2007-Jan-08 18:27
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3028&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: MovingMap: Download von GoogleEarth

By: pfeffer
Date: 2007-Jan-08 18:27

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.01 (Windows NT 5.1; U; de)

direkter Download von GoogleEarth-Karten mit 
Kalibrierungsinformationen

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3028&group_id=2211


From admin at berlios.de  Wed May 23 17:02:43 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:02:43 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2992] Cachetypen in Konfigurationsdatei
Message-ID: <200705231502.l4NF2h42005716@unicorn.berlios.de>

Feature Request #2992, was updated on 2006-Dec-24 09:28
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2992&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Cachetypen in Konfigurationsdatei 

By: salzkammergut
Date: 2006-Dec-24 09:28

Message:
Logged In: YES 
user_id=33713
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

Da zu erwarten ist, da? es auch in Zukunft immer wieder
einmal neue Cachetypen geben wird, sollten die
Cachetypen aus einer Konfigurationsdatei gelesen werden
um nicht jedesmal neu kompilieren zu m?ssen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2992&group_id=2211


From admin at berlios.de  Wed May 23 17:02:43 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:02:43 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2990] Import von anderen Kalibrirungsfiles
Message-ID: <200705231502.l4NF2h5Q005758@unicorn.berlios.de>

Feature Request #2990, was updated on 2006-Dec-22 17:41
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2990&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Import von anderen Kalibrirungsfiles

By: kalli
Date: 2006-Dec-22 17:41

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (compatible; Konqueror/3.5; Linux) KHTML/3.5.2 (like Gecko) Kubuntu 6.06 Dapper

Nach dem Tod von NHTop50Trans tauchen ?fters 
Fragen nach dem Import von anderen Formaten 
auf. Vielleicht sollte man hier gleich eine saubere 
Importschnittstelle definieren, die zum einen das 
Dateiformat automatisch erkennt (meist gibt es 
einen Header) und dann die entprechende 
Importmethode aufruft. als Ergebnis kommt dann 
eh ein .wfl-File raus.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2990&group_id=2211


From admin at berlios.de  Wed May 23 17:02:43 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:02:43 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2987] /maps Verzeichnis
Message-ID: <200705231502.l4NF2hbJ005768@unicorn.berlios.de>

Feature Request #2987, was updated on 2006-Dec-21 17:39
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2987&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: /maps Verzeichnis

By: mik77
Date: 2007-Jan-13 21:12

Message:
Logged In: YES 
user_id=34677
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de-AT; rv:1.8.1) Gecko/20061101 SeaMonkey/1.1b Mnenhy/0.7.4.10002

Es gibt noch ein paar weitere Stellen, an denen das
Karten-Verzeichnis angepasst werden m?sste. Z.B. bei Import.
bei einer Suche nach "maps/" finde ich noch drei weitere
Stellen.

----------------------------------------------------------------------

By: pfeffer
Date: 2007-Jan-11 05:14

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

so, jetzt kann man durch klick auf die gelben Streifen links
oben in der Ecke der MovingMap ein vom Standardverzeichnis
abweichendes w?hlen. (SVN: 380)
Zweck: ein Verzeichnis f?r GoogleEarth-Karten, ein anderes
f?r Karten aus TK50 der Landesvermessungs?mter o.?.

Gru?,
  Pfeffer.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2987&group_id=2211


From admin at berlios.de  Wed May 23 17:02:42 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:02:42 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3028] MovingMap: Download von GoogleEarth
Message-ID: <200705231502.l4NF2gqw005706@unicorn.berlios.de>

Feature Request #3028, was updated on 2007-Jan-08 18:27
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3028&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: MovingMap: Download von GoogleEarth

By: pfeffer
Date: 2007-Jan-08 18:27

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.01 (Windows NT 5.1; U; de)

direkter Download von GoogleEarth-Karten mit 
Kalibrierungsinformationen

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3028&group_id=2211


From admin at berlios.de  Wed May 23 17:02:43 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:02:43 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2976] Updates automatisch herunterladen
Message-ID: <200705231502.l4NF2hos005779@unicorn.berlios.de>

Feature Request #2976, was updated on 2006-Dec-17 11:46
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2976&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Updates automatisch herunterladen

By: tobox
Date: 2006-Dec-17 11:46

Message:
Logged In: YES 
user_id=34193
Browser: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.7) Gecko/20060830 Firefox/1.5.0.7 (Debian-1.5.dfsg+1.5.0.7-2)

Mit der Funktion "Version pr?fen" kann man schon
feststellen, ob es eine neuere CacheWolf-Version gibt -
praktisch w?re es, wenn man z.B. ?ber einen Link direkt
die neue Version herunterladen k?nnte.

Thomas

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2976&group_id=2211


From admin at berlios.de  Wed May 23 17:02:48 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:02:48 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2970] Cacheliste fortlaufend sortieren
Message-ID: <200705231502.l4NF2mGA005917@unicorn.berlios.de>

Feature Request #2970, was updated on 2006-Dec-14 08:56
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2970&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Cacheliste fortlaufend sortieren

By: pfeffer
Date: 2007-Feb-01 15:08

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

wir wollen es so: die Cacheliste bleibt sortiert, egal, ob 
man Filter anwedet, Filter aufhebt, neue Caches l?dt 
usw. siehe http://www.geoclub.de/ftopic13883-20.html

@albsucher: diese Funktion gibt es schon: im Goto-
Panel auf "Zentrum" klicken.

----------------------------------------------------------------------

By: albsucher
Date: 2006-Dec-14 09:09

Message:
Logged In: YES 
user_id=26380
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

Ich finde einen Automatismus weniger geeignet da man meist
einen bestimmten Cache suchen geht.
Au?erdem d?rfte es aufwendig und sehr performancefressend
sein - vor allem bei langen Listen.

Was m.E. praktischer w?re: einen Men?punkt "nearest Caches"
oder so, wo dann die Liste nach Entfernung vom aktuellen
Standort neu sortiert wird. So kann man "schnell" mal sehen
ob und wo Caches in der N?he sind.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2970&group_id=2211


From admin at berlios.de  Wed May 23 17:02:54 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:02:54 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2937] Passwort abspeichern
Message-ID: <200705231502.l4NF2ssM006093@unicorn.berlios.de>

Feature Request #2937, was updated on 2006-Dec-04 16:47
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2937&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Passwort abspeichern

By: tobox
Date: 2006-Dec-05 09:00

Message:
Logged In: YES 
user_id=34193
Browser: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.7) Gecko/20060830 Firefox/1.5.0.7 (Debian-1.5.dfsg+1.5.0.7-2~bpo.1)

Da stimme ich Dir zu. Wie w?re es mit einer Checkbox
"Passwort speichern" (default: unchecked) unter der
Passwort-Textbox? So machen es viele Webseiten ja auch. 

Thomas

----------------------------------------------------------------------

By: pfeffer
Date: 2006-Dec-04 16:52

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.01 (Windows NT 5.1; U; de)

hmmm.... sowas macht immer Sicherheitsprobleme. Ich 
denke: es darf jedenfalls nicht ohne nachfrage und 
ohne Warnung gespeichert werden.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2937&group_id=2211


From admin at berlios.de  Wed May 23 17:03:11 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:11 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2932] auch .bmp und jpg als kalibrierte
	Karte
Message-ID: <200705231503.l4NF3BIw006587@unicorn.berlios.de>

Feature Request #2932, was updated on 2006-Dec-04 03:01
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2932&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: auch .bmp und jpg als kalibrierte Karte 

By: pfeffer
Date: 2007-Jan-20 06:41

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

SVN 406:
.png, .jpg, .gif und .bmp werden akzeptiert.

----------------------------------------------------------------------

By: pfeffer
Date: 2006-Dec-18 12:37

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

und auch .gif

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2932&group_id=2211


From admin at berlios.de  Wed May 23 17:03:17 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:17 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2931] Start beschleunigen
Message-ID: <200705231503.l4NF3H8Z006731@unicorn.berlios.de>

Feature Request #2931, was updated on 2006-Dec-03 23:58
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2931&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Start beschleunigen

By: kalli
Date: 2006-Dec-16 00:00

Message:
Logged In: YES 
user_id=24621
Browser: Opera/9.00 (Windows NT 5.1; U; de)

Habe mal die Schleife aud MyXMLBuilder rausgenommen. 
Hat auf dem PPC etwas gebracht: vorher ca. 25s, jetzt 
ca. 20s, Datenbank hat 169 Caches. Mit nur einem 
Cache dauert es 9,79 s gedauert. Ich werde die Sache 
schon mal einchecken, aber mal mit dem Profiler weiter 
nachschauen.

----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Dec-04 16:22

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; CIO CU; .NET CLR 1.0.3705; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.1)

Habe es mit einem BufferedReader versucht. Zeit geht 
von 110ms auf 125ms hoch ==> also kein Zeitgewinn. 
Schade.

Vielleicht finden wir aber noch etwas anderes...

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2931&group_id=2211


From admin at berlios.de  Wed May 23 17:03:22 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:22 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2928] Sonnenrichtung in MovingMap anzeigen
Message-ID: <200705231503.l4NF3MAO006912@unicorn.berlios.de>

Feature Request #2928, was updated on 2006-Dec-03 16:35
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2928&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Sonnenrichtung in MovingMap anzeigen

By: pfeffer
Date: 2007-Jan-12 15:54

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

erledigtr mit SVN 381. Auch die Nordrichtung wird 
(dunkelblau) angezeigt.

----------------------------------------------------------------------

By: pfeffer
Date: 2006-Dec-03 16:35

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

Sonnenrichtung in MovingMap anzeigen durch kleines am
Rand entland wanderndes Sonnensymbol

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2928&group_id=2211


From admin at berlios.de  Wed May 23 17:03:22 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:22 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2929] Mondrichtung anzeigen
Message-ID: <200705231503.l4NF3MqE006902@unicorn.berlios.de>

Feature Request #2929, was updated on 2006-Dec-03 16:36
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2929&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Mondrichtung anzeigen

By: pfeffer
Date: 2007-Mar-05 18:37

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

ich hab's schon fast fertig

----------------------------------------------------------------------

By: pfeffer
Date: 2006-Dec-03 16:36

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

wo nun die Tage k?rzer werden wird es zunehmend
wichtiger, auch im Dunkeln die Himmelsrichtung
bestimmen zu k?nnen

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2929&group_id=2211


From admin at berlios.de  Wed May 23 17:03:23 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:23 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2926] Checkboxen ausblenden
Message-ID: <200705231503.l4NF3Ni8006922@unicorn.berlios.de>

Feature Request #2926, was updated on 2006-Dec-03 09:22
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2926&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Checkboxen ausblenden

By: bilbowolf
Date: 2006-Dec-03 09:22

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8) Gecko/20061025 Firefox/1.5.0.8

http://www.geoclub.de/ftopic12757.html

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2926&group_id=2211


From admin at berlios.de  Wed May 23 17:03:38 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:38 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2910] GPS-Empfangsstatus in MovinMap
	anzeigen
Message-ID: <200705231503.l4NF3cMc007420@unicorn.berlios.de>

Feature Request #2910, was updated on 2006-Nov-28 02:17
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2910&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: GPS-Empfangsstatus in MovinMap anzeigen

By: pfeffer
Date: 2006-Nov-28 02:18

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

ist erledigt, bitte testen

----------------------------------------------------------------------

By: pfeffer
Date: 2006-Nov-28 02:17

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

GPS-Empfangsstatus in MovinMap anzeigen:
gr?ner Kreis: sat-fix vorhanden
gelber Kreis: Empfang von GPS-Daten, aber unfixed
roter Kreis: Verbindung zu GPS abgebrochen: kein
Datenempfang

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2910&group_id=2211


From admin at berlios.de  Wed May 23 17:03:38 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:38 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2877] Terracaching
Message-ID: <200705231503.l4NF3cOi007472@unicorn.berlios.de>

Feature Request #2877, was updated on 2006-Nov-14 22:51
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2877&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Terracaching

By: kalli
Date: 2007-Apr-05 21:03

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

Ich hab die Infos ?ber das Terracaching GPX zusammen, mache
den Request wieder auf.

----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Nov-23 15:48

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; CIO CU; .NET CLR 1.0.3705; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.1)

lohnt sich nicht...

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2877&group_id=2211


From admin at berlios.de  Wed May 23 17:03:28 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:28 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2924] Anzeige der GotoPosition in
	MovingMap
Message-ID: <200705231503.l4NF3S0x007101@unicorn.berlios.de>

Feature Request #2924, was updated on 2006-Dec-02 03:18
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2924&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Anzeige der GotoPosition in MovingMap

By: pfeffer
Date: 2007-Jan-08 03:22

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

so, jetz (nach SVN 366) kann man die MovingMap auch ohne
kalibrierte Karte nutzen

----------------------------------------------------------------------

By: albsucher
Date: 2007-Jan-03 17:07

Message:
Logged In: YES 
user_id=26380
Browser: Mozilla/5.0 (X11; U; Linux i686; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

Also ganz ehrlich ich hab die MM noch nie benutzt und w?sste
jetzt auch nicht was genau ich da testen soll???
Sorry...

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2924&group_id=2211


From admin at berlios.de  Wed May 23 17:03:39 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:39 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2826] Proxyeinstellungen
Message-ID: <200705231503.l4NF3drX007488@unicorn.berlios.de>

Feature Request #2826, was updated on 2006-Oct-31 10:47
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2826&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Proxyeinstellungen

By: bilbowolf
Date: 2006-Oct-31 10:47

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; CIO CU; .NET CLR 1.0.3705; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.1)

Man sollte Proxyeinstellungen per "H?ckchen" 
aktivieren, bzw. deaktivieren k?nnen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2826&group_id=2211


From admin at berlios.de  Wed May 23 17:03:51 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:03:51 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2826] Proxyeinstellungen
Message-ID: <200705231503.l4NF3pvI007838@unicorn.berlios.de>

Feature Request #2826, was updated on 2006-Oct-31 10:47
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2826&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Proxyeinstellungen

By: bilbowolf
Date: 2006-Oct-31 10:47

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; CIO CU; .NET CLR 1.0.3705; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.1)

Man sollte Proxyeinstellungen per "H?ckchen" 
aktivieren, bzw. deaktivieren k?nnen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2826&group_id=2211


From admin at berlios.de  Wed May 23 17:04:15 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:15 +0200 (CEST)
Subject: [Feature #2474] Auswahlbutton fr Browser
Message-ID: <200705231504.l4NF4FDh008529@unicorn.berlios.de>

Feature Request #2474, was updated on 2006-Aug-08 18:43
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2474&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Auswahlbutton f?r Browser

By: albsucher
Date: 2006-Aug-08 18:43

Message:
Logged In: YES 
user_id=26380
Browser: Mozilla/5.0 (X11; U; Linux i686; de; rv:1.8.0.1) Gecko/20060124 Firefox/1.5.0.1

Pr?ferenzen-fenster: Hinzuf?gen eines Auswahlbuttons
f?r Browser.
Auswahl sollte erst beendet asein wenn ein ausf?hrbares
Programm ausgew?hlt wurde (Windows: EXE, Linux: ?)


----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2474&group_id=2211


From admin at berlios.de  Wed May 23 17:04:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:16 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2460] Import Fortschritt
Message-ID: <200705231504.l4NF4GWs008549@unicorn.berlios.de>

Feature Request #2460, was updated on 2006-Aug-04 15:14
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2460&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Import Fortschritt

By: greiol
Date: 2006-Aug-04 15:14

Message:
Logged In: YES 
user_id=30600
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.0.6) Gecko/20060728 Firefox/1.5.0.6

W?hrend eines GPX Imports (vor allem mit ImageSpider)
ist es aussichtslos zu erkennen was CW gerade macht.
Bei wirklich neuen Caches erscheint zwar ein Z?hler,
aber das wars dann auch. Es ist nicht zu erkennen, ob
CW gerade noch damit besch?ftigt ist Bilder nachzuladen
oder einfach in einem Bereich ist in dem es nur
Logupdates gibt.
Konsequenz: Ich schau nach wieviel CPU die Software
braucht und wenn sie eine Minute lange keine braucht,
beende ich das Programm und starte den Import neu.
Bloss weiss ich nicht wo sie das letzte mal stehen
geblieben ist (was sich auf die Qualit?t der Bugreports
auswirkt)
Ich w?rde mir neben einem Z?hler f?r neue Caches auch
einen Z?hler w?nschen der die Update-Only-Caches
anzeigt. So sieht man direkt ob sich noch etwas tut.
Ausserdem w?re es nett wenn in dem fenster auch immer
der aktuell bearbeitete wegpunkt erscheinen w?rde. Zur
not k?nnte man den dann aus dem gpx herausfischen und
an die entwickler schicken ;)

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2460&group_id=2211


From admin at berlios.de  Wed May 23 17:04:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:16 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2421] Installer
Message-ID: <200705231504.l4NF4GsV008559@unicorn.berlios.de>

Feature Request #2421, was updated on 2006-Jul-26 21:24
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2421&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Installer

By: albsucher
Date: 2006-Aug-08 18:49

Message:
Logged In: YES 
user_id=26380
Browser: Mozilla/5.0 (X11; U; Linux i686; de; rv:1.8.0.1) Gecko/20060124 Firefox/1.5.0.1

Wie w?rs mit einer genauen beschreibung auf der Homepage?
Oder mit in die Doku aufnehmen?

----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Jul-26 21:24

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.4) Gecko/20060508 Firefox/1.5.0.4

schreiben f?r PocketPC.

Scheinbar haben zu viele ein Problem mit der
"manuellen" Installationsmethode.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2421&group_id=2211


From admin at berlios.de  Wed May 23 17:04:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:16 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2415] Button zum speichern
Message-ID: <200705231504.l4NF4GPU008569@unicorn.berlios.de>

Feature Request #2415, was updated on 2006-Jul-24 11:47
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2415&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Button zum speichern

By: pfeffer
Date: 2006-Sep-17 18:42

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.01 (Windows NT 5.1; U; de)

wenn es durchs speichern bei jeder Aenderung wirklich 
zu traege wird, dann macht man es halt nur 
automatisch  beim beenden. Aber lieber erstmal 
versuchen...


----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Sep-17 07:18

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.7) Gecko/20060909 Firefox/1.5.0.7

Bei einer grossen index.xml Datei wird cw auf dem pocketpc
noch etwas tr?ger. K?nnte man aber mal probieren.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2415&group_id=2211


From admin at berlios.de  Wed May 23 17:04:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:16 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2411] Filter nach Status
Message-ID: <200705231504.l4NF4GfZ008598@unicorn.berlios.de>

Feature Request #2411, was updated on 2006-Jul-23 20:46
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2411&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Filter nach Status

By: bilbowolf
Date: 2006-Jul-23 20:46

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.4) Gecko/20060508 Firefox/1.5.0.4

..

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2411&group_id=2211


From admin at berlios.de  Wed May 23 17:04:16 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:16 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2038] OC Cachetypen
Message-ID: <200705231504.l4NF4Gh8008621@unicorn.berlios.de>

Feature Request #2038, was updated on 2006-Mar-24 22:07
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2038&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: OC Cachetypen

By: pfeffer
Date: 2006-Aug-30 11:29

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; de) Opera 8.54

nein, wenn Du schon angefangen hast, dann ist's ja 
bl?dsinn, wenn ich mich da reinarbeite.

Ich wollte Dir nur gern irgendetwas abnehmen, damit 

a) auch bei mir die Moving Map bald funktioniert ;-)
b) 0.9m bald released werden kann. Aber hatte wohl 
?bersehen, dass diese Erweiterung erst f?r n geplant 
ist.

Gru?,
  Pfeffer.

----------------------------------------------------------------------

By: kalli
Date: 2006-Aug-29 20:14

Message:
Logged In: YES 
user_id=24621
Browser: Opera/9.00 (Windows NT 5.1; U; de)

Hatte ich bisher nur angefangen, indem ich den Code, 
der die Cachetypen behandelt, in eine eigene Klasse 
CacheType zusammengezogen habe. In dem einen oder 
anderen Exporter d?rfte noch spezieller Code zu dem 
Thema schlummern. 
Die zus?tzlichen Cachetypen bekommt man nur, wenn 
man das XML-Interface benutzt, in den GPXen stehen 
die "normalen" drin. 
Du kannst das gerne ?bernehmen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2038&group_id=2211


From admin at berlios.de  Wed May 23 17:04:15 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:15 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2466] GPX import verz merken
Message-ID: <200705231504.l4NF4Fax008539@unicorn.berlios.de>

Feature Request #2466, was updated on 2006-Aug-06 21:22
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2466&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: GPX import verz merken

By: bilbowolf
Date: 2006-Aug-06 21:22

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; IE Autoconfiguration; CIO CU; .NET CLR 1.1.4322; InfoPath.1; .NET CLR 2.0.50727)

Auch w?re es nett, wenn man beim laden einer 
GPX-Datei nicht jedesmal durch den ganzen Ordner 
navigieren muss, sondern das der Ordner vom 
letzten Laden gemerkt wird.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2466&group_id=2211


From admin at berlios.de  Wed May 23 17:04:17 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:17 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2036] Moving Map and EXIF
Message-ID: <200705231504.l4NF4H0A008631@unicorn.berlios.de>

Feature Request #2036, was updated on 2006-Mar-24 12:25
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2036&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Moving Map and EXIF

By: bilbowolf
Date: 2006-Mar-24 12:25

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; IE Autoconfiguration; .NET CLR 1.1.4322; InfoPath.1)

CW soll meta daten aus digi photos auslesen und 
in der moving map (dann nat?rlich nicht mehr 
moving) anzeigen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2036&group_id=2211


From admin at berlios.de  Wed May 23 17:04:22 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:22 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1991] Koordinaten averageing
Message-ID: <200705231504.l4NF4MiC008769@unicorn.berlios.de>

Feature Request #1991, was updated on 2006-Mar-18 12:17
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1991&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Koordinaten averageing

By: bilbowolf
Date: 2006-Mar-18 12:17

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; IE Autoconfiguration; .NET CLR 1.1.4322)

Im goto panel to option einbauen, ?ber einen 
Zeitraum coordinaten einzumessen. Feature wird 
ben?tigt, wenn man einen cache verstecken 
m?chte.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1991&group_id=2211


From admin at berlios.de  Wed May 23 17:04:38 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:38 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1976] Meilen
Message-ID: <200705231504.l4NF4cf9009225@unicorn.berlios.de>

Feature Request #1976, was updated on 2006-Mar-16 21:19
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211

Category: 0.9n
Status: Open
Priority: 5
Summary: Meilen

By: bilbowolf
Date: 2006-Mar-16 21:19

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.1) Gecko/20060111 Firefox/1.5.0.1

Cachewolf sollte auch mit Meilen umgehen k?nnen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211


From admin at berlios.de  Wed May 23 17:04:57 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:04:57 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1980] "?"
Message-ID: <200705231504.l4NF4vKK009765@unicorn.berlios.de>

Feature Request #1980, was updated on 2006-Mar-16 21:23
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1980&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: "?"

By: bilbowolf
Date: 2006-Mar-16 21:23

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.1) Gecko/20060111 Firefox/1.5.0.1

Dokumentation unter "?" einh?ngen

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1980&group_id=2211


From admin at berlios.de  Wed May 23 17:05:02 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:05:02 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1976] Meilen
Message-ID: <200705231505.l4NF52R8009946@unicorn.berlios.de>

Feature Request #1976, was updated on 2006-Mar-16 21:19
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Meilen

By: bilbowolf
Date: 2006-Mar-16 21:19

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.1) Gecko/20060111 Firefox/1.5.0.1

Cachewolf sollte auch mit Meilen umgehen k?nnen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211


From admin at berlios.de  Wed May 23 17:05:18 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:05:18 +0200 (CEST)
Subject: [Feature #1973] Export ber GPSBabel zu PalmDocs
Message-ID: <200705231505.l4NF5IRR010380@unicorn.berlios.de>

Feature Request #1973, was updated on 2006-Mar-16 21:17
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1973&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Export ?ber GPSBabel zu PalmDocs

By: cw-tester
Date: 2007-Feb-22 12:43

Message:
Logged In: YES 
user_id=30505
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

Also bei mir wird dieser Befehl abgesetzt:

gpsbabel.exe -p "" -w -i gpx -f
"I:\WP\Test\TestZubeh?r\GC101CJ.gpx" -o mapsend -F
"d:	emp\Test.wpt"

----------------------------------------------------------------------

By: cw-tester
Date: 2007-Feb-22 11:41

Message:
Logged In: YES 
user_id=30505
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1

Also bei mir wird dieser Befehl abgesetzt:

gpsbabel.exe -p "" -w -i gpx -f
"I:\WP\Test\TestZubeh?r\GC101CJ.gpx" -o mapsend -F
"d:	emp\Test.wpt"

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1973&group_id=2211


From admin at berlios.de  Wed May 23 17:05:07 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:05:07 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1974] Cache Attribute anzeigen und filtern
Message-ID: <200705231505.l4NF57HE010093@unicorn.berlios.de>

Feature Request #1974, was updated on 2006-Mar-16 21:18
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1974&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Cache Attribute anzeigen und filtern

By: salzkammergut
Date: 2007-Mar-16 19:32

Message:
Logged In: YES 
user_id=33713
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.10) Gecko/20070216 Firefox/1.5.0.10

An der Anzeige bin ich dran. Kommt nach 0.9n

----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Mar-16 21:18

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.1) Gecko/20060111 Firefox/1.5.0.1

Cache Attribute anzeigen und filtern

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1974&group_id=2211


From admin at berlios.de  Wed May 23 17:05:18 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:05:18 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1968] Beliebiges zoomen im Radar
Message-ID: <200705231505.l4NF5IjW010399@unicorn.berlios.de>

Feature Request #1968, was updated on 2006-Mar-16 08:03
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1968&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Beliebiges zoomen im Radar

By: kalli
Date: 2006-Mar-16 08:03

Message:
Logged In: YES 
user_id=24621
Browser: Opera/8.50 (Windows NT 5.1; U; de)

Beliebiges zoomen im Radar

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1968&group_id=2211


From admin at berlios.de  Wed May 23 17:05:23 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 17:05:23 +0200 (CEST)
Subject: [Feature #1967] Filter nach Flche
Message-ID: <200705231505.l4NF5NXe010570@unicorn.berlios.de>

Feature Request #1967, was updated on 2006-Mar-16 08:01
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1967&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Filter nach Fl?che

By: kalli
Date: 2006-Mar-16 08:01

Message:
Logged In: YES 
user_id=24621
Browser: Opera/8.50 (Windows NT 5.1; U; de)

Es kann eine Fl?che (Polygon) als Filterkriterium 
festgelegt werden

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1967&group_id=2211


From admin at berlios.de  Wed May 23 18:59:49 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 18:59:49 +0200 (CEST)
Subject: [Cachewolf-svn] [Bug #11152] Version Check funktioniert nicht
Message-ID: <200705231659.l4NGxnYB022706@unicorn.berlios.de>

Bug #11152, was updated on 2007-May-23 18:59
Here is a current snapshot of the bug.

Project: CacheWolf
Category: 0.9n
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: tobox
Assigned to : none
Summary: Version Check funktioniert nicht

Details: Version Check liefert bei mir unter Windows mit der 0.9n: "New version available", wobei die 0.9n doch die neueste ist!

Thomas

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=11152&group_id=2211


From admin at berlios.de  Wed May 23 19:01:13 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 23 May 2007 19:01:13 +0200 (CEST)
Subject: [Cachewolf-svn] [Bug #11152] Version Check funktioniert nicht
Message-ID: <200705231701.l4NH1DG9001259@unicorn.berlios.de>

Bug #11152, was updated on 2007-May-23 18:59
Here is a current snapshot of the bug.

Project: CacheWolf
Category: 0.9n
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: tobox
Assigned to : none
Summary: Version Check funktioniert nicht

Details: Version Check liefert bei mir unter Windows mit der 0.9n: "New version available", wobei die 0.9n doch die neueste ist!

Thomas

Follow-Ups:

Date: 2007-May-23 19:01
By: tobox

Comment:
Auch wenn dieser Bug auf den ersten Blick nach einem Duplicate aussieht von 010121, ist es keiner.

Thomas
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=11152&group_id=2211


From kalli at mail.berlios.de  Wed May 23 20:37:49 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:37:49 +0200
Subject: [Cachewolf-svn] r691 - branches
Message-ID: <200705231837.l4NIbnqC012589@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:37:46 +0200 (Wed, 23 May 2007)
New Revision: 691

Added:
   branches/bugfix_09n/
Removed:
   branches/1.0/
Log:
Branch fuer Bugfixes an der 0.9n


Copied: branches/bugfix_09n (from rev 690, branches/1.0)



From kalli at mail.berlios.de  Wed May 23 20:38:21 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:38:21 +0200
Subject: [Cachewolf-svn] r692 - branches/bugfix_09n
Message-ID: <200705231838.l4NIcLru012625@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:38:17 +0200 (Wed, 23 May 2007)
New Revision: 692

Removed:
   branches/bugfix_09n/CacheWolf/
Log:
Removed file/folder



From kalli at mail.berlios.de  Wed May 23 20:38:33 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:38:33 +0200
Subject: [Cachewolf-svn] r693 - branches/bugfix_09n
Message-ID: <200705231838.l4NIcXUR012646@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:38:32 +0200 (Wed, 23 May 2007)
New Revision: 693

Removed:
   branches/bugfix_09n/exp/
Log:
Removed file/folder



From kalli at mail.berlios.de  Wed May 23 20:40:01 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:40:01 +0200
Subject: [Cachewolf-svn] r694 - branches/bugfix_09n
Message-ID: <200705231840.l4NIe1Jq012749@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:39:57 +0200 (Wed, 23 May 2007)
New Revision: 694

Added:
   branches/bugfix_09n/lib/
Log:
Copied remotely

Copied: branches/bugfix_09n/lib (from rev 693, trunk/lib)



From kalli at mail.berlios.de  Wed May 23 20:40:44 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:40:44 +0200
Subject: [Cachewolf-svn] r695 - branches/bugfix_09n
Message-ID: <200705231840.l4NIeitT012800@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:40:40 +0200 (Wed, 23 May 2007)
New Revision: 695

Added:
   branches/bugfix_09n/resources/
Log:
Copied remotely

Copied: branches/bugfix_09n/resources (from rev 694, trunk/resources)



From kalli at mail.berlios.de  Wed May 23 20:41:11 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:41:11 +0200
Subject: [Cachewolf-svn] r696 - branches/bugfix_09n
Message-ID: <200705231841.l4NIfBPA012949@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:41:07 +0200 (Wed, 23 May 2007)
New Revision: 696

Added:
   branches/bugfix_09n/work/
Log:
Copied remotely

Copied: branches/bugfix_09n/work (from rev 695, trunk/work)



From kalli at mail.berlios.de  Wed May 23 20:43:56 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:43:56 +0200
Subject: [Cachewolf-svn] r697 - branches/bugfix_09n trunk
Message-ID: <200705231843.l4NIhuNP013179@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:43:50 +0200 (Wed, 23 May 2007)
New Revision: 697

Added:
   branches/bugfix_09n/.classpath
Removed:
   trunk/.classpath
Log:
Moved remotely

Copied: branches/bugfix_09n/.classpath (from rev 696, trunk/.classpath)

Deleted: trunk/.classpath
===================================================================
--- trunk/.classpath	2007-05-23 18:41:07 UTC (rev 696)
+++ trunk/.classpath	2007-05-23 18:43:50 UTC (rev 697)
@@ -1,11 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<classpath>
-	<classpathentry kind="src" path="src"/>
-	<classpathentry kind="lib" path="lib/CompileEwe.zip"/>
-	<classpathentry kind="lib" path="lib/ewe.jar"/>
-	<classpathentry kind="lib" path="lib/ewesoft.zip"/>
-	<classpathentry kind="lib" path="lib/EwesoftRegex.zip"/>
-	<classpathentry kind="lib" path="lib/HTML.zip"/>
-	<classpathentry kind="lib" path="lib/openmap.jar"/>
-	<classpathentry kind="output" path="bin"/>
-</classpath>



From kalli at mail.berlios.de  Wed May 23 20:46:18 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:46:18 +0200
Subject: [Cachewolf-svn] r698 - trunk
Message-ID: <200705231846.l4NIkICg013500@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:46:12 +0200 (Wed, 23 May 2007)
New Revision: 698

Added:
   trunk/.classpath
Log:
Copied remotely

Copied: trunk/.classpath (from rev 697, branches/bugfix_09n/.classpath)



From kalli at mail.berlios.de  Wed May 23 20:46:56 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:46:56 +0200
Subject: [Cachewolf-svn] r699 - branches/bugfix_09n
Message-ID: <200705231846.l4NIkuwr013573@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:46:50 +0200 (Wed, 23 May 2007)
New Revision: 699

Added:
   branches/bugfix_09n/buildexe.bat
Log:
Copied remotely

Copied: branches/bugfix_09n/buildexe.bat (from rev 698, trunk/buildexe.bat)



From kalli at mail.berlios.de  Wed May 23 20:48:04 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:48:04 +0200
Subject: [Cachewolf-svn] r700 - branches/bugfix_09n
Message-ID: <200705231848.l4NIm41o013632@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:48:00 +0200 (Wed, 23 May 2007)
New Revision: 700

Added:
   branches/bugfix_09n/compile.bat
Log:
Copied remotely

Copied: branches/bugfix_09n/compile.bat (from rev 699, trunk/compile.bat)



From kalli at mail.berlios.de  Wed May 23 20:49:01 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:49:01 +0200
Subject: [Cachewolf-svn] r701 - branches/bugfix_09n
Message-ID: <200705231849.l4NIn1gE013689@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:48:54 +0200 (Wed, 23 May 2007)
New Revision: 701

Added:
   branches/bugfix_09n/runwolf.bat
Log:
Copied remotely

Copied: branches/bugfix_09n/runwolf.bat (from rev 700, trunk/runwolf.bat)



From kalli at mail.berlios.de  Wed May 23 20:49:27 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:49:27 +0200
Subject: [Cachewolf-svn] r702 - branches/bugfix_09n
Message-ID: <200705231849.l4NInRvf013714@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:49:21 +0200 (Wed, 23 May 2007)
New Revision: 702

Added:
   branches/bugfix_09n/cwberlios.jnf
Log:
Copied remotely

Copied: branches/bugfix_09n/cwberlios.jnf (from rev 701, trunk/cwberlios.jnf)



From kalli at mail.berlios.de  Wed May 23 20:50:04 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 20:50:04 +0200
Subject: [Cachewolf-svn] r703 - trunk/src
Message-ID: <200705231850.l4NIo4Iv013800@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 20:50:03 +0200 (Wed, 23 May 2007)
New Revision: 703

Removed:
   trunk/src/src/
Log:
Removed file/folder



From kalli at mail.berlios.de  Wed May 23 21:05:47 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 23 May 2007 21:05:47 +0200
Subject: [Cachewolf-svn] r704 - branches/bugfix_09n
Message-ID: <200705231905.l4NJ5l8x015160@sheep.berlios.de>

Author: kalli
Date: 2007-05-23 21:05:42 +0200 (Wed, 23 May 2007)
New Revision: 704

Added:
   branches/bugfix_09n/getRes.bat
Log:
Copied remotely

Copied: branches/bugfix_09n/getRes.bat (from rev 703, trunk/getRes.bat)



From admin at berlios.de  Thu May 24 16:20:04 2007
From: admin at berlios.de (admin at berlios.de)
Date: Thu, 24 May 2007 06:20:04 -0800 (AKDT)
Subject: [Cachewolf-svn] [Feature #3434] Zeilenumbruch in Cachebeschreibung
Message-ID: <200705241420.l4OEK4h7014122@unicorn.berlios.de>

Feature Request #3434, was updated on 2007-May-24 06:20
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3434&group_id=2211

Category: 1.0
Status: Open
Priority: 5
Summary: Zeilenumbruch in Cachebeschreibung

By: cw-tester
Date: 2007-May-24 06:20

Message:
Logged In: YES 
user_id=30505
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

in folgendem Beispiel ist es CW nicht m?glich einen
entsprechenden Zeilenumbruch zu generieren.

Beispielcode aus GCWEZ1:
[code]<font color="#0000ff" size="+1" face=
"Arial">Diese Serie soll an eine ehemalige, fast
vergessene Bahnlinie</font>
<font color="#0000ff" size="+1" face=
"Arial">in Nordhessen erinnern.</font>[/code][/quote]

Eine L?sung w?re ein horizontaler Scrollbalken.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3434&group_id=2211


From salzkammergut at mail.berlios.de  Thu May 24 20:10:09 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 24 May 2007 20:10:09 +0200
Subject: [Cachewolf-svn] r705 - trunk/src/CacheWolf
Message-ID: <200705241810.l4OIA9mi027218@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-24 20:10:03 +0200 (Thu, 24 May 2007)
New Revision: 705

Removed:
   trunk/src/CacheWolf/ProfilesScreen.java
Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/ProfileDataForm.java
   trunk/src/CacheWolf/ProfilesForm.java
Log:
Support fuer alte Profile entfernt

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2007-05-23 19:05:42 UTC (rev 704)
+++ trunk/src/CacheWolf/Preferences.java	2007-05-24 18:10:03 UTC (rev 705)
@@ -48,13 +48,6 @@
 	//public int nLogs = 5;
 	public boolean dirty = false;
 
-	public int currProfile = 0;
-	public String profiles[] = {"","","",""};
-	public String profdirs[] = {"","","",""};
-	public String lats[] = {"","","",""};
-	public String longs[] = {"","","",""};
-	public String lastSyncOC[] = {"","","",""};
-	public String lastDistOC[] = {"","","",""};
 	public String garminConn="com1";  // The type of connection which GPSBABEL uses: com1 OR usb.
 	public String garminGPSBabelOptions=""; // Additional options for GPSBabel, i.e. -s to synthethize short names
 	// These settings govern where the menu and the tabs are displayed and whether the statusbas is shown
@@ -271,7 +264,7 @@
 		do {	
 			if(!profileExists || (showProfileSelector==PROFILE_SELECTOR_FORCED_ON) || 
 					(showProfileSelector==PROFILE_SELECTOR_ONOROFF && !autoReloadLastProfile)){ // Ask for the profile
-				ProfilesForm f = new ProfilesForm(baseDir,profiles,lastProfile,!profileExists || hasNewButton);
+				ProfilesForm f = new ProfilesForm(baseDir,lastProfile,!profileExists || hasNewButton);
 				int code = f.execute();
 				// If no profile chosen (includes a new one), terminate
 				if (code==-1) return false; // Cancel pressed
@@ -285,15 +278,7 @@
 		} while (profileExists==false);
 		// Now we are sure that baseDir exists and basDir+profile exists
 		prof.name=lastProfile;
-		currProfile=-1;
-		if (lastProfile.equals(profiles[0])) openOldProfile(prof, 0);
-		else if (lastProfile.equals(profiles[1])) openOldProfile(prof, 1);
-		else if (lastProfile.equals(profiles[2])) openOldProfile(prof, 2);
-		else if (lastProfile.equals(profiles[3])) openOldProfile(prof, 3);
-		else { 
-			prof.dataDir=baseDir+lastProfile;
-			//mydatadir=prof.dataDir;
-		}
+		prof.dataDir=baseDir+lastProfile;
 		prof.dataDir=prof.dataDir.replace('\\','/');
 		if (!prof.dataDir.endsWith("/")) prof.dataDir+='/';
 		savePreferences();
@@ -302,31 +287,6 @@
 	}
 
 	/**
-	 * Open an old Profile (stored in preferences)
-	 * @param i 0-3 for profiles 1-4
-	 */
-	private void openOldProfile(Profile prof, int i) {
-		currProfile=i+1;
-		curCentrePt.set(lats[i]+" "+longs[i]);
-		//mydatadir=profdirs[i];
-		if(lastSyncOC[i] == null || lastSyncOC[i].endsWith("null")){
-			prof.last_sync_opencaching = "20050801000000";
-		}else {
-			prof.last_sync_opencaching = lastSyncOC[i];
-		}
-		if(lastDistOC[i] == null || lastDistOC[i].endsWith("null")){
-			prof.distOC = "0";
-		} else {
-			prof.distOC = lastDistOC[i];
-		}
-		prof.centre.set(lats[i]+" "+longs[i]);
-		prof.dataDir=profdirs[i];
-	}
-
-
-
-
-	/**
 	 * Method that gets called when a new element has been identified in pref.xml
 	 */
 	public void startElement(String name, AttributeList atts){
@@ -353,41 +313,6 @@
 			forwardGPS = Convert.toBoolean(atts.getValue("active"));
 			forwardGpsHost = atts.getValue("destinationHost");
 		}
-		//if(name.equals("logs")){
-		//	nLogs = Convert.parseInt(atts.getValue("number"));
-		//}
-		if(name.equals("profile1")){
-			profiles[0] = atts.getValue("name");
-			profdirs[0] = atts.getValue("dir");
-			lats[0] = atts.getValue("lat");
-			longs[0] = atts.getValue("lon");
-			lastSyncOC[0] = atts.getValue("lastsyncoc");
-			lastDistOC[0] = atts.getValue("lastdistoc");
-		}
-		if(name.equals("profile2")){
-			profiles[1] = atts.getValue("name");
-			profdirs[1] = atts.getValue("dir");
-			lats[1] = atts.getValue("lat");
-			longs[1] = atts.getValue("lon");
-			lastSyncOC[1] = atts.getValue("lastsyncoc");
-			lastDistOC[1] = atts.getValue("lastdistoc");
-		}
-		if(name.equals("profile3")){
-			profiles[2] = atts.getValue("name");
-			profdirs[2] = atts.getValue("dir");
-			lats[2] = atts.getValue("lat");
-			longs[2] = atts.getValue("lon");
-			lastSyncOC[2] = atts.getValue("lastsyncoc");
-			lastDistOC[2] = atts.getValue("lastdistoc");
-		}
-		if(name.equals("profile4")){
-			profiles[3] = atts.getValue("name");
-			profdirs[3] = atts.getValue("dir");
-			lats[3] = atts.getValue("lat");
-			longs[3] = atts.getValue("lon");
-			lastSyncOC[3] = atts.getValue("lastsyncoc");
-			lastDistOC[3] = atts.getValue("lastdistoc");
-		}
 		if (name.equals("lastprofile")) {
 			collectElement=new StringBuffer(50);
 			if (atts.getValue("autoreload").equals("true")) autoReloadLastProfile=true;
@@ -518,12 +443,6 @@
 	public void savePreferences(){
 		String datei = File.getProgramDirectory() + "/" + "pref.xml";
 		datei = datei.replace('\\', '/');
-		//last_sync_opencaching = last_sync_opencaching==null?"20050801000000":last_sync_opencaching;
-		//distOC = distOC==null?"0":distOC;
-		if (currProfile > 0) {
-			lastSyncOC[currProfile -1] = Global.getProfile().last_sync_opencaching;
-			lastDistOC[currProfile - 1] = Global.getProfile().distOC;
-		}
 
 		try{
 			PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(datei)));
@@ -569,10 +488,6 @@
 			//outp.print("	<syncOC date = \"" + last_sync_opencaching + "\" dist = \"" + distOC +  "\"/>\n");
 			outp.print("	<location lat = \""+curCentrePt.getLatDeg(CWPoint.DD)+"\" long = \""+curCentrePt.getLonDeg(CWPoint.DD)+"\"/>\n");
 			if (customMapsPath!=null) outp.print("	<mapspath dir = \""+ customMapsPath +"\"/>\n");
-			outp.print("	<profile1 name = \""+profiles[0]+"\" lat = \""+ lats[0] +"\" lon = \""+ longs[0] +"\" dir = \""+ profdirs[0] +"\" lastsyncoc= \"" + lastSyncOC[0] + "\" lastdistoc= \"" + lastDistOC[0] + "\" />\n");
-			outp.print("	<profile2 name = \""+profiles[1]+"\" lat = \""+ lats[1] +"\" lon = \""+ longs[1] +"\" dir = \""+ profdirs[1] +"\" lastsyncoc= \"" + lastSyncOC[1] + "\" lastdistoc= \"" + lastDistOC[1] + "\" />\n");
-			outp.print("	<profile3 name = \""+profiles[2]+"\" lat = \""+ lats[2] +"\" lon = \""+ longs[2] +"\" dir = \""+ profdirs[2] +"\" lastsyncoc= \"" + lastSyncOC[2] + "\" lastdistoc= \"" + lastDistOC[2] + "\" />\n");
-			outp.print("	<profile4 name = \""+profiles[3]+"\" lat = \""+ lats[3] +"\" lon = \""+ longs[3] +"\" dir = \""+ profdirs[3] +"\" lastsyncoc= \"" + lastSyncOC[3] + "\" lastdistoc= \"" + lastDistOC[3] + "\" />\n");
 			if (debug) outp.print("    <debug value=\"true\" />\n"); // Keep the debug switch if it is set
 			outp.print("</preferences>");
 			outp.close();

Modified: trunk/src/CacheWolf/ProfileDataForm.java
===================================================================
--- trunk/src/CacheWolf/ProfileDataForm.java	2007-05-23 19:05:42 UTC (rev 704)
+++ trunk/src/CacheWolf/ProfileDataForm.java	2007-05-24 18:10:03 UTC (rev 705)
@@ -15,7 +15,7 @@
 */
 public class ProfileDataForm extends Form {
 
-	private mButton btnOK, btnCurrentCentre, btnProfileCentre, btnCur2Prof, btnProf2Cur, btnOldProfiles;
+	private mButton btnOK, btnCurrentCentre, btnProfileCentre, btnCur2Prof, btnProf2Cur;
 	Preferences pref;
 	Profile profile;
 	CellPanel content = new CellPanel();
@@ -42,7 +42,6 @@
 		content.addLast(btnProfileCentre=new mButton(profile.centre.toString()),HSTRETCH,HFILL|LEFT);
 		addLast(content,HSTRETCH,HFILL);
 		addLast(new mLabel(""),VSTRETCH,FILL);
-		addLast(btnOldProfiles=new mButton(MyLocale.getMsg(1119,"Old Profiles")),HSTRETCH,HFILL);
 		//addNext(btnCancel = new mButton(MyLocale.getMsg(1604,"Cancel")),DONTSTRETCH,DONTFILL|LEFT);
 		addLast(btnOK = new mButton("OK"),DONTSTRETCH,HFILL|RIGHT);
 	}
@@ -88,10 +87,6 @@
 				btnCurrentCentre.setText(pref.curCentrePt.toString());
 				Global.getProfile().updateBearingDistance();
 			}
-			if (ev.target == btnOldProfiles){
-				ProfilesScreen pfs = new ProfilesScreen(pref);
-				pfs.execute();
-			}
 		}
 		super.onEvent(ev);
 	}

Modified: trunk/src/CacheWolf/ProfilesForm.java
===================================================================
--- trunk/src/CacheWolf/ProfilesForm.java	2007-05-23 19:05:42 UTC (rev 704)
+++ trunk/src/CacheWolf/ProfilesForm.java	2007-05-24 18:10:03 UTC (rev 705)
@@ -54,7 +54,7 @@
 	* @param oldProfiles List of names of old profiles
 	* @param selectedProfile Name of the last used profile
 	*/
-	public ProfilesForm(String baseDir, String[] oldProfiles,String selectedProfile, boolean hasNewButton){
+	public ProfilesForm(String baseDir, String selectedProfile, boolean hasNewButton){
 		super();
     	resizable =  false;
 		int w=MyLocale.getScreenWidth();
@@ -70,12 +70,6 @@
 		}
 		
 		choice=new MyList();
-        // First add the old style profiles (stored in pref.xml)
-        if (oldProfiles[0].length()>0) choice.addItem(oldProfiles[0]);
-        if (oldProfiles[1].length()>0) choice.addItem(oldProfiles[1]);
-        if (oldProfiles[2].length()>0) choice.addItem(oldProfiles[2]);
-        if (oldProfiles[3].length()>0) choice.addItem(oldProfiles[3]);
-        if (choice.itemsSize()>0) choice.addItem("-");
 		// Get all subdirectories in the base directory
 		File fileBaseDir=new File(baseDir);
 		String[] existingProfiles=fileBaseDir.list("*",FileBase.LIST_DIRECTORIES_ONLY);

Deleted: trunk/src/CacheWolf/ProfilesScreen.java
===================================================================
--- trunk/src/CacheWolf/ProfilesScreen.java	2007-05-23 19:05:42 UTC (rev 704)
+++ trunk/src/CacheWolf/ProfilesScreen.java	2007-05-24 18:10:03 UTC (rev 705)
@@ -1,189 +0,0 @@
-package CacheWolf;
-
-import ewe.sys.*;
-import ewe.ui.*;
-import ewe.filechooser.*;
-
-/**
-*	This form displays fields to enter up to 4 different profile configurations.
-*	A profile consists of the name an directory entered here as well as the current
-*	home coordinates set up in the preferences screen.
-*	Class ID = 1100
-*/
-public class ProfilesScreen extends Form {
-	mButton cancelB, applyB;
-	Preferences pref;
-	mInput name1,dir1;
-	mInput name2,dir2;
-	mInput name3,dir3;
-	mInput name4,dir4;
-	mButton but1,but2,but3,but4,btnCoords1,btnCoords2,btnCoords3,btnCoords4;
-	CellPanel content = new CellPanel();
-	ScrollBarPanel scp;
-	
-	/**
-	*	Constructor!
-	*	Existing profile values are assigned upon set-up.
-	*/
-	public ProfilesScreen(Preferences p){
-		scp = new ScrollBarPanel(content);
-		pref = p;
-		setMinimumSize(240,240);
-		setMaximumSize(300,400);
-
-		this.title = MyLocale.getMsg(1100,"Profiles");
-		
-		//content.addLast(new mLabel(MyLocale.getMsg(1101,"Profile 1")));
-		content.addNext(new mLabel(MyLocale.getMsg(1101,"Profile 1")));
-		content.addLast(btnCoords1 = new mButton(pref.lats[0] + " " + pref.longs[0]));
-		content.addNext(new mLabel("Name"));
-		content.addLast(name1 = new mInput());
-		content.addNext(new mLabel("Dir"));
-		content.addNext(dir1 = new mInput());
-		content.addLast(but1 = new mButton(MyLocale.getMsg(1105,"Browse")));
-		name1.setText(pref.profiles[0]);
-		dir1.setText(pref.profdirs[0]);
-		
-		//content.addLast(new mLabel(MyLocale.getMsg(1102,"Profile 1")));
-		content.addNext(new mLabel(MyLocale.getMsg(1102,"Profile 2")));
-		content.addLast(btnCoords2 = new mButton(pref.lats[1] + " " + pref.longs[1]));
-		content.addNext(new mLabel("Name"));
-		content.addLast(name2 = new mInput());
-		content.addNext(new mLabel("Dir"));
-		content.addNext(dir2 = new mInput());
-		content.addLast(but2 = new mButton(MyLocale.getMsg(1105,"Browse")));
-		name2.setText(pref.profiles[1]);
-		dir2.setText(pref.profdirs[1]);
-		
-		//content.addLast(new mLabel(MyLocale.getMsg(1103,"Profile 1")));
-		content.addNext(new mLabel(MyLocale.getMsg(1103,"Profile 3")));
-		content.addLast(btnCoords3 = new mButton(pref.lats[2] + " " + pref.longs[2]));
-		content.addNext(new mLabel("Name"));
-		content.addLast(name3 = new mInput());
-		content.addNext(new mLabel("Dir"));
-		content.addNext(dir3 = new mInput());
-		content.addLast(but3 = new mButton(MyLocale.getMsg(1105,"Browse")));
-		name3.setText(pref.profiles[2]);
-		dir3.setText(pref.profdirs[2]);
-		
-		//content.addLast(new mLabel(MyLocale.getMsg(1104,"Profile 1")));
-		content.addNext(new mLabel(MyLocale.getMsg(1104,"Profile 4")));
-		content.addLast(btnCoords4 = new mButton(pref.lats[3] + " " + pref.longs[3]));
-		content.addNext(new mLabel("Name"));
-		content.addLast(name4 = new mInput());
-		content.addNext(new mLabel("Dir"));
-		content.addNext(dir4 = new mInput());
-		content.addLast(but4 = new mButton(MyLocale.getMsg(1105,"Browse")));
-		name4.setText(pref.profiles[3]);
-		dir4.setText(pref.profdirs[3]);
-		content.addNext(new mLabel(""));
-		content.addNext(cancelB = new mButton(MyLocale.getMsg(614,"Cancel")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		content.addLast(applyB = new mButton(MyLocale.getMsg(620,"Save")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.EAST));
-		
-		this.addLast(scp.getScrollablePanel(), CellConstants.STRETCH, CellConstants.FILL);
-
-	}
-	
-	/**
-	*	Event handler to react to a users input.
-	*	First of all the form catches if a user enteres or changes any of the
-	*	input fields.
-	*	When the user closes the form by hitting the Apply - Button the form checks
-	*	if any of the fields have been changed. If so the values are updated in preferences
-	*	and the currently set up home coordinates are associated with the updated
-	*	profile.
-	*	The form the requests the profiles to be saved and then closes itself.
-	*/
-	public void onEvent(Event ev){
-		
-		
-		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
-			if (ev.target == cancelB){
-				this.close(0);
-			}
-			if (ev.target == applyB){
-				pref.profiles[0] = name1.getText();
-				pref.profdirs[0] = dir1.getText();
-				pref.profiles[1] = name2.getText();
-				pref.profdirs[1] = dir2.getText();
-				pref.profiles[2] = name3.getText();
-				pref.profdirs[2] = dir3.getText();
-				pref.profiles[3] = name4.getText();
-				pref.profdirs[3] = dir4.getText();
-				pref.savePreferences();
-				//pref.dirty = true; No need to reload database here
-				this.close(0);
-			}
-
-			if(ev.target == btnCoords1){
-				getCoords((mButton)ev.target,0);
-			}
-
-			if(ev.target == btnCoords2){
-				getCoords((mButton)ev.target,1);
-			}
-			
-			if(ev.target == btnCoords3){
-				getCoords((mButton)ev.target,2);
-			}
-			
-			if(ev.target == btnCoords4){
-				getCoords((mButton)ev.target,3);
-			}
-			
-			if(ev.target == but1){
-				FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, pref.baseDir);
-				fc.setTitle(MyLocale.getMsg(616,"Select data directory"));
-				if(fc.execute() != IDCANCEL)	{
-					dir1.setText(fc.getChosen()+"/");
-				}
-			}
-			if(ev.target == but2){
-				FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, pref.baseDir);
-				fc.setTitle(MyLocale.getMsg(616,"Select data directory"));
-				if(fc.execute() != IDCANCEL)	{
-					dir2.setText(fc.getChosen()+"/");
-				}
-			}
-			if(ev.target == but3){
-				FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, pref.baseDir);
-				fc.setTitle(MyLocale.getMsg(616,"Select data directory"));
-				if(fc.execute() != IDCANCEL)	{
-					dir3.setText(fc.getChosen()+"/");
-				}
-			}
-			if(ev.target == but4){
-				FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, pref.baseDir);
-				fc.setTitle(MyLocale.getMsg(616,"Select data directory"));
-				if(fc.execute() != IDCANCEL)	{
-					dir4.setText(fc.getChosen()+"/");
-				}
-			}
-			
-		}
-		super.onEvent(ev);
-	}
-	
-	private void getCoords(mButton btn,int idx){
-		CoordsScreen cs = new CoordsScreen();
-		CWPoint profCoords = new CWPoint();
-		//minimum check if there is some Data in the prefs
-		if (pref.lats[idx] != null &&  pref.longs[idx] != null 
-		&& (pref.lats[idx].length() > 9) && (pref.longs[idx].length() > 9)) {
-			profCoords.set(pref.lats[idx] + " " + pref.longs[idx], CWPoint.CW);
-		}
-		cs.setFields(profCoords, CWPoint.DMM);
-		if (cs.execute()== IDOK){
-			profCoords = cs.getCoords();
-			// remember coords for profile ...
-			pref.lats[idx] = profCoords.getNSLetter() + " " + profCoords.getLatDeg(CWPoint.DMM) + " " +
-							  profCoords.getLatMin(CWPoint.DMM);
-			pref.longs[idx] = profCoords.getEWLetter() + " " + profCoords.getLonDeg(CWPoint.DMM) + " " +
-			  				   profCoords.getLonMin(CWPoint.DMM);
-			btn.setText((pref.lats[idx] + " " + pref.longs[idx]));
-			// .. and set current preferences
-			pref.curCentrePt.set(profCoords);
-		}
-		
-	}
-}



From salzkammergut at mail.berlios.de  Thu May 24 20:49:53 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 24 May 2007 20:49:53 +0200
Subject: [Cachewolf-svn] r706 - trunk/docs
Message-ID: <200705241849.l4OInrru031645@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-24 20:49:49 +0200 (Thu, 24 May 2007)
New Revision: 706

Added:
   trunk/docs/NotizenFuerEntwickler.txt
Log:
Erste Version von Notizen fuer Entwickler - Bitte erweitern 

Added: trunk/docs/NotizenFuerEntwickler.txt
===================================================================
--- trunk/docs/NotizenFuerEntwickler.txt	2007-05-24 18:10:03 UTC (rev 705)
+++ trunk/docs/NotizenFuerEntwickler.txt	2007-05-24 18:49:49 UTC (rev 706)
@@ -0,0 +1,33 @@
+Notizen f?r Entwickler:
+
+1. Zugriff auf globale Objekte:
+	Preferences pref = Global.getPref();	// Pr?ferenzen
+	Profile profile=Global.getProfile();	// Das aktuelle Profil
+	MainTab mainTab;						// Das mainTab Objekt (Enth?lt alle Ansichten)
+	
+2. Aufzeichnung von internen Fehlern in der log.txt:
+	Die Datei log.txt wird bei jedem Spidervorgang neu generiert.
+	F?r die Aufzeichnung von Fehlern (oder auch nur Ablaufverfolgungen wie z.B. in SpiderGC)
+	stehen folgende Routinen zur Verf?gung (alle in Preferences.java)
+	
+	public void log(String text)					// Beliebige Fehlermeldung mit Zeitstempel
+	public void log(String message,Exception e) 	// Exception mit Zeitstempel (nutzt obige Funktion)
+	public void log(String text,Throwable e, 		// Exception mit Zeitstempel und Stacktrace
+		boolean withStackTrace) 
+	
+	Beispiel:
+	Global.getPref().log("Fehler bei xxx");
+	
+3. Debug-Schalter:
+	Es besteht die M?glichkeit ?ber einen undokumentierten Schalter in der pref.xml 
+	"schlafenden" Debug-Code bei Probleme selektiv zu aktivieren. Dazu ist in der pref.xml
+	die Zeile 
+		<debug value="true">
+	einzuf?gen.
+	Der Wert der debug Variablen kann dann wie folgt abgefragt werden:
+		if(Global.getPref().debug) {
+			// Code der nur ausgef?hrt wird wenn debug Schalter gesetzt
+			// z.B. ausf?hrlichere Fehlermeldung
+		}
+
+



From salzkammergut at mail.berlios.de  Thu May 24 21:06:13 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 24 May 2007 21:06:13 +0200
Subject: [Cachewolf-svn] r707 - in trunk/src: CacheWolf exp
Message-ID: <200705241906.l4OJ6DBT032614@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-24 21:05:50 +0200 (Thu, 24 May 2007)
New Revision: 707

Added:
   trunk/src/CacheWolf/CacheHolderDetail.java
Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/DBStats.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/GPXImporter.java
   trunk/src/CacheWolf/HintLogPanel.java
   trunk/src/CacheWolf/ImagePanel.java
   trunk/src/CacheWolf/LOCXMLImporter.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/NotesScreen.java
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SpiderGC.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/exp/Exporter.java
   trunk/src/exp/GPXExporter.java
   trunk/src/exp/HTMLExporter.java
   trunk/src/exp/MSARCSVExporter.java
   trunk/src/exp/TPLExporter.java
Log:
Auftrennung des CacheHolder Objekts in CacheHolder und CacheHolderDetail.
Ersteres haengt in der CacheDB, letzters wird nur befuellt wenn die Details
eines Caches (+Logs, Bilder, LongDescription, Bugs usw.) benoetigt werden.
Dies ist die erste Version, noch weitere Optimierungen notwendig.

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/CacheHolder.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -17,490 +17,98 @@
 *	
 */
 public class CacheHolder {
-  private String NODISTANCE="? km";
-  private String NOBEARING="?";
-  private String EMPTY=""; // Needs less Memory than using 'new String()'
-  //public String UUID = EMPTY;
-  public String wayPoint = EMPTY;
-  public String LongDescription = EMPTY;
-  public String CacheName = EMPTY;
-  public String CacheOwner = EMPTY;
-  public CWPoint pos = new CWPoint();
-  public String LatLon = pos.toString();
-  public String DateHidden = EMPTY;
-  public String LastUpdate = EMPTY;
-  public String Hints = EMPTY;
-  public Vector CacheLogs = new Vector(0);
-  public String CacheNotes = EMPTY;
-  public String CacheStatus = EMPTY;
-  public String CacheSize = "None";
-  public String distance = NODISTANCE;
-  public String bearing = NOBEARING;
-  public double degrees = 0;
-  public double kilom = 0;
-  public String hard = EMPTY;
-  public String terrain = EMPTY;
-  public String type = "0";
-  public String dirty = EMPTY;
-  public Vector Images = new Vector();
-  public Vector ImagesText = new Vector();
-  public Vector LogImages = new Vector();
-  public Vector LogImagesText = new Vector();
-  public Vector UserImages = new Vector();
-  public Vector UserImagesText = new Vector();
-  public Vector attributes = new Vector();
-  public Vector CacheIcons = new Vector();
-  public String Bugs = EMPTY;
-  public String URL = EMPTY;
-  public String ocCacheID = EMPTY;
-  public int noFindLogs = 0;
-  public boolean is_archived = false;
-  public boolean is_available = true;
-  public boolean has_bug = false;
-  public boolean is_black = false;
-  public boolean is_filtered = false;
-  public boolean is_flaged = false;
-  public boolean is_owned = false;
-  public boolean is_found = false;
-  public boolean is_new = false;
-  public boolean is_log_update = false;
-  public boolean is_update = false;
-  public boolean is_selected = false;
-  public boolean is_incomplete=false;
-  public boolean is_HTML = true;
-  public boolean is_Checked = false;
-  public Vector addiWpts = new Vector();
-  public CacheHolder mainCache;
-  public String sort;
-    
-  
-  /**
- * Method to update an existing cache with new data. This is
- * necessary to avoid missing old logs.
- * @param newCh new cache data
- * @return CacheHolder with updated data
- */
-public CacheHolder update(CacheHolder newCh){
-	  // flags
-	  this.is_available = newCh.is_available;
-	  this.is_archived = newCh.is_archived;
-	  // update is_owned only if not the owner ????
-	  if (this.is_owned == false) this.is_owned = newCh.is_owned;
-	  // update is_found if not already found
-	  if (this.is_found == false) this.is_found = newCh.is_found;
-	  // no else, because status can change.
-	  if (this.is_found == true) this.CacheStatus = MyLocale.getMsg(318,"Found");
-	  
-	  
-	  this.is_new = false;
-	  this.is_update = false;
-	  this.is_log_update = false;
-	  
-	  //name and owner
-	  this.CacheName = newCh.CacheName;
-	  this.CacheOwner = newCh.CacheOwner;
+protected String NODISTANCE = "? km";
+protected String NOBEARING = "?";
+protected String EMPTY = "";
 
-	  //classification
-	  this.hard = newCh.hard;
-	  this.terrain = newCh.terrain;
-	  this.type = newCh.type;
-	  
-	  //travelbugs: overriding is OK, since GPX-File contains all actual travelbugs
-	  this.has_bug = newCh.has_bug;
-	  this.Bugs = newCh.Bugs;
-	  
-	  // URL
-	  this.URL = newCh.URL;
-	  
-	  //coords
-	  this.LatLon = newCh.LatLon;
-	  this.pos.set(newCh.pos);
+public String CacheStatus = EMPTY;
+public String wayPoint = EMPTY;
+public String CacheName = EMPTY;
+public String CacheOwner = EMPTY;
+public CWPoint pos = new CWPoint();
+public String LatLon = pos.toString();
+public String DateHidden = EMPTY;
+public String CacheSize = "None";
+public double kilom = 0;
+public String distance = NODISTANCE;
+public String bearing = NOBEARING;
+public double degrees = 0;
+public String hard = EMPTY;
+public String terrain = EMPTY;
+public String type = "0";
+public boolean is_archived = false;
+public boolean is_available = true;
+public boolean is_owned = false;
+public boolean is_found = false;
+public boolean is_filtered = false;
+public boolean is_log_update = false;
+public boolean is_update = false;
+public boolean is_selected = false;
+public boolean is_incomplete = false;
+public boolean is_black = false;
+public boolean is_new = false;
+public boolean is_flaged = false;
+public boolean is_Checked = false;
+public String dirty = EMPTY;
+public String ocCacheID = EMPTY;
+public int noFindLogs = 0;
+public boolean has_bug = false;
+public boolean is_HTML = true;
+public Vector addiWpts = new Vector();
+public CacheHolder mainCache;
+public String sort;
 
-	  // check only length of the description to see, if there was an update
-	  if (this.LongDescription.length() != newCh.LongDescription.length()){
-		  this.is_update = true;
-	  }
-	  // same for hints
-	  if (this.Hints.length() != newCh.Hints.length()){
-		  this.is_update = true;
-	  }
-	  
-	  // description & hints
-	  this.is_HTML = newCh.is_HTML;
-	  this.LongDescription = newCh.LongDescription;
-	  this.Hints = newCh.Hints;
-
-	  //Logs
-	  //<img src='icon_smile.gif'>&nbsp;2005-10-30 by Schatzpirat</strong><br>
-	  //get Date of latest log in old cachedata
-	  Extractor extOldDate;
-	  String oldLogDate = EMPTY;
-	  if(this.CacheLogs.size()>0){
-		extOldDate = new Extractor((String) this.CacheLogs.get(0), ";"," by", 0, true);
-		oldLogDate= new String(extOldDate.findNext());
-	  }
-	  // now loop through new cachedata and compare logentries, 
-	  // starting with oldest log
-	  
-	  //Vm.debug("made it to here!");
-	  int currLog = newCh.CacheLogs.size()-1;
-	  String newLogDate = EMPTY;
-	  while (currLog >= 0 ){
-		  Extractor extNewDate = new Extractor((String) newCh.CacheLogs.get(currLog), ";"," by", 0, true);
-		  newLogDate = extNewDate.findNext();
-		  if (newLogDate.compareTo(oldLogDate)> 0){
-	  		  // oldest log from new cachedata is younger than stored data
-	  		  // put the new logs in front of old logs
-			  //Vm.debug(newCh.wayPoint + " New: " + newLogDate + " Old: " + oldLogDate + " cmp: " + newLogDate.compareTo(oldLogDate));
-			  while (currLog >= 0) this.CacheLogs.add(0, newCh.CacheLogs.get(currLog--));
-			  this.is_log_update = true;
-		  }
-		  else currLog--;
-	  }//while
-   	 //Check for number sukzessive DNF logs
-	 int z = 0;
-	 String loganal = EMPTY;
-	 //Vm.debug("Checking size: ");
-	 //int sz = newCh.CacheLogs.size();
-	 //Vm.debug("log size: " + sz);
- 	 while(z < newCh.CacheLogs.size() && z < 5){
-		loganal = (String)newCh.CacheLogs.get(z);
-		if(loganal.indexOf("icon_sad")>0) {
-			z++;
-		}else break;
-	 }
-	 noFindLogs = z;
- 	return this;
-  }
-  
-	public Object clone(){
-		CacheHolder cx = new CacheHolder();
-		cx.CacheName = CacheName;
-		cx.CacheOwner = CacheOwner;
-		cx.LatLon = LatLon;
-		cx.DateHidden = DateHidden;
-		cx.wayPoint = 	wayPoint;
-		cx.CacheStatus=CacheStatus;
-		cx.type=type;
-		cx.hard=hard;
-		cx.terrain=terrain;
-		cx.dirty=dirty;
-		cx.CacheSize=CacheSize;
-		cx.is_available=is_available;
-		cx.is_archived=is_archived;
-		cx.has_bug=has_bug;
-		cx.is_black=is_black;
-		cx.is_filtered=is_filtered;
-		cx.is_owned=is_owned;
-		cx.is_found=is_found;
-		cx.is_new=is_new;
-		cx.is_log_update=is_log_update;
-		cx.is_update=is_update;
-		cx.is_HTML=is_HTML;
-		cx.noFindLogs=noFindLogs;
-		cx.ocCacheID=ocCacheID;
-		cx.is_incomplete=is_incomplete;
-		cx.ocCacheID=ocCacheID;
-		cx.ocCacheID=ocCacheID;
-		return cx;
-	}
-
-	/**
-	 * Method to clear all attributes of the cache.
-	 * 
-	 */
-	public void freeMEM(){
-		LongDescription = EMPTY;
-		LastUpdate = EMPTY;
-		Hints = EMPTY;
-		CacheLogs = null;
-		CacheNotes = EMPTY;
-		Images = null;
-		ImagesText = null;
-		LogImages = null;
-		LogImagesText = null;
-		UserImages = null;
-		UserImagesText = null;
-		attributes = null;
-		CacheIcons = null;
-		Bugs = EMPTY;
-		URL = EMPTY;
-		ocCacheID = EMPTY;
-	}
+CacheHolder() {}
+CacheHolder(String wpt) {this.wayPoint=wpt; }
+CacheHolder(CacheHolder ch) {
+	this.CacheStatus=ch.CacheStatus;
+	this.wayPoint = ch.wayPoint;
+	this.CacheName = ch.CacheName;
+	this.CacheOwner = ch.CacheOwner;
+	this.pos = ch.pos;
+	this.LatLon = ch.LatLon;
+	this.DateHidden = ch.DateHidden;
+	this.CacheSize = ch.CacheSize;
+	this.kilom = ch.kilom;
+	this.distance = ch.distance;
+	this.bearing = ch.bearing;
+	this.degrees = ch.degrees;
+	this.hard = ch.hard;
+	this.terrain = ch.terrain;
+	this.type = ch.type;
+	this.is_archived = ch.is_archived;
+	this.is_available = ch.is_available;
+	this.is_owned = ch.is_owned;
+	this.is_found = ch.is_found;
+	this.is_filtered = ch.is_filtered;
+	this.is_log_update = ch.is_log_update;
+	this.is_update = ch.is_update;
+	this.is_selected = ch.is_selected;
+	this.is_incomplete = ch.is_incomplete;
+	this.is_black=ch.is_black;
+	this.addiWpts = ch.addiWpts;
+	this.mainCache=ch.mainCache;
+	this.is_new=ch.is_new;
+	this.is_flaged = ch.is_flaged;
+	this.is_Checked = ch.is_Checked;
+    this.dirty = ch.dirty;
+	this.ocCacheID = ch.ocCacheID;
+	this.noFindLogs = ch.noFindLogs;
+	this.has_bug = ch.has_bug;
+	this.is_HTML = ch.is_HTML;
+	this.sort=ch.sort;
 	
-  /**
-   * Adds a user image to the cache data
-   * @param profile
-   */
-	public void addUserImage(Profile profile){
-	  File imgFile;
-	  String imgDesc, imgDestName;
-	  
-	  //Get Image and description
-		FileChooser fc = new FileChooser(FileChooser.OPEN, profile.dataDir);
-		fc.setTitle("Select image file:");
-		if(fc.execute() != FileChooser.IDCANCEL){
-			imgFile = fc.getChosenFile();
-			imgDesc = new InputBox("Description").input("",10);
-			//Create Destination Filename
-			String ext = imgFile.getFileExt().substring(imgFile.getFileExt().lastIndexOf("."));
-			imgDestName = this.wayPoint + "_U_" + (this.UserImages.size()+1) + ext;
-			
-			this.UserImages.add(imgDestName);
-			this.UserImagesText.add(imgDesc);
-			// Copy File
-			DataMover.copy(imgFile.getFullPath(),profile.dataDir + imgDestName);
-			// Save Data
-			saveCacheDetails(profile.dataDir);
-		}
-  }
-  /**
-   * Adds a new log to the cachedata 
-   * @param logEntry
-   */
-  public void addLog(String logEntry){
-	  //Logs
-	  //<img src='icon_smile.gif'>&nbsp;2005-10-30 by Schatzpirat</strong><br>
-	  //get Date of latest log in old cachedata
-	  Extractor extOldDate;
-	  String oldLogDate = new String();
-	  if(this.CacheLogs.size()>0){
-		extOldDate = new Extractor((String) this.CacheLogs.get(0), ";"," by", 0, true);
-		oldLogDate= new String(extOldDate.findNext());
-	  }
+}
 
-	  String newLogDate;
-	  Extractor extNewDate = new Extractor(logEntry, ";"," by", 0, true);
-	  newLogDate = extNewDate.findNext();
-	  if (newLogDate.compareTo(oldLogDate)> 0){
-  		  // oldest log from new cachedata is younger than stored data
-  		  // put the new logs in front of old logs
-		  //Vm.debug(newCh.wayPoint + " New: " + newLogDate + " Old: " + oldLogDate + " cmp: " + newLogDate.compareTo(oldLogDate));
-		  this.CacheLogs.add(0, logEntry);
-		  this.is_log_update = true;
-		  if (logEntry.indexOf("icon_sad")> 0) this.noFindLogs++;
-		  return;
-	  }
-	  if (newLogDate.compareTo(oldLogDate)== 0){
-		  // logdate is equal, so check, if finder is equal
-		  String newLogFinder, oldLogFinder;
-		  Extractor extOldFinder = new Extractor((String) this.CacheLogs.get(0), "by ","<", 0, true);
-		  oldLogFinder = extOldFinder.findNext().toLowerCase();
-		  
-		  Extractor extNewFinder = new Extractor(logEntry, "by ","<", 0, true);
-		  newLogFinder = extNewFinder.findNext().toLowerCase();
-		  
-		  if (newLogFinder.compareTo(oldLogFinder)!= 0){
-			  this.CacheLogs.add(0, logEntry);
-			  this.is_log_update = true;
-			  if (logEntry.indexOf("icon_sad")> 0) this.noFindLogs++;
-		  }
-	  }
-  }
-
-  
-	/**
-	*	Method to parse a specific cache.xml file.
-	*	It fills information on cache details, hints, logs, notes and
-	*	images.
-	*/
-	public void readCache(String dir) throws IOException{
-		String dummy;
-		FileReader in = new FileReader(dir+wayPoint+".xml");
-		String text= in.readAll();
-		in.close();
-		Extractor ex = new Extractor(text, "<DETAILS><![CDATA[", "]]></DETAILS>", 0, true);		
-		LongDescription = ex.findNext();
-		ex = new Extractor(text, "<HINTS><![CDATA[", "]]></HINTS>", 0, true);
-		Hints = ex.findNext();
-		ex = new Extractor(text, "<LOGS>","</LOGS>", 0, true);
-		dummy = ex.findNext();
-		CacheLogs.clear();
-		ex = new Extractor(dummy, "<LOG><![CDATA[","]]></LOG>", 0, true);
-		
-		dummy = ex.findNext();
-		while(ex.endOfSearch()==false){
-			CacheLogs.add(dummy);
-			dummy = ex.findNext();
-		}
-		ex = new Extractor(text, "<NOTES><![CDATA[", "]]></NOTES>", 0, true);
-		CacheNotes = ex.findNext();
-		Images.clear();
-		ex = new Extractor(text, "<IMG>", "</IMG>", 0, true);
-		dummy = ex.findNext();
-		while(ex.endOfSearch() == false){
-			Images.add(dummy);
-			dummy = ex.findNext();
-		}
-		ImagesText.clear();
-		ex = new Extractor(text, "<IMGTEXT>", "</IMGTEXT>", 0, true);
-		dummy = ex.findNext();
-		while(ex.endOfSearch() == false){
-			ImagesText.add(dummy);
-			dummy = ex.findNext();
-		}
-		// Logimages
-		LogImages.clear();
-		ex = new Extractor(text, "<LOGIMG>", "</LOGIMG>", 0, true);
-		dummy = ex.findNext();
-		while(ex.endOfSearch() == false){
-			LogImages.add(dummy);
-			dummy = ex.findNext();
-		}
-		LogImagesText.clear();
-		ex = new Extractor(text, "<LOGIMGTEXT>", "</LOGIMGTEXT>", 0, true);
-		dummy = ex.findNext();
-		while(ex.endOfSearch() == false){
-			LogImagesText.add(dummy);
-			dummy = ex.findNext();
-		}
-
-		UserImages.clear();
-		ex = new Extractor(text, "<USERIMG>", "</USERIMG>", 0, true);
-		dummy = ex.findNext();
-		while(ex.endOfSearch() == false){
-			UserImages.add(dummy);
-			dummy = ex.findNext();
-		}
-		UserImagesText.clear();
-		ex = new Extractor(text, "<USERIMGTEXT>", "</USERIMGTEXT>", 0, true);
-		dummy = ex.findNext();
-		while(ex.endOfSearch() == false){
-			UserImagesText.add(dummy);
-			dummy = ex.findNext();
-		}
-
-
-		ex = new Extractor(text, "<BUGS><![CDATA[", "]]></BUGS>", 0, true);
-		Bugs = ex.findNext();
-		
-		ex = new Extractor(text, "<URL><![CDATA[", "]]></URL>", 0, true);
-		// if no URL is stored, set default URL (at this time only possible for gc.com)
-		dummy = ex.findNext();
-		if (dummy.length() > 10){
-			URL = dummy;
-		}
-		else {
-			if (wayPoint.startsWith("GC")) {
-				URL = "http://www.geocaching.com/seek/cache_details.aspx?wp="+ wayPoint + "&Submit6=Find&log=y";
-			}
-		}
-
-	}
-	
-	/**
-	*	Method to save a cache.xml file.
-	*/
-	public void saveCacheDetails(String dir){
-		PrintWriter detfile;
-		String dummy = new String();
-		//File exists?
-		boolean exists = (new File(dir + wayPoint + ".xml")).exists();
-		//yes: then delete
-		if (exists) {
-			boolean ok = (new File(dir + wayPoint + ".xml")).delete();
-			if(ok) ok = true;
-		}
-		boolean exists2 = (new File(dir + wayPoint.toLowerCase() + ".xml")).exists();
-		//yes: delete
-		if (exists2) {
-			boolean ok2 = (new File(dir + wayPoint.toLowerCase() + ".xml")).delete();
-			if(ok2) ok2=true;
-		}
-		//Vm.debug("Writing to: " +dir + "for: " + wayPoint);
-		try{
-		  detfile = new PrintWriter(new BufferedWriter(new FileWriter(dir + wayPoint + ".xml")));
-		} catch (Exception e) {
-			Global.getPref().log("Problem opening details file",e,true);
-			return;
-		}
-		try{
-			if(wayPoint.length()>0){
-			  detfile.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n");
-			  detfile.print("<CACHEDETAILS>\r\n");
-			  detfile.print("<DETAILS><![CDATA["+LongDescription+"]]></DETAILS>\r\n");
-			  detfile.print("<HINTS><![CDATA["+Hints+"]]></HINTS>\r\n");
-			  detfile.print("<LOGS>\r\n");
-			  for(int i = 0; i < CacheLogs.size(); i++){
-				  dummy = (String)CacheLogs.get(i);
-				  detfile.print("<LOG><![CDATA[\r\n");
-				  detfile.print(dummy);
-				  detfile.print("\r\n]]></LOG>\r\n");
-			  }
-			  detfile.print("</LOGS>\r\n");
-		
-			  detfile.print("<NOTES><![CDATA["+CacheNotes+"]]></NOTES>\n");
-			  detfile.print("<IMAGES>");
-			  String stbuf = new String();
-			  for(int i = 0;i<Images.size();i++){
-					stbuf = (String)Images.get(i);
-					detfile.print("    <IMG>"+stbuf+"</IMG>\n");
-			  }
-			  for(int i = 0;i<ImagesText.size();i++){
-					stbuf = (String)ImagesText.get(i);
-					detfile.print("    <IMGTEXT>"+stbuf+"</IMGTEXT>\n");
-			  }
-
-			  for(int i = 0;i<LogImages.size();i++){
-					stbuf = (String)LogImages.get(i);
-					detfile.print("    <LOGIMG>"+stbuf+"</LOGIMG>\n");
-			  }
-			  for(int i = 0;i<LogImagesText.size();i++){
-					stbuf = (String)LogImagesText.get(i);
-					detfile.print("    <LOGIMGTEXT>"+stbuf+"</LOGIMGTEXT>\n");
-			  }
-			  for(int i = 0;i<UserImages.size();i++){
-					stbuf = (String)UserImages.get(i);
-					detfile.print("    <USERIMG>"+stbuf+"</USERIMG>\n");
-			  }
-			  for(int i = 0;i<UserImagesText.size();i++){
-					stbuf = (String)UserImagesText.get(i);
-					detfile.print("    <USERIMGTEXT>"+stbuf+"</USERIMGTEXT>\n");
-			  }
-
-
-			  detfile.print("</IMAGES>\n");
-			  detfile.print("<BUGS><![CDATA[\n");
-			  detfile.print(Bugs+"\n");
-			  detfile.print("]]></BUGS>\n");
-			  detfile.print("<URL><![CDATA["+URL+"]]></URL>\r\n");
-			  detfile.print("</CACHEDETAILS>\n");
-			} // if length
-		} catch (Exception e){
-			Vm.debug("Problem writing to a details file");
-		}
-		try{
-		  detfile.close();
-		} catch (Exception e){
-		  //Vm.debug("Problem closing details file");
-		}
-	}
-	
-	/**
-	 * Method for checking if to caches belongs to each other, e.g.
-	 * an additional waypoint belongs to the main cache.
-	 * Works currently only, if the last 4 or 5 chars of the waypoint are
-	 * the same, this is the gc.com way. 
-	 * @param ch cache to check
-	 * @return true if there is a relation, false otherwise
-	 */
-	public boolean belongsTo (CacheHolder ch) {
-		
-		// avoid self referencing
-		if (this.wayPoint.equals(ch.wayPoint)) return false;
-
-		return this.wayPoint.endsWith(ch.wayPoint.substring(2));
-	}
-	
-   
-   public boolean isAddiWpt(){
+public boolean isAddiWpt() {
 	   return CacheType.isAddiWpt(this.type);
    }
-   
+
    public boolean hasAddiWpt() {
 	   if (this.addiWpts.getCount()>0) return true;
 	   else return false;
    }
+
    
    public void calcDistance(CWPoint toPoint) {	
 	   if(pos.isValid()){
@@ -513,7 +121,6 @@
 		   bearing = NOBEARING;
 	   }
    }
-
    public void setAttributesFromMainCache(CacheHolder mainCh){
 	   this.CacheOwner = mainCh.CacheOwner;
 	   this.CacheStatus = mainCh.CacheStatus;
@@ -534,5 +141,9 @@
 		   }
 	   }
    }
-   
+
+//public void finalize() {
+//   Vm.debug("Destroying CacheHolderBase "+wayPoint);
+//}
+
 }
\ No newline at end of file

Added: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -0,0 +1,407 @@
+package CacheWolf;
+
+import ewe.filechooser.FileChooser;
+import ewe.io.BufferedWriter;
+import ewe.io.File;
+import ewe.io.FileReader;
+import ewe.io.FileWriter;
+import ewe.io.IOException;
+import ewe.io.PrintWriter;
+import ewe.sys.Vm;
+import ewe.ui.InputBox;
+import ewe.util.Vector;
+
+public class CacheHolderDetail extends CacheHolder {
+	  public String LongDescription = EMPTY;
+	  public String LastUpdate = EMPTY;
+	  public String Hints = EMPTY;
+	  public Vector CacheLogs = new Vector(0);
+	  public String CacheNotes = EMPTY;
+	  public Vector Images = new Vector();
+	  public Vector ImagesText = new Vector();
+	  public Vector LogImages = new Vector();
+	  public Vector LogImagesText = new Vector();
+	  public Vector UserImages = new Vector();
+	  public Vector UserImagesText = new Vector();
+	  public Vector attributes = new Vector();
+	  public Vector CacheIcons = new Vector();
+	  public String Bugs = EMPTY;
+	  public String URL = EMPTY;
+	  
+	 public CacheHolderDetail() {
+	 }
+	 public CacheHolderDetail(String wpt) {super(wpt); }
+	 public CacheHolderDetail(CacheHolder ch) {
+		 super(ch);
+	 }
+	  
+	  /**
+	 * Method to update an existing cache with new data. This is
+	 * necessary to avoid missing old logs.
+	 * @param newCh new cache data
+	 * @return CacheHolder with updated data
+	 */
+	public CacheHolderDetail update(CacheHolderDetail newCh){
+		  // flags
+		  this.is_available = newCh.is_available;
+		  this.is_archived = newCh.is_archived;
+		  // update is_owned only if not the owner ????
+		  if (this.is_owned == false) this.is_owned = newCh.is_owned;
+		  // update is_found if not already found
+		  if (this.is_found == false) this.is_found = newCh.is_found;
+		  // no else, because status can change.
+		  if (this.is_found == true) this.CacheStatus = MyLocale.getMsg(318,"Found");
+		  
+		  
+		  this.is_new = false;
+		  this.is_update = false;
+		  this.is_log_update = false;
+		  
+		  //name and owner
+		  this.CacheName = newCh.CacheName;
+		  this.CacheOwner = newCh.CacheOwner;
+
+		  //classification
+		  this.hard = newCh.hard;
+		  this.terrain = newCh.terrain;
+		  this.type = newCh.type;
+		  
+		  //travelbugs: overriding is OK, since GPX-File contains all actual travelbugs
+		  this.has_bug = newCh.has_bug;
+		  this.Bugs = newCh.Bugs;
+		  
+		  // URL
+		  this.URL = newCh.URL;
+		  
+		  //coords
+		  this.LatLon = newCh.LatLon;
+		  this.pos.set(newCh.pos);
+
+		  // check only length of the description to see, if there was an update
+		  if (this.LongDescription.length() != newCh.LongDescription.length()){
+			  this.is_update = true;
+		  }
+		  // same for hints
+		  if (this.Hints.length() != newCh.Hints.length()){
+			  this.is_update = true;
+		  }
+		  
+		  // description & hints
+		  this.is_HTML = newCh.is_HTML;
+		  this.LongDescription = newCh.LongDescription;
+		  this.Hints = newCh.Hints;
+
+		  //Logs
+		  //<img src='icon_smile.gif'>&nbsp;2005-10-30 by Schatzpirat</strong><br>
+		  //get Date of latest log in old cachedata
+		  Extractor extOldDate;
+		  String oldLogDate = EMPTY;
+		  if(this.CacheLogs.size()>0){
+			extOldDate = new Extractor((String) this.CacheLogs.get(0), ";"," by", 0, true);
+			oldLogDate= new String(extOldDate.findNext());
+		  }
+		  // now loop through new cachedata and compare logentries, 
+		  // starting with oldest log
+		  
+		  //Vm.debug("made it to here!");
+		  int currLog = newCh.CacheLogs.size()-1;
+		  String newLogDate = EMPTY;
+		  while (currLog >= 0 ){
+			  Extractor extNewDate = new Extractor((String) newCh.CacheLogs.get(currLog), ";"," by", 0, true);
+			  newLogDate = extNewDate.findNext();
+			  if (newLogDate.compareTo(oldLogDate)> 0){
+		  		  // oldest log from new cachedata is younger than stored data
+		  		  // put the new logs in front of old logs
+				  //Vm.debug(newCh.wayPoint + " New: " + newLogDate + " Old: " + oldLogDate + " cmp: " + newLogDate.compareTo(oldLogDate));
+				  while (currLog >= 0) this.CacheLogs.add(0, newCh.CacheLogs.get(currLog--));
+				  this.is_log_update = true;
+			  }
+			  else currLog--;
+		  }//while
+	   	 //Check for number sukzessive DNF logs
+		 int z = 0;
+		 String loganal = EMPTY;
+		 //Vm.debug("Checking size: ");
+		 //int sz = newCh.CacheLogs.size();
+		 //Vm.debug("log size: " + sz);
+	 	 while(z < newCh.CacheLogs.size() && z < 5){
+			loganal = (String)newCh.CacheLogs.get(z);
+			if(loganal.indexOf("icon_sad")>0) {
+				z++;
+			}else break;
+		 }
+		 noFindLogs = z;
+	 	return this;
+	  }
+	  
+	  /**
+	   * Adds a user image to the cache data
+	   * @param profile
+	   */
+		public void addUserImage(Profile profile){
+		  File imgFile;
+		  String imgDesc, imgDestName;
+		  
+		  //Get Image and description
+			FileChooser fc = new FileChooser(FileChooser.OPEN, profile.dataDir);
+			fc.setTitle("Select image file:");
+			if(fc.execute() != FileChooser.IDCANCEL){
+				imgFile = fc.getChosenFile();
+				imgDesc = new InputBox("Description").input("",10);
+				//Create Destination Filename
+				String ext = imgFile.getFileExt().substring(imgFile.getFileExt().lastIndexOf("."));
+				imgDestName = this.wayPoint + "_U_" + (this.UserImages.size()+1) + ext;
+				
+				this.UserImages.add(imgDestName);
+				this.UserImagesText.add(imgDesc);
+				// Copy File
+				DataMover.copy(imgFile.getFullPath(),profile.dataDir + imgDestName);
+				// Save Data
+				saveCacheDetails(profile.dataDir);
+			}
+	  }
+	  /**
+	   * Adds a new log to the cachedata 
+	   * @param logEntry
+	   */
+	  public void addLog(String logEntry){
+		  //Logs
+		  //<img src='icon_smile.gif'>&nbsp;2005-10-30 by Schatzpirat</strong><br>
+		  //get Date of latest log in old cachedata
+		  Extractor extOldDate;
+		  String oldLogDate = new String();
+		  if(this.CacheLogs.size()>0){
+			extOldDate = new Extractor((String) this.CacheLogs.get(0), ";"," by", 0, true);
+			oldLogDate= new String(extOldDate.findNext());
+		  }
+
+		  String newLogDate;
+		  Extractor extNewDate = new Extractor(logEntry, ";"," by", 0, true);
+		  newLogDate = extNewDate.findNext();
+		  if (newLogDate.compareTo(oldLogDate)> 0){
+	  		  // oldest log from new cachedata is younger than stored data
+	  		  // put the new logs in front of old logs
+			  //Vm.debug(newCh.wayPoint + " New: " + newLogDate + " Old: " + oldLogDate + " cmp: " + newLogDate.compareTo(oldLogDate));
+			  this.CacheLogs.add(0, logEntry);
+			  this.is_log_update = true;
+			  if (logEntry.indexOf("icon_sad")> 0) this.noFindLogs++;
+			  return;
+		  }
+		  if (newLogDate.compareTo(oldLogDate)== 0){
+			  // logdate is equal, so check, if finder is equal
+			  String newLogFinder, oldLogFinder;
+			  Extractor extOldFinder = new Extractor((String) this.CacheLogs.get(0), "by ","<", 0, true);
+			  oldLogFinder = extOldFinder.findNext().toLowerCase();
+			  
+			  Extractor extNewFinder = new Extractor(logEntry, "by ","<", 0, true);
+			  newLogFinder = extNewFinder.findNext().toLowerCase();
+			  
+			  if (newLogFinder.compareTo(oldLogFinder)!= 0){
+				  this.CacheLogs.add(0, logEntry);
+				  this.is_log_update = true;
+				  if (logEntry.indexOf("icon_sad")> 0) this.noFindLogs++;
+			  }
+		  }
+	  }
+
+	  
+		/**
+		*	Method to parse a specific cache.xml file.
+		*	It fills information on cache details, hints, logs, notes and
+		*	images.
+		*/
+		public void readCache(String dir) throws IOException{
+			String dummy;
+			FileReader in = new FileReader(dir+wayPoint+".xml");
+			String text= in.readAll();
+			in.close();
+			Extractor ex = new Extractor(text, "<DETAILS><![CDATA[", "]]></DETAILS>", 0, true);		
+			LongDescription = ex.findNext();
+			ex = new Extractor(text, "<HINTS><![CDATA[", "]]></HINTS>", 0, true);
+			Hints = ex.findNext();
+			ex = new Extractor(text, "<LOGS>","</LOGS>", 0, true);
+			dummy = ex.findNext();
+			CacheLogs.clear();
+			ex = new Extractor(dummy, "<LOG><![CDATA[","]]></LOG>", 0, true);
+			
+			dummy = ex.findNext();
+			while(ex.endOfSearch()==false){
+				CacheLogs.add(dummy);
+				dummy = ex.findNext();
+			}
+			ex = new Extractor(text, "<NOTES><![CDATA[", "]]></NOTES>", 0, true);
+			CacheNotes = ex.findNext();
+			Images.clear();
+			ex = new Extractor(text, "<IMG>", "</IMG>", 0, true);
+			dummy = ex.findNext();
+			while(ex.endOfSearch() == false){
+				Images.add(dummy);
+				dummy = ex.findNext();
+			}
+			ImagesText.clear();
+			ex = new Extractor(text, "<IMGTEXT>", "</IMGTEXT>", 0, true);
+			dummy = ex.findNext();
+			while(ex.endOfSearch() == false){
+				ImagesText.add(dummy);
+				dummy = ex.findNext();
+			}
+			// Logimages
+			LogImages.clear();
+			ex = new Extractor(text, "<LOGIMG>", "</LOGIMG>", 0, true);
+			dummy = ex.findNext();
+			while(ex.endOfSearch() == false){
+				LogImages.add(dummy);
+				dummy = ex.findNext();
+			}
+			LogImagesText.clear();
+			ex = new Extractor(text, "<LOGIMGTEXT>", "</LOGIMGTEXT>", 0, true);
+			dummy = ex.findNext();
+			while(ex.endOfSearch() == false){
+				LogImagesText.add(dummy);
+				dummy = ex.findNext();
+			}
+
+			UserImages.clear();
+			ex = new Extractor(text, "<USERIMG>", "</USERIMG>", 0, true);
+			dummy = ex.findNext();
+			while(ex.endOfSearch() == false){
+				UserImages.add(dummy);
+				dummy = ex.findNext();
+			}
+			UserImagesText.clear();
+			ex = new Extractor(text, "<USERIMGTEXT>", "</USERIMGTEXT>", 0, true);
+			dummy = ex.findNext();
+			while(ex.endOfSearch() == false){
+				UserImagesText.add(dummy);
+				dummy = ex.findNext();
+			}
+
+
+			ex = new Extractor(text, "<BUGS><![CDATA[", "]]></BUGS>", 0, true);
+			Bugs = ex.findNext();
+			
+			ex = new Extractor(text, "<URL><![CDATA[", "]]></URL>", 0, true);
+			// if no URL is stored, set default URL (at this time only possible for gc.com)
+			dummy = ex.findNext();
+			if (dummy.length() > 10){
+				URL = dummy;
+			}
+			else {
+				if (wayPoint.startsWith("GC")) {
+					URL = "http://www.geocaching.com/seek/cache_details.aspx?wp="+ wayPoint + "&Submit6=Find&log=y";
+				}
+			}
+
+		}
+		
+		/**
+		*	Method to save a cache.xml file.
+		*/
+		public void saveCacheDetails(String dir){
+			PrintWriter detfile;
+			String dummy = new String();
+			//File exists?
+			boolean exists = (new File(dir + wayPoint + ".xml")).exists();
+			//yes: then delete
+			if (exists) {
+				boolean ok = (new File(dir + wayPoint + ".xml")).delete();
+				if(ok) ok = true;
+			}
+			boolean exists2 = (new File(dir + wayPoint.toLowerCase() + ".xml")).exists();
+			//yes: delete
+			if (exists2) {
+				boolean ok2 = (new File(dir + wayPoint.toLowerCase() + ".xml")).delete();
+				if(ok2) ok2=true;
+			}
+			//Vm.debug("Writing to: " +dir + "for: " + wayPoint);
+			try{
+			  detfile = new PrintWriter(new BufferedWriter(new FileWriter(dir + wayPoint + ".xml")));
+			} catch (Exception e) {
+				Global.getPref().log("Problem opening details file",e,true);
+				return;
+			}
+			try{
+				if(wayPoint.length()>0){
+				  detfile.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n");
+				  detfile.print("<CACHEDETAILS>\r\n");
+				  detfile.print("<DETAILS><![CDATA["+LongDescription+"]]></DETAILS>\r\n");
+				  detfile.print("<HINTS><![CDATA["+Hints+"]]></HINTS>\r\n");
+				  detfile.print("<LOGS>\r\n");
+				  for(int i = 0; i < CacheLogs.size(); i++){
+					  dummy = (String)CacheLogs.get(i);
+					  detfile.print("<LOG><![CDATA[\r\n");
+					  detfile.print(dummy);
+					  detfile.print("\r\n]]></LOG>\r\n");
+				  }
+				  detfile.print("</LOGS>\r\n");
+			
+				  detfile.print("<NOTES><![CDATA["+CacheNotes+"]]></NOTES>\n");
+				  detfile.print("<IMAGES>");
+				  String stbuf = new String();
+				  for(int i = 0;i<Images.size();i++){
+						stbuf = (String)Images.get(i);
+						detfile.print("    <IMG>"+stbuf+"</IMG>\n");
+				  }
+				  for(int i = 0;i<ImagesText.size();i++){
+						stbuf = (String)ImagesText.get(i);
+						detfile.print("    <IMGTEXT>"+stbuf+"</IMGTEXT>\n");
+				  }
+
+				  for(int i = 0;i<LogImages.size();i++){
+						stbuf = (String)LogImages.get(i);
+						detfile.print("    <LOGIMG>"+stbuf+"</LOGIMG>\n");
+				  }
+				  for(int i = 0;i<LogImagesText.size();i++){
+						stbuf = (String)LogImagesText.get(i);
+						detfile.print("    <LOGIMGTEXT>"+stbuf+"</LOGIMGTEXT>\n");
+				  }
+				  for(int i = 0;i<UserImages.size();i++){
+						stbuf = (String)UserImages.get(i);
+						detfile.print("    <USERIMG>"+stbuf+"</USERIMG>\n");
+				  }
+				  for(int i = 0;i<UserImagesText.size();i++){
+						stbuf = (String)UserImagesText.get(i);
+						detfile.print("    <USERIMGTEXT>"+stbuf+"</USERIMGTEXT>\n");
+				  }
+
+
+				  detfile.print("</IMAGES>\n");
+				  detfile.print("<BUGS><![CDATA[\n");
+				  detfile.print(Bugs+"\n");
+				  detfile.print("]]></BUGS>\n");
+				  detfile.print("<URL><![CDATA["+URL+"]]></URL>\r\n");
+				  detfile.print("</CACHEDETAILS>\n");
+				} // if length
+			} catch (Exception e){
+				Vm.debug("Problem writing to a details file");
+			}
+			try{
+			  detfile.close();
+			} catch (Exception e){
+			  //Vm.debug("Problem closing details file");
+			}
+		}
+		
+		/**
+		 * Method for checking if to caches belongs to each other, e.g.
+		 * an additional waypoint belongs to the main cache.
+		 * Works currently only, if the last 4 or 5 chars of the waypoint are
+		 * the same, this is the gc.com way. 
+		 * @param ch cache to check
+		 * @return true if there is a relation, false otherwise
+		 */
+		public boolean belongsTo (CacheHolder ch) {
+			
+			// avoid self referencing
+			if (this.wayPoint.equals(ch.wayPoint)) return false;
+
+			return this.wayPoint.endsWith(ch.wayPoint.substring(2));
+		}
+		
+
+//	   public void finalize() {
+//		   super.finalize();
+//		   Vm.debug("Destroying CacheHolder "+wayPoint);
+//	   }
+
+}

Modified: trunk/src/CacheWolf/DBStats.java
===================================================================
--- trunk/src/CacheWolf/DBStats.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/DBStats.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -21,7 +21,7 @@
 	 * @return
 	 */
 	public int visible(){
-		CacheHolder holder = new CacheHolder();
+		CacheHolder holder;
 		int counter = 0;
 		for(int i = 0; i<cacheDB.size();i++){
 			holder = (CacheHolder)cacheDB.get(i);
@@ -37,7 +37,7 @@
 	 * @return
 	 */
 	public int total(){
-		CacheHolder holder = new CacheHolder();
+		CacheHolder holder;
 		int counter = 0;
 		for(int i = 0; i<cacheDB.size();i++){
 			holder = (CacheHolder)cacheDB.get(i);
@@ -49,7 +49,7 @@
 	}
 	
 	public int totalFound(){
-		CacheHolder holder = new CacheHolder();
+		CacheHolder holder;
 		int counter = 0;
 		for(int i = 0; i<cacheDB.size();i++){
 			holder = (CacheHolder)cacheDB.get(i);

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -10,7 +10,7 @@
 public class DescriptionPanel extends CellPanel{
 	HtmlDisplay disp = new HtmlDisplay();
 	mButton btnPlus, btnMinus;
-	CacheHolder currCache;
+	CacheHolderDetail currCache;
 	
 	CellPanel buttonP = new CellPanel();
 	CellPanel descP = new CellPanel();
@@ -28,7 +28,7 @@
 	/**
 	*	Set the text to display. Text should be HTML formated.
 	*/
-	public void setText(CacheHolder cache){
+	public void setText(CacheHolderDetail cache){
 		if (currCache != cache){
 			Vm.showWait(true);
 			if (cache.is_HTML)	disp.setHtml(cache.LongDescription);

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -25,7 +25,7 @@
 	mButton btnNewWpt, btnShowBug, btnShowMap, btnGoto, btnAddPicture, btnBlack, btnNotes, btnSave, btnCancel;
 	mButton btnFoundDate,btnHiddenDate;
 	Vector cacheDB;
-	CacheHolder thisCache;
+	CacheHolderDetail thisCache;
 	CellPanel pnlTools = new CellPanel(); 
 	
 	private boolean dirty_notes = false;
@@ -129,7 +129,7 @@
 	/**
 	*	Set the values to display.
 	*/
-	public void setDetails(CacheHolder ch){
+	public void setDetails(CacheHolderDetail ch){
 		thisCache = ch;
 		dirty_notes = false;
 		dirty_details = false;
@@ -363,36 +363,52 @@
 	}
 	
 	public void saveDirtyWaypoint() {
-		CacheHolder ch;
-		  ch = (CacheHolder)cacheDB.get(Global.mainTab.tbP.getSelectedCache());
+		// We have to update two objects: thisCache (a CacheHolderDetail) which contains 
+		// the full cache which will be written to the cache.xml file AND
+		// the CacheHolder object which sits in cacheDB
 		  // Strip the found message if the status contains a date
-		  if (chcStatus.getText().startsWith(MyLocale.getMsg(318,"Found")) && 
+		if (chcStatus.getText().startsWith(MyLocale.getMsg(318,"Found")) && 
 				  chcStatus.getText().length()==MyLocale.getMsg(318,"Found").length()+11)
-			  ch.CacheStatus = chcStatus.getText().substring(MyLocale.getMsg(318,"Found").length()+1);
+			  thisCache.CacheStatus = chcStatus.getText().substring(MyLocale.getMsg(318,"Found").length()+1);
 		  else	  
-			  ch.CacheStatus = chcStatus.getText();
-		  ch.is_found = chcStatus.getText().startsWith(MyLocale.getMsg(318,"Found"));
-		  ch.is_owned = ch.CacheStatus.equals(MyLocale.getMsg(320,"Owner"));
+			  thisCache.CacheStatus = chcStatus.getText();
+		  thisCache.is_found = chcStatus.getText().startsWith(MyLocale.getMsg(318,"Found"));
+		  thisCache.CacheOwner = inpOwner.getText().trim();
+		  thisCache.is_owned = thisCache.CacheStatus.equals(MyLocale.getMsg(320,"Owner"));
 		  // Avoid setting is_owned if alias is empty and username is empty
-		  if(ch.is_owned == false){
-			  ch.is_owned = (!pref.myAlias.equals("") && pref.myAlias.equals(ch.CacheOwner)) || 
-					        (!pref.myAlias2.equals("") && pref.myAlias2.equals(ch.CacheOwner));
+		  if(thisCache.is_owned == false){
+			  thisCache.is_owned = (!pref.myAlias.equals("") && pref.myAlias.equals(thisCache.CacheOwner)) || 
+					        (!pref.myAlias2.equals("") && pref.myAlias2.equals(thisCache.CacheOwner));
 		  }
-		  ch.is_black = blackStatus;
-		  ch.wayPoint = inpWaypoint.getText().trim();
-		  ch.CacheSize = chcSize.getText();
+		  thisCache.is_black = blackStatus;
+		  thisCache.wayPoint = inpWaypoint.getText().trim();
+		  thisCache.CacheSize = chcSize.getText();
 		  // If the waypoint does not have a name, give it one
-		  if (ch.wayPoint.equals("")) { 
-			  ch.wayPoint=profile.getNewWayPointName();
+		  if (thisCache.wayPoint.equals("")) { 
+			  thisCache.wayPoint=profile.getNewWayPointName();
 		  }
 		  //Don't allow single letter names=> Problems in updateBearingDistance
 		  // This is a hack but faster than slowing down the loop in updateBearingDistance
-		  if (ch.wayPoint.length()<2) ch.wayPoint+=" ";
-		  ch.CacheName = inpName.getText().trim();
-		  ch.LatLon = ch.pos.toString();
-		  ch.DateHidden = inpHidden.getText().trim();
-		  ch.CacheOwner = inpOwner.getText().trim();
-		  ch.type = transSelect(chcType.getInt());
+		  if (thisCache.wayPoint.length()<2) thisCache.wayPoint+=" ";
+		  thisCache.CacheName = inpName.getText().trim();
+		  thisCache.LatLon = thisCache.pos.toString();
+		  thisCache.DateHidden = inpHidden.getText().trim();
+		  thisCache.type = transSelect(chcType.getInt());
+		  thisCache.saveCacheDetails(profile.dataDir);
+		  // Now update the table
+		  CacheHolder ch = (CacheHolder)cacheDB.get(Global.mainTab.tbP.getSelectedCache());
+		  ch.CacheStatus=thisCache.CacheStatus;
+		  ch.is_found=thisCache.is_found;
+		  ch.is_owned=thisCache.is_owned;
+		  ch.is_black=thisCache.is_black;
+		  ch.wayPoint=thisCache.wayPoint;
+		  ch.CacheSize=thisCache.CacheSize;
+		  ch.wayPoint=thisCache.wayPoint;
+		  ch.CacheName=thisCache.CacheName;
+		  ch.LatLon=thisCache.LatLon;
+		  ch.DateHidden=thisCache.DateHidden;
+		  ch.CacheOwner=thisCache.CacheOwner;
+		  ch.type=thisCache.type;
 		  if (CacheType.isAddiWpt(ch.type)) {
 			  int idx;
 			  if (ch.wayPoint.length()<5)
@@ -406,7 +422,6 @@
 		  }
 		  // set status also on addi wpts
 		  ch.setAttributesToAddiWpts();
-		  ch.saveCacheDetails(profile.dataDir);
 		  dirty_notes=false;
 		  dirty_details=false;
 		  

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -20,7 +20,7 @@
 	static Preferences pref;
 	Profile profile;
 	Vector cacheDB;
-	CacheHolder holder;
+	CacheHolderDetail holder;
 	String strData, saveDir, logData, logIcon, logDate, logFinder;
 	boolean inWpt, inCache, inLogs, inBug;
 	public XMLElement document;
@@ -158,7 +158,7 @@
 			zaehlerGel = 0;
 		}
 		if (name.equals("wpt")) {
-			holder = new CacheHolder();
+			holder = new CacheHolderDetail();
 			holder.LatLon = latdeg2min(atts.getValue("lat")) + " " +londeg2min(atts.getValue("lon"));
 			holder.pos.set(Common.parseDouble(atts.getValue("lat")),Common.parseDouble(atts.getValue("lon")));
 			inWpt = true;
@@ -273,7 +273,7 @@
 				zaehlerGel++;
 				if (zaehlerGel % 5==1) infB.setInfo( (MyLocale.getMsg(4000,"Loaded caches") + ":" + zaehlerGel));
 				holder.is_new = true;
-				cacheDB.add(holder);
+				cacheDB.add(new CacheHolder(holder));
 				//Vm.debug("here B");
 				//if(doSpider == true && fromOC == false){
 				// don't spider additional waypoints, so check
@@ -294,9 +294,9 @@
 						//spiderImages();
 						spiderImagesUsingSpider();
 						//Rename image sources
-						String text = new String();
-						String orig = new String();
-						String imgName = new String();
+						String text;
+						String orig;
+						String imgName;
 						orig = holder.LongDescription;
 						Extractor ex = new Extractor(orig, "<img src=\"", ">", 0, false);
 						text = ex.findNext();
@@ -318,7 +318,7 @@
 			//Update cache data
 			else {
 				//Vm.debug("it is not new!");
-				CacheHolder oldCh= (CacheHolder) cacheDB.get(index);
+				CacheHolderDetail oldCh= new CacheHolderDetail((CacheHolder) cacheDB.get(index));
 				try {
 					//Vm.debug("Try to load");
 					oldCh.readCache(saveDir);
@@ -554,8 +554,8 @@
 		} else return -1;
 	}
 	private void spiderImagesUsingSpider(){
-		String addr = new String();
-		String cacheText = new String();
+		String addr;
+		String cacheText;
 		
 		// just to be sure to have a spider object
 		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile, false);

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/HintLogPanel.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -23,7 +23,7 @@
  */
 public class HintLogPanel extends CellPanel{
 	int crntLogPosition = 0;
-	CacheHolder cache;
+	CacheHolderDetail cache;
 	private final int DEFAULT_STRINGBUFFER_SIZE=8000;
 	mTextPad hint = new mTextPad();
 	//mTextPad logs = new mTextPad();
@@ -58,7 +58,7 @@
 		this.addLast(split);
 	}
 
-	public void setText(CacheHolder cache){
+	public void setText(CacheHolderDetail cache){
 		this.cache = cache;
 		if(!cache.Hints.equals("null")) 
 			hint.setText(cache.Hints);

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/ImagePanel.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -41,7 +41,7 @@
 	* Gets called immediatly before panel is displayed
 	* @see MainTab#onEvent(Event ev)
 	*/
-	public void setImages(CacheHolder cache){
+	public void setImages(CacheHolderDetail cache){
 		pref = Global.getPref();
 		profile=Global.getProfile();
 		Vm.showWait(true);

Modified: trunk/src/CacheWolf/LOCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/LOCXMLImporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/LOCXMLImporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -42,7 +42,7 @@
 	Preferences pref;
 	Profile profile;
 	String file;
-	CacheHolder holder;
+	CacheHolderDetail holder;
 
 	Hashtable DBindexWpt = new Hashtable();
 	String strData = new String();
@@ -108,15 +108,15 @@
 			index = searchWpt(holder.wayPoint);
 			if (index == -1){
 				holder.is_new = true;
-				cacheDB.add(holder);
+				cacheDB.add(new CacheHolder(holder));
 				DBindexWpt.put((String)holder.wayPoint, new Integer(cacheDB.size()-1));
 			}
 			// update (overwrite) data
 			else {
 				holder.is_new = false;
-				cacheDB.set(index, holder);
+				cacheDB.set(index, new CacheHolder(holder));
 			}
-			// save all
+			// save all  (after each cache???)
 			holder.saveCacheDetails(profile.dataDir);
 			profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 			return;
@@ -150,17 +150,17 @@
 		} else return -1;
 	}
 
-	private CacheHolder getHolder(String wpt){
+	private CacheHolderDetail getHolder(String wpt){// See also OCXMLImporter
 		int index;
-		CacheHolder ch;
+		CacheHolderDetail ch;
 		
 		index = searchWpt(wpt);
 		if (index == -1){
-			ch = new CacheHolder();
+			ch = new CacheHolderDetail();
 			ch.wayPoint = wpt;
 			return ch;
 		}
-		ch = (CacheHolder) cacheDB.get(index);
+		ch = new CacheHolderDetail((CacheHolder) cacheDB.get(index));
 		try {
 			ch.readCache(profile.dataDir);
 		} catch (Exception e) {Vm.debug("Could not open file: " + e.toString());};

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/MainTab.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -26,7 +26,8 @@
 	ImagePanel imageP;
 	SolverPanel solverP;
 	String lastselected = new String();
-	CacheHolder ch =null;
+	CacheHolder ch=null;
+	CacheHolderDetail chD =null;
 	MainMenu mnuMain;
 	StatusBar statBar;
 	MovingMap mm;
@@ -79,14 +80,14 @@
 		return tbP;
 	}
 
-	public void selectAndActive(int rownum){
+	public void selectAndActive(int rownum){// Called from myInteractivePanel.imageClicked
 		tbP.selectRow(rownum);
 		this.selectAndExpand(0);
 	}
 
 	/** Update the distances of all caches to the center and display a message 
 	 */
-	public void updateBearDist(){
+	public void updateBearDist(){// Called from DetailsPanel, GotoPanel and myTableControl
 		tbP.pref = pref;
 		profile.updateBearingDistance();
 		tbP.refreshTable();
@@ -104,7 +105,7 @@
 		//tbP.tc.scrollToVisible(row, 0);
 		//tbP.selectRow(row);
 		select(descP);
-		descP.setText(chi);
+		//descP.setText(chi);
 	}
 
 
@@ -137,24 +138,25 @@
 
 	public void onEvent(Event ev)
 	{
-		////Vm.debug(ev.toString());
+		//Vm.debug(ev.toString()+"/"+this.getSelectedItem());
 		if(ev instanceof MultiPanelEvent){
 			mnuMain.allowProfileChange(false);	  
-			if(this.getSelectedItem() == 0){
+			if(this.getSelectedItem() == 0){// List view selected
 				mnuMain.allowProfileChange(true);	  
 //				Vm.setParameter(Vm.SET_ALWAYS_SHOW_SIP_BUTTON,0);
 //				Vm.setSIP(0);
 				MyLocale.setSIPOff();
 			}
 			updatePendingChanges();
-			if(this.getSelectedItem() != 0){
-				if (tbP.getSelectedCache()>=cacheDB.size() || tbP.getSelectedCache()<0)
-					ch=null;
-				else {
+			if(this.getSelectedItem() != 0){// any panel other than list view
+				if (tbP.getSelectedCache()>=cacheDB.size() || tbP.getSelectedCache()<0) {
+					ch=null; chD=null;
+				} else {
 					ch = (CacheHolder)cacheDB.get(tbP.getSelectedCache());
 					try {
 						if(ch.wayPoint.equals(lastselected) == false){
-							ch.readCache(profile.dataDir);
+							chD=new CacheHolderDetail(ch);
+							chD.readCache(profile.dataDir);
 							lastselected = ch.wayPoint;
 						}
 					} catch(Exception e){
@@ -162,36 +164,37 @@
 					}
 				}
 			} else statBar.updateDisplay();
-
 			// If no cache is selected, create a new one
 			switch (this.getSelectedItem()) {
 			case 1:  // DetailsPanel
-				if (ch==null) newWaypoint(ch=new CacheHolder());
+				if (chD==null) { // Empty DB - show a dummy detail
+					newWaypoint(chD=new CacheHolderDetail()); 
+				}
 				MyLocale.setSIPButton();
-				detP.setDetails(ch);
+				detP.setDetails(chD);
 				break;
 			case 2: // Description Panel
-				if (ch!=null) {
+				if (chD!=null) {
 					MyLocale.setSIPOff();
-					descP.setText(ch);
+					descP.setText(chD);
 				}
 				break;
 			case 3: // Picture Panel
-				if (ch!=null) {
+				if (chD!=null) {
 					MyLocale.setSIPOff();
-					imageP.setImages(ch);
+					imageP.setImages(chD);
 				}
 				break;
 			case 4:  // Log Hint Panel
-				if (ch!=null) {
+				if (chD!=null) {
 					MyLocale.setSIPOff();
-					hintLP.setText(ch);
+					hintLP.setText(chD);
 				}
 				break;
 			case 5:  // CalcPanel
-				if (ch!=null) {
+				if (chD!=null) {
 					MyLocale.setSIPButton();
-					calcP.setFields(ch);
+					calcP.setFields(chD);
 				}
 				break;
 
@@ -200,11 +203,11 @@
 				break;
 			case 7:  // Solver Panel
 				MyLocale.setSIPButton();
-				solverP.setCh(ch);
+				solverP.setCh(chD);
 				break;
 			case 8:  // Cache Radar Panel
 				MyLocale.setSIPOff();
-				radarP.setParam(pref, cacheDB, ch==null?"":ch.wayPoint);
+				radarP.setParam(pref, cacheDB, chD==null?"":chD.wayPoint);
 				radarP.drawThePanel();
 				break;
 			}

Modified: trunk/src/CacheWolf/NotesScreen.java
===================================================================
--- trunk/src/CacheWolf/NotesScreen.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/NotesScreen.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -13,12 +13,12 @@
 */
 public class NotesScreen extends Form{
 	mTextPad wayNotes = new mTextPad();
-	CacheHolder thisCache = null;
+	CacheHolderDetail thisCache = null;
 	mButton addDateTime = new mButton((IImage)new mImage("date_time.png"));
 	mButton btSave = new mButton(MyLocale.getMsg(127,"Save"));
 	ScrollBarPanel sbp = new ScrollBarPanel(wayNotes);
 	
-	public NotesScreen(CacheHolder ch){
+	public NotesScreen(CacheHolderDetail ch){
 		this.title = "Notes";
 		setPreferredSize(Global.getPref().myAppWidth, Global.getPref().myAppHeight);
 		thisCache = ch;

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -32,7 +32,7 @@
 	boolean debugGPX = false;
 	Vector cacheDB;
 	InfoBox inf;
-	CacheHolder holder;
+	CacheHolderDetail holder;
 	Preferences pref;
 	Profile profile;
 	Time dateOfthisSync;
@@ -672,17 +672,17 @@
 	}
 
 
-	private CacheHolder getHolder(String CacheID){ // TODO move this into profile.java
+	private CacheHolderDetail getHolder(String wpt){// See also LOCXMLImporter
 		int index;
-		CacheHolder ch;
-
-		index = searchID(CacheID);
+		CacheHolderDetail ch;
+		
+		index = searchWpt(wpt);
 		if (index == -1){
-			ch = new CacheHolder();
-			ch.ocCacheID = CacheID;
+			ch = new CacheHolderDetail();
+			ch.wayPoint = wpt;
 			return ch;
 		}
-		ch = (CacheHolder) cacheDB.get(index);
+		ch = new CacheHolderDetail((CacheHolder) cacheDB.get(index));
 		try {
 			ch.readCache(profile.dataDir);
 		} catch (Exception e) {Vm.debug("Could not open file: " + e.toString());};

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/Profile.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -238,7 +238,7 @@
 				}
 				ch = (CacheHolder)cacheDB.get(i);
 				////Vm.debug("Saving: " + ch.CacheName);
-				if(ch.wayPoint.length()>0 && ch.LongDescription.equals("An Error Has Occured") == false){
+				if(ch.wayPoint.length()>0) { //TODO && ch.LongDescription.equals("An Error Has Occured") == false){
 					detfile.print("    <CACHE name = \""+SafeXML.clean(ch.CacheName)+"\" owner = \""+SafeXML.clean(ch.CacheOwner)+
 							//"\" lat = \""+ SafeXML.clean(ch.LatLon) +
 							"\" lat = \""+ ch.pos.latDec + "\" lon = \""+ch.pos.lonDec+

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -130,118 +130,119 @@
 		CacheHolder ch = (CacheHolder)cacheDB.get(number);
 		if (ch.isAddiWpt()) return false;  // No point spidering an addi waypoint, comes with parent
 		//Vm.showWait(true); Already done in myTableControl
+		CacheHolderDetail chD=new CacheHolderDetail(ch);
 		String notes = "";
 		String start = "";
 		String origLong = "";
 		try{
-			ch.readCache(profile.dataDir);
+			chD.readCache(profile.dataDir);
 		}catch(IOException ioex){
-			pref.log("Could not load " + ch.wayPoint + "file in spiderSingle");
+			pref.log("Could not load " + chD.wayPoint + "file in spiderSingle");
 		}
-		notes = ch.CacheNotes;
+		//notes = chD.CacheNotes;
 		
 		
-		String doc = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + ch.wayPoint +"&log=y";
+		String doc = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + chD.wayPoint +"&log=y";
 		try{
-			pref.log("Fetching: " + ch.wayPoint);
+			pref.log("Fetching: " + chD.wayPoint);
 			start = fetch(doc);
 		}catch(Exception ex){
-			pref.log("Could not fetch " + ch.wayPoint);
-			ch.is_incomplete = true;
-			cacheDB.set(number, ch);
+			pref.log("Could not fetch " + chD.wayPoint);
+			chD.is_incomplete = true;
+			//Redundant: cacheDB.set(number, ch);
 			//Vm.debug("Couldn't get cache detail page");
 		}
 		if (!infB.isClosed) { // Only analyse the cache data if user has not closed the progress window
 			try{
-				ch.is_new = false;
-				ch.is_update = false;
-				ch.is_HTML = true;
-				ch.is_available = true;
-				ch.is_archived = false;
-				ch.is_incomplete = false;
-				ch.CacheLogs.clear();
-				ch.addiWpts.clear();
-				ch.Images.clear();
-				ch.ImagesText.clear();
-				//Vm.debug(ch.wayPoint);
+				chD.is_new = false;
+				chD.is_update = false;
+				chD.is_HTML = true;
+				chD.is_available = true;
+				chD.is_archived = false;
+				chD.is_incomplete = false;
+				chD.CacheLogs.clear();
+				chD.addiWpts.clear();
+				chD.Images.clear();
+				chD.ImagesText.clear();
+				//Vm.debug(chD.wayPoint);
 				
-				if(start.indexOf("This cache is temporarily unavailable") >= 0) ch.is_available = false;
-				if(start.indexOf("This cache has been archived") >= 0) ch.is_archived = true;
+				if(start.indexOf("This cache is temporarily unavailable") >= 0) chD.is_available = false;
+				if(start.indexOf("This cache has been archived") >= 0) chD.is_archived = true;
 				pref.log("Trying logs");
-				int logsz = ch.CacheLogs.size();
-				ch.CacheLogs = getLogs(start, ch);
+				int logsz = chD.CacheLogs.size();
+				chD.CacheLogs = getLogs(start, chD);
 				int z = 0;
 				String loganal = "";
-				while(z < ch.CacheLogs.size() && z < 5){
-					loganal = (String)ch.CacheLogs.get(z);
+				while(z < chD.CacheLogs.size() && z < 5){
+					loganal = (String)chD.CacheLogs.get(z);
 					if(loganal.indexOf("icon_sad")>0) {
 						z++;
 					}else break;
 				}
-				ch.noFindLogs = z;
-				ch.is_log_update = false;
-				if(ch.CacheLogs.size()>logsz) ch.is_log_update = true;
+				chD.noFindLogs = z;
+				chD.is_log_update = false;
+				if(chD.CacheLogs.size()>logsz) chD.is_log_update = true;
 				pref.log("Found logs");
-				ch.LatLon = getLatLon(start);
-				ch.pos.set(ch.LatLon);
-				//Vm.debug("LatLon: " + ch.LatLon);
+				chD.LatLon = getLatLon(start);
+				chD.pos.set(chD.LatLon);
+				//Vm.debug("LatLon: " + chD.LatLon);
 				pref.log("Trying description");
-				origLong = ch.LongDescription;
-				ch.LongDescription = getLongDesc(start);
-				if(!ch.LongDescription.equals(origLong)) ch.is_update = true;
+				origLong = chD.LongDescription;
+				chD.LongDescription = getLongDesc(start);
+				if(!chD.LongDescription.equals(origLong)) chD.is_update = true;
 				pref.log("Got description");
 				pref.log("Getting cache name");
-				ch.CacheName = SafeXML.cleanback(getName(start));
+				chD.CacheName = SafeXML.cleanback(getName(start));
 				pref.log("Got cache name");
-				//Vm.debug("Name: " + ch.CacheName);
+				//Vm.debug("Name: " + chD.CacheName);
 				pref.log("Trying owner");
-				ch.CacheOwner = SafeXML.cleanback(getOwner(start)).trim();
-				if(ch.CacheOwner.equals(pref.myAlias) || (pref.myAlias2.length()>0 && ch.CacheOwner.equals(pref.myAlias2))) ch.is_owned = true;
+				chD.CacheOwner = SafeXML.cleanback(getOwner(start)).trim();
+				if(chD.CacheOwner.equals(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equals(pref.myAlias2))) chD.is_owned = true;
 				pref.log("Got owner");
-				//Vm.debug("Owner: " + ch.CacheOwner);
+				//Vm.debug("Owner: " + chD.CacheOwner);
 				pref.log("Trying date hidden");
-				ch.DateHidden = DateFormat.MDY2YMD(getDateHidden(start));
+				chD.DateHidden = DateFormat.MDY2YMD(getDateHidden(start));
 				pref.log("Got date hidden");
-				//Vm.debug("Hidden: " + ch.DateHidden);
+				//Vm.debug("Hidden: " + chD.DateHidden);
 				pref.log("Trying hints");
-				ch.Hints = getHints(start);
+				chD.Hints = getHints(start);
 				pref.log("Got hints");
-				//Vm.debug("Hints: " + ch.Hints);
+				//Vm.debug("Hints: " + chD.Hints);
 				//Vm.debug("Got the hints");
 				pref.log("Trying size");
-				ch.CacheSize = getSize(start);
+				chD.CacheSize = getSize(start);
 				pref.log("Got size");
-				//Vm.debug("Size: " + ch.CacheSize);
+				//Vm.debug("Size: " + chD.CacheSize);
 				pref.log("Trying difficulty");
-				ch.hard = getDiff(start);
+				chD.hard = getDiff(start);
 				pref.log("Got difficulty");
-				//Vm.debug("Hard: " + ch.hard);
+				//Vm.debug("Hard: " + chD.hard);
 				pref.log("Trying terrain");
-				ch.terrain = getTerr(start);
+				chD.terrain = getTerr(start);
 				pref.log("Got terrain");
-				if (!infB.isClosed) ch.Bugs = getBugs(start);
-				if(ch.Bugs.length()>0) ch.has_bug = true; else ch.has_bug = false;
-				//Vm.debug("Terr: " + ch.terrain);
+				if (!infB.isClosed) chD.Bugs = getBugs(start);
+				chD.has_bug = chD.Bugs.length()>0;
+				//Vm.debug("Terr: " + chD.terrain);
 				pref.log("Trying cache type");
-				ch.type = getType(start);
+				chD.type = getType(start);
 				pref.log("Got cache type");
-				//Vm.debug("Type: " + ch.type);
+				//Vm.debug("Type: " + chD.type);
 				pref.log("Trying images");
-				getImages(start, ch);
+				getImages(start, chD);
 				pref.log("Got images");
 				//pref.log("Trying maps");
 				//getMaps(ch);
 				//pref.log("Got maps");
 				pref.log("Getting additional waypoints");
 				
-				getAddWaypoints(start, ch.wayPoint, ch.is_found);
+				getAddWaypoints(start, chD.wayPoint, chD.is_found);
 		
 				pref.log("Got additional waypoints");
-				ch.CacheNotes = notes;
+				//chD.CacheNotes = notes;
 				if (!infB.isClosed) {
-					ch.saveCacheDetails(profile.dataDir);
+					chD.saveCacheDetails(profile.dataDir);
 					pref.log("Saving to:" + profile.dataDir);
-					cacheDB.set(number, ch);
+					cacheDB.set(number, new CacheHolder(ch)); // TODO Could copy into existing object
 				}
 			}catch(Exception ex){
 				pref.log("Exception in spider: " +ex.toString());
@@ -263,7 +264,7 @@
 		String ln=null;
 		String wpt = "";
 		String loganal;
-		CacheHolder ch;
+		CacheHolderDetail chD;
 		CWPoint origin = pref.curCentrePt; // No need to copy curCentrePt as it is only read and not written
 		if (!origin.isValid()) {
 			(new MessageBox("Error", "Coordinates for center must be set", MessageBox.OKB)).execute();
@@ -379,7 +380,7 @@
 		
 		// Now ready to spider each cache
 		
-		ch = new CacheHolder();
+		chD = new CacheHolderDetail();
 		for(int i = 0; i<cachesToLoad.size(); i++){
 			if (infB.isClosed) break;
 			
@@ -401,100 +402,100 @@
 				}
 				if(start != null && start.length()!=0){
 					pref.log("Fetch doc ok... going into details.");
-					ch.is_new = true;
-					ch.is_HTML = true;
-					ch.is_available = true;
-					ch.is_archived = false;
-					ch.wayPoint = wpt;
-					if(start.indexOf("This cache is temporarily unavailable") >= 0) ch.is_available = false;
-					if(start.indexOf("This cache has been archived") >= 0) ch.is_archived = true;
-					//Vm.debug(ch.wayPoint);
+					chD.is_new = true;
+					chD.is_HTML = true;
+					chD.is_available = true;
+					chD.is_archived = false;
+					chD.wayPoint = wpt;
+					if(start.indexOf("This cache is temporarily unavailable") >= 0) chD.is_available = false;
+					if(start.indexOf("This cache has been archived") >= 0) chD.is_archived = true;
+					//Vm.debug(chD.wayPoint);
 					try{
 						pref.log("Trying logs");
-						ch.CacheLogs = getLogs(start, ch);
+						chD.CacheLogs = getLogs(start, chD);
 						int z = 0;
 						loganal = "";
-						while(z < ch.CacheLogs.size() && z < 5){
-							loganal = (String)ch.CacheLogs.get(z);
+						while(z < chD.CacheLogs.size() && z < 5){
+							loganal = (String)chD.CacheLogs.get(z);
 							if(loganal.indexOf("icon_sad")>0) {
 								z++;
 							}else break;
 						}
-						ch.noFindLogs = z;
+						chD.noFindLogs = z;
 						pref.log("Found logs");
-						ch.LatLon = getLatLon(start);
-						ch.pos.set(ch.LatLon); // Slow parse no problem
-						//Vm.debug("LatLon: " + ch.LatLon);
+						chD.LatLon = getLatLon(start);
+						chD.pos.set(chD.LatLon); // Slow parse no problem
+						//Vm.debug("LatLon: " + chD.LatLon);
 						pref.log("Trying description");
-						ch.LongDescription = getLongDesc(start);
+						chD.LongDescription = getLongDesc(start);
 						
 						pref.log("Got description");
 						pref.log("Getting cache name");
-						ch.CacheName = SafeXML.cleanback(getName(start));
+						chD.CacheName = SafeXML.cleanback(getName(start));
 						pref.log("Got cache name");
-						//Vm.debug("Name: " + ch.CacheName);
+						//Vm.debug("Name: " + chD.CacheName);
 						pref.log("Trying owner");
-						ch.CacheOwner = SafeXML.cleanback(getOwner(start)).trim();
-						if(ch.CacheOwner.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && ch.CacheOwner.equalsIgnoreCase(pref.myAlias2))) ch.is_owned = true;
+						chD.CacheOwner = SafeXML.cleanback(getOwner(start)).trim();
+						if(chD.CacheOwner.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equalsIgnoreCase(pref.myAlias2))) chD.is_owned = true;
 						pref.log("Got owner");
-						//Vm.debug("Owner: " + ch.CacheOwner);
+						//Vm.debug("Owner: " + chD.CacheOwner);
 						pref.log("Trying date hidden");
-						ch.DateHidden = getDateHidden(start);
+						chD.DateHidden = getDateHidden(start);
 						pref.log("Got date hidden");
-						//Vm.debug("Hidden: " + ch.DateHidden);
+						//Vm.debug("Hidden: " + chD.DateHidden);
 						pref.log("Trying hints");
-						ch.Hints = getHints(start);
+						chD.Hints = getHints(start);
 						pref.log("Got hints");
-						//Vm.debug("Hints: " + ch.Hints);
+						//Vm.debug("Hints: " + chD.Hints);
 						//Vm.debug("Got the hints");
 						pref.log("Trying size");
-						ch.CacheSize = getSize(start);
+						chD.CacheSize = getSize(start);
 						pref.log("Got size");
-						//Vm.debug("Size: " + ch.CacheSize);
+						//Vm.debug("Size: " + chD.CacheSize);
 						pref.log("Trying difficulty");
-						ch.hard = getDiff(start);
+						chD.hard = getDiff(start);
 						pref.log("Got difficulty");
-						//Vm.debug("Hard: " + ch.hard);
+						//Vm.debug("Hard: " + chD.hard);
 						pref.log("Trying terrain");
-						ch.terrain = getTerr(start);
+						chD.terrain = getTerr(start);
 						pref.log("Got terrain");
-						//Vm.debug("Terr: " + ch.terrain);
+						//Vm.debug("Terr: " + chD.terrain);
 						pref.log("Trying cache type");
-						ch.type = getType(start);
+						chD.type = getType(start);
 						pref.log("Got cache type");
-						//Vm.debug("Type: " + ch.type);
+						//Vm.debug("Type: " + chD.type);
 						if(getImages){
 							pref.log("Trying images");
-							getImages(start, ch);
+							getImages(start, chD);
 							pref.log("Got images");
 						}
 						if (infB.isClosed) {
 							
 							break;
 						}
-						ch.Bugs = getBugs(start);
-						if(ch.Bugs.length()>0) ch.has_bug = true; else ch.has_bug = false;
+						chD.Bugs = getBugs(start);
+						if(chD.Bugs.length()>0) chD.has_bug = true; else chD.has_bug = false;
 						pref.log("Getting additional waypoints");
-						getAddWaypoints(start, ch.wayPoint, ch.is_found);
+						getAddWaypoints(start, chD.wayPoint, chD.is_found);
 						pref.log("Got additional waypoints");
 						
 						if(doNotgetFound) {
-							if(!ch.is_found) profile.writeIndexLine(ch);
-						} else profile.writeIndexLine(ch);
+							if(!chD.is_found) profile.writeIndexLine(chD);
+						} else profile.writeIndexLine(chD);
 						
-						ch.saveCacheDetails(profile.dataDir);
+						chD.saveCacheDetails(profile.dataDir);
 						
-						ch = new CacheHolder();
+						chD = new CacheHolderDetail();
 					}catch(Exception ex){
 						pref.log("There was an error in the last step:");
 						pref.log("Cache was: " + wpt);
 						pref.log("Error was: " + ex.toString());
-						ch.is_incomplete = true;
+						chD.is_incomplete = true;
 						if(doNotgetFound) {
-							if(!ch.is_found) profile.writeIndexLine(ch);
-						} else profile.writeIndexLine(ch);
+							if(!chD.is_found) profile.writeIndexLine(chD);
+						} else profile.writeIndexLine(chD);
 						
-						ch = new CacheHolder();
+						chD = new CacheHolderDetail();
 					}finally{
 						//just continue please!
 						pref.log("Continuing with next cache.");
@@ -563,7 +564,7 @@
 			rowBlock = exRowBlock.findNext();
 			rowBlock = exRowBlock.findNext();
 			while(exRowBlock.endOfSearch()==false){
-				CacheHolder cx = new CacheHolder();
+				CacheHolderDetail cx = new CacheHolderDetail();
 				
 				nameRex.search(rowBlock);
 				koordRex.search(rowBlock);
@@ -594,14 +595,15 @@
 					}
 				}else if (((CacheHolder) cacheDB.get(idx)).is_Checked && // Only re-spider existing addi waypoints that are ticked
 						!((CacheHolder) cacheDB.get(idx)).is_filtered) // and are visible (i.e.  not filtered)
-					((CacheHolder) cacheDB.get(idx)).update(cx);
+					cacheDB.set(idx,new CacheHolder(
+					    new CacheHolderDetail(((CacheHolder) cacheDB.get(idx))).update(cx)));
 				cx.saveCacheDetails(profile.dataDir);
 				rowBlock = exRowBlock.findNext();
 			}
 		}
 	}
 	
-	public void getImages(String doc, CacheHolder ch){
+	public void getImages(String doc, CacheHolderDetail ch){
 		int imgCounter = 0;
 		String imgName;
 		String imgType;
@@ -801,7 +803,7 @@
 		return Convert.toDouble(inRex.stringMatched(1));
 	}
 	
-	private Vector getLogs(String doc, CacheHolder ch){
+	private Vector getLogs(String doc, CacheHolderDetail ch){
 		String icon = "";
 		String name = "";
 		Vector reslts = new Vector();

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/CacheWolf/myTableControl.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -174,11 +174,12 @@
 		}
 		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1020,"Open online in Browser"))){
 			ch = (CacheHolder)cacheDB.get(tbp.getSelectedCache());
+			CacheHolderDetail chD=new CacheHolderDetail(ch);
 			try{
-				ch.readCache(profile.dataDir);
+				chD.readCache(profile.dataDir);
 			}catch(IOException ex){	(new MessageBox(MyLocale.getMsg(321,"Error"), "Cannot read cache data\n"+ex.toString()+"\nCache: "+ch.wayPoint,MessageBox.OKB)).execute(); }
 			try {
-				String cmd = "\""+pref.browser+ "\" \"" + ch.URL+"\"";
+				String cmd = "\""+pref.browser+ "\" \"" + chD.URL+"\"";
 				Vm.exec(cmd);
 			} catch (IOException ex) {
 				(new MessageBox("Error", "Cannot start browser!\n"+ex.toString()+"\nThe are two possible reasons:\n * path to internet browser in \npreferences not correct\n * An bug in ewe VM, please be \npatient for an update",MessageBox.OKB)).execute();

Modified: trunk/src/exp/Exporter.java
===================================================================
--- trunk/src/exp/Exporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/exp/Exporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -65,7 +65,8 @@
 	public void doIt(int variant){
 		File outFile;
 		String str;
-		CacheHolder holder;
+		CacheHolder ch;
+		CacheHolderDetail holder;
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
 
@@ -84,8 +85,8 @@
 		int counter = 0;
 		int expCount = 0;
 		for(int i = 0; i<cacheDB.size();i++){
-			holder = (CacheHolder)cacheDB.get(i);
-			if(holder.is_black == false && holder.is_filtered == false) counter++;
+			ch = (CacheHolder)cacheDB.get(i);
+			if(ch.is_black == false && ch.is_filtered == false) counter++;
 		}
 
 		try{
@@ -93,8 +94,9 @@
 			str = this.header();
 			if (str != null) outp.print(str);
 			for(int i = 0; i<cacheDB.size(); i++){
-				holder=(CacheHolder)cacheDB.get(i);
-				if(holder.is_black == false && holder.is_filtered == false){
+				ch=(CacheHolder)cacheDB.get(i);
+				if(ch.is_black == false && ch.is_filtered == false){
+					holder=new CacheHolderDetail(ch);
 					expCount++;
 					h.progress = (float)expCount/(float)counter;
 					h.changed();
@@ -210,7 +212,7 @@
 	 * @param ch	cachedata
 	 * @return formated cache data
 	 */	
-	public String record(CacheHolder ch){
+	public String record(CacheHolderDetail chD){
 		return null;
 	}
 
@@ -221,7 +223,7 @@
 	 * @param lon
 	 * @return formated cache data
 	 */
-	public String record(CacheHolder ch, String lat, String lon){
+	public String record(CacheHolderDetail ch, String lat, String lon){
 		return null;
 	}
 	/**

Modified: trunk/src/exp/GPXExporter.java
===================================================================
--- trunk/src/exp/GPXExporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/exp/GPXExporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -43,7 +43,7 @@
 		return strBuf.toString();
 	}
 	
-	public String record(CacheHolder ch, String lat, String lon) {
+	public String record(CacheHolderDetail ch, String lat, String lon) {
 		StringBuffer strBuf = new StringBuffer(1000);
 		Time tim = new Time();
 

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/exp/HTMLExporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -36,7 +36,8 @@
 	}
 	
 	public void doIt(){
-		CacheHolder holder = new CacheHolder();
+		CacheHolderDetail holder;
+		CacheHolder ch;
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
 
@@ -63,8 +64,8 @@
 			//Generate index page
 			int counter = 0;
 			for(int i = 0; i<cacheDB.size();i++){
-				holder = (CacheHolder)cacheDB.get(i);
-				if(holder.is_black == false && holder.is_filtered == false) counter++;
+				ch = (CacheHolder)cacheDB.get(i);
+				if(ch.is_black == false && ch.is_filtered == false) counter++;
 			}
 			
 			pbf.showMainTask = false;
@@ -75,8 +76,9 @@
 				h.progress = (float)(i+1)/(float)counter;
 				h.changed();
 
-				holder = (CacheHolder)cacheDB.get(i);
-				if(holder.is_black == false && holder.is_filtered == false){
+				ch = (CacheHolder)cacheDB.get(i);
+				if(ch.is_black == false && ch.is_filtered == false){
+					holder=new CacheHolderDetail(ch);
 					//KHF read cachedata only if needed
 					try{
 						holder.readCache( profile.dataDir);

Modified: trunk/src/exp/MSARCSVExporter.java
===================================================================
--- trunk/src/exp/MSARCSVExporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/exp/MSARCSVExporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -22,7 +22,7 @@
 		return "Name;Breitengrad;L\u00E4ngengrad;Typ1;Typ2;Waypoint;Datum;Hyperlink\r";
 	}
 
-	public String record(CacheHolder ch, String lat, String lon) {
+	public String record(CacheHolderDetail ch, String lat, String lon) {
 		StringBuffer str = new StringBuffer(200);
 		str.append("\"" + ch.wayPoint + " - " + ch.CacheName + "\";");
 		str.append(lat + ";" + lon +";");

Modified: trunk/src/exp/TPLExporter.java
===================================================================
--- trunk/src/exp/TPLExporter.java	2007-05-24 18:49:49 UTC (rev 706)
+++ trunk/src/exp/TPLExporter.java	2007-05-24 19:05:50 UTC (rev 707)
@@ -27,6 +27,7 @@
 
 import CacheWolf.CWPoint;
 import CacheWolf.CacheHolder;
+import CacheWolf.CacheHolderDetail;
 import CacheWolf.CacheType;
 import CacheWolf.Global;
 import CacheWolf.Preferences;
@@ -138,7 +139,8 @@
 	}
 	
 	public void doIt(){
-		CacheHolder holder;
+		CacheHolderDetail holder;
+		CacheHolder ch;
 		ProgressBarForm pbf = new ProgressBarForm();
 		ewe.sys.Handle h = new ewe.sys.Handle();
 
@@ -149,8 +151,8 @@
 		
 		int counter = 0;
 		for(int i = 0; i<cacheDB.size();i++){
-			holder = (CacheHolder)cacheDB.get(i);
-			if(holder.is_black == false && holder.is_filtered == false) counter++;
+			ch = (CacheHolder)cacheDB.get(i);
+			if(ch.is_black == false && ch.is_filtered == false) counter++;
 		}
 		pbf.showMainTask = false;
 		pbf.setTask(h,"Exporting ...");
@@ -174,11 +176,12 @@
 			Template tpl = new Template(args);
 
 			for(int i = 0; i<counter;i++){
-				holder = (CacheHolder)cacheDB.get(i);
+				ch = (CacheHolder)cacheDB.get(i);
 				h.progress = (float)i/(float)counter;
 				h.changed();
-				if(holder.is_black == false && holder.is_filtered == false){
-					if (holder.pos.isValid() == false) continue;
+				if(ch.is_black == false && ch.is_filtered == false){
+					if (ch.pos.isValid() == false) continue;
+					holder=new CacheHolderDetail(ch);
 					try{
 						holder.readCache(profile.dataDir);
 					}catch(Exception e){



From admin at berlios.de  Fri May 25 13:00:55 2007
From: admin at berlios.de (admin at berlios.de)
Date: Fri, 25 May 2007 13:00:55 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3439] .wl in HTML export
Message-ID: <200705251100.l4PB0tqc011677@unicorn.berlios.de>

Feature Request #3439, was updated on 2007-May-25 13:00
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3439&group_id=2211

Category: None
Status: Open
Priority: 5
Summary: .wl in HTML export

By: bilbowolf
Date: 2007-May-25 13:00

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; CIO CU; .NET CLR 1.0.3705; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.1)

Beim Ausdrucken, bzw. besser beim HTML Export 
scheint die *.wl Datei nicht mit integriert. Wenn ich 
einen Multi mache, w?rde ich die abgelesenen, 
abgez?hlten, ... Werte aber gerne nur dort 
ablegen (um nachher gleich damit zu rechnen), so 
fehlen sie aber in der Dokumentation (ich gedenke 
die HTML-Dateien zur Dokumentation verwenden) 

siehe auch: 
http://www.geoclub.de/ftopic16289.html

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3439&group_id=2211


From salzkammergut at mail.berlios.de  Sun May 27 09:50:46 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 27 May 2007 09:50:46 +0200
Subject: [Cachewolf-svn] r708 - in trunk: resources src/CacheWolf
Message-ID: <200705270750.l4R7okkQ008795@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-27 09:50:41 +0200 (Sun, 27 May 2007)
New Revision: 708

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/MainMenu.java
Log:
MainMenu: Aenderung der Option Profile->Edit auf Profile->Zentrum

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-05-24 19:05:50 UTC (rev 707)
+++ trunk/resources/cachewolf.Languages.cfg	2007-05-27 07:50:41 UTC (rev 708)
@@ -226,16 +226,12 @@
 		1024=Entfernungen in der Listenansicht~vom aktuellen Standpunkt aus~neu berechnet
 		1025=Kann Zentrum nicht setzen (GPS-Position unzul%e4ssig)
 		1100=Profile
-		1101=Profil 1
-		1102=Profil 2
-		1103=Profil 3
-		1104=Profil 4
 		1105=Suchen
 		1106=Profil w%e4hlen oder Neu
 		1107=Neu
 		1108=Profil w%e4hlen
 		1109=Laden
-		1110=Bearbeiten
+		1110=Zentrum
 		1111=Neues Profil anlegen
 		1112=Profilname
 		1113=Kann Verzeichnis nicht erstellen (Es darf kein vom Betriebssystem verbotenen Zeichen beinhalten)
@@ -574,16 +570,12 @@
 		1024=Distances in list view recalculated~from current position
 		1025=Cannot set centre (Invalid GPS position)
 		1100=Profiles
-		1101=Profile 1
-		1102=Profile 2
-		1103=Profile 3
-		1104=Profile 4
 		1105=Browse
 		1106=Choose profile or New
 		1107=New
 		1108=Choose profile
 		1109=Open
-		1110=Edit
+		1110=Center
 		1111=Create new profile:
 		1112=New profile name
 		1113=Cannot create directory (must not contain caracters forbidden by operating system)

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2007-05-24 19:05:50 UTC (rev 707)
+++ trunk/src/CacheWolf/MainMenu.java	2007-05-27 07:50:41 UTC (rev 708)
@@ -29,7 +29,7 @@
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtBlack, filtApply;
 	private MenuItem exportGPS, exportCacheMate,mnuSeparator;
 	private MenuItem orgCopy, orgMove, orgDelete;
-	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditProfile;
+	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditCenter;
 	private Form father;
 	private TablePanel tbp;
 	private FilterScreen scnFilter=new FilterScreen();
@@ -44,7 +44,7 @@
 		MenuItem[] mnuProfile = new MenuItem[3];
 		mnuProfile[0] = mnuNewProfile = new MenuItem(MyLocale.getMsg(1107,"New"));
 		mnuProfile[1] = mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109,"Open"));
-		mnuProfile[2] = mnuEditProfile = new MenuItem(MyLocale.getMsg(1110,"Edit"));
+		mnuProfile[2] = mnuEditCenter = new MenuItem(MyLocale.getMsg(1110,"Center"));
 		Menu profileMenu = new Menu(mnuProfile,MyLocale.getMsg(121,"Profiles"));
 		
 		///////////////////////////////////////////////////////////////////////
@@ -219,7 +219,7 @@
 						tbp.resetModel();
 				}
 			}
-			if(mev.selectedItem == mnuEditProfile){
+			if(mev.selectedItem == mnuEditCenter){
 				ProfileDataForm f=new ProfileDataForm(pref,profile);
 			    int code=f.execute(getFrame(), Gui.CENTER_FRAME);
 			    tbp.refreshTable();



From salzkammergut at mail.berlios.de  Mon May 28 01:39:48 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 28 May 2007 01:39:48 +0200
Subject: [Cachewolf-svn] r709 - trunk/src/exp
Message-ID: <200705272339.l4RNdmY6028594@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-28 01:39:40 +0200 (Mon, 28 May 2007)
New Revision: 709

Modified:
   trunk/src/exp/ASCExporter.java
   trunk/src/exp/Exporter.java
   trunk/src/exp/KMLExporter.java
   trunk/src/exp/LocExporter.java
   trunk/src/exp/OVLExporter.java
   trunk/src/exp/OziExporter.java
   trunk/src/exp/PCX5Exporter.java
Log:
Exporter: Nachtrag zur Umstellung auf CacheHolder und CacheHolderDetail

Modified: trunk/src/exp/ASCExporter.java
===================================================================
--- trunk/src/exp/ASCExporter.java	2007-05-27 07:50:41 UTC (rev 708)
+++ trunk/src/exp/ASCExporter.java	2007-05-27 23:39:40 UTC (rev 709)
@@ -19,7 +19,7 @@
 		this();
 	}
 	
-	public String record (CacheHolder holder, String lat, String lon){
+	public String record (CacheHolderDetail holder, String lat, String lon){
 		StringBuffer strBuf = new StringBuffer(100);
 		String dummy;
 		dummy = holder.CacheName;

Modified: trunk/src/exp/Exporter.java
===================================================================
--- trunk/src/exp/Exporter.java	2007-05-27 07:50:41 UTC (rev 708)
+++ trunk/src/exp/Exporter.java	2007-05-27 23:39:40 UTC (rev 709)
@@ -108,7 +108,7 @@
 						continue;
 					}
 					switch (this.howManyParams) {
-					case NO_PARAMS: 
+					case NO_PARAMS:
 						str = record(holder);
 						break;
 					case LAT_LON:

Modified: trunk/src/exp/KMLExporter.java
===================================================================
--- trunk/src/exp/KMLExporter.java	2007-05-27 07:50:41 UTC (rev 708)
+++ trunk/src/exp/KMLExporter.java	2007-05-27 23:39:40 UTC (rev 709)
@@ -32,7 +32,7 @@
 		return strBuf.toString();
 	}
 	
-	public String record(CacheHolder ch, String lat, String lon){
+	public String record(CacheHolderDetail ch, String lat, String lon){
 		StringBuffer strBuf = new StringBuffer(200);
 		
 		strBuf.append("   <Placemark>\r\n");

Modified: trunk/src/exp/LocExporter.java
===================================================================
--- trunk/src/exp/LocExporter.java	2007-05-27 07:50:41 UTC (rev 708)
+++ trunk/src/exp/LocExporter.java	2007-05-27 23:39:40 UTC (rev 709)
@@ -1,5 +1,6 @@
 package exp;
 import CacheWolf.*;
+import ewe.sys.Vm;
 import ewe.util.Hashtable;
 
 /**
@@ -19,7 +20,7 @@
 		return "<?xml version=\"1.0\"?><loc version=\"1.0\" src=\"EasyGPS\">\r\n";
 	}
 	
-	public String record(CacheHolder ch){
+	public String record(CacheHolderDetail ch){
 		// filter out not valid coords
 		if (!ch.pos.isValid()) return null;
 		StringBuffer strBuf = new StringBuffer(200);

Modified: trunk/src/exp/OVLExporter.java
===================================================================
--- trunk/src/exp/OVLExporter.java	2007-05-27 07:50:41 UTC (rev 708)
+++ trunk/src/exp/OVLExporter.java	2007-05-27 23:39:40 UTC (rev 709)
@@ -14,7 +14,7 @@
 		this.setHowManyParams(LAT_LON|COUNT);
 	}
 	
-	public String record(CacheHolder ch, String lat, String lon, int counter){
+	public String record(CacheHolderDetail ch, String lat, String lon, int counter){
 		StringBuffer str = new StringBuffer(200);
 		double tmp;
 		str.append("[Symbol "+Convert.toString(2*counter + 1)+"]\r\n");

Modified: trunk/src/exp/OziExporter.java
===================================================================
--- trunk/src/exp/OziExporter.java	2007-05-27 07:50:41 UTC (rev 708)
+++ trunk/src/exp/OziExporter.java	2007-05-27 23:39:40 UTC (rev 709)
@@ -23,7 +23,7 @@
 		return strBuf.toString();
 	}
 
-	public String record(CacheHolder ch, String lat, String lon){
+	public String record(CacheHolderDetail ch, String lat, String lon){
 		StringBuffer strBuf = new StringBuffer(200);
 		String tmpName;
 

Modified: trunk/src/exp/PCX5Exporter.java
===================================================================
--- trunk/src/exp/PCX5Exporter.java	2007-05-27 07:50:41 UTC (rev 708)
+++ trunk/src/exp/PCX5Exporter.java	2007-05-27 23:39:40 UTC (rev 709)
@@ -34,7 +34,7 @@
 		return strBuf.toString();
 	}
 	
-	public String record(CacheHolder ch){
+	public String record(CacheHolderDetail ch){
 		StringBuffer strBuf = new StringBuffer(200);
 		String latlonstr, dummy;
 



From salzkammergut at mail.berlios.de  Mon May 28 01:43:04 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 28 May 2007 01:43:04 +0200
Subject: [Cachewolf-svn] r710 - trunk/src/CacheWolf
Message-ID: <200705272343.l4RNh4f4028960@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-28 01:43:02 +0200 (Mon, 28 May 2007)
New Revision: 710

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
DetailsPanel: Erster Teil Bugfix fuer fehlende Umschaltung Blacklist

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-05-27 23:39:40 UTC (rev 709)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-05-27 23:43:02 UTC (rev 710)
@@ -306,6 +306,7 @@
 				blackStatus = thisCache.is_black;
 				thisCache.setAttributesToAddiWpts();
 				btnBlack.repaintNow();
+				dirty_details=true;
 			}
 			else if (ev.target == btnNewWpt){
 				Global.mainTab.newWaypoint(new CacheHolder());



From salzkammergut at mail.berlios.de  Mon May 28 01:48:45 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 28 May 2007 01:48:45 +0200
Subject: [Cachewolf-svn] r711 - in trunk: resources src/CacheWolf
Message-ID: <200705272348.l4RNmjVU029289@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-28 01:48:40 +0200 (Mon, 28 May 2007)
New Revision: 711

Added:
   trunk/resources/spider.def
Modified:
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SpiderGC.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Spider: Umbau auf Tabellensteuerung und Aufraeumen
Es gibt jetzt nur mehr eine Spider-routine, die sowohl von Spidersingle und doIt aufgerufen wird
Einbau einer Begrenzung der Logs auf 250 (Kann in Zukunft ueber Praeferenzen angepa?\195?\159t werden)
Merken des Passwortes (innerhalb eines Programmlaufes)
Noch zu machen: Vermeiden Bilder mehrfach zu laden

Added: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-05-27 23:43:02 UTC (rev 710)
+++ trunk/resources/spider.def	2007-05-27 23:48:40 UTC (rev 711)
@@ -0,0 +1,107 @@
+#============================================================
+# spider.def - Definition file for reading caches from GC.COM
+# Version 1.0 - 20070526 skg
+#============================================================
+# A suffix of Rex indicates a regular expression
+# A suffix of ExStart indicates the start of an Extractor search pattern
+# A suffix of ExEnd indicates the end of an Extractor search pattern
+#
+# Important:
+# * When entering spaces into a string ensure to escape them or write them as \\u0020
+# * Be sure that you have no hidden spaces at the end of a line or the patterns will not match!
+#------------------------------------------------------------
+loginPage          = http://www.geocaching.com/login/Default.aspx
+nextPage           = /login/default.aspx
+#--------------------------------------
+#Section1: First page with list of caches
+#--------------------------------------
+firstPage          = http://www.geocaching.com/seek/nearest.aspx?lat=
+firstPage2         = &lon=
+# Regex to search for cachenames 
+lineRex            = <tr bgcolor=((?s).*?)</tr>
+listBlockRex       = <table id="dlResults"((?s).*?)</table>
+distRex            = <br\ />(.*?)(km|mi)</td>
+waypointRex        = </a> \\((.*?)\\)<br>
+showOnlyFound      = &f=1
+nextListPage       = /seek/nearest.aspx
+
+#--------------------------------------
+#Section2: Get cachepage by name
+#--------------------------------------
+getPageByName      = http://www.geocaching.com/seek/cache_details.aspx?wp=
+fetchAllLogs       = &log=y
+cacheUnavailable   = This\ cache\ is\ temporarily\ unavailable
+cacheArchived      = This cache\ has\ been\ archived
+latLonRex          = <span\ id="LatLon"><.*?>((?s).*?)</STRONG>
+shortDescRex       = <span\ id="ShortDescription">((?s).*?)</span>
+longDescRex        = <span\ id="LongDescription">((?s).*?)<strong>Additional\ Hints
+cacheNameRex       = <span\ id="CacheName">((?s).*?)</span>
+cacheOwnerRex      = <span\ id="CacheOwner".*?by ((?s).*?)\\[<A\ HREF=
+dateHiddenRex      = <span\ id="DateHidden">((?s).*?)</span>
+hintsRex           = <span\ id="Hints"\ class="displayMe">((?s).*?)</span>
+sizeRex            = This\ is\ a\ <strong>((?s).*?)</strong>\ cache
+difficultyRex      = <span\ id="Difficulty">.*?alt="(.*?)\ out\ of
+terrainRex         = <span\ id="Terrain">.*?alt="(.*?)\ out\ of
+cacheTypeRex       = <img\ src="../images/WptTypes/(.*?)\\.gif
+
+#--------------------------------------
+#Section2a: Logs
+#--------------------------------------
+# blockRex extrahiert zun?chst aus der gesamten Seite den Logbereich
+blockRex           = <span\ id="CacheLogs">((?s).*?)</span>
+# singleLogEx extrahiert in einer Schleife alle Logs aus dem Logbereich
+singleLogExStart   = <STRONG>
+singleLogExEnd     = [<A\ href=
+# iconEx, nameTempEx, dateEx, singleLogEx werden auf einen singleLog angewendet
+iconExStart        = http://www.geocaching.com/images/icons/
+iconExEnd          = '\ align='abs
+nameTempExStart    = <A\ HREF="
+nameTempExEnd      = /A>
+# Name extrahiert aus nameTemp
+nameExStart        = >
+nameExEnd          = <
+dateExStart        = align='absmiddle'>&nbsp;
+dateExEnd          = \ by\ <
+logExStart         = found)
+logExEnd           = <br>[
+# Die Icons, die einen erfolgreichen Fund signalisieren
+icon_smile         = icon_smile.gif
+icon_camera        = icon_camera.gif
+
+#--------------------------------------
+#Section2b: Bugs
+#--------------------------------------
+# blockEx extrahiert zun?chst den Bugbereich aus der gesamten Seite
+blockExStart       = >&nbsp;Inventory</td>
+blockExEnd         = What\ is\ a\ Travel\ Bug?
+# bugEx extrahiert die Namen der einzelnen Bugs aus dem Bugbereich
+bugExStart         = <a\ href='
+bugExEnd           = </a></strong></td>
+bugDetailsStart    = id="BugDetail_BugGoal">
+bugDetailsEnd      = </span>
+
+#--------------------------------------
+#Section2c: Images
+#--------------------------------------
+# imgBlockEx searches for images in the long description
+imgBlockExStart    = <IMG
+imgBlockExEnd      = >
+# imgSpanEx searches for images in the image section
+imgSpanExStart     = <span\ id="Images"
+imgSpanExEnd       = </span>
+imgNameExStart     = align=absmiddle\ border=0>
+imgNameExEnd       = </a><br/>
+imgSrcExStart      = <A\ HREF='http://
+imgSrcExEnd        = '\ rel='lightbox'
+
+#--------------------------------------
+#Section2d: Additional waypoints
+#--------------------------------------
+wayBlockExStart    = <strong>Additional\ Waypoints</strong><br>
+wayBlockExEnd      = </table>
+nameRex            = &RefDS=1">(.*)</a>
+koordRex           = align="left">([NSns]\ [0-9]{1,2}..[0-9]{1,2}.[0-9]{1,3}\ [EWew]\ [0-9]{1,3}..[0-9]{1,2}.[0-9]{1,3})</td>
+descRex            = colspan="4">(.*)</td>
+typeRex            = </a>\ \\((.*)\\)</td>
+rowBlockExStart    = <tr
+rowBlockExEnd      = </tr>

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2007-05-27 23:43:02 UTC (rev 710)
+++ trunk/src/CacheWolf/Profile.java	2007-05-27 23:48:40 UTC (rev 711)
@@ -100,97 +100,7 @@
 		saveIndex(pref,showprogress, Filter.filterActive,Filter.filterInverted);
 	}
 
-	/**
-	 * Method to write the header for the index file.
-	 * Should be used when memory becomes critical and storage
-	 * in the cachedb vector poses a problem (see spiderGC)
-	 *
-	 */
-	public void openIndex(Preferences pref){
-		boolean saveFilterActive = Filter.filterActive;
-		boolean saveFilterInverted = Filter.filterInverted;
-		PrintWriter detfile;
-		try{
-			detfile = new PrintWriter(new BufferedWriter(new FileWriter(dataDir + "indextemp.xml")));
-		} catch (Exception e) {
-			Vm.debug("Problem creating index file "+e.toString()+"\nFilename="+dataDir + "index.xml");
-			return;
-		}
-		CWPoint savedCentre=centre;
-		if (centre==null || !centre.isValid() || (savedCentre.latDec==0.0 && savedCentre.lonDec==0.0)) savedCentre=pref.curCentrePt;
-		try{
-			detfile.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n");
-			detfile.print("<CACHELIST format=\"decimal\">\n");
-			if (savedCentre.isValid())
-				detfile.print("    <CENTRE lat=\""+savedCentre.latDec+"\" lon=\""+savedCentre.lonDec+"\"/>\n");
-			if(last_sync_opencaching == null || last_sync_opencaching.endsWith("null") || last_sync_opencaching.equals("")){
-				last_sync_opencaching = "20050801000000";
-			}
-			if(distOC == null || distOC.endsWith("null") || distOC.equals("")){
-				distOC = "0";
-			}
-
-			detfile.print("    <FILTER status = \""+(saveFilterActive?"T":"F")+(saveFilterInverted?"T":"F")+ 
-					"\" rose = \""+filterRose+"\" type = \""+filterType+
-					"\" var = \""+filterVar+"\" dist = \""+filterDist.replace('"',' ')+"\" diff = \""+
-					filterDiff+"\" terr = \""+filterTerr+"\" size = \""+filterSize+"\" />\n");
-			detfile.print("    <SYNCOC date = \""+last_sync_opencaching+"\" dist = \""+distOC+"\"/>\n");
-			detfile.close();
-			byPassIndexActive = true;
-		}catch(Exception e){
-			Vm.debug("Problem writing to index file "+e.toString());
-			detfile.close();
-		}
-	}
 	
-	/**
-	 * Method to appen a single line of cachedate to the index file
-	 * @param ch
-	 */
-	public void writeIndexLine(CacheHolder ch){
-		Stream strout = null;
-		//Vm.debug("Datadir:" + dataDir);
-		File index = new File(dataDir + "indextemp.xml");
-		String cachedata = "    <CACHE name = \""+SafeXML.clean(ch.CacheName)+"\" owner = \""+SafeXML.clean(ch.CacheOwner)+
-				"\" lat = \""+ ch.pos.latDec + "\" lon = \""+ch.pos.lonDec+
-				"\" hidden = \""+ch.DateHidden+"\" wayp = \""+SafeXML.clean(ch.wayPoint)+"\" status = \""+ch.CacheStatus+"\" type = \""+ch.type+"\" dif = \""+ch.hard+"\" terrain = \"" + ch.terrain + "\" dirty = \"" + ch.dirty + "\" size = \""+ch.CacheSize+"\" online = \"" + Convert.toString(ch.is_available) + "\" archived = \"" + Convert.toString(ch.is_archived) + "\" has_bug = \"" + Convert.toString(ch.has_bug) + "\" black = \"" + Convert.toString(ch.is_black) + "\" owned = \"" + Convert.toString(ch.is_owned) + "\" found = \"" + Convert.toString(ch.is_found) + "\" is_new = \"" + Convert.toString(ch.is_new) +"\" is_log_update = \"" + Convert.toString(ch.is_log_update) + "\" is_update = \"" + Convert.toString(ch.is_update) + "\" is_HTML = \"" + Convert.toString(ch.is_HTML) + "\" DNFLOGS = \"" + ch.noFindLogs + "\" ocCacheID = \"" + ch.ocCacheID + "\" is_INCOMPLETE = \""+Convert.toString(ch.is_incomplete)+"\" />\n";
-		try{
-			//append data!
-			strout = index.toWritableStream(true);
-			byte[] data = cachedata.getBytes(); 
-			strout.write(data);
-			//Vm.debug("Line: " + cachedata);
-		}catch(Exception ex){
-			Vm.debug("Problem writing to index");
-		}
-		finally{
-			strout.close();
-		}
-	}
-	
-	/**
-	 * Use this method to "finalize" the index file when using openIndex()
-	 * and writeIndexLine()
-	 *
-	 */
-	public void closeIndex(){
-		Stream strout = null;
-		File index = new File(dataDir + "indextemp.xml");
-		try{
-			//append data!
-			strout = index.toWritableStream(true);
-			byte[] data = "</CACHELIST>\n".getBytes(); 
-			strout.write(data);
-			strout.close();
-			File old = new File(dataDir + "index.xml");
-			old.delete();
-			index.rename("index.xml");
-			File indextemp = new File(dataDir + "indextemp.xml");
-			indextemp.delete();
-			byPassIndexActive = false;
-		}catch(Exception ex){};
-	}
-	
 	/** Save index with filter settings given */ 
 	public void saveIndex(Preferences pref, boolean showprogress, boolean saveFilterActive, boolean saveFilterInverted){
 		ProgressBarForm pbf = new ProgressBarForm();

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-27 23:43:02 UTC (rev 710)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-27 23:48:40 UTC (rev 711)
@@ -33,11 +33,14 @@
 
 /**
 *	Class to spider caches from gc.com
-*	It uses a generic parse tree to parse the page and build a gpx file.
-*	ClassID (for cachewolf.languages.cfg = 5500
 */
 public class SpiderGC{
 	
+	/**
+	 * The maximum number of logs that will be stored
+	 */
+	public static int MAXLOGS=250;
+	
 	private static int ERR_LOGIN = -10;
 	private static Preferences pref;
 	private Profile profile;
@@ -49,9 +52,27 @@
 	Regex inRex = new Regex();
 	Vector cacheDB;
 	Vector cachesToLoad = new Vector();
-	Hashtable indexDB = new Hashtable();
+	Hashtable indexDB;
 	InfoBox infB;
+	private static Properties p=null; 
 	
+	public SpiderGC(Preferences prf, Profile profile, boolean bypass){
+		this.profile=profile;
+		this.cacheDB = profile.cacheDB;
+		pref = prf;
+		try {
+			if (p==null) {
+				p=new Properties();
+				p.load(new FileInputStream("spider.def"));
+			}
+		} catch (Exception ex) {
+			p=null;
+			pref.log("Failed to load spider.def",ex);
+			// We don't display an error message box here, as the call to 
+			// spiderSingle or doIt will do this
+		}
+	}
+	
 	/**
 	 * Method to login the user to gc.com
 	 * It will request a password and use the alias defined in preferences
@@ -59,10 +80,10 @@
 	public int login(){
 		pref.logInit();
 		//Access the page once to get a viewstate
-		String start = "";
-		String doc = "";
+		String start,doc,loginPage;
 		//Get password
 		InfoBox infB = new InfoBox("Password", "Enter password:", InfoBox.INPUT);
+		infB.feedback.setText(passwort); // Remember the PWD for next time
 		int code = infB.execute();
 		passwort = infB.getInput();
 		infB.close(0);
@@ -72,9 +93,10 @@
 		infB.exec();
 		try{
 			pref.log("Fetching login page");
-			start = fetch("http://www.geocaching.com/login/Default.aspx");
+			start = fetch(loginPage=p.getProperty("loginPage"));   //http://www.geocaching.com/login/Default.aspx
 		}catch(Exception ex){
 			pref.log("Could not fetch: gc.com start page",ex);
+			passwort="";
 			return ERR_LOGIN;
 		}
 		if (!infB.isClosed) {
@@ -89,16 +111,16 @@
 			//Ok now login!
 			try{
 				pref.log("Logging in as "+pref.myAlias);
-				doc = URL.encodeURL("__VIEWSTATE",false) +"="+ URL.encodeURL(viewstate,false);
-				doc += "&" + URL.encodeURL("myUsername",false) +"="+ URL.encodeURL(pref.myAlias,false);
-				doc += "&" + URL.encodeURL("myPassword",false) +"="+ URL.encodeURL(passwort,false);
-				doc += "&" + URL.encodeURL("cookie",false) +"="+ URL.encodeURL("on",false);
-				doc += "&" + URL.encodeURL("Button1",false) +"="+ URL.encodeURL("Login",false);
-				start = fetch_post("http://www.geocaching.com/login/Default.aspx", doc, "/login/default.aspx");
+				doc = URL.encodeURL("__VIEWSTATE",false) +"="+ URL.encodeURL(viewstate,false)
+					+ "&" + URL.encodeURL("myUsername",false) +"="+ URL.encodeURL(pref.myAlias,false)
+				    + "&" + URL.encodeURL("myPassword",false) +"="+ URL.encodeURL(passwort,false)
+				    + "&" + URL.encodeURL("cookie",false) +"="+ URL.encodeURL("on",false)
+				    + "&" + URL.encodeURL("Button1",false) +"="+ URL.encodeURL("Login",false);
+				start = fetch_post(loginPage, doc, p.getProperty("nextPage"));  // /login/default.aspx
 				pref.log("Login successful");
 			}catch(Exception ex){
 				//Vm.debug("Could not login: gc.com start page");
-				pref.log("Login failed.");
+				pref.log("Login failed.", ex);
 				infB.close(0);
 				return ERR_LOGIN;
 			}
@@ -126,150 +148,58 @@
 	 * @return True if spider was successful, false if spider was cancelled by closing the infobox
 	 */
 	public boolean spiderSingle(int number, InfoBox infB){
+		boolean ret=false;
 		this.infB = infB;
+		if (p==null) {
+			(new MessageBox(MyLocale.getMsg(5500,"Error"), "Could not load 'spider.def'", MessageBox.OKB)).execute();
+			return false;
+		}
 		CacheHolder ch = (CacheHolder)cacheDB.get(number);
-		if (ch.isAddiWpt()) return false;  // No point spidering an addi waypoint, comes with parent
-		//Vm.showWait(true); Already done in myTableControl
+		if (ch.isAddiWpt()) return false;  // No point re-spidering an addi waypoint, comes with parent
+
 		CacheHolderDetail chD=new CacheHolderDetail(ch);
-		String notes = "";
-		String start = "";
-		String origLong = "";
 		try{
+			// Get all existing details of the cache
 			chD.readCache(profile.dataDir);
+			// Read the cache data from GC.COM and compare to old data
+			ret=getCacheByWaypointName(chD,true,true,false,true);
+			// Save the spidered data 
+			if (ret) {
+				pref.log("Saving to:" + profile.dataDir);
+				chD.saveCacheDetails(profile.dataDir);
+				cacheDB.set(number, new CacheHolder(chD)); // TODO Could copy into existing object
+			}
 		}catch(IOException ioex){
 			pref.log("Could not load " + chD.wayPoint + "file in spiderSingle");
 		}
-		//notes = chD.CacheNotes;
-		
-		
-		String doc = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + chD.wayPoint +"&log=y";
-		try{
-			pref.log("Fetching: " + chD.wayPoint);
-			start = fetch(doc);
-		}catch(Exception ex){
-			pref.log("Could not fetch " + chD.wayPoint);
-			chD.is_incomplete = true;
-			//Redundant: cacheDB.set(number, ch);
-			//Vm.debug("Couldn't get cache detail page");
-		}
-		if (!infB.isClosed) { // Only analyse the cache data if user has not closed the progress window
-			try{
-				chD.is_new = false;
-				chD.is_update = false;
-				chD.is_HTML = true;
-				chD.is_available = true;
-				chD.is_archived = false;
-				chD.is_incomplete = false;
-				chD.CacheLogs.clear();
-				chD.addiWpts.clear();
-				chD.Images.clear();
-				chD.ImagesText.clear();
-				//Vm.debug(chD.wayPoint);
-				
-				if(start.indexOf("This cache is temporarily unavailable") >= 0) chD.is_available = false;
-				if(start.indexOf("This cache has been archived") >= 0) chD.is_archived = true;
-				pref.log("Trying logs");
-				int logsz = chD.CacheLogs.size();
-				chD.CacheLogs = getLogs(start, chD);
-				int z = 0;
-				String loganal = "";
-				while(z < chD.CacheLogs.size() && z < 5){
-					loganal = (String)chD.CacheLogs.get(z);
-					if(loganal.indexOf("icon_sad")>0) {
-						z++;
-					}else break;
-				}
-				chD.noFindLogs = z;
-				chD.is_log_update = false;
-				if(chD.CacheLogs.size()>logsz) chD.is_log_update = true;
-				pref.log("Found logs");
-				chD.LatLon = getLatLon(start);
-				chD.pos.set(chD.LatLon);
-				//Vm.debug("LatLon: " + chD.LatLon);
-				pref.log("Trying description");
-				origLong = chD.LongDescription;
-				chD.LongDescription = getLongDesc(start);
-				if(!chD.LongDescription.equals(origLong)) chD.is_update = true;
-				pref.log("Got description");
-				pref.log("Getting cache name");
-				chD.CacheName = SafeXML.cleanback(getName(start));
-				pref.log("Got cache name");
-				//Vm.debug("Name: " + chD.CacheName);
-				pref.log("Trying owner");
-				chD.CacheOwner = SafeXML.cleanback(getOwner(start)).trim();
-				if(chD.CacheOwner.equals(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equals(pref.myAlias2))) chD.is_owned = true;
-				pref.log("Got owner");
-				//Vm.debug("Owner: " + chD.CacheOwner);
-				pref.log("Trying date hidden");
-				chD.DateHidden = DateFormat.MDY2YMD(getDateHidden(start));
-				pref.log("Got date hidden");
-				//Vm.debug("Hidden: " + chD.DateHidden);
-				pref.log("Trying hints");
-				chD.Hints = getHints(start);
-				pref.log("Got hints");
-				//Vm.debug("Hints: " + chD.Hints);
-				//Vm.debug("Got the hints");
-				pref.log("Trying size");
-				chD.CacheSize = getSize(start);
-				pref.log("Got size");
-				//Vm.debug("Size: " + chD.CacheSize);
-				pref.log("Trying difficulty");
-				chD.hard = getDiff(start);
-				pref.log("Got difficulty");
-				//Vm.debug("Hard: " + chD.hard);
-				pref.log("Trying terrain");
-				chD.terrain = getTerr(start);
-				pref.log("Got terrain");
-				if (!infB.isClosed) chD.Bugs = getBugs(start);
-				chD.has_bug = chD.Bugs.length()>0;
-				//Vm.debug("Terr: " + chD.terrain);
-				pref.log("Trying cache type");
-				chD.type = getType(start);
-				pref.log("Got cache type");
-				//Vm.debug("Type: " + chD.type);
-				pref.log("Trying images");
-				getImages(start, chD);
-				pref.log("Got images");
-				//pref.log("Trying maps");
-				//getMaps(ch);
-				//pref.log("Got maps");
-				pref.log("Getting additional waypoints");
-				
-				getAddWaypoints(start, chD.wayPoint, chD.is_found);
-		
-				pref.log("Got additional waypoints");
-				//chD.CacheNotes = notes;
-				if (!infB.isClosed) {
-					chD.saveCacheDetails(profile.dataDir);
-					pref.log("Saving to:" + profile.dataDir);
-					cacheDB.set(number, new CacheHolder(ch)); // TODO Could copy into existing object
-				}
-			}catch(Exception ex){
-				pref.log("Exception in spider: " +ex.toString());
-			}
-			finally{}
-		}
-		boolean ret=!infB.isClosed; // If the infoBox was closed before getting here, we return false
-		//Vm.showWait(false); In myTableControl
 		return ret;
-	}
+	} // spiderSingle
 	
 	/**
 	*	Method to start the spider for a search around the center coordinates
 	*/
 	public void doIt(){
-		String postStr = new String();
-		String dummy = "";
-		Regex rexLine;
-		String ln=null;
-		String wpt = "";
-		String loganal;
+		String postStr, dummy, ln, wpt;
+		Regex lineRex;
 		CacheHolderDetail chD;
+		if (p==null) {
+			(new MessageBox(MyLocale.getMsg(5500,"Error"), "Could not load 'spider.def'", MessageBox.OKB)).execute();
+			return;
+		}
 		CWPoint origin = pref.curCentrePt; // No need to copy curCentrePt as it is only read and not written
 		if (!origin.isValid()) {
 			(new MessageBox("Error", "Coordinates for center must be set", MessageBox.OKB)).execute();
 			return;
 		}
+		// Prepare an index of caches for faster searching
+		indexDB = new Hashtable(cacheDB.size());
+		CacheHolder ch;
+		//index the database for faster searching!
+		for(int i = 0; i<cacheDB.size();i++){
+			ch = (CacheHolder)cacheDB.get(i);
+			indexDB.put((String)ch.wayPoint, new Integer(i));
+			ch.is_new = false;
+		}
 		String start = "";
 		Regex rex = new Regex("name=\"__VIEWSTATE\" value=\"(.*)\" />");
 		String doc = "";
@@ -288,18 +218,19 @@
 		String dist = options.distanceInput.getText();
 		if (dist.length()== 0) return;
 		distance = Convert.toDouble(dist);
-		//boolean getMaps = options.mapsCheckBox.getState();
 		boolean doNotgetFound = options.foundCheckBox.getState();
-		//Vm.debug("Do not get found? "+doNotgetFound);
 		boolean getImages = options.imagesCheckBox.getState();
 		options.close(0);
 		
+		//=======
+		// Prepare list of all caches that are to be spidered
+		//=======
 		Vm.showWait(true);
 		infB = new InfoBox("Status", MyLocale.getMsg(5502,"Fetching first page..."));
 		infB.exec();
 		//Get first page
 		try{
-			ln = "http://www.geocaching.com/seek/nearest.aspx?lat=" + origin.getLatDeg(CWPoint.DD) + "&lon=" +origin.getLonDeg(CWPoint.DD);
+			ln = p.getProperty("firstPage") + origin.getLatDeg(CWPoint.DD) + p.getProperty("firstPage2") +origin.getLonDeg(CWPoint.DD);
 			if(doNotgetFound) ln = ln + "&f=1";
 			pref.log("Getting first page: "+ln);
 			start = fetch(ln);
@@ -307,15 +238,14 @@
 		}catch(Exception ex){
 			infB.close(0);
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5503,"Error fetching first list page."), MessageBox.OKB)).execute();
-			pref.log("Error fetching first list page");
-			//Vm.debug("Could not get list");
+			pref.log("Error fetching first list page",ex);
 			Vm.showWait(false);
 			return;
 		}
 		dummy = "";
 		//String lineBlck = "";
 		int page_number = 4;		
-		rexLine = new Regex("<tr bgcolor=((?s).*?)</tr>");
+		lineRex = new Regex(p.getProperty("lineRex")); //"<tr bgcolor=((?s).*?)</tr>"
 		int found_on_page = 0;
 		//Loop till maximum distance has been found or no more caches are in the list
 		while(distance > 0){
@@ -323,52 +253,41 @@
 			rex.search(start);
 			viewstate = rex.stringMatched(1);
 			//Vm.debug("In loop");
-			dummy = getListBlock(start);
-			/*
+			Regex listBlockRex = new Regex(p.getProperty("listBlockRex")); // "<table id=\"dlResults\"((?s).*?)</table>"
+			listBlockRex.search(start);
+			dummy = listBlockRex.stringMatched(1);
 			try{
-				  PrintWriter detfile = new PrintWriter(new BufferedWriter(new FileWriter("debug.txt")));
-				  detfile.print(dummy);
-				  detfile.close();
-				} catch (Exception e) {
-					Vm.debug("Problem opening details file");
-				}
-			*/
-			try{
-				rexLine.search(dummy);
+				lineRex.search(dummy);
 			}catch(NullPointerException nex){}
-			
-			while(rexLine.didMatch()){
+			while(lineRex.didMatch()){
 				//Vm.debug(getDist(rexLine.stringMatched(1)) + " / " +getWP(rexLine.stringMatched(1)));
 				found_on_page++;
-				if(getDist(rexLine.stringMatched(1)) <= distance){
-					if(indexDB.get((String)getWP(rexLine.stringMatched(1))) == null){
-						cachesToLoad.add(getWP(rexLine.stringMatched(1)));
-					} else pref.log(getWP(rexLine.stringMatched(1))+" already in DB");
+				if(getDist(lineRex.stringMatched(1)) <= distance){
+					if(indexDB.get((String)getWP(lineRex.stringMatched(1))) == null){
+						cachesToLoad.add(getWP(lineRex.stringMatched(1)));
+					} else pref.log(getWP(lineRex.stringMatched(1))+" already in DB");
 				} else distance = 0;
-				rexLine.searchFrom(dummy, rexLine.matchedTo());
+				lineRex.searchFrom(dummy, lineRex.matchedTo());
 			}
 			infB.setInfo("Found " + cachesToLoad.size() + " caches");
 			if(found_on_page < 20) distance = 0;
-			postStr = "http://www.geocaching.com/seek/nearest.aspx?" + origin.getLatDeg(CWPoint.DD) + "&" + origin.getLonDeg(CWPoint.DD);
-			if(doNotgetFound) postStr = postStr + "&f=1";
+			postStr = p.getProperty("firstLine") + origin.getLatDeg(CWPoint.DD) + "&" + origin.getLonDeg(CWPoint.DD);
+			if(doNotgetFound) postStr = postStr + p.getProperty("showOnlyFound");
 			if(distance > 0){
 				page_number++;
 				if(page_number >= 15) page_number = 5;
-				doc = URL.encodeURL("__VIEWSTATE",false) +"="+ URL.encodeURL(viewstate,false);
-				//doc += "&" + URL.encodeURL("lat",false) +"="+ URL.encodeURL(origin.getLatDeg(CWPoint.DD),false);
-				//doc += "&" + URL.encodeURL("lon",false) +"="+ URL.encodeURL(origin.getLonDeg(CWPoint.DD),false);
+				doc = URL.encodeURL("__VIEWSTATE",false) +"="+ URL.encodeURL(viewstate,false)
 				//if(doNotgetFound) doc += "&f=1";
-				doc += "&" + URL.encodeURL("__EVENTTARGET",false) +"="+ URL.encodeURL("ResultsPager:_ctl"+page_number,false);
-				doc += "&" + URL.encodeURL("__EVENTARGUMENT",false) +"="+ URL.encodeURL("",false);
+				    + "&" + URL.encodeURL("__EVENTTARGET",false) +"="+ URL.encodeURL("ResultsPager:_ctl"+page_number,false)
+				    + "&" + URL.encodeURL("__EVENTARGUMENT",false) +"="+ URL.encodeURL("",false);
 				try{
 					start = "";
 					pref.log("Fetching next list page:" + doc);
-					start = fetch_post(postStr, doc, "/seek/nearest.aspx");
+					start = fetch_post(postStr, doc, p.getProperty("nextListPage"));
 				}catch(Exception ex){
 					//Vm.debug("Couldn't get the next page");
 					pref.log("Error getting next page");
 				}finally{
-					
 				}
 			}
 			//Vm.debug("Distance is now: " + distance);
@@ -377,10 +296,9 @@
 		
 		pref.log("Found " + cachesToLoad.size() + " caches");
 		if (!infB.isClosed) infB.setInfo("Found " + cachesToLoad.size() + " caches");
-		
-		// Now ready to spider each cache
-		
-		chD = new CacheHolderDetail();
+		//=======
+		// Now ready to spider each cache in the list
+		//=======
 		for(int i = 0; i<cachesToLoad.size(); i++){
 			if (infB.isClosed) break;
 			
@@ -388,125 +306,177 @@
 			// Get only caches not already available in the DB
 			if(searchWpt(wpt) == -1){
 				infB.setInfo("Loading: " + wpt +"(" + (i+1) + " / " + cachesToLoad.size() + ")");
-				doc = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + wpt +"&log=y";
-				start = "";
-				try{
-					pref.log("Fetching: " + wpt);
-					start = fetch(doc);
-				}catch(Exception ex){
-					pref.log("Could not fetch detail page for: " + wpt);
-					//Vm.debug("Couldn't get cache detail page");
-				}finally{
-					//	just continue please!
-					pref.log("Trying for details.");
-				}
-				if(start != null && start.length()!=0){
-					pref.log("Fetch doc ok... going into details.");
-					chD.is_new = true;
-					chD.is_HTML = true;
-					chD.is_available = true;
-					chD.is_archived = false;
-					chD.wayPoint = wpt;
-					if(start.indexOf("This cache is temporarily unavailable") >= 0) chD.is_available = false;
-					if(start.indexOf("This cache has been archived") >= 0) chD.is_archived = true;
-					//Vm.debug(chD.wayPoint);
-					try{
-						pref.log("Trying logs");
-						chD.CacheLogs = getLogs(start, chD);
-						int z = 0;
-						loganal = "";
-						while(z < chD.CacheLogs.size() && z < 5){
-							loganal = (String)chD.CacheLogs.get(z);
-							if(loganal.indexOf("icon_sad")>0) {
-								z++;
-							}else break;
-						}
-						chD.noFindLogs = z;
-						pref.log("Found logs");
-						chD.LatLon = getLatLon(start);
-						chD.pos.set(chD.LatLon); // Slow parse no problem
-						//Vm.debug("LatLon: " + chD.LatLon);
-						pref.log("Trying description");
-						chD.LongDescription = getLongDesc(start);
-						
-						pref.log("Got description");
-						pref.log("Getting cache name");
-						chD.CacheName = SafeXML.cleanback(getName(start));
-						pref.log("Got cache name");
-						//Vm.debug("Name: " + chD.CacheName);
-						pref.log("Trying owner");
-						chD.CacheOwner = SafeXML.cleanback(getOwner(start)).trim();
-						if(chD.CacheOwner.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equalsIgnoreCase(pref.myAlias2))) chD.is_owned = true;
-						pref.log("Got owner");
-						//Vm.debug("Owner: " + chD.CacheOwner);
-						pref.log("Trying date hidden");
-						chD.DateHidden = getDateHidden(start);
-						pref.log("Got date hidden");
-						//Vm.debug("Hidden: " + chD.DateHidden);
-						pref.log("Trying hints");
-						chD.Hints = getHints(start);
-						pref.log("Got hints");
-						//Vm.debug("Hints: " + chD.Hints);
-						//Vm.debug("Got the hints");
-						pref.log("Trying size");
-						chD.CacheSize = getSize(start);
-						pref.log("Got size");
-						//Vm.debug("Size: " + chD.CacheSize);
-						pref.log("Trying difficulty");
-						chD.hard = getDiff(start);
-						pref.log("Got difficulty");
-						//Vm.debug("Hard: " + chD.hard);
-						pref.log("Trying terrain");
-						chD.terrain = getTerr(start);
-						pref.log("Got terrain");
-						//Vm.debug("Terr: " + chD.terrain);
-						pref.log("Trying cache type");
-						chD.type = getType(start);
-						pref.log("Got cache type");
-						//Vm.debug("Type: " + chD.type);
-						if(getImages){
-							pref.log("Trying images");
-							getImages(start, chD);
-							pref.log("Got images");
-						}
-						if (infB.isClosed) {
-							
-							break;
-						}
-						chD.Bugs = getBugs(start);
-						if(chD.Bugs.length()>0) chD.has_bug = true; else chD.has_bug = false;
-						pref.log("Getting additional waypoints");
-						getAddWaypoints(start, chD.wayPoint, chD.is_found);
-						pref.log("Got additional waypoints");
-						
-						if(doNotgetFound) {
-							if(!chD.is_found) profile.writeIndexLine(chD);
-						} else profile.writeIndexLine(chD);
-						
-						chD.saveCacheDetails(profile.dataDir);
-						
-						chD = new CacheHolderDetail();
-					}catch(Exception ex){
-						pref.log("There was an error in the last step:");
-						pref.log("Cache was: " + wpt);
-						pref.log("Error was: " + ex.toString());
-						chD.is_incomplete = true;
-						if(doNotgetFound) {
-							if(!chD.is_found) profile.writeIndexLine(chD);
-						} else profile.writeIndexLine(chD);
-						
-						chD = new CacheHolderDetail();
-					}finally{
-						//just continue please!
-						pref.log("Continuing with next cache.");
-					}
-				}
+				chD = new CacheHolderDetail();
+				chD.wayPoint=wpt;
+				if (!getCacheByWaypointName(chD,false,getImages,doNotgetFound,true)) break;
+				if (!chD.is_found || !doNotgetFound ) {
+					chD.saveCacheDetails(profile.dataDir);
+					cacheDB.add(new CacheHolder(chD)); // TODO Could copy into existing object
+				}					
 			}
 		}
-		profile.closeIndex();
 		infB.close(0);
 		Vm.showWait(false);
+		Global.getProfile().saveIndex(Global.getPref(),true);
 	}
+
+	/**
+	 * Read a complete cachepage from geocaching.com including all logs. This is used both when
+	 * updating already existing caches (via spiderSingle) and when spidering around a centre. It
+	 * is also used when reading a GPX file and fetching the images.
+	 * 
+	 * This is the workhorse function of the spider.
+	 * 
+	 * @param CacheHolderDetail chD The element wayPoint must be set to the name of a waypoint
+	 * @param boolean isUpdate True if an existing cache is being updated, false if it is a new cache
+	 * @param boolean fetchImages True if the pictures are to be fetched
+	 * @param boolean doNotGetFound True if the cache is not to be spidered if it has already been found
+	 * @param boolean fetchAllLogs True if all logs are to be fetched (by adding option '&logs=y' to command line).
+	 *     This is normally false when spidering from GPXImport as the logs are part of the GPX file, and true otherwise
+	 * @return false if the infoBox was closed
+	 */
+	private boolean getCacheByWaypointName(CacheHolderDetail chD, boolean isUpdate, boolean fetchImages, boolean doNotGetFound, boolean fetchAllLogs) {
+		String completeWebPage,origLongDesc;
+		String doc = p.getProperty("getPageByName") + chD.wayPoint +(fetchAllLogs?p.getProperty("fetchAllLogs"):"");
+		try{
+			pref.log("Fetching: " + chD.wayPoint);
+			completeWebPage = fetch(doc);
+		}catch(Exception ex){
+			pref.log("Could not fetch " + chD.wayPoint,ex);
+			chD.is_incomplete = true;
+			return !infB.isClosed;
+		}
+		// Only analyse the cache data and fetch pictures if user has not closed the progress window
+		if (!infB.isClosed) { 
+			try{
+				chD.is_new = !isUpdate;
+				chD.is_update = false;
+				chD.is_HTML = true;
+				chD.is_available = true;
+				chD.is_archived = false;
+				chD.is_incomplete = false;
+				chD.CacheLogs.clear();
+				chD.addiWpts.clear();
+				chD.Images.clear();
+				chD.ImagesText.clear();
+				
+				if(completeWebPage.indexOf(p.getProperty("cacheUnavailable")) >= 0) chD.is_available = false;
+				if(completeWebPage.indexOf(p.getProperty("cacheArchived")) >= 0) chD.is_archived = true;
+				//==========
+				// General Cache Data
+				//==========
+				chD.LatLon = getLatLon(completeWebPage);
+				chD.pos.set(chD.LatLon);
+				if (pref.debug) pref.log("LatLon: " + chD.LatLon);
+				
+				pref.log("Trying description");
+				origLongDesc = chD.LongDescription;
+				chD.LongDescription = getLongDesc(completeWebPage);
+				if(isUpdate && !chD.LongDescription.equals(origLongDesc)) chD.is_update = true;
+				pref.log("Got description");
+				
+				pref.log("Getting cache name");
+				chD.CacheName = SafeXML.cleanback(getName(completeWebPage));
+				pref.log("Got cache name");
+				if (pref.debug) pref.log("Name: " + chD.CacheName);
+
+				pref.log("Trying owner");
+				chD.CacheOwner = SafeXML.cleanback(getOwner(completeWebPage)).trim();
+				if(chD.CacheOwner.equals(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equals(pref.myAlias2))) chD.is_owned = true;
+				pref.log("Got owner");
+				if (pref.debug) pref.log("Owner: " + chD.CacheOwner +"; is_owned = "+chD.is_owned+";  alias1,2 = ["+pref.myAlias+"|"+pref.myAlias2+"]");
+				
+				pref.log("Trying date hidden");
+				chD.DateHidden = DateFormat.MDY2YMD(getDateHidden(completeWebPage));
+				pref.log("Got date hidden");
+				if (pref.debug) pref.log("Hidden: " + chD.DateHidden);
+				
+				pref.log("Trying hints");
+				chD.Hints = getHints(completeWebPage);
+				pref.log("Got hints");
+				if (pref.debug) pref.log("Hints: " + chD.Hints);
+
+				pref.log("Trying size");
+				chD.CacheSize = getSize(completeWebPage);
+				pref.log("Got size");
+				if (pref.debug) pref.log("Size: " + chD.CacheSize);
+				
+				pref.log("Trying difficulty");
+				chD.hard = getDiff(completeWebPage);
+				pref.log("Got difficulty");
+				if (pref.debug) pref.log("Hard: " + chD.hard);
+				
+				pref.log("Trying terrain");
+				chD.terrain = getTerr(completeWebPage);
+				pref.log("Got terrain");
+				if (pref.debug) pref.log("Terr: " + chD.terrain);
+
+				pref.log("Trying cache type");
+				chD.type = getType(completeWebPage);
+				pref.log("Got cache type");
+				if (pref.debug) pref.log("Type: " + chD.type);
+				
+				//==========
+				// Logs
+				//==========
+				pref.log("Trying logs");
+				int logsz = chD.CacheLogs.size();
+				chD.CacheLogs = getLogs(completeWebPage, chD);
+				// Count the number of not-found logs
+				int countNoFoundLogs = 0;
+				String loganal = "";
+				while(countNoFoundLogs < chD.CacheLogs.size() && countNoFoundLogs < 5){
+					loganal = (String)chD.CacheLogs.get(countNoFoundLogs);
+					if(loganal.indexOf("icon_sad")>0) {
+						countNoFoundLogs++;
+					}else break;
+				}
+				chD.noFindLogs = countNoFoundLogs;
+				chD.is_log_update = false;
+				if(isUpdate && chD.CacheLogs.size()>logsz) chD.is_log_update = true;
+				pref.log("Found logs");
+				// If the switch is set to not store found caches and we found the cache => return
+				if (chD.is_found && doNotGetFound) return !infB.isClosed; 
+				
+				//==========
+				// Bugs
+				//==========
+				// As there may be several bugs, we check whether the user has aborted
+				if (!infB.isClosed) chD.Bugs = getBugs(completeWebPage);
+				chD.has_bug = chD.Bugs.length()>0;
+				
+				//==========
+				// Images
+				//==========
+				if(fetchImages){
+					pref.log("Trying images");
+					getImages(completeWebPage, chD);
+					pref.log("Got images");
+				}
+				//==========
+				// Addi waypoints
+				//==========
+				
+				pref.log("Getting additional waypoints");
+				getAddWaypoints(completeWebPage, chD.wayPoint, chD.is_found);
+				pref.log("Got additional waypoints");
+
+
+			}catch(Exception ex){
+				pref.log("Error reading cache: "+chD.wayPoint);
+				pref.log("Exception in getCacheByWaypointName: ",ex);
+			}
+			finally{}
+		}
+		boolean ret=!infB.isClosed; // If the infoBox was closed before getting here, we return false
+		return ret;
+	} // getCacheByWaypointName
+	
+	/**
+	 * Check whether a waypoint is in the database
+	 * @param wpt Name of waypoint to check
+	 * @return index of waypoint in database, -1 if it does not exist
+	 */
 	private int searchWpt(String wpt){
 		Integer INTR = (Integer)indexDB.get(wpt);
 		if(INTR != null){
@@ -514,11 +484,233 @@
 		} else return -1;
 	}
 	
+	/**
+	 * Get the Distance to the centre
+	 * @param doc A previously fetched cachepage
+	 * @return Distance
+	 */
+	private double getDist(String doc){
+		inRex = new Regex(p.getProperty("distRex"));
+		inRex.search(doc);
+		if(doc.indexOf("Here") > 0) return(0);
+		if(pref.digSeparator.equals(",")) return Convert.toDouble(inRex.stringMatched(1).replace('.',','));
+		return Convert.toDouble(inRex.stringMatched(1));
+	}
+
+	/**
+	 * Get the waypoint name
+	 * @param doc A previously fetched cachepage
+	 * @return Name of waypoint to add to list 
+	 */
+	private String getWP(String doc){
+		inRex = new Regex(p.getProperty("waypointRex"));
+		inRex.search(doc);
+		return inRex.stringMatched(1);
+	}
+	
+	/**
+	 * Get the coordinates of the cache
+	 * @param doc A previously fetched cachepage
+	 * @return Cache coordinates
+	 */
+	private String getLatLon(String doc){
+		inRex = new Regex(p.getProperty("latLonRex"));
+		inRex.search(doc);
+		return inRex.stringMatched(1);
+	}
+	
+	/**
+	 * Get the long description
+	 * @param doc A previously fetched cachepage
+	 * @return the long description
+	 */
+	private String getLongDesc(String doc){
+		String res = "";
+		inRex = new Regex(p.getProperty("shortDescRex"));
+		Regex rex2 = new Regex(p.getProperty("longDescRex"));
+		inRex.search(doc);
+		rex2.search(doc);
+		res = inRex.stringMatched(1) + "<br>";
+		res += rex2.stringMatched(1); 
+		return SafeXML.cleanback(res);
+	}
+	
+	/**
+	 * Get the cache name
+	 * @param doc A previously fetched cachepage
+	 * @return the name of the cache
+	 */
+	private String getName(String doc){
+		inRex = new Regex(p.getProperty("cacheNameRex"));
+		inRex.search(doc);
+		return inRex.stringMatched(1);
+	}
+	
+	/**
+	 * Get the cache owner
+	 * @param doc A previously fetched cachepage
+	 * @return the cache owner
+	 */
+	private String getOwner(String doc){
+		inRex = new Regex(p.getProperty("cacheOwnerRex"));
+		inRex.search(doc);
+		return inRex.stringMatched(1);
+	}
+	
+	/**
+	 * Get the date when the cache was hidden
+	 * @param doc A previously fetched cachepage
+	 * @return Hidden date
+	 */
+	private String getDateHidden(String doc){
+		inRex = new Regex(p.getProperty("dateHiddenRex"));
+		inRex.search(doc);
+		return inRex.stringMatched(1);
+	}
+	
+	/**
+	 * Get the hints
+	 * @param doc A previously fetched cachepage
+	 * @return Cachehints
+	 */
+	private String getHints(String doc){
+		inRex = new Regex(p.getProperty("hintsRex"));
+		inRex.search(doc);
+		return inRex.stringMatched(1);
+	}
+	
+	/**
+	 * Get the cache size
+	 * @param doc A previously fetched cachepage
+	 * @return Cache size
+	 */
+	private String getSize(String doc){
+		inRex = new Regex(p.getProperty("sizeRex"));
+		inRex.search(doc);
+		if(inRex.didMatch()) return inRex.stringMatched(1);
+		else return "None";
+	}
+	
+	/**
+	 * Get the Difficulty
+	 * @param doc A previously fetched cachepage
+	 * @return The cache difficulty 
+	 */
+	private String getDiff(String doc){
+		inRex = new Regex(p.getProperty("difficultyRex"));
+		inRex.search(doc);
+		if(inRex.didMatch()) return inRex.stringMatched(1);
+		else return "";
+	}
+	
+	/**
+	 * Get the terrain rating
+	 * @param doc A previously fetched cachepage
+	 * @return Terrain rating
+	 */
+	private String getTerr(String doc){
+		inRex = new Regex(p.getProperty("terrainRex"));
+		inRex.search(doc);
+		if(inRex.didMatch()) return inRex.stringMatched(1);
+		else return "";
+	}
+
+	/**
+	 * Get the waypoint type
+	 * @param doc A previously fetched cachepage
+	 * @return the waypoint type (Tradi, Multi, etc.)
+	 */
+	private String getType(String doc){
+		inRex = new Regex(p.getProperty("cacheTypeRex"));
+		inRex.search(doc);
+		if(inRex.didMatch()) return inRex.stringMatched(1);
+		else return "";
+	}
+
+	/**
+	 * Get the logs 
+	 * @param doc A previously fetched cachepage
+	 * @param chD Cache Details
+	 * @return A HTML string containing the logs
+	 */
+	private Vector getLogs(String doc, CacheHolderDetail chD){
+		String icon = "";
+		String name = "";
+		Vector reslts = new Vector();
+		Regex blockRex = new Regex(p.getProperty("blockRex"));
+		blockRex.search(doc);
+		doc = blockRex.stringMatched(1);
+		//Vm.debug("Log Block: " + doc);
+		/*
+		Vm.debug("Setting log regex");
+		inRex = new Regex("<STRONG><IMG SRC='http://www.geocaching.com/images/icons/((?s).*?)'((?s).*?)&nbsp;((?s).*?)<A NAME=\"((?s).*?)'text-decoration: underline;'>((?s).*?)<A HREF=\"((?s).*?)'text-decoration: underline;'>((?s).*?)</A></strong>((?s).*?)\\[<A href=");
+		inRex.optimize();
+		inRex.search(doc);
+		Vm.debug("Log regex run...");
+		while(inRex.didMatch()){
+			Vm.debug("Logs:" + inRex.stringMatched(1) + " / " + inRex.stringMatched(3)+ " / " + inRex.stringMatched(7)+ " / " + inRex.stringMatched(8));
+			//<img src='icon_smile.gif'>&nbsp;
+			reslts.add("<img src='"+ inRex.stringMatched(1) +"'>&nbsp;" + inRex.stringMatched(3)+ inRex.stringMatched(7)+ inRex.stringMatched(8));
+			inRex.searchFrom(doc, inRex.matchedTo());
+		}
+		*/
+		String singleLog = "";
+		Extractor exSingleLog = new Extractor(doc,p.getProperty("singleLogExStart"), p.getProperty("singleLogExEnd"), 0, false); // maybe here is some change neccessary because findnext now gives the whole endstring back??? 
+		singleLog = exSingleLog.findNext();
+		Extractor exIcon = new Extractor(singleLog,p.getProperty("iconExStart"), p.getProperty("iconExEnd"), 0, true);
+		Extractor exNameTemp = new Extractor(singleLog,p.getProperty("nameTempExStart"), p.getProperty("nameTempExEnd"), 0 , true);
+		String nameTemp = "";
+		nameTemp = exNameTemp.findNext();
+		Extractor exName = new Extractor(nameTemp, p.getProperty("nameExStart"), p.getProperty("nameExEnd"), 0 , true);
+		Extractor exDate = new Extractor(singleLog,p.getProperty("dateExStart"), p.getProperty("dateExEnd"), 0 , true);
+		Extractor exLog = new Extractor(singleLog, p.getProperty("logExStart"), p.getProperty("logExEnd"), 0, true);
+		//Vm.debug("Log Block: " + singleLog);
+		int nLogs=0;
+		while(exSingleLog.endOfSearch() == false){
+			nLogs++;
+			if (nLogs>MAXLOGS) {
+				reslts.add("<br\\>More than "+MAXLOGS+" logs.<br\\>");
+				break;
+			}
+			//Vm.debug("--------------------------------------------");
+			//Vm.debug("Log Block: " + singleLog);
+			//Vm.debug("Icon: "+exIcon.findNext());
+			//Vm.debug(exName.findNext());
+			//Vm.debug(exDate.findNext());
+			//Vm.debug(exLog.findNext());
+			//Vm.debug("--------------------------------------------");
+			icon = exIcon.findNext();
+			name = exName.findNext();
+			String d=DateFormat.logdate2YMD(exDate.findNext());
+			if((icon.equals(p.getProperty("icon_smile")) || icon.equals(p.getProperty("icon_camera"))) && 
+				(name.equals(pref.myAlias) || (pref.myAlias2.length()>0 && name.equals(pref.myAlias2))) )  {
+				chD.is_found = true;
+				chD.CacheStatus = d;
+			}
+			reslts.add("<img src='"+ icon +"'>&nbsp;" + d + " " + name + exLog.findNext());
+			
+			singleLog = exSingleLog.findNext();
+			exIcon.setSource(singleLog);
+			exNameTemp.setSource(singleLog);
+			nameTemp = exNameTemp.findNext();
+			exName.setSource(nameTemp);
+			exDate.setSource(singleLog);
+			exLog.setSource(singleLog);
+		}
+		return reslts;
+	}
+	
+	/**
+	 * Read the travelbug names from a previously fetched Cache page and then
+	 * read the travelbug purpose for each travelbug
+	 * @param doc The previously fetched cachepage
+	 * @return A HTML formatted string with bug names and there purpose
+	 */
 	public String getBugs(String doc){	
-		Extractor exBlock = new Extractor(doc, ">&nbsp;Inventory</td>","What is a Travel Bug?",0,Extractor.EXCLUDESTARTEND);
+		Extractor exBlock = new Extractor(doc,p.getProperty("blockExStart"),p.getProperty("blockExEnd") ,0,Extractor.EXCLUDESTARTEND);
 		String bugBlock = exBlock.findNext();
 		//Vm.debug("Bugblock: "+bugBlock);
-		Extractor exBug = new Extractor(bugBlock, "<a href='", "</a></strong></td>",0,Extractor.EXCLUDESTARTEND);
+		Extractor exBug = new Extractor(bugBlock,p.getProperty("bugExStart"),p.getProperty("bugExEnd"),0,Extractor.EXCLUDESTARTEND);
 		String link,bug,linkPlusBug,bugDetails;
 		String result = "";
 		String oldInfoBox=infB.getInfo();
@@ -539,7 +731,7 @@
 					pref.log("Could not fetch bug details");
 					bugDetails="";
 				}
-				Extractor exDetails = new Extractor(bugDetails, "<span id=\"BugDetail_BugGoal\">", "</span>",0,Extractor.EXCLUDESTARTEND);
+				Extractor exDetails = new Extractor(bugDetails,p.getProperty("bugDetailsStart"),p.getProperty("bugDetailsEnd"),0,Extractor.EXCLUDESTARTEND);
 				result+=exDetails.findNext()+"<hr>";
 			}
 			//Vm.debug("B: " + bug);
@@ -549,76 +741,27 @@
 		return result;
 	}
 	
-	public void getAddWaypoints(String doc, String wayPoint, boolean is_found){
-		Extractor exWayBlock = new Extractor(doc, "<strong>Additional Waypoints</strong><br>", "</table>", 0, false);
-		String wayBlock = "";
-		String rowBlock = "";
-		wayBlock = exWayBlock.findNext();
-		Regex nameRex = new Regex("&RefDS=1\">(.*)</a>");
-		Regex koordRex = new Regex("align=\"left\">([NSns] [0-9]{1,2}..[0-9]{1,2}.[0-9]{1,3} [EWew] [0-9]{1,3}..[0-9]{1,2}.[0-9]{1,3})</td>");
-		Regex descRex = new Regex("colspan=\"4\">(.*)</td>");
-		Regex typeRex = new Regex("</a> \\((.*)\\)</td>");
-		int counter = 0;
-		if(exWayBlock.endOfSearch() == false && wayBlock.indexOf("No additional waypoints to display.")<0){
-			Extractor exRowBlock = new Extractor(wayBlock, "<tr", "</tr>", 0, false);
-			rowBlock = exRowBlock.findNext();
-			rowBlock = exRowBlock.findNext();
-			while(exRowBlock.endOfSearch()==false){
-				CacheHolderDetail cx = new CacheHolderDetail();
-				
-				nameRex.search(rowBlock);
-				koordRex.search(rowBlock);
-				typeRex.search(rowBlock);
-				cx.CacheName = nameRex.stringMatched(1);
-				//Vm.debug("Addi: " + cx.CacheName);
-				if(koordRex.didMatch()) cx.pos.set(koordRex.stringMatched(1)); 
-				cx.LatLon = cx.pos.toString(); 
-				//cx.pos.set(cx.LatLon);
-				if(typeRex.didMatch()) cx.type = CacheType.typeText2Number("Waypoint|"+typeRex.stringMatched(1));
-				rowBlock = exRowBlock.findNext();
-				descRex.search(rowBlock);
-				cx.wayPoint = MyLocale.formatLong(counter, "00") + wayPoint.substring(2);
-				counter++;
-				cx.LongDescription = descRex.stringMatched(1); 
-				//Vm.debug(descRex.stringMatched(1));
-				int idx=profile.getCacheIndex(cx.wayPoint);
-				cx.is_found = is_found;
-				//Vm.debug("IDX: " + idx);
-				if (idx<0){
-					if(profile.byPassIndexActive) {
-						profile.writeIndexLine(cx);
-						//Vm.debug("Using index bypass");
-					}
-					else {
-						cacheDB.add(cx);
-						//Vm.debug("Adding to cachedb");
-					}
-				}else if (((CacheHolder) cacheDB.get(idx)).is_Checked && // Only re-spider existing addi waypoints that are ticked
-						!((CacheHolder) cacheDB.get(idx)).is_filtered) // and are visible (i.e.  not filtered)
-					cacheDB.set(idx,new CacheHolder(
-					    new CacheHolderDetail(((CacheHolder) cacheDB.get(idx))).update(cx)));
-				cx.saveCacheDetails(profile.dataDir);
-				rowBlock = exRowBlock.findNext();
-			}
-		}
-	}
-	
-	public void getImages(String doc, CacheHolderDetail ch){
+	/**
+	 * Get the images for a previously fetched cache page. Images are extracted 
+	 * from two areas: The long description and the pictures section (including
+	 * the spoiler)
+	 * @param doc The previously fetched cachepage
+	 * @param chD The Cachedetails
+	 */
+	public void getImages(String doc, CacheHolderDetail chD){
 		int imgCounter = 0;
 		String imgName;
 		String imgType;
 		String imgUrl;
+		//========
 		//In the long description
+		//========
 		String longDesc = "";
 		longDesc = getLongDesc(doc);
 		longDesc = STRreplace.replace(longDesc, "img", "IMG");
 		longDesc = STRreplace.replace(longDesc, "src", "SRC");
 		longDesc = STRreplace.replace(longDesc, "'", "\"");
-		//longDesc = STRreplace.replace(longDesc, "SRC =", "SRC=");
-		//longDesc = STRreplace.replace(longDesc, "SRC= \"", "SRC=\"");
-		//longDesc = STRreplace.replace(longDesc, "\n", " ");
-		//longDesc = STRreplace.replace(longDesc, " ", "");
-		Extractor exImgBlock = new Extractor(longDesc, "<IMG", ">", 0, false);
+		Extractor exImgBlock = new Extractor(longDesc,p.getProperty("imgBlockExStart"),p.getProperty("imgBlockExEnd"), 0, false);
 		//Vm.debug("In getImages: Have longDesc" + longDesc);
 		String tst;
 		tst = exImgBlock.findNext();
@@ -632,12 +775,12 @@
 				try{
 					imgType = imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase();
 					if(!imgType.startsWith("com") && !imgType.startsWith("php") && !imgType.startsWith("exe")){
-						imgName = ch.wayPoint + "_" + Convert.toString(imgCounter);
+						imgName = chD.wayPoint + "_" + Convert.toString(imgCounter);
 						pref.log("Loading image: " + imgUrl);
 						spiderImage(imgUrl, imgName+imgType);
 						imgCounter++;
-						ch.Images.add(imgName+imgType);
-						ch.ImagesText.add(imgName);
+						chD.Images.add(imgName+imgType);
+						chD.ImagesText.add(imgName);
 					}
 				} catch (IndexOutOfBoundsException e) { 
 					//Vm.debug("IndexOutOfBoundsException not in image span"+e.toString()+"imgURL:"+imgUrl);
@@ -646,13 +789,13 @@
 				}
 			exImgSrc.setSource(exImgBlock.findNext());
 		}
-
+		//========
 		//In the image span
-
-		Extractor spanBlock = new Extractor(doc, "<span id=\"Images\"", "</span>", 0 , true);
+		//========
+		Extractor spanBlock = new Extractor(doc,p.getProperty("imgSpanExStart"),p.getProperty("imgSpanExEnd"), 0 , true);
 		tst = spanBlock.findNext();
-		Extractor exImgName = new Extractor(tst, "align=absmiddle border=0>", "</a><br/>", 0 , true);
-		exImgSrc = new Extractor(tst, "<A HREF='http://", "' rel='lightbox'", 0, true);
+		Extractor exImgName = new Extractor(tst,p.getProperty("imgNameExStart"),p.getProperty("imgNameExEnd"), 0 , true);
+		exImgSrc = new Extractor(tst,p.getProperty("imgSrcExStart"),p.getProperty("imgSrcExEnd"), 0, true);
 		while(exImgSrc.endOfSearch() == false){
 			imgUrl = exImgSrc.findNext();
 			//Vm.debug("Img Url: " +imgUrl);
@@ -661,11 +804,11 @@
 				try{
 					imgType = imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase();
 					if(!imgType.startsWith("com") && !imgType.startsWith("php") && !imgType.startsWith("exe")){
-						imgName = ch.wayPoint + "_" + Convert.toString(imgCounter);
+						imgName = chD.wayPoint + "_" + Convert.toString(imgCounter);
 						spiderImage(imgUrl, imgName+imgType);
 						imgCounter++;
-						ch.Images.add(imgName+imgType);
-						ch.ImagesText.add(exImgName.findNext());
+						chD.Images.add(imgName+imgType);
+						chD.ImagesText.add(exImgName.findNext());
 					}
 				} catch (IndexOutOfBoundsException e) { 
 					pref.log("IndexOutOfBoundsException in image span. imgURL:"+imgUrl,e); 
@@ -674,7 +817,12 @@
 		}
 	}
 	
-	private void spiderImage(String quelle, String target){
+	/**
+	 * Read an image from the server
+	 * @param imgUrl The Url of the image
+	 * @param target The bytes of the image
+	 */
+	private void spiderImage(String imgUrl, String target){
 		HttpConnection connImg;
 		Socket sockImg;
 		//InputStream is;
@@ -685,13 +833,13 @@
 		String datei = "";
 		datei = profile.dataDir + target;
 		if(pref.myproxy.length()>0){
-			connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), quelle);
+			connImg = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), imgUrl);
 		}else{
-			connImg = new HttpConnection(quelle);
+			connImg = new HttpConnection(imgUrl);
 		}
 		connImg.setRequestorProperty("Connection", "close");
 		try{
-			pref.log("Trying to fetch image from: " + quelle);
+			pref.log("Trying to fetch image from: " + imgUrl);
 			sockImg = connImg.connect();
 			daten = connImg.readData(connImg.connect());
 			fos = new FileOutputStream(new File(datei));
@@ -700,187 +848,69 @@
 			sockImg.close();
 		} catch (UnknownHostException e) {
 			pref.log("Host not there...");
-			//Vm.debug("Host not there...");
 		}catch(IOException ioex){
 			pref.log("File not found!");
-			//Vm.debug("File not found!");
 		} catch (Exception ex){
-			pref.log("Some other problem while fetching image");
-			//Vm.debug("Some kind of problem!");
+			pref.log("Some other problem while fetching image",ex);
 		} finally {
 			//Continue with the spider
 		}
 	}		
-	
-	private String getType(String doc){
-		inRex = new Regex("<img src=\"../images/WptTypes/(.*?)\\.gif");
-		inRex.search(doc);
-		if(inRex.didMatch()) return inRex.stringMatched(1);
-		else return "";
-	}
-	
-	private String getDiff(String doc){
-		inRex = new Regex("<span id=\"Difficulty\">.*?alt=\"(.*?) out of");
-		inRex.search(doc);
-		if(inRex.didMatch()) return inRex.stringMatched(1);
-		else return "";
-	}
-	
-	private String getTerr(String doc){
-		inRex = new Regex("<span id=\"Terrain\">.*?alt=\"(.*?) out of");
-		inRex.search(doc);
-		if(inRex.didMatch()) return inRex.stringMatched(1);
-		else return "";
-	}
-	
-	private String getSize(String doc){
-		inRex = new Regex("This is a <strong>((?s).*?)</strong> cache");
-		inRex.search(doc);
-		if(inRex.didMatch()) return inRex.stringMatched(1);
-		else return "None";
-	}
-	
-	private String getHints(String doc){
-		inRex = new Regex("<span id=\"Hints\" class=\"displayMe\">((?s).*?)</span>");
-		inRex.search(doc);
-		return inRex.stringMatched(1);
-	}
-	
-	private String getDateHidden(String doc){
-		inRex = new Regex("<span id=\"DateHidden\">((?s).*?)</span>");
-		inRex.search(doc);
-		return inRex.stringMatched(1);
-	}
-	
-	private String getLatLon(String doc){
-		inRex = new Regex("<span id=\"LatLon\"><.*?>((?s).*?)</STRONG>");
-		inRex.search(doc);
-		
-		//Vm.debug("LatLon: " + inRex.stringMatched(1));
-		
-		return inRex.stringMatched(1);
-	}
-	
-	private String getOwner(String doc){
-		inRex = new Regex("<span id=\"CacheOwner\".*?by ((?s).*?)\\[<A HREF=");
-		inRex.search(doc);
-		return inRex.stringMatched(1);
-	}
-	
-	private String getName(String doc){
-		inRex = new Regex("<span id=\"CacheName\">((?s).*?)</span>");
-		inRex.search(doc);
-		return inRex.stringMatched(1);
-	}
-	
-	private String getLongDesc(String doc){
-		String res = "";
-		inRex = new Regex("<span id=\"ShortDescription\">((?s).*?)</span>");
-		Regex rex2 = new Regex("<span id=\"LongDescription\">((?s).*?)<strong>Additional Hints");
-		inRex.search(doc);
-		rex2.search(doc);
-		res = inRex.stringMatched(1) + "<br>";
-		res += rex2.stringMatched(1); 
-		return SafeXML.cleanback(res);
-	}
-	
-	private String getListBlock(String doc){
-		inRex = new Regex("<table id=\"dlResults\"((?s).*?)</table>");
-		inRex.search(doc);
-		return inRex.stringMatched(1);
-	}
-	
-	private String getWP(String doc){
-		inRex = new Regex("</a> \\((.*?)\\)<br>");
-		inRex.search(doc);
-		return inRex.stringMatched(1);
-	}
-	private double getDist(String doc){
-		inRex = new Regex("<br />(.*?)(km|mi)</td>");
-		inRex.search(doc);
-		if(doc.indexOf("Here") > 0) return(0);
-		if(pref.digSeparator.equals(",")) return Convert.toDouble(inRex.stringMatched(1).replace('.',','));
-		return Convert.toDouble(inRex.stringMatched(1));
-	}
-	
-	private Vector getLogs(String doc, CacheHolderDetail ch){
-		String icon = "";
-		String name = "";
-		Vector reslts = new Vector();
-		Regex block = new Regex("<span id=\"CacheLogs\">((?s).*?)</span>");
-		block.search(doc);
-		doc = block.stringMatched(1);
-		//Vm.debug("Log Block: " + doc);
-		/*
-		Vm.debug("Setting log regex");
-		inRex = new Regex("<STRONG><IMG SRC='http://www.geocaching.com/images/icons/((?s).*?)'((?s).*?)&nbsp;((?s).*?)<A NAME=\"((?s).*?)'text-decoration: underline;'>((?s).*?)<A HREF=\"((?s).*?)'text-decoration: underline;'>((?s).*?)</A></strong>((?s).*?)\\[<A href=");
-		inRex.optimize();
-		inRex.search(doc);
-		Vm.debug("Log regex run...");
-		while(inRex.didMatch()){
-			Vm.debug("Logs:" + inRex.stringMatched(1) + " / " + inRex.stringMatched(3)+ " / " + inRex.stringMatched(7)+ " / " + inRex.stringMatched(8));
-			//<img src='icon_smile.gif'>&nbsp;
-			reslts.add("<img src='"+ inRex.stringMatched(1) +"'>&nbsp;" + inRex.stringMatched(3)+ inRex.stringMatched(7)+ inRex.stringMatched(8));
-			inRex.searchFrom(doc, inRex.matchedTo());
-		}
-		*/
-		String singleLog = "";
-		Extractor exSingleLog = new Extractor(doc, "<STRONG>", "[<A href=", 0, false); // maybe here is some change neccessary because findnext now gives the whole endstring back??? 
-		singleLog = exSingleLog.findNext();
-		Extractor exIcon = new Extractor(singleLog, "http://www.geocaching.com/images/icons/", "' align='abs", 0, true);
-		Extractor exNameTemp = new Extractor(singleLog, "<A HREF=\"", "/A>", 0 , true);
-		String nameTemp = "";
-		nameTemp = exNameTemp.findNext();
-		Extractor exName = new Extractor(nameTemp, ">", "<", 0 , true);
-		Extractor exDate = new Extractor(singleLog, "align='absmiddle'>&nbsp;", " by <", 0 , true);
-		Extractor exLog = new Extractor(singleLog, "found)", "<br>[", 0, true);
-		//Vm.debug("Log Block: " + singleLog);
-		while(exSingleLog.endOfSearch() == false){
-			//Vm.debug("--------------------------------------------");
-			//Vm.debug("Log Block: " + singleLog);
-			//Vm.debug("Icon: "+exIcon.findNext());
-			//Vm.debug(exName.findNext());
-			//Vm.debug(exDate.findNext());
-			//Vm.debug(exLog.findNext());
-			//Vm.debug("--------------------------------------------");
-			icon = exIcon.findNext();
-			name = exName.findNext();
-			String d=DateFormat.logdate2YMD(exDate.findNext());
-			if((icon.equals("icon_smile.gif") || icon.equals("icon_camera.gif")) && 
-				(name.equals(pref.myAlias) || (pref.myAlias2.length()>0 && name.equals(pref.myAlias2))) )  {
-				ch.is_found = true;
-				ch.CacheStatus = d;
+
+	/**
+	 * Read all additional waypoints from a previously fetched cachepage.
+	 * @param doc The previously fetched cachepage
+	 * @param wayPoint The name of the cache
+	 * @param is_found Found status of the cached (is inherited by the additional waypoints)
+	 */
+	public void getAddWaypoints(String doc, String wayPoint, boolean is_found){
+		Extractor exWayBlock = new Extractor(doc,p.getProperty("wayBlockExStart"),p.getProperty("wayBlockExEnd"), 0, false);
+		String wayBlock = "";
+		String rowBlock = "";
+		wayBlock = exWayBlock.findNext();
+		Regex nameRex = new Regex(p.getProperty("nameRex"));
+		Regex koordRex = new Regex(p.getProperty("koordRex"));
+		Regex descRex = new Regex(p.getProperty("descRex"));
+		Regex typeRex = new Regex(p.getProperty("typeRex"));
+		int counter = 0;
+		if(exWayBlock.endOfSearch() == false && wayBlock.indexOf("No additional waypoints to display.")<0){
+			Extractor exRowBlock = new Extractor(wayBlock,p.getProperty("rowBlockExStart"),p.getProperty("rowBlockExEnd"), 0, false);
+			rowBlock = exRowBlock.findNext();
+			rowBlock = exRowBlock.findNext();
+			while(exRowBlock.endOfSearch()==false){
+				CacheHolderDetail cx = new CacheHolderDetail();
+				
+				nameRex.search(rowBlock);
+				koordRex.search(rowBlock);
+				typeRex.search(rowBlock);
+				cx.CacheName = nameRex.stringMatched(1);
+				//Vm.debug("Addi: " + cx.CacheName);
+				if(koordRex.didMatch()) cx.pos.set(koordRex.stringMatched(1)); 
+				cx.LatLon = cx.pos.toString(); 
+				//cx.pos.set(cx.LatLon);
+				if(typeRex.didMatch()) cx.type = CacheType.typeText2Number("Waypoint|"+typeRex.stringMatched(1));
+				rowBlock = exRowBlock.findNext();
+				descRex.search(rowBlock);
+				cx.wayPoint = MyLocale.formatLong(counter, "00") + wayPoint.substring(2);
+				counter++;
+				cx.LongDescription = descRex.stringMatched(1); 
+				//Vm.debug(descRex.stringMatched(1));
+				int idx=profile.getCacheIndex(cx.wayPoint);
+				cx.is_found = is_found;
+				//Vm.debug("IDX: " + idx);
+				if (idx<0){
+					cacheDB.add(new CacheHolder(cx));
+				}else if (((CacheHolder) cacheDB.get(idx)).is_Checked && // Only re-spider existing addi waypoints that are ticked
+						!((CacheHolder) cacheDB.get(idx)).is_filtered) // and are visible (i.e.  not filtered)
+					cacheDB.set(idx,new CacheHolder(
+					    new CacheHolderDetail(((CacheHolder) cacheDB.get(idx))).update(cx)));
+				cx.saveCacheDetails(profile.dataDir);
+				rowBlock = exRowBlock.findNext();
 			}
-			reslts.add("<img src='"+ icon +"'>&nbsp;" + d + " " + name + exLog.findNext());
-			
-			singleLog = exSingleLog.findNext();
-			exIcon.setSource(singleLog);
-			exNameTemp.setSource(singleLog);
-			nameTemp = exNameTemp.findNext();
-			exName.setSource(nameTemp);
-			exDate.setSource(singleLog);
-			exLog.setSource(singleLog);
 		}
-		return reslts;
 	}
 	
-	public SpiderGC(Preferences prf, Profile profile, boolean bypass){
-		this.profile=profile;
-		this.cacheDB = profile.cacheDB;
-		pref = prf;
-		indexDB = new Hashtable(cacheDB.size());
-		CacheHolder ch;
-		if(bypass) profile.openIndex(pref);
-		//index the database for faster searching!
-		for(int i = 0; i<cacheDB.size();i++){
-			ch = (CacheHolder)cacheDB.get(i);
-			indexDB.put((String)ch.wayPoint, new Integer(i));
-			ch.is_new = false;
-			//cacheDB.set(i, ch);
-			profile.writeIndexLine(ch);
-		}
-	}
-	
+
 	/**
 	*	Performs an initial fetch to a given address. In this case
 	*	it will be a gc.com address. This method is used to obtain

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-05-27 23:43:02 UTC (rev 710)
+++ trunk/src/CacheWolf/myTableControl.java	2007-05-27 23:48:40 UTC (rev 711)
@@ -145,7 +145,6 @@
 				}
 				infB.close(0);
 				profile.hasUnsavedChanges=true;	
-				profile.closeIndex();
 				profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 //				cacheDB.clear();
 //				profile.readIndex();



From salzkammergut at mail.berlios.de  Tue May 29 01:17:42 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 29 May 2007 01:17:42 +0200
Subject: [Cachewolf-svn] r712 - trunk/src/CacheWolf
Message-ID: <200705282317.l4SNHgVw027852@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-29 01:17:34 +0200 (Tue, 29 May 2007)
New Revision: 712

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Nach snaky's Mitteilung auf geoclub am 28.5.07 kleinere Aenderungen:
- Bei Umwandlung von Text in Zahl wird zuvor Komma zu Punkt gemacht
- replace erlaubt leere Zeichenfolge als Ersatzzeichenfolge
- Ueberarbeitung der val Funktion

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2007-05-27 23:48:40 UTC (rev 711)
+++ trunk/src/CacheWolf/Parser.java	2007-05-28 23:17:34 UTC (rev 712)
@@ -231,8 +231,11 @@
 	
 	private double toNumber(String str) {
 		try {
-			if (Global.getPref().digSeparator.equals(","))	str = str.replace('.', ',');
-			 return java.lang.Double.parseDouble(str);
+			if (Global.getPref().digSeparator.equals(","))	
+				str = str.replace('.', ',');
+			else
+				str = str.replace(',','.');
+			return java.lang.Double.parseDouble(str);
 		} catch (NumberFormatException e) {
 			 return java.lang.Double.NaN;
 		}
@@ -376,19 +379,22 @@
     private double funcCrossTotal(int nargs) throws Exception {
     	int cycles=1;
 		if (nargs==2) cycles=(int)popCalcStackAsNumber(1);
-		double a=java.lang.Math.abs(popCalcStackAsNumber(0));
+		String aString=popCalcStackAsString().replace('-','0').trim();
+		double a=0;
 		if (cycles<0) cycles=1;
     	if (cycles>5) cycles=5;
-    	while (a>=10 && cycles-->0) {
+    	while (cycles-->0) {
 	    	// Cross total = Quersumme berechnen
-			String aString = Convert.toString(a); // 
-			// bei 1.8e2 nur 1.8 verwenden 
-			if (aString.toLowerCase().indexOf("e") > 0) aString = aString.substring(0, aString.toLowerCase().indexOf("e"));
 			a=0;
 			for (int i=0; i<aString.length(); i++) {
-			 a += Convert.toDouble(Convert.toString(aString.charAt(i)));	
+			   if (aString.charAt(i)>='0' && aString.charAt(i)<='9')
+			      a += aString.charAt(i)-'0';
+			   else
+				  break; // break at first non numeric character 
 			}
-    	}return a;
+			aString=Convert.toString(a);
+    	} 
+    	return a;
     }
     
     /** Calculate distance between 2 points */
@@ -548,7 +554,7 @@
     	String replaceWith=popCalcStackAsString();
     	String whatToReplace=popCalcStackAsString();
     	String s=popCalcStackAsString();
-        if (whatToReplace.equals("") || replaceWith.equals("")) return s;
+        if (whatToReplace.equals("")) return s;
         return STRreplace.replace(s,whatToReplace,replaceWith);
     }
     



From salzkammergut at mail.berlios.de  Tue May 29 01:21:54 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 29 May 2007 01:21:54 +0200
Subject: [Cachewolf-svn] r713 - trunk/src/CacheWolf
Message-ID: <200705282321.l4SNLs0t005306@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-29 01:21:46 +0200 (Tue, 29 May 2007)
New Revision: 713

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
myTableModel: Wenn viele Caches auf einmal geloescht wurden konnte es zu 'IndexOutOfRange' Exceptions kommen

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2007-05-28 23:17:34 UTC (rev 712)
+++ trunk/src/CacheWolf/myTableModel.java	2007-05-28 23:21:46 UTC (rev 713)
@@ -170,17 +170,19 @@
 		ta.alignment = ta.LEFT;
 		ta.anchor = ta.LEFT;
 		if(row >= 0){ 
-			CacheHolder ch = (CacheHolder)cacheDB.get(row);
-			if(isSelected == true) ta.fillColor = COLOR_SELECTED;
-			else if(ch.is_available == false && ch.is_found == true){
-				ta.fillColor = COLOR_ARCHFND_BG;   // Green BG
-				ta.foreground = COLOR_ARCHFND_FG;  // Red FG
-			}
-			else if(ch.is_archived == true) ta.fillColor = COLOR_ARCHIVED;
-			else if(ch.is_available == false) ta.fillColor = COLOR_AVAILABLE;
-			else if(ch.is_owned == true) ta.fillColor = COLOR_OWNED;
-			else if(ch.is_found == true) ta.fillColor = COLOR_FOUND;
-			else if(ch.is_flaged == true) ta.fillColor = COLOR_FLAGED;
+			try {
+			   CacheHolder ch = (CacheHolder)cacheDB.get(row);
+				if(isSelected == true) ta.fillColor = COLOR_SELECTED;
+				else if(ch.is_available == false && ch.is_found == true){
+					ta.fillColor = COLOR_ARCHFND_BG;   // Green BG
+					ta.foreground = COLOR_ARCHFND_FG;  // Red FG
+				}
+				else if(ch.is_archived == true) ta.fillColor = COLOR_ARCHIVED;
+				else if(ch.is_available == false) ta.fillColor = COLOR_AVAILABLE;
+				else if(ch.is_owned == true) ta.fillColor = COLOR_OWNED;
+				else if(ch.is_found == true) ta.fillColor = COLOR_FOUND;
+				else if(ch.is_flaged == true) ta.fillColor = COLOR_FLAGED;
+			} catch (Exception e) {};
 		}
 		return ta;
 	}
@@ -211,56 +213,58 @@
 		if(row == -1) {
 			return (String)colName[col];
 		} else {
-			CacheHolder ch = (CacheHolder)cacheDB.get(row);
-			if(ch.is_filtered == false){
-				switch(colID[col]) { // Faster than using column names
-					case 0: // Checkbox
-						if (ch.is_Checked) 
-							return checkboxTicked; 
-						else 
-							return checkboxUnticked;
-					case 1: // Type
-						try {
-							return (IImage) cacheImages[Convert.parseInt(ch.type)]; // TODO save in cacheholder as int
-						} catch (NumberFormatException e) { return "?";}
-					case 2: // Difficulty;
-						return (String)ch.hard;
-					case 3: // Terrain
-						return (String)ch.terrain;
-					case 4: // Waypoint
-						if(ch.is_incomplete) return new IconAndText((IImage)skull, ch.wayPoint, fm);
-						if(ch.is_update    ) return new IconAndText((IImage)red, ch.wayPoint, fm); // TODO this is for sure quite inefficient, better store it, don't create always new when the table is refreshed or only scrolled
-						if(ch.is_new       ) return new IconAndText((IImage)yellow, ch.wayPoint, fm);
-						if(ch.is_log_update) return new IconAndText((IImage)blue, ch.wayPoint, fm);
-						return (String)ch.wayPoint;
-					case 5: // Cachename
-						// Fast return for majority of case
-						if (ch.has_bug == false && ch.noFindLogs==0) return (String)ch.CacheName; 
-						// Now need more checks
-						IconAndText wpVal = new IconAndText();
-						if(ch.has_bug == true) wpVal.addColumn((IImage)bug);
-						if(ch.noFindLogs > 0){
-							if (ch.noFindLogs > noFindLogs.length) 
-								wpVal.addColumn((IImage)noFindLogs[noFindLogs.length-1]);
+			try { // Access to row can fail if many caches are deleted
+				CacheHolder ch = (CacheHolder)cacheDB.get(row);
+				if(ch.is_filtered == false){
+					switch(colID[col]) { // Faster than using column names
+						case 0: // Checkbox
+							if (ch.is_Checked) 
+								return checkboxTicked; 
 							else 
-								wpVal.addColumn((IImage)noFindLogs[ch.noFindLogs-1]);
-						}
-						wpVal.addColumn((String)ch.CacheName);
-						return wpVal;
-					case 6: // Location
-						return (String)ch.LatLon;
-					case 7: // Owner
-						return (String)ch.CacheOwner;
-					case 8: // Date hidden
-						return (String)ch.DateHidden;
-					case 9: // Status
-						return (String)ch.CacheStatus;
-					case 10: // Distance
-						return (String)ch.distance;
-					case 11: // Bearing
-						return (String)ch.bearing;
-				}
-			}
+								return checkboxUnticked;
+						case 1: // Type
+							try {
+								return (IImage) cacheImages[Convert.parseInt(ch.type)]; // TODO save in cacheholder as int
+							} catch (NumberFormatException e) { return "?";}
+						case 2: // Difficulty;
+							return (String)ch.hard;
+						case 3: // Terrain
+							return (String)ch.terrain;
+						case 4: // Waypoint
+							if(ch.is_incomplete) return new IconAndText((IImage)skull, ch.wayPoint, fm);
+							if(ch.is_update    ) return new IconAndText((IImage)red, ch.wayPoint, fm); // TODO this is for sure quite inefficient, better store it, don't create always new when the table is refreshed or only scrolled
+							if(ch.is_new       ) return new IconAndText((IImage)yellow, ch.wayPoint, fm);
+							if(ch.is_log_update) return new IconAndText((IImage)blue, ch.wayPoint, fm);
+							return (String)ch.wayPoint;
+						case 5: // Cachename
+							// Fast return for majority of case
+							if (ch.has_bug == false && ch.noFindLogs==0) return (String)ch.CacheName; 
+							// Now need more checks
+							IconAndText wpVal = new IconAndText();
+							if(ch.has_bug == true) wpVal.addColumn((IImage)bug);
+							if(ch.noFindLogs > 0){
+								if (ch.noFindLogs > noFindLogs.length) 
+									wpVal.addColumn((IImage)noFindLogs[noFindLogs.length-1]);
+								else 
+									wpVal.addColumn((IImage)noFindLogs[ch.noFindLogs-1]);
+							}
+							wpVal.addColumn((String)ch.CacheName);
+							return wpVal;
+						case 6: // Location
+							return (String)ch.LatLon;
+						case 7: // Owner
+							return (String)ch.CacheOwner;
+						case 8: // Date hidden
+							return (String)ch.DateHidden;
+						case 9: // Status
+							return (String)ch.CacheStatus;
+						case 10: // Distance
+							return (String)ch.distance;
+						case 11: // Bearing
+							return (String)ch.bearing;
+					} // Switch
+				} // if
+			} catch (Exception e) { return null; }
 		}
 		return null;
 	}



From salzkammergut at mail.berlios.de  Tue May 29 02:06:32 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 29 May 2007 02:06:32 +0200
Subject: [Cachewolf-svn] r714 - trunk/src/CacheWolf
Message-ID: <200705290006.l4T06WqW010781@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-29 02:06:29 +0200 (Tue, 29 May 2007)
New Revision: 714

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
myTableControl: Beim Loeschen von Caches Wartsymbol anzeigen (kann bei vielen Caches lange dauern)

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-05-28 23:21:46 UTC (rev 713)
+++ trunk/src/CacheWolf/myTableControl.java	2007-05-29 00:06:29 UTC (rev 714)
@@ -95,6 +95,7 @@
 		if (selectedItem.toString().equals(MyLocale.getMsg(1012,"Delete"))){
 			if ((new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1022, "Delete all caches that have a tick?"), MessageBox.YESB | MessageBox.NOB)).execute() != Form.IDYES) return;
 			DataMover dm=new DataMover();
+			Vm.showWait(true);
 			for(int i = cacheDB.size()-1; i >=0; i--){
 				ch = (CacheHolder)cacheDB.get(i);
 				if(ch.is_Checked == true) {
@@ -102,6 +103,7 @@
 					cacheDB.remove(ch);
 				}
 			}
+			Vm.showWait(false);
 			profile.saveIndex(pref,true);	
 			tbp.refreshTable();
 		}



From salzkammergut at mail.berlios.de  Tue May 29 02:08:54 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 29 May 2007 02:08:54 +0200
Subject: [Cachewolf-svn] r715 - trunk/src/CacheWolf
Message-ID: <200705290008.l4T08svG011098@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-29 02:08:52 +0200 (Tue, 29 May 2007)
New Revision: 715

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
spiderGC: Wenn ein Cache das gleiche Bild mehrfach verlinkt, wird es nur mehr einmal heruntergeladen um Platz zu sparen.
Vorsicht beim Loeschen (Rechtklick im ImageViewer).

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-05-29 00:06:29 UTC (rev 714)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-05-29 00:08:52 UTC (rev 715)
@@ -750,9 +750,9 @@
 	 */
 	public void getImages(String doc, CacheHolderDetail chD){
 		int imgCounter = 0;
-		String imgName;
-		String imgType;
-		String imgUrl;
+		String imgName, oldImgName, imgType, imgUrl;
+		Vector spideredUrls=new Vector(15);
+		int idxUrl; // Index of already spidered Url in list of spideredUrls
 		//========
 		//In the long description
 		//========
@@ -773,14 +773,24 @@
 			if(imgUrl.length()>0){
 				imgUrl = "http://" + imgUrl;
 				try{
-					imgType = imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase();
-					if(!imgType.startsWith("com") && !imgType.startsWith("php") && !imgType.startsWith("exe")){
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
+					// imgType is now max 4 chars, starting with .
+					if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
+						// Check whether image was already spidered for this cache
+						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.wayPoint + "_" + Convert.toString(imgCounter);
-						pref.log("Loading image: " + imgUrl);
-						spiderImage(imgUrl, imgName+imgType);
+						if (idxUrl<0) { // New image
+							pref.log("Loading image: " + imgUrl);
+							spiderImage(imgUrl, imgName+imgType);
+							chD.Images.add(imgName+imgType);
+							spideredUrls.add(imgUrl);
+						} else { // Image already spidered as wayPoint_'idxUrl'
+							pref.log("Already loaded image: " + imgUrl);
+							oldImgName = chD.wayPoint + "_" + Convert.toString(idxUrl);
+							chD.Images.add(oldImgName+imgType); // Store name of old image as image to load
+						}
+						chD.ImagesText.add(imgName); // Keep the image name
 						imgCounter++;
-						chD.Images.add(imgName+imgType);
-						chD.ImagesText.add(imgName);
 					}
 				} catch (IndexOutOfBoundsException e) { 
 					//Vm.debug("IndexOutOfBoundsException not in image span"+e.toString()+"imgURL:"+imgUrl);
@@ -802,13 +812,24 @@
 			if(imgUrl.length()>0){
 				imgUrl = "http://" + imgUrl;
 				try{
-					imgType = imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase();
-					if(!imgType.startsWith("com") && !imgType.startsWith("php") && !imgType.startsWith("exe")){
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
+					// imgType is now max 4 chars, starting with .
+					if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
+						// Check whether image was already spidered for this cache
+						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.wayPoint + "_" + Convert.toString(imgCounter);
-						spiderImage(imgUrl, imgName+imgType);
+						if (idxUrl<0) { // New image
+							pref.log("Loading image: " + imgUrl);
+							spiderImage(imgUrl, imgName+imgType);
+							chD.Images.add(imgName+imgType);
+						} else { // Image already spidered as wayPoint_ 'idxUrl'
+							pref.log("Already loaded image: " + imgUrl);
+							oldImgName = chD.wayPoint + "_" + Convert.toString(idxUrl);
+							chD.Images.add(oldImgName+imgType); // Store name of old image as image to load
+						}
+						chD.ImagesText.add(exImgName.findNext()); // Keep the image description
+						chD.ImagesText.add(imgName); 
 						imgCounter++;
-						chD.Images.add(imgName+imgType);
-						chD.ImagesText.add(exImgName.findNext());
 					}
 				} catch (IndexOutOfBoundsException e) { 
 					pref.log("IndexOutOfBoundsException in image span. imgURL:"+imgUrl,e); 



From salzkammergut at mail.berlios.de  Tue May 29 02:11:05 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 29 May 2007 02:11:05 +0200
Subject: [Cachewolf-svn] r716 - trunk/src/CacheWolf
Message-ID: <200705290011.l4T0B58P011341@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-29 02:11:02 +0200 (Tue, 29 May 2007)
New Revision: 716

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
mainTab: Zweiter Teil Bugfix fuer automatische, korrekte Darstellung der Blacklist

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-05-29 00:08:52 UTC (rev 715)
+++ trunk/src/CacheWolf/MainTab.java	2007-05-29 00:11:02 UTC (rev 716)
@@ -166,6 +166,22 @@
 			} else statBar.updateDisplay();
 			// If no cache is selected, create a new one
 			switch (this.getSelectedItem()) {
+			case 0:
+				if (detP.hasBlackStatusChanged()) {
+					// Restore the filter status (this automatically sets the status for blacklisted caches)
+					//TODO This is not very elegant (see also SearchCache)
+					Filter flt=new Filter();
+					if (Filter.filterActive) {
+						flt.setFilter();
+						flt.doFilter();
+					} else {
+						flt.clearFilter();
+					}
+					if (Filter.filterInverted) 
+						flt.invertFilter();
+					tbP.refreshTable();
+				}
+				break;
 			case 1:  // DetailsPanel
 				if (chD==null) { // Empty DB - show a dummy detail
 					newWaypoint(chD=new CacheHolderDetail()); 



From salzkammergut at mail.berlios.de  Tue May 29 04:20:15 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 29 May 2007 04:20:15 +0200
Subject: [Cachewolf-svn] r717 - trunk/src/CacheWolf
Message-ID: <200705290220.l4T2KFPF020695@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-29 04:20:07 +0200 (Tue, 29 May 2007)
New Revision: 717

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
DetailsPanel: Nachtrag zum Blacklist fix

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-05-29 00:11:02 UTC (rev 716)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-05-29 02:20:07 UTC (rev 717)
@@ -31,6 +31,8 @@
 	private boolean dirty_notes = false;
 	private boolean dirty_details = false;
 	private boolean blackStatus = false;
+	private boolean blackStatusChanged=false;
+	
 	Preferences pref; // Test
 	Profile profile;
 	mImage imgBlack;
@@ -124,6 +126,9 @@
 	public boolean isDirty() {
 		return dirty_notes || dirty_details;
 	}
+	public boolean hasBlackStatusChanged() {
+		return blackStatusChanged;
+	}
 	
 	
 	/**
@@ -152,6 +157,7 @@
 			btnBlack.image = imgBlackNo;
 		}
 		blackStatus=ch.is_black; 
+		blackStatusChanged=false;
 		btnBlack.repaintNow();
 		if(ch.has_bug == true) {
 			btnShowBug.modify(Control.Disabled,1);
@@ -307,6 +313,7 @@
 				thisCache.setAttributesToAddiWpts();
 				btnBlack.repaintNow();
 				dirty_details=true;
+				blackStatusChanged=true;
 			}
 			else if (ev.target == btnNewWpt){
 				Global.mainTab.newWaypoint(new CacheHolder());
@@ -369,7 +376,7 @@
 		// the CacheHolder object which sits in cacheDB
 		  // Strip the found message if the status contains a date
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318,"Found")) && 
-				  chcStatus.getText().length()==MyLocale.getMsg(318,"Found").length()+11)
+				  chcStatus.getText().length()>=MyLocale.getMsg(318,"Found").length()+11)
 			  thisCache.CacheStatus = chcStatus.getText().substring(MyLocale.getMsg(318,"Found").length()+1);
 		  else	  
 			  thisCache.CacheStatus = chcStatus.getText();



From admin at berlios.de  Wed May 30 20:50:55 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 30 May 2007 20:50:55 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3450] Beschreibung in .asc wie in .ov2
Message-ID: <200705301850.l4UIotPL001419@unicorn.berlios.de>

Feature Request #3450, was updated on 2007-May-30 20:50
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3450&group_id=2211

Category: 1.0
Status: Open
Priority: 5
Summary: Beschreibung in .asc wie in .ov2

By: kalli
Date: 2007-May-30 20:50

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

Der Name in den TomTom-asc-Dateien sollte so aufgebaut
sein wie in den ov2-Dateien.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3450&group_id=2211


From admin at berlios.de  Wed May 30 20:51:24 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 30 May 2007 20:51:24 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3450] Beschreibung in .asc wie in .ov2
Message-ID: <200705301851.l4UIpO1m002170@unicorn.berlios.de>

Feature Request #3450, was updated on 2007-May-30 20:50
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3450&group_id=2211

Category: 1.0
Status: Open
Priority: 5
Summary: Beschreibung in .asc wie in .ov2

By: kalli
Date: 2007-May-30 20:50

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

Der Name in den TomTom-asc-Dateien sollte so aufgebaut
sein wie in den ov2-Dateien.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3450&group_id=2211


From admin at berlios.de  Wed May 30 20:54:29 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 30 May 2007 20:54:29 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2990] Import von anderen Kalibrirungsfiles
Message-ID: <200705301854.l4UIsTXY007365@unicorn.berlios.de>

Feature Request #2990, was updated on 2006-Dec-22 17:41
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2990&group_id=2211

Category: 1.0
Status: Open
Priority: 5
Summary: Import von anderen Kalibrirungsfiles

By: kalli
Date: 2006-Dec-22 17:41

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (compatible; Konqueror/3.5; Linux) KHTML/3.5.2 (like Gecko) Kubuntu 6.06 Dapper

Nach dem Tod von NHTop50Trans tauchen ?fters 
Fragen nach dem Import von anderen Formaten 
auf. Vielleicht sollte man hier gleich eine saubere 
Importschnittstelle definieren, die zum einen das 
Dateiformat automatisch erkennt (meist gibt es 
einen Header) und dann die entprechende 
Importmethode aufruft. als Ergebnis kommt dann 
eh ein .wfl-File raus.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2990&group_id=2211


From bilbowolf at mail.berlios.de  Wed May 30 23:45:00 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Wed, 30 May 2007 23:45:00 +0200
Subject: [Cachewolf-svn] r718 - branches/bugfix_09n/src/CacheWolf
Message-ID: <200705302145.l4ULj0la008455@sheep.berlios.de>

Author: bilbowolf
Date: 2007-05-30 23:44:56 +0200 (Wed, 30 May 2007)
New Revision: 718

Modified:
   branches/bugfix_09n/src/CacheWolf/SpiderGC.java
   branches/bugfix_09n/src/CacheWolf/Version.java
Log:
?\195?\132nderungen am spider, um die Layout?\195?\164nderung von gc.com vom 30.05.07
zu parsen.

Modified: branches/bugfix_09n/src/CacheWolf/SpiderGC.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-05-29 02:20:07 UTC (rev 717)
+++ branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-05-30 21:44:56 UTC (rev 718)
@@ -751,18 +751,15 @@
 	}
 	
 	private String getLatLon(String doc){
-		inRex = new Regex("<span id=\"LatLon\"><.*?>((?s).*?)</STRONG>");
+		inRex = new Regex("<span id=\"LatLon\"><b>((?s).*?)</b></span>");
 		inRex.search(doc);
-		
-		//Vm.debug("LatLon: " + inRex.stringMatched(1));
-		
 		return inRex.stringMatched(1);
 	}
 	
 	private String getOwner(String doc){
-		inRex = new Regex("<span id=\"CacheOwner\".*?by ((?s).*?)\\[<A HREF=");
+		inRex = new Regex("<span id=\"CacheOwner\">by <a href=((?s).*?)>((?s).*?)</a></span></b>");
 		inRex.search(doc);
-		return inRex.stringMatched(1);
+		return inRex.stringMatched(2);
 	}
 	
 	private String getName(String doc){

Modified: branches/bugfix_09n/src/CacheWolf/Version.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/Version.java	2007-05-29 02:20:07 UTC (rev 717)
+++ branches/bugfix_09n/src/CacheWolf/Version.java	2007-05-30 21:44:56 UTC (rev 718)
@@ -8,7 +8,7 @@
 
 public class Version {
 	static final String VER_MAJOR = "0.9n";
-	static final String VER_MINOR = "";
+	static final String VER_MINOR = " patch 1";
 	static final String VER_BUILD = " RC ";
 	static final String VER_SVN ="$LastChangedRevision$"; //the  number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	



From salzkammergut at mail.berlios.de  Thu May 31 12:42:27 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 31 May 2007 12:42:27 +0200
Subject: [Cachewolf-svn] r719 - trunk/resources
Message-ID: <200705311042.l4VAgRZp018184@sheep.berlios.de>

Author: salzkammergut
Date: 2007-05-31 12:42:17 +0200 (Thu, 31 May 2007)
New Revision: 719

Modified:
   trunk/resources/spider.def
Log:
Update Definitionsdatei fuer Aenderungen GC 

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-05-30 21:44:56 UTC (rev 718)
+++ trunk/resources/spider.def	2007-05-31 10:42:17 UTC (rev 719)
@@ -1,6 +1,7 @@
 #============================================================
 # spider.def - Definition file for reading caches from GC.COM
 # Version 1.0 - 20070526 skg
+# Version 2.0 - 20070531 nach GC ?nderungen
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -32,11 +33,11 @@
 fetchAllLogs       = &log=y
 cacheUnavailable   = This\ cache\ is\ temporarily\ unavailable
 cacheArchived      = This cache\ has\ been\ archived
-latLonRex          = <span\ id="LatLon"><.*?>((?s).*?)</STRONG>
+latLonRex          = <span\ id="LatLon"><b>((?s).*?)</b></span>
 shortDescRex       = <span\ id="ShortDescription">((?s).*?)</span>
 longDescRex        = <span\ id="LongDescription">((?s).*?)<strong>Additional\ Hints
 cacheNameRex       = <span\ id="CacheName">((?s).*?)</span>
-cacheOwnerRex      = <span\ id="CacheOwner".*?by ((?s).*?)\\[<A\ HREF=
+cacheOwnerRex      = <span\ id="CacheOwner">by\ <a\ href=(?:(?s).*?)>((?s).*?)</a></span></b>
 dateHiddenRex      = <span\ id="DateHidden">((?s).*?)</span>
 hintsRex           = <span\ id="Hints"\ class="displayMe">((?s).*?)</span>
 sizeRex            = This\ is\ a\ <strong>((?s).*?)</strong>\ cache



