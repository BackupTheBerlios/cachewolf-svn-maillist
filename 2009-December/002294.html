<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2370 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2370%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C200912191450.nBJEo4S2010653%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002293.html">
   <LINK REL="Next"  HREF="002295.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2370 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2370%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C200912191450.nBJEo4S2010653%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2370 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Sat Dec 19 15:50:04 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002293.html">[Cachewolf-svn] r2369 - trunk
</A></li>
        <LI>Next message: <A HREF="002295.html">[Cachewolf-svn] r2371 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2294">[ date ]</a>
              <a href="thread.html#2294">[ thread ]</a>
              <a href="subject.html#2294">[ subject ]</a>
              <a href="author.html#2294">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2009-12-19 15:49:58 +0100 (Sat, 19 Dec 2009)
New Revision: 2370

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
extended import selection possibilities with mindistance and direction

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/res_noewe/languages/DE.cfg	2009-12-19 14:49:58 UTC (rev 2370)
@@ -30,9 +30,9 @@
 		126=nach TomTom OV2
 		127=Speichern
 		128=%fcber Template
-		129=Importiere GPX
-		130=Download von opencaching
-		131=Spider von geocaching.com
+		129=aus GPX Datei
+		130=von opencaching de,pl,cz,uk
+		131=von geocaching.com
 		132=nach Explorist
 		133=Suche alle
 		134=Gew%e4hlter Cache
@@ -106,7 +106,7 @@
 		214=Neuer Wegpunkt
 		215=nach LOC
 		216=Immer bei GC einloggen
-		217=Spider alle Funde von geocaching.com
+		217=alle Funde von geocaching.com
 		218=Auch in Beschreibung/Notizen
 		219=Suche...
 		220=Pr%fcfe Notizen und L%f6ser
@@ -460,9 +460,11 @@
 		1622=Gefundene Caches nicht laden
 		1623=Max. Anzahl:
 		1624=+Caches
-		1625=TBs downloaden
+		1625=TBs laden
 		1626=Max. Logs:
 		1627=Alle Caches
+		1628=min. Abstand:
+		1629=Richtung (leer,N,O,S,W):
 		1700=Fehler in Zeile:
 		1701=Spalte:
 		1702=Variable nicht definiert:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/res_noewe/languages/EN.cfg	2009-12-19 14:49:58 UTC (rev 2370)
@@ -30,9 +30,9 @@
 		126=to TomTom OV2
 		127=Save
 		128=via Template
-		129=Import GPX
-		130=Download from opencaching
-		131=Spider from geocaching.com
+		129=from GPX file
+		130=from opencaching de, pl, cz, uk
+		131=from geocaching.com
 		132=to Explorist
 		133=Search all
 		134=Selected Cache
@@ -106,7 +106,7 @@
 		214=New Waypoint
 		215=to LOC
 		216=Always login to GC
-		217=Spider all finds from geocaching.com
+		217=all finds from geocaching.com
 		218=Also in description/notes
 		219=Searching...
 		220=Check notes and solver
@@ -436,7 +436,7 @@
 		1513=Cannot start moving map without valid coordinates. Please enter coordinates as destination as center or in selected cache, or start GPS
 		1514=Cannot recalculate distances, because the GPS position is not set
 		1600=+Download
-		1601=Distance:
+		1601=max. Distance:
 		1602=Download images
 		1603=Download maps
 		1604=Cancel
@@ -463,6 +463,8 @@
 		1625=Download TBs
 		1626=Max. logs:
 		1627=All caches
+		1628=min. Distance:
+		1629=Direction (empty,N,E,S,W):
 		1700=Error on line:
 		1701= position:
 		1702=Variable not defined:

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/res_noewe/languages/FR.cfg	2009-12-19 14:49:58 UTC (rev 2370)
@@ -30,9 +30,9 @@
 		126=vers TomTom OV2
 		127=Enregistrer
 		128=par Template
-		129=Importe GPX
-		130=T%e9l%e9chargement par opencaching
-		131=Spider par geocaching.com
+		129=de GPX Fichier
+		130=de opencaching de, pl, cz, uk
+		131=de geocaching.com
 		132=vers Explorist
 		133=Cherche toutes
 		134=Cache choisi
@@ -104,8 +104,9 @@
 		212=Effacer toutes les fichier .xml (et images) qui ne sont pas en index.xml
 		213=Effacer les fichier .xml orpheline
 		214=Nouveau waypoint
+		215=%e0 LOC
 		216=Toujours connecter
-		217=[retrouver les ?found de geocaching.com]
+		217=toutes les trouvailles de geocaching.com
 		218=Aussi dans description/notes
 		219=Cherchant...
 		220=V%e9rifier notes et resoudeur
@@ -432,7 +433,7 @@
 		1512=Waypoint
 		1513=Ne peut pas afficher carte sans coordonn%e9es valides - Merci d'entrer coordonn%e9es comme destination, centre ou dans le cache choisi et d%e9marrer GPS
 		1600=+T%e9l%e9chargement
-		1601=Distance maximum:
+		1601=max. Distance:
 		1602=T%e9l%e9charger images
 		1603=T%e9l%e9charger cartes
 		1604=Annuler
@@ -454,6 +455,13 @@
 		1620=t%e9l%e9chargement d'image integr%e8e:+
 		1621=Erreur d'interpretation du fichier mise %e0 jour.%0aC'est probablement un erreur d'opencaching.de%0aEssayez encore une fois plus tard.%0a Statut:
 		1622=Pas t%e9l%e9charger caches trouv%e9es
+		1623=Max Quantit%e9:
+		1624=+ caches
+		1625=Importe TBs
+		1626=Max Activit%e9:
+		1627=Tous les caches
+		1628=min. Distance:
+		1629=Direction (vide,N,E,S,W):
 		1700=Erreur en lingne:
 		1701=Colonne:
 		1702=Variable pas d%e9fini:

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/res_noewe/languages/NL.cfg	2009-12-19 14:49:58 UTC (rev 2370)
@@ -30,9 +30,9 @@
 		126=Naar TomTom OV2
 		127=Opslaan
 		128=Via sjabloon
-		129=Importeren GPX
-		130=Download van opencaching
-		131=Werkgeheugen van geocaching.com
+		129=van GPX Bestand
+		130=van opencaching de, pl, cz, uk
+		131=van geocaching.com
 		132=Naar Explorist
 		133=Allen zoeken
 		134=Gekozen Cache
@@ -103,6 +103,9 @@
 		212=[Delete all .xml files not in index.xml and associated pictures]
 		213=[Deleting orphans]
 		214=Nieuwe Waypoint
+		215=aan LOC
+		216=Altijd aanmelden bij GC
+		217=alle vondsten uit geocaching.com
 		218=Ook in opmerkingen/beschrijving
 		219=Zoeken...
 		220=Onderzoek opmerkingen en oplosser
@@ -409,7 +412,7 @@
 		1513=Kan moving map niet draaien zonder geldige co%f6rdinaten. Geef Centrums- of Doelco%f6rdinaten of start het GPS AUB.
 		1514=Kan afstanden niet opnieuw berekenen doordat er geen GPS positie gegeven is (geen receptie is/was)
 		1600=+Download
-		1601=Afstand:
+		1601=max. Afstand:
 		1602=Download afbeeldingen
 		1603=Download kaarten
 		1604=Annuleren
@@ -430,6 +433,14 @@
 		1619=: kon de afbeelding van URL niet downloaden:+
 		1620=download bijgesloten afbeeldingen:+
 		1621=Fout tijdens interpreteren data%0a van Opencaching.de,%0aDit is vermoedelijk een fout bij Opencaching.de%0aprobeer later nogmaals%0aStatus:
+		1622=niet in staat om te laden caches gevonden
+		1623=Max Aantal:
+		1624=+ caches
+		1625=Import TBs:
+		1626=Max Logs:
+		1627=Alle caches
+		1628=max. Afstand:
+		1629=Richting (leeg,N,O,Z,W):
 		1700=Fout in lijn:
 		1701=Positie:
 		1702=Variabele niet gedefinieerd.

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/res_noewe/languages/PL.cfg	2009-12-19 14:49:58 UTC (rev 2370)
@@ -30,9 +30,9 @@
                 126=TomTom OV2
                 127=Zapisz
                 128=Przez szablon
-                129=Importuj GPX
-                130=Sciagnij z opencaching.de
-                131=Sciagnij z geocaching.com
+                129=z GPX pliku
+                130=z Opencaching de, pl, cz, pl
+                131=z geocaching.com
                 132=Explorist
                 133=Szukaj wszystkich
                 134=Zaznaczony Cache
@@ -435,7 +435,7 @@
                 1513=Nie mozna poruszac mapy bez prawidlowych wspolrzednych.%0a Prosze Wprowadz Wspolrzedne srodka %0alub na wybrana skrzynke, lub pozycja GPS
                 1514=Nie mozna przeliczyc odleglosci, pozycja GPS nie ustawiona
                 1600=Opencahing Download
-                1601=Odleglosc:
+                1601=max. Odleglosc:
                 1602=Sciagnij obrazki
                 1603=Sciagnij mapy
                 1604=Anuluj
@@ -462,6 +462,8 @@
                 1625=Sciagnij TBs
                 1626=Max. logow:
                 1627=Wszystkie skrzynki
+                1628=min. Odleglosc:
+                1629=Kierunek (pusty,N,E,P,W):
                 1700=Blad on line:
                 1701= pozycja:
                 1702=Zmienna niezdefiniowana:

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/res_noewe/spider.def	2009-12-19 14:49:58 UTC (rev 2370)
@@ -56,6 +56,7 @@
 # Regex to search for cachenames
 listBlockRex       = &lt;table id=&quot;ctl00_ContentBody_dlResults&quot;((?s).*?)&lt;/table&gt;
 lineRex            = &lt;tr\ bgcolor='#.{6}'&gt;(?:(?s).*?)&lt;td\ valign=&quot;top&quot;\ align=&quot;left&quot;&gt;((?s).*?)&lt;/tr&gt;
+directionRex       = /compass/(.*?).gif&quot; alt=&quot;
 distRex            = &lt;br\ /&gt;(.*?)(?:km|mi)(?:\\s*)&lt;/td&gt;
 waypointRex        = \\(GC(.*?)\\)&lt;br\ /&gt;
 showOnlyFound      = &amp;f=1

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/src/CacheWolf/Profile.java	2009-12-19 14:49:58 UTC (rev 2370)
@@ -46,6 +46,9 @@
 
 	/** Distance for geocaching caches */
 	private String distGC = new String();
+	private String minDistGC = new String();
+	/** Direction for geocaching caches */
+	private String directionGC = new String();
 
 	/** path to the maps of the profile relative to the maps root */
 	private String relativeCustomMapsPath = new String();
@@ -115,6 +118,8 @@
 		setLast_sync_opencaching(&quot;&quot;);
 		setDistOC(&quot;&quot;);
 		setDistGC(&quot;&quot;);
+		setMinDistGC(&quot;&quot;);
+		setDirectionGC(&quot;&quot;);
 		setRelativeCustomMapsPath(&quot;&quot;);
 		resetUnsavedChanges();
 	}
@@ -185,7 +190,13 @@
 			if (getDistGC() == null || getDistGC().endsWith(&quot;null&quot;) || getDistGC().equals(&quot;&quot;)) {
 				setDistGC(&quot;0.0&quot;);
 			}
-
+			if (getMinDistGC() == null || getMinDistGC().endsWith(&quot;null&quot;) || getMinDistGC().equals(&quot;&quot;)) {
+				setMinDistGC(&quot;0.0&quot;);
+			}
+			if (getDirectionGC() == null || getDirectionGC().endsWith(&quot;null&quot;) || getDirectionGC().equals(&quot;&quot;)) {
+				setDirectionGC(&quot;&quot;);
+			}
+			
 			// If the current filter is a CacheTour filter, then save it as
 			// normal filter, because after loading there is no cache tour defined
 			// which could be used as filter criterium.
@@ -199,7 +210,7 @@
 					(isFilterInverted()?&quot;T&quot;:&quot;F&quot;)+&quot;\&quot; showBlacklist = \&quot;&quot;+showBlacklisted()+&quot;\&quot; /&gt;\n&quot;);
 			detfile.print(this.getCurrentFilter().toXML(&quot;&quot;));
 			detfile.print(&quot;    &lt;SYNCOC date = \&quot;&quot;+getLast_sync_opencaching()+&quot;\&quot; dist = \&quot;&quot;+getDistOC()+&quot;\&quot;/&gt;\n&quot;);
-			detfile.print(&quot;    &lt;SPIDERGC dist = \&quot;&quot; + getDistGC() + &quot;\&quot;/&gt;\n&quot;);
+			detfile.print(&quot;    &lt;SPIDERGC dist = \&quot;&quot; + getDistGC() + &quot;\&quot; mindist = \&quot;&quot; + getMinDistGC() + &quot;\&quot; direction = \&quot;&quot; + getDirectionGC() + &quot;\&quot;/&gt;\n&quot;);
 			detfile.print(&quot;    &lt;mapspath relativeDir = \&quot;&quot; + SafeXML.clean(relativeCustomMapsPath) + &quot;\&quot;/&gt;\n&quot;);
 			int size = cacheDB.size();
 			for (int i = 0; i &lt; size; i++) {
@@ -304,6 +315,10 @@
 				} else if (text.indexOf(&quot;&lt;SPIDERGC&quot;)&gt;=0) {
 					int start=text.indexOf(&quot;dist = \&quot;&quot;)+8;
 					setDistGC(text.substring(start,text.indexOf(&quot;\&quot;&quot;,start)));
+					start=text.indexOf(&quot;mindist = \&quot;&quot;)+11;
+					setMinDistGC(text.substring(start,text.indexOf(&quot;\&quot;&quot;,start)));
+					start=text.indexOf(&quot;direction = \&quot;&quot;)+13;
+					setDirectionGC(text.substring(start,text.indexOf(&quot;\&quot;&quot;,start)));
 				} else if (indexXmlVersion &lt;=2 &amp;&amp; text.indexOf(&quot;&lt;FILTER&quot;)&gt;=0){
 					// Read filter data of file versions 1 and 2. (Legacy code)
 					ex.setSource(text.substring(text.indexOf(&quot;&lt;FILTER&quot;)));
@@ -782,11 +797,32 @@
 		return distGC;
 	}
 
+	public String getMinDistGC() {
+		return minDistGC;
+	}
+
+	public String getDirectionGC() {
+		return directionGC;
+	}
+//
+	public void setMinDistGC(String minDistGC) {
+		this.notifyUnsavedChanges(!minDistGC.equals(this.minDistGC));
+		this.minDistGC = minDistGC;
+	}
+
 	public void setDistGC(String distGC) {
 		this.notifyUnsavedChanges(!distGC.equals(this.distGC));
 		this.distGC = distGC;
 	}
 
+	public void setDirectionGC(String directionGC) {
+		if (directionGC.length() &gt; 2) {
+			directionGC=directionGC.substring(0,2);
+		}
+		this.notifyUnsavedChanges(!directionGC.equals(this.directionGC));
+		this.directionGC = directionGC;
+	}
+
 	public String getRelativeCustomMapsPath() {
 		return relativeCustomMapsPath;
 	}

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-12-19 14:49:58 UTC (rev 2370)
@@ -192,7 +192,7 @@
 																 | OCXMLImporterScreen.HOST);
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
 		Vm.showWait(true);
-		String dist = importOpt.distanceInput.getText();
+		String dist = importOpt.maxDistanceInput.getText();
 
 		if (importOpt.domains.getSelectedItem()!=null)
 			hostname = (String)importOpt.domains.getSelectedItem();

Modified: trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-12-19 14:49:58 UTC (rev 2370)
@@ -22,7 +22,9 @@
 	mButton cancelB, okB;
 	Preferences pref;
 	mChoice chcType;
-	mInput distanceInput;
+	mInput maxDistanceInput;
+	mInput minDistanceInput;
+	mInput directionInput;
 	mInput maxNumberInput;
 	mInput maxLogsInput;
 	mCheckBox imagesCheckBox, /*mapsCheckBox, */ missingCheckBox, foundCheckBox, travelbugsCheckBox;
@@ -42,6 +44,8 @@
 	public static final int MAXLOGS = 128;
 	public static final int TYPE = 256;
 	public static final int HOST = 512;
+	public static final int MINDIST = 1024;
+	public static final int DIRECTION = 2048;
 
 
 	public OCXMLImporterScreen(String title, int options) {
@@ -76,9 +80,29 @@
 				},0), CellConstants.STRETCH, (CellConstants.FILL|CellConstants.WEST));
 		}
 
+		if ((options &amp; MINDIST) &gt; 0) {
+			this.addNext(distLbl = new mLabel(MyLocale.getMsg(1628,&quot;min. Distance:&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			minDistanceInput = new mInput();
+			String dist1=&quot;0&quot;;
+			String dist2=&quot;0&quot;;
+			if (isGC) {
+				dist1 = Global.getProfile().getMinDistGC();
+				dist2 = Global.getProfile().getDistOC();
+			} else {
+				dist1 = Global.getProfile().getDistOC();
+				dist2 = Global.getProfile().getMinDistGC();
+			}
+			if ( dist1.equals(&quot;&quot;) || dist1.equals(&quot;0&quot;) || dist1.equals(&quot;0.0&quot;) ) {
+				dist1 = dist2;
+			}
+			minDistanceInput.setText(dist1);
+			this.addNext(minDistanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			this.addLast(new mLabel(&quot; km/mi.&quot;),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		}
+
 		if ((options &amp; DIST) &gt; 0) {
 			this.addNext(distLbl = new mLabel(MyLocale.getMsg(1601,&quot;Distance:&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-			distanceInput = new mInput();
+			maxDistanceInput = new mInput();
 			String dist1;
 			String dist2;
 			if (isGC) {
@@ -91,11 +115,18 @@
 			if ( dist1.equals(&quot;&quot;) || dist1.equals(&quot;0&quot;) || dist1.equals(&quot;0.0&quot;) ) {
 				dist1 = dist2;
 			}
-			distanceInput.setText(dist1);
-			this.addNext(distanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			maxDistanceInput.setText(dist1);
+			this.addNext(maxDistanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 			this.addLast(distUnit = new mLabel(&quot; km/mi.&quot;),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		}
 
+		if ((options &amp; DIRECTION) &gt; 0) {
+			this.addNext(new mLabel(MyLocale.getMsg(1629,&quot;Richtung (leer,N,O,S,W):&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			directionInput = new mInput();
+			directionInput.setText(Global.getProfile().getDirectionGC());
+			this.addLast(directionInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		}
+
 		if ((options &amp; MAXNUMBER) &gt; 0) {
 			this.addNext(maxNumberLbl = new mLabel(MyLocale.getMsg(1623,&quot;Max. number:&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 			maxNumberInput = new mInput();

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-12-17 23:37:33 UTC (rev 2369)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-12-19 14:49:58 UTC (rev 2370)
@@ -87,7 +87,9 @@
 	private static String viewstate = &quot;&quot;;
 	private static String cookieID = &quot;&quot;;
 	private static String cookieSession = &quot;&quot;;
-	private static double distance = 0;
+	private static double minDistance = 0;
+	private static double maxDistance = 0;
+	private static String direction = &quot;&quot;;
 	private Regex inRex = new Regex();
 	private CacheDB cacheDB;
 	private Vector cachesToLoad = new Vector();
@@ -365,21 +367,35 @@
 		if (spiderAllFinds) {
 			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,&quot;Spider Options&quot;), OCXMLImporterScreen.MAXNUMBER|OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.TYPE);
 			if (options.execute() == FormBase.IDCANCEL) {return; }
-
-			distance = 1;
+			maxDistance = 1;
+			minDistance = 0;
+			direction=&quot;&quot;;
 		} else {
-			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,&quot;Spider Options&quot;),	OCXMLImporterScreen.MAXNUMBER|OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST| OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.TYPE);
+			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,&quot;Spider Options&quot;),	OCXMLImporterScreen.MAXNUMBER|OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.MINDIST| OCXMLImporterScreen.DIST| OCXMLImporterScreen.DIRECTION| OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.TYPE);
 			if (options.execute() == FormBase.IDCANCEL) {return; }
-			String dist = options.distanceInput.getText();
-			if (dist.length()== 0) return;
-			distance = Common.parseDouble(dist);
 
-			//save last radius to profile
+			String minDist = options.minDistanceInput.getText();
+			if (minDist.length() == 0) minDist=&quot;0&quot;;
+			minDistance = Common.parseDouble(minDist);
 			Double distDouble = new Double();
-			distDouble.value = distance;
-			dist = distDouble.toString(0, 1, 0).replace(',', '.');
-			profile.setDistGC(dist);
+			distDouble.value = minDistance;
+			minDist = distDouble.toString(0, 1, 0).replace(',', '.');
+			profile.setMinDistGC(minDist);
 
+			String maxDist = options.maxDistanceInput.getText();
+			if (maxDist.length()== 0) return;
+			maxDistance = Common.parseDouble(maxDist);
+			//save last radius to profile
+			distDouble.value = maxDistance;
+			maxDist = distDouble.toString(0, 1, 0).replace(',', '.');
+			profile.setDistGC(maxDist);
+
+			direction=options.directionInput.getText().toUpperCase();
+			profile.setDirectionGC(direction);
+			direction.replace('O', 'E');
+			direction.replace('Z', 'S');
+			direction.replace('P', 'S');
+
 			doNotgetFound = options.foundCheckBox.getState();
 		}
 
@@ -403,9 +419,9 @@
 		options.close(0);
 
 		//max distance in miles for URL, so we can get more than 80km
-		double saveDistanceInMiles = distance;
+		double saveDistanceInMiles = maxDistance;
 		if ( Global.getPref().metricSystem != Metrics.IMPERIAL ) {
-			saveDistanceInMiles = Metrics.convertUnit(distance, Metrics.KILOMETER, Metrics.MILES);
+			saveDistanceInMiles = Metrics.convertUnit(maxDistance, Metrics.KILOMETER, Metrics.MILES);
 		}
 		// add a mile to be save from different distance calculations in CW and at GC
 		saveDistanceInMiles = java.lang.Math.ceil(saveDistanceInMiles) + 1;
@@ -413,10 +429,15 @@
 		Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
 
 		if (pref.spiderUpdates != Preferences.NO) {
-			double distanceInKm = distance;
+			double distanceInKm = maxDistance;
 			if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
-				distanceInKm = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
+				distanceInKm = Metrics.convertUnit(maxDistance, Metrics.MILES, Metrics.KILOMETER);
 			}
+			double minDistanceInKm = minDistance;
+			if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
+				minDistanceInKm = Metrics.convertUnit(minDistance, Metrics.MILES, Metrics.KILOMETER);
+			}
+
 			byte restrictedCacheType = options.getRestrictedCacheType(p);
 			for(int i = 0; i&lt;cacheDB.size();i++){
 				ch = cacheDB.get(i);
@@ -428,7 +449,7 @@
 					}
 				} else {
 					if ( (!ch.is_archived())
-						 &amp;&amp; (ch.kilom &lt;= distanceInKm)
+						 &amp;&amp; (ch.kilom &lt;= distanceInKm) &amp;&amp; (ch.kilom &gt;= minDistanceInKm)
 						 &amp;&amp; !(doNotgetFound &amp;&amp; (ch.is_found() || ch.is_owned()))
 						 &amp;&amp; (ch.getWayPoint().substring(0,2).equalsIgnoreCase(&quot;GC&quot;))
 						 &amp;&amp; ( (restrictedCacheType == CacheType.CW_TYPE_ERROR) || (ch.getType() == restrictedCacheType) )
@@ -479,7 +500,7 @@
 		int found_on_page = 0;
 		try {
 			//Loop till maximum distance has been found or no more caches are in the list
-			while(distance &gt; 0){
+			while(maxDistance &gt; 0){
 				if (infB.isClosed){
 					//don't update existing caches, because list is not correct when aborting
 					cachesToUpdate.clear();
@@ -514,65 +535,75 @@
 				}catch(NullPointerException nex){
 					Global.getPref().log(&quot;Ignored Exception&quot;, nex, true);
 				}
-				while(lineRex.didMatch()){
+				String oneCacheDesc=&quot;&quot;;
+				String gotDirection=&quot;&quot;;
+				while ( maxDistance&gt;0 &amp;&amp; lineRex.didMatch()){
 					//Vm.debug(getDist(lineRex.stringMatched(1)) + &quot; / &quot; +getWP(lineRex.stringMatched(1)));
 					found_on_page++;
-					if(getDist(lineRex.stringMatched(1)) &lt;= distance){
-						String waypoint=getWP(lineRex.stringMatched(1));
-						CacheHolder existingCache;
-						if((existingCache=cacheDB.get(waypoint)) == null){
-							if ( (maxNumber &gt; 0) &amp;&amp; (cachesToLoad.size() &gt;= maxNumber) ) {
-								maxNumberAbort = true;
-
-								//add no more caches
-								distance = 0;
-
-								//don't update existing caches, because list is not correct when aborting
-								cachesToUpdate.clear();
-							} else {
-								cachesToLoad.add(waypoint);
-
-								//if we don't want to update caches, we can stop directly after adding the maximum of new caches.
-								if ( (pref.spiderUpdates == Preferences.NO) &amp;&amp; (maxNumber &gt; 0) &amp;&amp; (cachesToLoad.size() &gt;= maxNumber)) {
+					oneCacheDesc=lineRex.stringMatched(1);
+					double gotDistance=getDist(oneCacheDesc);
+					gotDirection=getDirection(oneCacheDesc);
+					if(gotDistance &lt;= maxDistance){
+						if ( gotDistance &gt;= minDistance &amp;&amp;
+							 gotDirection.startsWith(direction) ){
+							String waypoint=getWP(oneCacheDesc);
+							CacheHolder existingCache;
+							if((existingCache=cacheDB.get(waypoint)) == null){
+								if ( (maxNumber &gt; 0) &amp;&amp; (cachesToLoad.size() &gt;= maxNumber) ) {
 									maxNumberAbort = true;
 
 									//add no more caches
-									distance = 0;
+									maxDistance = 0;
 
 									//don't update existing caches, because list is not correct when aborting
 									cachesToUpdate.clear();
+								} else {
+									pref.log(waypoint+&quot; added to load!&quot;);
+									cachesToLoad.add(waypoint);
+
+									//if we don't want to update caches, we can stop directly after adding the maximum of new caches.
+									if ( (pref.spiderUpdates == Preferences.NO) &amp;&amp; (maxNumber &gt; 0) &amp;&amp; (cachesToLoad.size() &gt;= maxNumber)) {
+										maxNumberAbort = true;
+
+										//add no more caches
+										maxDistance = 0;
+
+										//don't update existing caches, because list is not correct when aborting
+										cachesToUpdate.clear();
+									}
 								}
-							}
-						} else {
-							pref.log(waypoint+&quot; already in DB&quot;);
-							ch=existingCache;
-							// If the &lt;strike&gt; tag is used, the cache is marked as unavailable or archived
-							boolean is_archived_GC=lineRex.stringMatched(1).indexOf(&quot;&lt;strike&gt;&lt;font color=\&quot;red\&quot;&gt;&quot;)!=-1;
-							boolean is_available_GC=lineRex.stringMatched(1).indexOf(&quot;&lt;strike&gt;&quot;)==-1;
-							if (ch.is_archived()!=is_archived_GC) { // Update the database with the cache status
-								pref.log(&quot;Updating status of &quot;+waypoint+&quot; to &quot;+(is_archived_GC?&quot;archived&quot;:&quot;not archived&quot;));
-								if ( ch.is_archived() ) {
-									cachesToUpdate.put(ch.getWayPoint(), ch);
+							} else {
+								pref.log(waypoint+&quot; already in DB&quot;);
+								ch=existingCache;
+								// If the &lt;strike&gt; tag is used, the cache is marked as unavailable or archived
+								boolean is_archived_GC=oneCacheDesc.indexOf(&quot;&lt;strike&gt;&lt;font color=\&quot;red\&quot;&gt;&quot;)!=-1;
+								boolean is_available_GC=oneCacheDesc.indexOf(&quot;&lt;strike&gt;&quot;)==-1;
+								if (ch.is_archived()!=is_archived_GC) { // Update the database with the cache status
+									pref.log(&quot;Updating status of &quot;+waypoint+&quot; to &quot;+(is_archived_GC?&quot;archived&quot;:&quot;not archived&quot;));
+									if ( ch.is_archived() ) {
+										cachesToUpdate.put(ch.getWayPoint(), ch);
+									}
+									ch.setArchived(is_archived_GC);
+								} else if (ch.is_available()!=is_available_GC) { // Update the database with the cache status
+									pref.log(&quot;Updating status of &quot;+waypoint+&quot; to &quot;+(is_available_GC?&quot;available&quot;:&quot;not available&quot;));
+									ch.setAvailable(is_available_GC);
+								} else if (spiderAllFinds &amp;&amp; !ch.is_found()) { // Update the database with the cache status
+									pref.log(&quot;Updating status of &quot;+waypoint+&quot; to found&quot;);
+									ch.setFound(true);
+								} else {
+									cachesToUpdate.remove( ch.getWayPoint() );
 								}
-								ch.setArchived(is_archived_GC);
-							} else if (ch.is_available()!=is_available_GC) { // Update the database with the cache status
-								pref.log(&quot;Updating status of &quot;+waypoint+&quot; to &quot;+(is_available_GC?&quot;available&quot;:&quot;not available&quot;));
-								ch.setAvailable(is_available_GC);
-							} else if (spiderAllFinds &amp;&amp; !ch.is_found()) { // Update the database with the cache status
-								pref.log(&quot;Updating status of &quot;+waypoint+&quot; to found&quot;);
-								ch.setFound(true);
-							} else {
-								cachesToUpdate.remove( ch.getWayPoint() );
 							}
 						}
-					} else distance = 0;
+					} else maxDistance = 0;
+					// next Cache Description of this page
 					lineRex.searchFrom(dummy, lineRex.matchedTo());
 				}
 
 				page++;
 				infB.setInfo(MyLocale.getMsg(5521,&quot;Page &quot;) + page + &quot;\n&quot; + MyLocale.getMsg(5511,&quot;Found &quot;) + cachesToLoad.size() + MyLocale.getMsg(5512,&quot; caches&quot;));
 
-				if(found_on_page &lt; 20) distance = 0;
+				if(found_on_page &lt; 20) maxDistance = 0;
 				if (spiderAllFinds) {
 					postStr = p.getProp(&quot;firstLine&quot;);
 				} else {
@@ -581,7 +612,7 @@
 					if(doNotgetFound) postStr = postStr + p.getProp(&quot;showOnlyFound&quot;);
 				}
 				postStr = postStr + cacheTypeRestriction;
-				if(distance &gt; 0){
+				if(maxDistance &gt; 0){
 					page_number++;
 					String strNextPage;
 					/*
@@ -944,6 +975,18 @@
 	}
 
 	/**
+	 * Get the direction
+	 * @param doc A previously fetched cachepage
+	 * @return direction String
+	 */
+	private String getDirection(String doc) throws Exception {
+		inRex = new Regex(p.getProp(&quot;directionRex&quot;));
+		inRex.search(doc);
+		if (!inRex.didMatch()) return &quot;&quot;;
+		return inRex.stringMatched(1);
+	}
+
+	/**
 	 * Get the waypoint name
 	 * @param doc A previously fetched cachepage
 	 * @return Name of waypoint to add to list


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002293.html">[Cachewolf-svn] r2369 - trunk
</A></li>
	<LI>Next message: <A HREF="002295.html">[Cachewolf-svn] r2371 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2294">[ date ]</a>
              <a href="thread.html#2294">[ thread ]</a>
              <a href="subject.html#2294">[ subject ]</a>
              <a href="author.html#2294">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
