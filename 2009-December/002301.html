<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2377 - in trunk: res_noewe/languages src/CacheWolf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2377%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf&In-Reply-To=%3C200912221004.nBMA48Ob016660%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002300.html">
   <LINK REL="Next"  HREF="002302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2377 - in trunk: res_noewe/languages src/CacheWolf</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2377%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf&In-Reply-To=%3C200912221004.nBMA48Ob016660%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2377 - in trunk: res_noewe/languages src/CacheWolf">araber95 at mail.berlios.de
       </A><BR>
    <I>Tue Dec 22 11:04:08 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002300.html">[Cachewolf-svn] r2376 - trunk/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="002302.html">[Cachewolf-svn] r2378 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2301">[ date ]</a>
              <a href="thread.html#2301">[ thread ]</a>
              <a href="subject.html#2301">[ subject ]</a>
              <a href="author.html#2301">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2009-12-22 11:04:03 +0100 (Tue, 22 Dec 2009)
New Revision: 2377

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/Rebuild.java
Log:
deleting caches not in profile is no longer necessary like before
(alternative move to a new profile to see remaining files)

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-12-21 08:51:20 UTC (rev 2376)
+++ trunk/res_noewe/languages/DE.cfg	2009-12-22 10:04:03 UTC (rev 2377)
@@ -834,6 +834,7 @@
 		5519=Information
 		5520=Nur das eingestellte Maximum an Caches wurde geladen.%0aWiederholen sie das Spidern sp%e4ter um weitere Caches zu laden.%0aEs wurden keine vorhandenen Caches aktualisiert.
 		5521=Seite+
+		5522=Pr%fcfen auf %e4ltere XML-Dateien ( ohne &lt;CACHE... /&gt; ) ?
 		6000=Guid
 		6001=Name
 		6002=Track#
@@ -924,15 +925,15 @@
 		7121=Daten per GPSD empfangen von
 		7122=Die GPS-Daten werden per GPSD von einem anderen Server oder localhost empfangen (statt per seriellem Port)
 		7200=Aufruf: CacheWolf [-c &lt;Pfad zur Einstellungsdatei&gt;] [-debug]
-        7300=Stra%dfe/POI
-        7301=Stadt
-        7302=Suchen
-        7303=Abbr.
-        7304=berlin, deutschland
-        7305=Hauptbahnhof
-        7306=suche...
-        7307=abgebrochen durch Nutzer
-        7308=Fehler bei der online Verbindung
+        	7300=Stra%dfe/POI
+        	7301=Stadt
+        	7302=Suchen
+        	7303=Abbr.
+        	7304=berlin, deutschland
+        	7305=Hauptbahnhof
+        	7306=suche...
+        	7307=abgebrochen durch Nutzer
+        	7308=Fehler bei der online Verbindung
 		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-12-21 08:51:20 UTC (rev 2376)
+++ trunk/res_noewe/languages/EN.cfg	2009-12-22 10:04:03 UTC (rev 2377)
@@ -822,6 +822,7 @@
 		5519=Information
 		5520=Only the given maximum of caches were loaded.%0aRepeat spidering later to load more caches.%0aNo already existing caches were updated.
 		5521=Page+
+		5522=Check for older xml-Files ( without &lt;CACHE... /&gt; )?
 		6000=Guid
 		6001=Name
 		6002=track#
@@ -831,7 +832,7 @@
 		6006=From Date
 		6007=From Log
 		6008=To Prof
-	  6009=To Wpt
+	  	6009=To Wpt
 		6010=To Date
 		6011=To Log
 		6015=*** OTHER ***
@@ -907,15 +908,15 @@
 		7121=Receive GPS from gpsd host
 		7122=GPS data will be received from a gpsd server, not from a serial port
 		7200=Usage: CacheWolf [-c &lt;path to pref.xml&gt;] [-debug]
-        7300=Street/POI
-        7301=City
-        7302=Search
-        7303=Cancel
-        7304=new york, usa
-        7305=wallstreet
-        7306=searching...
-        7307=Canceled by user
-        7308=Could not connect
+        	7300=Street/POI
+        	7301=City
+        	7302=Search
+        	7303=Cancel
+        	7304=new york, usa
+        	7305=wallstreet
+        	7306=searching...
+        	7307=Canceled by user
+        	7308=Could not connect
 		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-12-21 08:51:20 UTC (rev 2376)
+++ trunk/res_noewe/languages/FR.cfg	2009-12-22 10:04:03 UTC (rev 2377)
@@ -820,6 +820,13 @@
 		5513=Chargeant:+
 		5514=%0aTravel Bug:+
 		5515=Erreur en chargeant la cache.%0aMerci de v%e9rifier votre connexion internet..%0aContinuer d'essayer?
+		5516=+descriptions cache%0ane pouvait pas %eatre charg%e9.
+		5517=Spider mises %e0 jour?
+		5518=+caches en base de donn%e9es ont besoin d'une mise %e0 jour. Mettre %e0 jour maintenant?
+		5519=Information
+		5520=Seulement le maximum compte tenu des caches ont %e9t%e9 charg%e9s.%0aR%e9p%e9tez spidering plus tard %e0 la charge des caches plus.%0aNo caches d%e9j%e0 existants ont %e9t%e9 mis %e0 jour.
+		5521=Page+
+		5522=V%e9rifier les plus %e2g%e9s fichiers XML (sans &lt;CACHE... /&gt;)?
 		6000=Guid
 		6001=Nom
 		6002=Track#
@@ -886,14 +893,14 @@
 		7021=Ce type de version
 		7022=Type de version
 		7023=Erreur en t%e9l%e9chargeant les informations de version
-        7300=Street / POI
-        7301=Ville
-        7302=Recherche
-        7303=Annuler
-        7304=paris
-        7305=avenue des champs-elysees
-        7306=Recherche en cours...
-        7307=Annul%e9 par l'utilisateur
-        7308=Impossible de se connecter		{..}
+        	7300=Street / POI
+        	7301=Ville
+        	7302=Recherche
+        	7303=Annuler
+        	7304=paris
+        	7305=avenue des champs-elysees
+        	7306=Recherche en cours...
+        	7307=Annul%e9 par l'utilisateur
+        	7308=Impossible de se connecter		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-12-21 08:51:20 UTC (rev 2376)
+++ trunk/res_noewe/languages/NL.cfg	2009-12-22 10:04:03 UTC (rev 2377)
@@ -332,8 +332,8 @@
 		1025=Kan middelpunt niet toepassen (verkeerde GPS co%f6rdinaten).
 		1028=)?
 		1029=Er zijn verwinkte maar niet zichtbare Waypoints.%0a(Caches:+
-        1030=, additionele Waypoints:+
-        1031=Deeze ook verwijdern?
+		1030=, additionele Waypoints:+
+		1031=Deeze ook verwijdern?
 		1032=Path to browser:
 		1033=is incorrect!
 		1034=Cannot start browser!
@@ -627,6 +627,14 @@
 		5512=+caches
 		5513=Bezig met laden:+
 		5514=%0aTravelbug
+		5515=Failed to load-cache.%0aPlease Controleer je internetverbinding.%0aRetry?
+		5516=+cache beschrijvingen%0acould niet worden geladen.
+		5517=Spider updates?
+		5518=+caches in de database moet een update. Update nu?
+		5519=Informatie
+		5520=Alleen de gegeven maximum van caches waren geladen.%0aRepeat spideren later meer caches te laden.%0aNo reeds bestaande caches zijn bijgewerkt.
+		5521=Page+
+		5522=Controleer voor oudere xml-bestanden (zonder &lt;CACHE... /&gt;)?
 		6000=Guid
 		6001=Naam
 		6002=Track#
@@ -676,15 +684,15 @@
 		6104=Cassiopeia
 		6105=Zwaan
 		6106=Zuiderkruis
-    7300=Straat / POI
-    7301=Stad
-    7302=Zoeken
-    7303=Annuleren
-    7304=Amsterdam
-    7305=centraal station
-    7306=zoeken...
-    7307=geannuleerd door gebruiker
-    7308=Kan geen verbinding
+		7300=Straat / POI
+		7301=Stad
+		7302=Zoeken
+		7303=Annuleren
+		7304=Amsterdam
+		7305=centraal station
+		7306=zoeken...
+		7307=geannuleerd door gebruiker
+		7308=Kan geen verbinding
     {..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-12-21 08:51:20 UTC (rev 2376)
+++ trunk/res_noewe/languages/PL.cfg	2009-12-22 10:04:03 UTC (rev 2377)
@@ -818,6 +818,7 @@
                 5519=Informacje
                 5520=Tylko zadane maksimum zostalo wczytane.%0aPowtorz pozniej by znalezc inne skrzynki.%0aZadna z dotychczasowych skrzynek nie zostala updateowana.
                 5521=Strona+
+                5522=Sprawdz starszych plik%f3w XML (bez &lt;CACHE... /&gt;)?
                 6000=Przewodnik
                 6001=Nazwa
                 6002=sciezka#

Modified: trunk/src/CacheWolf/Rebuild.java
===================================================================
--- trunk/src/CacheWolf/Rebuild.java	2009-12-21 08:51:20 UTC (rev 2376)
+++ trunk/src/CacheWolf/Rebuild.java	2009-12-22 10:04:03 UTC (rev 2377)
@@ -9,7 +9,6 @@
 import ewe.ui.ProgressBarForm;
 
 public class Rebuild {
-	String [] xmlFiles;
 	private int cacheXmlVersion;
 	private int startOfCacheDetails;
 
@@ -22,81 +21,68 @@
 
 		myProgressBarForm pbf = new myProgressBarForm();
 		Handle h = new Handle();
-		pbf.setTask(h,MyLocale.getMsg(209,&quot;Rebuilding index&quot;));
-		pbf.exec();
 
-		FileBugfix file=new FileBugfix(Global.getProfile().dataDir);
-		xmlFiles=file.list(&quot;*.xml&quot;,0);
 		int orphans=0; // xml Files without entry in database : Changed to all entries!!!
 		int nAdded=0;  // caches added to database
-		for (i=0; i&lt;xmlFiles.length; i++) {
-			int pos=xmlFiles[i].lastIndexOf('.');
-			if (pos&lt;0) continue;
-			String wayPoint=xmlFiles[i].substring(0,pos).toUpperCase();
-			if (wayPoint.equalsIgnoreCase(&quot;index&quot;))	// Check for index.xml and index.bak
-				xmlFiles[i]=null;   				// Remove (existing caches) or index.xml
-			else {
-				//ewe.sys.Vm.debug(&quot;Orphan: &quot;+wayPoint);
-				orphans++;
-				int cacheIndex=prof.getCacheIndex(wayPoint);
-				if (cacheIndex &gt; -1) {
-					// In older Versions of CW the &lt;CACHE... /&gt; line was not stored in the cache.xml
-					// therefore get it from the index.xml (prof.cacheDB) and put it into the cache.xml
-					getCacheDetails(prof.dataDir+xmlFiles[i]);
-					if (startOfCacheDetails &lt; 0) {
-						CacheHolder ch=prof.cacheDB.get(cacheIndex);
-						ch.save();
+		boolean checkOlder;
+		MessageBox mBox = new MessageBox(&quot;&quot;, MyLocale.getMsg(5522,&quot;Check for older Versions xml-Files ( without &lt;CACHE... /&gt; )&quot;) , FormBase.IDYES |FormBase.IDNO);
+		if (mBox.execute() == FormBase.IDOK){checkOlder=true;}
+		else {checkOlder=false;}
+		// still time consuming the list files
+		pbf.setTask(h, &quot;Reading Directory, be patient&quot;);
+		pbf.exec();
+		h.progress=(float) 0.5;
+		h.changed();
+		String[] CacheFiles = new FileBugfix(prof.dataDir).list(&quot;*.xml&quot;, FileBase.LIST_FILES_ONLY|FileBase.LIST_DONT_SORT);
+		pbf.setTask(h,&quot;checking XML-files&quot;);
+		for (i=0; i&lt;CacheFiles.length; i++) {
+				int pos=CacheFiles[i].lastIndexOf('.');
+				if (pos&lt;0) continue;
+				String wayPoint=CacheFiles[i].substring(0,pos).toUpperCase();
+				if (wayPoint.equalsIgnoreCase(&quot;index&quot;))	// Check for index.xml and index.bak
+					CacheFiles[i]=null;   				// Remove (existing caches) or index.xml
+				else {
+					//ewe.sys.Vm.debug(&quot;Orphan: &quot;+wayPoint);
+					orphans++;
+					h.progress = ((float)(orphans)/(float)CacheFiles.length);
+					h.changed();
+					if (checkOlder) {
+						int cacheIndex=prof.getCacheIndex(wayPoint);
+						if (cacheIndex &gt; -1) {
+							// In older Versions of CW the &lt;CACHE... /&gt; line was not stored in the cache.xml
+							// therefore get it from the index.xml (prof.cacheDB) and put it into the cache.xml
+							getCacheDetails(prof.dataDir+CacheFiles[i]);
+							if (startOfCacheDetails &lt; 0) {
+								CacheHolder ch=prof.cacheDB.get(cacheIndex);
+								ch.save();
+							}
+							// prof.cacheDB.removeElementAt(cacheIndex);
+						}
 					}
-					// prof.cacheDB.removeElementAt(cacheIndex);
 				}
-			}
 		}
 		prof.cacheDB.clear(); //easier than removeElementAt
+		pbf.setTask(h,MyLocale.getMsg(209,&quot;Rebuilding index&quot;));
 		if (orphans&gt;0) { // At least one cache not in database
 			int nProcessed=0;
 			// Now do the actual work
-			for(i = 0; i&lt;xmlFiles.length; i++){
-				if (xmlFiles[i]!=null) {
+			for(i = 0; i&lt;CacheFiles.length; i++){
+				if (CacheFiles[i]!=null) {
 					h.progress = ((float)nProcessed++)/(float)(orphans);
 					h.changed();
-					String details=getCacheDetails(prof.dataDir+xmlFiles[i]);
+					String details=getCacheDetails(prof.dataDir+CacheFiles[i]);
 					if (details!=null) {
 						CacheHolder ch=new CacheHolder(details, cacheXmlVersion);
 						prof.cacheDB.add(ch);
 						nAdded++;
-						xmlFiles[i]=null;
-					} else Global.getPref().log(&quot;File &quot;+xmlFiles[i]+&quot; not in index.xml&quot;);
+						CacheFiles[i]=null;
+					} else Global.getPref().log(&quot;File &quot;+CacheFiles[i]+&quot; not in index.xml&quot;);
 				}
 				if (pbf.isClosed) break;
 			}
-			(new MessageBox(MyLocale.getMsg(327, &quot;Information&quot;),
-					  MyLocale.getMsg(210,&quot;Caches deleted: &quot;)+orphans+
-					  MyLocale.getMsg(211,&quot;\nCaches added: &quot;)+nAdded
-					, FormBase.OKB)).execute();
 			prof.buildReferences();
 			prof.saveIndex(Global.getPref(),true);
 		}
-		if (orphans!=nAdded &amp;&amp; (new MessageBox(MyLocale.getMsg(327, &quot;Information&quot;),
-					MyLocale.getMsg(212,&quot;Delete all .xml files not in index.xml and associated pictures&quot;),
-					FormBase.YESB | FormBase.NOB)).execute()==FormBase.YESB) {
-			h = new Handle();
-			pbf.setTask(h,MyLocale.getMsg(213,&quot;Deleting orphans&quot;));
-			DataMover dm=new DataMover();
-			int nDeleted=0;
-			String[] CacheFiles = new FileBugfix(prof.dataDir).list(null, FileBase.LIST_FILES_ONLY|FileBase.LIST_DONT_SORT);
-			for (i=0; i&lt;xmlFiles.length; i++) {
-				if (xmlFiles[i]!=null){
-					h.progress = ((float)nDeleted++)/(float)(orphans-nAdded);
-					h.changed();
-					int dotPos = xmlFiles[i].indexOf('.');
-					if (dotPos &gt; 0) {
-					    // This may appear when there are directories in the profile
-					    String wayPoint=xmlFiles[i].substring(0,dotPos);
-					    dm.deleteCacheFiles(wayPoint,prof.dataDir,CacheFiles);
-					}
-				}
-			}
-		}
 		pbf.exit(0);
 	}
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002300.html">[Cachewolf-svn] r2376 - trunk/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="002302.html">[Cachewolf-svn] r2378 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2301">[ date ]</a>
              <a href="thread.html#2301">[ thread ]</a>
              <a href="subject.html#2301">[ subject ]</a>
              <a href="author.html#2301">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
