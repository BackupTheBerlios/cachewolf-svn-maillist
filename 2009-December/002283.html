<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2359 - in trunk: res_noewe/languages	src/CacheWolf/exp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2359%20-%20in%20trunk%3A%20res_noewe/languages%0A%09src/CacheWolf/exp&In-Reply-To=%3C200912122226.nBCMQDZ9022019%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002282.html">
   <LINK REL="Next"  HREF="002284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2359 - in trunk: res_noewe/languages	src/CacheWolf/exp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2359%20-%20in%20trunk%3A%20res_noewe/languages%0A%09src/CacheWolf/exp&In-Reply-To=%3C200912122226.nBCMQDZ9022019%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2359 - in trunk: res_noewe/languages	src/CacheWolf/exp">araber95 at mail.berlios.de
       </A><BR>
    <I>Sat Dec 12 23:26:13 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002282.html">[Cachewolf-svn] r2358 - trunk/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="002284.html">[Cachewolf-svn] r2360 - in trunk: lib src/CacheWolf	src/CacheWolf/imp src/CacheWolf/navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2283">[ date ]</a>
              <a href="thread.html#2283">[ thread ]</a>
              <a href="subject.html#2283">[ subject ]</a>
              <a href="author.html#2283">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2009-12-12 23:26:10 +0100 (Sat, 12 Dec 2009)
New Revision: 2359

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/exp/GpxExportNg.java
Log:
changed Menupoint from mapsource to (NG development)
changed newline to crlf
lat/lon nr of decimals limit to 6
made Style export MyFinds work


Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-12-12 22:07:30 UTC (rev 2358)
+++ trunk/res_noewe/languages/DE.cfg	2009-12-12 22:26:10 UTC (rev 2359)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{de}
 		100=nach HTML
-		101=nach GPX Mapsource
+		101=nach GPX (NG Entwicklung)
 		102=nach TOP50 ASCII
 		103=nach GPX
 		104=nach CSV

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-12-12 22:07:30 UTC (rev 2358)
+++ trunk/res_noewe/languages/EN.cfg	2009-12-12 22:26:10 UTC (rev 2359)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{en}
 		100=to HTML
-		101=to GPX Mapsource
+		101=to GPX (NG Development)
 		102=to TOP50 ASCII
 		103=to GPX
 		104=to ASC

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-12-12 22:07:30 UTC (rev 2358)
+++ trunk/res_noewe/languages/FR.cfg	2009-12-12 22:26:10 UTC (rev 2359)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{fr}
 		100=vers HTML
-		101=vers GPX Mapsource
+		101=vers GPX (NG D%e9veloppement)
 		102=vers TOP50 ASCII
 		103=vers GPX
 		104=vers CSV

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-12-12 22:07:30 UTC (rev 2358)
+++ trunk/res_noewe/languages/NL.cfg	2009-12-12 22:26:10 UTC (rev 2359)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{nl}
 		100=naar HTML
-		101=naar GPX MapSource
+		101=naar GPX Ontwikkeling
 		102=naar TOP50 ASCII
 		103=naar GPX
 		104=naar CSV

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-12-12 22:07:30 UTC (rev 2358)
+++ trunk/res_noewe/languages/PL.cfg	2009-12-12 22:26:10 UTC (rev 2359)
@@ -2,7 +2,7 @@
         {LocalResources}
                 {pl}
                 100=HTML
-                101=GPX Mapsource
+                101=GPX Rozw%f6j
                 102=TOP50 ASCII
                 103=GPX
                 104=ASC

Modified: trunk/src/CacheWolf/exp/GpxExportNg.java
===================================================================
--- trunk/src/CacheWolf/exp/GpxExportNg.java	2009-12-12 22:07:30 UTC (rev 2358)
+++ trunk/src/CacheWolf/exp/GpxExportNg.java	2009-12-12 22:26:10 UTC (rev 2359)
@@ -59,7 +59,10 @@
  * can be accomplished with GPX
  */
 public class GpxExportNg {
-
+	/** new line */
+	final static String newLine=&quot;\r\n&quot;;
+	/** decimal separator for lat- and lon-String */
+	// final static char decimalSeparator='.';
 	/** export is in compact format */
 	final static int STYLE_GPX_COMPACT = 0;
 	/** export is PQ like */
@@ -94,30 +97,30 @@
 	private String finderid;
 
 	// we need to fake desc to make clients like GSAK accept additional waypoints together with caches
-	final static String GPXHEADER = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;\n&quot;
-			.concat(&quot;&lt;gpx xmlns:xsi=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance\">http://www.w3.org/2001/XMLSchema-instance\</A>&quot; xmlns:xsd=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema\">http://www.w3.org/2001/XMLSchema\</A>&quot; version=\&quot;1.0\&quot; creator=\&quot;CacheWolf\&quot; xsi:schemaLocation=\&quot;<A HREF="http://www.topografix.com/GPX/1/0">http://www.topografix.com/GPX/1/0</A> <A HREF="http://www.topografix.com/GPX/1/0/gpx.xsd">http://www.topografix.com/GPX/1/0/gpx.xsd</A> <A HREF="http://www.groundspeak.com/cache/1/0">http://www.groundspeak.com/cache/1/0</A> <A HREF="http://www.groundspeak.com/cache/1/0/cache.xsd\">http://www.groundspeak.com/cache/1/0/cache.xsd\</A>&quot; xmlns=\&quot;<A HREF="http://www.topografix.com/GPX/1/0\">http://www.topografix.com/GPX/1/0\</A>&quot;&gt;\n&quot;)
-			.concat(&quot;&lt;name&gt;Waypoints for Cache Listings, Generated by CacheWolf&lt;/name&gt;\n&quot;)
-			.concat(&quot;&lt;desc&gt;This is an individual cache generated from Geocaching.com&lt;/desc&gt;\n&quot;)
-			.concat(&quot;&lt;author&gt;Various users from geocaching.com and/or opencaching.de&lt;/author&gt;\n&quot;)
-			.concat(&quot;&lt;email&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">contact at cachewolf.de</A>&lt;/email&gt;\n&quot;)
-			.concat(&quot;&lt;url&gt;<A HREF="http://www.cachewolf.de/&lt;/url">http://www.cachewolf.de/&lt;/url</A>&gt;\n&quot;)
-			.concat(&quot;&lt;urlname&gt;CacheWolf - Paperless Geocaching&lt;/urlname&gt;\n&quot;)
-			.concat(&quot;&lt;time&gt;@@CREATEDATE@@T00:00:00Z&lt;/time&gt;\n&quot;)
-			.concat(&quot;&lt;keywords&gt;cache, geocache, waypoints&lt;/keywords&gt;\n&quot;)
+	final static String GPXHEADER = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;+newLine
+			.concat(&quot;&lt;gpx xmlns:xsi=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance\">http://www.w3.org/2001/XMLSchema-instance\</A>&quot; xmlns:xsd=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema\">http://www.w3.org/2001/XMLSchema\</A>&quot; version=\&quot;1.0\&quot; creator=\&quot;CacheWolf\&quot; xsi:schemaLocation=\&quot;<A HREF="http://www.topografix.com/GPX/1/0">http://www.topografix.com/GPX/1/0</A> <A HREF="http://www.topografix.com/GPX/1/0/gpx.xsd">http://www.topografix.com/GPX/1/0/gpx.xsd</A> <A HREF="http://www.groundspeak.com/cache/1/0">http://www.groundspeak.com/cache/1/0</A> <A HREF="http://www.groundspeak.com/cache/1/0/cache.xsd\">http://www.groundspeak.com/cache/1/0/cache.xsd\</A>&quot; xmlns=\&quot;<A HREF="http://www.topografix.com/GPX/1/0\">http://www.topografix.com/GPX/1/0\</A>&quot;&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;name&gt;@@NAME@@&lt;/name&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;desc&gt;This is an individual cache generated from Geocaching.com&lt;/desc&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;author&gt;Various users from geocaching.com and/or opencaching.de&lt;/author&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;email&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">contact at cachewolf.de</A>&lt;/email&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;url&gt;<A HREF="http://www.cachewolf.de/&lt;/url">http://www.cachewolf.de/&lt;/url</A>&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;urlname&gt;CacheWolf - Paperless Geocaching&lt;/urlname&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;time&gt;@@CREATEDATE@@T00:00:00.0000000-07:00&lt;/time&gt;&quot;.concat(newLine))
+			.concat(&quot;&lt;keywords&gt;cache, geocache, waypoints&lt;/keywords&gt;&quot;.concat(newLine))
 	// TODO: is it worth a second loop?
 	// .concat(&quot;&lt;bounds minlat=\&quot;50.91695\&quot; minlon=\&quot;6.876383\&quot; maxlat=\&quot;50.935183\&quot; maxlon=\&quot;6.918817\&quot; /&gt;&quot;)
 	;
 
-	final static String GPXLOG = &quot;\t\t\t\t&lt;groundspeak:log id=\&quot;@@LOGID@@\&quot;&gt;\n&quot;
-			.concat(&quot;\t\t\t\t\t&lt;groundspeak:date&gt;@@LOGDATE@@T00:00:00&lt;/groundspeak:date&gt;\n&quot;)
-			.concat(&quot;\t\t\t\t\t&lt;groundspeak:type&gt;@@LOGTYPE@@&lt;/groundspeak:type&gt;\n&quot;)
-			.concat(&quot;\t\t\t\t\t&lt;groundspeak:finder id=\&quot;@@LOGFINDERID@@\&quot;&gt;@@LOGFINDER@@&lt;/groundspeak:finder&gt;\n&quot;)
-			.concat(&quot;\t\t\t\t\t&lt;groundspeak:text encoded=\&quot;@@LOGENCODE@@\&quot;&gt;@@LOGTEXT@@&lt;/groundspeak:text&gt;\n&quot;)
-			.concat(&quot;\t\t\t\t&lt;/groundspeak:log&gt;\n&quot;);
+	final static String GPXLOG = &quot;\t\t\t\t&lt;groundspeak:log id=\&quot;@@LOGID@@\&quot;&gt;&quot;.concat(newLine)
+			.concat(&quot;\t\t\t\t\t&lt;groundspeak:date&gt;@@LOGDATE@@T00:00:00&lt;/groundspeak:date&gt;&quot;.concat(newLine))
+			.concat(&quot;\t\t\t\t\t&lt;groundspeak:type&gt;@@LOGTYPE@@&lt;/groundspeak:type&gt;&quot;.concat(newLine))
+			.concat(&quot;\t\t\t\t\t&lt;groundspeak:finder id=\&quot;@@LOGFINDERID@@\&quot;&gt;@@LOGFINDER@@&lt;/groundspeak:finder&gt;&quot;.concat(newLine))
+			.concat(&quot;\t\t\t\t\t&lt;groundspeak:text encoded=\&quot;@@LOGENCODE@@\&quot;&gt;@@LOGTEXT@@&lt;/groundspeak:text&gt;&quot;.concat(newLine))
+			.concat(&quot;\t\t\t\t&lt;/groundspeak:log&gt;&quot;.concat(newLine));
 
-	final static String GPXTB = &quot;\t\t\t\t&lt;groundspeak:travelbug id=\&quot;@@TBID@@\&quot; ref=\&quot;@@TBREF@@\&quot;&gt;\n&quot;
-			.concat(&quot;\t\t\t\t\t&lt;groundspeak:name&gt;@@TBNAME@@&lt;/groundspeak:name&gt;\n&quot;)
-			.concat(&quot;\t\t\t\t&lt;/groundspeak:travelbug&gt;\n&quot;);
+	final static String GPXTB = &quot;\t\t\t\t&lt;groundspeak:travelbug id=\&quot;@@TBID@@\&quot; ref=\&quot;@@TBREF@@\&quot;&gt;&quot;.concat(newLine)
+			.concat(&quot;\t\t\t\t\t&lt;groundspeak:name&gt;@@TBNAME@@&lt;/groundspeak:name&gt;&quot;.concat(newLine))
+			.concat(&quot;\t\t\t\t&lt;/groundspeak:travelbug&gt;&quot;.concat(newLine));
 
 	// FIXME: don't use this until GPX import can strip this off as well
 	final static String GPXADDIINMAIN = &quot;@@ADDIID@@ - @@ADDISHORT@@@@ADDIDELIM@@&quot;
@@ -304,7 +307,7 @@
 					String key = (String) keys.nextElement();
 					PrintWriter writer = (PrintWriter) fileHandles.get(key);
 
-					writer.print(&quot;&lt;/gpx&gt;\n&quot;);
+					writer.print(&quot;&lt;/gpx&gt;&quot;.concat(newLine));
 					writer.close();
 					if (exportTarget == OUTPUT_POI) {
 						poiCounter++;
@@ -439,7 +442,7 @@
 
 				pbf.exit(0);
 
-				outp.print(&quot;&lt;/gpx&gt;\n&quot;);
+				outp.print(&quot;&lt;/gpx&gt;&quot;.concat(newLine));
 				outp.close();
 			} catch (Exception ex) {
 				exportErrors++;
@@ -517,7 +520,7 @@
 				ret.append(formatPqExtensions(ch));
 			}
 
-			ret.append(&quot;  &lt;/wpt&gt;\n&quot;);
+			ret.append(&quot;  &lt;/wpt&gt;&quot;.concat(newLine));
 		} catch (IllegalArgumentException e) {
 			exportErrors++;
 			ch.setIncomplete(true);
@@ -541,31 +544,31 @@
 
 		StringBuffer ret = new StringBuffer();
 
-//			.concat(&quot;\t\t&lt;desc&gt;@@WPDESC@@&lt;/desc&gt;\n&quot;)
+//			.concat(&quot;\t\t&lt;desc&gt;@@WPDESC@@&lt;/desc&gt;&quot;.concat(newLine))
 
-		ret.append(&quot;  &lt;wpt lat=\&quot;&quot;+String.valueOf(ch.pos.latDec).replace(',', '.')+&quot;\&quot; lon=\&quot;&quot;+String.valueOf(ch.pos.lonDec).replace(',', '.')+&quot;\&quot;&gt;\n&quot;);
+		ret.append(&quot;  &lt;wpt lat=\&quot;&quot;+ch.pos.getLatDeg(CWPoint.DD)+&quot;\&quot; lon=\&quot;&quot;+ch.pos.getLonDeg(CWPoint.DD)+&quot;\&quot;&gt;&quot;.concat(newLine));
 
 		if (exportStyle != STYLE_GPX_COMPACT) {
 			if (ch.isAddiWpt()) {
 				try {
-					ret.append(&quot;    &lt;time&gt;&quot;+ch.mainCache.getDateHidden()+&quot;T00:00:00&lt;/time&gt;\n&quot;);
+					ret.append(&quot;    &lt;time&gt;&quot;+ch.mainCache.getDateHidden()+&quot;T00:00:00&lt;/time&gt;&quot;.concat(newLine));
 				} catch (Exception e) {
 					Global.getPref().log(ch.getWayPoint() + &quot; has no parent&quot;);
 					exportErrors++;
-					ret.append(&quot;    &lt;time&gt;1970-01-01T00:00:00&lt;/time&gt;\n&quot;);
+					ret.append(&quot;    &lt;time&gt;1970-01-01T00:00:00&lt;/time&gt;&quot;.concat(newLine));
 				}
 			} else if (ch.isCustomWpt()) {
-				ret.append(&quot;    &lt;time&gt;1970-01-01T00:00:00&lt;/time&gt;\n&quot;);
+				ret.append(&quot;    &lt;time&gt;1970-01-01T00:00:00&lt;/time&gt;&quot;.concat(newLine));
 			} else {
-				ret.append(&quot;    &lt;time&gt;&quot;+ch.getDateHidden()+&quot;T00:00:00&lt;/time&gt;\n&quot;);
+				ret.append(&quot;    &lt;time&gt;&quot;+ch.getDateHidden()+&quot;T00:00:00&lt;/time&gt;&quot;.concat(newLine));
 			}
 		}
 
 		if (exportIds == WPNAME_ID_SMART) {
 			if (ch.isAddiWpt()) {
-				ret.append(&quot;    &lt;name&gt;&quot;.concat(SafeXML.cleanGPX(ch.mainCache.getWayPoint().concat(&quot; &quot;).concat(ch.getWayPoint().substring(0, 2)))).concat(&quot;&lt;/name&gt;\n&quot;));
+				ret.append(&quot;    &lt;name&gt;&quot;.concat(SafeXML.cleanGPX(ch.mainCache.getWayPoint().concat(&quot; &quot;).concat(ch.getWayPoint().substring(0, 2)))).concat(&quot;&lt;/name&gt;&quot;.concat(newLine)));
 			} else if (ch.isCustomWpt()) {
-				ret.append(&quot;    &lt;name&gt;&quot;.concat(SafeXML.cleanGPX(ch.getWayPoint())).concat(&quot;&lt;/name&gt;\n&quot;));
+				ret.append(&quot;    &lt;name&gt;&quot;.concat(SafeXML.cleanGPX(ch.getWayPoint())).concat(&quot;&lt;/name&gt;&quot;.concat(newLine)));
 			} else {
 				ret.append(&quot;    &lt;name&gt;&quot;.concat(SafeXML.cleanGPX(ch.getWayPoint())
 						.concat(&quot; &quot;)
@@ -574,64 +577,64 @@
 						.concat(String.valueOf(ch.getTerrain()))
 						.concat(CacheSize.getExportShortId(ch.getCacheSize())))
 						.concat(String.valueOf(ch.getNoFindLogs()))
-						.concat(&quot;&lt;/name&gt;\n&quot;));
+						.concat(&quot;&lt;/name&gt;&quot;.concat(newLine)));
 			}
 		} else if (exportIds == WPNAME_NAME_SMART) {
 			// TBD
 		} else {
-			ret.append(&quot;    &lt;name&gt;&quot;.concat(SafeXML.cleanGPX(ch.getWayPoint())).concat(&quot;&lt;/name&gt;\n&quot;));
+			ret.append(&quot;    &lt;name&gt;&quot;.concat(SafeXML.cleanGPX(ch.getWayPoint())).concat(&quot;&lt;/name&gt;&quot;.concat(newLine)));
 		}
 
 		// no &lt;cmt&gt; for custom
 		if (!ch.isCustomWpt()) {
 			if (exportIds == WPNAME_ID_SMART &amp;&amp; exportStyle == STYLE_GPX_COMPACT) {
 				if (ch.isAddiWpt()) {
-					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + ch.getFreshDetails().LongDescription)).concat(&quot;&lt;/cmt&gt;\n&quot;));
+					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + ch.getFreshDetails().LongDescription)).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
 				} else {
-					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + Common.rot13(ch.getFreshDetails().Hints))).concat(&quot;&lt;/cmt&gt;\n&quot;));
+					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + Common.rot13(ch.getFreshDetails().Hints))).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
 				}
 			} else if (exportIds == WPNAME_NAME_SMART) {
 				// TBD
 			} else {
 				if (ch.isAddiWpt()) {
-					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)).concat(&quot;&lt;/cmt&gt;\n&quot;));
+					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
 				} // caches have no &lt;cmt&gt; in gc.com PQs
 			}
 		}
 
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
-			ret.append(&quot;    &lt;desc&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName())).concat(&quot;&lt;/desc&gt;\n&quot;));
+			ret.append(&quot;    &lt;desc&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName())).concat(&quot;&lt;/desc&gt;&quot;.concat(newLine)));
 		} else {
 			ret.append(&quot;    &lt;desc&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName().concat(&quot; by &quot;).concat(ch.getCacheOwner()).concat(&quot;, &quot;)
 					.concat(CacheType.sym2GpxString(ch.getType()))
 					.concat(&quot; (&quot;).concat(CacheTerrDiff.shortDT(ch.getHard()))
 					.concat(&quot;/&quot;).concat(CacheTerrDiff.shortDT(ch.getTerrain())).concat(&quot;)&quot;)))
-					.concat(&quot;&lt;/desc&gt;\n&quot;));
+					.concat(&quot;&lt;/desc&gt;&quot;.concat(newLine)));
 		}
 
 		if (exportStyle != STYLE_GPX_COMPACT) {
 			if (!ch.isCustomWpt()) {
-				ret.append(&quot;    &lt;url&gt;&quot;.concat(ch.details.URL).concat(&quot;&lt;/url&gt;\n&quot;));
-				ret.append(&quot;    &lt;urlname&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName())).concat(&quot;&lt;/urlname&gt;\n&quot;));
+				ret.append(&quot;    &lt;url&gt;&quot;.concat(ch.details.URL).concat(&quot;&lt;/url&gt;&quot;.concat(newLine)));
+				ret.append(&quot;    &lt;urlname&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName())).concat(&quot;&lt;/urlname&gt;&quot;.concat(newLine)));
 			}
 		}
 
 		if (customIcons) {
-			ret.append(&quot;    &lt;sym&gt;&quot;.concat(poiMapper.getIcon(ch)).concat(&quot;&lt;/sym&gt;\n&quot;));
+			ret.append(&quot;    &lt;sym&gt;&quot;.concat(poiMapper.getIcon(ch)).concat(&quot;&lt;/sym&gt;&quot;.concat(newLine)));
 		} else {
 			if (ch.isAddiWpt()) {
-				ret.append(&quot;    &lt;sym&gt;&quot;.concat(CacheType.sym2GpxString(ch.getType())).concat(&quot;&lt;/sym&gt;\n&quot;));
+				ret.append(&quot;    &lt;sym&gt;&quot;.concat(CacheType.sym2GpxString(ch.getType())).concat(&quot;&lt;/sym&gt;&quot;.concat(newLine)));
 			} else if (ch.isCustomWpt()) {
-				ret.append(&quot;    &lt;sym&gt;Custom&lt;/sym&gt;\n&quot;);
+				ret.append(&quot;    &lt;sym&gt;Custom&lt;/sym&gt;&quot;.concat(newLine));
 			} else if (ch.is_found()) {
-				ret.append(&quot;    &lt;sym&gt;Geocache found&lt;/sym&gt;\n&quot;);
+				ret.append(&quot;    &lt;sym&gt;Geocache found&lt;/sym&gt;&quot;.concat(newLine));
 			} else {
-				ret.append(&quot;    &lt;sym&gt;Geocache&lt;/sym&gt;\n&quot;);
+				ret.append(&quot;    &lt;sym&gt;Geocache&lt;/sym&gt;&quot;.concat(newLine));
 			}
 		}
 
 		if (exportStyle != STYLE_GPX_COMPACT) {
-			ret.append(&quot;    &lt;type&gt;&quot;.concat(CacheType.type2GpxString(ch.getType())).concat(&quot;&lt;/type&gt;\n&quot;));
+			ret.append(&quot;    &lt;type&gt;&quot;.concat(CacheType.type2GpxString(ch.getType())).concat(&quot;&lt;/type&gt;&quot;.concat(newLine)));
 		}
 
 		return ret.toString();
@@ -647,26 +650,26 @@
 		if (ch.isCustomWpt() || ch.isAddiWpt())
 			return &quot;&quot;;
 
-		return &quot;    &lt;groundspeak:cache id=\&quot;&quot;.concat(ch.GetCacheID()).concat(&quot;\&quot; available=\&quot;&quot;).concat(ch.is_available() ? TRUE : FALSE).concat(&quot;\&quot; archived=\&quot;&quot;).concat(ch.is_archived() ? TRUE : FALSE).concat(&quot;\&quot; xmlns:groundspeak=\&quot;<A HREF="http://www.groundspeak.com/cache/1/0\">http://www.groundspeak.com/cache/1/0\</A>&quot;&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:name&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheName())).concat(&quot;&lt;/groundspeak:name&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:placed_by&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat(&quot;&lt;/groundspeak:placed_by&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:owner id=\&quot;&quot;).concat(&quot;31415&quot;).concat(&quot;\&quot;&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat(&quot;&lt;/groundspeak:owner&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:type&gt;&quot;).concat(CacheType.type2GpxString(ch.getType())).concat(&quot;&lt;/groundspeak:type&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:container&gt;&quot;).concat(CacheSize.cw2ExportString(ch.getCacheSize())).concat(&quot;&lt;/groundspeak:container&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:difficulty&gt;&quot;).concat(CacheTerrDiff.shortDT(ch.getHard())).concat(&quot;&lt;/groundspeak:difficulty&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:terrain&gt;&quot;).concat(CacheTerrDiff.shortDT(ch.getTerrain())).concat(&quot;&lt;/groundspeak:terrain&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:country&gt;&quot;).concat(SafeXML.cleanGPX(ch.details.Country)).concat(&quot;&lt;/groundspeak:country&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:state&gt;&quot;).concat(SafeXML.cleanGPX(ch.details.State)).concat(&quot;&lt;/groundspeak:state&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:short_description html=\&quot;&quot;).concat(ch.is_HTML() ? TRUE : FALSE).concat(&quot;\&quot;&gt;&lt;/groundspeak:short_description&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:long_description html=\&quot;&quot;).concat(ch.is_HTML() ? TRUE : FALSE).concat(&quot;\&quot;&gt;&quot;).concat(SafeXML.cleanGPX(formatLongDescription(ch))).concat(&quot;&lt;/groundspeak:long_description&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:encoded_hints&gt;&quot;).concat(SafeXML.cleanGPX(Common.rot13(ch.details.Hints))).concat(&quot;&lt;/groundspeak:encoded_hints&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:logs&gt;\n&quot;)
+		return &quot;    &lt;groundspeak:cache id=\&quot;&quot;.concat(ch.GetCacheID()).concat(&quot;\&quot; available=\&quot;&quot;).concat(ch.is_available() ? TRUE : FALSE).concat(&quot;\&quot; archived=\&quot;&quot;).concat(ch.is_archived() ? TRUE : FALSE).concat(&quot;\&quot; xmlns:groundspeak=\&quot;<A HREF="http://www.groundspeak.com/cache/1/0\">http://www.groundspeak.com/cache/1/0\</A>&quot;&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:name&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheName())).concat(&quot;&lt;/groundspeak:name&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:placed_by&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat(&quot;&lt;/groundspeak:placed_by&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:owner id=\&quot;&quot;).concat(&quot;31415&quot;).concat(&quot;\&quot;&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat(&quot;&lt;/groundspeak:owner&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:type&gt;&quot;).concat(CacheType.type2GpxString(ch.getType())).concat(&quot;&lt;/groundspeak:type&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:container&gt;&quot;).concat(CacheSize.cw2ExportString(ch.getCacheSize())).concat(&quot;&lt;/groundspeak:container&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:difficulty&gt;&quot;).concat(CacheTerrDiff.shortDT(ch.getHard())).concat(&quot;&lt;/groundspeak:difficulty&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:terrain&gt;&quot;).concat(CacheTerrDiff.shortDT(ch.getTerrain())).concat(&quot;&lt;/groundspeak:terrain&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:country&gt;&quot;).concat(SafeXML.cleanGPX(ch.details.Country)).concat(&quot;&lt;/groundspeak:country&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:state&gt;&quot;).concat(SafeXML.cleanGPX(ch.details.State)).concat(&quot;&lt;/groundspeak:state&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:short_description html=\&quot;&quot;).concat(ch.is_HTML() ? TRUE : FALSE).concat(&quot;\&quot;&gt;&lt;/groundspeak:short_description&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:long_description html=\&quot;&quot;).concat(ch.is_HTML() ? TRUE : FALSE).concat(&quot;\&quot;&gt;&quot;).concat(SafeXML.cleanGPX(formatLongDescription(ch))).concat(&quot;&lt;/groundspeak:long_description&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:encoded_hints&gt;&quot;).concat(SafeXML.cleanGPX(Common.rot13(ch.details.Hints))).concat(&quot;&lt;/groundspeak:encoded_hints&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:logs&gt;&quot;.concat(newLine))
 		.concat(formatLogs(ch))
-		.concat(&quot;      &lt;/groundspeak:logs&gt;\n&quot;)
-		.concat(&quot;      &lt;groundspeak:travelbugs&gt;\n&quot;)
+		.concat(&quot;      &lt;/groundspeak:logs&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:travelbugs&gt;&quot;.concat(newLine))
 //		.concat(formatTbs(ch))
-		.concat(&quot;      &lt;/groundspeak:travelbugs&gt;\n&quot;)
-		.concat(&quot;    &lt;/groundspeak:cache&gt;\n&quot;);
+		.concat(&quot;      &lt;/groundspeak:travelbugs&gt;&quot;.concat(newLine))
+		.concat(&quot;    &lt;/groundspeak:cache&gt;&quot;.concat(newLine));
 
 	}
 
@@ -695,23 +698,15 @@
 			exportlogs = logs.size();
 		}
 
+		boolean logexported=false;
 		for (int i = 0; i &lt; exportlogs; i++) {
 			String logId = Integer.toString(i);
 			Log log = logs.getLog(i);
 
-			if (exportStyle == STYLE_GPX_MYFINDS &amp;&amp; !log.getLogger().equals(Global.getPref().myAlias))
-					continue;
-
-//			if (exportStyle == STYLE_GPX_MYFINDS)
-//				logId = log.getLogId();
-
-//			ret.append(&quot;        &lt;groundspeak:log id=\&quot;&quot;.concat(log.getLogId()).concat(&quot;@@LOGID@@\&quot;&gt;\n&quot;)
-//			ret.append(&quot;        &lt;groundspeak:log id=\&quot;31415\&quot;&gt;\n&quot;
-//			.concat(&quot;          &lt;groundspeak:date&gt;&quot;).concat(log.getDate()).concat(&quot;&lt;/groundspeak:date&gt;\n&quot;)
-//			.concat(&quot;          &lt;groundspeak:type&gt;&quot;).concat(image2TypeText(log.getIcon())).concat(&quot;&lt;/groundspeak:type&gt;\n&quot;)
-//			.concat(&quot;          &lt;groundspeak:finder id=\&quot;@@LOGFINDERID@@\&quot;&gt;@@LOGFINDER@@&lt;/groundspeak:finder&gt;\n&quot;)
-//			.concat(&quot;          &lt;groundspeak:text encoded=\&quot;@@LOGENCODE@@\&quot;&gt;@@LOGTEXT@@&lt;/groundspeak:text&gt;\n&quot;)
-//			.concat(&quot;        &lt;/groundspeak:log&gt;\n&quot;));
+			if (exportStyle == STYLE_GPX_MYFINDS) {
+				if (!log.isOwnLog()) { continue; }
+				else {if (!log.isFoundLog()) { continue; } }
+			}
 			Transformer trans = new Transformer(true);
 			trans.add(new Regex(&quot;@@LOGID@@&quot;, logId));
 			trans.add(new Regex(&quot;@@LOGDATE@@&quot;, log.getDate()));
@@ -721,7 +716,21 @@
 			trans.add(new Regex(&quot;@@LOGENCODE@@&quot;, &quot;&quot;));
 			trans.add(new Regex(&quot;@@LOGTEXT@@&quot;, SafeXML.cleanGPX(log.getMessage())));
 			ret.append(trans.replaceAll(GPXLOG));
+			if (exportStyle == STYLE_GPX_MYFINDS ) {logexported = true; break;}
 		}
+		if (exportStyle == STYLE_GPX_MYFINDS &amp;&amp; !logexported) {
+			// own log is not within the saved logs
+			Transformer trans = new Transformer(true);
+			trans.add(new Regex(&quot;@@LOGID@@&quot;, &quot;0&quot;));
+			trans.add(new Regex(&quot;@@LOGDATE@@&quot;, ch.GetStatusDate()+&quot;T&quot;+ch.GetStatusTime()+&quot;:00&quot;));
+			trans.add(new Regex(&quot;@@LOGTYPE@@&quot;, &quot;Found it&quot;));
+			trans.add(new Regex(&quot;@@LOGFINDERID@@&quot;, fid));
+			trans.add(new Regex(&quot;@@LOGFINDER@@&quot;, SafeXML.cleanGPX(Global.getPref().myAlias)));
+			trans.add(new Regex(&quot;@@LOGENCODE@@&quot;, &quot;&quot;));
+			// trans.add(new Regex(&quot;@@LOGTEXT@@&quot;,ch.details == null ? &quot;&quot; : ch.details.OwnLog == null ? &quot;&quot; : SafeXML.cleanGPX(ch.details.OwnLog.getMessage())));
+			trans.add(new Regex(&quot;@@LOGTEXT@@&quot;,&quot;&quot;)); // who cares about the text ?
+			ret.append(trans.replaceAll(GPXLOG));
+		}
 
 		return ret.toString();
 	}
@@ -734,8 +743,18 @@
 		//FIXME: extend profile to add &lt;bounds minlat=\&quot;50.91695\&quot; minlon=\&quot;6.876383\&quot; maxlat=\&quot;50.935183\&quot; maxlon=\&quot;6.918817\&quot; /&gt;
 		//Global.getProfile().getSourroundingArea(false);
 		Transformer trans = new Transformer(true);
-		trans.add(new Regex(&quot;@@CREATEDATE@@&quot;, new Date().setFormat(&quot;yyyy-MM-dd&quot;).toString()));
+		trans.add(new Regex(&quot;@@CREATEDATE@@&quot;, new Date().setToCurrentTime().setFormat(&quot;yyyy-MM-dd&quot;).toString()));
+		if (exportStyle==STYLE_GPX_MYFINDS)
+			 {trans.add(new Regex(&quot;@@NAME@@&quot;,&quot;My Finds Pocket Query&quot;));}
+		else {trans.add(new Regex(&quot;@@NAME@@&quot;,&quot;Waypoints for Cache Listings, Generated by CacheWolf&quot;));}
 		return trans.replaceFirst(GPXHEADER);
+		/*
+		String ret = STRreplace.replace(GPXHEADER,&quot;@@CREATEDATE@@&quot;, new Date().setToCurrentTime().setFormat(&quot;yyyy-MM-dd&quot;).toString());
+		if (exportStyle==STYLE_GPX_MYFINDS)
+			 { ret=STRreplace.replace(ret,&quot;@@NAME@@&quot;,&quot;My Finds Pocket Query&quot;);}
+		else { ret=STRreplace.replace(ret,&quot;@@NAME@@&quot;,&quot;Waypoints for Cache Listings, Generated by CacheWolf&quot;);}
+		return ret;
+		*/
 	}
 
 	/**
@@ -753,15 +772,15 @@
 			if (ch.is_HTML()) {
 				delim = &quot;&lt;br /&gt;&quot;;
 			} else {
-				delim = &quot;\n&quot;;
+				delim = newLine;
 			}
 			// FIXME: format is not quite right yet
 			// FIXME: cut Addis off in GPXimporter otherwise people who use GPX to feed CacheWolf have them doubled
 			if (ch.addiWpts.size() &gt; 0 &amp;&amp; exportStyle != STYLE_GPX_MYFINDS) {
 				if (ch.is_HTML()) {
-					ret.append(&quot;\n\n&lt;p&gt;Additional Waypoints&lt;/p&gt;&quot;);
+					ret.append(newLine.concat(newLine)+&quot;&lt;p&gt;Additional Waypoints&lt;/p&gt;&quot;);
 				} else {
-					ret.append(&quot;\n\nAdditional Waypoints\n&quot;);
+					ret.append(newLine.concat(newLine)+&quot;Additional Waypoints&quot;.concat(newLine));
 				}
 
 				Iterator iter = ch.addiWpts.iterator();
@@ -776,7 +795,7 @@
 					trans.add(new Regex(&quot;@@ADDILONG@@&quot;,addi.getFreshDetails().LongDescription));
 					ret.append(trans.replaceAll(GPXADDIINMAIN));
 				}
-				ret.append(delim).append(&quot;\n&quot;);
+				ret.append(delim).append(newLine);
 			}
 			return ret.toString();
 		}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002282.html">[Cachewolf-svn] r2358 - trunk/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="002284.html">[Cachewolf-svn] r2360 - in trunk: lib src/CacheWolf	src/CacheWolf/imp src/CacheWolf/navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2283">[ date ]</a>
              <a href="thread.html#2283">[ thread ]</a>
              <a href="subject.html#2283">[ subject ]</a>
              <a href="author.html#2283">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
