<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2445 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2010-February/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2445%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C201002052020.o15KKsLS003534%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="002371.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2445 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2445%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C201002052020.o15KKsLS003534%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2445 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Fri Feb  5 21:20:54 CET 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="002371.html">[Cachewolf-svn] r2446 - in trunk: res_noewe src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2370">[ date ]</a>
              <a href="thread.html#2370">[ thread ]</a>
              <a href="subject.html#2370">[ subject ]</a>
              <a href="author.html#2370">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2010-02-05 21:20:47 +0100 (Fri, 05 Feb 2010)
New Revision: 2445

Modified:
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/CacheSize.java
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
changed spider.def for UMTS internet access
and checking for changed CacheType and CacheSize.
doing the log.txt more readable on windows (CRLF / LF)
Cachesize.java changed for checking in listpage output.


Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/res_noewe/languages/EN.cfg	2010-02-05 20:20:47 UTC (rev 2445)
@@ -31,7 +31,7 @@
 		127=Save
 		128=via Template
 		129=from GPX file
-		130=from opencaching de, pl, cz, uk
+		130=from opencaching
 		131=from geocaching.com
 		132=to Explorist
 		133=Search all

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/res_noewe/languages/FR.cfg	2010-02-05 20:20:47 UTC (rev 2445)
@@ -31,7 +31,7 @@
 		127=Enregistrer
 		128=par Template
 		129=de GPX Fichier
-		130=de opencaching de, pl, cz, uk
+		130=de opencaching
 		131=de geocaching.com
 		132=vers Explorist
 		133=Cherche toutes

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/res_noewe/languages/NL.cfg	2010-02-05 20:20:47 UTC (rev 2445)
@@ -31,7 +31,7 @@
 		127=Opslaan
 		128=Via sjabloon
 		129=van GPX Bestand
-		130=van opencaching de, pl, cz, uk
+		130=van opencaching
 		131=van geocaching.com
 		132=Naar Explorist
 		133=Allen zoeken

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/res_noewe/languages/PL.cfg	2010-02-05 20:20:47 UTC (rev 2445)
@@ -31,7 +31,7 @@
                 127=Zapisz
                 128=Przez szablon
                 129=z GPX pliku
-                130=z Opencaching de, pl, cz, pl
+                130=z Opencaching
                 131=z geocaching.com
                 132=Explorist
                 133=Szukaj wszystkich

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/res_noewe/spider.def	2010-02-05 20:20:47 UTC (rev 2445)
@@ -64,10 +64,10 @@
 PMRex              = small_profile.gif
 distRex            = &lt;br\ /&gt;(.*?)(?:km|mi)&lt;/td&gt;
 waypointRex        = \\(GC(.*?)\\)&lt;br\ /&gt;
-TypeRex            = /WptTypes/([0-9]+).gif
-SizeRex            = /container/(.*?).gif
+TypeRex            = k&quot;&gt;&lt;img\ src=&quot;/images/WptTypes/(.*?)\\.gif
+SizeRex            = /container/(.*?)\\.gif
 DandTRex           = &lt;td&gt;((.*?)/(.*?))&lt;br
-found              = /WptTypes/check.gif
+found              = alt=&quot;Found\ It!&quot;
 own                = /WptTypes/name_tag.gif
 TBRex              = /wpttypes/([0-9]+).gif&quot; alt=&quot;(.*?)&quot;
 showOnlyFound      = &amp;f=1
@@ -123,7 +123,7 @@
 singleLogExStart   = &lt;strong&gt;
 singleLogExEnd     = &lt;small&gt;&lt;a\ href=&quot;
 # iconEx, nameTempEx, dateEx, singleLogEx werden auf einen singleLog angewendet
-iconExStart        = <A HREF="http://www.geocaching.com/images/icons/">http://www.geocaching.com/images/icons/</A>
+iconExStart        = www.geocaching.com/images/icons/
 iconExEnd          = &quot;\ alt=&quot;&quot;\ /&gt;
 nameTempExStart    = &lt;a\ href=&quot;
 nameTempExEnd      = /a&gt;
@@ -152,10 +152,10 @@
 bugExEnd           = &lt;/a&gt;&lt;/li&gt;
 bugDetailsStart    = id=&quot;ctl00_ContentBody_BugDetails_BugGoal&quot;&gt;
 bugDetailsEnd      = &lt;/span&gt;
-getBugByName       = <A HREF="http://www.geocaching.com/track/search.aspx?k=">http://www.geocaching.com/track/search.aspx?k=</A>
-getBugByGuid       = <A HREF="http://www.geocaching.com/track/details.aspx?guid=">http://www.geocaching.com/track/details.aspx?guid=</A>
-getBugById         = <A HREF="http://www.geocaching.com/track/details.aspx?id=">http://www.geocaching.com/track/details.aspx?id=</A>
-getBugByTrackNr    = <A HREF="http://www.geocaching.com/track/details.aspx?tracker=">http://www.geocaching.com/track/details.aspx?tracker=</A>
+getBugByName       = www.geocaching.com/track/search.aspx?k=
+getBugByGuid       = www.geocaching.com/track/details.aspx?guid=
+getBugById         = www.geocaching.com/track/details.aspx?id=
+getBugByTrackNr    = www.geocaching.com/track/details.aspx?tracker=
 bugGuidExStart     = www.geocaching.com/track/details.aspx?id=
 bugGuidExEnd       = &quot;
 bugNotFound        = No\ results\ were\ found\ for\ your\ search

Modified: trunk/src/CacheWolf/CacheSize.java
===================================================================
--- trunk/src/CacheWolf/CacheSize.java	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/src/CacheWolf/CacheSize.java	2010-02-05 20:20:47 UTC (rev 2445)
@@ -224,23 +224,25 @@
 	 */
 
 	public static byte gcGpxString2Cw(final String gcstring) throws IllegalArgumentException {
-		if (gcstring.equals(GC_SIZE_MICRO)) {
+		if (gcstring.equalsIgnoreCase(GC_SIZE_MICRO)) {
 			return CW_SIZE_MICRO;
-		} else if (gcstring.equals(GC_SIZE_SMALL)) {
+		} else if (gcstring.equalsIgnoreCase(GC_SIZE_SMALL)) {
 			return CW_SIZE_SMALL;
-		} else if (gcstring.equals(GC_SIZE_REGULAR)) {
+		} else if (gcstring.equalsIgnoreCase(GC_SIZE_REGULAR)) {
 			return CW_SIZE_REGULAR;
-		} else if (gcstring.equals(GC_SIZE_LARGE)) {
+		} else if (gcstring.equalsIgnoreCase(GC_SIZE_LARGE)) {
 			return CW_SIZE_LARGE;
-		} else if (gcstring.equals(GC_SIZE_NOTCHOSEN)) {
+		} else if (gcstring.equalsIgnoreCase(GC_SIZE_NOTCHOSEN)) {
 			return CW_SIZE_NOTCHOSEN;
-		} else if (gcstring.equals(GC_SIZE_OTHER)) {
+		} else if (gcstring.equalsIgnoreCase(GC_SIZE_OTHER)) {
 			return CW_SIZE_OTHER;
-		} else if (gcstring.equals(GC_SIZE_VIRTUAL)) {
+		} else if (gcstring.equalsIgnoreCase(GC_SIZE_VIRTUAL)) {
 			return CW_SIZE_VIRTUAL;
 		// GSAK exports wrong type information
-		} else if (gcstring.equals(&quot;Unknown&quot;)) {
+		} else if (gcstring.equalsIgnoreCase(&quot;Unknown&quot;)) {
 			return CW_SIZE_NOTCHOSEN;
+		} else if (gcstring.equalsIgnoreCase(&quot;not_chosen&quot;)) {
+			return CW_SIZE_NOTCHOSEN;
 		} else {
 			throw (new IllegalArgumentException(&quot;unmatched argument &quot; + gcstring + &quot; in CacheSize gcGpxString2Cw()&quot;));
 		}

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/src/CacheWolf/CacheType.java	2010-02-05 20:20:47 UTC (rev 2445)
@@ -452,14 +452,14 @@
 		if (gcType.equals(&quot;5&quot;)) { return CW_TYPE_LETTERBOX; }
 		if (gcType.equals(&quot;6&quot;)) { return CW_TYPE_EVENT; }
 		if (gcType.equals(&quot;8&quot;)) { return CW_TYPE_UNKNOWN; }
-		if (gcType.equals(&quot;9&quot;)) { return CW_TYPE_APE; }
+		if (gcType.equals(&quot;9&quot;)) { return CW_TYPE_APE; } //102
 		if (gcType.equals(&quot;11&quot;)) { return CW_TYPE_WEBCAM; }
 		if (gcType.equals(&quot;12&quot;)) { return CW_TYPE_LOCATIONLESS; }
 		if (gcType.equals(&quot;13&quot;)) { return CW_TYPE_CITO; }
-		if (gcType.equals(&quot;137&quot;)) { return CW_TYPE_EARTH; }
-		if (gcType.equals(&quot;453&quot;)) { return CW_TYPE_MEGA_EVENT; }
-		if (gcType.equals(&quot;1304&quot;)) { return CW_TYPE_MAZE; }
-		if (gcType.equals(&quot;1858&quot;)) { return CW_TYPE_WHEREIGO; }
+		if (gcType.equals(&quot;137&quot;)) { return CW_TYPE_EARTH; } //104
+		if (gcType.equals(&quot;453&quot;)) { return CW_TYPE_MEGA_EVENT; } //100
+		if (gcType.equals(&quot;1304&quot;)) { return CW_TYPE_MAZE; } //103
+		if (gcType.equals(&quot;1858&quot;)) { return CW_TYPE_WHEREIGO; } //101
 		throw new IllegalArgumentException(&quot;unmatched argument &quot;+gcType+&quot; in CacheSize gcSpider2CwType()&quot;);
 	}
 

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/src/CacheWolf/Preferences.java	2010-02-05 20:20:47 UTC (rev 2445)
@@ -46,6 +46,7 @@
 	public static final int YES = 0;
 	public static final int NO = 1;
 	public static final int ASK = 2;
+	private static String NEWLINE=&quot;\n&quot;;
 	// Hashtable is saving filter data objects the user wants to save
 	private Hashtable filterList = new Hashtable(15);
 	/** screen is big enough to hold additional information like cache notes */
@@ -103,6 +104,10 @@
 		}
 		pathToConfigFile = STRreplace.replace(p_, &quot;//&quot;, &quot;/&quot;); // this is necessary in case that the root dir is the dir where the pref.xml is stored
 		pathToConfigFile = pathToConfigFile.replace('\\', '/');
+		p=System.getProperty(&quot;os.name&quot;);
+		if (p==null || p.indexOf(&quot;indows&quot;)!=-1) {
+			NEWLINE = &quot;\r\n&quot;;
+		} 
 	}
 
 	/**
@@ -1043,7 +1048,7 @@
 				logFile = new FileWriter(LOGFILENAME, true);
 				//Stream strout = null;
 				//strout = logFile.toWritableStream(true);
-				logFile.println(text);
+				logFile.print(text+NEWLINE);
 				//Vm.debug(text); Not needed - put &lt;debug value=&quot;true&quot;&gt; into pref.xml
 			}catch(Exception ex){
 				Vm.debug(&quot;Error writing to log file!&quot;);

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2010-01-31 13:24:04 UTC (rev 2444)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2010-02-05 20:20:47 UTC (rev 2445)
@@ -135,17 +135,33 @@
 	private static String propFirstLine2;
 	private static String propMaxDistance;
 	private static String propShowOnlyFound;
-	private Regex RexPropListBlock;
-	private Regex RexPropLine;
-	private Regex RexPropLogDate;
+	private static Regex RexPropListBlock;
+	private static Regex RexPropLine;
+	private static Regex RexPropLogDate;
 	private static String propAvailable;
 	private static String propArchived;
 	private static String propFound;
 	private static String propPM;
-	private Regex RexPropDirection;
-	private Regex RexPropDistance;
-	private Regex RexPropWaypoint;
-
+	private static Regex RexPropDirection;
+	private static Regex RexPropDistance;
+	private static Regex RexPropWaypoint;
+	private static Regex RexPropType;
+	private static Regex RexPropSize;
+	private static Regex RexPropDandT;
+	private static Regex RexPropOwn;	
+	private static Regex RexLogBlock;
+	private static Extractor exSingleLog;
+	private static Extractor exIcon;
+	private static Extractor exNameTemp;
+	private static Extractor exName;
+	private static Extractor exDate;
+	private static Extractor exLog;
+	private static Extractor exLogId;
+	private static String icon_smile;
+	private static String icon_camera;
+	private static String icon_attended;
+	private static Regex RexCacheType;
+	
 	private int numFoundUpdates=0;
 	private int numArchivedUpdates=0;
 	private int numAvailableUpdates=0;
@@ -718,6 +734,22 @@
 			RexPropDirection=new Regex(p.getProp(&quot;directionRex&quot;));
 			RexPropDistance = new Regex(p.getProp(&quot;distRex&quot;));
 			RexPropWaypoint = new Regex(p.getProp(&quot;waypointRex&quot;));
+			RexPropType = new Regex(p.getProp(&quot;TypeRex&quot;));
+			RexPropSize = new Regex(p.getProp(&quot;SizeRex&quot;));
+			RexPropDandT = new Regex(p.getProp(&quot;DandTRex&quot;));
+			RexPropOwn = new Regex(p.getProp(&quot;own&quot;));
+			RexLogBlock = new Regex(p.getProp(&quot;blockRex&quot;));
+			exSingleLog = new Extractor(&quot;&quot;,p.getProp(&quot;singleLogExStart&quot;), p.getProp(&quot;singleLogExEnd&quot;), 0, false); 
+			exIcon = new Extractor(&quot;&quot;,p.getProp(&quot;iconExStart&quot;), p.getProp(&quot;iconExEnd&quot;), 0, true);
+			exNameTemp = new Extractor(&quot;&quot;,p.getProp(&quot;nameTempExStart&quot;), p.getProp(&quot;nameTempExEnd&quot;), 0 , true);
+			exName = new Extractor(&quot;&quot;, p.getProp(&quot;nameExStart&quot;), p.getProp(&quot;nameExEnd&quot;), 0 , true);
+			exDate = new Extractor(&quot;&quot;,p.getProp(&quot;dateExStart&quot;), p.getProp(&quot;dateExEnd&quot;), 0 , true);
+			exLog = new Extractor(&quot;&quot;, p.getProp(&quot;logExStart&quot;), p.getProp(&quot;logExEnd&quot;), 0, true);
+			exLogId = new Extractor(&quot;&quot;, p.getProp(&quot;logIdExStart&quot;), p.getProp(&quot;logIdExEnd&quot;), 0, true);
+			icon_smile=p.getProp(&quot;icon_smile&quot;);
+			icon_camera=p.getProp(&quot;icon_camera&quot;);
+			icon_attended=p.getProp(&quot;icon_attended&quot;);
+			RexCacheType = new Regex(p.getProp(&quot;cacheTypeRex&quot;));
 		}catch(Exception ex){
 		}
 	}
@@ -826,7 +858,9 @@
 		boolean is_available_GC=!is_archived_GC &amp;&amp; CacheDescription.indexOf(propAvailable)==-1;
 		if (is_available_GC != ch.is_available()) {
 			ch.setAvailable(is_available_GC); save=true; numAvailableUpdates+=1; ret=true;}
-		// we could check for update of terrain,difficult,size,cache type for not necessarily to load the complete cache 
+		// we could check for update of terrain,difficult,size,cache type for not necessarily to load the complete cache
+		if (typeChanged(ch,CacheDescription)) { ret=true;}
+		if (sizeChanged(ch,CacheDescription)) { ret=true;}
 		if (newLogExists(ch,CacheDescription)) {numLogUpdates+=1; ret=true;}
 		if (save) ch.save();
 		return ret;
@@ -891,6 +925,36 @@
 		if (pref.isPremium) return true;
 		return toCheck.indexOf(propPM) &lt;= 0;
 	}
+	/*
+	 * check for changed Cachetype
+	 */
+	private boolean typeChanged(CacheHolder ch, String toCheck){
+		RexPropType.search(toCheck);
+		if(RexPropType.didMatch()) {
+			String stmp=RexPropType.stringMatched(1);
+			if (Common.parseInt(stmp)==0){
+				if (stmp.equalsIgnoreCase(&quot;EarthCache&quot;)) stmp=&quot;137&quot;;
+			}
+			if(ch.getType()==CacheType.gcSpider2CwType(stmp))
+				return false;
+				else return true;
+		}
+		return false;
+	}
+	/*
+	 * check for changed CacheSize
+	 */
+	private boolean sizeChanged(CacheHolder ch, String toCheck) {
+		RexPropSize.search(toCheck);
+		if(RexPropSize.didMatch()){
+			String stmp=RexPropSize.stringMatched(1);
+			//gcSpiderString2Cw
+			if(ch.getCacheSize()==CacheSize.gcSpiderString2Cw(stmp))
+				return false;
+				else return true;
+		}
+		return false;
+	}
 
 	/**
 	 * Get the direction
@@ -992,6 +1056,7 @@
 	private int getCacheByWaypointName(CacheHolder ch, boolean isUpdate, boolean fetchImages, boolean fetchTBs, boolean doNotGetFound, boolean fetchAllLogs) {
 		int ret = SPIDER_OK; // initialize value;
 		while (true) { // retry even if failure
+			pref.log(&quot;&quot;); // new line for more overview
 			String completeWebPage;
 			int spiderTrys=0;
 			int MAX_SPIDER_TRYS=3;
@@ -1141,7 +1206,7 @@
 						//==========
 						ch.setLastSync((new Time()).format(&quot;yyyyMMddHHmmss&quot;));
 						ch.setIncomplete(false);
-						pref.log(&quot;ready &quot; + ch.getWayPoint() + &quot; : &quot;+ ch.getLastSync()+&quot;\n&quot;);
+						pref.log(&quot;ready &quot; + ch.getWayPoint() + &quot; : &quot;+ ch.getLastSync());
 						break;
 					}catch(Exception ex){
 						pref.log(&quot;Error reading cache: &quot;+ch.getWayPoint());
@@ -1305,10 +1370,9 @@
 	 * @param doc A previously fetched cachepage
 	 * @return the waypoint type (Tradi, Multi, etc.)
 	 */
-	private byte getType(String doc) throws Exception {
-		Regex inRex = new Regex(p.getProp(&quot;cacheTypeRex&quot;));
-		inRex.search(doc);
-		if(inRex.didMatch()) return CacheType.gcSpider2CwType(inRex.stringMatched(1));
+	private byte getType(String doc){
+		RexCacheType.search(doc);
+		if(RexCacheType.didMatch()) return CacheType.gcSpider2CwType(RexCacheType.stringMatched(1));
 		else return 0;
 	}
 
@@ -1318,73 +1382,62 @@
 	 * @param chD Cache Details
 	 * @return A HTML string containing the logs
 	 */
-	private LogList getLogs(String doc, CacheHolderDetail chD) throws Exception {
+	private LogList getLogs(String completeWebPage, CacheHolderDetail chD) throws Exception {
 		String icon = &quot;&quot;;
 		String name = &quot;&quot;;
 		String logText = &quot;&quot;;
 		String logId = &quot;&quot;;
+		String singleLog = &quot;&quot;;
 		LogList reslts = new LogList();
-		Regex blockRex = new Regex(p.getProp(&quot;blockRex&quot;));
-		blockRex.search(doc);
-		doc = blockRex.stringMatched(1);
-		String singleLog = &quot;&quot;;
-		Extractor exSingleLog = new Extractor(doc,p.getProp(&quot;singleLogExStart&quot;), p.getProp(&quot;singleLogExEnd&quot;), 0, false); // maybe here is some change neccessary because findnext now gives the whole endstring back???
+		RexLogBlock.search(completeWebPage);
+		String LogBlock = RexLogBlock.stringMatched(1);
+		//pref.log(LogBlock);
+		exSingleLog.setSource(LogBlock);
 		singleLog = exSingleLog.findNext();
-		Extractor exIcon = new Extractor(singleLog,p.getProp(&quot;iconExStart&quot;), p.getProp(&quot;iconExEnd&quot;), 0, true);
-		Extractor exNameTemp = new Extractor(singleLog,p.getProp(&quot;nameTempExStart&quot;), p.getProp(&quot;nameTempExEnd&quot;), 0 , true);
-		String nameTemp = &quot;&quot;;
-		nameTemp = exNameTemp.findNext();
-		Extractor exName = new Extractor(nameTemp, p.getProp(&quot;nameExStart&quot;), p.getProp(&quot;nameExEnd&quot;), 0 , true);
-		Extractor exDate = new Extractor(singleLog,p.getProp(&quot;dateExStart&quot;), p.getProp(&quot;dateExEnd&quot;), 0 , true);
-		Extractor exLog = new Extractor(singleLog, p.getProp(&quot;logExStart&quot;), p.getProp(&quot;logExEnd&quot;), 0, true);
-		Extractor exLogId = new Extractor(singleLog, p.getProp(&quot;logIdExStart&quot;), p.getProp(&quot;logIdExEnd&quot;), 0, true);
-		//Vm.debug(&quot;Log Block: &quot; + singleLog);
+		exIcon.setSource(singleLog);
+		exNameTemp.setSource(singleLog);
+		exName.setSource(exNameTemp.findNext());
+		exDate.setSource(singleLog);
+		exLog.setSource(singleLog);
+		exLogId.setSource(singleLog);
 		int nLogs=0;
-		while(exSingleLog.endOfSearch() == false){
+		boolean foundown = false;
+		while(!exSingleLog.endOfSearch()){
+			//pref.log(singleLog);
 			nLogs++;
-			//Vm.debug(&quot;--------------------------------------------&quot;);
-			//Vm.debug(&quot;Log Block: &quot; + singleLog);
-			//Vm.debug(&quot;Icon: &quot;+exIcon.findNext());
-			//Vm.debug(exName.findNext());
-			//Vm.debug(exDate.findNext());
-			//Vm.debug(exLog.findNext());
-			//Vm.debug(&quot;--------------------------------------------&quot;);
 			icon = exIcon.findNext();
 			name = exName.findNext();
 			logText = exLog.findNext();
 			logId = exLogId.findNext();
 			String d=DateFormat.logdate2YMD(exDate.findNext());
+			//pref.log(Integer.toString(nLogs)+&quot;:&quot;+icon+&quot;|logger:&quot;+name+&quot;|id:&quot;+logId+&quot;|&quot;+d);
 			// if this log says this Cache is found by me
-			if((icon.equals(p.getProp(&quot;icon_smile&quot;)) || icon.equals(p.getProp(&quot;icon_camera&quot;)) || icon.equals(p.getProp(&quot;icon_attended&quot;))) &amp;&amp;
-				(name.equalsIgnoreCase(SafeXML.clean(pref.myAlias)) || (pref.myAlias2.length()&gt;0 &amp;&amp; name.equalsIgnoreCase(SafeXML.clean(pref.myAlias2)))) )  {
+			if((icon.equals(icon_smile) || icon.equals(icon_camera) || icon.equals(icon_attended)) &amp;&amp;
+				(name.equalsIgnoreCase(SafeXML.clean(pref.myAlias)) || 
+				(pref.myAlias2.length()&gt;0 &amp;&amp; name.equalsIgnoreCase(SafeXML.clean(pref.myAlias2)))) )  {
 				chD.getParent().setFound(true);
 				chD.getParent().setCacheStatus(d);
 				chD.OwnLogId = logId;
 				chD.OwnLog = new Log(icon,d,name,logText);
+				reslts.add(new Log(icon,d,name,logText));
+				foundown=true;
+				//pref.log(&quot;own log detected!&quot;);
 			}
-			if (nLogs&lt;=pref.maxLogsToSpider) reslts.add(new Log(icon,d,name,logText));
-
+			if (nLogs&lt;=pref.maxLogsToSpider) {reslts.add(new Log(icon,d,name,logText));}
+			else {if (foundown){break;}}
 			singleLog = exSingleLog.findNext();
 			exIcon.setSource(singleLog);
 			exNameTemp.setSource(singleLog);
-			nameTemp = exNameTemp.findNext();
-			exName.setSource(nameTemp);
+			exName.setSource(exNameTemp.findNext());
 			exDate.setSource(singleLog);
 			exLog.setSource(singleLog);
 			exLogId.setSource(singleLog);
-			// We cannot simply stop if we have reached MAXLOGS just in case we are waiting for
-			// a log by our alias that happened earlier.
-			if (nLogs&gt;=pref.maxLogsToSpider &amp;&amp; 
-				chD.getParent().is_found() &amp;&amp; 
-				chD.OwnLogId.length() != 0 &amp;&amp; 
-				chD.OwnLog != null &amp;&amp; 
-				!(chD.OwnLog.getDate().equals(&quot;1900-01-01&quot;))) break;
 		}
 		if (nLogs&gt;pref.maxLogsToSpider) {
 			reslts.add(Log.maxLog());
-			pref.log(&quot;Too many logs. MAXLOGS reached (&quot;+pref.maxLogsToSpider+&quot;)&quot;);
-		} else
-			pref.log(nLogs+&quot; logs found&quot;);
+			//pref.log(&quot;MAXLOGS reached (&quot;+pref.maxLogsToSpider+&quot;)&quot;);
+		} 
+		//pref.log(nLogs+&quot; checked!&quot;);
 		return reslts;
 	}
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="002371.html">[Cachewolf-svn] r2446 - in trunk: res_noewe src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2370">[ date ]</a>
              <a href="thread.html#2370">[ thread ]</a>
              <a href="subject.html#2370">[ subject ]</a>
              <a href="author.html#2370">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
