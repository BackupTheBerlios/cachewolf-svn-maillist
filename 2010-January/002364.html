<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2439 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2010-January/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2439%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C201001291556.o0TFuHAA027737%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002363.html">
   <LINK REL="Next"  HREF="002365.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2439 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2439%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C201001291556.o0TFuHAA027737%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2439 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Fri Jan 29 16:56:17 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002363.html">[Cachewolf-svn] r2438 - trunk/src/CacheWolf/exp
</A></li>
        <LI>Next message: <A HREF="002365.html">[Cachewolf-svn] r2440 - trunk/src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2364">[ date ]</a>
              <a href="thread.html#2364">[ thread ]</a>
              <a href="subject.html#2364">[ subject ]</a>
              <a href="author.html#2364">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2010-01-29 16:56:13 +0100 (Fri, 29 Jan 2010)
New Revision: 2439

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
loading the Cachepage with all logs for found caches (extended cases on import and update).
added check for missing logID in import/update
optimized log output
updated some texts

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2010-01-29 13:58:31 UTC (rev 2438)
+++ trunk/res_noewe/languages/DE.cfg	2010-01-29 15:56:13 UTC (rev 2439)
@@ -459,15 +459,15 @@
 		1620=laden eingebundener Bilder:+
 		1621=Fehler beim Interpretieren%0a der Update-Datei,%0aDies ist vermutlich ein Fehler bei Opencaching.de%0aSp%e4ter erneut versuchen%0a Status:
 		1622=Gefundene Caches nicht laden
-		1623=Max. Anzahl:
-		1624=+Caches
+		1623=Importiere h%f6chstens
+		1624=+Cache (leer=alle)
 		1625=TBs laden
-		1626=Max. Logs:
+		1626=Speichere bis zu x Logs:
 		1627=Alle Caches
 		1628=min. Abstand:
 		1629=Richtung (leer/N/N*/N,NE,E):
 		1630=z.B. leer oder N oder N* oder N,NE,E
-		1631=Max. Updates:
+		1631=Aktualisiere h%f6chstens:
 		1700=Fehler in Zeile:
 		1701=Spalte:
 		1702=Variable nicht definiert:
@@ -824,14 +824,14 @@
 		5507=Status
 		5508=Einloggen ...
 		5509=Zentrumskoordinaten nicht gesetzt
-		5510=Spider Optionen
+		5510=Import Optionen
 		5511=Gefunden+
 		5512=+neue Caches
 		5513=Laden von:+
 		5514=%0aTravelbug:+
 		5515=Fehler beim Laden des Caches.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung.%0aNoch einmal versuchen?
 		5516=+Cachebeschreibungen%0akonnten nicht geladen werden.
-		5517=Aktualisierungen spidern?
+		5517=Aktualisierungen importieren?
 		5518=+Caches in der Datenbank sollten aktualisiert werden. Jetzt aktualisieren?
 		5519=Information
 		5520=Nur das eingestellte Maximum an Caches wurde geladen.%0aWiederholen sie das Spidern sp%e4ter um weitere Caches zu laden.%0aEs wurden keine vorhandenen Caches aktualisiert.

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2010-01-29 13:58:31 UTC (rev 2438)
+++ trunk/res_noewe/languages/EN.cfg	2010-01-29 15:56:13 UTC (rev 2439)
@@ -459,15 +459,15 @@
 		1620=downloading embedded images:+
 		1621=Error while interpreting data%0a from Opencaching.de,%0aThis is most probaly a bug at Opencaching.de%0aRetry later%0a Status:
 		1622=Exclude found caches
-		1623=Max. number:
-		1624=+caches
+		1623=Import upto:
+		1624=+caches (empty=all)
 		1625=Download TBs
-		1626=Max. logs:
+		1626=Max. save logs:
 		1627=All caches
 		1628=min. Distance:
 		1629=Direction (empty/N/N*/N,NE,E):
 		1630=e.g. blank or N or N* or N,NE,E
-		1631=Max. updates:
+		1631=Update upto:
 		1700=Error on line:
 		1701= position:
 		1702=Variable not defined:

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2010-01-29 13:58:31 UTC (rev 2438)
+++ trunk/res_noewe/spider.def	2010-01-29 15:56:13 UTC (rev 2439)
@@ -64,6 +64,12 @@
 PMRex              = small_profile.gif
 distRex            = &lt;br\ /&gt;(.*?)(?:km|mi)&lt;/td&gt;
 waypointRex        = \\(GC(.*?)\\)&lt;br\ /&gt;
+TypeRex            = /WptTypes/([0-9]+).gif
+SizeRex            = /container/(.*?).gif
+DandTRex           = &lt;td&gt;((.*?)/(.*?))&lt;br
+found              = /WptTypes/check.gif
+own                = /WptTypes/name_tag.gif
+TBRex              = /wpttypes/([0-9]+).gif&quot; alt=&quot;(.*?)&quot;
 showOnlyFound      = &amp;f=1
 maxDistance        = &amp;dist=
 firstLine          = <A HREF="http://www.geocaching.com/seek/nearest.aspx?lat=">http://www.geocaching.com/seek/nearest.aspx?lat=</A>

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2010-01-29 13:58:31 UTC (rev 2438)
+++ trunk/src/CacheWolf/MainMenu.java	2010-01-29 15:56:13 UTC (rev 2439)
@@ -842,7 +842,7 @@
 			infB.setInfo(MyLocale.getMsg(5513,&quot;Loading: &quot;) + ch.getWayPoint() +&quot; (&quot; + (j+1) + &quot; / &quot; + cachesToUpdate.size() + &quot;)&quot;);
 			infB.redisplay();
 			if (ch.getWayPoint().substring(0,2).equalsIgnoreCase(&quot;GC&quot;)) {
-				int test = spider.spiderSingle(i, infB, forceLogin, loadAllLogs);
+				int test = spider.spiderSingle(i, infB, forceLogin, loadAllLogs || ch.is_found());
 				if (test == SpiderGC.SPIDER_CANCEL) {
 					infB.close(0);
 					break;

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2010-01-29 13:58:31 UTC (rev 2438)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2010-01-29 15:56:13 UTC (rev 2439)
@@ -98,6 +98,8 @@
 	public static int SPIDER_ERROR = 0;
 	/** Cache was spidered without problems */
 	public static int SPIDER_OK = 1;
+	/** no probs, but exmpl found und not want this*/
+	public static int SPIDER_IGNORE = 2;
 
 	private static int ERR_LOGIN = -10;
 	private static Preferences pref;
@@ -138,6 +140,7 @@
 	private Regex RexPropLogDate;
 	private static String propAvailable;
 	private static String propArchived;
+	private static String propFound;
 	private static String propPM;
 	private Regex RexPropDirection;
 	private Regex RexPropDistance;
@@ -193,6 +196,7 @@
 					OCXMLImporterScreen.MAXUPDATE|
 					OCXMLImporterScreen.IMAGES|
 					OCXMLImporterScreen.ISGC|
+					OCXMLImporterScreen.MAXLOGS|
 					OCXMLImporterScreen.TRAVELBUGS);
 
 			options.maxNumberUpdates.setText(&quot;0&quot;); // no updates for founds
@@ -435,11 +439,9 @@
 				} else if (test == SPIDER_ERROR) {
 					spiderErrors++;
 				} else if (test == SPIDER_OK){
-					if (!holder.is_found() || !doNotgetFound ) {
-						cacheDB.add(holder);
-						holder.save();
-					}
-				} // For test==SPIDER_IGNORE_PREMIUM: Nothing to do
+					cacheDB.add(holder);
+					holder.save();
+				} // For test == SPIDER_IGNORE_PREMIUM and SPIDER_IGNORE there is nothing to do
 			}
 		}
 
@@ -711,6 +713,7 @@
 			RexPropLogDate = new Regex(p.getProp(&quot;logDateRex&quot;));
 			propAvailable=p.getProp(&quot;availableRex&quot;);
 			propArchived=p.getProp(&quot;archivedRex&quot;);
+			propFound=p.getProp(&quot;found&quot;);		
 			propPM=p.getProp(&quot;PMRex&quot;);
 			RexPropDirection=new Regex(p.getProp(&quot;directionRex&quot;));
 			RexPropDistance = new Regex(p.getProp(&quot;distRex&quot;));
@@ -809,11 +812,17 @@
 		boolean ret = false;
 		boolean save = false;
 		boolean is_archived_GC=false;
+		boolean is_found_GC=false;
+		CacheHolderDetail chd = ch.getFreshDetails();
 		if (spiderAllFinds) {
 			if(!ch.is_found()) { ch.setFound(true); save=true; numFoundUpdates+=1; ret=true;}
 			is_archived_GC=CacheDescription.indexOf(propArchived)!=-1;
-				if (is_archived_GC!=ch.is_archived()) { ch.setArchived(is_archived_GC); save=true; numArchivedUpdates+=1; ret=true;}
+			if (is_archived_GC!=ch.is_archived()) { ch.setArchived(is_archived_GC); save=true; numArchivedUpdates+=1; ret=true;}
+		} else if (!doNotgetFound){ // there could be a found or own ...
+			is_found_GC=CacheDescription.indexOf(propFound)!=-1;
+			if (is_found_GC!=ch.is_found()) {ch.setFound(is_found_GC); save=true; ret=true;}
 		}
+		if (ch.is_found() &amp;&amp; chd.OwnLogId.equals(&quot;&quot;)) {ret=true;}
 		boolean is_available_GC=!is_archived_GC &amp;&amp; CacheDescription.indexOf(propAvailable)==-1;
 		if (is_available_GC != ch.is_available()) {
 			ch.setAvailable(is_available_GC); save=true; numAvailableUpdates+=1; ret=true;}
@@ -922,8 +931,7 @@
 		if(!pref.checkLog) return false;
 		// String[] CacheDesc=mString.split(cacheDescrition,'\n');
 		Time lastLogCW = new Time();
-		CacheHolderDetail chd = ch.getCacheDetails(true);
-		String slastLogCW=chd.CacheLogs.getLog(0).getDate();
+		String slastLogCW=ch.details.CacheLogs.getLog(0).getDate();
 		if (slastLogCW.equals(&quot;&quot;)) return true; // or check cacheDescGC also no log?
 		lastLogCW.parse(slastLogCW,&quot;yyyy-MM-dd&quot;);
 
@@ -983,14 +991,14 @@
 	 */
 	private int getCacheByWaypointName(CacheHolder ch, boolean isUpdate, boolean fetchImages, boolean fetchTBs, boolean doNotGetFound, boolean fetchAllLogs) {
 		int ret = SPIDER_OK; // initialize value;
-		while (true) {
+		while (true) { // retry even if failure
 			String completeWebPage;
 			int spiderTrys=0;
 			int MAX_SPIDER_TRYS=3;
 			while (spiderTrys++&lt;MAX_SPIDER_TRYS) {
 				ret = SPIDER_OK; // initialize value;
 				try{
-					String doc = p.getProp(&quot;getPageByName&quot;) + ch.getWayPoint() +(fetchAllLogs?p.getProp(&quot;fetchAllLogs&quot;):&quot;&quot;);
+					String doc = p.getProp(&quot;getPageByName&quot;) + ch.getWayPoint() +((fetchAllLogs||ch.is_found())?p.getProp(&quot;fetchAllLogs&quot;):&quot;&quot;);
 					pref.log(&quot;Fetching: &quot; + ch.getWayPoint());
 					completeWebPage = fetch(doc);
 					if	( completeWebPage.equals(&quot;&quot;)) {
@@ -1035,7 +1043,7 @@
 						ch.setHTML(true);
 						ch.setIncomplete(true);
 						// Save size of logs to be able to check whether any new logs were added
-						//int logsz = chD.CacheLogs.size();
+						// int logsz = chD.CacheLogs.size();
 						//chD.CacheLogs.clear();
 						ch.addiWpts.clear();
 						ch.getFreshDetails().images.clear();
@@ -1043,21 +1051,30 @@
 						ch.setAvailable(!(completeWebPage.indexOf(p.getProp(&quot;cacheUnavailable&quot;)) &gt;= 0));
 						ch.setArchived(completeWebPage.indexOf(p.getProp(&quot;cacheArchived&quot;)) &gt;= 0);
 						//==========
+						// Logs first (for check early for break)
+						//==========
+						ch.getFreshDetails().setCacheLogs(getLogs(completeWebPage, ch.getFreshDetails()));
+						pref.log(&quot;Got logs&quot;);
+						// If the switch is set to not store found caches and we found the cache =&gt; return
+						if (ch.is_found() &amp;&amp; doNotGetFound) {
+							if (infB.isClosed) {
+								return SPIDER_CANCEL;
+							} else {
+								return SPIDER_IGNORE;
+							}
+						}
+						//==========
 						// General Cache Data
 						//==========
 						ch.setLatLon(latLon);
 						pref.log(&quot;LatLon: &quot; + ch.LatLon);
-						if (pref.debug) pref.log(&quot;chD.pos: &quot; + ch.pos.toString());
 
-						pref.log(&quot;Trying description&quot;);
 						ch.getFreshDetails().setLongDescription(getLongDesc(completeWebPage));
 						pref.log(&quot;Got description&quot;);
 
-						pref.log(&quot;Getting cache name&quot;);
 						ch.setCacheName(SafeXML.cleanback(getName(completeWebPage)));
-						if (pref.debug) pref.log(&quot;Name: &quot; + ch.getCacheName()); else pref.log(&quot;Got name&quot;);
+						pref.log(&quot;Name: &quot; + ch.getCacheName());
 
-						pref.log(&quot;Trying location (country/state)&quot;);
 						String location = getLocation(completeWebPage);
 						if (location.length() != 0) {
 							int countryStart = location.indexOf(&quot;,&quot;);
@@ -1075,95 +1092,56 @@
 							pref.log(&quot;No location (country/state) found&quot;);
 						}
 
-						pref.log(&quot;Trying owner&quot;);
 						ch.setCacheOwner(SafeXML.cleanback(getOwner(completeWebPage)).trim());
 						if(ch.getCacheOwner().equals(pref.myAlias) || (pref.myAlias2.length()&gt;0 &amp;&amp; ch.getCacheOwner().equals(pref.myAlias2))) ch.setOwned(true);
-						if (pref.debug) pref.log(&quot;Owner: &quot; + ch.getCacheOwner() +&quot;; is_owned = &quot;+ch.is_owned()+&quot;;  alias1,2 = [&quot;+pref.myAlias+&quot;|&quot;+pref.myAlias2+&quot;]&quot;);
-						else pref.log(&quot;Got owner&quot;);
+						pref.log(&quot;Owner: &quot; + ch.getCacheOwner() +&quot;; is_owned = &quot;+ch.is_owned()+&quot;;  alias1,2 = [&quot;+pref.myAlias+&quot;|&quot;+pref.myAlias2+&quot;]&quot;);
 
-
-						pref.log(&quot;Trying date hidden&quot;);
 						ch.setDateHidden(DateFormat.MDY2YMD(getDateHidden(completeWebPage)));
-						if (pref.debug) pref.log(&quot;Hidden: &quot; + ch.getDateHidden());
-						else pref.log(&quot;Got date hidden&quot;);
+						pref.log(&quot;Hidden: &quot; + ch.getDateHidden());
 
-						pref.log(&quot;Trying hints&quot;);
 						ch.getFreshDetails().setHints(getHints(completeWebPage));
-						if (pref.debug) pref.log(&quot;Hints: &quot; + ch.getFreshDetails().Hints);
-						else pref.log(&quot;Got hints&quot;);
+						pref.log(&quot;Hints: &quot; + ch.getFreshDetails().Hints);
 
-						pref.log(&quot;Trying size&quot;);
 						ch.setCacheSize(CacheSize.gcSpiderString2Cw(getSize(completeWebPage)));
-						if (pref.debug) pref.log(&quot;Size: &quot; + ch.getCacheSize());
-						else pref.log(&quot;Got size&quot;);
+						pref.log(&quot;Size: &quot; + ch.getCacheSize());
 
-						pref.log(&quot;Trying difficulty&quot;);
 						ch.setHard(CacheTerrDiff.v1Converter(getDiff(completeWebPage)));
-						if (pref.debug) pref.log(&quot;Hard: &quot; + ch.getHard());
-						else pref.log(&quot;Got difficulty&quot;);
+						pref.log(&quot;Hard: &quot; + ch.getHard());
 
-						pref.log(&quot;Trying terrain&quot;);
 						ch.setTerrain(CacheTerrDiff.v1Converter(getTerr(completeWebPage)));
-						if (pref.debug) pref.log(&quot;Terr: &quot; + ch.getTerrain());
-						else pref.log(&quot;Got terrain&quot;);
+						pref.log(&quot;Terr: &quot; + ch.getTerrain());
 
-						pref.log(&quot;Trying cache type&quot;);
 						ch.setType(getType(completeWebPage));
-						if (pref.debug) pref.log(&quot;Type: &quot; + ch.getType());
-						else pref.log(&quot;Got cache type&quot;);
-
+						pref.log(&quot;Type: &quot; + ch.getType());
 						//==========
-						// Logs
-						//==========
-						pref.log(&quot;Trying logs&quot;);
-						ch.getFreshDetails().setCacheLogs(getLogs(completeWebPage, ch.getFreshDetails()));
-						pref.log(&quot;Found logs&quot;);
-
-						// If the switch is set to not store found caches and we found the cache =&gt; return
-						if (ch.is_found() &amp;&amp; doNotGetFound) {
-							if (infB.isClosed) {
-								return SPIDER_CANCEL;
-							} else {
-								return SPIDER_OK;
-							}
-						}
-
-						//==========
 						// Bugs
 						//==========
-						// As there may be several bugs, we check whether the user has aborted
-						if (!infB.isClosed &amp;&amp; fetchTBs) getBugs(ch.getFreshDetails(),completeWebPage);
+						if (fetchTBs) getBugs(ch.getFreshDetails(),completeWebPage);
 						ch.setHas_bugs(ch.getFreshDetails().Travelbugs.size()&gt;0);
-
+						pref.log(&quot;Got TBs&quot;);
 						//==========
 						// Images
 						//==========
 						if(fetchImages){
-							pref.log(&quot;Trying images&quot;);
 							getImages(completeWebPage, ch.getFreshDetails());
 							pref.log(&quot;Got images&quot;);
 						}
 						//==========
 						// Addi waypoints
 						//==========
-
-						pref.log(&quot;Getting additional waypoints&quot;);
 						getAddWaypoints(completeWebPage, ch.getWayPoint(), ch.is_found());
 						pref.log(&quot;Got additional waypoints&quot;);
-
 						//==========
 						// Attributes
 						//==========
-						pref.log(&quot;Getting attributes&quot;);
 						getAttributes(completeWebPage, ch.getFreshDetails());
 						pref.log(&quot;Got attributes&quot;);
-						//if (ch.is_new()) ch.setUpdated(false);
 						//==========
 						// Last sync date
 						//==========
 						ch.setLastSync((new Time()).format(&quot;yyyyMMddHHmmss&quot;));
-
 						ch.setIncomplete(false);
+						pref.log(&quot;ready &quot; + ch.getWayPoint() + &quot; : &quot;+ ch.getLastSync()+&quot;\n&quot;);
 						break;
 					}catch(Exception ex){
 						pref.log(&quot;Error reading cache: &quot;+ch.getWayPoint());
@@ -1177,7 +1155,7 @@
 				pref.log(&quot;&gt;&gt;&gt; Failed to spider cache. Number of retrys exhausted.&quot;);
 				int decision = (new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;),MyLocale.getMsg(5515,&quot;Failed to load cache.%0aPleas check your internet connection.%0aRetry?&quot;),FormBase.DEFOKB|FormBase.NOB|FormBase.CANCELB)).execute();
 				if ( decision == FormBase.IDOK ) {
-					continue;
+					continue; // retry even if failure
 				} else if ( decision == FormBase.IDNO ){
 					ret = SPIDER_ERROR;
 				} else {
@@ -1185,7 +1163,7 @@
 				}
 			}
 			break;
-		}//while(true)
+		}//while(true) // retry even if failure
 		if (infB.isClosed) {// If the infoBox was closed before getting here, we return -1
 			return SPIDER_CANCEL;
 		}
@@ -1376,6 +1354,7 @@
 			logText = exLog.findNext();
 			logId = exLogId.findNext();
 			String d=DateFormat.logdate2YMD(exDate.findNext());
+			// if this log says this Cache is found by me
 			if((icon.equals(p.getProp(&quot;icon_smile&quot;)) || icon.equals(p.getProp(&quot;icon_camera&quot;)) || icon.equals(p.getProp(&quot;icon_attended&quot;))) &amp;&amp;
 				(name.equalsIgnoreCase(SafeXML.clean(pref.myAlias)) || (pref.myAlias2.length()&gt;0 &amp;&amp; name.equalsIgnoreCase(SafeXML.clean(pref.myAlias2)))) )  {
 				chD.getParent().setFound(true);
@@ -1395,7 +1374,11 @@
 			exLogId.setSource(singleLog);
 			// We cannot simply stop if we have reached MAXLOGS just in case we are waiting for
 			// a log by our alias that happened earlier.
-			if (nLogs&gt;=pref.maxLogsToSpider &amp;&amp; chD.getParent().is_found() &amp;&amp; (chD.OwnLogId.length() != 0) &amp;&amp; (chD.OwnLog != null) &amp;&amp; !(chD.OwnLog.getDate().equals(&quot;1900-01-01&quot;))) break;
+			if (nLogs&gt;=pref.maxLogsToSpider &amp;&amp; 
+				chD.getParent().is_found() &amp;&amp; 
+				chD.OwnLogId.length() != 0 &amp;&amp; 
+				chD.OwnLog != null &amp;&amp; 
+				!(chD.OwnLog.getDate().equals(&quot;1900-01-01&quot;))) break;
 		}
 		if (nLogs&gt;pref.maxLogsToSpider) {
 			reslts.add(Log.maxLog());
@@ -1497,7 +1480,7 @@
 				// Optimize: img.groundspeak.com -&gt; img.geocaching.com (for better caching purposes)
 				imgUrl = CacheImages.optimizeLink(&quot;<A HREF="http://">http://</A>&quot; + imgUrl);
 				try{
-					imgType = (imgUrl.substring(imgUrl.lastIndexOf(&quot;.&quot;)).toLowerCase()+&quot;    &quot;).substring(0,4).trim();
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase()+&quot;    &quot;).substring(0,4).trim();
 					// imgType is now max 4 chars, starting with .
 					if(imgType.startsWith(&quot;.png&quot;) || imgType.startsWith(&quot;.jpg&quot;) || imgType.startsWith(&quot;.gif&quot;)){
 						// Check whether image was already spidered for this cache
@@ -1559,7 +1542,7 @@
 			if(imgUrl.length()&gt;0){
 				imgUrl = &quot;<A HREF="http://">http://</A>&quot; + imgUrl;
 				try{
-					imgType = (imgUrl.substring(imgUrl.lastIndexOf(&quot;.&quot;)).toLowerCase()+&quot;    &quot;).substring(0,4).trim();
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase()+&quot;    &quot;).substring(0,4).trim();
 					// imgType is now max 4 chars, starting with .
 					if(imgType.startsWith(&quot;.png&quot;) || imgType.startsWith(&quot;.jpg&quot;) || imgType.startsWith(&quot;.gif&quot;)){
 						// Check whether image was already spidered for this cache
@@ -1610,9 +1593,9 @@
 				// Optimize: img.groundspeak.com -&gt; img.geocaching.com (for better caching purposes)
 				imgUrl = CacheImages.optimizeLink(&quot;<A HREF="http://">http://</A>&quot; + imgUrl);
 				try{
-					imgType = (imgUrl.substring(imgUrl.lastIndexOf(&quot;.&quot;)).toLowerCase()+&quot;    &quot;).substring(0,4).trim();
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase()+&quot;    &quot;).substring(0,4).trim();
 					// imgType is now max 4 chars, starting with . Delete characters in URL after the image extension
-					imgUrl=imgUrl.substring(0,imgUrl.lastIndexOf(&quot;.&quot;)+imgType.length());
+					imgUrl=imgUrl.substring(0,imgUrl.lastIndexOf('.')+imgType.length());
 					if( imgType.startsWith(&quot;.jpg&quot;) || imgType.startsWith(&quot;.bmp&quot;) || imgType.startsWith(&quot;.png&quot;) || imgType.startsWith(&quot;.gif&quot;)){
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002363.html">[Cachewolf-svn] r2438 - trunk/src/CacheWolf/exp
</A></li>
	<LI>Next message: <A HREF="002365.html">[Cachewolf-svn] r2440 - trunk/src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2364">[ date ]</a>
              <a href="thread.html#2364">[ thread ]</a>
              <a href="subject.html#2364">[ subject ]</a>
              <a href="author.html#2364">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
