<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2431 - in trunk: res_noewe/templates	src/CacheWolf/exp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2010-January/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2431%20-%20in%20trunk%3A%20res_noewe/templates%0A%09src/CacheWolf/exp&In-Reply-To=%3C201001251800.o0PI0D4e014661%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002355.html">
   <LINK REL="Next"  HREF="002357.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2431 - in trunk: res_noewe/templates	src/CacheWolf/exp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2431%20-%20in%20trunk%3A%20res_noewe/templates%0A%09src/CacheWolf/exp&In-Reply-To=%3C201001251800.o0PI0D4e014661%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2431 - in trunk: res_noewe/templates	src/CacheWolf/exp">araber95 at mail.berlios.de
       </A><BR>
    <I>Mon Jan 25 19:00:13 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002355.html">[Cachewolf-svn] r2430 - trunk/res_noewe/templates
</A></li>
        <LI>Next message: <A HREF="002357.html">[Cachewolf-svn] r2432 - trunk/res_noewe/templates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2356">[ date ]</a>
              <a href="thread.html#2356">[ thread ]</a>
              <a href="subject.html#2356">[ subject ]</a>
              <a href="author.html#2356">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2010-01-25 18:59:59 +0100 (Mon, 25 Jan 2010)
New Revision: 2431

Modified:
   trunk/res_noewe/templates/Short documentation for the export via templates.htm
   trunk/src/CacheWolf/exp/TPLExporter.java
Log:
Adding possibility of unicode output to the template exporters with template parameter charset = UNICODE

Modified: trunk/res_noewe/templates/Short documentation for the export via templates.htm
===================================================================
--- trunk/res_noewe/templates/Short documentation for the export via templates.htm	2010-01-25 15:56:51 UTC (rev 2430)
+++ trunk/res_noewe/templates/Short documentation for the export via templates.htm	2010-01-25 17:59:59 UTC (rev 2431)
@@ -181,7 +181,7 @@
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'&gt;&lt;&lt;span
 class=SpellE&gt;tmpl_par&lt;/span&gt; name=&quot;&lt;span class=SpellE&gt;charset&lt;/span&gt;&quot;
 value=&quot;ASCII&quot;&gt;&lt;span style='mso-tab-count:3'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;&lt;span
-class=SpellE&gt;Charsets&lt;/span&gt;: &nbsp;values ASCII or UTF8&lt;br&gt;
+class=SpellE&gt;Charsets&lt;/span&gt;: &nbsp;values ASCII or UTF8 or UNICODE&lt;br&gt;
 &lt;&lt;span class=SpellE&gt;tmpl_par&lt;/span&gt; name=&quot;&lt;span class=SpellE&gt;badchars&lt;/span&gt;&quot;
 value=&quot;,&quot;&gt;&lt;span style='mso-tab-count:4'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;&lt;span
 class=SpellE&gt;&lt;span class=GramE&gt;BadChars&lt;/span&gt;&lt;/span&gt;&lt;span class=GramE&gt; :&lt;/span&gt;
@@ -260,8 +260,7 @@
 kann nur 30 Buchstaben)&lt;br&gt;
 &lt;/span&gt;&lt;span style='font-size:10.0pt;font-family:Arial'&gt;OWNER&lt;span
 style='mso-tab-count:8'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;:&lt;br&gt;
-DIFFICULTY&lt;span style='mso-tab-count:7'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;&lt;span
-style='mso-tab-count:1'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;:&lt;br&gt;
+DIFFICULTY&lt;span style='mso-tab-count:8'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;:&lt;br&gt;
 &lt;/span&gt;&lt;span style='font-size:10.0pt;font-family:Helvetica'&gt;SHORTDIFFICULTY&lt;span
 style='mso-tab-count:7'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;:
 &lt;span class=SpellE&gt;Difficulty&lt;/span&gt; mal 10 also 15 statt 1.5&lt;br&gt;
@@ -311,12 +310,12 @@
 Decrypted hints&nbsp;&nbsp;&nbsp; (&lt;span class=SpellE&gt;badchars&lt;/span&gt; are
 removed, see below) &lt;br&gt;
 &lt;/span&gt;&lt;span lang=EN-GB style='font-size:10.0pt;font-family:Helvetica;
-mso-ansi-language:EN-GB'&gt;SHORTWAYPOINT&lt;span style='mso-tab-count:6'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;&lt;span
-style='mso-tab-count:1'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;: &lt;/span&gt;&lt;span class=SpellE&gt;&lt;span
-lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'&gt;ShortNameLength&lt;/span&gt;&lt;/span&gt;&lt;span
-lang=EN-GB style='font-size:10.0pt;font-family:Helvetica;mso-ansi-language:
-EN-GB'&gt; &lt;span class=SpellE&gt;Zeichen&lt;/span&gt; des Waypoints (&lt;span class=SpellE&gt;f&#252;r&lt;/span&gt;
-&lt;span class=SpellE&gt;Benutzer&lt;/span&gt; alter &lt;span class=SpellE&gt;Ger&#228;te&lt;/span&gt; &lt;span
+mso-ansi-language:EN-GB'&gt;SHORTWAYPOINT&lt;span style='mso-tab-count:7'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;:
+&lt;/span&gt;&lt;span class=SpellE&gt;&lt;span lang=EN-GB style='font-size:10.0pt;font-family:
+Arial;mso-ansi-language:EN-GB'&gt;ShortNameLength&lt;/span&gt;&lt;/span&gt;&lt;span lang=EN-GB
+style='font-size:10.0pt;font-family:Helvetica;mso-ansi-language:EN-GB'&gt; &lt;span
+class=SpellE&gt;Zeichen&lt;/span&gt; des Waypoints (&lt;span class=SpellE&gt;f&#252;r&lt;/span&gt; &lt;span
+class=SpellE&gt;Benutzer&lt;/span&gt; alter &lt;span class=SpellE&gt;Ger&#228;te&lt;/span&gt; &lt;span
 class=SpellE&gt;mit&lt;/span&gt; &lt;span class=SpellE&gt;nur&lt;/span&gt; 6 &lt;span class=SpellE&gt;Waypointzeichen&lt;/span&gt;,
 &lt;br&gt;
 &lt;span style='mso-spacerun:yes'&gt;&#160;&lt;/span&gt;&lt;span style='mso-tab-count:9'&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/span&gt;:
@@ -498,9 +497,9 @@
 the if block allows us to display some output if a condition is true&lt;span
 class=GramE&gt;,&lt;span style='mso-spacerun:yes'&gt;&#160; &lt;/span&gt;we&lt;/span&gt;&lt;/span&gt;&lt;span
 lang=EN-GB style='mso-ansi-language:EN-GB'&gt; &lt;/span&gt;&lt;span lang=EN-GB
-style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'&gt;may also
-need to display content if the condition is false. This can be done by using
-the optional else&lt;/span&gt;&lt;span lang=EN-GB style='mso-ansi-language:EN-GB'&gt; &lt;/span&gt;&lt;span
+style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'&gt;may also need
+to display content if the condition is false. This can be done by using the
+optional else&lt;/span&gt;&lt;span lang=EN-GB style='mso-ansi-language:EN-GB'&gt; &lt;/span&gt;&lt;span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'&gt;branch
 of &lt;span class=GramE&gt;the if&lt;/span&gt; block.&lt;/span&gt;&lt;span lang=EN-GB
 style='mso-ansi-language:EN-GB'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
@@ -550,8 +549,8 @@
 
 &lt;p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span
 lang=EN-GB style='font-size:10.0pt;font-family:Arial;mso-ansi-language:EN-GB'&gt;If
-you set &lt;span class=SpellE&gt;loop_context_vars&lt;/span&gt; to true in your Template's constructor,
-then you will have access to five special&lt;/span&gt;&lt;span lang=EN-GB
+you set &lt;span class=SpellE&gt;loop_context_vars&lt;/span&gt; to true in your Template's
+constructor, then you will have access to five special&lt;/span&gt;&lt;span lang=EN-GB
 style='mso-ansi-language:EN-GB'&gt; &lt;/span&gt;&lt;span lang=EN-GB style='font-size:10.0pt;
 font-family:Arial;mso-ansi-language:EN-GB'&gt;variables in all your loops. These
 are:&lt;/span&gt;&lt;span lang=EN-GB style='mso-ansi-language:EN-GB'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;

Modified: trunk/src/CacheWolf/exp/TPLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/TPLExporter.java	2010-01-25 15:56:51 UTC (rev 2430)
+++ trunk/src/CacheWolf/exp/TPLExporter.java	2010-01-25 17:59:59 UTC (rev 2431)
@@ -105,8 +105,9 @@
 
 			// get the values
 			if (param.equals(&quot;charset&quot;)) {
-				if (value.equals(&quot;ASCII&quot;)) codec = new AsciiCodec();
-				if (value.equals(&quot;UTF8&quot;)) codec = new JavaUtf8Codec();
+				if (value.equals(&quot;ASCII&quot;)) {codec = new AsciiCodec();}
+				else if (value.equals(&quot;UTF8&quot;)) {codec = new JavaUtf8Codec();}
+				else {codec = new NoCodec();}
 			}
 			if (param.equals(&quot;badchars&quot;)) {
 				badChars = value;
@@ -331,5 +332,87 @@
         }
         return sb.toString();
     }
+}
 
+//##################################################################
+class NoCodec implements TextCodec{
+//##################################################################
+
+/**
+* This is a creation option. It specifies that CR characters should be removed when
+* encoding text into UTF.
+**/
+public static final int STRIP_CR_ON_DECODE = 0x1;
+/**
+* This is a creation option. It specifies that CR characters should be removed when
+* decoding text from UTF.
+**/
+public static final int STRIP_CR_ON_ENCODE = 0x2;
+/**
+* This is a creation option. It specifies that CR characters should be removed when
+* decoding text from UTF AND encoding text to UTF.
+**/
+public static final int STRIP_CR = STRIP_CR_ON_DECODE|STRIP_CR_ON_ENCODE;
+
+private int flags = 0;
+
+//===================================================================
+public NoCodec(int options)
+//===================================================================
+{
+	flags = options;
 }
+//===================================================================
+public NoCodec()
+//===================================================================
+{
+	this(0);
+}
+//===================================================================
+public ByteArray encodeText(char [] text, int start, int length, boolean endOfData, ByteArray dest) throws IOException
+//===================================================================
+{
+	if (dest == null) dest = new ByteArray();
+	int size = length == 0 ? 2 : 2+text.length*2;
+	if (dest.data == null || dest.data.length &lt; size)
+		dest.data = new byte[size];
+	byte [] destination = dest.data;
+	int s = 0;
+	if (length&gt;0){
+		destination[s++] = (byte) 0xFF;
+		destination[s++] = (byte) 0xFE;
+	}
+	for (int i = 0; i&lt;length; i++){
+		char c = text[i+start];
+		if (c == 13 &amp;&amp; ((flags &amp; STRIP_CR_ON_ENCODE) != 0)) continue;
+		destination[s++] = (byte)(c &amp; 0xFF);
+		destination[s++] = (byte)((c&gt;&gt;8) &amp; 0xFF);
+	}
+	dest.length = s;
+	return dest;
+}
+
+//===================================================================
+public CharArray decodeText(byte [] encoded, int start, int length, boolean endOfData, CharArray dest) throws IOException
+//===================================================================
+{
+	if (dest == null) dest = new CharArray();
+	dest.length = 0;
+	return dest;
+}
+
+//===================================================================
+public void closeCodec() throws IOException
+//===================================================================
+{
+}
+
+//===================================================================
+public Object getCopy()
+//===================================================================
+{
+	return new NoCodec(flags);
+}
+//##################################################################
+}
+//##################################################################


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002355.html">[Cachewolf-svn] r2430 - trunk/res_noewe/templates
</A></li>
	<LI>Next message: <A HREF="002357.html">[Cachewolf-svn] r2432 - trunk/res_noewe/templates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2356">[ date ]</a>
              <a href="thread.html#2356">[ thread ]</a>
              <a href="subject.html#2356">[ subject ]</a>
              <a href="author.html#2356">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
