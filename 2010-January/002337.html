<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2413 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2010-January/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2413%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/exp&In-Reply-To=%3C201001171617.o0HGHELJ016055%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002336.html">
   <LINK REL="Next"  HREF="002338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2413 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp</H1>
    <B>kalli at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2413%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/exp&In-Reply-To=%3C201001171617.o0HGHELJ016055%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2413 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp">kalli at mail.berlios.de
       </A><BR>
    <I>Sun Jan 17 17:17:14 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002336.html">[Cachewolf-svn] r2412 - in trunk/src/CacheWolf: . imp
</A></li>
        <LI>Next message: <A HREF="002338.html">[Cachewolf-svn] r2414 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2337">[ date ]</a>
              <a href="thread.html#2337">[ thread ]</a>
              <a href="subject.html#2337">[ subject ]</a>
              <a href="author.html#2337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kalli
Date: 2010-01-17 17:16:23 +0100 (Sun, 17 Jan 2010)
New Revision: 2413

Added:
   trunk/src/CacheWolf/exp/SpoilerPOIExporter.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/MainMenu.java
Log:
SpoilerPOI exporter added

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2010-01-17 10:09:31 UTC (rev 2412)
+++ trunk/res_noewe/languages/DE.cfg	2010-01-17 16:16:23 UTC (rev 2413)
@@ -36,6 +36,7 @@
 		132=nach Explorist
 		133=Suche alle
 		134=Gew%e4hlter Cache
+		135=nach SpoilerPOI
 		139=Travelbugs verwalten
 		140=Verwalten
 		141=Kopieren

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2010-01-17 10:09:31 UTC (rev 2412)
+++ trunk/res_noewe/languages/EN.cfg	2010-01-17 16:16:23 UTC (rev 2413)
@@ -36,6 +36,7 @@
 		132=to Explorist
 		133=Search all
 		134=Selected Cache
+		135=to SpoilerPOI
 		139=Manage Travelbugs
 		140=Organise
 		141=Copy

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2010-01-17 10:09:31 UTC (rev 2412)
+++ trunk/res_noewe/languages/FR.cfg	2010-01-17 16:16:23 UTC (rev 2413)
@@ -36,6 +36,7 @@
 		132=vers Explorist
 		133=Cherche toutes
 		134=Cache choisi
+		135=vers SpoilerPOI
 		139=G%e9rer Travelbugs
 		140=G%e9rer
 		141=Copier

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2010-01-17 10:09:31 UTC (rev 2412)
+++ trunk/res_noewe/languages/NL.cfg	2010-01-17 16:16:23 UTC (rev 2413)
@@ -36,6 +36,7 @@
 		132=Naar Explorist
 		133=Allen zoeken
 		134=Gekozen Cache
+		135=Naar SpoilerPOI
 		139=Beheren Travelbugs
 		140=Organiseren
 		141=Kopi%ebren

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2010-01-17 10:09:31 UTC (rev 2412)
+++ trunk/res_noewe/languages/PL.cfg	2010-01-17 16:16:23 UTC (rev 2413)
@@ -36,6 +36,7 @@
                 132=Explorist
                 133=Szukaj wszystkich
                 134=Zaznaczony Cache
+                135=SpoilerPOI
                 139=Zarzadzaj Travelbugami
                 140=Zarzadzanie
                 141=Kopiuj

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2010-01-17 10:09:31 UTC (rev 2412)
+++ trunk/src/CacheWolf/MainMenu.java	2010-01-17 16:16:23 UTC (rev 2413)
@@ -10,6 +10,7 @@
 import CacheWolf.exp.MSARCSVExporter;
 import CacheWolf.exp.OVLExporter;
 import CacheWolf.exp.OziExporter;
+import CacheWolf.exp.SpoilerPOIExporter;
 import CacheWolf.exp.TPLExporter;
 import CacheWolf.exp.TomTomExporter;
 import CacheWolf.imp.GPXImporter;
@@ -56,7 +57,7 @@
 	private MenuItem downloadmap, kalibmap, importmap, selectMapPath;
 	private MenuItem spider, spiderAllFinds, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
-	private MenuItem exportGpxNg, exporthtml, exporttop50, exportGPX, exportASC, exportTomTom, exportMSARCSV;
+	private MenuItem exportGpxNg, exporthtml, exporttop50, exportGPX, exportASC, exportTomTom, exportMSARCSV, exportSpoilerPOI;
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
 	private MenuItem exportLOC, exportGPS, mnuSeparator;
@@ -102,7 +103,7 @@
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for export, part of &quot;Application&quot; menu below
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] exitems = new MenuItem[13];
+		MenuItem[] exitems = new MenuItem[14];
 		//Vm.debug(&quot;Hi in MainMenu &quot;+lr);
 		exitems[0] = exporthtml = new MenuItem(MyLocale.getMsg(100,&quot;to HTML&quot;));
 		exitems[1] = exportGpxNg = new MenuItem(MyLocale.getMsg(101,&quot;to GPX Test&quot;));
@@ -120,6 +121,7 @@
 		exitems[10] = exportKML = new MenuItem(MyLocale.getMsg(125,&quot;to Google Earth&quot;));
 		exitems[11] = exportExplorist = new MenuItem(MyLocale.getMsg(132,&quot;to Explorist&quot;));
 		exitems[12] = exportTPL = new MenuItem(MyLocale.getMsg(128,&quot;via Template&quot;));
+		exitems[13] = exportSpoilerPOI = new MenuItem(MyLocale.getMsg(135,&quot;to SpoilerPOI&quot;));
 
 		Menu exportMenu = new Menu(exitems, MyLocale.getMsg(107,&quot;Export&quot;));
 
@@ -472,6 +474,11 @@
 				ExploristExporter mag = new ExploristExporter( pref, profile);
 				mag.doIt();
 			}
+			if(mev.selectedItem == exportSpoilerPOI) {
+				SpoilerPOIExporter spoilerpoi = new SpoilerPOIExporter( pref, profile);
+				spoilerpoi.doIt();
+			}
+
 			///////////////////////////////////////////////////////////////////////
 			// subMenu for maps, part of &quot;Application&quot; menu
 			///////////////////////////////////////////////////////////////////////

Added: trunk/src/CacheWolf/exp/SpoilerPOIExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/SpoilerPOIExporter.java	2010-01-17 10:09:31 UTC (rev 2412)
+++ trunk/src/CacheWolf/exp/SpoilerPOIExporter.java	2010-01-17 16:16:23 UTC (rev 2413)
@@ -0,0 +1,90 @@
+package CacheWolf.exp;
+import ewe.sys.Time;
+import CacheWolf.*;
+
+/** 
+ * 
+ * @author Kalle
+ * Class to create a gpx-File with links to the pictures of a 
+ * cache, which is used as input for the POILoader from Garmin.
+ */
+
+public class SpoilerPOIExporter extends Exporter {
+
+	
+	public SpoilerPOIExporter(Preferences p, Profile prof){
+		super();
+		this.setMask(&quot;*.gpx&quot;);
+		this.setHowManyParams(LAT_LON);
+		this.setNeedCacheDetails(true);
+	}
+
+	
+	public String header () {
+		StringBuffer strBuf = new StringBuffer(200);
+		Time tim = new Time();
+
+		strBuf.append(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;no\&quot; ?&gt;\r\n&quot;);
+		strBuf.append(&quot;&lt;gpx xmlns=\&quot;<A HREF="http://www.topografix.com/GPX/1/1\">http://www.topografix.com/GPX/1/1\</A>&quot; creator=\&quot;CacheWolf\&quot; version=\&quot;1.1\&quot;&quot; +
+				      &quot; xmlns:xsi=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance\">http://www.w3.org/2001/XMLSchema-instance\</A>&quot; &quot; +
+				      &quot;xsi:schemaLocation=\&quot;<A HREF="http://www.topografix.com/GPX/1/1">http://www.topografix.com/GPX/1/1</A> <A HREF="http://www.topografix.com/GPX/1/1/gpx.xsd\">http://www.topografix.com/GPX/1/1/gpx.xsd\</A>&quot;&gt;\r\n&quot;);
+		strBuf.append(&quot;  &lt;metadata&gt;\r\n&quot;);
+		strBuf.append(&quot;    &lt;link href=\&quot;<A HREF="http://www.cachewolf.de\">http://www.cachewolf.de\</A>&quot;&gt;\r\n&quot;);
+		strBuf.append(&quot;      &lt;text&gt;CacheWolf&lt;/text&gt;\r\n&quot;);
+		strBuf.append(&quot;    &lt;/link&gt;\r\n&quot;);
+		tim = tim.setFormat(&quot;yyyy-MM-dd'T'HH:mm:dd'Z'&quot;);
+		tim = tim.setToCurrentTime();
+		strBuf.append(&quot;    &lt;time&gt;&quot; + tim.toString() + &quot;&lt;/time&gt;\r\n&quot;);
+		strBuf.append(&quot;  &lt;/metadata&gt;\r\n&quot;);
+		return strBuf.toString();
+	}
+	
+	public String record(CacheHolder ch, String lat, String lon) {
+		StringBuffer strBuf = new StringBuffer(1000);
+		String comment,filename;
+		
+		// Makes only sense for main waypoints
+		if (ch.isAddiWpt()) return null;
+		
+		// First check, if there a any pictures in the db for the wpt
+		ch.getCacheDetails(false);
+		if (! ch.detailsLoaded()) return null;
+		if (ch.details.images.size() == 0) return null;
+		
+		for (int i=0; i &lt; ch.details.images.size(); i++ ) {
+			filename = ch.details.images.get(i).getFilename();
+			comment = ch.details.images.get(i).getTitle();
+			// POILoader can only work with JPG-Files
+			if ( !filename.endsWith(&quot;.jpg&quot;)) continue;
+			// Try to export only Spoiler
+			if ( comment.indexOf(&quot;oiler&quot;) &lt; 1) continue;
+			
+			strBuf.append(&quot;&lt;wpt lat=\&quot;&quot; + lat + &quot;\&quot; lon=\&quot;&quot; + lon + &quot;\&quot;&gt;\r\n&quot;);
+			strBuf.append(&quot;  &lt;name&gt;Spoiler: &quot; + SafeXML.cleanGPX(ch.cacheName) + &quot;&lt;/name&gt;\r\n&quot;);
+			strBuf.append(&quot;  &lt;cmt&gt;\r\n&quot;);
+			if (ch.details.Hints.length()&gt; 0){
+				strBuf.append(&quot;  Hint: &quot; + SafeXML.cleanGPX(Common.rot13(ch.details.Hints)) + &quot;\r\n&quot;);
+			}
+			if (comment != null){
+				strBuf.append(&quot;  Comment: &quot; + SafeXML.cleanGPX(comment) + &quot;\r\n&quot;);
+			}
+			strBuf.append(&quot;  &lt;/cmt&gt;\r\n&quot;);
+			strBuf.append(&quot;  &lt;desc&gt;GCcode: &quot; + ch.getWayPoint() + &quot; &lt;/desc&gt;\r\n&quot;);
+			strBuf.append(&quot;   &lt;link href=\&quot;&quot; + profile.dataDir + filename + &quot;\&quot;/&gt;\r\n&quot;);
+			strBuf.append(&quot;  &lt;sym&gt;Scenic Area&lt;/sym&gt;\r\n&quot;);
+			strBuf.append(&quot;  &lt;extensions&gt;\r\n&quot;);
+			strBuf.append(&quot;     &lt;gpxx:WaypointExtension xmlns:gpxx=\&quot;<A HREF="http://www.garmin.com/xmlschemas/GpxExtensions/v3\">http://www.garmin.com/xmlschemas/GpxExtensions/v3\</A>&quot;&gt;\r\n&quot;);
+			strBuf.append(&quot;        &lt;gpxx:DisplayMode&gt;SymbolAndName&lt;/gpxx:DisplayMode&gt;\r\n&quot;);
+			strBuf.append(&quot;     &lt;/gpxx:WaypointExtension&gt;\r\n&quot;);
+			strBuf.append(&quot;  &lt;/extensions&gt;\r\n&quot;);
+			strBuf.append(&quot;&lt;/wpt&gt;\r\n&quot;);
+			strBuf.append(&quot;\r\n&quot;);
+		}
+	
+		return strBuf.toString();
+	}
+	
+	public String trailer() {
+		return &quot;&lt;/gpx&gt;\r\n&quot;;
+	}
+}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002336.html">[Cachewolf-svn] r2412 - in trunk/src/CacheWolf: . imp
</A></li>
	<LI>Next message: <A HREF="002338.html">[Cachewolf-svn] r2414 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2337">[ date ]</a>
              <a href="thread.html#2337">[ thread ]</a>
              <a href="subject.html#2337">[ subject ]</a>
              <a href="author.html#2337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
