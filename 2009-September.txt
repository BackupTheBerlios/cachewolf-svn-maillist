From pfeffer at mail.berlios.de  Tue Sep  1 13:57:13 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 1 Sep 2009 13:57:13 +0200
Subject: [Cachewolf-svn] r2126 - trunk/src/CacheWolf/navi
Message-ID: <200909011157.n81BvD3w005007@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-01 13:57:12 +0200 (Tue, 01 Sep 2009)
New Revision: 2126

Modified:
   trunk/src/CacheWolf/navi/MovingMapCache.java
Log:
MovingMap: fill white area: bug fixed: works now with Ewe (windows-exe). reason was again that Ewe doesn't support .getclass()

Modified: trunk/src/CacheWolf/navi/MovingMapCache.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMapCache.java	2009-08-31 18:08:11 UTC (rev 2125)
+++ trunk/src/CacheWolf/navi/MovingMapCache.java	2009-09-01 11:57:12 UTC (rev 2126)
@@ -114,7 +114,7 @@
 					return true;
 				if (obj == null)
 					return false;
-				if (getClass() != obj.getClass())
+				if (! (obj instanceof Key))
 					return false;
 				final Key other = (Key) obj;
 				if (column != other.column)



From pfeffer at mail.berlios.de  Tue Sep  1 17:44:10 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 1 Sep 2009 17:44:10 +0200
Subject: [Cachewolf-svn] r2127 - trunk/src/CacheWolf/navi
Message-ID: <200909011544.n81FiAx2021000@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-01 17:44:09 +0200 (Tue, 01 Sep 2009)
New Revision: 2127

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: Bug fixed: show caches again in the map

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-01 11:57:12 UTC (rev 2126)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-01 15:44:09 UTC (rev 2127)
@@ -976,7 +976,7 @@
 		Vector icons = new Vector ();
 		for (Iterator i = mmp.images.iterator(); i.hasNext();) {
 			AniImage im = (AniImage) i.next();
-			if ( (im instanceof MapImage) && mmp.mapImage != im) {
+			if ( (im instanceof MapImage) && (!(im instanceof MapSymbol)) && mmp.mapImage != im) {
 				i.remove();
 			}
 			else{



From pfeffer at mail.berlios.de  Tue Sep  1 18:47:04 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 1 Sep 2009 18:47:04 +0200
Subject: [Cachewolf-svn] r2128 - trunk/src/CacheWolf/navi
Message-ID: <200909011647.n81Gl4Uq010003@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-01 18:46:55 +0200 (Tue, 01 Sep 2009)
New Revision: 2128

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: bug fixed (hopefully): show red dots from track

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-01 15:44:09 UTC (rev 2127)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-01 16:46:55 UTC (rev 2128)
@@ -976,7 +976,8 @@
 		Vector icons = new Vector ();
 		for (Iterator i = mmp.images.iterator(); i.hasNext();) {
 			AniImage im = (AniImage) i.next();
-			if ( (im instanceof MapImage) && (!(im instanceof MapSymbol)) && mmp.mapImage != im) {
+			if ( (im instanceof MapImage) && (
+					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
 				i.remove();
 			}
 			else{



From mik77 at mail.berlios.de  Wed Sep  2 10:15:47 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 2 Sep 2009 10:15:47 +0200
Subject: [Cachewolf-svn] r2129 - in trunk: . src/CacheWolf/navi
Message-ID: <200909020815.n828Fl7m012888@sheep.berlios.de>

Author: mik77
Date: 2009-09-02 10:15:39 +0200 (Wed, 02 Sep 2009)
New Revision: 2129

Modified:
   trunk/cw-pda.jnf
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
 - memory for PDA reduced to 8M
 - map menu symbols for showing map and filling "white" areas set to on when function is activated

Modified: trunk/cw-pda.jnf
===================================================================
--- trunk/cw-pda.jnf	2009-09-01 16:46:55 UTC (rev 2128)
+++ trunk/cw-pda.jnf	2009-09-02 08:15:39 UTC (rev 2129)
@@ -1 +1 @@
-command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D/Xmx%2B12M&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DPocketPC%25252B2003%252526%25253DPocketPC%25252B-%25252BARM/XScale%252526%25253DPocketPC%25252B-%25252BMIPS%252526%25253DPocketPC%25252B-%25252BSH3&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEnt!
 ry%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D/Xmx%252B12M%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources/CacheWolf.ico
+command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D/Xmx%2B8M&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DPocketPC%25252B2003%252526%25253DPocketPC%25252B-%25252BARM/XScale%252526%25253DPocketPC%25252B-%25252BMIPS%252526%25253DPocketPC%25252B-%25252BSH3&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntr!
 y%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D/Xmx%252B8M%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources/CacheWolf.ico

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-01 16:46:55 UTC (rev 2128)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-02 08:15:39 UTC (rev 2129)
@@ -1747,9 +1747,9 @@
 	Menu mapsMenu;
 	MenuItem selectMapMI = new MenuItem(MyLocale.getMsg(4234, "Select a map manually$s"), new IconAndText(new mImage("map_open.png"), MyLocale.getMsg(4235, "Select a map manually"), null, CellConstants.RIGHT));
 	MenuItem changeMapDirMI = new MenuItem(MyLocale.getMsg(4236, "Change map directory$c"), new IconAndText(new mImage("map_cd.png"), MyLocale.getMsg(4237, "Change map directory"), null, CellConstants.RIGHT));
-	MenuItem showMapMI = new MenuItem(MyLocale.getMsg(4238, "Show map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4239, "Show map"), null, CellConstants.RIGHT));
-	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4241, "Hide map"), null, CellConstants.RIGHT));
-	MenuItem fillMapMI = new MenuItem(MyLocale.getMsg(4267, "Show white areas"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4267, "Show white areas"), null, CellConstants.RIGHT));
+	MenuItem showMapMI = new MenuItem(MyLocale.getMsg(4238, "Show map"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4239, "Show map"), null, CellConstants.RIGHT));
+	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4241, "Hide map"), null, CellConstants.RIGHT));
+	MenuItem fillMapMI = new MenuItem(MyLocale.getMsg(4267, "Show white areas"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4267, "Show white areas"), null, CellConstants.RIGHT));
 	MenuItem noFillMapMI = new MenuItem(MyLocale.getMsg(4266, "Fill white areas"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4266, "Fill white areas"), null, CellConstants.RIGHT));
 	// automatic
 	MenuItem mapChangeModusMI = new MenuItem(MyLocale.getMsg(4242, "Modus for automatic map change"), MenuItem.Separator, null);;



From araber95 at mail.berlios.de  Thu Sep  3 00:02:14 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 3 Sep 2009 00:02:14 +0200
Subject: [Cachewolf-svn] r2130 - trunk/res_noewe/webmapservices
Message-ID: <200909022202.n82M2Evm017129@sheep.berlios.de>

Author: araber95
Date: 2009-09-03 00:02:10 +0200 (Thu, 03 Sep 2009)
New Revision: 2130

Added:
   trunk/res_noewe/webmapservices/at-1_p.wms
   trunk/res_noewe/webmapservices/cz-vy_p.wms
   trunk/res_noewe/webmapservices/cz-vy_t10.wms
   trunk/res_noewe/webmapservices/cz-vy_t50.wms
Log:
new wms - files for "Austria/Region Burgenland" and "Tschechien/Region Highland"

Added: trunk/res_noewe/webmapservices/at-1_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/at-1_p.wms	2009-09-02 08:15:39 UTC (rev 2129)
+++ trunk/res_noewe/webmapservices/at-1_p.wms	2009-09-02 22:02:10 UTC (rev 2130)
@@ -0,0 +1,66 @@
+TakenFromUrl:       http://gis.bgld.gv.at:80/wmsconnector/com.esri.wms.Esrimap/CentropeMap?
+GetCapabilitiesUrl: http://gis.bgld.gv.at:80/wmsconnector/com.esri.wms.Esrimap/CentropeMap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               at.Burgenland p SF=1..10
+MapType:                        photo
+MainUrl:            http://gis.bgld.gv.at:80/wmsconnector/com.esri.wms.Esrimap/CentropeMap?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287
+#      <SRS>EPSG:31256</SRS>
+#      <SRS>EPSG:31259</SRS>
+#      <SRS>EPSG:31287</SRS>
+#      <SRS>EPSG:31297</SRS>
+#      <SRS>EPSG:4326</SRS>
+#      <SRS>EPSG:4267</SRS>
+#      <SRS>EPSG:4269</SRS> 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=oek50|OEK50||
+#LayersUrlPart:     LAYERS=ortho1m_farbe|Orthofoto Farbe||
+#LayersUrlPart:     LAYERS=Flugdatum_Farbe|Flugdatum Orthofoto Farbe||
+#LayersUrlPart:     LAYERS=Flugjahr_ortho|FlugjahrOrthofoto||
+#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
+#LayersUrlPart:     LAYERS=orientierungskarte|Orientierungskarte|NaN|NaN
+#LayersUrlPart:     LAYERS=Ziel_1_Gebiet|Ziel_1_Gebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
+#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
+#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
+#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
+#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
+#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
+#LayersUrlPart:     LAYERS=geschuetzteLandschaftsteile|geschuetzte Landschaftsteile||
+#LayersUrlPart:     LAYERS=sonstigeSchutzgebiete|sonstige Schutzgebiete||
+#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasserschongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Wasserschongebiet_allgemein|Wasserschongebiet_allgemein|NaN|99999999
+#LayersUrlPart:     LAYERS=iki|Katastropheninformation|NaN|99999999
+#LayersUrlPart:     LAYERS=Messstelle_gw|Messstelle Grundwasser|NaN|99999999
+#LayersUrlPart:     LAYERS=Messstelle_og|Messstelle Oberflaechengewaesser|NaN|99999999
+#LayersUrlPart:     LAYERS=Messstelle_ns|Messstelle Niederschlaege|NaN|99999999
+#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
+#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
+#LayersUrlPart:     LAYERS=see|Stehende Gewaesser||
+#LayersUrlPart:     LAYERS=so_str|sonstige Strasse||
+#LayersUrlPart:     LAYERS=l_str|Landesstrasse L||
+#LayersUrlPart:     LAYERS=b_str|Landesstrasse B||
+#LayersUrlPart:     LAYERS=s_str|Schnellstrasse||
+#LayersUrlPart:     LAYERS=a_str|Autobahn||
+#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
+#LayersUrlPart:     LAYERS=oertl_str|oertliches Strassennetz||
+#LayersUrlPart:     LAYERS=adressen|Adressen|NaN|99999999
+#LayersUrlPart:     LAYERS=geo_nam|geonam|NaN|NaN
+#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
+#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
+#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
+#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
+LayersUrlPart:     LAYERS=ortho1m_farbe,flu_50t,see,so_str,l_str,b_str,s_str,a_str,oertl_str
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 48.1886 E 15.9545
+BoundingBoxButtomRightWGS84: N 46.7613 E 17.2342
+#BBox_Mitte: N 47.47496561765 E 16.5943567439
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/cz-vy_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_p.wms	2009-09-02 08:15:39 UTC (rev 2129)
+++ trunk/res_noewe/webmapservices/cz-vy_p.wms	2009-09-02 22:02:10 UTC (rev 2130)
@@ -0,0 +1,37 @@
+TakenFromUrl:       http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?
+GetCapabilitiesUrl: http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               CZ.VY Vysocina  p SF=0,7
+MapType:                        photo
+MainUrl:            http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=zm50|ZM 1:50 000||
+#LayersUrlPart:     LAYERS=rzm10|RZM 1:10 000||
+#LayersUrlPart:     LAYERS=orto_bw|Ortofoto BW 0,7m/px||
+#LayersUrlPart:     LAYERS=technol|Technologie||
+#LayersUrlPart:     LAYERS=plan|Planovan? stav||
+#LayersUrlPart:     LAYERS=hotspot|HOTSPOT||
+#LayersUrlPart:     LAYERS=cdoptika|CDoptika||
+#LayersUrlPart:     LAYERS=taliasonera|TeliaSonera||
+#LayersUrlPart:     LAYERS=selfnet|Selfnet||
+#LayersUrlPart:     LAYERS=jme_optika|JME_optika||
+#LayersUrlPart:     LAYERS=optokon|Optokon||
+#LayersUrlPart:     LAYERS=optika|Optika ostatn?||
+#LayersUrlPart:     LAYERS=obce2005|Obce|0|NaN
+#LayersUrlPart:     LAYERS=pov_hr|OPV|NaN|99999999
+#LayersUrlPart:     LAYERS=orp_hr|ORP|NaN|99999999
+#LayersUrlPart:     LAYERS=kraje_hr|Kraje||
+#LayersUrlPart:     LAYERS=cesko_hr|CR||
+LayersUrlPart:     LAYERS=orto_bw
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 49.9457 E 14.7989
+BoundingBoxButtomRightWGS84: N 48.8765 E 16.5340
+#BBox_Mitte: N 49.41110624465 E 15.6664623227
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   0,7
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/cz-vy_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_t10.wms	2009-09-02 08:15:39 UTC (rev 2129)
+++ trunk/res_noewe/webmapservices/cz-vy_t10.wms	2009-09-02 22:02:10 UTC (rev 2130)
@@ -0,0 +1,38 @@
+TakenFromUrl:       http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?
+GetCapabilitiesUrl: http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               CZ.VY Vysocina  t10 SF=1..3?
+#Name:               CZ.Region Hochland Hauptstadt Jihlava  t10 SF=1..3?
+MapType:                        topo
+MainUrl:            http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=zm50|ZM 1:50 000||
+#LayersUrlPart:     LAYERS=rzm10|RZM 1:10 000||
+#LayersUrlPart:     LAYERS=orto_bw|Ortofoto BW 0,7m/px||
+#LayersUrlPart:     LAYERS=technol|Technologie||
+#LayersUrlPart:     LAYERS=plan|Planovan? stav||
+#LayersUrlPart:     LAYERS=hotspot|HOTSPOT||
+#LayersUrlPart:     LAYERS=cdoptika|CDoptika||
+#LayersUrlPart:     LAYERS=taliasonera|TeliaSonera||
+#LayersUrlPart:     LAYERS=selfnet|Selfnet||
+#LayersUrlPart:     LAYERS=jme_optika|JME_optika||
+#LayersUrlPart:     LAYERS=optokon|Optokon||
+#LayersUrlPart:     LAYERS=optika|Optika ostatn?||
+#LayersUrlPart:     LAYERS=obce2005|Obce|0|NaN
+#LayersUrlPart:     LAYERS=pov_hr|OPV|NaN|99999999
+#LayersUrlPart:     LAYERS=orp_hr|ORP|NaN|99999999
+#LayersUrlPart:     LAYERS=kraje_hr|Kraje||
+#LayersUrlPart:     LAYERS=cesko_hr|CR||
+LayersUrlPart:     LAYERS=rzm10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 49.9457 E 14.7989
+BoundingBoxButtomRightWGS84: N 48.8765 E 16.5340
+#BBox_Mitte: N 49.41110624465 E 15.6664623227
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/cz-vy_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_t50.wms	2009-09-02 08:15:39 UTC (rev 2129)
+++ trunk/res_noewe/webmapservices/cz-vy_t50.wms	2009-09-02 22:02:10 UTC (rev 2130)
@@ -0,0 +1,37 @@
+TakenFromUrl:       http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?
+GetCapabilitiesUrl: http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               CZ.VY Vysocina  t50 SF=4..10?
+MapType:                        topo
+MainUrl:            http://gis.kr-vysocina.cz:80/wmsconnector/com.esri.wms.Esrimap/metropolitky?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=zm50|ZM 1:50 000||
+#LayersUrlPart:     LAYERS=rzm10|RZM 1:10 000||
+#LayersUrlPart:     LAYERS=orto_bw|Ortofoto BW 0,7m/px||
+#LayersUrlPart:     LAYERS=technol|Technologie||
+#LayersUrlPart:     LAYERS=plan|Planovan? stav||
+#LayersUrlPart:     LAYERS=hotspot|HOTSPOT||
+#LayersUrlPart:     LAYERS=cdoptika|CDoptika||
+#LayersUrlPart:     LAYERS=taliasonera|TeliaSonera||
+#LayersUrlPart:     LAYERS=selfnet|Selfnet||
+#LayersUrlPart:     LAYERS=jme_optika|JME_optika||
+#LayersUrlPart:     LAYERS=optokon|Optokon||
+#LayersUrlPart:     LAYERS=optika|Optika ostatn?||
+#LayersUrlPart:     LAYERS=obce2005|Obce|0|NaN
+#LayersUrlPart:     LAYERS=pov_hr|OPV|NaN|99999999
+#LayersUrlPart:     LAYERS=orp_hr|ORP|NaN|99999999
+#LayersUrlPart:     LAYERS=kraje_hr|Kraje||
+#LayersUrlPart:     LAYERS=cesko_hr|CR||
+LayersUrlPart:     LAYERS=zm50
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 49.9457 E 14.7989
+BoundingBoxButtomRightWGS84: N 48.8765 E 16.5340
+#BBox_Mitte: N 49.41110624465 E 15.6664623227
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png



From pfeffer at mail.berlios.de  Thu Sep  3 11:40:36 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 3 Sep 2009 11:40:36 +0200
Subject: [Cachewolf-svn] r2131 - trunk/src/CacheWolf/navi
Message-ID: <200909030940.n839easa030976@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-03 11:40:35 +0200 (Thu, 03 Sep 2009)
New Revision: 2131

Modified:
   trunk/src/CacheWolf/navi/ProjectedPoint.java
Log:
TransformCoordinates: ProjectedPoint.getProjection: bug fixed: German Gau?-Kr?ger stripe 5 supported again

Modified: trunk/src/CacheWolf/navi/ProjectedPoint.java
===================================================================
--- trunk/src/CacheWolf/navi/ProjectedPoint.java	2009-09-02 22:02:10 UTC (rev 2130)
+++ trunk/src/CacheWolf/navi/ProjectedPoint.java	2009-09-03 09:40:35 UTC (rev 2131)
@@ -74,7 +74,8 @@
 		case TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_NEW: return PJ_AUSTRIAN_LAMBERT_NEW;
 		case TransformCoordinates.EPSG_GERMAN_GK2: 
 		case TransformCoordinates.EPSG_GERMAN_GK3: 
-		case TransformCoordinates.EPSG_GERMAN_GK4: return PJ_GERMAN_GK;
+		case TransformCoordinates.EPSG_GERMAN_GK4:
+		case TransformCoordinates.EPSG_GERMAN_GK5:return PJ_GERMAN_GK;
 		case TransformCoordinates.EPSG_ITALIAN_GB_EW1:
 		case TransformCoordinates.EPSG_ITALIAN_GB_EW2: return PJ_ITALIAN_GB;
 		case TransformCoordinates.EPSG_FRENCH_LAMBERT_NTF_II : return PJ_FRENCH_LAMBERT_NTF_II;



From jennergruhle at mail.berlios.de  Thu Sep  3 13:01:38 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Thu, 3 Sep 2009 13:01:38 +0200
Subject: [Cachewolf-svn] r2132 - trunk/src/CacheWolf
Message-ID: <200909031101.n83B1cY4002295@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-03 12:52:14 +0200 (Thu, 03 Sep 2009)
New Revision: 2132

Modified:
   trunk/src/CacheWolf/UrlFetcher.java
Log:
fetchByteArray: urltmp handling for redirects:
- replace /../ by / (.. is not allowed)
- when redirect is an URI: construct full URL

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2009-09-03 09:40:35 UTC (rev 2131)
+++ trunk/src/CacheWolf/UrlFetcher.java	2009-09-03 10:52:14 UTC (rev 2132)
@@ -4,6 +4,7 @@
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
 import ewe.net.Socket;
+import ewe.net.URL;
 import ewe.util.ByteArray;
 import ewe.util.CharArray;
 import ewe.util.Properties;
@@ -48,6 +49,13 @@
 			sock = conn.connect();
 			if (conn.responseCode >= 400) throw new IOException("URL: "+ urltmp + "\nhttp response code: " + conn.responseCode);
 			urltmp = conn.getRedirectTo();
+			if(urltmp!=null){
+				urltmp = urltmp.replaceAll("/\\.\\./", "/");
+				URL eweUrl = new URL(url);
+				if(urltmp.indexOf(eweUrl.getHost())<0){
+					urltmp = new URL(eweUrl.getProtocol(), eweUrl.getHost(),eweUrl.getPort(), urltmp).url;
+				}
+			}
 		} while (urltmp != null && i <= maxRedirections ); 
 		if (i > maxRedirections) throw new IOException("too many http redirections while trying to fetch: "+url + " only "+maxRedirections+" are allowed");
 		ByteArray daten = conn.readData(sock);



From jennergruhle at mail.berlios.de  Thu Sep  3 13:08:08 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Thu, 3 Sep 2009 13:08:08 +0200
Subject: [Cachewolf-svn] r2133 - trunk/src/CacheWolf/imp
Message-ID: <200909031108.n83B88CF010568@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-03 13:08:05 +0200 (Thu, 03 Sep 2009)
New Revision: 2133

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
variable OC hostname for one of the OC domains - selected dynamically from waypoint name

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-03 10:52:14 UTC (rev 2132)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-03 11:08:05 UTC (rev 2133)
@@ -34,7 +34,7 @@
 import ewe.sys.Double;
 
 /**
- *	Class to import Data from opencaching.de. 
+ *	Class to import Data from opencaching. 
  *	It uses the lastmodified parameter to identify new or changed caches.
  *	See here: http://www.opencaching.com/phpBB2/viewtopic.php?t=281 (out-dated)
  *   See here: http://www.opencaching.de/doc/xml/xml11.htm and http://develforum.opencaching.de/viewtopic.php?t=135&postdays=0&postorder=asc&start=0
@@ -46,8 +46,18 @@
 	static protected final int STAT_CACHE_DESC = 2;
 	static protected final int STAT_CACHE_LOG = 3;
 	static protected final int STAT_PICTURE = 4;
-
-	final static String OPENCACHING_HOST = "www.opencaching.de";
+	
+	public final static String OPENCACHING_DE_HOST = "www.opencaching.de";
+	public final static String OPENCACHING_DE_PATTERN = "OC";
+	public final static String OPENCACHING_PL_HOST = "www.opencaching.pl";
+	public final static String OPENCACHING_PL_PATTERN = "OP";
+	public final static String OPENCACHING_CZ_HOST = "www.opencaching.cz";
+	public final static String OPENCACHING_CZ_PATTERN = "OZ";
+	public final static String OPENCACHING_UK_HOST = "www.opencaching.org.uk";
+	public final static String OPENCACHING_UK_PATTERN = "OK";
+	
+	String hostname;
+	
 	int state = STAT_INIT;
 	int numCacheImported, numDescImported, numLogImported= 0;
 
@@ -69,7 +79,6 @@
 	String picUrl = new String();
 	String picTitle =  new String();
 	String picID = new String();
-	String ocSeekUrl = new String("http://"+OPENCACHING_HOST+"/viewcache.php?cacheid=");
 	String cacheID = new String();
 
 	String logData, logIcon, logDate, logFinder, logId;
@@ -97,6 +106,17 @@
 		}//for
 
 	}
+	
+	protected void setHostname(String wpName){
+		if(wpName.startsWith(OPENCACHING_DE_PATTERN))
+			hostname = OPENCACHING_DE_HOST;
+		else if(wpName.startsWith(OPENCACHING_PL_PATTERN))
+			hostname = OPENCACHING_PL_HOST;
+		else if(wpName.startsWith(OPENCACHING_CZ_PATTERN))
+			hostname = OPENCACHING_CZ_HOST;
+		else if(wpName.startsWith(OPENCACHING_UK_PATTERN))
+			hostname = OPENCACHING_UK_HOST;
+	}
 
 	/** true, if not the last syncdate shall be used, but the caches shall be reloaded
 	 * only used in syncSingle */
@@ -110,20 +130,23 @@
 	public boolean syncSingle(int number, InfoBox infB) {
 		ch = cacheDB.get(number);
 		holder= null; //new CacheHolderDetail(ch); //TODO is this still correct? use getDetails ?
+		setHostname(ch.getWayPoint());
 
 		if (infB.isClosed) {
 			if (askForOptions) return false; 
 			else return true;
 		}
+		
 		if (askForOptions) {
-			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL);
+			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( 
+				MyLocale.getMsg(1600, hostname + " Download"),OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL);
 			if (importOpt.execute() == FormBase.IDCANCEL) {	return false; }
 			askForOptions = false;
 			reload = importOpt.missingCheckBox.getState();
 		}
 
 		// this is only a dummy-InfoBox for capturing the output
-		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
+		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from " + hostname), InfoBox.PROGRESS_WITH_WARNINGS, false);
 //		inf.setPreferredSize(220, 300);
 //		inf.relayout(false);
 //		inf.exec();
@@ -141,7 +164,7 @@
 		String url = new String();
 		picCnt = 0;
 		//Build url
-		url = "http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
+		url = "http://" + hostname + "/xml/ocxml11.php?"
 			+ "modifiedsince=" + lastS
 			+ "&cache=1"
 			+ "&cachedesc=1";
@@ -171,7 +194,8 @@
 			(new MessageBox("Error", "Coordinates for centre must be set", FormBase.OKB)).execute();
 			return;
 		}
-		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),
+		setHostname(ch.getWayPoint());
+		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, hostname + " Download"),
 																 OCXMLImporterScreen.ALL | OCXMLImporterScreen.DIST | OCXMLImporterScreen.IMAGES);
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
 		Vm.showWait(true);
@@ -198,7 +222,7 @@
 		}	
 		picCnt = 0;
 		//Build url
-		url = "http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
+		url = "http://" + hostname + "/xml/ocxml11.php?"
 			+ "modifiedsince=" + lastS
 			+ "&cache=1"
 			+ "&cachedesc=1";
@@ -276,12 +300,12 @@
 			else {
 				if (e.getMessage().equalsIgnoreCase("could not connect") ||
 						e.getMessage().equalsIgnoreCase("unkown host")) { // is there a better way to find out what happened?
-					finalMessage = MyLocale.getMsg(1616,"Error: could not download udpate file from opencaching.de");
+					finalMessage = MyLocale.getMsg(1616,"Error: could not download update file from " + hostname);
 				} else { finalMessage = "IOException: "+e.getMessage(); }
 				success = false;
 			}
 		}catch (IllegalArgumentException e) {
-			finalMessage = MyLocale.getMsg(1621,"Error parsing update file\n this is likely a bug in opencaching.de\nplease try again later\n, state:")+" "+state+", waypoint: "+ holder.getWayPoint();
+			finalMessage = MyLocale.getMsg(1621,"Error parsing update file\n this is likely a bug in " + hostname + "\nplease try again later\n, state:")+" "+state+", waypoint: "+ holder.getWayPoint();
 			success = false;
 			Vm.debug("Parse error: " + state + " " + holder.getWayPoint());
 			e.printStackTrace();
@@ -392,11 +416,12 @@
 
 		if(name.equals("waypoints")){
 			holder.setWayPoint(atts.getValue("oc"));
-			if (holder.getWayPoint().length()==0) throw new IllegalArgumentException("empty waypointname"); // this should not happen - it is likey a bug in opencaching.de / it happens on 27-12-2006 on cache OC143E
+			if (holder.getWayPoint().length()==0) throw new IllegalArgumentException("empty waypointname"); // this should not happen - it is likey a bug in opencaching / it happens on 27-12-2006 on cache OC143E
 			return;
 		}
 
 	}
+	
 	private void startCacheDesc(String name, AttributeList atts){
 		inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported);
 		if (name.equals("cachedesc")){
@@ -443,6 +468,7 @@
 
 	// TODO Do we have to release the "holder" cache details ?
 	private void endCache(String name){
+		setHostname(ch.getWayPoint());
 		if (name.equals("cache")){
 			holder.setLastSync(dateOfthisSync.format("yyyyMMddHHmmss"));
 			int index;
@@ -476,6 +502,7 @@
 		if(name.equals("id")){ // </id>
 			holder = getHolder(strData); // Allocate a new CacheHolder object
 			holder.setOcCacheID(strData);
+			String ocSeekUrl = new String("http://" + hostname + "/viewcache.php?cacheid=");
 			holder.getFreshDetails().URL = ocSeekUrl + cacheID;
 			return;
 		}
@@ -523,15 +550,15 @@
 			if (name.equals("cachedesc")){
 				if (pref.downloadPics && holder.is_HTML()) {
 					String fetchUrl, imgTag, imgAltText;
-					Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enth?lt keine Anf?hrungszeichen
+					Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enthlt keine Anfhrungszeichen
 					Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
 					imgRegexAlt.setIgnoreCase(true);
 					imgRegexUrl.setIgnoreCase(true);
 					int descIndex=0;
 					int numDownloaded=1;
 					while (imgRegexUrl.searchFrom(holder.getFreshDetails().LongDescription, descIndex)) { // "img" found
-						imgTag=imgRegexUrl.stringMatched(1); // (1) enth?lt das gesamte <img ...>-tag
-						fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anf?hrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anf?hrungszeichen 
+						imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte <img ...>-tag
+						fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen 
 						if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
 						if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
 							inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+holder.getWayPoint()));
@@ -541,9 +568,9 @@
 						if (imgRegexAlt.search(imgTag)) {
 							imgAltText=imgRegexAlt.stringMatched(1);
 							if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
-							// kein alternativer Text als Bild?berschrift -> Dateiname
+							// kein alternativer Text als Bildberschrift -> Dateiname
 						} else { 
-							if (fetchUrl.toLowerCase().indexOf("opencaching.de") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend 
+							if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend 
 								imgAltText = new String("No image title");
 							else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf("/")+1);
 						}
@@ -586,8 +613,12 @@
 	}
 	
 	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs
+		setHostname(ch.getWayPoint());
 		try {
-			if (!fetchURL.startsWith("http://")) fetchURL = new URL(new URL("http://" + OPENCACHING_HOST+"/"), fetchURL).toString(); // TODO this is not quite correct: actually the "base" URL must be known... but anyway a different baseURL should not happen very often  - it doesn't in my area
+			//TODO this is not quite correct: actually the "base" URL must be known... 
+			// but anyway a different baseURL should not happen very often  - it doesn't in my area
+			if (!fetchURL.startsWith("http://")) fetchURL = new URL(
+				new URL("http://" + hostname+"/"), fetchURL).toString(); 
 			String fileName = createPicFilename(fetchURL);
 			ImageInfo imageInfo = new ImageInfo();
 			// add title
@@ -606,7 +637,8 @@
 			} catch (IOException e) {
 				String ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
 				if (e.getMessage().toLowerCase().equalsIgnoreCase("could not connect") ||
-						e.getMessage().equalsIgnoreCase("unkown host")) { // is there a better way to find out what happened?
+						e.getMessage().equalsIgnoreCase("unkown host")) { 
+					// is there a better way to find out what happened?
 					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+holder.getCacheName() + " ("+holder.getWayPoint()+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
 				} 
 				inf.addWarning("\n"+ErrMessage);



From jennergruhle at mail.berlios.de  Thu Sep  3 13:09:53 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Thu, 3 Sep 2009 13:09:53 +0200
Subject: [Cachewolf-svn] r2134 - trunk/src/CacheWolf
Message-ID: <200909031109.n83B9rgt014180@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-03 13:09:51 +0200 (Thu, 03 Sep 2009)
New Revision: 2134

Modified:
   trunk/src/CacheWolf/MainMenu.java
Log:
updateSelectedCaches: added the other OC domains

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-09-03 11:08:05 UTC (rev 2133)
+++ trunk/src/CacheWolf/MainMenu.java	2009-09-03 11:09:51 UTC (rev 2134)
@@ -780,11 +780,14 @@
 		for(int i = 0; i <	cacheDB.size(); i++){
 			ch = cacheDB.get(i);
 			if(ch.is_Checked == true && ch.isVisible()) {
-				if ( ch.getWayPoint().length()>1 && (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC") 
-						|| ch.getWayPoint().substring(0,2).equalsIgnoreCase("OC")))
-//					if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
+				String wpStart = ch.getWayPoint().substring(0,2);
+				if ( ch.getWayPoint().length()>1 && (wpStart.equalsIgnoreCase("GC") 
+					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_DE_PATTERN)
+					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_PL_PATTERN)
+					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_CZ_PATTERN)
+					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_UK_PATTERN)))
 //					Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
-//					Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
+//					Alter code prft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
 				{
 					cachesToUpdate.add(new Integer(i));
 				} else {
@@ -796,8 +799,9 @@
 					if (!ch.isAddiWpt() && !alreadySaid) {
 						alreadySaid = true;
 						(new MessageBox(MyLocale.getMsg(327,"Information"),
-								        ch.getWayPoint()+ 
-								        MyLocale.getMsg(5002,": At the moment this function is only applicable for geocaching.com and opencaching.de."), FormBase.OKB)).execute();
+					        ch.getWayPoint()+ MyLocale.getMsg(5002,
+					        	": At the moment this function is only applicable for geocaching.com and opencaching.de/.pl/.cz/.org.uk ."),
+					        FormBase.OKB)).execute();
 					}
 				}
 



From pfeffer at mail.berlios.de  Thu Sep  3 13:21:12 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 3 Sep 2009 13:21:12 +0200
Subject: [Cachewolf-svn] r2135 - trunk/src/CacheWolf/navi
Message-ID: <200909031121.n83BLCRQ030982@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-03 13:21:10 +0200 (Thu, 03 Sep 2009)
New Revision: 2135

Modified:
   trunk/src/CacheWolf/navi/TransformCoordinates.java
   trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java
Log:
added some modifiers, hoping to speed it up.

Modified: trunk/src/CacheWolf/navi/TransformCoordinates.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinates.java	2009-09-03 11:09:51 UTC (rev 2134)
+++ trunk/src/CacheWolf/navi/TransformCoordinates.java	2009-09-03 11:21:10 UTC (rev 2135)
@@ -230,17 +230,17 @@
 		return ret;
 	}
 
-	public static boolean isSupported(int epsgcode) {
+	public static final boolean isSupported(int epsgcode) {
 		if ((epsgcode == EPSG_WGS84) || epsgcode == EPSG_ETRS89) return true;
 		return (getLocalProjectionSystem(epsgcode) >= 0);
 	}
 
 
-	public static CWPoint ProjectedEpsgToWgs84(ProjectedPoint lp, int epsg) {
+	public static final CWPoint ProjectedEpsgToWgs84(ProjectedPoint lp, int epsg) {
 		return ProjectedToWgs84(lp, epsg, false);
 	}
 
-	public static CWPoint ProjectedToWgs84(ProjectedPoint lp, int epsg_localsystem, boolean isLocalSystem) {
+	public static final CWPoint ProjectedToWgs84(ProjectedPoint lp, int epsg_localsystem, boolean isLocalSystem) {
 		CWPoint ll = lp.unproject();
 		int ls = (isLocalSystem ? epsg_localsystem : getLocalProjectionSystem(epsg_localsystem));
 		TransformParameters transparams = getTransParams(lp, ls);
@@ -267,14 +267,14 @@
 	 */
 
 
-	public static TransformParameters getGermanGkTransformParameters(TrackPoint ll) {
+	public static final TransformParameters getGermanGkTransformParameters(TrackPoint ll) {
 		if (FORMER_GDR.isInBound(ll)) return GK_GERMANY_2001_TO_WGS84; // exlcude former GDR from the splitting germany in north/middel/south
 		if (ll.latDec <= 55 && ll.latDec >= 52.33333334 ) return  GK_NORD_GERMANY_TO_WGS84;
 		if (ll.latDec <= 52.33333334  && ll.latDec >= 50.33333334 ) return  GK_MID_GERMANY_TO_WGS84;
 		if (ll.latDec <= 50.33333334  && ll.latDec >= 47) return  GK_SOUTH_GERMANY_TO_WGS84;
 		return GK_GERMANY_2001_TO_WGS84;
 	}
-	public static TransformParameters getGermanTransformParams(ProjectedPoint gk) {
+	public static final TransformParameters getGermanTransformParams(ProjectedPoint gk) {
 		double n = gk.getNorthing();
 		if (n <= 6089288.064 && n >= 5585291.767 && // these coordinates are transformed ones from the invers routine
 				( gk.zone == 4 && gk.getEasting() >= 4404124.247 && gk.getEasting() <= 4679300.398) ||
@@ -286,23 +286,23 @@
 		return GK_GERMANY_2001_TO_WGS84;
 	}
 
-	public static TransformParameters getItalianGkTransformParameters(TrackPoint ll) {
+	public static final TransformParameters getItalianGkTransformParameters(TrackPoint ll) {
 		if (ITALY_SARDINIA.isInBound(ll)) return GB_ITALIAN_SARDINIA_TO_WGS84;
 		if (ITALY_SICILIA.isInBound(ll)) return GB_ITALIAN_SICILIA_TO_WGS84;
 		else return GB_ITALIAN_PENINSULAR_TO_WGS84;
 	}
-	public static TransformParameters getItalianTransformParams(ProjectedPoint gk) {
+	public static final TransformParameters getItalianTransformParams(ProjectedPoint gk) {
 		if (ITALY_SARDINIA_GK.isInBound(gk.toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB))) return GB_ITALIAN_SARDINIA_TO_WGS84;
 		if (ITALY_SICILIA_GK.isInBound(gk.toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB))) return GB_ITALIAN_SICILIA_TO_WGS84;
 		else return GB_ITALIAN_PENINSULAR_TO_WGS84;
 	}
 
 
-	public static ProjectedPoint wgs84ToEpsg(TrackPoint wgs84, int epsg) throws IllegalArgumentException {
+	public static final ProjectedPoint wgs84ToEpsg(TrackPoint wgs84, int epsg) throws IllegalArgumentException {
 		return wgs84ToEpsgLocalsystem(wgs84, epsg, false);
 	}
 
-	public static ProjectedPoint wgs84ToLocalsystem(TrackPoint wgs84, int localsystem) throws IllegalArgumentException {
+	public static final ProjectedPoint wgs84ToLocalsystem(TrackPoint wgs84, int localsystem) throws IllegalArgumentException {
 		return wgs84ToEpsgLocalsystem(wgs84, localsystem, true);
 	}
 
@@ -314,7 +314,7 @@
 	 * @return
 	 * @throws IllegalArgumentException if EPSG code is not supported GK or unsupported
 	 */
-	private static ProjectedPoint wgs84ToEpsgLocalsystem(TrackPoint wgs84, int epsg_localsystem, boolean isLocalsystem) throws IllegalArgumentException {
+	private static final ProjectedPoint wgs84ToEpsgLocalsystem(TrackPoint wgs84, int epsg_localsystem, boolean isLocalsystem) throws IllegalArgumentException {
 		//wgs84.latDec = 47.07472; // Testkoordinaten von http://www.geoclub.de/viewtopic.php?f=54&t=23912&start=30 
 		//wgs84.lonDec = 12.69417;
 		// xyzWgs.x = 3657660.66; // test case http://www.epsg.org/ p. 109 WGS72_TO_WGS84
@@ -330,7 +330,7 @@
 		return ret;
 	}
 
-	private static TransformParameters getTransParams(TrackPoint wgs84, int localsystem) {
+	private static final TransformParameters getTransParams(TrackPoint wgs84, int localsystem) {
 		switch(localsystem) {
 		case TransformCoordinates.LOCALSYSTEM_GERMAN_GK: 
 			return getGermanGkTransformParameters(wgs84); 
@@ -347,7 +347,7 @@
 			throw new IllegalArgumentException("TransformCoordinates.getTransParams(wgs84): localsystem: " + localsystem + "not supported");
 		}
 	}
-	private static TransformParameters getTransParams(ProjectedPoint pp, int localsystem) {
+	private static final TransformParameters getTransParams(ProjectedPoint pp, int localsystem) {
 		TransformParameters transparams;
 		switch (localsystem) {
 		case TransformCoordinates.LOCALSYSTEM_GERMAN_GK:
@@ -367,7 +367,7 @@
 	}
 
 
-	private static XyzCoordinates latLon2xyz(TrackPoint ll, double alt, Ellipsoid ellipsoid) {
+	private static final XyzCoordinates latLon2xyz(TrackPoint ll, double alt, Ellipsoid ellipsoid) {
 		if (!ll.isValid()) throw new IllegalArgumentException("latLon2xyz: invalid lat-lon");
 		double e2 = (ellipsoid.a * ellipsoid.a - ellipsoid.b * ellipsoid.b)/(ellipsoid.a * ellipsoid.a);
 		double N = ellipsoid.a/ Math.sqrt(1 - e2 * Math.pow(Math.sin(ll.latDec / 180*Math.PI), 2));
@@ -378,7 +378,7 @@
 		return ret;
 	}
 
-	private static XyzCoordinates transform(XyzCoordinates from, TransformParameters transParams) {
+	private static final XyzCoordinates transform(XyzCoordinates from, TransformParameters transParams) {
 
 		Matrix coos = new Matrix(3, 1);
 		coos.matrix[0][0] = from.x;
@@ -405,7 +405,7 @@
 		return new XyzCoordinates(coos.matrix[0][0], coos.matrix[1][0], coos.matrix[2][0]);
 	}
 
-	private static CWPoint xyz2Latlon(XyzCoordinates from, Ellipsoid ellipsoid) {
+	private static final CWPoint xyz2Latlon(XyzCoordinates from, Ellipsoid ellipsoid) {
 		double e2 = (ellipsoid.a * ellipsoid.a - ellipsoid.b * ellipsoid.b)/(ellipsoid.a * ellipsoid.a);
 		double s = Math.sqrt( Math.pow(from.x,2) + Math.pow(from.y,2));
 		double T = Math.atan( from.z * ellipsoid.a / (s * ellipsoid.b));
@@ -423,7 +423,7 @@
 
 }
 
-class XyzCoordinates {
+final class XyzCoordinates {
 	double x, y, z;
 	public XyzCoordinates (double xi, double yi, double zi) {
 		x = xi;
@@ -433,7 +433,7 @@
 }
 
 
-class TransformParameters {
+final class TransformParameters {
 	// shift parameter in meter
 	double dx, dy, dz, 
 	// rotation parameter in rad
@@ -441,6 +441,7 @@
 	// scale as multiplicator
 	s;
 	Ellipsoid ellip;
+	public TransformParameters inverted = null;
 
 	/**
 	 * 
@@ -454,7 +455,7 @@
 		ellip = ellip_;
 	}
 
-	protected void set(double dxi, double dyi, double dzi, double exi, double eyi, double ezi, double si, boolean addinverted) {
+	protected final void set(double dxi, double dyi, double dzi, double exi, double eyi, double ezi, double si, boolean addinverted) {
 		dx = dxi; dy = dyi; dz = dzi; 
 		ex = exi * Math.PI/180/3600;
 		ey = eyi * Math.PI/180/3600; 
@@ -474,12 +475,11 @@
 		if (invert) invert();
 	}
 
-	public void invert() {
+	public final void invert() {
 		dx *= -1; dy *= -1;	dz *= -1;
 		ex *= -1; ey *= -1;	ez *= -1;
 		s = 1/s;
 	}
-	public TransformParameters inverted = null;
 }
 
 

Modified: trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java	2009-09-03 11:09:51 UTC (rev 2134)
+++ trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java	2009-09-03 11:21:10 UTC (rev 2135)
@@ -15,8 +15,8 @@
  * @author Pfeffer
  *
  */
-public class TransformCoordinatesProperties extends Properties {
-	public int epsgCode;
+public final class TransformCoordinatesProperties {
+
 	/**
 	 * return ll transformed into the desired coordinate reference system
 	 * if the prjection is Gau?-Kr?ger, easting will be put in lonDec and
@@ -24,7 +24,7 @@
 	 * @param ll
 	 * @return
 	 */
-	public static TrackPoint fromWgs84(TrackPoint ll, int epsgCode) {
+	public final static TrackPoint fromWgs84(TrackPoint ll, int epsgCode) {
 		TrackPoint ret = null;
 		switch (epsgCode) {
 		case TransformCoordinates.EPSG_WGS84:
@@ -52,7 +52,7 @@
 	 * @param p
 	 * @return
 	 */
-	public static CWPoint toWgs84(CWPoint p, int epsgCode) {
+	public final static CWPoint toWgs84(CWPoint p, int epsgCode) {
 		CWPoint ret = null;
 		switch (epsgCode) {
 		case TransformCoordinates.EPSG_WGS84:



From pfeffer at mail.berlios.de  Thu Sep  3 13:26:18 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 3 Sep 2009 13:26:18 +0200
Subject: [Cachewolf-svn] r2136 - trunk/src/CacheWolf
Message-ID: <200909031126.n83BQIVv006014@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-03 13:26:08 +0200 (Thu, 03 Sep 2009)
New Revision: 2136

Modified:
   trunk/src/CacheWolf/UrlFetcher.java
Log:
Method String.replaceAll for Strings as arguments is not supported in Ewe, use self defined STRReplace instead

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2009-09-03 11:21:10 UTC (rev 2135)
+++ trunk/src/CacheWolf/UrlFetcher.java	2009-09-03 11:26:08 UTC (rev 2136)
@@ -50,7 +50,7 @@
 			if (conn.responseCode >= 400) throw new IOException("URL: "+ urltmp + "\nhttp response code: " + conn.responseCode);
 			urltmp = conn.getRedirectTo();
 			if(urltmp!=null){
-				urltmp = urltmp.replaceAll("/\\.\\./", "/");
+				urltmp = STRreplace.replace(urltmp, "/\\.\\./", "/");
 				URL eweUrl = new URL(url);
 				if(urltmp.indexOf(eweUrl.getHost())<0){
 					urltmp = new URL(eweUrl.getProtocol(), eweUrl.getHost(),eweUrl.getPort(), urltmp).url;



From jennergruhle at mail.berlios.de  Thu Sep  3 18:57:48 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Thu, 3 Sep 2009 18:57:48 +0200
Subject: [Cachewolf-svn] r2137 - trunk/res_noewe/languages
Message-ID: <200909031657.n83GvmW6008232@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-03 18:57:39 +0200 (Thu, 03 Sep 2009)
New Revision: 2137

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
Log:
added the other OC domains for 5002

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-03 11:26:08 UTC (rev 2136)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-03 16:57:39 UTC (rev 2137)
@@ -780,7 +780,7 @@
 		4924=ToWgs84: EPSG code+
 		5000=Lade Cacheliste
 		5001=Hilfswegpunkte k%f6nnnen nicht direkt gespidert werden.%0aBitte zus%e4tzlich den Vater anhaken.
-		5002=: Diese Funktion steht gegenw%e4rtig nur f%fcr Geocaching.com und Opencaching.de zur Verf%fcgung.
+		5002=: Diese Funktion steht gegenw%e4rtig nur f%fcr Geocaching.com und Opencaching.de/.cz/.org.uk zur Verf%fcgung.
 		5003=Optionen
 		5004=Erstelle Beziehungen f%fcr zus%e4tzliche Wegpunkte...
 		5497=Fehler: Ein Tag in spider.def fehlt

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-03 11:26:08 UTC (rev 2136)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-03 16:57:39 UTC (rev 2137)
@@ -770,7 +770,7 @@
 		5499=Error loading login page.%0aPlease check your internet connection.
 		5000=Load Cachelist
 		5001=Can't spider additional waypoint directly.%0aPlease check main cache.
-		5002=: At the moment this function is only applicable for geocaching.com and opencaching.de.
+		5002=: At the moment this function is only applicable for geocaching.com and opencaching.de/.cz/.org.uk .
 		5003=Options
 		5004=Building references for additional waypoints...
 		5497=Error missing tag in spider.def

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-03 11:26:08 UTC (rev 2136)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-03 16:57:39 UTC (rev 2137)
@@ -757,7 +757,7 @@
 		4924=ToWgs84: code EPSG+
 		5000=Chargeant liste de caches
 		5001=Ne peut pas spider waypoints suppletif.%0aCochez le parent, svp..
-		5002=: Cette fonction n'est disponible que pour Geocaching.com et Opencaching.de momentan%e9ment.
+		5002=: Cette fonction n'est disponible que pour Geocaching.com et Opencaching.de/.cz/.org.uk momentan%e9ment.
 		5003=Options
 		5004=Cr%e9ant r%e9f%e9rences pour les waypoints additionelles...
 		5497=Erreur: Une balise manque en spider.def

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-09-03 11:26:08 UTC (rev 2136)
+++ trunk/res_noewe/languages/NL.cfg	2009-09-03 16:57:39 UTC (rev 2137)
@@ -550,7 +550,9 @@
 		4502=Fnd:
 		4600=Sommige caches kunnen niet worden getoond door verkeerde blacklist status.
 		5000=Laad cache lijst
-		5004=
+		5001=Kan niet extra waypoint laaden.%0aGelieve te laaden hoofd Waypoint.
+		5002=Op het ogenblik is deze functie slechts toepasselijk voor geocaching.com en opencaching.de/.cz/.org.uk .
+		5004=Bouw de verwijzingen voor extra waypoints
 		5497=Fout, verdwenen tag in spider.def.
 		5498=Login fout. Fout bij het laden van de pagina na login.
 		5499=Fout bij het laden van de login pagina.



From jennergruhle at mail.berlios.de  Thu Sep  3 19:19:15 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Thu, 3 Sep 2009 19:19:15 +0200
Subject: [Cachewolf-svn] r2138 - trunk/src/CacheWolf
Message-ID: <200909031719.n83HJFJc007286@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-03 19:19:08 +0200 (Thu, 03 Sep 2009)
New Revision: 2138

Modified:
   trunk/src/CacheWolf/UrlFetcher.java
Log:
fetchByteArray: urltmp handling for redirects:
- replace <hostname>/../ by <hostname>/ (.. is not allowed when on root path)

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2009-09-03 16:57:39 UTC (rev 2137)
+++ trunk/src/CacheWolf/UrlFetcher.java	2009-09-03 17:19:08 UTC (rev 2138)
@@ -50,11 +50,11 @@
 			if (conn.responseCode >= 400) throw new IOException("URL: "+ urltmp + "\nhttp response code: " + conn.responseCode);
 			urltmp = conn.getRedirectTo();
 			if(urltmp!=null){
-				urltmp = STRreplace.replace(urltmp, "/\\.\\./", "/");
 				URL eweUrl = new URL(url);
 				if(urltmp.indexOf(eweUrl.getHost())<0){
 					urltmp = new URL(eweUrl.getProtocol(), eweUrl.getHost(),eweUrl.getPort(), urltmp).url;
 				}
+				urltmp = STRreplace.replace(urltmp, eweUrl.getHost() + "/\\.\\./", eweUrl.getHost() + "/");
 			}
 		} while (urltmp != null && i <= maxRedirections ); 
 		if (i > maxRedirections) throw new IOException("too many http redirections while trying to fetch: "+url + " only "+maxRedirections+" are allowed");



From mirabilos at mail.berlios.de  Thu Sep  3 20:51:46 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Thu, 3 Sep 2009 20:51:46 +0200
Subject: [Cachewolf-svn] r2139 - trunk/res_noewe/languages
Message-ID: <200909031851.n83IpkBd029087@sheep.berlios.de>

Author: mirabilos
Date: 2009-09-03 20:51:45 +0200 (Thu, 03 Sep 2009)
New Revision: 2139

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
Log:
There are four OpenCaching domains, not three.


Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-03 17:19:08 UTC (rev 2138)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-03 18:51:45 UTC (rev 2139)
@@ -113,7 +113,7 @@
 		221=Filter %fcberschreiben?
 		222=Der Filter existiert schon. %dcberschreiben?
 		223=Filter l%f6schen?
-		224=+- Den gespeicherten Filter l%f6schen? 
+		224=+- Den gespeicherten Filter l%f6schen?
 		225=Auch in Logs
 		250=ColleIsarcos Texte fuer den DataMover
 		251=Alle Wegpunkte werden gel%f6scht
@@ -780,7 +780,7 @@
 		4924=ToWgs84: EPSG code+
 		5000=Lade Cacheliste
 		5001=Hilfswegpunkte k%f6nnnen nicht direkt gespidert werden.%0aBitte zus%e4tzlich den Vater anhaken.
-		5002=: Diese Funktion steht gegenw%e4rtig nur f%fcr Geocaching.com und Opencaching.de/.cz/.org.uk zur Verf%fcgung.
+		5002=: Diese Funktion steht gegenw%e4rtig nur f%fcr geocaching.com und opencaching.{cz,de,org.uk,pl} zur Verf%fcgung.
 		5003=Optionen
 		5004=Erstelle Beziehungen f%fcr zus%e4tzliche Wegpunkte...
 		5497=Fehler: Ein Tag in spider.def fehlt

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-03 17:19:08 UTC (rev 2138)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-03 18:51:45 UTC (rev 2139)
@@ -487,7 +487,7 @@
 		1740=Crossbearing degrees  must be in interval [0;360]
 		1741=Crossbearing degrees  must be in interval [0;2*PI]
 		1742=Crossbearing: distance between points to small
-		1743=Crossbearing calculation failed. Please inform the developers at geoclub.de		
+		1743=Crossbearing calculation failed. Please inform the developers at geoclub.de
 		1800=Download georeferenced maps
 		1801=Download tiles
 		1802=Download georeferenced maps%0a Select online service:
@@ -770,7 +770,7 @@
 		5499=Error loading login page.%0aPlease check your internet connection.
 		5000=Load Cachelist
 		5001=Can't spider additional waypoint directly.%0aPlease check main cache.
-		5002=: At the moment this function is only applicable for geocaching.com and opencaching.de/.cz/.org.uk .
+		5002=: At the moment, this function is only available for geocaching.com and opencaching.{cz,de,org.uk,pl}.
 		5003=Options
 		5004=Building references for additional waypoints...
 		5497=Error missing tag in spider.def

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-03 17:19:08 UTC (rev 2138)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-03 18:51:45 UTC (rev 2139)
@@ -37,14 +37,14 @@
 		133=Cherche toutes
 		134=Cache choisi
 		139=G%e9rer Travelbugs
-		140=G%e9rer 
-		141=Copier 
-		142=D%e9placer 
+		140=G%e9rer
+		141=Copier
+		142=D%e9placer
 		143=Effacer
-		144=Avertissement 
+		144=Avertissement
 		145=Donn%e9es de TOUTES les waypoints AFFICH%c9ES seront effac%e9es. Continu%e9?
 		146=Donn%e9es de TOUTES les waypoints AFFICH%c9ES seront copi%e9es. Continu%e9?
-		147=Donn%e9es de TOUTES les waypoints AFFICH%c9ES seront d%e9plac%e9es. Continu%e9? 
+		147=Donn%e9es de TOUTES les waypoints AFFICH%c9ES seront d%e9plac%e9es. Continu%e9?
 		148=Choisir dossier
 		149=Cartes
 		150=Importer
@@ -88,7 +88,7 @@
 		196=# Caches en tout (GC&OC)%0a# visible%0a# trouv%e9es
 		197=Afficher/dissimuler tour de cache
 		198=Tour de cache
-		199=Ajouter au tour de cache	
+		199=Ajouter au tour de cache
 		200=D%e9tails
 		201=Description
 		202=Images
@@ -100,7 +100,7 @@
 		208=R%e9cr%e9er index
 		209=R%e9cr%e9er index
 		210=Caches pas en index.xml:+
-		211=%0aDont ajout%e9e:+  
+		211=%0aDont ajout%e9e:+
 		212=Effacer toutes les fichier .xml (et images) qui ne sont pas en index.xml
 		213=Effacer les fichier .xml orpheline
 		214=Nouveau waypoint
@@ -223,7 +223,7 @@
 		628=Statut
 		629=Charger profil automatiquement
 		630=Ind./Logs:  Logs par page
-		631=PDA a bouton "quitter" 
+		631=PDA a bouton "quitter"
 		632=En plus
 		633=Spider Max. logs
 		634=Utiliser proxy
@@ -307,7 +307,7 @@
 		1009=Dir
 		1010=Allez vers cache
 		1011=Filtrer les non-coch%e9e
-		1012=Effacer les coch%e9es 
+		1012=Effacer les coch%e9es
 		1013=Selection
 		1014=Mettre %e0 jour les coch%e9es
 		1015=Cocher toutes
@@ -349,7 +349,7 @@
 		1051=Date de mettre %e0 jour
 		1100=Profils
 		1105=Chercher
-		1106=Choiser profil ou cr%e9er-un 
+		1106=Choiser profil ou cr%e9er-un
 		1107=Cr%e9er
 		1108=Choisir profil
 		1109=Charger
@@ -403,7 +403,7 @@
 		1508=Latitude
 		1509=Longitude
 		1510=Pas de donn%e9es par le GPS%0aFermer connexion avec port seriel.
-		1511=Ne peut pas interpr%e9ter les donn%e9es du GPS%0aCauses possibles:%0aMauvais Port,%0amauvais baud,%0apas de protocole NMEA%0aConnexion ferm%e9e%0aDerni%e8re cha%eene de lettres:%0a 
+		1511=Ne peut pas interpr%e9ter les donn%e9es du GPS%0aCauses possibles:%0aMauvais Port,%0amauvais baud,%0apas de protocole NMEA%0aConnexion ferm%e9e%0aDerni%e8re cha%eene de lettres:%0a
 		1512=Waypoint
 		1513=Ne peut pas afficher carte sans coordonn%e9es valides - Merci d'entrer coordonn%e9es comme destination, centre ou dans le cache choisi et d%e9marrer GPS
 		1600=T%e9l%e9chargement Opencaching.de
@@ -415,10 +415,10 @@
 		1606=Ret%e9l%e9charger toutes
 		1607=Mise %e0 jour par opencaching r%e9ussi
 		1608=T%e9l%e9chargant donn%e9es par opencaching...
-		1609=Importe Cache: 
+		1609=Importe Cache:
 		1610=T%e9l%e9charge la carte manquante
-		1611=Importe description: 
-		1612=Importe Log: 
+		1611=Importe description:
+		1612=Importe Log:
 		1613=Importe Image:
 		1614=Erreur en decompactant le fichier mise %e0 jour
 		1615=Erreur en decompactant le fichier mise %e0 jour. Statut:
@@ -429,21 +429,21 @@
 		1620=t%e9l%e9chargement d'image integr%e8e:+
 		1621=Erreur d'interpretation du fichier mise %e0 jour.%0aC'est probablement un erreur d'opencaching.de%0aEssayez encore une fois plus tard.%0a Statut:
 		1622=Pas t%e9l%e9charger caches trouv%e9es
-		1700=Erreur en lingne: 
-		1701=Colonne: 
-		1702=Variable pas d%e9fini: 
-		1703=Pas de nombre valide: 
+		1700=Erreur en lingne:
+		1701=Colonne:
+		1702=Variable pas d%e9fini:
+		1703=Pas de nombre valide:
 		1704=Fin de logiciel pas attendue
 		1705=ENDIF manquant
-		1706=Attendu: 
-		1707=Trouv%e9: 
-		1708=Nom de fonction pas unique: 
-		1709=Fonction inconnue: 
+		1706=Attendu:
+		1707=Trouv%e9:
+		1708=Nom de fonction pas unique:
+		1709=Fonction inconnue:
 		1710=Ne peut pas compter cha%eene de caract%e8res vide
 		1711=Cha%eenes de caract%e8res de remplacement doivent avoir la m?me longuer
-		1712=Coordonn%e9e invalide: 
+		1712=Coordonn%e9e invalide:
 		1713=Format de coordonn%e9es pas valide. Faut avoir cw / dd / dmm / dms /+
-		1714=Goto: Waypoint n'existe pas: 
+		1714=Goto: Waypoint n'existe pas:
 		1715=instr: Position de d%e9part pas en cha%eene de caract%e8re
 		1716=mid: Attendu param%e8tre en nombre entier
 		1717=mid: Param%e8tre hors domaine valide
@@ -451,11 +451,11 @@
 		1719=Angle doit ?tre dans la domaine [0;360]
 		1720=Ne peut pas extraire la racine d'un nombre negativ
 		1723=Attendu un operateur de comparaison
-		1724=Variable n'a pas de valeur: 
-		1725=Caract%e8re(s) inattendu(s): 
+		1724=Variable n'a pas de valeur:
+		1725=Caract%e8re(s) inattendu(s):
 		1726=Trop d'argument pour fonction
 		1727=Fonction a mauvais nombre d'arguments
-		1728=Fonction pas encore realis%e9e: 
+		1728=Fonction pas encore realis%e9e:
 		1729=Division par 0
 		1730=" manquant %e0 la fin de la cha%eene de caract%e8res
 		1731=Caract%e8re de format pas valide
@@ -465,7 +465,7 @@
 		1735=Calcule!
 		1736=Charger
 		1737=Enregistrer
-		1738=Enregistrer sous	
+		1738=Enregistrer sous
 		1739=Angle doit ?tre dans la domaine [0;2*PI]
 		1739=[Projection degrees must be in interval [0;2*PI]]
 		1740=[Crossbearing degrees  must be in interval [0;360]]
@@ -483,27 +483,27 @@
 		1808=Chevauchement en pixel:
 		1809=T%e9l%e9charge carte synoptique
 		1810=Dans un cadre de:
-		1811=avec le centre: 
+		1811=avec le centre:
 		1812=Pages
 		1813=T%e9l%e9charge carte pour
-		1814=Par cache		
+		1814=Par cache
 		1815=T%e9l%e9charge cartes g%e9o-r%e9f%e9renc%e9es
 		1816=T%e9l%e9charge cartes g%e9o-r%e9f%e9renc%e9es%0a %0a %0a %0a %0a
 		1817=Pas de caches coch%e9es
-		1818=getSortedMapServiceIndex: Index 
+		1818=getSortedMapServiceIndex: Index
 		1819=pas trouv%e9
 		1820=T%e9l%e9charge carte '
 		1821=%0a pour cache:%0a
-		1822=Cache: 
-		1823=Ignore erreur: 
+		1822=Cache:
+		1823=Ignore erreur:
 		1824=T%e9l%e9charge carte synoptique
-		1825=Carte synoptique: Ignore erreurs: 
+		1825=Carte synoptique: Ignore erreurs:
 		1826=Charger et calibrer des cartes fini
 		1827='Radius' doit ?tre plus grand que zero
 		1828='Chevauchement' ne doit pas ?tre moins que zero
 		1829=Entrez un 'centre' autour duquel les cartes seront charg%e9es.
 		1830=Le service de cartes choisi offre cartes en %e9chelle de
-		1831= %e0 
+		1831= %e0
 		1832=%0a Adaptez 'Ca. m par pixel' respectivement, svp.
 		2000=GPX Export
 		2001=de
@@ -599,7 +599,7 @@
 		2584=Appropri%e9 pour chaises roulantes
 		2585=Pas disponible en hiver
 		2586=Disponible en hiver
-		2587=Entretien de la cache pas n%e9cessaire 
+		2587=Entretien de la cache pas n%e9cessaire
 		2588=Entretien de la cache n%e9cessaire
 		2589=Lampe n%e9cessaire
 		3000=Fermer
@@ -720,13 +720,13 @@
 		4800=Charge services de cartes en lingne
 		4801=Ignore erreur en %0a lisant le fichier de d%e9finition Web Map Service %0a
 		4802=Chargeant image de carte calibr%e9e et g%e9o-r%e9f%e9renc%e9e %0a '
-		4803=' %0a Chargeant page %0a Ligne 
-		4804= Colonne 
+		4803=' %0a Chargeant page %0a Ligne
+		4804= Colonne
 		4805=Page
-		4806=: Ignore erreur: 
+		4806=: Ignore erreur:
 		4807=loadTo: Chargement de la carte %e9chou%e9: Pas re?u http-redirect
-		4808=downloadImage: content-type: 
-		4809= n'est pas une image, debut du contenu: 
+		4808=downloadImage: content-type:
+		4809= n'est pas une image, debut du contenu:
 		4810=Erreur en chargeant ou enr%e9gstrant carte:%0a
 		4811=OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):%0a This method must be overloaded in order to be able to use it
 		4812=WebMapService: Propri%e9t%e9 >Name:< manque en fichier:%0a
@@ -739,16 +739,16 @@
 		4819=). Utilise caract%e8res %e0 ignorer pour s%e9paration
 		4820=WebMapService: Propri%e9t%e9 >CoordinateReferenceSystemUrlPart:< fautive en fichier:%0a
 		4821=WebMapService: Propri%e9t%e9 >ImageFileExtension:< manque en fichier:%0a
-		4822=%c9tendu: 
-		4823= n'est pas couvert par service: 
-		4824=, %c9tendu de service: 
-		4825=Echelle 
-		4826= n'est pas soutenu par cette service de cartes. Echelle soutenu: 
+		4822=%c9tendu:
+		4823= n'est pas couvert par service:
+		4824=, %c9tendu de service:
+		4825=Echelle
+		4826= n'est pas soutenu par cette service de cartes. Echelle soutenu:
 		4827= (mesur%e9 verticalement en m%e8tres par pixel)
-		4828=Syst%e8me de coordonn%e9es n'est pas soutenue par CacheWolf: 
-		4829=getUrlForBoundingBox: Point: 
+		4828=Syst%e8me de coordonn%e9es n'est pas soutenue par CacheWolf:
+		4829=getUrlForBoundingBox: Point:
 		4830=Pas de bande Gau%df-Kr%fcger dans la liste de codes EPSG dans le fichier .wms
-		4831=getMapInfoObject: Syst%e8me de coordonn%e9es n'est pas soutenue par CacheWolf: 
+		4831=getMapInfoObject: Syst%e8me de coordonn%e9es n'est pas soutenue par CacheWolf:
 		4900=+n'est pas une coordonn%e9e allemande Gau%df-Kr%fcger
 		4920=Code EPSG+
 		4921=+pas soutenu
@@ -757,7 +757,7 @@
 		4924=ToWgs84: code EPSG+
 		5000=Chargeant liste de caches
 		5001=Ne peut pas spider waypoints suppletif.%0aCochez le parent, svp..
-		5002=: Cette fonction n'est disponible que pour Geocaching.com et Opencaching.de/.cz/.org.uk momentan%e9ment.
+		5002=: Cette fonction n'est disponible que pour geocaching.com et opencaching.{cz,de,org.uk,pl} momentan%e9ment.
 		5003=Options
 		5004=Cr%e9ant r%e9f%e9rences pour les waypoints additionelles...
 		5497=Erreur: Une balise manque en spider.def
@@ -777,7 +777,7 @@
 		5511=Trouv%e9e+
 		5512=+Caches
 		5513=Chargeant:+
-		5514=%0aTravel Bug:+ 
+		5514=%0aTravel Bug:+
 		5515=Erreur en chargeant la cache.%0aMerci de v%e9rifier votre connexion internet..%0aContinuer d'essayer?
 		6000=Guid
 		6001=Nom

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-09-03 17:19:08 UTC (rev 2138)
+++ trunk/res_noewe/languages/NL.cfg	2009-09-03 18:51:45 UTC (rev 2139)
@@ -351,7 +351,7 @@
 		1300=Laatste instellingen
 		1301=Selecteer profiel
 		1400=Zone
-		1401=Northing	
+		1401=Northing
 		1402=Easting
 		1403=Richting
 		1404=Afstand
@@ -371,7 +371,7 @@
 		1512=Wegpunt
 		1513=Kan moving map niet draaien zonder geldige co%f6rdinaten. Geef Centrums- of Doelco%f6rdinaten of start het GPS AUB.
 		1514=Kan afstanden niet opnieuw berekenen doordat er geen GPS positie gegeven is (geen receptie is/was)
-		1600=Download van Opencaching.de 
+		1600=Download van Opencaching.de
 		1601=Afstand:
 		1602=Download afbeeldingen
 		1603=Download kaarten
@@ -390,7 +390,7 @@
 		1616=Fout: Kan de update file niet downloaden van Opencaching.de.
 		1617=Negeert fout in html-cache-beschrijving:"<img" without "src=" in cache+
 		1618=Negeert fout in cache:+
-		1619=: kon de afbeelding van URL niet downloaden:+	
+		1619=: kon de afbeelding van URL niet downloaden:+
 		1620=download bijgesloten afbeeldingen:+
 		1621=Fout tijdens interpreteren data%0a van Opencaching.de,%0aDit is vermoedelijk een fout bij Opencaching.de%0aprobeer later nogmaals%0aStatus:
 		1700=Fout in lijn:
@@ -476,7 +476,7 @@
 		2534=Terreinwagens toegestaan
 		2535=Kind onvriendelijk
 		2536=Kind vriendelijk
-		2537=*mijnen 
+		2537=*mijnen
 		2538=*geen mijnen
 		2539=Geen motorfietsen
 		2540=Motorfietsen toegestaan
@@ -509,7 +509,7 @@
 		2567=*geen sneeuwvoertuigen
 		2568=*sneeuwvoertuigen toegestaan
 		2569=Stiekemheid niet nodig
-		2570=Stiekemheid geboden 
+		2570=Stiekemheid geboden
 		2571=Kinderwagen onvriendelijk
 		2572=Kinderwagen vriendelijk
 		2573=*geen zwemmen
@@ -551,7 +551,7 @@
 		4600=Sommige caches kunnen niet worden getoond door verkeerde blacklist status.
 		5000=Laad cache lijst
 		5001=Kan niet extra waypoint laaden.%0aGelieve te laaden hoofd Waypoint.
-		5002=Op het ogenblik is deze functie slechts toepasselijk voor geocaching.com en opencaching.de/.cz/.org.uk .
+		5002=Op het ogenblik is deze functie slechts toepasselijk voor geocaching.com en opencaching.{cz,de,org.uk,pl}.
 		5004=Bouw de verwijzingen voor extra waypoints
 		5497=Fout, verdwenen tag in spider.def.
 		5498=Login fout. Fout bij het laden van de pagina na login.



From salzkammergut at mail.berlios.de  Thu Sep  3 21:52:13 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 3 Sep 2009 21:52:13 +0200
Subject: [Cachewolf-svn] r2140 - trunk/src/CacheWolf
Message-ID: <200909031952.n83JqDIp004192@sheep.berlios.de>

Author: salzkammergut
Date: 2009-09-03 21:52:10 +0200 (Thu, 03 Sep 2009)
New Revision: 2140

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Solver: Added MODulo function
Example MOD(a,b)

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-09-03 18:51:45 UTC (rev 2139)
+++ trunk/src/CacheWolf/Parser.java	2009-09-03 19:52:10 UTC (rev 2140)
@@ -125,6 +125,7 @@
     	new fnType("lcase","lc",2),
     	new fnType("length","len",2),
     	new fnType("mid","mid",12),
+    	new fnType("mod","mod",4),
      	new fnType("pc","pz",3),
      	new fnType("profilecenter","pz",3),
      	new fnType("profilecentre","pz",3),
@@ -603,6 +604,15 @@
     	}
     }
 
+    /** MOD function as in Basic */
+    private Double funcMod() throws Exception {
+    	double b=popCalcStackAsNumber(0);
+    	double a=popCalcStackAsNumber(0);
+		if (b==0.0)
+			err(MyLocale.getMsg(1729,"Division by 0"));
+		return new java.lang.Double(a % b);
+    }
+
 	/** Get or set the profile centre */
 	private void funcPz(int nargs) throws Exception {
 		if (nargs==0) {
@@ -652,7 +662,7 @@
     		double bearing1 = point1.getBearing(point2);
     		double bearing2 = point1.getBearing(point1);
     		if (bearing1 == degrees1 || bearing2 == degrees2){
-    			err(MyLocale.getMsg(1740,"Invalid crossbearing angles"));    			
+    			err(MyLocale.getMsg(1740,"Invalid crossbearing angles"));
     		}
     	}
 
@@ -1156,6 +1166,7 @@
 	    else if (funcDef.alias.equals("lc")) calcStack.add(popCalcStackAsString().toLowerCase());
 	    else if (funcDef.alias.equals("len")) calcStack.add(new Double(popCalcStackAsString().length()));
 	    else if (funcDef.alias.equals("mid")) calcStack.add(funcMid(nargs));
+	    else if (funcDef.alias.equals("mod")) calcStack.add(funcMod());
 	    else if (funcDef.alias.equals("project")) calcStack.add(funcProject());
 	    else if (funcDef.alias.equals("pz")) funcPz(nargs);
 	    else if (funcDef.alias.equals("rad")) funcDeg(false);



From salzkammergut at mail.berlios.de  Thu Sep  3 22:08:10 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 3 Sep 2009 22:08:10 +0200
Subject: [Cachewolf-svn] r2141 - trunk/src/CacheWolf
Message-ID: <200909032008.n83K8AaA005547@sheep.berlios.de>

Author: salzkammergut
Date: 2009-09-03 22:08:09 +0200 (Thu, 03 Sep 2009)
New Revision: 2141

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Solver: Added INT function, e.g. INT(-3.14159) = -3
Known limitation: Argument (not checked) should be < MAX_LONG 

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-09-03 19:52:10 UTC (rev 2140)
+++ trunk/src/CacheWolf/Parser.java	2009-09-03 20:08:09 UTC (rev 2141)
@@ -122,6 +122,7 @@
     	new fnType("ic","ic",3),
     	new fnType("ignorecase","ic",3),
     	new fnType("instr","instr",12),
+    	new fnType("int","int",2),
     	new fnType("lcase","lc",2),
     	new fnType("length","len",2),
     	new fnType("mid","mid",12),
@@ -1163,6 +1164,7 @@
 	    else if (funcDef.alias.equals("goto")) funcGoto(nargs);
 	    else if (funcDef.alias.equals("ic")) funcIgnoreVariableCase(nargs);
 	    else if (funcDef.alias.equals("instr")) calcStack.add(new Double(funcInstr(nargs)));
+	    else if (funcDef.alias.equals("int")) calcStack.add(new Double(new Double(popCalcStackAsNumber(0)).longValue()));
 	    else if (funcDef.alias.equals("lc")) calcStack.add(popCalcStackAsString().toLowerCase());
 	    else if (funcDef.alias.equals("len")) calcStack.add(new Double(popCalcStackAsString().length()));
 	    else if (funcDef.alias.equals("mid")) calcStack.add(funcMid(nargs));



From jennergruhle at mail.berlios.de  Fri Sep  4 12:49:04 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 12:49:04 +0200
Subject: [Cachewolf-svn] r2143 - trunk/src/CacheWolf
Message-ID: <200909041049.n84An40e014273@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 12:48:54 +0200 (Fri, 04 Sep 2009)
New Revision: 2143

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
method isOC() for checking if the waypoint name starts with one of the OC patterns

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-04 10:33:21 UTC (rev 2142)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-04 10:48:54 UTC (rev 2143)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.navi.Metrics;
 
 import com.stevesoft.ewe_pat.Regex;
@@ -24,7 +25,7 @@
 
 	/** Cachestatus is Found, Not found or a date in format yyyy-mm-dd hh:mm for found date */
 	private String cacheStatus = EMPTY;
-	/** The name of the waypoint typicall GC.... or OC.... or CW...... (can be any characters) */
+	/** The name of the waypoint, typically GC.... or OC.... or CW...... (can be any characters) */
 	private String wayPoint = EMPTY;
 	/** The name of the cache (short description) */
 	private String cacheName = EMPTY;
@@ -512,7 +513,8 @@
 	 * Call it only when necessary, it takes time, because all logs must be parsed
 	 */
 	public void calcRecommendationScore() {
-		if (getWayPoint().toLowerCase().startsWith("oc")) {
+		String pattern = getWayPoint().toUpperCase();
+		if (isOC()) {
 			// Calculate recommendation score only when details
 			// are already loaded. When they aren't loaded, then we assume
 			// that there is no change, so nothing to do.
@@ -587,6 +589,13 @@
 		return addiWpts.getCount()>0;
 	}
 
+	public boolean isOC() {
+		String pattern = getWayPoint().toUpperCase();
+		return pattern.startsWith( OCXMLImporter.OPENCACHING_CZ_PATTERN )
+				|| pattern.startsWith( OCXMLImporter.OPENCACHING_DE_PATTERN )
+				//|| pattern.startsWith( OCXMLImporter.OPENCACHING_PL_PATTERN )
+				|| pattern.startsWith( OCXMLImporter.OPENCACHING_UK_PATTERN );
+	}
 
 	public void calcDistance(CWPoint toPoint) {	
 		if(pos.isValid()){
@@ -818,8 +827,9 @@
 		
 	public String GetCacheID() {
 		String result = "";
-		
-		if ( getWayPoint().toUpperCase().startsWith( "GC" ) ) {
+		String pattern = getWayPoint().toUpperCase();
+
+		if ( pattern.startsWith( "GC" ) ) {
 			int gcId = 0;
 
 			String sequence = "0123456789ABCDEFGHJKMNPQRTVWXYZ";
@@ -841,7 +851,7 @@
 	        }
 	        
 	        result = Integer.toString(gcId);	        
-		} else if ( getWayPoint().toUpperCase().startsWith( "OC" ) ) {
+		} else if (isOC()) {
         	result = getOcCacheID();
         }
 



From jennergruhle at mail.berlios.de  Fri Sep  4 12:50:27 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 12:50:27 +0200
Subject: [Cachewolf-svn] r2144 - trunk/src/CacheWolf
Message-ID: <200909041050.n84AoRTE015709@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 12:50:11 +0200 (Fri, 04 Sep 2009)
New Revision: 2144

Modified:
   trunk/src/CacheWolf/DBStats.java
Log:
using method isOC() instead of checking for "OC"

Modified: trunk/src/CacheWolf/DBStats.java
===================================================================
--- trunk/src/CacheWolf/DBStats.java	2009-09-04 10:48:54 UTC (rev 2143)
+++ trunk/src/CacheWolf/DBStats.java	2009-09-04 10:50:11 UTC (rev 2144)
@@ -24,7 +24,7 @@
 		for(int i = 0; i<cacheDB.size();i++){
 			holder = cacheDB.get(i);
 			if(holder.isVisible()){
-				if(holder.getWayPoint().startsWith("GC") || holder.getWayPoint().startsWith("OC")) counter++;
+				if(holder.getWayPoint().startsWith("GC") || holder.isOC()) counter++;
 			}
 		}
 		return counter;
@@ -40,7 +40,7 @@
 		for(int i = 0; i<cacheDB.size();i++){
 			holder = cacheDB.get(i);
 			if(holder.is_black() == false){
-				if(holder.getWayPoint().startsWith("GC") || holder.getWayPoint().startsWith("OC")) counter++;
+				if(holder.getWayPoint().startsWith("GC") || holder.isOC()) counter++;
 			}
 		}
 		return counter;
@@ -52,7 +52,7 @@
 		for(int i = 0; i<cacheDB.size();i++){
 			holder = cacheDB.get(i);
 			if(holder.is_found() == true) {
-				if(holder.getWayPoint().startsWith("GC") || holder.getWayPoint().startsWith("OC")) counter++;
+				if(holder.getWayPoint().startsWith("GC") || holder.isOC()) counter++;
 			}
 		}
 		return counter;



From jennergruhle at mail.berlios.de  Fri Sep  4 12:53:14 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 12:53:14 +0200
Subject: [Cachewolf-svn] r2145 - trunk/src/CacheWolf
Message-ID: <200909041053.n84ArEZQ018413@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 12:53:10 +0200 (Fri, 04 Sep 2009)
New Revision: 2145

Modified:
   trunk/src/CacheWolf/MyComparer.java
   trunk/src/CacheWolf/myTableModel.java
Log:
using method isOC() instead of checking for "OC"

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2009-09-04 10:50:11 UTC (rev 2144)
+++ trunk/src/CacheWolf/MyComparer.java	2009-09-04 10:53:10 UTC (rev 2145)
@@ -87,7 +87,7 @@
 		} else if (colToCompare==14) {
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=cacheDB.get(i);
-				if (ch.getWayPoint().startsWith("OC"))
+				if (ch.isOC())
 					ch.sort=MyLocale.formatLong(ch.recommendationScore,"00000");
 				else
 					ch.sort="\uFFFF";

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-09-04 10:50:11 UTC (rev 2144)
+++ trunk/src/CacheWolf/myTableModel.java	2009-09-04 10:53:10 UTC (rev 2145)
@@ -369,7 +369,7 @@
 						if (ch.isAddiWpt() || CacheType.CW_TYPE_CUSTOM == ch.getType()) return null;
 						return Convert.formatInt(ch.getNumRecommended());
 					case 14: // OC rating
-						if (ch.getWayPoint().startsWith("OC"))
+						if (ch.isOC())
 							return Convert.formatInt(ch.recommendationScore);
 						return null;
 					case 15: // Is solver filled?



From jennergruhle at mail.berlios.de  Fri Sep  4 12:53:48 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 12:53:48 +0200
Subject: [Cachewolf-svn] r2146 - trunk/src/CacheWolf
Message-ID: <200909041053.n84ArmpB019107@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 12:53:39 +0200 (Fri, 04 Sep 2009)
New Revision: 2146

Modified:
   trunk/src/CacheWolf/Profile.java
Log:
added the other OC patterns for waypoint names

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-04 10:53:10 UTC (rev 2145)
+++ trunk/src/CacheWolf/Profile.java	2009-09-04 10:53:39 UTC (rev 2146)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.navi.Area;
 import CacheWolf.navi.TransformCoordinates;
 import ewe.io.BufferedWriter;
@@ -447,8 +448,14 @@
 		String mainwpt = ch.getWayPoint().substring(2);
 		int mainindex = getCacheIndex("GC" + mainwpt);
 		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
-			mainindex = getCacheIndex("OC" + mainwpt);
+			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_CZ_PATTERN + mainwpt);
 		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
+			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_DE_PATTERN + mainwpt);
+//		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
+//			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_PL_PATTERN + mainwpt);
+		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
+			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_UK_PATTERN + mainwpt);
+		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
 			mainindex = getCacheIndex("CW" + mainwpt);
 		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt()) {
 			ch.setIncomplete(true);



From jennergruhle at mail.berlios.de  Fri Sep  4 13:00:35 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 13:00:35 +0200
Subject: [Cachewolf-svn] r2147 - trunk/src/CacheWolf
Message-ID: <200909041100.n84B0ZxL025425@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 13:00:22 +0200 (Fri, 04 Sep 2009)
New Revision: 2147

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
added method isOCWaypoint(String wpName) for waypoint name checking

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-04 10:53:39 UTC (rev 2146)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-04 11:00:22 UTC (rev 2147)
@@ -590,7 +590,11 @@
 	}
 
 	public boolean isOC() {
-		String pattern = getWayPoint().toUpperCase();
+		return isOCWaypoint(getWayPoint());
+	}
+
+	public static boolean isOCWaypoint(String wpName) {
+		String pattern = wpName.toUpperCase();
 		return pattern.startsWith( OCXMLImporter.OPENCACHING_CZ_PATTERN )
 				|| pattern.startsWith( OCXMLImporter.OPENCACHING_DE_PATTERN )
 				//|| pattern.startsWith( OCXMLImporter.OPENCACHING_PL_PATTERN )



From jennergruhle at mail.berlios.de  Fri Sep  4 13:01:53 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 13:01:53 +0200
Subject: [Cachewolf-svn] r2148 - trunk/src/CacheWolf
Message-ID: <200909041101.n84B1rDu026823@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 13:01:37 +0200 (Fri, 04 Sep 2009)
New Revision: 2148

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
using CacheHolder.isOCWaypoint(wpt) for checking if OC cache

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-09-04 11:00:22 UTC (rev 2147)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-09-04 11:01:37 UTC (rev 2148)
@@ -421,11 +421,7 @@
 		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) 
 				&& Global.mainTab.mainCache != null 
 				&& (Global.mainTab.mainCache.startsWith("GC") 
-						|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_CZ_PATTERN) 
-						|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_DE_PATTERN) 
-						|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_UK_PATTERN) 
-						//|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_PL_PATTERN) 
-						|| Global.mainTab.mainCache.startsWith("CW")) 
+					|| CacheHolder.isOCWaypoint(Global.mainTab.mainCache) || Global.mainTab.mainCache.startsWith("CW")) 
 				&& wpt.startsWith("CW")) {
 			// for what was this?:
 			Global.mainTab.lastselected = Global.mainTab.mainCache; // I don't know exactly, but it's needed for creating a series of Addis
@@ -435,11 +431,7 @@
 		}
 		if (!CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
 				&& !(wpt.startsWith("GC")
-						|| wpt.startsWith(OCXMLImporter.OPENCACHING_CZ_PATTERN)
-						|| wpt.startsWith(OCXMLImporter.OPENCACHING_DE_PATTERN)
-						|| wpt.startsWith(OCXMLImporter.OPENCACHING_UK_PATTERN)
-						//|| wpt.startsWith(OCXMLImporter.OPENCACHING_PL_PATTERN)
-						|| wpt.startsWith("CW"))) {
+					|| CacheHolder.isOCWaypoint(wpt) || wpt.startsWith("CW"))) {
 			inpWaypoint.setText(Global.getProfile().getNewWayPointName());
 		}
 	}



From jennergruhle at mail.berlios.de  Fri Sep  4 13:02:36 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 13:02:36 +0200
Subject: [Cachewolf-svn] r2149 - trunk/src/CacheWolf
Message-ID: <200909041102.n84B2ad4027573@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 13:02:29 +0200 (Fri, 04 Sep 2009)
New Revision: 2149

Modified:
   trunk/src/CacheWolf/MainMenu.java
Log:
using CacheHolder.isOCWaypoint(wpt) for checking if OC cache

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-09-04 11:01:37 UTC (rev 2148)
+++ trunk/src/CacheWolf/MainMenu.java	2009-09-04 11:02:29 UTC (rev 2149)
@@ -88,8 +88,8 @@
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] mnuImport = new MenuItem[7];
 		mnuImport[0] = loadcaches  = new MenuItem(MyLocale.getMsg(129,"Import GPX")); //TODO internationalization
-		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download von opencaching.de")); 
-		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider von geocaching.com")); 
+		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download from opencaching")); 
+		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider from geocaching.com")); 
 		mnuImport[3] = spiderAllFinds = new MenuItem(MyLocale.getMsg(217,"Spider all finds from geocaching.com")); 
 		mnuImport[4] = update         = new MenuItem(MyLocale.getMsg(1014,"Update cache data"));
 		mnuImport[5] = mnuSeparator   = new MenuItem("-"); 
@@ -781,11 +781,7 @@
 			ch = cacheDB.get(i);
 			if(ch.is_Checked == true && ch.isVisible()) {
 				String wpStart = ch.getWayPoint().substring(0,2);
-				if ( ch.getWayPoint().length()>1 && (wpStart.equalsIgnoreCase("GC") 
-					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_DE_PATTERN)
-					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_PL_PATTERN)
-					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_CZ_PATTERN)
-					|| ch.getWayPoint().substring(0,2).equalsIgnoreCase(OCXMLImporter.OPENCACHING_UK_PATTERN)))
+				if ( ch.getWayPoint().length()>1 && (wpStart.equalsIgnoreCase("GC") || ch.isOC()))
 //					Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
 //					Alter code prft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
 				{
@@ -800,7 +796,7 @@
 						alreadySaid = true;
 						(new MessageBox(MyLocale.getMsg(327,"Information"),
 					        ch.getWayPoint()+ MyLocale.getMsg(5002,
-					        	": At the moment this function is only applicable for geocaching.com and opencaching.de/.pl/.cz/.org.uk ."),
+					        	": At the moment this function is only applicable for geocaching.com and opencaching.de/.cz/.org.uk ."),
 					        FormBase.OKB)).execute();
 					}
 				}



From jennergruhle at mail.berlios.de  Fri Sep  4 12:33:28 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Fri, 4 Sep 2009 12:33:28 +0200
Subject: [Cachewolf-svn] r2142 - trunk/src/CacheWolf
Message-ID: <200909041033.n84AXSwL003292@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-04 12:33:21 +0200 (Fri, 04 Sep 2009)
New Revision: 2142

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
added the other OC patterns for waypoint names

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-09-03 20:08:09 UTC (rev 2141)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-09-04 10:33:21 UTC (rev 2142)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.navi.TransformCoordinates;
 import ewe.fx.Color;
 import ewe.fx.Dimension;
@@ -420,7 +421,10 @@
 		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) 
 				&& Global.mainTab.mainCache != null 
 				&& (Global.mainTab.mainCache.startsWith("GC") 
-						|| Global.mainTab.mainCache.startsWith("OC") 
+						|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_CZ_PATTERN) 
+						|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_DE_PATTERN) 
+						|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_UK_PATTERN) 
+						//|| Global.mainTab.mainCache.startsWith(OCXMLImporter.OPENCACHING_PL_PATTERN) 
 						|| Global.mainTab.mainCache.startsWith("CW")) 
 				&& wpt.startsWith("CW")) {
 			// for what was this?:
@@ -430,8 +434,12 @@
 					Global.mainTab.mainCache));
 		}
 		if (!CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-				&& !(wpt.startsWith("GC") || wpt.startsWith("OC") || wpt
-						.startsWith("CW"))) {
+				&& !(wpt.startsWith("GC")
+						|| wpt.startsWith(OCXMLImporter.OPENCACHING_CZ_PATTERN)
+						|| wpt.startsWith(OCXMLImporter.OPENCACHING_DE_PATTERN)
+						|| wpt.startsWith(OCXMLImporter.OPENCACHING_UK_PATTERN)
+						//|| wpt.startsWith(OCXMLImporter.OPENCACHING_PL_PATTERN)
+						|| wpt.startsWith("CW"))) {
 			inpWaypoint.setText(Global.getProfile().getNewWayPointName());
 		}
 	}



From araber95 at mail.berlios.de  Sat Sep  5 16:25:48 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 5 Sep 2009 16:25:48 +0200
Subject: [Cachewolf-svn] r2150 - trunk/res_noewe/webmapservices
Message-ID: <200909051425.n85EPmkj008285@sheep.berlios.de>

Author: araber95
Date: 2009-09-05 16:25:46 +0200 (Sat, 05 Sep 2009)
New Revision: 2150

Added:
   trunk/res_noewe/webmapservices/cz-jm_p.wms
Log:
new wms for CZ-JM (Tschechien-Region S?dm?hren)

Added: trunk/res_noewe/webmapservices/cz-jm_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-jm_p.wms	2009-09-04 11:02:29 UTC (rev 2149)
+++ trunk/res_noewe/webmapservices/cz-jm_p.wms	2009-09-05 14:25:46 UTC (rev 2150)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://ias.kr-jihomoravsky.cz:8080/wmsconnector/com.esri.wms.Esrimap/kolo?
+GetCapabilitiesUrl: http://ias.kr-jihomoravsky.cz:8080/wmsconnector/com.esri.wms.Esrimap/kolo?SERVICE=WMS&VERSION=1.1.0&REQUEST=GetCapabilities
+Name:               cz.jihomoravsky p SF=1
+#Name:               cz.Suedmaehren p SF=1
+MapType:                        photo
+MainUrl:            http://ias.kr-jihomoravsky.cz:8080/wmsconnector/com.esri.wms.Esrimap/kolo?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+#<SRS>EPSG:4326 EPSG:102067 EPSG:4267 EPSG:4269</SRS>
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=u15|Relief||
+#LayersUrlPart:     LAYERS=orto|OrtoFoto2003||
+#LayersUrlPart:     LAYERS=lesy|SDE.LESY_JMK|NaN|NaN
+#LayersUrlPart:     LAYERS=u1|JARDA.RC_CZ0620_A213|NaN|NaN
+#LayersUrlPart:     LAYERS=u2|JARDA.RC_CZ0620_A234|NaN|9999999
+#LayersUrlPart:     LAYERS=u3|JARDA.SILNICE|NaN|9999999
+#LayersUrlPart:     LAYERS=u4|Obce|NaN|9999999
+#LayersUrlPart:     LAYERS=21|Lesni puda se stromy|NaN|NaN
+#LayersUrlPart:     LAYERS=22|Lesni puda s kosodrevinou|NaN|NaN
+#LayersUrlPart:     LAYERS=23|Lesni puda s krovinatym porostem|NaN|NaN
+#LayersUrlPart:     LAYERS=24|Louka pastvina|NaN|NaN
+#LayersUrlPart:     LAYERS=25|Okrasna zahrada, park|NaN|NaN
+#LayersUrlPart:     LAYERS=27|Vinice|NaN|NaN
+#LayersUrlPart:     LAYERS=28|Ovocny sad zahrada|NaN|NaN
+#LayersUrlPart:     LAYERS=29|Orna puda a ostatni neurcena plocha|NaN|NaN
+#LayersUrlPart:     LAYERS=30|Intravilan|NaN|NaN
+#LayersUrlPart:     LAYERS=33|Ucelova zastavba|NaN|NaN
+#LayersUrlPart:     LAYERS=35|Skladka|0|NaN
+#LayersUrlPart:     LAYERS=37|Vodni tok|NaN|NaN
+#LayersUrlPart:     LAYERS=41|Vodni plocha|NaN|NaN
+#LayersUrlPart:     LAYERS=43|Valcova nadrz, zasobnik|NaN|NaN
+#LayersUrlPart:     LAYERS=46|Budova blok budov1|NaN|NaN
+#LayersUrlPart:     LAYERS=47|Chladici vez|NaN|NaN
+#LayersUrlPart:     LAYERS=59|Usazovaci nadrz odkaliste|NaN|NaN
+#LayersUrlPart:     LAYERS=53|Stupen|0|NaN
+#LayersUrlPart:     LAYERS=55|Rokle vymol|0|NaN
+#LayersUrlPart:     LAYERS=56|Vrstevnice doplnkova|NaN|NaN
+#LayersUrlPart:     LAYERS=57|Vrstevnice zesilena|NaN|NaN
+#LayersUrlPart:     LAYERS=62|Prehradni hraz jez|0|NaN
+#LayersUrlPart:     LAYERS=65|Brod|0|NaN
+#LayersUrlPart:     LAYERS=66|Akvadukt shybka|0|NaN
+#LayersUrlPart:     LAYERS=68|Obvod letistni drahy|NaN|NaN
+#LayersUrlPart:     LAYERS=71|Lesni prusek|0|NaN
+#LayersUrlPart:     LAYERS=73|Elektricke vedeni|NaN|NaN
+#LayersUrlPart:     LAYERS=74|Tunel|NaN|NaN
+#LayersUrlPart:     LAYERS=75|Produktovod potrubi|NaN|NaN
+#LayersUrlPart:     LAYERS=77|Lanova draha lyzarsky vlek|0|NaN
+#LayersUrlPart:     LAYERS=78|Cesta|0|NaN
+#LayersUrlPart:     LAYERS=79|Pesina|0|NaN
+#LayersUrlPart:     LAYERS=81|Silnice dalnice|NaN|NaN
+#LayersUrlPart:     LAYERS=82|Vlecka|0|NaN
+#LayersUrlPart:     LAYERS=84|Poulicni draha|0|NaN
+#LayersUrlPart:     LAYERS=85|Zeleznicni trat|0|NaN
+#LayersUrlPart:     LAYERS=89|Hranice dobyvaciho prostoru|NaN|NaN
+#LayersUrlPart:     LAYERS=90|Chranene uzemi|0|NaN
+#LayersUrlPart:     LAYERS=91|Hrbitov|0|NaN
+#LayersUrlPart:     LAYERS=92|Propustek|0|NaN
+#LayersUrlPart:     LAYERS=93|Lavka|0|NaN
+#LayersUrlPart:     LAYERS=94|Podjezd|0|NaN
+#LayersUrlPart:     LAYERS=95|Most|0|NaN
+#LayersUrlPart:     LAYERS=97|Bod tihoveho pole|0|NaN
+#LayersUrlPart:     LAYERS=98|Bod polohoveho pole|0|NaN
+#LayersUrlPart:     LAYERS=99|Bod vyskoveho pole|0|NaN
+#LayersUrlPart:     LAYERS=100|Hranicni prechod|0|NaN
+#LayersUrlPart:     LAYERS=101|Osamely strom, lesik|0|NaN
+#LayersUrlPart:     LAYERS=103|Osamely balvan skala|0|NaN
+#LayersUrlPart:     LAYERS=104|Vstup do jeskyne|0|NaN
+#LayersUrlPart:     LAYERS=105|Kotovany bod|0|NaN
+#LayersUrlPart:     LAYERS=107|Zdroj podzemnich vod|0|NaN
+#LayersUrlPart:     LAYERS=108|Pristaviste|0|NaN
+#LayersUrlPart:     LAYERS=110|Zeleznicni zastavka|0|NaN
+#LayersUrlPart:     LAYERS=120|Uzlovy bod silnicni site UBS|0|NaN
+#LayersUrlPart:     LAYERS=121|Vodojem vezovy|0|NaN
+#LayersUrlPart:     LAYERS=122|Valcova nadrz zasobnik|NaN|NaN
+#LayersUrlPart:     LAYERS=123|Silo|NaN|NaN
+#LayersUrlPart:     LAYERS=125|Kriz sloup kulturniho vyznamu|0|NaN
+#LayersUrlPart:     LAYERS=126|Nastavba na budove, rozhledna|0|NaN
+#LayersUrlPart:     LAYERS=127|Budova blok budov|NaN|NaN
+#LayersUrlPart:     LAYERS=128|Vetrny motor|0|NaN
+#LayersUrlPart:     LAYERS=130|Tovarni komin|0|NaN
+#LayersUrlPart:     LAYERS=131|Tezni vez|0|NaN
+#LayersUrlPart:     LAYERS=132|Usti sachty stoly|0|NaN
+#LayersUrlPart:     LAYERS=obceZ|SDE.OBCE_B_2|NaN|NaN
+#LayersUrlPart:     LAYERS=cyklo|Cyklotrasy||
+#LayersUrlPart:     LAYERS=PRECHOD|HranPrechod||
+#LayersUrlPart:     LAYERS=OBCE2|JARDA.RA_CZ620_C113||
+LayersUrlPart:     LAYERS=orto
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+#manuell
+BoundingBoxTopLeftWGS84: N 49.634341 E 15.50975
+BoundingBoxButtomRightWGS84: N 48.614016 E 17.666016
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .jpg



From araber95 at mail.berlios.de  Mon Sep  7 01:05:24 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 7 Sep 2009 01:05:24 +0200
Subject: [Cachewolf-svn] r2151 - trunk/res_noewe/webmapservices
Message-ID: <200909062305.n86N5OSG000790@sheep.berlios.de>

Author: araber95
Date: 2009-09-07 01:05:09 +0200 (Mon, 07 Sep 2009)
New Revision: 2151

Added:
   trunk/res_noewe/webmapservices/cz-jc_t25.wms
Log:
wms for CZ-JC Tschechien-S??dB??hmen (first extraction of the centrope-server)

Added: trunk/res_noewe/webmapservices/cz-jc_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-jc_t25.wms	2009-09-05 14:25:46 UTC (rev 2150)
+++ trunk/res_noewe/webmapservices/cz-jc_t25.wms	2009-09-06 23:05:09 UTC (rev 2151)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://www.centropemap.org
+GetCapabilitiesUrl: http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+#Name:               Oesterreich, Tschechien, Slowakei, Ungarn t100 SF=7..12
+#Name:               Centrope Oesterreich, Tschechien, Slowakei, Ungarn t25 SF=1..7
+Name:               CZ.Jihocesky t25 SF=1..7
+#Name:               CZ.S?db?hmen t25 SF=1..7
+MapType:                        topo
+MainUrl:            http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287 31466 31467
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287 SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Topographic Base Map|Topographic Base Map|997.805696859274|24945.1424214819
+#LayersUrlPart:     LAYERS=GeoAtlas_2008|GeoAtlas_2008||
+#LayersUrlPart:     LAYERS=m4m|m4m|1496.70854528891|498902.847930734
+#LayersUrlPart:     LAYERS=m2m|m2m|548.793133272601|1496.70804638606
+#LayersUrlPart:     LAYERS=m1m|m1m|299.341709057782|548.792634369752
+#LayersUrlPart:     LAYERS=m500k|m500k|114.748154041665|299.341210154934
+#LayersUrlPart:     LAYERS=m250k|m250k|37.4182125350712|114.747655138817
+#LayersUrlPart:     LAYERS=m100k_01|m100k_01|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_02|m100k_02|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_03|m100k_03|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_04|m100k_04|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_05|m100k_05|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m50k_01|m50k_01|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_02|m50k_02|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_03|m50k_03|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_04|m50k_04|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_05|m50k_05|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_06|m50k_06|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_07|m50k_07|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_08|m50k_08|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_09|m50k_09|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_10|m50k_10|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_11|m50k_11|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_12|m50k_12|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m25k_01|m25k_01|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_02|m25k_02|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_03|m25k_03|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_04|m25k_04|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_05|m25k_05|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_06|m25k_06|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_07|m25k_07|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_08|m25k_08|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_09|m25k_09|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_10|m25k_10|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_11|m25k_11|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_12|m25k_12|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_13|m25k_13|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_14|m25k_14|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_15|m25k_15|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_16|m25k_16|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_17|m25k_17|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_18|m25k_18|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_19|m25k_19|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_20|m25k_20|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_21|m25k_21|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_22|m25k_22|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_23|m25k_23|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_24|m25k_24|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_25|m25k_25|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_26|m25k_26|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_27|m25k_27|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_28|m25k_28|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_29|m25k_29|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_30|m25k_30|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_31|m25k_31|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_32|m25k_32|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_33|m25k_33|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_34|m25k_34|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_35|m25k_35|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_36|m25k_36|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_37|m25k_37|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_38|m25k_38|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=Countries|Countries||
+#LayersUrlPart:     LAYERS=National_Borders|National_Borders|0.000498902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=Nuts3_Borders|Nuts3_Borders|0.000498902848429637|2494.51424214819
+#LayersUrlPart:     LAYERS=Municipalities|Municipalities|0.000498902848429637|249.451923117667
+#LayersUrlPart:     LAYERS=m50k_01,m50k_02,m50k_03,m50k_04,m50k_05,m50k_06,m50k_07,m50k_08,m50k_09,m50k_10,m50k_11,m50k_12
+LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10,m25k_11,m25k_12,m25k_13,m25k_14,m25k_15,m25k_16,m25k_17,m25k_18,m25k_19,m25k_20,m25k_21,m25k_22,m25k_23,m25k_24,m25k_25,m25k_26,m25k_27,m25k_28,m25k_29,m25k_30,m25k_31,m25k_32,m25k_33,m25k_34,m25k_35,m25k_36,m25k_37,m25k_38
+##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+#grob
+#BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
+#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BBox_Mitte: N 47.60515 E 16.341865
+#centrope
+#BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
+#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#S?db?hmen
+BoundingBoxTopLeftWGS84: N 49.62233 E 13.51730
+BoundingBoxButtomRightWGS84: N 48.54843 E 15.61450
+#MinScale:   1
+#MaxScale:   26
+RecommendedScale:   2.5
+ImageFileExtension: .png



From araber95 at mail.berlios.de  Mon Sep  7 12:38:35 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 7 Sep 2009 12:38:35 +0200
Subject: [Cachewolf-svn] r2152 - trunk/res_noewe/webmapservices
Message-ID: <200909071038.n87AcZBT030394@sheep.berlios.de>

Author: araber95
Date: 2009-09-07 12:38:25 +0200 (Mon, 07 Sep 2009)
New Revision: 2152

Added:
   trunk/res_noewe/webmapservices/cz-jm_t25.wms
   trunk/res_noewe/webmapservices/cz-vy_t25.wms
Modified:
   trunk/res_noewe/webmapservices/cz-jc_t25.wms
Log:
wms Centrope for CZ regions S??db??hmen, Hochland, S??dm??hren changed/new

Modified: trunk/res_noewe/webmapservices/cz-jc_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-jc_t25.wms	2009-09-06 23:05:09 UTC (rev 2151)
+++ trunk/res_noewe/webmapservices/cz-jc_t25.wms	2009-09-07 10:38:25 UTC (rev 2152)
@@ -82,11 +82,11 @@
 ##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
-#grob
+#Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
 #BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
-#centrope
+#real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
 #BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
 #S?db?hmen

Added: trunk/res_noewe/webmapservices/cz-jm_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-jm_t25.wms	2009-09-06 23:05:09 UTC (rev 2151)
+++ trunk/res_noewe/webmapservices/cz-jm_t25.wms	2009-09-07 10:38:25 UTC (rev 2152)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://www.centropemap.org
+GetCapabilitiesUrl: http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+#Name:               Oesterreich, Tschechien, Slowakei, Ungarn t100 SF=7..12
+#Name:               Centrope Oesterreich, Tschechien, Slowakei, Ungarn t25 SF=1..7
+Name:               CZ.Jihomoravsky t25 SF=1..7
+#Name:               CZ.S?dm?hren t25 SF=1..7
+MapType:                        topo
+MainUrl:            http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287 31466 31467
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287 SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Topographic Base Map|Topographic Base Map|997.805696859274|24945.1424214819
+#LayersUrlPart:     LAYERS=GeoAtlas_2008|GeoAtlas_2008||
+#LayersUrlPart:     LAYERS=m4m|m4m|1496.70854528891|498902.847930734
+#LayersUrlPart:     LAYERS=m2m|m2m|548.793133272601|1496.70804638606
+#LayersUrlPart:     LAYERS=m1m|m1m|299.341709057782|548.792634369752
+#LayersUrlPart:     LAYERS=m500k|m500k|114.748154041665|299.341210154934
+#LayersUrlPart:     LAYERS=m250k|m250k|37.4182125350712|114.747655138817
+#LayersUrlPart:     LAYERS=m100k_01|m100k_01|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_02|m100k_02|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_03|m100k_03|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_04|m100k_04|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_05|m100k_05|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m50k_01|m50k_01|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_02|m50k_02|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_03|m50k_03|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_04|m50k_04|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_05|m50k_05|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_06|m50k_06|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_07|m50k_07|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_08|m50k_08|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_09|m50k_09|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_10|m50k_10|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_11|m50k_11|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_12|m50k_12|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m25k_01|m25k_01|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_02|m25k_02|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_03|m25k_03|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_04|m25k_04|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_05|m25k_05|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_06|m25k_06|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_07|m25k_07|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_08|m25k_08|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_09|m25k_09|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_10|m25k_10|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_11|m25k_11|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_12|m25k_12|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_13|m25k_13|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_14|m25k_14|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_15|m25k_15|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_16|m25k_16|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_17|m25k_17|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_18|m25k_18|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_19|m25k_19|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_20|m25k_20|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_21|m25k_21|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_22|m25k_22|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_23|m25k_23|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_24|m25k_24|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_25|m25k_25|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_26|m25k_26|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_27|m25k_27|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_28|m25k_28|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_29|m25k_29|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_30|m25k_30|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_31|m25k_31|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_32|m25k_32|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_33|m25k_33|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_34|m25k_34|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_35|m25k_35|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_36|m25k_36|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_37|m25k_37|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_38|m25k_38|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=Countries|Countries||
+#LayersUrlPart:     LAYERS=National_Borders|National_Borders|0.000498902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=Nuts3_Borders|Nuts3_Borders|0.000498902848429637|2494.51424214819
+#LayersUrlPart:     LAYERS=Municipalities|Municipalities|0.000498902848429637|249.451923117667
+#LayersUrlPart:     LAYERS=m50k_01,m50k_02,m50k_03,m50k_04,m50k_05,m50k_06,m50k_07,m50k_08,m50k_09,m50k_10,m50k_11,m50k_12
+LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10,m25k_11,m25k_12,m25k_13,m25k_14,m25k_15,m25k_16,m25k_17,m25k_18,m25k_19,m25k_20,m25k_21,m25k_22,m25k_23,m25k_24,m25k_25,m25k_26,m25k_27,m25k_28,m25k_29,m25k_30,m25k_31,m25k_32,m25k_33,m25k_34,m25k_35,m25k_36,m25k_37,m25k_38
+##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+#Server
+#BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
+#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BBox_Mitte: N 47.60515 E 16.341865
+#Real
+#BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
+#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#S?dm?hren
+BoundingBoxTopLeftWGS84: N 49.634619 E 15.531836
+BoundingBoxButtomRightWGS84: N 48.609817 E 17.657948
+#MinScale:   1
+#MaxScale:   26
+RecommendedScale:   2.5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/cz-vy_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_t25.wms	2009-09-06 23:05:09 UTC (rev 2151)
+++ trunk/res_noewe/webmapservices/cz-vy_t25.wms	2009-09-07 10:38:25 UTC (rev 2152)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://www.centropemap.org
+GetCapabilitiesUrl: http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+#Name:               Oesterreich, Tschechien, Slowakei, Ungarn t100 SF=7..12
+#Name:               Centrope Oesterreich, Tschechien, Slowakei, Ungarn t25 SF=1..7
+Name:               CZ.Vysocina t25 SF=1..7
+#Name:               CZ.Hochland t25 SF=1..7
+MapType:                        topo
+MainUrl:            http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287 31466 31467
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287 SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Topographic Base Map|Topographic Base Map|997.805696859274|24945.1424214819
+#LayersUrlPart:     LAYERS=GeoAtlas_2008|GeoAtlas_2008||
+#LayersUrlPart:     LAYERS=m4m|m4m|1496.70854528891|498902.847930734
+#LayersUrlPart:     LAYERS=m2m|m2m|548.793133272601|1496.70804638606
+#LayersUrlPart:     LAYERS=m1m|m1m|299.341709057782|548.792634369752
+#LayersUrlPart:     LAYERS=m500k|m500k|114.748154041665|299.341210154934
+#LayersUrlPart:     LAYERS=m250k|m250k|37.4182125350712|114.747655138817
+#LayersUrlPart:     LAYERS=m100k_01|m100k_01|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_02|m100k_02|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_03|m100k_03|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_04|m100k_04|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_05|m100k_05|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m50k_01|m50k_01|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_02|m50k_02|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_03|m50k_03|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_04|m50k_04|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_05|m50k_05|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_06|m50k_06|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_07|m50k_07|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_08|m50k_08|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_09|m50k_09|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_10|m50k_10|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_11|m50k_11|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_12|m50k_12|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m25k_01|m25k_01|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_02|m25k_02|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_03|m25k_03|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_04|m25k_04|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_05|m25k_05|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_06|m25k_06|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_07|m25k_07|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_08|m25k_08|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_09|m25k_09|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_10|m25k_10|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_11|m25k_11|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_12|m25k_12|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_13|m25k_13|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_14|m25k_14|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_15|m25k_15|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_16|m25k_16|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_17|m25k_17|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_18|m25k_18|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_19|m25k_19|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_20|m25k_20|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_21|m25k_21|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_22|m25k_22|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_23|m25k_23|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_24|m25k_24|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_25|m25k_25|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_26|m25k_26|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_27|m25k_27|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_28|m25k_28|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_29|m25k_29|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_30|m25k_30|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_31|m25k_31|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_32|m25k_32|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_33|m25k_33|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_34|m25k_34|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_35|m25k_35|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_36|m25k_36|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_37|m25k_37|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_38|m25k_38|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=Countries|Countries||
+#LayersUrlPart:     LAYERS=National_Borders|National_Borders|0.000498902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=Nuts3_Borders|Nuts3_Borders|0.000498902848429637|2494.51424214819
+#LayersUrlPart:     LAYERS=Municipalities|Municipalities|0.000498902848429637|249.451923117667
+#LayersUrlPart:     LAYERS=m50k_01,m50k_02,m50k_03,m50k_04,m50k_05,m50k_06,m50k_07,m50k_08,m50k_09,m50k_10,m50k_11,m50k_12
+LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10,m25k_11,m25k_12,m25k_13,m25k_14,m25k_15,m25k_16,m25k_17,m25k_18,m25k_19,m25k_20,m25k_21,m25k_22,m25k_23,m25k_24,m25k_25,m25k_26,m25k_27,m25k_28,m25k_29,m25k_30,m25k_31,m25k_32,m25k_33,m25k_34,m25k_35,m25k_36,m25k_37,m25k_38
+##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+#Server
+#BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
+#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BBox_Mitte: N 47.60515 E 16.341865
+#real
+#BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
+#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#Hochland
+BoundingBoxTopLeftWGS84: N 49.86521 E 14.886475
+BoundingBoxButtomRightWGS84: N 48.932583 E 16.42529
+#MinScale:   1
+#MaxScale:   26
+RecommendedScale:   2.5
+ImageFileExtension: .png



From pfeffer at mail.berlios.de  Mon Sep  7 13:48:49 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 7 Sep 2009 13:48:49 +0200
Subject: [Cachewolf-svn] r2153 - trunk/res_noewe/webmapservices
Message-ID: <200909071148.n87BmnnU014148@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-07 13:48:47 +0200 (Mon, 07 Sep 2009)
New Revision: 2153

Added:
   trunk/res_noewe/webmapservices/pl_p.wms
   trunk/res_noewe/webmapservices/pl_t50.wms
Log:
WMS: airial photos and topographic map 1:25000 for poland (raw version made by araber95)

Added: trunk/res_noewe/webmapservices/pl_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/pl_p.wms	2009-09-07 10:38:25 UTC (rev 2152)
+++ trunk/res_noewe/webmapservices/pl_p.wms	2009-09-07 11:48:47 UTC (rev 2153)
@@ -0,0 +1,22 @@
+TakenFromUrl:       
+GetCapabilitiesUrl: http://sdi.geoportal.gov.pl/wms_orto/wmservice.aspx?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               pl p
+MapType:                        photo
+MainUrl:            http://sdi.geoportal.gov.pl/wms_orto/wmservice.aspx?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+#      <SRS>EPSG:2180</SRS>
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=ORTOFOTO|ORTOFOTO||
+LayersUrlPart:     LAYERS=ORTOFOTO
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 54.8793 E 10.0579
+BoundingBoxButtomRightWGS84: N 48.3726 E 28.4862
+#BBox_Center: N 51.6259298143288 E 19.2720480387164
+MinScale:   0
+MaxScale:   24
+RecommendedScale:   1
+ImageFileExtension: .jpg

Added: trunk/res_noewe/webmapservices/pl_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/pl_t50.wms	2009-09-07 10:38:25 UTC (rev 2152)
+++ trunk/res_noewe/webmapservices/pl_t50.wms	2009-09-07 11:48:47 UTC (rev 2153)
@@ -0,0 +1,30 @@
+TakenFromUrl:       
+GetCapabilitiesUrl: http://sdi.geoportal.gov.pl/wms_topo/wmservice.aspx?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               pl t50 SF=1..8
+MapType:                        topo
+MainUrl:            http://sdi.geoportal.gov.pl/wms_topo/wmservice.aspx?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+#      <SRS>EPSG:2180</SRS>
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=TOPO_50_92|TOPO_50_92||
+#LayersUrlPart:     LAYERS=TOPO_50_65|TOPO_50_65||
+#LayersUrlPart:     LAYERS=TOPO_50_42|TOPO_50_42||
+#LayersUrlPart:     LAYERS=TOPO_25_65|TOPO_25_65||
+#LayersUrlPart:     LAYERS=TOPO_100_80|TOPO_100_80||
+#LayersUrlPart:     LAYERS=TOPO_10_92|TOPO_10_92||
+#LayersUrlPart:     LAYERS=TOPO_10_65_Sytuacja|TOPO_10_65_Sytuacja||
+#LayersUrlPart:     LAYERS=TOPO_10_65_Rzezba|TOPO_10_65_Rzezba||
+#LayersUrlPart:     LAYERS=TOPO_10_42|TOPO_10_42||
+LayersUrlPart:     LAYERS=TOPO_50_92
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 54.84 E 14.121686
+BoundingBoxButtomRightWGS84: N 48.9996 E 24.1488
+#BBox_Mitte: N 51.6341900499786 E 19.2912770537469
+MinScale:   1
+MaxScale:   8
+RecommendedScale:   5
+ImageFileExtension: .png



From pfeffer at mail.berlios.de  Mon Sep  7 15:57:37 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 7 Sep 2009 15:57:37 +0200
Subject: [Cachewolf-svn] r2154 - trunk/res_noewe/languages
Message-ID: <200909071357.n87Dvb5Y000929@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-07 15:57:36 +0200 (Mon, 07 Sep 2009)
New Revision: 2154

Added:
   trunk/res_noewe/languages/PL.cfg
Log:
Localisation: first polish version

Added: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-07 11:48:47 UTC (rev 2153)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-07 13:57:36 UTC (rev 2154)
@@ -0,0 +1,886 @@
+{cachewolf.Languages}
+        {LocalResources}
+                {pl}
+                100=HTML
+                101=GPX Mapsource
+                102=TOP50 ASCII
+                103=GPX
+                104=ASC
+                105=TomTom
+                106=MS AutoRoute CSV
+                107=Eksport
+                108=Wlasciwosci
+                109=Wczytaj skrzynki
+                110=Zapisz i wyjdz
+                111=Wyjdz
+                112=Szukaj
+                113=Wyczysc wyszukiwanie
+                114=Edytuj i uzyj filtra
+                115=Odwroc filtr
+                116=Wyczysc filtr
+                117=O...
+                118=WolfLanguage
+                119=Szukaj:
+                120=Aplikacja
+                121=Profil
+                122=Garmin
+                123=CacheMate
+                124=OZI
+                125=Google Earth
+                126=TomTom OV2
+                127=Zapisz
+                128=Przez szablon
+                129=Importuj GPX
+                130=Sciagnij z opencaching.de
+                131=Sciagnij z geocaching.com
+                132=Explorist
+                133=Szukaj wszystkich
+                134=Wybrana Skrzynka
+                139=Zarzadzaj Travelbugami
+                140=Zarzadzanie
+                141=Kopiuj
+                142=Przenies
+                143=Usun
+                144=Uwaga
+                145=Dane WSZYSTKICH POKAZANYCH waypointow beda usuniete! Kontynuowac? 
+                146=Dane WSZYSTKICH POKAZANYCH waypointow beda skopiowane! Kontynuowac?
+                147=Dane WSZYSTKICH POKAZANYCH waypointow beda przeniesione! Kontynuowac?
+                148=Wybierz folder docelowy
+                149=Mapy
+                150=Importuj
+                151=Kalibruj
+                152=Import mapy
+                153=Mapa zaimportowana
+                154=Blad podczas importowania mapy
+                155=Legenda
+                156=Blad pamieci - za duza mapa
+                157=System
+                158=Sprawdzanie wersji
+                159=Filtr
+                160=Filtruj zaznaczone
+                161=Pokaz czarna liste
+                162=Sciagnij skalibrowane
+                170=Wybierz folder z danymi
+                171=Profil nie istnieje:+
+                172=Blad: nie mozna utworzyc katalogu map:%0a
+                173=GPSBabel:
+                174=Krotkie nazwy
+                175=Importuj
+                176=Pierwsze uruchomienie %0a Prosze wybrac katalog z danymi %0a i stworzyc swoj profil %0a%0a Dla zaawansowanych: %0a Blad odczytu pliku wlasciwosci:%0a
+                177=-- chwilowo nieuzywane--
+                178=Sprawdzanie wersji
+                179=Jestes na%0atej wersji.
+                180=Wez skrzynki
+                181=tutaj
+                182=Nowa lista
+                183=Wczytaj liste
+                184=Zapisz jako
+                185=Zapisz (bez potwierdzenia)
+                186=Wez tez Addi Wpts
+                187=Pokaz tylko te waypointy
+                188=CACHEWYCIECZKA: Nowa
+                189=Wlacz filtr wycieczki
+                190=Pokaz tylko te waypointy
+                191=Wybierz plik
+                192=Zapisz zmiany
+                193=Dodaj Addis
+                195=Aktualny srodek
+                196=Wszystkich # skrzynek (GC&OC)%0aWszystkich # widocznych%0aWszystkich # znalezionych
+                197=Pokaz/ukryj cachewycieczke
+                198=cachewycieczka
+                199=Dodaj do cachewycieczki
+                200=Szczegoly
+                201=Opis
+                202=Obrazki
+                203=Logi i podpowiedzi
+                204=Pomoc w rozwiazaniu
+                205=Radar
+                206=Lista
+                207=Zawsze loguj na GC
+                208=Przebuduj index
+                209=Trwa przebudowywanie index
+                210=Nie ma skrzynek w index.xml:+
+                211=%0aDodane:+
+                212=Usun wszystkie pliki .xml, ktore nie sa w index.xml i zalaczone obrazy
+                213=Usuwanie sierot
+                214=Nowy WaypointUsunacUsunac
+                215=LOC
+                216=Zawsze loguj do GC
+                217=sciagnij wszystkie znalezione z geocaching.com
+                218=Takze w opisie/notatkach
+                219=Wyszukiwanie...
+                220=Sprawdz notatki i pomoc
+                221=Nadpisac filtr?
+                222=Taki filtr juz istnieje. Nadpisac?
+                223=Usunac filtr?
+                224=+- Usunac zapisany filtr?
+                225=Takze w logach
+                250=ColleIsarcos tekst uzyty w DataMover
+                251=Wszystkie waypointy zostana skasowane
+                252=Wszystkie waypointy zostana przeniesione
+                253=Wszystkie waypointy zostana skopiowanie
+                254=Wszytskie widoczne
+                255=Wszystkie zaznaczone
+                256=Wszystkie widoczne i zanzaczone
+                257=Glowne
+                258=Addis
+                259=Czy chcesz kontynuowac?
+                260=Platforma:
+                261=Twoj jezyk:
+                262=Twoj kraj:
+                263=Separator dziesietny:
+                264=Twoje urzadzenie PDA:
+                265=Obraz:
+                266=Rozmiar czcionki:
+                267=Wpisy w bazie:
+                268=Separator plikow:
+                269=Katalog programu:
+                270=Liczba szczegolow w RAM:
+                271=Maksymalnie:
+                272=Wersja CacheWolf-a:
+                299=Regular expression
+                300=Typ:
+                301=Rozmiar:
+                302=Waypoint:
+                303=Nazwa:
+                304=Lokalizacja:
+                305=Ukryty:
+                306=Wlasciciel:
+                307=Status:
+                308=Notatki:
+                309=Ustaw wysrodkowany
+                310=Usun
+                311=Nowy Waypoint
+                312=Zapisz
+                313=Flaga 1
+                314=Flaga 2
+                315=Flaga 3
+                316=Flaga 4
+                317=Szukaj
+                318=Znaleziono
+                319=Nie znaleziono
+                320=Wlasciciel
+                321=Blad
+                322=Nie znaleziono obrazkow/map
+                323=Fehler beim Schreiben der Datei
+                324= - sprobowac ponownie?
+                325=Za malo punktow odniesienia, mapa nie skalibrowana.
+                326=Nie ma dostepnej skalibrowanej mapy. %0a Prosze wybrac inna skale by wyswietlic trase i skrzynki.
+                327=Informacje
+                328=Data znalezienia
+                329=Ukryta
+                340=Obrazki skrzynki:
+                341=Obrazki uzytkownika:
+                342=usuniete
+                343=Nie mozna wczytac obrazka skrzynki, za malo pamieci
+                344=Usun obrazek
+                345=Idz do tych wspolrzednych
+                346=Pokaz TravelBugi
+                347=Pokaz mape
+                348=Dodaj obrazki uzytkownika.
+                349=Zmien status czarnej listy
+                350=Dodaj znacznik czasowy do notatek
+                351=Dodaj/edytuj notatki
+                400=Odkoduj
+                401=Zakoduj
+                500=Przelacz
+                588=System jednostek
+                589=Metryczny (km)
+                590=Milowy (mi.)
+                591=Pozostaw puste dla jezyka domyslnego lub%0adodaj 2 literowy jezyk, e.g. DE, EN, PL
+                592=Jezyk (wymagany restart)
+                593=Haslo jest opcjonalne.%0aWpisz tylko jesli chcesz zachowac je w pref.xml
+                594=Passwd
+                595=Lista
+                596=Nazwa
+                597=Waypoint
+                598=Typ
+                599=Checkbox
+                600=Wlasciwosci
+                601=Twoj alias:
+                602=Wspolrzedne startowe:
+                603=Folder danych
+                604=Szukaj
+                605=Liczba kolumn tabeli:
+                606=Trudnosc
+                607=Teren
+                608=Wspolrzedne
+                609=Wlasciciel
+                610=Ukryta
+                611=Status
+                612=Odleglosc
+                613=Azymut
+                614=Anuluj
+                615=OK
+                616=Wybierz folder
+                617=Wklej
+                618=Kopiuj
+                619=Przeksztalc
+                620=Zapisz
+                621=Ogolnie
+                622=Obraz
+                623=Obrazki:
+                624=Pokaz usuniete obrazy
+                625=Ekran (wymaga restartu):
+                626=Menu top
+                627=Tabs top
+                628=Status
+                629=Autostart ostatniego profilu
+                630=HintLogPanel:  Logi na strone
+                631=PDA ma przycisk Zamknij
+                632=Wiecej...
+                633=Max. logow do spidera
+                634=uzyj Proxy
+                635=Rozmiar
+                636=OC Recs
+                637=OC Index
+                638=POkaz obrazki w opisie
+                639=Uaktualniac podczas sciagania?
+                640=Tak
+                641=Nie
+                642=Pytanie
+                643=Szczegoly skrzynki:
+                644=waypoint
+                645=nazwa
+                700=Ustaw filtr
+                701=Odleglosc
+                702=Trudnosc
+                703=Znaleziona
+                704=Nie znaleziona
+                705=w ciagu ostatnich
+                706=Znaleziona
+                707=Wlasciciel
+                708=Anuluj
+                709=Zastosuj Filtr
+                710=Zarchiwizowana
+                711=Niedostepna
+                712=Wybierz plik drogi
+                713=Zapisz Filtr
+                714=azymut i Odleglosc
+                715=Pokaz wszystkie skrzynki o statusie:
+                716=Odznacz wszystkie
+                717=Zaznacz wszystkie
+                718=Oceny skrzynek
+                719=Typy skrzynek
+                720=Status
+                721=Kierunek
+                722=Oceny
+                723=Typy
+                724=Pojemnik
+                725=Pamietaj: Filtry sa addytywne, aktywne filtry=zielone
+                726=Dodatkowe waypointy
+                727=Cache pojemnik
+                728=Add. Waypt
+                729=Nie zarchiwizowana
+                730=Dostepna
+                731=Jeszcze nieznaleziona
+                732=Inny wlasciciel
+                733=Addi Wpt
+                734=Nie znaleziono waypointow dla
+                735=Waypointy Addi musza miec format xxYYYY, gdzie xx to 2 obojetne znaki a YYYY to glowne znaki skrzynki GC
+                736=Za duzo logow (Limit mozna ustawic we wlasciwosciach)
+                737=Wlasciwosci skrzynki
+                738=Wlasciwosci
+                739=Filtr wlaczony
+                740=wszystkie
+                741=jedna
+                742=zadna
+                800=Tworzenie listy
+                801=Szukanie...
+                802=Skrzynki zidentyfikowane. Szukanie...
+                803=Zrobione!
+                804=Zbieranie szczegolow skrzynek
+                805=Zbieranie danych dla:
+                900=Lista
+                901=Loc
+                902=Najblizsze
+                903=Anuluj
+                904=Multi
+                905=Wczytaj skrzynki
+                906=Lista skrzynek:
+                907=Max Odleglosc:
+                908=Wybierz waypoint plik:
+                909=Wybierz plik(i)
+                910=Wybierz plik szablonow
+                950=Transfer
+                951=Wysylanie do GPS
+                952=Konwertuje...
+                999=Nie ustawiono
+                1000=D
+                1001=T
+                1002=Waypoint
+                1003=Nazwa
+                1004=Polozenie
+                1005=Wlasciciel
+                1006=Ukryta
+                1007=Status
+                1008=Odl.
+                1009=Azym
+                1010=Idz do tej
+                1011=Filtruj niezaznaczone
+                1012=Usun zaznaczone
+                1013=Wybrane / Zaznaczone
+                1014=Aktualizuj wybrane
+                1015=Zaznacz wszystkie
+                1016=Odznacz wszystkie
+                1017=S
+                1018=Otworz offline w przegladarce
+                1019=Ustaw jako wysrodkowane
+                1020=Otworz online w przegladarce
+                1021=Otworz opis skrzynki
+                1022=Skasuj wszystkie waypointy z zaznaczeniem (
+                1023=Funkcja dostepna tylko dla geocaching.com
+                1024=Odleglosci na liscie ustalone od aktualnej pozycji
+                1025=Nie mozna srodkowac (Bledna pozycja GPS)
+                1026=#Rec
+                1027=OC-Idx
+                1028=)?
+                1029=Uwaga. Sa waypointy zaznaczone ale niewidoczne.%0a(Glowne skrzynki:+
+                1030=, dodatkowe waypointy:+
+                1031=Usunac je takze?
+                1032=sciezka do przegladarki:
+                1033=nieprawidlowa!
+                1034=Blad podczas uruchamiania przegladarki!
+                1035=Mozliwe przyczyny:
+                1036=Bug w ewe VM, prosze byc
+                1037=cierpliwym podczas update'u
+                1038=S
+                1039=Istnieje pomoc
+                1040=N
+                1041=Istnieja notatki
+                1042=Pokaz Addis
+                1043=Ta skrzynka nie ma dodatkowych waypointow.
+                1044=Addis
+                1045=Ukryj Addis
+                1046=# Addis
+                1047=A
+                1048=# Nieznalezienia
+                1049=Nieznalezienie
+                1050=Ostatnio zsynchronizowane
+                1051=Data ostatniej synchronizacji
+                1100=Profile
+                1105=Browse
+                1106=Wybierz Profil lub nowy
+                1107=Nowy
+                1108=Wybierz Profil
+                1109=Otworz
+                1110=Srodek
+                1111=Stworz nowy Profil:
+                1112=Nazwa nowego profilu
+                1113=Nie mozna utworzyc katalogu (nie moze zawierac znakow zabronionych w systemie)
+                1114=Taki katalog juz istnieje.
+                1115=Srodek
+                1116=Aktualny
+                1117=kopiuj
+                1118=Profil
+                1119=Stare Profile
+                1120=Trud
+                1121=Tere
+                1122='maps' zarezerwowane dla katalogu map.
+                1123=Kliknij "nastepny" by zdefiniowac srodkowe wspolrzedne profilu.
+                1124=Nastepny
+                1200=Lista
+                1201=Szczegoly
+                1202=Opis
+                1203=Obrazki
+                1204=Podpowiedz i Logi
+                1205=Pomoc
+                1206=Calc
+                1207=Twoj Profil ma niezapisane zmiany. Chcesz zapisac?
+                1300=Ostatnie ustawienia
+                1301=Wybierz Profil:
+                1400=Strefa
+                1401=Northing
+                1402=Easting
+                1403=azymut
+                1404=Odleglosc
+                1405=Aby wczytac wspolrzedne z GC, Wprowadz GCxxxxx ponizej
+                1406=Wprowadz wspolrzedne w dowolnym formacie lub GCxxxx
+                1407=krokow
+                1408=stop
+                1409=jardow
+                1410=mil
+                1411=Wprowadz poprawne wspolrzedne
+                1412=Niepoprawne wspolrzedne. Uzyc tak czy tak?
+                1413=Czysto
+                1500=DST:
+                1501=Aktualna
+                1502=deg
+                1503=P??noc wysrodkowane
+                1504=Start GPS
+                1505=Stop GPS
+                1506=Mapa
+                1507=Wspolrzedne poza zasiegiem:
+                1508=szerokosc
+                1509=dlugosc
+                1510=Brak danych z GPS%0aZamkniete polaczenie do portu
+                1511=Bledne dane z GPS%0a mozliwe przyczyny:%0a zly Port,%0a zla predkosc portu (Baudrate),%0a protokol nie NMEA%0aPolaczenie z portem zerwane%0aOstatni wiersz probowany do interpretacji:%0a
+                1512=Waypoint
+                1513=Nie mozna poruszac mapy bez prawidlowych wspolrzednych.%0a Prosze Wprowadz Wspolrzedne srodka %0alub na wybrana skrzynke, lub pozycja GPS
+                1514=Nie mo?na przeliczyc odleglosci, pozycja GPS nie ustawiona
+                1600=Opencahing.de Download
+                1601=Odleglosc:
+                1602=Sciagnij obrazki
+                1603=Sciagnij mapy
+                1604=Anuluj
+                1605=OK
+                1606=Sciagnij ponownie wszystko
+                1607=Update Z opencaching udany
+                1608=Sciagam dane Z opencaching...
+                1609=Importuje Skrzynke:
+                1610=Sciagnij brakujaca mape
+                1611=Importowanie opisu skrzynki:
+                1612=Importowanie Log:
+                1613=Importowanie obrazow:
+                1614=Blad podczas rozpakowywania %0apliku update'u
+                1615=Blad przeliczania pliku, stan:
+                1616=Blad: nie moge sciagnac pliku z opencaching.de
+                1617=Ignoruje Blad w html-skrzynka-opis: "<img" without "src=" dla skrzynki+
+                1618=Ignoruje Blad w skrzynce:+
+                1619=: nie moge pobrac obrazka z URL:+
+                1620=Sciagam osadzone grafiki:+
+                1621=Blad podczas interpretacji danych%0a Z Opencaching.de,%0aNajpopularniejszy blad w Opencaching.de%0aSprobuj pozniej%0a Status:
+                1622=Wyklucz znalezione skrzynki
+                1623=Max. numer:
+                1624=+skrzynek
+                1625=Sciagnij TBs
+                1626=Max. logow:
+                1627=Wszystkie skrzynki
+                1700=Blad on line:
+                1701= pozycja:
+                1702=Zmienna niezdefiniowana:
+                1703=Nieprawidlowy numer:
+                1704=Nieoczekiwany koniec
+                1705=brak znacznika ENDIF
+                1706=Oczekiwane
+                1707=Znalezione:
+                1708=Niejasna funkcja Nazwa:
+                1709=Nieznana funkcja:
+                1710=Nie moge liczyc pustego ciagu
+                1711=Ciagi musza byc tej samej dlugosci
+                1712=Zle wspolrzedne:
+                1713=Zly format wspolrzednych. Dozwolone to cw / dd / dmm / dms /+
+                1714=GoTo: Waypoint nie istnieje:
+                1715=instr: Pozycja poczatkowa nie w ciagu
+                1716=mid: Oczekiwano wartosci calkowitej
+                1717=mid: Poza przedzialem
+                1718=Odleglosc nie moze byc ujemna
+                1719=Azymut musi byc w przedziale [0;360] stopni
+                1720=Nie ma rzeczywistych pierwiastkow kwadratowych liczby ujemnej
+                1723=Oczekiwano porownania
+                1724=Zmienna nie ustawiona:
+                1725=Nieoczekiwane znaki:
+                1726=Za duzo argumentow funkcji
+                1727=Zla ilosc argumentow
+                1728=Funkcja jeszcze niezaimplementowana:
+                1729=Dzielenie przez 0
+                1730=ciag nieskonczony
+                1731=Zly format znakow
+                1732=Zly znak
+                1733=Komenda wejsciowa
+                1734=Puste dane wyjsciowe
+                1735=Rozwiazane!
+                1736=Wczytaj
+                1737=Zapisz
+                1738=Zapisz jako
+                1739=Azymut musi byc w przedziale [0;2*PI] stopni 
+                1740=Crossazymut degrees  must be in interval [0;360]
+                1741=Crossazymut degrees  must be in interval [0;2*PI]
+                1742=Crossazymut: Odleglosc between points to small
+                1743=Crossazymut calculation failed. Prosze inform the developers at geoclub.de
+                1800=Download georeferenced maps
+                1801=Download tiles
+                1802=Download georeferenced maps%0a Wybierz serwis online:
+                1803=dla
+                1804=wszystkich
+                1805=zaznaczonych
+                1806=skrzynek
+                1807=Okolo m na pixel:
+                1808=zachodzenie na pixel:
+                1809=sciagnij mape ogolna
+                1810=Within a rectangle of:
+                1811=dookola srodka:
+                1812=Tiles
+                1813=Sciagnij mape dla
+                1814=Dla skrzynki
+                1815=Downloading georeferenced maps
+                1816=Downloading georeferenced maps%0a %0a %0a %0a %0a
+                1817=No caches are ticked
+                1818=getSortedMapServiceIndex: index
+                1819=not Znaleziona
+                1820=Downloading map '
+                1821=%0a for cache:%0a
+                1822=Cache:
+                1823=Ignoring Blad:
+                1824=downloading overview map
+                1825=Overview map: Ignoring Blad:
+                1826=Finished downloading and calibration of maps
+                1827='radius' must be graeter than 0
+                1828='overlapping' must be greater lub equal 0
+                1829=Prosze Wprowadz the 'centre' around which the maps shall be downloaded
+                1830=The Wybierzed online map service provides map in the scale from
+                1831= to
+                1832=%0a Prosze adjust 'Approx. meter pro pixel' accordingly
+                1833=Prosze don't Wybierz the separetor line in the wms service option
+                2000=GPX Export
+                2001=of
+                2500=Blad loading attributes lub unknown attribute
+                2501=not 24-7
+                2502=available 24-7
+                2503=no bikes
+                2504=bikes allowed
+                2505=*boat-no
+                2506=*boat-yes
+                2507=*cactus-no
+                2508=*cactus-yes
+                2509=no campfires
+                2510=campfires allowed
+                2511=No camping
+                2512=Camping allowed
+                2513=*cliff-no
+                2514=falling rocks nearby
+                2515=no difficult climbing
+                2516=difficult climbing
+                2517=*compass-no
+                2518=*compass-yes
+                2519=*cow-no
+                2520=watch for livestock
+                2521=*danger-no
+                2522=dangerous area
+                2523=no dogs
+                2524=dogs allowed
+                2525=*fee-no
+                2526=access/parking fees
+                2527=*hiking-no
+                2528=significant hike
+                2529=no horses
+                2530=horses allowed
+                2531=*hunting-no
+                2532=hunting area
+                2533=no off-road vehicles
+                2534=off-road vehicles allowed
+                2535=no kids
+                2536=kid friendly
+                2537=*mine-no
+                2538=*mine-yes
+                2539=no motorcycles
+                2540=motorcycles allowed
+                2541=not recommended at night
+                2542=recommended at night
+                2543=takes Wiecej niz jeden hour
+                2544=takes less than one hour
+                2545=*parking-no
+                2546=parking available
+                2547=*phone-no
+                2548=telephone nearby
+                2549=*picnic-no
+                2550=picnic tables available
+                2551=*poisonoak-no
+                2552=*poisonoak-yes
+                2553=*public-no
+                2554=public transit available
+                2555=no quads
+                2556=quads allowed
+                2557=*rappelling-no
+                2558=climbing gear
+                2559=*restrooms-no
+                2560=restrooms available
+                2561=*scenic-no
+                2562=scenic view
+                2563=*scuba-no
+                2564=*scuba-yes
+                2565=*snakes-no
+                2566=*snakes-yes
+                2567=no snowmobiles
+                2568=*snowmobiles-yes
+                2569=no stealth required
+                2570=stealth required
+                2571=not stroller accessible
+                2572=stroller accessible
+                2573=*plywanie-no
+                2574=*plywanie-yes
+                2575=*thorn-no
+                2576=thorns!
+                2577=*ticks-no
+                2578=ticks!
+                2579=*wading-no
+                2580=may require wading
+                2581=*water-no
+                2582=drinking water nearby
+                2583=not wheelchair accessible
+                2584=wheelchair accessible
+                2585=not available in winter
+                2586=available in winter
+                2587=No maintenance needed
+                2588=Needs maintenance
+                2589=Flashlight required
+                3000=Close
+                4000=Loaded caches:+
+                4001=GPX pliks Z opencaching don't contain information of images, they cannot be laoded. Best you get caches Z opencaching by menu /Application/Import/Download Z Opencaching
+                4101=Maps
+                4102=Calibrated maps
+                4103=Not calibrated maps
+                4104=Anuluj
+                4105=Load
+                4106=Calibrate map
+                4107=Done!
+                4108=Coordinates:
+                4109=Loading maps...
+                4110=loading
+                4111=Wspolrzednemust be Wprowadzed in the format N XX XX.XXX E XXX XX.XXX
+                4112=IO-Blad while kopiujing image from:+
+                4113=to:+
+                4114=+Blad:+
+                4115=Blad: could not decode image:+
+                4116=+-+image not copied
+                4117=Blad while importing .map-plik:+
+                4118=IO-Blad while reading lub writing calibration plik
+                4119=No calibration plik Znaleziona for:+
+                4120=done.
+                4200=Wybierz map directory
+                4201=Information
+                4203=Loading list of maps...
+                4204=No georeferenced map available %0a Prosze Wybierz a scale %0a to show the track and the caches. %0a You can get one by the menu: Application/Maps/download calibrated
+                4206=Dist:+
+                4207=Blad
+                4208=Bug: %0aillegal mapChangeModus:+
+                4210=Moving map cannot run without a map - Prosze Wybierz one. %0a You can Wybierz an empty map
+                4211=No+
+                4212=less
+                4213=more
+                4214=+detailed map available
+                4215=No caches Wybierzed by a tick
+                4216=Loading map...
+                4217=Could not find image associated with: %0a
+                4218=Could not load map: %0a
+                4219=Not enough memory to load map: %0a
+                4220=%0a You can try to close %0a all prgrams and %0a restart CacheWolf
+                4221=Not enough ressources to load map:+
+                4222=Out of memory Blad
+                4230=Goto here$g
+                4232=Create nowy Waypoint here$n
+                4234=Wybierz a map manually$s
+                4236=Change map directory$c
+                4237=Change map directory
+                4238=Show map
+                4239=Show map
+                4240=Hide map
+                4241=Hide map
+                4242=Modus for automatic map change
+                4244=Highest res. containing dest. & cur. position
+                4246=Highest resolution
+                4247=Highest resolution
+                4248=Keep manual resolution
+                4249=Keep manual resolution
+                4250=Change resolution manually
+                4252=Load a map containing all marked caches
+                4253=Load a map containing all marked caches
+                4254=Load a map with more details
+                4255=Load a map with more details
+                4256=Load a map for a better overview
+                4257=Load a map for a better overview
+                4258=Move map to and load map
+                4260=Move map to goto point
+                4261=Move map to goto point
+                4262=Move map to GPS position
+                4263=Move map to GPS position
+                4264=Move map to centre
+                4265=Move map to centre
+                4266=Fill white areas
+                4267=Show white areas
+                4270=Open
+                4271=--- Maps containing GPS and goto pos. ---
+                4273=--- Maps containing curr. position ---
+                4274=--- Maps containing goto position ---
+                4275=--- Inne mapy ---
+                4276=Anuluj
+                4277=Wybierz
+                4278=Nie moge wczytac wfl-plik: \n
+                4279=Idz do
+                4300=Pusty 1 Pixel =+
+                4301=+metrow
+                4302=Lat/Lon poza obszarem podczas wczytywania+
+                4303=za malo lini w pliku+
+                4304=za malo punktow do kalibracji mapy.
+                4305=Not allowed values in affine%0a (matrix cannot be inverted)%0a w pliku %0a
+                4306=mapa nie skalibrowana
+                4400=Uwaga
+                4401=Ignoring Blad:%0a could not forward GPS data to host:%0a
+                4402=%0azatrzymaj i uruchom GPS by sprobowac ponownie
+                4403=Blad
+                4404=Nie moge polaczyc z odbiornikiem GPS.%0a Blad otwarcia Portu szeregowego%0a
+                4405=%0amozliwe przyczyny:\n Inny (GPS-)program blokuje port%0azly port%0aLoox: aktywna podczerwien blokuje GPS"
+                4406=Prosze kopiuj jave_ewe.dll do katalogu z programem
+                4407=The Profil pliks are not in the aktualna format.%0aTherefore they are now converted to the aktualna format. Depending of the size of the Profil and the computer involved this may take some minutes. Prosze bear with us until the conwersja is done.
+                4408=Could not connect to GPSD:
+                4409=%0amozliwe przyczyny:%0aGPSD host is not reachable lub GPSD is not running there
+                4500=Tot:
+                4501=Vis:
+                4502=Fnd:
+                4600=Some cache(s) cannot be shown because of wrong blacklist status
+                4700=Ignoruje blad podczas%0aodczytu pliku kalibracji%0a
+                4701=Szukam najlepszej mapy
+                4702=Optymalizacja
+                4703=Cachewolf moze wczytywac mapy duzo szybciej dodajac znaczniki identyfikujace do nazwy pliku. Zrobic to teraz?%0aTo moze zajac pare minut.
+                4704=%0aPonownie nazywam plik:
+                4705=Blad ponownego nazywania:%0a
+                4706=%0ado:%0
+                4707=I/O-Blad podczas odczytu:
+                4708=Blad podczas odczytu:
+                4709=Nie moge znalezc obrazka powiazanego z:%0a
+                4800=Wczytuje serwisy map online
+                4801=Ignoruje blad podczas %0a wczytywania pliku definicji serwera mapy%0a
+                4802=Sciagam skalibrowany (z georeferencjami) %0a obraz mapy %0a '
+                4803=' %0a Sciagam rzad %0a 
+                4804= kolumna
+                4805=Pole
+                4806=: Ignoruje blad:
+                4807=loadTo: nieudane sciaganie mapy: nie ma przekierowania http
+                4808=downloadImage: content-type:
+                4809= to nie obraz, poczatek struktury zawartosci:
+                4810=Blad podczas sciagania lub zapisu mapy:%0a
+                4811=OnlineMapService: getMapInfoObjectInternal(Pole mapy, Point pixelsize):%0a This method must be overloaded in order to be able to use it
+                4812=WebMapService: property >Nazwa:< brakuje w pliku:%0a
+                4813=WebMapService: property >MainUrl:< brakuje w pliku:%0a
+                4814=WebMapService: CoordinateReferenceSystemCacheWolf nie ma zadnej wartosci
+                4815=System powiazan wspolrzednych nie wspierany przez CacheWolf:%0a
+                4816=WebMapService: property >CoordinateReferenceSystemUrlPart:< brak w pliku:%0a
+                4817=numer wierszy w CoordinateReferenceSystemUrlPart (
+                4818=) musi byc taki sam jak numer kodu w CoordinateReferenceSystemCacheWolf (
+                4819=) uzyj spacji do rozdzielenia
+                4820=WebMapService: property >CoordinateReferenceSystemUrlPart:< bledne w pliku:%0a
+                4821=WebMapService: property >ImageplikExtension:< brak w pliku:%0a
+                4822=obszar:
+                4823= brak pokrycia w serwisie:
+                4824=, obszar:
+                4825=skala
+                4826= nie obslugiwane przez serwer online, zastosuj skale:
+                4827= (mierzone w metrach na piksel pionowo)
+                4828=Cachewolf nie wspiera takich wspolrzednych:
+                4829=getUrlForBoundingBox: Point:
+                4830=Nie pasujace Gau%df-Kr%fcger-Stripe w kodzie EPSG w pliku .wms
+                4831=getMapInfoObject: Cachewolf nie wspiera takich wspolrzednych:
+                4900=+to nie sa koordynaty Gauss-Krueger
+                4920=EPSG code+
+                4921=+nie wspierane
+                4922=EPSG code missing in:+
+                4923=fromWgs84: EPSG code+
+                4924=ToWgs84: EPSG code+
+                5498=Nieudane logowanie. Blad wczytania strony po zalogowaniu.
+                5499=Blad wczytywania strony logowania.%0aProsze sprawdzic polaczenie z internetem.
+                5000=Wczytuje liste skrzynek
+                5001=Nie moge powiazac spiderem waypointow bezposrednio.%0aProsze sprawdzic glowna skrzynke.
+                5002=: Na ten moment, ta funkcja jest dostepna tylko dla geocaching.com i opencaching.{cz,de,org.uk,pl}.
+                5003=Opcje
+                5004=Buduje powiazania z dodatkowymi waypointami...
+                5497=Blad: Brakuje tagu w spider.def
+                5500=Blad
+                5501=Logowanie nieudane! Zle konto lub Haslo?
+                5502=Fetching first page...
+                5503=Blad fetching first list page.
+                5504=Nie mozna wczytac 'spider.def'
+                5505=Wprowadz Haslo
+                5506=Haslo
+                5507=Status
+                5508=Loguje...
+                5509=Wspolrzedne dla srodka musza byc podane
+                5510=Opcje Spidera
+                5511=Znaleziona+
+                5512=+skrzynki
+                5513=Wczytuje:+
+                5514=%0aPobieram bugi:+
+                5515=Nie mozna zaladowac skrzynki.%0aProsze sprawdzic polaczenie z netem.%0aSprobowac ponownie?
+                5516=+Nie mozna zaladowac%0aopisu skrzynek.
+                5517=Spider updates?
+                5518=+Skrzynki w bazie wymagaja update'u.%0aZrobic to teraz?
+                5519=Informacje
+                5520=Tylko zadane maksimum zostalo wczytane.%0aPowtorz pozniej by znalezc inne skrzynki.%0aZadna z dotychczasowych skrzynek nie zostala updateowana.
+                5521=Strona+
+                6000=Przewodnik
+                6001=Nazwa
+                6002=sciezka#
+		6003=Misja
+		6004=Z Prof
+		6005=Z Wpt
+		6006=Z Dane
+		6007=Z Log
+		6008=Do Prof
+	  	6009=Do Wpt
+		6010=Do Dane
+		6011=Do Log
+		6015=*** INNE ***
+		6016=Wez travelbug
+		6017=Wrzuc travelbug
+		6018=Travelbug Nazwa
+		6019=Tracking numer
+		6020=Travelbug nie znaleziony.
+		6021=Wiecej niz jeden travelbug Znaleziony. Sprecyzuj nazwe.
+		6022=: aktualna cache:+
+		6025=Nazwa:
+		6026=Tracking #:
+		6027=Id/Guid:
+		6028=Nazwa
+		6029=Profil/Cache:
+		6030=Znaleziona:
+		6031=Zalogowana
+		6032=Od
+		6033=Data wrzucenia:
+		6034=Do
+		6035=Misja:
+		6036=Misja
+		6040=Zabierz TB z aktualnej skrzynki
+		6041=Wrzuc TB do skrzynki
+		6042=nowy Travelbug
+		6043=Usun Travelbug
+		6044=Pobierz misje (i nazwe)
+		6045=Otworz online
+		6046=Pokaz tylko nie zalogowane
+		6047=Usun wybrane Travelbugi
+		6050=Pokaz kolumny
+		6051=Don't show column
+		6100=Slonce
+		6101=Ksiezyc
+		6102=Wielka Niedzwiedzica
+		6103=Orion
+		6104=Cassiopeia
+		6105=Cygnus
+		6126=Mimosa w Krzyzu Poludnia
+		7000=Release
+		7001=RC
+		7002=w opracowaniu, stabilna
+		7003=w opracowaniu, najnowsza
+		7010=bereits aktuell(er)
+		7011=Update available
+		7012=not available
+		7013=Blad
+		7020=Typ rekomendowanej wersji
+		7021=typ tej wersji
+		7022=Typ wersji
+		7023=Blad sciagania informacji aktualnej wersji
+		7100=Opcje portu szeregowego
+		7101=Update Ports$u
+		7102=Baud:$b
+		7103=Scan$u
+		7104=Test$t
+		7105=Przekaz dane GPS do hosta
+		7106=Wszystkie dane z GPS beda przeslane na port 23 TCP%0a i moga byc przekierowane na port szeregowy%0a przez
+		7107=Przerwa w sekundach dla logowania
+		7108=Blad: Nieudane otwarcie portu szeregowego:+
+		7109=Blad: Nie moge zyskac danych o portach szeregowych%0a
+		7110=GPS nie znaleziony%0a
+		7111=Probowanie+
+		7112= +
+		7113= - sa jakies dane%0a
+		7114=GPS Port Znaleziony%0a
+		7115= - Nie znaleziono tagu danych GPS%0a
+		7116= - nie otrzymano danych%0a
+		7117=Pokazuje dane bezposrednio z portu:%0a
+		7118=Stop
+		7119=Stop
+		7120=Anulowano
+		7121=Pobierz dane GPS z gpsd host
+		7122=Dane GPS beda pobrane z serwera gpsd, nie z portu szeregowego
+		7200=Uzytkowanie: CacheWolf [-c <path to pref.xml>] [-debug]
+		{..}
+	{..}
+{..}



From jennergruhle at mail.berlios.de  Tue Sep  8 20:09:54 2009
From: jennergruhle at mail.berlios.de (jennergruhle at mail.berlios.de)
Date: Tue, 8 Sep 2009 20:09:54 +0200
Subject: [Cachewolf-svn] r2155 - trunk/src/CacheWolf/imp
Message-ID: <200909081809.n88I9sNk016204@sheep.berlios.de>

Author: jennergruhle
Date: 2009-09-08 20:09:50 +0200 (Tue, 08 Sep 2009)
New Revision: 2155

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
Log:
selectable host list for download

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-07 13:57:36 UTC (rev 2154)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-08 18:09:50 UTC (rev 2155)
@@ -104,7 +104,7 @@
 			if (!ch.getOcCacheID().equals(""))
 				DBindexID.put(ch.getOcCacheID(), new Integer(i));
 		}//for
-
+		
 	}
 	
 	protected void setHostname(String wpName){
@@ -185,7 +185,6 @@
 		boolean success=true;
 		String finalMessage;
 
-		
 		String url = new String();
 
 		String lastS =  profile.getLast_sync_opencaching();
@@ -200,6 +199,10 @@
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
 		Vm.showWait(true);
 		String dist = importOpt.distanceInput.getText();
+		
+		if (importOpt.domains.getSelectedItem()!=null)
+			hostname = (String)importOpt.domains.getSelectedItem();
+		
 		if (dist.length()== 0) return;
 		
 		Double distDouble = new Double();

Modified: trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-09-07 13:57:36 UTC (rev 2154)
+++ trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-09-08 18:09:50 UTC (rev 2155)
@@ -26,6 +26,8 @@
 	mInput maxNumberInput;
 	mInput maxLogsInput;
 	mCheckBox imagesCheckBox, /*mapsCheckBox, */ missingCheckBox, foundCheckBox, travelbugsCheckBox;
+	ewe.ui.mChoice domains;
+
 	mLabel distLbl;
 	mLabel maxNumberLbl;
 	mLabel distUnit;
@@ -111,6 +113,14 @@
 			imagesCheckBox.setState(pref.downloadPics);
 			this.addLast(imagesCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
 		}
+
+		if((options & DIST) > 0){
+			// When distance is given (spidering), Host is also to be chosen
+			String[] hosts = new String[] {OCXMLImporter.OPENCACHING_DE_HOST, OCXMLImporter.OPENCACHING_CZ_HOST, OCXMLImporter.OPENCACHING_PL_HOST, OCXMLImporter.OPENCACHING_UK_HOST};
+			domains = new mChoice(hosts,0);
+			domains.setTextSize(25, 1);
+			this.addLast(domains, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
+		}
 		
 		if ((options & TRAVELBUGS) > 0) {
 			travelbugsCheckBox = new mCheckBox();



From araber95 at mail.berlios.de  Tue Sep  8 23:28:10 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 8 Sep 2009 23:28:10 +0200
Subject: [Cachewolf-svn] r2156 - trunk/src/CacheWolf
Message-ID: <200909082128.n88LSAs7007582@sheep.berlios.de>

Author: araber95
Date: 2009-09-08 23:27:09 +0200 (Tue, 08 Sep 2009)
New Revision: 2156

Modified:
   trunk/src/CacheWolf/ImagePanel.java
Log:
images now shown again

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2009-09-08 18:09:50 UTC (rev 2155)
+++ trunk/src/CacheWolf/ImagePanel.java	2009-09-08 21:27:09 UTC (rev 2156)
@@ -53,12 +53,12 @@
 			int rowCounter1 = 0;
 			if (cache.images.getDisplayImages(cache.getParent().getWayPoint()).size()>0) {
 				rowCounter1 = cache.images.getDisplayImages(cache.getParent().getWayPoint()).size();
-				rowCounter1 = (int) java.lang.Math.ceil(rowCounter1/3);
+				rowCounter1 = (int) java.lang.Math.ceil(rowCounter1/3)+1;
 			}
 			int rowCounter2 = 0;
 			if (cache.userImages.size()>0){
 				rowCounter2 = cache.userImages.size();
-				rowCounter2 = (int) java.lang.Math.ceil(rowCounter2/3);
+				rowCounter2 = (int) java.lang.Math.ceil(rowCounter2/3)+1;
 			}
 			int rowCounter = rowCounter1 + rowCounter2;
 			Rect r = new Rect(0, 0, pref.myAppWidth, rowCounter*thumb_size+rowCounter*padding+padding);



From araber95 at mail.berlios.de  Wed Sep  9 00:15:19 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 9 Sep 2009 00:15:19 +0200
Subject: [Cachewolf-svn] r2157 - trunk/res_noewe
Message-ID: <200909082215.n88MFJFr013428@sheep.berlios.de>

Author: araber95
Date: 2009-09-09 00:15:12 +0200 (Wed, 09 Sep 2009)
New Revision: 2157

Modified:
   trunk/res_noewe/wolflang_de.html
Log:
updated Version of t31 of 2009.09.05

Modified: trunk/res_noewe/wolflang_de.html
===================================================================
--- trunk/res_noewe/wolflang_de.html	2009-09-08 21:27:09 UTC (rev 2156)
+++ trunk/res_noewe/wolflang_de.html	2009-09-08 22:15:12 UTC (rev 2157)
@@ -1,73 +1,92 @@
-<font face="Tahoma" size = "2"><b>WolfLanguage Befehle:</b><br>
-Zeichen hinter dem # bis zum Zeilenende werden ignoriert<br>
-Mehrere Befehle in einer Zeile werden durch einem Semikolon (;) getrennt<br>
-<i>Beispiel: stop</i>   # Stoppt Skript<br>
-<i>Beispiel: cls()</i>   # Ausgabefenster l?schen<br>
-<br>
-<b><u>Grundlegende Operationen</u></b><br>
- Zuweisung:<br>
- variable = wert<br>
+<h1>WolfLanguage Befehle:</h1>
+<p>Zeichen hinter dem # bis zum Zeilenende werden ignoriert.<br>
+Mehrere Befehle in einer Zeile werden durch einem Semikolon (;) getrennt.<br>
+Fortsetzungszeilen k?nnen durch _ oder \ erzwungen werden.<br>
+<i>Beispiel: A=0; stop <font color="green"># weist A null zu stoppt das Skript</font></i><br>
+cls() <i>alias</i> clearscreen()<br>
+<i>Beispiel: cls() <font color="green"># Ausgabefenster l?schen</font></i></p>
+
+<p><b>Zuweisung:</b><br>variable = wert<br>
 <i> Beispiel: a = 2</i><br>
 <i> Beispiel: $a = 2; b="abc"</i><br>
-$a ist eine globale Variable.<br>
-Numerische Ausdr?cke formatieren:<br>
-Beispiel: 3.14159:000.00:<br>
-<i>Formatierungszeichen:</i> 0 . # wobei # f?r beliebige Ziffern steht<br> 
-<br>
-<u><b> Anzeige von Werten</b></u><br>
- "beliebiger Text" " weitere Text":<br>
-<i> Beispiel: "N 34 12." a " :das " rot13("Mvry")</i>
- +, -, *, /, (, ):<br>
-<i> Beispiel: a = 1 / 2 + 34 - 8 * 12<br>
- oder a = (1 / b + 34 - b) * 12</i><br>
-<br>
-<b><u>Wurzel, Potenz</u></b><br>
+$a ist eine globale Variable.</p>
+
+<p><b>Numerische Ausdr?cke formatieren:</b><br>
+Formatierungszeichen: 0 . # wobei # f?r beliebige Ziffern steht<br>
+<i>Beispiel: 3.14159:000.00: <font color="green"># 003.14</font></i></p>
+
+<p><b>Anzeige von Werten</b><br>
+"beliebiger Text" " weitere Text"<br>
+Operatoren: +, -, *, /, (, )<br>
+<i>Beispiel: a = 1 / 2 + 34 - 8 * 12<font color="green"> # a = -61.5</font></i><br>
+<i>Beispiel:  a = (1 / 2 + 34 - 8) * 12<font color="green"> # a = 318</font></i><br>
+<i>Beispiel: "N 34 12." a " :das " rot13("Mvry")<font color="green"> # N 34 12.318 :das Ziel</font><br></i>
+show()<br>
+<i>Beispiel:  show(a)<font color="green"> # veraltet, gibt a aus</font></i></p>
+
+<p><b>Wurzel, Potenz</b><br>
  sqrt(), ^:<br>
-<i> Beispiel: a = sqrt(2) ^ 5</i><br>
-<br>
-<b><u>Trigonometrische Funktionen</u></b><br>
- cos(), sin(), tan(),<br>
- atan(), asin(), acos():<br>
-<i> Beispiel: a = cos(90);<br>
- oder a = atan(b);</i><br>
-<u>Modus f?r trigonometrische Funktionen ?ndern</u><br>
+<i> Beispiel: a = sqrt(2) ^ 5</i><br></p>
+
+<p><b>Trigonometrische Funktionen</b><br>
+ cos(Wert), sin(Wert), tan(Wert),<br>
+ atan(Wert), asin(Wert), acos(Wert)<br>
+<i>Beispiel: a = cos(90)<br>
+Beispiel:  a = atan(b)</i><br>
+<b>Modus f?r trigonometrische Funktionen ?ndern</b><br>
  deg()<br>
  rad()<br>
-<u>Trigonometrische Konvertierungen</u><br>
- deg2rad()  <i>alias</i> d2r()<br>
- rad2deg()  <i>alias</i> r2d()<br>   
-<br>
-<b><u>Numerische Functionen</u></b><br>
-ct(number) # Quersumme (engl.: crosstotal)<br>
-q(number) # Quersumme<br><br>
-<b><u>Text Funktionen</u></b>[s is eine Zeichenkette]<br>
-length(s)<br>
+<b>Trigonometrische Konvertierungen</b><br>
+ deg2rad(Wert)  <i>alias</i> d2r()<br>
+ rad2deg(Wert)  <i>alias</i> r2d()<br>
+<b>Konstante Pi</b><br>
+Behelf durch 180 / r2d(1)<br>
+<i>Beispiel: A = r ^ 2 * 180 / r2d(1) <font color="green"># Fl?cheninhalt des Kreises</font></i></p>   
+
+<p><b>Numerische Functionen</b><br>
+ct(Wert) <i>alias</i> crosstotal(Wert), quersumme(Wert), q(Wert)<br>
+<i> Beispiel: q(123) <font color="green"># Quersumme 6</font></i><br>
+abs(Wert)<br>
+<i> Beispiel: abs(-2.7) <font color="green"># Betrag 2.7</font></i><br>
+mod(Wert,Div)<br>
+<i> Beispiel: mod(7,3) <font color="green"># Rest 1</font></i><br>
+int(Wert)<br>
+<i> Beispiel: int(-2.7) <font color="green"># Ganzzahl -2</font></i><br></p>
+
+<p><b>Text Funktionen</b> [s is eine Zeichenkette]<br>
+len(s) <i>alias</i> length(s)<br>
 mid(s,startpos,length)<br> 
 instr(s,searchStr)<br>
 instr(startpos,s,searchstr)<br>
-ucase(s)<br>
-lcase(s)<br>
+uc(s) <i>alias</i> ucase(s), touppercase(s)<br>
+lc(s) <i>alias</i> lcase(s), tolowercase(s)<br>
 replace(s,searchStr,ReplaceStr)<br>
 reverse(s)<br>
 encode(s,s1,s2)<br>
 count(s,whatStr)<br>
-val(s)<i> # A=1, B=2, ... Z=26;  Alle addieren</i><br>
-sval(s)<i> # A=1, B=2, ... Z=26</i><br>
-rot13(s)<br><br>
-<b><u>Koordinaten</u></b><br>
-bearing(coordinate1,coordinate2) # Peilung<br>
-center() # get current center<br>
+val(s)<i> <font color="green"># A=1, B=2, ... Z=26;  Alle addieren</font></i><br>
+sval(s)<i> <font color="green"># A=1, B=2, ... Z=26</font></i><br>
+rot13(s)</p>
+
+<p><b>Koordinaten</b><br>
+bearing(coordinate1,coordinate2) <font color="green"># Peilung</font><br>
+center() <font color="green"># get current center</font><br>
 center(coordinate)<br>
-cp() # get current GPS position<br>
-distance(coordinate1,coordinate2) # Abstand zwischen zwei Punkten<br>  
+<i>alias</i> zentrum(coordinate)<br>
+cp() <i>alias</i> curpos() <font color="green"># get current GPS position</font><br>
+cb(coord1,angle1,coord2,angle2)<br>
+<i>alias</i> crossbearing(coord1,angle1,coord2,angle2) <font color="green"># Kreuzpeilung</font><br>
+distance(coordinate1,coordinate2) <font color="green"># Abstand zwischen zwei Punkten</font><br>  
 format(coordinate,fmt) <br>
   <i>wobei fmt="CW" or "UTM" or "DMS" or "DD" or "DMM" or "GK"</i><br>
 goto(coordinate)<br>
 goto(coordinate,waypointname)<br>
-project(coordinate,angle,distance) # Projektion<br><br>
-<b><u>Programme f?r Multicaches generieren (mit/ohne zus?tzlichen Wegpunkten)</u></b><br>
-skeleton() # Skript-Ger?st f?r aktuellen Cache generieren<br>
-skeleton(AnzahlderStationen) # Ger?st mit Stationen generieren<br><br>
-<b><u>IF THEN ENDIF</u></b><br>
-IF bedingung THEN Anweisung ; Anweisung .... ENDIF<br><br>
-</font>
+project(coordinate,angle,distance) <font color="green"># Projektion</font></p>
+
+<p><b>Programme f?r Multicaches generieren (mit/ohne zus?tzlichen Wegpunkten)</b><br>
+skeleton() <font color="green"># Skript-Ger?st f?r aktuellen Cache generieren</font><br>
+skeleton(AnzahlderStationen) <font color="green"># Ger?st mit Stationen generieren</font></p>
+
+<p><b>IF THEN ENDIF</b><br>
+IF bedingung THEN Anweisung ; Anweisung .... ENDIF</p><br><br>
+



From pfeffer at mail.berlios.de  Wed Sep  9 01:52:03 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 01:52:03 +0200
Subject: [Cachewolf-svn] r2158 - trunk/res_noewe/webmapservices
Message-ID: <200909082352.n88Nq3Uj007951@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 01:52:01 +0200 (Wed, 09 Sep 2009)
New Revision: 2158

Modified:
   trunk/res_noewe/webmapservices/pl_t50.wms
Log:
WMS Poland T50: use old map (from 1962) if not covered by map from 1992

Modified: trunk/res_noewe/webmapservices/pl_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/pl_t50.wms	2009-09-08 22:15:12 UTC (rev 2157)
+++ trunk/res_noewe/webmapservices/pl_t50.wms	2009-09-08 23:52:01 UTC (rev 2158)
@@ -1,14 +1,20 @@
+# For a description of the file format see readme_wms.txt in the same directory
+# this file is located in
+
 TakenFromUrl:       
 GetCapabilitiesUrl: http://sdi.geoportal.gov.pl/wms_topo/wmservice.aspx?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
 Name:               pl t50 SF=1..8
-MapType:                        topo
+MapType:            topo
 MainUrl:            http://sdi.geoportal.gov.pl/wms_topo/wmservice.aspx?
 ServiceTypeUrlPart: SERVICE=WMS
 VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+
+# in comparison with GoogleEarth there seem to be a shift of about 25-30m in Warszawa
+CoordinateReferenceSystemCacheWolf: 4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326 
 #      <SRS>EPSG:2180</SRS>
 RequestUrlPart:     REQUEST=GetMap
+
 #LayersUrlPart:     LAYERS=TOPO_50_92|TOPO_50_92||
 #LayersUrlPart:     LAYERS=TOPO_50_65|TOPO_50_65||
 #LayersUrlPart:     LAYERS=TOPO_50_42|TOPO_50_42||
@@ -18,13 +24,22 @@
 #LayersUrlPart:     LAYERS=TOPO_10_65_Sytuacja|TOPO_10_65_Sytuacja||
 #LayersUrlPart:     LAYERS=TOPO_10_65_Rzezba|TOPO_10_65_Rzezba||
 #LayersUrlPart:     LAYERS=TOPO_10_42|TOPO_10_42||
-LayersUrlPart:     LAYERS=TOPO_50_92
+# the second number is the year. Unfortunately topo50 1992 looks good, 
+# but seems to cover only till about 20.17? east (Skierniewice is still covered)
+# the layers become transparent, if area / scale is not covered
+# if both layers cover the area and scale, only the last one in the list below is shown
+LayersUrlPart:     LAYERS=TOPO_50_65,TOPO_50_92
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
+
+# the GetCapabilities answer says, these layers provide only png, but jpg is
+# working well: the images are smoother and of smaller size in bytes thas png.
+ImageFormatUrlPart:FORMAT=image/jpeg
+
+# pfeffer entered here the bounding box of Poland
 BoundingBoxTopLeftWGS84: N 54.84 E 14.121686
 BoundingBoxButtomRightWGS84: N 48.9996 E 24.1488
-#BBox_Mitte: N 51.6341900499786 E 19.2912770537469
 MinScale:   1
-MaxScale:   8
+MaxScale:   11
 RecommendedScale:   5
-ImageFileExtension: .png
+
+ImageFileExtension: .jpg



From pfeffer at mail.berlios.de  Wed Sep  9 11:28:57 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 11:28:57 +0200
Subject: [Cachewolf-svn] r2159 - trunk/res_noewe/languages
Message-ID: <200909090928.n899Svom025624@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 11:28:53 +0200 (Wed, 09 Sep 2009)
New Revision: 2159

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
Log:
import from opencaching: menu item: removed ".de"

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-08 23:52:01 UTC (rev 2158)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-09 09:28:53 UTC (rev 2159)
@@ -418,7 +418,7 @@
 		1512=Wegpunkt
 		1513=Kann Karte nicht ohne g%fcltige Koordinaten anzeigen - Bitte Koordinaten als Ziel, Zentrum oder im gew%e4hlten Cache eingeben oder GPS starten
 		1514=Kann Entfernungen nicht neuberechnen, weil keine GPS-Position gesetzt ist (kein GPS-Empfang ist/war)
-		1600=Opencaching.de Download
+		1600=Opencaching Download
 		1601=max. Abstand:
 		1602=Bilder downloaden
 		1603=Karten downloaden

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-08 23:52:01 UTC (rev 2158)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-09 09:28:53 UTC (rev 2159)
@@ -31,7 +31,7 @@
 		127=Save
 		128=via Template
 		129=Import GPX
-		130=Download from opencaching.de
+		130=Download from opencaching
 		131=Spider from geocaching.com
 		132=to Explorist
 		133=Search all

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-08 23:52:01 UTC (rev 2158)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-09 09:28:53 UTC (rev 2159)
@@ -31,7 +31,7 @@
 		127=Enregistrer
 		128=par Template
 		129=Importe GPX
-		130=T%e9l%e9chargement par opencaching.de
+		130=T%e9l%e9chargement par opencaching
 		131=Spider par geocaching.com
 		132=vers Explorist
 		133=Cherche toutes

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-09-08 23:52:01 UTC (rev 2158)
+++ trunk/res_noewe/languages/NL.cfg	2009-09-09 09:28:53 UTC (rev 2159)
@@ -31,7 +31,7 @@
 		127=Opslaan
 		128=Via sjabloon
 		129=Importeren GPX
-		130=Download van opencaching.de
+		130=Download van opencaching
 		131=Werkgeheugen van geocaching.com
 		132=Naar Explorist
 		133=Allen zoeken

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-08 23:52:01 UTC (rev 2158)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-09 09:28:53 UTC (rev 2159)
@@ -31,7 +31,7 @@
                 127=Zapisz
                 128=Przez szablon
                 129=Importuj GPX
-                130=Sciagnij z opencaching.de
+                130=Sciagnij z opencaching
                 131=Sciagnij z geocaching.com
                 132=Explorist
                 133=Szukaj wszystkich



From araber95 at mail.berlios.de  Wed Sep  9 11:34:02 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 9 Sep 2009 11:34:02 +0200
Subject: [Cachewolf-svn] r2160 - trunk/res_noewe/webmapservices
Message-ID: <200909090934.n899Y2Mh025957@sheep.berlios.de>

Author: araber95
Date: 2009-09-09 11:33:57 +0200 (Wed, 09 Sep 2009)
New Revision: 2160

Added:
   trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
   trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms
Removed:
   trunk/res_noewe/webmapservices/eu_topo_osm.wms
Log:
de and eu : wms servers for osm data

Added: trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2009-09-09 09:28:53 UTC (rev 2159)
+++ trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2009-09-09 09:33:57 UTC (rev 2160)
@@ -0,0 +1,61 @@
+TakenFromUrl:       http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&
+GetCapabilitiesUrl: http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               de t SF=0..88 OSM-itc-halle
+MapType:                        topo
+MainUrl:            http://osmwms.itc-halle.de/maps/osmfree?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31466 31467 31468
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=osmwms|OpenStreetMap-WMS||
+#LayersUrlPart:     LAYERS=grenzen|Administrative Grenzen (M 1:100000000)||
+#LayersUrlPart:     LAYERS=grenzen_50000|Administrative Grenzen (M 1:50000)|0|24.9451424214819
+#LayersUrlPart:     LAYERS=grenzen_200000|Administrative Grenzen (M 1:200000)|24.9451424214819|99.7805696859274
+#LayersUrlPart:     LAYERS=grenzen_400000|Administrative Grenzen (M 1:400000)|99.7805696859274|199.561139371855
+#LayersUrlPart:     LAYERS=grenzen_100000000|Administrative Grenzen (M 1:100000000)|199.561139371855|49890.2848429637
+#LayersUrlPart:     LAYERS=flaechen|Fl?chen (M 1:100000000)||
+#LayersUrlPart:     LAYERS=flaechen_5000|Fl?chen (M 1:5000)|0|2.49451424214819
+#LayersUrlPart:     LAYERS=flaechen_20000|Fl?chen (M 1:20000)|2.49451424214819|9.97805696859274
+#LayersUrlPart:     LAYERS=flaechen_100000|Fl?chen (M 1:10000)|9.97805696859274|49.8902848429637
+#LayersUrlPart:     LAYERS=flaechen_200000|Fl?chen (M 1:200000)|49.8902848429637|99.7805696859274
+#LayersUrlPart:     LAYERS=flaechen_2000000|Fl?chen (M 1:2000000)|99.7805696859274|997.805696859274
+#LayersUrlPart:     LAYERS=flaechen_100000000|Fl?chen (M 1:100000000)|997.805696859274|49890.2848429637
+#LayersUrlPart:     LAYERS=gebaeude|Geb?ude (M1:50000)|0|24.9451424214819
+#LayersUrlPart:     LAYERS=wasser|Wasserstrassen (M 1:100000000)||
+#LayersUrlPart:     LAYERS=wasser_50000|Wasserstrassen (M 1:50000)|0|24.9451424214819
+#LayersUrlPart:     LAYERS=wasser_100000|Wasserstrassen (M 1:100000)|24.9451424214819|49.8902848429637
+#LayersUrlPart:     LAYERS=wasser_200000|Wasserstrassen (M 1:200000)|49.8902848429637|99.7805696859274
+#LayersUrlPart:     LAYERS=wasser_500000|Wasserstrassen (M 1:500000)|99.7805696859274|249.451424214819
+#LayersUrlPart:     LAYERS=wasser_1000000|Wasserstrassen (M 1:1000000)|249.451424214819|498.902848429637
+#LayersUrlPart:     LAYERS=wasser_100000000|Wasserstrassen (M 1:100000000)|498.902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=schienen|Schienenwege (M 1:1000000)||
+#LayersUrlPart:     LAYERS=rail|Bahn (M 1:1000000)|0|498.902848429637
+#LayersUrlPart:     LAYERS=sbahn|S-Bahn (M 1:50000)|0|24.9451424214819
+#LayersUrlPart:     LAYERS=ubahn|U-Bahn (M 1:20000)|0|9.97805696859274
+#LayersUrlPart:     LAYERS=tram|Strassenbahn (M 1:20000)|0|9.97805696859274
+#LayersUrlPart:     LAYERS=strassen|Strassen und Wege (M 1:100000000)||
+#LayersUrlPart:     LAYERS=strassen_br|Strassen und Wege (Br?cken M 1:10000)|0|4.98902848429637
+#LayersUrlPart:     LAYERS=strassen_20000|Strassen und Wege (M 1:20000)|0|9.97805696859274
+#LayersUrlPart:     LAYERS=strassen_50000|Strassen und Wege (M 1:50000)|9.97805696859274|24.9451424214819
+#LayersUrlPart:     LAYERS=strassen_200000|Strassen und Wege (M 1:200000)|24.9451424214819|99.7805696859274
+#LayersUrlPart:     LAYERS=strassen_400000|Strassen und Wege (M 1:400000)|99.7805696859274|199.561139371855
+#LayersUrlPart:     LAYERS=strassen_1000000|Strassen und Wege (M 1:1000000)|199.561139371855|498.902848429637
+#LayersUrlPart:     LAYERS=strassen_100000000|Strassen und Wege (M 1:100000000)|498.902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=strassen_x|Strassen und Wege (bez. M 1:200000)|0|99.7805696859274
+#LayersUrlPart:     LAYERS=power|Stromleitungen (M 1:100000)|0|498.902848429637
+#LayersUrlPart:     LAYERS=punkte|Punkte (M 1:20000)|0|9.97805696859274
+#LayersUrlPart:     LAYERS=orte|Ortsnamen (M 1:100000000)|0|49890.2848429637
+#LayersUrlPart:     LAYERS=credits|Copyright||
+LayersUrlPart:     LAYERS=osmwms
+#LayersUrlPart:     LAYERS=grenzen,grenzen_50000,grenzen_200000,grenzen_400000,grenzen_100000000,flaechen,flaechen_5000,flaechen_20000,flaechen_100000,flaechen_200000,flaechen_2000000,flaechen_100000000,gebaeude,wasser,wasser_50000,wasser_100000,wasser_200000,wasser_500000,wasser_1000000,wasser_100000000,schienen,rail,sbahn,ubahn,tram,strassen,strassen_br,strassen_20000,strassen_50000,strassen_200000,strassen_400000,strassen_1000000,strassen_100000000,strassen_x,power,orte
+#LayersUrlPart:     LAYERS=grenzen_50000,flaechen_20000,gebaeude,wasser_50000,rail,sbahn,ubahn,tram,strassen_br,strassen_20000,strassen_x,power,orte
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 55.1087 E 5.2905
+BoundingBoxButtomRightWGS84: N 47.1503 E 15.3245
+#BBox_Mitte: N 51.1295 E 10.30751
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   2,5
+ImageFileExtension: .png

Copied: trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms (from rev 2156, trunk/res_noewe/webmapservices/eu_topo_osm.wms)
===================================================================
--- trunk/res_noewe/webmapservices/eu_topo_osm.wms	2009-09-08 21:27:09 UTC (rev 2156)
+++ trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms	2009-09-09 09:33:57 UTC (rev 2160)
@@ -0,0 +1,67 @@
+TakenFromUrl:       http://osm.wheregroup.com/cgi-bin/osm_basic.xml?SERVICE=WMS&
+GetCapabilitiesUrl: http://osm.wheregroup.com/cgi-bin/osm_basic.xml?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               eu t OSM_wheregroup
+MapType:                        topo
+MainUrl:            http://osm.wheregroup.com/cgi-bin/osm_basic.xml?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=OSM_Basic|OSM_Basic||
+#LayersUrlPart:     LAYERS=Grenzen|Europa||
+#LayersUrlPart:     LAYERS=Landwirtschaft|Landwirtschaft|0|99.7805696859274
+#LayersUrlPart:     LAYERS=Industriegebiet|Industriegebiet|0|49.8902848429637
+#LayersUrlPart:     LAYERS=Bauland|Bauland|0|49.8902848429637
+#LayersUrlPart:     LAYERS=Gruenflaeche|Gruenflaeche|0|49.8902848429637
+#LayersUrlPart:     LAYERS=unkultiviertes_Land|unkultiviertes_Land|0|99.7805696859274
+#LayersUrlPart:     LAYERS=Park|Park|0|24.9451424214819
+#LayersUrlPart:     LAYERS=Naherholungsgebiet|Naherholungsgebiet|0|24.9451424214819
+#LayersUrlPart:     LAYERS=Wald|Wald/Forst|0|149.670854528891
+#LayersUrlPart:     LAYERS=Wiese|Wiese|0|149.670854528891
+#LayersUrlPart:     LAYERS=Fussgaengerzone|Fu?g?ngerzone|0|2.49451424214819
+#LayersUrlPart:     LAYERS=Gebaeude|Geb?ude|0|2.49451424214819
+#LayersUrlPart:     LAYERS=Wasser|Gewaesser|0|498.902848429637
+#LayersUrlPart:     LAYERS=Fluesse|Fluesse|0|997.805696859274
+#LayersUrlPart:     LAYERS=Baeche|Baeche|0|24.9451424214819
+#LayersUrlPart:     LAYERS=Kanal|Kanal|0|24.9451424214819
+#LayersUrlPart:     LAYERS=Wasserbecken|Wasser- und Speicherbecken|0|24.9451424214819
+#LayersUrlPart:     LAYERS=Insel|Insel|0|997.805696859274
+#LayersUrlPart:     LAYERS=Kueste|K?ste|0|997.805696859274
+#LayersUrlPart:     LAYERS=Inselpunkte|Inselpunkte|0|99.7805696859274
+#LayersUrlPart:     LAYERS=Strand|Strand|0|49.8902848429637
+#LayersUrlPart:     LAYERS=Fussgaengerweg|Fu?g?ngerwege|0|2.49451424214819
+#LayersUrlPart:     LAYERS=Radweg|Radweg|0|0.997805696859274
+#LayersUrlPart:     LAYERS=Wege|Wege|0|4.98902848429637
+#LayersUrlPart:     LAYERS=Wohnstrasse|Wohnstrasse|0|19.9561139371855
+#LayersUrlPart:     LAYERS=Zufahrtswege|Zufahrtswege|0|49.8902848429637
+#LayersUrlPart:     LAYERS=einfache_Strasse|einfache Strasse|0|49.8902848429637
+#LayersUrlPart:     LAYERS=Landstrasse|Landstrasse|0|49.8902848429637
+#LayersUrlPart:     LAYERS=Bundesstrasse|Bundesstrasse|0|199.561139371855
+#LayersUrlPart:     LAYERS=Kraftfahrstrasse|Kraftfahrstrasse|0|498.902848429637
+#LayersUrlPart:     LAYERS=Autobahn|Autobahn|0|9978.05696859274
+#LayersUrlPart:     LAYERS=Ortschaft|Ortschaft|0|39.912227874371
+#LayersUrlPart:     LAYERS=Weiler|Weiler|0|9.97805696859274
+#LayersUrlPart:     LAYERS=Stadtteil|Stadtteil|0|34.9231993900746
+#LayersUrlPart:     LAYERS=Dorf|Dorf|0|34.9231993900746
+#LayersUrlPart:     LAYERS=Stadt|Stadt|0|399.12227874371
+#LayersUrlPart:     LAYERS=Grossstadt|Grossstadt|0|7483.54272644456
+#LayersUrlPart:     LAYERS=Bahn|Bahn|0|446.518049344525
+#LayersUrlPart:     LAYERS=Bahnhof|Bahnhof|0|49.8902848429637
+#LayersUrlPart:     LAYERS=Airport|Flughafen|0|49.8902848429637
+#LayersUrlPart:     LAYERS=Kirchengelaende|Kirchengel?nde|0|9.97805696859274
+#LayersUrlPart:     LAYERS=Friedhof|Friedhof|0|19.9561139371855
+#LayersUrlPart:     LAYERS=Kirche|Kirche|0|9.97805696859274
+#LayersUrlPart:     LAYERS=Graeber|Gr?ber|0|9.97805696859274
+#LayersUrlPart:     LAYERS=copyright|Copyright||
+#LayersUrlPart:  LAYERS=Landwirtschaft,Industriegebiet,Bauland,Gruenflaeche,unkultiviertes_Land,Park,Naherholungsgebiet,Wald,Wiese,Wasser,Fluesse,Baeche,Kanal,Insel,Kueste,Strand,Fussgaengerzone,Fussgaengerweg,Radweg,Wege,Wohnstrasse,Zufahrtswege,einfache_Strasse,Landstrasse,Bundesstrasse,Kraftfahrstrasse,Autobahn,Ortschaft,Weiler,Dorf,Stadt,Grossstadt,Bahn,Bahnhof,Gebaeude
+LayersUrlPart:     LAYERS=Landwirtschaft,Industriegebiet,Bauland,Gruenflaeche,unkultiviertes_Land,Park,Naherholungsgebiet,Wald,Wiese,Fussgaengerzone,Gebaeude,Wasser,Fluesse,Baeche,Kanal,Wasserbecken,Insel,Kueste,Inselpunkte,Strand,Fussgaengerweg,Radweg,Wege,Wohnstrasse,Zufahrtswege,einfache_Strasse,Landstrasse,Bundesstrasse,Kraftfahrstrasse,Autobahn,Ortschaft,Weiler,Stadtteil,Dorf,Stadt,Grossstadt,Bahn,Bahnhof,Airport,Kirchengelaende,Friedhof,Kirche,Graeber
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 74.1000 W 10.4000
+BoundingBoxButtomRightWGS84: N 35.7000 E 43.0000
+#BBox_Mitte: N 54.9 E 16.3
+MinScale: 0.6
+MaxScale: 99.99
+RecommendedScale: 5
+ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/eu_topo_osm.wms
===================================================================
--- trunk/res_noewe/webmapservices/eu_topo_osm.wms	2009-09-09 09:28:53 UTC (rev 2159)
+++ trunk/res_noewe/webmapservices/eu_topo_osm.wms	2009-09-09 09:33:57 UTC (rev 2160)
@@ -1,20 +0,0 @@
-# de_topo_OSM.wms - Version 0.2
-TakenFromUrl: http://www.wheregroup.com/de/freier_wms_mit_openstreetmap_daten
-GetCapabilitiesUrl: http://osm.wheregroup.com/cgi-bin/mapserv?map=/data/umn/osm/osm_basic.map&REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.1.1
-Name: eu OpenStreetMap
-MainUrl:  http://osm.wheregroup.com/cgi-bin/osm_basic.xml?
-MapType:  topo
-ServiceTypeUrlPart:   SERVICE=WMS 
-VersionUrlPart:   VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf: 4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
-RequestUrlPart: REQUEST=GetMap
-LayersUrlPart:  LAYERS=Landwirtschaft,Industriegebiet,Bauland,Gruenflaeche,unkultiviertes_Land,Park,Naherholungsgebiet,Wald,Wiese,Wasser,Fluesse,Baeche,Kanal,Insel,Kueste,Strand,Fussgaengerzone,Fussgaengerweg,Radweg,Wege,Wohnstrasse,Zufahrtswege,einfache_Strasse,Landstrasse,Bundesstrasse,Kraftfahrstrasse,Autobahn,Ortschaft,Weiler,Dorf,Stadt,Grossstadt,Bahn,Bahnhof,Gebaeude
-StylesUrlPart:  STYLES=
-ImageFormatUrlPart: FORMAT=image/png
-BoundingBoxTopLeftWGS84:  N 74.1 W 10.4
-BoundingBoxButtomRightWGS84:  N 35.7 E 43.0
-MinScale: 0.6
-MaxScale: 99.99
-RecommendedScale: 5
-ImageFileExtension: .png



From pfeffer at mail.berlios.de  Wed Sep  9 12:11:32 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 12:11:32 +0200
Subject: [Cachewolf-svn] r2161 - trunk/src/CacheWolf
Message-ID: <200909091011.n89ABW8p029199@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 12:11:30 +0200 (Wed, 09 Sep 2009)
New Revision: 2161

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
Cachholder: do not create an cacheholder detail if it is not needed

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-09 09:33:57 UTC (rev 2160)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-09 10:11:30 UTC (rev 2161)
@@ -519,7 +519,7 @@
 			// are already loaded. When they aren't loaded, then we assume
 			// that there is no change, so nothing to do.
 			if (this.detailsLoaded()) {
-				CacheHolderDetail chD = getCacheDetails(true, false);
+				CacheHolderDetail chD = getCacheDetails(false, false);
 				if (chD != null) {
 					chD.CacheLogs.calcRecommendations();
 					recommendationScore = chD.CacheLogs.recommendationRating;
@@ -700,7 +700,7 @@
 						(new MessageBox(MyLocale.getMsg(31415,"Error"), MyLocale.getMsg(31415, "Could not read cache details for cache: ")
 						        + this.getWayPoint(), FormBase.OKB)).execute();
 					} else {
-						Global.getPref().log("Could not read details for waypoint " + getWayPoint());
+				//		Global.getPref().log("Could not read details for waypoint " + getWayPoint());
 					}
 					details = null;
 					this.setIncomplete(true);
@@ -744,7 +744,8 @@
 	 */
 	public void save() {
 		checkIncomplete();
-		this.getFreshDetails().saveCacheDetails(Global.getProfile().dataDir);
+		CacheHolderDetail chD = getCacheDetails(false, false);
+		if (chD != null) chD.saveCacheDetails(Global.getProfile().dataDir);
 	}
 	
 	void releaseCacheDetails() {



From pfeffer at mail.berlios.de  Wed Sep  9 12:14:43 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 12:14:43 +0200
Subject: [Cachewolf-svn] r2162 - trunk/src/CacheWolf
Message-ID: <200909091014.n89AEh50029451@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 12:14:41 +0200 (Wed, 09 Sep 2009)
New Revision: 2162

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
revoke part of the last commit: write an <waypoint>.xml file even if there are no cache details

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-09 10:11:30 UTC (rev 2161)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-09 10:14:41 UTC (rev 2162)
@@ -744,8 +744,7 @@
 	 */
 	public void save() {
 		checkIncomplete();
-		CacheHolderDetail chD = getCacheDetails(false, false);
-		if (chD != null) chD.saveCacheDetails(Global.getProfile().dataDir);
+		this.getFreshDetails().saveCacheDetails(Global.getProfile().dataDir);
 	}
 	
 	void releaseCacheDetails() {



From pfeffer at mail.berlios.de  Wed Sep  9 13:28:10 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 13:28:10 +0200
Subject: [Cachewolf-svn] r2163 - in trunk: res_noewe/languages src/CacheWolf
	src/CacheWolf/imp
Message-ID: <200909091128.n89BSAsj005224@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 13:28:05 +0200 (Wed, 09 Sep 2009)
New Revision: 2163

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/imp/LOCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
opencaching remove ".de" was not complete
opencaching download: bug fixed: <waypoint>.xml were not created at first download. In order to solve this problem, Cacheholder.CachesWithLoadedDetails now again holds a vector of the Cacheholders directly, not a list of waypoint names, see http://www.geoclub.de/viewtopic.php?f=40&t=33289&start=20 for details

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -31,7 +31,7 @@
 		127=Speichern
 		128=%fcber Template
 		129=Importiere GPX
-		130=Download von opencaching.de
+		130=Download von opencaching
 		131=Spider von geocaching.com
 		132=nach Explorist
 		133=Suche alle
@@ -418,7 +418,7 @@
 		1512=Wegpunkt
 		1513=Kann Karte nicht ohne g%fcltige Koordinaten anzeigen - Bitte Koordinaten als Ziel, Zentrum oder im gew%e4hlten Cache eingeben oder GPS starten
 		1514=Kann Entfernungen nicht neuberechnen, weil keine GPS-Position gesetzt ist (kein GPS-Empfang ist/war)
-		1600=Opencaching Download
+		1600=+Download
 		1601=max. Abstand:
 		1602=Bilder downloaden
 		1603=Karten downloaden

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -418,7 +418,7 @@
 		1512=Waypoint
 		1513=Cannot start moving map without valid coordinates. Please enter coordinates as destination as center or in selected cache, or start GPS
 		1514=Cannot recalculate distances, because the GPS position is not set
-		1600=Opencahing.de Download
+		1600=+Download
 		1601=Distance:
 		1602=Download images
 		1603=Download maps

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -406,7 +406,7 @@
 		1511=Ne peut pas interpr%e9ter les donn%e9es du GPS%0aCauses possibles:%0aMauvais Port,%0amauvais baud,%0apas de protocole NMEA%0aConnexion ferm%e9e%0aDerni%e8re cha%eene de lettres:%0a
 		1512=Waypoint
 		1513=Ne peut pas afficher carte sans coordonn%e9es valides - Merci d'entrer coordonn%e9es comme destination, centre ou dans le cache choisi et d%e9marrer GPS
-		1600=T%e9l%e9chargement Opencaching.de
+		1600=+T%e9l%e9chargement
 		1601=Distance maximum:
 		1602=T%e9l%e9charger images
 		1603=T%e9l%e9charger cartes

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/NL.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -371,7 +371,7 @@
 		1512=Wegpunt
 		1513=Kan moving map niet draaien zonder geldige co%f6rdinaten. Geef Centrums- of Doelco%f6rdinaten of start het GPS AUB.
 		1514=Kan afstanden niet opnieuw berekenen doordat er geen GPS positie gegeven is (geen receptie is/was)
-		1600=Download van Opencaching.de
+		1600=+Download
 		1601=Afstand:
 		1602=Download afbeeldingen
 		1603=Download kaarten

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -418,7 +418,7 @@
                 1512=Waypoint
                 1513=Nie mozna poruszac mapy bez prawidlowych wspolrzednych.%0a Prosze Wprowadz Wspolrzedne srodka %0alub na wybrana skrzynke, lub pozycja GPS
                 1514=Nie mo?na przeliczyc odleglosci, pozycja GPS nie ustawiona
-                1600=Opencahing.de Download
+                1600=+Download
                 1601=Odleglosc:
                 1602=Sciagnij obrazki
                 1603=Sciagnij mapy

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-09 11:28:05 UTC (rev 2163)
@@ -708,10 +708,11 @@
 			}
 			if (details != null
 					  // for importing/spidering reasons helper objects with same waypoint are created
-					&& !cachesWithLoadedDetails.contains(this.getWayPoint())
+					&& !cachesWithLoadedDetails.contains(this)
 					  // helper objects may have empty waypoint
-					&& !this.getWayPoint().equals(CacheHolder.EMPTY)) {
-				cachesWithLoadedDetails.add(this.getWayPoint());
+					//&& !this.getWayPoint().equals(CacheHolder.EMPTY)
+					) {
+				cachesWithLoadedDetails.add(this);
 				if (cachesWithLoadedDetails.size() >= Global.getPref().maxDetails) removeOldestDetails();
 			}
 		}
@@ -752,24 +753,28 @@
 			details.saveCacheDetails(Global.getProfile().dataDir);
 		}
 		details = null;
-		cachesWithLoadedDetails.remove(this.getWayPoint());
+		cachesWithLoadedDetails.remove(this);
 	}
 
 	//final static int maxDetails = 50; 
 	static Vector cachesWithLoadedDetails = new Vector(Global.getPref().maxDetails);
 
 	public static void removeOldestDetails() {
+		CacheHolder ch;
 		for (int i=0; i<Global.getPref().deleteDetails; i++) {
-			String wp = (String) cachesWithLoadedDetails.get(i);
-			CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+//			String wp = (String) cachesWithLoadedDetails.get(i);
+	//		CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+			ch = (CacheHolder) cachesWithLoadedDetails.get(i);
 			if (ch!=null) ch.releaseCacheDetails();
 		}	
 	}
 
 	public static void removeAllDetails() {
+		CacheHolder ch;
 		for (int i=cachesWithLoadedDetails.size()-1; i>=0; i--) {
-			String wp = (String) cachesWithLoadedDetails.get(i);
-			CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+			// String wp = (String) cachesWithLoadedDetails.get(i);
+			// CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+			ch = (CacheHolder) cachesWithLoadedDetails.get(i);
 			if (ch!=null && ch.detailsLoaded()) ch.releaseCacheDetails();
 		}
 	}
@@ -782,8 +787,9 @@
 		CacheHolder ch;
 		CacheHolderDetail chD;
 		for (int i=cachesWithLoadedDetails.size()-1; i>=0; i--) {
-			String wp = (String) cachesWithLoadedDetails.get(i);
-			ch = Global.getProfile().cacheDB.get(wp);
+//			String wp = (String) cachesWithLoadedDetails.get(i);
+//			ch = Global.getProfile().cacheDB.get(wp);
+			ch = (CacheHolder) cachesWithLoadedDetails.get(i);
 			if (ch != null) {
 	            chD = ch.getExistingDetails();
 	            if (chD!=null && chD.hasUnsavedChanges) {

Modified: trunk/src/CacheWolf/imp/LOCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/LOCXMLImporter.java	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/src/CacheWolf/imp/LOCXMLImporter.java	2009-09-09 11:28:05 UTC (rev 2163)
@@ -26,7 +26,6 @@
 
 package CacheWolf.imp;
 
-//TODO: move to CacheWOlf.imp
 
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 11:28:05 UTC (rev 2163)
@@ -64,7 +64,7 @@
 	boolean debugGPX = false;
 	CacheDB cacheDB;
 	InfoBox inf;
-	CacheHolder ch;
+	//CacheHolder ch;
 	CacheHolder holder;
 	Preferences pref;
 	Profile profile;
@@ -99,6 +99,7 @@
 			incUpdate = false;
 		}
 		user = p.myAlias.toLowerCase();
+		CacheHolder ch;
 		for(int i = 0; i<cacheDB.size();i++){
 			ch = cacheDB.get(i);
 			if (!ch.getOcCacheID().equals(""))
@@ -128,9 +129,10 @@
 	 * @return true, if some change was made to the cacheDB
 	 */
 	public boolean syncSingle(int number, InfoBox infB) {
+		CacheHolder ch;
 		ch = cacheDB.get(number);
+		setHostname(ch.getWayPoint());
 		holder= null; //new CacheHolderDetail(ch); //TODO is this still correct? use getDetails ?
-		setHostname(ch.getWayPoint());
 
 		if (infB.isClosed) {
 			if (askForOptions) return false; 
@@ -139,7 +141,7 @@
 		
 		if (askForOptions) {
 			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( 
-				MyLocale.getMsg(1600, hostname + " Download"),OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL);
+					hostname + MyLocale.getMsg(1600, " Download"),OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL);
 			if (importOpt.execute() == FormBase.IDCANCEL) {	return false; }
 			askForOptions = false;
 			reload = importOpt.missingCheckBox.getState();
@@ -193,7 +195,6 @@
 			(new MessageBox("Error", "Coordinates for centre must be set", FormBase.OKB)).execute();
 			return;
 		}
-		setHostname(ch.getWayPoint());
 		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, hostname + " Download"),
 																 OCXMLImporterScreen.ALL | OCXMLImporterScreen.DIST | OCXMLImporterScreen.IMAGES);
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
@@ -217,6 +218,7 @@
 		}
 		profile.setDistOC(dist);
 		// Clear status of caches in db
+		CacheHolder ch;
 		for(int i = cacheDB.size()-1; i>=0 ;i--){
 			ch = cacheDB.get(i);
 			ch.setUpdated(false);
@@ -316,7 +318,7 @@
 			if (holder != null)	finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: "+ holder.getWayPoint();
 			else finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: <unkown>";
 			success = false;
-			Vm.debug("Parse error: " + state + " Exception:" + e.toString()+"   "+holder.getOcCacheID());
+			//Vm.debug("Parse error: " + state + " Exception:" + e.toString()+"   "+holder.getOcCacheID());
 			e.printStackTrace();
 		} finally {
 			if (tmpFile != null) tmpFile.delete();
@@ -470,8 +472,8 @@
 	}
 
 	// TODO Do we have to release the "holder" cache details ?
+	// for details see: http://www.geoclub.de/viewtopic.php?f=40&t=33289
 	private void endCache(String name){
-		setHostname(ch.getWayPoint());
 		if (name.equals("cache")){
 			holder.setLastSync(dateOfthisSync.format("yyyyMMddHHmmss"));
 			int index;
@@ -616,7 +618,6 @@
 	}
 	
 	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs
-		setHostname(ch.getWayPoint());
 		try {
 			//TODO this is not quite correct: actually the "base" URL must be known... 
 			// but anyway a different baseURL should not happen very often  - it doesn't in my area



From pfeffer at mail.berlios.de  Wed Sep  9 13:29:22 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 13:29:22 +0200
Subject: [Cachewolf-svn] r2164 - trunk
Message-ID: <200909091129.n89BTMEJ007789@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 13:29:20 +0200 (Wed, 09 Sep 2009)
New Revision: 2164

Modified:
   trunk/buildexe.bat
Log:
buildexe.bat: automatically switch to the dir it is in -> make it possible to run it by double clicking in eclipse

Modified: trunk/buildexe.bat
===================================================================
--- trunk/buildexe.bat	2009-09-09 11:28:05 UTC (rev 2163)
+++ trunk/buildexe.bat	2009-09-09 11:29:20 UTC (rev 2164)
@@ -1,6 +1,6 @@
 cd %~d0%~p0
 call getres.bat
-java -cp lib/ewe.jar Ewe programs/Jewel.ewe -c cw-pda.jnf
+rem java -cp lib/ewe.jar Ewe programs/Jewel.ewe -c cw-pda.jnf
 java -cp lib/ewe.jar Ewe programs/Jewel.ewe -c cw-pc.jnf
 REM Dont change the order above because the PC version has to overwrite the PDA version of the EWE-file
-pause
+rem pause



From pfeffer at mail.berlios.de  Wed Sep  9 13:38:11 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 13:38:11 +0200
Subject: [Cachewolf-svn] r2165 - trunk/src/CacheWolf
Message-ID: <200909091138.n89BcB62021446@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 13:38:10 +0200 (Wed, 09 Sep 2009)
New Revision: 2165

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
opencaching.pl: bug fixed: Pattern (OP) now recognized to an opencaching waypoint

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-09 11:29:20 UTC (rev 2164)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-09 11:38:10 UTC (rev 2165)
@@ -597,7 +597,7 @@
 		String pattern = wpName.toUpperCase();
 		return pattern.startsWith( OCXMLImporter.OPENCACHING_CZ_PATTERN )
 				|| pattern.startsWith( OCXMLImporter.OPENCACHING_DE_PATTERN )
-				//|| pattern.startsWith( OCXMLImporter.OPENCACHING_PL_PATTERN )
+				|| pattern.startsWith( OCXMLImporter.OPENCACHING_PL_PATTERN )
 				|| pattern.startsWith( OCXMLImporter.OPENCACHING_UK_PATTERN );
 	}
 



From pfeffer at mail.berlios.de  Wed Sep  9 14:37:34 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 14:37:34 +0200
Subject: [Cachewolf-svn] r2166 - trunk
Message-ID: <200909091237.n89CbYab025898@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 14:37:33 +0200 (Wed, 09 Sep 2009)
New Revision: 2166

Modified:
   trunk/buildexe.bat
Log:
revoke last commit: didn't want to commit my local changes

Modified: trunk/buildexe.bat
===================================================================
--- trunk/buildexe.bat	2009-09-09 11:38:10 UTC (rev 2165)
+++ trunk/buildexe.bat	2009-09-09 12:37:33 UTC (rev 2166)
@@ -1,6 +1,6 @@
 cd %~d0%~p0
 call getres.bat
-rem java -cp lib/ewe.jar Ewe programs/Jewel.ewe -c cw-pda.jnf
+java -cp lib/ewe.jar Ewe programs/Jewel.ewe -c cw-pda.jnf
 java -cp lib/ewe.jar Ewe programs/Jewel.ewe -c cw-pc.jnf
 REM Dont change the order above because the PC version has to overwrite the PDA version of the EWE-file
 rem pause



From pfeffer at mail.berlios.de  Wed Sep  9 14:59:29 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 14:59:29 +0200
Subject: [Cachewolf-svn] r2167 - trunk/src/CacheWolf
Message-ID: <200909091259.n89CxTFP027726@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 14:59:27 +0200 (Wed, 09 Sep 2009)
New Revision: 2167

Modified:
   trunk/src/CacheWolf/SafeXML.java
Log:
SafeXML: fixed a bug: the XML defined entities "&quot" etc. were not interpreted because of a misspelling

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2009-09-09 12:37:33 UTC (rev 2166)
+++ trunk/src/CacheWolf/SafeXML.java	2009-09-09 12:59:27 UTC (rev 2167)
@@ -502,14 +502,14 @@
 					dst.append(ch);
 				} else {
 					/* yes - string value */
-					StringBuffer tconv = new StringBuffer("#");
+					StringBuffer tconv = new StringBuffer("&");
 					String tc;
 
 					do {
 						tconv.append(tmp[i]);
 					} while (tmp[i++] != ';');
 
-					if ((tc = (String)iso2htmlMappings.get(tconv)) == null)
+					if ((tc = (String)iso2htmlMappings.get(tconv.toString())) == null)
 						/* invalid entity, just retain it */
 						dst.append(tconv);
 					else



From pfeffer at mail.berlios.de  Wed Sep  9 16:15:34 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 16:15:34 +0200
Subject: [Cachewolf-svn] r2168 - trunk/src/CacheWolf
Message-ID: <200909091415.n89EFYie002462@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 16:15:29 +0200 (Wed, 09 Sep 2009)
New Revision: 2168

Modified:
   trunk/src/CacheWolf/SafeXML.java
Log:
SafeXML: make cleanback learn to cleanback any &#<number>, not only listed ones

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2009-09-09 12:59:27 UTC (rev 2167)
+++ trunk/src/CacheWolf/SafeXML.java	2009-09-09 14:15:29 UTC (rev 2168)
@@ -278,14 +278,7 @@
 						indexStart = alternativeStart;
 					} else {
 						String entity = htmlString.substring( indexStart, indexEnd + 1);
-						String isoCharacter = (String) iso2htmlMappings.get( entity);
-						if (isoCharacter != null) {
-							// insert iso character instead of html entity
-							isoBuffer.append( isoCharacter);
-						} else {
-							// illegal entity detected, ignore gracefully
-							isoBuffer.append( entity);
-						}
+						appendEntityAsIsoChar(entity, isoBuffer); 
 						indexStart = htmlString.indexOf( ENTITY_START, indexEnd + 1);
 						if (indexStart >= 0) {
 							// another entity start detected, flush the html string inbetween
@@ -308,6 +301,30 @@
 		}
 	}
 
+	protected static void appendEntityAsIsoChar(String entity, StringBuffer addto) {
+		if (entity.startsWith("&#")) {
+			try{
+				if (entity.charAt(2)== 'x' || entity.charAt(2) == 'X') // number in hexadecimal // not tested because I don't have an XML containing hexadecimal encodings
+					addto.append((char)Integer.parseInt(entity.substring(2, entity.length()-1), 16)); 
+				else // number is decimal
+					addto.append((char)Integer.parseInt(entity.substring(2, entity.length()-1)));
+			} catch (NumberFormatException e) {
+				addto.append(entity); // not a valid number, insert original text
+			}
+
+		} // number format exception
+		else { // entity with a name like "&quot"						
+			String isoCharacter = (String) iso2htmlMappings.get(entity);
+			if (isoCharacter != null) {
+				// insert iso character instead of html entity
+				addto.append(isoCharacter);
+			} else {
+				// illegal entity detected, ignore gracefully
+				addto.append(entity);
+			}
+		}
+	}
+	
 	/**
      * convert a single char to its equivalent HTML entity. Ordinary chars are
      * not changed. 160 -> &nbsp;



From pfeffer at mail.berlios.de  Wed Sep  9 18:42:32 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 18:42:32 +0200
Subject: [Cachewolf-svn] r2169 - trunk/src/CacheWolf
Message-ID: <200909091642.n89GgWqL029036@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 18:42:13 +0200 (Wed, 09 Sep 2009)
New Revision: 2169

Modified:
   trunk/src/CacheWolf/Log.java
Log:
Log: corrected an old mistyping without real consequences

Modified: trunk/src/CacheWolf/Log.java
===================================================================
--- trunk/src/CacheWolf/Log.java	2009-09-09 14:15:29 UTC (rev 2168)
+++ trunk/src/CacheWolf/Log.java	2009-09-09 16:42:13 UTC (rev 2169)
@@ -111,7 +111,7 @@
 			s.append("RECOMMENDED=\"1\"");
 		s.append("<![CDATA[");
 		s.append(toHtml());
-		s.append("]]>)");
+		s.append("]]>");
 		s.append("</LOG>\r\n");
 		return s.toString();
 	}



From pfeffer at mail.berlios.de  Wed Sep  9 20:09:28 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 20:09:28 +0200
Subject: [Cachewolf-svn] r2170 - trunk/src/CacheWolf/imp
Message-ID: <200909091809.n89I9SYV018649@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 20:09:27 +0200 (Wed, 09 Sep 2009)
New Revision: 2170

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
Opencaching download importer: show different languages if provided in the description and hints

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 16:42:13 UTC (rev 2169)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 18:09:27 UTC (rev 2170)
@@ -72,7 +72,6 @@
 	String strData = new String();
 	int picCnt;
 	boolean incUpdate = true; // complete or incremental Update
-	boolean ignoreDesc = false;
 	boolean askForOptions = true;
 	Hashtable DBindexID = new Hashtable();
 
@@ -85,9 +84,12 @@
 	boolean loggerRecommended;
 	int logtype;
 	String user;
+
+	/** Temporarly save the values from XML */
 	double longitude;
+	/** Temporarly save the values from XML: set to the language of the description which is currently parsed */
+	String processingDescLang;
 
-
 	public OCXMLImporter(Preferences p,Profile prof)
 	{
 		pref = p;
@@ -427,19 +429,18 @@
 
 	}
 	
+
 	private void startCacheDesc(String name, AttributeList atts){
 		inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported);
 		if (name.equals("cachedesc")){
-			ignoreDesc = false;
 		}
 
 		if (name.equals("desc")){
 			holder.setHTML(atts.getValue("html").equals("1")?true:false);
 		}
-
-		if (name.equals("language") && !atts.getValue("id").equals("DE")){
-			if (holder.getFreshDetails().LongDescription.length()> 0) ignoreDesc = true; // TODO "DE" in preferences adjustable
-			else ignoreDesc = false;
+		
+		if (name.equals("language")) {
+			processingDescLang = atts.getValue("id");
 		}
 	}
 
@@ -471,8 +472,6 @@
 		}
 	}
 
-	// TODO Do we have to release the "holder" cache details ?
-	// for details see: http://www.geoclub.de/viewtopic.php?f=40&t=33289
 	private void endCache(String name){
 		if (name.equals("cache")){
 			holder.setLastSync(dateOfthisSync.format("yyyyMMddHHmmss"));
@@ -550,66 +549,71 @@
 	}
 
 	private void endCacheDesc(String name){
-
-		if (!ignoreDesc){
-			if (name.equals("cachedesc")){
-				if (pref.downloadPics && holder.is_HTML()) {
-					String fetchUrl, imgTag, imgAltText;
-					Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enthlt keine Anfhrungszeichen
-					Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
-					imgRegexAlt.setIgnoreCase(true);
-					imgRegexUrl.setIgnoreCase(true);
-					int descIndex=0;
-					int numDownloaded=1;
-					while (imgRegexUrl.searchFrom(holder.getFreshDetails().LongDescription, descIndex)) { // "img" found
-						imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte <img ...>-tag
-						fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen 
-						if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
-						if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
-							inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+holder.getWayPoint()));
-							continue;
-						}
-						inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported + "\n"+MyLocale.getMsg(1620, "downloading embedded images: ") + numDownloaded++);
-						if (imgRegexAlt.search(imgTag)) {
-							imgAltText=imgRegexAlt.stringMatched(1);
-							if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
-							// kein alternativer Text als Bildberschrift -> Dateiname
-						} else { 
-							if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend 
-								imgAltText = new String("No image title");
-							else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf("/")+1);
-						}
-						descIndex = imgRegexUrl.matchedTo();
-						getPic(fetchUrl, imgAltText);
+		if (name.equals("cachedesc")){
+			if (pref.downloadPics && holder.is_HTML()) {
+				String fetchUrl, imgTag, imgAltText;
+				Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enthlt keine Anfhrungszeichen
+				Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
+				imgRegexAlt.setIgnoreCase(true);
+				imgRegexUrl.setIgnoreCase(true);
+				int descIndex=0;
+				int numDownloaded=1;
+				while (imgRegexUrl.searchFrom(holder.getFreshDetails().LongDescription, descIndex)) { // "img" found
+					imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte <img ...>-tag
+					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen 
+					if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
+					if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
+						inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+holder.getWayPoint()));
+						continue;
 					}
+					inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported + "\n"+MyLocale.getMsg(1620, "downloading embedded images: ") + numDownloaded++);
+					if (imgRegexAlt.search(imgTag)) {
+						imgAltText=imgRegexAlt.stringMatched(1);
+						if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
+						// no alternative text as image title -> use filename
+					} else { 
+						if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend 
+							imgAltText = new String("No image title");
+						else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf("/")+1);
+					}
+					descIndex = imgRegexUrl.matchedTo();
+					getPic(fetchUrl, imgAltText);
 				}
-				holder.getFreshDetails().hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
-				return;
 			}
+			holder.getFreshDetails().hasUnsavedChanges = true;
+			return;
+		}
 
 
-			if (name.equals("cacheid")){
-				// load cachedata
-				holder = getHolder(strData);
-				holder.setUpdated(true);
-				return;
-			}
+		if (name.equals("cacheid")){
+			// load cachedata
+			holder = getHolder(strData);
+			return;
+		}
 
-			if (name.equals("shortdesc")){
-				holder.getFreshDetails().LongDescription = strData;
-				return;
-			}
+		if (name.equals("shortdesc")){
+			String linebraek; 
 
-			if (name.equals("desc")){ // </desc>
-				if (holder.is_HTML())	holder.getFreshDetails().LongDescription +=SafeXML.cleanback(strData);
-				else holder.getFreshDetails().LongDescription +=strData;
-				return;
-			}
-			if (name.equals("hint")){
-				holder.getFreshDetails().Hints = Common.rot13(strData);
-				return;
-			}
+			if (holder.is_HTML())	linebraek = "<br>\n";
+			else 					linebraek = "\n";
+
+			if (holder.is_updated())	holder.getFreshDetails().LongDescription += linebraek + processingDescLang + ":" +  linebraek + strData; // if a long description is already updated, then this one is likely to be in another language
+			else 					 	holder.getFreshDetails().LongDescription =              processingDescLang + ":" +  linebraek + strData; 
+			return;
 		}
+
+		if (name.equals("desc")){ // </desc>
+			if (holder.is_HTML())	holder.getFreshDetails().LongDescription +=SafeXML.cleanback(strData);
+			else holder.getFreshDetails().LongDescription +=strData;
+			return;
+		}
+		if (name.equals("hint")){
+			if (holder.is_updated()) 	
+				holder.getFreshDetails().Hints += "\n" +  processingDescLang + ": " + Common.rot13(strData);
+			else						holder.getFreshDetails().Hints = Common.rot13(strData);
+			holder.setUpdated(true); // remark: this is used in "shortdesc" to decide weather the description should be appended or replaced
+			return;
+		}
 	}
 
 	private String createPicFilename(String fetchURL) {



From pfeffer at mail.berlios.de  Wed Sep  9 21:58:08 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Sep 2009 21:58:08 +0200
Subject: [Cachewolf-svn] r2171 - trunk/src/CacheWolf/imp
Message-ID: <200909091958.n89Jw8RJ004059@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-09 21:58:06 +0200 (Wed, 09 Sep 2009)
New Revision: 2171

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
Log:
Spider Options: don't show opencaching host option

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 18:09:27 UTC (rev 2170)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 19:58:06 UTC (rev 2171)
@@ -198,7 +198,8 @@
 			return;
 		}
 		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, hostname + " Download"),
-																 OCXMLImporterScreen.ALL | OCXMLImporterScreen.DIST | OCXMLImporterScreen.IMAGES);
+																 OCXMLImporterScreen.ALL | OCXMLImporterScreen.DIST | OCXMLImporterScreen.IMAGES
+																 | OCXMLImporterScreen.HOST);
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
 		Vm.showWait(true);
 		String dist = importOpt.distanceInput.getText();

Modified: trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-09-09 18:09:27 UTC (rev 2170)
+++ trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-09-09 19:58:06 UTC (rev 2171)
@@ -32,15 +32,16 @@
 	mLabel maxNumberLbl;
 	mLabel distUnit;
 	boolean isGC = true;
-	static int DIST = 1;
-	public static int IMAGES = 2;
-	static int ALL = 4;
-	static int INCLUDEFOUND = 8;
-	static int ISGC = 16;
-	static int MAXNUMBER = 32;
-	public static int TRAVELBUGS = 64;
-	public static int MAXLOGS = 128;
-	static int TYPE = 256;
+	public static final int DIST = 1;
+	public static final int IMAGES = 2;
+	public static final int ALL = 4;
+	public static final int INCLUDEFOUND = 8;
+	public static final int ISGC = 16;
+	public static final int MAXNUMBER = 32;
+	public static final int TRAVELBUGS = 64;
+	public static final int MAXLOGS = 128;
+	public static final int TYPE = 256;
+	public static final int HOST = 512;
 
 	
 	public OCXMLImporterScreen(String title, int options) {
@@ -51,6 +52,13 @@
 		
 		this.title = title;
 				
+		if((options & HOST) > 0){
+			String[] hosts = new String[] {OCXMLImporter.OPENCACHING_DE_HOST, OCXMLImporter.OPENCACHING_CZ_HOST, OCXMLImporter.OPENCACHING_PL_HOST, OCXMLImporter.OPENCACHING_UK_HOST};
+			domains = new mChoice(hosts,0);
+			domains.setTextSize(25, 1);
+			this.addLast(domains, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
+		}
+		
 		if ((options & TYPE) > 0) {
 			this.addLast( chcType = new mChoice(new String[] {
 					MyLocale.getMsg(1627,"All caches"),	
@@ -114,14 +122,6 @@
 			this.addLast(imagesCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
 		}
 
-		if((options & DIST) > 0){
-			// When distance is given (spidering), Host is also to be chosen
-			String[] hosts = new String[] {OCXMLImporter.OPENCACHING_DE_HOST, OCXMLImporter.OPENCACHING_CZ_HOST, OCXMLImporter.OPENCACHING_PL_HOST, OCXMLImporter.OPENCACHING_UK_HOST};
-			domains = new mChoice(hosts,0);
-			domains.setTextSize(25, 1);
-			this.addLast(domains, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
-		}
-		
 		if ((options & TRAVELBUGS) > 0) {
 			travelbugsCheckBox = new mCheckBox();
 			travelbugsCheckBox.setText(MyLocale.getMsg(1625,"Download TBs"));



From pfeffer at mail.berlios.de  Thu Sep 10 02:11:13 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 10 Sep 2009 02:11:13 +0200
Subject: [Cachewolf-svn] r2172 - trunk/src/CacheWolf
Message-ID: <200909100011.n8A0BDgf010039@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-10 02:11:11 +0200 (Thu, 10 Sep 2009)
New Revision: 2172

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
preferences: try to set some usefull standards automatically

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-09 19:58:06 UTC (rev 2171)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-10 00:11:11 UTC (rev 2172)
@@ -108,8 +108,6 @@
 			}
 		} else
 			fontSize = 11;
-		
-
 	}
 
     //////////////////////////////////////////////////////////////////////////////////////
@@ -283,6 +281,7 @@
 			r.close();
 		}catch(IOException e){
 			log("IOException reading config file: " + pathToConfigFile, e, true);
+			browser = getDefaultBrowser();
 			(new MessageBox(MyLocale.getMsg(327, "Information"), MyLocale.getMsg(176, "First start - using default preferences \n For experts only: \n Could not read preferences file:\n") + pathToConfigFile, FormBase.OKB)).execute();
 		}catch(Exception e){
 			if (e instanceof NullPointerException)
@@ -294,6 +293,42 @@
 		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
 	}
 
+/**
+ * Tries to find a executable browser
+ * return "" if no browser found
+ * @return
+ */
+	private String getDefaultBrowser() {
+		String pf = Vm.getPlatform();
+		String testlist[] = null;
+		if (pf.equals("Java") || pf.equals("Win32")) {
+			String progdir = Vm.getenv("ProgramFiles", null); // at least in java-Win XP this is set
+			if (progdir != null) {
+				String test[] = {
+						progdir+"/Firefox/firefox.exe",
+						progdir+"/Opera/opera.exe",
+						progdir+"/Internet Explorer/iexplore.exe"};
+				testlist = test;
+			} else {
+				String test[] = { // this part is not tested
+						"/opt/firefox/firefox", // default path in ubuntu
+						"/usr/bin/firefox"};
+				testlist = test;
+			}
+		}
+		if (pf.equals("WinCE")) {
+			String test[] = {"/windows/iexplore.exe"};
+			testlist = test;
+		}
+		if (testlist != null) {
+			for (int i=0; i < testlist.length; i++)
+				if ((new FileBugfix(testlist[i])).exists()) { 
+					return testlist[i]; 
+				}
+		}
+		return "";
+	}
+
 	/** Helper variables for XML parser */
 	private StringBuffer collectElement=null;
 	private String lastName; // The string to the last XML that was processed
@@ -301,11 +336,15 @@
 	/**
 	 * Method that gets called when a new element has been identified in pref.xml
 	 */
+	
 	public void startElement(String name, AttributeList atts){
 		//Vm.debug("name = "+name);
 		lastName=name;
 		String tmp;
-		if(name.equals("browser")) browser = atts.getValue("name");
+		if(name.equals("browser")) {
+			browser = atts.getValue("name");
+			if (browser == null || browser.length() == 0) browser = getDefaultBrowser();
+		}
 		else if(name.equals("fixedsip")) {
 			if(atts.getValue("state").equals("true")) {
 				fixSIP = true;
@@ -724,6 +763,22 @@
 	static protected final int PROFILE_SELECTOR_ONOROFF=2;
 
 	/**
+	 * tries to get the home data dir of the user
+	 * e.g. "c:\documents and...\<user>\my documents" or "/home/<user>" in linux 
+	 * if none could be identified, "/" is returned.
+	 * @return
+	 */
+	public String getHomeDir() {
+		String test;
+		test = Vm.getenv("HOMEDRIVE", ""); // returns in java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application data>
+		log("Vm.getenv(HOMEDRIVE: " + test); // this works also in win32.exe (ewe-vm on win xp)
+		test += Vm.getenv("HOMEPATH", ""); // returns in java-vm on win xp: c:\<dokumente und Einstellungen>\<username>\<application data>
+		log("Vm.getenv(HOMEPATH: " + test); // this works also in win32.exe (ewe-vm on win xp)
+		if (test.length() == 0)	test = Vm.getenv("HOME", ""); // This should return on *nix system the home dir
+		if (test.length() == 0)	test = "/";
+		return test;
+	}
+	/**
 	 * Open Profile selector screen
 	 * @param prof
 	 * @param showProfileSelector
@@ -733,7 +788,7 @@
 		// If datadir is empty, ask for one
 		if (baseDir.length()==0 || !(new FileBugfix(baseDir)).exists()) {
 			do {
-				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT,"/");
+				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, getHomeDir());
 				fc.title = MyLocale.getMsg(170,"Select base directory for cache data");
 				// If no base directory given, terminate
 				if (fc.execute() == FormBase.IDCANCEL) ewe.sys.Vm.exit(0);



From pfeffer at mail.berlios.de  Thu Sep 10 17:23:12 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 10 Sep 2009 17:23:12 +0200
Subject: [Cachewolf-svn] r2173 - trunk/src/CacheWolf
Message-ID: <200909101523.n8AFNCio029009@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-10 17:23:10 +0200 (Thu, 10 Sep 2009)
New Revision: 2173

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/FilterData.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SafeXML.java
Log:
SafeXML: remove doubled methods

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-09-10 00:11:11 UTC (rev 2172)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-09-10 15:23:10 UTC (rev 2173)
@@ -238,10 +238,10 @@
 				imageInfo = new ImageInfo();
 				int pos=dummy.indexOf("<URL>");
 				if (pos>0) {
-					imageInfo.setFilename(SafeXML.strxmldecode(dummy.substring(0,pos)));
-					imageInfo.setURL(SafeXML.strxmldecode((dummy.substring(pos+5,dummy.indexOf("</URL>")))));
+					imageInfo.setFilename(SafeXML.cleanback(dummy.substring(0,pos)));
+					imageInfo.setURL(SafeXML.cleanback((dummy.substring(pos+5,dummy.indexOf("</URL>")))));
 				} else {
-					imageInfo.setFilename(SafeXML.strxmldecode(dummy));
+					imageInfo.setFilename(SafeXML.cleanback(dummy));
 				}
 				this.images.add(imageInfo);
 				dummy = ex.findNext();
@@ -377,9 +377,9 @@
 						stbuf = images.get(i).getFilename();
 						String urlBuf = images.get(i).getURL();
 						if (urlBuf != null && !urlBuf.equals("")) {
-							detfile.print("    <IMG>"+SafeXML.strxmlencode(stbuf)+"<URL>"+SafeXML.strxmlencode(urlBuf)+"</URL></IMG>\n");
+							detfile.print("    <IMG>"+SafeXML.clean(stbuf)+"<URL>"+SafeXML.clean(urlBuf)+"</URL></IMG>\n");
 						} else {
-							detfile.print("    <IMG>"+SafeXML.strxmlencode(stbuf)+"</IMG>\n");
+							detfile.print("    <IMG>"+SafeXML.clean(stbuf)+"</IMG>\n");
 						}
 				  }
 				  int iis = images.size();

Modified: trunk/src/CacheWolf/FilterData.java
===================================================================
--- trunk/src/CacheWolf/FilterData.java	2009-09-10 00:11:11 UTC (rev 2172)
+++ trunk/src/CacheWolf/FilterData.java	2009-09-10 15:23:10 UTC (rev 2173)
@@ -50,13 +50,13 @@
 	public String toXML(String ID) {
 		String saveID="";
 		if (ID != null && ! ID.equals("")) {
-			saveID = "id = \""+SafeXML.strxmlencode(ID)+"\" ";
+			saveID = "id = \""+SafeXML.clean(ID)+"\" ";
 		}
 	    return "    <FILTERDATA "+saveID+"rose = \""+getFilterRose()+"\" type = \""+getFilterType()+
 		"\" var = \""+getFilterVar()+"\" dist = \""+getFilterDist().replace('"',' ')+"\" diff = \""+
 		getFilterDiff()+"\" terr = \""+getFilterTerr()+"\" size = \""+getFilterSize()+"\" attributesYes = \""+getFilterAttrYes()+
 		"\" attributesNo = \""+getFilterAttrNo()+"\" attributesChoice = \""+getFilterAttrChoice()+
-		"\" status = \""+SafeXML.strxmlencode(getFilterStatus())+"\" useRegexp = \""+useRegexp()+"\" />\n";	
+		"\" status = \""+SafeXML.clean(getFilterStatus())+"\" useRegexp = \""+useRegexp()+"\" />\n";	
 	}
 	/**
 	 * Ensure that all filters have the proper length so that the 'charAt' access in the filter do

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-10 00:11:11 UTC (rev 2172)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-10 15:23:10 UTC (rev 2173)
@@ -497,11 +497,11 @@
 			language = atts.getValue("language");
 		}
 		else if (name.equals("rater")) {
-			rater = SafeXML.strxmldecode(atts.getValue("tool"));
+			rater = SafeXML.cleanback(atts.getValue("tool"));
 		}
 		else if (name.equals("FILTERDATA")) {
 			// Creating a filter object and reading the saved data
-			String id = SafeXML.strxmldecode(atts.getValue("id"));
+			String id = SafeXML.cleanback(atts.getValue("id"));
 			FilterData data = new FilterData();
 			data.setFilterRose(atts.getValue("rose"));
 			data.setFilterType(atts.getValue("type"));
@@ -513,7 +513,7 @@
 			data.setFilterAttrYes(Convert.parseLong(atts.getValue("attributesYes")));
 			data.setFilterAttrNo(Convert.parseLong(atts.getValue("attributesNo")));
 			data.setFilterAttrChoice(Convert.parseInt(atts.getValue("attributesChoice")));
-			data.setFilterStatus(SafeXML.strxmldecode(atts.getValue("status")));
+			data.setFilterStatus(SafeXML.cleanback(atts.getValue("status")));
 			data.setUseRegexp(Boolean.valueOf(atts.getValue("useRegexp")).booleanValue());
 			// Filter object is remembered under the given ID
 			this.addFilter(id, data);
@@ -569,39 +569,39 @@
 			PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(pathToConfigFile)));
 			outp.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n");
 			outp.print("<preferences>\n");
-			outp.print("    <locale language=\"" + SafeXML.strxmlencode(language) + "\"/>\n");
-			outp.print("    <basedir dir = \"" + SafeXML.strxmlencode(baseDir) + "\"/>\n");
-			outp.print("    <lastprofile autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\">" + SafeXML.strxmlencode(lastProfile) + "</lastprofile>\n"); //RB
+			outp.print("    <locale language=\"" + SafeXML.clean(language) + "\"/>\n");
+			outp.print("    <basedir dir = \"" + SafeXML.clean(baseDir) + "\"/>\n");
+			outp.print("    <lastprofile autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\">" + SafeXML.clean(lastProfile) + "</lastprofile>\n"); //RB
 			outp.print("    <alias name =\""+ SafeXML.clean(myAlias) +"\" password=\""+SafeXML.clean(password)+"\" />\n");
 			outp.print("    <alias2 name =\""+ SafeXML.clean(myAlias2) +"\"/>\n");
 			outp.print("    <gcmemberid name =\""+ SafeXML.clean(gcMemberId) +"\"/>\n");
-			outp.print("    <browser name = \"" + SafeXML.strxmlencode(browser) + "\"/>\n");
-			outp.print("    <proxy prx = \"" + SafeXML.strxmlencode(myproxy) + "\" prt = \"" + SafeXML.strxmlencode(myproxyport) + "\" active = \"" + SafeXML.strxmlencode(proxyActive) + "\" />\n");
-			outp.print("    <port portname = \"" + SafeXML.strxmlencode(mySPO.portName) + "\" baud = \"" + SafeXML.strxmlencode(mySPO.baudRate) + "\"/>\n");
-			outp.print("    <portforward active= \"" + SafeXML.strxmlencode(Convert.toString(forwardGPS)) + "\" destinationHost = \"" + SafeXML.strxmlencode(forwardGpsHost) + "\"/>\n");
-			outp.print("    <gpsd active= \"" + SafeXML.strxmlencode(Convert.toString(useGPSD)) + "\" host = \"" + SafeXML.strxmlencode(gpsdHost) + "\" port = \"" + SafeXML.strxmlencode(gpsdPort) + "\"/>\n");
-			outp.print("    <portlog active= \"" + SafeXML.strxmlencode(Convert.toString(logGPS)) + "\" logTimer = \"" + SafeXML.strxmlencode(logGPSTimer) + "\"/>\n");
+			outp.print("    <browser name = \"" + SafeXML.clean(browser) + "\"/>\n");
+			outp.print("    <proxy prx = \"" + SafeXML.clean(myproxy) + "\" prt = \"" + SafeXML.clean(myproxyport) + "\" active = \"" + SafeXML.strxmlencode(proxyActive) + "\" />\n");
+			outp.print("    <port portname = \"" + SafeXML.clean(mySPO.portName) + "\" baud = \"" + SafeXML.strxmlencode(mySPO.baudRate) + "\"/>\n");
+			outp.print("    <portforward active= \"" + SafeXML.clean(Convert.toString(forwardGPS)) + "\" destinationHost = \"" + SafeXML.clean(forwardGpsHost) + "\"/>\n");
+			outp.print("    <gpsd active= \"" + SafeXML.clean(Convert.toString(useGPSD)) + "\" host = \"" + SafeXML.clean(gpsdHost) + "\" port = \"" + SafeXML.strxmlencode(gpsdPort) + "\"/>\n");
+			outp.print("    <portlog active= \"" + SafeXML.clean(Convert.toString(logGPS)) + "\" logTimer = \"" + SafeXML.clean(logGPSTimer) + "\"/>\n");
 			outp.print("    <font size =\"" + SafeXML.strxmlencode(fontSize) + "\"/>\n");
 			outp.print("    <screen menuattop=\""+menuAtTop+"\" tabsattop=\""+tabsAtTop+"\" showstatus=\""+showStatus+"\" hasclosebutton=\""+hasCloseButton+
 	                "\" h=\""+myAppHeight+"\" w=\""+myAppWidth+"\" />\n");
 			outp.print("    <fixedsip state = \"" + SafeXML.strxmlencode(fixSIP) + "\"/>\n");
-			outp.print("    <listview colmap=\"" + SafeXML.strxmlencode(listColMap) + "\" colwidths=\"" + SafeXML.strxmlencode(listColWidth) + "\" />\n");
-			outp.print("    <travelbugs colmap=\"" + SafeXML.strxmlencode(travelbugColMap) + "\" colwidths=\"" + SafeXML.strxmlencode(travelbugColWidth) + "\" shownonlogged=\"" + SafeXML.strxmlencode(travelbugShowOnlyNonLogged) + "\" />\n");
+			outp.print("    <listview colmap=\"" + SafeXML.clean(listColMap) + "\" colwidths=\"" + SafeXML.clean(listColWidth) + "\" />\n");
+			outp.print("    <travelbugs colmap=\"" + SafeXML.clean(travelbugColMap) + "\" colwidths=\"" + SafeXML.clean(travelbugColWidth) + "\" shownonlogged=\"" + SafeXML.strxmlencode(travelbugShowOnlyNonLogged) + "\" />\n");
 			outp.print("    <descpanel showimages=\"" + SafeXML.strxmlencode(descShowImg) + "\" />\n");
 			outp.print("    <imagepanel showdeletedimages=\"" + SafeXML.strxmlencode(showDeletedImages) + "\"/>\n");
 			outp.print("    <hintlogpanel logsperpage=\"" + SafeXML.strxmlencode(logsPerPage) + "\" initialhintheight=\"" + SafeXML.strxmlencode(initialHintHeight) + "\"  maxspiderlogs=\"" + SafeXML.strxmlencode(maxLogsToSpider) + "\" />\n");
 			outp.print("    <solver ignorevariablecase=\"" + SafeXML.strxmlencode(solverIgnoreCase) + "\" degMode=\"" + SafeXML.strxmlencode(solverDegMode) + "\" />\n");
-			outp.print("    <garmin connection = \"" + SafeXML.strxmlencode(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.strxmlencode(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) +
+			outp.print("    <garmin connection = \"" + SafeXML.clean(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.clean(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) +
 					        "\" addDetailsToWaypoint = \"" + SafeXML.strxmlencode(addDetailsToWaypoint) + "\" addDetailsToName = \"" + SafeXML.strxmlencode(addDetailsToName) + "\" />\n");
 			outp.print("    <opencaching downloadMissing=\"" + SafeXML.strxmlencode(downloadmissingOC) + "\"/>\n");
-			outp.print("    <location lat = \"" + SafeXML.strxmlencode(curCentrePt.getLatDeg(TransformCoordinates.DD)) + "\" long = \"" + SafeXML.strxmlencode(curCentrePt.getLonDeg(TransformCoordinates.DD)) + "\"/>\n");
+			outp.print("    <location lat = \"" + SafeXML.clean(curCentrePt.getLatDeg(TransformCoordinates.DD)) + "\" long = \"" + SafeXML.clean(curCentrePt.getLonDeg(TransformCoordinates.DD)) + "\"/>\n");
 			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\" downloadPics=\"" + SafeXML.strxmlencode(downloadPics) + "\" downloadTBs=\"" + SafeXML.strxmlencode(downloadTBs) +"\"/>\n");
 			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
 			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
 			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\"/>\n");
 			outp.print("    <export numberOfLogsToExport=\"" + SafeXML.strxmlencode(numberOfLogsToExport) + "\" exportTravelbugs=\"" + SafeXML.strxmlencode(exportTravelbugs) + "\" exportGpxAsMyFinds=\"" + SafeXML.strxmlencode(exportGpxAsMyFinds) + "\"/>\n");
 			outp.print("    <datamover processorMode=\"" + SafeXML.strxmlencode(processorMode) + "\" />\n");
-			if (customMapsPath!=null) outp.print("    <mapspath dir = \"" + SafeXML.strxmlencode(customMapsPath.replace('\\','/')) + "\"/>\n");
+			if (customMapsPath!=null) outp.print("    <mapspath dir = \"" + SafeXML.clean(customMapsPath.replace('\\','/')) + "\"/>\n");
 			// Saving filters
 			String[] filterIDs = this.getFilterIDs();
 			for (int i=0; i<filterIDs.length; i++){
@@ -613,14 +613,14 @@
 			MapEntry entry;
 			while(itPath.hasNext()){
 				entry = (MapEntry) itPath.next();
-				outp.print("    <expPath key = \"" + SafeXML.strxmlencode(entry.getKey().toString()) + "\" value = \"" + SafeXML.strxmlencode(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
+				outp.print("    <expPath key = \"" + SafeXML.clean(entry.getKey().toString()) + "\" value = \"" + SafeXML.clean(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
 			}
 			itPath = importerPaths.entries();
 			while(itPath.hasNext()){
 				entry = (MapEntry) itPath.next();
-				outp.print("    <impPath key = \"" + SafeXML.strxmlencode(entry.getKey().toString()) + "\" value = \"" + SafeXML.strxmlencode(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
+				outp.print("    <impPath key = \"" + SafeXML.clean(entry.getKey().toString()) + "\" value = \"" + SafeXML.clean(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
 			}
-			if (rater != null) outp.print("    <rater tool=\"".concat(SafeXML.strxmlencode(rater)).concat("\"/>\n"));
+			if (rater != null) outp.print("    <rater tool=\"".concat(SafeXML.clean(rater)).concat("\"/>\n"));
 			outp.print("    <logkeeping maximum=\""+SafeXML.strxmlencode(maxLogsToKeep)+"\" keepown=\""+SafeXML.strxmlencode(alwaysKeepOwnLogs)+"\" />\n");
 			outp.print("    <fillWhiteArea on=\""+SafeXML.strxmlencode(fillWhiteArea)+"\"/>\n");
 			outp.print("</preferences>");

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-10 00:11:11 UTC (rev 2172)
+++ trunk/src/CacheWolf/Profile.java	2009-09-10 15:23:10 UTC (rev 2173)
@@ -344,7 +344,7 @@
 					setFilterAttrNo(Convert.parseLong(attr));
 					attr = ex.findNext();
 					setFilterAttrChoice(Convert.parseInt(attr));
-					setFilterStatus(SafeXML.strxmldecode(ex.findNext()));
+					setFilterStatus(SafeXML.cleanback(ex.findNext()));
 					setFilterUseRegexp(Boolean.valueOf(ex.findNext()).booleanValue());
 				} else if (text.indexOf("<FILTERCONFIG")>=0){
 					ex.setSource(text.substring(text.indexOf("<FILTERCONFIG")));

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2009-09-10 00:11:11 UTC (rev 2172)
+++ trunk/src/CacheWolf/SafeXML.java	2009-09-10 15:23:10 UTC (rev 2173)
@@ -8,13 +8,13 @@
 
 import ewe.util.Hashtable;
 
-public class SafeXML{
+public final class SafeXML{
 	private static final char ENTITY_START = '&';
 	private static final char ENTITY_END = ';';
 	
-	private static Hashtable iso2htmlMappings = new Hashtable(300);
+	private final static Hashtable iso2htmlMappings = new Hashtable(300);
 	static {
-		String[] mappingArray = new String[] {
+		final String[] mappingArray = new String[] {
 				"&apos;",   "'",		// Added 20061227 - not a valid HTML entity but sometimes used
 				"&quot;",   "\"",
 				"&amp;",    "&",
@@ -115,125 +115,7 @@
 				"&uuml;",   "?",
 				"&yacute;", "?",
 				"&thorn;",  "?",
-				"&yuml;",   "?",
-				
-				"&#34;",  "\"",
-				"&#38;",  "&",
-				"&#60;",  "<",
-				"&#62;",  ">",
-				"&#160;", " ",
-				"&#161;", "?",
-				"&#162;", "?",
-				"&#163;", "?",
-				"&#164;", "?",
-				"&#165;", "?",
-				"&#166;", "?",
-				"&#167;", "?",
-				"&#168;", "?",
-				"&#169;", "?",
-				"&#170;", "?",
-				"&#171;", "?",
-				"&#172;", "?",
-				"&#173;", "?",
-				"&#174;", "?",
-				"&#175;", "?",
-				"&#176;", "?",
-				"&#177;", "?",
-				"&#178;", "?",
-				"&#179;", "?",
-				"&#180;", "?",
-				"&#181;", "?",
-				"&#182;", "?",
-				"&#183;", "?",
-				"&#184;", "?",
-				"&#185;", "?",
-				"&#186;", "?",
-				"&#187;", "?",
-				"&#188;", "?",
-				"&#189;", "?",
-				"&#190;", "?",
-				"&#191;", "?",
-				"&#192;", "?",
-				"&#193;", "?",
-				"&#194;", "?",
-				"&#195;", "?",
-				"&#196;", "?",
-				"&#197;", "?",
-				"&#198;", "?",
-				"&#199;", "?",
-				"&#200;", "?",
-				"&#201;", "?",
-				"&#202;", "?",
-				"&#203;", "?",
-				"&#204;", "?",
-				"&#205;", "?",
-				"&#206;", "?",
-				"&#207;", "?",
-				"&#208;", "?",
-				"&#209;", "?",
-				"&#210;", "?",
-				"&#211;", "?",
-				"&#212;", "?",
-				"&#213;", "?",
-				"&#214;", "?",
-				"&#215;", "?",
-				"&#216;", "?",
-				"&#217;", "?",
-				"&#218;", "?",
-				"&#219;", "?",
-				"&#220;", "?",
-				"&#221;", "?",
-				"&#222;", "?",
-				"&#223;", "?",
-				"&#224;", "?",
-				"&#225;", "?",
-				"&#226;", "?",
-				"&#227;", "?",
-				"&#228;", "?",
-				"&#229;", "?",
-				"&#230;", "?",
-				"&#231;", "?",
-				"&#232;", "?",
-				"&#233;", "?",
-				"&#234;", "?",
-				"&#235;", "?",
-				"&#236;", "?",
-				"&#237;", "?",
-				"&#238;", "?",
-				"&#239;", "?",
-				"&#240;", "?",
-				"&#241;", "?",
-				"&#242;", "?",
-				"&#243;", "?",
-				"&#244;", "?",
-				"&#245;", "?",
-				"&#246;", "?",
-				"&#247;", "?",
-				"&#248;", "?",
-				"&#249;", "?",
-				"&#250;", "?",
-				"&#251;", "?",
-				"&#252;", "?",
-				"&#253;", "?",
-				"&#254;", "?",
-				"&#255;", "?",
-				"&#8208;", "-",
-				"&#8209;", "-",
-				"&#8210;", "-",
-				"&#8211;", "-",
-				"&#8212;", "-",
-				"&#8213;", "-",
-				"&#8216;", "'",
-				"&#8217;", "'",
-				"&#8218;", "'",
-				"&#8219;", "'",
-				"&#8220;", "\"",
-				"&#8221;", "\"",
-				"&#8222;", "\"",
-				"&#8223;", "\"",
-				"&#8226;", "?",
-				"&#8242;", "'",
-				"&#8243;", "\""
+				"&yuml;",   "?"
 				};
 		for (int i = 0; i < mappingArray.length; i = i + 2) {
 			iso2htmlMappings.put( mappingArray[i], mappingArray[i+1]);
@@ -257,7 +139,7 @@
 	 * @return A <code>String</code> containing only ISO8859-1
 	 * 	characters
 	 */
-	public static String cleanback( String htmlString) {
+	public final static String cleanback( String htmlString) {
 		int indexStart;
 		// return immediately if string is null or does not contain &
 		if (htmlString != null && (indexStart = htmlString.indexOf( ENTITY_START))>=0) {
@@ -301,7 +183,7 @@
 		}
 	}
 
-	protected static void appendEntityAsIsoChar(String entity, StringBuffer addto) {
+	private final static void appendEntityAsIsoChar(String entity, StringBuffer addto) {
 		if (entity.startsWith("&#")) {
 			try{
 				if (entity.charAt(2)== 'x' || entity.charAt(2) == 'X') // number in hexadecimal // not tested because I don't have an XML containing hexadecimal encodings
@@ -333,7 +215,7 @@
      *
      * @return equivalent string eg. &amp;, null means leave char as is.
      */
-    protected static String charToEntity( char c )
+    private final static String charToEntity( char c )
         {
         switch ( c ) {
 	        case 34 : return "&quot;";
@@ -361,7 +243,7 @@
      *
      * @return translated text, or null if input is null.
      */
-    public static String clean( String text ) {
+    public final static String clean( String text ) {
         if ( text == null ) return null;
         int originalTextLength = text.length();
         StringBuffer sb = new StringBuffer( originalTextLength * 110 / 100 );
@@ -392,7 +274,7 @@
     } // end insertEntities
 	
 	
-	public static String cleanGPX(String str){
+	public final static String cleanGPX(String str){
 		String dummy = new String();
 		
 		dummy = STRreplace.replace(str, "&","&amp;");
@@ -416,124 +298,13 @@
 	 *
 	 * @return (String) translated text, or null if input is null
 	 */
-	public static String strxmlencode(boolean src) {
+	public final static String strxmlencode(boolean src) {
 		/* bools are always safe */
 		return (src ? "true" : "false");
 	}
-	public static String strxmlencode(int src) {
+	public final static String strxmlencode(int src) {
 		/* numbers are always safe */
 		return (Integer.toString(src));
 	}
-	public static String strxmlencode(String src) {
-		int i, slen;
-		char tmp[];
-		StringBuffer dst;
 
-		if (src == null)
-			return (null);
-
-		slen = src.length();
-		dst = new StringBuffer(slen);
-		tmp = new char[slen];
-		src.getChars(0, slen, tmp, 0);
-		for (i = 0; i < slen; ++i)
-			if (tmp[i] == '&' || tmp[i] == '<' ||
-			    tmp[i] == '>' || tmp[i] > 0x7E) {
-				dst.append("&#");
-				dst.append((int)tmp[i]);
-				dst.append(';');
-			} else
-				dst.append(tmp[i]);
-		return (dst.toString());
-	}
-
-	/**
-	 * Converts a string that is safe to use inside an XML file (like
-	 * prefs.xml) back to a data string - entities like &amp; are *NOT*
-	 * valid XML unless declared specially, so we must use the numerical
-	 * values here. We also try to decode non-standard entities.
-	 *
-	 * @param src (String) translated text to be processed
-	 *
-	 * @return (String) raw text, or null if input is null
-	 */
-	public static String strxmldecode(String src) {
-		int i, j, slen;
-		char ch, tmp[];
-		StringBuffer dst;
-		boolean isinval;
-
-		if (src == null)
-			return (null);
-
-		slen = src.length();
-		dst = new StringBuffer(slen);
-		tmp = new char[slen];
-		src.getChars(0, slen, tmp, 0);
-		i = 0;
-		while (i < slen)
-			if (tmp[i] == '&') {
-				/* first scan if we have a trailing ; */
-				if (src.indexOf(';', i) == -1) {
-					/* no - ignore and proceed */
-					i++;
-					dst.append(0xFFFD);
-				} else if (tmp[++i] == '#') {
-					/* yes - numerical value? */
-					i++;
-					ch = 0;
-					isinval = false;
-					if (tmp[i] == 'x' || tmp[i] == 'X') {
-						/* hexadecimal numeric */
-						i++;
-						while ((j = tmp[i++]) != ';') {
-							ch *= 16;
-							if (j < 0x30)
-								isinval = true;
-							else if (j < 0x3A)
-								ch += j - 0x30;
-							else if (j < 0x41)
-								isinval = true;
-							else if (j < 0x47)
-								ch += j - 0x37;
-							else if (j < 0x61)
-								isinval = true;
-							else if (j < 0x67)
-								ch += j - 0x57;
-							else
-								isinval = true;
-						}
-					} else
-						/* decimal numeric */
-						while ((j = tmp[i++]) != ';') {
-							ch *= 10;
-							if (j < 0x30)
-								isinval = true;
-							else if (j < 0x3A)
-								ch += j - 0x30;
-							else
-								isinval = true;
-						}
-					if (isinval)
-						ch = 0xFFFD;
-					dst.append(ch);
-				} else {
-					/* yes - string value */
-					StringBuffer tconv = new StringBuffer("&");
-					String tc;
-
-					do {
-						tconv.append(tmp[i]);
-					} while (tmp[i++] != ';');
-
-					if ((tc = (String)iso2htmlMappings.get(tconv.toString())) == null)
-						/* invalid entity, just retain it */
-						dst.append(tconv);
-					else
-						dst.append(tc);
-				}
-			} else
-				dst.append(tmp[i++]);
-		return (dst.toString());
-	}
 }



From pfeffer at mail.berlios.de  Thu Sep 10 22:37:00 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 10 Sep 2009 22:37:00 +0200
Subject: [Cachewolf-svn] r2174 - trunk/res_noewe
Message-ID: <200909102037.n8AKb0Mh014681@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-10 22:36:59 +0200 (Thu, 10 Sep 2009)
New Revision: 2174

Added:
   trunk/res_noewe/cachewolf.bat
Log:
starting cachewolf: adding a batch file which automatically uses the (sun) java vm, if it exists and otherwise starts cachewolf.exe (incorperating the slowlier ewe vm), see http://www.geoclub.de/viewtopic.php?f=40&t=37879&p=598164#p598164

Added: trunk/res_noewe/cachewolf.bat
===================================================================
--- trunk/res_noewe/cachewolf.bat	2009-09-10 15:23:10 UTC (rev 2173)
+++ trunk/res_noewe/cachewolf.bat	2009-09-10 20:36:59 UTC (rev 2174)
@@ -0,0 +1,16 @@
+ at echo off
+echo "Starting Cachewolf..."
+rem change into the directory this file is located in
+cd %~d0%~p0
+rem if a java vm is installed and cachewolf.jar exists, use it
+rem otherwise use cachewolf.exe (= cachewolf.ewe with integrated ewe-vm)
+if exist CacheWolf.jar (
+javaw -version 2>nul
+if not errorlevel 1 (
+start javaw -cp CacheWolf.jar ewe.applet.Applet CacheWolf.CacheWolf
+) else (
+start cachewolf.exe
+) ) else (
+start /b cachewolf.exe
+)
+exit



From pfeffer at mail.berlios.de  Fri Sep 11 02:19:42 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 11 Sep 2009 02:19:42 +0200
Subject: [Cachewolf-svn] r2175 - in trunk/src/CacheWolf: . imp
Message-ID: <200909110019.n8B0Jgsx020443@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-11 02:19:40 +0200 (Fri, 11 Sep 2009)
New Revision: 2175

Modified:
   trunk/src/CacheWolf/CacheImages.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Images on linux: bug fixed: images that match the old 8.3 dos filename scheme were not displayed in linux, see http://www.geoclub.de/viewtopic.php?f=40&t=37887&p=598234#p598234

Modified: trunk/src/CacheWolf/CacheImages.java
===================================================================
--- trunk/src/CacheWolf/CacheImages.java	2009-09-10 20:36:59 UTC (rev 2174)
+++ trunk/src/CacheWolf/CacheImages.java	2009-09-11 00:19:40 UTC (rev 2175)
@@ -209,7 +209,7 @@
 			String obsoleteFilename = oldImages.get(i).getFilename();
 			if (!newImages.hasFile(obsoleteFilename)) {
 				String location = Global.getProfile().dataDir + obsoleteFilename;
-				File tmpFile = new File(location);
+				File tmpFile = new FileBugfix(location);
 				if (tmpFile.exists() && tmpFile.canWrite()) {
 					Global.getPref().log("Image not longer needed. Deleting: "+obsoleteFilename);
 					tmpFile.delete();

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-10 20:36:59 UTC (rev 2174)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-11 00:19:40 UTC (rev 2175)
@@ -619,7 +619,7 @@
 
 	private String createPicFilename(String fetchURL) {
 		String fileName = holder.getWayPoint() + "_" + fetchURL.substring(fetchURL.lastIndexOf("/")+1);
-		return Common.ClearForFileName(fileName);
+		return Common.ClearForFileName(fileName).toLowerCase();
 	}
 	
 	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-09-10 20:36:59 UTC (rev 2174)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-09-11 00:19:40 UTC (rev 2175)
@@ -1257,7 +1257,7 @@
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 						imageInfo = null;
 						if (idxUrl<0) { // New image
-							fileName = chD.getParent().getWayPoint() + "_" + Convert.toString(spiderCounter);
+							fileName = chD.getParent().getWayPoint().toLowerCase() + "_" + Convert.toString(spiderCounter);
 							if (lastImages != null) {
 								imageInfo = lastImages.needsSpidering(imgUrl, fileName+imgType);
 							}



From araber95 at mail.berlios.de  Fri Sep 11 11:12:15 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 11 Sep 2009 11:12:15 +0200
Subject: [Cachewolf-svn] r2176 - trunk
Message-ID: <200909110912.n8B9CFIL024763@sheep.berlios.de>

Author: araber95
Date: 2009-09-11 11:12:14 +0200 (Fri, 11 Sep 2009)
New Revision: 2176

Modified:
   trunk/cw-pda.jnf
Log:
less memory error showing png-files 

Modified: trunk/cw-pda.jnf
===================================================================
--- trunk/cw-pda.jnf	2009-09-11 00:19:40 UTC (rev 2175)
+++ trunk/cw-pda.jnf	2009-09-11 09:12:14 UTC (rev 2176)
@@ -1 +1 @@
-command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D/Xmx%2B8M&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DPocketPC%25252B2003%252526%25253DPocketPC%25252B-%25252BARM/XScale%252526%25253DPocketPC%25252B-%25252BMIPS%252526%25253DPocketPC%25252B-%25252BSH3&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntr!
 y%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D/Xmx%252B8M%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources/CacheWolf.ico
+command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D/Xmx%2B6M&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DPocketPC%25252B2003%252526%25253DPocketPC%25252B-%25252BARM/XScale%252526%25253DPocketPC%25252B-%25252BMIPS%252526%25253DPocketPC%25252B-%25252BSH3&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntr!
 y%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D/Xmx%252B6M%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources/CacheWolf.ico



From araber95 at mail.berlios.de  Fri Sep 11 11:15:27 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 11 Sep 2009 11:15:27 +0200
Subject: [Cachewolf-svn] r2177 - in trunk/src/CacheWolf: . imp navi
Message-ID: <200909110915.n8B9FROW025069@sheep.berlios.de>

Author: araber95
Date: 2009-09-11 11:15:23 +0200 (Fri, 11 Sep 2009)
New Revision: 2177

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/Common.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/navi/MapLoader.java
   trunk/src/CacheWolf/navi/MovingMapCache.java
   trunk/src/CacheWolf/navi/TransformCoordinates.java
   trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java
Log:
removed / commented lines causing warnings. (didn't check possible side effects)

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -513,7 +513,7 @@
 	 * Call it only when necessary, it takes time, because all logs must be parsed
 	 */
 	public void calcRecommendationScore() {
-		String pattern = getWayPoint().toUpperCase();
+		// String pattern = getWayPoint().toUpperCase();
 		if (isOC()) {
 			// Calculate recommendation score only when details
 			// are already loaded. When they aren't loaded, then we assume

Modified: trunk/src/CacheWolf/Common.java
===================================================================
--- trunk/src/CacheWolf/Common.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/Common.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -2,7 +2,6 @@
 
 
 import CacheWolf.utils.FileBugfix;
-import ewe.io.File;
 import ewe.sys.Convert;
 
 public final class Common {

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -1,6 +1,5 @@
 package CacheWolf;
 
-import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.navi.TransformCoordinates;
 import ewe.fx.Color;
 import ewe.fx.Dimension;

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -87,7 +87,7 @@
 	private static String viewstate = "";
 	private static String viewstate1 = "";
 	//FIXME Field is never read. Needed?
-	private static String eventvalidation = "";
+	//private static String eventvalidation = "";
 	private static String cookieID = "";
 	private static String cookieSession = "";
 	private static double distance = 0;
@@ -171,7 +171,7 @@
 			else {
 				rexEventvalidation.search(start);
 				if(rexEventvalidation.didMatch()){
-					eventvalidation = rexEventvalidation.stringMatched(1);
+					// eventvalidation = rexEventvalidation.stringMatched(1);
 					//Vm.debug("EVENTVALIDATION: " + eventvalidation);
 				} else
 					pref.log("[login]:Eventvalidation not found before login");
@@ -496,11 +496,11 @@
 
 				rexEventvalidation.search(start);
 				if(rexEventvalidation.didMatch()){
-					eventvalidation = rexEventvalidation.stringMatched(1);
+					// eventvalidation = rexEventvalidation.stringMatched(1);
 					//Vm.debug("EVENTVALIDATION: " + eventvalidation);
 				} else {
-					eventvalidation = "";
-					pref.log("Eventvalidation not found");
+					// eventvalidation = "";
+					// pref.log("Eventvalidation not found");
 				}
 
 				//Vm.debug("In loop");

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -493,7 +493,7 @@
 	//	CWPoint buttomleft = new CWPoint(maparea.buttomright.latDec, maparea.topleft.lonDec);
 		int crs = getCrs(maparea.getCenter());
 		// FIXME region is never read. Needed?
-		int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[crs]);
+		// int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[crs]);
 		ret[TOPLEFT_INDEX] = TransformCoordinates.wgs84ToEpsg(maparea.topleft, coordinateReferenceSystem[crs]);
 		ret[BUTTOMRIGHT_INDEX] = TransformCoordinates.wgs84ToEpsg(maparea.buttomright, coordinateReferenceSystem[crs]);
 		ret[TOPRIGHT_INDEX] =  ret[BUTTOMRIGHT_INDEX].cloneIt();

Modified: trunk/src/CacheWolf/navi/MovingMapCache.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMapCache.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/navi/MovingMapCache.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -1,7 +1,6 @@
 package CacheWolf.navi;
 
 import ewe.fx.Dimension;
-import ewe.fx.Rect;
 import ewe.util.Hashtable;
 import ewe.util.Iterator;
 import ewe.util.Map;

Modified: trunk/src/CacheWolf/navi/TransformCoordinates.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinates.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/navi/TransformCoordinates.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -117,16 +117,16 @@
 
 	// taken from http://www.lverma.nrw.de/produkte/druckschriften/verwaltungsvorschriften/images/gps/TrafopsNRW.pdf for NRW this transform has deviations lower than 34cm.
 	/** use this for NRW in Germany. Deviations less than 34 cm */
-	private static final TransformParameters GK_NRW_GERMANY_TO_WGS84 = new TransformParameters(566.1, 116.3, 390.1, -1.11, -0.24, 3.76, -12.6, BESSEL);
+	// private static final TransformParameters GK_NRW_GERMANY_TO_WGS84 = new TransformParameters(566.1, 116.3, 390.1, -1.11, -0.24, 3.76, -12.6, BESSEL);
 
 	// taken from http://www.lverma.nrw.de/produkte/druckschriften/verwaltungsvorschriften/images/gps/TrafopsNRW.pdf for NRW this transform has deviations lower than 113cm.
 	// these matches to  http://www.geoclub.de/files/GK_nach_GPS.xls "Parametersatz 3 = Deutschland 1995"
 	/** Use this for Germany if there is no more specific available. Deviations less than 113 cm */
-	private static final TransformParameters GK_GERMANY_1995_TO_WGS84 = new TransformParameters(582, 105, 414, -1.04, -0.35, +3.08, -8.3, BESSEL);
+	// private static final TransformParameters GK_GERMANY_1995_TO_WGS84 = new TransformParameters(582, 105, 414, -1.04, -0.35, +3.08, -8.3, BESSEL);
 
 	// taken from http://www.geodatenzentrum.de/geodaten/gdz_home1.gdz_home_start?gdz_home_para1=Technische%A0Hinweise&gdz_home_para2=Technische%A0Hinweise&gdz_home_menu_nr=10&gdz_home_menu_nr2=1&gdz_home_para3=/auftrag/html/gdz_tech_geo_deu.htm&gdz_home_spr=deu&gdz_home_para0=0
 	/** Use this for Germany if there is no more specific available. Deviations unknown. Data source: Bundesamt f?r Kartographie und Geod?sie, taken from website on: 1-11-2007 */
-	private static final TransformParameters GK_GERMANY_BKG_TO_WGS84 = new TransformParameters(586, 87, 409, -0.52, -0.15, 2.82, -9, BESSEL);
+	// private static final TransformParameters GK_GERMANY_BKG_TO_WGS84 = new TransformParameters(586, 87, 409, -0.52, -0.15, 2.82, -9, BESSEL);
 
 	// take from http://www.geoclub.de/files/GK_nach_GPS.xls "Parametersatz 2 = Deutschland 2001" (rotation *-1)
 	/** Use this for Germany if there is no more specific available. maximal deviations unknown */

Modified: trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java	2009-09-11 09:12:14 UTC (rev 2176)
+++ trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java	2009-09-11 09:15:23 UTC (rev 2177)
@@ -1,6 +1,5 @@
 package CacheWolf.navi;
 
-import ewe.util.Properties;
 import CacheWolf.CWPoint;
 import CacheWolf.MyLocale;
 



From araber95 at mail.berlios.de  Fri Sep 11 14:00:25 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 11 Sep 2009 14:00:25 +0200
Subject: [Cachewolf-svn] r2178 - trunk/src/CacheWolf/imp
Message-ID: <200909111200.n8BC0P2M024663@sheep.berlios.de>

Author: araber95
Date: 2009-09-11 14:00:18 +0200 (Fri, 11 Sep 2009)
New Revision: 2178

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
reflection of OC(de) Stati > 4 : status 1 is CW.available, all other are not CW.available, status 3 is also CW.archived

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-11 09:15:23 UTC (rev 2177)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-11 12:00:18 UTC (rev 2178)
@@ -408,13 +408,22 @@
 			return;
 		}
 		if(name.equals("status")){
-			if(atts.getValue("id").equals("1")) holder.setAvailable(true);
-			if(atts.getValue("id").equals("2")) holder.setAvailable(false);
-			if(atts.getValue("id").equals("3")) {
-				holder.setArchived(true);
+            // meaning of OC status :
+			//  1=Kann gesucht werden ;
+			//  2=Momentan nicht verf?gbar ; 
+			//  3=Archiviert ; 
+			//  4= ; 
+			//  5= ; 
+			//  6=Gesperrt ;
+			//  are there more ? ;
+			if (atts.getValue("id").equals("1")) {
+				holder.setAvailable(true);
+			} else {
 				holder.setAvailable(false);
+				if(atts.getValue("id").equals("3")) {
+					holder.setArchived(true);
+				}
 			}
-			if(atts.getValue("id").equals("4")) holder.setAvailable(false);
 			return;
 		}
 		if(name.equals("size")){



From araber95 at mail.berlios.de  Fri Sep 11 20:39:48 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 11 Sep 2009 20:39:48 +0200
Subject: [Cachewolf-svn] r2179 - in trunk: res_noewe/languages src/CacheWolf
	src/CacheWolf/imp
Message-ID: <200909111839.n8BIdmZB029761@sheep.berlios.de>

Author: araber95
Date: 2009-09-11 20:39:44 +0200 (Fri, 11 Sep 2009)
New Revision: 2179

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
removed double call of options input if there is an OC - Cache

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-11 12:00:18 UTC (rev 2178)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-11 18:39:44 UTC (rev 2179)
@@ -424,7 +424,7 @@
 		1603=Karten downloaden
 		1604=Abbrechen
 		1605=OK
-		1606=Alle neu downloaden
+		1606=OC Alle neu downloaden
 		1607=Update von opencaching erfolgreich
 		1608=Daten von opencaching downloaden...
 		1609=Importiere Cache:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-11 12:00:18 UTC (rev 2178)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-11 18:39:44 UTC (rev 2179)
@@ -424,7 +424,7 @@
 		1603=Download maps
 		1604=Cancel
 		1605=OK
-		1606=redownload all
+		1606=OC redownload all
 		1607=Update from opencaching successful
 		1608=Downloading data from opencaching...
 		1609=Importing Cache:

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-11 12:00:18 UTC (rev 2178)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-11 18:39:44 UTC (rev 2179)
@@ -412,7 +412,7 @@
 		1603=T%e9l%e9charger cartes
 		1604=Annuler
 		1605=OK
-		1606=Ret%e9l%e9charger toutes
+		1606=OC Ret%e9l%e9charger toutes
 		1607=Mise %e0 jour par opencaching r%e9ussi
 		1608=T%e9l%e9chargant donn%e9es par opencaching...
 		1609=Importe Cache:

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-09-11 12:00:18 UTC (rev 2178)
+++ trunk/res_noewe/languages/NL.cfg	2009-09-11 18:39:44 UTC (rev 2179)
@@ -377,7 +377,7 @@
 		1603=Download kaarten
 		1604=Annuleren
 		1605=OK
-		1606=Redownload alles
+		1606=OC Redownload alles
 		1607=Update van Opencaching.de is gelukt.
 		1608=Download data van Opencaching.de.
 		1609=Importeren cache

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-11 12:00:18 UTC (rev 2178)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-11 18:39:44 UTC (rev 2179)
@@ -424,7 +424,7 @@
                 1603=Sciagnij mapy
                 1604=Anuluj
                 1605=OK
-                1606=Sciagnij ponownie wszystko
+                1606=OC Sciagnij ponownie wszystko
                 1607=Update Z opencaching udany
                 1608=Sciagam dane Z opencaching...
                 1609=Importuje Skrzynke:

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-09-11 12:00:18 UTC (rev 2178)
+++ trunk/src/CacheWolf/MainMenu.java	2009-09-11 18:39:44 UTC (rev 2179)
@@ -762,7 +762,7 @@
 		CacheDB cacheDB=profile.cacheDB;
 		CacheHolder ch;
 		
-		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(5003,"Options"), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS);
+		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(5003,"Options"), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.ALL);
 		if (options.execute() == FormBase.IDCANCEL) {	return; }
 				
 		SpiderGC spider = new SpiderGC(pref, profile, false);

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-11 12:00:18 UTC (rev 2178)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-11 18:39:44 UTC (rev 2179)
@@ -72,7 +72,6 @@
 	String strData = new String();
 	int picCnt;
 	boolean incUpdate = true; // complete or incremental Update
-	boolean askForOptions = true;
 	Hashtable DBindexID = new Hashtable();
 
 	String picUrl = new String();
@@ -121,9 +120,6 @@
 			hostname = OPENCACHING_UK_HOST;
 	}
 
-	/** true, if not the last syncdate shall be used, but the caches shall be reloaded
-	 * only used in syncSingle */
-	boolean reload;
 	/**
 	 * 
 	 * @param number
@@ -135,28 +131,20 @@
 		ch = cacheDB.get(number);
 		setHostname(ch.getWayPoint());
 		holder= null; //new CacheHolderDetail(ch); //TODO is this still correct? use getDetails ?
-
+		
 		if (infB.isClosed) {
-			if (askForOptions) return false; 
-			else return true;
+			// there could have been an update before
+			return true;
 		}
-		
-		if (askForOptions) {
-			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( 
-					hostname + MyLocale.getMsg(1600, " Download"),OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL);
-			if (importOpt.execute() == FormBase.IDCANCEL) {	return false; }
-			askForOptions = false;
-			reload = importOpt.missingCheckBox.getState();
-		}
 
 		// this is only a dummy-InfoBox for capturing the output
 		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from " + hostname), InfoBox.PROGRESS_WITH_WARNINGS, false);
-//		inf.setPreferredSize(220, 300);
-//		inf.relayout(false);
-//		inf.exec();
 
 		String lastS; 
-		if (reload)  lastS = "20050801000000";
+		/** pref.downloadmissingOC = true, if not the last syncdate shall be used,
+		 *  but the caches shall be reloaded
+		 *  only used in syncSingle  */
+		if (pref.downloadmissingOC)  lastS = "20050801000000";
 		else {
 			if (ch.getLastSync().length() < 14) lastS = "20050801000000";
 			else lastS = ch.getLastSync();
@@ -172,6 +160,7 @@
 			+ "modifiedsince=" + lastS
 			+ "&cache=1"
 			+ "&cachedesc=1";
+		
 		if (pref.downloadPics) url += "&picture=1";
 		else url += "&picture=0";
 		url += "&cachelog=1"



From araber95 at mail.berlios.de  Fri Sep 11 22:44:01 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 11 Sep 2009 22:44:01 +0200
Subject: [Cachewolf-svn] r2180 - trunk/res_noewe/webmapservices
Message-ID: <200909112044.n8BKi18i010738@sheep.berlios.de>

Author: araber95
Date: 2009-09-11 22:43:54 +0200 (Fri, 11 Sep 2009)
New Revision: 2180

Added:
   trunk/res_noewe/webmapservices/sk-bl_t25.wms
   trunk/res_noewe/webmapservices/sk-ta_t25.wms
Log:
Wms centrope for Slovakia region Bratislavsky and region Trnavsky

Added: trunk/res_noewe/webmapservices/sk-bl_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/sk-bl_t25.wms	2009-09-11 18:39:44 UTC (rev 2179)
+++ trunk/res_noewe/webmapservices/sk-bl_t25.wms	2009-09-11 20:43:54 UTC (rev 2180)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://www.centropemap.org
+GetCapabilitiesUrl: http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+#Name:               Oesterreich, Tschechien, Slowakei, Ungarn t100 SF=7..12
+#Name:               Centrope Oesterreich, Tschechien, Slowakei, Ungarn t25 SF=1..7
+Name:               SK.Bratislavsky t25 SF=1..7
+#Name:               SK.Bratislava t25 SF=1..7
+MapType:                        topo
+MainUrl:            http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287 31466 31467
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287 SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Topographic Base Map|Topographic Base Map|997.805696859274|24945.1424214819
+#LayersUrlPart:     LAYERS=GeoAtlas_2008|GeoAtlas_2008||
+#LayersUrlPart:     LAYERS=m4m|m4m|1496.70854528891|498902.847930734
+#LayersUrlPart:     LAYERS=m2m|m2m|548.793133272601|1496.70804638606
+#LayersUrlPart:     LAYERS=m1m|m1m|299.341709057782|548.792634369752
+#LayersUrlPart:     LAYERS=m500k|m500k|114.748154041665|299.341210154934
+#LayersUrlPart:     LAYERS=m250k|m250k|37.4182125350712|114.747655138817
+#LayersUrlPart:     LAYERS=m100k_01|m100k_01|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_02|m100k_02|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_03|m100k_03|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_04|m100k_04|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_05|m100k_05|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m50k_01|m50k_01|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_02|m50k_02|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_03|m50k_03|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_04|m50k_04|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_05|m50k_05|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_06|m50k_06|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_07|m50k_07|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_08|m50k_08|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_09|m50k_09|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_10|m50k_10|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_11|m50k_11|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_12|m50k_12|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m25k_01|m25k_01|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_02|m25k_02|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_03|m25k_03|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_04|m25k_04|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_05|m25k_05|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_06|m25k_06|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_07|m25k_07|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_08|m25k_08|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_09|m25k_09|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_10|m25k_10|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_11|m25k_11|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_12|m25k_12|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_13|m25k_13|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_14|m25k_14|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_15|m25k_15|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_16|m25k_16|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_17|m25k_17|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_18|m25k_18|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_19|m25k_19|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_20|m25k_20|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_21|m25k_21|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_22|m25k_22|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_23|m25k_23|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_24|m25k_24|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_25|m25k_25|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_26|m25k_26|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_27|m25k_27|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_28|m25k_28|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_29|m25k_29|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_30|m25k_30|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_31|m25k_31|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_32|m25k_32|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_33|m25k_33|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_34|m25k_34|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_35|m25k_35|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_36|m25k_36|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_37|m25k_37|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_38|m25k_38|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=Countries|Countries||
+#LayersUrlPart:     LAYERS=National_Borders|National_Borders|0.000498902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=Nuts3_Borders|Nuts3_Borders|0.000498902848429637|2494.51424214819
+#LayersUrlPart:     LAYERS=Municipalities|Municipalities|0.000498902848429637|249.451923117667
+#LayersUrlPart:     LAYERS=m50k_01,m50k_02,m50k_03,m50k_04,m50k_05,m50k_06,m50k_07,m50k_08,m50k_09,m50k_10,m50k_11,m50k_12
+LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10,m25k_11,m25k_12,m25k_13,m25k_14,m25k_15,m25k_16,m25k_17,m25k_18,m25k_19,m25k_20,m25k_21,m25k_22,m25k_23,m25k_24,m25k_25,m25k_26,m25k_27,m25k_28,m25k_29,m25k_30,m25k_31,m25k_32,m25k_33,m25k_34,m25k_35,m25k_36,m25k_37,m25k_38
+##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+#Server
+#BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
+#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BBox_Mitte: N 47.60515 E 16.341865
+#real
+#BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
+#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#SK Bratislava
+BoundingBoxTopLeftWGS84: N 48.659222 E 16.819382
+BoundingBoxButtomRightWGS84: N 48.009865 E 17.517636
+#MinScale:   1
+#MaxScale:   26
+RecommendedScale:   2.5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/sk-ta_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/sk-ta_t25.wms	2009-09-11 18:39:44 UTC (rev 2179)
+++ trunk/res_noewe/webmapservices/sk-ta_t25.wms	2009-09-11 20:43:54 UTC (rev 2180)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://www.centropemap.org
+GetCapabilitiesUrl: http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+#Name:               Oesterreich, Tschechien, Slowakei, Ungarn t100 SF=7..12
+#Name:               Centrope Oesterreich, Tschechien, Slowakei, Ungarn t25 SF=1..7
+Name:               SK.Trnavsky t25 SF=1..7
+#Name:               SK.Tyrnauer t25 SF=1..7
+MapType:                        topo
+MainUrl:            http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287 31466 31467
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287 SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Topographic Base Map|Topographic Base Map|997.805696859274|24945.1424214819
+#LayersUrlPart:     LAYERS=GeoAtlas_2008|GeoAtlas_2008||
+#LayersUrlPart:     LAYERS=m4m|m4m|1496.70854528891|498902.847930734
+#LayersUrlPart:     LAYERS=m2m|m2m|548.793133272601|1496.70804638606
+#LayersUrlPart:     LAYERS=m1m|m1m|299.341709057782|548.792634369752
+#LayersUrlPart:     LAYERS=m500k|m500k|114.748154041665|299.341210154934
+#LayersUrlPart:     LAYERS=m250k|m250k|37.4182125350712|114.747655138817
+#LayersUrlPart:     LAYERS=m100k_01|m100k_01|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_02|m100k_02|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_03|m100k_03|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_04|m100k_04|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_05|m100k_05|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m50k_01|m50k_01|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_02|m50k_02|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_03|m50k_03|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_04|m50k_04|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_05|m50k_05|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_06|m50k_06|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_07|m50k_07|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_08|m50k_08|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_09|m50k_09|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_10|m50k_10|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_11|m50k_11|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_12|m50k_12|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m25k_01|m25k_01|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_02|m25k_02|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_03|m25k_03|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_04|m25k_04|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_05|m25k_05|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_06|m25k_06|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_07|m25k_07|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_08|m25k_08|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_09|m25k_09|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_10|m25k_10|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_11|m25k_11|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_12|m25k_12|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_13|m25k_13|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_14|m25k_14|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_15|m25k_15|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_16|m25k_16|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_17|m25k_17|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_18|m25k_18|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_19|m25k_19|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_20|m25k_20|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_21|m25k_21|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_22|m25k_22|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_23|m25k_23|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_24|m25k_24|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_25|m25k_25|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_26|m25k_26|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_27|m25k_27|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_28|m25k_28|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_29|m25k_29|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_30|m25k_30|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_31|m25k_31|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_32|m25k_32|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_33|m25k_33|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_34|m25k_34|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_35|m25k_35|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_36|m25k_36|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_37|m25k_37|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_38|m25k_38|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=Countries|Countries||
+#LayersUrlPart:     LAYERS=National_Borders|National_Borders|0.000498902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=Nuts3_Borders|Nuts3_Borders|0.000498902848429637|2494.51424214819
+#LayersUrlPart:     LAYERS=Municipalities|Municipalities|0.000498902848429637|249.451923117667
+#LayersUrlPart:     LAYERS=m50k_01,m50k_02,m50k_03,m50k_04,m50k_05,m50k_06,m50k_07,m50k_08,m50k_09,m50k_10,m50k_11,m50k_12
+LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10,m25k_11,m25k_12,m25k_13,m25k_14,m25k_15,m25k_16,m25k_17,m25k_18,m25k_19,m25k_20,m25k_21,m25k_22,m25k_23,m25k_24,m25k_25,m25k_26,m25k_27,m25k_28,m25k_29,m25k_30,m25k_31,m25k_32,m25k_33,m25k_34,m25k_35,m25k_36,m25k_37,m25k_38
+##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+#Server
+#BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
+#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BBox_Mitte: N 47.60515 E 16.341865
+#real
+#BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
+#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#SK Tyrnauer
+BoundingBoxTopLeftWGS84: N 48.882582 E 16.927528
+BoundingBoxButtomRightWGS84: N 47.75606 E 18.08583
+#MinScale:   1
+#MaxScale:   26
+RecommendedScale:   2.5
+ImageFileExtension: .png



From araber95 at mail.berlios.de  Fri Sep 11 23:40:28 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 11 Sep 2009 23:40:28 +0200
Subject: [Cachewolf-svn] r2181 - trunk/res_noewe/webmapservices
Message-ID: <200909112140.n8BLeSfo014645@sheep.berlios.de>

Author: araber95
Date: 2009-09-11 23:40:25 +0200 (Fri, 11 Sep 2009)
New Revision: 2181

Added:
   trunk/res_noewe/webmapservices/hu-gs_t25.wms
   trunk/res_noewe/webmapservices/hu-va_t25.wms
Log:
Zentrope WMS hungary region Vas and region Gyor-Moson-Sopron

Added: trunk/res_noewe/webmapservices/hu-gs_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/hu-gs_t25.wms	2009-09-11 20:43:54 UTC (rev 2180)
+++ trunk/res_noewe/webmapservices/hu-gs_t25.wms	2009-09-11 21:40:25 UTC (rev 2181)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://www.centropemap.org
+GetCapabilitiesUrl: http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+#Name:               Oesterreich, Tschechien, Slowakei, Ungarn t100 SF=7..12
+#Name:               Centrope Oesterreich, Tschechien, Slowakei, Ungarn t25 SF=1..7
+Name:               HU.Gyor-Moson-Sopron t25 SF=1..7
+#Name:               HU.Gyor-Moson-Sopron t25 SF=1..7
+MapType:                        topo
+MainUrl:            http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287 31466 31467
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287 SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Topographic Base Map|Topographic Base Map|997.805696859274|24945.1424214819
+#LayersUrlPart:     LAYERS=GeoAtlas_2008|GeoAtlas_2008||
+#LayersUrlPart:     LAYERS=m4m|m4m|1496.70854528891|498902.847930734
+#LayersUrlPart:     LAYERS=m2m|m2m|548.793133272601|1496.70804638606
+#LayersUrlPart:     LAYERS=m1m|m1m|299.341709057782|548.792634369752
+#LayersUrlPart:     LAYERS=m500k|m500k|114.748154041665|299.341210154934
+#LayersUrlPart:     LAYERS=m250k|m250k|37.4182125350712|114.747655138817
+#LayersUrlPart:     LAYERS=m100k_01|m100k_01|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_02|m100k_02|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_03|m100k_03|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_04|m100k_04|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_05|m100k_05|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m50k_01|m50k_01|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_02|m50k_02|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_03|m50k_03|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_04|m50k_04|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_05|m50k_05|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_06|m50k_06|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_07|m50k_07|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_08|m50k_08|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_09|m50k_09|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_10|m50k_10|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_11|m50k_11|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_12|m50k_12|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m25k_01|m25k_01|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_02|m25k_02|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_03|m25k_03|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_04|m25k_04|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_05|m25k_05|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_06|m25k_06|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_07|m25k_07|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_08|m25k_08|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_09|m25k_09|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_10|m25k_10|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_11|m25k_11|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_12|m25k_12|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_13|m25k_13|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_14|m25k_14|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_15|m25k_15|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_16|m25k_16|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_17|m25k_17|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_18|m25k_18|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_19|m25k_19|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_20|m25k_20|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_21|m25k_21|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_22|m25k_22|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_23|m25k_23|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_24|m25k_24|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_25|m25k_25|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_26|m25k_26|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_27|m25k_27|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_28|m25k_28|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_29|m25k_29|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_30|m25k_30|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_31|m25k_31|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_32|m25k_32|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_33|m25k_33|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_34|m25k_34|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_35|m25k_35|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_36|m25k_36|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_37|m25k_37|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_38|m25k_38|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=Countries|Countries||
+#LayersUrlPart:     LAYERS=National_Borders|National_Borders|0.000498902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=Nuts3_Borders|Nuts3_Borders|0.000498902848429637|2494.51424214819
+#LayersUrlPart:     LAYERS=Municipalities|Municipalities|0.000498902848429637|249.451923117667
+#LayersUrlPart:     LAYERS=m50k_01,m50k_02,m50k_03,m50k_04,m50k_05,m50k_06,m50k_07,m50k_08,m50k_09,m50k_10,m50k_11,m50k_12
+LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10,m25k_11,m25k_12,m25k_13,m25k_14,m25k_15,m25k_16,m25k_17,m25k_18,m25k_19,m25k_20,m25k_21,m25k_22,m25k_23,m25k_24,m25k_25,m25k_26,m25k_27,m25k_28,m25k_29,m25k_30,m25k_31,m25k_32,m25k_33,m25k_34,m25k_35,m25k_36,m25k_37,m25k_38
+##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+#Server
+#BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
+#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BBox_Mitte: N 47.60515 E 16.341865
+#real
+#BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
+#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#HU Gyor-Moson-Sopron
+BoundingBoxTopLeftWGS84: N 48.027490 E 16.421143
+BoundingBoxButtomRightWGS84: N 47.392132 E 17.953978
+#MinScale:   1
+#MaxScale:   26
+RecommendedScale:   2.5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/hu-va_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/hu-va_t25.wms	2009-09-11 20:43:54 UTC (rev 2180)
+++ trunk/res_noewe/webmapservices/hu-va_t25.wms	2009-09-11 21:40:25 UTC (rev 2181)
@@ -0,0 +1,98 @@
+TakenFromUrl:       http://www.centropemap.org
+GetCapabilitiesUrl: http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+#Name:               Oesterreich, Tschechien, Slowakei, Ungarn t100 SF=7..12
+#Name:               Centrope Oesterreich, Tschechien, Slowakei, Ungarn t25 SF=1..7
+Name:               HU.Vas t25 SF=1..7
+#Name:               HU.Vas t25 SF=1..7
+MapType:                        topo
+MainUrl:            http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_topogr_background_2008.map&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31287 31466 31467
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31287 SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Topographic Base Map|Topographic Base Map|997.805696859274|24945.1424214819
+#LayersUrlPart:     LAYERS=GeoAtlas_2008|GeoAtlas_2008||
+#LayersUrlPart:     LAYERS=m4m|m4m|1496.70854528891|498902.847930734
+#LayersUrlPart:     LAYERS=m2m|m2m|548.793133272601|1496.70804638606
+#LayersUrlPart:     LAYERS=m1m|m1m|299.341709057782|548.792634369752
+#LayersUrlPart:     LAYERS=m500k|m500k|114.748154041665|299.341210154934
+#LayersUrlPart:     LAYERS=m250k|m250k|37.4182125350712|114.747655138817
+#LayersUrlPart:     LAYERS=m100k_01|m100k_01|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_02|m100k_02|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_03|m100k_03|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_04|m100k_04|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m100k_05|m100k_05|24.9456413243303|37.4177136322228
+#LayersUrlPart:     LAYERS=m50k_01|m50k_01|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_02|m50k_02|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_03|m50k_03|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_04|m50k_04|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_05|m50k_05|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_06|m50k_06|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_07|m50k_07|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_08|m50k_08|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_09|m50k_09|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_10|m50k_10|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_11|m50k_11|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m50k_12|m50k_12|12.4730701135894|24.9451424214819
+#LayersUrlPart:     LAYERS=m25k_01|m25k_01|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_02|m25k_02|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_03|m25k_03|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_04|m25k_04|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_05|m25k_05|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_06|m25k_06|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_07|m25k_07|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_08|m25k_08|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_09|m25k_09|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_10|m25k_10|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_11|m25k_11|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_12|m25k_12|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_13|m25k_13|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_14|m25k_14|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_15|m25k_15|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_16|m25k_16|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_17|m25k_17|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_18|m25k_18|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_19|m25k_19|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_20|m25k_20|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_21|m25k_21|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_22|m25k_22|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_23|m25k_23|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_24|m25k_24|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_25|m25k_25|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_26|m25k_26|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_27|m25k_27|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_28|m25k_28|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_29|m25k_29|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_30|m25k_30|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_31|m25k_31|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_32|m25k_32|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_33|m25k_33|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_34|m25k_34|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_35|m25k_35|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_36|m25k_36|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_37|m25k_37|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=m25k_38|m25k_38|0.000498902848429637|12.4725712107409
+#LayersUrlPart:     LAYERS=Countries|Countries||
+#LayersUrlPart:     LAYERS=National_Borders|National_Borders|0.000498902848429637|49890.2848429637
+#LayersUrlPart:     LAYERS=Nuts3_Borders|Nuts3_Borders|0.000498902848429637|2494.51424214819
+#LayersUrlPart:     LAYERS=Municipalities|Municipalities|0.000498902848429637|249.451923117667
+#LayersUrlPart:     LAYERS=m50k_01,m50k_02,m50k_03,m50k_04,m50k_05,m50k_06,m50k_07,m50k_08,m50k_09,m50k_10,m50k_11,m50k_12
+LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10,m25k_11,m25k_12,m25k_13,m25k_14,m25k_15,m25k_16,m25k_17,m25k_18,m25k_19,m25k_20,m25k_21,m25k_22,m25k_23,m25k_24,m25k_25,m25k_26,m25k_27,m25k_28,m25k_29,m25k_30,m25k_31,m25k_32,m25k_33,m25k_34,m25k_35,m25k_36,m25k_37,m25k_38
+##LayersUrlPart:     LAYERS=m25k_01,m25k_02,m25k_03,m25k_04,m25k_05,m25k_06,m25k_07,m25k_08,m25k_09,m25k_10
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+#Server
+#BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
+#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BBox_Mitte: N 47.60515 E 16.341865
+#real
+#BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
+#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#HU Vas
+BoundingBoxTopLeftWGS84: N 47.46660 E 16.11368
+BoundingBoxButtomRightWGS84: N 46.72205 E 17.33420
+#MinScale:   1
+#MaxScale:   26
+RecommendedScale:   2.5
+ImageFileExtension: .png



From mik77 at mail.berlios.de  Sat Sep 12 01:30:54 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 12 Sep 2009 01:30:54 +0200
Subject: [Cachewolf-svn] r2182 - in trunk/src/CacheWolf: . utils
Message-ID: <200909112330.n8BNUs3Y022097@sheep.berlios.de>

Author: mik77
Date: 2009-09-12 01:30:50 +0200 (Sat, 12 Sep 2009)
New Revision: 2182

Modified:
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/utils/FileBugfix.java
Log:
Correct determination of absolute path added to FileBugfix and used when reading index.xml.

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-11 21:40:25 UTC (rev 2181)
+++ trunk/src/CacheWolf/Profile.java	2009-09-11 23:30:50 UTC (rev 2182)
@@ -3,6 +3,7 @@
 import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.navi.Area;
 import CacheWolf.navi.TransformCoordinates;
+import CacheWolf.utils.FileBugfix;
 import ewe.io.BufferedWriter;
 import ewe.io.File;
 import ewe.io.FileNotFoundException;
@@ -234,7 +235,8 @@
 			int lastShownWpt=0;
 			char decSep = MyLocale.getDigSeparator().charAt(0);
 			char notDecSep = decSep == '.' ? ',' : '.';
-			FileReader in = new FileReader(dataDir + "index.xml");
+			FileBugfix indexFile = new FileBugfix(dataDir + "index.xml");
+			FileReader in = new FileReader(indexFile.getAbsolutePath());
 			indexXmlVersion = 1; // Initial guess
 			in.readLine(); // <?xml version= ...
 			String text = in.readLine(); // <CACHELIST>

Modified: trunk/src/CacheWolf/utils/FileBugfix.java
===================================================================
--- trunk/src/CacheWolf/utils/FileBugfix.java	2009-09-11 21:40:25 UTC (rev 2181)
+++ trunk/src/CacheWolf/utils/FileBugfix.java	2009-09-11 23:30:50 UTC (rev 2182)
@@ -115,6 +115,21 @@
 		return (ewefile.getDrivePath());
 	}
 
+	public String getAbsolutePath() {
+		String fullPath = ewefile.getFullPath();
+		int rel = fullPath.indexOf("/..");
+		while (rel > 0) {
+			int parent = fullPath.lastIndexOf("/", rel-1);
+			if (parent == -1) {
+				break;
+			}
+			fullPath = fullPath.substring(0, parent) + fullPath.substring(rel+3);
 
+			rel = fullPath.indexOf("/..");
+		}
+		return fullPath;
+	}
 
+
+
 }



From araber95 at mail.berlios.de  Sat Sep 12 22:25:05 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 12 Sep 2009 22:25:05 +0200
Subject: [Cachewolf-svn] r2183 - trunk/src/CacheWolf/navi
Message-ID: <200909122025.n8CKP5AW003577@sheep.berlios.de>

Author: araber95
Date: 2009-09-12 22:25:03 +0200 (Sat, 12 Sep 2009)
New Revision: 2183

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
removed some info-boxes of getting and loading maps

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-11 23:30:50 UTC (rev 2182)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-12 20:25:03 UTC (rev 2183)
@@ -109,9 +109,9 @@
 	 */
 	public MapInfoObject getBestMap(CWPoint ll, Rect screen, float scale, boolean forceScale) {
 		if (size() == 0) return null;
-		long start = new Time().getTime();
-		InfoBox progressBox = null;
-		boolean showprogress = false;
+		// long start = new Time().getTime();
+		// InfoBox progressBox = null;
+		// boolean showprogress = false;
 		String cmp = "FF1"+Area.getEasyFindString(ll, 30);
 		MapListEntry ml;
 		MapInfoObject mi;
@@ -123,14 +123,16 @@
 		Area screenArea = null; // getAreaForScreen(screen, lat, lon, bestMap.scale, bestMap);
 		float lastscale = -1;
 		int testkw = 0;
+		ewe.sys.Vm.showWait(true);
 		for (int i=size()-1; i >= 0 ;i--) {
+			/*
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
 				showprogress = true;      
 				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
 				progressBox.exec(); 
 				progressBox.waitUntilPainted(100);
-				ewe.sys.Vm.showWait(true);
 			}
+			*/
 			ml = (MapListEntry)get(i);
 			try {
 				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
@@ -170,10 +172,12 @@
 				}
 			}
 		}
+		/*
 		if (progressBox != null) {
 			progressBox.close(0);
-			ewe.sys.Vm.showWait(false);
 		}
+		*/
+		ewe.sys.Vm.showWait(false);
 		if (bestMap == null) return null;
 		return new MapInfoObject(bestMap); // return a copy of the MapInfoObject so that zooming won't change the MapInfoObject in the list 
 	}

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-11 23:30:50 UTC (rev 2182)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-12 20:25:03 UTC (rev 2183)
@@ -223,7 +223,7 @@
 		if (loadingMapList) return;
 		loadingMapList = true;
 		//this.mapPath = mapsPath;
-		Vm.showWait(this, true);
+		ewe.sys.Vm.showWait(this, true);
 		resetCenterOfMap();
 		InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
 		inf.exec();
@@ -238,7 +238,7 @@
 		maps.addEmptyMaps(lat); // the empty maps must be added last, otherwise in method setBestMap, when no mapt is available, a malfunction will happen, see there
 		dontUpdatePos = saveGpsIgnoreStatus;
 		inf.close(0);
-		Vm.showWait(this, false);
+		ewe.sys.Vm.showWait(this, false);
 		this.mapsloaded = true;
 		loadingMapList = false;
 	}
@@ -1461,14 +1461,16 @@
 			updateOnlyPosition(where, true); 
 			return;
 		}
-		Vm.showWait(true);
+		ewe.sys.Vm.showWait(this,true);
 		boolean saveIgnoreStatus;
 		saveIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;  // make updatePosition ignore calls during loading new map
+		/*
 		InfoBox inf;
 		inf = new InfoBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4216, "Loading map..."));
 		inf.show();
 		inf.waitUntilPainted(100);
+		*/
 		try {
 			this.currentMap = newmap; 
 			this.title = currentMap.mapName;
@@ -1503,8 +1505,8 @@
 			forceMapLoad = false;
 			directionArrows.setMap(currentMap);
 			updateScale();
-			inf.close(0);  // this doesn't work in a ticked-thread in the ewe-vm. That's why i made a new mThread in gotoPanel for ticked
-			Vm.showWait(false);
+			// !!! inf.close(0);  // this doesn't work in a ticked-thread in the ewe-vm. That's why i made a new mThread in gotoPanel for ticked
+			ewe.sys.Vm.showWait(this,false);
 			dontUpdatePos = saveIgnoreStatus;
 		} catch (IllegalArgumentException e) { // thrown by new AniImage() in ewe-vm if file not found;
 			if (mmp.mapImage != null) {
@@ -1514,8 +1516,8 @@
 			}
 			rebuildOverlaySet();
 			updateOnlyPosition(where, false);
-			inf.close(0);
-			Vm.showWait(false);
+			// !!! inf.close(0);
+			ewe.sys.Vm.showWait(this,false);
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4218, "Could not load map: \n")+ newmap.getImageFilename(), FormBase.OKB)).execute();
 			dontUpdatePos = saveIgnoreStatus;
 		} catch (OutOfMemoryError e) {
@@ -1526,8 +1528,8 @@
 			}
 			rebuildOverlaySet();
 			updateOnlyPosition(where, false);
-			inf.close(0);
-			Vm.showWait(false);
+			// !!! inf.close(0);
+			ewe.sys.Vm.showWait(this,false);
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4219, "Not enough memory to load map: \n") 
 					+ newmap.getImageFilename()
 					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 
@@ -1541,8 +1543,8 @@
 			}
 			rebuildOverlaySet();
 			updateOnlyPosition(where, false); // TODO this doesn't work correctly if the resolution changed, I guess because the pixels of PosCircle will be interpreted from the new resolution, but should be interpreted using the old resolution to test: select a map with a much greater value of m per pixel manually 
-			inf.close(0);
-			Vm.showWait(false);
+			// !!! inf.close(0);
+			ewe.sys.Vm.showWait(this,false);
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4221, "Not enough ressources to load map: ")
 					+ newmap.getImageFilename()
 					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 



From pfeffer at mail.berlios.de  Sun Sep 13 04:11:29 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 13 Sep 2009 04:11:29 +0200
Subject: [Cachewolf-svn] r2184 - trunk/src/CacheWolf/imp
Message-ID: <200909130211.n8D2BTBR015821@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-13 04:11:27 +0200 (Sun, 13 Sep 2009)
New Revision: 2184

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
OC download: bug fix: in some cases upper case letters were still created, causing problems when using the same data on linux and windows

OC download: show progress even when syncing single caches. One cache can take several minutes. If nothing is displayed I tend to think, cachewolf has crashed. That's why I enabled this status window

OC download: mak use of FileBugFixed


Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-12 20:25:03 UTC (rev 2183)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-13 02:11:27 UTC (rev 2184)
@@ -139,7 +139,7 @@
 
 		// this is only a dummy-InfoBox for capturing the output
 		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from " + hostname), InfoBox.PROGRESS_WITH_WARNINGS, false);
-
+		inf.exec();
 		String lastS; 
 		/** pref.downloadmissingOC = true, if not the last syncdate shall be used,
 		 *  but the caches shall be reloaded
@@ -632,7 +632,7 @@
 			imageInfo.setTitle(picDesc);
 			holder.getFreshDetails().images.add(imageInfo);
 			try {
-				File ftest = new File(profile.dataDir + fileName);
+				File ftest = new FileBugfix(profile.dataDir + fileName);
 				if (ftest.exists()){
 					imageInfo.setFilename(fileName);
 				}
@@ -729,8 +729,8 @@
 		//Vm.debug("Redirect: " + redirect);
 		CharArray realurl = new CharArray();
 		ByteArray daten = UrlFetcher.fetchByteArray(addr, realurl);
-		String address = realurl.toString();
-		if (holder != null) fileName = holder.getWayPoint() + "_" + Common.ClearForFileName(address.substring(address.lastIndexOf("/")+1));
+		// String address = realurl.toString();
+		// if (holder != null) fileName = holder.getWayPoint() + "_" + Common.ClearForFileName(address.substring(address.lastIndexOf("/")+1));
 		// else fileName = Common.ClearForFileName(address.substring(address.lastIndexOf("/")+1));
 
 		//save file



From araber95 at mail.berlios.de  Sun Sep 13 11:29:41 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 13 Sep 2009 11:29:41 +0200
Subject: [Cachewolf-svn] r2185 - trunk/src/CacheWolf/navi
Message-ID: <200909130929.n8D9Tf1F013415@sheep.berlios.de>

Author: araber95
Date: 2009-09-13 11:29:39 +0200 (Sun, 13 Sep 2009)
New Revision: 2185

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
reverted to previous commit: Infoboxes are necessary for debugging while developping new MovingMap.java

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-13 02:11:27 UTC (rev 2184)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-13 09:29:39 UTC (rev 2185)
@@ -109,9 +109,9 @@
 	 */
 	public MapInfoObject getBestMap(CWPoint ll, Rect screen, float scale, boolean forceScale) {
 		if (size() == 0) return null;
-		// long start = new Time().getTime();
-		// InfoBox progressBox = null;
-		// boolean showprogress = false;
+		long start = new Time().getTime();
+		InfoBox progressBox = null;
+		boolean showprogress = false;
 		String cmp = "FF1"+Area.getEasyFindString(ll, 30);
 		MapListEntry ml;
 		MapInfoObject mi;
@@ -123,16 +123,14 @@
 		Area screenArea = null; // getAreaForScreen(screen, lat, lon, bestMap.scale, bestMap);
 		float lastscale = -1;
 		int testkw = 0;
-		ewe.sys.Vm.showWait(true);
 		for (int i=size()-1; i >= 0 ;i--) {
-			/*
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
 				showprogress = true;      
 				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
 				progressBox.exec(); 
 				progressBox.waitUntilPainted(100);
+				ewe.sys.Vm.showWait(true);
 			}
-			*/
 			ml = (MapListEntry)get(i);
 			try {
 				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
@@ -172,12 +170,10 @@
 				}
 			}
 		}
-		/*
 		if (progressBox != null) {
 			progressBox.close(0);
+			ewe.sys.Vm.showWait(false);
 		}
-		*/
-		ewe.sys.Vm.showWait(false);
 		if (bestMap == null) return null;
 		return new MapInfoObject(bestMap); // return a copy of the MapInfoObject so that zooming won't change the MapInfoObject in the list 
 	}

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-13 02:11:27 UTC (rev 2184)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-13 09:29:39 UTC (rev 2185)
@@ -17,7 +17,6 @@
 import ewe.filechooser.FileChooser;
 import ewe.filechooser.FileChooserBase;
 import ewe.fx.*;
-import ewe.util.Iterator;
 import ewe.util.Vector;
 
 /**
@@ -82,17 +81,6 @@
 	
 	float lastHighestResolutionGPSDestScale = -1;
 
-	public static final int tileWidth = 100;
-	public static final int tileHeight = 100;
-
-	public boolean isFillWhiteArea() {
-		return pref.fillWhiteArea;
-	}
-
-	public void setFillWhiteArea(boolean fillWhiteArea) {
-		pref.fillWhiteArea = fillWhiteArea;
-	}
-
 	public MovingMap(Navigate nav, CacheDB cacheDB){
 		this.cacheDB = cacheDB;
 		this.myNavigation = nav;
@@ -223,7 +211,7 @@
 		if (loadingMapList) return;
 		loadingMapList = true;
 		//this.mapPath = mapsPath;
-		ewe.sys.Vm.showWait(this, true);
+		Vm.showWait(this, true);
 		resetCenterOfMap();
 		InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
 		inf.exec();
@@ -238,7 +226,7 @@
 		maps.addEmptyMaps(lat); // the empty maps must be added last, otherwise in method setBestMap, when no mapt is available, a malfunction will happen, see there
 		dontUpdatePos = saveGpsIgnoreStatus;
 		inf.close(0);
-		ewe.sys.Vm.showWait(this, false);
+		Vm.showWait(this, false);
 		this.mapsloaded = true;
 		loadingMapList = false;
 	}
@@ -971,49 +959,6 @@
 			return;
 		}
 		updateOnlyPosition(where, true);
-		
-		//Clean up any additional images, tiles will removed and any other item be added again later
-		Vector icons = new Vector ();
-		for (Iterator i = mmp.images.iterator(); i.hasNext();) {
-			AniImage im = (AniImage) i.next();
-			if ( (im instanceof MapImage) && (
-					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
-				i.remove();
-			}
-			else{
-				icons.add(im);
-				i.remove();
-			}
-		}
-		//Mark all tiles as dirty
-		MovingMapCache.getCache().clearUsedFlags ();
-		
-		Point mapPosx = getMapPositionOnScreen();
-		//Holds areas not filled by currentmap and/or used tiles
-		Vector rectangles = new Vector();
-		//calculate areas which will not drawn
-		Rect whiteArea = new Rect (0,0,width,height);
-		Rect blackArea = new Rect (mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
-		calculateRectangles(blackArea, whiteArea,rectangles);
-		//I've sometimes experienced an endless loop which might be caused by a bug in getBestMap. Therefore i will stop the loop after 30 runs
-		int count=0;
-		while (isFillWhiteArea() && currentMap.zoomFactor == 1.0 && !mapHidden && !rectangles.isEmpty() && count < 30){
-			count++;
-			try {
-			updateTileForWhiteArea(rectangles);
-			} catch (ewe.sys.SystemResourceException sre) {
-				setFillWhiteArea(false);
-				(new MessageBox("Error", "Not enough ressources to fill white ares, disabling this", MessageBox.OKB)).execute();
-			}
-		}		
-		//Remove all tiles not needed from the cache to reduce memory
-		MovingMapCache.getCache().cleanCache ();
-		//At Last redraw all icons on the map
-		for(Iterator i = icons.iterator(); i.hasNext();){
-			AniImage im = (AniImage) i.next();
-			mmp.addImage(im);
-		}
-		
 		if (!autoSelectMap) return;
 		Point mapPos = getMapPositionOnScreen();
 		boolean screenNotCompletlyCovered =  mmp.mapImage == null || (mmp.mapImage != null && ( mapPos.y > 0 || mapPos.x > 0 || mapPos.y+mmp.mapImage.getHeight()<this.height	|| mapPos.x+mmp.mapImage.getWidth()<this.width));
@@ -1029,183 +974,6 @@
 		}
 	}
 
-	private void updateTileForWhiteArea(Vector rectangles) {
-		Rect blackArea;
-		Rect r = (Rect) rectangles.get(0);
-		rectangles.removeElementAt(0);
-		//calculate the center of the rectangle and try to get an map for it
-		int middlewidth = r.x + (r.width)/2;
-		int middleheight = r.y + (r.height)/2;
-		CWPoint centerPoint = ScreenXY2LatLon(middlewidth, middleheight);
-		Rect screen = new Rect ();
-		screen.height = r.height ;//- r.y; 
-		screen.width = r.width ;//- r.x;
-		MapInfoObject bestMap = maps.getBestMap(centerPoint, screen, currentMap.scale, true);
-		if (bestMap == null){
-			//No map found, area must be left white
-			return;
-		}
-		//A map was found, but it does not contain the previously calculated center
-		if (!(bestMap.buttomright.latDec <= centerPoint.latDec && centerPoint.latDec <= bestMap.topleft.latDec)){
-			return;
-		}
-		if (!(bestMap.topleft.lonDec <= centerPoint.lonDec && centerPoint.lonDec <= bestMap.buttomright.lonDec)){
-			return;
-		}
-		//Pfeffer got an NPE in the following if-statement. I think the image-filename has got not the correct extension.
-		//For me, showing a message seems better than throwing the NPE
-		String imagefilename = bestMap.getImageFilename();
-		if (imagefilename == null){
-			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4217, "Could not find image associated with: \n")+currentMap.fileNameWFL, FormBase.OKB)).execute();
-			return;
-		}
-
-		if (!imagefilename.equals(currentMap.getImageFilename())) {
-			String filename = bestMap.getImageFilename();
-			if (filename.length() > 0) {
-				//calculate position of the new map on the screen
-				Point mapPos = new Point();
-				Point mapposint = bestMap.calcMapXY(posCircle.where);
-				mapPos.x = posCircleX - mapposint.x;
-				mapPos.y = posCircleY - mapposint.y;
-				Point mapDimension = bestMap.calcMapXY(bestMap.buttomright);
-				blackArea = new Rect (mapPos.x, mapPos.y, mapDimension.x, mapDimension.y);
-				//Are there any white areas left?
-				calculateRectangles(blackArea, r, rectangles);
-				//Not all maps have the dimension 1000x1000 Pixels, we cache this information:
-				Dimension rect2 = MovingMapCache.getCache().getDimension (filename);
-				MapImage fullImage = null;
-				if (rect2 == null){
-					fullImage = new MapImage(filename);
-					rect2 = new Dimension (fullImage.getHeight(), fullImage.getWidth());
-					MovingMapCache.getCache ().putDimension (filename, rect2);
-				}
-				generateTiles(blackArea, filename, mapPos, rect2, fullImage);
-			}
-		}
-	}
-
-	private void generateTiles(Rect blackArea, String filename, Point mapPos,
-			Dimension rect2, MapImage fullImage) {
-		//Generate tiles from the map
-		int numRows = ((rect2.height-1)/tileHeight)+1;
-		int numCols = ((rect2.width-1)/tileWidth)+1;
-		for (int row = 0; row < numRows; row++) {
-			for (int column = 0; column < numCols; column++) {
-				//Tile is not needed, don't process
-				if (!isCoveredByBlackArea(mapPos, row, column, blackArea, rect2)) {
-					continue;
-				}
-				//Get tile from cache or if not found, put all tiles for this image into the cache. 
-				MapImage im = MovingMapCache.getCache().get(filename, row, column);
-				if (im == null) {
-					if (fullImage == null){
-						fullImage = new MapImage(filename);
-					}
-					putImageIntoCache(filename, fullImage, mapPos, blackArea);
-					im = MovingMapCache.getCache().get(filename, row, column);
-				}
-				//If a tile has been found, draw it on the screen
-				if (im != null) {
-					im.setLocation(mapPos.x + (column * tileWidth), mapPos.y + (row * tileHeight));
-					mmp.addImage(im);
-				}
-			}
-		}
-	}
-
-	private void putImageIntoCache(String filename, MapImage fullImage, Point mapPos, Rect blackArea) {
-		MapImage im;
-		int numRows = (fullImage.getHeight()-1)/tileHeight + 1;
-		int numCols = (fullImage.getWidth()-1)/tileWidth + 1;
-		for (int row2 = 0; row2 < numRows; row2++) {
-			for (int column2 = 0; column2 < numCols; column2++) {
-				int realWidth = java.lang.Math.min(tileWidth, (fullImage.getWidth() - tileWidth*column2));
-				int realHeight = java.lang.Math.min(tileHeight, (fullImage.getHeight() - tileHeight*row2));
-				if (!isCoveredByBlackArea(mapPos, row2, column2, blackArea, new Dimension(fullImage.getWidth(), fullImage.getHeight()))){
-					continue;
-				}
-				Image image2 = new Image(realWidth, realHeight);
-				int[] pixels = new int[realWidth * realHeight];
-				fullImage.getPixels(pixels, 0, tileWidth * column2, tileHeight * row2, realWidth, realHeight, 0);
-				image2.setPixels(pixels, 0, 0, 0, realWidth, realHeight, 0);
-				im = new MapImage();
-				im.setImage(image2);
-
-				MovingMapCache.getCache().put(filename, row2, column2, im);
-			}
-		}
-	}
-
-	private boolean isCoveredByBlackArea (Point mapPos, int row,int column,Rect blackArea, Dimension mapDimension){
-		int realWidth = java.lang.Math.min(tileWidth, (mapDimension.width - tileWidth*column));
-		int realHeight = java.lang.Math.min(tileHeight, (mapDimension.height - tileHeight*row));
-		int left = mapPos.x + column * tileWidth;
-		int right = left + realWidth;
-		int top = mapPos.y + row * tileHeight;
-		int bottom = top +realHeight;
-		if (right < blackArea.x || bottom < blackArea.y){
-			return false;
-		}
-		if (left > blackArea.x + blackArea.width || top > blackArea.y + blackArea.height){
-			return false;
-		}
-		return true;
-	}
-	
-	private void calculateRectangles(Rect blackArea, Rect whiteArea, Vector rectangles) {
-		if (width == 0 || height == 0) return;
-		if (whiteArea.x >= width || whiteArea.y >= height) return;
-		
-		if (blackArea.x < 0){
-			blackArea.width += blackArea.x; 
-			blackArea.x =0;
-		}
-		if (blackArea.y < 0){
-			blackArea.height += blackArea.y; 
-			blackArea.y =0;
-		}
-		if (blackArea.x + blackArea.width > width){
-			blackArea.width = width - blackArea.x;
-		}
-		if (blackArea.y + blackArea.height > height){
-			blackArea.height = height - blackArea.y;
-		}
-		
-		if (blackArea.x > whiteArea.x) {
-			Rect r= new Rect ();
-			r.x = 0;
-			r.y = whiteArea.y;
-			r.width = blackArea.x;
-			r.height = whiteArea.height;
-			rectangles.add(r);
-		}
-		if (blackArea.y > whiteArea.y) {
-			Rect r= new Rect ();
-			r.x = whiteArea.x;
-			r.y = 0;
-			r.width = whiteArea.width;
-			r.height = blackArea.y;
-			rectangles.add(r);
-		}
-		if ((blackArea.y + blackArea.height) <  whiteArea.y + whiteArea.height) {
-			Rect r= new Rect ();
-			r.x = whiteArea.x;
-			r.y = blackArea.y + blackArea.height;
-			r.width = whiteArea.width;
-			r.height = (whiteArea.y + whiteArea.height) - r.y;
-			rectangles.add(r);
-		}
-		if ((blackArea.x + blackArea.width)<  whiteArea.x + whiteArea.width) {
-			Rect r= new Rect ();
-			r.x = blackArea.x + blackArea.width;
-			r.y = whiteArea.y;
-			r.width = (whiteArea.x + whiteArea.width) - r.x;
-			r.height = whiteArea.height;
-			rectangles.add(r);
-		}
-	}
-
 	public void updateGps(int fix) {
 		if (!running || ignoreGps) return;
 		// runMovingMap neccessary in case of multi-threaded Java-VM: ticked could be called during load of mmp 
@@ -1461,16 +1229,14 @@
 			updateOnlyPosition(where, true); 
 			return;
 		}
-		ewe.sys.Vm.showWait(this,true);
+		Vm.showWait(true);
 		boolean saveIgnoreStatus;
 		saveIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;  // make updatePosition ignore calls during loading new map
-		/*
 		InfoBox inf;
 		inf = new InfoBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4216, "Loading map..."));
 		inf.show();
 		inf.waitUntilPainted(100);
-		*/
 		try {
 			this.currentMap = newmap; 
 			this.title = currentMap.mapName;
@@ -1505,8 +1271,8 @@
 			forceMapLoad = false;
 			directionArrows.setMap(currentMap);
 			updateScale();
-			// !!! inf.close(0);  // this doesn't work in a ticked-thread in the ewe-vm. That's why i made a new mThread in gotoPanel for ticked
-			ewe.sys.Vm.showWait(this,false);
+			inf.close(0);  // this doesn't work in a ticked-thread in the ewe-vm. That's why i made a new mThread in gotoPanel for ticked
+			Vm.showWait(false);
 			dontUpdatePos = saveIgnoreStatus;
 		} catch (IllegalArgumentException e) { // thrown by new AniImage() in ewe-vm if file not found;
 			if (mmp.mapImage != null) {
@@ -1516,8 +1282,8 @@
 			}
 			rebuildOverlaySet();
 			updateOnlyPosition(where, false);
-			// !!! inf.close(0);
-			ewe.sys.Vm.showWait(this,false);
+			inf.close(0);
+			Vm.showWait(false);
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4218, "Could not load map: \n")+ newmap.getImageFilename(), FormBase.OKB)).execute();
 			dontUpdatePos = saveIgnoreStatus;
 		} catch (OutOfMemoryError e) {
@@ -1528,8 +1294,8 @@
 			}
 			rebuildOverlaySet();
 			updateOnlyPosition(where, false);
-			// !!! inf.close(0);
-			ewe.sys.Vm.showWait(this,false);
+			inf.close(0);
+			Vm.showWait(false);
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4219, "Not enough memory to load map: \n") 
 					+ newmap.getImageFilename()
 					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 
@@ -1543,8 +1309,8 @@
 			}
 			rebuildOverlaySet();
 			updateOnlyPosition(where, false); // TODO this doesn't work correctly if the resolution changed, I guess because the pixels of PosCircle will be interpreted from the new resolution, but should be interpreted using the old resolution to test: select a map with a much greater value of m per pixel manually 
-			// !!! inf.close(0);
-			ewe.sys.Vm.showWait(this,false);
+			inf.close(0);
+			Vm.showWait(false);
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4221, "Not enough ressources to load map: ")
 					+ newmap.getImageFilename()
 					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 
@@ -1749,10 +1515,8 @@
 	Menu mapsMenu;
 	MenuItem selectMapMI = new MenuItem(MyLocale.getMsg(4234, "Select a map manually$s"), new IconAndText(new mImage("map_open.png"), MyLocale.getMsg(4235, "Select a map manually"), null, CellConstants.RIGHT));
 	MenuItem changeMapDirMI = new MenuItem(MyLocale.getMsg(4236, "Change map directory$c"), new IconAndText(new mImage("map_cd.png"), MyLocale.getMsg(4237, "Change map directory"), null, CellConstants.RIGHT));
-	MenuItem showMapMI = new MenuItem(MyLocale.getMsg(4238, "Show map"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4239, "Show map"), null, CellConstants.RIGHT));
-	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4241, "Hide map"), null, CellConstants.RIGHT));
-	MenuItem fillMapMI = new MenuItem(MyLocale.getMsg(4267, "Show white areas"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4267, "Show white areas"), null, CellConstants.RIGHT));
-	MenuItem noFillMapMI = new MenuItem(MyLocale.getMsg(4266, "Fill white areas"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4266, "Fill white areas"), null, CellConstants.RIGHT));
+	MenuItem showMapMI = new MenuItem(MyLocale.getMsg(4238, "Show map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4239, "Show map"), null, CellConstants.RIGHT));
+	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4241, "Hide map"), null, CellConstants.RIGHT));
 	// automatic
 	MenuItem mapChangeModusMI = new MenuItem(MyLocale.getMsg(4242, "Modus for automatic map change"), MenuItem.Separator, null);;
 	MenuItem highestResGpsDestMI = new MenuItem(MyLocale.getMsg(4244, "Highest res. containing dest. & cur. position"), new IconAndText(new mImage("res_gps_goto.png"), MyLocale.getMsg(4245, "Highest res. containing dest. & cur. position"), null, CellConstants.RIGHT)); //immer h?chste Aufl?sung w?hlen, die akt. Pos. und Ziel enthalten 
@@ -1777,7 +1541,6 @@
 	boolean paintingZoomArea;
 	ImageList saveImageList = null;
 	int lastZoomWidth , lastZoomHeight;
-	
 	public MovingMapPanel(MovingMap f){
 		this.mm = f;
 		miLuminary = new MenuItem[SkyOrientation.LUMINARY_NAMES.length];
@@ -1958,12 +1721,7 @@
 				if (mm.mapHidden) mapsMenu.addItem(showMapMI);
 				else mapsMenu.addItem(hideMapMI);
 			}
-			if (mm.isFillWhiteArea()){
-				mapsMenu.addItem(fillMapMI);
-			}
-			else{
-				mapsMenu.addItem(noFillMapMI);
-			}
+
 			// automatic
 			highestResGpsDestMI.modifiers &= ~MenuItem.Checked;
 			highestResolutionMI.modifiers &= ~MenuItem.Checked;
@@ -2068,7 +1826,7 @@
 							mapsMenu.close();
 							chooseMap();
 						}
-						else if (action == changeMapDirMI)	{
+						if (action == changeMapDirMI)	{
 							mapsMenu.close();
 							FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().baseDir+"maps");
 							fc.addMask("*.wfl");
@@ -2079,64 +1837,52 @@
 								mm.forceMapLoad();
 							}
 						}
-						else if (action == fillMapMI){
-							mapsMenu.close ();
-							mm.setFillWhiteArea(false);
-							mm.updatePosition (mm.posCircle.where);
-							repaintNow();
-						}
-						else if (action == noFillMapMI){
-							mapsMenu.close ();
-							mm.setFillWhiteArea(true);
-							mm.updatePosition (mm.posCircle.where);
-							repaintNow();
-						}
 						//dont show map
-						else if (action == hideMapMI) {
+						if (action == hideMapMI) {
 							mapsMenu.close();
 							mm.hideMap();
 						}
 						// show map
-						else if (action == showMapMI) {
+						if (action == showMapMI) {
 							mapsMenu.close();
 							mm.showMap();
 						}
 						// map change modus
-						else if (action == highestResGpsDestMI) {
+						if (action == highestResGpsDestMI) {
 							mapsMenu.close();
 							mm.setResModus(MovingMap.HIGHEST_RESOLUTION_GPS_DEST);
 						}
-						else if (action == highestResolutionMI) {
+						if (action == highestResolutionMI) {
 							mapsMenu.close();
 							mm.setResModus(MovingMap.HIGHEST_RESOLUTION);
 						}
-						else if (action == keepManResolutionMI) {
+						if (action == keepManResolutionMI) {
 							mapsMenu.close();
 							mm.setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
 						}
 						// manually change map resolution
-						else if (action == moreDetailsMI) {
+						if (action == moreDetailsMI) {
 							mapsMenu.close();
 							mm.loadMoreDetailedMap(false);
 						} 
-						else if (action == moreOverviewMI) {
+						if (action == moreOverviewMI) {
 							mapsMenu.close();
 							mm.loadMoreDetailedMap(true);
 						}
-						else if (action == AllCachesResMI) {
+						if (action == AllCachesResMI) {
 							mapsMenu.close();
 							mm.loadMapForAllCaches();
 						}
 						// moveto position
-						else if (action == moveToCenterMI) {
+						if (action == moveToCenterMI) {
 							mapsMenu.close();
 							mm.setCenterOfScreen(Global.getPref().curCentrePt, true);
 						}
-						else if (action == moveToDestMI) {
+						if (action == moveToDestMI) {
 							mapsMenu.close();
 							mm.setCenterOfScreen(mm.gotoPos.where, true);
 						}
-						else if (action == moveToGpsMI) {
+						if (action == moveToGpsMI) {
 							mapsMenu.close();
 							this.snapToGps();						
 						}



From araber95 at mail.berlios.de  Sun Sep 13 18:18:04 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 13 Sep 2009 18:18:04 +0200
Subject: [Cachewolf-svn] r2186 - trunk/src/CacheWolf/navi
Message-ID: <200909131618.n8DGI4Iq005649@sheep.berlios.de>

Author: araber95
Date: 2009-09-13 18:18:03 +0200 (Sun, 13 Sep 2009)
New Revision: 2186

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
correcting revert. there went somthing wrong on last revert.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-13 09:29:39 UTC (rev 2185)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-13 16:18:03 UTC (rev 2186)
@@ -17,6 +17,7 @@
 import ewe.filechooser.FileChooser;
 import ewe.filechooser.FileChooserBase;
 import ewe.fx.*;
+import ewe.util.Iterator;
 import ewe.util.Vector;
 
 /**
@@ -81,6 +82,17 @@
 	
 	float lastHighestResolutionGPSDestScale = -1;
 
+	public static final int tileWidth = 100;
+	public static final int tileHeight = 100;
+
+	public boolean isFillWhiteArea() {
+		return pref.fillWhiteArea;
+	}
+
+	public void setFillWhiteArea(boolean fillWhiteArea) {
+		pref.fillWhiteArea = fillWhiteArea;
+	}
+
 	public MovingMap(Navigate nav, CacheDB cacheDB){
 		this.cacheDB = cacheDB;
 		this.myNavigation = nav;
@@ -959,6 +971,49 @@
 			return;
 		}
 		updateOnlyPosition(where, true);
+		
+		//Clean up any additional images, tiles will removed and any other item be added again later
+		Vector icons = new Vector ();
+		for (Iterator i = mmp.images.iterator(); i.hasNext();) {
+			AniImage im = (AniImage) i.next();
+			if ( (im instanceof MapImage) && (
+					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
+				i.remove();
+			}
+			else{
+				icons.add(im);
+				i.remove();
+			}
+		}
+		//Mark all tiles as dirty
+		MovingMapCache.getCache().clearUsedFlags ();
+		
+		Point mapPosx = getMapPositionOnScreen();
+		//Holds areas not filled by currentmap and/or used tiles
+		Vector rectangles = new Vector();
+		//calculate areas which will not drawn
+		Rect whiteArea = new Rect (0,0,width,height);
+		Rect blackArea = new Rect (mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
+		calculateRectangles(blackArea, whiteArea,rectangles);
+		//I've sometimes experienced an endless loop which might be caused by a bug in getBestMap. Therefore i will stop the loop after 30 runs
+		int count=0;
+		while (isFillWhiteArea() && currentMap.zoomFactor == 1.0 && !mapHidden && !rectangles.isEmpty() && count < 30){
+			count++;
+			try {
+			updateTileForWhiteArea(rectangles);
+			} catch (ewe.sys.SystemResourceException sre) {
+				setFillWhiteArea(false);
+				(new MessageBox("Error", "Not enough ressources to fill white ares, disabling this", MessageBox.OKB)).execute();
+			}
+		}		
+		//Remove all tiles not needed from the cache to reduce memory
+		MovingMapCache.getCache().cleanCache ();
+		//At Last redraw all icons on the map
+		for(Iterator i = icons.iterator(); i.hasNext();){
+			AniImage im = (AniImage) i.next();
+			mmp.addImage(im);
+		}
+		
 		if (!autoSelectMap) return;
 		Point mapPos = getMapPositionOnScreen();
 		boolean screenNotCompletlyCovered =  mmp.mapImage == null || (mmp.mapImage != null && ( mapPos.y > 0 || mapPos.x > 0 || mapPos.y+mmp.mapImage.getHeight()<this.height	|| mapPos.x+mmp.mapImage.getWidth()<this.width));
@@ -974,6 +1029,183 @@
 		}
 	}
 
+	private void updateTileForWhiteArea(Vector rectangles) {
+		Rect blackArea;
+		Rect r = (Rect) rectangles.get(0);
+		rectangles.removeElementAt(0);
+		//calculate the center of the rectangle and try to get an map for it
+		int middlewidth = r.x + (r.width)/2;
+		int middleheight = r.y + (r.height)/2;
+		CWPoint centerPoint = ScreenXY2LatLon(middlewidth, middleheight);
+		Rect screen = new Rect ();
+		screen.height = r.height ;//- r.y; 
+		screen.width = r.width ;//- r.x;
+		MapInfoObject bestMap = maps.getBestMap(centerPoint, screen, currentMap.scale, true);
+		if (bestMap == null){
+			//No map found, area must be left white
+			return;
+		}
+		//A map was found, but it does not contain the previously calculated center
+		if (!(bestMap.buttomright.latDec <= centerPoint.latDec && centerPoint.latDec <= bestMap.topleft.latDec)){
+			return;
+		}
+		if (!(bestMap.topleft.lonDec <= centerPoint.lonDec && centerPoint.lonDec <= bestMap.buttomright.lonDec)){
+			return;
+		}
+		//Pfeffer got an NPE in the following if-statement. I think the image-filename has got not the correct extension.
+		//For me, showing a message seems better than throwing the NPE
+		String imagefilename = bestMap.getImageFilename();
+		if (imagefilename == null){
+			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4217, "Could not find image associated with: \n")+currentMap.fileNameWFL, FormBase.OKB)).execute();
+			return;
+		}
+
+		if (!imagefilename.equals(currentMap.getImageFilename())) {
+			String filename = bestMap.getImageFilename();
+			if (filename.length() > 0) {
+				//calculate position of the new map on the screen
+				Point mapPos = new Point();
+				Point mapposint = bestMap.calcMapXY(posCircle.where);
+				mapPos.x = posCircleX - mapposint.x;
+				mapPos.y = posCircleY - mapposint.y;
+				Point mapDimension = bestMap.calcMapXY(bestMap.buttomright);
+				blackArea = new Rect (mapPos.x, mapPos.y, mapDimension.x, mapDimension.y);
+				//Are there any white areas left?
+				calculateRectangles(blackArea, r, rectangles);
+				//Not all maps have the dimension 1000x1000 Pixels, we cache this information:
+				Dimension rect2 = MovingMapCache.getCache().getDimension (filename);
+				MapImage fullImage = null;
+				if (rect2 == null){
+					fullImage = new MapImage(filename);
+					rect2 = new Dimension (fullImage.getHeight(), fullImage.getWidth());
+					MovingMapCache.getCache ().putDimension (filename, rect2);
+				}
+				generateTiles(blackArea, filename, mapPos, rect2, fullImage);
+			}
+		}
+	}
+
+	private void generateTiles(Rect blackArea, String filename, Point mapPos,
+			Dimension rect2, MapImage fullImage) {
+		//Generate tiles from the map
+		int numRows = ((rect2.height-1)/tileHeight)+1;
+		int numCols = ((rect2.width-1)/tileWidth)+1;
+		for (int row = 0; row < numRows; row++) {
+			for (int column = 0; column < numCols; column++) {
+				//Tile is not needed, don't process
+				if (!isCoveredByBlackArea(mapPos, row, column, blackArea, rect2)) {
+					continue;
+				}
+				//Get tile from cache or if not found, put all tiles for this image into the cache. 
+				MapImage im = MovingMapCache.getCache().get(filename, row, column);
+				if (im == null) {
+					if (fullImage == null){
+						fullImage = new MapImage(filename);
+					}
+					putImageIntoCache(filename, fullImage, mapPos, blackArea);
+					im = MovingMapCache.getCache().get(filename, row, column);
+				}
+				//If a tile has been found, draw it on the screen
+				if (im != null) {
+					im.setLocation(mapPos.x + (column * tileWidth), mapPos.y + (row * tileHeight));
+					mmp.addImage(im);
+				}
+			}
+		}
+	}
+
+	private void putImageIntoCache(String filename, MapImage fullImage, Point mapPos, Rect blackArea) {
+		MapImage im;
+		int numRows = (fullImage.getHeight()-1)/tileHeight + 1;
+		int numCols = (fullImage.getWidth()-1)/tileWidth + 1;
+		for (int row2 = 0; row2 < numRows; row2++) {
+			for (int column2 = 0; column2 < numCols; column2++) {
+				int realWidth = java.lang.Math.min(tileWidth, (fullImage.getWidth() - tileWidth*column2));
+				int realHeight = java.lang.Math.min(tileHeight, (fullImage.getHeight() - tileHeight*row2));
+				if (!isCoveredByBlackArea(mapPos, row2, column2, blackArea, new Dimension(fullImage.getWidth(), fullImage.getHeight()))){
+					continue;
+				}
+				Image image2 = new Image(realWidth, realHeight);
+				int[] pixels = new int[realWidth * realHeight];
+				fullImage.getPixels(pixels, 0, tileWidth * column2, tileHeight * row2, realWidth, realHeight, 0);
+				image2.setPixels(pixels, 0, 0, 0, realWidth, realHeight, 0);
+				im = new MapImage();
+				im.setImage(image2);
+
+				MovingMapCache.getCache().put(filename, row2, column2, im);
+			}
+		}
+	}
+
+	private boolean isCoveredByBlackArea (Point mapPos, int row,int column,Rect blackArea, Dimension mapDimension){
+		int realWidth = java.lang.Math.min(tileWidth, (mapDimension.width - tileWidth*column));
+		int realHeight = java.lang.Math.min(tileHeight, (mapDimension.height - tileHeight*row));
+		int left = mapPos.x + column * tileWidth;
+		int right = left + realWidth;
+		int top = mapPos.y + row * tileHeight;
+		int bottom = top +realHeight;
+		if (right < blackArea.x || bottom < blackArea.y){
+			return false;
+		}
+		if (left > blackArea.x + blackArea.width || top > blackArea.y + blackArea.height){
+			return false;
+		}
+		return true;
+	}
+	
+	private void calculateRectangles(Rect blackArea, Rect whiteArea, Vector rectangles) {
+		if (width == 0 || height == 0) return;
+		if (whiteArea.x >= width || whiteArea.y >= height) return;
+		
+		if (blackArea.x < 0){
+			blackArea.width += blackArea.x; 
+			blackArea.x =0;
+		}
+		if (blackArea.y < 0){
+			blackArea.height += blackArea.y; 
+			blackArea.y =0;
+		}
+		if (blackArea.x + blackArea.width > width){
+			blackArea.width = width - blackArea.x;
+		}
+		if (blackArea.y + blackArea.height > height){
+			blackArea.height = height - blackArea.y;
+		}
+		
+		if (blackArea.x > whiteArea.x) {
+			Rect r= new Rect ();
+			r.x = 0;
+			r.y = whiteArea.y;
+			r.width = blackArea.x;
+			r.height = whiteArea.height;
+			rectangles.add(r);
+		}
+		if (blackArea.y > whiteArea.y) {
+			Rect r= new Rect ();
+			r.x = whiteArea.x;
+			r.y = 0;
+			r.width = whiteArea.width;
+			r.height = blackArea.y;
+			rectangles.add(r);
+		}
+		if ((blackArea.y + blackArea.height) <  whiteArea.y + whiteArea.height) {
+			Rect r= new Rect ();
+			r.x = whiteArea.x;
+			r.y = blackArea.y + blackArea.height;
+			r.width = whiteArea.width;
+			r.height = (whiteArea.y + whiteArea.height) - r.y;
+			rectangles.add(r);
+		}
+		if ((blackArea.x + blackArea.width)<  whiteArea.x + whiteArea.width) {
+			Rect r= new Rect ();
+			r.x = blackArea.x + blackArea.width;
+			r.y = whiteArea.y;
+			r.width = (whiteArea.x + whiteArea.width) - r.x;
+			r.height = whiteArea.height;
+			rectangles.add(r);
+		}
+	}
+
 	public void updateGps(int fix) {
 		if (!running || ignoreGps) return;
 		// runMovingMap neccessary in case of multi-threaded Java-VM: ticked could be called during load of mmp 
@@ -1515,8 +1747,10 @@
 	Menu mapsMenu;
 	MenuItem selectMapMI = new MenuItem(MyLocale.getMsg(4234, "Select a map manually$s"), new IconAndText(new mImage("map_open.png"), MyLocale.getMsg(4235, "Select a map manually"), null, CellConstants.RIGHT));
 	MenuItem changeMapDirMI = new MenuItem(MyLocale.getMsg(4236, "Change map directory$c"), new IconAndText(new mImage("map_cd.png"), MyLocale.getMsg(4237, "Change map directory"), null, CellConstants.RIGHT));
-	MenuItem showMapMI = new MenuItem(MyLocale.getMsg(4238, "Show map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4239, "Show map"), null, CellConstants.RIGHT));
-	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4241, "Hide map"), null, CellConstants.RIGHT));
+	MenuItem showMapMI = new MenuItem(MyLocale.getMsg(4238, "Show map"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4239, "Show map"), null, CellConstants.RIGHT));
+	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4241, "Hide map"), null, CellConstants.RIGHT));
+	MenuItem fillMapMI = new MenuItem(MyLocale.getMsg(4267, "Show white areas"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4267, "Show white areas"), null, CellConstants.RIGHT));
+	MenuItem noFillMapMI = new MenuItem(MyLocale.getMsg(4266, "Fill white areas"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4266, "Fill white areas"), null, CellConstants.RIGHT));
 	// automatic
 	MenuItem mapChangeModusMI = new MenuItem(MyLocale.getMsg(4242, "Modus for automatic map change"), MenuItem.Separator, null);;
 	MenuItem highestResGpsDestMI = new MenuItem(MyLocale.getMsg(4244, "Highest res. containing dest. & cur. position"), new IconAndText(new mImage("res_gps_goto.png"), MyLocale.getMsg(4245, "Highest res. containing dest. & cur. position"), null, CellConstants.RIGHT)); //immer h?chste Aufl?sung w?hlen, die akt. Pos. und Ziel enthalten 
@@ -1541,6 +1775,7 @@
 	boolean paintingZoomArea;
 	ImageList saveImageList = null;
 	int lastZoomWidth , lastZoomHeight;
+	
 	public MovingMapPanel(MovingMap f){
 		this.mm = f;
 		miLuminary = new MenuItem[SkyOrientation.LUMINARY_NAMES.length];
@@ -1721,7 +1956,12 @@
 				if (mm.mapHidden) mapsMenu.addItem(showMapMI);
 				else mapsMenu.addItem(hideMapMI);
 			}
-
+			if (mm.isFillWhiteArea()){
+				mapsMenu.addItem(fillMapMI);
+			}
+			else{
+				mapsMenu.addItem(noFillMapMI);
+			}
 			// automatic
 			highestResGpsDestMI.modifiers &= ~MenuItem.Checked;
 			highestResolutionMI.modifiers &= ~MenuItem.Checked;
@@ -1826,7 +2066,7 @@
 							mapsMenu.close();
 							chooseMap();
 						}
-						if (action == changeMapDirMI)	{
+						else if (action == changeMapDirMI)	{
 							mapsMenu.close();
 							FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().baseDir+"maps");
 							fc.addMask("*.wfl");
@@ -1837,52 +2077,64 @@
 								mm.forceMapLoad();
 							}
 						}
+						else if (action == fillMapMI){
+							mapsMenu.close ();
+							mm.setFillWhiteArea(false);
+							mm.updatePosition (mm.posCircle.where);
+							repaintNow();
+						}
+						else if (action == noFillMapMI){
+							mapsMenu.close ();
+							mm.setFillWhiteArea(true);
+							mm.updatePosition (mm.posCircle.where);
+							repaintNow();
+						}
 						//dont show map
-						if (action == hideMapMI) {
+						else if (action == hideMapMI) {
 							mapsMenu.close();
 							mm.hideMap();
 						}
 						// show map
-						if (action == showMapMI) {
+						else if (action == showMapMI) {
 							mapsMenu.close();
 							mm.showMap();
 						}
 						// map change modus
-						if (action == highestResGpsDestMI) {
+						else if (action == highestResGpsDestMI) {
 							mapsMenu.close();
 							mm.setResModus(MovingMap.HIGHEST_RESOLUTION_GPS_DEST);
 						}
-						if (action == highestResolutionMI) {
+						else if (action == highestResolutionMI) {
 							mapsMenu.close();
 							mm.setResModus(MovingMap.HIGHEST_RESOLUTION);
 						}
-						if (action == keepManResolutionMI) {
+						else if (action == keepManResolutionMI) {
 							mapsMenu.close();
 							mm.setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
 						}
 						// manually change map resolution
-						if (action == moreDetailsMI) {
+						else if (action == moreDetailsMI) {
 							mapsMenu.close();
 							mm.loadMoreDetailedMap(false);
 						} 
-						if (action == moreOverviewMI) {
+						else if (action == moreOverviewMI) {
 							mapsMenu.close();
 							mm.loadMoreDetailedMap(true);
 						}
-						if (action == AllCachesResMI) {
+						else if (action == AllCachesResMI) {
 							mapsMenu.close();
 							mm.loadMapForAllCaches();
 						}
 						// moveto position
-						if (action == moveToCenterMI) {
+						else if (action == moveToCenterMI) {
 							mapsMenu.close();
 							mm.setCenterOfScreen(Global.getPref().curCentrePt, true);
 						}
-						if (action == moveToDestMI) {
+						else if (action == moveToDestMI) {
 							mapsMenu.close();
 							mm.setCenterOfScreen(mm.gotoPos.where, true);
 						}
-						if (action == moveToGpsMI) {
+						else if (action == moveToGpsMI) {
 							mapsMenu.close();
 							this.snapToGps();						
 						}



From pfeffer at mail.berlios.de  Mon Sep 14 01:29:14 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 14 Sep 2009 01:29:14 +0200
Subject: [Cachewolf-svn] r2187 - trunk/src/CacheWolf/imp
Message-ID: <200909132329.n8DNTEjD019822@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-14 01:29:11 +0200 (Mon, 14 Sep 2009)
New Revision: 2187

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
Opencaching download: removed a NullPointerException, reported here: http://forum.opencaching.pl/viewtopic.php?p=65319#65319

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-13 16:18:03 UTC (rev 2186)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-13 23:29:11 UTC (rev 2187)
@@ -139,6 +139,8 @@
 
 		// this is only a dummy-InfoBox for capturing the output
 		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from " + hostname), InfoBox.PROGRESS_WITH_WARNINGS, false);
+		inf.setPreferredSize(220, 300);
+		inf.relayout(false);
 		inf.exec();
 		String lastS; 
 		/** pref.downloadmissingOC = true, if not the last syncdate shall be used,
@@ -642,12 +644,20 @@
 					}
 				}
 			} catch (IOException e) {
-				String ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
-				if (e.getMessage().toLowerCase().equalsIgnoreCase("could not connect") ||
-						e.getMessage().equalsIgnoreCase("unkown host")) { 
+				String ErrMessage;
+				String wp, n;
+				if (holder != null && holder.getWayPoint() != null) wp = holder.getWayPoint();
+				else 												wp = new String("WP???");
+				if (holder != null && holder.getCacheName() != null) n = holder.getCacheName();
+				else 												 n = new String("name???");
+				
+				if (e.getMessage().equalsIgnoreCase("could not connect") ||
+					e.getMessage().equalsIgnoreCase("unkown host")) { 
 					// is there a better way to find out what happened?
-					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+holder.getCacheName() + " ("+holder.getWayPoint()+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
-				} 
+					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
+				} else
+					ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
+					
 				inf.addWarning("\n"+ErrMessage);
 				//(new MessageBox(MyLocale.getMsg(144, "Warning"), ErrMessage, MessageBox.OKB)).exec();
 				pref.log(ErrMessage);



From mik77 at mail.berlios.de  Mon Sep 14 20:31:18 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 14 Sep 2009 20:31:18 +0200
Subject: [Cachewolf-svn] r2188 - trunk/src/CacheWolf
Message-ID: <200909141831.n8EIVIeo003843@sheep.berlios.de>

Author: mik77
Date: 2009-09-14 20:31:15 +0200 (Mon, 14 Sep 2009)
New Revision: 2188

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/Profile.java
Log:
Some more bugfixes for relative path to data dir

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-09-13 23:29:11 UTC (rev 2187)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-09-14 18:31:15 UTC (rev 2188)
@@ -185,11 +185,21 @@
 			// If parent cache has empty waypoint then don't do anything. This might happen
 			// when a cache object is freshly created to serve as container for imported data
 			if (this.getParent().getWayPoint().equals(CacheHolder.EMPTY)) return;
-			
-			if (new FileBugfix(dir + getParent().getWayPoint().toLowerCase() + ".xml").exists()) in = new FileReader(dir+getParent().getWayPoint().toLowerCase() + ".xml");
+			FileBugfix cacheFile = new FileBugfix(dir + getParent().getWayPoint().toLowerCase() + ".xml");			
+			if (cacheFile.exists()) {
+				try {
+					in = new FileReader(cacheFile.getAbsolutePath());
+				} catch (FileNotFoundException e) {
+					in = null; //exception is thrown again below, if file could not be found in upper case, too
+				}
+			}
 			if (in == null) {
-				if (new FileBugfix(dir + getParent().getWayPoint() + ".xml").exists()) in = new FileReader(dir+getParent().getWayPoint() + ".xml");
+				cacheFile = new FileBugfix(dir + getParent().getWayPoint() + ".xml");			
+				if (cacheFile.exists()) {
+					in = new FileReader(cacheFile.getAbsolutePath());
+				}
 			}
+
 			if (in == null) throw new FileNotFoundException(dir+getParent().getWayPoint().toLowerCase()+".xml");
 			if (Global.getPref().debug) Global.getPref().log("Reading file "+getParent().getWayPoint() + ".xml");
 			String text= in.readAll();
@@ -343,7 +353,7 @@
 			}
 			//Vm.debug("Writing to: " +dir + "for: " + wayPoint);
 			try{
-			  detfile = new PrintWriter(new BufferedWriter(new FileWriter(dir + getParent().getWayPoint().toLowerCase() + ".xml")));
+			  detfile = new PrintWriter(new BufferedWriter(new FileWriter(new FileBugfix(dir + getParent().getWayPoint().toLowerCase() + ".xml").getAbsolutePath())));
 			} catch (Exception e) {
 				Global.getPref().log("Problem creating details file",e,true);
 				return;

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-13 23:29:11 UTC (rev 2187)
+++ trunk/src/CacheWolf/Profile.java	2009-09-14 18:31:15 UTC (rev 2188)
@@ -148,14 +148,16 @@
 		CacheHolder ch;
 		try {
 			File backup=new File(dataDir+"index.bak");
-			if (backup.exists()) backup.delete();
+			if (backup.exists()) {
+				backup.delete();
+			}
 			File index=new File(dataDir+"index.xml");
 			index.rename("index.bak");
 		} catch (Exception ex) {
 			pref.log("Error deleting backup or renaming index.xml");
 		}
 		try{
-			detfile = new PrintWriter(new BufferedWriter(new FileWriter(dataDir + "index.xml")));
+			detfile = new PrintWriter(new BufferedWriter(new FileWriter(new FileBugfix(dataDir + "index.xml").getAbsolutePath())));
 		} catch (Exception e) {
 			Vm.debug("Problem creating index file "+e.toString()+"\nFilename="+dataDir + "index.xml");
 			return;



From mik77 at mail.berlios.de  Mon Sep 14 22:04:31 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 14 Sep 2009 22:04:31 +0200
Subject: [Cachewolf-svn] r2189 - in trunk/src/CacheWolf: . navi
Message-ID: <200909142004.n8EK4VvM012302@sheep.berlios.de>

Author: mik77
Date: 2009-09-14 22:04:26 +0200 (Mon, 14 Sep 2009)
New Revision: 2189

Modified:
   trunk/src/CacheWolf/DataMover.java
   trunk/src/CacheWolf/NewProfileWizard.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/TravelbugJourneyList.java
   trunk/src/CacheWolf/navi/MapImporter.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
a more fundamental solution for relative data dir path

Modified: trunk/src/CacheWolf/DataMover.java
===================================================================
--- trunk/src/CacheWolf/DataMover.java	2009-09-14 18:31:15 UTC (rev 2188)
+++ trunk/src/CacheWolf/DataMover.java	2009-09-14 20:04:26 UTC (rev 2189)
@@ -239,7 +239,7 @@
 	
 	public String selectTargetDir() {
 		// Select destination directory
-		FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, pref.baseDir);
+		FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, pref.absoluteBaseDir);
 		fc.setTitle(MyLocale.getMsg(148,"Select Target directory"));
 		if(fc.execute() != FormBase.IDCANCEL){
 			return fc.getChosen() + "/";

Modified: trunk/src/CacheWolf/NewProfileWizard.java
===================================================================
--- trunk/src/CacheWolf/NewProfileWizard.java	2009-09-14 18:31:15 UTC (rev 2188)
+++ trunk/src/CacheWolf/NewProfileWizard.java	2009-09-14 20:04:26 UTC (rev 2189)
@@ -9,14 +9,14 @@
 	static public boolean startNewProfileWizard(ewe.ui.Frame parent) {
 		if (Global.mainTab != null) Global.mainTab.saveUnsavedChanges(true);
 		Preferences pref = Global.getPref();
-		NewProfileForm f=new NewProfileForm(pref.baseDir);
+		NewProfileForm f=new NewProfileForm(pref.absoluteBaseDir);
 		int code=f.execute(parent, Gui.CENTER_FRAME);
 		if (code==0) {
 			Profile profile = Global.getProfile();
 			profile.clearProfile(); 
 			pref.lastProfile=profile.name=f.profileDir;
 			pref.savePreferences(); // Remember that this was the last profile used
-			profile.dataDir=pref.baseDir+f.profileDir+"/";
+			profile.dataDir=pref.absoluteBaseDir+f.profileDir+"/";
 			
 			CoordsScreen cs = new CoordsScreen();
 			cs.setFields(new CWPoint(), TransformCoordinates.CW);

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-14 18:31:15 UTC (rev 2188)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-14 20:04:26 UTC (rev 2189)
@@ -115,7 +115,8 @@
 	//////////////////////////////////////////////////////////////////////////////////////
 
 	/** The base directory contains one subdirectory for each profile*/
-	public String baseDir = "";
+	private String baseDir = "";
+	public String absoluteBaseDir = "";
 	/** Name of last used profile */
 	public String lastProfile="";
 	/** If true, the last profile is reloaded automatically without a dialogue */
@@ -385,7 +386,7 @@
 		}
 
 		else if(name.equals("basedir")) {
-			baseDir = atts.getValue("dir");
+			setBaseDir(atts.getValue("dir"));
 		}
 		else if (name.equals("opencaching")) {
 			downloadmissingOC = Boolean.valueOf(atts.getValue("downloadmissing")).booleanValue();
@@ -570,7 +571,7 @@
 			outp.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n");
 			outp.print("<preferences>\n");
 			outp.print("    <locale language=\"" + SafeXML.clean(language) + "\"/>\n");
-			outp.print("    <basedir dir = \"" + SafeXML.clean(baseDir) + "\"/>\n");
+			outp.print("    <basedir dir = \"" + SafeXML.clean(getBaseDir()) + "\"/>\n");
 			outp.print("    <lastprofile autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\">" + SafeXML.clean(lastProfile) + "</lastprofile>\n"); //RB
 			outp.print("    <alias name =\""+ SafeXML.clean(myAlias) +"\" password=\""+SafeXML.clean(password)+"\" />\n");
 			outp.print("    <alias2 name =\""+ SafeXML.clean(myAlias2) +"\"/>\n");
@@ -675,7 +676,7 @@
 		ret = getMapManuallySavePath(false);
 		File t = new FileBugfix(ret);
 		String[] f = t.list("*.wfl", FileBase.LIST_FILES_ONLY);
-		if (f != null && f.length > 0) return  baseDir + mapsPath;
+		if (f != null && f.length > 0) return  absoluteBaseDir + mapsPath;
 		f = t.list("*.wfl", FileBase.LIST_DIRECTORIES_ONLY | FileBase.LIST_ALWAYS_INCLUDE_DIRECTORIES);
 		if (f != null && f.length > 0) { // see if in a subdir of <baseDir>/maps/standard are .wfl files
 			String[] f2;
@@ -716,7 +717,7 @@
 		// return getMapExpediaLoadPath();
 
 		//whole maps directory
-		return Global.getPref().baseDir.replace('\\', '/') + "maps";
+		return Global.getPref().absoluteBaseDir.replace('\\', '/') + "maps";
 	}
 
 	/**
@@ -725,7 +726,7 @@
 	 * this should be adjustable in preferences...
 	 */
 	public String getMapManuallySavePath(boolean create) {
-		String mapsDir = baseDir + mapsPath;
+		String mapsDir = absoluteBaseDir + mapsPath;
 		if (create && !(new FileBugfix(mapsDir).isDirectory())) { // dir exists?
 			if (new FileBugfix(mapsDir).mkdirs() == false) {// dir creation failed?
 				(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(172,"Error: cannot create maps directory: \n")+mapsDir, FormBase.OKB)).exec();
@@ -739,8 +740,8 @@
 	 * to this path the automatically downloaded maps are saved
 	 */
 	public String getMapDownloadSavePath(String mapkind) {
-		String subdir = Global.getProfile().dataDir.substring(Global.getPref().baseDir.length()).replace('\\', '/');
-		String mapsDir = Global.getPref().baseDir + "maps/" + Common.ClearForFileName(mapkind)+ "/" + subdir;
+		String subdir = Global.getProfile().dataDir.substring(Global.getPref().absoluteBaseDir.length()).replace('\\', '/');
+		String mapsDir = Global.getPref().absoluteBaseDir + "maps/" + Common.ClearForFileName(mapkind)+ "/" + subdir;
 		if (!(new FileBugfix(mapsDir).isDirectory())) { // dir exists?
 			if (new FileBugfix(mapsDir).mkdirs() == false) // dir creation failed?
 			{(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(172,"Error: cannot create maps directory: \n")+new FileBugfix(mapsDir).getParentFile(), FormBase.OKB)).exec();
@@ -751,7 +752,7 @@
 	}
 
 	public String getMapExpediaLoadPath() {
-		return Global.getPref().baseDir.replace('\\', '/') + "maps/expedia"; // baseDir has trailing /
+		return Global.getPref().absoluteBaseDir.replace('\\', '/') + "maps/expedia"; // baseDir has trailing /
 	}
 
     //////////////////////////////////////////////////////////////////////////////////////
@@ -786,22 +787,20 @@
 	 */
 	public boolean selectProfile(Profile prof, int showProfileSelector, boolean hasNewButton) {
 		// If datadir is empty, ask for one
-		if (baseDir.length()==0 || !(new FileBugfix(baseDir)).exists()) {
+		if (absoluteBaseDir.length()==0 || !(new FileBugfix(absoluteBaseDir)).exists()) {
 			do {
 				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, getHomeDir());
 				fc.title = MyLocale.getMsg(170,"Select base directory for cache data");
 				// If no base directory given, terminate
 				if (fc.execute() == FormBase.IDCANCEL) ewe.sys.Vm.exit(0);
-				baseDir = fc.getChosenFile().toString();
-			}while (!(new FileBugfix(baseDir)).exists());
+				setBaseDir(fc.getChosenFile().toString());
+			}while (!(new FileBugfix(absoluteBaseDir)).exists());
 		}
-		baseDir=baseDir.replace('\\','/');
-		if (!baseDir.endsWith("/")) baseDir+="/";
 		boolean profileExists=true;  // Assume that the profile exists
 		do {
 			if(!profileExists || (showProfileSelector==PROFILE_SELECTOR_FORCED_ON) ||
 					(showProfileSelector==PROFILE_SELECTOR_ONOROFF && !autoReloadLastProfile)){ // Ask for the profile
-				ProfilesForm f = new ProfilesForm(baseDir,lastProfile,!profileExists || hasNewButton);
+				ProfilesForm f = new ProfilesForm(absoluteBaseDir,lastProfile,!profileExists || hasNewButton);
 				int code = f.execute();
 				// If no profile chosen (includes a new one), terminate
 				if (code==-1) return false; // Cancel pressed
@@ -812,13 +811,13 @@
 				//curCentrePt.set(0,0); // No centre yet
 				lastProfile=f.newSelectedProfile;
 			}
-			profileExists=(new FileBugfix(baseDir+lastProfile)).exists();
+			profileExists=(new FileBugfix(absoluteBaseDir+lastProfile)).exists();
 			if (!profileExists) (new MessageBox(MyLocale.getMsg(144,"Warning"),
 					           MyLocale.getMsg(171,"Profile does not exist: ")+lastProfile,FormBase.MBOK)).execute();
 		} while (profileExists==false);
 		// Now we are sure that baseDir exists and basDir+profile exists
 		prof.name=lastProfile;
-		prof.dataDir=baseDir+lastProfile;
+		prof.dataDir=absoluteBaseDir+lastProfile;
 		prof.dataDir=prof.dataDir.replace('\\','/');
 		if (!prof.dataDir.endsWith("/")) prof.dataDir+='/';
 		savePreferences();
@@ -1033,5 +1032,18 @@
 	public String getPathToConfigFile() {
 		return pathToConfigFile;
 	}
+	
+	public String getBaseDir() {
+		return baseDir;
+	}
+	
+	public void setBaseDir(String dir) {
+		baseDir = dir;
+		baseDir=baseDir.replace('\\','/');
+		if (!baseDir.endsWith("/")) baseDir+="/";
+		absoluteBaseDir = new FileBugfix(baseDir).getAbsolutePath();
+		absoluteBaseDir=absoluteBaseDir.replace('\\','/');
+		if (!absoluteBaseDir.endsWith("/")) absoluteBaseDir+="/";
+	}
 
 }

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2009-09-14 18:31:15 UTC (rev 2188)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2009-09-14 20:04:26 UTC (rev 2189)
@@ -81,7 +81,7 @@
 		//frmDataDir.setTag(INSETS,new Insets(10,10,10,10));
 		frmDataDir.addLast(brwBt = new mButton(MyLocale.getMsg(604,"Browse")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.EAST));
 		DataDir = new mInput();
-		DataDir.setText(pref.baseDir);
+		DataDir.setText(pref.getBaseDir());
 		frmDataDir.addLast(DataDir.setTag(CellConstants.SPAN, new Dimension(3,1)),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
 		frmDataDir.addLast(chkAutoLoad = new mCheckBox(MyLocale.getMsg(629,"Autoload last profile")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		if (pref.autoReloadLastProfile) chkAutoLoad.setState(true);
@@ -284,7 +284,7 @@
 			if (ev.target == applyB){
 				//if (pref.currProfile == 0){
 					//pref.curCentrePt.set(btnCentre.getText());
-					pref.baseDir = DataDir.getText();
+					pref.setBaseDir(DataDir.getText());
 				//}
 				pref.fontSize = Convert.toInt(fontSize.getText());
 				if (pref.fontSize<6) pref.fontSize=11;
@@ -332,7 +332,7 @@
 				this.close(0);
 			}
 			if(ev.target == brwBt){
-				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, pref.baseDir);
+				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, pref.getBaseDir());
 				fc.setTitle(MyLocale.getMsg(616,"Select directory"));
 				if(fc.execute() != FormBase.IDCANCEL)	DataDir.setText(fc.getChosen()+"/");
 			}

Modified: trunk/src/CacheWolf/TravelbugJourneyList.java
===================================================================
--- trunk/src/CacheWolf/TravelbugJourneyList.java	2009-09-14 18:31:15 UTC (rev 2188)
+++ trunk/src/CacheWolf/TravelbugJourneyList.java	2009-09-14 20:04:26 UTC (rev 2189)
@@ -101,7 +101,7 @@
 	 */
 	public boolean readTravelbugsFile(){
 		try{
-			String datei = Global.getPref().baseDir + "/" + "travelbugs.xml";
+			String datei = Global.getPref().absoluteBaseDir + "/" + "travelbugs.xml";
 			datei = datei.replace('\\', '/');
 			ewe.io.Reader r = new ewe.io.InputStreamReader(new ewe.io.FileInputStream(datei));
 			parse(r);
@@ -159,7 +159,7 @@
 	 * Method to save current travelbugs in the travelbugs.xml file
 	 */
 	public void saveTravelbugsFile(){
-		String baseDir=Global.getPref().baseDir;
+		String baseDir=Global.getPref().absoluteBaseDir;
 		try {
 			File backup=new File(baseDir+"travelbugs.bak");
 			if (backup.exists()) backup.delete();

Modified: trunk/src/CacheWolf/navi/MapImporter.java
===================================================================
--- trunk/src/CacheWolf/navi/MapImporter.java	2009-09-14 18:31:15 UTC (rev 2188)
+++ trunk/src/CacheWolf/navi/MapImporter.java	2009-09-14 20:04:26 UTC (rev 2189)
@@ -121,7 +121,7 @@
 	 */
 	public int importMap(){
 		String rawFileName = new String();
-		FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().baseDir);
+		FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().absoluteBaseDir);
 		fc.addMask("*.png,*.gif,*.bmp,*.jpg");
 		fc.setTitle(MyLocale.getMsg(4100,"Select Directory:"));
 		int tmp = fc.execute() ; 

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-14 18:31:15 UTC (rev 2188)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-14 20:04:26 UTC (rev 2189)
@@ -2068,7 +2068,7 @@
 						}
 						else if (action == changeMapDirMI)	{
 							mapsMenu.close();
-							FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().baseDir+"maps");
+							FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().absoluteBaseDir+"maps");
 							fc.addMask("*.wfl");
 							fc.setTitle(MyLocale.getMsg(4200,"Select map directory:"));
 							if(fc.execute() != FormBase.IDCANCEL){



From araber95 at mail.berlios.de  Tue Sep 15 13:57:08 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 15 Sep 2009 13:57:08 +0200
Subject: [Cachewolf-svn] r2190 - trunk/src/CacheWolf/navi
Message-ID: <200909151157.n8FBv8ts012460@sheep.berlios.de>

Author: araber95
Date: 2009-09-15 13:57:03 +0200 (Tue, 15 Sep 2009)
New Revision: 2190

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
some minor corrections for showing white areas. inserting debug code for white areas. switch on with inserting <debug value="true" /> into pref.xml

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-14 20:04:26 UTC (rev 2189)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-15 11:57:03 UTC (rev 2190)
@@ -124,12 +124,15 @@
 		float lastscale = -1;
 		int testkw = 0;
 		for (int i=size()-1; i >= 0 ;i--) {
-			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
-				showprogress = true;      
-				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
-				progressBox.exec(); 
-				progressBox.waitUntilPainted(100);
-				ewe.sys.Vm.showWait(true);
+			if (Global.getPref().debug) {
+				if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
+					showprogress = true;      
+					progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
+					progressBox.exec(); 
+					progressBox.waitUntilPainted(100);
+					ewe.sys.Vm.showWait(true);
+					Global.getPref().log(MyLocale.getMsg(4701,"Searching for best map"));
+				}
 			}
 			ml = (MapListEntry)get(i);
 			try {

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-14 20:04:26 UTC (rev 2189)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-15 11:57:03 UTC (rev 2190)
@@ -223,11 +223,14 @@
 		if (loadingMapList) return;
 		loadingMapList = true;
 		//this.mapPath = mapsPath;
-		Vm.showWait(this, true);
+		InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
+		if (Global.getPref().debug) {
+			Vm.showWait(this, true);
+			inf.exec();
+			inf.waitUntilPainted(100);
+			Global.getPref().log(MyLocale.getMsg(4203, "Loading list of maps..."));
+		}
 		resetCenterOfMap();
-		InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
-		inf.exec();
-		inf.waitUntilPainted(100);
 		boolean saveGpsIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;
 		maps = new MapsList(mapsPath); // this actually loads the maps
@@ -768,7 +771,9 @@
 	 * @return
 	 */
 	public Point getMapPositionOnScreen() {
-		if (currentMap == null || !posCircle.where.isValid()) return new Point(pref.myAppWidth +1, pref.myAppHeight +1); // in case no calculation is possible return somthing outside of the screen
+		if (currentMap == null || !posCircle.where.isValid()) 
+			return new Point(pref.myAppWidth +1, pref.myAppHeight +1); 
+		// in case no calculation is possible return somthing outside of the screen
 		Point mapPos = new Point(); 
 		//if (mmp.mapImage != null) mmp.mapImage.getLocation(mapPos);
 		//else {
@@ -972,67 +977,75 @@
 		}
 		updateOnlyPosition(where, true);
 		
-		//Clean up any additional images, tiles will removed and any other item be added again later
-		Vector icons = new Vector ();
-		for (Iterator i = mmp.images.iterator(); i.hasNext();) {
-			AniImage im = (AniImage) i.next();
-			if ( (im instanceof MapImage) && (
-					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
-				i.remove();
+		Point mapPos = getMapPositionOnScreen();
+		boolean screenNotCompletlyCovered =  mmp.mapImage == null || (mmp.mapImage != null && ( mapPos.y > 0 || mapPos.x > 0 || mapPos.y+mmp.mapImage.getHeight()<this.height	|| mapPos.x+mmp.mapImage.getWidth()<this.width));
+		if (autoSelectMap) {
+			if (forceMapLoad || wantMapTest|| screenNotCompletlyCovered) 	{
+				//Vm.debug("Screen not completly covered by map");
+				if (forceMapLoad || (java.lang.Math.abs(lastCompareX-mapPos.x) > this.width/10 || java.lang.Math.abs(lastCompareY-mapPos.y) > this.height/10)) {
+					// more then 1/10 of screen moved since last time we tried to find a better map
+					lastCompareX = mapPos.x;
+					lastCompareY = mapPos.y;
+					setBestMap(where, true);
+					forceMapLoad = false;
+					// update for checking of whitearea 
+					if (!inBestMap) {
+						// map changed
+						mapPos = getMapPositionOnScreen();
+						screenNotCompletlyCovered =  mmp.mapImage == null || (mmp.mapImage != null && ( mapPos.y > 0 || mapPos.x > 0 || mapPos.y+mmp.mapImage.getHeight()<this.height	|| mapPos.x+mmp.mapImage.getWidth()<this.width));
+					}
+				}
 			}
-			else{
-				icons.add(im);
-				i.remove();
-			}
 		}
-		//Mark all tiles as dirty
-		MovingMapCache.getCache().clearUsedFlags ();
 		
-		Point mapPosx = getMapPositionOnScreen();
-		//Holds areas not filled by currentmap and/or used tiles
-		Vector rectangles = new Vector();
-		//calculate areas which will not drawn
-		Rect whiteArea = new Rect (0,0,width,height);
-		Rect blackArea = new Rect (mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
-		calculateRectangles(blackArea, whiteArea,rectangles);
-		//I've sometimes experienced an endless loop which might be caused by a bug in getBestMap. Therefore i will stop the loop after 30 runs
-		int count=0;
-		while (isFillWhiteArea() && currentMap.zoomFactor == 1.0 && !mapHidden && !rectangles.isEmpty() && count < 30){
-			count++;
-			try {
-			updateTileForWhiteArea(rectangles);
-			} catch (ewe.sys.SystemResourceException sre) {
-				setFillWhiteArea(false);
-				(new MessageBox("Error", "Not enough ressources to fill white ares, disabling this", MessageBox.OKB)).execute();
+		if (isFillWhiteArea() && screenNotCompletlyCovered) {
+        	if (Global.getPref().debug) {Global.getPref().log("updatePosition : "+where.toString(TransformCoordinates.DD));}
+			//Clean up any additional images, tiles will removed and any other item be added again later
+			Vector icons = new Vector ();
+			for (Iterator i = mmp.images.iterator(); i.hasNext();) {
+				AniImage im = (AniImage) i.next();
+				if ( (im instanceof MapImage) && (
+					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
+						i.remove();
+				}
+				else{
+					icons.add(im);
+					i.remove();
+				}
 			}
-		}		
-		//Remove all tiles not needed from the cache to reduce memory
-		MovingMapCache.getCache().cleanCache ();
-		//At Last redraw all icons on the map
-		for(Iterator i = icons.iterator(); i.hasNext();){
-			AniImage im = (AniImage) i.next();
-			mmp.addImage(im);
+			//Mark all tiles as dirty
+			MovingMapCache.getCache().clearUsedFlags ();
+			//Holds areas not filled by currentMap and/or used tiles
+			Vector rectangles = new Vector();
+			//calculate areas which will not drawn
+			Rect whiteArea = new Rect (0,0,width,height);
+			Rect blackArea = new Rect (mapPos.x, mapPos.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
+			calculateRectangles(blackArea, whiteArea,rectangles);
+        	//I've sometimes experienced an endless loop which might be caused by a bug in getBestMap. Therefore i will stop the loop after 30 runs
+			int count=0;
+			while (isFillWhiteArea() && currentMap.zoomFactor == 1.0 && !mapHidden && count<rectangles.getCount() && count < 30){
+				try {
+					updateTileForWhiteArea(rectangles,count);
+				} catch (ewe.sys.SystemResourceException sre) {
+					setFillWhiteArea(false);
+					(new MessageBox("Error", "Not enough ressources to fill white ares, disabling this", MessageBox.OKB)).execute();
+				}
+				count++;
+			}		
+			//Remove all tiles not needed from the cache to reduce memory
+			MovingMapCache.getCache().cleanCache ();
+			//At Last redraw all icons on the map
+			for(Iterator i = icons.iterator(); i.hasNext();){
+				AniImage im = (AniImage) i.next();
+				mmp.addImage(im);
+			}	
+        	if (Global.getPref().debug) {Global.getPref().log("End updatePosition : "+where.toString(TransformCoordinates.DD)+"\n");}
 		}
-		
-		if (!autoSelectMap) return;
-		Point mapPos = getMapPositionOnScreen();
-		boolean screenNotCompletlyCovered =  mmp.mapImage == null || (mmp.mapImage != null && ( mapPos.y > 0 || mapPos.x > 0 || mapPos.y+mmp.mapImage.getHeight()<this.height	|| mapPos.x+mmp.mapImage.getWidth()<this.width));
-		if (forceMapLoad || wantMapTest|| screenNotCompletlyCovered) 	{ // if force || want || map doesn't cover the scree completly
-			//Vm.debug("Screen not completly covered by map");
-			if (forceMapLoad || (java.lang.Math.abs(lastCompareX-mapPos.x) > this.width/10 || java.lang.Math.abs(lastCompareY-mapPos.y) > this.height/10)) {
-				// more then 1/10 of screen moved since last time we tried to find a better map
-				lastCompareX = mapPos.x;
-				lastCompareY = mapPos.y;
-				setBestMap(where, screenNotCompletlyCovered);
-				forceMapLoad = false;
-			}
-		}
 	}
 
-	private void updateTileForWhiteArea(Vector rectangles) {
+	private void updateTileForWhiteArea(Vector rectangles, int at) {
 		Rect blackArea;
-		Rect r = (Rect) rectangles.get(0);
-		rectangles.removeElementAt(0);
+		Rect r = (Rect) rectangles.get(at);
 		//calculate the center of the rectangle and try to get an map for it
 		int middlewidth = r.x + (r.width)/2;
 		int middleheight = r.y + (r.height)/2;
@@ -1084,7 +1097,7 @@
 			}
 		}
 	}
-
+	
 	private void generateTiles(Rect blackArea, String filename, Point mapPos,
 			Dimension rect2, MapImage fullImage) {
 		//Generate tiles from the map
@@ -1152,11 +1165,18 @@
 		}
 		return true;
 	}
+
+	private String SRect(Rect r){
+		String OL, UR ;
+		OL= " ("+String.valueOf(r.x)+","+String.valueOf(r.y)+")";
+		UR= " ("+String.valueOf(r.x+r.width)+","+String.valueOf(r.y+r.height)+") ";
+		return OL+" :"+UR;
+	}
 	
 	private void calculateRectangles(Rect blackArea, Rect whiteArea, Vector rectangles) {
 		if (width == 0 || height == 0) return;
 		if (whiteArea.x >= width || whiteArea.y >= height) return;
-		
+		if (Global.getPref().debug) {Global.getPref().log("Compare"+SRect(whiteArea)+"with"+SRect(blackArea)+" (blackarea)");}
 		if (blackArea.x < 0){
 			blackArea.width += blackArea.x; 
 			blackArea.x =0;
@@ -1179,6 +1199,7 @@
 			r.width = blackArea.x;
 			r.height = whiteArea.height;
 			rectangles.add(r);
+			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
 		}
 		if (blackArea.y > whiteArea.y) {
 			Rect r= new Rect ();
@@ -1187,6 +1208,7 @@
 			r.width = whiteArea.width;
 			r.height = blackArea.y;
 			rectangles.add(r);
+			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
 		}
 		if ((blackArea.y + blackArea.height) <  whiteArea.y + whiteArea.height) {
 			Rect r= new Rect ();
@@ -1195,6 +1217,7 @@
 			r.width = whiteArea.width;
 			r.height = (whiteArea.y + whiteArea.height) - r.y;
 			rectangles.add(r);
+			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
 		}
 		if ((blackArea.x + blackArea.width)<  whiteArea.x + whiteArea.width) {
 			Rect r= new Rect ();
@@ -1203,6 +1226,7 @@
 			r.width = (whiteArea.x + whiteArea.width) - r.x;
 			r.height = whiteArea.height;
 			rectangles.add(r);
+			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
 		}
 	}
 
@@ -1247,8 +1271,10 @@
 	 * 
 	 * @param lat
 	 * @param lon
-	 * @param loadIfSameScale false: will not change the map if the better map has the same scale as the current - this is used not to change the map if it covers already the screen completely
-	 * true: willchange the map, regardless of change in scale
+	 * @param loadIfSameScale 
+	 * 			false: will not change the map if the better map has the same scale as the current
+	 * 			  - this is used not to change the map if it covers already the screen completely
+	 * 			true: willchange the map, regardless of change in scale
 	 */
 	public void setBestMap(CWPoint where, boolean loadIfSameScale) {
 		if (inBestMap) return;
@@ -1467,8 +1493,11 @@
 		dontUpdatePos = true;  // make updatePosition ignore calls during loading new map
 		InfoBox inf;
 		inf = new InfoBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4216, "Loading map..."));
-		inf.show();
-		inf.waitUntilPainted(100);
+		if (Global.getPref().debug) {
+			inf.show();
+			inf.waitUntilPainted(100);
+			Global.getPref().log(MyLocale.getMsg(4216, "Loading map..."));
+		}
 		try {
 			this.currentMap = newmap; 
 			this.title = currentMap.mapName;



From araber95 at mail.berlios.de  Tue Sep 15 22:43:55 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 15 Sep 2009 22:43:55 +0200
Subject: [Cachewolf-svn] r2191 - trunk/src/CacheWolf
Message-ID: <200909152043.n8FKhto7021675@sheep.berlios.de>

Author: araber95
Date: 2009-09-15 22:43:53 +0200 (Tue, 15 Sep 2009)
New Revision: 2191

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
1) inserting chrome as possible browser on windows when starting fresh and installed then its the default browser;
2) starting with ProfilePreferences : profpref.xml in each profile-dir : first for mapspath per profile : does work when starting new : maplist reread on change profile will come soon.

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-15 11:57:03 UTC (rev 2190)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-15 20:43:53 UTC (rev 2191)
@@ -264,6 +264,8 @@
 	public int myAppWidth = 800;
 	/** True if the preferences were changed and need to be saved */
 	public boolean dirty = false;
+	
+	private String pathToProfile;
 
     //////////////////////////////////////////////////////////////////////////////////////
     // Read pref.xml file
@@ -304,8 +306,10 @@
 		String testlist[] = null;
 		if (pf.equals("Java") || pf.equals("Win32")) {
 			String progdir = Vm.getenv("ProgramFiles", null); // at least in java-Win XP this is set
+			String homedir=Vm.getenv("HOMEPATH", "");
 			if (progdir != null) {
 				String test[] = {
+						homedir+"/Lokale Einstellungen/Anwendungsdaten/Google/Chrome/Application/chrome.exe",
 						progdir+"/Firefox/firefox.exe",
 						progdir+"/Opera/opera.exe",
 						progdir+"/Internet Explorer/iexplore.exe"};
@@ -444,7 +448,7 @@
 			if (tmp != null) solverDegMode=Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("mapspath")) {
-			customMapsPath=atts.getValue("dir").replace('\\', '/');
+			customMapsPath=atts.getValue("dir").replace('\\', '/');			
 		}
 		else if (name.equals("debug")) debug=Boolean.valueOf(atts.getValue("value")).booleanValue();
 
@@ -645,10 +649,34 @@
 	   return customMapsPath;
 	}
 
+	private void saveProfilePreferences() {
+		PrintWriter outp;
+		try{
+			outp = new PrintWriter(new BufferedWriter(new FileWriter(new FileBugfix(pathToProfile + "profpref.xml").getAbsolutePath())));
+			outp.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n");
+			outp.print("<preferences>\n");
+			outp.print("    <mapspath dir = \"" + customMapsPath + "\"/>\n");
+			outp.print("</preferences>");
+			outp.close();
+		}catch(Exception e){
+		}
+	}	
+	
+	private void getProfilePreferences() {
+		String fn = new FileBugfix(pathToProfile + "profpref.xml").getAbsolutePath();
+		try{
+			ewe.io.Reader r = new ewe.io.InputStreamReader(new ewe.io.FileInputStream(fn));
+			parse(r);
+			r.close();
+		}catch(Exception e){
+		}
+	}
+	
 	public void saveCustomMapsPath(String mapspath_) {
 		if (customMapsPath == null || !customMapsPath.equals(mapspath_)) {
 			customMapsPath=new String(mapspath_).replace('\\', '/');
 			savePreferences();
+			saveProfilePreferences();
 		}
 	}
 
@@ -820,6 +848,8 @@
 		prof.dataDir=absoluteBaseDir+lastProfile;
 		prof.dataDir=prof.dataDir.replace('\\','/');
 		if (!prof.dataDir.endsWith("/")) prof.dataDir+='/';
+		pathToProfile=prof.dataDir;
+		getProfilePreferences();
 		savePreferences();
 		return true;
 	}



From pfeffer at mail.berlios.de  Wed Sep 16 15:00:20 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 16 Sep 2009 15:00:20 +0200
Subject: [Cachewolf-svn] r2192 - trunk/src/CacheWolf
Message-ID: <200909161300.n8GD0Kej014619@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-16 15:00:13 +0200 (Wed, 16 Sep 2009)
New Revision: 2192

Modified:
   trunk/src/CacheWolf/CalcPanel.java
Log:
CalcPanel: bug fixed: shows the calculated coordinates again
CalcPanel: bug fixed: default to DD?MM.mm'

Modified: trunk/src/CacheWolf/CalcPanel.java
===================================================================
--- trunk/src/CacheWolf/CalcPanel.java	2009-09-15 20:43:53 UTC (rev 2191)
+++ trunk/src/CacheWolf/CalcPanel.java	2009-09-16 13:00:13 UTC (rev 2192)
@@ -73,8 +73,8 @@
 		chkDMM.setGroup(chkFormat);
 		chkDMS.setGroup(chkFormat);
 		chkCustom.setGroup(chkFormat);
-		chkFormat.setInt(2);
-		currFormat = 2;
+		chkFormat.setInt(1);
+		currFormat = 1;
 		String[] ls = TransformCoordinates.getProjectedSystemNames();
 		TopP.addLast(localCooSystem = new mChoice(ls, 0),CellConstants.DONTSTRETCH, CellConstants.WEST);
 
@@ -168,7 +168,7 @@
 				inpBearing.setText("0");
 				inpDistance.setText("0");
 
-				currFormat = 2;
+				//currFormat = 1;
 				if (ch.LatLon.length()== 0) coordInp.set(0,0);
 				else coordInp.set(ch.LatLon, TransformCoordinates.CW);
 				setFields();				
@@ -198,7 +198,7 @@
 			if (ev.target == btnCalc){
 				readFields(coordInp, bd);
 				coordOut = coordInp.project(bd.degrees, bd.distance);
-				txtOutput.appendText(coordOut.toString(currFormat)+ "\n",true);
+				txtOutput.appendText(coordOut.toString(getLocalCooSystem())+ "\n",true);
 			}
 			if (ev.target == btnClear){
 				txtOutput.setText("");



From araber95 at mail.berlios.de  Wed Sep 16 20:52:36 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 16 Sep 2009 20:52:36 +0200
Subject: [Cachewolf-svn] r2193 - trunk/src/CacheWolf/navi
Message-ID: <200909161852.n8GIqala025317@sheep.berlios.de>

Author: araber95
Date: 2009-09-16 20:52:33 +0200 (Wed, 16 Sep 2009)
New Revision: 2193

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
pictures of previously covered white area removed if map covers whole screen.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-16 13:00:13 UTC (rev 2192)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-16 18:52:33 UTC (rev 2193)
@@ -76,7 +76,7 @@
 	boolean noMapsAvailable;
 	boolean zoomingMode = false;
 	boolean mapsloaded = false;
-	
+	boolean additionalOverlaysDeleted=true;
 	Point lastRepaintMapPos = null;
 	double lastDistance = -1;
 	
@@ -998,6 +998,17 @@
 			}
 		}
 		
+		if (!screenNotCompletlyCovered && !additionalOverlaysDeleted){
+			for (Iterator i = mmp.images.iterator(); i.hasNext();) {
+				AniImage im = (AniImage) i.next();
+				if ( (im instanceof MapImage) && (
+					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
+						i.remove();
+				}
+			}
+			additionalOverlaysDeleted = true;
+		}
+		
 		if (isFillWhiteArea() && screenNotCompletlyCovered) {
         	if (Global.getPref().debug) {Global.getPref().log("updatePosition : "+where.toString(TransformCoordinates.DD));}
 			//Clean up any additional images, tiles will removed and any other item be added again later
@@ -1039,6 +1050,7 @@
 				AniImage im = (AniImage) i.next();
 				mmp.addImage(im);
 			}	
+			additionalOverlaysDeleted = false;
         	if (Global.getPref().debug) {Global.getPref().log("End updatePosition : "+where.toString(TransformCoordinates.DD)+"\n");}
 		}
 	}



From araber95 at mail.berlios.de  Thu Sep 17 01:14:03 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 17 Sep 2009 01:14:03 +0200
Subject: [Cachewolf-svn] r2194 - trunk/src/CacheWolf
Message-ID: <200909162314.n8GNE3On012781@sheep.berlios.de>

Author: araber95
Date: 2009-09-17 01:13:59 +0200 (Thu, 17 Sep 2009)
New Revision: 2194

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
Log:
Changed setting mapspath for profile to index.xml . path is always relativ to basedir/maps otherwise empty meaning using path of preferences.

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-16 18:52:33 UTC (rev 2193)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-16 23:13:59 UTC (rev 2194)
@@ -448,7 +448,7 @@
 			if (tmp != null) solverDegMode=Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("mapspath")) {
-			customMapsPath=atts.getValue("dir").replace('\\', '/');			
+			customMapsPath=atts.getValue("dir").replace('\\', '/');
 		}
 		else if (name.equals("debug")) debug=Boolean.valueOf(atts.getValue("value")).booleanValue();
 
@@ -646,37 +646,26 @@
 	 * @return custom Maps Path, null if not set
 	 */
 	public String getCustomMapsPath() {
-	   return customMapsPath;
-	}
-
-	private void saveProfilePreferences() {
-		PrintWriter outp;
-		try{
-			outp = new PrintWriter(new BufferedWriter(new FileWriter(new FileBugfix(pathToProfile + "profpref.xml").getAbsolutePath())));
-			outp.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n");
-			outp.print("<preferences>\n");
-			outp.print("    <mapspath dir = \"" + customMapsPath + "\"/>\n");
-			outp.print("</preferences>");
-			outp.close();
-		}catch(Exception e){
+	   String s = Global.getProfile().getRelativeCustomMapsPath();
+	   if (s.equals("")) {
+		   return customMapsPath;
+		} else {
+			String t = absoluteBaseDir+"maps";
+			return t+s;
 		}
-	}	
-	
-	private void getProfilePreferences() {
-		String fn = new FileBugfix(pathToProfile + "profpref.xml").getAbsolutePath();
-		try{
-			ewe.io.Reader r = new ewe.io.InputStreamReader(new ewe.io.FileInputStream(fn));
-			parse(r);
-			r.close();
-		}catch(Exception e){
-		}
 	}
 	
 	public void saveCustomMapsPath(String mapspath_) {
 		if (customMapsPath == null || !customMapsPath.equals(mapspath_)) {
 			customMapsPath=new String(mapspath_).replace('\\', '/');
 			savePreferences();
-			saveProfilePreferences();
+			String s = absoluteBaseDir+"maps";
+			if (customMapsPath.indexOf(s)==0) {
+				String t=customMapsPath.substring(s.length(), customMapsPath.length());
+				Global.getProfile().setRelativeCustomMapsPath(t);
+			} else {
+				Global.getProfile().setRelativeCustomMapsPath("");
+			}
 		}
 	}
 
@@ -849,7 +838,6 @@
 		prof.dataDir=prof.dataDir.replace('\\','/');
 		if (!prof.dataDir.endsWith("/")) prof.dataDir+='/';
 		pathToProfile=prof.dataDir;
-		getProfilePreferences();
 		savePreferences();
 		return true;
 	}

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-16 18:52:33 UTC (rev 2193)
+++ trunk/src/CacheWolf/Profile.java	2009-09-16 23:13:59 UTC (rev 2194)
@@ -47,6 +47,9 @@
 	/** Distance for geocaching caches */
 	private String distGC = new String();
 
+	/** path to the maps of the profile relative to the maps root */
+	private String relativeCustomMapsPath = new String();
+
 	public final static boolean SHOW_PROGRESS_BAR = true;
 	public final static boolean NO_SHOW_PROGRESS_BAR = false;
 
@@ -112,6 +115,7 @@
 		setLast_sync_opencaching("");
 		setDistOC("");
 		setDistGC("");
+		setRelativeCustomMapsPath("");
 		resetUnsavedChanges();
 	}
 
@@ -195,6 +199,7 @@
 			detfile.print(this.getCurrentFilter().toXML(""));
 			detfile.print("    <SYNCOC date = \""+getLast_sync_opencaching()+"\" dist = \""+getDistOC()+"\"/>\n");
 			detfile.print("    <SPIDERGC dist = \"" + getDistGC() + "\"/>\n");
+			detfile.print("    <mapspath relativeDir = \"" + relativeCustomMapsPath + "\"/>\n");
 			int size = cacheDB.size();
 			for (int i = 0; i < size; i++) {
 				if (showprogress) {
@@ -292,6 +297,9 @@
 					setLast_sync_opencaching(text.substring(start,text.indexOf("\"",start)));
 					start=text.indexOf("dist = \"")+8;
 					setDistOC(text.substring(start,text.indexOf("\"",start)));
+				} else if (text.indexOf("mapspath")>=0) {
+					int start=text.indexOf("relativeDir = \"")+15;
+					setRelativeCustomMapsPath(text.substring(start,text.indexOf("\"",start)));
 				} else if (text.indexOf("<SPIDERGC")>=0) {
 					int start=text.indexOf("dist = \"")+8;
 					setDistGC(text.substring(start,text.indexOf("\"",start)));
@@ -763,6 +771,15 @@
 		this.distGC = distGC;
 	}
 
+	public String getRelativeCustomMapsPath() {
+		return relativeCustomMapsPath;
+	}
+	
+	public void setRelativeCustomMapsPath(String relativeCustomMapsPath) {
+		relativeCustomMapsPath=SafeXML.clean(relativeCustomMapsPath.replace('\\','/'));
+		this.notifyUnsavedChanges(!relativeCustomMapsPath.equals(this.relativeCustomMapsPath));
+		this.relativeCustomMapsPath = relativeCustomMapsPath;
+	}
 	/**
 	 * Returns the currently active FilterData object for the profile.
 	 * @return Object representing the setting of the filter



From pfeffer at mail.berlios.de  Thu Sep 17 01:43:05 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 17 Sep 2009 01:43:05 +0200
Subject: [Cachewolf-svn] r2195 - trunk/src/CacheWolf/imp
Message-ID: <200909162343.n8GNh5uU012279@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-17 01:43:02 +0200 (Thu, 17 Sep 2009)
New Revision: 2195

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
Opencaching download: trying to fix NPE reported here: http://forum.opencaching.pl/viewtopic.php?t=4413&start=30

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-16 23:13:59 UTC (rev 2194)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-16 23:43:02 UTC (rev 2195)
@@ -130,14 +130,13 @@
 		CacheHolder ch;
 		ch = cacheDB.get(number);
 		setHostname(ch.getWayPoint());
-		holder= null; //new CacheHolderDetail(ch); //TODO is this still correct? use getDetails ?
+		holder= null;
 		
 		if (infB.isClosed) {
 			// there could have been an update before
 			return true;
 		}
 
-		// this is only a dummy-InfoBox for capturing the output
 		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from " + hostname), InfoBox.PROGRESS_WITH_WARNINGS, false);
 		inf.setPreferredSize(220, 300);
 		inf.relayout(false);
@@ -650,14 +649,16 @@
 				else 												wp = new String("WP???");
 				if (holder != null && holder.getCacheName() != null) n = holder.getCacheName();
 				else 												 n = new String("name???");
-				
-				if (e.getMessage().equalsIgnoreCase("could not connect") ||
-					e.getMessage().equalsIgnoreCase("unkown host")) { 
-					// is there a better way to find out what happened?
-					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
-				} else
-					ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
-					
+
+				if (e == null) ErrMessage = "Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: "+fileName+" from URL:"+fetchURL;
+				else {
+					if (e.getMessage().equalsIgnoreCase("could not connect") ||
+							e.getMessage().equalsIgnoreCase("unkown host")) { 
+						// is there a better way to find out what happened?
+						ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
+					} else
+						ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
+				}
 				inf.addWarning("\n"+ErrMessage);
 				//(new MessageBox(MyLocale.getMsg(144, "Warning"), ErrMessage, MessageBox.OKB)).exec();
 				pref.log(ErrMessage);



From mik77 at mail.berlios.de  Thu Sep 17 14:06:53 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 17 Sep 2009 14:06:53 +0200
Subject: [Cachewolf-svn] r2196 - trunk/src/CacheWolf
Message-ID: <200909171206.n8HC6rnZ023636@sheep.berlios.de>

Author: mik77
Date: 2009-09-17 14:06:21 +0200 (Thu, 17 Sep 2009)
New Revision: 2196

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
Mark whole cache es found, if the final AddiWpt is marked as found.

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-16 23:43:02 UTC (rev 2195)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-17 12:06:21 UTC (rev 2196)
@@ -1211,9 +1211,15 @@
     }
 
 	public void setFound(boolean is_found) {
-		Global.getProfile().notifyUnsavedChanges(is_found != this.found);		
-    	this.found = is_found;
+    if (is_found != this.found) {
+      Global.getProfile().notifyUnsavedChanges(true);		
+      this.found = is_found;
+      if (is_found && (this.getType() == CacheType.CW_TYPE_FINAL) && (this.mainCache != null) ) {
+        this.mainCache.setFound(true);
+        this.mainCache.setAttributesToAddiWpts();
+      }
     }
+  }
 
 	/**
 	 * If this returns <code>true</code>, then the additional waypoints for this cache should be 



From apreisser at mail.berlios.de  Thu Sep 17 17:12:58 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Thu, 17 Sep 2009 17:12:58 +0200
Subject: [Cachewolf-svn] r2197 - trunk/src/CacheWolf/navi
Message-ID: <200909171512.n8HFCwFx007680@sheep.berlios.de>

Author: apreisser
Date: 2009-09-17 17:12:51 +0200 (Thu, 17 Sep 2009)
New Revision: 2197

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Improved Performance on filling white areas: the tiles will only be reloaded if the map moved more than 10% of width and/or height of screen

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-17 12:06:21 UTC (rev 2196)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-17 15:12:51 UTC (rev 2197)
@@ -85,6 +85,12 @@
 	public static final int tileWidth = 100;
 	public static final int tileHeight = 100;
 
+	//Needed by updatePosition to decide if a recalculation of map-tiles is needed:
+	private int lastXPos;
+	private int lastYPos;
+	private int lastWidth;
+	private int lastHeight;
+
 	public boolean isFillWhiteArea() {
 		return pref.fillWhiteArea;
 	}
@@ -976,88 +982,106 @@
 			return;
 		}
 		updateOnlyPosition(where, true);
-		
+
+		if (!autoSelectMap) return;
 		Point mapPos = getMapPositionOnScreen();
-		boolean screenNotCompletlyCovered =  mmp.mapImage == null || (mmp.mapImage != null && ( mapPos.y > 0 || mapPos.x > 0 || mapPos.y+mmp.mapImage.getHeight()<this.height	|| mapPos.x+mmp.mapImage.getWidth()<this.width));
-		if (autoSelectMap) {
-			if (forceMapLoad || wantMapTest|| screenNotCompletlyCovered) 	{
-				//Vm.debug("Screen not completly covered by map");
-				if (forceMapLoad || (java.lang.Math.abs(lastCompareX-mapPos.x) > this.width/10 || java.lang.Math.abs(lastCompareY-mapPos.y) > this.height/10)) {
-					// more then 1/10 of screen moved since last time we tried to find a better map
-					lastCompareX = mapPos.x;
-					lastCompareY = mapPos.y;
-					setBestMap(where, true);
-					forceMapLoad = false;
-					// update for checking of whitearea 
-					if (!inBestMap) {
-						// map changed
-						mapPos = getMapPositionOnScreen();
-						screenNotCompletlyCovered =  mmp.mapImage == null || (mmp.mapImage != null && ( mapPos.y > 0 || mapPos.x > 0 || mapPos.y+mmp.mapImage.getHeight()<this.height	|| mapPos.x+mmp.mapImage.getWidth()<this.width));
+		boolean screenNotCompletlyCovered = mmp.mapImage == null
+				|| (mmp.mapImage != null && (mapPos.y > 0 || mapPos.x > 0
+						|| mapPos.y + mmp.mapImage.getHeight() < this.height || mapPos.x
+						+ mmp.mapImage.getWidth() < this.width));
+		//if screendimensions changed also force reload of map
+		forceMapLoad |= lastWidth != width || lastHeight != height;
+		if (forceMapLoad || wantMapTest || screenNotCompletlyCovered) { // if force || want || map doesn't cover the screen completly
+			// Vm.debug("Screen not completly covered by map");
+			if (forceMapLoad
+					|| (java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
+				// more then 1/10 of screen moved since last time we tried to
+				// find a better map
+
+				// Clean up any additional images, tiles will removed and any
+				// other item be added again later
+				Vector icons = new Vector();
+				for (Iterator i = mmp.images.iterator(); i.hasNext();) {
+					AniImage im = (AniImage) i.next();
+					if ((im instanceof MapImage)
+							&& (!((im instanceof MapSymbol)
+									|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
+						i.remove();
+					} else {
+						icons.add(im);
+						i.remove();
 					}
 				}
-			}
-		}
-		
-		if (!screenNotCompletlyCovered && !additionalOverlaysDeleted){
-			for (Iterator i = mmp.images.iterator(); i.hasNext();) {
-				AniImage im = (AniImage) i.next();
-				if ( (im instanceof MapImage) && (
-					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
-						i.remove();
+				// Mark all tiles as dirty
+				MovingMapCache.getCache().clearUsedFlags();
+
+				Point mapPosx = getMapPositionOnScreen();
+				// Holds areas not filled by currentmap and/or used tiles
+				Vector rectangles = new Vector();
+				// calculate areas which will not drawn
+				Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
+				Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage
+						.getWidth(), mmp.mapImage.getHeight());
+				calculateRectangles(blackArea, whiteArea, rectangles);
+				// I've sometimes experienced an endless loop which might be
+				// caused by a bug in getBestMap. Therefore i will stop the loop
+				// after 30 runs
+				int count = 0;
+				while (isFillWhiteArea() && currentMap.zoomFactor == 1.0
+						&& !mapHidden && !rectangles.isEmpty() && count < 30) {
+					count++;
+					try {
+						updateTileForWhiteArea(rectangles);
+					} catch (ewe.sys.SystemResourceException sre) {
+						setFillWhiteArea(false);
+						(new MessageBox(
+								"Error",
+								"Not enough ressources to fill white ares, disabling this",
+								MessageBox.OKB)).execute();
+					}
 				}
+				// Remove all tiles not needed from the cache to reduce memory
+				MovingMapCache.getCache().cleanCache();
+				// At Last redraw all icons on the map
+				for (Iterator i = icons.iterator(); i.hasNext();) {
+					AniImage im = (AniImage) i.next();
+					mmp.addImage(im);
+				}
+
+				lastCompareX = mapPos.x;
+				lastCompareY = mapPos.y;
+				setBestMap(where, screenNotCompletlyCovered);
+				forceMapLoad = false;
 			}
-			additionalOverlaysDeleted = true;
-		}
-		
-		if (isFillWhiteArea() && screenNotCompletlyCovered) {
-        	if (Global.getPref().debug) {Global.getPref().log("updatePosition : "+where.toString(TransformCoordinates.DD));}
-			//Clean up any additional images, tiles will removed and any other item be added again later
-			Vector icons = new Vector ();
-			for (Iterator i = mmp.images.iterator(); i.hasNext();) {
-				AniImage im = (AniImage) i.next();
-				if ( (im instanceof MapImage) && (
-					!((im instanceof MapSymbol) || (im instanceof TrackOverlay) || mmp.mapImage == im) ) ) {
-						i.remove();
+			else{
+				int deltaX = mapPos.x - lastXPos;
+				int deltaY = mapPos.y - lastYPos;
+				for(Iterator i =mmp.images.iterator(); i.hasNext ();){
+					AniImage im = (AniImage) i.next();
+					if ((im instanceof MapImage)
+						&& (!((im instanceof MapSymbol)
+							|| (im instanceof TrackOverlay) 
+							|| mmp.mapImage == im))) {
+						//locAlways contains the real coordinates while
+						//location is only correct if the image is on the screen.
+						Point p = ((MapImage)im).locAlways;
+						p.x += deltaX;
+						p.y += deltaY;
+						im.setLocation(p.x, p.y);
+					}
 				}
-				else{
-					icons.add(im);
-					i.remove();
-				}
 			}
-			//Mark all tiles as dirty
-			MovingMapCache.getCache().clearUsedFlags ();
-			//Holds areas not filled by currentMap and/or used tiles
-			Vector rectangles = new Vector();
-			//calculate areas which will not drawn
-			Rect whiteArea = new Rect (0,0,width,height);
-			Rect blackArea = new Rect (mapPos.x, mapPos.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
-			calculateRectangles(blackArea, whiteArea,rectangles);
-        	//I've sometimes experienced an endless loop which might be caused by a bug in getBestMap. Therefore i will stop the loop after 30 runs
-			int count=0;
-			while (isFillWhiteArea() && currentMap.zoomFactor == 1.0 && !mapHidden && count<rectangles.getCount() && count < 30){
-				try {
-					updateTileForWhiteArea(rectangles,count);
-				} catch (ewe.sys.SystemResourceException sre) {
-					setFillWhiteArea(false);
-					(new MessageBox("Error", "Not enough ressources to fill white ares, disabling this", MessageBox.OKB)).execute();
-				}
-				count++;
-			}		
-			//Remove all tiles not needed from the cache to reduce memory
-			MovingMapCache.getCache().cleanCache ();
-			//At Last redraw all icons on the map
-			for(Iterator i = icons.iterator(); i.hasNext();){
-				AniImage im = (AniImage) i.next();
-				mmp.addImage(im);
-			}	
-			additionalOverlaysDeleted = false;
-        	if (Global.getPref().debug) {Global.getPref().log("End updatePosition : "+where.toString(TransformCoordinates.DD)+"\n");}
 		}
+		lastXPos = mapPos.x;
+		lastYPos = mapPos.y;
+		lastWidth = width;
+		lastHeight = height;
 	}
 
-	private void updateTileForWhiteArea(Vector rectangles, int at) {
+	private void updateTileForWhiteArea(Vector rectangles) {
 		Rect blackArea;
-		Rect r = (Rect) rectangles.get(at);
+		Rect r = (Rect) rectangles.get(0);
+		rectangles.removeElementAt(0);
 		//calculate the center of the rectangle and try to get an map for it
 		int middlewidth = r.x + (r.width)/2;
 		int middleheight = r.y + (r.height)/2;
@@ -1132,8 +1156,19 @@
 				}
 				//If a tile has been found, draw it on the screen
 				if (im != null) {
-					im.setLocation(mapPos.x + (column * tileWidth), mapPos.y + (row * tileHeight));
-					mmp.addImage(im);
+					//Check if not already added. this might happen if the map for horizontal and vertical stripe is the same
+					boolean added=false;
+					for(Iterator i=mmp.images.iterator(); i.hasNext();){
+						MapImage m=(MapImage) i.next();
+						if (m == im){
+							added=true;
+							break;
+						}
+					}
+					if(!added){
+						im.setLocation(mapPos.x + (column * tileWidth), mapPos.y + (row * tileHeight));
+						mmp.addImage(im);
+					}
 				}
 			}
 		}
@@ -1187,15 +1222,19 @@
 	
 	private void calculateRectangles(Rect blackArea, Rect whiteArea, Vector rectangles) {
 		if (width == 0 || height == 0) return;
+		int offsetX = width/10;
+		int offsetY = height/10;
+		int width=this.width+offsetX;
+		int height=this.height+offsetY;
 		if (whiteArea.x >= width || whiteArea.y >= height) return;
-		if (Global.getPref().debug) {Global.getPref().log("Compare"+SRect(whiteArea)+"with"+SRect(blackArea)+" (blackarea)");}
-		if (blackArea.x < 0){
-			blackArea.width += blackArea.x; 
-			blackArea.x =0;
+		
+		if (blackArea.x < -offsetX){
+			blackArea.width += blackArea.x + offsetX;
+			blackArea.x = -offsetX;
 		}
-		if (blackArea.y < 0){
-			blackArea.height += blackArea.y; 
-			blackArea.y =0;
+		if (blackArea.y < -offsetY){
+			blackArea.height += blackArea.y + offsetY;
+			blackArea.y = -offsetY;
 		}
 		if (blackArea.x + blackArea.width > width){
 			blackArea.width = width - blackArea.x;
@@ -1206,9 +1245,9 @@
 		
 		if (blackArea.x > whiteArea.x) {
 			Rect r= new Rect ();
-			r.x = 0;
+			r.x = -offsetX;
 			r.y = whiteArea.y;
-			r.width = blackArea.x;
+			r.width = blackArea.x + offsetX;
 			r.height = whiteArea.height;
 			rectangles.add(r);
 			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
@@ -1216,9 +1255,9 @@
 		if (blackArea.y > whiteArea.y) {
 			Rect r= new Rect ();
 			r.x = whiteArea.x;
-			r.y = 0;
+			r.y = -offsetY;
 			r.width = whiteArea.width;
-			r.height = blackArea.y;
+			r.height = blackArea.y + offsetY;
 			rectangles.add(r);
 			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
 		}
@@ -1344,7 +1383,7 @@
 			return;
 		}
 		if (currentMap == null && newmap == null) {
-			// (new MessageBox("Information", "F?r die aktuelle Position steht keine Karte zur Verf?ng, bitte w?hlen Sie eine manuell", MessageBox.OKB)).execute();
+			// (new MessageBox("Information", "F?r die aktuelle Position steht keine Karte zur Verf?ng, bitte w?hlen Sie eine manuell", MessageBox.OKB)).execute();
 			posCircle.where.set(cll); // choosemap calls setmap with posCircle-coos
 			try {
 				setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), where); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps



From apreisser at mail.berlios.de  Thu Sep 17 17:36:43 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Thu, 17 Sep 2009 17:36:43 +0200
Subject: [Cachewolf-svn] r2198 - trunk/src/CacheWolf/navi
Message-ID: <200909171536.n8HFahJY009968@sheep.berlios.de>

Author: apreisser
Date: 2009-09-17 17:36:37 +0200 (Thu, 17 Sep 2009)
New Revision: 2198

Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
small tile size for maps added. 

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-09-17 15:12:51 UTC (rev 2197)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-09-17 15:36:37 UTC (rev 2198)
@@ -46,7 +46,11 @@
 	mCheckBox overviewChkBox = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
 	mCheckBox overviewChkBoxPerCache = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
 
-	MapLoader mapLoader;
+        mCheckBox smallTiles = new mCheckBox (MyLocale.getMsg (4280, "Small Tiles"));
+        mCheckBox bigTiles = new mCheckBox (MyLocale.getMsg (4282, "BigTiles"));
+        CheckBoxGroup tileSize = new CheckBoxGroup ();
+
+        MapLoader mapLoader;
 	String[] unsortedMapServices;
 	String[] sortedmapServices;
 	int[] sortingMapServices;
@@ -101,6 +105,11 @@
 		pnlTiles.addLast(overlappingInput);
 		overviewChkBox.setState(true);
 		pnlTiles.addLast(overviewChkBox);
+		pnlTiles.addNext(smallTiles);
+		pnlTiles.addLast(bigTiles);
+		smallTiles.setGroup(tileSize);
+                bigTiles.setGroup(tileSize);
+		tileSize.selectIndex(1);
 		cancelB = new mButton(MyLocale.getMsg(1604,"Cancel"));
 		cancelB.setHotKey(0, IKeys.ESCAPE);
 		pnlTiles.addNext(cancelB,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
@@ -205,11 +214,20 @@
 		progressBox.exec();
 		mapLoader.setProgressInfoBox(progressBox);
 		Vm.showWait(true);
-		ewe.fx.Point size = new ewe.fx.Point(1000,1000); // Size of the downloaded maps
+		int length;
+        	switch (tileSize.getSelectedIndex()){
+		    //Perhaps introduce a medium size??
+		case 0:
+		    length=500;
+		    break;
+		default:
+		    length=1000;
+		}
+		ewe.fx.Point size = new ewe.fx.Point(length,length);
 		if (forCachesChkBox.getState() || perCache) {
 			Area surArea = Global.getProfile().getSourroundingArea(onlySelected); // calculate map boundaries from cacheDB
 			if (surArea == null) {
-				(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1817, "No Caches are seleted"), FormBase.OKB)).execute();
+				(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1817, "No Caches are selected"), FormBase.OKB)).execute();
 				Vm.showWait(false);
 				progressBox.close(0);
 				return;
@@ -294,9 +312,9 @@
 			if (ev.target == cancelB || ev.target == cancelBPerCache){
 				this.close(FormBase.IDCANCEL);
 			}
-			if (ev.target == okBtiles || ev.target == okBPerCache){
+			else if (ev.target == okBtiles || ev.target == okBPerCache){
 				if (sortingMapServices[mapServiceChoice.selectedIndex] == -1) {
-					(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1833, "Please don't select the separetor line in the wms service option"), FormBase.OKB)).execute(); 
+					(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1833, "Please don't select the separator line in the wms service option"), FormBase.OKB)).execute(); 
 				}
 				mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
 				if (ev.target == okBtiles) { // get tiles
@@ -309,7 +327,7 @@
 					overlapping = Convert.toInt(overlappingInput.getText());
 					if (!forCachesChkBox.getState()) {
 						if (radius <= 0) { 
-							(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1827, "'radius' must be graeter than 0"), FormBase.OKB)).execute();
+							(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1827, "'radius' must be greater than 0"), FormBase.OKB)).execute();
 							return;
 						}
 						if (overlapping < 0) { 
@@ -342,7 +360,7 @@
 				this.close(FormBase.IDOK); 
 				this.downloadTiles();
 			}
-			if (ev.target == coosBtn) {
+			else if (ev.target == coosBtn) {
 				CoordsScreen cs = new CoordsScreen();
 				cs.setFields(center, TransformCoordinates.CW);
 				if (cs.execute() != FormBase.IDCANCEL) {
@@ -353,9 +371,18 @@
 					mapServiceChoice.set(sortedmapServices, (!inbound[tmp] ? 0 : getSortedMapServiceIndex((tmp))));
 				}
 			}
-			if (ev.target == forCachesChkBox) {
+			else if (ev.target == forCachesChkBox) {
 				updateForCachesState();
 			}
+			else if (ev.target == tileSize){
+			    switch (tileSize.getSelectedIndex()){
+			    case 0:
+			    overlappingInput.setText ("10");
+			    break;
+			    default:
+			    overlappingInput.setText ("100");
+			    }
+			}
 		} // end of "if controllEvent..."
 		if (ev instanceof DataChangeEvent && ev.target == mapServiceChoice) {
 			mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);



From apreisser at mail.berlios.de  Thu Sep 17 17:37:23 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Thu, 17 Sep 2009 17:37:23 +0200
Subject: [Cachewolf-svn] r2199 - trunk/res_noewe/languages
Message-ID: <200909171537.n8HFbNXb010080@sheep.berlios.de>

Author: apreisser
Date: 2009-09-17 17:37:03 +0200 (Thu, 17 Sep 2009)
New Revision: 2199

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
Log:
small tile size for maps added. 

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-17 15:36:37 UTC (rev 2198)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-17 15:37:03 UTC (rev 2199)
@@ -709,6 +709,9 @@
 		4277=Ausw%e4hlen
 		4278=Kann folgende .wfl-Datei nicht laden:+%0a
 		4279=Setze Ziel auf
+		4280=Kleine Kacheln
+		4281=Mittler Kacheln
+		4282=Gro%dfe Kacheln
 		4300=Leer 1 Punkt =+
 		4301=+meter
 		4302=Breite/L%e4nge au%dferhalb des zul%e4ssigen Bereiches beim Lesen von+

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-17 15:36:37 UTC (rev 2198)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-17 15:37:03 UTC (rev 2199)
@@ -697,6 +697,9 @@
 		4277=Select
 		4278=Cannot load wfl-file: \n
 		4279=Goto
+		4280=Small Tiles
+		4281=Medium Tiles
+		4282=Big Tiles
 		4300=empty 1 Pixel =+
 		4301=+meters
 		4302=Lat/Lon out of range while reading+

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-17 15:36:37 UTC (rev 2198)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-17 15:37:03 UTC (rev 2199)
@@ -689,6 +689,9 @@
 		4276=Annuler
 		4277=Choisir
 		4278=Ne peut pas charger ces fichiers .wfl:+%0a
+		4280=[Small Tiles]
+		4281=[Medium Tiles]
+		4282=[Big Tiles]
 		4300=1 pixel vide =+
 		4301=+metre
 		4302=Latitude/Longitude hors de l'%e9tendue valide en chargeant+

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-09-17 15:36:37 UTC (rev 2198)
+++ trunk/res_noewe/languages/NL.cfg	2009-09-17 15:37:03 UTC (rev 2199)
@@ -545,6 +545,9 @@
 		4200=Kies kaarten map
 		4266=[Fill white areas]
 		4267=[Show white areas]
+		4280=[Small Tiles]
+		4281=[Medium Tiles]
+		4282=[Big Tiles]
 		4500=Tot:
 		4501=Vis:
 		4502=Fnd:

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-17 15:36:37 UTC (rev 2198)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-17 15:37:03 UTC (rev 2199)
@@ -697,6 +697,9 @@
                 4277=Wybierz
                 4278=Nie moge wczytac wfl-plik: \n
                 4279=Idz do
+				4280=[Small Tiles]
+				4281=[Medium Tiles]
+				4282=[Big Tiles]
                 4300=Pusty 1 Pixel =+
                 4301=+metrow
                 4302=Lat/Lon poza obszarem podczas wczytywania+



From mik77 at mail.berlios.de  Fri Sep 18 16:53:23 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 18 Sep 2009 16:53:23 +0200
Subject: [Cachewolf-svn] r2200 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200909181453.n8IErNpY009340@sheep.berlios.de>

Author: mik77
Date: 2009-09-18 16:53:12 +0200 (Fri, 18 Sep 2009)
New Revision: 2200

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/FilterData.java
   trunk/src/CacheWolf/FilterScreen.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
Log:
New filter checkbox to filter out waypoints without coordinates

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-17 15:37:03 UTC (rev 2199)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-18 14:53:12 UTC (rev 2200)
@@ -285,6 +285,7 @@
 		740=Allen
 		741=Einem
 		742=Keinem
+		743=Ohne Koordinaten
 		800=Erstelle Liste
 		801=suche...
 		802=Caches identifiziert. Suche weiter...

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-17 15:37:03 UTC (rev 2199)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-18 14:53:12 UTC (rev 2200)
@@ -285,6 +285,7 @@
 		740=all
 		741=one
 		742=none
+		743=No coordinates
 		800=Creating list
 		801=searching...
 		802=Caches identified. searching...

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2009-09-17 15:37:03 UTC (rev 2199)
+++ trunk/src/CacheWolf/Filter.java	2009-09-18 14:53:12 UTC (rev 2200)
@@ -88,6 +88,7 @@
 
 	private String cacheStatus;
 	private boolean useRegexp;
+	private boolean filterNoCoord;
 	
 	private boolean ownedByMe;
 	private boolean notOwnedByMe;
@@ -258,6 +259,7 @@
 		typeMatchPattern=0;
 		cacheStatus  = profile.getFilterStatus();
 		useRegexp    = profile.getFilterUseRegexp();
+		filterNoCoord = profile.getFilterNoCoord();
 		
 		String filterType=profile.getFilterType();
 		if (filterType.charAt(0) == '1') typeMatchPattern|=TRADITIONAL;
@@ -463,10 +465,12 @@
 				        cacheRosePattern = WNW;
 			        else if (ch.bearing.equals("W"))
 				        cacheRosePattern = W;
+			        else if (ch.bearing.equals("WSW"))
+				        cacheRosePattern = WSW;
 			        else
-				        cacheRosePattern = WSW;
+				        cacheRosePattern = 0;
 		        }
-		        if ((cacheRosePattern & roseMatchPattern) == 0) {
+		        if ((cacheRosePattern != 0) && ((cacheRosePattern & roseMatchPattern) == 0)) {
 			        cacheFiltered = true; break;
 		        }
 	        }
@@ -573,6 +577,9 @@
 			        }
 		        }
 	        }
+	        ///////////////////////////////
+	        // Filter criterium 12: Status
+	        ///////////////////////////////
 	        if (!cacheStatus.equals("")) {
 	        	if (!useRegexp) {
 	        		if (ch.getCacheStatus().toLowerCase().indexOf(cacheStatus.toLowerCase())<0) {
@@ -588,6 +595,14 @@
 	        		}
 	        	}
 	        }
+	        ///////////////////////////////
+	        // Filter criterium 11: NoCoord
+	        ///////////////////////////////
+	        if (!filterNoCoord && !ch.pos.isValid()) {
+	          cacheFiltered = true;
+	        	break;
+        }
+
 	        break;
         } while (true);
 		return cacheFiltered;
@@ -624,7 +639,8 @@
 		    prof.getFilterTerr().equals("L") &&
 		    prof.getFilterAttrYes() == 0l &&
 		    prof.getFilterAttrNo() == 0l &&
-		    prof.getFilterStatus().equals(""));
+		    prof.getFilterStatus().equals("") &&
+        prof.getFilterNoCoord());
 	}
 
 }

Modified: trunk/src/CacheWolf/FilterData.java
===================================================================
--- trunk/src/CacheWolf/FilterData.java	2009-09-17 15:37:03 UTC (rev 2199)
+++ trunk/src/CacheWolf/FilterData.java	2009-09-18 14:53:12 UTC (rev 2200)
@@ -17,6 +17,7 @@
 	private String filterType = new String(FILTERTYPE);
 	private String filterRose = new String(FILTERROSE);
 	private String filterSize = new String(FILTERSIZE);
+	private boolean filterNoCoord = true;
 
 	// filter settings for archived ... owner (section) in filterscreen
 	private String filterVar = new String(FILTERVAR);
@@ -56,7 +57,7 @@
 		"\" var = \""+getFilterVar()+"\" dist = \""+getFilterDist().replace('"',' ')+"\" diff = \""+
 		getFilterDiff()+"\" terr = \""+getFilterTerr()+"\" size = \""+getFilterSize()+"\" attributesYes = \""+getFilterAttrYes()+
 		"\" attributesNo = \""+getFilterAttrNo()+"\" attributesChoice = \""+getFilterAttrChoice()+
-		"\" status = \""+SafeXML.clean(getFilterStatus())+"\" useRegexp = \""+useRegexp()+"\" />\n";	
+		"\" status = \""+SafeXML.clean(getFilterStatus())+"\" useRegexp = \""+useRegexp()+"\" noCoord = \""+getFilterNoCoord()+"\" />\n";	
 	}
 	/**
 	 * Ensure that all filters have the proper length so that the 'charAt' access in the filter do
@@ -182,4 +183,12 @@
     	this.useRegexp = useRegexp;
     }
 
+	public boolean getFilterNoCoord() {
+    	return filterNoCoord;
+    }
+
+	public void setFilterNoCoord(boolean filterNoCoord) {
+    	this.filterNoCoord = filterNoCoord;
+    }
+
 }

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2009-09-17 15:37:03 UTC (rev 2199)
+++ trunk/src/CacheWolf/FilterScreen.java	2009-09-18 14:53:12 UTC (rev 2200)
@@ -26,7 +26,7 @@
 					  chkMicro,chkSmall,chkRegular,chkLarge,chkVeryLarge,chkOther,chkCito,
 	                  chkArchived, chkNotArchived, chkAvailable, chkNotAvailable,
 					  chkNW, chkNNW , chkN , chkNNE, chkNE, chkENE, chkE, chkESE, chkSE, chkSSE, chkS,
-					  chkSSW, chkSW, chkWSW, chkW, chkWNW, chkWherigo;
+					  chkSSW, chkSW, chkWSW, chkW, chkWNW, chkWherigo, chkNoCoord;
 	private mComboBox chcStatus;
 	private mChoice   fltList;
 	private mCheckBox chkUseRegexp;
@@ -110,6 +110,8 @@
 		pnlBearDist.addNext(chcDist = new mChoice(new String[]{"<=", ">="},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		pnlBearDist.addLast(inpDist = new mInput(),CellConstants.DONTSTRETCH, CellConstants.FILL);
 		pnlBearDist.addLast(new mLabel(""));
+		pnlBearDist.addLast(chkNoCoord = new mCheckBox(MyLocale.getMsg(743,"No coordinates")),CellConstants.HSTRETCH, CellConstants.FILL);
+		
 		pnlRose.addNext(chkNW = new mCheckBox("NW"),CellConstants.HSTRETCH, CellConstants.FILL);
 		pnlRose.addNext(chkNNW = new mCheckBox("NNW"),CellConstants.HSTRETCH, CellConstants.FILL);
 		pnlRose.addNext(chkN = new mCheckBox("N"),CellConstants.HSTRETCH, CellConstants.FILL);
@@ -362,6 +364,7 @@
 			chcDist.select(0);
 			inpDist.setText("");
 		}
+		chkNoCoord.state = data.getFilterNoCoord();
 		String fltRose=data.getFilterRose();
 		chkNW.state   = fltRose.charAt(0) == '1';
 		chkNNW.state  = fltRose.charAt(1) == '1';
@@ -492,14 +495,14 @@
 			  !(chkNW.state && chkNNW.state && chkN.state && chkNNE.state &&
 				chkNE.state && chkENE.state && chkE.state && chkESE.state &&
 				chkSE.state && chkSSE.state && chkS.state && chkSSW.state &&
-				chkSW.state && chkWSW.state && chkW.state && chkWNW.state))
+				chkSW.state && chkWSW.state && chkW.state && chkWNW.state && chkNoCoord.state))
 			btnBearing.backGround=COLOR_FILTERACTIVE;
 		else
 			btnBearing.backGround=COLOR_FILTERINACTIVE;
 		if (  !(chkNW.state || chkNNW.state || chkN.state || chkNNE.state ||
 				chkNE.state || chkENE.state || chkE.state || chkESE.state ||
 				chkSE.state || chkSSE.state || chkS.state || chkSSW.state ||
-				chkSW.state || chkWSW.state || chkW.state || chkWNW.state))
+				chkSW.state || chkWSW.state || chkW.state || chkWNW.state || chkNoCoord.state))
 			btnBearing.backGround=COLOR_FILTERALL;
 		btnBearing.repaint();
 		
@@ -833,6 +836,7 @@
 	    data.setFilterAttrChoice(chcAttrib.selectedIndex);
 	    data.setFilterStatus(chcStatus.getText());
 	    data.setUseRegexp(chkUseRegexp.getState());
+	    data.setFilterNoCoord(chkNoCoord.getState());
 	    return data;
     }
 

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-17 15:37:03 UTC (rev 2199)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-18 14:53:12 UTC (rev 2200)
@@ -520,6 +520,12 @@
 			data.setFilterAttrChoice(Convert.parseInt(atts.getValue("attributesChoice")));
 			data.setFilterStatus(SafeXML.cleanback(atts.getValue("status")));
 			data.setUseRegexp(Boolean.valueOf(atts.getValue("useRegexp")).booleanValue());
+			tmp = atts.getValue("noCoord");
+			if (tmp != null) {
+			  data.setFilterNoCoord(Boolean.valueOf(tmp).booleanValue());
+      } else {
+			  data.setFilterNoCoord(true);
+      }
 			// Filter object is remembered under the given ID
 			this.addFilter(id, data);
 		}

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-17 15:37:03 UTC (rev 2199)
+++ trunk/src/CacheWolf/Profile.java	2009-09-18 14:53:12 UTC (rev 2200)
@@ -358,6 +358,12 @@
 					setFilterAttrChoice(Convert.parseInt(attr));
 					setFilterStatus(SafeXML.cleanback(ex.findNext()));
 					setFilterUseRegexp(Boolean.valueOf(ex.findNext()).booleanValue());
+					attr = ex.findNext();
+  				if (attr != null && !attr.equals("")) {
+  					setFilterNoCoord(Boolean.valueOf(attr).booleanValue());
+          } else {
+            setFilterNoCoord(true);
+          }
 				} else if (text.indexOf("<FILTERCONFIG")>=0){
 					ex.setSource(text.substring(text.indexOf("<FILTERCONFIG")));
 					String temp=ex.findNext();
@@ -743,6 +749,15 @@
 		this.notifyUnsavedChanges(useRegexp != this.getFilterUseRegexp());
     	this.currentFilter.setUseRegexp(useRegexp);
     }
+
+	public boolean getFilterNoCoord() {
+    	return currentFilter.getFilterNoCoord();
+    }
+
+	public void setFilterNoCoord(boolean filterNoCoord) {
+		this.notifyUnsavedChanges(filterNoCoord != this.getFilterNoCoord());
+    	this.currentFilter.setFilterNoCoord(filterNoCoord);
+    }
 	
 	public String getLast_sync_opencaching() {
 		return last_sync_opencaching;



From apreisser at mail.berlios.de  Fri Sep 18 16:58:08 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Fri, 18 Sep 2009 16:58:08 +0200
Subject: [Cachewolf-svn] r2201 - in trunk/src/CacheWolf: . navi
Message-ID: <200909181458.n8IEw8TH009606@sheep.berlios.de>

Author: apreisser
Date: 2009-09-18 16:58:06 +0200 (Fri, 18 Sep 2009)
New Revision: 2201

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
Stores the requested tilesize in the preferences-file

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-18 14:53:12 UTC (rev 2200)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-18 14:58:06 UTC (rev 2201)
@@ -246,6 +246,11 @@
 	/** Determines whether to fill the white areas on the map */
 	public boolean fillWhiteArea=false;
 
+        /** Selected Size of map tiles */
+        public int mapTileSize=1;
+        /** How many should maptiles overlap */
+        public int mapOverlapping=100;
+
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
 	 * the line: <pre><debug value="true" /></pre>
@@ -549,6 +554,14 @@
 			tmp = atts.getValue("on");
 			fillWhiteArea = tmp != null && tmp.equalsIgnoreCase("true");
 		}
+		else if (name.equals("mapLoader")){
+			     tmp = atts.getValue("tileSize");
+			     if (tmp == null || tmp.length() == 0) tmp = "1";
+			     mapTileSize = Convert.parseInt(tmp);
+                             tmp = atts.getValue("overlapping");
+			     if (tmp == null || tmp.length() == 0) tmp = "100";
+			     mapOverlapping = Convert.parseInt(tmp);
+		}
 	}
 
 	public void characters( char ch[], int start, int length ) {
@@ -634,6 +647,7 @@
 			if (rater != null) outp.print("    <rater tool=\"".concat(SafeXML.clean(rater)).concat("\"/>\n"));
 			outp.print("    <logkeeping maximum=\""+SafeXML.strxmlencode(maxLogsToKeep)+"\" keepown=\""+SafeXML.strxmlencode(alwaysKeepOwnLogs)+"\" />\n");
 			outp.print("    <fillWhiteArea on=\""+SafeXML.strxmlencode(fillWhiteArea)+"\"/>\n");
+			outp.print("    <mapLoader tileSize=\""+SafeXML.strxmlencode(mapTileSize)+"\" overlapping=\""+SafeXML.strxmlencode(mapOverlapping)+"\"/>\n");
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-09-18 14:53:12 UTC (rev 2200)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-09-18 14:58:06 UTC (rev 2201)
@@ -22,7 +22,7 @@
 
 public class MapLoaderGui extends Form {
 	mButton cancelB, okBtiles, okBPerCache, cancelBPerCache;
-	Preferences pref;
+    Preferences pref = Global.getPref ();
 	mTabbedPanel mTab = new mTabbedPanel();
 	CellPanel pnlTiles = new CellPanel();
 	CellPanel pnlPerCache = new CellPanel();
@@ -42,7 +42,7 @@
 	mInput scaleInput = new mInput ("3");
 	mInput scaleInputPerCache = new mInput ("1");
 	mLabel overlappingLbl = new mLabel(MyLocale.getMsg(1808,"overlapping in pixel:"));
-	mInput overlappingInput = new mInput("100");
+        mInput overlappingInput = new mInput(""+pref.mapOverlapping);
 	mCheckBox overviewChkBox = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
 	mCheckBox overviewChkBoxPerCache = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
 
@@ -67,7 +67,6 @@
 	public MapLoaderGui(CacheDB cacheDBi) {
 		super();
 		this.title = MyLocale.getMsg(1800, "Download georeferenced maps"); 
-		pref = Global.getPref(); // myPreferences sollte sp?ter auch diese Einstellungen speichern
 		center = new CWPoint(pref.curCentrePt);
 		cacheDB = cacheDBi;
 		mapLoader = new MapLoader(FileBase.getProgramDirectory()+"/"+"webmapservices");
@@ -109,7 +108,7 @@
 		pnlTiles.addLast(bigTiles);
 		smallTiles.setGroup(tileSize);
                 bigTiles.setGroup(tileSize);
-		tileSize.selectIndex(1);
+		tileSize.selectIndex(pref.mapTileSize);
 		cancelB = new mButton(MyLocale.getMsg(1604,"Cancel"));
 		cancelB.setHotKey(0, IKeys.ESCAPE);
 		pnlTiles.addNext(cancelB,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
@@ -223,6 +222,8 @@
 		default:
 		    length=1000;
 		}
+		//Override size if one tile for each cache is wanted
+		if (perCache) length=1000;
 		ewe.fx.Point size = new ewe.fx.Point(length,length);
 		if (forCachesChkBox.getState() || perCache) {
 			Area surArea = Global.getProfile().getSourroundingArea(onlySelected); // calculate map boundaries from cacheDB
@@ -378,16 +379,25 @@
 			    switch (tileSize.getSelectedIndex()){
 			    case 0:
 			    overlappingInput.setText ("10");
+			    pref.mapTileSize=0;
+			    pref.mapOverlapping=10;
 			    break;
 			    default:
 			    overlappingInput.setText ("100");
+			    pref.mapTileSize=1;
+			    pref.mapOverlapping=100;
 			    }
 			}
 		} // end of "if controllEvent..."
-		if (ev instanceof DataChangeEvent && ev.target == mapServiceChoice) {
+		if (ev instanceof DataChangeEvent){
+		    if (ev.target == mapServiceChoice) {
 			mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
 			scaleInput.setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScale));
 			scaleInputPerCache.setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScale));
+		    }
+		    else if (ev.target == overlappingInput){
+			pref.mapOverlapping = Convert.toInt(overlappingInput.getText ());
+		    }
 		}
 		super.onEvent(ev);
 	}



From pfeffer at mail.berlios.de  Sat Sep 19 00:35:25 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 19 Sep 2009 00:35:25 +0200
Subject: [Cachewolf-svn] r2202 - trunk/res_noewe/languages
Message-ID: <200909182235.n8IMZPPl009932@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-19 00:35:21 +0200 (Sat, 19 Sep 2009)
New Revision: 2202

Modified:
   trunk/res_noewe/languages/PL.cfg
Log:
Polish translation made better (original translation and this version made by picek, see http://forum.opencaching.pl/viewtopic.php?t=4413&postdays=0&postorder=asc&start=30 )

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-18 14:58:06 UTC (rev 2201)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-18 22:35:21 UTC (rev 2202)
@@ -9,16 +9,16 @@
                 105=TomTom
                 106=MS AutoRoute CSV
                 107=Eksport
-                108=Wlasciwosci
+                108=Opcje
                 109=Wczytaj skrzynki
                 110=Zapisz i wyjdz
                 111=Wyjdz
                 112=Szukaj
                 113=Wyczysc wyszukiwanie
-                114=Edytuj i uzyj filtra
+                114=Edytuj filtr
                 115=Odwroc filtr
                 116=Wyczysc filtr
-                117=O...
+                117=O programie
                 118=WolfLanguage
                 119=Szukaj:
                 120=Aplikacja
@@ -31,11 +31,11 @@
                 127=Zapisz
                 128=Przez szablon
                 129=Importuj GPX
-                130=Sciagnij z opencaching
+                130=Sciagnij z opencaching.de
                 131=Sciagnij z geocaching.com
                 132=Explorist
                 133=Szukaj wszystkich
-                134=Wybrana Skrzynka
+                134=Zaznaczony Cache
                 139=Zarzadzaj Travelbugami
                 140=Zarzadzanie
                 141=Kopiuj
@@ -55,7 +55,7 @@
                 155=Legenda
                 156=Blad pamieci - za duza mapa
                 157=System
-                158=Sprawdzanie wersji
+                158=Sprawdz wersje
                 159=Filtr
                 160=Filtruj zaznaczone
                 161=Pokaz czarna liste
@@ -68,7 +68,7 @@
                 175=Importuj
                 176=Pierwsze uruchomienie %0a Prosze wybrac katalog z danymi %0a i stworzyc swoj profil %0a%0a Dla zaawansowanych: %0a Blad odczytu pliku wlasciwosci:%0a
                 177=-- chwilowo nieuzywane--
-                178=Sprawdzanie wersji
+                178=Sprawdz wersje
                 179=Jestes na%0atej wersji.
                 180=Wez skrzynki
                 181=tutaj
@@ -78,7 +78,7 @@
                 185=Zapisz (bez potwierdzenia)
                 186=Wez tez Addi Wpts
                 187=Pokaz tylko te waypointy
-                188=CACHEWYCIECZKA: Nowa
+                188=PlanujTrase: Nowa
                 189=Wlacz filtr wycieczki
                 190=Pokaz tylko te waypointy
                 191=Wybierz plik
@@ -87,7 +87,7 @@
                 195=Aktualny srodek
                 196=Wszystkich # skrzynek (GC&OC)%0aWszystkich # widocznych%0aWszystkich # znalezionych
                 197=Pokaz/ukryj cachewycieczke
-                198=cachewycieczka
+                198=PlanujTrase
                 199=Dodaj do cachewycieczki
                 200=Szczegoly
                 201=Opis
@@ -138,7 +138,7 @@
                 270=Liczba szczegolow w RAM:
                 271=Maksymalnie:
                 272=Wersja CacheWolf-a:
-                299=Regular expression
+                299=Wyrazenie regularne (zwykle)
                 300=Typ:
                 301=Rozmiar:
                 302=Waypoint:
@@ -320,14 +320,14 @@
                 1011=Filtruj niezaznaczone
                 1012=Usun zaznaczone
                 1013=Wybrane / Zaznaczone
-                1014=Aktualizuj wybrane
+                1014=Aktualizuj zaznaczone
                 1015=Zaznacz wszystkie
                 1016=Odznacz wszystkie
                 1017=S
                 1018=Otworz offline w przegladarce
-                1019=Ustaw jako wysrodkowane
+                1019=Ustaw jako srodek
                 1020=Otworz online w przegladarce
-                1021=Otworz opis skrzynki
+                1021=Pokaz opis
                 1022=Skasuj wszystkie waypointy z zaznaczeniem (
                 1023=Funkcja dostepna tylko dla geocaching.com
                 1024=Odleglosci na liscie ustalone od aktualnej pozycji
@@ -406,7 +406,7 @@
                 1500=DST:
                 1501=Aktualna
                 1502=deg
-                1503=P??noc wysrodkowane
+                1503=Polnoc wysrodkowane
                 1504=Start GPS
                 1505=Stop GPS
                 1506=Mapa
@@ -417,14 +417,14 @@
                 1511=Bledne dane z GPS%0a mozliwe przyczyny:%0a zly Port,%0a zla predkosc portu (Baudrate),%0a protokol nie NMEA%0aPolaczenie z portem zerwane%0aOstatni wiersz probowany do interpretacji:%0a
                 1512=Waypoint
                 1513=Nie mozna poruszac mapy bez prawidlowych wspolrzednych.%0a Prosze Wprowadz Wspolrzedne srodka %0alub na wybrana skrzynke, lub pozycja GPS
-                1514=Nie mo?na przeliczyc odleglosci, pozycja GPS nie ustawiona
-                1600=+Download
+                1514=Nie mozna przeliczyc odleglosci, pozycja GPS nie ustawiona
+                1600=Opencahing.de Download
                 1601=Odleglosc:
                 1602=Sciagnij obrazki
                 1603=Sciagnij mapy
                 1604=Anuluj
                 1605=OK
-                1606=OC Sciagnij ponownie wszystko
+                1606=Sciagnij ponownie wszystko
                 1607=Update Z opencaching udany
                 1608=Sciagam dane Z opencaching...
                 1609=Importuje Skrzynke:
@@ -484,13 +484,13 @@
                 1737=Zapisz
                 1738=Zapisz jako
                 1739=Azymut musi byc w przedziale [0;2*PI] stopni 
-                1740=Crossazymut degrees  must be in interval [0;360]
-                1741=Crossazymut degrees  must be in interval [0;2*PI]
-                1742=Crossazymut: Odleglosc between points to small
-                1743=Crossazymut calculation failed. Prosze inform the developers at geoclub.de
-                1800=Download georeferenced maps
-                1801=Download tiles
-                1802=Download georeferenced maps%0a Wybierz serwis online:
+                1740=Crossazymut musi byc w przedziale [0;360]
+                1741=Crossazymut musi byc w przedziale [0;2*PI]
+                1742=Crossazymut: Odleglosc miedzy punktami za mala
+                1743=Crossazymut obliczenia nieudane. Prosze poinformowac programistow na geoclub.de
+                1800=Sciagnij skalibrowane mapy
+                1801=Sciagnij kawalki (?)
+                1802=Sciagnij skalibrowane mapy%0a Wybierz serwis online:
                 1803=dla
                 1804=wszystkich
                 1805=zaznaczonych
@@ -498,200 +498,200 @@
                 1807=Okolo m na pixel:
                 1808=zachodzenie na pixel:
                 1809=sciagnij mape ogolna
-                1810=Within a rectangle of:
+                1810=wewnatrz prostokata:
                 1811=dookola srodka:
-                1812=Tiles
+                1812=Kawalki (?)
                 1813=Sciagnij mape dla
                 1814=Dla skrzynki
-                1815=Downloading georeferenced maps
-                1816=Downloading georeferenced maps%0a %0a %0a %0a %0a
-                1817=No caches are ticked
+                1815=Sciaganie skalibrowanych map
+                1816=Sciaganie skalibrowanych map %0a %0a %0a %0a %0a
+                1817=Nie wybrano skrzynek
                 1818=getSortedMapServiceIndex: index
-                1819=not Znaleziona
-                1820=Downloading map '
-                1821=%0a for cache:%0a
-                1822=Cache:
-                1823=Ignoring Blad:
-                1824=downloading overview map
-                1825=Overview map: Ignoring Blad:
-                1826=Finished downloading and calibration of maps
-                1827='radius' must be graeter than 0
-                1828='overlapping' must be greater lub equal 0
-                1829=Prosze Wprowadz the 'centre' around which the maps shall be downloaded
-                1830=The Wybierzed online map service provides map in the scale from
-                1831= to
-                1832=%0a Prosze adjust 'Approx. meter pro pixel' accordingly
-                1833=Prosze don't Wybierz the separetor line in the wms service option
+                1819=Nienaleziona
+                1820=Sciagam mape '
+                1821=%0a dla skrzynki:%0a
+                1822=Skrzynka:
+                1823=Ignoruje blad:
+                1824=sciaganie mapy przegladawej
+                1825=Mapa przegladowa: Ignoruje Blad:
+                1826=Zakonczone sciaganie i kalibrowanie map
+                1827='radius' musi byc wieksze niz 0
+                1828='overlapping' musi byc rowne lub wieksze niz 0
+                1829=Prosze Wprowadz 'srodek' wokol ktorego sciagnac mape
+                1830=Wybrany serwis map online daje mapy w skali od
+                1831= do
+                1832=%0a Prosze dostosowac 'Approx. meter pro pixel' accordingly
+                1833=Prosze nie wybierac lini separatora w opcjach serwisu wms
                 2000=GPX Export
                 2001=of
-                2500=Blad loading attributes lub unknown attribute
-                2501=not 24-7
-                2502=available 24-7
-                2503=no bikes
-                2504=bikes allowed
-                2505=*boat-no
-                2506=*boat-yes
-                2507=*cactus-no
-                2508=*cactus-yes
-                2509=no campfires
-                2510=campfires allowed
-                2511=No camping
-                2512=Camping allowed
-                2513=*cliff-no
-                2514=falling rocks nearby
-                2515=no difficult climbing
-                2516=difficult climbing
-                2517=*compass-no
-                2518=*compass-yes
-                2519=*cow-no
-                2520=watch for livestock
-                2521=*danger-no
-                2522=dangerous area
-                2523=no dogs
-                2524=dogs allowed
-                2525=*fee-no
-                2526=access/parking fees
-                2527=*hiking-no
-                2528=significant hike
-                2529=no horses
-                2530=horses allowed
-                2531=*hunting-no
-                2532=hunting area
-                2533=no off-road vehicles
-                2534=off-road vehicles allowed
-                2535=no kids
-                2536=kid friendly
-                2537=*mine-no
-                2538=*mine-yes
-                2539=no motorcycles
-                2540=motorcycles allowed
-                2541=not recommended at night
-                2542=recommended at night
-                2543=takes Wiecej niz jeden hour
-                2544=takes less than one hour
-                2545=*parking-no
-                2546=parking available
-                2547=*phone-no
-                2548=telephone nearby
-                2549=*picnic-no
-                2550=picnic tables available
-                2551=*poisonoak-no
-                2552=*poisonoak-yes
-                2553=*public-no
-                2554=public transit available
-                2555=no quads
-                2556=quads allowed
-                2557=*rappelling-no
-                2558=climbing gear
-                2559=*restrooms-no
-                2560=restrooms available
-                2561=*scenic-no
-                2562=scenic view
-                2563=*scuba-no
-                2564=*scuba-yes
-                2565=*snakes-no
-                2566=*snakes-yes
-                2567=no snowmobiles
-                2568=*snowmobiles-yes
-                2569=no stealth required
-                2570=stealth required
-                2571=not stroller accessible
-                2572=stroller accessible
-                2573=*plywanie-no
-                2574=*plywanie-yes
-                2575=*thorn-no
-                2576=thorns!
-                2577=*ticks-no
-                2578=ticks!
-                2579=*wading-no
-                2580=may require wading
-                2581=*water-no
-                2582=drinking water nearby
-                2583=not wheelchair accessible
-                2584=wheelchair accessible
-                2585=not available in winter
-                2586=available in winter
-                2587=No maintenance needed
-                2588=Needs maintenance
-                2589=Flashlight required
-                3000=Close
-                4000=Loaded caches:+
-                4001=GPX pliks Z opencaching don't contain information of images, they cannot be laoded. Best you get caches Z opencaching by menu /Application/Import/Download Z Opencaching
-                4101=Maps
-                4102=Calibrated maps
-                4103=Not calibrated maps
+                2500=Blad wczytywania albo bledne atrybuty
+                2501=niedostepna 24-7
+                2502=dostepna 24-7
+                2503=bez rowerow
+                2504=rowery dozwolone
+                2505=*lodz-nie
+                2506=*potrzebna lodz
+                2507=*kaktusy/kolce-nie
+                2508=*kaktusy/kolce-tak
+                2509=brak miejsca na ognisko
+                2510=mozna palic ognisko
+                2511=nie rozbijac namiotow
+                2512=Mozesz rozbic namiot
+                2513=*wspinaczka-nie
+                2514=uwaga, spadajace skaly
+                2515=latwa wspinaczka
+                2516=trudna wspinaczka
+                2517=*kompas-nie
+                2518=*kompas-tak
+                2519=*bydlo-nie
+                2520=uwaga na trzode
+                2521=*brak niebezpieczenstw
+                2522=teren niebezpieczny
+                2523=bez psow
+                2524=mozna wziac psa
+                2525=*brak oplat
+                2526=oplaty wejscie/parking
+                2527=*nie trzeba chodzic
+                2528=dluzsza trasa do przejscia
+                2529=zakaz koni
+                2530=mozna jechac konno
+                2531=*zakaz polowania
+                2532=teren lowiecki
+                2533=zakaz pojazdow offroad
+                2534=mozesz wjechac offroadem
+                2535=nie bierz dzieci
+                2536=mozesz wziac dzieci
+                2537=*nie ma min/kopalni
+                2538=*kopalnie
+                2539=Zakaz motorow
+                2540=Mozna motorem
+                2541=nie zalecana w nocy
+                2542=zalecana w nocy
+                2543=trzeba poswiecic ponad godzine
+                2544=mniej niz godzine
+                2545=*parking-nie
+                2546=parking dostepny
+                2547=*nie ma budki tel
+                2548=budka tel niedaleko
+                2549=*brak miejs piknikowych
+                2550=stoliki piknikowe niedaleko
+                2551=*trujace-nie
+                2552=*uwaga cos trujacego/jadowitego
+                2553=*nie dojedziesz publicznym transportem
+                2554=dojezdza transport publiczny
+                2555=bez quadow
+                2556=Mozna quadami
+                2557=*liny-nie
+                2558=Sprzet wspinaczkowy
+                2559=*ubikacje-nie
+                2560=ubikacje niedaleko
+                2561=*malownicze widoki-nie
+                2562=malownicze widoki
+                2563=*nurkowanie-nie
+                2564=*nurkowanie-tak
+                2565=*bez wezy
+                2566=*weze!
+                2567=bez pojazdow snieznych
+                2568=*pojazdy sniezne
+                2569=nie musisz byc ostrozny
+                2570=zachowaj ostroznosc
+                2571=bez wozkow
+                2572=mozna na wozku
+                2573=*plywanie-nie
+                2574=*plywanie-tak
+                2575=*nie ma cierni
+                2576=ciernie!
+                2577=*bez kleszczy
+                2578=kleszcze!
+                2579=*nie trzeba brodzic
+                2580=moze wymagac brodzenia w wodzie
+                2581=*nie ma wody w poblizu
+                2582=woda pitna dostepna
+                2583=niedostepna z wozkiem inwalidzkim
+                2584=dostepna z wozkiem inwalidzkim
+                2585=niedostepna zima
+                2586=dostepna zima
+                2587=Nie trzeba serwisu
+                2588=Potrzeba serwisu
+                2589=Potrzebna latarka
+                3000=Zamknij
+                4000=Wczytaj skrzynki:+
+                4001=Pliki GPX z opencaching nie zawieraja informacji o obrazach, nie moga byc one wczytane. Najlepiej pobierz skrzynki z opencaching przez menu /Aplikacja/Importuj/Sciagnij Z Opencaching
+                4101=Mapy
+                4102=Skalibrowane mapy
+                4103=Nie skalibrowane mapy
                 4104=Anuluj
-                4105=Load
-                4106=Calibrate map
-                4107=Done!
-                4108=Coordinates:
-                4109=Loading maps...
-                4110=loading
-                4111=Wspolrzednemust be Wprowadzed in the format N XX XX.XXX E XXX XX.XXX
-                4112=IO-Blad while kopiujing image from:+
-                4113=to:+
+                4105=Wczytaj
+                4106=Kalibracja mapy
+                4107=Zrobione!
+                4108=Wspolrzedne:
+                4109=Wczytuje mapy...
+                4110=wczytuje
+                4111=Wspolrzedne musza byc wprowadzone w formacie N XX XX.XXX E XXX XX.XXX
+                4112=IO-Blad podczas kopiowania obrazu z:+
+                4113=do:+
                 4114=+Blad:+
-                4115=Blad: could not decode image:+
-                4116=+-+image not copied
-                4117=Blad while importing .map-plik:+
-                4118=IO-Blad while reading lub writing calibration plik
-                4119=No calibration plik Znaleziona for:+
-                4120=done.
-                4200=Wybierz map directory
-                4201=Information
-                4203=Loading list of maps...
-                4204=No georeferenced map available %0a Prosze Wybierz a scale %0a to show the track and the caches. %0a You can get one by the menu: Application/Maps/download calibrated
+                4115=Blad: nie moge odczytac obrazu:+
+                4116=+-+obraz nie skopiowany
+                4117=Blad podczas importowania pliku .map:+
+                4118=IO-Blad podczas wczytywania lub nadpisywania pliku
+                4119=Plik kalibracji nie znaleziony dla:+
+                4120=skonczone.
+                4200=Wybierz katalog map
+                4201=Informacja
+                4203=Wczytuje liste map...
+                4204=Brak skalibrowanej mapy %0a Prosze Wybierz skale %0a by pokazac trase i skrzynki. %0a Mozesz uzyskac jakas przez menu: Aplikacja/Mapy/sciagnij skalibrowane
                 4206=Dist:+
                 4207=Blad
-                4208=Bug: %0aillegal mapChangeModus:+
-                4210=Moving map cannot run without a map - Prosze Wybierz one. %0a You can Wybierz an empty map
-                4211=No+
-                4212=less
-                4213=more
-                4214=+detailed map available
-                4215=No caches Wybierzed by a tick
-                4216=Loading map...
-                4217=Could not find image associated with: %0a
-                4218=Could not load map: %0a
-                4219=Not enough memory to load map: %0a
-                4220=%0a You can try to close %0a all prgrams and %0a restart CacheWolf
-                4221=Not enough ressources to load map:+
-                4222=Out of memory Blad
-                4230=Goto here$g
-                4232=Create nowy Waypoint here$n
-                4234=Wybierz a map manually$s
-                4236=Change map directory$c
-                4237=Change map directory
-                4238=Show map
-                4239=Show map
-                4240=Hide map
-                4241=Hide map
-                4242=Modus for automatic map change
-                4244=Highest res. containing dest. & cur. position
-                4246=Highest resolution
-                4247=Highest resolution
-                4248=Keep manual resolution
-                4249=Keep manual resolution
-                4250=Change resolution manually
-                4252=Load a map containing all marked caches
-                4253=Load a map containing all marked caches
-                4254=Load a map with more details
-                4255=Load a map with more details
-                4256=Load a map for a better overview
-                4257=Load a map for a better overview
-                4258=Move map to and load map
-                4260=Move map to goto point
-                4261=Move map to goto point
-                4262=Move map to GPS position
-                4263=Move map to GPS position
-                4264=Move map to centre
-                4265=Move map to centre
-                4266=Fill white areas
-                4267=Show white areas
-                4270=Open
-                4271=--- Maps containing GPS and goto pos. ---
-                4273=--- Maps containing curr. position ---
-                4274=--- Maps containing goto position ---
+                4208=Bug: %0anieprawidlowy mapChangeModus:+
+                4210=Przesuwanie mapy nie moze dzialac bez mapy - Prosze wybrac jakas. %0a Mozesz wybrac pusta
+                4211=Zadna+
+                4212=mniej
+                4213=bardziej
+                4214=+szczegolowa mapa dostepna
+                4215=Nie ma skrzynek wybraych
+                4216=Wczytuje mape...
+                4217=Nie moge znalezc obrazow polaczonych z: %0a
+                4218=Nie moge wczytac mapy: %0a
+                4219=Za malo pamieci do wczytania mapy: %0a
+                4220=%0a Mozesz sprobowac zamknac %0a wszystkie programy %0a i zrestartowac CacheWolfa
+                4221=Za malo zrodel do wczytania mapy:+
+                4222=Za malo pamieci
+                4230=Idz tu$g
+                4232=Utworz nowy Waypoint tutaj$n
+                4234=Wybierz mape recznie$s
+                4236=Zmien katalog map$c
+                4237=Zmien katalog map
+                4238=Pokaz mape
+                4239=Pokaz mape
+                4240=Ukryj mape
+                4241=Ukryj mape
+                4242=Sposob autozmian mapy
+                4244=Najwyzsza rozdz. zawierajaca akt. polozenie i cel
+                4246=Najwieksza rozdzielczosc
+                4247=Najwieksza rozdzielczosc
+                4248=Reczna rozdzielczosc
+                4249=Reczna rozdzielczosc
+                4250=Reczna zmiana rozdzielczosci
+                4252=Wczytaj mape z wszystkimi zazn. skrzynki
+                4253=Wczytaj mape z wszystkimi zazn. skrzynki
+                4254=Wczytaj mape szczegolowa 
+                4255=Wczytaj mape szczegolowa
+                4256=Wczytaj mape przegladowa
+                4257=Wczytaj mape przegladowa
+                4258=Wczytaj i ustaw mape
+                4260=Punkt docelowy
+                4261=Punkt docelowy
+                4262=Pozycja GPS
+                4263=Pozycja GPS
+                4264=Srodek mapy
+                4265=Srodek mapy
+                4266=Wypelnij biale obszary
+                4267=Pokaz biale obszary
+                4270=Otworz
+                4271=--- Mapy zawierajace GPS i pozycje IdzDo. ---
+                4273=--- Mapy zawierajace akt. pozycje ---
+                4274=--- Mapy zawierajace pozycje IdzDo ---
                 4275=--- Inne mapy ---
                 4276=Anuluj
                 4277=Wybierz
@@ -705,26 +705,26 @@
                 4302=Lat/Lon poza obszarem podczas wczytywania+
                 4303=za malo lini w pliku+
                 4304=za malo punktow do kalibracji mapy.
-                4305=Not allowed values in affine%0a (matrix cannot be inverted)%0a w pliku %0a
+                4305=Nieprawidlowe wartosci afiniczne %0a (macierz nie moze byc odwrocona)%0a w pliku %0a
                 4306=mapa nie skalibrowana
                 4400=Uwaga
-                4401=Ignoring Blad:%0a could not forward GPS data to host:%0a
+                4401=Ignoruje Blad:%0a nie moge podac danych GPS do hosta:%0a
                 4402=%0azatrzymaj i uruchom GPS by sprobowac ponownie
                 4403=Blad
                 4404=Nie moge polaczyc z odbiornikiem GPS.%0a Blad otwarcia Portu szeregowego%0a
                 4405=%0amozliwe przyczyny:\n Inny (GPS-)program blokuje port%0azly port%0aLoox: aktywna podczerwien blokuje GPS"
                 4406=Prosze kopiuj jave_ewe.dll do katalogu z programem
-                4407=The Profil pliks are not in the aktualna format.%0aTherefore they are now converted to the aktualna format. Depending of the size of the Profil and the computer involved this may take some minutes. Prosze bear with us until the conwersja is done.
-                4408=Could not connect to GPSD:
-                4409=%0amozliwe przyczyny:%0aGPSD host is not reachable lub GPSD is not running there
-                4500=Tot:
-                4501=Vis:
-                4502=Fnd:
-                4600=Some cache(s) cannot be shown because of wrong blacklist status
+                4407=Pliki Profilu sa w nieaktualnym formacie.%0aZostaja na sile przekonwertowywane na aktualny format.%0a W zaleznosci od wielkosci profilu i mozliwosci komputera moze to chwile potrwac.%0a Prosze czekac?]
+                4408=Nie moge polaczyc z GPSD:
+                4409=%0amozliwe przyczyny:%0aGPSD host nieosiagalny lub GPSD tu nie dziala
+                4500=Wsz:
+                4501=Odw:
+                4502=Zna:
+                4600=Niektore skrzynki nie moga byc wyswietlone bo sa na blackliscie
                 4700=Ignoruje blad podczas%0aodczytu pliku kalibracji%0a
                 4701=Szukam najlepszej mapy
                 4702=Optymalizacja
-                4703=Cachewolf moze wczytywac mapy duzo szybciej dodajac znaczniki identyfikujace do nazwy pliku. Zrobic to teraz?%0aTo moze zajac pare minut.
+                4703=Cachewolf moze wczytywac mapy duzo szybciej%0a dodajac znaczniki identyfikujace do nazwy pliku. %0a Zrobic to teraz?%0aTo moze zajac pare minut.
                 4704=%0aPonownie nazywam plik:
                 4705=Blad ponownego nazywania:%0a
                 4706=%0ado:%0
@@ -743,16 +743,16 @@
                 4809= to nie obraz, poczatek struktury zawartosci:
                 4810=Blad podczas sciagania lub zapisu mapy:%0a
                 4811=OnlineMapService: getMapInfoObjectInternal(Pole mapy, Point pixelsize):%0a This method must be overloaded in order to be able to use it
-                4812=WebMapService: property >Nazwa:< brakuje w pliku:%0a
-                4813=WebMapService: property >MainUrl:< brakuje w pliku:%0a
+                4812=WebMapService: dane >Nazwa:< brakuje w pliku:%0a
+                4813=WebMapService: dane >MainUrl:< brakuje w pliku:%0a
                 4814=WebMapService: CoordinateReferenceSystemCacheWolf nie ma zadnej wartosci
                 4815=System powiazan wspolrzednych nie wspierany przez CacheWolf:%0a
-                4816=WebMapService: property >CoordinateReferenceSystemUrlPart:< brak w pliku:%0a
+                4816=WebMapService: dane >CoordinateReferenceSystemUrlPart:< brak w pliku:%0a
                 4817=numer wierszy w CoordinateReferenceSystemUrlPart (
                 4818=) musi byc taki sam jak numer kodu w CoordinateReferenceSystemCacheWolf (
                 4819=) uzyj spacji do rozdzielenia
-                4820=WebMapService: property >CoordinateReferenceSystemUrlPart:< bledne w pliku:%0a
-                4821=WebMapService: property >ImageplikExtension:< brak w pliku:%0a
+                4820=WebMapService: dane >CoordinateReferenceSystemUrlPart:< bledne w pliku:%0a
+                4821=WebMapService: dane >ImageplikExtension:< brak w pliku:%0a
                 4822=obszar:
                 4823= brak pokrycia w serwisie:
                 4824=, obszar:
@@ -766,7 +766,7 @@
                 4900=+to nie sa koordynaty Gauss-Krueger
                 4920=EPSG code+
                 4921=+nie wspierane
-                4922=EPSG code missing in:+
+                4922=EPSG code brakujacy w:+
                 4923=fromWgs84: EPSG code+
                 4924=ToWgs84: EPSG code+
                 5498=Nieudane logowanie. Blad wczytania strony po zalogowaniu.
@@ -778,9 +778,9 @@
                 5004=Buduje powiazania z dodatkowymi waypointami...
                 5497=Blad: Brakuje tagu w spider.def
                 5500=Blad
-                5501=Logowanie nieudane! Zle konto lub Haslo?
-                5502=Fetching first page...
-                5503=Blad fetching first list page.
+                5501=Logowanie nieudane! Brak konta lub zle haslo?
+                5502=Sciagam pierwsza strone...
+                5503=Blad pozyskiwania pierwszej strony.
                 5504=Nie mozna wczytac 'spider.def'
                 5505=Wprowadz Haslo
                 5506=Haslo
@@ -802,88 +802,88 @@
                 6000=Przewodnik
                 6001=Nazwa
                 6002=sciezka#
-		6003=Misja
-		6004=Z Prof
-		6005=Z Wpt
-		6006=Z Dane
-		6007=Z Log
-		6008=Do Prof
-	  	6009=Do Wpt
-		6010=Do Dane
-		6011=Do Log
-		6015=*** INNE ***
-		6016=Wez travelbug
-		6017=Wrzuc travelbug
-		6018=Travelbug Nazwa
-		6019=Tracking numer
-		6020=Travelbug nie znaleziony.
-		6021=Wiecej niz jeden travelbug Znaleziony. Sprecyzuj nazwe.
-		6022=: aktualna cache:+
-		6025=Nazwa:
-		6026=Tracking #:
-		6027=Id/Guid:
-		6028=Nazwa
-		6029=Profil/Cache:
-		6030=Znaleziona:
-		6031=Zalogowana
-		6032=Od
-		6033=Data wrzucenia:
-		6034=Do
-		6035=Misja:
-		6036=Misja
-		6040=Zabierz TB z aktualnej skrzynki
-		6041=Wrzuc TB do skrzynki
-		6042=nowy Travelbug
-		6043=Usun Travelbug
-		6044=Pobierz misje (i nazwe)
-		6045=Otworz online
-		6046=Pokaz tylko nie zalogowane
-		6047=Usun wybrane Travelbugi
-		6050=Pokaz kolumny
-		6051=Don't show column
-		6100=Slonce
-		6101=Ksiezyc
-		6102=Wielka Niedzwiedzica
-		6103=Orion
-		6104=Cassiopeia
-		6105=Cygnus
-		6126=Mimosa w Krzyzu Poludnia
-		7000=Release
-		7001=RC
-		7002=w opracowaniu, stabilna
-		7003=w opracowaniu, najnowsza
-		7010=bereits aktuell(er)
-		7011=Update available
-		7012=not available
-		7013=Blad
-		7020=Typ rekomendowanej wersji
-		7021=typ tej wersji
-		7022=Typ wersji
-		7023=Blad sciagania informacji aktualnej wersji
-		7100=Opcje portu szeregowego
-		7101=Update Ports$u
-		7102=Baud:$b
-		7103=Scan$u
-		7104=Test$t
-		7105=Przekaz dane GPS do hosta
-		7106=Wszystkie dane z GPS beda przeslane na port 23 TCP%0a i moga byc przekierowane na port szeregowy%0a przez
-		7107=Przerwa w sekundach dla logowania
-		7108=Blad: Nieudane otwarcie portu szeregowego:+
-		7109=Blad: Nie moge zyskac danych o portach szeregowych%0a
-		7110=GPS nie znaleziony%0a
-		7111=Probowanie+
-		7112= +
-		7113= - sa jakies dane%0a
-		7114=GPS Port Znaleziony%0a
-		7115= - Nie znaleziono tagu danych GPS%0a
-		7116= - nie otrzymano danych%0a
-		7117=Pokazuje dane bezposrednio z portu:%0a
-		7118=Stop
-		7119=Stop
-		7120=Anulowano
-		7121=Pobierz dane GPS z gpsd host
-		7122=Dane GPS beda pobrane z serwera gpsd, nie z portu szeregowego
-		7200=Uzytkowanie: CacheWolf [-c <path to pref.xml>] [-debug]
-		{..}
-	{..}
+                6003=Misja
+                6004=Z Prof
+                6005=Z Wpt
+                6006=Z Dane
+                6007=Z Log
+                6008=Do Prof
+                6009=Do Wpt
+                6010=Do Dane
+                6011=Do Log
+                6015=*** INNE ***
+                6016=Wez travelbug
+                6017=Wrzuc travelbug
+                6018=Travelbug Nazwa
+                6019=Tracking numer
+                6020=Travelbug nie znaleziony.
+                6021=Wiecej niz jeden travelbug Znaleziony. Sprecyzuj nazwe.
+                6022=: aktualna cache:+
+                6025=Nazwa:
+                6026=Tracking #:
+                6027=Id/Guid:
+                6028=Nazwa
+                6029=Profil/Cache:
+                6030=Znaleziona:
+                6031=Zalogowana
+                6032=Od
+                6033=Data wrzucenia:
+                6034=Do
+                6035=Misja:
+                6036=Misja
+                6040=Zabierz TB z aktualnej skrzynki
+                6041=Wrzuc TB do skrzynki
+                6042=nowy Travelbug
+                6043=Usun Travelbug
+                6044=Pobierz misje (i nazwe)
+                6045=Otworz online
+                6046=Pokaz tylko nie zalogowane
+                6047=Usun wybrane Travelbugi
+                6050=Pokaz kolumny
+                6051=Nie pokazuj kolumny
+                6100=Slonce
+                6101=Ksiezyc
+                6102=Wielka Niedzwiedzica
+                6103=Orion
+                6104=Cassiopeia
+                6105=Cygnus
+                6126=Mimosa w Krzyzu Poludnia
+                7000=Wypuszczona
+                7001=RC
+                7002=w opracowaniu, stabilna
+                7003=w opracowaniu, najnowsza
+                7010=bereits aktuell(er)
+                7011=Uptade dostepny
+                7012=niedostepne
+                7013=Blad
+                7020=Typ rekomendowanej wersji
+                7021=typ tej wersji
+                7022=Typ wersji
+                7023=Blad sciagania informacji aktualnej wersji
+                7100=Opcje portu szeregowego
+                7101=Update Ports$u
+                7102=Baud:$b
+                7103=Scan$u
+                7104=Test$t
+                7105=Przekaz dane GPS do hosta
+                7106=Wszystkie dane z GPS beda przeslane na port 23 TCP%0a i moga byc przekierowane na port szeregowy%0a przez
+                7107=Przerwa w sekundach dla logowania
+                7108=Blad: Nieudane otwarcie portu szeregowego:+
+                7109=Blad: Nie moge zyskac danych o portach szeregowych%0a
+                7110=GPS nie znaleziony%0a
+                7111=Probowanie+
+                7112= +
+                7113= - sa jakies dane%0a
+                7114=GPS Port Znaleziony%0a
+                7115= - Nie znaleziono tagu danych GPS%0a
+                7116= - nie otrzymano danych%0a
+                7117=Pokazuje dane bezposrednio z portu:%0a
+                7118=Stop
+                7119=Stop
+                7120=Anulowano
+                7121=Pobierz dane GPS z gpsd host
+                7122=Dane GPS beda pobrane z serwera gpsd, nie z portu szeregowego
+                7200=Uzytkowanie: CacheWolf [-c <path to pref.xml>] [-debug]
+                {..}
+       {..}
 {..}



From pfeffer at mail.berlios.de  Sat Sep 19 00:53:00 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 19 Sep 2009 00:53:00 +0200
Subject: [Cachewolf-svn] r2203 - trunk/res_noewe/languages
Message-ID: <200909182253.n8IMr0l4023902@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-19 00:52:47 +0200 (Sat, 19 Sep 2009)
New Revision: 2203

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/PL.cfg
Log:
Language files: mark the unused item no. 207 as free / unused

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-18 22:35:21 UTC (rev 2202)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-18 22:52:47 UTC (rev 2203)
@@ -96,7 +96,7 @@
 		204=L%f6ser
 		205=Radar
 		206=Liste
-		207=Immer neu einloggen
+		207=**frei/nicht benutzt / veraltet**
 		208=Index neu erstellen
 		209=Wiederaufbau Index
 		210=Caches nicht in index.xml:+

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-18 22:35:21 UTC (rev 2202)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-18 22:52:47 UTC (rev 2203)
@@ -96,7 +96,7 @@
 		204=Solver
 		205=Radar
 		206=List
-		207=Always login to GC
+		207=** unused **
 		208=Rebuild index
 		209=Rebuilding index
 		210=Caches not in index.xml:+

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-18 22:35:21 UTC (rev 2202)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-18 22:52:47 UTC (rev 2203)
@@ -96,7 +96,7 @@
 		204=Resoudeur
 		205=Radar
 		206=Liste
-		207=Toujours connecter
+		207=** liberte **
 		208=R%e9cr%e9er index
 		209=R%e9cr%e9er index
 		210=Caches pas en index.xml:+
@@ -104,7 +104,8 @@
 		212=Effacer toutes les fichier .xml (et images) qui ne sont pas en index.xml
 		213=Effacer les fichier .xml orpheline
 		214=Nouveau waypoint
-		218=Aussi dans description/notes
+        216=Toujours connecter
+        218=Aussi dans description/notes
 		219=Cherchant...
 		220=V%e9rifier notes et resoudeur
 		221=%c9craser filtre?

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-18 22:35:21 UTC (rev 2202)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-18 22:52:47 UTC (rev 2203)
@@ -96,7 +96,7 @@
                 204=Pomoc w rozwiazaniu
                 205=Radar
                 206=Lista
-                207=Zawsze loguj na GC
+                207=** free / unused / depreciated **
                 208=Przebuduj index
                 209=Trwa przebudowywanie index
                 210=Nie ma skrzynek w index.xml:+



From pfeffer at mail.berlios.de  Sun Sep 20 12:43:27 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 20 Sep 2009 12:43:27 +0200
Subject: [Cachewolf-svn] r2204 - trunk/res_noewe/languages
Message-ID: <200909201043.n8KAhRSv024187@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-20 12:43:19 +0200 (Sun, 20 Sep 2009)
New Revision: 2204

Modified:
   trunk/res_noewe/languages/PL.cfg
Log:
polish translation: v3

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-18 22:52:47 UTC (rev 2203)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-20 10:43:19 UTC (rev 2204)
@@ -96,7 +96,7 @@
                 204=Pomoc w rozwiazaniu
                 205=Radar
                 206=Lista
-                207=** free / unused / depreciated **
+                207=** free/unused/depreciated **
                 208=Przebuduj index
                 209=Trwa przebudowywanie index
                 210=Nie ma skrzynek w index.xml:+
@@ -418,7 +418,7 @@
                 1512=Waypoint
                 1513=Nie mozna poruszac mapy bez prawidlowych wspolrzednych.%0a Prosze Wprowadz Wspolrzedne srodka %0alub na wybrana skrzynke, lub pozycja GPS
                 1514=Nie mozna przeliczyc odleglosci, pozycja GPS nie ustawiona
-                1600=Opencahing.de Download
+                1600=Opencahing Download
                 1601=Odleglosc:
                 1602=Sciagnij obrazki
                 1603=Sciagnij mapy
@@ -434,12 +434,12 @@
                 1613=Importowanie obrazow:
                 1614=Blad podczas rozpakowywania %0apliku update'u
                 1615=Blad przeliczania pliku, stan:
-                1616=Blad: nie moge sciagnac pliku z opencaching.de
+                1616=Blad: nie moge sciagnac pliku z opencaching
                 1617=Ignoruje Blad w html-skrzynka-opis: "<img" without "src=" dla skrzynki+
                 1618=Ignoruje Blad w skrzynce:+
                 1619=: nie moge pobrac obrazka z URL:+
                 1620=Sciagam osadzone grafiki:+
-                1621=Blad podczas interpretacji danych%0a Z Opencaching.de,%0aNajpopularniejszy blad w Opencaching.de%0aSprobuj pozniej%0a Status:
+                1621=Blad podczas interpretacji danych%0a Z Opencaching,%0aNajpopularniejszy blad w Opencaching%0aSprobuj pozniej%0a Status:
                 1622=Wyklucz znalezione skrzynki
                 1623=Max. numer:
                 1624=+skrzynek
@@ -697,9 +697,6 @@
                 4277=Wybierz
                 4278=Nie moge wczytac wfl-plik: \n
                 4279=Idz do
-				4280=[Small Tiles]
-				4281=[Medium Tiles]
-				4282=[Big Tiles]
                 4300=Pusty 1 Pixel =+
                 4301=+metrow
                 4302=Lat/Lon poza obszarem podczas wczytywania+



From mik77 at mail.berlios.de  Sun Sep 20 13:36:30 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 20 Sep 2009 13:36:30 +0200
Subject: [Cachewolf-svn] r2205 - in trunk/src/CacheWolf: . navi
Message-ID: <200909201136.n8KBaUSc001082@sheep.berlios.de>

Author: mik77
Date: 2009-09-20 13:36:07 +0200 (Sun, 20 Sep 2009)
New Revision: 2205

Modified:
   trunk/src/CacheWolf/CWPoint.java
   trunk/src/CacheWolf/navi/UTMProjection.java
Log:
Better handling for invalid coordinates. Clearing of waypoints in solver should work again now.

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2009-09-20 10:43:19 UTC (rev 2204)
+++ trunk/src/CacheWolf/CWPoint.java	2009-09-20 11:36:07 UTC (rev 2205)
@@ -171,7 +171,7 @@
 					)
 		*/	
 	String crsid = null;
-	if ((coord.charAt(2)=='.') && (coord.indexOf(' ') >= 0)) { // first 2 letters = Internet domain of projected area
+	if ((coord.length()>=2) && (coord.charAt(2)=='.') && (coord.indexOf(' ') >= 0)) { // first 2 letters = Internet domain of projected area
 		crsid = coord.substring(0, coord.indexOf(' '));
 		if (TransformCoordinates.getLocalSystemCode(crsid) != -1) {
 			coord = coord.substring(coord.indexOf(' ') + 1, coord.length());
@@ -262,8 +262,12 @@
 	 * @param utmzone
 	 */
 	public void set(String UTMNorthing, String UTMEasting, String utmzone){
-		ProjectedPoint utm = new ProjectedPoint(new CWPoint(Common.parseDouble(UTMNorthing), Common.parseDouble(UTMEasting)), utmzone, TransformCoordinates.LOCALSYSTEM_UTM_WGS84, true);
-		set(TransformCoordinates.ProjectedToWgs84(utm, TransformCoordinates.LOCALSYSTEM_UTM_WGS84, true));
+		try {
+			ProjectedPoint utm = new ProjectedPoint(new CWPoint(Common.parseDouble(UTMNorthing), Common.parseDouble(UTMEasting)), utmzone, TransformCoordinates.LOCALSYSTEM_UTM_WGS84, true);
+			set(TransformCoordinates.ProjectedToWgs84(utm, TransformCoordinates.LOCALSYSTEM_UTM_WGS84, true));
+		} catch (Exception e){
+			makeInvalid();
+		}
 	}
 
 	
@@ -297,9 +301,13 @@
 	 * @param localCooSystem one of TransformCoordinates.LOCALSYSTEM_XXX
 	 */
 	public void set (String strNorthing, String strEasting, int localCooSystem){
-		CWPoint pp = new CWPoint(Common.parseDouble(strNorthing),Common.parseDouble(strEasting));
-		ProjectedPoint gk = new ProjectedPoint(pp, localCooSystem, true, true);
-		set(TransformCoordinates.ProjectedToWgs84(gk, localCooSystem, true));
+		try {
+			CWPoint pp = new CWPoint(Common.parseDouble(strNorthing),Common.parseDouble(strEasting));
+			ProjectedPoint gk = new ProjectedPoint(pp, localCooSystem, true, true);
+			set(TransformCoordinates.ProjectedToWgs84(gk, localCooSystem, true));
+		} catch (Exception e){
+			makeInvalid();
+		}
 	}
 
 	/**
@@ -309,9 +317,13 @@
 	 * @param localCooSystem one of TransformCoordinates.LOCALSYSTEM_XXX which requires an explicit zone
 	 */
 	public void set (String strNorthing, String strEasting, String zone, int localCooSystem){
-		CWPoint pp = new CWPoint(Common.parseDouble(strNorthing),Common.parseDouble(strEasting));
-		ProjectedPoint gk = new ProjectedPoint(pp, zone, localCooSystem, true);
-		set(TransformCoordinates.ProjectedToWgs84(gk, localCooSystem, true));
+		try {
+			CWPoint pp = new CWPoint(Common.parseDouble(strNorthing),Common.parseDouble(strEasting));
+			ProjectedPoint gk = new ProjectedPoint(pp, zone, localCooSystem, true);
+			set(TransformCoordinates.ProjectedToWgs84(gk, localCooSystem, true));
+		} catch (Exception e){
+			makeInvalid();
+		}
 	}
 	/**
 	 * Get degrees of latitude in different formats

Modified: trunk/src/CacheWolf/navi/UTMProjection.java
===================================================================
--- trunk/src/CacheWolf/navi/UTMProjection.java	2009-09-20 10:43:19 UTC (rev 2204)
+++ trunk/src/CacheWolf/navi/UTMProjection.java	2009-09-20 11:36:07 UTC (rev 2205)
@@ -56,6 +56,7 @@
 		pp.easting = easting - 500000;
 		if (northing > 10000000) pp.northing = northing - 10000000;
 		else pp.northing = northing;
+		if (zone.length() < 1) throw new IllegalArgumentException("UTMProjection.set: zone must be set");
 		if (zone.length() > 3) throw new IllegalArgumentException("UTMProjection.set: zone must not have more than 3 letters");
 		char lastletter = zone.charAt(zone.length()-1); 
 		int zoneletter = -1;



From mik77 at mail.berlios.de  Mon Sep 21 20:27:27 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 21 Sep 2009 20:27:27 +0200
Subject: [Cachewolf-svn] r2206 - trunk/src/CacheWolf
Message-ID: <200909211827.n8LIRRbM016616@sheep.berlios.de>

Author: mik77
Date: 2009-09-21 20:27:24 +0200 (Mon, 21 Sep 2009)
New Revision: 2206

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
show main cache details in DetailsPanel of Addi

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-09-20 11:36:07 UTC (rev 2205)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-09-21 18:27:24 UTC (rev 2206)
@@ -320,13 +320,18 @@
 	public void setDetails(final CacheHolder ch, boolean isNew) {
 		needsTableUpdate = isNew;
 		cache = ch;
+		CacheHolder mainCache = ch;
+		if (ch.isAddiWpt() && (ch.mainCache != null)) {
+			mainCache = ch.mainCache;
+		}
 		dirtyNotes = false;
 		dirtyDetails = false;
 		inpWaypoint.setText(ch.getWayPoint());
 		inpName.setText(ch.getCacheName());
 		btnCoordinates.setText(ch.pos.toString());
-		inpHidden.setText(ch.getDateHidden());
-		inpOwner.setText(ch.getCacheOwner());
+		inpHidden.setText(mainCache.getDateHidden());
+		inpOwner.setText(mainCache.getCacheOwner());			
+
 		if (ch.getCacheStatus().length() >= 10 && ch.getCacheStatus().charAt(4) == '-') {
 			chcStatus.setText(MyLocale.getMsg(318, "Found") + " " + ch.getCacheStatus());
 		} else {
@@ -349,7 +354,7 @@
 		if (inpWaypoint.getText().length() == 0) {
 			createWptName();
 		}
-		if (ch.has_bugs()) {
+		if (mainCache.has_bugs()) {
 			// btnShowBug.modify(Control.Disabled,1);
 			btnShowBug.image = imgShowBug;
 		} else {
@@ -357,12 +362,10 @@
 			btnShowBug.image = imgShowBugNo;
 		}
 		btnShowBug.repaintNow();
-		chcSize.setInt(ch.getCacheSize());
+		chcSize.setInt(mainCache.getCacheSize());
 
 		attViewer.showImages(ch.getCacheDetails(true).attributes);
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
-			btnTerr.setText(MyLocale.getMsg(1001, "T") + DTINVALID);
-			btnDiff.setText(MyLocale.getMsg(1000, "D") + DTINVALID);
 			deactivateControl(btnTerr);
 			deactivateControl(btnDiff);
 			deactivateControl(chcSize);
@@ -370,7 +373,6 @@
 			deactivateControl(inpHidden);
 			deactivateControl(btnShowBug);
 			deactivateControl(btnBlack);
-			chcSize.select(0);
 		} else {
 			activateControl(btnTerr);
 			activateControl(btnDiff);
@@ -379,25 +381,33 @@
 			activateControl(inpHidden);
 			activateControl(btnShowBug);
 			activateControl(btnBlack);
-			if (CacheTerrDiff.isValidTD(ch.getTerrain())) {
-				btnTerr.setText(MyLocale.getMsg(1001, "T") + ": " + CacheTerrDiff.longDT(ch.getTerrain()));
+		}
+		
+		if (ch.isCustomWpt()) {
+			btnTerr.setText(MyLocale.getMsg(1001, "T") + DTINVALID);
+			btnDiff.setText(MyLocale.getMsg(1000, "D") + DTINVALID);
+			chcSize.select(0);
+		} else {
+			if (CacheTerrDiff.isValidTD(mainCache.getTerrain())) {
+				btnTerr.setText(MyLocale.getMsg(1001, "T") + ": " + CacheTerrDiff.longDT(mainCache.getTerrain()));
 			} else {
 				btnTerr.setText("T: -.-");
-				ch.setIncomplete(true);
+				mainCache.setIncomplete(true);
 				if (Global.getPref().debug) {
-					Global.getPref().log(ch.getWayPoint() + " has wrong terrain " + ch.getTerrain());
+					Global.getPref().log(mainCache.getWayPoint() + " has wrong terrain " + mainCache.getTerrain());
 				}
 			}
-			if (CacheTerrDiff.isValidTD(ch.getHard())) {
-				btnDiff.setText(MyLocale.getMsg(1000, "D") + ": " + CacheTerrDiff.longDT(ch.getHard()));
+			if (CacheTerrDiff.isValidTD(mainCache.getHard())) {
+				btnDiff.setText(MyLocale.getMsg(1000, "D") + ": " + CacheTerrDiff.longDT(mainCache.getHard()));
 			} else {
 				btnDiff.setText("D: -.-");
-				ch.setIncomplete(true);
+				mainCache.setIncomplete(true);
 				if (Global.getPref().debug) {
-					Global.getPref().log(ch.getWayPoint() + " has wrong difficulty " + ch.getHard());
+					Global.getPref().log(mainCache.getWayPoint() + " has wrong difficulty " + mainCache.getHard());
 				}
 			}
 		}
+		
 		int addiCount = 0;
 		if (ch.mainCache == null) {
 			addiCount = ch.addiWpts.size();
@@ -702,7 +712,9 @@
 			cache.setFound(chcStatus.getText().startsWith(
 					MyLocale.getMsg(318, "Found")));
 		}
-		cache.setCacheOwner(inpOwner.getText().trim());
+		if (!cache.isAddiWpt()) {
+			cache.setCacheOwner(inpOwner.getText().trim());
+		}
 		cache.setOwned(cache.getCacheStatus().equals(
 				MyLocale.getMsg(320, "Owner")));
 		// Avoid setting is_owned if alias is empty and username is empty
@@ -715,8 +727,9 @@
 		cache.setBlack(blackStatus);
 		final String oldWaypoint = cache.getWayPoint();
 		cache.setWayPoint(inpWaypoint.getText().toUpperCase().trim());
-		cache.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize
-				.getText()));
+		if (!cache.isAddiWpt()) {
+			cache.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize.getText()));
+		}
 		// If the waypoint does not have a name, give it one
 		if (cache.getWayPoint().equals("")) {
 			cache.setWayPoint(profile.getNewWayPointName());
@@ -728,7 +741,9 @@
 			cache.setWayPoint(cache.getWayPoint() + " ");
 		cache.setCacheName(inpName.getText().trim());
 		cache.LatLon = cache.pos.toString();
-		cache.setDateHidden(inpHidden.getText().trim());
+		if (!cache.isAddiWpt()) {
+			cache.setDateHidden(inpHidden.getText().trim());
+		}
 		final byte oldType = cache.getType();
 		cache.setType(CacheType.guiSelect2Cw(chcType.getInt()));
 		// thisCache.saveCacheDetails(profile.dataDir); // this is redundant,
@@ -759,8 +774,10 @@
 			// set status also on addi wpts
 			cache.setAttributesToAddiWpts();
 		}
-		cache.setHard(decodeTerrDiff(btnDiff,MyLocale.getMsg(1000, "D"),cache.isCacheWpt()));
-		cache.setTerrain(decodeTerrDiff(btnTerr,MyLocale.getMsg(1001, "T"),cache.isCacheWpt()));
+		if (!cache.isAddiWpt()) {
+			cache.setHard(decodeTerrDiff(btnDiff,MyLocale.getMsg(1000, "D"),cache.isCacheWpt()));
+			cache.setTerrain(decodeTerrDiff(btnTerr,MyLocale.getMsg(1001, "T"),cache.isCacheWpt()));
+		}
 		dirtyNotes = false;
 		dirtyDetails = false;
 		needsTableUpdate = false;



From pfeffer at mail.berlios.de  Thu Sep 24 02:06:30 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 24 Sep 2009 02:06:30 +0200
Subject: [Cachewolf-svn] r2207 - in trunk/src/CacheWolf: . navi
Message-ID: <200909240006.n8O06UxX002215@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-24 02:06:26 +0200 (Thu, 24 Sep 2009)
New Revision: 2207

Modified:
   trunk/src/CacheWolf/ImagePanel.java
   trunk/src/CacheWolf/SafeXML.java
   trunk/src/CacheWolf/navi/MapsList.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: getBestMap works now about 2 times faster. The idea behind it: sort the maps once and search then systematically using a quickfind algorithmus

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2009-09-21 18:27:24 UTC (rev 2206)
+++ trunk/src/CacheWolf/ImagePanel.java	2009-09-24 00:06:26 UTC (rev 2207)
@@ -43,7 +43,7 @@
 	* @see MainTab#onEvent(Event ev)
 	*/
 	public void setImages(CacheHolderDetail cache){
-		if (cache!=oldCache) {
+		if (cache!=oldCache) { 
 			pref = Global.getPref();
 			profile=Global.getProfile();
 			Vm.showWait(true);

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2009-09-21 18:27:24 UTC (rev 2206)
+++ trunk/src/CacheWolf/SafeXML.java	2009-09-24 00:06:26 UTC (rev 2207)
@@ -15,7 +15,7 @@
 	private final static Hashtable iso2htmlMappings = new Hashtable(300);
 	static {
 		final String[] mappingArray = new String[] {
-				"&apos;",   "'",		// Added 20061227 - not a valid HTML entity but sometimes used
+				"&apos;",   "'",		// Added 20061227 - not a valid HTML entity but used in XML
 				"&quot;",   "\"",
 				"&amp;",    "&",
 				"&lt;",     "<",
@@ -218,10 +218,11 @@
     private final static String charToEntity( char c )
         {
         switch ( c ) {
-	        case 34 : return "&quot;";
-	        case 38 : return "&amp;";
-	        case 60 : return "&lt;";
-	        case 62 : return "&gt;";
+	        case '"' : return "&quot;";
+	        case '&' : return "&amp;";
+	        case '<' : return "&lt;";
+	        case '>' : return "&gt;";
+	        case '\'': return "&apos;";
             default :
                 if ( c < 127 ) {
                     // leave alone as equivalent string.
@@ -283,7 +284,7 @@
 		//dummy = replace(dummy, "&nbsp;", "&amp;nbsp;");
 		dummy = STRreplace.replace(dummy, "\"", "&quot;");
 		dummy = STRreplace.replace(dummy, "'","&apos;");
-		dummy = STRreplace.replace(dummy, "]]>","]] >");
+		//dummy = STRreplace.replace(dummy, "]]>","]] >"); this means changing content, it is not necessary because ">" is already replaced by "&gt;"
 
 		return dummy;
 	}

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-21 18:27:24 UTC (rev 2206)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-24 00:06:26 UTC (rev 2207)
@@ -10,8 +10,11 @@
 import ewe.io.FileBase;
 import ewe.io.IOException;
 import ewe.sys.Time;
+import ewe.sys.Vm;
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
+import ewe.util.Comparer;
+import ewe.util.SubString;
 import ewe.util.Vector;
 import ewe.fx.*;
 /**
@@ -112,7 +115,9 @@
 		long start = new Time().getTime();
 		InfoBox progressBox = null;
 		boolean showprogress = false;
-		String cmp = "FF1"+Area.getEasyFindString(ll, 30);
+		String cmp = "FF1"+Area.getEasyFindString(ll, MAXDIGITS_IN_FF);
+		int guess = -1;
+		int foundkw = -1;
 		MapListEntry ml;
 		MapInfoObject mi;
 		MapInfoObject bestMap = null; // = (MapInfoObject)get(0);
@@ -122,54 +127,60 @@
 		boolean better = false;
 		Area screenArea = null; // getAreaForScreen(screen, lat, lon, bestMap.scale, bestMap);
 		float lastscale = -1;
-		int testkw = 0;
-		for (int i=size()-1; i >= 0 ;i--) {
-			if (Global.getPref().debug) {
-				if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
-					showprogress = true;      
-					progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
-					progressBox.exec(); 
-					progressBox.waitUntilPainted(100);
-					ewe.sys.Vm.showWait(true);
-					Global.getPref().log(MyLocale.getMsg(4701,"Searching for best map"));
+		// int testkw = 0;
+		// int testdkw = 0;
+		for (int digitlenght = 0; digitlenght < maxDigits; digitlenght++) {
+			guess = quickfind(cmp, this.numDigitsStartIndex[digitlenght], this.numDigitsStartIndex[digitlenght+1]-1);
+			for (int i=guess; i >= numDigitsStartIndex[digitlenght] ;i--) {
+				// testdkw++;
+				if (Global.getPref().debug) {
+					if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
+						showprogress = true;      
+						progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
+						progressBox.exec(); 
+						progressBox.waitUntilPainted(100);
+						ewe.sys.Vm.showWait(true);
+						Global.getPref().log(MyLocale.getMsg(4701,"Searching for best map"));
+					}
 				}
-			}
-			ml = (MapListEntry)get(i);
-			try {
-				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
-				else { mi = ml.getMap(); testkw++;}
-			} catch (IOException ex) {continue; } // could not read .wfl-file
-			better = false;
-//			mi = (MapInfoObject)get(i);
-			if (screenArea == null || !scaleEquals(lastscale, mi) ) {
-				screenArea = getAreaForScreen(screen, ll, mi.scale, mi);
-				lastscale = mi.scale;
-			}
-			
-			if (screenArea.isOverlapping(mi) ) { // is on screen
-				if (!forceScale || (forceScale && scaleEquals(scale, mi))) { // different scale?
-					if (!forceScale && (mi.isInBound(ll) && (bestMap == null || scaleNearer(mi.scale, bestMap.scale, scale) || !bestMap.isInBound(ll)))) 
-						better = true; // inbound and resolution nearer at wanted resolution or old one is on screen but lat/long not inbound-> better
-					else {
-						if ( bestMap == null || scaleNearerOrEuqal(mi.scale, bestMap.scale, scale)) {
-							latNearer = java.lang.Math.abs(ll.latDec - mi.center.latDec)/mi.sizeKm < minDistLat ;
-							lonNearer = java.lang.Math.abs(ll.lonDec - mi.center.lonDec)/mi.sizeKm < minDistLon;
-							if ( latNearer && lonNearer) better = true; // for faster processing: if lat and lon are nearer then the distancance doesn't need to be calculated
-							else {
-								if ( (latNearer || lonNearer )) { 
-									if (bestMap == null || mi.center.getDistanceRad(ll) < bestMap.center.getDistanceRad(ll) ){
-										better = true;
+				ml = (MapListEntry)get(i);
+				try {
+					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) break; // TODO if no map available
+					else { mi = ml.getMap(); /* testkw++; */}
+				} catch (IOException ex) {continue; } // could not read .wfl-file
+				better = false;
+				//			mi = (MapInfoObject)get(i);
+				if (screenArea == null || !scaleEquals(lastscale, mi) ) {
+					screenArea = getAreaForScreen(screen, ll, mi.scale, mi);
+					lastscale = mi.scale;
+				}
+
+				if (screenArea.isOverlapping(mi) ) { // is on screen
+					if (!forceScale || (forceScale && scaleEquals(scale, mi))) { // different scale?
+						if (!forceScale && (mi.isInBound(ll) && (bestMap == null || scaleNearer(mi.scale, bestMap.scale, scale) || !bestMap.isInBound(ll)))) 
+							better = true; // inbound and resolution nearer at wanted resolution or old one is on screen but lat/long not inbound-> better
+						else {
+							if ( bestMap == null || scaleNearerOrEuqal(mi.scale, bestMap.scale, scale)) {
+								latNearer = java.lang.Math.abs(ll.latDec - mi.center.latDec)/mi.sizeKm < minDistLat ;
+								lonNearer = java.lang.Math.abs(ll.lonDec - mi.center.lonDec)/mi.sizeKm < minDistLon;
+								if ( latNearer && lonNearer) better = true; // for faster processing: if lat and lon are nearer then the distancance doesn't need to be calculated
+								else {
+									if ( (latNearer || lonNearer )) { 
+										if (bestMap == null || mi.center.getDistanceRad(ll) < bestMap.center.getDistanceRad(ll) ){
+											better = true;
+										}
 									}
 								}
 							}
 						}
+						if (better) {
+							minDistLat = java.lang.Math.abs(ll.latDec - mi.center.latDec)/mi.sizeKm;
+							minDistLon = java.lang.Math.abs(ll.lonDec - mi.center.lonDec)/mi.sizeKm;
+							bestMap = mi;
+							//foundkw = i;
+							// Vm.debug("better"+ i);
+						}
 					}
-					if (better) {
-						minDistLat = java.lang.Math.abs(ll.latDec - mi.center.latDec)/mi.sizeKm;
-						minDistLon = java.lang.Math.abs(ll.lonDec - mi.center.lonDec)/mi.sizeKm;
-						bestMap = mi;
-						// Vm.debug("better"+ i);
-					}
 				}
 			}
 		}
@@ -178,6 +189,7 @@
 			ewe.sys.Vm.showWait(false);
 		}
 		if (bestMap == null) return null;
+		//Vm.debug("getBestMap: guess: " + guess + ", bestmap: " + foundkw + ", durchl?ufe: "+ testdkw);
 		return new MapInfoObject(bestMap); // return a copy of the MapInfoObject so that zooming won't change the MapInfoObject in the list 
 	}
 	/*
@@ -186,8 +198,78 @@
 		if (ret == null) ret = getBestMap(lat, lon, screen, scale, false);
 		return ret;
 	}
-	 */ 
+	 */
+	
+	private final static int MAXDIGITS_IN_FF = 30;
+	/** after calling onCompletedRead() this will contain a list of
+	 * indexes at which a new number of digits in the sortEntryBBox start
+	 */
+	private int[] numDigitsStartIndex = new int[MAXDIGITS_IN_FF];
+	private int maxDigits = -1;
+	public void onCompletedRead() {
+		sort(
+				new Comparer() 
+				{
+					public int compare(Object o1, Object o2){
+						String s1 = ((MapListEntry)o1).sortEntryBBox;
+						String s2 = ((MapListEntry)o2).sortEntryBBox;
+						int ret = s1.length() - s2.length(); // sort shorter sortEntryBBox at the beginning
+						if (ret == 0) ret = s1.compareTo(s2);
+						return ret;
+					}
+				}
+				, false);
+		int digits_index = 0;
+		int numdigits = 0;
+		int s = size(); // avoid calling size() for each MaplistEntry (could be some thousand times)
+		for (int i = 0; i < s; i++) {
+			if ( ((MapListEntry)get(i)).sortEntryBBox.length() > numdigits) {
+				numDigitsStartIndex[digits_index] = i;
+				digits_index++;
+				numdigits = ((MapListEntry)get(i)).sortEntryBBox.length();
+			}
+		}
+		numDigitsStartIndex[digits_index] = s;
+		maxDigits = digits_index;
+	}
+	
 	/**
+	 * 
+	 * @param searchfor String starting with FFE1, it should be longer than any sortEntryBoxString in the list
+	 * @return the highest index which matches the searchfor-String. Look downward from there to find the best map, llimit if there is no match
+	 */
+	private int quickfind(String searchfor, int llimitorig, int ulimit) {
+		int llimit = llimitorig;
+		int test;
+		int comp;
+		String cmp;
+//		int testskw = 0;
+		if ( ((MapListEntry)this.get(llimit)).sortEntryBBox.compareTo(searchfor) > 0 ||
+			 ((MapListEntry)this.get(ulimit)).sortEntryBBox.compareTo(searchfor) < 0)
+			return llimit; // if searchfor is not in the range, return llimit (llimit because getBestMap counts downward, so returning llimit will cause it to do only 1 test
+		while (ulimit - llimit > 1) {
+	//		testskw++;
+			test = (ulimit + llimit) / 2;
+			cmp = ((MapListEntry)this.get(test)).sortEntryBBox;
+			
+			comp = cmp.compareTo(searchfor);
+			if ( comp > 0 ) { // test > searchfor
+				ulimit = test;
+			} else { // test <= searchfor
+				if (comp < 0) llimit = test; // test < serachfor
+				else { // test == searchfor
+					llimit = test;
+					ulimit = test;
+				}
+			}
+		}
+	     // if the found mapListEntry doesn't contain the searchfor, then there is no map containing it.
+		if (!searchfor.startsWith(((MapListEntry)this.get(llimit)).sortEntryBBox)) llimit = llimitorig; 
+		// Vm.debug("quickfind: testskw: " + testskw + ", searched for: " + searchfor);
+		return llimit;
+	}
+
+		/**
 	 * @return a map which includs topleft and bottomright, 
 	 * if no map includes both it returns null
 	 * @param if more than one map includes topleft and bottomright than the one will
@@ -276,7 +358,7 @@
 		boolean better = false;
 		Area screenArea = null; // getAreaForScreen(screen, lat, lon, bestMap.scale, bestMap);
 		float lastscale = -1;
-		String cmp = "FF1"+Area.getEasyFindString(ll, 30);
+		String cmp = "FF1"+Area.getEasyFindString(ll, MAXDIGITS_IN_FF);
 		for (int i=size()-1; i >= 0 ;i--) { 
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
 				showprogress = true;      

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-21 18:27:24 UTC (rev 2206)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-24 00:06:26 UTC (rev 2207)
@@ -244,7 +244,8 @@
 			(new MessageBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4204, "No georeferenced map available \n Please choose a scale \n to show the track and the caches. \n You can get one by the menu: Application/Maps/download calibrated"), FormBase.OKB)).execute();
 			noMapsAvailable = true;
 		} else noMapsAvailable = false;
-		maps.addEmptyMaps(lat); // the empty maps must be added last, otherwise in method setBestMap, when no mapt is available, a malfunction will happen, see there
+		maps.addEmptyMaps(lat); // the empty maps must be added last, otherwise in method setBestMap, when no map is available, a malfunction will happen, see there
+		maps.onCompletedRead();
 		dontUpdatePos = saveGpsIgnoreStatus;
 		inf.close(0);
 		Vm.showWait(this, false);



From pfeffer at mail.berlios.de  Thu Sep 24 02:24:00 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 24 Sep 2009 02:24:00 +0200
Subject: [Cachewolf-svn] r2208 - trunk/src/CacheWolf
Message-ID: <200909240024.n8O0O0MQ003518@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-24 02:23:58 +0200 (Thu, 24 Sep 2009)
New Revision: 2208

Modified:
   trunk/src/CacheWolf/SafeXML.java
Log:
revert the unintended part of the last commit: not sure what cleanGPX should do

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2009-09-24 00:06:26 UTC (rev 2207)
+++ trunk/src/CacheWolf/SafeXML.java	2009-09-24 00:23:58 UTC (rev 2208)
@@ -278,13 +278,13 @@
 	public final static String cleanGPX(String str){
 		String dummy = new String();
 		
-		dummy = STRreplace.replace(str, "&","&amp;");
+		dummy = STRreplace.replace(str, "&","&amp;"); // why is this here? in a CDATA section this is not necessary, see http://de.wikipedia.org/wiki/CDATA
 		dummy = STRreplace.replace(dummy, "<", "&lt;");
 		dummy = STRreplace.replace(dummy, ">", "&gt;");
 		//dummy = replace(dummy, "&nbsp;", "&amp;nbsp;");
 		dummy = STRreplace.replace(dummy, "\"", "&quot;");
 		dummy = STRreplace.replace(dummy, "'","&apos;");
-		//dummy = STRreplace.replace(dummy, "]]>","]] >"); this means changing content, it is not necessary because ">" is already replaced by "&gt;"
+		dummy = STRreplace.replace(dummy, "]]>","]] >"); // this means changing content, but it is the easiest way of avoiding ]]> to be interpreted as endmark of CDATA-section
 
 		return dummy;
 	}



From pfeffer at mail.berlios.de  Thu Sep 24 19:48:44 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 24 Sep 2009 19:48:44 +0200
Subject: [Cachewolf-svn] r2209 - trunk/src/CacheWolf/navi
Message-ID: <200909241748.n8OHmi8a023656@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-24 19:48:42 +0200 (Thu, 24 Sep 2009)
New Revision: 2209

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
Log:
MapsList: performance: reading the list of *.wfl files more than twice as fast in the sun-java-vm than before

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-24 00:23:58 UTC (rev 2208)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-24 17:48:42 UTC (rev 2209)
@@ -44,14 +44,14 @@
 		MessageBox f = null; 
 		// sort(new StandardComparer(), false);
 
-		
+		files = new FileBugfix(mapsPath+"/"+dirs.get(0));
 		for (int j = 0; j < dirs.size(); j++) {
-			files = new FileBugfix(mapsPath+"/"+dirs.get(j));
+			files.set(null, mapsPath+"/"+dirs.get(j));
 			//ewe.sys.Vm.debug("mapd-Dirs:"+files);
 			
 			//add subdirectories
 			if (!dirs.get(j).equals(".")) {
-				dirstmp = files.list(null, FileBase.LIST_DIRECTORIES_ONLY);
+				dirstmp = files.list(null, FileBase.LIST_DIRECTORIES_ONLY | File.LIST_DONT_SORT | File.LIST_IGNORE_DIRECTORY_STATUS); // the options "File.LIST_DONT_SORT | File.LIST_IGNORE_DIRECTORY_STATUS" make it run about twice as fast in sun-vm. The option File.LIST_IGNORE_DIRECTORY_STATUS influences only the sorting (dirs first)  
 				if (dirstmp != null) {
 					for (int subDir = 0; subDir < dirstmp.length; subDir++) {
 						dirs.add(j+1+subDir, dirs.get(j)+"/"+dirstmp[subDir]);
@@ -59,7 +59,7 @@
 				}
 			}
 
-			dateien = files.list("*.wfl", FileBase.LIST_FILES_ONLY); //"*.xyz" doesn't work on some systems -> use FileBugFix
+			dateien = files.list("*.wfl", FileBase.LIST_FILES_ONLY | File.LIST_DONT_SORT | File.LIST_IGNORE_DIRECTORY_STATUS); //"*.xyz" doesn't work on some systems -> use FileBugFix
 			if (dateien == null) continue;
 			for(int i = 0; i < dateien.length;i++){
 				// if (!dateien[i].endsWith(".wfl")) continue;



From pfeffer at mail.berlios.de  Fri Sep 25 13:58:46 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 25 Sep 2009 13:58:46 +0200
Subject: [Cachewolf-svn] r2210 - trunk/src/CacheWolf/navi
Message-ID: <200909251158.n8PBwke8015221@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-25 13:58:44 +0200 (Fri, 25 Sep 2009)
New Revision: 2210

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: show the "loading list of maps" message again, even if not in debug mode. I feel waiting 10" till 30" without any reaction after pressing the map-button from the PocketPC is too much.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-24 17:48:42 UTC (rev 2209)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-25 11:58:44 UTC (rev 2210)
@@ -230,12 +230,11 @@
 		loadingMapList = true;
 		//this.mapPath = mapsPath;
 		InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
-		if (Global.getPref().debug) {
-			Vm.showWait(this, true);
-			inf.exec();
-			inf.waitUntilPainted(100);
+		Vm.showWait(this, true);
+		inf.exec();
+		inf.waitUntilPainted(100);
+		if (Global.getPref().debug)
 			Global.getPref().log(MyLocale.getMsg(4203, "Loading list of maps..."));
-		}
 		resetCenterOfMap();
 		boolean saveGpsIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;



From mik77 at mail.berlios.de  Fri Sep 25 21:26:35 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 25 Sep 2009 21:26:35 +0200
Subject: [Cachewolf-svn] r2211 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200909251926.n8PJQZpA030337@sheep.berlios.de>

Author: mik77
Date: 2009-09-25 21:26:30 +0200 (Fri, 25 Sep 2009)
New Revision: 2211

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/myTableControl.java
Log:
New context menu item "Log in browser online". Especially useful for PM-only caches. The notes text is copied to clipboard (if present).

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-25 11:58:44 UTC (rev 2210)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-25 19:26:30 UTC (rev 2211)
@@ -359,6 +359,7 @@
 		1049=DNF
 		1050=Aktualisiert
 		1051=Zuletzt aktualisiert
+		1052=Im Browser online loggen
 		1100=Profile
 		1105=Suchen
 		1106=Profil w%e4hlen oder Neu

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-25 11:58:44 UTC (rev 2210)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-25 19:26:30 UTC (rev 2211)
@@ -359,6 +359,7 @@
 		1049=DNF
 		1050=Last synced
 		1051=Last sync date
+		1052=Log online in Browser
 		1100=Profiles
 		1105=Browse
 		1106=Choose profile or New

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2009-09-25 11:58:44 UTC (rev 2210)
+++ trunk/src/CacheWolf/myTableControl.java	2009-09-25 19:26:30 UTC (rev 2211)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.utils.CWWrapper;
 import ewe.sys.*;
 import ewe.ui.*;
@@ -18,7 +19,7 @@
 	public TablePanel tbp;
 	
 	private MenuItem miOpen, miGoto, miCenter, miUnhideAddis;
-	private MenuItem miOpenOnline, miOpenOffline;
+	private MenuItem miOpenOnline, miOpenOffline, miLogOnline;
 	private MenuItem miDelete, miUpdate;
 	private MenuItem miTickAll, miUntickAll;
 	private MenuItem miSeparator;
@@ -33,7 +34,7 @@
 		tbp =tablePanel;
 		allowDragSelection = false; // allow only one row to be selected at one time
 				
-		MenuItem[] mnuFull = new MenuItem[13];
+		MenuItem[] mnuFull = new MenuItem[14];
   	mnuFull[0] = miOpen = new MenuItem(MyLocale.getMsg(1021,"Open description"));
   	mnuFull[1] = miGoto = new MenuItem(MyLocale.getMsg(1010,"Goto"));
   	mnuFull[2] = miCenter = new MenuItem(MyLocale.getMsg(1019,"Center"));
@@ -41,15 +42,16 @@
   	mnuFull[4] = miSeparator = new MenuItem("-");
   	mnuFull[5] = miOpenOnline = new MenuItem(MyLocale.getMsg(1020,"Open in $browser online"));
   	mnuFull[6] = miOpenOffline = new MenuItem(MyLocale.getMsg(1018,"Open in browser offline"));
-  	mnuFull[7] = miSeparator;
-  	mnuFull[8] = miDelete = new MenuItem(MyLocale.getMsg(1012,"Delete selected"));
-  	mnuFull[9] = miUpdate = new MenuItem(MyLocale.getMsg(1014,"Update"));
-  	mnuFull[10] = miSeparator;
-  	mnuFull[11] = miTickAll = new MenuItem(MyLocale.getMsg(1015,"Select all"));
-  	mnuFull[12] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,"De-select all"));	
+  	mnuFull[7] = miLogOnline = new MenuItem(MyLocale.getMsg(1052,"Log online in Browser"));
+  	mnuFull[8] = miSeparator;
+  	mnuFull[9] = miDelete = new MenuItem(MyLocale.getMsg(1012,"Delete selected"));
+  	mnuFull[10] = miUpdate = new MenuItem(MyLocale.getMsg(1014,"Update"));
+  	mnuFull[11] = miSeparator;
+  	mnuFull[12] = miTickAll = new MenuItem(MyLocale.getMsg(1015,"Select all"));
+  	mnuFull[13] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,"De-select all"));	
   	mFull = new Menu(mnuFull, MyLocale.getMsg(1013,"With selection"));
 
-  	MenuItem[] mnuSmall = new MenuItem[7];
+  	MenuItem[] mnuSmall = new MenuItem[8];
   	mnuSmall[0] = miOpen;
   	mnuSmall[1] = miGoto;
   	mnuSmall[2] = miCenter;
@@ -57,6 +59,7 @@
   	mnuSmall[4] = miSeparator;
   	mnuSmall[5] = miOpenOnline;
   	mnuSmall[6] = miOpenOffline;
+  	mnuSmall[7] = miLogOnline;
   	mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013,"With selection"));	
 	}
 
@@ -273,6 +276,50 @@
 				sc.showCache(cacheDB.get(tbp.getSelectedCache()));
 			}
 		} else
+			
+		if (selectedItem == miLogOnline){
+			if(browserPathIsValid()){
+				ch = cacheDB.get(tbp.getSelectedCache());
+				CacheHolder mainCache = ch;
+				if (ch.isAddiWpt() && (ch.mainCache != null)) {
+					mainCache = ch.mainCache;
+				}
+				if (mainCache.isCacheWpt()) {
+					CacheHolderDetail chD=mainCache.getCacheDetails(false, true);
+					try {
+						if (chD != null) {
+							String URL = "";
+							if (ch.isOC())
+							{
+								URL = chD.URL;
+								if (URL.indexOf("viewcache") >= 0) {
+									URL = STRreplace.replace(URL, "viewcache", "log");
+								} else {
+									URL = "";
+								}
+							} else {
+								URL = "http://www.geocaching.com/seek/log.aspx?ID=" + mainCache.GetCacheID();								
+							}
+
+							if (URL.length() > 0) {
+								String notes = chD.getCacheNotes();
+								if (notes.length() > 0) {
+									Vm.setClipboardText(notes);
+								}
+								CWWrapper.exec(pref.browser, URL);
+							}
+						}
+					} catch (IOException ex) {
+						(new MessageBox(MyLocale.getMsg(321,"Error"),
+								MyLocale.getMsg(1034,"Cannot start browser!") + "\n" + ex.toString() + "\n" +
+								MyLocale.getMsg(1035,"Possible reason:") + "\n" +
+								MyLocale.getMsg(1036,"A bug in ewe VM, please be") + "\n" +
+								MyLocale.getMsg(1037,"patient for an update"),FormBase.OKB)).execute();
+					}
+				}
+			}
+		} else
+
 		    
 		if (selectedItem == miOpen){
 			penDoubleClicked(null);



From araber95 at mail.berlios.de  Sun Sep 27 15:03:30 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 27 Sep 2009 15:03:30 +0200
Subject: [Cachewolf-svn] r2212 - trunk/src/CacheWolf/navi
Message-ID: <200909271303.n8RD3Uww008839@sheep.berlios.de>

Author: araber95
Date: 2009-09-27 15:03:28 +0200 (Sun, 27 Sep 2009)
New Revision: 2212

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
Log:
introduced getMapsPath() for MapsList
introduced getFilename() and getSortEntryBBox() for MapListEntry
accidently removed trailing spaces ( think it doesn't matter)

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-25 19:26:30 UTC (rev 2211)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-27 13:03:28 UTC (rev 2212)
@@ -33,7 +33,7 @@
 	 */
 	public MapsList(String mapsPath) {
 		super(); // forget already loaded maps
-		//if (mmp.mapImage != null) 
+		//if (mmp.mapImage != null)
 		String dateien[];
 		FileBugfix files;
 		String rawFileName;
@@ -41,17 +41,17 @@
 		Vector dirs = new Vector();
 		dirs.add(""); // start with the mapsPath (only this one , without its subdirs)
 		MapListEntry tempMIO;
-		MessageBox f = null; 
+		MessageBox f = null;
 		// sort(new StandardComparer(), false);
 
 		files = new FileBugfix(mapsPath+"/"+dirs.get(0));
 		for (int j = 0; j < dirs.size(); j++) {
 			files.set(null, mapsPath+"/"+dirs.get(j));
 			//ewe.sys.Vm.debug("mapd-Dirs:"+files);
-			
+
 			//add subdirectories
 			if (!dirs.get(j).equals(".")) {
-				dirstmp = files.list(null, FileBase.LIST_DIRECTORIES_ONLY | File.LIST_DONT_SORT | File.LIST_IGNORE_DIRECTORY_STATUS); // the options "File.LIST_DONT_SORT | File.LIST_IGNORE_DIRECTORY_STATUS" make it run about twice as fast in sun-vm. The option File.LIST_IGNORE_DIRECTORY_STATUS influences only the sorting (dirs first)  
+				dirstmp = files.list(null, FileBase.LIST_DIRECTORIES_ONLY | File.LIST_DONT_SORT | File.LIST_IGNORE_DIRECTORY_STATUS); // the options "File.LIST_DONT_SORT | File.LIST_IGNORE_DIRECTORY_STATUS" make it run about twice as fast in sun-vm. The option File.LIST_IGNORE_DIRECTORY_STATUS influences only the sorting (dirs first)
 				if (dirstmp != null) {
 					for (int subDir = 0; subDir < dirstmp.length; subDir++) {
 						dirs.add(j+1+subDir, dirs.get(j)+"/"+dirstmp[subDir]);
@@ -68,23 +68,24 @@
 					if (dirs.get(j).equals(".")) // the notation dir/./filename doesn't work on all platforms anyhow
 						tempMIO = new MapListEntry(mapsPath+"/", rawFileName);
 					else tempMIO = new MapListEntry(mapsPath+"/"+dirs.get(j)+"/", rawFileName);
-					if (tempMIO.sortEntryBBox != null) add(tempMIO);
+					if (tempMIO.getSortEntryBBox() != null) add(tempMIO);
 					//ewe.sys.Vm.debug(tempMIO.getEasyFindString() + tempMIO.mapName);
-				}catch(Exception ex){ // TODO exception ist, glaub ich evtl ?berfl?ssig 
+				}catch(Exception ex){ // TODO exception ist, glaub ich evtl ?berfl?ssig
 					if (f == null) (f=new MessageBox(MyLocale.getMsg(144, "Warning"), MyLocale.getMsg(4700, "Ignoring error while \n reading calibration file \n")+ex.toString(), FormBase.OKB)).exec();
-				} /* catch(ArithmeticException ex){ // affine contain not allowed values 
+				} /* catch(ArithmeticException ex){ // affine contain not allowed values
 					if (f == null) (f=new MessageBox("Warning", "Ignoring error while \n reading calibration file \n"+ex.toString(), MessageBox.OKB)).exec();
 				} */
 			}
 		}
 		if (MapListEntry.rename == 1) MapListEntry.loadingFinished();
+		_mapsPath=mapsPath;
 	}
 
 	public void addEmptyMaps(double lat) {
-		MapListEntry tempMIO; 
+		MapListEntry tempMIO;
 		tempMIO = new MapListEntry(1.0, lat);
 		add(tempMIO);
-		tempMIO = new MapListEntry(5.0, lat); // this one ( the 4th last) is automatically used when no real map is available, see MovingMap.setBestMap 
+		tempMIO = new MapListEntry(5.0, lat); // this one ( the 4th last) is automatically used when no real map is available, see MovingMap.setBestMap
 		add(tempMIO);
 		tempMIO = new MapListEntry(50.0, lat);
 		add(tempMIO);
@@ -93,7 +94,7 @@
 		tempMIO = new MapListEntry(1000.0, lat);
 		add(tempMIO);
 	}
-     
+
 	/* diese Routine wird gegenw?rtig f?r 3 ZWecke verwendet:
 	 * a) normal - keep given resolution --> L?sung: ?bergebene scale nutzen f?r screen
 	 * b) highest res: Ziel: Karte mit h?chster Aufl?sung, die im screen ist und m?glichst nah an lat/lon -> ich muss aufl?sung noch in Dateinamen schreiben
@@ -135,9 +136,9 @@
 				// testdkw++;
 				if (Global.getPref().debug) {
 					if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
-						showprogress = true;      
+						showprogress = true;
 						progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
-						progressBox.exec(); 
+						progressBox.exec();
 						progressBox.waitUntilPainted(100);
 						ewe.sys.Vm.showWait(true);
 						Global.getPref().log(MyLocale.getMsg(4701,"Searching for best map"));
@@ -145,7 +146,7 @@
 				}
 				ml = (MapListEntry)get(i);
 				try {
-					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) break; // TODO if no map available
+					if (!Area.containsRoughly(ml.getSortEntryBBox(), cmp)) break; // TODO if no map available
 					else { mi = ml.getMap(); /* testkw++; */}
 				} catch (IOException ex) {continue; } // could not read .wfl-file
 				better = false;
@@ -157,7 +158,7 @@
 
 				if (screenArea.isOverlapping(mi) ) { // is on screen
 					if (!forceScale || (forceScale && scaleEquals(scale, mi))) { // different scale?
-						if (!forceScale && (mi.isInBound(ll) && (bestMap == null || scaleNearer(mi.scale, bestMap.scale, scale) || !bestMap.isInBound(ll)))) 
+						if (!forceScale && (mi.isInBound(ll) && (bestMap == null || scaleNearer(mi.scale, bestMap.scale, scale) || !bestMap.isInBound(ll))))
 							better = true; // inbound and resolution nearer at wanted resolution or old one is on screen but lat/long not inbound-> better
 						else {
 							if ( bestMap == null || scaleNearerOrEuqal(mi.scale, bestMap.scale, scale)) {
@@ -165,7 +166,7 @@
 								lonNearer = java.lang.Math.abs(ll.lonDec - mi.center.lonDec)/mi.sizeKm < minDistLon;
 								if ( latNearer && lonNearer) better = true; // for faster processing: if lat and lon are nearer then the distancance doesn't need to be calculated
 								else {
-									if ( (latNearer || lonNearer )) { 
+									if ( (latNearer || lonNearer )) {
 										if (bestMap == null || mi.center.getDistanceRad(ll) < bestMap.center.getDistanceRad(ll) ){
 											better = true;
 										}
@@ -190,7 +191,7 @@
 		}
 		if (bestMap == null) return null;
 		//Vm.debug("getBestMap: guess: " + guess + ", bestmap: " + foundkw + ", durchl?ufe: "+ testdkw);
-		return new MapInfoObject(bestMap); // return a copy of the MapInfoObject so that zooming won't change the MapInfoObject in the list 
+		return new MapInfoObject(bestMap); // return a copy of the MapInfoObject so that zooming won't change the MapInfoObject in the list
 	}
 	/*
 	public MapInfoObject getBestMapNotStrictSciale(double lat, double lon, Area screen, float scale) {
@@ -199,7 +200,7 @@
 		return ret;
 	}
 	 */
-	
+
 	private final static int MAXDIGITS_IN_FF = 30;
 	/** after calling onCompletedRead() this will contain a list of
 	 * indexes at which a new number of digits in the sortEntryBBox start
@@ -208,11 +209,11 @@
 	private int maxDigits = -1;
 	public void onCompletedRead() {
 		sort(
-				new Comparer() 
+				new Comparer()
 				{
 					public int compare(Object o1, Object o2){
-						String s1 = ((MapListEntry)o1).sortEntryBBox;
-						String s2 = ((MapListEntry)o2).sortEntryBBox;
+						String s1 = ((MapListEntry)o1).getSortEntryBBox();
+						String s2 = ((MapListEntry)o2).getSortEntryBBox();
 						int ret = s1.length() - s2.length(); // sort shorter sortEntryBBox at the beginning
 						if (ret == 0) ret = s1.compareTo(s2);
 						return ret;
@@ -223,18 +224,18 @@
 		int numdigits = 0;
 		int s = size(); // avoid calling size() for each MaplistEntry (could be some thousand times)
 		for (int i = 0; i < s; i++) {
-			if ( ((MapListEntry)get(i)).sortEntryBBox.length() > numdigits) {
+			if ( ((MapListEntry)get(i)).getSortEntryBBox().length() > numdigits) {
 				numDigitsStartIndex[digits_index] = i;
 				digits_index++;
-				numdigits = ((MapListEntry)get(i)).sortEntryBBox.length();
+				numdigits = ((MapListEntry)get(i)).getSortEntryBBox().length();
 			}
 		}
 		numDigitsStartIndex[digits_index] = s;
 		maxDigits = digits_index;
 	}
-	
+
 	/**
-	 * 
+	 *
 	 * @param searchfor String starting with FFE1, it should be longer than any sortEntryBoxString in the list
 	 * @return the highest index which matches the searchfor-String. Look downward from there to find the best map, llimit if there is no match
 	 */
@@ -244,14 +245,14 @@
 		int comp;
 		String cmp;
 //		int testskw = 0;
-		if ( ((MapListEntry)this.get(llimit)).sortEntryBBox.compareTo(searchfor) > 0 ||
-			 ((MapListEntry)this.get(ulimit)).sortEntryBBox.compareTo(searchfor) < 0)
+		if ( ((MapListEntry)this.get(llimit)).getSortEntryBBox().compareTo(searchfor) > 0 ||
+			 ((MapListEntry)this.get(ulimit)).getSortEntryBBox().compareTo(searchfor) < 0)
 			return llimit; // if searchfor is not in the range, return llimit (llimit because getBestMap counts downward, so returning llimit will cause it to do only 1 test
 		while (ulimit - llimit > 1) {
 	//		testskw++;
 			test = (ulimit + llimit) / 2;
-			cmp = ((MapListEntry)this.get(test)).sortEntryBBox;
-			
+			cmp = ((MapListEntry)this.get(test)).getSortEntryBBox();
+
 			comp = cmp.compareTo(searchfor);
 			if ( comp > 0 ) { // test > searchfor
 				ulimit = test;
@@ -264,18 +265,18 @@
 			}
 		}
 	     // if the found mapListEntry doesn't contain the searchfor, then there is no map containing it.
-		if (!searchfor.startsWith(((MapListEntry)this.get(llimit)).sortEntryBBox)) llimit = llimitorig; 
+		if (!searchfor.startsWith(((MapListEntry)this.get(llimit)).getSortEntryBBox())) llimit = llimitorig;
 		// Vm.debug("quickfind: testskw: " + testskw + ", searched for: " + searchfor);
 		return llimit;
 	}
 
 		/**
-	 * @return a map which includs topleft and bottomright, 
+	 * @return a map which includs topleft and bottomright,
 	 * if no map includes both it returns null
 	 * @param if more than one map includes topleft and bottomright than the one will
 	 * be returned which has its center nearest to topleft. If you have gps-pos and goto-pos
 	 * as topleft and buttomright use gps as topleft.
-	 * if topleft is really topleft or if it is buttomright is not relevant.  
+	 * if topleft is really topleft or if it is buttomright is not relevant.
 	 */
 
 	public MapInfoObject getMapForArea(CWPoint topleft, CWPoint bottomright){
@@ -292,15 +293,15 @@
 		double minDistLon = 10000000000000000000000.0;
 		for (int i=size() -1; i>=0 ;i--) {
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
-				showprogress = true;      
+				showprogress = true;
 				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
-				progressBox.exec(); 
+				progressBox.exec();
 				progressBox.waitUntilPainted(100);
 				ewe.sys.Vm.showWait(true);
 			}
 			ml = (MapListEntry)get(i);
 			try {
-				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
+				if (!Area.containsRoughly(ml.getSortEntryBBox(), cmp)) continue; // TODO if no map available
 				else { mi = ml.getMap();}
 			} catch (IOException ex) {continue; } // could not read .wfl-file
 			better = false;
@@ -313,7 +314,7 @@
 						lonNearer = java.lang.Math.abs(topleft.lonDec - mi.center.lonDec)/mi.sizeKm < minDistLon;
 						if ( latNearer && lonNearer) better = true; // for faster processing: if lat and lon are nearer then the distancance doesn't need to be calculated
 						else {
-							if ( (latNearer || lonNearer )) { 
+							if ( (latNearer || lonNearer )) {
 								if (mi.center.getDistanceRad(topleft) < fittingmap.center.getDistanceRad(topleft) ) better = true;
 							}
 						}
@@ -336,7 +337,7 @@
 	}
 
 	/**
-	 * 
+	 *
 	 * @param lat a point to be inside the map
 	 * @param lon
 	 * @param screen: width, height of the screen. The map must overlap the screen. xy: where is lat/lon on screen
@@ -359,18 +360,18 @@
 		Area screenArea = null; // getAreaForScreen(screen, lat, lon, bestMap.scale, bestMap);
 		float lastscale = -1;
 		String cmp = "FF1"+Area.getEasyFindString(ll, MAXDIGITS_IN_FF);
-		for (int i=size()-1; i >= 0 ;i--) { 
+		for (int i=size()-1; i >= 0 ;i--) {
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
-				showprogress = true;      
+				showprogress = true;
 				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
-				progressBox.exec(); 
+				progressBox.exec();
 				progressBox.waitUntilPainted(100);
 				ewe.sys.Vm.showWait(true);
 			}
 			better = false;
 			ml = (MapListEntry)get(i);
 			try {
-				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
+				if (!Area.containsRoughly(ml.getSortEntryBBox(), cmp)) continue; // TODO if no map available
 				else { mi = ml.getMap();}
 			} catch (IOException ex) {continue; } // could not read .wfl-file
 			if (mi.fileNameWFL == "") continue; // exclude "maps" without image // TODO make this a boolean in MapInfoObject
@@ -384,12 +385,12 @@
 							(moreDetails && (curScale > mi.scale * scaleTolerance) && (bestMap == null || mi.scale > bestMap.scale * scaleTolerance ) ) // higher resolution wanted and mi has higher res and a lower res than bestmap, because we dont want to overjump one resolution step
 							|| (!moreDetails && (curScale *  scaleTolerance < mi.scale) && (bestMap == null || mi.scale * scaleTolerance < bestMap.scale) ) // lower resolution wanted and mi has lower res and a higher res than bestmap, because we dont want to overjump one resolution step
 					) )	better = true;	// inbound and higher resolution if higher res wanted -> better
-				} else { // same scale as bestmap -> look if naerer 
+				} else { // same scale as bestmap -> look if naerer
 					latNearer = java.lang.Math.abs(ll.latDec - mi.center.latDec)/mi.sizeKm < minDistLat ;
 					lonNearer = java.lang.Math.abs(ll.lonDec - mi.center.lonDec)/mi.sizeKm < minDistLon;
 					if ( latNearer && lonNearer) better = true; // for faster processing: if lat and lon are nearer then the distancance doesn't need to be calculated
 					else {
-						if ( (latNearer || lonNearer )) { 
+						if ( (latNearer || lonNearer )) {
 							if (mi.center.getDistanceRad(ll) < bestMap.center.getDistanceRad(ll) ) better = true;
 						}
 					}
@@ -423,11 +424,11 @@
 		Point xy = map.calcMapXY(ll);
 		Point topleft = new Point(xy.x - a.x, xy.y - a.y);
 		ret = new Area(map.calcLatLon(topleft), map.calcLatLon(topleft.x+a.width, topleft.y+a.height));
-		return ret; 
+		return ret;
 	}
 	public static boolean scaleEquals(MapInfoObject a, MapInfoObject b) {
 		//return java.lang.Math.abs(a.scale - b.scale) < scaleTolerance;
-		if (a.scale > b.scale) return a.scale / b.scale < scaleTolerance; 
+		if (a.scale > b.scale) return a.scale / b.scale < scaleTolerance;
 		else return b.scale / a.scale < scaleTolerance;
 	}
 	public static boolean scaleEquals(float s, MapInfoObject b) {
@@ -437,7 +438,7 @@
 	}
 
 	/**
-	 * 
+	 *
 	 * @param test
 	 * @param old
 	 * @param wanted
@@ -452,14 +453,14 @@
 			testa = wanted;
 			wanta = test;
 		}
-		if (old > wanted) { // ensure that second term is greater than 1 
+		if (old > wanted) { // ensure that second term is greater than 1
 			olda = old;
 			wantb = wanted;
 		} else {
 			olda = wanted;
 			wantb = old;
 		}
-		return testa/wanta * scaleTolerance < olda/wantb; 
+		return testa/wanta * scaleTolerance < olda/wantb;
 	}
 
 	public static boolean scaleNearerOrEuqal(float test, float old, float wanted) {
@@ -471,16 +472,16 @@
 			testa = wanted;
 			wanta = test;
 		}
-		if (old > wanted) { // ensure that second term is greater than 1 
+		if (old > wanted) { // ensure that second term is greater than 1
 			olda = old;
 			wantb = wanted;
 		} else {
 			olda = wanted;
 			wantb = old;
 		}
-		return testa/wanta < olda/wantb * scaleTolerance ; 
+		return testa/wanta < olda/wantb * scaleTolerance ;
 	}
-	
+
 	/* may be the following code is used same time later to further enhance the speed of finding the best map
 	public int getQuickMap(String search){
 		boolean found = false; // TODO unfertig
@@ -502,12 +503,17 @@
 			return false;
 	}
 	 */
+	private String _mapsPath="";
+	public String getMapsPath() {
+		return _mapsPath;
+	}
+	
 }
 
 class MapListEntry /*implements Comparable */ {
-	String sortEntryBBox;
+	private String sortEntryBBox;
 	//String sortEntry;
-	String filename;
+	private String filename;
 	String path;
 	MapInfoObject map;
 	static int rename = 0;
@@ -522,7 +528,7 @@
 		/*
 		try {map = new MapInfoObject(path, filename); } catch (Exception e) {
 		}
-		
+
 		ewe.sys.Vm.debug("centerID: "+map.getCenterID());
 		ewe.sys.Vm.debug("PxID: "+map.getPxSizeID());
 		ewe.sys.Vm.debug("scaleID: "+map.getScaleID()+"scale: "+map.scale);
@@ -538,7 +544,7 @@
 				sortEntryBBox = "FF1"+map.getEasyFindString();
 				ewe.sys.Vm.debug(sortEntryBBox + ": "+filename);
 				if (rename == 0) { // never asked before
-					if ( (new MessageBox(MyLocale.getMsg(4702,"Optimisation"), MyLocale.getMsg(4703,"Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?\n It can take several minutes"), 
+					if ( (new MessageBox(MyLocale.getMsg(4702,"Optimisation"), MyLocale.getMsg(4703,"Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?\n It can take several minutes"),
 							FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES)
 					{
 						renameProgressInfoB = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4704,"\nRenaming file:")+"    \n");
@@ -578,29 +584,37 @@
 			}
 		}
 	}
-	
+
 	public MapListEntry(double scale, double lat) {
 		map = new MapInfoObject(scale, lat);
 		filename = map.mapName;
 		sortEntryBBox = "FF1";
 	}
-	
+
 	public MapInfoObject getMap() throws IOException {
 		if (map == null) map = new MapInfoObject(path, filename);
 		return map;
 	}
-	
+
 	public static void loadingFinished() {
 		if (renameProgressInfoB != null) renameProgressInfoB.close(0);
 		renameProgressInfoB = null;
 		rename = 0;
 	}
-	
+
 	/*
 	// this maybe needed some time later to further enhance the speed of finding the best map
 	public int compareTo(Object other) {
 		if (other == null) return 1;
 		return this.sortEntryBBox.compareTo(((MapListEntry)other).sortEntryBBox);
 	} */
+
+	public String getSortEntryBBox() {
+		return sortEntryBBox;
+	}
+
+	public String getFilename() {
+		return filename;
+	}
 }
 



From araber95 at mail.berlios.de  Sun Sep 27 15:12:56 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 27 Sep 2009 15:12:56 +0200
Subject: [Cachewolf-svn] r2213 - trunk/src/CacheWolf/navi
Message-ID: <200909271312.n8RDCuYK010044@sheep.berlios.de>

Author: araber95
Date: 2009-09-27 15:12:55 +0200 (Sun, 27 Sep 2009)
New Revision: 2213

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
loading "list of maps" now reflects changed path of maps (example on changing profile).
(sorry for the removed trailing spaces)

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-27 13:03:28 UTC (rev 2212)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-27 13:12:55 UTC (rev 2213)
@@ -27,7 +27,7 @@
 	public final static int gotFix = 4; //green
 	public final static int lostFix = 3; //yellow
 	public final static int noGPSData = 2; // red
-	public final static int noGPS = 1; // no GPS-Position marker, manually disconnected 
+	public final static int noGPS = 1; // no GPS-Position marker, manually disconnected
 	public final static int ignoreGPS = -1; // ignore even changes in GPS-signal (eg. from lost fix to gotFix) this is wanted when the map is moved manually
 
 	public MapSymbol gotoPos = null;
@@ -44,14 +44,14 @@
 	//String mapPath;
 	Navigate myNavigation;
 	boolean running = false;
-	
+
 	MapImage mapImage1to1;
 	ArrowsOnMap directionArrows = new ArrowsOnMap();
 	AniImage statusImageHaveSignal;
 	AniImage statusImageNoSignal;
 	AniImage statusImageNoGps;
 	AniImage bottonImageClose;
-	AniImage bottonImageChooseMap; 
+	AniImage bottonImageChooseMap;
 	AniImage buttonImageGpsOn;
 	AniImage buttonImageLens;
 	AniImage buttonImageLensActivated;
@@ -79,7 +79,7 @@
 	boolean additionalOverlaysDeleted=true;
 	Point lastRepaintMapPos = null;
 	double lastDistance = -1;
-	
+
 	float lastHighestResolutionGPSDestScale = -1;
 
 	public static final int tileWidth = 100;
@@ -110,22 +110,22 @@
 		this.hasTopBar = false;
 		this.noBorder = true;
 		this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
-		this.title = "Moving Map"; 
+		this.title = "Moving Map";
 		this.backGround = new Color(254,254,254); // background must not be black because black is interpreted as transparent and transparent images above (eg trackoverlay) want be drawn in windows-VM, so be care, don|t use white either
 		//this.mapPath = Global.getPref().getMapLoadPath();
 
 		mmp = new MovingMapPanel(this);
 		this.addLast(mmp);
-		
+
 		boolean mobileVGA = false;
-		if (Vm.isMobile() && MyLocale.getScreenWidth() >= 400) mobileVGA = true;  
+		if (Vm.isMobile() && MyLocale.getScreenWidth() >= 400) mobileVGA = true;
 		String imagesize="";
 		if(mobileVGA) imagesize="_vga";
-		
+
 		statusImageHaveSignal = new AniImage("position_green"+imagesize+".png");
 		statusImageNoSignal = new AniImage("position_yellow"+imagesize+".png");
 		statusImageNoGps = new AniImage("position_red"+imagesize+".png");
-		bottonImageChooseMap = new AniImage("choose_map"+imagesize+".gif"); 
+		bottonImageChooseMap = new AniImage("choose_map"+imagesize+".gif");
 		buttonImageGpsOn = new AniImage("snap2gps"+imagesize+".gif");
 		buttonImageLens = new AniImage("lupe"+imagesize+".png");
 		buttonImageLensActivated = new AniImage("lupe_activated"+imagesize+".png");
@@ -134,7 +134,7 @@
 		buttonImageZoom1to1 = new AniImage("zoom1to1"+imagesize+".png");
 		posCircle = new MapSymbol("position_green"+imagesize+".png", "gps-position", new CWPoint());
 		MARK_CACHE_IMAGE = "mark_cache.png";
-		
+
 		DrawnIcon closeX;
 		if(mobileVGA)
 			closeX = new DrawnIcon(DrawnIcon.CROSS,30,30,new Color(0,0,0));
@@ -187,7 +187,7 @@
 		scaleWanted = 1;
 		mapChangeModus = HIGHEST_RESOLUTION_GPS_DEST;
 		lastHighestResolutionGPSDestScale = -1;
-		
+
 		lastRepaintMapPos = new Point(pref.myAppWidth +1, pref.myAppHeight +1);
 	}
 
@@ -209,7 +209,7 @@
 		buttonImageLensActivatedZoomOut.setLocation(w - buttonImageLensActivatedZoomOut.getWidth()-10, h/2 - buttonImageLensActivatedZoomOut.getHeight()/2 );
 		DistanceImage.setLocation(0, h - DistanceImage.getHeight());
 		ScaleImage.setLocation(w - ScaleImage.getWidth(), h - ScaleImage.getHeight());
-		if (mmp.mapImage != null) mmp.mapImage.screenDimChanged(); 
+		if (mmp.mapImage != null) mmp.mapImage.screenDimChanged();
 		if (posCircle != null) posCircle.screenDimChanged();
 		if (tracks != null) rebuildOverlaySet();
 		if (symbols != null) { // TODO: see if the rest of the code works with symbols = null
@@ -255,14 +255,14 @@
 	public void updateScale() {
 		ScaleImageGraphics.setColor(ScaleImage.transparentColor);
 		ScaleImageGraphics.fillRect(0, 0, ScaleImage.location.width,ScaleImage.location.height);
-		
+
 		if (currentMap != null)
 		{
 			double lineLengthMeters = 40 * currentMap.scale;
-			
+
 			int metricSystem = Global.getPref().metricSystem;
 			double localizedLineLength = 0;
-			int bigUnit = -1; 
+			int bigUnit = -1;
 			int smallUnit = -1;
 			double threshold = -1;
 			// Allow for different metric systems
@@ -270,18 +270,18 @@
 				bigUnit = Metrics.MILES;
 				smallUnit = Metrics.FEET;
 				threshold = 501;
-				
+
 				localizedLineLength = Metrics.convertUnit( lineLengthMeters, Metrics.METER, smallUnit);
 			} else {
 				bigUnit = Metrics.KILOMETER;
 				smallUnit = Metrics.METER;
 				threshold = 1000;
-				
+
 				localizedLineLength = lineLengthMeters;
 			}
-			
+
 			int currentUnit = smallUnit;
-						
+
 			float digits = (float)java.lang.Math.floor( java.lang.Math.log(localizedLineLength) / java.lang.Math.log(10.0) );
 			localizedLineLength = (float)java.lang.Math.ceil( localizedLineLength / (float)java.lang.Math.pow(10, digits) ) * (float)java.lang.Math.pow(10, digits);
 
@@ -289,28 +289,28 @@
 			{
 				currentUnit = bigUnit;
 				localizedLineLength = Metrics.convertUnit( lineLengthMeters, Metrics.METER, currentUnit);
-				
+
 				digits = (float)java.lang.Math.floor( java.lang.Math.log(localizedLineLength) / java.lang.Math.log(10.0) );
 				localizedLineLength = (float)java.lang.Math.ceil( localizedLineLength / (float)java.lang.Math.pow(10, digits) ) * (float)java.lang.Math.pow(10, digits);
 			}
-			
+
 			String lineLengthString = Convert.toString((int) localizedLineLength) + Metrics.getUnit(currentUnit);
-			
+
 			if	(digits < 0){
 				Double tmp = new Double();
 				tmp.set(localizedLineLength);
-				
+
 				int decimals = (int)(-1 * digits);
-				
+
 				lineLengthString = tmp.toString(decimals+2,decimals,0) + Metrics.getUnit(currentUnit);
 //				lineLengthString = MyLocale.formatDouble(tmp,"0.000") + Metrics.getUnit(currentUnit);
 			}
 
 			lineLengthMeters = Metrics.convertUnit( localizedLineLength, currentUnit, Metrics.METER);
-			
-			int lineLengthPixels = (int)java.lang.Math.round( lineLengthMeters / currentMap.scale );			
+
+			int lineLengthPixels = (int)java.lang.Math.round( lineLengthMeters / currentMap.scale );
 			int backgroundStartX = ScaleImage.location.width - (lineLengthPixels + fm.getTextWidth(lineLengthString) + 7);
-			
+
 			ScaleImageGraphics.setColor(new Color(250,250,250));
 			ScaleImageGraphics.fillRect(backgroundStartX, 0, ScaleImage.location.width - backgroundStartX ,ScaleImage.location.height);
 
@@ -319,11 +319,11 @@
 			ScaleImageGraphics.setColor(Color.DarkBlue);
 			ScaleImageGraphics.drawText(lineLengthString , backgroundStartX + lineLengthPixels + 5, 0);
 		}
-		
-		ScaleImageGraphics.drawImage(ScaleImage.image,null,Color.LightBlue,0,0,ScaleImage.location.width,ScaleImage.location.height); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed 
+
+		ScaleImageGraphics.drawImage(ScaleImage.image,null,Color.LightBlue,0,0,ScaleImage.location.width,ScaleImage.location.height); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed
 		ScaleImageGraphics.drawImage(ScaleImage.image,null,Color.White,0,0,ScaleImage.location.width,ScaleImage.location.height); // these 2 commands are necessary because of a bug or near to a bug in the ewe-vm
 	}
-	
+
 	public void updateDistance(boolean repaint) {
 		DistanceImageGraphics.setColor(DistanceImage.transparentColor);
 		DistanceImageGraphics.fillRect(0, 0, DistanceImage.location.width,DistanceImage.location.height);
@@ -335,10 +335,10 @@
 				lastDistance = currentDistance;
 				ewe.sys.Double dd = new ewe.sys.Double();
 				String d;
-				
+
 				int metricSystem = Global.getPref().metricSystem;
 				double localizedDistance = 0;
-				int bigUnit = -1; 
+				int bigUnit = -1;
 				int smallUnit = -1;
 				double threshold = -1;
 				// Allow for different metric systems
@@ -353,7 +353,7 @@
 					smallUnit = Metrics.METER;
 					threshold = 1.0;
 					localizedDistance = currentDistance;
-				} 
+				}
 				dd.set(localizedDistance);
 				if (dd.value >= threshold){
 					d = MyLocale.formatDouble(dd,"0.000") + Metrics.getUnit(bigUnit);
@@ -361,7 +361,7 @@
 					dd.set(Metrics.convertUnit(dd.value, bigUnit, smallUnit));
 					d = dd.toString(3,0,0) + Metrics.getUnit(smallUnit);
 				}
-				
+
 				int backgroundWidth = fm.getTextWidth(d) + 4;
 
 				DistanceImageGraphics.setColor(new Color(250,250,250));
@@ -369,8 +369,8 @@
 
 				DistanceImageGraphics.setColor(Color.DarkBlue);
 				DistanceImageGraphics.drawText(d, 2, 0);
-				
-				DistanceImageGraphics.drawImage(DistanceImage.image,null,Color.LightBlue,0,0,DistanceImage.location.width,DistanceImage.location.height); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed 
+
+				DistanceImageGraphics.drawImage(DistanceImage.image,null,Color.LightBlue,0,0,DistanceImage.location.width,DistanceImage.location.height); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed
 				DistanceImageGraphics.drawImage(DistanceImage.image,null,Color.White,0,0,DistanceImage.location.width,DistanceImage.location.height); // these 2 commands are necessary because of a bug or near to a bug in the ewe-vm
 				if (repaint)
 				{
@@ -380,7 +380,7 @@
 		}
 		else
 		{
-			DistanceImageGraphics.drawImage(DistanceImage.image,null,Color.LightBlue,0,0,DistanceImage.location.width,DistanceImage.location.height); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed 
+			DistanceImageGraphics.drawImage(DistanceImage.image,null,Color.LightBlue,0,0,DistanceImage.location.width,DistanceImage.location.height); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed
 			DistanceImageGraphics.drawImage(DistanceImage.image,null,Color.White,0,0,DistanceImage.location.width,DistanceImage.location.height); // these 2 commands are necessary because of a bug or near to a bug in the ewe-vm
 		}
 	}
@@ -407,7 +407,7 @@
 		}
 		setMarkedCache(mainT.ch);
 		addTrack(myNavigation.curTrack);
-		if (tracks != null && tracks.size() > 0 && ((Track)tracks.get(0)).num > 0) 
+		if (tracks != null && tracks.size() > 0 && ((Track)tracks.get(0)).num > 0)
 			rebuildOverlaySet(); // show points which where added when MavingMap was not running
 		if (myNavigation.destinationIsCache) {
 			destChanged(myNavigation.destinationCache);
@@ -415,11 +415,11 @@
 		else {
 			destChanged(myNavigation.destination);
 		}
-		
+
 		FormFrame ret = exec();
 		return ret;
 	}
-	
+
 	CacheHolder markedCache = null;
 	public void setMarkedCache(CacheHolder ch) {
 		if (ch == markedCache) return;
@@ -435,7 +435,7 @@
 			}
 		}
 	}
-	
+
 	public void addTrack(Track tr) {
 		if (tr == null) return;
 		if (tracks == null) tracks = new Vector();
@@ -454,7 +454,7 @@
 
 	/**
 	 * adds an 3x3 set of overlays to the map-window which contain the track
-	 * 
+	 *
 	 * add tracks with addtrack(track) before
 	 */
 
@@ -465,10 +465,10 @@
 			addMissingOverlays();
 		} catch (NullPointerException e) {
 			// hapens if currentmap == null or PosCircle not valid
-		} 
+		}
 		catch (IllegalArgumentException e) {
 			// happens if screensize is still not known    ---> in both cases creation of Overlayset will be done in updateOverlayPos if tracks != null
-		}  
+		}
 	}
 
 	public void destroyOverlaySet() {
@@ -492,16 +492,16 @@
 		}
 		boolean saveGPSIgnoreStatus = dontUpdatePos; // avoid multi-threading problems
 		dontUpdatePos = true;
-		Point upperleftOf4 = getXYonScreen(TrackOverlaySetCenterTopLeft); // TrackOverlay[4] == center of Trackoverlays 
+		Point upperleftOf4 = getXYonScreen(TrackOverlaySetCenterTopLeft); // TrackOverlay[4] == center of Trackoverlays
 		//upperleftOf4.x = (upperleftOf4.x + 1* width) % (width * 2) - 1 * width;
 		//upperleftOf4.y = (upperleftOf4.y + 1* height) % (height * 2) - 1 * height;
 		int i;
 		for (int yi=0; yi<3; yi++) {
 			for (int xi=0; xi<3; xi++) {
 				i = yi*3+xi;
-				if (TrackOverlays[i]==null) { 
-					TrackOverlays[i]= new TrackOverlay(ScreenXY2LatLon(upperleftOf4.x+(xi-1)*width, upperleftOf4.y+(yi-1)*height), width, height, currentMap); 
-					TrackOverlays[i].setLocation(width+1, height+1); // outside of the screen will hide it automatically it will get the correct position in upadteOverlayposition 
+				if (TrackOverlays[i]==null) {
+					TrackOverlays[i]= new TrackOverlay(ScreenXY2LatLon(upperleftOf4.x+(xi-1)*width, upperleftOf4.y+(yi-1)*height), width, height, currentMap);
+					TrackOverlays[i].setLocation(width+1, height+1); // outside of the screen will hide it automatically it will get the correct position in upadteOverlayposition
 					TrackOverlays[i].tracks = this.tracks;
 					TrackOverlays[i].paintTracks();
 					mmp.addImage(TrackOverlays[i]);
@@ -514,7 +514,7 @@
 	}
 
 	private void destroyOverlay(int ov) {
-		if (TrackOverlays[ov] == null) return; 
+		if (TrackOverlays[ov] == null) return;
 		mmp.removeImage(TrackOverlays[ov]);
 		TrackOverlays[ov].free();
 		TrackOverlays[ov]=null;
@@ -695,7 +695,7 @@
 			for (int xi=0; xi<3; xi++) {
 				num = yi*3+xi;
 				pX = posOnScreen.x+(xi-1)*ww;
-				pY = posOnScreen.y+(yi-1)*wh; 
+				pY = posOnScreen.y+(yi-1)*wh;
 				TrackOverlays[num].setLocation(pX, pY);
 			}
 		}
@@ -710,7 +710,7 @@
 					|| TrackOverlays[0].locAlways.y > 0 || TrackOverlays[8].locAlways.y < 0) { // testForNeedToRearange
 				rearangeOverlays();
 				addMissingOverlays();
-				// updateOverlayOnlyPos(); is called from addMissingOverlays 
+				// updateOverlayOnlyPos(); is called from addMissingOverlays
 			}
 		}
 	}
@@ -755,7 +755,7 @@
 	public void mapMoved(int diffX, int diffY) {
 		int w = posCircle.getWidth();
 		int h = posCircle.getHeight();
-		int npx = posCircleX-w/2+diffX; 
+		int npx = posCircleX-w/2+diffX;
 		int npy = posCircleY-h/2+diffY;
 		posCircle.move(npx, npy);
 		posCircleX = posCircleX+diffX;
@@ -777,10 +777,10 @@
 	 * @return
 	 */
 	public Point getMapPositionOnScreen() {
-		if (currentMap == null || !posCircle.where.isValid()) 
-			return new Point(pref.myAppWidth +1, pref.myAppHeight +1); 
+		if (currentMap == null || !posCircle.where.isValid())
+			return new Point(pref.myAppWidth +1, pref.myAppHeight +1);
 		// in case no calculation is possible return somthing outside of the screen
-		Point mapPos = new Point(); 
+		Point mapPos = new Point();
 		//if (mmp.mapImage != null) mmp.mapImage.getLocation(mapPos);
 		//else {
 		Point mapposint = currentMap.calcMapXY(posCircle.where);
@@ -791,7 +791,7 @@
 	}
 
 	/**
-	 * 
+	 *
 	 * @param lat
 	 * @param lon
 	 * @return
@@ -847,13 +847,13 @@
 		mmp.addImage(ms);
 		return ms;
 	}
-	
+
 	public void addSymbolIfNecessary(String pName, Object mapObject, Image imSymb, CWPoint where) {
 		if (findMapSymbol(pName) >= 0) return;
 		else addSymbol(pName, mapObject, imSymb, where);
-		
+
 	}
-		
+
 	public void addSymbol(String pName, Object mapObject, Image imSymb, CWPoint ll) {
 		if (symbols==null) symbols=new Vector();
 		MapSymbol ms = new MapSymbol(pName, mapObject, imSymb, ll);
@@ -865,7 +865,7 @@
 	}
 
 	public void destChanged(CWPoint d) {
-		if(!running || (d == null && gotoPos == null) || 
+		if(!running || (d == null && gotoPos == null) ||
 				(d != null && gotoPos != null && gotoPos.where.equals(d))) return;
 		removeGotoPosition();
 		if (d == null || !d.isValid() ) return;
@@ -929,7 +929,7 @@
 		}
 		return -1;
 	}
-	
+
 	public int findMapSymbol(Object obj) {
 		if (symbols == null) return -1;
 		MapSymbol ms;
@@ -942,8 +942,8 @@
 
 	/**
 	 * Move the map so that the posCircle is at lat/lon
-	 * 
-	 * @param  
+	 *
+	 * @param
 	 */
 	public void updateOnlyPosition(CWPoint where, boolean updateOverlay){
 		//Point oldMapPos = getMapPositionOnScreen();
@@ -951,20 +951,20 @@
 		Point mapPos = getMapPositionOnScreen();
 		//Vm.debug("mapx = " + mapx);
 		//Vm.debug("mapy = " + mapy);
-		if (forceMapLoad || (java.lang.Math.abs(lastRepaintMapPos.x - mapPos.x) > 1 || java.lang.Math.abs(lastRepaintMapPos.y - mapPos.y) > 1)) 
+		if (forceMapLoad || (java.lang.Math.abs(lastRepaintMapPos.x - mapPos.x) > 1 || java.lang.Math.abs(lastRepaintMapPos.y - mapPos.y) > 1))
 		{
 			lastRepaintMapPos = mapPos;
 			if (mmp.mapImage != null) 	mmp.mapImage.move(mapPos.x, mapPos.y);
 			updateSymbolPositions();
 			updateDistance(false);
 			if (updateOverlay ) updateOverlayPos(); // && TrackOverlays != null
-			mmp.repaintNow(); 
+			mmp.repaintNow();
 		}
 		else
 		{
 			updateDistance(true);
 		}
-		//Vm.debug("update only position");			
+		//Vm.debug("update only position");
 	}
 	/**
 	 * Method to laod the best map for lat/lon and move the map so that the posCircle is at lat/lon
@@ -972,7 +972,7 @@
 	public void updatePosition(CWPoint where){
 		if (dontUpdatePos || loadingMapList) return; // avoid multi-threading problems
 		//Vm.debug("updatepos, lat: "+where.latDec+" lon: "+where.lonDec);
-		if (!mapsloaded) {
+		if (!mapsloaded || !this.maps.getMapsPath().equals(Global.getPref().getCustomMapsPath())) {
 			loadMaps(Global.getPref().getMapLoadPath(), where.latDec);
 			lastCompareX = Integer.MAX_VALUE;
 			lastCompareY = Integer.MAX_VALUE;
@@ -1060,7 +1060,7 @@
 					AniImage im = (AniImage) i.next();
 					if ((im instanceof MapImage)
 						&& (!((im instanceof MapSymbol)
-							|| (im instanceof TrackOverlay) 
+							|| (im instanceof TrackOverlay)
 							|| mmp.mapImage == im))) {
 						//locAlways contains the real coordinates while
 						//location is only correct if the image is on the screen.
@@ -1087,7 +1087,7 @@
 		int middleheight = r.y + (r.height)/2;
 		CWPoint centerPoint = ScreenXY2LatLon(middlewidth, middleheight);
 		Rect screen = new Rect ();
-		screen.height = r.height ;//- r.y; 
+		screen.height = r.height ;//- r.y;
 		screen.width = r.width ;//- r.x;
 		MapInfoObject bestMap = maps.getBestMap(centerPoint, screen, currentMap.scale, true);
 		if (bestMap == null){
@@ -1133,7 +1133,7 @@
 			}
 		}
 	}
-	
+
 	private void generateTiles(Rect blackArea, String filename, Point mapPos,
 			Dimension rect2, MapImage fullImage) {
 		//Generate tiles from the map
@@ -1145,7 +1145,7 @@
 				if (!isCoveredByBlackArea(mapPos, row, column, blackArea, rect2)) {
 					continue;
 				}
-				//Get tile from cache or if not found, put all tiles for this image into the cache. 
+				//Get tile from cache or if not found, put all tiles for this image into the cache.
 				MapImage im = MovingMapCache.getCache().get(filename, row, column);
 				if (im == null) {
 					if (fullImage == null){
@@ -1219,7 +1219,7 @@
 		UR= " ("+String.valueOf(r.x+r.width)+","+String.valueOf(r.y+r.height)+") ";
 		return OL+" :"+UR;
 	}
-	
+
 	private void calculateRectangles(Rect blackArea, Rect whiteArea, Vector rectangles) {
 		if (width == 0 || height == 0) return;
 		int offsetX = width/10;
@@ -1227,7 +1227,7 @@
 		int width=this.width+offsetX;
 		int height=this.height+offsetY;
 		if (whiteArea.x >= width || whiteArea.y >= height) return;
-		
+
 		if (blackArea.x < -offsetX){
 			blackArea.width += blackArea.x + offsetX;
 			blackArea.x = -offsetX;
@@ -1242,7 +1242,7 @@
 		if (blackArea.y + blackArea.height > height){
 			blackArea.height = height - blackArea.y;
 		}
-		
+
 		if (blackArea.x > whiteArea.x) {
 			Rect r= new Rect ();
 			r.x = -offsetX;
@@ -1283,7 +1283,7 @@
 
 	public void updateGps(int fix) {
 		if (!running || ignoreGps) return;
-		// runMovingMap neccessary in case of multi-threaded Java-VM: ticked could be called during load of mmp 
+		// runMovingMap neccessary in case of multi-threaded Java-VM: ticked could be called during load of mmp
 		if ((fix > 0) && (myNavigation.gpsPos.getSats()>= 0)) { // TODO is getSats really necessary?
 			directionArrows.setDirections((float)myNavigation.gpsPos.getBearing(myNavigation.destination),
 					(float)myNavigation.skyOrientationDir.lonDec, (float)myNavigation.gpsPos.getBear());
@@ -1294,7 +1294,7 @@
 		if (fix == 0 && myNavigation.gpsPos.getSats()== 0) 	setGpsStatus(MovingMap.lostFix);
 		if (fix < 0 )	setGpsStatus(MovingMap.noGPSData);
 	}
-	
+
 	public void gpsStarted() {
 		addTrack(myNavigation.curTrack);
 		ignoreGps = false;
@@ -1319,10 +1319,10 @@
 	 * but anyway the map will be adjusted (moved) relativ to posCircle
 	 * when a better map was found the called method updateposition will set
 	 * posCirleLat/-Lon to lat/lon.
-	 * 
+	 *
 	 * @param lat
 	 * @param lon
-	 * @param loadIfSameScale 
+	 * @param loadIfSameScale
 	 * 			false: will not change the map if the better map has the same scale as the current
 	 * 			  - this is used not to change the map if it covers already the screen completely
 	 * 			true: willchange the map, regardless of change in scale
@@ -1331,14 +1331,14 @@
 		if (inBestMap) return;
 		inBestMap = true;
 		Object [] s = getRectForMapChange(where);
-		CWPoint cll = (CWPoint) s[0]; 
-		Rect screen = (Rect) s[1]; 
+		CWPoint cll = (CWPoint) s[0];
+		Rect screen = (Rect) s[1];
 		boolean posCircleOnScreen = ((Boolean) s[2]).booleanValue();
 		MapInfoObject newmap = null;
 		//if (mapChangeModus == 0) mapChangeModus = HIGHEST_RESOLUTION_GPS_DEST;
 		wantMapTest = true;
 		switch (mapChangeModus) {
-		case NORMAL_KEEP_RESOLUTION: 
+		case NORMAL_KEEP_RESOLUTION:
 			lastHighestResolutionGPSDestScale = -1;
 			newmap = maps.getBestMap(cll, screen, scaleWanted, false);
 			if (newmap == null) newmap = currentMap;
@@ -1348,27 +1348,27 @@
 			lastHighestResolutionGPSDestScale = -1;
 			newmap = maps.getBestMap(cll, screen, 0.000001f, false);
 			break;
-		case HIGHEST_RESOLUTION_GPS_DEST: 
+		case HIGHEST_RESOLUTION_GPS_DEST:
 			if (gotoPos!= null && GpsStatus != noGPS && posCircle.where.isValid()) {
 				if ( ( !posCircleOnScreen ) && ( lastHighestResolutionGPSDestScale > 0 ) ) {
 					newmap = maps.getBestMap(cll, screen, lastHighestResolutionGPSDestScale , false);
 				} else {
 					newmap = maps.getMapForArea(posCircle.where, gotoPos.where); // TODO use home-coos if no gps? - consider start from details panel and from gotopanel
 					if (newmap == null)	newmap = maps.getBestMap(cll, screen, 10000000000000000000000000000000000f, false); // use map with most available overview if no map containing PosCircle and GotoPos is available
-					
+
 					if (newmap != null) {
-						lastHighestResolutionGPSDestScale = newmap.scale;	
-						
+						lastHighestResolutionGPSDestScale = newmap.scale;
+
 						if (!posCircleOnScreen) {
 							newmap = maps.getBestMap(cll, screen, lastHighestResolutionGPSDestScale , false);
-						}						
+						}
 					}
 				}
 			}
 			//	either Goto-Pos or GPS-Pos not set
 			else {
 				lastHighestResolutionGPSDestScale = -1;
-				newmap = maps.getBestMap(cll, screen, 0.000001f, false); 
+				newmap = maps.getBestMap(cll, screen, 0.000001f, false);
 			}
 			break;
 		default: (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4208, "Bug: \nillegal mapChangeModus: ") + mapChangeModus, FormBase.OKB)).execute(); break;
@@ -1389,7 +1389,7 @@
 				setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), where); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
 			} catch (IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4209, "setBestMap: problem in: setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), lat, lon) lat/lon:") + where.toString(), FormBase.OKB)).exec(); }
 			while (currentMap == null) { // this actually cannot happen, but maybe in case of an inconstistent code change (esp. regarding empty maps)
-				mmp.chooseMap(); // force the user to select a scale 
+				mmp.chooseMap(); // force the user to select a scale
 				 if (currentMap == null) (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4210, "Moving map cannot run without a map - please select one. \n You can select an empty map"), FormBase.OKB)).execute();
 			}
 		}
@@ -1405,10 +1405,10 @@
 	}
 	/**
 	 * method to get a point on the screen which must be included in the map
-	 * the map methods are looking for. If the poscircle is on the screen this will be 
+	 * the map methods are looking for. If the poscircle is on the screen this will be
 	 * that point. If it is outside then the centre of the screen will be used.
-	 * 
-	 * returns [0] = CWPoint of that point, [1] Rect describing the screen around it 
+	 *
+	 * returns [0] = CWPoint of that point, [1] Rect describing the screen around it
 	 * @param lat
 	 * @param lon
 	 * @return
@@ -1428,16 +1428,16 @@
 			cll = ScreenXY2LatLon(w/2, h/2);
 			pX = w/2;
 			pY = h/2;
-		} 
+		}
 		Object[] ret = new Object[3];
 		ret[0] = cll;
 		ret[1] = new Rect(pX, pY, w, h);
 		ret[2] = posCircleOnScreen;
-		return ret; 
+		return ret;
 	}
 
 	/**
-	 * 
+	 *
 	 * @param betterOverview true: getmap with better overview
 	 * @return
 	 */
@@ -1452,7 +1452,7 @@
 		} else {
 			cll = new CWPoint(posCircle.where);
 		}
-		
+
 		MapInfoObject m = maps.getMapChangeResolution(cll, screen, currentMap.scale * currentMap.zoomFactor, !betterOverview);
 		if (m != null) {
 			boolean saveGpsIgnStatus = dontUpdatePos;
@@ -1461,9 +1461,9 @@
 			setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
 			dontUpdatePos = saveGpsIgnStatus;
 		}
-		else (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4211, "No ") + 
-				(betterOverview ? MyLocale.getMsg(4212, "less") : MyLocale.getMsg(4213, "more") ) + 
-				MyLocale.getMsg(4214, " detailed map available"), 
+		else (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4211, "No ") +
+				(betterOverview ? MyLocale.getMsg(4212, "less") : MyLocale.getMsg(4213, "more") ) +
+				MyLocale.getMsg(4214, " detailed map available"),
 				FormBase.OKB)).execute();
 	}
 
@@ -1476,15 +1476,15 @@
 		MapInfoObject newmap = maps.getMapForArea(sur.topleft, sur.buttomright);
 		if (newmap == null ) { // no map that includs all caches is available -> load map with lowest resolution
 			Object [] s = getRectForMapChange(posCircle.where);
-			CWPoint cll = (CWPoint) s[0]; 
-			Rect screen = (Rect) s[1]; 
+			CWPoint cll = (CWPoint) s[0];
+			Rect screen = (Rect) s[1];
 			newmap = maps.getBestMap(cll, screen, Float.MAX_VALUE -1, false);
 		}
 		if (newmap == null) { // no map is covering any area of the caches -> zoom an empty map to cover all caches on screen
 			try {
 				Object [] s = getRectForMapChange(posCircle.where);
-			//	CWPoint cll = (CWPoint) s[0]; 
-				Rect screen = (Rect) s[1]; 
+			//	CWPoint cll = (CWPoint) s[0];
+				Rect screen = (Rect) s[1];
 				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.buttomright.lonDec) * 1000 / (screen.width-15)); // 15 for the size of the cache image
 				float neededscaley = (float) (sur.topleft.getDistance(sur.buttomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height-15)); // 15 for the size of the cache image
 				newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
@@ -1510,7 +1510,7 @@
 		case lostFix:   { posCircle.change(statusImageNoSignal); break; }
 		case noGPSData: { posCircle.change(statusImageNoGps); break; }
 		}
-		mapMoved(0, 0); // positions the posCircle correctly accourding to its size (which can change when the image changes, e.g. from null to something else 
+		mapMoved(0, 0); // positions the posCircle correctly accourding to its size (which can change when the image changes, e.g. from null to something else
 		posCircle.refreshNow();
 	}
 
@@ -1528,14 +1528,14 @@
 	}
 
 	/** sets and displays the map
-	 * 
+	 *
 	 * @param newmap
 	 * @param lat move map so that lat/lon is in the centre / -361: don't adust to lat/lon
 	 * @param lon -361: don't adust to lat/lon
 	 */
 	public void setMap(MapInfoObject newmap, CWPoint where) {
-		if (currentMap != null && newmap.mapName.equals(currentMap.mapName) && !forceMapLoad) { // note: newmap.mapName == currentMap.mapName won't work because they are different String containing the same text 
-			updateOnlyPosition(where, true); 
+		if (currentMap != null && newmap.mapName.equals(currentMap.mapName) && !forceMapLoad) { // note: newmap.mapName == currentMap.mapName won't work because they are different String containing the same text
+			updateOnlyPosition(where, true);
 			return;
 		}
 		Vm.showWait(true);
@@ -1550,7 +1550,7 @@
 			Global.getPref().log(MyLocale.getMsg(4216, "Loading map..."));
 		}
 		try {
-			this.currentMap = newmap; 
+			this.currentMap = newmap;
 			this.title = currentMap.mapName;
 			lastCompareX = Integer.MAX_VALUE; // neccessary to make updateposition to test if the current map is the best one for the GPS-Position
 			lastCompareY = Integer.MAX_VALUE;
@@ -1561,13 +1561,13 @@
 				//Vm.debug("free: "+Vm.getUsedMemory(false)+"classMemory: "+Vm.getClassMemory()+ "after garbage collection: "+Vm.getUsedMemory(false));
 				Vm.getUsedMemory(true); // calls the garbage collection
 			} // give memory free before loading the new map to avoid out of memory error
-			String ImageFilename = currentMap.getImageFilename(); 
+			String ImageFilename = currentMap.getImageFilename();
 			if (ImageFilename == null ) {
 				mmp.mapImage = new MapImage();
 				maps.remove(currentMap);
 				(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4217, "Could not find image associated with: \n")+currentMap.fileNameWFL, FormBase.OKB)).execute();
 			}
-			else { 
+			else {
 				if (ImageFilename.length() > 0) mmp.mapImage = new MapImage(ImageFilename); // attention: when running in native java-vm, no exception will be thrown, not even OutOfMemeoryError
 				else mmp.mapImage = new MapImage(); // no image associated with the calibration info ("empty map")
 			}
@@ -1588,7 +1588,7 @@
 			dontUpdatePos = saveIgnoreStatus;
 		} catch (IllegalArgumentException e) { // thrown by new AniImage() in ewe-vm if file not found;
 			if (mmp.mapImage != null) {
-				mmp.removeImage(mmp.mapImage); 
+				mmp.removeImage(mmp.mapImage);
 				mmp.mapImage.free();
 				mmp.mapImage = null; mapImage1to1 = mmp.mapImage;
 			}
@@ -1600,7 +1600,7 @@
 			dontUpdatePos = saveIgnoreStatus;
 		} catch (OutOfMemoryError e) {
 			if (mmp.mapImage != null) {
-				mmp.removeImage(mmp.mapImage); 
+				mmp.removeImage(mmp.mapImage);
 				mmp.mapImage.free();
 				mmp.mapImage = null; mapImage1to1 = mmp.mapImage;
 			}
@@ -1608,29 +1608,29 @@
 			updateOnlyPosition(where, false);
 			inf.close(0);
 			Vm.showWait(false);
-			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4219, "Not enough memory to load map: \n") 
+			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4219, "Not enough memory to load map: \n")
 					+ newmap.getImageFilename()
-					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 
+					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"),
 					FormBase.OKB)).execute();
 			dontUpdatePos = saveIgnoreStatus;
 		}catch (SystemResourceException e) {
 			if (mmp.mapImage != null) {
-				mmp.removeImage(mmp.mapImage); 
+				mmp.removeImage(mmp.mapImage);
 				mmp.mapImage.free();
 				mmp.mapImage = null; mapImage1to1 = mmp.mapImage;
 			}
 			rebuildOverlaySet();
-			updateOnlyPosition(where, false); // TODO this doesn't work correctly if the resolution changed, I guess because the pixels of PosCircle will be interpreted from the new resolution, but should be interpreted using the old resolution to test: select a map with a much greater value of m per pixel manually 
+			updateOnlyPosition(where, false); // TODO this doesn't work correctly if the resolution changed, I guess because the pixels of PosCircle will be interpreted from the new resolution, but should be interpreted using the old resolution to test: select a map with a much greater value of m per pixel manually
 			inf.close(0);
 			Vm.showWait(false);
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4221, "Not enough ressources to load map: ")
 					+ newmap.getImageFilename()
-					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 
+					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"),
 					FormBase.OKB)).execute();
 			dontUpdatePos = saveIgnoreStatus;
 		}
 	}
-	
+
 	private void updateAfterMapChange(CWPoint newCenter) {
 		if (!posCircle.where.isValid()) {
 			posCircle.where.set(newCenter);
@@ -1643,17 +1643,17 @@
 		int mapPosY = h/2 - centerOnMap.y;
 		int newPosCircleX = mapPosX + circlePosOnMap.x;
 		int newPosCircleY = mapPosY + circlePosOnMap.y;
-		
+
 		if (mmp != null && mmp.mapImage != null) mmp.mapImage.move(mapPosX, mapPosY);
-		
+
 		int wCircle = posCircle.getWidth();
 		int hCircle = posCircle.getHeight();
-		int npx = newPosCircleX-wCircle/2; 
+		int npx = newPosCircleX-wCircle/2;
 		int npy = newPosCircleY-hCircle/2;
 		posCircle.move(npx, npy);
 		posCircleX = newPosCircleX;
 		posCircleY = newPosCircleY;
-		
+
 		updateOnlyPosition(posCircle.where, true);
 	}
 
@@ -1684,8 +1684,8 @@
 	 * @param h
 	 */
 	public void zoomScreenRect(Point firstclickpoint, int w, int h) {
-		int newImageWidth = (int) (this.width *  (this.width  < 481 ? 2 : 1.6)); // (maximal) size of the zoomed image 
-		int newImageHeight= (int) (this.height * (this.width < 481 ?  2 : 1.6)); // dont make this to big, otherwise it causes out of memory errors 
+		int newImageWidth = (int) (this.width *  (this.width  < 481 ? 2 : 1.6)); // (maximal) size of the zoomed image
+		int newImageHeight= (int) (this.height * (this.width < 481 ?  2 : 1.6)); // dont make this to big, otherwise it causes out of memory errors
 		CWPoint center = ScreenXY2LatLon(firstclickpoint.x + w/2, firstclickpoint.y + h/2);
 		float zoomFactor;
 		if (h < 0) {
@@ -1710,22 +1710,22 @@
 		if (mapImage1to1 != null && mmp.mapImage != null && mapImage1to1.image != null)
 		{
 			// try to avoid overlapping by shifting
-			if (newImageRect.x < 0) 
+			if (newImageRect.x < 0)
 				newImageRect.x = 0; // align left if left overlapping
-			if (newImageRect.y < 0) 
+			if (newImageRect.y < 0)
 				newImageRect.y = 0;
-			if (newImageRect.x + newImageRect.width >= mapImage1to1.getWidth()) 
+			if (newImageRect.x + newImageRect.width >= mapImage1to1.getWidth())
 				newImageRect.x = mapImage1to1.getWidth()- newImageWidth; // align right if right overlaping
-			if (newImageRect.y + newImageRect.height >= mapImage1to1.getHeight()) 
+			if (newImageRect.y + newImageRect.height >= mapImage1to1.getHeight())
 				newImageRect.y = mapImage1to1.getHeight()- newImageHeight;
 			// crop if after shifting still overlapping
-			if (newImageRect.x < 0) 
+			if (newImageRect.x < 0)
 				newImageRect.x = 0;
-			if (newImageRect.y < 0) 
+			if (newImageRect.y < 0)
 				newImageRect.y = 0;
-			if (newImageRect.x + newImageRect.width >= mapImage1to1.getWidth()) 
+			if (newImageRect.x + newImageRect.width >= mapImage1to1.getWidth())
 				newImageRect.width = mapImage1to1.getWidth() - newImageRect.x;
-			if (newImageRect.y + newImageRect.height >= mapImage1to1.getHeight()) 
+			if (newImageRect.y + newImageRect.height >= mapImage1to1.getHeight())
 				newImageRect.height= mapImage1to1.getHeight()- newImageRect.y;
 		}
 		zoomFromUnscaled(zoomFactor * currentMap.zoomFactor, newImageRect, center);
@@ -1742,7 +1742,7 @@
 	 * @param zoomFactor relative to original image
 	 * @param newImageRect Rect in the 1:1 image that contains the area to be zoomed into
 	 * @param center
-	 */		
+	 */
 	public void zoomFromUnscaled (float zoomFactor, Rect newImageRect, CWPoint center) {
 		Vm.showWait(this, true);
 		boolean savegpsstatus = dontUpdatePos;
@@ -1765,7 +1765,7 @@
 				else tmp = new MapImage(mapImage1to1.scale((int) (newImageRect.width*zoomFactor), (int)(newImageRect.height*zoomFactor), newImageRect, 0));
 				currentMap.zoom(zoomFactor, newImageRect.x, newImageRect.y);
 			} catch (OutOfMemoryError e) {
-				(new MessageBox(MyLocale.getMsg(4207, "Error"), 
+				(new MessageBox(MyLocale.getMsg(4207, "Error"),
 						MyLocale.getMsg(4222, "Out of memory error"), FormBase.OKB)).execute();
 				//tmp = mapImage1to1;
 			} //if (tmp != null) currentMap.zoom();}
@@ -1780,7 +1780,7 @@
 				Point mappos = getMapPositionOnScreen();
 				mmp.mapImage.move(mappos.x,mappos.y);
 			}
-		} else // no map image loaded 
+		} else // no map image loaded
 		{ currentMap.zoom(zoomFactor, newImageRect.x, newImageRect.y); }
 		// scaleWanted = currentMap.scale; use this if you want to change automatically to a map scale that best fits the zooming
 		destroyOverlaySet();
@@ -1804,7 +1804,7 @@
 	public void onEvent(Event ev){
 		if(ev instanceof FormEvent && (ev.type == FormEvent.CLOSED )){
 			running = false;
-		}  
+		}
 		if( ev instanceof KeyEvent && ev.target == this && ( (((KeyEvent)ev).key == IKeys.ESCAPE) || (((KeyEvent)ev).key == IKeys.ENTER) || (((KeyEvent)ev).key == IKeys.ACTION) ) ) {
 			this.close(0);
 			ev.consumed = true;
@@ -1821,7 +1821,7 @@
 	MenuItem gotoMenuItem = new MenuItem(MyLocale.getMsg(4230, "Goto here$g"), 0, null);
 	MenuItem newWayPointMenuItem = new MenuItem(MyLocale.getMsg(4232, "Create new Waypoint here$n"), 0, null);;
 	MenuItem openCacheDescMenuItem,addCachetoListMenuItem,gotoCacheMenuItem;
-	
+
 	MenuItem miLuminary[];
 
 	Menu mapsMenu;
@@ -1833,19 +1833,19 @@
 	MenuItem noFillMapMI = new MenuItem(MyLocale.getMsg(4266, "Fill white areas"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4266, "Fill white areas"), null, CellConstants.RIGHT));
 	// automatic
 	MenuItem mapChangeModusMI = new MenuItem(MyLocale.getMsg(4242, "Modus for automatic map change"), MenuItem.Separator, null);;
-	MenuItem highestResGpsDestMI = new MenuItem(MyLocale.getMsg(4244, "Highest res. containing dest. & cur. position"), new IconAndText(new mImage("res_gps_goto.png"), MyLocale.getMsg(4245, "Highest res. containing dest. & cur. position"), null, CellConstants.RIGHT)); //immer h?chste Aufl?sung w?hlen, die akt. Pos. und Ziel enthalten 
-	MenuItem highestResolutionMI = new MenuItem(MyLocale.getMsg(4246, "Highest resolution"), new IconAndText(new mImage("res_high.png"), MyLocale.getMsg(4247, "Highest resolution"), null, CellConstants.RIGHT)); //immer h?chste Aufl?sung w?hlen 
-	MenuItem keepManResolutionMI = new MenuItem(MyLocale.getMsg(4248, "Keep manual resolution"), new IconAndText(new mImage("res_manuell.png"), MyLocale.getMsg(4249, "Keep manual resolution"), null, CellConstants.RIGHT)); // manuell gew?hlte Aufl?sung beibehalten  
+	MenuItem highestResGpsDestMI = new MenuItem(MyLocale.getMsg(4244, "Highest res. containing dest. & cur. position"), new IconAndText(new mImage("res_gps_goto.png"), MyLocale.getMsg(4245, "Highest res. containing dest. & cur. position"), null, CellConstants.RIGHT)); //immer h?chste Aufl?sung w?hlen, die akt. Pos. und Ziel enthalten
+	MenuItem highestResolutionMI = new MenuItem(MyLocale.getMsg(4246, "Highest resolution"), new IconAndText(new mImage("res_high.png"), MyLocale.getMsg(4247, "Highest resolution"), null, CellConstants.RIGHT)); //immer h?chste Aufl?sung w?hlen
+	MenuItem keepManResolutionMI = new MenuItem(MyLocale.getMsg(4248, "Keep manual resolution"), new IconAndText(new mImage("res_manuell.png"), MyLocale.getMsg(4249, "Keep manual resolution"), null, CellConstants.RIGHT)); // manuell gew?hlte Aufl?sung beibehalten
 	// manuell
 	MenuItem mapChangeResMI = new MenuItem(MyLocale.getMsg(4250, "Change resolution manually"), MenuItem.Separator, null);;
-	MenuItem AllCachesResMI = new MenuItem(MyLocale.getMsg(4252, "Load a map containing all marked caches"),  new IconAndText(new mImage("loupe_all.png"), MyLocale.getMsg(4253, "Load a map containing all marked caches"), null, CellConstants.RIGHT));   
-	MenuItem moreDetailsMI = new MenuItem(MyLocale.getMsg(4254, "Load a map with more details"), new IconAndText(new mImage("loupe_more_details.png"), MyLocale.getMsg(4255, "Load a map with more details"), null, CellConstants.RIGHT)); // laod a map with more details 
-	MenuItem moreOverviewMI = new MenuItem(MyLocale.getMsg(4256, "Load a map for a better overview"), new IconAndText(new mImage("loupe_better_overview.png"), MyLocale.getMsg(4257, "Load a map for a better overview"), null, CellConstants.RIGHT)); // Load a map for a better overview --> lesser details  
+	MenuItem AllCachesResMI = new MenuItem(MyLocale.getMsg(4252, "Load a map containing all marked caches"),  new IconAndText(new mImage("loupe_all.png"), MyLocale.getMsg(4253, "Load a map containing all marked caches"), null, CellConstants.RIGHT));
+	MenuItem moreDetailsMI = new MenuItem(MyLocale.getMsg(4254, "Load a map with more details"), new IconAndText(new mImage("loupe_more_details.png"), MyLocale.getMsg(4255, "Load a map with more details"), null, CellConstants.RIGHT)); // laod a map with more details
+	MenuItem moreOverviewMI = new MenuItem(MyLocale.getMsg(4256, "Load a map for a better overview"), new IconAndText(new mImage("loupe_better_overview.png"), MyLocale.getMsg(4257, "Load a map for a better overview"), null, CellConstants.RIGHT)); // Load a map for a better overview --> lesser details
 	// move map to
 	MenuItem moveToMI = new MenuItem(MyLocale.getMsg(4258, "Move map to and load map"), MenuItem.Separator, null);;
-	MenuItem moveToDestMI = new MenuItem(MyLocale.getMsg(4260, "Move to goto point"), new IconAndText(new mImage("move2goto.png"), MyLocale.getMsg(4261, "Move to goto point"), null, CellConstants.RIGHT)); //* Karte zum Ziel verschieben (und ggf. entsprechende Karte laden) 
-	MenuItem moveToGpsMI = new MenuItem(MyLocale.getMsg(4262, "Move to GPS position"), new IconAndText(new mImage("move2gps.png"), MyLocale.getMsg(4263, "Move to GPS position"), null, CellConstants.RIGHT));   
-	MenuItem moveToCenterMI = new MenuItem(MyLocale.getMsg(4264, "Move to centre"), new IconAndText(new mImage("move2center.png"), MyLocale.getMsg(4265, "Move to centre"), null, CellConstants.RIGHT));   
+	MenuItem moveToDestMI = new MenuItem(MyLocale.getMsg(4260, "Move to goto point"), new IconAndText(new mImage("move2goto.png"), MyLocale.getMsg(4261, "Move to goto point"), null, CellConstants.RIGHT)); //* Karte zum Ziel verschieben (und ggf. entsprechende Karte laden)
+	MenuItem moveToGpsMI = new MenuItem(MyLocale.getMsg(4262, "Move to GPS position"), new IconAndText(new mImage("move2gps.png"), MyLocale.getMsg(4263, "Move to GPS position"), null, CellConstants.RIGHT));
+	MenuItem moveToCenterMI = new MenuItem(MyLocale.getMsg(4264, "Move to centre"), new IconAndText(new mImage("move2center.png"), MyLocale.getMsg(4265, "Move to centre"), null, CellConstants.RIGHT));
 
 	CacheHolder clickedCache;
 	MovingMap mm;
@@ -1855,7 +1855,7 @@
 	boolean paintingZoomArea;
 	ImageList saveImageList = null;
 	int lastZoomWidth , lastZoomHeight;
-	
+
 	public MovingMapPanel(MovingMap f){
 		this.mm = f;
 		miLuminary = new MenuItem[SkyOrientation.LUMINARY_NAMES.length];
@@ -1874,7 +1874,7 @@
 		}
 		// move (drag) map
 		//if (!(which == null || which == mapImage || which instanceof TrackOverlay || which == mm.directionArrows) ) return false;
-		saveGpsIgnoreStatus = mm.dontUpdatePos; 
+		saveGpsIgnoreStatus = mm.dontUpdatePos;
 		mm.dontUpdatePos = true;
 		saveMapLoc = pos;
 		bringMapToTop();
@@ -1902,7 +1902,7 @@
 			saveMapLoc = new Point (ev.x, ev.y);
 			paintingZoomArea = true;
 			mm.zoomingMode = true;
-		} 
+		}
 		if (!mm.zoomingMode && ev.type == PenEvent.PEN_DOWN && ev.modifiers == PenEvent.RIGHT_BUTTON) {
 			penHeld(new Point (ev.x, ev.y));
 		}
@@ -1930,13 +1930,13 @@
 			top -= 2;
 			if (top < 0) top = 0;
 			if (left < 0) left = 0;
-			if ((lastZoomWidth <= 0) && (ev.x - saveMapLoc.x > 0)) { // changed from zooming out to zooming in 
+			if ((lastZoomWidth <= 0) && (ev.x - saveMapLoc.x > 0)) { // changed from zooming out to zooming in
 				removeImage(mm.buttonImageLensActivated);
 				removeImage(mm.buttonImageLensActivatedZoomOut);
 				addImage(mm.buttonImageLensActivatedZoomIn);
 				this.repaintNow(dr, new Rect(mm.buttonImageLensActivatedZoomIn.location.x, mm.buttonImageLensActivatedZoomIn.location.y, mm.buttonImageLensActivatedZoomIn.getWidth(), mm.buttonImageLensActivatedZoomIn.getHeight()));
 			}
-			if ((lastZoomWidth >= 0) && (ev.x - saveMapLoc.x < 0)) { // changed from zooming out to zooming in 
+			if ((lastZoomWidth >= 0) && (ev.x - saveMapLoc.x < 0)) { // changed from zooming out to zooming in
 				removeImage(mm.buttonImageLensActivated);
 				removeImage(mm.buttonImageLensActivatedZoomIn);
 				addImage(mm.buttonImageLensActivatedZoomOut);
@@ -2010,12 +2010,12 @@
 			} else {
 				mm.setGpsStatus(MovingMap.noGPS);
 				mm.ignoreGps = true;
-				mm.setMap(l.selectedMap, mm.posCircle.where); 
+				mm.setMap(l.selectedMap, mm.posCircle.where);
 				if (mm.currentMap.fileNameWFL.length() > 0)
 					mm.setCenterOfScreen(l.selectedMap.center, true); // if map has an image
 				mm.setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
 				//Point posCXY = new Point (0,0); mm.getXYinMap(mm.posCircleLat, mm.posCircleLat);
-				//double lat = mm.currentMap.affine[0]*posCXY.x + mm.currentMap.affine[2]*posCXY.y + mm.currentMap.affine[4]; 
+				//double lat = mm.currentMap.affine[0]*posCXY.x + mm.currentMap.affine[2]*posCXY.y + mm.currentMap.affine[4];
 				//mm.posCircleX = 0; // place map to the upper left corner of windows
 				//mm.posCircleY = 0;
 				//mm.updateOnlyPosition(mm.currentMap.affine[4], mm.currentMap.affine[5], true);
@@ -2031,7 +2031,7 @@
 			mapsMenu = new Menu();
 			mapsMenu.addItem(selectMapMI);
 			mapsMenu.addItem(changeMapDirMI);
-			if (!mm.noMapsAvailable) 
+			if (!mm.noMapsAvailable)
 			{
 				if (mm.mapHidden) mapsMenu.addItem(showMapMI);
 				else mapsMenu.addItem(hideMapMI);
@@ -2047,9 +2047,9 @@
 			highestResolutionMI.modifiers &= ~MenuItem.Checked;
 			keepManResolutionMI.modifiers &= ~MenuItem.Checked;
 			switch (mm.mapChangeModus) {
-			case MovingMap.NORMAL_KEEP_RESOLUTION: keepManResolutionMI.modifiers |= MenuItem.Checked; break;   
-			case MovingMap.HIGHEST_RESOLUTION: highestResolutionMI.modifiers |= MenuItem.Checked; break;   
-			case MovingMap.HIGHEST_RESOLUTION_GPS_DEST: highestResGpsDestMI.modifiers |= MenuItem.Checked; break;   
+			case MovingMap.NORMAL_KEEP_RESOLUTION: keepManResolutionMI.modifiers |= MenuItem.Checked; break;
+			case MovingMap.HIGHEST_RESOLUTION: highestResolutionMI.modifiers |= MenuItem.Checked; break;
+			case MovingMap.HIGHEST_RESOLUTION_GPS_DEST: highestResGpsDestMI.modifiers |= MenuItem.Checked; break;
 			}
 			mapsMenu.addItem(mapChangeModusMI);
 			mapsMenu.addItem(highestResGpsDestMI);
@@ -2082,7 +2082,7 @@
 			lastZoomHeight = 0;
 		}
 		if (which == mm.buttonImageZoom1to1) {
-			mm.zoom1to1(); 
+			mm.zoom1to1();
 		}
 		if (which == mm.bottonImageClose) {
 			WindowEvent tmp = new WindowEvent();
@@ -2098,9 +2098,9 @@
 
 	public void penHeld(Point p){
 		//	if (!menuIsActive()) doMenu(p);
-		if (!mm.zoomingMode) { 
+		if (!mm.zoomingMode) {
 			//( (ev.type == PenEvent.PEN_DOWN) && ((PenEvent)ev).modifiers == PenEvent.RIGHT_BUTTON)
-			//|| ((ev.type == PenEvent.RIGHT_BUTTON) ) )) ---> these events are not posted --> this overridering is the only solution 
+			//|| ((ev.type == PenEvent.RIGHT_BUTTON) ) )) ---> these events are not posted --> this overridering is the only solution
 			kontextMenu = new Menu();
 			if ( !(mm.directionArrows.onHotArea(p.x, p.y)) ) {
 				kontextMenu.addItem(gotoMenuItem);
@@ -2113,14 +2113,14 @@
 						kontextMenu.addItem(openCacheDescMenuItem);
 						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto")+ " '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$g"); // clickedCache == null can happen if clicked on the goto-symbol
 						kontextMenu.addItem(gotoCacheMenuItem);
-						if (Global.mainForm.cacheListVisible) { 
+						if (Global.mainForm.cacheListVisible) {
 							addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
 							kontextMenu.addItem(addCachetoListMenuItem);
 						}
 					}
 				}
 			}
-			else {			
+			else {
 				for (int i=0; i<SkyOrientation.LUMINARY_NAMES.length; i++) {
 					kontextMenu.addItem(miLuminary[i]);
 					if (i == mm.myNavigation.luminary) miLuminary[i].modifiers |= MenuItem.Checked;
@@ -2135,14 +2135,14 @@
 		if (mapsMenu != null && ev instanceof PenEvent && ev.type == PenEvent.PEN_DOWN && ev.target == this) {mapsMenu.close(); mapsMenu = null;}
 		if (kontextMenu != null && ev instanceof PenEvent && ev.type == PenEvent.PEN_DOWN && ev.target == this) {kontextMenu.close(); kontextMenu = null; }
 
-		if (ev instanceof MenuEvent) { 
+		if (ev instanceof MenuEvent) {
 			if (ev.target == mapsMenu) {
-				if (ev.type == MenuEvent.ABORTED || ev.type == ControlEvent.CANCELLED || ev.type == ControlEvent.FOCUS_OUT) mapsMenu.close(); // TODO menuIsActive() benutzen? 
+				if (ev.type == MenuEvent.ABORTED || ev.type == ControlEvent.CANCELLED || ev.type == ControlEvent.FOCUS_OUT) mapsMenu.close(); // TODO menuIsActive() benutzen?
 				if (ev.type == MenuEvent.SELECTED ) {
-					MenuItem action = (MenuItem) mapsMenu.getSelectedItem(); 
+					MenuItem action = (MenuItem) mapsMenu.getSelectedItem();
 					if (mapsMenu.getSelectedItem() != null) {
 						//maps
-						if (action == selectMapMI)	{ 
+						if (action == selectMapMI)	{
 							mapsMenu.close();
 							chooseMap();
 						}
@@ -2196,7 +2196,7 @@
 						else if (action == moreDetailsMI) {
 							mapsMenu.close();
 							mm.loadMoreDetailedMap(false);
-						} 
+						}
 						else if (action == moreOverviewMI) {
 							mapsMenu.close();
 							mm.loadMoreDetailedMap(true);
@@ -2216,7 +2216,7 @@
 						}
 						else if (action == moveToGpsMI) {
 							mapsMenu.close();
-							this.snapToGps();						
+							this.snapToGps();
 						}
 
 					}
@@ -2224,10 +2224,10 @@
 			} // if (ev.target == mapsMenu)
 			if (ev.target == kontextMenu) {
 				if ((((MenuEvent)ev).type==MenuEvent.SELECTED)) {
-					MenuItem action = (MenuItem) kontextMenu.getSelectedItem(); 
+					MenuItem action = (MenuItem) kontextMenu.getSelectedItem();
 					if (action == gotoMenuItem) {
 						kontextMenu.close();
-						mm.myNavigation.setDestination(mm.ScreenXY2LatLon(saveMapLoc.x, saveMapLoc.y));	
+						mm.myNavigation.setDestination(mm.ScreenXY2LatLon(saveMapLoc.x, saveMapLoc.y));
 					}
 					if (action == openCacheDescMenuItem) {
 						//mm.onEvent(new FormEvent(FormEvent.CLOSED, mm));
@@ -2241,17 +2241,17 @@
 					}
 					if (action == gotoCacheMenuItem) {
 						kontextMenu.close();
-						mm.myNavigation.setDestination(clickedCache);	
+						mm.myNavigation.setDestination(clickedCache);
 					}
 					if (action == newWayPointMenuItem) {
 						kontextMenu.close();
 						WindowEvent close = new WindowEvent();
-						close.target = mm; 
+						close.target = mm;
 						close.type = WindowEvent.CLOSE;
 						mm.postEvent(close);
 						CacheHolder newWP = new CacheHolder();
 						newWP.pos = mm.ScreenXY2LatLon(saveMapLoc.x, saveMapLoc.y);
-						newWP.LatLon=newWP.pos.toString(); 
+						newWP.LatLon=newWP.pos.toString();
 						Global.mainTab.newWaypoint(newWP);
 					}
 					if (action == addCachetoListMenuItem) {
@@ -2268,7 +2268,7 @@
 					}
 				}
 			} // if (ev.target == kontextMenu)
-		} // if (ev instanceof ControlEvent ) 
+		} // if (ev instanceof ControlEvent )
 		super.onEvent(ev);
 	}
 }
@@ -2286,7 +2286,7 @@
 
 	public ListBox(Vector maps, CWPoint Gps, CWPoint gotopos, MapInfoObject curMap){
 		this.title = MyLocale.getMsg(4271, "Maps");
-		// if (Gui.screenIs(Gui.PDA_SCREEN)) this.setPreferredSize(200,100); else 
+		// if (Gui.screenIs(Gui.PDA_SCREEN)) this.setPreferredSize(200,100); else
 		// set width to screenwidth *3/4 but to at least 240 if the screen is big engough for 240px width
 		this.setPreferredSize(java.lang.Math.max(MyLocale.getScreenWidth()*3/4, java.lang.Math.min(240, MyLocale.getScreenWidth()) ), MyLocale.getScreenHeight()*3/4);
 		this.maps = maps;
@@ -2308,14 +2308,14 @@
 					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
 					else { map = ml.getMap();}
 				} catch (IOException ex) {continue; } // could not read .wfl-file
-				if( map.isInBound(Gps.latDec, Gps.lonDec) && map.isInBound(gotopos) ) 
+				if( map.isInBound(Gps.latDec, Gps.lonDec) && map.isInBound(gotopos) )
 				{
 					list.addItem(i + ": " + map.mapName);
 					row++;
 					inList[i] = true;
-					if (!curMapFound && curMap!=null && map.mapName.equals(curMap.mapName)) { 
-						oldmap = row; 
-						curMapFound = true; 
+					if (!curMapFound && curMap!=null && map.mapName.equals(curMap.mapName)) {
+						oldmap = row;
+						curMapFound = true;
 					}
 				} else inList[i] = false;
 			}
@@ -2330,14 +2330,14 @@
 					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
 					else { map = ml.getMap();}
 				} catch (IOException ex) {continue; } // could not read .wfl-file
-				if( map.isInBound(Gps.latDec, Gps.lonDec) ) 
+				if( map.isInBound(Gps.latDec, Gps.lonDec) )
 				{
 					list.addItem(i + ": " + map.mapName);
 					row++;
 					inList[i] = true;
-					if (!curMapFound  && curMap!=null && map.mapName.equals(curMap.mapName)) { 
-						oldmap = row; 
-						curMapFound = true; 
+					if (!curMapFound  && curMap!=null && map.mapName.equals(curMap.mapName)) {
+						oldmap = row;
+						curMapFound = true;
 					}
 				}
 			}
@@ -2356,9 +2356,9 @@
 					list.addItem(i + ": " + map.mapName);
 					row++;
 					inList[i] = true;
-					if (!curMapFound  && curMap!=null && map.mapName.equals(curMap.mapName)) { 
-						oldmap = row; 
-						curMapFound = true; 
+					if (!curMapFound  && curMap!=null && map.mapName.equals(curMap.mapName)) {
+						oldmap = row;
+						curMapFound = true;
 					}
 				}
 			}
@@ -2370,9 +2370,9 @@
 			if(!inList[i]) {
 				list.addItem(i + ": " + ml.filename);
 				row++;
-				if (!curMapFound && curMap!=null && ml.filename.equals(curMap.mapName)) { 
-					oldmap = row; 
-					curMapFound = true; 
+				if (!curMapFound && curMap!=null && ml.filename.equals(curMap.mapName)) {
+					oldmap = row;
+					curMapFound = true;
 				}
 			}
 		}
@@ -2387,7 +2387,7 @@
 		okButton.takeFocus(0);
 	}
 	public void mapSelected() {
-		try { 
+		try {
 			selectedMap = null;
 			int mapNum = 0;
 			String it = new String();
@@ -2401,7 +2401,7 @@
 				selected = true;
 				this.close(FormBase.IDOK);
 				} catch (IOException e) {
-					(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4278, "Cannot load wfl-file: \n") 
+					(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4278, "Cannot load wfl-file: \n")
 							+ ((MapListEntry)maps.get(mapNum)).filename, FormBase.OKB)).execute();
 				}
 			}
@@ -2410,8 +2410,8 @@
 				this.close(FormBase.IDCANCEL);
 			}
 		}catch (NegativeArraySizeException e) {
-			// happens in substring when a dividing line selected 
-		} 
+			// happens in substring when a dividing line selected
+		}
 	}
 
 	public void onEvent(Event ev){
@@ -2442,7 +2442,7 @@
 	Graphics draw;
 	private MapInfoObject map=null;
 
-	Color moveDirColor = new Color(255,0,0); // RED 
+	Color moveDirColor = new Color(255,0,0); // RED
 	final static Color sunDirColor = new Color(255,255,0); // Yellow
 	//final static Color GREEN = new Color(0,255,0);
 	final static Color gotoDirColor = new Color(0,0,128); // dark blue
@@ -2451,10 +2451,10 @@
 	Point[] gotoDirArrow = null;
 	Point[] moveDirArrow = null;
 	Point[] northDirArrow = null;
-	
+
 	int imageSize = Global.getPref().fontSize * 8;
 	int arrowThickness = imageSize / 28;
-	
+
 	/**
 	 * @param gd goto direction
 	 * @param sd sun direction
@@ -2500,7 +2500,7 @@
 		drawArrows(g);
 		return;
 /*		if (!dirsChanged) {
-			g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height); // the transparency with a transparent color doesn't work in ewe-vm for pocketpc, it works in java-vm, ewe-vm on pocketpc2003 
+			g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height); // the transparency with a transparent color doesn't work in ewe-vm for pocketpc, it works in java-vm, ewe-vm on pocketpc2003
 			return;
 		}
 		dirsChanged = false;
@@ -2509,7 +2509,7 @@
 		draw.fillRect(0, 0, location.width, location.height);
 		minY = Integer.MAX_VALUE;
 		drawArrows(draw);
-		draw.drawImage(image,mask,Color.DarkBlue,0,0,location.width,location.height); // this trick (note: wrong transparentColor) forces a redraw 
+		draw.drawImage(image,mask,Color.DarkBlue,0,0,location.width,location.height); // this trick (note: wrong transparentColor) forces a redraw
 		g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height);
 */	}
 
@@ -2531,10 +2531,10 @@
 				if (northDirArrow == null) northDirArrow = new Point[2];
 				makeArrow(northDirArrow, 0, 1.0f); // north direction
 			} else northDirArrow = null;
-			
+
 			//select moveDirColor according to difference to gotoDir
 			moveDirColor = new Color(255,0,0); // red
-			
+
 			if (moveDirArrow != null && gotoDirArrow != null)
 			{
 				float diff = java.lang.Math.abs(moveDir - gotoDir);
@@ -2546,7 +2546,7 @@
 				{
 					diff = 360.0f - diff;
 				}
-				
+
 				if (diff <= 5.0)
 				{
 					moveDirColor = new Color(0,192,0);// darkgreen
@@ -2563,7 +2563,7 @@
 		}
 
 	/**
-	 * make (calculate) Pixel array for a single arrow 
+	 * make (calculate) Pixel array for a single arrow
 	 * @param g handle for drawing
 	 * @param angle angle of arrow
 	 * @param col color of arrow
@@ -2590,7 +2590,7 @@
 		drawArrow(g, moveDirArrow, moveDirColor);
 		drawArrow(g, sunDirArrow, sunDirColor);
 	}
-	
+
 	public void drawArrow(Graphics g, Point[] arrow, Color col) {
 		if (arrow == null) return;
 		g.setPen(new Pen(col,Pen.SOLID,arrowThickness));



From pfeffer at mail.berlios.de  Mon Sep 28 01:09:31 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 28 Sep 2009 01:09:31 +0200
Subject: [Cachewolf-svn] r2214 - trunk/src/CacheWolf/navi
Message-ID: <200909272309.n8RN9Vs5020588@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-28 01:09:20 +0200 (Mon, 28 Sep 2009)
New Revision: 2214

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
Log:
Maps: GetBestMap should work now in the situation described here: http://www.geoclub.de/viewtopic.php?f=40&t=38364

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-27 13:12:55 UTC (rev 2213)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-27 23:09:20 UTC (rev 2214)
@@ -242,9 +242,11 @@
 	private int quickfind(String searchfor, int llimitorig, int ulimit) {
 		int llimit = llimitorig;
 		int test;
-		int comp;
-		String cmp;
+		String cmp = ((MapListEntry)this.get(llimit)).sortEntryBBox; 
+		int comp = cmp.compareTo(searchfor);
 //		int testskw = 0;
+		if ( cmp.compareTo(searchfor.substring(0, cmp.length())) > 0 ||
+			 ((MapListEntry)this.get(ulimit)).sortEntryBBox.compareTo(searchfor.substring(0, cmp.length())) < 0)
 		if ( ((MapListEntry)this.get(llimit)).getSortEntryBBox().compareTo(searchfor) > 0 ||
 			 ((MapListEntry)this.get(ulimit)).getSortEntryBBox().compareTo(searchfor) < 0)
 			return llimit; // if searchfor is not in the range, return llimit (llimit because getBestMap counts downward, so returning llimit will cause it to do only 1 test
@@ -264,6 +266,7 @@
 				}
 			}
 		}
+		if ( comp < 0) llimit = ulimit;
 	     // if the found mapListEntry doesn't contain the searchfor, then there is no map containing it.
 		if (!searchfor.startsWith(((MapListEntry)this.get(llimit)).getSortEntryBBox())) llimit = llimitorig;
 		// Vm.debug("quickfind: testskw: " + testskw + ", searched for: " + searchfor);
@@ -511,9 +514,9 @@
 }
 
 class MapListEntry /*implements Comparable */ {
-	private String sortEntryBBox;
+	public String sortEntryBBox;
 	//String sortEntry;
-	private String filename;
+	public String filename;
 	String path;
 	MapInfoObject map;
 	static int rename = 0;



From pfeffer at mail.berlios.de  Mon Sep 28 18:21:39 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 28 Sep 2009 18:21:39 +0200
Subject: [Cachewolf-svn] r2215 - trunk/src/CacheWolf
Message-ID: <200909281621.n8SGLdAn001176@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-28 18:21:38 +0200 (Mon, 28 Sep 2009)
New Revision: 2215

Modified:
   trunk/src/CacheWolf/Matrix.java
Log:
MovingMap, MapImort: avoid unnecessary object creation

Modified: trunk/src/CacheWolf/Matrix.java
===================================================================
--- trunk/src/CacheWolf/Matrix.java	2009-09-27 23:09:20 UTC (rev 2214)
+++ trunk/src/CacheWolf/Matrix.java	2009-09-28 16:21:38 UTC (rev 2215)
@@ -30,10 +30,7 @@
 				m[i][j] = calculateRowColumnProduct(matrix,i,srcMatrix.matrix,j);
 			}
 		
-		matrix = new double[m.length][m[0].length];
-		for (int i = 0; i < m.length; i++)
-			for (int j = 0; j < m[i].length; j++)
-				matrix[i][j] = m[i][j];
+		matrix = m;
 	}
 	
 	/**



From pfeffer at mail.berlios.de  Tue Sep 29 19:13:51 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 29 Sep 2009 19:13:51 +0200
Subject: [Cachewolf-svn] r2216 - trunk/src/CacheWolf/navi
Message-ID: <200909291713.n8THDpQZ017342@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-29 19:13:47 +0200 (Tue, 29 Sep 2009)
New Revision: 2216

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: quik find best map: big fixed, see http://www.geoclub.de/viewtopic.php?f=40&t=38364

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-28 16:21:38 UTC (rev 2215)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-29 17:13:47 UTC (rev 2216)
@@ -14,7 +14,6 @@
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
 import ewe.util.Comparer;
-import ewe.util.SubString;
 import ewe.util.Vector;
 import ewe.fx.*;
 /**
@@ -24,7 +23,7 @@
  * start offset for language file: 4700
  *
  */
-public class MapsList extends Vector {
+public final class MapsList extends Vector {
 	public static float scaleTolerance = 1.15f; // absolute deviations from this factor are seen to have the same scale
 
 	/**
@@ -68,7 +67,7 @@
 					if (dirs.get(j).equals(".")) // the notation dir/./filename doesn't work on all platforms anyhow
 						tempMIO = new MapListEntry(mapsPath+"/", rawFileName);
 					else tempMIO = new MapListEntry(mapsPath+"/"+dirs.get(j)+"/", rawFileName);
-					if (tempMIO.getSortEntryBBox() != null) add(tempMIO);
+					if (tempMIO.sortEntryBBox != null) add(tempMIO);
 					//ewe.sys.Vm.debug(tempMIO.getEasyFindString() + tempMIO.mapName);
 				}catch(Exception ex){ // TODO exception ist, glaub ich evtl ?berfl?ssig
 					if (f == null) (f=new MessageBox(MyLocale.getMsg(144, "Warning"), MyLocale.getMsg(4700, "Ignoring error while \n reading calibration file \n")+ex.toString(), FormBase.OKB)).exec();
@@ -118,7 +117,7 @@
 		boolean showprogress = false;
 		String cmp = "FF1"+Area.getEasyFindString(ll, MAXDIGITS_IN_FF);
 		int guess = -1;
-		int foundkw = -1;
+//		int foundkw = -1;
 		MapListEntry ml;
 		MapInfoObject mi;
 		MapInfoObject bestMap = null; // = (MapInfoObject)get(0);
@@ -146,7 +145,7 @@
 				}
 				ml = (MapListEntry)get(i);
 				try {
-					if (!Area.containsRoughly(ml.getSortEntryBBox(), cmp)) break; // TODO if no map available
+					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) break; // TODO if no map available
 					else { mi = ml.getMap(); /* testkw++; */}
 				} catch (IOException ex) {continue; } // could not read .wfl-file
 				better = false;
@@ -212,8 +211,8 @@
 				new Comparer()
 				{
 					public int compare(Object o1, Object o2){
-						String s1 = ((MapListEntry)o1).getSortEntryBBox();
-						String s2 = ((MapListEntry)o2).getSortEntryBBox();
+						String s1 = ((MapListEntry)o1).sortEntryBBox;
+						String s2 = ((MapListEntry)o2).sortEntryBBox;
 						int ret = s1.length() - s2.length(); // sort shorter sortEntryBBox at the beginning
 						if (ret == 0) ret = s1.compareTo(s2);
 						return ret;
@@ -224,7 +223,7 @@
 		int numdigits = 0;
 		int s = size(); // avoid calling size() for each MaplistEntry (could be some thousand times)
 		for (int i = 0; i < s; i++) {
-			if ( ((MapListEntry)get(i)).getSortEntryBBox().length() > numdigits) {
+			if ( ((MapListEntry)get(i)).sortEntryBBox.length() > numdigits) {
 				numDigitsStartIndex[digits_index] = i;
 				digits_index++;
 				numdigits = ((MapListEntry)get(i)).getSortEntryBBox().length();
@@ -235,26 +234,26 @@
 	}
 
 	/**
-	 *
-	 * @param searchfor String starting with FFE1, it should be longer than any sortEntryBoxString in the list
-	 * @return the highest index which matches the searchfor-String. Look downward from there to find the best map, llimit if there is no match
+	 * @param llimitorig lower limit to start the search from
+	 * @param ulimit upper limit to stop the search. llimit and ulimit must be set in a way that
+	 * the sortEntryBBox of each entry betwenn the limits have the same length
+	 * @param searchfor String starting with FF1, it should be longer than any sortEntryBoxString in the list
+	 * @return the highest index which matches the searchfor-String. Look downward from there to find the best map, returns llimit if there is no match
 	 */
 	private int quickfind(String searchfor, int llimitorig, int ulimit) {
 		int llimit = llimitorig;
 		int test;
-		String cmp = ((MapListEntry)this.get(llimit)).sortEntryBBox; 
-		int comp = cmp.compareTo(searchfor);
+		String cmp = ((MapListEntry)this.get(llimit)).sortEntryBBox;
+		String sshort = searchfor.substring(0, cmp.length());
+		int comp;
 //		int testskw = 0;
-		if ( cmp.compareTo(searchfor.substring(0, cmp.length())) > 0 ||
-			 ((MapListEntry)this.get(ulimit)).sortEntryBBox.compareTo(searchfor.substring(0, cmp.length())) < 0)
-		if ( ((MapListEntry)this.get(llimit)).getSortEntryBBox().compareTo(searchfor) > 0 ||
-			 ((MapListEntry)this.get(ulimit)).getSortEntryBBox().compareTo(searchfor) < 0)
+		if ( cmp.compareTo(sshort) > 0 ||
+			 ((MapListEntry)this.get(ulimit)).sortEntryBBox.compareTo(sshort) < 0)
 			return llimit; // if searchfor is not in the range, return llimit (llimit because getBestMap counts downward, so returning llimit will cause it to do only 1 test
 		while (ulimit - llimit > 1) {
 	//		testskw++;
 			test = (ulimit + llimit) / 2;
-			cmp = ((MapListEntry)this.get(test)).getSortEntryBBox();
-
+			cmp = ((MapListEntry)this.get(test)).sortEntryBBox;
 			comp = cmp.compareTo(searchfor);
 			if ( comp > 0 ) { // test > searchfor
 				ulimit = test;
@@ -265,10 +264,14 @@
 					ulimit = test;
 				}
 			}
-		}
-		if ( comp < 0) llimit = ulimit;
-	     // if the found mapListEntry doesn't contain the searchfor, then there is no map containing it.
-		if (!searchfor.startsWith(((MapListEntry)this.get(llimit)).getSortEntryBBox())) llimit = llimitorig;
+		} // searchfor is between llimit and ulimit OR is at ulimit or higher OR at llimit or lower 
+		// we want to return the highest index of the map which starts with searchfor 
+		comp = ((MapListEntry)this.get(ulimit)).sortEntryBBox.compareTo(searchfor);
+		if ( (comp <= 0) && searchfor.startsWith(((MapListEntry)this.get(ulimit)).sortEntryBBox) ) 
+			llimit = ulimit; // search for is on ulimit or higher
+	     
+		if (!searchfor.startsWith(((MapListEntry)this.get(llimit)).sortEntryBBox)) 
+			llimit = llimitorig; // if the found mapListEntry doesn't contain the searchfor, then there is no map containing it.
 		// Vm.debug("quickfind: testskw: " + testskw + ", searched for: " + searchfor);
 		return llimit;
 	}
@@ -304,7 +307,7 @@
 			}
 			ml = (MapListEntry)get(i);
 			try {
-				if (!Area.containsRoughly(ml.getSortEntryBBox(), cmp)) continue; // TODO if no map available
+				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
 				else { mi = ml.getMap();}
 			} catch (IOException ex) {continue; } // could not read .wfl-file
 			better = false;
@@ -374,7 +377,7 @@
 			better = false;
 			ml = (MapListEntry)get(i);
 			try {
-				if (!Area.containsRoughly(ml.getSortEntryBBox(), cmp)) continue; // TODO if no map available
+				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
 				else { mi = ml.getMap();}
 			} catch (IOException ex) {continue; } // could not read .wfl-file
 			if (mi.fileNameWFL == "") continue; // exclude "maps" without image // TODO make this a boolean in MapInfoObject
@@ -513,12 +516,13 @@
 	
 }
 
-class MapListEntry /*implements Comparable */ {
+final class MapListEntry /*implements Comparable */ {
 	public String sortEntryBBox;
 	//String sortEntry;
 	public String filename;
 	String path;
 	MapInfoObject map;
+	
 	static int rename = 0;
 	static int renameCounter = 0;
 	static InfoBox renameProgressInfoB = null;
@@ -539,7 +543,7 @@
 		try {
 			if (filenamei.startsWith("FF1")) sortEntryBBox = filenamei.substring(0, filenamei.indexOf("E-"));
 		} catch (IndexOutOfBoundsException ex) {
-			Global.getPref().log("Ignored Exception", ex, true);
+			// Global.getPref().log("Ignored Exception", ex, true);
 		}
 		if (sortEntryBBox == null ) { //|| sortEntryScaleCenterPx.length() < 16) {
 			try {
@@ -611,13 +615,5 @@
 		if (other == null) return 1;
 		return this.sortEntryBBox.compareTo(((MapListEntry)other).sortEntryBBox);
 	} */
-
-	public String getSortEntryBBox() {
-		return sortEntryBBox;
-	}
-
-	public String getFilename() {
-		return filename;
-	}
 }
 

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-28 16:21:38 UTC (rev 2215)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-29 17:13:47 UTC (rev 2216)
@@ -23,7 +23,7 @@
 /**
  *	Class to handle a moving map.
  */
-public class MovingMap extends Form {
+public final class MovingMap extends Form {
 	public final static int gotFix = 4; //green
 	public final static int lostFix = 3; //yellow
 	public final static int noGPSData = 2; // red



From pfeffer at mail.berlios.de  Tue Sep 29 19:15:13 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 29 Sep 2009 19:15:13 +0200
Subject: [Cachewolf-svn] r2217 - trunk/src/CacheWolf/navi
Message-ID: <200909291715.n8THFDHb019336@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-29 19:15:09 +0200 (Tue, 29 Sep 2009)
New Revision: 2217

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
Log:
missed one line in the last commit

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-29 17:13:47 UTC (rev 2216)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-29 17:15:09 UTC (rev 2217)
@@ -226,7 +226,7 @@
 			if ( ((MapListEntry)get(i)).sortEntryBBox.length() > numdigits) {
 				numDigitsStartIndex[digits_index] = i;
 				digits_index++;
-				numdigits = ((MapListEntry)get(i)).getSortEntryBBox().length();
+				numdigits = ((MapListEntry)get(i)).sortEntryBBox.length();
 			}
 		}
 		numDigitsStartIndex[digits_index] = s;



From pfeffer at mail.berlios.de  Tue Sep 29 22:59:56 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 29 Sep 2009 22:59:56 +0200
Subject: [Cachewolf-svn] r2218 - trunk/src/CacheWolf
Message-ID: <200909292059.n8TKxuow020113@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-29 22:59:54 +0200 (Tue, 29 Sep 2009)
New Revision: 2218

Modified:
   trunk/src/CacheWolf/Matrix.java
Log:
make the class final --> that should be faster and using jip, Matrix.Multiply is one mayor bottelneck for the moving map

Modified: trunk/src/CacheWolf/Matrix.java
===================================================================
--- trunk/src/CacheWolf/Matrix.java	2009-09-29 17:15:09 UTC (rev 2217)
+++ trunk/src/CacheWolf/Matrix.java	2009-09-29 20:59:54 UTC (rev 2218)
@@ -2,7 +2,7 @@
 
 import ewe.sys.*;
 
-public class Matrix{
+public final class Matrix{
 	int iDF = 0;
 	
 	public double matrix[][] = new double[0][0];



From pfeffer at mail.berlios.de  Wed Sep 30 02:30:10 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Sep 2009 02:30:10 +0200
Subject: [Cachewolf-svn] r2219 - trunk/src/CacheWolf/navi
Message-ID: <200909300030.n8U0UATh017660@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-30 02:30:06 +0200 (Wed, 30 Sep 2009)
New Revision: 2219

Modified:
   trunk/src/CacheWolf/navi/Area.java
Log:
MovingMap: Bug fixed: Area.isOverlapping() didn't consider one special constellation. Hopefully finally the bug described here http://www.geoclub.de/viewtopic.php?f=40&t=38364 is fixed by this patch.

Modified: trunk/src/CacheWolf/navi/Area.java
===================================================================
--- trunk/src/CacheWolf/navi/Area.java	2009-09-29 20:59:54 UTC (rev 2218)
+++ trunk/src/CacheWolf/navi/Area.java	2009-09-30 00:30:06 UTC (rev 2219)
@@ -53,10 +53,25 @@
 				 // in case this is completly within a, the above tests will give false, so testing the otherway around
 				 || a.isInBound(this.topleft) || a.isInBound(this.buttomright)
 				 || a.isInBound(this.buttomright.latDec, this.topleft.lonDec) // buttom left
-				 || a.isInBound(this.topleft.latDec, this.buttomright.lonDec)) // top right
+				 || a.isInBound(this.topleft.latDec, this.buttomright.lonDec) // top right
+			 // no point is inbound, but the areas are crossing
+			 	 || crossingVertically(a) // TODO maybe these two tests are making all the previous ones redundant
+			 	 || a.crossingVertically(this)
+			 )
 			 return true;
 		 else return false;
 	 }
+	 
+	 // test if this is a vertical stripe overlapping a
+	 private boolean crossingVertically(Area a) {
+		 return ( 
+	 			   		(a.topleft.lonDec <= this.topleft.lonDec     && this.topleft.lonDec     <= a.buttomright.lonDec)
+		 			 || (a.topleft.lonDec <= this.buttomright.lonDec && this.buttomright.lonDec <= a.buttomright.lonDec)
+		 			 ) && (
+		 					   (this.topleft.latDec >= a.topleft.latDec     && a.topleft.latDec     >= this.buttomright.latDec)
+		 				    || (this.topleft.latDec >= a.buttomright.latDec && a.buttomright.latDec >= this.buttomright.latDec)
+		 				   );
+	 }
 
 	 public boolean equals(Area a) {
 		 if(java.lang.Math.abs(topleft.latDec - a.topleft.latDec) < edgeTolerance 



From pfeffer at mail.berlios.de  Wed Sep 30 12:18:37 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Sep 2009 12:18:37 +0200
Subject: [Cachewolf-svn] r2220 - trunk/src/CacheWolf/navi
Message-ID: <200909301018.n8UAIbVI001935@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-30 12:18:36 +0200 (Wed, 30 Sep 2009)
New Revision: 2220

Modified:
   trunk/src/CacheWolf/navi/Area.java
Log:
Area: isOverlapping: using a much more elegant way, described by Engywuck, see http://www.geoclub.de/viewtopic.php?f=40&t=38364&p=607033#p607033

Modified: trunk/src/CacheWolf/navi/Area.java
===================================================================
--- trunk/src/CacheWolf/navi/Area.java	2009-09-30 00:30:06 UTC (rev 2219)
+++ trunk/src/CacheWolf/navi/Area.java	2009-09-30 10:18:36 UTC (rev 2220)
@@ -28,7 +28,6 @@
 				 && buttomright.latDec <= p.latDec && buttomright.lonDec >= p.lonDec) return true;
 		 else return false;
 	 }
-	 //if(affine[4] >= lati && lati >= lowlat && affine[5] <= loni && loni <= lowlon) isInBound = true;
 		
 	 public boolean isInBound(double lat, double lon) {
 		 if (topleft.latDec >= lat && topleft.lonDec <= lon
@@ -47,32 +46,13 @@
 	 
 	 
 	 public boolean isOverlapping(Area a) {
-		 if (       isInBound(a.topleft) || isInBound(a.buttomright) 
-				 || isInBound(a.buttomright.latDec, a.topleft.lonDec) // buttom left
-				 || isInBound(a.topleft.latDec, a.buttomright.lonDec) // top right
-				 // in case this is completly within a, the above tests will give false, so testing the otherway around
-				 || a.isInBound(this.topleft) || a.isInBound(this.buttomright)
-				 || a.isInBound(this.buttomright.latDec, this.topleft.lonDec) // buttom left
-				 || a.isInBound(this.topleft.latDec, this.buttomright.lonDec) // top right
-			 // no point is inbound, but the areas are crossing
-			 	 || crossingVertically(a) // TODO maybe these two tests are making all the previous ones redundant
-			 	 || a.crossingVertically(this)
-			 )
-			 return true;
-		 else return false;
+		 return ! ( // test if not overlapping and invert the result, see http://www.geoclub.de/viewtopic.php?f=40&t=38364&p=607033#p607033
+				    this.buttomright.latDec > a.topleft.latDec
+				 || this.topleft.latDec     < a.buttomright.latDec
+				 || this.buttomright.lonDec < a.topleft.lonDec
+				 || this.topleft.lonDec     > a.buttomright.lonDec);
 	 }
 	 
-	 // test if this is a vertical stripe overlapping a
-	 private boolean crossingVertically(Area a) {
-		 return ( 
-	 			   		(a.topleft.lonDec <= this.topleft.lonDec     && this.topleft.lonDec     <= a.buttomright.lonDec)
-		 			 || (a.topleft.lonDec <= this.buttomright.lonDec && this.buttomright.lonDec <= a.buttomright.lonDec)
-		 			 ) && (
-		 					   (this.topleft.latDec >= a.topleft.latDec     && a.topleft.latDec     >= this.buttomright.latDec)
-		 				    || (this.topleft.latDec >= a.buttomright.latDec && a.buttomright.latDec >= this.buttomright.latDec)
-		 				   );
-	 }
-
 	 public boolean equals(Area a) {
 		 if(java.lang.Math.abs(topleft.latDec - a.topleft.latDec) < edgeTolerance 
 				 && java.lang.Math.abs(topleft.lonDec - a.topleft.lonDec) < edgeTolerance



From pfeffer at mail.berlios.de  Wed Sep 30 12:30:17 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Sep 2009 12:30:17 +0200
Subject: [Cachewolf-svn] r2221 - trunk/src/CacheWolf/navi
Message-ID: <200909301030.n8UAUH08003459@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-30 12:30:15 +0200 (Wed, 30 Sep 2009)
New Revision: 2221

Modified:
   trunk/src/CacheWolf/navi/Area.java
Log:
Area: unused code commented out
Area: declared as much as final als possible for performance reasons. If needed, the final declaration of individual methods can be reverted

Modified: trunk/src/CacheWolf/navi/Area.java
===================================================================
--- trunk/src/CacheWolf/navi/Area.java	2009-09-30 10:18:36 UTC (rev 2220)
+++ trunk/src/CacheWolf/navi/Area.java	2009-09-30 10:30:15 UTC (rev 2221)
@@ -3,15 +3,16 @@
 import CacheWolf.CWPoint;
 
 public class Area {
+	/* not used
 	 public final static int NOT_ON_EDGE = -1;
 	 public final static int AT_TOP_EDGE = 1;
 	 public final static int AT_RIGHT_EDGE = 2;
 	 public final static int AT_BUTTOM_EDGE = 3;
 	 public final static int AT_LEFT_EDGE = 4;
 	 public static double edgeTolerance = 3 * 360/40000000; // approx 3m will be seen as the same
-
-	 CWPoint topleft;
-	 CWPoint buttomright;
+*/
+	 public CWPoint topleft;
+	 public CWPoint buttomright;
 	 
 	 public Area() {
 		 topleft = new CWPoint();
@@ -23,13 +24,13 @@
 		 buttomright = new CWPoint(br);
 	 }
 
-	 public boolean isInBound(TrackPoint p) {
+	 public final boolean isInBound(TrackPoint p) {
 		 if (topleft.latDec >= p.latDec && topleft.lonDec <= p.lonDec 
 				 && buttomright.latDec <= p.latDec && buttomright.lonDec >= p.lonDec) return true;
 		 else return false;
 	 }
 		
-	 public boolean isInBound(double lat, double lon) {
+	 public final boolean isInBound(double lat, double lon) {
 		 if (topleft.latDec >= lat && topleft.lonDec <= lon
 				 && buttomright.latDec <= lat && buttomright.lonDec >= lon) return true;
 		 else return false;
@@ -40,12 +41,12 @@
 	 * @param a
 	 * @return
 	 */
-	 public boolean isInBound(Area a) {
+	 public final boolean isInBound(Area a) {
 		 return (isInBound(a.topleft) && isInBound(a.buttomright));
 	 }
 	 
 	 
-	 public boolean isOverlapping(Area a) {
+	 public final boolean isOverlapping(Area a) {
 		 return ! ( // test if not overlapping and invert the result, see http://www.geoclub.de/viewtopic.php?f=40&t=38364&p=607033#p607033
 				    this.buttomright.latDec > a.topleft.latDec
 				 || this.topleft.latDec     < a.buttomright.latDec
@@ -53,7 +54,8 @@
 				 || this.topleft.lonDec     > a.buttomright.lonDec);
 	 }
 	 
-	 public boolean equals(Area a) {
+	 /* not used at the moment
+	  public boolean equals(Area a) {
 		 if(java.lang.Math.abs(topleft.latDec - a.topleft.latDec) < edgeTolerance 
 				 && java.lang.Math.abs(topleft.lonDec - a.topleft.lonDec) < edgeTolerance
 				 && java.lang.Math.abs(buttomright.latDec - a.buttomright.latDec) < edgeTolerance
@@ -61,7 +63,9 @@
 			 return true;
 		 else return false;
 	 }
+	 */
 	 
+	 /* not used at the moment
 	 public int getEdge(CWPoint tl, CWPoint br) {
 		 if (java.lang.Math.abs(topleft.latDec - br.latDec) < edgeTolerance 
 				 && java.lang.Math.abs(topleft.lonDec - tl.lonDec) < edgeTolerance 
@@ -81,12 +85,13 @@
 				 return AT_LEFT_EDGE;
 			 return NOT_ON_EDGE;
 	 }
-	 
+	 */
+	  
 	 /**
 	  * get an easy find string for this area
 	  * @return
 	  */
-	 public String getEasyFindString() {
+	 public final String getEasyFindString() {
 		 String ul = getEasyFindString(topleft, 30);
 		 String br = getEasyFindString(buttomright, 30);
 		 int i;
@@ -102,7 +107,7 @@
 	  * @param prec number of digits to return, min 2, max: 30
 	  * @return
 	  */
-	 public static String getEasyFindString(CWPoint p, int prec) {
+	 public static final String getEasyFindString(CWPoint p, int prec) {
 		 double longinrange = p.lonDec;
 		 if (longinrange > 180) longinrange -= 180;
 		 int lat = (int) (((p.latDec+90d)/180d) * (1 << (prec)));
@@ -119,7 +124,7 @@
 		 return ret;
 	 }
 	 
-	 static public boolean containsRoughly(String boundingbox, String q) {
+	 public static final boolean containsRoughly(String boundingbox, String q) {
 		 if (boundingbox.length() <= q.length() ) return q.startsWith(boundingbox);
 		 else return boundingbox.startsWith(q);
 	 }
@@ -128,7 +133,7 @@
 		 return topleft.toString() + ", " + buttomright.toString();
 	 }
 	 
-	 public CWPoint getCenter() {
+	 public final CWPoint getCenter() {
 		 return new CWPoint((topleft.latDec + buttomright.latDec)/2, (topleft.lonDec + buttomright.lonDec)/2);
 	 }
 }



From pfeffer at mail.berlios.de  Wed Sep 30 14:03:59 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Sep 2009 14:03:59 +0200
Subject: [Cachewolf-svn] r2222 - trunk/src/CacheWolf/navi
Message-ID: <200909301203.n8UC3xtL030467@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-30 14:03:57 +0200 (Wed, 30 Sep 2009)
New Revision: 2222

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: Calculate white rectangles only if preferences say that they should be filled

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 10:30:15 UTC (rev 2221)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 12:03:57 UTC (rev 2222)
@@ -997,57 +997,57 @@
 					|| (java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
 				// more then 1/10 of screen moved since last time we tried to
 				// find a better map
-
-				// Clean up any additional images, tiles will removed and any
-				// other item be added again later
-				Vector icons = new Vector();
-				for (Iterator i = mmp.images.iterator(); i.hasNext();) {
-					AniImage im = (AniImage) i.next();
-					if ((im instanceof MapImage)
-							&& (!((im instanceof MapSymbol)
-									|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
-						i.remove();
-					} else {
-						icons.add(im);
-						i.remove();
+				Point mapPosx = getMapPositionOnScreen();
+				if (isFillWhiteArea()) {
+					// Clean up any additional images, tiles will removed and any
+					// other item be added again later
+					Vector icons = new Vector();
+					for (Iterator i = mmp.images.iterator(); i.hasNext();) {
+						AniImage im = (AniImage) i.next();
+						if ((im instanceof MapImage)
+								&& (!((im instanceof MapSymbol)
+										|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
+							i.remove();
+						} else {
+							icons.add(im);
+							i.remove();
+						}
 					}
-				}
-				// Mark all tiles as dirty
-				MovingMapCache.getCache().clearUsedFlags();
+					// Mark all tiles as dirty
+					MovingMapCache.getCache().clearUsedFlags();
 
-				Point mapPosx = getMapPositionOnScreen();
-				// Holds areas not filled by currentmap and/or used tiles
-				Vector rectangles = new Vector();
-				// calculate areas which will not drawn
-				Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
-				Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage
-						.getWidth(), mmp.mapImage.getHeight());
-				calculateRectangles(blackArea, whiteArea, rectangles);
-				// I've sometimes experienced an endless loop which might be
-				// caused by a bug in getBestMap. Therefore i will stop the loop
-				// after 30 runs
-				int count = 0;
-				while (isFillWhiteArea() && currentMap.zoomFactor == 1.0
-						&& !mapHidden && !rectangles.isEmpty() && count < 30) {
-					count++;
-					try {
-						updateTileForWhiteArea(rectangles);
-					} catch (ewe.sys.SystemResourceException sre) {
-						setFillWhiteArea(false);
-						(new MessageBox(
-								"Error",
-								"Not enough ressources to fill white ares, disabling this",
-								MessageBox.OKB)).execute();
+					// Holds areas not filled by currentmap and/or used tiles
+					Vector rectangles = new Vector();
+					// calculate areas which will not drawn
+					Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
+					Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage
+							.getWidth(), mmp.mapImage.getHeight());
+					calculateRectangles(blackArea, whiteArea, rectangles);
+					// I've sometimes experienced an endless loop which might be
+					// caused by a bug in getBestMap. Therefore i will stop the loop
+					// after 30 runs
+					int count = 0;
+					while (isFillWhiteArea() && currentMap.zoomFactor == 1.0
+							&& !mapHidden && !rectangles.isEmpty() && count < 30) {
+						count++;
+						try {
+							updateTileForWhiteArea(rectangles);
+						} catch (ewe.sys.SystemResourceException sre) {
+							setFillWhiteArea(false);
+							(new MessageBox(
+									"Error",
+									"Not enough ressources to fill white ares, disabling this",
+									MessageBox.OKB)).execute();
+						}
 					}
+					// Remove all tiles not needed from the cache to reduce memory
+					MovingMapCache.getCache().cleanCache();
+					// At Last redraw all icons on the map
+					for (Iterator i = icons.iterator(); i.hasNext();) {
+						AniImage im = (AniImage) i.next();
+						mmp.addImage(im);
+					}
 				}
-				// Remove all tiles not needed from the cache to reduce memory
-				MovingMapCache.getCache().cleanCache();
-				// At Last redraw all icons on the map
-				for (Iterator i = icons.iterator(); i.hasNext();) {
-					AniImage im = (AniImage) i.next();
-					mmp.addImage(im);
-				}
-
 				lastCompareX = mapPos.x;
 				lastCompareY = mapPos.y;
 				setBestMap(where, screenNotCompletlyCovered);



From pfeffer at mail.berlios.de  Wed Sep 30 14:05:10 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Sep 2009 14:05:10 +0200
Subject: [Cachewolf-svn] r2223 - in trunk/src/CacheWolf: . navi
Message-ID: <200909301205.n8UC59QU030640@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-30 14:05:08 +0200 (Wed, 30 Sep 2009)
New Revision: 2223

Modified:
   trunk/src/CacheWolf/Common.java
   trunk/src/CacheWolf/navi/MapsList.java
Log:
MapsList: use new/faster algorithm in getMapForArea too

Modified: trunk/src/CacheWolf/Common.java
===================================================================
--- trunk/src/CacheWolf/Common.java	2009-09-30 12:03:57 UTC (rev 2222)
+++ trunk/src/CacheWolf/Common.java	2009-09-30 12:05:08 UTC (rev 2223)
@@ -149,6 +149,17 @@
 		}
 		return sb.toString();
 	}
+	
+	/**
+	 * right pad with spaces
+	 * @param s
+	 * @param length
+	 * @return
+	 */
+	public static String rightPad(String s, int length) {
+		String p = "                                                          ";
+		return s + p.substring(s.length()+(p.length()-length));
+	}
 
 
 }

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-09-30 12:03:57 UTC (rev 2222)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-09-30 12:05:08 UTC (rev 2223)
@@ -285,55 +285,61 @@
 	 * if topleft is really topleft or if it is buttomright is not relevant.
 	 */
 
-	public MapInfoObject getMapForArea(CWPoint topleft, CWPoint bottomright){
+	public final MapInfoObject getMapForArea(CWPoint topleft, CWPoint bottomright){
 		long start = new Time().getTime();
 		InfoBox progressBox = null;
 		boolean showprogress = false;
 		MapListEntry ml;
 		MapInfoObject mi;
 		String cmp = "FF1"+(new Area(topleft, bottomright)).getEasyFindString();
+		String cmppadded = Common.rightPad(cmp, 30);
 		MapInfoObject fittingmap = null;
+		int guess;
 		boolean latNearer, lonNearer;
 		boolean better;
 		double minDistLat = 10000000000000000000000.0;
 		double minDistLon = 10000000000000000000000.0;
-		for (int i=size() -1; i>=0 ;i--) {
-			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
-				showprogress = true;
-				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
-				progressBox.exec();
-				progressBox.waitUntilPainted(100);
-				ewe.sys.Vm.showWait(true);
-			}
-			ml = (MapListEntry)get(i);
-			try {
-				if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
-				else { mi = ml.getMap();}
-			} catch (IOException ex) {continue; } // could not read .wfl-file
-			better = false;
-			if (mi.isInBound(topleft) && mi.isInBound(bottomright)) { // both points are inside the map
-				if (fittingmap == null || fittingmap.scale > mi.scale * scaleTolerance) {
-					better = true; // mi map has a better (lower) scale than the last knwon good map
-				} else {
-					if (scaleEquals(mi, fittingmap)) { // same scale as bestmap till now -> test if its center is nearer to the gps-point = topleft
-						latNearer = java.lang.Math.abs(topleft.latDec- mi.center.latDec)/mi.sizeKm < minDistLat ;
-						lonNearer = java.lang.Math.abs(topleft.lonDec - mi.center.lonDec)/mi.sizeKm < minDistLon;
-						if ( latNearer && lonNearer) better = true; // for faster processing: if lat and lon are nearer then the distancance doesn't need to be calculated
-						else {
-							if ( (latNearer || lonNearer )) {
-								if (mi.center.getDistanceRad(topleft) < fittingmap.center.getDistanceRad(topleft) ) better = true;
+		for (int digitlength = 0; digitlength < maxDigits; digitlength++) {
+			guess = quickfind(cmppadded, this.numDigitsStartIndex[digitlength], this.numDigitsStartIndex[digitlength+1]-1);
+			if ( ((MapListEntry)get(guess)).sortEntryBBox.length() > cmp.length() ) break; // if the sortEntryBBox indicates that it cannot contain both points, stop searching
+			for (int i=guess; i >= numDigitsStartIndex[digitlength] ;i--) {
+				if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
+					showprogress = true;
+					progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
+					progressBox.exec();
+					progressBox.waitUntilPainted(100);
+					ewe.sys.Vm.showWait(true);
+				}
+				ml = (MapListEntry)get(i);
+				try {
+					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
+					else { mi = ml.getMap();}
+				} catch (IOException ex) {continue; } // could not read .wfl-file
+				better = false;
+				if (mi.isInBound(topleft) && mi.isInBound(bottomright)) { // both points are inside the map
+					if (fittingmap == null || fittingmap.scale > mi.scale * scaleTolerance) {
+						better = true; // mi map has a better (lower) scale than the last knwon good map
+					} else {
+						if (scaleEquals(mi, fittingmap)) { // same scale as bestmap till now -> test if its center is nearer to the gps-point = topleft
+							latNearer = java.lang.Math.abs(topleft.latDec- mi.center.latDec)/mi.sizeKm < minDistLat ;
+							lonNearer = java.lang.Math.abs(topleft.lonDec - mi.center.lonDec)/mi.sizeKm < minDistLon;
+							if ( latNearer && lonNearer) better = true; // for faster processing: if lat and lon are nearer then the distancance doesn't need to be calculated
+							else {
+								if ( (latNearer || lonNearer )) {
+									if (mi.center.getDistanceRad(topleft) < fittingmap.center.getDistanceRad(topleft) ) better = true;
+								}
 							}
+
 						}
-
 					}
+					if (better) {
+						fittingmap = mi;
+						minDistLat = java.lang.Math.abs(topleft.latDec - mi.center.latDec);
+						minDistLon = java.lang.Math.abs(topleft.lonDec - mi.center.lonDec);
+					}
 				}
-				if (better) {
-					fittingmap = mi;
-					minDistLat = java.lang.Math.abs(topleft.latDec - mi.center.latDec);
-					minDistLon = java.lang.Math.abs(topleft.lonDec - mi.center.lonDec);
-				}
-			}
-		} // for
+			} // for i
+		} // for digitlength
 		if (progressBox != null) {
 			progressBox.close(0);
 			ewe.sys.Vm.showWait(false);



From pfeffer at mail.berlios.de  Wed Sep 30 15:23:12 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Sep 2009 15:23:12 +0200
Subject: [Cachewolf-svn] r2224 - trunk/src/CacheWolf/navi
Message-ID: <200909301323.n8UDNCB4009951@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-30 15:23:11 +0200 (Wed, 30 Sep 2009)
New Revision: 2224

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: FillWhiteArea: Bug fixed: if the map image doesn't overlap the screen, all space between the map image and the screen was tried to fill. Now only the screen will be filled

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 12:05:08 UTC (rev 2223)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 13:23:11 UTC (rev 2224)
@@ -985,10 +985,10 @@
 
 		if (!autoSelectMap) return;
 		Point mapPos = getMapPositionOnScreen();
-		boolean screenNotCompletlyCovered = mmp.mapImage == null
-				|| (mmp.mapImage != null && (mapPos.y > 0 || mapPos.x > 0
-						|| mapPos.y + mmp.mapImage.getHeight() < this.height || mapPos.x
-						+ mmp.mapImage.getWidth() < this.width));
+		boolean screenNotCompletlyCovered = (mmp.mapImage == null)
+				|| (mmp.mapImage != null && (
+				   mapPos.y > 0                                      || mapPos.x                           > 0
+				|| mapPos.y + mmp.mapImage.getHeight() < this.height || mapPos.x + mmp.mapImage.getWidth() < this.width));
 		//if screendimensions changed also force reload of map
 		forceMapLoad |= lastWidth != width || lastHeight != height;
 		if (forceMapLoad || wantMapTest || screenNotCompletlyCovered) { // if force || want || map doesn't cover the screen completly
@@ -997,7 +997,7 @@
 					|| (java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
 				// more then 1/10 of screen moved since last time we tried to
 				// find a better map
-				Point mapPosx = getMapPositionOnScreen();
+						
 				if (isFillWhiteArea()) {
 					// Clean up any additional images, tiles will removed and any
 					// other item be added again later
@@ -1019,10 +1019,16 @@
 					// Holds areas not filled by currentmap and/or used tiles
 					Vector rectangles = new Vector();
 					// calculate areas which will not drawn
-					Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
-					Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage
-							.getWidth(), mmp.mapImage.getHeight());
-					calculateRectangles(blackArea, whiteArea, rectangles);
+					Point mapPosx = getMapPositionOnScreen();
+					if ( screenNotCompletlyCovered && ( // screen not completely covered is only used, because it is already calculated
+							mapPosx.x > this.width || mapPosx.y > this.height // map doesn't overlap with the screen
+							|| mapPosx.x - mmp.mapImage.getWidth() < 0 || mapPosx.y - mmp.mapImage.getHeight() < 0) ) {
+						rectangles.add(new Rect(0,0, this.width, this.height)); // if the map is completely outside the screen, just fill the screen, nit all the space beteween the map and the screen
+					} else {
+						Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
+						Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
+						calculateRectangles(blackArea, whiteArea, rectangles);
+					}
 					// I've sometimes experienced an endless loop which might be
 					// caused by a bug in getBestMap. Therefore i will stop the loop
 					// after 30 runs



From pfeffer at mail.berlios.de  Wed Sep 30 15:53:43 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Sep 2009 15:53:43 +0200
Subject: [Cachewolf-svn] r2225 - trunk/src/CacheWolf/navi
Message-ID: <200909301353.n8UDrhYW014788@sheep.berlios.de>

Author: pfeffer
Date: 2009-09-30 15:53:42 +0200 (Wed, 30 Sep 2009)
New Revision: 2225

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: Bug fix for my previous commit: "Calculate white rectangles only if preferences say that they should be filled"

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 13:23:11 UTC (rev 2224)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 13:53:42 UTC (rev 2225)
@@ -97,6 +97,16 @@
 
 	public void setFillWhiteArea(boolean fillWhiteArea) {
 		pref.fillWhiteArea = fillWhiteArea;
+		if (!fillWhiteArea) { // remove tiles from panel
+			for (int i = mmp.images.size() -1; i >= 0; i--) {
+				AniImage im = (AniImage) mmp.images.get(i);
+				if ((im instanceof MapImage)
+						&& (!((im instanceof MapSymbol)
+								|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
+					mmp.images.remove(im);
+				} 
+			}
+		}
 	}
 
 	public MovingMap(Navigate nav, CacheDB cacheDB){
@@ -1022,7 +1032,7 @@
 					Point mapPosx = getMapPositionOnScreen();
 					if ( screenNotCompletlyCovered && ( // screen not completely covered is only used, because it is already calculated
 							mapPosx.x > this.width || mapPosx.y > this.height // map doesn't overlap with the screen
-							|| mapPosx.x - mmp.mapImage.getWidth() < 0 || mapPosx.y - mmp.mapImage.getHeight() < 0) ) {
+							|| mapPosx.x + mmp.mapImage.getWidth() < 0 || mapPosx.y + mmp.mapImage.getHeight() < 0) ) {
 						rectangles.add(new Rect(0,0, this.width, this.height)); // if the map is completely outside the screen, just fill the screen, nit all the space beteween the map and the screen
 					} else {
 						Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));



From araber95 at mail.berlios.de  Wed Sep 30 22:04:05 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 30 Sep 2009 22:04:05 +0200
Subject: [Cachewolf-svn] r2226 - in trunk/src/CacheWolf: . navi
Message-ID: <200909302004.n8UK44M4014239@sheep.berlios.de>

Author: araber95
Date: 2009-09-30 22:04:02 +0200 (Wed, 30 Sep 2009)
New Revision: 2226

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
path with special characters should work now; 

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-30 13:53:42 UTC (rev 2225)
+++ trunk/src/CacheWolf/Preferences.java	2009-09-30 20:04:02 UTC (rev 2226)
@@ -666,12 +666,11 @@
 	 * @return custom Maps Path, null if not set
 	 */
 	public String getCustomMapsPath() {
-	   String s = Global.getProfile().getRelativeCustomMapsPath();
-	   if (s.equals("")) {
+	   String rCMP = Global.getProfile().getRelativeCustomMapsPath();
+	   if (rCMP.equals("")) {
 		   return customMapsPath;
 		} else {
-			String t = absoluteBaseDir+"maps";
-			return t+s;
+			return absoluteBaseDir+"maps"+rCMP;
 		}
 	}
 	

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-30 13:53:42 UTC (rev 2225)
+++ trunk/src/CacheWolf/Profile.java	2009-09-30 20:04:02 UTC (rev 2226)
@@ -299,7 +299,7 @@
 					setDistOC(text.substring(start,text.indexOf("\"",start)));
 				} else if (text.indexOf("mapspath")>=0) {
 					int start=text.indexOf("relativeDir = \"")+15;
-					setRelativeCustomMapsPath(text.substring(start,text.indexOf("\"",start)));
+					setRelativeCustomMapsPath(SafeXML.cleanback(text.substring(start,text.indexOf("\"",start))).replace('\\','/'));
 				} else if (text.indexOf("<SPIDERGC")>=0) {
 					int start=text.indexOf("dist = \"")+8;
 					setDistGC(text.substring(start,text.indexOf("\"",start)));
@@ -790,10 +790,9 @@
 		return relativeCustomMapsPath;
 	}
 	
-	public void setRelativeCustomMapsPath(String relativeCustomMapsPath) {
-		relativeCustomMapsPath=SafeXML.clean(relativeCustomMapsPath.replace('\\','/'));
-		this.notifyUnsavedChanges(!relativeCustomMapsPath.equals(this.relativeCustomMapsPath));
-		this.relativeCustomMapsPath = relativeCustomMapsPath;
+	public void setRelativeCustomMapsPath(String rCMPath) {
+		this.notifyUnsavedChanges(!rCMPath.equals(this.relativeCustomMapsPath));
+		this.relativeCustomMapsPath = rCMPath;
 	}
 	/**
 	 * Returns the currently active FilterData object for the profile.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 13:53:42 UTC (rev 2225)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-09-30 20:04:02 UTC (rev 2226)
@@ -983,7 +983,7 @@
 		if (dontUpdatePos || loadingMapList) return; // avoid multi-threading problems
 		//Vm.debug("updatepos, lat: "+where.latDec+" lon: "+where.lonDec);
 		if (!mapsloaded || !this.maps.getMapsPath().equals(Global.getPref().getCustomMapsPath())) {
-			loadMaps(Global.getPref().getMapLoadPath(), where.latDec);
+			loadMaps(Global.getPref().getCustomMapsPath(), where.latDec);
 			lastCompareX = Integer.MAX_VALUE;
 			lastCompareY = Integer.MAX_VALUE;
 			autoSelectMap = true;
@@ -2169,7 +2169,7 @@
 							fc.setTitle(MyLocale.getMsg(4200,"Select map directory:"));
 							if(fc.execute() != FormBase.IDCANCEL){
 								Global.getPref().saveCustomMapsPath(fc.getChosen().toString());
-								mm.loadMaps(Global.getPref().getMapLoadPath(), mm.posCircle.where.latDec);
+								mm.loadMaps(Global.getPref().getCustomMapsPath(), mm.posCircle.where.latDec);
 								mm.forceMapLoad();
 							}
 						}



