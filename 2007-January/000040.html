<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r358 - trunk/src/CacheWolf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r358%20-%20trunk/src/CacheWolf&In-Reply-To=%3C200701071657.l07Gvee9031550%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000038.html">
   <LINK REL="Next"  HREF="000041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r358 - trunk/src/CacheWolf</H1>
    <B>salzkammergut at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r358%20-%20trunk/src/CacheWolf&In-Reply-To=%3C200701071657.l07Gvee9031550%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r358 - trunk/src/CacheWolf">salzkammergut at mail.berlios.de
       </A><BR>
    <I>Sun Jan  7 17:57:40 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000038.html">[Cachewolf-svn] r357 - trunk/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="000041.html">[Cachewolf-svn] [Feature #2203] Markierungen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40">[ date ]</a>
              <a href="thread.html#40">[ thread ]</a>
              <a href="subject.html#40">[ subject ]</a>
              <a href="author.html#40">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: salzkammergut
Date: 2007-01-07 17:57:37 +0100 (Sun, 07 Jan 2007)
New Revision: 358

Modified:
   trunk/src/CacheWolf/CacheWolf.java
   trunk/src/CacheWolf/LoadScreen.java
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/Spider.java
Log:
Klassen Spider und LoadScreen entfernt, da nicht in Verwendung.
(Derzeit nur durch Entfernen von allem Code - wie kann man diese Klassen und auch GeoToad loeschen)?

Modified: trunk/src/CacheWolf/CacheWolf.java
===================================================================
--- trunk/src/CacheWolf/CacheWolf.java	2007-01-07 16:43:22 UTC (rev 357)
+++ trunk/src/CacheWolf/CacheWolf.java	2007-01-07 16:57:37 UTC (rev 358)
@@ -242,15 +242,6 @@
 		//}
 		
 		if(args.length &gt; 0){
-			//Vm.debug(&quot;in args!!!!&quot;);
-			//Vm.sleep(500);
-			if(args[0].equals(&quot;spider&quot;)){
-				//Vm.debug(&quot;Starting cmd line mode&quot;);
-				//Vm.sleep(500);
-				// args are: spider distance profileName
-				Form mainF = new MainForm(args[0], args[1], args[2]);
-				mainF.execute();
-			}
 			if(args[0].equals(&quot;test&quot;)){
 				Test t=new Test(); 
 				t.testAll();

Modified: trunk/src/CacheWolf/LoadScreen.java
===================================================================
--- trunk/src/CacheWolf/LoadScreen.java	2007-01-07 16:43:22 UTC (rev 357)
+++ trunk/src/CacheWolf/LoadScreen.java	2007-01-07 16:57:37 UTC (rev 358)
@@ -1,176 +0,0 @@
-package CacheWolf;
-import ewe.ui.*;
-import ewe.ui.MessageBox;
-import ewe.sys.*;
-import ewe.util.*;
-import ewe.filechooser.*;
-import ewe.io.*;
-
-/**
-*	This class displays the screen offering the user the different options
-* 	to spider the caches. From this screen the spider is activated and starts
-*	working.
-*	Class ID = 900
-*/
-public class LoadScreen extends Form{
-/* skg20061225: Commented out - needs to be deleted as it is not referenced
- * The functionality seems to be taken over by SpiderGC
- * 
- 	
-	Locale l = Vm.getLocale();
-	LocalResource lr = l.getLocalResource(&quot;cachewolf.Languages&quot;,true);
-	Spider mySpidy;
-	mTextPad liste = new mTextPad();
-	mButton btList = new mButton((String)lr.get(900,&quot;List&quot;));
-	mButton btLoc = new mButton((String)lr.get(901,&quot;Loc&quot;));
-	mButton btNearest = new mButton((String)lr.get(902,&quot;Nearest&quot;));
-	mButton btCancel = new mButton((String)lr.get(903,&quot;Cancel&quot;));
-	mButton btMulti = new mButton((String)lr.get(904,&quot;Multi&quot;));
-	mButton btGPX = new mButton(&quot;GPX&quot;);
-
-	Vector cacheDB = new Vector();
-	Preferences myP = new Preferences();
-	MessageArea msgArea;
-	Handle spiderHandle;
-	Lock spiderLock = new Lock(); 
-	boolean spiderRunning = false;
-	
-	public LoadScreen(Vector DB, Preferences p){
-		cacheDB = DB;
-		myP = p;
-		this.setPreferredSize(200,200);
-		this.title = (String)lr.get(905,&quot;Load Caches&quot;);
-		this.addLast(new mLabel((String)lr.get(906,&quot;List of Caches:&quot;)),this.DONTSTRETCH, (this.DONTFILL|this.WEST));
-		this.addLast(liste, this.STRETCH, this.FILL);
-		CellPanel cp = new CellPanel();
-		cp.addNext(btList, this.HSTRETCH, this.FILL);
-		cp.addNext(btLoc, this.HSTRETCH, this.FILL);
-		cp.addNext(btNearest, this.HSTRETCH, this.FILL);
-		cp.addNext(btGPX, this.HSTRETCH, this.FILL);
-		cp.addLast(btMulti, this.HSTRETCH, this.FILL);
-		cp.addLast(msgArea = new MessageArea(&quot;&quot;), this.HSTRETCH, this.FILL|this.WEST);
-		cp.addLast(btCancel, this.HSTRETCH, this.FILL);
-		this.addLast(cp, this.HSTRETCH, this.FILL);
-	} // LoadScreen
-	
-	private void startSpiderRunning(){ 
-		 spiderLock.synchronize(); try{ 
-		   //Make sure it is not already running. 
-		   if (spiderRunning) return; 
-		   spiderRunning = true; 
-		   new mThread(){ 
-		    public void run(){ 
-		     //mySpidy = new Spider(cacheDB, myP, msgArea,   Spider.SPIDERLOC); 
-		     //mySpidy.setUp(data); 
-		     //spiderHandle = mySpidy.getHandle(); 
-		     mySpidy.run();  
-		     try{ 
-		     spiderHandle.waitUntilStopped(); 
-		     }catch(Exception e){ 
-		     }finally{ 
-		   spiderLock.synchronize(); 
-		   spiderRunning = false; 
-		   spiderLock.release(); 
-		   close(0); 
-		     }      
-		     } 
-		   }.start();    
-		 }finally{spiderLock.release();} 
-	} 
-
-	public void onEvent(Event ev){
-		if(ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED){
-			if(ev.target == btCancel){
-				if(spiderRunning == true){
-					//spiderHandle.stop(1);
-					Handle hdl = mySpidy.stopTask(1);
-					Vm.debug(&quot;Done? &quot; + mySpidy.shouldStop);
-					try{
-						hdl.waitUntilStopped();
-					}catch(Exception ex){}
-					//mySpidy.stopTask(0);
-				}
-				this.close(0);
-			}
-			if(ev.target == btLoc){
-				LOCReader lor = new LOCReader(myP.mydatadir);
-				Vector data = new Vector();
-				data = lor.doIt();
-				mySpidy = new Spider(cacheDB, myP,msgArea, Spider.SPIDERLOC);
-				mySpidy.setUp(data);
-				spiderHandle = mySpidy.getHandle();
-				mySpidy.run();
-				try{
-					spiderHandle.waitUntilStopped();
-				}catch(Exception e){}
-				this.close(0);
-			}
-			if(ev.target == btList){
-				Vector data = new Vector();
-				data = mString.split(liste.getText(), ',', data);
-				mySpidy = new Spider(cacheDB, myP, msgArea, Spider.SPIDERLOC);
-				mySpidy.setUp(data);
-				spiderHandle = mySpidy.getHandle();
-				mySpidy.run();
-				try{
-					spiderHandle.waitUntilStopped();
-				}catch(Exception e){}
-				this.close(0);
-			}
-			if(ev.target == btNearest){
-				if(myP.existCenter() == true){
-					String dist = new InputBox((String)lr.get(907,&quot;Max distance:&quot;)).input(&quot;50&quot;,10);
-					mySpidy = new Spider(cacheDB, myP, msgArea, Spider.SPIDERNEAREST);
-					mySpidy.setUp(dist);
-					spiderHandle = mySpidy.getHandle();
-					startSpiderRunning();
-				} else {
-					MessageBox mb = new MessageBox(&quot;Error!&quot;, &quot;Koordinates in preferences not set!&quot;, 1);
-					mb.execute();
-				}
-				//this.close(0);
-			}
-			if(ev.target == btMulti){
-				FileChooser fc = new FileChooser(FileChooser.OPEN, myP.mydatadir);
-				fc.setTitle((String)lr.get(908,&quot;Select waypoints file&quot;));
-				if(fc.execute() != fc.IDCANCEL){
-					String dist = new InputBox((String)lr.get(907,&quot;Max distance:&quot;)).input(&quot;1&quot;,10);
-					try{
-						FileReader in = new FileReader(fc.getChosenFile());
-						String text = new String();
-						Vector vct = new Vector();
-						text = in.readAll();
-						in.close();
-						if(!(text.substring(text.length()-2,text.length()-1).equals(&quot;;&quot;))){
-							text = text + &quot;;&quot;;
-						}
-						vct = mString.split(text, ';', vct);
-						mySpidy = new Spider(cacheDB, myP,msgArea, Spider.SPIDERMULTI);
-						mySpidy.setUp(vct, dist);
-						spiderHandle = mySpidy.getHandle();
-						mySpidy.run();
-						try{
-							spiderHandle.waitUntilStopped();
-						}catch(Exception e){}
-					}catch(Exception ex){
-						//Vm.debug(&quot;Error reading waypoint file&quot;);
-					}
-				} else {
-				}
-			this.close(0);
-			}
-			if(ev.target == btGPX){
-				FileChooser fc = new FileChooser(FileChooser.OPEN, myP.mydatadir);
-				fc.addMask(&quot;*.gpx&quot;);
-				fc.setTitle((String)lr.get(909,&quot;Select GPX file&quot;));
-				if(fc.execute() != fc.IDCANCEL){
-					//GPXImporter gpx = new GPXImporter(cacheDB, fc.getChosenFile().toString(),myP.mydatadir,msgArea);
-					//gpx.doIt();
-					//this.close(0);
-				}
-			}
-		}
-		super.onEvent(ev);
-	}
-*/
-}

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2007-01-07 16:43:22 UTC (rev 357)
+++ trunk/src/CacheWolf/MainForm.java	2007-01-07 16:57:37 UTC (rev 358)
@@ -76,21 +76,6 @@
 	}
 
 	
-	public MainForm(String what, String dist, String profileName){
-		try{
-			pref.readPrefFile();
-			addGuiFont();
-			pref.lastProfile=profileName;
-			pref.selectProfile(profile,Preferences.PROFILE_SELECTOR_FORCED_OFF,false);
-			profile.readIndex();
-			Spider mySpidy = new Spider(pref, profile,null, Spider.SPIDERNEAREST);
-			mySpidy.SpiderNearest(dist);
-			ewe.sys.Vm.exit(0);
-		} catch (Exception e){
-			//Vm.debug(e.toString());
-		}
-	}
-	
 	private void addGuiFont(){
 		Font defaultGuiFont = mApp.findFont(&quot;gui&quot;);
 		int sz = (pref.fontSize);

Modified: trunk/src/CacheWolf/Spider.java
===================================================================
--- trunk/src/CacheWolf/Spider.java	2007-01-07 16:43:22 UTC (rev 357)
+++ trunk/src/CacheWolf/Spider.java	2007-01-07 16:57:37 UTC (rev 358)
@@ -1,932 +0,0 @@
-package CacheWolf;
-import ewe.net.*;
-import ewe.io.*;
-import ewe.sys.*;
-import ewe.util.*;
-import ewe.ui.*;
-
-/**
-*	The class to spider:&lt;br&gt;
-*	a) the cache list&lt;br&gt;
-*	b) the cache details&lt;br&gt;&lt;br&gt;
-*	This class still needs thorough documentation&lt;br&gt;
-*	Class ID=800
-*/
-
-/**
-*	Spider Travelbugs:
-*	Das hier f&#252;r welche abgelegt sind (auf Cache Detailseite)
-/////////////////////
-*	&lt;span id=&quot;lnkTravelBugs&quot;&gt;&lt;tr&gt;&lt;td VALIGN=&quot;TOP&quot; ALIGN=&quot;LEFT&quot;&gt;&lt;img SRC=&quot;../images/wpttypes/21.gif&quot; WIDTH=&quot;22&quot; HEIGHT=&quot;30&quot;&gt;&lt;/td&gt;&lt;td VALIGN=&quot;TOP&quot; ALIGN=&quot;LEFT&quot; COLSPAN=&quot;2&quot;&gt;&lt;font face=&quot;Verdana&quot; size=&quot;2&quot;&gt;&lt;FONT SIZE=&quot;1&quot;&gt;Travel Bugs have been seen in this cache -&lt;/FONT&gt;&lt;br&gt;
-*&lt;A HREF=&quot;../track/details.aspx?guid=8e52e5d8-6922-40f4-9b09-5b521297468e&quot;&gt;BlackLog&lt;/A&gt;&lt;br&gt;
-*&lt;A HREF=&quot;../track/details.aspx?guid=bc5f6513-ad4c-41b1-b299-759cf4b78d84&quot;&gt;Ostrov Hotel&lt;/A&gt;&lt;br&gt;
-*&lt;A HREF=&quot;../track/details.aspx?guid=ec0a978e-3491-4315-8ab0-7e2c417b0d84&quot;&gt;TB - Alan Stewart &lt;/A&gt;
-*&lt;br&gt;&lt;A HREF=&quot;../track/details.aspx?guid=bdd919d9-73a1-47b7-8ba8-5f0584e7f33e&quot;&gt;Theodore the Traveling Toad&lt;/A&gt;
-*&lt;br&gt;&lt;A HREF=&quot;../track/details.aspx?guid=092d0214-a601-407e-84cb-cd514598106c&quot;&gt;Forgetful Jones - Denkedran Jost&lt;/A&gt;&lt;br&gt;
-*&lt;br&gt;&lt;FONT SIZE=1&gt;&lt;A HREF=&quot;../track/&quot;&gt;What is a Travel Bug?&lt;/A&gt;&lt;br&gt;&lt;a href=&quot;../track/search.aspx?wid=a4ff6781-84fa-466c-ba0f-028128e06a7a&quot;&gt;View Bug History&lt;/a&gt;&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/span&gt;
-/////////////////////
-*
-*	Bild von dem Bug:
-*       &lt;img id=&quot;BugDetail_BugImage&quot; src=&quot;<A HREF="http://img.groundspeak.com/track/display/35c891d1-b4e4-4f85-b88e-176bb5b13ceb.jpg">http://img.groundspeak.com/track/display/35c891d1-b4e4-4f85-b88e-176bb5b13ceb.jpg</A>&quot; alt=&quot;Our 2nd TravelBug - BlackLog&quot; align=&quot;Right&quot; border=&quot;0&quot; /&gt;
-*
-*	Ziel des Bugs:
-*	&lt;span id=&quot;BugDetail_BugGoal&quot;&gt;
-*	...
-*	&lt;/span&gt;
-*	und!
-*	&lt;span id=&quot;BugDetail_BugDetails&quot;&gt;
-*	...
-*	&lt;/span&gt;
-*
-*/
-public class Spider extends TaskObject{
-	public static int SPIDERMULTI = 0;
-	public static int SPIDERNEAREST = 1;
-	public static int SPIDERLOC = 2;
-	public static String proxy;
-	public static String port;
-	private int SpiderType = -1;
-	private Vector caches_identified = new Vector();
-	private String caches_available = new String();
-	Vector cacheDB;
-	Preferences pref;
-	Profile profile;
-	ProgressBarForm pbf = new ProgressBarForm();
-	MessageArea msgA;
-	Vector data;
-	String distance;
-/** skg: 20061225 Commented out as it is not used	
-	protected void doRun(){
-		switch(SpiderType){
-			case 0: SpiderMulti(data, distance);
-				break;
-			case 1: SpiderNearest(distance);
-				break;
-			case 2: SpiderLOC(data);
-				break;
-		}
-	}
-	
-	public void setUp(Vector dta){
-		data = dta;
-	}
-	public void setUp(String dst){
-		distance = dst;
-	}
-	public void setUp(Vector vct, String dist){
-		data = vct;
-		distance = dist;
-	}
-*/	
-	
-	/**
-	*	Initializes a spider. It also identifies which caches
-	*	are already available in the database.
-	*
-	*   This seems to be used for spidering caches in batch mode
-	*/
-	public Spider(Preferences p, Profile prof, MessageArea msg, int SpT){
-		msgA = msg;
-		SpiderType = SpT;
-		cacheDB = profile.cacheDB;
-		profile=prof;
-		pref = p;
-		proxy = pref.myproxy;
-		port = pref.myproxyport;
-		CacheHolder ch;
-		for(int i = 0; i&lt;cacheDB.size(); i++){
-			ch = (CacheHolder)cacheDB.get(i);
-// TODO Change to hashTable or StringBuffer			
-			caches_available = caches_available + &quot;;&quot; + ch.wayPoint;  
-		}
-		//Vm.debug(&quot;Setup caches avail: &quot; + caches_available);
-	}
-	
-	/**
-	*	Performs an initial fetch to a given address. In this case
-	*	it will be a gc.com address. This method is used to obtain
-	*	the result of a search for caches screen.
-	*/
-	private static String fetch(String address) throws IOException
-	   	{
-			//Vm.debug(address);
-			HttpConnection conn;
-			if(proxy.length() &gt; 0){
-				conn = new HttpConnection(proxy, Convert.parseInt(port), address);
-				//Vm.debug(address);
-			} else {
-				conn = new HttpConnection(address);
-			}
-			conn.setRequestorProperty(&quot;USER_AGENT&quot;, &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0&quot;);
-			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-			conn.documentIsEncoded = true;
-			Socket sock = conn.connect();
-			ByteArray daten = conn.readData(sock);
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			////Vm.debug(c_data.toString());
-			sock.close();
-			return c_data.toString();
-		}
-	
-	/**
-	*	After a fetch to gc.com the next fetches have to use the post method.
-	*	This method does exactly that. Actually this method is generic in the sense
-	*	that it can be used to post to a URL using http post.
-	*/
-	private static String fetch_post(String address, String document) throws IOException 
-	   	{
-			
-			String line = new String();
-			String totline = new String();
-			if(proxy.length()==0){
-				try {
-					// Create a socket to the host
-					String hostname = &quot;www.geocaching.com&quot;;
-					int port = 80;
-					//InetAddress addr = InetAddress.getByName(hostname);
-					Socket socket = new Socket(hostname, port);
-				
-					// Send header
-					String path = &quot;/seek/nearest.aspx&quot;;
-					BufferedWriter wr = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream(), &quot;UTF8&quot;));
-					BufferedReader rd = new BufferedReader(new InputStreamReader(socket.getInputStream()));
-					wr.write(&quot;POST &quot;+path+&quot; HTTP/1.1\r\n&quot;);
-					wr.write(&quot;Host: www.geocaching.com\r\n&quot;);
-					wr.write(&quot;Content-Length: &quot;+document.length()+&quot;\r\n&quot;);
-					wr.write(&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;);
-					wr.write(&quot;Connection: close\r\n&quot;);
-					wr.write(&quot;\r\n&quot;);
-					// Send data
-					wr.write(document);
-					wr.write(&quot;\r\n&quot;);
-					wr.flush();
-					//Vm.debug(&quot;Sent the data!&quot;);
-					// Get response
-					while ((line = rd.readLine()) != null) {
-						totline += line + &quot;\n&quot;;
-					}
-					wr.close();
-					rd.close();
-				} catch (Exception e) {
-				}
-			} else {
-				HttpConnection conn;
-				conn = new HttpConnection(proxy, Convert.parseInt(port), address);
-				JavaUtf8Codec codec = new JavaUtf8Codec();
-				conn.documentIsEncoded = true;
-				//Vm.debug(address + &quot; / &quot; + document);
-				//document = document + &quot;\r\n&quot;;
-				//conn.setPostData(document.toCharArray());
-				conn.setRequestorProperty(&quot;USER_AGENT&quot;, &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0&quot;);
-				conn.setPostData(codec.encodeText(document.toCharArray(),0,document.length(),true,null));
-				conn.setRequestorProperty(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
-				conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-				Socket sock = conn.connect();
-				
-				//Vm.debug(&quot;getting stuff!&quot;);
-				ByteArray daten = conn.readData(sock);
-				//Vm.debug(&quot;coming back!&quot;);
-				CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-				sock.close();
-				//Vm.debug(c_data.toString());
-				totline =  c_data.toString();
-			}
-			return totline;
-		}
-		
-	/**
-	*	This mehtod is to be called after LOC files from gc.com
-	*	have been analysed. It spiders each identified cache step by step.
-	*/
-	public void SpiderLOC(Vector locs){
-		for(int i = 0; i&lt;locs.size();i++){
-			caches_identified.add((String)locs.get(i));
-		}
-		try{
-			doSpider(Convert.toString(locs.size()), false);
-		}catch (Exception e){
-			//Vm.debug(&quot;Problem with spider&quot;);
-		}
-	}
-	
-	/**
-	*	This method spiders all caches in a radius of PERIP. It
-	*	converts to km to identify those caches outside of PERIP.
-	*	Center point is what is currently set in preferences.
-	*/
-	public void SpiderNearest(String perip){
-			//ParseLatLon pll;
-			//pbf.display(MyLocale.getMsg(800,&quot;Collecting list&quot;), MyLocale.getMsg(801,&quot;collecting...&quot;), pForm);
-			if(msgA != null)  msgA.setText(MyLocale.getMsg(801,&quot;collecting...&quot;));
-			double periInt = Convert.parseDouble(perip);
-			double distDbl;
-			int cacheCounter = 0;
-			int page_number = 5; //gc.com starts with 5! for page 2...
-			// initial fetch
-			//String url_for_next_page = new String();
-			String sourcePage = new String();
-			String listString = new String();
-			String v_state = new String();
-			//String ev_argument = new String(); //not used?
-			String ev_target = new String();
-			String cache = new String();
-			String dist = new String();
-			//String document = new String();
-			String NS = pref.curCentrePt.getNSLetter().equals(&quot;N&quot;) ? &quot;1&quot; : &quot;-1&quot;;
-			String WE = pref.curCentrePt.getEWLetter().equals(&quot;E&quot;) ? &quot;1&quot; : &quot;-1&quot;;
-			String searchStr = 
-				        &quot;lat_ns=&quot;     + NS +
-						&quot;&amp;lat_h=&quot;     + pref.curCentrePt.getLatDeg(CWPoint.DMM) +
-						&quot;&amp;lat_mmss=&quot;  + pref.curCentrePt.getLatMin(CWPoint.DMM) +
-						&quot;&amp;long_ew=&quot;   + WE +
-						&quot;&amp;long_h=&quot;    + pref.curCentrePt.getLonDeg(CWPoint.DMM) +
-						&quot;&amp;long_mmss=&quot; + pref.curCentrePt.getLatMin(CWPoint.DMM);
-			boolean more = true;
-			Extractor sourceEx, listEx, listExDist, listExCache;
-			try{
-				sourcePage = fetch(&quot;<A HREF="http://www.geocaching.com/seek/nearest.aspx?">http://www.geocaching.com/seek/nearest.aspx?</A>&quot;+searchStr);
-			} catch (Exception ex){
-				ex.printStackTrace();
-				//Vm.debug(ex.toString());
-			}
-			//do we have a valid page or maybe there are no caches in required distance?
-			if(sourcePage.indexOf(&quot;Sorry, no results were found for this search&quot;)==-1){
-				do{
-					// analyse page
-					// first get relevant section
-					listEx = new Extractor(sourcePage, &quot;Last Found&quot;, &quot;Distances measured&quot;, 0, true);
-					listString = listEx.findNext();
-					//Vm.debug(listString);
-					// now get the details within the section
-					listExDist = new Extractor(listString, &quot;&lt;br /&gt;&quot;, &quot;&lt;/td&gt;&quot;, 0, true);
-					listExCache = new Extractor(listString, &quot;&lt;/a&gt; (&quot;, &quot;)&lt;br&gt;&quot;, 0, true);
-					cache = listExCache.findNext();
-					dist = listExDist.findNext();
-					while (listExDist.endOfSearch() == false) {
-						dist = dist.substring(0, dist.length()-2);
-						if(dist.indexOf(&quot;.&quot;) == -1) dist = &quot;0.&quot; + dist;
-						if(pref.digSeparator.equals(&quot;,&quot;)) dist = dist.replace('.',',');
-						distDbl = 0;
-						try{
-							distDbl = Convert.parseDouble(dist);
-							distDbl = distDbl * 1.6093;
-						} catch (NumberFormatException nfe){
-							Vm.debug(&quot;Number format exception: &quot; +cache);
-						}
-						if( distDbl &lt;= periInt) {
-							//add to list to spider
-							caches_identified.add(cache);
-							cacheCounter++;
-							//pbf.display(MyLocale.getMsg(800,&quot;Collecting list&quot;), Convert.toString(cacheCounter) + MyLocale.getMsg(802,&quot; caches identified: collecting more...&quot;), pForm);
-							if(msgA != null)  msgA.setText(Convert.toString(cacheCounter) + MyLocale.getMsg(802,&quot; caches identified: collecting more...&quot;));
-							//more = true;
-							//Vm.debug(dist +&quot; : &quot; +cache);
-						} else {
-							// reached edge... stop getting list pages
-							more = false;
-						}
-						cache = listExCache.findNext();
-						dist = listExDist.findNext();
-					}
-					// get next page
-					if(more == true){
-						sourceEx = new Extractor(sourcePage, &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;__VIEWSTATE\&quot; value=\&quot;&quot;, &quot;\&quot; /&gt;&quot;,0, true);
-						v_state = sourceEx.findNext();
-						ev_target = &quot;ResultsPager:_ctl&quot; + Convert.toString(page_number);
-						page_number++;
-						if(page_number &gt;= 15) page_number = 5;
-						String data = new String();
-						data = URL.encodeURL(&quot;lat_ns&quot;,false) + &quot;=&quot; + URL.encodeURL(NS,false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;lat_h&quot;,false) +&quot;=&quot;+ URL.encodeURL(pref.curCentrePt.getLatDeg(CWPoint.DMM),false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;lat_mmss&quot;,false) +&quot;=&quot;+ URL.encodeURL(pref.curCentrePt.getLatMin(CWPoint.DMM),false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;long_ew&quot;,false) +&quot;=&quot;+ URL.encodeURL(WE,false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;long_h&quot;,false) +&quot;=&quot;+ URL.encodeURL(pref.curCentrePt.getLonDeg(CWPoint.DMM),false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;long_mmss&quot;,false) +&quot;=&quot;+ URL.encodeURL(pref.curCentrePt.getLonMin(CWPoint.DMM),false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;__EVENTTARGET&quot;,false) +&quot;=&quot;+ URL.encodeURL(ev_target,false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;__EVENTARGUMENT&quot;,false) +&quot;=&quot;+ URL.encodeURL(&quot;&quot;,false);
-						data += &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATE&quot;,false) +&quot;=&quot;+ URL.encodeURL(v_state,false);
-						//Vm.debug(&quot;This is viewstate: &quot; + v_state);
-						//document = &quot;origin_lat=&quot; +URL.encodeURL(&quot;48&quot;,false) +&quot;&amp;origin_lon=&quot; + URL.encodeURL(&quot;11&quot;,false) +&quot;&amp;submit3=&quot; + URL.encodeURL(&quot;Submit&quot;,false) +	&quot;&amp;__EVENTTARGET=&quot;+URL.encodeURL(ev_target,false) +&quot;&amp;__EVENTARGUMENT=&amp;__VIEWSTATE=&quot;+URL.encodeURL(v_state,false);
-						//document = &quot;origin_lat=48&amp;origin_lon=11&amp;submit3=Submit&amp;__EVENTTARGET=&quot;+ev_target +&quot;&amp;__EVENTARGUMENT=&amp;__VIEWSTATE=&quot;+v_state;
-						//document = URL.encodeURL(&quot;lat_ns=&quot;+NS+&quot;&amp;lat_h=&quot;+myPref.mylgDeg+ &quot;&amp;lat_mmss=&quot; +myPref.mylgMin+ &quot;&amp;long_ew=&quot; + WE+ &quot;&amp;long_h=&quot; + myPref.mybrDeg+ &quot;&amp;long_mmss=&quot; + myPref.mybrMin +&quot;&amp;submit3=Submit&amp;__EVENTTARGET=&quot;+ev_target +&quot;&amp;__EVENTARGUMENT=&amp;__VIEWSTATE=&quot;+v_state,false);
-						//document = &quot;?lat_ns=1&amp;lat_h=48&amp;lat_mmss=07.915&amp;long_ew=1&amp;long_h=11&amp;long_mmss=35.597&quot;;
-						//document = &quot;lat_ns=&quot;+URL.encodeURL(NS,false)+&quot;&amp;lat_h=&quot;+URL.encodeURL(myPref.mylgDeg,false) + &quot;&amp;lat_mmss=&quot; +URL.encodeURL(myPref.mylgMin,false) + &quot;&amp;long_ew=&quot; + URL.encodeURL(WE,false)+ &quot;&amp;long_h=&quot; + URL.encodeURL(myPref.mybrDeg,false) + &quot;&amp;long_mmss=&quot; + URL.encodeURL(myPref.mybrMin,false) +&quot;&amp;submit3=&quot; + URL.encodeURL(&quot;Submit&quot;,false) +	&quot;&amp;__EVENTTARGET=&quot;+URL.encodeURL(ev_target,false) +&quot;&amp;__EVENTARGUMENT=&quot;+URL.encodeURL(&quot;&quot;,false) +	&quot;&amp;__VIEWSTATE=&quot;+URL.encodeURL(v_state,false);
-						//document = &quot;__EVENTTARGET=&quot;+URL.encodeURL(ev_target,false) +&quot;&amp;__EVENTARGUMENT=&quot;+URL.encodeURL(&quot;&quot;,false) +	&quot;&amp;__VIEWSTATE=&quot;+URL.encodeURL(v_state,false);
-						//document = &quot;__VIEWSTATE=&quot;+URL.encodeURL(v_state,false)+&quot;&amp;__EVENTTARGET=&quot;+ev_target;
-						try{
-							sourcePage = &quot;&quot;;
-							sourcePage = fetch_post(&quot;<A HREF="http://www.geocaching.com/seek/nearest.aspx">http://www.geocaching.com/seek/nearest.aspx</A>&quot;, data);
-							//sourcePage = fetch_post(&quot;<A HREF="http://localhost/post.php">http://localhost/post.php</A>&quot;, data);
-							//more = false;
-							//Vm.debug(sourcePage);
-						} catch (Exception ex){
-							ex.printStackTrace();
-							////Vm.debug(ex.toString());
-						}
-					}
-					//Vm.debug(&quot;running....&quot;);
-					if(shouldStop == true) break;
-				} while (more == true);
-			}//if sourcepage valid
-			//pbf.display(MyLocale.getMsg(800,&quot;Collecting list&quot;), Convert.toString(cacheCounter) + MyLocale.getMsg(803,&quot; Done!&quot;), pForm);
-			if(msgA != null) msgA.setText(Convert.toString(cacheCounter) + MyLocale.getMsg(803,&quot; Done!&quot;));
-			if(shouldStop == false){
-				try{
-					doSpider(Convert.toString(cacheCounter), true);
-				}catch(IOException ex){
-					//Vm.debug(&quot;Problem with Spider&quot;);
-				}
-			}
-		}
-		
-		/**
-		*	Call this method to find out if a cache has already been
-		*	spidered.
-		*/
-		/*skg 20061223: Not used
-		private boolean isAlreadyFetched(String wp){
-			if(caches_available.indexOf(wp) == -1) return false;
-			else return true;
-		}
-		*/
-		/**
-		*	Method that performs a multi point spider.
-		*	User will choose this option when identification of caches
-		*	along a route is required.
-		*/
-		/**skg 20061225: Not used
-		public void SpiderMulti(Vector wpts, String dist){
-			//first save current preference settings
-			CWPoint SavedCentre=new CWPoint(pref.curCentrePt);
-			
-			//loop through the vector and perform a spidernearest
-			for(int i = 0; i&lt;wpts.size(); i++){
-				pref.curCentrePt.set((String)wpts.get(i)); // Can use Regex here as time is not of concern
-				if(shouldStop == true) break;
-				//do the spider
-				SpiderNearest(dist);
-			}
-			
-			//save back preferences
-			pref.curCentrePt.set(SavedCentre);
-		}
-		*/
-	
-		/**
-		*	Method that actually gathers details on a cache.
-		*	The string total is just for information purposes.
-		*	This method actually loops through the vector
-		*	&quot;caches_identified&quot;, that holds caches that are not
-		*	available in the database.
-		*/
-		private void doSpider(String total, boolean update_existing) throws IOException {
-			MapLoader mpl;
-			ParseLatLon pll;
-			Extractor cacheEx;
-			Extractor tempEx, tempEx2;
-			CacheHolder ch;
-			int doneCounter = 1;
-			String wp = new String();
-			String document = new String();
-			String imgLoc = new String();
-			String dummy = new String();
-			String dummy2 = new String();
-			String dummy3 = new String();
-			String dummy4 = new String();
-			String dummy5 = new String();
-			String dummy6 = new String();
-			boolean found = false;
-			//time to add existing caches to the identified list, ommitting double entries
-			if(shouldStop == false){
-				if(update_existing == true){
-					for(int x = 0; x &lt; cacheDB.size(); x++){
-						found = false;
-						ch = new CacheHolder();
-						ch = (CacheHolder)cacheDB.get(x);
-						for(int y = 0; y&lt;caches_identified.size(); y++){
-							dummy = new String();
-							dummy = (String)caches_identified.get(y);
-							dummy = dummy.trim();
-							if(ch.wayPoint.toUpperCase().equals(dummy.toUpperCase()) == true) found = true;
-						}
-						if(found == false &amp;&amp; ch.is_found == false) caches_identified.add(ch.wayPoint);
-					}
-					total = Convert.toString(caches_identified.size());
-				}
-			}
-			for(int i = 0; i&lt;caches_identified.size(); i++){
-				ch = new CacheHolder();
-				wp = (String)caches_identified.get(i);
-				wp = wp.trim();
-				//make sure we do not get doubles!
-				//Vm.debug(caches_available);
-				
-				//Vm.debug(&quot;Do not have going in for: &quot; + wp);
-				//pbf.display(MyLocale.getMsg(804,&quot;Collecting Cache Details&quot;), MyLocale.getMsg(805,&quot;Fetching: &quot;) + wp + &quot; (&quot; +Convert.toString(doneCounter)+&quot; of &quot;+total+&quot;)&quot;, pForm);
-				if(msgA != null) msgA.setText(MyLocale.getMsg(805,&quot;Fetching: &quot;) + wp + &quot; (&quot; +Convert.toString(doneCounter)+&quot; of &quot;+total+&quot;)&quot;);
-				try{
-					document = fetch(&quot;<A HREF="http://www.geocaching.com/seek/cache_details.aspx?wp=">http://www.geocaching.com/seek/cache_details.aspx?wp=</A>&quot;+wp+&quot;&amp;Submit6=Find&amp;log=y&quot;);
-				}catch(Exception ex){
-					//Vm.debug(&quot;Problem with page: &quot;+wp);
-				}
-				//if(caches_available.indexOf(wp) == -1){	
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;CacheName\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				ch.CacheName = cacheEx.findNext();
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;ErrorText\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				dummy = cacheEx.findNext();
-				if(dummy.indexOf(&quot;has been archived&quot;)&gt;=0) ch.is_archived = true;
-				if(dummy.indexOf(&quot;temporarily unavailable&quot;)&gt;=0) ch.is_available = false;
-				
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;CacheOwner\&quot;&gt;&lt;b&gt;&lt;font size=\&quot;2\&quot;&gt;by &quot;, &quot;[&lt;A&quot;,0,true);
-				ch.CacheOwner = cacheEx.findNext();
-				//Vm.debug(ch.CacheOwner);
-				if(ch.CacheOwner.indexOf(pref.myAlias)&gt;=0) ch.is_owned = true;
-				if(ch.is_owned == true) ch.CacheStatus = &quot;Owner&quot;;
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;LatLon\&quot;&gt;&lt;font size=\&quot;3\&quot;&gt;&quot;, &quot;&lt;/STRONG&gt;&lt;br /&gt;&lt;STRONG&gt;&lt;/font&gt;&lt;/span&gt;&quot;,0,true);
-				ch.LatLon = cacheEx.findNext();
-				ch.LatLon = replace(ch.LatLon, &quot;&#176;&quot;, &quot;&#176;&quot;);
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;DateHidden\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				ch.DateHidden = cacheEx.findNext();
-				ch.wayPoint = wp;
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;ShortDescription\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				ch.LongDescription = cacheEx.findNext();
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;LongDescription\&quot;&gt;&quot;, &quot;&lt;STRONG&gt;Additional Hints&nbsp;&quot;,0,true);
-				ch.LongDescription += cacheEx.findNext();
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;Hints\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				ch.Hints = cacheEx.findNext();
-				cacheEx = new Extractor(document, &quot;&lt;img src=\&quot;../images/WptTypes/&quot;, &quot;.gif\&quot;&quot;,0,true);
-				ch.type = cacheEx.findNext();
-				if(ch.type.equals(&quot;11&quot;) == false){
-					cacheEx = new Extractor(document, &quot;This is a &lt;strong&gt;&quot;, &quot;&lt;/strong&gt; cache.&quot;,0,true);
-					ch.CacheSize = cacheEx.findNext();
-				}
-				
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;CacheLogs\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				dummy = cacheEx.findNext();
-				//is found?
-				if(pref.myAlias.length()&gt;0){
-					tempEx = new Extractor(dummy, &quot;icon_smile.gif&quot;, &quot;&lt;/A&gt;&quot;,0,true);
-					dummy3 = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						if(dummy3.indexOf(pref.myAlias)&gt;0) ch.is_found = true;
-						dummy3 = tempEx.findNext();
-					}
-					tempEx = new Extractor(dummy, &quot;icon_camera.gif&quot;, &quot;&lt;/A&gt;&quot;,0,true);
-					dummy3 = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						if(dummy3.indexOf(pref.myAlias)&gt;0) ch.is_found = true;
-						dummy3 = tempEx.findNext();
-					}
-					tempEx = new Extractor(dummy, &quot;icon_attended.gif&quot;, &quot;&lt;/A&gt;&quot;,0,true);
-					dummy3 = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						if(dummy3.indexOf(pref.myAlias)&gt;0) ch.is_found = true;
-						dummy3 = tempEx.findNext();
-					}
-				}
-				if(ch.is_found == true) ch.CacheStatus = &quot;Found&quot;;
-				
-				cacheEx = new Extractor(dummy, &quot;&lt;STRONG&gt;&lt;IMG SRC='http:&quot;, &quot;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td VALIGN='TOP' ALIGN='LEFT'&gt;&lt;font face='Verdana' size='2'&gt;&quot;,0,true);
-				dummy = cacheEx.findNext();
-				//int maxLogs = myPref.nLogs;
-				
-				while(cacheEx.endOfSearch() == false){
-					//maxLogs--;
-					//Vm.debug(dummy);
-					//extract any images if they exist
-					tempEx = new Extractor(dummy, &quot;&lt;A HREF='./log.aspx?IID=&quot;, &quot;&amp;&quot;, 0 ,true);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						ch.LogImages.add(imgLoc);
-						//Vm.debug(imgLoc);
-						imgLoc = tempEx.findNext();
-					}
-					
-					//Erase stuff in [...]
-					tempEx = new Extractor(dummy, &quot;[&quot;, &quot;]&quot;, 0, false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						dummy = replace(dummy, imgLoc, &quot;&quot;);
-						imgLoc = tempEx.findNext();
-					}
-					
-					//rename image link to [[name_of_image]]
-					tempEx = new Extractor(dummy, &quot;&lt;A HREF='./log.aspx?IID=&quot;, &quot;&lt;/A&gt;&quot;, 0 ,false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						tempEx2 = new Extractor(imgLoc, &quot;'&gt;&quot;, &quot;&lt;/&quot;, 0 ,true);
-						dummy2 = tempEx2.findNext();
-						dummy2 = dummy2.substring(0, dummy2.length()-1);
-						ch.LogImagesText.add(dummy2);
-						dummy = replace(dummy, imgLoc, &quot; [[ &quot;+dummy2+&quot; ]] &quot;);
-						imgLoc = tempEx.findNext();
-					}
-					//repoint log icons
-					dummy = replace(dummy, &quot;&lt;IMG SRC='../images/icon_camera.gif' align=left&gt;&quot;, &quot;&lt;img src='icon_camera.gif'&gt;&quot;);
-					dummy = replace(dummy, &quot;&lt;IMG SRC='../images/icon_smile.gif' align=left&gt;&quot;, &quot;&lt;img src='icon_smile.gif'&gt;&quot;);
-					dummy = replace(dummy, &quot;&lt;IMG SRC='../images/icon_attended.gif' align=left&gt;&quot;, &quot;&lt;img src='icon_attended.gif'&gt;&quot;);
-					
-					dummy = replace(dummy, &quot;//www.geocaching.com/images/icons/&quot;, &quot;&lt;img src='&quot;);
-					
-					//Erase HTML stuff in logs
-					//table tags
-					tempEx = new Extractor(dummy, &quot;&lt;table&quot;, &quot;&gt;&quot;, 0, false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						dummy = replace(dummy, imgLoc, &quot;&quot;);
-						imgLoc = tempEx.findNext();
-					}
-					tempEx = new Extractor(dummy, &quot;&lt;TABLE&quot;, &quot;&gt;&quot;, 0, false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						dummy = replace(dummy, imgLoc, &quot;&quot;);
-						imgLoc = tempEx.findNext();
-					}
-					tempEx = new Extractor(dummy, &quot;&lt;td&quot;, &quot;&gt;&quot;, 0, false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						dummy = replace(dummy, imgLoc, &quot;&quot;);
-						imgLoc = tempEx.findNext();
-					}
-					tempEx = new Extractor(dummy, &quot;&lt;TD&quot;, &quot;&gt;&quot;, 0, false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						dummy = replace(dummy, imgLoc, &quot;&quot;);
-						imgLoc = tempEx.findNext();
-					}
-					dummy = replace(dummy, &quot;&lt;tr&gt;&quot;, &quot;&quot;);
-					dummy = replace(dummy, &quot;&lt;TR&gt;&quot;, &quot;&quot;);
-					dummy = replace(dummy, &quot;&lt;/tr&gt;&quot;, &quot;&quot;);
-					dummy = replace(dummy, &quot;&lt;/TR&gt;&quot;, &quot;&quot;);
-					dummy = replace(dummy, &quot;&lt;/td&gt;&quot;, &quot;&quot;);
-					dummy = replace(dummy, &quot;&lt;/TD&gt;&quot;, &quot;&quot;);
-					dummy = replace(dummy, &quot;&lt;/table&gt;&quot;, &quot;&quot;);
-					dummy = replace(dummy, &quot;&lt;/TABLE&gt;&quot;, &quot;&quot;);
-					// a href
-					tempEx = new Extractor(dummy, &quot;&lt;A HREF=&quot;, &quot;&gt;&quot;, 0, false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						dummy = replace(dummy, imgLoc, &quot;&quot;);
-						imgLoc = tempEx.findNext();
-					}
-					tempEx = new Extractor(dummy, &quot;&lt;A NAME=&quot;, &quot;&gt;&quot;, 0, false);
-					imgLoc = new String();
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						dummy = replace(dummy, imgLoc, &quot;&quot;);
-						imgLoc = tempEx.findNext();
-					}
-					dummy = replace(dummy, &quot;&lt;/A&gt;&quot;, &quot;&quot;);
-					//End of erase html stuff in logs
-					
-					ch.CacheLogs.add(dummy);
-					dummy = cacheEx.findNext();
-				} //while
-				
-				
-				// Search for Travelbugs
-				
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;lnkTravelBugs\&quot;&gt;&quot;,&quot;&lt;/span&gt;&quot;,0,true);
-				dummy = cacheEx.findNext();
-				if(dummy.length()&gt;0){
-					cacheEx = new Extractor(dummy, &quot;&lt;A HREF&quot;,&quot;&lt;/A&gt;&quot;,0,true);
-					dummy2 = cacheEx.findNext();
-					while(cacheEx.endOfSearch() == false){
-						tempEx2 = new Extractor(dummy2, &quot;guid=&quot;,&quot;\&quot;&gt;&quot;,0,true);
-						//we need only those where guid exist
-						dummy4 = tempEx2.findNext();
-						if(dummy4.length()&gt;0){
-							// Have a bug, lets get description and picture
-							dummy5 = fetch(&quot;<A HREF="http://www.geocaching.com//track/details.aspx?guid=">http://www.geocaching.com//track/details.aspx?guid=</A>&quot;+dummy4);
-							tempEx = new Extractor(dummy5,&quot;&lt;span id=\&quot;lbHeading\&quot;&gt;&quot;,&quot;&lt;/span&gt;&quot;,0,true);
-							dummy6 = tempEx.findNext();
-							ch.Bugs += &quot;&lt;b&gt;Name:&lt;/b&gt; &quot; + dummy6 + &quot;&lt;br&gt;&quot;;
-							tempEx = new Extractor(dummy5,&quot;&lt;span id=\&quot;BugDetail_BugGoal\&quot;&gt;&quot;,&quot;&lt;/span&gt;&quot;,0,true);
-							dummy6 = tempEx.findNext();
-							ch.Bugs += &quot;&lt;b&gt;Goal: &lt;/b&gt;&quot; + dummy6 + &quot;&lt;br&gt;&quot;;
-							tempEx = new Extractor(dummy5,&quot;&lt;span id=\&quot;BugDetail_BugDetails\&quot;&gt;&quot;,&quot;&lt;/span&gt;&quot;,0,true);
-							dummy6 = tempEx.findNext();
-							ch.Bugs += &quot;&lt;b&gt;Details:&lt;/b&gt; &quot; + dummy6 + &quot;&lt;br&gt;&lt;br&gt;&lt;hr&gt;&quot;;
-							ch.has_bug = true;
-						}
-						dummy2 = cacheEx.findNext();
-					}
-				}
-				// End of search for travelbugs
-				
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;Terrain\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				dummy = cacheEx.findNext();
-				cacheEx = new Extractor(dummy, &quot;/stargreen&quot;, &quot;gif&quot;,0,true);
-				double counter = 0;
-				cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					counter++;
-					cacheEx.findNext();
-				}
-				cacheEx = new Extractor(dummy, &quot;/halfstargreen&quot;, &quot;gif&quot;,0,true);
-				cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					counter = counter + 0.5;
-					cacheEx.findNext();
-				}
-				ch.terrain = Convert.toString(counter);
-
-				counter = 0;				
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;Difficulty\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				dummy = new String();
-				dummy = cacheEx.findNext();
-				cacheEx = new Extractor(dummy, &quot;/staryellow&quot;, &quot;gif&quot;,0,true);
-				cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					counter++;
-					cacheEx.findNext();
-				}
-				cacheEx = new Extractor(dummy, &quot;/halfstaryellow&quot;, &quot;gif&quot;,0,true);
-				cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					counter = counter + 0.5;
-					cacheEx.findNext();
-				}
-				ch.hard = Convert.toString(counter);
-				////Vm.debug(&quot;Hard: &quot; +ch.hard + &quot; / Terrain: &quot; + ch.terrain);
-				// Replace image tags in description
-				// get unique images from everywhere
-				// Replace image tags in logs
-				// Get images in logs
-
-				//hier ist ein Problem....
-				//c) dann in LongDescription
-				//d) dann in den logs
-				
-				//first find cacheattributes
-				/*
-				cacheEx = new Extractor(document, &quot;&lt;img src=\&quot;../images/attributes/&quot;, &quot;\&quot; Alt&quot;,0,true);
-				
-				img = cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					ch.attributes.add(img);
-					img = cacheEx.findNext();
-				}
-				*/
-				
-				//get the images in the image span
-				cacheEx = new Extractor(document, &quot;&lt;span id=\&quot;Images\&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;,0,true);
-				imgLoc = new String();
-				String tmpDoc = new String();
-				tmpDoc = cacheEx.findNext();
-				if(cacheEx.endOfSearch() == false){
-					tempEx = new Extractor(tmpDoc, &quot;&lt;A HREF=\&quot;&quot;, &quot;\&quot; target=&quot;, 0, true);
-					imgLoc = tempEx.findNext();
-					while(tempEx.endOfSearch() == false){
-						ch.Images.add(imgLoc);
-						////Vm.debug(&quot;Got: &quot; + imgLoc);
-						imgLoc = tempEx.findNext();
-					}
-				}
-				
-				//get and replace images in the longdescription
-				
-				////Vm.debug(&quot;1&quot;);
-				ch.LongDescription = &quot; &quot; + ch.LongDescription;
-				cacheEx = new Extractor(ch.LongDescription, &quot;&lt;img src = \&quot;&quot;, &quot;\&quot;&quot;, 0 ,true);
-				imgLoc = new String();
-				imgLoc = cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					ch.Images.add(imgLoc);
-					imgLoc = cacheEx.findNext();
-				}
-				////Vm.debug(&quot;2&quot;);
-				cacheEx = new Extractor(ch.LongDescription, &quot;&lt;img src = \&quot;&quot;, &quot;&gt;&quot;, 0 ,false);
-				imgLoc = new String();
-				imgLoc = cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					ch.LongDescription = replace(ch.LongDescription, imgLoc, &quot;&quot;);
-					imgLoc = cacheEx.findNext();
-				}
-				
-				////Vm.debug(&quot;3--------------------------&quot;);
-				cacheEx = new Extractor(ch.LongDescription, &quot;&lt;img src=\&quot;&quot;, &quot;\&quot;&quot;, 0 ,true);
-				imgLoc = new String();
-				imgLoc = cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					ch.Images.add(imgLoc);
-					imgLoc = cacheEx.findNext();
-				}
-				
-				////Vm.debug(&quot;4&quot;);
-				cacheEx = new Extractor(ch.LongDescription, &quot;&lt;img src=\&quot;&quot;, &quot;&gt;&quot;, 0 ,false);
-				imgLoc = new String();
-				imgLoc = cacheEx.findNext();
-				while(cacheEx.endOfSearch() == false){
-					ch.LongDescription = replace(ch.LongDescription, imgLoc, &quot;&quot;);
-					imgLoc = cacheEx.findNext();
-				}
-				// have all the images, now spider them!
-				HttpConnection connImg;
-				Socket sockImg;
-				FileOutputStream fos;
-				String datei = new String();
-				String imageOrig = new String();
-				String imageType = new String();
-				String imageList = new String();
-				ByteArray daten;
-				int imgCounter = 0;
-				
-				// Images 
-				//Vm.debug(&quot;Have images: &quot; + Convert.toString(ch.Images.size()));
-				for(int p = 0; p&lt;ch.Images.size(); p++){
-					imgCounter++;
-					imageOrig = (String)ch.Images.get(p);
-					//Vm.debug(&quot;Checking: &quot; + imageOrig);
-					//sleep(1500);
-					//make sure we do not get the images more than once!
-					if(imageList.indexOf(imageOrig) == -1){
-						//some images are fetched using PHP
-						//we don't want these images
-						if(imageOrig.lastIndexOf(&quot;.php&quot;) &lt;= 0){
-							imageList = imageList + &quot;;&quot; + imageOrig;
-							if(proxy.length()&gt;0){
-							connImg = new HttpConnection(proxy, Convert.parseInt(port), imageOrig);
-							}else{
-								connImg = new HttpConnection(imageOrig);
-							}
-							imageType = imageOrig.substring(imageOrig.lastIndexOf(&quot;.&quot;), imageOrig.lastIndexOf(&quot;.&quot;)+4);
-							datei = profile.dataDir + ch.wayPoint + &quot;_&quot; + Convert.toString(imgCounter)+ imageType;
-							ch.Images.set(p, ch.wayPoint + &quot;_&quot; + Convert.toString(imgCounter) + imageType);
-							//connImg.keepAliveMode = true;
-							connImg.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-							//Vm.debug(&quot;Connecting...&quot;);
-							try{
-								sockImg = connImg.connect();
-								daten = connImg.readData(sockImg);
-								fos = new FileOutputStream(new File(datei));
-								fos.write(daten.toBytes());
-								fos.close();
-								sockImg.close();
-							}catch(IOException ioex){
-								//Vm.debug(&quot;File not found!&quot;);
-								ch.Images.removeElementAt(p);
-							}
-						}
-					} else {
-						ch.Images.removeElementAt(p);
-					}
-				}
-				//Log Images
-				//Vm.debug(&quot;Going into log images&quot;);
-				
-				for(int p = 0; p&lt;ch.LogImages.size(); p++){
-					imgCounter++;
-					imageOrig = (String)ch.LogImages.get(p);
-					//Vm.debug(&quot;Fetching Log Image: &quot; +imageOrig);
-					datei = profile.dataDir + ch.wayPoint + &quot;_L_&quot; + Convert.toString(imgCounter)+ &quot;.jpg&quot;;
-					File dateiF = new File(datei);
-					//no need to save the file if it already exists!
-					ch.LogImages.set(p, ch.wayPoint + &quot;_L_&quot; + Convert.toString(imgCounter) + &quot;.jpg&quot;);
-					if(!dateiF.exists()){
-						imageOrig = &quot;<A HREF="http://img.groundspeak.com/cache/log/">http://img.groundspeak.com/cache/log/</A>&quot;+imageOrig+&quot;.jpg&quot;;
-						if(proxy.length()&gt;0){
-							connImg = new HttpConnection(proxy, Convert.parseInt(port), imageOrig);
-						}else{
-							connImg = new HttpConnection(imageOrig);
-						}
-						//connImg.keepAliveMode = true;
-						connImg.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-						sockImg = connImg.connect();
-						daten = connImg.readData(sockImg);
-						fos = new FileOutputStream(dateiF);
-						fos.write(daten.toBytes());
-						
-						fos.close();
-						sockImg.close();
-					} //if file does not exist
-				}
-				
-				//Vm.debug(&quot;Out of log images...&quot;);
-				
-				//Now check if cache has already been spidered earlier.
-				//If yes change the status flags accordingly
-				if(caches_available.indexOf(ch.wayPoint) &lt; 0){ //no, this is a new cache
-					//Vm.debug(&quot;Cache is new exists!!!!!!!!!!!!&quot;);
-					ch.is_new = true;
-					ch.is_update = false;
-					ch.is_log_update = false;
-					cacheDB.add(ch);
-					caches_available = caches_available + &quot;;&quot; +wp;
-				}else{ //yes cache exists
-					//Vm.debug(&quot;Cache exists!!!!!!!!!!!!&quot;);
-					CacheHolder checkCache = getCache(ch.wayPoint);
-					ch.is_new = false;
-					ch.is_update = false;
-					ch.is_log_update = false;
-					//Check if description changed
-					if(ch.LongDescription.equals(checkCache.LongDescription) == false){
-						ch.is_update = true;
-						//Vm.debug(ch.LongDescription + &quot;\n\n--------------\n\n&quot;);
-						//Vm.debug(checkCache.LongDescription);
-					}
-					//Check if there are new logs
-					/*
-					if(ch.CacheLogs.size() != checkCache.CacheLogs.size()){
-						ch.is_log_update = true;
-						//Vm.debug(&quot;Log check: spidered: &quot; + ch.CacheLogs.size() + &quot; old: &quot;+ checkCache.CacheLogs.size());
-					}*/
-					changeCache(ch);
-				}
-				
-				ch.saveCacheDetails(profile.dataDir);	
-				ch.CacheName = SafeXML.cleanback(ch.CacheName);
-				if(ch.CacheName.equals(&quot;An Error Has Occured&quot;)){
-					ch.type = &quot;0&quot;;
-				}
-				ch.LatLon = SafeXML.cleanback(ch.LatLon);
-				ch.CacheOwner = SafeXML.cleanback(ch.CacheOwner);
-				//} // if cache exists				
-				//Save cache index list (index.xml)
-				//after each spider
-				document = new String();
-				doneCounter++;
-				profile.saveIndex(pref);
-				if(!ch.CacheName.equals(&quot;An Error Has Occured&quot;) &amp;&amp; ch.LatLon.length() &gt; 1){
-					pll = new ParseLatLon(ch.LatLon,&quot;.&quot;);
-					pll.parse();
-					mpl = new MapLoader(pll.getLatDeg(),pll.getLonDeg(), pref.myproxy, pref.myproxyport);
-					mpl.loadTo(profile.dataDir + &quot;/&quot; + ch.wayPoint + &quot;_map.gif&quot;, &quot;3&quot;);
-					mpl.loadTo(profile.dataDir + &quot;/&quot; + ch.wayPoint + &quot;_map_2.gif&quot;, &quot;10&quot;);
-				}
-				if(shouldStop == true) break;
-			} // for
-			/*
-			for(int i = 0; i &lt; cacheDB.size();i++){
-				ch = (CacheHolder)cacheDB.get(i);
-				ch.CacheName = SafeXML.cleanback(ch.CacheName);
-				ch.LatLon = SafeXML.cleanback(ch.LatLon);
-				ch.CacheOwner = SafeXML.cleanback(ch.CacheOwner);
-				cacheDB.set(i, ch);
-			}*/
-
-			//pbf.clear();
-		}
-		
-		private void changeCache(CacheHolder ch){
-			CacheHolder retCH = new CacheHolder();
-			String waypoint = new String();
-			waypoint = ch.wayPoint;
-			int i = 0;
-			for(i = 0; i&lt;cacheDB.size();i++){
-				retCH = new CacheHolder();
-				retCH = (CacheHolder)cacheDB.get(i);
-				if(retCH.wayPoint.equals(waypoint)) break;
-			}
-			cacheDB.set(i,ch);
-		}
-		
-		/**
-		*	This method will load all information available for a
-		*	cache. It returns a CacheHolder object.
-		*/
-		private CacheHolder getCache(String waypoint){
-			CacheHolder retCH=null;
-			for(int i = 0; i&lt;cacheDB.size();i++){
-				retCH = (CacheHolder)cacheDB.get(i);
-				if(retCH.wayPoint.equals(waypoint)) {
-					try{
-						retCH.readCache(profile.dataDir);
-					}catch(Exception ex){};
-					return retCH;
-				}
-			}
-			return retCH;
-		}
-		
-		/**
-		 *   Replace all instances of a String in a String.
-		 *   @param  s  String to alter.
-		 *   @param  f  String to look for.
-		 *   @param  r  String to replace it with, or null to just remove it.
-		 */ 
-		private String replace( String s, String f, String r )
-		{
-		   if (s == null)  return s;
-		   if (f == null)  return s;
-		   if (r == null)  r = &quot;&quot;;
-		
-		   int index01 = s.indexOf( f );
-		   while (index01 != -1)
-		   {
-			  s = s.substring(0,index01) + r + s.substring(index01+f.length());
-			  index01 += r.length();
-			  index01 = s.indexOf( f, index01 );
-		   }
-		   return s;
-		}
-}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000038.html">[Cachewolf-svn] r357 - trunk/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="000041.html">[Cachewolf-svn] [Feature #2203] Markierungen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40">[ date ]</a>
              <a href="thread.html#40">[ thread ]</a>
              <a href="subject.html#40">[ subject ]</a>
              <a href="author.html#40">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
