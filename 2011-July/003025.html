<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r3034 - in trunk/src/CacheWolf: . imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2011-July/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3034%20-%20in%20trunk/src/CacheWolf%3A%20.%20imp&In-Reply-To=%3C20110701105757.7FD874813E9%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003024.html">
   <LINK REL="Next"  HREF="003027.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r3034 - in trunk/src/CacheWolf: . imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3034%20-%20in%20trunk/src/CacheWolf%3A%20.%20imp&In-Reply-To=%3C20110701105757.7FD874813E9%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r3034 - in trunk/src/CacheWolf: . imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Fri Jul  1 12:57:57 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003024.html">[Cachewolf-svn] r3033 - in trunk: res_noewe src/CacheWolf	src/CacheWolf/imp
</A></li>
        <LI>Next message: <A HREF="003027.html">[Cachewolf-svn] r3036 - trunk/res_noewe/webmapservices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3025">[ date ]</a>
              <a href="thread.html#3025">[ thread ]</a>
              <a href="subject.html#3025">[ subject ]</a>
              <a href="author.html#3025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2011-07-01 12:57:57 +0200 (Fri, 01 Jul 2011)
New Revision: 3034

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
1. use Radar or Map Tab in Preferences affects MainTab.java on small screens
2. direct access of pref isbigscreen and usebigicons in DetailsPamel.java
3.  reflecting a non consistent presentation of caches without TBs (for Info of check Extraction String) in SpiderGC.java

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2011-07-01 08:11:00 UTC (rev 3033)
+++ trunk/src/CacheWolf/DetailsPanel.java	2011-07-01 10:57:57 UTC (rev 3034)
@@ -1,28 +1,28 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
 
 import CacheWolf.navi.TransformCoordinates;
@@ -64,7 +64,7 @@
  */
 public class DetailsPanel extends CellPanel {
 
-    // ===== GUI elements =====
+	// ===== GUI elements =====
 	/** way point id. */
 	private static mInput inpWaypoint;
 	/** way point name. */
@@ -135,24 +135,20 @@
 	private boolean blackStatusChanged;
 	/** FIXME */
 	private boolean needsTableUpdate;
-	/** screen is VGA or better */
-	private final boolean isBigScreen;
-	/** use big icons */
-	private final boolean useBigIcons;
-	/** String to display for invalid or not applicable terrain or difficulty values.*/
+	/** String to display for invalid or not applicable terrain or difficulty values. */
 	private final static String DTINVALID = &quot;: -.-&quot;;
-	public boolean evWaypointChanged=false;
-	private String warnedForWaypoint=&quot;&quot;;
+	public boolean evWaypointChanged = false;
+	private String warnedForWaypoint = &quot;&quot;;
 
-    // TODO: move images to image broker
-    //mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgShowMaps, imgAddImages, imgNotes;
+	// TODO: move images to image broker
+	// mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgShowMaps, imgAddImages, imgNotes;
 
 	/**
 	 * public constructor for detail panels. should only be called from main tab.
 	 */
 	public DetailsPanel() {
 		super();
-        // ===== local objects =====
+		// ===== local objects =====
 		/** helper panels to organize layout */
 		CellPanel helperPanel1, helperPanel2, helperPanel3, helperPanel4, helperPanel5;
 
@@ -166,11 +162,9 @@
 		blackStatus = false;
 		blackStatusChanged = false;
 		needsTableUpdate = false;
-		isBigScreen = pref.isBigScreen;
-		useBigIcons = pref.useBigIcons;
 
 		// ===== initialize GUI objects =====
-        // ----- main body -----
+		// ----- main body -----
 
 		helperPanel1 = new CellPanel();
 		helperPanel2 = new CellPanel();
@@ -183,7 +177,7 @@
 		chcType.alwaysDrop = true;
 		chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
 		chcSize.alwaysDrop = true;
-		chcStatus = new mComboBox(CacheHolder.GetGuiLogTypes(),0);
+		chcStatus = new mComboBox(CacheHolder.GetGuiLogTypes(), 0);
 		inpWaypoint = new mInput();
 		inpName = new mInput();
 
@@ -196,7 +190,7 @@
 
 		// ===== put the controls onto the GUI =====
 
-        // ----- helper panels -----
+		// ----- helper panels -----
 
 		btnDiff = new mButton(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: 5.5&quot;);
 		btnDiff.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
@@ -208,10 +202,10 @@
 
 		lblAddiCount = new mLabel(MyLocale.getMsg(1044, &quot;Addis&quot;) + &quot;: 888&quot;);
 
-		btnFoundDate = new mButton(new mImage(useBigIcons ? &quot;calendar_vga.png&quot; : &quot;calendar.png&quot;));
+		btnFoundDate = new mButton(new mImage(pref.useBigIcons ? &quot;calendar_vga.png&quot; : &quot;calendar.png&quot;));
 		btnFoundDate.setToolTip(MyLocale.getMsg(31415, &quot;Set found date / time&quot;));
 
-		btnHiddenDate = new mButton(new mImage(useBigIcons ? &quot;calendar_vga.png&quot;	: &quot;calendar.png&quot;));
+		btnHiddenDate = new mButton(new mImage(pref.useBigIcons ? &quot;calendar_vga.png&quot; : &quot;calendar.png&quot;));
 		btnHiddenDate.setToolTip(MyLocale.getMsg(31415, &quot;Set hidden date&quot;));
 
 		helperPanel1.addNext(chcType, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
@@ -226,7 +220,7 @@
 		helperPanel4.addNext(chcStatus, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 		helperPanel4.addLast(btnFoundDate, DONTSTRETCH, DONTFILL);
 
-		helperPanel5.addNext(inpHidden, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
+		helperPanel5.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 		helperPanel5.addLast(btnHiddenDate, DONTSTRETCH, DONTFILL);
 
 		// ----- main body -----
@@ -242,10 +236,10 @@
 		addLast(helperPanel3, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
 
 		addNext(new mLabel(MyLocale.getMsg(303, &quot;Name:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
+		addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 
 		addNext(new mLabel(MyLocale.getMsg(304, &quot;Coordinates:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		addLast(btnCoordinates.setTag(CellConstants.SPAN, new Dimension(2, 1)),	CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		addLast(btnCoordinates.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 
 		addNext(new mLabel(MyLocale.getMsg(307, &quot;Status:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(helperPanel4, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
@@ -258,56 +252,56 @@
 
 		addLast(attViewer);
 
-		//TODO: decide whether to still use the object without display on small screens to handle notes
-		if (isBigScreen) {
+		// TODO: decide whether to still use the object without display on small screens to handle notes
+		if (pref.isBigScreen) {
 			addLast(new mLabel(MyLocale.getMsg(308, &quot;Notes:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 			waypointNotes = new mTextPad();
 			waypointNotes.modify(ControlConstants.NotEditable, 0);
 			addLast(new MyScrollBarPanel(waypointNotes));
 		}
 
-		//FIXME: get rid of this
-		imgBlack = new mImage(useBigIcons?&quot;is_black_vga.png&quot;:&quot;is_black.png&quot;);
+		// FIXME: get rid of this
+		imgBlack = new mImage(pref.useBigIcons ? &quot;is_black_vga.png&quot; : &quot;is_black.png&quot;);
 		imgBlack.transparentColor = Color.White;
-		imgBlackNo = new mImage(useBigIcons ? &quot;no_black_vga.png&quot; : &quot;no_black.png&quot;);
+		imgBlackNo = new mImage(pref.useBigIcons ? &quot;no_black_vga.png&quot; : &quot;no_black.png&quot;);
 		imgBlackNo.transparentColor = Color.Black;
-		imgShowBug = new mImage(useBigIcons ? &quot;bug_vga.gif&quot;:&quot;bug.gif&quot;);
-		imgShowBugNo = new mImage(useBigIcons ? &quot;bug_no_vga.gif&quot;:&quot;bug_no.gif&quot;);
+		imgShowBug = new mImage(pref.useBigIcons ? &quot;bug_vga.gif&quot; : &quot;bug.gif&quot;);
+		imgShowBugNo = new mImage(pref.useBigIcons ? &quot;bug_no_vga.gif&quot; : &quot;bug_no.gif&quot;);
 	}
 
 	private CellPanel createToolsPanel() {
 		final CellPanel pnlTools = new CellPanel();
 
-		btnNewWpt = new mButton(imgNewWpt = new mImage(useBigIcons ? &quot;newwpt_vga.png&quot; : &quot;newwpt.png&quot;));
+		btnNewWpt = new mButton(imgNewWpt = new mImage(pref.useBigIcons ? &quot;newwpt_vga.png&quot; : &quot;newwpt.png&quot;));
 		// FIXME: get an image with proper transparency
 		imgNewWpt.transparentColor = new Color(255, 0, 0);
 		btnNewWpt.setToolTip(MyLocale.getMsg(311, &quot;Create Waypoint&quot;));
 
-		btnGoto = new mButton(imgGoto = new mImage(useBigIcons ? &quot;goto_vga.png&quot;	: &quot;goto.png&quot;));
+		btnGoto = new mButton(imgGoto = new mImage(pref.useBigIcons ? &quot;goto_vga.png&quot; : &quot;goto.png&quot;));
 		// FIXME: get an image with proper transparency
 		imgGoto.transparentColor = Color.White;
 		btnGoto.setToolTip(MyLocale.getMsg(345, &quot;Goto these coordinates&quot;));
 
-		btnShowBug = new mButton(new mImage(useBigIcons ? &quot;bug_no_vga.gif&quot; : &quot;bug_no.gif&quot;));
+		btnShowBug = new mButton(new mImage(pref.useBigIcons ? &quot;bug_no_vga.gif&quot; : &quot;bug_no.gif&quot;));
 		btnShowBug.setToolTip(MyLocale.getMsg(346, &quot;Show travelbugs&quot;));
 
-		btnShowMap = new mButton(new mImage(useBigIcons ? &quot;globe_small_vga.gif&quot; : &quot;globe_small.gif&quot;));
+		btnShowMap = new mButton(new mImage(pref.useBigIcons ? &quot;globe_small_vga.gif&quot; : &quot;globe_small.gif&quot;));
 		btnShowMap.setToolTip(MyLocale.getMsg(347, &quot;Show map&quot;));
 
-		btnAddPicture = new mButton(new mImage(useBigIcons ? &quot;images_vga.gif&quot; : &quot;images.gif&quot;));
+		btnAddPicture = new mButton(new mImage(pref.useBigIcons ? &quot;images_vga.gif&quot; : &quot;images.gif&quot;));
 		btnAddPicture.setToolTip(MyLocale.getMsg(348, &quot;Add user pictures&quot;));
 
-		btnBlack = new mButton(imgBlack = new mImage(useBigIcons ? &quot;no_black_vga.png&quot; : &quot;no_black.png&quot;));
+		btnBlack = new mButton(imgBlack = new mImage(pref.useBigIcons ? &quot;no_black_vga.png&quot; : &quot;no_black.png&quot;));
 		// FIXME: get an image with proper transparency
 		imgBlack.transparentColor = Color.Black;
 		btnBlack.setToolTip(MyLocale.getMsg(349, &quot;Toggle Blacklist status&quot;));
 
-		btnNotes = new mButton(imgNotes = new mImage(useBigIcons ? &quot;notes_vga.gif&quot; : &quot;notes.gif&quot;));
+		btnNotes = new mButton(imgNotes = new mImage(pref.useBigIcons ? &quot;notes_vga.gif&quot; : &quot;notes.gif&quot;));
 		// FIXME: get an image with proper transparency
 		imgNotes.transparentColor = Color.DarkBlue;
 		btnNotes.setToolTip(MyLocale.getMsg(351, &quot;Add/Edit notes&quot;));
 
-		btnAddDateTime = new mButton(new mImage(useBigIcons ? &quot;date_time_vga.gif&quot; : &quot;date_time.gif&quot;));
+		btnAddDateTime = new mButton(new mImage(pref.useBigIcons ? &quot;date_time_vga.gif&quot; : &quot;date_time.gif&quot;));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, &quot;Add timestamp to notes&quot;));
 
 		pnlTools.addNext(btnNewWpt);
@@ -425,7 +419,7 @@
 		}
 		lblAddiCount.setText(MyLocale.getMsg(1044, &quot;Addis&quot;) + &quot;: &quot; + addiCount);
 
-		if (isBigScreen) {
+		if (pref.isBigScreen) {
 			waypointNotes.setText(ch.getCacheDetails(true).getCacheNotes());
 		}
 	}
@@ -436,307 +430,275 @@
 	 */
 	public void createWptName() {
 		final String wpt = inpWaypoint.getText().toUpperCase();
-		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-				&amp;&amp; Global.mainTab.mainCache != null
-				&amp;&amp; (Global.mainTab.mainCache.startsWith(&quot;GC&quot;)
-					|| OC.isOC(Global.mainTab.mainCache) || Global.mainTab.mainCache.startsWith(&quot;CW&quot;))
+		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) &amp;&amp; Global.mainTab.mainCache != null &amp;&amp; (Global.mainTab.mainCache.startsWith(&quot;GC&quot;) || OC.isOC(Global.mainTab.mainCache) || Global.mainTab.mainCache.startsWith(&quot;CW&quot;))
 				&amp;&amp; wpt.startsWith(&quot;CW&quot;)) {
 			// for creating the Addiname on creating a new Waypoint
-			Global.mainTab.lastselected = Global.mainTab.mainCache; 
+			Global.mainTab.lastselected = Global.mainTab.mainCache;
 
-			inpWaypoint.setText(Global.getProfile().getNewAddiWayPointName(
-					Global.mainTab.mainCache));
+			inpWaypoint.setText(Global.getProfile().getNewAddiWayPointName(Global.mainTab.mainCache));
 		}
-		if (!CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-				&amp;&amp; !(wpt.startsWith(&quot;GC&quot;)
-					|| OC.isOC(wpt) || wpt.startsWith(&quot;CW&quot;))) {
+		if (!CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) &amp;&amp; !(wpt.startsWith(&quot;GC&quot;) || OC.isOC(wpt) || wpt.startsWith(&quot;CW&quot;))) {
 			inpWaypoint.setText(Global.getProfile().getNewWayPointName());
 		}
 	}
 
-    /**
-     * Method to react to a user input.
-     */
-    public void onEvent(final Event ev) {
-        if (ev instanceof DataChangeEvent) {
-            if (ev.target == inpWaypoint) {
-                if (evWaypointChanged) {
-                    String iTmp=inpWaypoint.getText();
-                    String uTmp=iTmp.toUpperCase();
-                    if (!iTmp.equals(uTmp)){
-                        inpWaypoint.setText(uTmp); // If user entered LowerCase -&gt; convert directly to UpperCase
-                        evWaypointChanged=false; //next DataChangeEvent fired by change to UpperCase will be ignored
-                    }
-                    // already warned(multi same DataChangeEvents) or same waypointname as before edit !!!
-                    if(!warnedForWaypoint.equals(uTmp) &amp;&amp; !uTmp.equals(this.cache.getWayPoint())){
-                        if ((new File(profile.dataDir + iTmp.toLowerCase()+&quot;.xml&quot;)).exists()) {
-                            warnedForWaypoint=uTmp; // before MessageBox cause Multithread DataChangeEvents
-                            // filename is LowerCase
-                            new MessageBox(&quot;Warning :&quot;,uTmp+&quot;\n&quot;+MyLocale.getMsg(275,&quot;Waypoint already exists!&quot;),MessageBox.OKB).execute();
-                            // revert waypointname
-                            inpWaypoint.setText(this.cache.getWayPoint());
-                        }
-                    }
-                }
-                else {
-                    // first DataChangeEvent is fired by Klick into (after reload).
-                    // that really didn't change anything
-                    evWaypointChanged=true;
-                }
-                // FIXME: if name was changed, we should rename the waypoint.xml file. how? where?
-            } else if (ev.target == chcType) {
-                createWptName();
-                if (CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.selectedIndex))) {
-                    activateControl(btnTerr);
-                    activateControl(btnDiff);
-                    activateControl(chcSize);
-                    activateControl(inpOwner);
-                    activateControl(inpHidden);
-                    activateControl(btnShowBug);
-                    activateControl(btnBlack);
-                } else {
-                    deactivateControl(btnTerr);
-                    deactivateControl(btnDiff);
-                    deactivateControl(chcSize);
-                    deactivateControl(inpOwner);
-                    deactivateControl(inpHidden);
-                    deactivateControl(btnShowBug);
-                    deactivateControl(btnBlack);
-                    chcSize.select(0);
-                    btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + DTINVALID);
-                    btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + DTINVALID);
-                }
-            }
-            //FIXME: check if something was actually changed, since datacachnge events also occur if you just hop through the fileds with the tab key (Why? don't know!)
-            dirtyDetails = true;
-            needsTableUpdate = true;
-        }
-        if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED) {
-            if (ev.target == btnNotes) {
-                dirtyNotes = true; // TODO I think this is redundant, because
-                                    // the notes are saved separately by the notes screen itself
-                final NotesScreen nsc = new NotesScreen(cache.getCacheDetails(true));
-                nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
-                if (isBigScreen) {
-                    waypointNotes.setText(cache.getCacheDetails(true).getCacheNotes());
-                }
-            } else if (ev.target == btnShowMap) {
-                Global.mainTab.SwitchToMovingMap(cache.pos, true);
-            } else if (ev.target == btnShowBug) {
-                // InfoScreen is = new InfoScreen(thisCache.Travelbugs.toHtml(),
-                // &quot;Travelbugs&quot;,
-                // false, pref);
-                // is.execute();
-                final TravelbugInCacheScreen ts = new TravelbugInCacheScreen(cache.getCacheDetails(true).Travelbugs.toHtml(),	&quot;Travelbugs&quot;);
-                ts.execute(this.getFrame(), Gui.CENTER_FRAME);
-            /* not fully implemented
-            } else if (ev.target == btnCenter) {
-                final CWPoint cp = new CWPoint(cache.LatLon);
-                if (cp.isValid()) {
-                    pref.setCurCentrePt(cp);
-                } else {
-                    final MessageBox tmpMB = new MessageBox(
-                            MyLocale.getMsg(312, &quot;Error&quot;),
-                            MyLocale.getMsg(4111, &quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;),
-                            FormBase.OKB);
-                    tmpMB.exec();
-                }
-            */
+	/**
+	 * Method to react to a user input.
+	 */
+	public void onEvent(final Event ev) {
+		if (ev instanceof DataChangeEvent) {
+			if (ev.target == inpWaypoint) {
+				if (evWaypointChanged) {
+					String iTmp = inpWaypoint.getText();
+					String uTmp = iTmp.toUpperCase();
+					if (!iTmp.equals(uTmp)) {
+						inpWaypoint.setText(uTmp); // If user entered LowerCase -&gt; convert directly to UpperCase
+						evWaypointChanged = false; // next DataChangeEvent fired by change to UpperCase will be ignored
+					}
+					// already warned(multi same DataChangeEvents) or same waypointname as before edit !!!
+					if (!warnedForWaypoint.equals(uTmp) &amp;&amp; !uTmp.equals(this.cache.getWayPoint())) {
+						if ((new File(profile.dataDir + iTmp.toLowerCase() + &quot;.xml&quot;)).exists()) {
+							warnedForWaypoint = uTmp; // before MessageBox cause Multithread DataChangeEvents
+							// filename is LowerCase
+							new MessageBox(&quot;Warning :&quot;, uTmp + &quot;\n&quot; + MyLocale.getMsg(275, &quot;Waypoint already exists!&quot;), MessageBox.OKB).execute();
+							// revert waypointname
+							inpWaypoint.setText(this.cache.getWayPoint());
+						}
+					}
+				} else {
+					// first DataChangeEvent is fired by Klick into (after reload).
+					// that really didn't change anything
+					evWaypointChanged = true;
+				}
+				// FIXME: if name was changed, we should rename the waypoint.xml file. how? where?
+			} else if (ev.target == chcType) {
+				createWptName();
+				if (CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.selectedIndex))) {
+					activateControl(btnTerr);
+					activateControl(btnDiff);
+					activateControl(chcSize);
+					activateControl(inpOwner);
+					activateControl(inpHidden);
+					activateControl(btnShowBug);
+					activateControl(btnBlack);
+				} else {
+					deactivateControl(btnTerr);
+					deactivateControl(btnDiff);
+					deactivateControl(chcSize);
+					deactivateControl(inpOwner);
+					deactivateControl(inpHidden);
+					deactivateControl(btnShowBug);
+					deactivateControl(btnBlack);
+					chcSize.select(0);
+					btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + DTINVALID);
+					btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + DTINVALID);
+				}
+			}
+			// FIXME: check if something was actually changed, since datacachnge events also occur if you just hop through the fileds with the tab key (Why? don't know!)
+			dirtyDetails = true;
+			needsTableUpdate = true;
+		}
+		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED) {
+			if (ev.target == btnNotes) {
+				dirtyNotes = true; // TODO I think this is redundant, because
+									// the notes are saved separately by the notes screen itself
+				final NotesScreen nsc = new NotesScreen(cache.getCacheDetails(true));
+				nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
+				if (pref.isBigScreen) {
+					waypointNotes.setText(cache.getCacheDetails(true).getCacheNotes());
+				}
+			} else if (ev.target == btnShowMap) {
+				Global.mainTab.SwitchToMovingMap(cache.pos, true);
+			} else if (ev.target == btnShowBug) {
+				// InfoScreen is = new InfoScreen(thisCache.Travelbugs.toHtml(),
+				// &quot;Travelbugs&quot;,
+				// false, pref);
+				// is.execute();
+				final TravelbugInCacheScreen ts = new TravelbugInCacheScreen(cache.getCacheDetails(true).Travelbugs.toHtml(), &quot;Travelbugs&quot;);
+				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
+				/*
+				 * not fully implemented
+				 * } else if (ev.target == btnCenter) {
+				 * final CWPoint cp = new CWPoint(cache.LatLon);
+				 * if (cp.isValid()) {
+				 * pref.setCurCentrePt(cp);
+				 * } else {
+				 * final MessageBox tmpMB = new MessageBox(
+				 * MyLocale.getMsg(312, &quot;Error&quot;),
+				 * MyLocale.getMsg(4111, &quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;),
+				 * FormBase.OKB);
+				 * tmpMB.exec();
+				 * }
+				 */
 
-            } else if (ev.target == btnAddDateTime) {
-                dirtyNotes = true;
+			} else if (ev.target == btnAddDateTime) {
+				dirtyNotes = true;
 
-                final StringBuffer newNote = new StringBuffer();
-                newNote.append(cache.getCacheDetails(true).getCacheNotes());
+				final StringBuffer newNote = new StringBuffer();
+				newNote.append(cache.getCacheDetails(true).getCacheNotes());
 
-                final Time dtm = new Time();
-                dtm.getTime();
-                dtm.setFormat(&quot;E dd.MM.yyyy '/' HH:mm&quot;);
+				final Time dtm = new Time();
+				dtm.getTime();
+				dtm.setFormat(&quot;E dd.MM.yyyy '/' HH:mm&quot;);
 
-                if (newNote.length() &gt; 0) {
-                    newNote.append('\n');
-                }
-                newNote.append(dtm.toString()).append('\n');
+				if (newNote.length() &gt; 0) {
+					newNote.append('\n');
+				}
+				newNote.append(dtm.toString()).append('\n');
 
-                cache.getCacheDetails(true).setCacheNotes(newNote.toString());
-                //FIXME: better use saveDirtyWaypoint()?
-                cache.save();
-            } else if (ev.target == btnAddPicture) {
-                cache.getCacheDetails(true).addUserImage(profile);
-            } else if (ev.target == btnBlack) {
-                if (cache.is_black()) {
-                    cache.setBlack(false);
-                    btnBlack.image = imgBlackNo;
-                } else {
-                    cache.setBlack(true);
-                    btnBlack.image = imgBlack;
-                }
-                blackStatus = cache.is_black();
-                cache.setAttributesToAddiWpts();
-                btnBlack.repaintNow();
-                dirtyDetails = true;
-                blackStatusChanged = true;
-            } else if (ev.target == btnNewWpt) {
-                final CacheHolder ch = new CacheHolder();
-                ch.setLatLon(cache.getLatLon());
-                ch.pos = new CWPoint(cache.pos);
-                ch.setType(CacheType.CW_TYPE_STAGE);
-                ch.setHard(CacheTerrDiff.CW_DT_UNSET);
-                ch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
-                ch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
-                Global.mainTab.newWaypoint(ch);
-            } else if (ev.target == btnGoto) {
-                // FIXME: if something changed saveDirtyWaypoint();
-                Global.mainTab.gotoP.setDestinationAndSwitch(cache);
-            } else if (ev.target == btnCoordinates) {
-                CWPoint coords = new CWPoint(btnCoordinates.getText(), TransformCoordinates.CW);
-                if(Vm.isMobile()){
-                    InputScreen InScr = new InputScreen(TransformCoordinates.CW, true);
-                    if (coords.isValid())	InScr.setCoords(coords);
-                        else InScr.setCoords(new CWPoint(0,0));
-                    if (InScr.execute(null, CellConstants.TOP) == FormBase.IDOK)
-                    {
-                        dirtyDetails = true;
-                        coords = InScr.getCoords();
-                        Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
-                        cache.pos.set(coords);
-                        btnCoordinates.setText(coords.toString());
-                        cache.setLatLon(coords.toString());
-                        // If the current centre is valid, calculate the distance and bearing to it
-                        final CWPoint centre = Global.getPref().getCurCentrePt();
-                        if (centre.isValid()) {
-                            cache.calcDistance(centre); // todo perhaps sortTable
-                        }
-                    }
-                }else{
-                    final CoordsScreen cs = new CoordsScreen(true);
-                    cs.setFields(coords, TransformCoordinates.CW);
-                    if (cs.execute() == FormBase.IDOK) {
-                        dirtyDetails = true;
-                        coords = cs.getCoords();
-                        Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
-                        cache.pos.set(coords);
-                        btnCoordinates.setText(coords.toString());
-                        cache.setLatLon(coords.toString());
-                        // If the current centre is valid, calculate the distance and bearing to it
-                        final CWPoint centre = Global.getPref().getCurCentrePt();
-                        if (centre.isValid()) {
-                            cache.calcDistance(centre); // todo perhaps sortTable
-                        }
-                    }
-                }
-            } else if (ev.target == btnFoundDate) {
-            	int msgNr=318; // normal found
-            	if (cache.getType() == CacheType.CW_TYPE_WEBCAM) { msgNr=361;}
-            	else if (cache.getType() == CacheType.CW_TYPE_EVENT 
-            			|| cache.getType() == CacheType.CW_TYPE_MEGA_EVENT) { msgNr=355;}
-                // DateChooser.dayFirst=true;
-                final DateTimeChooser dc = new DateTimeChooser(Vm.getLocale());
-                dc.title = MyLocale.getMsg(328, &quot;Date found&quot;);
-                dc.setPreferredSize(240, 240);
-                String foundDate = chcStatus.getText();
-                if (foundDate.startsWith(MyLocale.getMsg(msgNr, &quot;Found&quot;) + &quot; &quot;)) {
-                    foundDate = foundDate.substring(MyLocale.getMsg(msgNr, &quot;Found&quot;).length() + 1);
-                }
-                else if (foundDate.endsWith(MyLocale.getMsg(319, &quot;not Found&quot;))) {
-                    foundDate = foundDate.substring(0,foundDate.length()-MyLocale.getMsg(319, &quot;not Found&quot;).length());
-                    dc.title=MyLocale.getMsg(330,&quot;Date Not Found&quot;);
-                }
-                foundDate=foundDate.trim();
-                if (foundDate.length()&gt;0 &amp;&amp; foundDate.indexOf('-')&gt;0) { //Don't try and parse empty date
-                    final Time t = new Time();
-                    try {
-                        t.parse(foundDate, &quot;y-M-d H:m&quot;);
-                    } catch (IllegalArgumentException e) {
-                        try {
-                            t.parse(foundDate, &quot;y-M-d&quot;);
-                        } catch (IllegalArgumentException e1) {
-                            Global.getPref().log(&quot;No parsable date given - should not appear (&quot;+foundDate+&quot;)&quot;, e1, true);
-                        }
-                    }
+				cache.getCacheDetails(true).setCacheNotes(newNote.toString());
+				// FIXME: better use saveDirtyWaypoint()?
+				cache.save();
+			} else if (ev.target == btnAddPicture) {
+				cache.getCacheDetails(true).addUserImage(profile);
+			} else if (ev.target == btnBlack) {
+				if (cache.is_black()) {
+					cache.setBlack(false);
+					btnBlack.image = imgBlackNo;
+				} else {
+					cache.setBlack(true);
+					btnBlack.image = imgBlack;
+				}
+				blackStatus = cache.is_black();
+				cache.setAttributesToAddiWpts();
+				btnBlack.repaintNow();
+				dirtyDetails = true;
+				blackStatusChanged = true;
+			} else if (ev.target == btnNewWpt) {
+				final CacheHolder ch = new CacheHolder();
+				ch.setLatLon(cache.getLatLon());
+				ch.pos = new CWPoint(cache.pos);
+				ch.setType(CacheType.CW_TYPE_STAGE);
+				ch.setHard(CacheTerrDiff.CW_DT_UNSET);
+				ch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
+				ch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
+				Global.mainTab.newWaypoint(ch);
+			} else if (ev.target == btnGoto) {
+				// FIXME: if something changed saveDirtyWaypoint();
+				Global.mainTab.gotoP.setDestinationAndSwitch(cache);
+			} else if (ev.target == btnCoordinates) {
+				CWPoint coords = new CWPoint(btnCoordinates.getText(), TransformCoordinates.CW);
+				if (Vm.isMobile()) {
+					InputScreen InScr = new InputScreen(TransformCoordinates.CW, true);
+					if (coords.isValid())
+						InScr.setCoords(coords);
+					else
+						InScr.setCoords(new CWPoint(0, 0));
+					if (InScr.execute(null, CellConstants.TOP) == FormBase.IDOK) {
+						dirtyDetails = true;
+						coords = InScr.getCoords();
+						Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
+						cache.pos.set(coords);
+						btnCoordinates.setText(coords.toString());
+						cache.setLatLon(coords.toString());
+						// If the current centre is valid, calculate the distance and bearing to it
+						final CWPoint centre = Global.getPref().getCurCentrePt();
+						if (centre.isValid()) {
+							cache.calcDistance(centre); // todo perhaps sortTable
+						}
+					}
+				} else {
+					final CoordsScreen cs = new CoordsScreen(true);
+					cs.setFields(coords, TransformCoordinates.CW);
+					if (cs.execute() == FormBase.IDOK) {
+						dirtyDetails = true;
+						coords = cs.getCoords();
+						Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
+						cache.pos.set(coords);
+						btnCoordinates.setText(coords.toString());
+						cache.setLatLon(coords.toString());
+						// If the current centre is valid, calculate the distance and bearing to it
+						final CWPoint centre = Global.getPref().getCurCentrePt();
+						if (centre.isValid()) {
+							cache.calcDistance(centre); // todo perhaps sortTable
+						}
+					}
+				}
+			} else if (ev.target == btnFoundDate) {
+				int msgNr = 318; // normal found
+				if (cache.getType() == CacheType.CW_TYPE_WEBCAM) {
+					msgNr = 361;
+				} else if (cache.getType() == CacheType.CW_TYPE_EVENT || cache.getType() == CacheType.CW_TYPE_MEGA_EVENT) {
+					msgNr = 355;
+				}
+				// DateChooser.dayFirst=true;
+				final DateTimeChooser dc = new DateTimeChooser(Vm.getLocale());
+				dc.title = MyLocale.getMsg(328, &quot;Date found&quot;);
+				dc.setPreferredSize(240, 240);
+				String foundDate = chcStatus.getText();
+				if (foundDate.startsWith(MyLocale.getMsg(msgNr, &quot;Found&quot;) + &quot; &quot;)) {
+					foundDate = foundDate.substring(MyLocale.getMsg(msgNr, &quot;Found&quot;).length() + 1);
+				} else if (foundDate.endsWith(MyLocale.getMsg(319, &quot;not Found&quot;))) {
+					foundDate = foundDate.substring(0, foundDate.length() - MyLocale.getMsg(319, &quot;not Found&quot;).length());
+					dc.title = MyLocale.getMsg(330, &quot;Date Not Found&quot;);
+				}
+				foundDate = foundDate.trim();
+				if (foundDate.length() &gt; 0 &amp;&amp; foundDate.indexOf('-') &gt; 0) { // Don't try and parse empty date
+					final Time t = new Time();
+					try {
+						t.parse(foundDate, &quot;y-M-d H:m&quot;);
+					} catch (IllegalArgumentException e) {
+						try {
+							t.parse(foundDate, &quot;y-M-d&quot;);
+						} catch (IllegalArgumentException e1) {
+							Global.getPref().log(&quot;No parsable date given - should not appear (&quot; + foundDate + &quot;)&quot;, e1, true);
+						}
+					}
 
-                    dc.reset(t);
-                }
-                // We can create a not found log with date in two ways:
-                //   1) Exiting the date-time dialog by clicking the x if the status is empty (somewhat
-                //      non-standard but quick and dirty)
-                //   2) Exiting the date-time dialog by clicking the tick. Then we check whether
-                //      the status field was preset with the not-found text. If yes it stays a not found
-                //      but the date is prepended
-                //TODO: The functions for extracting the date and the found/not-found text should not be in the GUI
-                int retCode=dc.execute();
-                if (retCode == ewe.ui.FormBase.IDOK &amp;&amp; !chcStatus.getText().endsWith(MyLocale.getMsg(319, &quot;not Found&quot;))) {
-                    chcStatus.setText(MyLocale.getMsg(msgNr, &quot;Found&quot;) + &quot; &quot;
-                                    + Convert.toString(dc.year) + &quot;-&quot;
-                                    + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-                                    + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
-                                    + dc.time);
-                    dirtyDetails = true;
-                }
-                else if (chcStatus.getText().length()==0 ||
-                		(retCode==ewe.ui.FormBase.IDOK &amp;&amp; chcStatus.getText().endsWith(MyLocale.getMsg(319, &quot;not Found&quot;)) )) {
-                    chcStatus.setText(Convert.toString(dc.year) + &quot;-&quot;
-                            + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-                            + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
-                            + dc.time + &quot; &quot;
-                            + MyLocale.getMsg(319, &quot;not Found&quot;)
-                            );
-                    dirtyDetails = true;
-                }
-            } else if (ev.target == btnHiddenDate) {
-                DateChooser.dayFirst = true;
-                final DateChooser dc = new DateChooser(Vm.getLocale());
-                dc.title = MyLocale.getMsg(329, &quot;Hidden date&quot;);
-                dc.setPreferredSize(240, 240);
-                if (inpHidden.getText().length() == 10)
-                    try {
-                        dc.setDate(new Time(Convert.parseInt(inpHidden
-                                .getText().substring(8)), Convert
-                                .parseInt(inpHidden.getText().substring(5, 7)),
-                                Convert.parseInt(inpHidden.getText().substring(
-                                        0, 4))));
-                    } catch (NumberFormatException e) {
-                        dc.reset(new Time());
-                    }
-                if (dc.execute() == ewe.ui.FormBase.IDOK) {
-                    inpHidden.setText(Convert.toString(dc.year) + &quot;-&quot;
-                            + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-                            + MyLocale.formatLong(dc.day, &quot;00&quot;));
-                    dirtyDetails = true;
-                    // profile.hasUnsavedChanges=true;
-                }
-            } else if (ev.target == btnTerr) {
-                int returnValue;
-                final TerrDiffForm tdf = new TerrDiffForm(true,
-                        decodeTerrDiff(btnTerr,
-                                MyLocale.getMsg(1001, &quot;T&quot;),
-                                CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-                            )
-                        );
-                returnValue = tdf.execute();
-                if (returnValue == 1) {
-                    btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + &quot;: &quot; + CacheTerrDiff.longDT(tdf.getDT()));
-                    dirtyDetails = true;
-                }
-            } else if (ev.target == btnDiff) {
-                int returnValue;
-                final TerrDiffForm tdf = new TerrDiffForm(false,
-                        decodeTerrDiff(btnDiff,
-                                MyLocale.getMsg(1001, &quot;D&quot;),
-                                CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-                            )
-                        );
+					dc.reset(t);
+				}
+				// We can create a not found log with date in two ways:
+				// 1) Exiting the date-time dialog by clicking the x if the status is empty (somewhat
+				// non-standard but quick and dirty)
+				// 2) Exiting the date-time dialog by clicking the tick. Then we check whether
+				// the status field was preset with the not-found text. If yes it stays a not found
+				// but the date is prepended
+				// TODO: The functions for extracting the date and the found/not-found text should not be in the GUI
+				int retCode = dc.execute();
+				if (retCode == ewe.ui.FormBase.IDOK &amp;&amp; !chcStatus.getText().endsWith(MyLocale.getMsg(319, &quot;not Found&quot;))) {
+					chcStatus.setText(MyLocale.getMsg(msgNr, &quot;Found&quot;) + &quot; &quot; + Convert.toString(dc.year) + &quot;-&quot; + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot; + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot; + dc.time);
+					dirtyDetails = true;
+				} else if (chcStatus.getText().length() == 0 || (retCode == ewe.ui.FormBase.IDOK &amp;&amp; chcStatus.getText().endsWith(MyLocale.getMsg(319, &quot;not Found&quot;)))) {
+					chcStatus.setText(Convert.toString(dc.year) + &quot;-&quot; + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot; + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot; + dc.time + &quot; &quot; + MyLocale.getMsg(319, &quot;not Found&quot;));
+					dirtyDetails = true;
+				}
+			} else if (ev.target == btnHiddenDate) {
+				DateChooser.dayFirst = true;
+				final DateChooser dc = new DateChooser(Vm.getLocale());
+				dc.title = MyLocale.getMsg(329, &quot;Hidden date&quot;);
+				dc.setPreferredSize(240, 240);
+				if (inpHidden.getText().length() == 10)
+					try {
+						dc.setDate(new Time(Convert.parseInt(inpHidden.getText().substring(8)), Convert.parseInt(inpHidden.getText().substring(5, 7)), Convert.parseInt(inpHidden.getText().substring(0, 4))));
+					} catch (NumberFormatException e) {
+						dc.reset(new Time());
+					}
+				if (dc.execute() == ewe.ui.FormBase.IDOK) {
+					inpHidden.setText(Convert.toString(dc.year) + &quot;-&quot; + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot; + MyLocale.formatLong(dc.day, &quot;00&quot;));
+					dirtyDetails = true;
+					// profile.hasUnsavedChanges=true;
+				}
+			} else if (ev.target == btnTerr) {
+				int returnValue;
+				final TerrDiffForm tdf = new TerrDiffForm(true, decodeTerrDiff(btnTerr, MyLocale.getMsg(1001, &quot;T&quot;), CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))));
+				returnValue = tdf.execute();
+				if (returnValue == 1) {
+					btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + &quot;: &quot; + CacheTerrDiff.longDT(tdf.getDT()));
+					dirtyDetails = true;
+				}
+			} else if (ev.target == btnDiff) {
+				int returnValue;
+				final TerrDiffForm tdf = new TerrDiffForm(false, decodeTerrDiff(btnDiff, MyLocale.getMsg(1001, &quot;D&quot;), CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))));
 
-                returnValue = tdf.execute();
-                if (returnValue == 1) {
-                    btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: &quot;
-                            + CacheTerrDiff.longDT(tdf.getDT()));
-                    dirtyDetails = true;
-                }
-            }
-            ev.consumed = true;
-        }
-    }
+				returnValue = tdf.execute();
+				if (returnValue == 1) {
+					btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: &quot; + CacheTerrDiff.longDT(tdf.getDT()));
+					dirtyDetails = true;
+				}
+			}
+			ev.consumed = true;
+		}
+	}
 
 	/** allow user input on control item */
 	private void activateControl(final Control ctrl) {
@@ -751,39 +713,39 @@
 	}
 
 	public void saveDirtyWaypoint() {
-		//FIXME: here we should check if the data is now different from what it used to be when calling the details panel instead of relying on dirty flags
-		//FIXME: take care of renaming waypoints
-		//FIXME: add method to convert back text of difficulty &amp; terrain buttons
-		//FIXME: check if manual changes have converted a cache from incomplete to complete
+		// FIXME: here we should check if the data is now different from what it used to be when calling the details panel instead of relying on dirty flags
+		// FIXME: take care of renaming waypoints
+		// FIXME: add method to convert back text of difficulty &amp; terrain buttons
+		// FIXME: check if manual changes have converted a cache from incomplete to complete
 
 		// We have to update two objects: thisCache (a CacheHolderDetail) which
 		// contains
 		// the full cache which will be written to the cache.xml file AND
 		// the CacheHolder object which sits in cacheDB
-		//FIXME: so how do we do this??
+		// FIXME: so how do we do this??
 
-		int msgNr=318; // normal found
-    	if (cache.getType() == CacheType.CW_TYPE_WEBCAM) { msgNr=361;}
-    	else if (cache.getType() == CacheType.CW_TYPE_EVENT 
-    			|| cache.getType() == CacheType.CW_TYPE_MEGA_EVENT) { msgNr=355;}
+		int msgNr = 318; // normal found
+		if (cache.getType() == CacheType.CW_TYPE_WEBCAM) {
+			msgNr = 361;
+		} else if (cache.getType() == CacheType.CW_TYPE_EVENT || cache.getType() == CacheType.CW_TYPE_MEGA_EVENT) {
+			msgNr = 355;
+		}
 
 		// Strip the found message if the status contains a date
-		if (chcStatus.getText().startsWith(MyLocale.getMsg(msgNr, &quot;Found&quot;)) &amp;&amp;
-			chcStatus.getText().length() &gt;= MyLocale.getMsg(msgNr, &quot;Found&quot;).length() + 11) {
+		if (chcStatus.getText().startsWith(MyLocale.getMsg(msgNr, &quot;Found&quot;)) &amp;&amp; chcStatus.getText().length() &gt;= MyLocale.getMsg(msgNr, &quot;Found&quot;).length() + 11) {
 			cache.setCacheStatus(chcStatus.getText().substring(MyLocale.getMsg(msgNr, &quot;Found&quot;).length() + 1));
 		} else {
 			cache.setCacheStatus(chcStatus.getText());
 		}
 
-		if (chcStatus.getText().startsWith(MyLocale.getMsg(msgNr, &quot;Found&quot;)) ||
-			(cache.getCacheStatus().length() == 10 || cache.getCacheStatus().length() == 16) &amp;&amp; cache.getCacheStatus().charAt(4) == '-') {
+		if (chcStatus.getText().startsWith(MyLocale.getMsg(msgNr, &quot;Found&quot;)) || (cache.getCacheStatus().length() == 10 || cache.getCacheStatus().length() == 16) &amp;&amp; cache.getCacheStatus().charAt(4) == '-') {
 			// Use same heuristic condition as in setDetails(CacheHolder) to
 			// determine, if this
 			// cache
 			// has to considered as found.
 			cache.setFound(true);
-		}
-		else cache.setFound(false);
+		} else
+			cache.setFound(false);
 
 		if (!cache.isAddiWpt()) {
 			cache.setCacheOwner(inpOwner.getText().trim());
@@ -791,13 +753,7 @@
 		cache.setOwned(cache.getCacheStatus().equals(MyLocale.getMsg(320, &quot;Owner&quot;)));
 		// Avoid setting is_owned if alias is empty and username is empty
 		if (!cache.is_owned()) {
-			cache.setOwned(
-					(!pref.myAlias.equals(&quot;&quot;) &amp;&amp;
-						pref.myAlias.equals(cache.getCacheOwner()))
-					||
-					(!pref.myAlias2.equals(&quot;&quot;) &amp;&amp;
-						pref.myAlias2.equals(cache.getCacheOwner()))
-					);
+			cache.setOwned((!pref.myAlias.equals(&quot;&quot;) &amp;&amp; pref.myAlias.equals(cache.getCacheOwner())) || (!pref.myAlias2.equals(&quot;&quot;) &amp;&amp; pref.myAlias2.equals(cache.getCacheOwner())));
 		}
 		cache.setBlack(blackStatus);
 		final String oldWaypoint = cache.getWayPoint();
@@ -833,51 +789,57 @@
 		 * - the cachetype changed from addi-&gt;normal or from normal-&gt;addi
 		 * - the old cachetype or the new cachetype were 'addi' and the waypointname has changed
 		 */
-		if (CacheType.isAddiWpt(cache.getType()) != CacheType.isAddiWpt(oldType) ||
-			((CacheType.isAddiWpt(cache.getType()) || CacheType.isAddiWpt(oldType)) &amp;&amp; !cache.getWayPoint().equals(oldWaypoint))) {
+		if (CacheType.isAddiWpt(cache.getType()) != CacheType.isAddiWpt(oldType) || ((CacheType.isAddiWpt(cache.getType()) || CacheType.isAddiWpt(oldType)) &amp;&amp; !cache.getWayPoint().equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
-			//FIXME: if cache was renamed we need to rebuild CacheDB.hashDB first
+			// FIXME: if cache was renamed we need to rebuild CacheDB.hashDB first
 			profile.buildReferences();
 		} else {
 			// set status also on addi wpts
 			cache.setAttributesToAddiWpts();
 		}
 		if (!cache.isAddiWpt()) {
-			cache.setHard(decodeTerrDiff(btnDiff,MyLocale.getMsg(1000, &quot;D&quot;),cache.isCacheWpt()));
-			cache.setTerrain(decodeTerrDiff(btnTerr,MyLocale.getMsg(1001, &quot;T&quot;),cache.isCacheWpt()));
+			cache.setHard(decodeTerrDiff(btnDiff, MyLocale.getMsg(1000, &quot;D&quot;), cache.isCacheWpt()));
+			cache.setTerrain(decodeTerrDiff(btnTerr, MyLocale.getMsg(1001, &quot;T&quot;), cache.isCacheWpt()));
 		}
 		dirtyNotes = false;
 		dirtyDetails = false;
 		needsTableUpdate = false;
 		cache.getCacheDetails(false).hasUnsavedChanges = true;
-		if (!oldWaypoint.equals(cache.getWayPoint())){
-		 // Delete old XML - File
-			cache.getCacheDetails(false).deleteFile(Global.getProfile().dataDir+oldWaypoint+&quot;.xml&quot;);
+		if (!oldWaypoint.equals(cache.getWayPoint())) {
+			// Delete old XML - File
+			cache.getCacheDetails(false).deleteFile(Global.getProfile().dataDir + oldWaypoint + &quot;.xml&quot;);
 		}
 	}
 
 	/**
 	 * convert the string displayed in the terrain in difficulty buttons to a byte for intrernal use&lt;br&gt;
 	 * assumes that the relevant information will at positions 3 and 5 in a 0 indexed string
-	 * @param button button control to get the text from
-	 * @param td localized string for abbreviation of terrain or difficulty
-	 * @param isCache true if waypoint is a cache, false for addis and custom
+	 * 
+	 * @param button
+	 *            button control to get the text from
+	 * @param td
+	 *            localized string for abbreviation of terrain or difficulty
+	 * @param isCache
+	 *            true if waypoint is a cache, false for addis and custom
 	 * @return 0 for additional or custum waypoints, -1 for caches if td is not valid, parsed byte otherwise
 	 */
 	private byte decodeTerrDiff(mButton button, String td, boolean isCache) {
 		// terrain and difficulty are always unset for non cache waypoints
-		if (! isCache) return CacheTerrDiff.CW_DT_UNSET;
+		if (!isCache)
+			return CacheTerrDiff.CW_DT_UNSET;
 
 		// cut off beginning of string
-		String buttonText = button.getText().substring(td.length()+2);
+		String buttonText = button.getText().substring(td.length() + 2);
 		// we now should have a string of length 3
-		if (buttonText.length() != 3) return -1;
+		if (buttonText.length() != 3)
+			return -1;
 
 		final StringBuffer tdv = new StringBuffer(2);
-		buttonText=tdv.append(buttonText.charAt(0)).append(buttonText.charAt(2)).toString();
+		buttonText = tdv.append(buttonText.charAt(0)).append(buttonText.charAt(2)).toString();
 
 		// unset value is invalid
-		if (&quot;--&quot;.equals(buttonText)) return CacheTerrDiff.CW_DT_ERROR;
+		if (&quot;--&quot;.equals(buttonText))
+			return CacheTerrDiff.CW_DT_ERROR;
 
 		return Byte.parseByte(buttonText);
 	}
@@ -887,18 +849,14 @@
 		private final DispPanel disp = new DispPanel();
 		private final mButton btCancel;
 
-
 		TravelbugInCacheScreen(String text, String title) {
 			super();
 			this.setTitle(title);
 			this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
 			disp.setHtml(text);
-			final ScrollBarPanel sbp = new MyScrollBarPanel(disp,
-					ScrollablePanel.NeverShowHorizontalScrollers);
+			final ScrollBarPanel sbp = new MyScrollBarPanel(disp, ScrollablePanel.NeverShowHorizontalScrollers);
 			this.addLast(sbp);
-			this.addLast(
-					btCancel = new mButton(MyLocale.getMsg(3000, &quot;Close&quot;)),
-					CellConstants.DONTSTRETCH, CellConstants.FILL);
+			this.addLast(btCancel = new mButton(MyLocale.getMsg(3000, &quot;Close&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		}
 
 		public void onEvent(Event ev) {
@@ -917,10 +875,8 @@
 
 			DispPanel() {
 				super();
-				tbMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(
-						6016, &quot;Pick up Travelbug&quot;));
-				tbMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6017,
-						&quot;Drop Travelbug&quot;));
+				tbMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(6016, &quot;Pick up Travelbug&quot;));
+				tbMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6017, &quot;Drop Travelbug&quot;));
 				mnuPopup = new Menu(tbMenuItems, &quot;&quot;);
 			}
 
@@ -946,8 +902,7 @@
 						tbjList = new TravelbugJourneyList();
 						tbjList.readTravelbugsFile();
 						// Add the tb to this list
-						tbjList.addTbPickup(tb, Global.getProfile().name,
-								cache.getWayPoint());
+						tbjList.addTbPickup(tb, Global.getProfile().name, cache.getWayPoint());
 						tbjList.saveTravelbugsFile();
 						setHtml(cache.getCacheDetails(true).Travelbugs.toHtml());
 						repaint();
@@ -991,8 +946,7 @@
 			resizable = false;
 			setTitle(MyLocale.getMsg(31415, &quot;D &amp; T&quot;));
 
-			addNext(new mLabel(terrain ? MyLocale.getMsg(31415, &quot;Terrain&quot;)
-					: MyLocale.getMsg(31415, &quot;Difficulty&quot;)));
+			addNext(new mLabel(terrain ? MyLocale.getMsg(31415, &quot;Terrain&quot;) : MyLocale.getMsg(31415, &quot;Difficulty&quot;)));
 			addLast(mcDT);
 			addButton(btnOk);
 			addButton(btnCancel);

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2011-07-01 08:11:00 UTC (rev 3033)
+++ trunk/src/CacheWolf/MainTab.java	2011-07-01 10:57:57 UTC (rev 3034)
@@ -145,11 +145,13 @@
 		c.iconize(new Image(&quot;goto&quot; + imagesize + &quot;.gif&quot;), true);
 		nav.setGotoPanel(gotoP);
 
-		c = this.addCard(mapP = new ewe.ui.CellPanel(), MyLocale.getMsg(347, &quot;Show map&quot;), null);
-		MAP_CARD = this.cardPanel.cards.size() - 1;
-		c.iconize(new Image(&quot;globe_small&quot; + imagesize + &quot;.gif&quot;), true);
+		if (pref.isBigScreen || !pref.useRadar) {
+			c = this.addCard(mapP = new ewe.ui.CellPanel(), MyLocale.getMsg(347, &quot;Show map&quot;), null);
+			MAP_CARD = this.cardPanel.cards.size() - 1;
+			c.iconize(new Image(&quot;globe_small&quot; + imagesize + &quot;.gif&quot;), true);
+		}
 
-		if (pref.isBigScreen) {
+		if (pref.isBigScreen || pref.useRadar) {
 			c = this.addCard(radarP, &quot;Radar&quot;, null);
 			RADAR_CARD = this.cardPanel.cards.size() - 1;
 			radarP.setMainTab(this);

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-07-01 08:11:00 UTC (rev 3033)
+++ trunk/src/CacheWolf/Preferences.java	2011-07-01 10:57:57 UTC (rev 3034)
@@ -82,6 +82,7 @@
 	/** display big icons. default only true for VGA PDAs */
 	// TODO: make this configurable via pref.xml
 	public boolean useBigIcons;
+	public boolean useRadar;
 
 	// ////////////////////////////////////////////////////////////////////////////////////
 	// Constructor
@@ -573,6 +574,11 @@
 			else {
 				useBigIcons = MyLocale.getScreenWidth() &gt;= 400 &amp;&amp; Vm.isMobile();
 			}
+			if (atts.getValue(&quot;useRadar&quot;) != null)
+				useRadar = Boolean.valueOf(atts.getValue(&quot;useRadar&quot;)).booleanValue();
+			else {
+				useRadar = MyLocale.getScreenWidth() &gt;= 400 &amp;&amp; Vm.isMobile();
+			}
 		} else if (name.equals(&quot;hintlogpanel&quot;)) {
 			logsPerPage = Convert.parseInt(atts.getValue(&quot;logsperpage&quot;));
 			String strInitialHintHeight = atts.getValue(&quot;initialhintheight&quot;);
@@ -821,6 +827,7 @@
 					+ &quot; h=\&quot;&quot; + myAppHeight + &quot;\&quot;&quot; //
 					+ &quot; w=\&quot;&quot; + myAppWidth + &quot;\&quot;&quot; //
 					+ &quot; useBigIcons=\&quot;&quot; + useBigIcons + &quot;\&quot;&quot; //
+					+ &quot; useRadar=\&quot;&quot; + useRadar + &quot;\&quot;&quot; //
 					+ &quot; /&gt;\n&quot; //
 
 					+ &quot;    &lt;fixedsip state=\&quot;&quot; + SafeXML.strxmlencode(fixSIP) + &quot;\&quot; /&gt;\n&quot; //

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2011-07-01 08:11:00 UTC (rev 3033)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2011-07-01 10:57:57 UTC (rev 3034)
@@ -61,8 +61,8 @@
 	mButton cancelB, applyB, brwBt, gpsB;
 	mChoice inpLanguage, inpMetric, inpSpiderUpdates;
 	mInput DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontName, fontSize, inpLogsPerPage, inpMaxLogsToSpider, inpPassword, inpGcMemberID, inpUserID;
-	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus, chkHasCloseButton, chkUseBigIcons, chkSynthShort, chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName, chkSetCurrentCentreFromGPSPosition,
-			chkSortingGroupedByCache, chkuseOwnSymbols, chkDebug, chkPM;
+	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus, chkHasCloseButton, chkUseBigIcons, chkUseRadar, chkSynthShort, chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName,
+			chkSetCurrentCentreFromGPSPosition, chkSortingGroupedByCache, chkuseOwnSymbols, chkDebug, chkPM;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
 	mLabel lblGarmin;
@@ -194,8 +194,10 @@
 		frmScreen.addLast(chkShowStatus = new mCheckBox(MyLocale.getMsg(628, &quot;Status&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
 		chkShowStatus.setState(pref.showStatus);
 		chkShowStatus.setTag(INSETS, new Insets(0, 0, 2, 0));
-		frmScreen.addLast(chkUseBigIcons = new mCheckBox(&quot;use big Icons&quot;), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
+		frmScreen.addNext(chkUseBigIcons = new mCheckBox(&quot;use big Icons&quot;), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
 		chkUseBigIcons.setState(pref.useBigIcons);
+		frmScreen.addLast(chkUseRadar = new mCheckBox(&quot;Radartab on small screen&quot;), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.LEFT));
+		chkUseRadar.setState(pref.useRadar);
 		pnlDisplay.addLast(frmScreen, CellConstants.HSTRETCH, CellConstants.FILL);
 
 		Frame frmImages = new Frame();
@@ -358,6 +360,7 @@
 				pref.showStatus = chkShowStatus.getState();
 				pref.hasCloseButton = chkHasCloseButton.getState();
 				pref.useBigIcons = chkUseBigIcons.getState();
+				pref.useRadar = chkUseRadar.getState();
 				pref.travelbugColMap = tccBugs.getSelectedCols();
 				pref.listColMap = tccList.getSelectedCols();
 				pref.descShowImg = chkDescShowImg.getState();

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-07-01 08:11:00 UTC (rev 3033)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-07-01 10:57:57 UTC (rev 3034)
@@ -2770,8 +2770,10 @@
 				}
 			}
 			infB.setInfo(oldInfoBox);
-			if (exBugWrong)
-				pref.log(&quot;[SpiderGC.java:getBugs]check TBs bugExStart / bugExEnd! blockLength = &quot; + blockLength, null);
+			if (exBugWrong) {
+				if (blockLength &gt; 200)
+					pref.log(&quot;[SpiderGC.java:getBugs]check TBs bugExStart / bugExEnd! blockLength = &quot; + blockLength + &quot; for &quot; + chD.URL, null);
+			}
 		} else {
 			pref.log(&quot;[SpiderGC.java:getBugs]check TBs blockExStart / blockExEnd! &quot;, null);
 		}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003024.html">[Cachewolf-svn] r3033 - in trunk: res_noewe src/CacheWolf	src/CacheWolf/imp
</A></li>
	<LI>Next message: <A HREF="003027.html">[Cachewolf-svn] r3036 - trunk/res_noewe/webmapservices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3025">[ date ]</a>
              <a href="thread.html#3025">[ thread ]</a>
              <a href="subject.html#3025">[ subject ]</a>
              <a href="author.html#3025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
