<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2768 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2010-September/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2768%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C20100903142505.0BFF6481014%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002754.html">
   <LINK REL="Next"  HREF="002757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2768 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2768%20-%20in%20trunk%3A%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/imp&In-Reply-To=%3C20100903142505.0BFF6481014%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2768 - in trunk: res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Fri Sep  3 04:25:04 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002754.html">[Cachewolf-svn] r2766 - trunk/src/CacheWolf/imp
</A></li>
        <LI>Next message: <A HREF="002757.html">[Cachewolf-svn] r2769 - in trunk: res_noewe src/CacheWolf	src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2756">[ date ]</a>
              <a href="thread.html#2756">[ thread ]</a>
              <a href="subject.html#2756">[ subject ]</a>
              <a href="author.html#2756">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2010-09-03 16:25:04 +0200 (Fri, 03 Sep 2010)
New Revision: 2768

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/languages/SV.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
doing some things better and quicker.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/res_noewe/languages/DE.cfg	2010-09-03 14:25:04 UTC (rev 2768)
@@ -60,13 +60,13 @@
 128=%fcber Template
 129=aus Datei
 130=von opencaching
-131=um Zentrum (GC)
+131=von GC um Zentrum
 132=nach Explorist
 133=Suche alle
 134=Gew%e4hlter Cache
 135=nach SpoilerPOI
 136=zum GPS: installiere GPSBabel
-137=am Weg (GC)
+137=von GC am Weg
 139=Travelbugs verwalten
 140=Verwalten
 141=Kopieren
@@ -137,7 +137,7 @@
 214=Neuer Wegpunkt
 215=nach LOC
 216=Immer bei GC einloggen
-217=Funde (GC)
+217=von GC Funde
 218=Auch in Beschreibung/Notizen
 219=Suche...
 220=Pr%fcfe Notizen und L%f6ser
@@ -972,7 +972,7 @@
 5509=Zentrumskoordinaten nicht gesetzt
 5510=Import Optionen
 5511=Gefunden+
-5512=+neue Caches
+5512=+%0aneue / zu aktualisierende Caches
 5513=Laden von:+
 5514=%0aTravelbug:+
 5515=Fehler beim Laden des Caches.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung und ob als Sprache bei GC.com English ausgew%e4hlt ist.%0aNoch einmal versuchen?

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/res_noewe/languages/EN.cfg	2010-09-03 14:25:04 UTC (rev 2768)
@@ -60,13 +60,13 @@
 128=via Template
 129=from file
 130=from opencaching
-131=from geocaching.com
+131=from GC around the center
 132=to Explorist
 133=Search all
 134=Selected Cache
 135=to SpoilerPOI
 136=to GPS : gpsbabel missing.
-137=along a route (from gc)
+137=from GC along a route
 139=Manage Travelbugs
 140=Organise
 141=Copy
@@ -137,7 +137,7 @@
 214=New Waypoint
 215=to LOC
 216=Always login to GC
-217=all finds (GC)
+217=from GC finds
 218=Also in description/notes
 219=Searching...
 220=Check notes and solver
@@ -972,7 +972,7 @@
 5509=Coordinates for centre must be set
 5510=Spider Options
 5511=Found+
-5512=+new caches
+5512=+new/update caches
 5513=Loading:+
 5514=%0aGetting bug:+
 5515=Failed to load cache.%0aPlease check your internet connection.%0aRetry?

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/res_noewe/languages/FR.cfg	2010-09-03 14:25:04 UTC (rev 2768)
@@ -60,13 +60,13 @@
 128=par Template
 129=de Fichier
 130=de opencaching
-131=de geocaching.com
+131=de GC autour du centre
 132=vers Explorist
 133=Cherche toutes
 134=Cache choisi
 135=vers SpoilerPOI
 136=to GPS : gpsbabel missing.
-137=along a route (from gc)
+137=de GC le long de la route
 139=G%e9rer Travelbugs
 140=G%e9rer
 141=Copier
@@ -137,7 +137,7 @@
 214=Nouveau waypoint
 215=%e0 LOC
 216=Toujours connecter
-217=toutes les trouvailles (GC)
+217=de GC trouvailles
 218=Aussi dans description/notes
 219=Cherchant...
 220=V%e9rifier notes et resoudeur
@@ -972,7 +972,7 @@
 5509=Coordonn%e9es de centre pas mis
 5510=Options spider
 5511=Trouv%e9e+
-5512=+nouveau Caches
+5512=+nouveau/mettre %e0 jour Caches
 5513=Chargeant:+
 5514=%0aTravel Bug:+
 5515=Erreur en chargeant la cache.%0aMerci de v%e9rifier votre connexion internet et si vous avez language englais chez gc.com..%0aContinuer d'essayer?

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/res_noewe/languages/NL.cfg	2010-09-03 14:25:04 UTC (rev 2768)
@@ -60,13 +60,13 @@
 128=Via sjabloon
 129=van Bestand
 130=van opencaching
-131=van geocaching.com
+131=van GC rond het centrum
 132=Naar Explorist
 133=Allen zoeken
 134=Gekozen Cache
 135=Naar SpoilerPOI
 136=to GPS : gpsbabel missing.
-137=along a route (from gc)
+137=van GC langs de route
 139=Beheren Travelbugs
 140=Organiseren
 141=Kopi%ebren
@@ -137,7 +137,7 @@
 214=Nieuwe Waypoint
 215=aan LOC
 216=Altijd aanmelden bij GC
-217=alle vondsten (GC)
+217=van GC vondsten
 218=Ook in opmerkingen/beschrijving
 219=Zoeken...
 220=Onderzoek opmerkingen en oplosser
@@ -972,7 +972,7 @@
 5509=Co%f6rdinaten voor middelpunt moeten worden ingegeven.
 5510=Spider options
 5511=Gevonden+
-5512=+niew caches
+5512=+niew/update caches
 5513=Bezig met laden:+
 5514=%0aTravelbug
 5515=Failed to load-cache.%0aPlease Controleer je internetverbinding.%0aRetry?

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/res_noewe/languages/PL.cfg	2010-09-03 14:25:04 UTC (rev 2768)
@@ -60,13 +60,13 @@
 128=Przez szablon
 129=z pliku
 130=z Opencaching
-131=z geocaching.com
+131=z GC wok%f3l centrum
 132=Explorist
 133=Szukaj wszystkich
 134=Zaznaczony Cache
 135=SpoilerPOI
 136=to GPS : gpsbabel missing.
-137=along a route (from gc)
+137=z GC na trasie
 139=Zarzadzaj Travelbugami
 140=Zarzadzanie
 141=Kopiuj
@@ -137,7 +137,7 @@
 214=Nowy WaypointUsunacUsunac
 215=LOC
 216=Zawsze loguj do GC
-217=sciagnij wszystkie znalezione (GC)
+217=z GC stwierdza
 218=Takze w opisie/notatkach
 219=Wyszukiwanie...
 220=Sprawdz notatki i pomoc
@@ -972,7 +972,7 @@
 5509=Wspolrzedne dla srodka musza byc podane
 5510=Opcje Spidera
 5511=Znaleziona+
-5512=+nowy skrzynki
+5512=+nowy/aktualizacja skrzynki
 5513=Wczytuje:+
 5514=%0aPobieram bugi:+
 5515=Nie mozna zaladowac skrzynki.%0aProsze sprawdzic polaczenie z netem.%0aSprobowac ponownie?

Modified: trunk/res_noewe/languages/SV.cfg
===================================================================
--- trunk/res_noewe/languages/SV.cfg	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/res_noewe/languages/SV.cfg	2010-09-03 14:25:04 UTC (rev 2768)
@@ -60,13 +60,13 @@
 128=via Mall
 129=fr%e5n fil
 130=fr%e5n opencaching
-131=fr%e5n geocaching.com
+131=fr%e5n GC runt centrum
 132=till eXplorist
 133=S%f6k alla
 134=Valda Cache
 135=till SpoilerPOI
 136=to GPS : gpsbabel missing.
-137=along a route (from gc)
+137=fr%e5n GC l%e4ngs rutten
 139=Hantera Travelbugs
 140=Sortera
 141=Kopiera
@@ -137,7 +137,7 @@
 214=Ny v%e4gpunkt
 215=f%f6r LOC
 216=alltid logga in till GC
-217=alla fynd (GC)
+217=fr%e5n GC finner
 218=%e4ven i beskrivningen / Notes
 219=S%f6ker ...
 220=Kontrollera anteckningar och solver
@@ -972,7 +972,7 @@
 5509=Koordinater f%f6r centrum m%e5ste st%e4llas
 5510=Spider Options
 5511=Found +
-5512=+ nya cachar
+5512=+ nya/uppdatering cachar
 5513=Laddar: +
 5514 =%0aGetting bug: +
 5515=Kunde inte ladda cache.%0aPlease kontrollera din Internetanslutning.%0aRetry?

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/res_noewe/spider.def	2010-09-03 14:25:04 UTC (rev 2768)
@@ -157,8 +157,8 @@
 bugLinkEnd         = &quot;\ class=&quot;lnk&quot;&gt;
 bugNameExStart     = &lt;span&gt;
 bugNameExEnd       = &lt;/span&gt;
-bugDetailsStart    = id=&quot;ctl00_ContentBody_BugDetails_BugGoal&quot;&gt;
-bugDetailsEnd      = &lt;/span&gt;
+bugDetailsStart    = &quot;og:description&quot;\ content=&quot;
+bugDetailsEnd      = &quot;\ property=&quot;og:desc
 getBugByName       = <A HREF="http://www.geocaching.com/track/search.aspx?k=">http://www.geocaching.com/track/search.aspx?k=</A>
 getBugByGuid       = <A HREF="http://www.geocaching.com/track/details.aspx?guid=">http://www.geocaching.com/track/details.aspx?guid=</A>
 getBugById         = <A HREF="http://www.geocaching.com/track/details.aspx?id=">http://www.geocaching.com/track/details.aspx?id=</A>

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/src/CacheWolf/Preferences.java	2010-09-03 14:25:04 UTC (rev 2768)
@@ -1042,7 +1042,11 @@
 	public void logInit(){
 		File logFile = new FileBugfix(LOGFILENAME);
 		logFile.delete();
-		log(&quot;CW Version &quot;+Version.getReleaseDetailed());
+		log(&quot;CW Version &quot;+Version.getReleaseDetailed(),null);
+		
+		if (System.getProperty(&quot;os.name&quot;)!=null) log(&quot;Operating system: &quot;+System.getProperty(&quot;os.name&quot;)+&quot;/&quot;+System.getProperty(&quot;os.arch&quot;),null);
+		if (System.getProperty(&quot;java.vendor&quot;)!=null) log(&quot;Java: &quot;+System.getProperty(&quot;java.vendor&quot;)+&quot;/&quot;+System.getProperty(&quot;java.version&quot;),null);
+		
 	}
 
 	boolean forceLog = false;
@@ -1092,7 +1096,7 @@
 	 */
 	public void log(String text,Throwable e, boolean withStackTrace) {
 		if (e!=null) {
-			text+=&quot;\n&quot;;
+			text+=Preferences.NEWLINE;
 			if (withStackTrace)
 				text+=ewe.sys.Vm.getAStackTrace(e);
 			else

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/src/CacheWolf/StatusBar.java	2010-09-03 14:25:04 UTC (rev 2768)
@@ -79,6 +79,7 @@
 		strStatus += MyLocale.getMsg(4500,&quot;Tot:&quot;) + &quot; &quot; + stats.total(bigScreen) + &quot; &quot; +
 					MyLocale.getMsg(4501,&quot;Dsp:&quot;) + &quot; &quot; + stats.visible(bigScreen) + &quot; &quot; +
 					MyLocale.getMsg(4502,&quot;Fnd:&quot;) + &quot; &quot; + stats.totalFound() + &quot;  &quot;;
+		disp.setToolTip(&quot;Cache/Addi +Blacklisted&quot;);
 		disp.setText(strStatus);
 		// Indicate that a filter is active in the status line
 		if (Global.getProfile().getFilterActive()==Filter.FILTER_ACTIVE)

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2010-09-02 13:18:45 UTC (rev 2767)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2010-09-03 14:25:04 UTC (rev 2768)
@@ -117,14 +117,12 @@
 	private static SpiderProperties p=null;
 	// following filled at doit
 	private CWPoint origin;
-	private double saveDistanceInMiles;
 	private boolean doNotgetFound;
 	private String cacheTypeRestriction;
 	private boolean spiderAllFinds;
 	private String htmlListPage;
 	private int maxUpdate;
 	private boolean maxNumberAbort;
-	private double distanceInKm=0;
 	private byte restrictedCacheType=0;
 
 	private static String propFirstPage;
@@ -132,6 +130,9 @@
 	private static String propFirstPageFinds;
 	private static String propFirstLine;
 	private static String propFirstLine2;
+	private static String gotoNextPage = &quot;ctl00$ContentBody$pgrTop$ctl08&quot;;
+	private static String gotoNextBlock = &quot;ctl00$ContentBody$pgrTop$ctl06&quot;; // change to the block (10pages) of the wanted page
+	private static String gotoPage = &quot;ctl00$ContentBody$pgrTop$lbGoToPage_&quot;; // add pagenumber 
 	private static String propMaxDistance;
 	private static String propShowOnlyFound;
 	private static Regex RexPropListBlock;
@@ -195,9 +196,6 @@
 			return;
 		}
 		
-		if (System.getProperty(&quot;os.name&quot;)!=null)pref.log(&quot;Operating system: &quot;+System.getProperty(&quot;os.name&quot;)+&quot;/&quot;+System.getProperty(&quot;os.arch&quot;));
-		if (System.getProperty(&quot;java.vendor&quot;)!=null)pref.log(&quot;Java: &quot;+System.getProperty(&quot;java.vendor&quot;)+&quot;/&quot;+System.getProperty(&quot;java.version&quot;));
-		
 		// Reset states for all caches when spidering (<A HREF="http://tinyurl.com/dzjh7p">http://tinyurl.com/dzjh7p</A>)
 		for(int i = 0; i&lt;cacheDB.size();i++){
 			CacheHolder ch = cacheDB.get(i);
@@ -210,7 +208,7 @@
 			infB = new InfoBox(&quot;Status&quot;, MyLocale.getMsg(5502,&quot;Fetching first page...&quot;));
 			infB.exec();
 			
-			pref.log(&quot;Download properties : &quot;+Preferences.NEWLINE
+			pref.log(&quot;ListPages Properties : &quot;+Preferences.NEWLINE
 					+ &quot;minDistance: &quot; + minDistance+Preferences.NEWLINE
 					+ &quot;maxDistance: &quot; + maxDistance+Preferences.NEWLINE
 					+ &quot;directions: &quot; + direction+Preferences.NEWLINE
@@ -224,7 +222,8 @@
 			
 			Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
 			
-			fillDownloadLists(pref.maxSpiderNumber , maxUpdate, maxDistance, minDistance, directions, cachesToUpdate);
+			cachesToUpdate=fillDownloadLists(pref.maxSpiderNumber , maxUpdate, maxDistance, minDistance, directions, cachesToUpdate);
+			if (cachesToUpdate == null) {cachesToUpdate = new Hashtable();};
 			if (infB.isClosed) { Vm.showWait(false); return; }
 			infB.setInfo(MyLocale.getMsg(5511,&quot;Found &quot;) + cachesToLoad.size() + MyLocale.getMsg(5512,&quot; caches&quot;));
 
@@ -250,7 +249,7 @@
 			int totalCachesToLoad = cachesToLoad.size() + cachesToUpdate.size();
 			boolean loadAllLogs = (pref.maxLogsToSpider &gt; 5) || spiderAllFinds;
 			pref.log(&quot;Download properties : &quot;+Preferences.NEWLINE
-					+ &quot;maxLogs: &quot; + (loadAllLogs ? &quot;completepage &quot; : &quot;shortpage&quot;) + &quot;save:&quot; + pref.maxLogsToSpider+Preferences.NEWLINE
+					+ &quot;maxLogs: &quot; + (loadAllLogs ? &quot;completepage &quot; : &quot;shortpage&quot;) + &quot;nr.:&quot; + pref.maxLogsToSpider+Preferences.NEWLINE
 					+ &quot;with pictures     : &quot; + (!pref.downloadPics ? &quot;no&quot; : &quot;yes&quot;)+Preferences.NEWLINE
 					+ &quot;with tb           : &quot; + (!pref.downloadTBs ? &quot;no&quot; : &quot;yes&quot;)+Preferences.NEWLINE
 					,null);
@@ -260,8 +259,6 @@
 			spiderErrors=downloadCaches(cachesToLoad, spiderErrors, totalCachesToLoad, loadAllLogs);
 			spiderErrors=updateCaches(cachesToUpdate, spiderErrors, totalCachesToLoad, loadAllLogs);
 
-			if (infB.isClosed) { Vm.showWait(false); return; }
-
 			if ( spiderErrors &gt; 0) {
 				new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;),spiderErrors + MyLocale.getMsg(5516,&quot; cache descriptions%0acould not be loaded.&quot;),FormBase.DEFOKB).execute();
 			}
@@ -271,7 +268,7 @@
 			Global.getProfile().restoreFilter();
 			Global.getProfile().saveIndex(Global.getPref(),true);
 
-			infB.close(0);
+			if (!infB.isClosed) {infB.close(0);}			
 			Vm.showWait(false);			
 		}
 	} // End of DoIt
@@ -292,7 +289,10 @@
 			if (ch.mainCache == null) ch.initStates(false);
 		}
 
-		double lateralDistance = distanceInKm; // Seitenabstand in km
+		double lateralDistance=maxDistance; // Seitenabstand in km
+		if ( pref.metricSystem == Metrics.IMPERIAL ) {
+			lateralDistance = Metrics.convertUnit(maxDistance, Metrics.MILES, Metrics.KILOMETER);
+		}			
 		cachesToLoad.clear();
 		origin=startPos;
 		Hashtable cachesToUpdate = new Hashtable(); //dummy , won't update
@@ -300,7 +300,7 @@
 		int n;
 		while ((n=nextRoutePoint(startPos, lateralDistance)) &gt; -1) {
 			// spider around startpos			
-			fillDownloadLists(Integer.MAX_VALUE, 0, lateralDistance, 0.0, directions, cachesToUpdate);
+			cachesToUpdate=fillDownloadLists(Integer.MAX_VALUE, 0, lateralDistance, 0.0, directions, cachesToUpdate);
 			nextCache=cacheDB.get(n);
 			double degrees = startPos.getBearing(nextCache.pos);
 			double distanceToNextCache=startPos.getDistance(nextCache.pos);
@@ -310,17 +310,17 @@
 				startPos=nextCheckPoint;
 				// spider around nextCheckPoint
 				origin=nextCheckPoint;
-				fillDownloadLists(Integer.MAX_VALUE, 0, lateralDistance, 0.0, directions, cachesToUpdate);
-				// Global.getPref().log(&quot;next CP = &quot;+nextCheckPoint.toString(),null);
+				cachesToUpdate=fillDownloadLists(Integer.MAX_VALUE, 0, lateralDistance, 0.0, directions, cachesToUpdate);
+				// pref.log(&quot;next CP = &quot;+nextCheckPoint.toString(),null);
 				if (infB.isClosed) { break; }
 			}
 			startPos=nextCache.pos;
-			// Global.getPref().log(&quot;next WP = &quot;+nextCache.getWayPoint()+&quot; : &quot;+CWPoint.getDirection(degrees),null);
+			// pref.log(&quot;next WP = &quot;+nextCache.getWayPoint()+&quot; : &quot;+CWPoint.getDirection(degrees),null);
 			if (infB.isClosed) { break; }
 		}
 		// spider around startpos (means endpos)
 		origin=startPos;
-		fillDownloadLists(Integer.MAX_VALUE, 0, lateralDistance, 0.0, directions, cachesToUpdate);
+		cachesToUpdate=fillDownloadLists(Integer.MAX_VALUE, 0, lateralDistance, 0.0, directions, cachesToUpdate);
 		int spiderErrors=0;
 		if (infB.isClosed) { Vm.showWait(false); return; } // or ask for download of intermediate result 
 		spiderErrors=downloadCaches(cachesToLoad, spiderErrors, cachesToLoad.size(), true);
@@ -460,7 +460,7 @@
 			if (maxNumberString.length()!= 0) {
 				maxNew = Common.parseInt(maxNumberString);
 			}
-			if (maxNew == 0) return false;
+			// if (maxNew == 0) return false;
 			if(maxNew == -1) maxNew=Integer.MAX_VALUE;
 			if (maxNew != pref.maxSpiderNumber) {
 				pref.maxSpiderNumber = maxNew;
@@ -492,18 +492,6 @@
 			profile.setDistGC(maxDist);
 		}
 
-		//max distance in miles for URL, so we can get more than 80km
-		saveDistanceInMiles = maxDistance;
-		if ( Global.getPref().metricSystem != Metrics.IMPERIAL ) {
-			saveDistanceInMiles = Metrics.convertUnit(maxDistance, Metrics.KILOMETER, Metrics.MILES);
-		}
-		// add a mile to be save from different distance calculations in CW and at GC
-		saveDistanceInMiles = java.lang.Math.ceil(saveDistanceInMiles) + 1;
-
-		distanceInKm = maxDistance;
-		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
-			distanceInKm = Metrics.convertUnit(maxDistance, Metrics.MILES, Metrics.KILOMETER);
-		}			
 		directions=mString.split(direction, ',');
 		// works even if TYPE not in options
 		cacheTypeRestriction = options.getCacheTypeRestriction(p);
@@ -515,26 +503,58 @@
 
 	}
 
-	private void fillDownloadLists(int maxNew, int maxUpdate, double toDistance, double fromDistance, String[] directions, Hashtable cExpectedForUpdate) {
-		if (!loggedIn || Global.getPref().forceLogin) {
-			if(login() != FormBase.IDOK) return;
+	private Hashtable fillDownloadLists(int maxNew, int maxUpdate, double toDistance, double fromDistance, String[] directions, Hashtable cExpectedForUpdate) {
+		if (!loggedIn || pref.forceLogin) {
+			if(login() != FormBase.IDOK) return null;
 		}
-		getFirstListPage();
-		int page_number = 1;
-		int found_on_page = 0;
 		
-		int numFinds=0; // spiderAllFinds : Number of GC-founds for this user
+		int numFinds;
+		int startPage=1;
+		// get pagenumber of page with fromDistance , to skip reading of pages &lt; fromDistance 
+		if (fromDistance&gt;0) {
+			// distance in miles for URL
+			int fromDistanceInMiles = (int) java.lang.Math.ceil(fromDistance);
+			if ( pref.metricSystem != Metrics.IMPERIAL ) {
+				fromDistanceInMiles =(int) java.lang.Math.ceil(Metrics.convertUnit(fromDistance, Metrics.KILOMETER, Metrics.MILES));
+			}
+			// - a mile to be save to get a page with fromDistance
+			getFirstListPage(java.lang.Math.max(fromDistanceInMiles-1, 1));		
+			numFinds=getNumFound(htmlListPage); // Number of caches from gc Listpage
+			// calc the number of the startpage
+			startPage = (int) java.lang.Math.ceil(numFinds / 20);			
+		}
+		
+		//max distance in miles for URL, so we can get more than 80km
+		int toDistanceInMiles = (int) java.lang.Math.ceil(toDistance);
+		if ( pref.metricSystem != Metrics.IMPERIAL ) {
+			toDistanceInMiles = (int) java.lang.Math.ceil(Metrics.convertUnit(toDistance, Metrics.KILOMETER, Metrics.MILES));
+		}
+		// add a mile to be save from different distance calculations in CW and at GC
+		toDistanceInMiles++;
+		getFirstListPage(toDistanceInMiles);		
+		numFinds=getNumFound(htmlListPage); // Number of caches from gc first Listpage
+
+		if (fromDistance&gt;0) {
+			// skip (most of) the pages with distance &lt; fromDistance
+			for (int i = 0; i &lt; (startPage / 10); i++) {
+				getAListPage(toDistanceInMiles,gotoNextBlock);			
+			}
+			getAListPage(toDistanceInMiles,gotoPage+startPage);			
+		}
+		
 		int numFoundInDB=0; // Number of GC-founds already in this profile
 		if (spiderAllFinds) {
-			pref.log((spiderAllFinds ? &quot;all Finds (DB/GC)&quot;+ numFoundInDB+&quot;/&quot;+numFinds : &quot;new and update Caches&quot;)+Preferences.NEWLINE);
-
 			numFoundInDB=getFoundInDB();
-			numFinds=getNumFound(htmlListPage);
+			pref.log((spiderAllFinds ? &quot;all Finds (DB/GC)&quot;+ numFoundInDB+&quot;/&quot;+numFinds : &quot;new and update Caches&quot;)+Preferences.NEWLINE,null);
 			maxNew=java.lang.Math.min(numFinds-numFoundInDB,maxNew);
-			if (maxUpdate == 0 &amp;&amp; maxNew == 0) { Vm.showWait(false); infB.close(0); return; }
+			if (maxUpdate == 0 &amp;&amp; maxNew == 0) { Vm.showWait(false); infB.close(0); return null; }
 		}
 
 		if (maxUpdate&gt;0) {
+			double distanceInKm=toDistance;
+			if ( pref.metricSystem == Metrics.IMPERIAL ) {
+				distanceInKm = Metrics.convertUnit(toDistance, Metrics.MILES, Metrics.KILOMETER);
+			}
 			// expecting all are changed (archived caches remain always) 
 			for(int i = 0; i&lt;cacheDB.size();i++){
 				CacheHolder ch = cacheDB.get(i);
@@ -558,6 +578,8 @@
 		int startSize=cExpectedForUpdate.size(); //for save reasons
 
 		Hashtable cFoundForUpdate = new Hashtable(cacheDB.size()); // for don't loose the already done work
+		int page_number = 1;
+		int found_on_page = 0;
 		try {
 			//Loop pages till maximum distance has been found or no more caches are in the list
 			while(toDistance &gt; 0){
@@ -601,11 +623,14 @@
 						else {
 							if (maxUpdate&gt;0) {
 								if (doPMCache(CacheDescriptionGC) &amp;&amp; updateExists(ch,CacheDescriptionGC)) {
-									if (!ch.is_black() &amp;&amp; (cFoundForUpdate.size()&lt;maxUpdate)) cFoundForUpdate.put(chWaypoint, ch);
+									if (!ch.is_black()) { 
+											if (cFoundForUpdate.size()&lt;maxUpdate) {
+												cFoundForUpdate.put(chWaypoint, ch); }
+											else cExpectedForUpdate.remove( chWaypoint );
+									}
+									else cExpectedForUpdate.remove( chWaypoint );
 								}
-								else {
-									cExpectedForUpdate.remove( chWaypoint );
-								}
+								else cExpectedForUpdate.remove( chWaypoint );
 							}
 						}
 						if(cachesToLoad.size() &gt;= maxNew) {
@@ -636,11 +661,11 @@
 					}
 					else toDistance = 0; // last page (has less than 20 entries!?) to check reached
 				}
-				if(toDistance &gt; 0){getNextListPage(); page_number++; found_on_page = 0;}
+				if(toDistance &gt; 0){getAListPage(toDistanceInMiles, gotoNextPage); page_number++; found_on_page = 0;}
 			} // loop pages
 		} // try
 		catch (Exception ex) {
-			pref.log(&quot;Download error : &quot;, ex);
+			pref.log(&quot;Download error : &quot;, ex, true);
 			infB.close(0);
 			Vm.showWait(false);
 		}
@@ -653,15 +678,16 @@
 				&quot;Found &quot; + numLogUpdates + &quot; caches with new found in log (inc. blacklisted&quot;+Preferences.NEWLINE+
 				&quot;Found &quot; + (cExpectedForUpdate.size()-numAvailableUpdates-numLogUpdates) + &quot; caches possibly archived.&quot;+Preferences.NEWLINE+
 				&quot;Found &quot; + cFoundForUpdate.size() + &quot;?=&quot; + (numFoundUpdates+numArchivedUpdates+numAvailableUpdates+numArchivedUpdates) + &quot; caches to update.&quot;+Preferences.NEWLINE+
-				&quot;Found &quot; + numPrivate + &quot; Premium Caches (for non Premium Member.)&quot;);
+				&quot;Found &quot; + numPrivate + &quot; Premium Caches (for non Premium Member.)&quot;,null);
 		if(spiderAllFinds){
 			pref.log(&quot;Found &quot; + numFoundUpdates + &quot; caches with no found in profile.&quot;+Preferences.NEWLINE+
-			&quot;Found &quot; + numArchivedUpdates + &quot; caches with changed archived status.&quot;+Preferences.NEWLINE);
+			&quot;Found &quot; + numArchivedUpdates + &quot; caches with changed archived status.&quot;+Preferences.NEWLINE,null);
 		}
 
 		if (cExpectedForUpdate.size() == startSize) cExpectedForUpdate.clear(); // there must be something wrong
 		if (cExpectedForUpdate.size() == 0 || cExpectedForUpdate.size() &gt; maxUpdate)
 			cExpectedForUpdate=cFoundForUpdate;
+		return cExpectedForUpdate;
 		
 	}
 
@@ -701,7 +727,7 @@
 				break;
 			} else if (test == SPIDER_ERROR) {
 				spiderErrors++;
-				Global.getPref().log(&quot;SpiderGC: could not spider &quot;+ch.getWayPoint(),null);
+				pref.log(&quot;[updateCaches] could not spider &quot;+ch.getWayPoint(),null);
 			} else {
 				//profile.hasUnsavedChanges=true;
 			}
@@ -751,7 +777,7 @@
 				cacheInDB.save();
 			}
 		}catch(Exception ex){
-			pref.log(&quot;Error spidering &quot; + ch.getWayPoint() + &quot; in spiderSingle&quot;);
+			pref.log(&quot;[spiderSingle] Error spidering &quot; + ch.getWayPoint() + &quot; in spiderSingle&quot;,ex);
 		}
 		return ret;
 	} // spiderSingle
@@ -765,7 +791,7 @@
 		String completeWebPage;
 		// Check whether spider definitions could be loaded, if not issue appropriate message and terminate
 		// Try to login. If login fails, issue appropriate message and terminate
-		if (!loggedIn || Global.getPref().forceLogin) {
+		if (!loggedIn || pref.forceLogin) {
 			if (login()!=FormBase.IDOK) {
 				return &quot;&quot;;
 			}
@@ -774,11 +800,11 @@
 		localInfB.exec();
 		try{
 			String doc = p.getProp(&quot;waypoint&quot;) + wayPoint;
-			pref.log(&quot;Fetching: &quot; + wayPoint);
 			completeWebPage = fetch(doc);
+			pref.log(&quot;Fetched &quot; + wayPoint);
 		}catch(Exception ex){
 			localInfB.close(0);
-			pref.log(&quot;Could not fetch &quot; + wayPoint,ex);
+			pref.log(&quot;[getCacheCoordinates] Could not fetch &quot; + wayPoint,ex);
 			return &quot;&quot;;
 		}
 		localInfB.close(0);
@@ -820,13 +846,13 @@
 		localInfB = new InfoBox(MyLocale.getMsg(5507,&quot;Status&quot;), MyLocale.getMsg(5508,&quot;Logging in...&quot;));
 		localInfB.exec();
 		try{
-			pref.log(&quot;[login]:Fetching login page&quot;);
 			//Access the page once to get a viewstate
 			loginPage = fetch(loginPageUrl);   //<A HREF="http://www.geocaching.com/login/Default.aspx">http://www.geocaching.com/login/Default.aspx</A>
+			pref.log(&quot;[login]:Fetched login page &quot;+loginPageUrl);
 			if (loginPage.equals(&quot;&quot;)) {
 				localInfB.close(0);
 				(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(5499,&quot;Error loading login page.%0aPlease check your internet connection.&quot;), FormBase.OKB)).execute();
-				pref.log(&quot;[login]:Could not fetch: gc.com login page&quot;);
+				pref.log(&quot;[login]:Could not fetch: gc.com login page &quot;+loginPageUrl,null);
 				return ERR_LOGIN;
 			}
 		} catch(Exception ex){
@@ -845,23 +871,20 @@
 			rexViewstate.search(loginPage);
 			if(rexViewstate.didMatch()){
 				viewstate = rexViewstate.stringMatched(1);
-				//Vm.debug(&quot;ViewState: &quot; + viewstate);
 			} else {
-				pref.log(&quot;[login]:rexViewstate not found before login&quot;+Preferences.NEWLINE);
+				pref.log(&quot;[login]:rexViewstate not found before login&quot;,null);
 			}
 
 			if(loginPage.indexOf(loginSuccess) &gt; 0)
-				pref.log(&quot;[login]:Already logged in&quot;);
+				pref.log(&quot;[login]:Already logged in&quot;+pref.myAlias);
 			else {
 				rexEventvalidation.search(loginPage);
 				if(rexEventvalidation.didMatch()){
 					// eventvalidation = rexEventvalidation.stringMatched(1);
-					//Vm.debug(&quot;EVENTVALIDATION: &quot; + eventvalidation);
 				} else
-					pref.log(&quot;[login]:rexEventvalidation not found before login&quot;+Preferences.NEWLINE);
+					pref.log(&quot;[login]:rexEventvalidation not found before login&quot;+Preferences.NEWLINE,null);
 				//Ok now login!
 				try{
-					pref.log(&quot;[login]:Logging in as &quot;+pref.myAlias);
 					StringBuffer sb=new StringBuffer(1000);
 					sb.append(URL.encodeURL(&quot;__VIEWSTATE&quot;,false));	sb.append(&quot;=&quot;); sb.append(URL.encodeURL(viewstate,false));
 					sb.append(&quot;&amp;ctl00%24ContentBody%24&quot;); sb.append(URL.encodeURL(&quot;myUsername&quot;,false));
@@ -876,13 +899,11 @@
 //					sb.append(&quot;=&quot;); sb.append(URL.encodeURL(eventvalidation,false));
 					loginPage = fetch_post(loginPageUrl, sb.toString(), nextPage);  // /login/default.aspx
 					if(loginPage.indexOf(loginSuccess) &gt; 0)
-						pref.log(&quot;[login]:Login successful&quot;);
+						pref.log(&quot;Login successful: &quot;+pref.myAlias);
 					else {
-						pref.log(&quot;[login]:Login failed. Wrong Account or Password?&quot;);
-						if (pref.debug) {
-							pref.log(&quot;[login.LoginUrl]:&quot;+sb.toString());
-							pref.log(&quot;[login.Answer]:&quot;+loginPage);
-						}
+						pref.log(&quot;Login failed. Wrong Account or Password? &quot;+pref.myAlias,null);
+						pref.log(&quot;[login.LoginUrl]:&quot;+sb.toString(),null);
+						pref.log(&quot;[login.Answer]:&quot;+loginPage,null);
 						localInfB.close(0);
 						(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(5501,&quot;Login failed! Wrong account or password?&quot;), FormBase.OKB)).execute();
 						return ERR_LOGIN;
@@ -897,23 +918,20 @@
 
 			rexViewstate.search(loginPage);
 			if (!rexViewstate.didMatch()) {
-				pref.log(&quot;[login]:check rexViewstate in SpiderGC.java --&gt; not found after login&quot;+Preferences.NEWLINE+loginPage);
+				pref.log(&quot;[login]:check rexViewstate in SpiderGC.java --&gt; not found after login&quot;+Preferences.NEWLINE+loginPage,null);
 			}
 			viewstate = rexViewstate.stringMatched(1);
 			
 			rexCookieID.search(loginPage);
 			if (!rexCookieID.didMatch()) {
-				pref.log(&quot;[login]:check rexCookieID in SpiderGC.java --&gt; CookieID not found. Using old one.&quot;+Preferences.NEWLINE+loginPage);
+				pref.log(&quot;[login]:check rexCookieID in SpiderGC.java --&gt; CookieID not found. Using old one.&quot;+Preferences.NEWLINE+loginPage,null);
 			} else
 				cookieID = rexCookieID.stringMatched(1);
-			//Vm.debug(cookieID);
 			rexCookieSession.search(loginPage);
 			if (!rexCookieSession.didMatch()) {
 				pref.log(&quot;[login]:check rexCookieSession in SpiderGC.java --&gt; CookieSession not found. Using old one.&quot;+Preferences.NEWLINE+loginPage);
-				//cookieSession=&quot;&quot;;
 			} else
 				cookieSession = rexCookieSession.stringMatched(1);
-			//Vm.debug(&quot;cookieSession = &quot; + cookieSession);
 
 			/*
 			String viewstate1;
@@ -943,10 +961,10 @@
 //		    + &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATE1&quot;,false) +&quot;=&quot;+ URL.encodeURL(viewstate1,false);
 //		    + &quot;&amp;&quot; + URL.encodeURL(&quot;__EVENTVALIDATION&quot;,false) +&quot;=&quot;+ URL.encodeURL(eventvalidation,false);
 			try{
-				pref.log(&quot;Switching to English:&quot; + postStr);
 				loginPage = fetch_post(loginPageUrl, postStr, nextPage);
+				pref.log(&quot;Switched to English&quot;);
 			}catch(Exception ex){
-				pref.log(&quot;Error switching to English&quot;);
+				pref.log(&quot;Error switching to English: check/n&quot; + loginPageUrl + &quot;/n&quot; + postStr + &quot;/n&quot; + nextPage + &quot;/n&quot;,ex);
 			}
 		}
 		boolean loginAborted=localInfB.isClosed;
@@ -998,13 +1016,14 @@
 			icon_attended=p.getProp(&quot;icon_attended&quot;);
 			RexCacheType = new Regex(p.getProp(&quot;cacheTypeRex&quot;));
 		}catch(Exception ex){
+			pref.log(&quot;Error fetching Properties.&quot;,ex);
 		}
 	}
 
 	/*
 	 *
 	 */
-	private void getFirstListPage() {
+	private void getFirstListPage(int distance) {
 		//Get first page
 
 		String url;
@@ -1012,16 +1031,15 @@
 			url = propFirstPageFinds + encodeUTF8URL(Utils.encodeJavaUtf8String(pref.myAlias));
 		} else {
 			url = propFirstPage + origin.getLatDeg(TransformCoordinates.DD) + propFirstPage2 + origin.getLonDeg(TransformCoordinates.DD)
-		                              + propMaxDistance + Integer.toString( (int)saveDistanceInMiles );
+		                              + propMaxDistance + Integer.toString(distance);
 			if(doNotgetFound) url = url + propShowOnlyFound;
 		}
 		url = url + cacheTypeRestriction;
-		pref.log(&quot;Getting first page: &quot;+url);
 		try{
 			htmlListPage = fetch(url);
-			pref.log(&quot;Got first page&quot;);
+			pref.log(&quot;Got first page &quot;+url);
 		}catch(Exception ex){
-			pref.log(&quot;Error fetching first list page&quot;,ex,true);
+			pref.log(&quot;Error fetching first list page &quot;+url,ex,true);
 			Vm.showWait(false);
 			infB.close(0);
 			(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(5503,&quot;Error fetching first list page.&quot;), FormBase.OKB)).execute();
@@ -1033,13 +1051,13 @@
 	 * in: ...
 	 * out: page_number,htmlPage
 	 */
-	private void getNextListPage() {
+	private void getAListPage(int distance, String whatPage) {
 		String postStr;
 		if (spiderAllFinds) {
 			postStr = propFirstLine;
 		} else {
 			postStr = propFirstLine + origin.getLatDeg(TransformCoordinates.DD) + propFirstLine2 + origin.getLonDeg(TransformCoordinates.DD)
-					                             + propMaxDistance + Integer.toString( (int)saveDistanceInMiles );
+					                             + propMaxDistance + Integer.toString(distance);
 			if(doNotgetFound) postStr = postStr + propShowOnlyFound;
 		}
 		postStr = postStr + cacheTypeRestriction;
@@ -1073,18 +1091,17 @@
 		}
 		*/
 
-		String strNextPage = &quot;ctl00$ContentBody$pgrTop$ctl08&quot;;
-		String url = URL.encodeURL(&quot;__EVENTTARGET&quot;,false) +&quot;=&quot;+ URL.encodeURL(strNextPage,false)
+		String url = URL.encodeURL(&quot;__EVENTTARGET&quot;,false) +&quot;=&quot;+ URL.encodeURL(whatPage,false)
 	    + &quot;&amp;&quot; + URL.encodeURL(&quot;__EVENTARGUMENT&quot;,false) +&quot;=&quot;+ URL.encodeURL(&quot;&quot;,false)
 	    + &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATEFIELDCOUNT&quot;,false) +&quot;=2&quot;
 	    + &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATE&quot;,false) +&quot;=&quot;+ URL.encodeURL(viewstate,false)
 	    + &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATE1&quot;,false) +&quot;=&quot;+ URL.encodeURL(viewstate1,false);
 //	    + &quot;&amp;&quot; + URL.encodeURL(&quot;__EVENTVALIDATION&quot;,false) +&quot;=&quot;+ URL.encodeURL(eventvalidation,false);
 		try{
-			pref.log(&quot;Fetching next list page:&quot; + url);
 			htmlListPage = fetch_post(postStr, url, p.getProp(&quot;nextListPage&quot;));
+			pref.log(&quot;Got next list page:&quot; + url);
 		}catch(Exception ex){
-			pref.log(&quot;Error getting next page&quot;);
+			pref.log(&quot;Error getting next page&quot;+url,ex);
 		}
 	}
 
@@ -1293,7 +1310,6 @@
 	 */
 	private boolean newFoundExists(CacheHolder ch, String cacheDescrition) {
 		if(!pref.checkLog) return false;
-		// String[] CacheDesc=mString.split(cacheDescrition,'\n');
 		Time lastLogCW = new Time();
 		Log lastLog = ch.getCacheDetails(true).CacheLogs.getLog(0);
 		if (lastLog == null) return true;
@@ -1317,10 +1333,9 @@
 			return false;
 		}
 		if (stmp.indexOf(&quot;day&quot;)&gt;0) {
-			lastLogGC.day=java.lang.Math.max(1, lastLogGC.day-7); // simplyfied (update if not newer than last week)
+			lastLogGC.setTime(lastLogGC.getTime()-691200000L); // simplyfied (update if not newer than last week)
 		}
 		else if (stmp.equals(&quot;&quot;)) {
-			Vm.debug(&quot;no log yet&quot;);
 			return false; // no log yet
 		}
 		else {
@@ -1337,9 +1352,8 @@
 			}
 			lastLogGC.year=2000+Integer.parseInt(SDate[2].substring(0,2));
 		}
-		// compare
-		// Vm.debug(&quot;CW:&quot;+lastLogCW.toString()+&quot; GC:&quot;+lastLogGC.toString());
-		return lastLogCW.compareTo(lastLogGC) &lt; 0;
+		boolean ret = lastLogCW.compareTo(lastLogGC) &lt; 0;
+		return ret;
 	}
 
 	/**
@@ -1369,10 +1383,10 @@
 				ret = SPIDER_OK; // initialize value;
 				try{
 					String doc = p.getProp(&quot;getPageByName&quot;) + ch.getWayPoint() +((fetchAllLogs||ch.is_found())?p.getProp(&quot;fetchAllLogs&quot;):&quot;&quot;);
-					pref.log(&quot;Fetching: &quot; + ch.getWayPoint());
 					completeWebPage = fetch(doc);
+					pref.log(&quot;Fetched: &quot; + ch.getWayPoint());
 					if	( completeWebPage.equals(&quot;&quot;)) {
-						pref.log(&quot;Could not fetch &quot; + ch.getWayPoint());
+						pref.log(&quot;Could not fetch &quot; + ch.getWayPoint(),null);
 						if (!infB.isClosed) {
 							continue;
 						} else {
@@ -1516,15 +1530,14 @@
 						pref.log(&quot;ready &quot; + ch.getWayPoint() + &quot; : &quot;+ ch.getLastSync());
 						break;
 					}catch(Exception ex){
-						pref.log(&quot;Error reading cache: &quot;+ch.getWayPoint());
-						pref.log(&quot;Exception in getCacheByWaypointName: &quot;,ex);
+						pref.log(&quot;[getCacheByWaypointName: ]Error reading cache: &quot;+ch.getWayPoint(),ex);
 					}
 				} else {
 					break;
 				}
 			} // spiderTrys
 			if ( ( spiderTrys &gt;= MAX_SPIDER_TRYS ) &amp;&amp; ( ret == SPIDER_OK ) ) {
-				pref.log(&quot;&gt;&gt;&gt; Failed to spider cache. Number of retrys exhausted.&quot;);
+				pref.log(&quot;&gt;&gt;&gt; Failed to spider cache. Number of retrys exhausted.&quot;,null);
 				int decision = (new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;),MyLocale.getMsg(5515,&quot;Failed to load cache.%0aPleas check your internet connection.%0aRetry?&quot;),FormBase.DEFOKB|FormBase.NOB|FormBase.CANCELB)).execute();
 				if ( decision == FormBase.IDOK ) {
 					continue; // retry even if failure
@@ -1800,7 +1813,6 @@
 	public void getBugs(CacheHolderDetail chD, String doc) throws Exception{
 		Extractor exBlock = new Extractor(doc,p.getProp(&quot;blockExStart&quot;),p.getProp(&quot;blockExEnd&quot;) ,0,Extractor.EXCLUDESTARTEND);
 		String bugBlock = exBlock.findNext();
-		//Vm.debug(&quot;Bugblock: &quot;+bugBlock);
 		Extractor exBug = new Extractor(bugBlock,p.getProp(&quot;bugExStart&quot;),p.getProp(&quot;bugExEnd&quot;),0,Extractor.EXCLUDESTARTEND);
 		String link,bug,linkPlusBug,bugDetails;
 		String oldInfoBox=infB.getInfo();
@@ -1817,15 +1829,15 @@
 				Travelbug tb=new Travelbug(bug);
 				try{
 					infB.setInfo(oldInfoBox+MyLocale.getMsg(5514,&quot;\nGetting bug: &quot;)+SafeXML.cleanback(bug));
-					pref.log(&quot;Fetching bug details: &quot;+bug);
 					bugDetails = fetch(link);
+					pref.log(&quot;[getBugs] Fetched TB details: &quot;+bug);
 					Extractor exDetails = new Extractor(bugDetails,p.getProp(&quot;bugDetailsStart&quot;),p.getProp(&quot;bugDetailsEnd&quot;),0,Extractor.EXCLUDESTARTEND);
 					tb.setMission(exDetails.findNext());
 					Extractor exGuid = new Extractor(bugDetails,&quot;details.aspx?guid=&quot;,&quot;\&quot; id=\&quot;aspnetForm&quot;,0,Extractor.EXCLUDESTARTEND); // TODO Replace with spider.def see also further down
 					tb.setGuid(exGuid.findNext());
 					chD.Travelbugs.add(tb);
 				}catch(Exception ex){
-					pref.log(&quot;Could not fetch bug details&quot;);
+					pref.log(&quot;[getBugs] Could not fetch bug details&quot;,ex);
 				}
 			}
 			//Vm.debug(&quot;B: &quot; + bug);
@@ -1872,10 +1884,8 @@
 		} catch (Exception ex) {//Missing property in spider.def
 			return;
 		}
-		//Vm.debug(&quot;In getImages: Have longDesc&quot; + longDesc);
 		String tst;
 		tst = exImgBlock.findNext();
-		//Vm.debug(&quot;Test: \n&quot; + tst);
 		Extractor exImgSrc = new Extractor(tst, &quot;<A HREF="http://">http://</A>&quot;, &quot;\&quot;&quot;, 0, true);
 		while(exImgBlock.endOfSearch() == false){
 			imgUrl = exImgSrc.findNext();
@@ -1898,18 +1908,18 @@
 							}
 							if (imageInfo == null) {
 								imageInfo = new ImageInfo();
-								pref.log(&quot;Loading image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
+								pref.log(&quot;[getImages] Loading image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
 								spiderImage(imgUrl, fileName+imgType);
 								imageInfo.setFilename(fileName+imgType);
 								imageInfo.setURL(imgUrl);
 							} else {
-								pref.log(&quot;Already exising image: &quot; + imgUrl+&quot; as &quot;+imageInfo.getFilename());
+								pref.log(&quot;[getImages] Already exising image: &quot; + imgUrl+&quot; as &quot;+imageInfo.getFilename());
 							}
 							spideredUrls.add(imgUrl);
 							spiderCounter++;
 						} else { // Image already spidered as wayPoint_'idxUrl'
 							fileName = chD.getParent().getWayPoint().toLowerCase() + &quot;_&quot; + Convert.toString(idxUrl);
-							pref.log(&quot;Already loaded image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
+							pref.log(&quot;[getImages] Already loaded image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
 							imageInfo = new ImageInfo();
 							imageInfo.setFilename(fileName+imgType);
 							imageInfo.setURL(imgUrl);
@@ -1920,8 +1930,7 @@
 						chD.images.add(imageInfo);
 					}
 				} catch (IndexOutOfBoundsException e) {
-					//Vm.debug(&quot;IndexOutOfBoundsException not in image span&quot;+e.toString()+&quot;imgURL:&quot;+imgUrl);
-					pref.log(&quot;Problem loading image. imgURL:&quot;+imgUrl);
+					pref.log(&quot;[getImages] Problem loading image. imgURL:&quot;+imgUrl,e);
 				}
 				}
 			exImgSrc.setSource(exImgBlock.findNext());
@@ -1936,7 +1945,7 @@
 			exImgName = new Extractor(tst,p.getProp(&quot;imgNameExStart&quot;),p.getProp(&quot;imgNameExEnd&quot;), 0 , true);
 			exImgSrc = new Extractor(tst,p.getProp(&quot;imgSrcExStart&quot;),p.getProp(&quot;imgSrcExEnd&quot;), 0, true);
 			exImgComment = new Extractor(tst,p.getProp(&quot;imgCommentExStart&quot;),p.getProp(&quot;imgCommentExEnd&quot;), 0, true);
-		} catch (Exception ex) { // Missing property in spider .def
+		} catch (Exception ex) {
 			return;
 		}
 		while(!exImgSrc.endOfSearch()){
@@ -1960,18 +1969,18 @@
 							}
 							if (imageInfo == null) {
 								imageInfo = new ImageInfo();
-								pref.log(&quot;Loading image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
+								pref.log(&quot;[getImages] Loading image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
 								spiderImage(imgUrl, fileName+imgType);
 								imageInfo.setFilename(fileName+imgType);
 								imageInfo.setURL(imgUrl);
 							} else {
-								pref.log(&quot;Already exising image: &quot; + imgUrl+&quot; as &quot;+imageInfo.getFilename());
+								pref.log(&quot;[getImages] Already exising image: &quot; + imgUrl+&quot; as &quot;+imageInfo.getFilename());
 							}
 							spideredUrls.add(imgUrl);
 							spiderCounter++;
 						} else { // Image already spidered as wayPoint_'idxUrl'
 							fileName = chD.getParent().getWayPoint().toLowerCase() + &quot;_&quot; + Convert.toString(idxUrl);
-							pref.log(&quot;Already loaded image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
+							pref.log(&quot;[getImages] Already loaded image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
 							imageInfo = new ImageInfo();
 							imageInfo.setFilename(fileName+imgType);
 							imageInfo.setURL(imgUrl);
@@ -1983,7 +1992,7 @@
 						chD.images.add(imageInfo);
 					}
 				} catch (IndexOutOfBoundsException e) {
-					pref.log(&quot;IndexOutOfBoundsException in image span. imgURL:&quot;+imgUrl,e);
+					pref.log(&quot;[getImages] IndexOutOfBoundsException in image span. imgURL:&quot;+imgUrl,e);
 				}
 			}
 		}
@@ -2011,12 +2020,12 @@
 							}
 							if (imageInfo==null) {
 								imageInfo = new ImageInfo();
-								pref.log(&quot;Loading image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
+								pref.log(&quot;[getImages] Loading image: &quot; + imgUrl+&quot; as &quot;+fileName+imgType);
 								spiderImage(imgUrl, fileName+imgType);
 								imageInfo.setFilename(fileName+imgType);
 								imageInfo.setURL(imgUrl);
 							} else {
-								pref.log(&quot;Already exising image: &quot; + imgUrl+&quot; as &quot;+imageInfo.getFilename());
+								pref.log(&quot;[getImages] Already exising image: &quot; + imgUrl+&quot; as &quot;+imageInfo.getFilename());
 							}
 							spideredUrls.add(imgUrl);
 							spiderCounter++;
@@ -2026,7 +2035,7 @@
 						}
 					}
 				} catch (IndexOutOfBoundsException e) {
-					pref.log(&quot;Problem loading image. imgURL:&quot;+imgUrl);
+					pref.log(&quot;[getImages] Problem loading image. imgURL:&quot;+imgUrl,e);
 				}
 			}
 		}
@@ -2054,14 +2063,14 @@
 		//connImg.setRequestorProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.12) Gecko/20080201 Firefox/2.0.0.12&quot;);
 		//connImg.setRequestorProperty(&quot;Accept&quot;,&quot;text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5&quot;);
 		try{
-			pref.log(&quot;Trying to fetch image from: &quot; + imgUrl);
+			pref.log(&quot;[spiderImage] Trying to fetch image from: &quot; + imgUrl);
 			String redirect=null;
 			do {
 				sockImg = connImg.connect();
 				redirect=connImg.getRedirectTo();
 				if (redirect!=null) {
 					connImg=connImg.getRedirectedConnection(redirect);
-					pref.log(&quot;Redirect to &quot;+redirect);
+					pref.log(&quot;[spiderImage] Redirect to &quot;+redirect);
 				}
 			} while(redirect!=null); // TODO this can end up in an endless loop if trying to load from a malicous site
 			daten = connImg.readData(sockImg);
@@ -2070,11 +2079,11 @@
 			fos.close();
 			sockImg.close();
 		} catch (UnknownHostException e) {
-			pref.log(&quot;Host not there...&quot;);
-		}catch(IOException ioex){
-			pref.log(&quot;File not found!&quot;);
+			pref.log(&quot;[spiderImage] Host not there...&quot;,e);
+		} catch(IOException ioex){
+			pref.log(&quot;[spiderImage] File not found!&quot;,ioex);
 		} catch (Exception ex){
-			pref.log(&quot;Some other problem while fetching image&quot;,ex);
+			pref.log(&quot;[spiderImage] Some other problem while fetching image&quot;,ex);
 		} finally {
 			//Continue with the spider
 		}
@@ -2221,18 +2230,18 @@
 				conn.setRequestorProperty(&quot;Cookie&quot;, &quot;ASP.NET_SessionId=&quot;+cookieSession +&quot;; userid=&quot;+cookieID);
 				pref.log(&quot;[fetch]:Cookie Zeug: &quot; + &quot;Cookie: ASP.NET_SessionId=&quot;+cookieSession +&quot;; userid=&quot;+cookieID);
 			} else
-				pref.log(&quot;[fetch]:No Cookie found&quot;);
+				pref.log(&quot;[fetch]:No Cookie found&quot;,null);
 			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
 			conn.documentIsEncoded = true;
-			if (pref.debug) pref.log(&quot;[fetch]:Connecting &quot;+address);
+			pref.log(&quot;[fetch]:Connecting &quot;+address);
 			Socket sock = conn.connect();
-			if (pref.debug) pref.log(&quot;[fetch]:Connect ok! &quot;+address);
+			pref.log(&quot;[fetch]:Connect ok! &quot;+address);
 			// ByteArray daten = conn.readData(sock);
 			JavaUtf8Codec codec = new JavaUtf8Codec();
 			// c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
 			c_data = conn.readText(sock, codec);
 			sock.close();
-			if (pref.debug) pref.log(&quot;[fetch]:Read data ok &quot;+address);
+			pref.log(&quot;[fetch]:Read data ok &quot;+address);
 			return getResponseHeaders(conn)+ c_data.toString();
 		}catch(IOException ioex){
 			pref.log(&quot;IOException in fetch&quot;, ioex);
@@ -2258,22 +2267,21 @@
 			conn.setRequestorProperty(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
 			if(cookieSession.length()&gt;0){
 				conn.setRequestorProperty(&quot;Cookie&quot;, &quot;ASP.NET_SessionId=&quot;+cookieSession+&quot;; userid=&quot;+cookieID);
-				pref.log(&quot;[fetch_post]:Cookie Zeug: &quot; + &quot;Cookie: ASP.NET_SessionId=&quot;+cookieSession +&quot;; userid=&quot;+cookieID);
+				pref.log(&quot;[fetch_post] &quot; + &quot;Cookie: ASP.NET_SessionId=&quot;+cookieSession +&quot;; userid=&quot;+cookieID);
 			} else {
-				pref.log(&quot;[fetch_post]:No Cookie found&quot;);
+				pref.log(&quot;[fetch_post]:No Cookie found&quot;,null);
 			}
 			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-			if (pref.debug) pref.log(&quot;[fetch_post]:Connecting &quot;+address);
 			Socket sock = conn.connect();
-			if (pref.debug) pref.log(&quot;[fetch_post]:Connect ok! &quot;+address);
+			pref.log(&quot;[fetch_post]:Connect ok! &quot;+address);
 			// ByteArray daten = conn.readData(sock);
 			CharArray c_data = conn.readText(sock, codec);
-			if (pref.debug) pref.log(&quot;[fetch_post]:Read data ok &quot;+address);
+			pref.log(&quot;[fetch_post]:Read data ok &quot;+address);
 			// CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
 			sock.close();
 			return getResponseHeaders(conn)+c_data.toString();
 		} catch (Exception e) {
-			Global.getPref().log(&quot;Ignored Exception&quot;, e, true);
+			pref.log(&quot;[fetch_post] Ignored Exception&quot;, e, true);
 		}
 		return &quot;&quot;;
 	}
@@ -2326,10 +2334,10 @@
 		String bugList;
 		try{
 			//infB.setInfo(oldInfoBox+&quot;\nGetting bug: &quot;+bug);
-			pref.log(&quot;Fetching bugId: &quot;+name);
 			bugList = fetch(p.getProp(&quot;getBugByName&quot;)+STRreplace.replace(SafeXML.clean(name),&quot; &quot;,&quot;+&quot;));
+			pref.log(&quot;[getBugId] Fetched bugId: &quot;+name);
 		}catch(Exception ex){
-			pref.log(&quot;Could not fetch bug list&quot;);
+			pref.log(&quot;[getBugId] Could not fetch bug list&quot;+name,ex);
 			bugList=&quot;&quot;;
 		}
 		try {
@@ -2344,6 +2352,7 @@
 			Extractor exGuid = new Extractor(bugList,p.getProp(&quot;bugGuidExStart&quot;),p.getProp(&quot;bugGuidExEnd&quot;),0,Extractor.EXCLUDESTARTEND); // TODO Replace with spider.def
 			return exGuid.findNext();
 		} catch (Exception ex) {
+			pref.log(&quot;[getBugId] Error getting TB&quot;,ex);
 			return &quot;&quot;;
 		}
 	}
@@ -2358,13 +2367,13 @@
 		String bugDetails;
 		try{
 			//infB.setInfo(oldInfoBox+&quot;\nGetting bug: &quot;+bug);
-			pref.log(&quot;Fetching bug detailsById: &quot;+guid);
 			if (guid.length()&gt;10)
 				bugDetails = fetch(p.getProp(&quot;getBugByGuid&quot;)+guid);
 			else
 				bugDetails = fetch(p.getProp(&quot;getBugById&quot;)+guid);
+			pref.log(&quot;[getBugMissionByGuid] Fetched TB detailsById: &quot;+guid);
 		}catch(Exception ex){
-			pref.log(&quot;Could not fetch bug details&quot;);
+			pref.log(&quot;[getBugMissionByGuid] Could not fetch TB details &quot;+guid,ex);
 			bugDetails=&quot;&quot;;
 		}
 		try {
@@ -2375,6 +2384,7 @@
 			Extractor exDetails = new Extractor(bugDetails,p.getProp(&quot;bugDetailsStart&quot;),p.getProp(&quot;bugDetailsEnd&quot;),0,Extractor.EXCLUDESTARTEND);
 			return exDetails.findNext();
 		} catch (Exception ex) {
+			pref.log(&quot;[getBugMissionByGuid] Error getting TB &quot;+guid,ex);
 			return &quot;&quot;;
 		}
 	}
@@ -2387,20 +2397,22 @@
 	public String getBugMissionByTrackNr(String trackNr) {
 		String bugDetails;
 		try{
-			pref.log(&quot;Fetching bug detailsByTrackNr: &quot;+trackNr);
 			bugDetails = fetch(p.getProp(&quot;getBugByTrackNr&quot;)+trackNr);
+			pref.log(&quot;[getBugMissionByTrackNr] Fetched bug detailsByTrackNr: &quot;+trackNr);
 		}catch(Exception ex){
-			pref.log(&quot;Could not fetch bug details&quot;);
+			pref.log(&quot;[getBugMissionByTrackNr] getBugByTrackNr &quot;+trackNr,ex);
 			bugDetails=&quot;&quot;;
 		}
 		try {
 			if (bugDetails.indexOf(p.getProp(&quot;bugNotFound&quot;))&gt;=0) {
+				pref.log(&quot;[getBugMissionByTrackNr], bugNotFound &quot;+trackNr,null);
 //				(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(6020,&quot;Travelbug not found.&quot;), MessageBox.OKB)).execute();
 				return &quot;&quot;;
 			}
 			Extractor exDetails = new Extractor(bugDetails,p.getProp(&quot;bugDetailsStart&quot;),p.getProp(&quot;bugDetailsEnd&quot;),0,Extractor.EXCLUDESTARTEND);
 			return exDetails.findNext();
 		} catch (Exception ex) {
+			pref.log(&quot;[getBugMissionByTrackNr] TB Details, bugNotFound &quot;+trackNr,ex);
 			return &quot;&quot;;
 		}
 	}
@@ -2414,14 +2426,15 @@
 		String bugDetails;
 		String trackNr = TB.getTrackingNo();
 		try{
-			pref.log(&quot;Fetching bug detailsByTrackNr: &quot;+trackNr);
 			bugDetails = fetch(p.getProp(&quot;getBugByTrackNr&quot;)+trackNr);
+			pref.log(&quot;[getBugMissionAndNameByTrackNr] Fetched TB getBugByTrackNr: &quot;+trackNr);
 		}catch(Exception ex){
-			pref.log(&quot;Could not fetch bug details&quot;);
+			pref.log(&quot;[getBugMissionAndNameByTrackNr] Could not fetch bug details: &quot;+trackNr,ex);
 			bugDetails=&quot;&quot;;
 		}
 		try {
 			if (bugDetails.indexOf(p.getProp(&quot;bugNotFound&quot;))&gt;=0) {
+				pref.log(&quot;[getBugMissionAndNameByTrackNr], bugNotFound: &quot;+trackNr,null);
 //				(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(6020,&quot;Travelbug not found.&quot;), MessageBox.OKB)).execute();
 				return false;
 			}
@@ -2431,6 +2444,7 @@
 			TB.setName( exName.findNext() );
 			return true;
 		} catch (Exception ex) {
+			pref.log(&quot;[getBugMissionAndNameByTrackNr] TB Details, bugNotFound: &quot;+trackNr,ex);
 			return false;
 		}
 	}
@@ -2441,7 +2455,7 @@
 			try {
 				load(new FileInputStream(FileBase.getProgramDirectory()+&quot;/spider.def&quot;));
 			} catch (Exception ex) {
-				pref.log(&quot;Failed to load spider.def&quot;,ex);
+				pref.log(&quot;Failed to load spider.def from &quot;+FileBase.getProgramDirectory(),ex);
 				(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(5504,&quot;Could not load 'spider.def'&quot;), FormBase.OKB)).execute();
 			}
 		}
@@ -2456,6 +2470,7 @@
 			String s=super.getProperty(key);
 			if (s == null) {
 				(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(5497,&quot;Error missing tag in spider.def&quot;) + &quot;: &quot;+key, FormBase.OKB)).execute();
+				pref.log(&quot;Missing tag in spider.def: &quot;+key);
 				throw new Exception(&quot;Missing tag in spider.def: &quot;+key);
 			}
 			return s;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002754.html">[Cachewolf-svn] r2766 - trunk/src/CacheWolf/imp
</A></li>
	<LI>Next message: <A HREF="002757.html">[Cachewolf-svn] r2769 - in trunk: res_noewe src/CacheWolf	src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2756">[ date ]</a>
              <a href="thread.html#2756">[ thread ]</a>
              <a href="subject.html#2756">[ subject ]</a>
              <a href="author.html#2756">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
