<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r3002 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3002%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/exp%20src/CacheWolf/imp&In-Reply-To=%3C20110513222241.977754813CD%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002995.html">
   <LINK REL="Next"  HREF="002996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r3002 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp src/CacheWolf/imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3002%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/exp%20src/CacheWolf/imp&In-Reply-To=%3C20110513222241.977754813CD%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r3002 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp src/CacheWolf/imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Sat May 14 12:22:41 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002995.html">[Cachewolf-svn] r3004 - in trunk/src/CacheWolf: exp imp
</A></li>
        <LI>Next message: <A HREF="002996.html">[Cachewolf-svn] r3005 - in trunk/src/CacheWolf: . imp view/ewe	view/pda
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2993">[ date ]</a>
              <a href="thread.html#2993">[ thread ]</a>
              <a href="subject.html#2993">[ subject ]</a>
              <a href="author.html#2993">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2011-05-14 00:22:41 +0200 (Sat, 14 May 2011)
New Revision: 3002

Added:
   trunk/src/CacheWolf/exp/OCLogExport.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/languages/SV.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/imp/OCGPXfetch.java
   trunk/src/CacheWolf/imp/OCLinkImporter.java
   trunk/src/CacheWolf/myTableControl.java
Log:
1. add Exporter for automated writing of gc-logs to the OC database
2. improvements on the OC-Link Importer
3. improvements in gc-cache context menu for handling oc-caches

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/res_noewe/languages/DE.cfg	2011-05-13 22:22:41 UTC (rev 3002)
@@ -456,6 +456,7 @@
 1207=&#196;nderungen im Profil Speichern?
 1208=Bewertungen von gcvote
 1209=Link zu OC - Cache
+1210=Logs nach OC
 1300=Letzte Einstellung
 1301=Profil ausw&#228;hlen:
 1400=Zone

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/res_noewe/languages/EN.cfg	2011-05-13 22:22:41 UTC (rev 3002)
@@ -456,6 +456,7 @@
 1207=Your profile has unsaved changes. Do you want to save?
 1208=ratings from GCVote
 1209=link to OC - Cache
+1210=logs to OC
 1300=Last Setting
 1301=Select Profile:
 1400=Zone

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/res_noewe/languages/FR.cfg	2011-05-13 22:22:41 UTC (rev 3002)
@@ -456,6 +456,7 @@
 1207=Sauvegarder les changements dans le profil?
 1208=ratings from GCVote
 1209 = lien vers OC - Cache
+1210 = journaux pour OC
 1300=Dernier param&#232;tage
 1301=Choisir profil:
 1400=Zone

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/res_noewe/languages/NL.cfg	2011-05-13 22:22:41 UTC (rev 3002)
@@ -456,6 +456,7 @@
 1207=Jouw profiel is veranderd, wil je het profiel opslaan?
 1208=ratings from GCVote
 1209 = link naar OC - Cache
+1210 = logboeken naar OC
 1300=Laatste instellingen
 1301=Selecteer profiel
 1400=Zone

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/res_noewe/languages/PL.cfg	2011-05-13 22:22:41 UTC (rev 3002)
@@ -456,6 +456,7 @@
 1207=Twoj Profil ma niezapisane zmiany. Chcesz zapisac?
 1208=ratings from GCVote
 1209 = link do OC - Cache
+1210 = dziennik&#243;w OC
 1300=Ostatnie ustawienia
 1301=Wybierz Profil:
 1400=Strefa

Modified: trunk/res_noewe/languages/SV.cfg
===================================================================
--- trunk/res_noewe/languages/SV.cfg	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/res_noewe/languages/SV.cfg	2011-05-13 22:22:41 UTC (rev 3002)
@@ -456,6 +456,7 @@
 1207=Din profil har sparats. Vill du spara?
 1208=ratings from GCVote
 1209 = l&#228;nk till OC - Cache
+1210 = loggar till OC
 1300=senaste inst&#228;llningen
 1301=V&#228;lj profil:
 1400=Zone

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/src/CacheWolf/MainMenu.java	2011-05-13 22:22:41 UTC (rev 3002)
@@ -32,6 +32,7 @@
 import CacheWolf.exp.KMLExporter;
 import CacheWolf.exp.LocExporter;
 import CacheWolf.exp.MSARCSVExporter;
+import CacheWolf.exp.OCLogExport;
 import CacheWolf.exp.OVLExporter;
 import CacheWolf.exp.OziExporter;
 import CacheWolf.exp.SpoilerPOIExporter;
@@ -84,7 +85,7 @@
 	private MenuItem spider, spiderRoute, spiderQuick, spiderAllFinds, loadGCVotes, fetchOCLink, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
 	private MenuItem exportGpxNg, exporthtml, exporttop50, exportASC, exportTomTom, exportMSARCSV, exportSpoilerPOI;
-	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
+	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist, exportOCLog;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
 	private MenuItem exportLOC, exportGPS, mnuSeparator = new MenuItem(&quot;-&quot;);
 	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete, orgRebuild, orgCheckNotesAndSolver;
@@ -154,8 +155,9 @@
 				exportOZI = new MenuItem(MyLocale.getMsg(124, &quot;to OZI&quot;)), //
 				exportKML = new MenuItem(MyLocale.getMsg(125, &quot;to Google Earth&quot;)), //
 				exportExplorist = new MenuItem(MyLocale.getMsg(132, &quot;to Explorist&quot;)), //
+				exportSpoilerPOI = new MenuItem(MyLocale.getMsg(135, &quot;to SpoilerPOI&quot;)), //
 				exportTPL = new MenuItem(MyLocale.getMsg(128, &quot;via Template&quot;)), //
-				exportSpoilerPOI = new MenuItem(MyLocale.getMsg(135, &quot;to SpoilerPOI&quot;)), //
+				exportOCLog = new MenuItem(MyLocale.getMsg(1210, &quot;logs to OC&quot;)), //
 		};
 		if (Global.getPref().gpsbabel == null) {
 			exportGPS.modifiers = MenuItem.Disabled;
@@ -510,6 +512,11 @@
 					tpl.doIt();
 				}
 			}
+			//
+			if (mev.selectedItem == exportOCLog) {
+				OCLogExport.doit();
+				tbp.resetModel();
+			}
 			if (mev.selectedItem == exportExplorist) {
 				ExploristExporter mag = new ExploristExporter(pref, profile);
 				mag.doIt();

Added: trunk/src/CacheWolf/exp/OCLogExport.java
===================================================================
--- trunk/src/CacheWolf/exp/OCLogExport.java	                        (rev 0)
+++ trunk/src/CacheWolf/exp/OCLogExport.java	2011-05-13 22:22:41 UTC (rev 3002)
@@ -0,0 +1,91 @@
+package CacheWolf.exp;
+
+import CacheWolf.CacheDB;
+import CacheWolf.CacheHolder;
+import CacheWolf.CacheHolderDetail;
+import CacheWolf.DateFormat;
+import CacheWolf.Extractor;
+import CacheWolf.Global;
+import CacheWolf.OC;
+import CacheWolf.UrlFetcher;
+import CacheWolf.imp.OCGPXfetch;
+import CacheWolf.imp.OCLinkImporter;
+import ewe.io.IOException;
+import ewe.sys.Handle;
+import ewe.sys.Time;
+import ewe.sys.Vm;
+import ewe.ui.ProgressBarForm;
+
+public class OCLogExport {
+	private static boolean loggedIn = false;
+	private static CacheDB cacheDB = null;
+
+	public static void doit() {
+
+		if (cacheDB == null)
+			cacheDB = Global.getProfile().cacheDB;
+		int totalWaypoints = cacheDB.countVisible();
+		int updated = 0;
+		ProgressBarForm pbf = new ProgressBarForm();
+		Handle h = new Handle();
+
+		pbf.showMainTask = false;
+		pbf.setTask(h, &quot;logging opencaching ...&quot;);
+		pbf.exec();
+		if (OCGPXfetch.login()) {
+			for (int o = 0; o &lt; cacheDB.size(); o += 1) {
+				h.progress = (float) o / (float) totalWaypoints;
+				h.changed();
+				if (pbf.exitValue == -1)
+					break;
+				CacheHolder ch = cacheDB.get(o);
+				if (ch.isVisible()) {
+					doOneLog(ch);
+					updated++;
+				}
+			}
+		}
+		pbf.exit(0);
+	}
+
+	public static void doOneLog(CacheHolder ch) {
+		// take GC log direct to OC, needs valid ch
+		Vm.showWait(true);
+		String wpName = ch.getOcCacheID();
+		if (wpName.length() &gt; 1) {
+			if (!loggedIn)
+				loggedIn = OCGPXfetch.login();
+			if (loggedIn) {
+				if (wpName.charAt(0) &lt; 65) {
+					// noch nicht bei OC gelogged
+					wpName = ch.getOcCacheID().substring(1);
+					String url = &quot;<A HREF="http://">http://</A>&quot; + OC.getOCHostName(wpName) + &quot;/log.php?wp=&quot; + wpName;
+					String page = &quot;&quot;;
+					try {
+						CacheHolderDetail chD = ch.getCacheDetails(false);
+						page = UrlFetcher.fetch(url);
+						loggedIn = page.indexOf(&quot;Eingeloggt als&quot;) &gt; -1; // next time perhaps
+						String ocCacheId = new Extractor(page, &quot;viewcache.php?cacheid=&quot;, &quot;\&quot;&gt;&quot;, 0, true).findNext();
+						String postData = &quot;cacheid=&quot; + ocCacheId + &quot;&amp;version3=1&amp;descMode=3&amp;logtype=1&quot;;
+						Time logDate = DateFormat.toDate(chD.OwnLog.getDate());
+						postData += &quot;&amp;logday=&quot; + logDate.day;
+						postData += &quot;&amp;logmonth=&quot; + logDate.month;
+						postData += &quot;&amp;logyear=&quot; + logDate.year;
+						postData += &quot;&amp;logtext=&quot; + UrlFetcher.toUtf8Url(chD.OwnLog.getMessage());
+						postData += &quot;&amp;submitform=Log+eintragen&quot;; // todo for other opencaching sites
+						UrlFetcher.setpostData(postData);
+						page = UrlFetcher.fetch(url);
+						OCLinkImporter.updateOCLink(ch);
+						if (ch.getOcCacheID().startsWith(&quot;-&quot;)) {
+							ch.setOcCacheID(&quot;!&quot; + ch.getOcCacheID().substring(1));
+							ch.save();
+						}
+					} catch (IOException e) {
+						// dann nicht
+					}
+				}
+			}
+		}
+		Vm.showWait(false);
+	}
+}


Property changes on: trunk/src/CacheWolf/exp/OCLogExport.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Modified: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-05-13 22:22:41 UTC (rev 3002)
@@ -64,6 +64,7 @@
 
 	public static boolean login() {
 		// TODO this is only a preliminary Version of login
+		// todo for other opencaching sites
 		boolean loggedIn = false;
 		String page;
 		try {

Modified: trunk/src/CacheWolf/imp/OCLinkImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCLinkImporter.java	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/src/CacheWolf/imp/OCLinkImporter.java	2011-05-13 22:22:41 UTC (rev 3002)
@@ -28,8 +28,10 @@
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
 import CacheWolf.Global;
+import CacheWolf.OC;
 import CacheWolf.UrlFetcher;
 import ewe.sys.Handle;
+import ewe.sys.Vm;
 import ewe.ui.ProgressBarForm;
 
 public class OCLinkImporter {
@@ -39,6 +41,8 @@
 
 		if (cacheDB == null)
 			cacheDB = Global.getProfile().cacheDB;
+		int totalWaypoints = cacheDB.countVisible();
+		int updated = 0;
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
 
@@ -47,44 +51,70 @@
 		pbf.exec();
 		if (OCGPXfetch.login()) {
 			for (int o = 0; o &lt; cacheDB.size(); o += 1) {
-				h.progress = (float) o / (float) (cacheDB.size() - 1);
-				if (o % 100 == 0)
-					h.changed();
+				h.progress = (float) updated / (float) totalWaypoints;
+				h.changed();
 				if (pbf.exitValue == -1)
 					break;
 				CacheHolder ch = cacheDB.get(o);
-				if (ch.isVisible())
+				if (ch.isVisible()) {
 					updateOCLink(ch);
+					updated++;
+				}
 			}
 		}
 		pbf.exit(0);
 	}
 
 	public static void updateOCLink(CacheHolder ch) {
+		// todo other OC sites
+		Vm.showWait(true);
+		boolean save = false;
 		String wp = ch.getWayPoint();
 		if (wp.startsWith(&quot;GC&quot;)) {
-			String url = &quot;<A HREF="http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=">http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=</A>&quot; + wp;
-			ch.setOcCacheID(&quot;&quot;);
+			String wpName = ch.getOcCacheID();
+			if (wpName.length() &gt; 0) {
+				if (wpName.charAt(0) &lt; 65)
+					wp = wpName.substring(1);
+				else {
+					if (wpName.startsWith(&quot;OC&quot;)) // other OC sites
+						wp = wpName;
+				}
+				if (!wp.startsWith(&quot;OC&quot;)) {
+					// other OC sites
+					ch.setOcCacheID(&quot;&quot;); // there may be a value from gpx - import
+					save = true;
+				}
+			}
+			// other OC sites
+			String url = &quot;<A HREF="http://">http://</A>&quot; + OC.getOCHostName(&quot;OC&quot;) + &quot;/map2.php?mode=wpsearch&amp;wp=&quot; + wp;
 			try {
 				String result = UrlFetcher.fetch(url);
 				boolean found = false;
-				int start = result.indexOf(&quot;found=\&quot;&quot;) + 7;
-				if (result.substring(start).startsWith(&quot;1&quot;))
+				if (result.substring(result.indexOf(&quot;found=\&quot;&quot;) + 7).startsWith(&quot;1&quot;))
 					found = true;
-				start = result.indexOf(&quot;wpoc=\&quot;&quot;) + 6;
+				int start = result.indexOf(&quot;wpoc=\&quot;&quot;) + 6;
 				if (start &gt; 5) {
 					int idend = result.indexOf(&quot;\&quot;&quot;, start);
 					String ocwp = result.substring(start, idend);
 					if (!found)
 						ocwp = &quot;-&quot; + ocwp;
-					ch.setOcCacheID(ocwp);
+					if (!ocwp.equals(ch.getOcCacheID())) {
+						ch.setOcCacheID(ocwp);
+						save = true;
+					}
+				} else {
+					// check over coordinates
+					// still looking for the best method
+				}
+				if (save)
 					ch.save();
-				}
+
 			} catch (Exception e) {
 				// dann halt nicht
 			}
 		}
 		// return ch;
+		Vm.showWait(false);
 	}
 
 }

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2011-05-12 20:42:00 UTC (rev 3001)
+++ trunk/src/CacheWolf/myTableControl.java	2011-05-13 22:22:41 UTC (rev 3002)
@@ -25,8 +25,7 @@
  */
 package CacheWolf;
 
-import CacheWolf.imp.OCGPXfetch;
-import CacheWolf.imp.OCLinkImporter;
+import CacheWolf.exp.OCLogExport;
 import CacheWolf.utils.CWWrapper;
 import CacheWolf.utils.FileBugfix;
 import ewe.fx.IconAndText;
@@ -36,7 +35,6 @@
 import ewe.io.IOException;
 import ewe.sys.Handle;
 import ewe.sys.Locale;
-import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.Control;
 import ewe.ui.DragContext;
@@ -204,6 +202,9 @@
 	}
 
 	public void popupMenuEvent(Object selectedItem) {
+		String url;
+		CacheHolder mainCache;
+		CacheHolderDetail chD;
 		if (selectedItem == null)
 			return;
 		CacheHolder ch;
@@ -344,18 +345,17 @@
 
 		if (selectedItem == miOpenOnline) {
 			ch = cacheDB.get(tbp.getSelectedCache());
-			CacheHolder mainCache = ch;
+			mainCache = ch;
 			if (ch.isAddiWpt() &amp;&amp; (ch.mainCache != null)) {
 				mainCache = ch.mainCache;
 			}
-			CacheHolderDetail chD = mainCache.getCacheDetails(true);
-			String url = chD.URL;
-			if (clickedColumn == 14 &amp;&amp; mainCache.getOcCacheID().length() &gt; 0) {
-				if (!mainCache.getOcCacheID().startsWith(&quot;OC&quot;)) {
-					url = &quot;<A HREF="http://www.opencaching.de/viewcache.php?wp=">http://www.opencaching.de/viewcache.php?wp=</A>&quot; + mainCache.getOcCacheID().substring(1);
-				} else {
-					url = &quot;<A HREF="http://www.opencaching.de/viewcache.php?wp=">http://www.opencaching.de/viewcache.php?wp=</A>&quot; + mainCache.getOcCacheID();
-				}
+			chD = mainCache.getCacheDetails(true);
+			url = chD.URL;
+			String wpName = mainCache.getOcCacheID();
+			if (clickedColumn == 14 &amp;&amp; wpName.length() &gt; 0) {
+				if (wpName.charAt(0) &lt; 65)
+					wpName = mainCache.getOcCacheID().substring(1);
+				url = &quot;<A HREF="http://">http://</A>&quot; + OC.getOCHostName(wpName) + &quot;/viewcache.php?wp=&quot; + wpName;
 			}
 			if (url != null) {
 				callExternalProgram(pref.browser, url);
@@ -372,7 +372,7 @@
 				if (!pref.language.equalsIgnoreCase(&quot;auto&quot;)) {
 					language = pref.language;
 				}
-				String url = &quot;<A HREF="http://maps.google.">http://maps.google.</A>&quot; + language + &quot;/maps?q=&quot; + nameOfCache + &quot;@&quot; + lat + &quot;,&quot; + lon;
+				url = &quot;<A HREF="http://maps.google.">http://maps.google.</A>&quot; + language + &quot;/maps?q=&quot; + nameOfCache + &quot;@&quot; + lat + &quot;,&quot; + lon;
 				callExternalProgram(pref.browser, url);
 				url = &quot;<A HREF="http://www.geocaching.com/map/default.aspx?lat=">http://www.geocaching.com/map/default.aspx?lat=</A>&quot; + lat + &quot;&amp;lng=&quot; + lon;
 				callExternalProgram(pref.browser, url);
@@ -386,64 +386,49 @@
 
 		if (selectedItem == miLogOnline) {
 			ch = cacheDB.get(tbp.getSelectedCache());
-			CacheHolder mainCache = ch;
+			mainCache = ch;
+			url = &quot;&quot;;
 			if (ch.isAddiWpt() &amp;&amp; (ch.mainCache != null)) {
 				mainCache = ch.mainCache;
 			}
 			if (mainCache.isCacheWpt()) {
-				CacheHolderDetail chD = mainCache.getCacheDetails(true);
+				chD = mainCache.getCacheDetails(false);
 				if (chD != null) {
-					String URL = &quot;&quot;;
 					String notes = chD.getCacheNotes();
 					if (notes.length() &gt; 0) {
-						Vm.setClipboardText(notes);
+						Vm.setClipboardText(mainCache.getCacheStatus() + '\n' + &quot;&lt;br&gt;&quot; + notes);
 					}
-					if (ch.isOC()) {
-						URL = chD.URL;
-						if (URL.indexOf(&quot;viewcache&quot;) &gt;= 0) {
-							URL = STRreplace.replace(URL, &quot;viewcache&quot;, &quot;log&quot;);
-						} else {
-							URL = &quot;&quot;;
+					if (mainCache.isOC()) {
+						url = chD.URL;
+						if (url.indexOf(&quot;viewcache&quot;) &gt;= 0) {
+							url = STRreplace.replace(url, &quot;viewcache&quot;, &quot;log&quot;);
 						}
 					} else {
-						if (chD.OwnLogId.length() &gt; 0 &amp;&amp; mainCache.getOcCacheID().startsWith(&quot;-&quot;)) {
-							URL = &quot;<A HREF="http://www.opencaching.de/log.php?wp=">http://www.opencaching.de/log.php?wp=</A>&quot; + mainCache.getOcCacheID().substring(1);
-							if (clickedColumn == 14) {
-								// take GC log direct to OC
-								if (OCGPXfetch.login()) {
-									String page = &quot;&quot;;
-									try {
-										page = UrlFetcher.fetch(URL);
-										String ocCacheId = new Extractor(page, &quot;viewcache.php?cacheid=&quot;, &quot;\&quot;&gt;&quot;, 0, true).findNext();
-										String postData = &quot;cacheid=&quot; + ocCacheId + &quot;&amp;version3=1&amp;descMode=3&amp;logtype=1&quot;;
-										Time logDate = DateFormat.toDate(chD.OwnLog.getDate());
-										postData += &quot;&amp;logday=&quot; + logDate.day;
-										postData += &quot;&amp;logmonth=&quot; + logDate.month;
-										postData += &quot;&amp;logyear=&quot; + logDate.year;
-										postData += &quot;&amp;logtext=&quot; + UrlFetcher.toUtf8Url(chD.OwnLog.getMessage());
-										postData += &quot;&amp;submitform=Log+eintragen&quot;;
-										UrlFetcher.setpostData(postData);
-										page = UrlFetcher.fetch(URL);
-										OCLinkImporter.updateOCLink(ch);
-										if (ch.getOcCacheID().startsWith(&quot;-&quot;)) {
-											ch.setOcCacheID(&quot;!&quot; + ch.getOcCacheID().substring(1));
-											ch.save();
+						if (chD.OwnLogId.length() &gt; 0) {
+							String wpName = mainCache.getOcCacheID();
+							if (wpName.length() &gt; 0 &amp;&amp; wpName.charAt(0) &lt; 65) {
+								// OC log (already logged at GC but not at OC)
+								if (clickedColumn == 14) {
+									OCLogExport.doOneLog(mainCache);
+									tbp.refreshTable();
+								} else {
+									// open OC logpage with GC Logtext in Clipboard
+									Vm.setClipboardText(chD.OwnLog.getDate() + '\n' + &quot;&lt;br&gt;&quot; + chD.OwnLog.getMessage());
+									if (wpName.length() &gt; 1) {
+										if (wpName.charAt(0) &lt; 65) {
+											wpName = mainCache.getOcCacheID().substring(1);
 										}
-									} catch (IOException e) {
-										// dann nicht
+										url = &quot;<A HREF="http://">http://</A>&quot; + OC.getOCHostName(wpName) + &quot;/log.php?wp=&quot; + wpName;
 									}
 								}
-								URL = &quot;&quot;;
-							} else {
-								// open OC logpage with GC Logtext in Clipboard
-								Vm.setClipboardText(chD.OwnLog.getDate() + '\n' + &quot;&lt;br&gt;&quot; + chD.OwnLog.getMessage());
 							}
 						} else
-							URL = &quot;<A HREF="http://www.geocaching.com/seek/log.aspx?ID=">http://www.geocaching.com/seek/log.aspx?ID=</A>&quot; + mainCache.GetCacheID();
+							// GC log
+							url = &quot;<A HREF="http://www.geocaching.com/seek/log.aspx?ID=">http://www.geocaching.com/seek/log.aspx?ID=</A>&quot; + mainCache.GetCacheID();
 					}
 
-					if (URL.length() &gt; 0) {
-						callExternalProgram(pref.browser, URL);
+					if (url.length() &gt; 0) {
+						callExternalProgram(pref.browser, url);
 					}
 				}
 			}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002995.html">[Cachewolf-svn] r3004 - in trunk/src/CacheWolf: exp imp
</A></li>
	<LI>Next message: <A HREF="002996.html">[Cachewolf-svn] r3005 - in trunk/src/CacheWolf: . imp view/ewe	view/pda
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2993">[ date ]</a>
              <a href="thread.html#2993">[ thread ]</a>
              <a href="subject.html#2993">[ subject ]</a>
              <a href="author.html#2993">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
