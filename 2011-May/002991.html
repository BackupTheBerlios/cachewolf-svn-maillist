<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r3000 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3000%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/imp&In-Reply-To=%3C20110511230445.BDEBF481396%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002990.html">
   <LINK REL="Next"  HREF="002992.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r3000 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3000%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/imp&In-Reply-To=%3C20110511230445.BDEBF481396%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r3000 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Thu May 12 01:04:45 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002990.html">[Cachewolf-svn] r2999 - trunk/res_noewe
</A></li>
        <LI>Next message: <A HREF="002992.html">[Cachewolf-svn] r3001 - in trunk/src/CacheWolf: . imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2991">[ date ]</a>
              <a href="thread.html#2991">[ thread ]</a>
              <a href="subject.html#2991">[ subject ]</a>
              <a href="author.html#2991">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2011-05-12 01:04:45 +0200 (Thu, 12 May 2011)
New Revision: 3000

Added:
   trunk/src/CacheWolf/imp/OCLinkImporter.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/languages/SV.cfg
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MyComparer.java
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/imp/OCGPXfetch.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/myTableModel.java
Log:
new function : getting GCs corresponding OC CacheID (if exists) and OCs find status

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/res_noewe/languages/DE.cfg	2011-05-11 23:04:45 UTC (rev 3000)
@@ -455,6 +455,7 @@
 1206=Rechner
 1207=&#196;nderungen im Profil Speichern?
 1208=Bewertungen von gcvote
+1209=Link zu OC - Cache
 1300=Letzte Einstellung
 1301=Profil ausw&#228;hlen:
 1400=Zone

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/res_noewe/languages/EN.cfg	2011-05-11 23:04:45 UTC (rev 3000)
@@ -455,6 +455,7 @@
 1206=Calc
 1207=Your profile has unsaved changes. Do you want to save?
 1208=ratings from GCVote
+1209=link to OC - Cache
 1300=Last Setting
 1301=Select Profile:
 1400=Zone

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/res_noewe/languages/FR.cfg	2011-05-11 23:04:45 UTC (rev 3000)
@@ -455,6 +455,7 @@
 1206=Ordinateur
 1207=Sauvegarder les changements dans le profil?
 1208=ratings from GCVote
+1209 = lien vers OC - Cache
 1300=Dernier param&#232;tage
 1301=Choisir profil:
 1400=Zone

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/res_noewe/languages/NL.cfg	2011-05-11 23:04:45 UTC (rev 3000)
@@ -455,6 +455,7 @@
 1206=Calculator
 1207=Jouw profiel is veranderd, wil je het profiel opslaan?
 1208=ratings from GCVote
+1209 = link naar OC - Cache
 1300=Laatste instellingen
 1301=Selecteer profiel
 1400=Zone

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/res_noewe/languages/PL.cfg	2011-05-11 23:04:45 UTC (rev 3000)
@@ -455,6 +455,7 @@
 1206=Calc
 1207=Twoj Profil ma niezapisane zmiany. Chcesz zapisac?
 1208=ratings from GCVote
+1209 = link do OC - Cache
 1300=Ostatnie ustawienia
 1301=Wybierz Profil:
 1400=Strefa

Modified: trunk/res_noewe/languages/SV.cfg
===================================================================
--- trunk/res_noewe/languages/SV.cfg	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/res_noewe/languages/SV.cfg	2011-05-11 23:04:45 UTC (rev 3000)
@@ -455,6 +455,7 @@
 1206=Calc
 1207=Din profil har sparats. Vill du spara?
 1208=ratings from GCVote
+1209 = l&#228;nk till OC - Cache
 1300=senaste inst&#228;llningen
 1301=V&#228;lj profil:
 1400=Zone

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/src/CacheWolf/CacheHolder.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -514,7 +514,8 @@
 		this.setIncomplete(ch.is_incomplete());
 		this.addiWpts = ch.addiWpts;
 		this.mainCache = ch.mainCache;
-		this.setOcCacheID(ch.getOcCacheID());
+		if (ch.getOcCacheID().length() &gt; 0)
+			this.setOcCacheID(ch.getOcCacheID());
 		this.setNoFindLogs(ch.getNoFindLogs());
 		this.setHas_bugs(ch.has_bugs());
 		this.setHTML(ch.is_HTML());
@@ -1872,7 +1873,7 @@
 		if (!isCacheWpt())
 			return &quot;&quot;;
 		if (isOC()) {
-			return Convert.formatInt(numRecommended);
+			return Convert.formatInt(recommendationScore) + &quot; (&quot; + Convert.formatInt(numRecommended) + &quot;)&quot;;
 		} else {
 			int gcVote = numRecommended;
 			if (gcVote &lt; 100) {

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/src/CacheWolf/MainMenu.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -1,28 +1,28 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
 
 import CacheWolf.exp.ASCExporter;
@@ -42,6 +42,7 @@
 import CacheWolf.imp.GPXImporter;
 import CacheWolf.imp.LOCXMLImporter;
 import CacheWolf.imp.OCGPXfetch;
+import CacheWolf.imp.OCLinkImporter;
 import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.imp.OCXMLImporterScreen;
 import CacheWolf.imp.SpiderGC;
@@ -71,215 +72,141 @@
 import ewe.util.Vector;
 
 /**
- *	This class creates the menu for cachewolf. It is also responsible
- *	for reacting to user inputs in the menu.&lt;br&gt;
- *	This class id=100
- *	@see MainForm
- *	@see MainTab
- *   Last change:
- *     20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
+ * This class creates the menu for cachewolf. It is also responsible for reacting to user inputs in the menu.&lt;br&gt;
+ * This class id=100
+ * 
+ * @see MainForm
+ * @see MainTab Last change: 20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
  */
 public class MainMenu extends MenuBar {
-	private MenuItem preferences, mnuContext,loadcaches,loadOC, loadOCFinds, /* savenexit, */ savenoxit,exit,search,searchAll,searchClr;
+	private MenuItem preferences, mnuContext, loadcaches, loadOC, loadOCFinds, /* savenexit, */savenoxit, exit, search, searchAll, searchClr;
 	private MenuItem downloadmap, kalibmap, importmap, selectMapPath;
-	private MenuItem spider, spiderRoute, spiderQuick, spiderAllFinds, loadGCVotes, update, chkVersion;
+	private MenuItem spider, spiderRoute, spiderQuick, spiderAllFinds, loadGCVotes, fetchOCLink, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
 	private MenuItem exportGpxNg, exporthtml, exporttop50, exportASC, exportTomTom, exportMSARCSV, exportSpoilerPOI;
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
-	private MenuItem exportLOC, exportGPS, mnuSeparator=new MenuItem(&quot;-&quot;);
-	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild,orgCheckNotesAndSolver;
+	private MenuItem exportLOC, exportGPS, mnuSeparator = new MenuItem(&quot;-&quot;);
+	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete, orgRebuild, orgCheckNotesAndSolver;
 	public MenuItem cacheTour, orgTravelbugs, mnuForceLogin;
 	private MenuItem mnuNewProfile, mnuOpenProfile, mnuDeleteProfile, mnuRenameProfile, mnuEditCenter;
 	private Form father;
 	private TablePanel tbp;
-	private FilterScreen scnFilter=new FilterScreen();
+	private FilterScreen scnFilter = new FilterScreen();
 	private static boolean searchInDescriptionAndNotes = false;
 	private static boolean searchInLogs = false;
+	GCVoteImporter sGCV = null;
+	OCLinkImporter sOCL = null;
 
-	public MainMenu(Form f){
+	public MainMenu(Form f) {
 
 		Global.getPref().setgpsbabel();
 
 		father = f;
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// subMenu for profiles, part of &quot;Application&quot; menu below
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] mnuProfile = {
-			mnuNewProfile = new MenuItem(MyLocale.getMsg(1107,&quot;New&quot;)),
-			mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109,&quot;Open&quot;)),
-			mnuDeleteProfile = new MenuItem(MyLocale.getMsg(1125,&quot;Delete&quot;)),
-			mnuRenameProfile = new MenuItem(MyLocale.getMsg(1126,&quot;Rename&quot;)),
-		};
-		Menu profileMenu = new Menu(mnuProfile,MyLocale.getMsg(121,&quot;Profiles&quot;));
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] mnuProfile = { mnuNewProfile = new MenuItem(MyLocale.getMsg(1107, &quot;New&quot;)), mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109, &quot;Open&quot;)), mnuDeleteProfile = new MenuItem(MyLocale.getMsg(1125, &quot;Delete&quot;)),
+				mnuRenameProfile = new MenuItem(MyLocale.getMsg(1126, &quot;Rename&quot;)), };
+		Menu profileMenu = new Menu(mnuProfile, MyLocale.getMsg(121, &quot;Profiles&quot;));
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// subMenu for import, part of &quot;Application&quot; menu below
-		///////////////////////////////////////////////////////////////////////
-		if (Global.getPref().spiderRoute) 
-			spiderRoute = new MenuItem(MyLocale.getMsg(137,&quot;Download along a Route from geocaching.com&quot;));
-		else spiderRoute = mnuSeparator;
-		MenuItem[] mnuImport = {				
-				loadcaches     = new MenuItem(MyLocale.getMsg(129,&quot;Import GPX&quot;)),
-				mnuSeparator,
-				loadOC         = new MenuItem(MyLocale.getMsg(130,&quot;Download from opencaching&quot;)),
-				loadOCFinds    = new MenuItem(MyLocale.getMsg(163,&quot;Finds from opencaching&quot;)),
-				mnuSeparator,
-				spider         = new MenuItem(MyLocale.getMsg(131,&quot;Download from geocaching.com&quot;)),
-				spiderRoute,
-				spiderAllFinds = new MenuItem(MyLocale.getMsg(217,&quot;Spider all finds from geocaching.com&quot;)),
-				spiderQuick    = new MenuItem(MyLocale.getMsg(138,&quot;from GC quick&quot;)),
-				update         = new MenuItem(MyLocale.getMsg(1014,&quot;Update cache data&quot;)),
-				mnuSeparator,
-				loadGCVotes    = new MenuItem(MyLocale.getMsg(1208,&quot;Import ratings from GCVote&quot;)),
-				mnuSeparator,
-				mnuForceLogin  = new MenuItem(MyLocale.getMsg(216,&quot;Always login to GC&quot;)),
-		};
-		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175,&quot;Import&quot;));
-		if (Global.getPref().forceLogin) mnuForceLogin.modifiers^=MenuItem.Checked;
+		// /////////////////////////////////////////////////////////////////////
+		if (Global.getPref().spiderRoute)
+			spiderRoute = new MenuItem(MyLocale.getMsg(137, &quot;Download along a Route from geocaching.com&quot;));
+		else
+			spiderRoute = mnuSeparator;
+		MenuItem[] mnuImport = { loadcaches = new MenuItem(MyLocale.getMsg(129, &quot;Import GPX&quot;)), mnuSeparator, loadOC = new MenuItem(MyLocale.getMsg(130, &quot;Download from opencaching&quot;)),
+				loadOCFinds = new MenuItem(MyLocale.getMsg(163, &quot;Finds from opencaching&quot;)), mnuSeparator, spider = new MenuItem(MyLocale.getMsg(131, &quot;Download from geocaching.com&quot;)), spiderRoute,
+				spiderAllFinds = new MenuItem(MyLocale.getMsg(217, &quot;Spider all finds from geocaching.com&quot;)), spiderQuick = new MenuItem(MyLocale.getMsg(138, &quot;from GC quick&quot;)), update = new MenuItem(MyLocale.getMsg(1014, &quot;Update cache data&quot;)),
+				mnuSeparator, loadGCVotes = new MenuItem(MyLocale.getMsg(1208, &quot;Import ratings from GCVote&quot;)), fetchOCLink = new MenuItem(MyLocale.getMsg(1209, &quot;Fetch link to OC - Cache&quot;)), mnuSeparator,
+				mnuForceLogin = new MenuItem(MyLocale.getMsg(216, &quot;Always login to GC&quot;)), };
+		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175, &quot;Import&quot;));
+		if (Global.getPref().forceLogin)
+			mnuForceLogin.modifiers ^= MenuItem.Checked;
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// subMenu for export, part of &quot;Application&quot; menu below
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] exitems = {
-				exporthtml = new MenuItem(MyLocale.getMsg(100,&quot;to HTML&quot;)),
-				exportGpxNg = new MenuItem(MyLocale.getMsg(101,&quot;to GPX Test&quot;)),
-				exporttop50 = new MenuItem(MyLocale.getMsg(102,&quot;to TOP50 ASCII&quot;)),
-				exportASC = new MenuItem(MyLocale.getMsg(104,&quot;to CSV&quot;)),
-				exportTomTom = new MenuItem(MyLocale.getMsg(105,&quot;to TomTom&quot;)),
-				exportMSARCSV = new MenuItem(MyLocale.getMsg(106,&quot;to MS AutoRoute CSV&quot;)),
-				exportLOC = new MenuItem(MyLocale.getMsg(215,&quot;to LOC&quot;)),
-				exportGPS = new MenuItem(MyLocale.getMsg(122,&quot;to GPS&quot;)),
-				exportOZI = new MenuItem(MyLocale.getMsg(124,&quot;to OZI&quot;)),
-				exportKML = new MenuItem(MyLocale.getMsg(125,&quot;to Google Earth&quot;)),
-				exportExplorist = new MenuItem(MyLocale.getMsg(132,&quot;to Explorist&quot;)),
-				exportTPL = new MenuItem(MyLocale.getMsg(128,&quot;via Template&quot;)),
-				exportSpoilerPOI = new MenuItem(MyLocale.getMsg(135,&quot;to SpoilerPOI&quot;)),
-		};
-		if ( Global.getPref().gpsbabel == null ) {
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] exitems = { exporthtml = new MenuItem(MyLocale.getMsg(100, &quot;to HTML&quot;)), exportGpxNg = new MenuItem(MyLocale.getMsg(101, &quot;to GPX Test&quot;)), exporttop50 = new MenuItem(MyLocale.getMsg(102, &quot;to TOP50 ASCII&quot;)),
+				exportASC = new MenuItem(MyLocale.getMsg(104, &quot;to CSV&quot;)), exportTomTom = new MenuItem(MyLocale.getMsg(105, &quot;to TomTom&quot;)), exportMSARCSV = new MenuItem(MyLocale.getMsg(106, &quot;to MS AutoRoute CSV&quot;)),
+				exportLOC = new MenuItem(MyLocale.getMsg(215, &quot;to LOC&quot;)), exportGPS = new MenuItem(MyLocale.getMsg(122, &quot;to GPS&quot;)), exportOZI = new MenuItem(MyLocale.getMsg(124, &quot;to OZI&quot;)),
+				exportKML = new MenuItem(MyLocale.getMsg(125, &quot;to Google Earth&quot;)), exportExplorist = new MenuItem(MyLocale.getMsg(132, &quot;to Explorist&quot;)), exportTPL = new MenuItem(MyLocale.getMsg(128, &quot;via Template&quot;)),
+				exportSpoilerPOI = new MenuItem(MyLocale.getMsg(135, &quot;to SpoilerPOI&quot;)), };
+		if (Global.getPref().gpsbabel == null) {
 			exportGPS.modifiers = MenuItem.Disabled;
-			exportGPS.setText(MyLocale.getMsg(136,&quot;to GPS : gpsbabel missing.&quot;));
+			exportGPS.setText(MyLocale.getMsg(136, &quot;to GPS : gpsbabel missing.&quot;));
 		}
 
-		Menu exportMenu = new Menu(exitems, MyLocale.getMsg(107,&quot;Export&quot;));
+		Menu exportMenu = new Menu(exitems, MyLocale.getMsg(107, &quot;Export&quot;));
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// subMenu for maps, part of &quot;Application&quot; menu below
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] mapMenuItems = {
-				downloadmap = new MenuItem(MyLocale.getMsg(162,&quot;Download calibrated&quot;)),
-				importmap = new MenuItem(MyLocale.getMsg(150,&quot;Import&quot;)),
-				kalibmap = new MenuItem(MyLocale.getMsg(151,&quot;Calibrate&quot;)),
-				selectMapPath = new MenuItem(MyLocale.getMsg(4236, &quot;Change map directory$c&quot;)),
-		};
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] mapMenuItems = { downloadmap = new MenuItem(MyLocale.getMsg(162, &quot;Download calibrated&quot;)), importmap = new MenuItem(MyLocale.getMsg(150, &quot;Import&quot;)), kalibmap = new MenuItem(MyLocale.getMsg(151, &quot;Calibrate&quot;)),
+				selectMapPath = new MenuItem(MyLocale.getMsg(4236, &quot;Change map directory$c&quot;)), };
 		Menu mapsMenu = new Menu(mapMenuItems, null);
 
 		// Now we start with the horizontal menu bar &quot;Application&quot;, &quot;Search&quot;, &quot;Filter&quot;, &quot;Organise&quot;, &quot;About&quot;
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Application&quot; pulldown menu
-		///////////////////////////////////////////////////////////////////////
-		MenuItem [] appMenuItems={
-				new MenuItem(MyLocale.getMsg(121,&quot;Profile&quot;), 0, profileMenu),
-				preferences = new MenuItem(MyLocale.getMsg(108,&quot;Preferences&quot;)),
-				mnuEditCenter = new MenuItem(MyLocale.getMsg(1110,&quot;Centre&quot;)),
-				mnuContext = new MenuItem(MyLocale.getMsg(134,&quot;Current Cache&quot;)),
-				mnuSeparator,
-				new MenuItem(MyLocale.getMsg(175,&quot;Import&quot;),0,importMenu),
-				new MenuItem(MyLocale.getMsg(107,&quot;Export&quot;),0,exportMenu),
-				new MenuItem(MyLocale.getMsg(149,&quot;Maps&quot;),0,mapsMenu),
-				mnuSeparator,
-				savenoxit = new MenuItem(MyLocale.getMsg(127,&quot;Save&quot;)),
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] appMenuItems = { new MenuItem(MyLocale.getMsg(121, &quot;Profile&quot;), 0, profileMenu), preferences = new MenuItem(MyLocale.getMsg(108, &quot;Preferences&quot;)), mnuEditCenter = new MenuItem(MyLocale.getMsg(1110, &quot;Centre&quot;)),
+				mnuContext = new MenuItem(MyLocale.getMsg(134, &quot;Current Cache&quot;)), mnuSeparator, new MenuItem(MyLocale.getMsg(175, &quot;Import&quot;), 0, importMenu), new MenuItem(MyLocale.getMsg(107, &quot;Export&quot;), 0, exportMenu),
+				new MenuItem(MyLocale.getMsg(149, &quot;Maps&quot;), 0, mapsMenu), mnuSeparator, savenoxit = new MenuItem(MyLocale.getMsg(127, &quot;Save&quot;)),
 				// savenexit = new MenuItem(MyLocale.getMsg(110,&quot;Save &amp; Exit&quot;)),
-				exit = new MenuItem(MyLocale.getMsg(111,&quot;Exit&quot;)),
-		};
-		this.addMenu(new PullDownMenu(MyLocale.getMsg(120,&quot;Application&quot;),new Menu(appMenuItems,null)));
+				exit = new MenuItem(MyLocale.getMsg(111, &quot;Exit&quot;)), };
+		this.addMenu(new PullDownMenu(MyLocale.getMsg(120, &quot;Application&quot;), new Menu(appMenuItems, null)));
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Search&quot; pulldown menu
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] searchMenuItems={
-				search = new MenuItem(MyLocale.getMsg(112,&quot;Search$&quot;+(char)6)),// char 6 = ctrl +f
-				searchAll = new MenuItem(MyLocale.getMsg(133,&quot;Search All&quot;)),
-				searchClr = new MenuItem(MyLocale.getMsg(113,&quot;Clear search&quot;)),
-		};
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] searchMenuItems = { search = new MenuItem(MyLocale.getMsg(112, &quot;Search$&quot; + (char) 6)),// char 6 = ctrl +f
+				searchAll = new MenuItem(MyLocale.getMsg(133, &quot;Search All&quot;)), searchClr = new MenuItem(MyLocale.getMsg(113, &quot;Clear search&quot;)), };
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Filter&quot; pulldown menu
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] filterMenuItems={
-				filtApply  = new MenuItem(MyLocale.getMsg(709,&quot;Apply&quot;)),
-				filtCreate  = new MenuItem(MyLocale.getMsg(114,&quot;Create&quot;)),
-				filtInvert  = new MenuItem(MyLocale.getMsg(115,&quot;Invert&quot;)),
-				filtClear   = new MenuItem(MyLocale.getMsg(116,&quot;Clear&quot;)),
-				mnuSeparator,
-				filtSelected = new MenuItem(MyLocale.getMsg(160,&quot;Filter selected&quot;)),
-				filtNonSelected = new MenuItem(MyLocale.getMsg(1011,&quot;Filter out non selected&quot;)),
-				mnuSeparator,
-				filtBlack   = new MenuItem(MyLocale.getMsg(161,&quot;Show Blacklist&quot;)),
-		};
-        filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] filterMenuItems = { filtApply = new MenuItem(MyLocale.getMsg(709, &quot;Apply&quot;)), filtCreate = new MenuItem(MyLocale.getMsg(114, &quot;Create&quot;)), filtInvert = new MenuItem(MyLocale.getMsg(115, &quot;Invert&quot;)),
+				filtClear = new MenuItem(MyLocale.getMsg(116, &quot;Clear&quot;)), mnuSeparator, filtSelected = new MenuItem(MyLocale.getMsg(160, &quot;Filter selected&quot;)), filtNonSelected = new MenuItem(MyLocale.getMsg(1011, &quot;Filter out non selected&quot;)), mnuSeparator,
+				filtBlack = new MenuItem(MyLocale.getMsg(161, &quot;Show Blacklist&quot;)), };
+		filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// Create a combined &quot;Filter and Search&quot; pulldown menu for devices with small screens
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] filterAndSearchMenuItems={
-				filtApply,
-				filtCreate,
-				filtInvert,
-				filtClear,
-				mnuSeparator,
-				filtSelected,
-				filtNonSelected,
-				mnuSeparator,
-				filtBlack,
-				mnuSeparator,
-				search,
-				searchClr,
-		};
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] filterAndSearchMenuItems = { filtApply, filtCreate, filtInvert, filtClear, mnuSeparator, filtSelected, filtNonSelected, mnuSeparator, filtBlack, mnuSeparator, search, searchClr, };
 
 		// Depending on screen width display either filter and search menus or the combined menu
-		if (MyLocale.getScreenWidth()&gt;300) {
-			this.addMenu(new PullDownMenu(MyLocale.getMsg(112,&quot;Search&quot;),new Menu(searchMenuItems,null)));
-			this.addMenu(new PullDownMenu(MyLocale.getMsg(159,&quot;Filter&quot;),new Menu(filterMenuItems,null)));
+		if (MyLocale.getScreenWidth() &gt; 300) {
+			this.addMenu(new PullDownMenu(MyLocale.getMsg(112, &quot;Search&quot;), new Menu(searchMenuItems, null)));
+			this.addMenu(new PullDownMenu(MyLocale.getMsg(159, &quot;Filter&quot;), new Menu(filterMenuItems, null)));
 		} else {
-			this.addMenu(new PullDownMenu(MyLocale.getMsg(159,&quot;Filter&quot;),new Menu(filterAndSearchMenuItems,null)));
+			this.addMenu(new PullDownMenu(MyLocale.getMsg(159, &quot;Filter&quot;), new Menu(filterAndSearchMenuItems, null)));
 		}
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Organise&quot; pulldown menu
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] organiseMenuItems={				
-				orgNewWP = new MenuItem(MyLocale.getMsg(214,&quot;New Waypoint&quot;)),
-				mnuSeparator,
-				orgCopy  = new MenuItem(MyLocale.getMsg(141,&quot;Copy&quot;)),
-				orgMove  = new MenuItem(MyLocale.getMsg(142,&quot;Move&quot;)),
-				orgDelete   = new MenuItem(MyLocale.getMsg(143,&quot;Delete&quot;)),
-				orgRebuild   = new MenuItem(MyLocale.getMsg(208,&quot;Rebuild Index&quot;)),
-				orgCheckNotesAndSolver = new MenuItem(MyLocale.getMsg(220,&quot;Check Notes/Solver&quot;)),
-				mnuSeparator,
-				orgTravelbugs = new MenuItem(MyLocale.getMsg(139,&quot;Manage travelbugs&quot;)),
-				cacheTour = new MenuItem(MyLocale.getMsg(198,&quot;Cachetour&quot;)),
-		};
-		this.addMenu(new PullDownMenu(MyLocale.getMsg(140,&quot;Organise&quot;),new Menu(organiseMenuItems,null)));
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] organiseMenuItems = { orgNewWP = new MenuItem(MyLocale.getMsg(214, &quot;New Waypoint&quot;)), mnuSeparator, orgCopy = new MenuItem(MyLocale.getMsg(141, &quot;Copy&quot;)), orgMove = new MenuItem(MyLocale.getMsg(142, &quot;Move&quot;)),
+				orgDelete = new MenuItem(MyLocale.getMsg(143, &quot;Delete&quot;)), orgRebuild = new MenuItem(MyLocale.getMsg(208, &quot;Rebuild Index&quot;)), orgCheckNotesAndSolver = new MenuItem(MyLocale.getMsg(220, &quot;Check Notes/Solver&quot;)), mnuSeparator,
+				orgTravelbugs = new MenuItem(MyLocale.getMsg(139, &quot;Manage travelbugs&quot;)), cacheTour = new MenuItem(MyLocale.getMsg(198, &quot;Cachetour&quot;)), };
+		this.addMenu(new PullDownMenu(MyLocale.getMsg(140, &quot;Organise&quot;), new Menu(organiseMenuItems, null)));
 
-		///////////////////////////////////////////////////////////////////////
+		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;About&quot; pulldown menu
-		///////////////////////////////////////////////////////////////////////
-		MenuItem[] aboutMenuItems={
-				about = new MenuItem(MyLocale.getMsg(117,&quot;About&quot;)),
-				legend = new MenuItem(MyLocale.getMsg(155,&quot;Legend&quot;)),
-				wolflang = new MenuItem(MyLocale.getMsg(118,&quot;WolfLanguage&quot;)),
-				sysinfo = new MenuItem(MyLocale.getMsg(157,&quot;System&quot;)),
-				chkVersion = new MenuItem(MyLocale.getMsg(158,&quot;Version Check&quot;)),
-		};
-		this.addMenu(new PullDownMenu(MyLocale.getMsg(117,&quot;About&quot;),new Menu(aboutMenuItems,null)));
+		// /////////////////////////////////////////////////////////////////////
+		MenuItem[] aboutMenuItems = { about = new MenuItem(MyLocale.getMsg(117, &quot;About&quot;)), legend = new MenuItem(MyLocale.getMsg(155, &quot;Legend&quot;)), wolflang = new MenuItem(MyLocale.getMsg(118, &quot;WolfLanguage&quot;)),
+				sysinfo = new MenuItem(MyLocale.getMsg(157, &quot;System&quot;)), chkVersion = new MenuItem(MyLocale.getMsg(158, &quot;Version Check&quot;)), };
+		this.addMenu(new PullDownMenu(MyLocale.getMsg(117, &quot;About&quot;), new Menu(aboutMenuItems, null)));
 	}
 
-	public void setTablePanel(TablePanel t){
+	public void setTablePanel(TablePanel t) {
 		tbp = t;
 		if (mnuContext.subMenu == null) {
-			if ((&quot;,&quot;+Global.getPref().listColMap+&quot;,&quot;).indexOf(&quot;,0,&quot;)&gt;=0)
+			if ((&quot;,&quot; + Global.getPref().listColMap + &quot;,&quot;).indexOf(&quot;,0,&quot;) &gt;= 0)
 				mnuContext.subMenu = tbp.tc.getMenuFull();
 			else
 				mnuContext.subMenu = tbp.tc.getMenuSmall();
@@ -288,21 +215,21 @@
 
 	public void allowProfileChange(boolean profileChangeAllowed) {
 		if (profileChangeAllowed) {
-			mnuNewProfile.modifiers&amp;=~MenuItem.Disabled;
-			mnuOpenProfile.modifiers&amp;=~MenuItem.Disabled;
+			mnuNewProfile.modifiers &amp;= ~MenuItem.Disabled;
+			mnuOpenProfile.modifiers &amp;= ~MenuItem.Disabled;
 		} else {
-			mnuNewProfile.modifiers|=MenuItem.Disabled;
-			mnuOpenProfile.modifiers|=MenuItem.Disabled;
+			mnuNewProfile.modifiers |= MenuItem.Disabled;
+			mnuOpenProfile.modifiers |= MenuItem.Disabled;
 		}
 	}
 
 	public void setForceLogin() {
-		mnuForceLogin.modifiers=Global.getPref().forceLogin ? Global.mainTab.mnuMain.modifiers|MenuItem.Checked : Global.mainTab.mnuMain.modifiers&amp;~MenuItem.Checked;
+		mnuForceLogin.modifiers = Global.getPref().forceLogin ? Global.mainTab.mnuMain.modifiers | MenuItem.Checked : Global.mainTab.mnuMain.modifiers &amp; ~MenuItem.Checked;
 	}
 
 	public static void search() {
-		SearchBox inp = new SearchBox(MyLocale.getMsg(119,&quot;Search for:&quot;));
-		String srch = inp.input(null,&quot;&quot;,searchInDescriptionAndNotes,searchInLogs,10);
+		SearchBox inp = new SearchBox(MyLocale.getMsg(119, &quot;Search for:&quot;));
+		String srch = inp.input(null, &quot;&quot;, searchInDescriptionAndNotes, searchInLogs, 10);
 		MyLocale.setSIPOff();
 		if (srch != null) {
 			searchInDescriptionAndNotes = inp.useNoteDesc();
@@ -312,60 +239,61 @@
 			Global.mainTab.tbP.refreshTable();
 		}
 	}
-	public void onEvent(Event ev){
-		Preferences pref=Global.getPref();
-		Profile profile=Global.getProfile();
-		CacheDB cacheDB=profile.cacheDB;
+
+	public void onEvent(Event ev) {
+		Preferences pref = Global.getPref();
+		Profile profile = Global.getProfile();
+		CacheDB cacheDB = profile.cacheDB;
 		Global.mainTab.updatePendingChanges();
-		if (ev instanceof MenuEvent){ //&amp;&amp; ev.type == MenuEvent.PRESSED
-			MenuEvent mev = (MenuEvent)ev;
-			///////////////////////////////////////////////////////////////////////
+		if (ev instanceof MenuEvent) { // &amp;&amp; ev.type == MenuEvent.PRESSED
+			MenuEvent mev = (MenuEvent) ev;
+			// /////////////////////////////////////////////////////////////////////
 			// subMenu for profiles, part of &quot;Application&quot; menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == mnuNewProfile){
-				if (NewProfileWizard.startNewProfileWizard(getFrame()) ) {
-					tbp.myMod.numRows=0;
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == mnuNewProfile) {
+				if (NewProfileWizard.startNewProfileWizard(getFrame())) {
+					tbp.myMod.numRows = 0;
 					pref.setCurCentrePt(profile.centre);
-		            filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
+					filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 					tbp.refreshTable();
 				}
 			}
-			if(mev.selectedItem == mnuOpenProfile){
+			if (mev.selectedItem == mnuOpenProfile) {
 				Global.mainTab.saveUnsavedChanges(true);
-				if (pref.selectProfile(profile,Preferences.PROFILE_SELECTOR_FORCED_ON,false)) {
-					tbp.myMod.sortedBy=-1;
-					tbp.myMod.numRows=0;
+				if (pref.selectProfile(profile, Preferences.PROFILE_SELECTOR_FORCED_ON, false)) {
+					tbp.myMod.sortedBy = -1;
+					tbp.myMod.numRows = 0;
 					CacheHolder.removeAllDetails();
 					profile.cacheDB.clear();
-					InfoBox infB = new InfoBox(&quot;CacheWolf&quot;,MyLocale.getMsg(5000,&quot;Loading Cache-List&quot;));
+					InfoBox infB = new InfoBox(&quot;CacheWolf&quot;, MyLocale.getMsg(5000, &quot;Loading Cache-List&quot;));
 					infB.exec();
 					infB.waitUntilPainted(1000);
 					Vm.showWait(infB, true);
 					profile.readIndex(infB);
 					Vm.showWait(infB, false);
 					pref.setCurCentrePt(profile.centre);
-                    filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
-        			Global.mainForm.setTitle(profile.name + &quot; - CW &quot;+Version.getRelease());
+					filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
+					Global.mainForm.setTitle(profile.name + &quot; - CW &quot; + Version.getRelease());
 					infB.close(0);
 					tbp.resetModel();
 				}
 			}
-			if(mev.selectedItem == mnuDeleteProfile) {
-				pref.editProfile(2,227,226);
+			if (mev.selectedItem == mnuDeleteProfile) {
+				pref.editProfile(2, 227, 226);
 			}
-			if(mev.selectedItem == mnuRenameProfile) {
-				pref.editProfile(3,228,229);
+			if (mev.selectedItem == mnuRenameProfile) {
+				pref.editProfile(3, 228, 229);
 			}
-			if(mev.selectedItem == mnuEditCenter){
-				ProfileDataForm f=new ProfileDataForm(pref,profile);
+			if (mev.selectedItem == mnuEditCenter) {
+				ProfileDataForm f = new ProfileDataForm(pref, profile);
 				f.execute(getFrame(), Gui.CENTER_FRAME);
 				tbp.refreshTable();
 				f.close(0);
 			}
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// subMenu for import, part of &quot;Application&quot; menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == spider){
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == spider) {
 				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doIt();
@@ -373,7 +301,7 @@
 				profile.readIndex();
 				tbp.resetModel();
 			}
-			if(mev.selectedItem == spiderRoute){
+			if (mev.selectedItem == spiderRoute) {
 				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doItAlongARoute();
@@ -381,7 +309,7 @@
 				profile.readIndex();
 				tbp.resetModel();
 			}
-			if(mev.selectedItem == spiderQuick){
+			if (mev.selectedItem == spiderQuick) {
 				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doItQuickFillFromMapList();
@@ -389,7 +317,7 @@
 				profile.readIndex();
 				tbp.resetModel();
 			}
-			if(mev.selectedItem == spiderAllFinds){
+			if (mev.selectedItem == spiderAllFinds) {
 				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doIt(true);
@@ -397,253 +325,256 @@
 				profile.readIndex();
 				tbp.resetModel();
 			}
-			if(mev.selectedItem == loadGCVotes){
-                GCVoteImporter sGCV = new GCVoteImporter(pref, profile);
-                sGCV.doIt();
-                tbp.resetModel();
+			if (mev.selectedItem == loadGCVotes) {
+				if (sGCV == null)
+					sGCV = new GCVoteImporter(pref, profile);
+				sGCV.doIt();
+				tbp.resetModel();
 			}
-			if(mev.selectedItem == loadcaches){
+			if (mev.selectedItem == fetchOCLink) {
+				if (sOCL == null)
+					sOCL = new OCLinkImporter();
+				sOCL.doIt();
+				tbp.resetModel();
+			}
+			if (mev.selectedItem == loadcaches) {
 				String dir = pref.getImporterPath(&quot;LocGpxImporter&quot;);
-				FileChooser fc = new FileChooser(FileChooserBase.OPEN|FileChooserBase.MULTI_SELECT, dir);
+				FileChooser fc = new FileChooser(FileChooserBase.OPEN | FileChooserBase.MULTI_SELECT, dir);
 				fc.addMask(&quot;*.gpx,*.zip,*.loc,fieldnotes.txt,geocache_visits.txt,FieldNotes.log,newlogs.txt&quot;);
-				fc.setTitle(MyLocale.getMsg(909,&quot;Select file(s)&quot;));
-				if(fc.execute() != FormBase.IDCANCEL){
+				fc.setTitle(MyLocale.getMsg(909, &quot;Select file(s)&quot;));
+				if (fc.execute() != FormBase.IDCANCEL) {
 					dir = fc.getChosenDirectory().toString();
 					pref.setImporterPath(&quot;LocGpxImporter&quot;, dir);
 					String files[] = fc.getAllChosen();
 					int how = GPXImporter.DOIT_ASK;
-					for (int i = 0; i &lt; files.length; i++){
+					for (int i = 0; i &lt; files.length; i++) {
 						String file = dir + &quot;/&quot; + files[i];
-						if (file.endsWith(&quot;txt&quot;)||file.endsWith(&quot;log&quot;)){
-							FieldnotesImporter fn=new FieldnotesImporter(pref, profile, file);
+						if (file.endsWith(&quot;txt&quot;) || file.endsWith(&quot;log&quot;)) {
+							FieldnotesImporter fn = new FieldnotesImporter(pref, profile, file);
 							fn.doIt();
-						}
-						else if (file.endsWith(&quot;loc&quot;)){
+						} else if (file.endsWith(&quot;loc&quot;)) {
 							LOCXMLImporter loc = new LOCXMLImporter(pref, profile, file);
 							loc.doIt();
-						}
-						else { //gpx + zip
+						} else { // gpx + zip
 							GPXImporter gpx = new GPXImporter(pref, profile, file);
 							gpx.doIt(how);
 							how = gpx.getHow();
 						}
 					}
 				}
-                Global.getProfile().setShowBlacklisted(false);
-                filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
+				Global.getProfile().setShowBlacklisted(false);
+				filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 				tbp.resetModel();
 			}
-			if(mev.selectedItem == loadOC){
-				OCXMLImporter oc = new OCXMLImporter(pref,profile);
+			if (mev.selectedItem == loadOC) {
+				OCXMLImporter oc = new OCXMLImporter(pref, profile);
 				oc.doIt();
-                Global.getProfile().setShowBlacklisted(false);
-                filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
+				Global.getProfile().setShowBlacklisted(false);
+				filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 				tbp.resetModel();
 			}
-			if(mev.selectedItem == loadOCFinds){
+			if (mev.selectedItem == loadOCFinds) {
 				OCGPXfetch.doIt();
-                Global.getProfile().setShowBlacklisted(false);
-                filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
+				Global.getProfile().setShowBlacklisted(false);
+				filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 				tbp.resetModel();
 			}
 			if (mev.selectedItem == update)
 				updateSelectedCaches(tbp);
-			if(mev.selectedItem == mnuForceLogin) {
-				mnuForceLogin.modifiers^=MenuItem.Checked;
-				Global.getPref().forceLogin=(mnuForceLogin.modifiers&amp;MenuItem.Checked)!=0;
+			if (mev.selectedItem == mnuForceLogin) {
+				mnuForceLogin.modifiers ^= MenuItem.Checked;
+				Global.getPref().forceLogin = (mnuForceLogin.modifiers &amp; MenuItem.Checked) != 0;
 				Global.getPref().savePreferences();
 			}
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// subMenu for export, part of &quot;Application&quot; menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == exporthtml){
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == exporthtml) {
 				HTMLExporter htm = new HTMLExporter(pref, profile);
 				htm.doIt();
 			}
-			if(mev.selectedItem == exportGpxNg){
+			if (mev.selectedItem == exportGpxNg) {
 				GpxExportNg gpx = new GpxExportNg();
 				gpx.doit();
 			}
-			if(mev.selectedItem == exporttop50){
+			if (mev.selectedItem == exporttop50) {
 				OVLExporter ovl = new OVLExporter(pref, profile);
 				ovl.doIt();
 			}
-			if(mev.selectedItem == exportASC){
-				ASCExporter asc = new ASCExporter(pref,profile);
+			if (mev.selectedItem == exportASC) {
+				ASCExporter asc = new ASCExporter(pref, profile);
 				asc.doIt();
 			}
-			if(mev.selectedItem == exportTomTom){
+			if (mev.selectedItem == exportTomTom) {
 				TomTomExporter tt = new TomTomExporter();
 				tt.doIt();
 			}
-			if(mev.selectedItem == exportMSARCSV){
-				MSARCSVExporter msar = new MSARCSVExporter(pref,profile);
+			if (mev.selectedItem == exportMSARCSV) {
+				MSARCSVExporter msar = new MSARCSVExporter(pref, profile);
 				msar.doIt();
 			}
-			if(mev.selectedItem == exportLOC){
+			if (mev.selectedItem == exportLOC) {
 				LocExporter loc = new LocExporter();
 				loc.doIt();
 			}
-			if(mev.selectedItem == exportGPS){
+			if (mev.selectedItem == exportGPS) {
 				String gpsBabelCommand;
 				Vm.showWait(true);
 				LocExporter loc = new LocExporter();
-				//String tmpFileName = FileBase.getProgramDirectory() + &quot;/temp.loc&quot;;
-                //Must not contain special characters, because we don't quote below, because quoting causes problems on some platforms.
-				//Find another way, when CW can be started from outside the program directory.
+				// String tmpFileName = FileBase.getProgramDirectory() + &quot;/temp.loc&quot;;
+				// Must not contain special characters, because we don't quote below, because quoting causes problems on some platforms.
+				// Find another way, when CW can be started from outside the program directory.
 				String tmpFileName = &quot;temp.loc&quot;;
 				loc.setTmpFileName(tmpFileName);
 				loc.doIt(LocExporter.MODE_AUTO);
-				ProgressBarForm.display(MyLocale.getMsg(950,&quot;Transfer&quot;),MyLocale.getMsg(951,&quot;Sending to GPS&quot;), null);
-				gpsBabelCommand = pref.gpsbabel+&quot; &quot;+pref.garminGPSBabelOptions+&quot; -i geo -f &quot;+ tmpFileName +&quot; -o garmin -F &quot; + pref.garminConn +&quot;:&quot;;
-				pref.log(&quot;[MainMenu:onEvent] &quot;+gpsBabelCommand);
+				ProgressBarForm.display(MyLocale.getMsg(950, &quot;Transfer&quot;), MyLocale.getMsg(951, &quot;Sending to GPS&quot;), null);
+				gpsBabelCommand = pref.gpsbabel + &quot; &quot; + pref.garminGPSBabelOptions + &quot; -i geo -f &quot; + tmpFileName + &quot; -o garmin -F &quot; + pref.garminConn + &quot;:&quot;;
+				pref.log(&quot;[MainMenu:onEvent] &quot; + gpsBabelCommand);
 				try {
 					// this will *only* work with ewe.jar at the moment
-					ewe.sys.Process p = Vm.exec( gpsBabelCommand );
+					ewe.sys.Process p = Vm.exec(gpsBabelCommand);
 					p.waitFor();
-				}catch(IOException ioex){
+				} catch (IOException ioex) {
 					Vm.showWait(false);
 					(new MessageBox(&quot;Error&quot;, &quot;Garmin export unsuccessful&quot;, FormBase.OKB)).execute();
-					pref.log(&quot;Error exporting to Garmin&quot;,ioex,true);
-				};
+					pref.log(&quot;Error exporting to Garmin&quot;, ioex, true);
+				}
+				;
 				ProgressBarForm.clear();
 				Vm.showWait(false);
 			}
-			if(mev.selectedItem == exportOZI){
-				OziExporter ozi = new OziExporter( pref, profile);
+			if (mev.selectedItem == exportOZI) {
+				OziExporter ozi = new OziExporter(pref, profile);
 				ozi.doIt();
 			}
-			if(mev.selectedItem == exportKML){
-				KMLExporter kml = new KMLExporter( pref, profile);
+			if (mev.selectedItem == exportKML) {
+				KMLExporter kml = new KMLExporter(pref, profile);
 				kml.doIt();
 			}
-			if(mev.selectedItem == exportTPL){
-				FileChooser fc = new FileChooser(FileChooserBase.OPEN, FileBase.getProgramDirectory()+FileBase.separator+&quot;templates&quot;);
+			if (mev.selectedItem == exportTPL) {
+				FileChooser fc = new FileChooser(FileChooserBase.OPEN, FileBase.getProgramDirectory() + FileBase.separator + &quot;templates&quot;);
 				fc.addMask(&quot;*.tpl&quot;);
-				fc.setTitle(MyLocale.getMsg(910,&quot;Select Template file&quot;));
-				if(fc.execute() != FormBase.IDCANCEL){
-					TPLExporter tpl = new TPLExporter( pref, profile, fc.getChosenFile().toString());
+				fc.setTitle(MyLocale.getMsg(910, &quot;Select Template file&quot;));
+				if (fc.execute() != FormBase.IDCANCEL) {
+					TPLExporter tpl = new TPLExporter(pref, profile, fc.getChosenFile().toString());
 					tpl.doIt();
 				}
 			}
-			if(mev.selectedItem == exportExplorist) {
-				ExploristExporter mag = new ExploristExporter( pref, profile);
+			if (mev.selectedItem == exportExplorist) {
+				ExploristExporter mag = new ExploristExporter(pref, profile);
 				mag.doIt();
 			}
-			if(mev.selectedItem == exportSpoilerPOI) {
-				SpoilerPOIExporter spoilerpoi = new SpoilerPOIExporter( pref, profile);
+			if (mev.selectedItem == exportSpoilerPOI) {
+				SpoilerPOIExporter spoilerpoi = new SpoilerPOIExporter(pref, profile);
 				spoilerpoi.doIt();
 			}
 
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// subMenu for maps, part of &quot;Application&quot; menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == downloadmap){
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == downloadmap) {
 				MapLoaderGui mLG = new MapLoaderGui(cacheDB);
 				mLG.exec(); // .execute doesn't work because the tcp-socket uses another thread which cannot be startet if here .execute() is used!
 			}
-			if(mev.selectedItem == importmap){
+			if (mev.selectedItem == importmap) {
 
 				MapImporter map = new MapImporter(pref);
 				map.importMap();
 			}
-			if(mev.selectedItem == kalibmap){
+			if (mev.selectedItem == kalibmap) {
 				SelectMap sM = new SelectMap();
 				sM.execute();
-				if((sM.getSelectedMap()).length()&gt;0){
+				if ((sM.getSelectedMap()).length() &gt; 0) {
 					try {
-						MapImporter map = new MapImporter(pref, sM.getSelectedMap(),sM.worldfileexists);
+						MapImporter map = new MapImporter(pref, sM.getSelectedMap(), sM.worldfileexists);
 						map.execute(null, Gui.CENTER_FRAME);
 					} catch (java.lang.OutOfMemoryError e) {
-						MessageBox tmpMB=new MessageBox(MyLocale.getMsg(312, &quot;Error&quot;), MyLocale.getMsg(156,&quot;Out of memory error, map to big&quot;), FormBase.OKB);
+						MessageBox tmpMB = new MessageBox(MyLocale.getMsg(312, &quot;Error&quot;), MyLocale.getMsg(156, &quot;Out of memory error, map to big&quot;), FormBase.OKB);
 						tmpMB.exec();
 					}
 				}
 			}
-			if (mev.selectedItem==selectMapPath) {
+			if (mev.selectedItem == selectMapPath) {
 				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().getCustomMapsPath());
 				fc.addMask(&quot;*.wfl&quot;);
-				fc.setTitle(MyLocale.getMsg(4200,&quot;Select map directory:&quot;));
-				if(fc.execute() != FormBase.IDCANCEL){
+				fc.setTitle(MyLocale.getMsg(4200, &quot;Select map directory:&quot;));
+				if (fc.execute() != FormBase.IDCANCEL) {
 					Global.getPref().saveCustomMapsPath(fc.getChosen().toString());
-					//mm.loadMaps(Global.getPref().getCustomMapsPath(), mm.posCircle.where.latDec);
-					//mm.forceMapLoad();
+					// mm.loadMaps(Global.getPref().getCustomMapsPath(), mm.posCircle.where.latDec);
+					// mm.forceMapLoad();
 				}
 
 			}
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// &quot;Application&quot; pulldown menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == preferences){
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == preferences) {
 				tbp.saveColWidth(pref);
 				PreferencesScreen pfs = new PreferencesScreen(pref);
 				pfs.execute(father.getFrame(), Gui.CENTER_FRAME);
 				pref.readPrefFile();
 			}
-			if(mev.selectedItem == savenoxit){
-				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
+			if (mev.selectedItem == savenoxit) {
+				profile.saveIndex(pref, Profile.SHOW_PROGRESS_BAR);
 				tbp.saveColWidth(pref);
 			}
-/*
-			if(mev.selectedItem == savenexit){
-				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
-				tbp.saveColWidth(pref);
-				ewe.sys.Vm.exit(0);
-			}
-*/
-			if(mev.selectedItem == exit){
+			/*
+			 * if(mev.selectedItem == savenexit){ profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR); tbp.saveColWidth(pref); ewe.sys.Vm.exit(0); }
+			 */
+			if (mev.selectedItem == exit) {
 				Global.mainTab.saveUnsavedChanges(true);
 				ewe.sys.Vm.exit(0);
 			}
 
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// &quot;Search&quot; pulldown menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == search){
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == search) {
 				search();
 			}
-			if(mev.selectedItem == searchAll){
+			if (mev.selectedItem == searchAll) {
 				SearchCache ssc = new SearchCache(cacheDB);
 				ssc.clearSearch();
 				tbp.refreshTable();
-                search();
+				search();
 			}
-			if(mev.selectedItem == searchClr){
+			if (mev.selectedItem == searchClr) {
 				SearchCache ssc = new SearchCache(cacheDB);
 				ssc.clearSearch();
 				tbp.refreshTable();
 			}
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// &quot;Filter&quot; pulldown menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == filtApply){
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == filtApply) {
 				Filter flt = new Filter();
 				flt.setFilter();
 				flt.doFilter();
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == filtCreate){
+			if (mev.selectedItem == filtCreate) {
 				scnFilter.setData(profile.getCurrentFilter());
 				scnFilter.setPreferredSize(450, 480);
-				if(Vm.isMobile()) scnFilter.setPreferredSize(MyLocale.getScreenWidth(), MyLocale.getScreenHeight()); //Fullscreen
+				if (Vm.isMobile())
+					scnFilter.setPreferredSize(MyLocale.getScreenWidth(), MyLocale.getScreenHeight()); // Fullscreen
 				scnFilter.execute(father.getFrame(), Gui.CENTER_FRAME);
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == filtInvert){
+			if (mev.selectedItem == filtInvert) {
 				Filter flt = new Filter();
 				flt.invertFilter();
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == filtClear){
+			if (mev.selectedItem == filtClear) {
 				Filter flt = new Filter();
 				flt.clearFilter();
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == filtSelected){ // incremental filter
+			if (mev.selectedItem == filtSelected) { // incremental filter
 				Global.getProfile().selectionChanged = true;
 				CacheHolder ch;
 				boolean filterChanged = false;
-				for(int i = cacheDB.size()-1; i&gt;=0; i--){
+				for (int i = cacheDB.size() - 1; i &gt;= 0; i--) {
 					ch = cacheDB.get(i);
 					// This is an incremental filter, i.e. it keeps the existing filter
 					// status and only adds the marked caches to the filtered set
@@ -652,16 +583,16 @@
 						filterChanged = true;
 					}
 				}
-				if ( filterChanged &amp;&amp; Global.getProfile().getFilterActive() == Filter.FILTER_INACTIVE) {
+				if (filterChanged &amp;&amp; Global.getProfile().getFilterActive() == Filter.FILTER_INACTIVE) {
 					Global.getProfile().setFilterActive(Filter.FILTER_MARKED_ONLY);
 				}
 				tbp.refreshTable();
 			}
-			if (mev.selectedItem == filtNonSelected){
+			if (mev.selectedItem == filtNonSelected) {
 				Global.getProfile().selectionChanged = true;
 				CacheHolder ch;
 				boolean filterChanged = false;
-				for(int i = cacheDB.size()-1; i &gt;=0; i--){
+				for (int i = cacheDB.size() - 1; i &gt;= 0; i--) {
 					ch = cacheDB.get(i);
 					// incremental filter. Keeps status of all marked caches and
 					// adds unmarked caches to filtered list
@@ -670,102 +601,104 @@
 						filterChanged = true;
 					}
 				}
-				if ( filterChanged &amp;&amp; Global.getProfile().getFilterActive() == Filter.FILTER_INACTIVE) {
+				if (filterChanged &amp;&amp; Global.getProfile().getFilterActive() == Filter.FILTER_INACTIVE) {
 					Global.getProfile().setFilterActive(Filter.FILTER_MARKED_ONLY);
 				}
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == filtBlack){
-				//filtBlack.modifiers=filtBlack.modifiers|MenuItem.Checked;
+			if (mev.selectedItem == filtBlack) {
+				// filtBlack.modifiers=filtBlack.modifiers|MenuItem.Checked;
 				Global.getProfile().setShowBlacklisted(!Global.getProfile().showBlacklisted());
-				filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
+				filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 				SearchCache ssc = new SearchCache(cacheDB);
 				ssc.clearSearch();// Clear search &amp; restore filter status
 				tbp.refreshTable();
 			}
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// &quot;Organise&quot; pulldown menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == orgNewWP){
-				if (Global.mainTab.tbP.getSelectedCache() &gt;= 0) 
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == orgNewWP) {
+				if (Global.mainTab.tbP.getSelectedCache() &gt;= 0)
 					Global.mainTab.lastselected = cacheDB.get(Global.mainTab.tbP.getSelectedCache()).getWayPoint();
-				else Global.mainTab.lastselected = &quot;&quot;;
+				else
+					Global.mainTab.lastselected = &quot;&quot;;
 				Global.mainTab.newWaypoint(new CacheHolder());
 			}
 
-			if(mev.selectedItem == orgCopy){
-				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
+			if (mev.selectedItem == orgCopy) {
+				profile.saveIndex(pref, Profile.SHOW_PROGRESS_BAR);
 				DataMover dm = new DataMover();
 				dm.copyCaches();
 				tbp.refreshTable();
 			}
 
-			if(mev.selectedItem == orgMove){
-				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
+			if (mev.selectedItem == orgMove) {
+				profile.saveIndex(pref, Profile.SHOW_PROGRESS_BAR);
 				DataMover dm = new DataMover();
 				dm.moveCaches();
 				tbp.refreshTable();
 			}
 
-			if(mev.selectedItem == orgDelete){
-				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
+			if (mev.selectedItem == orgDelete) {
+				profile.saveIndex(pref, Profile.SHOW_PROGRESS_BAR);
 				DataMover dm = new DataMover();
 				dm.deleteCaches();
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == orgRebuild){
-				Rebuild rb=new Rebuild();
+			if (mev.selectedItem == orgRebuild) {
+				Rebuild rb = new Rebuild();
 				rb.rebuild();
 				profile.updateBearingDistance();
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == orgCheckNotesAndSolver){
+			if (mev.selectedItem == orgCheckNotesAndSolver) {
 				// Checking every cache if notes or solver data exist
-				CWProgressBar cwp = new CWProgressBar(MyLocale.getMsg(219,&quot;Searching...&quot;), 0, cacheDB.size(), true);
+				CWProgressBar cwp = new CWProgressBar(MyLocale.getMsg(219, &quot;Searching...&quot;), 0, cacheDB.size(), true);
 				cwp.exec();
 				cwp.allowExit(true);
-				for(int i = 0;i &lt; cacheDB.size();i++){
+				for (int i = 0; i &lt; cacheDB.size(); i++) {
 					cwp.setPosition(i);
 					CacheHolder ch = cacheDB.get(i);
-					if (ch.mainCache==null) {
+					if (ch.mainCache == null) {
 						ch.setHasNote(!ch.getCacheDetails(false).getCacheNotes().equals(&quot;&quot;));
 						ch.setHasSolver(!ch.getCacheDetails(false).getSolver().equals(&quot;&quot;));
 					}
-					if (cwp.isClosed()) break;
+					if (cwp.isClosed())
+						break;
 				} // for
 				cwp.exit(0);
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == orgTravelbugs){
-				Form tbs=TravelbugJourneyScreenFactory.createTravelbugJourneyScreen();
-				tbs.setPreferredSize(800,600);
+			if (mev.selectedItem == orgTravelbugs) {
+				Form tbs = TravelbugJourneyScreenFactory.createTravelbugJourneyScreen();
+				tbs.setPreferredSize(800, 600);
 				tbs.execute();
 				tbs.close(0);
 			}
-			if(mev.selectedItem == cacheTour){
-				cacheTour.modifiers^=MenuItem.Checked;
+			if (mev.selectedItem == cacheTour) {
+				cacheTour.modifiers ^= MenuItem.Checked;
 				Global.mainForm.toggleCacheListVisible();
 			}
 
-			///////////////////////////////////////////////////////////////////////
+			// /////////////////////////////////////////////////////////////////////
 			// &quot;About&quot; pulldown menu
-			///////////////////////////////////////////////////////////////////////
-			if(mev.selectedItem == about){
-				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile(&quot;info.html&quot;), MyLocale.getMsg(117,&quot;About&quot;),true, pref);
+			// /////////////////////////////////////////////////////////////////////
+			if (mev.selectedItem == about) {
+				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile(&quot;info.html&quot;), MyLocale.getMsg(117, &quot;About&quot;), true, pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
-			if(mev.selectedItem == legend){
-				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile(&quot;legende.html&quot;), MyLocale.getMsg(155,&quot;Legend&quot;),true, pref);
+			if (mev.selectedItem == legend) {
+				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile(&quot;legende.html&quot;), MyLocale.getMsg(155, &quot;Legend&quot;), true, pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
-			if(mev.selectedItem == wolflang){
-				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile(&quot;wolflang.html&quot;), MyLocale.getMsg(118,&quot;WolfLanguage&quot;), true, pref);
+			if (mev.selectedItem == wolflang) {
+				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile(&quot;wolflang.html&quot;), MyLocale.getMsg(118, &quot;WolfLanguage&quot;), true, pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
-			if(mev.selectedItem == sysinfo){
-				StringBuffer sb=new StringBuffer(400);
+			if (mev.selectedItem == sysinfo) {
+				StringBuffer sb = new StringBuffer(400);
 				Font f = mApp.guiFont;
-				sb.append(MyLocale.getMsg(121,&quot;Profile&quot;));
+				sb.append(MyLocale.getMsg(121, &quot;Profile&quot;));
 				sb.append(&quot;: &quot;);
 				sb.append(profile.dataDir);
 				sb.append(&quot;&lt;br&gt;&quot;);
@@ -792,21 +725,22 @@
 				sb.append(MyLocale.getMsg(265, &quot;Screen:&quot;));
 				sb.append(' ');
 				sb.append(MyLocale.getScreenWidth());
-				sb.append(&quot; x &quot;);	 sb.append(MyLocale.getScreenHeight());
+				sb.append(&quot; x &quot;);
+				sb.append(MyLocale.getScreenHeight());
 				sb.append(&quot;&lt;br&gt;&quot;);
 				sb.append(MyLocale.getMsg(266, &quot;Font size:&quot;));
 				sb.append(' ');
 				sb.append(f.getSize());
 				sb.append(&quot;&lt;br&gt;&quot;);
 				sb.append(MyLocale.getMsg(267, &quot;Entries in DB:&quot;));
-				sb.append (' ');
+				sb.append(' ');
 				sb.append(cacheDB.size());
 				sb.append(&quot;&lt;br&gt;&quot;);
-				sb.append(MyLocale.getMsg (268, &quot;File separator is:&quot;));
-				sb.append (&quot; \&quot;&quot;);
-				sb.append(Vm.getProperty(&quot;file.separator&quot;,&quot;def&quot;));
+				sb.append(MyLocale.getMsg(268, &quot;File separator is:&quot;));
+				sb.append(&quot; \&quot;&quot;);
+				sb.append(Vm.getProperty(&quot;file.separator&quot;, &quot;def&quot;));
 				sb.append(&quot;\&quot;&lt;br&gt;&quot;);
-				sb.append(MyLocale.getMsg (269, &quot;Programme directory is:&quot;));
+				sb.append(MyLocale.getMsg(269, &quot;Programme directory is:&quot;));
 				sb.append(' ');
 				sb.append(FileBase.getProgramDirectory());
 				sb.append(&quot;&lt;br&gt;&quot;);
@@ -822,11 +756,11 @@
 				sb.append(' ');
 				sb.append(Version.getReleaseDetailed());
 				sb.append(&quot;&lt;br&gt;&quot;);
-				InfoScreen is = new InfoScreen(sb.toString(), &quot;System&quot;, false,pref);
-				pref.log(STRreplace.replace(sb.toString(),&quot;&lt;br&gt;&quot;,Preferences.NEWLINE),null);
+				InfoScreen is = new InfoScreen(sb.toString(), &quot;System&quot;, false, pref);
+				pref.log(STRreplace.replace(sb.toString(), &quot;&lt;br&gt;&quot;, Preferences.NEWLINE), null);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
-			if(mev.selectedItem == chkVersion){
+			if (mev.selectedItem == chkVersion) {
 				(new MessageBox(MyLocale.getMsg(178, &quot;Version Checking&quot;), Version.getUpdateMessage(), FormBase.OKB)).execute();
 			}
 
@@ -842,13 +776,15 @@
 	}
 
 	public static void updateSelectedCaches(TablePanel tablePanel) {
-		Preferences pref=Global.getPref();
-		Profile profile=Global.getProfile();
-		CacheDB cacheDB=profile.cacheDB;
+		Preferences pref = Global.getPref();
+		Profile profile = Global.getProfile();
+		CacheDB cacheDB = profile.cacheDB;
 		CacheHolder ch;
 
-		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(1014,&quot;updateSelectedCaches&quot;), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.ALL);
-		if (options.execute() == FormBase.IDCANCEL) {	return; }
+		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(1014, &quot;updateSelectedCaches&quot;), OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.TRAVELBUGS | OCXMLImporterScreen.MAXLOGS | OCXMLImporterScreen.ALL);
+		if (options.execute() == FormBase.IDCANCEL) {
+			return;
+		}
 
 		SpiderGC spider = new SpiderGC(pref, profile);
 		OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
@@ -861,27 +797,23 @@
 		boolean loadAllLogs = (pref.maxLogsToSpider &gt; 5);
 
 		Vector cachesToUpdate = new Vector();
-		for(int i = 0; i &lt;	cacheDB.size(); i++){
+		for (int i = 0; i &lt; cacheDB.size(); i++) {
 			ch = cacheDB.get(i);
-			if(ch.is_Checked == true &amp;&amp; ch.isVisible()) {
-				String wpStart = ch.getWayPoint().substring(0,2);
-				if ( ch.getWayPoint().length()&gt;1 &amp;&amp; (wpStart.equalsIgnoreCase(&quot;GC&quot;) || ch.isOC()))
-//					Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
-//					Alter code prft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
+			if (ch.is_Checked == true &amp;&amp; ch.isVisible()) {
+				String wpStart = ch.getWayPoint().substring(0, 2);
+				if (ch.getWayPoint().length() &gt; 1 &amp;&amp; (wpStart.equalsIgnoreCase(&quot;GC&quot;) || ch.isOC()))
+				// Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
+				// Alter code prft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
 				{
 					cachesToUpdate.add(new Integer(i));
 				} else {
-					if (ch.isAddiWpt() &amp;&amp; ch.mainCache!=null &amp;&amp; !ch.mainCache.is_Checked &amp;&amp; !alreadySaid2) { // Is the father ticked?
-						alreadySaid2=true;
-						(new MessageBox(MyLocale.getMsg(327,&quot;Information&quot;),
-								        MyLocale.getMsg(5001,&quot;Can't spider additional waypoint directly. Please check main cache.&quot;), FormBase.OKB)).execute();
+					if (ch.isAddiWpt() &amp;&amp; ch.mainCache != null &amp;&amp; !ch.mainCache.is_Checked &amp;&amp; !alreadySaid2) { // Is the father ticked?
+						alreadySaid2 = true;
+						(new MessageBox(MyLocale.getMsg(327, &quot;Information&quot;), MyLocale.getMsg(5001, &quot;Can't spider additional waypoint directly. Please check main cache.&quot;), FormBase.OKB)).execute();
 					}
 					if (!ch.isAddiWpt() &amp;&amp; !alreadySaid) {
 						alreadySaid = true;
-						(new MessageBox(MyLocale.getMsg(327,&quot;Information&quot;),
-					        ch.getWayPoint()+ MyLocale.getMsg(5002,
-					        	&quot;: At the moment this function is only applicable for geocaching.com and opencaching.de/.cz/.org.uk .&quot;),
-					        FormBase.OKB)).execute();
+						(new MessageBox(MyLocale.getMsg(327, &quot;Information&quot;), ch.getWayPoint() + MyLocale.getMsg(5002, &quot;: At the moment this function is only applicable for geocaching.com and opencaching.de/.cz/.org.uk .&quot;), FormBase.OKB)).execute();
 					}
 				}
 
@@ -889,14 +821,14 @@
 		}
 
 		int spiderErrors = 0;
-		boolean forceLogin=Global.getPref().forceLogin; // To ensure that spiderSingle only logs in once if forcedLogin=true
-		for(int j = 0; j &lt;	cachesToUpdate.size(); j++){
-			int i = ((Integer)cachesToUpdate.get(j)).intValue();
+		boolean forceLogin = Global.getPref().forceLogin; // To ensure that spiderSingle only logs in once if forcedLogin=true
+		for (int j = 0; j &lt; cachesToUpdate.size(); j++) {
+			int i = ((Integer) cachesToUpdate.get(j)).intValue();
 			ch = cacheDB.get(i);
-//			infB.setInfo(&quot;Loading: &quot; + ch.wayPoint);
-			infB.setInfo(MyLocale.getMsg(5513,&quot;Loading: &quot;) + ch.getWayPoint() +&quot; (&quot; + (j+1) + &quot; / &quot; + cachesToUpdate.size() + &quot;)&quot;);
+			// infB.setInfo(&quot;Loading: &quot; + ch.wayPoint);
+			infB.setInfo(MyLocale.getMsg(5513, &quot;Loading: &quot;) + ch.getWayPoint() + &quot; (&quot; + (j + 1) + &quot; / &quot; + cachesToUpdate.size() + &quot;)&quot;);
 			infB.redisplay();
-			if (ch.getWayPoint().substring(0,2).equalsIgnoreCase(&quot;GC&quot;)) {
+			if (ch.getWayPoint().substring(0, 2).equalsIgnoreCase(&quot;GC&quot;)) {
 				int test = spider.spiderSingle(i, infB, forceLogin, loadAllLogs || ch.is_found());
 				if (test == SpiderGC.SPIDER_CANCEL) {
 					infB.close(0);
@@ -904,30 +836,29 @@
 				} else if (test == SpiderGC.SPIDER_ERROR) {
 					spiderErrors++;
 				} else {
-					//profile.hasUnsavedChanges=true;
+					// profile.hasUnsavedChanges=true;
 				}
-				forceLogin=false;
-			}
-			else {
+				forceLogin = false;
+			} else {
 				if (!ocSync.syncSingle(i, infB)) {
 					infB.close(0);
 					break;
 				} else {
-					//profile.hasUnsavedChanges=true;
+					// profile.hasUnsavedChanges=true;
 				}
 			}
 
-//			cacheDB.clear();
-//			profile.readIndex();
+			// cacheDB.clear();
+			// profile.readIndex();
 		}
 		infB.close(0);
-		profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
+		profile.saveIndex(pref, Profile.SHOW_PROGRESS_BAR);
 		profile.restoreFilter();
 		profile.updateBearingDistance();
 		tablePanel.refreshTable();
 		Vm.showWait(false);
-		if ( spiderErrors &gt; 0) {
-			new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;),spiderErrors + MyLocale.getMsg(5516,&quot; cache descriptions%0acould not be loaded.&quot;),FormBase.DEFOKB).execute();
+		if (spiderErrors &gt; 0) {
+			new MessageBox(MyLocale.getMsg(5500, &quot;Error&quot;), spiderErrors + MyLocale.getMsg(5516, &quot; cache descriptions%0acould not be loaded.&quot;), FormBase.DEFOKB).execute();
 		}
 	}
 

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/src/CacheWolf/MyComparer.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -1,183 +1,194 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
+
 import ewe.util.Comparer;
 import ewe.util.Vector;
+import ewe.util.mString;
 
 /**
-*	This class handles the sorting for most of the sorting tasks. If a cache is 
-*	to be displayed in the table or not is handled in the table model
-*	@see MyTableModel
-*	@see DistComparer
-*/
-public class MyComparer implements Comparer{
+ * This class handles the sorting for most of the sorting tasks. If a cache is to be displayed in the table or not is handled in the table model
+ * 
+ * @see MyTableModel
+ * @see DistComparer
+ */
+public class MyComparer implements Comparer {
 	Vector cacheDB;
-	
-	public MyComparer(CacheDB cacheDB, int colToCompare, int visibleSize){
-		//visibleSize=Global.mainTab.tbP.myMod.numRows;
-		if (visibleSize&lt;2) return;
-		for (int i=visibleSize; i&lt;cacheDB.size(); i++) {
-			CacheHolder ch=cacheDB.get(i);
-			ch.sort=&quot;\uFFFF&quot;;
+
+	public MyComparer(CacheDB cacheDB, int colToCompare, int visibleSize) {
+		// visibleSize=Global.mainTab.tbP.myMod.numRows;
+		if (visibleSize &lt; 2)
+			return;
+		for (int i = visibleSize; i &lt; cacheDB.size(); i++) {
+			CacheHolder ch = cacheDB.get(i);
+			ch.sort = &quot;\uFFFF&quot;;
 		}
-		if (colToCompare==1) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=String.valueOf(ch.getType());
+		if (colToCompare == 1) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = String.valueOf(ch.getType());
 			}
-		} else if (colToCompare==2) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=String.valueOf(ch.getHard());
+		} else if (colToCompare == 2) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = String.valueOf(ch.getHard());
 			}
-		} else if (colToCompare==3) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=String.valueOf(ch.getTerrain());
+		} else if (colToCompare == 3) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = String.valueOf(ch.getTerrain());
 			}
-		} else if (colToCompare==4) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.getWayPoint().toUpperCase();
+		} else if (colToCompare == 4) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = ch.getWayPoint().toUpperCase();
 			}
-		} else if (colToCompare==5) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.getCacheName().trim().toLowerCase();
+		} else if (colToCompare == 5) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = ch.getCacheName().trim().toLowerCase();
 			}
-		} else if (colToCompare==6) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.getLatLon();
+		} else if (colToCompare == 6) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = ch.getLatLon();
 			}
-		} else if (colToCompare==7) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.getCacheOwner().toLowerCase();
+		} else if (colToCompare == 7) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = ch.getCacheOwner().toLowerCase();
 			}
-		} else if (colToCompare==8) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.getDateHidden();
+		} else if (colToCompare == 8) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = ch.getDateHidden();
 			}
-		} else if (colToCompare==9) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.getCacheStatus();
+		} else if (colToCompare == 9) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = ch.getCacheStatus();
 			}
-		} else if (colToCompare==10) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
+		} else if (colToCompare == 10) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
 				// CHECK Is the formatting correctly done?
-				if (ch.kilom==-1.0) {
-					ch.sort=&quot;\uFFFF&quot;;
+				if (ch.kilom == -1.0) {
+					ch.sort = &quot;\uFFFF&quot;;
+				} else {
+					ch.sort = MyLocale.formatDouble(ch.kilom * 1000, &quot;000000000000&quot;);
 				}
-				else {
-					ch.sort = MyLocale.formatDouble(ch.kilom*1000, &quot;000000000000&quot;);
-				}
 			}
-		} else if (colToCompare==11) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
+		} else if (colToCompare == 11) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
 				if (ch.getBearing().equals(&quot;?&quot;)) {
-					ch.sort=&quot;\uFFFF&quot;;
+					ch.sort = &quot;\uFFFF&quot;;
+				} else {
+					ch.sort = ch.getBearing();
 				}
+			}
+
+		} else if (colToCompare == 12) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = Integer.toString(ch.getCacheSize());
+			}
+		} else if (colToCompare == 13) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				if (ch.isOC()) {
+					ch.sort = MyLocale.formatLong(ch.recommendationScore, &quot;000&quot;) + MyLocale.formatLong(ch.getNumRecommended(), &quot;00000&quot;);
+				} else {
+					int gcVote = ch.getNumRecommended();
+					if (gcVote &lt; 100) {
+						ch.sort = MyLocale.formatLong(gcVote, &quot;000&quot;) + &quot;00000000&quot;;
+					} else {
+						int votes = gcVote / 100;
+						gcVote = gcVote - 100 * votes;
+						ch.sort = MyLocale.formatLong(gcVote, &quot;000&quot;) + MyLocale.formatLong(votes, &quot;00000000&quot;);
+					}
+				}
+			}
+		} else if (colToCompare == 14) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				if (ch.getWayPoint().startsWith(&quot;GC&quot;))
+					ch.sort = ch.getOcCacheID();
 				else {
-					ch.sort=ch.getBearing();
-				}			
+					String[] stmp = mString.split(ch.getCacheOwner(), '/');
+					int l = stmp.length - 1;
+					if (l &gt; 0) {
+						String s = stmp[l].trim();
+						if (s.startsWith(&quot;GC&quot;))
+							ch.sort = s;
+						else
+							ch.sort = &quot;\uFFFF&quot;;
+					} else
+						ch.sort = &quot;\uFFFF&quot;; // ans Ende
+				}
 			}
-			
-		} else if (colToCompare==12) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				ch.sort=Integer.toString(ch.getCacheSize());
+		} else if (colToCompare == 15) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				if (ch.hasSolver()) {
+					ch.sort = &quot;1&quot;;
+				} else {
+					ch.sort = &quot;2&quot;;
+				}
 			}
-		} else if (colToCompare==13) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				if ( ch.isOC() ) {
-  				ch.sort=MyLocale.formatLong(ch.getNumRecommended(),&quot;00000&quot;);
-        } else {
-				  int gcVote = ch.getNumRecommended();
-				  if ( gcVote &lt; 100 ) {
-				    ch.sort=MyLocale.formatLong(gcVote,&quot;00&quot;) + &quot;00000000&quot;;
-          } else {
-            int votes = gcVote / 100;
-            gcVote = gcVote - 100 * votes;
-            ch.sort = MyLocale.formatLong(gcVote,&quot;00&quot;) + MyLocale.formatLong(votes,&quot;00000000&quot;);
-          }
-        }
-			}			
-		} else if (colToCompare==14) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch=cacheDB.get(i);
-				if (ch.isOC())
-					ch.sort=MyLocale.formatLong(ch.recommendationScore,&quot;00000&quot;);
-				else
-					ch.sort=&quot;\uFFFF&quot;;
-			}			
-		} else if (colToCompare==15) {
-		    for (int i=0; i&lt;visibleSize; i++) {
-		        CacheHolder ch=cacheDB.get(i);
-		        if (ch.hasSolver()) {
-		            ch.sort=&quot;1&quot;;
-		        } else {
-		            ch.sort=&quot;2&quot;;
-		        }
-		    }
-		} else if (colToCompare==16) {
-		    for (int i=0; i&lt;visibleSize; i++) {
-		        CacheHolder ch=cacheDB.get(i);
-		        if (ch.hasNote()) {
-		            ch.sort=&quot;1&quot;;
-		        } else {
-		            ch.sort=&quot;2&quot;;
-		        }
-		    }
-		} else if (colToCompare==17) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch =  cacheDB.get(i);
-				ch.sort=MyLocale.formatLong(ch.addiWpts.size(),&quot;000&quot;);
+		} else if (colToCompare == 16) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				if (ch.hasNote()) {
+					ch.sort = &quot;1&quot;;
+				} else {
+					ch.sort = &quot;2&quot;;
+				}
 			}
-		} else if (colToCompare==18) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch =  cacheDB.get(i);
-				ch.sort=MyLocale.formatLong(ch.getNoFindLogs(),&quot;000&quot;);
+		} else if (colToCompare == 17) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = MyLocale.formatLong(ch.addiWpts.size(), &quot;000&quot;);
 			}
-		} else if (colToCompare==19) {
-			for (int i=0; i&lt;visibleSize; i++) {
-				CacheHolder ch =  cacheDB.get(i);
-				ch.sort=ch.getLastSync();
+		} else if (colToCompare == 18) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = MyLocale.formatLong(ch.getNoFindLogs(), &quot;000&quot;);
 			}
+		} else if (colToCompare == 19) {
+			for (int i = 0; i &lt; visibleSize; i++) {
+				CacheHolder ch = cacheDB.get(i);
+				ch.sort = ch.getLastSync();
+			}
 		}
- 	}
-	
-	public int compare(Object o1, Object o2){
-		CacheHolder oo1 = (CacheHolder)o1;
-		CacheHolder oo2 = (CacheHolder)o2;
+	}
+
+	public int compare(Object o1, Object o2) {
+		CacheHolder oo1 = (CacheHolder) o1;
+		CacheHolder oo2 = (CacheHolder) o2;
 		return oo1.sort.compareTo(oo2.sort);
 	}
 }

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -28,6 +28,7 @@
 import ewe.data.PropertyList;
 import ewe.io.AsciiCodec;
 import ewe.io.File;
+import ewe.io.FileBase;
 import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
@@ -131,6 +132,20 @@
 				i = i - 1;
 			}
 			realUrl = urltmp;
+			if (!urltmp.startsWith(&quot;http&quot;)) {
+				url = FileBase.fixupPath(url);
+				String uu = url.toLowerCase();
+				String host;
+				uu = url.replace('\\', '/');
+				host = uu.substring(7);
+				int first = host.indexOf('/');
+				if (first != -1) {
+					host = host.substring(0, first);
+				}
+				if (!urltmp.startsWith(&quot;/&quot;))
+					host = host + &quot;/&quot;;
+				urltmp = &quot;<A HREF="http://">http://</A>&quot; + host + urltmp;
+			}
 			conn.setUrl(urltmp);
 			conn.documentIsEncoded = isUrlEncoded(urltmp);
 			if (permanentRequestorProperties == null)
@@ -153,6 +168,12 @@
 			urltmp = conn.getRedirectTo();
 			if (urltmp != null) {
 				conn.disconnect();
+				final PropertyList pl = UrlFetcher.getDocumentProperties();
+				if (pl != null) {
+					String cookie = (String) pl.getValue(&quot;Set-Cookie&quot;, &quot;&quot;);
+					if (!cookie.equals(&quot;&quot;))
+						setPermanentRequestorProperty(&quot;Cookie&quot;, cookie);
+				}
 				conn = conn.getRedirectedConnection(urltmp);
 				forceRedirect = false; // one time or more redirected
 			}
@@ -236,7 +257,7 @@
 			char c = what[i];
 			if (spaceToPlus &amp;&amp; c == ' ')
 				c = '+';
-			else if (c &lt;= '/' || c &gt;= 127 || c == '+' || c == '&amp;' || c == '%' || c == '=' || c == '|' || c == '{' || c == '}') {
+			else if (c &lt;= ' ' || c &gt;= 127 || c == '+' || c == '&amp;' || c == '%' || c == '=' || c == '|' || c == '{' || c == '}' || c == '$' || c == '/') {
 				dest[d++] = '%';
 				dest[d++] = hex.charAt((c &gt;&gt; 4) &amp; 0xf);
 				dest[d++] = hex.charAt(c &amp; 0xf);

Modified: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -1,90 +1,78 @@
 package CacheWolf.imp;
 
-import ewe.io.File;
-import ewe.io.IOException;
-import ewe.ui.FormBase;
 import CacheWolf.Global;
 import CacheWolf.MyLocale;
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
 import CacheWolf.UrlFetcher;
 import CacheWolf.utils.FileBugfix;
+import ewe.io.File;
+import ewe.io.IOException;
+import ewe.ui.FormBase;
 
 public class OCGPXfetch {
 	static Preferences pref = Global.getPref();
 	static Profile prof = Global.getProfile();;
-	
+
 	public static void doIt() {
 		String hostname = pref.lastOCSite;
-		boolean oldDownloadAllOC=pref.downloadAllOC;
+		boolean oldDownloadAllOC = pref.downloadAllOC;
 		boolean onlyListedAtOC = false;
-		OCXMLImporterScreen importOpt = new OCXMLImporterScreen(
-				MyLocale.getMsg(130,&quot;Download from opencaching&quot;),
-				OCXMLImporterScreen.IMAGES|
-				OCXMLImporterScreen.ALL|
-				OCXMLImporterScreen.HOST);
-		importOpt.missingCheckBox.setText(MyLocale.getMsg(164,&quot;only listed at OC&quot;));
+		OCXMLImporterScreen importOpt = new OCXMLImporterScreen(MyLocale.getMsg(130, &quot;Download from opencaching&quot;), OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL | OCXMLImporterScreen.HOST);
+		importOpt.missingCheckBox.setText(MyLocale.getMsg(164, &quot;only listed at OC&quot;));
 		importOpt.missingCheckBox.setState(onlyListedAtOC);
-		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
-		onlyListedAtOC=pref.downloadAllOC;
-		pref.downloadAllOC=oldDownloadAllOC;
-		if (importOpt.domains.getSelectedItem()!=null) {
-			hostname = (String)importOpt.domains.getSelectedItem();
-			pref.lastOCSite=hostname;
+		if (importOpt.execute() == FormBase.IDCANCEL) {
+			return;
 		}
+		onlyListedAtOC = pref.downloadAllOC;
+		pref.downloadAllOC = oldDownloadAllOC;
+		if (importOpt.domains.getSelectedItem() != null) {
+			hostname = (String) importOpt.domains.getSelectedItem();
+			pref.lastOCSite = hostname;
+		}
 
 		try {
-			String address=&quot;<A HREF="http://">http://</A>&quot;+hostname+&quot;/search.php?&quot;;
-			address+=&quot;searchto=searchbyfinder&quot;; // searchbydistance
-			address+=&quot;&amp;showresult=1&amp;expert=0&amp;sort=bydistance&amp;orderRatingFirst=0&quot;;
-			address+=&quot;&amp;f_userowner=0&amp;f_userfound=0&amp;f_inactive=0&amp;f_ignored=0&quot;;
-			address+=&quot;&amp;f_otherPlatforms=&quot;; // 0 = all 1 = nur OC
+			String address = &quot;<A HREF="http://">http://</A>&quot; + hostname + &quot;/search.php?&quot;;
+			address += &quot;searchto=searchbyfinder&quot;; // searchbydistance
+			address += &quot;&amp;showresult=1&amp;expert=0&amp;sort=bydistance&amp;orderRatingFirst=0&quot;;
+			address += &quot;&amp;f_userowner=0&amp;f_userfound=0&amp;f_inactive=0&amp;f_ignored=0&quot;;
+			address += &quot;&amp;f_otherPlatforms=&quot;; // 0 = all 1 = nur OC
 			if (onlyListedAtOC)
-				address+=&quot;1&quot;;
-			else 
-				address+=&quot;0&quot;; 
-			address+=&quot;&amp;country=&amp;difficultymin=0&amp;difficultymax=0&amp;terrainmin=0&amp;terrainmax=0&amp;cachetype=1;2;3;4;5;6;7;8;9;10&amp;cachesize=1;2;3;4;5;6;7&amp;cache_attribs=&amp;cache_attribs_not=&quot;;
-			address+=&quot;&amp;logtype=1,7&quot;;
-			address+=&quot;&amp;utf8=1&amp;output=gpx&amp;zip=1&quot;;
-			address+=&quot;&amp;count=max&quot;;
-			address+=&quot;&amp;finder=&quot;+pref.myAlias;
-			String tmpFile=prof.dataDir + &quot;dummy.zip&quot;;
+				address += &quot;1&quot;;
+			else
+				address += &quot;0&quot;;
+			address += &quot;&amp;country=&amp;difficultymin=0&amp;difficultymax=0&amp;terrainmin=0&amp;terrainmax=0&amp;cachetype=1;2;3;4;5;6;7;8;9;10&amp;cachesize=1;2;3;4;5;6;7&amp;cache_attribs=&amp;cache_attribs_not=&quot;;
+			address += &quot;&amp;logtype=1,7&quot;;
+			address += &quot;&amp;utf8=1&amp;output=gpx&amp;zip=1&quot;;
+			address += &quot;&amp;count=max&quot;;
+			address += &quot;&amp;finder=&quot; + pref.myAlias;
+			String tmpFile = prof.dataDir + &quot;dummy.zip&quot;;
 			login();
 			UrlFetcher.fetchDataFile(address, tmpFile);
 			File ftmp = new FileBugfix(tmpFile);
-			if (ftmp.exists() &amp;&amp; ftmp.length()&gt;0) {
+			if (ftmp.exists() &amp;&amp; ftmp.length() &gt; 0) {
 				GPXImporter gpx = new GPXImporter(pref, prof, tmpFile);
-				if (pref.downloadPics) 
-					gpx.doIt(GPXImporter.DOIT_WITHSPOILER);				
-				else gpx.doIt(GPXImporter.DOIT_NOSPOILER);
+				if (pref.downloadPics)
+					gpx.doIt(GPXImporter.DOIT_WITHSPOILER);
+				else
+					gpx.doIt(GPXImporter.DOIT_NOSPOILER);
 			}
 			ftmp.delete();
 		} catch (IOException e) {
 		}
 	}
-	
-	private static boolean login() {
+
+	public static boolean login() {
 		// TODO this is only a preliminary Version of login
 		boolean loggedIn = false;
 		String page;
 		try {
-			String loginDaten=&quot;target=myhome.php&amp;action=login&amp;email=&quot;+pref.myAlias+&quot;&amp;password=&quot;+pref.password;
-			try {
-				UrlFetcher.setpostData(loginDaten);
-				UrlFetcher.setMaxRedirections(1);
-				UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/login.php">http://www.opencaching.de/login.php</A>&quot;);
-			} catch (IOException e) {
-				if (e.getMessage().startsWith(&quot;too many http redirections&quot;)) {
-					String cookie = (String) UrlFetcher.getDocumentProperties().getValue(&quot;Set-Cookie&quot;,&quot;&quot;);
-					UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;,cookie);
-					page=UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/login.php?action=cookieverify&amp;target=myhome.php">http://www.opencaching.de/login.php?action=cookieverify&amp;target=myhome.php</A>&quot;);
-					page=UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/myhome.php">http://www.opencaching.de/myhome.php</A>&quot;);
-					// control , that I am logged in
-					// (by ?) get finderid ?
-					// todo set language ?
-					loggedIn = page.indexOf(&quot;Eingeloggt als&quot;) &gt; -1;
-				}
-			}			
+			String loginDaten = &quot;target=myhome.php&amp;action=login&amp;email=&quot; + pref.myAlias + &quot;&amp;password=&quot; + pref.password;
+			UrlFetcher.setpostData(loginDaten);
+			page = UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/login.php">http://www.opencaching.de/login.php</A>&quot;);
+			// final PropertyList pl = UrlFetcher.getDocumentProperties();
+			page = UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/myhome.php">http://www.opencaching.de/myhome.php</A>&quot;);
+			loggedIn = page.indexOf(&quot;Eingeloggt als&quot;) &gt; -1;
 		} catch (IOException e) {
 			pref.log(&quot;Fehler&quot;, e);
 		}

Added: trunk/src/CacheWolf/imp/OCLinkImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCLinkImporter.java	                        (rev 0)
+++ trunk/src/CacheWolf/imp/OCLinkImporter.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -0,0 +1,79 @@
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
+
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+package CacheWolf.imp;
+
+import CacheWolf.CacheDB;
+import CacheWolf.CacheHolder;
+import CacheWolf.Global;
+import CacheWolf.UrlFetcher;
+import ewe.sys.Handle;
+import ewe.ui.ProgressBarForm;
+
+public class OCLinkImporter {
+	private CacheDB cacheDB;
+
+	public OCLinkImporter() {
+		this.cacheDB = Global.getProfile().cacheDB;
+	}
+
+	public void doIt() {
+		ProgressBarForm pbf = new ProgressBarForm();
+		Handle h = new Handle();
+
+		pbf.showMainTask = false;
+		pbf.setTask(h, &quot;Import OC names ...&quot;);
+		pbf.exec();
+		OCGPXfetch.login();
+		for (int o = 0; o &lt; cacheDB.size(); o += 1) {
+			CacheHolder ch = cacheDB.get(o);
+			String wp = ch.getWayPoint();
+			if (wp.startsWith(&quot;GC&quot;)) {
+				String url = &quot;<A HREF="http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=">http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=</A>&quot; + wp;
+				h.progress = (float) o / (float) (cacheDB.size() - 1);
+				h.changed();
+				try {
+					String result = UrlFetcher.fetch(url);
+					boolean found = false;
+					int start = result.indexOf(&quot;found=\&quot;&quot;) + 7;
+					if (result.substring(start).startsWith(&quot;1&quot;))
+						found = true;
+					start = result.indexOf(&quot;wpoc=\&quot;&quot;) + 6;
+					if (start &gt; 5) {
+						int idend = result.indexOf(&quot;\&quot;&quot;, start);
+						String ocwp = result.substring(start, idend);
+						if (!found)
+							ocwp = &quot;-&quot; + ocwp;
+						ch.setOcCacheID(ocwp);
+					}
+				} catch (Exception e) {
+					// dann halt nicht
+				}
+			}
+		}
+		pbf.exit(0);
+	}
+
+}


Property changes on: trunk/src/CacheWolf/imp/OCLinkImporter.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -1341,14 +1341,17 @@
 		} else
 			return false;
 		final String strEnglishPage = &quot;ctl00$uxLocaleList$uxLocaleList$ctl01$uxLocaleItem&quot;;
-		final String postStr = &quot;__EVENTTARGET=&quot; + UrlFetcher.encodeURL(strEnglishPage, false) + &quot;&amp;__EVENTARGUMENT=&quot; + &quot;&amp;__VIEWSTATE=&quot; + UrlFetcher.encodeURL(viewstate, false);
+		String postStr = &quot;__EVENTTARGET=&quot; + UrlFetcher.encodeURL(strEnglishPage, false) + &quot;&amp;__EVENTARGUMENT=&quot; + &quot;&amp;__VIEWSTATE=&quot; + UrlFetcher.encodeURL(viewstate, false);
+		// postStr += UrlFetcher.encodeURL(&quot;&amp;ctl00$ContentBody$tbSearch=postal code, country, etc.&quot;, true);
 		try {
 			UrlFetcher.setpostData(postStr);
-			/*
-			 * UrlFetcher.setRequestorProperty(&quot;Referer&quot;, url); UrlFetcher.setRequestorProperty(&quot;Origin&quot;, &quot;<A HREF="http://www.geocaching.com">http://www.geocaching.com</A>&quot;); UrlFetcher.setRequestorProperty(&quot;Cache-Control&quot;, &quot;max-age=0&quot;); UrlFetcher.setRequestorProperty(&quot;Accept-Charset&quot;,
-			 * &quot;ISO-8859-1,utf-8;q=0.7,*;q=0.3&quot;); UrlFetcher.setRequestorProperty(&quot;Accept-Language&quot;, &quot;de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4&quot;); cookie =
-			 * &quot;company_history=%5B%5B%22http%3A//feedback.geocaching.com/geocaching%22%2C%22Geocaching%22%5D%5D; Send2GPS=garmin; __qca=P0-675333427-1299837942815; &quot; + cookie; UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;, cookie);
-			 */
+			// UrlFetcher.setRequestorProperty(&quot;Referer&quot;, url);
+			// UrlFetcher.setRequestorProperty(&quot;Origin&quot;, &quot;<A HREF="http://www.geocaching.com">http://www.geocaching.com</A>&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Cache-Control&quot;, &quot;max-age=0&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Accept-Charset&quot;, &quot;ISO-8859-1,utf-8;q=0.7,*;q=0.3&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Accept-Language&quot;, &quot;de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4&quot;);
+			// cookie = &quot;company_history=%5B%5B%22http%3A//feedback.geocaching.com/geocaching%22%2C%22Geocaching%22%5D%5D; Send2GPS=garmin; __qca=P0-675333427-1299837942815; &quot; + cookie;
+			// UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;, cookie);
 			page = UrlFetcher.fetch(url);
 			if (page.indexOf(loggedInEnglish) &gt; -1) {
 				pref.log(&quot;Switched to English&quot;);

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2011-05-11 15:56:46 UTC (rev 2999)
+++ trunk/src/CacheWolf/myTableModel.java	2011-05-11 23:04:45 UTC (rev 3000)
@@ -1,28 +1,28 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
 
 import ewe.fx.Color;
@@ -31,7 +31,6 @@
 import ewe.fx.Image;
 import ewe.fx.Point;
 import ewe.fx.mImage;
-import ewe.sys.Convert;
 import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.CellConstants;
@@ -39,11 +38,10 @@
 import ewe.ui.TableCellAttributes;
 import ewe.ui.TableModel;
 import ewe.util.Vector;
+import ewe.util.mString;
 
 /**
- * Table model used to display the cache list. Used by the table control in the
- * first panel of CacheWolf. 20061212 salzkammergut, patch to speed up
- * scrolling, Used MyLocale
+ * Table model used to display the cache list. Used by the table control in the first panel of CacheWolf. 20061212 salzkammergut, patch to speed up scrolling, Used MyLocale
  */
 public class myTableModel extends TableModel {
 
@@ -66,30 +64,17 @@
 	/** The max number of columns in the list view */
 	public static final int N_COLUMNS = 20;
 	/**
-	 * How the columns are mapped onto the list view. If colMap[i]=j, it means
-	 * that the element j (as per the list below) is visible in column i.
-	 * [0]TickBox, [1]Type, [2]Distance, [3]Terrain, [4]waypoint, [5]name,
-	 * [6]coordinates, [7]owner, [8]datehidden, [9]status, [10]distance,
-	 * [11]bearing, [12] Size, [13] # of OC recommend. [14] OC index, [15]
-	 * Solver exists, [16] Note exists, [17] # Additionals, [18] # DNF [19] Last
-	 * Sync Date
+	 * How the columns are mapped onto the list view. If colMap[i]=j, it means that the element j (as per the list below) is visible in column i. [0]TickBox, [1]Type, [2]Distance, [3]Terrain, [4]waypoint, [5]name, [6]coordinates, [7]owner, [8]datehidden,
+	 * [9]status, [10]distance, [11]bearing, [12] Size, [13] # of OC recommend. [14] OC index, [15] Solver exists, [16] Note exists, [17] # Additionals, [18] # DNF [19] Last Sync Date
 	 * 
-	 * Attention: When adding columns here, also add a default width in
-	 * Preferences.listColWidth
+	 * Attention: When adding columns here, also add a default width in Preferences.listColWidth
 	 */
 	private int[] colMap;
 	/** The column widths corresponding to the list of columns above */
 	private int[] colWidth;
-	private String[] colName = { &quot; &quot;, &quot;?&quot;, MyLocale.getMsg(1000, &quot;D&quot;),
-			MyLocale.getMsg(1001, &quot;T&quot;), MyLocale.getMsg(1002, &quot;Waypoint&quot;),
-			&quot;Name&quot;, MyLocale.getMsg(1004, &quot;Location&quot;),
-			MyLocale.getMsg(1005, &quot;Owner&quot;), MyLocale.getMsg(1006, &quot;Hidden&quot;),
-			MyLocale.getMsg(1007, &quot;Status&quot;), MyLocale.getMsg(1008, &quot;Dist&quot;),
-			MyLocale.getMsg(1009, &quot;Bear&quot;), MyLocale.getMsg(1017, &quot;S&quot;),
-			MyLocale.getMsg(1026, &quot;#Rec&quot;), MyLocale.getMsg(1027, &quot;OC-IDX&quot;),
-			MyLocale.getMsg(1038, &quot;S&quot;), MyLocale.getMsg(1040, &quot;N&quot;),
-			MyLocale.getMsg(1047, &quot;A&quot;), MyLocale.getMsg(1049, &quot;DNF&quot;),
-			MyLocale.getMsg(1051, &quot;Last synced&quot;) };
+	private String[] colName = { &quot; &quot;, &quot;?&quot;, MyLocale.getMsg(1000, &quot;D&quot;), MyLocale.getMsg(1001, &quot;T&quot;), MyLocale.getMsg(1002, &quot;Waypoint&quot;), &quot;Name&quot;, MyLocale.getMsg(1004, &quot;Location&quot;), MyLocale.getMsg(1005, &quot;Owner&quot;), MyLocale.getMsg(1006, &quot;Hidden&quot;),
+			MyLocale.getMsg(1007, &quot;Status&quot;), MyLocale.getMsg(1008, &quot;Dist&quot;), MyLocale.getMsg(1009, &quot;Bear&quot;), MyLocale.getMsg(1017, &quot;S&quot;), MyLocale.getMsg(1026, &quot;#Rec&quot;), MyLocale.getMsg(1027, &quot;OC-IDX&quot;), MyLocale.getMsg(1038, &quot;S&quot;),
+			MyLocale.getMsg(1040, &quot;N&quot;), MyLocale.getMsg(1047, &quot;A&quot;), MyLocale.getMsg(1049, &quot;DNF&quot;), MyLocale.getMsg(1051, &quot;Last synced&quot;) };
 
 	private static Image noFindLogs[] = new Image[4];
 	public static mImage red, blue, yellow; // skull, green
@@ -106,8 +91,7 @@
 	private mImage picHasSolver, picHasNotes;
 	private mImage[] sizePics = new mImage[CacheSize.CW_TOTAL_SIZE_IMAGES];
 	/**
-	 * This is the modifier (Shift &amp; Control key status) for Pen Events it is
-	 * set in myTableControl.onEvent
+	 * This is the modifier (Shift &amp; Control key status) for Pen Events it is set in myTableControl.onEvent
 	 */
 	public int penEventModifiers;
 	public myTableControl tcControl;
@@ -174,10 +158,8 @@
 	 * 
 	 */
 	public void setColumnNamesAndWidths() {
-		colMap = TableColumnChooser.str2Array(Global.getPref().listColMap, 0,
-				N_COLUMNS - 1, 0, -1);
-		colWidth = TableColumnChooser.str2Array(Global.getPref().listColWidth,
-				10, 1024, 50, colMap.length);
+		colMap = TableColumnChooser.str2Array(Global.getPref().listColMap, 0, N_COLUMNS - 1, 0, -1);
+		colWidth = TableColumnChooser.str2Array(Global.getPref().listColWidth, 10, 1024, 50, colMap.length);
 		numCols = colMap.length;
 		clearCellAdjustments();
 		// If the displayed columns include the checkbox, we use the full menu
@@ -188,8 +170,7 @@
 	}
 
 	/**
-	 * Return the column widths as a comma delimited string for storing in the
-	 * preferences
+	 * Return the column widths as a comma delimited string for storing in the preferences
 	 * 
 	 * @return
 	 */
@@ -261,14 +242,12 @@
 	}
 
 	/**
-	 * Method to set the row color of the table displaying the cache list,
-	 * depending on different flags set to the cache.
+	 * Method to set the row color of the table displaying the cache list, depending on different flags set to the cache.
 	 */
 	/*
 	 * (non-Javadoc)
 	 * 
-	 * @see ewe.ui.TableModel#getCellAttributes(int, int, boolean,
-	 * ewe.ui.TableCellAttributes)
+	 * @see ewe.ui.TableModel#getCellAttributes(int, int, boolean, ewe.ui.TableCellAttributes)
 	 */
 	public TableCellAttributes getCellAttributes(int row, int col, boolean isSelected, TableCellAttributes ta) {
 		ta = super.getCellAttributes(row, col, isSelected, ta);
@@ -320,7 +299,7 @@
 					lastColorFG.set(ta.foreground);
 					lastRow = row;
 				} catch (Exception e) {
-					Global.getPref().log(&quot;[myTableModel:getCellAttributes]Ignored row=&quot;+row+&quot; lastRow=&quot;+lastRow,e, true);
+					Global.getPref().log(&quot;[myTableModel:getCellAttributes]Ignored row=&quot; + row + &quot; lastRow=&quot; + lastRow, e, true);
 				}
 				;
 			} else {
@@ -329,8 +308,7 @@
 				ta.fillColor = lastColorBG;
 				ta.foreground = lastColorFG;
 			}
-		} else if (row == -1 &amp;&amp; colMap[col] == 0
-				&amp;&amp; Global.getProfile().showBlacklisted()) {
+		} else if (row == -1 &amp;&amp; colMap[col] == 0 &amp;&amp; Global.getProfile().showBlacklisted()) {
 			ta.fillColor = Color.Black;
 			lastColorBG.set(ta.fillColor);
 		}
@@ -338,22 +316,17 @@
 	}
 
 	/**
-	 * Determines the arithmetic mean value of two colors and stores the result
-	 * in the third color.
+	 * Determines the arithmetic mean value of two colors and stores the result in the third color.
 	 * 
 	 * @param colorMerged
 	 *            Resulting color
 	 * @param colorA
-	 *            First color to merge. May be same object as
-	 *            &lt;code&gt;colorMerged&lt;/code&gt;.
+	 *            First color to merge. May be same object as &lt;code&gt;colorMerged&lt;/code&gt;.
 	 * @param colorB
-	 *            Second color to merge. May be same object as
-	 *            &lt;code&gt;colorMerged&lt;/code&gt;.
+	 *            Second color to merge. May be same object as &lt;code&gt;colorMerged&lt;/code&gt;.
 	 */
 	private void mergeColor(Color colorMerged, Color colorA, Color colorB) {
-		colorMerged.set((colorA.getRed() + colorB.getRed()) / 2, (colorA
-				.getGreen() + colorB.getGreen()) / 2,
-				(colorA.getBlue() + colorB.getBlue()) / 2);
+		colorMerged.set((colorA.getRed() + colorB.getRed()) / 2, (colorA.getGreen() + colorB.getGreen()) / 2, (colorA.getBlue() + colorB.getBlue()) / 2);
 	}
 
 	public int calculateRowHeight(int row) {
@@ -370,9 +343,7 @@
 	}
 
 	/**
-	 * Need to override this method with a null return to avoid getCellData
-	 * being called twice on each access to a cell. For further reference see
-	 * the Ewe source code.
+	 * Need to override this method with a null return to avoid getCellData being called twice on each access to a cell. For further reference see the Ewe source code.
 	 * 
 	 * @author skg
 	 */
@@ -432,8 +403,7 @@
 					return ch.getWayPoint();
 				case 5: // Cachename
 					// Fast return for majority of case
-					if (!showExtraWptInfo
-							|| (ch.has_bugs() == false &amp;&amp; ch.getNoFindLogs() == 0))
+					if (!showExtraWptInfo || (ch.has_bugs() == false &amp;&amp; ch.getNoFindLogs() == 0))
 						return ch.getCacheName();
 					// Now need more checks
 					IconAndText wpVal = new IconAndText();
@@ -465,13 +435,23 @@
 					} else {
 						return sizePics[CacheSize.guiSizeImageId(ch.getCacheSize())];
 					}
-				case 13: // OC number of recommendations
-					 return ch.getRecommended();
-          
-				case 14: // OC rating
-					if (ch.isOC())
-						return Convert.formatInt(ch.recommendationScore);
-					return null;
+				case 13: // OC / gcvote Bewertung
+					return ch.getRecommended();
+				case 14: //
+					if (ch.getWayPoint().startsWith(&quot;GC&quot;))
+						return ch.getOcCacheID();
+					else {
+						String[] stmp = mString.split(ch.getCacheOwner(), '/');
+						int l = stmp.length - 1;
+						if (l &gt; 0) {
+							String s = stmp[l].trim();
+							if (s.startsWith(&quot;GC&quot;))
+								return s;
+							else
+								return &quot;&quot;;
+						} else
+							return &quot;&quot;;
+					}
 				case 15: // Is solver filled?
 					if (ch.hasSolver())
 						return picHasSolver;
@@ -497,10 +477,9 @@
 				case 19: // Last sync date
 					if (!ch.getLastSync().equals(&quot;&quot;)) {
 						try {
-							lastSyncWorker.parse(ch.getLastSync(),
-									&quot;yyyyMMddHHmmss&quot;);
+							lastSyncWorker.parse(ch.getLastSync(), &quot;yyyyMMddHHmmss&quot;);
 						} catch (IllegalArgumentException e) {
-							Global.getPref().log(&quot;Could not parse 'lastSyncDate': &quot;	+ ch.getLastSync() + &quot;. Reset to empty.&quot;, e);
+							Global.getPref().log(&quot;Could not parse 'lastSyncDate': &quot; + ch.getLastSync() + &quot;. Reset to empty.&quot;, e);
 							ch.setLastSync(&quot;&quot;);
 						}
 						return lastSyncWorker.format(&quot;yyyy-MM-dd HH:mm&quot;);
@@ -551,7 +530,7 @@
 				retval = true;
 			}
 		} catch (NullPointerException npex) {
-			Global.getPref().log(&quot;[myTableModel:Penpressed]&quot;,npex,true);
+			Global.getPref().log(&quot;[myTableModel:Penpressed]&quot;, npex, true);
 			Vm.showWait(false);
 		}
 		return retval;
@@ -574,7 +553,7 @@
 			CacheHolder ch = null;
 			if ((a != null) &amp;&amp; (a.y &gt;= 0) &amp;&amp; (a.y &lt; cacheDB.size()))
 				ch = cacheDB.get(a.y);
-			cacheDB.sort(new MyComparer(cacheDB, sortedBy, numRows),!sortAscending);
+			cacheDB.sort(new MyComparer(cacheDB, sortedBy, numRows), !sortAscending);
 			updateRows();
 			// = cacheDB.rebuild(sortedVector of ch,
 			// invisibleVector of ch)
@@ -591,9 +570,7 @@
 	}
 
 	/**
-	 * Toggle the select status for a group of caches If from==to, the addi
-	 * Waypoints are also toggled if the cache is a main waypoint If from!=to,
-	 * each cache is toggled irrespective of its type (main or addi)
+	 * Toggle the select status for a group of caches If from==to, the addi Waypoints are also toggled if the cache is a main waypoint If from!=to, each cache is toggled irrespective of its type (main or addi)
 	 * 
 	 * @param from
 	 *            index of first cache to toggle


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002990.html">[Cachewolf-svn] r2999 - trunk/res_noewe
</A></li>
	<LI>Next message: <A HREF="002992.html">[Cachewolf-svn] r3001 - in trunk/src/CacheWolf: . imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2991">[ date ]</a>
              <a href="thread.html#2991">[ thread ]</a>
              <a href="subject.html#2991">[ subject ]</a>
              <a href="author.html#2991">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
