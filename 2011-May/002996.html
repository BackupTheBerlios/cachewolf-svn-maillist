<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r3005 - in trunk/src/CacheWolf: . imp view/ewe	view/pda
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3005%20-%20in%20trunk/src/CacheWolf%3A%20.%20imp%20view/ewe%0A%09view/pda&In-Reply-To=%3C20110515182009.DD752480A0E%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002993.html">
   <LINK REL="Next"  HREF="002998.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r3005 - in trunk/src/CacheWolf: . imp view/ewe	view/pda</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3005%20-%20in%20trunk/src/CacheWolf%3A%20.%20imp%20view/ewe%0A%09view/pda&In-Reply-To=%3C20110515182009.DD752480A0E%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r3005 - in trunk/src/CacheWolf: . imp view/ewe	view/pda">araber95 at mail.berlios.de
       </A><BR>
    <I>Sun May 15 08:20:09 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002993.html">[Cachewolf-svn] r3002 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp src/CacheWolf/imp
</A></li>
        <LI>Next message: <A HREF="002998.html">[Cachewolf-svn] r3007 - in trunk/src/CacheWolf: . imp navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2996">[ date ]</a>
              <a href="thread.html#2996">[ thread ]</a>
              <a href="subject.html#2996">[ subject ]</a>
              <a href="author.html#2996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2011-05-15 20:20:09 +0200 (Sun, 15 May 2011)
New Revision: 3005

Modified:
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/TravelbugJourneyScreen.java
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java
   trunk/src/CacheWolf/view/ewe/TravelbugMenu.java
   trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java
Log:


Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/CoordsScreen.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -1,28 +1,28 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
 
 import CacheWolf.imp.SpiderGC;
@@ -50,11 +50,10 @@
 import ewe.ui.mLabel;
 
 /**
- *	Class for entering coordinates&lt;br&gt;
- *	Class IDs 1400 and 600 (same as calc panel and preferences screen)&lt;br&gt;
+ * Class for entering coordinates&lt;br&gt;
+ * Class IDs 1400 and 600 (same as calc panel and preferences screen)&lt;br&gt;
  */
 
-
 public class CoordsScreen extends Form {
 
 	mCheckBox chkDMM, chkDMS, chkDD, chkCustom;
@@ -70,138 +69,171 @@
 	CWPoint coordInp = new CWPoint();
 	CellPanel topLinePanel = new CellPanel();
 	CellPanel mainPanel = new CellPanel();
-	int exitKeys[]={75009};
+	int exitKeys[] = { 75009 };
 	int currFormat;
 
 	boolean bNSDeg = false;
 	boolean bNSm = false;
-	boolean	bNSs = false;
+	boolean bNSs = false;
 	boolean bEWDeg = false;
 	boolean bEWm = false;
 	boolean bEWs = false;
 	boolean bUTMNorthing = false;
 	boolean bUTMEasting = false;
-	
 
 	private boolean allowInvalid = false;
 
-	public CoordsScreen(boolean allowInvalidCoords)
-	{
+	public CoordsScreen(boolean allowInvalidCoords) {
 		allowInvalid = allowInvalidCoords;
 
-		InitCoordsScreen();		
+		InitCoordsScreen();
 	}
 
-	public CoordsScreen()
-	{
-		InitCoordsScreen();		
+	public CoordsScreen() {
+		InitCoordsScreen();
 	}
 
-	private void InitCoordsScreen()
-	{
+	private void InitCoordsScreen() {
 		this.setTitle(&quot;&quot;);
-		//Radiobuttons for format
-		topLinePanel.addNext(chkDD =new mCheckBox(&quot;d.d&#176;&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
-		topLinePanel.addNext(chkDMM =new mCheckBox(&quot;d&#176;m.m\'&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
-		topLinePanel.addNext(chkDMS =new mCheckBox(&quot;d&#176;m\'s\&quot;&quot;),CellConstants.DONTSTRETCH,CellConstants.WEST);
-		//topLinePanel.addNext(chkUTM =new mCheckBox(&quot;UTM&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
-		topLinePanel.addNext(chkCustom =new mCheckBox(&quot;&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		// Radiobuttons for format
+		topLinePanel.addNext(chkDD = new mCheckBox(&quot;d.d&#176;&quot;), CellConstants.DONTSTRETCH, CellConstants.WEST);
+		topLinePanel.addNext(chkDMM = new mCheckBox(&quot;d&#176;m.m\'&quot;), CellConstants.DONTSTRETCH, CellConstants.WEST);
+		topLinePanel.addNext(chkDMS = new mCheckBox(&quot;d&#176;m\'s\&quot;&quot;), CellConstants.DONTSTRETCH, CellConstants.WEST);
+		// topLinePanel.addNext(chkUTM =new mCheckBox(&quot;UTM&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		topLinePanel.addNext(chkCustom = new mCheckBox(&quot;&quot;), CellConstants.DONTSTRETCH, CellConstants.WEST);
 
 		String[] ls = TransformCoordinates.getProjectedSystemNames();
-		topLinePanel.addLast(localCooSystem = new mChoice(ls, 0),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		topLinePanel.addLast(localCooSystem = new mChoice(ls, 0), CellConstants.DONTSTRETCH, CellConstants.WEST);
 
-		chkDD.setGroup(chkFormat); chkDD.exitKeys=exitKeys;
-		chkDMM.setGroup(chkFormat);chkDMM.exitKeys=exitKeys;
-		chkDMS.setGroup(chkFormat);chkDMS.exitKeys=exitKeys;
-		chkCustom.setGroup(chkFormat);chkCustom.exitKeys=exitKeys;
-		this.addLast(topLinePanel,CellConstants.DONTSTRETCH, CellConstants.WEST);
+		chkDD.setGroup(chkFormat);
+		chkDD.exitKeys = exitKeys;
+		chkDMM.setGroup(chkFormat);
+		chkDMM.exitKeys = exitKeys;
+		chkDMS.setGroup(chkFormat);
+		chkDMS.exitKeys = exitKeys;
+		chkCustom.setGroup(chkFormat);
+		chkCustom.exitKeys = exitKeys;
+		this.addLast(topLinePanel, CellConstants.DONTSTRETCH, CellConstants.WEST);
 
 		// Input for degrees
-		mainPanel.addNext(chcNS = new mChoice(new String[]{&quot;N&quot;, &quot;S&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		mainPanel.addNext(chcNS = new mChoice(new String[] { &quot;N&quot;, &quot;S&quot; }, 0), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		chcNS.setInt(0);
-		mainPanel.addNext(inpNSDeg = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addNext(inpNSm = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addLast(inpNSs = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		mainPanel.addNext(inpNSDeg = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		mainPanel.addNext(inpNSm = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		mainPanel.addLast(inpNSs = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 
-		mainPanel.addNext(chcEW = new mChoice(new String[]{&quot;E&quot;, &quot;W&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		mainPanel.addNext(chcEW = new mChoice(new String[] { &quot;E&quot;, &quot;W&quot; }, 0), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		chcEW.setInt(0);
-		mainPanel.addNext(inpEWDeg = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addNext(inpEWm = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addLast(inpEWs = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		mainPanel.addNext(inpEWDeg = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		mainPanel.addNext(inpEWm = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		mainPanel.addLast(inpEWs = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 
 		// Input for UTM
-		if (allowInvalid){
-			mainPanel.addNext(new mLabel(MyLocale.getMsg(1400,&quot;Zone&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
-			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402,&quot;Easting&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
-			mainPanel.addNext(new mLabel(MyLocale.getMsg(1401,&quot;Northing&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
-			mainPanel.addLast(btnClear = new mButton(MyLocale.getMsg(1413,&quot;Clear&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL));
+		if (allowInvalid) {
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1400, &quot;Zone&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402, &quot;Easting&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1401, &quot;Northing&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.SOUTHWEST));
+			mainPanel.addLast(btnClear = new mButton(MyLocale.getMsg(1413, &quot;Clear&quot;)), CellConstants.HSTRETCH, (CellConstants.HFILL));
 		} else {
-			mainPanel.addNext(new mLabel(MyLocale.getMsg(1400,&quot;Zone&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
-			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402,&quot;Easting&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
-			mainPanel.addNext(new mLabel(MyLocale.getMsg(1401,&quot;Northing&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
-			mainPanel.addLast(btnSearch = new mButton(MyLocale.getMsg(1414,&quot;Search&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1400, &quot;Zone&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402, &quot;Easting&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1401, &quot;Northing&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.SOUTHWEST));
+			mainPanel.addLast(btnSearch = new mButton(MyLocale.getMsg(1414, &quot;Search&quot;)), CellConstants.HSTRETCH, (CellConstants.HFILL));
 		}
 
-		mainPanel.addNext(inpUTMZone = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addNext(inpUTMEasting = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addNext(inpUTMNorthing = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addLast(btnGps = new mButton(&quot;GPS&quot;),CellConstants.HSTRETCH, (CellConstants.HFILL));
+		mainPanel.addNext(inpUTMZone = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		mainPanel.addNext(inpUTMEasting = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		mainPanel.addNext(inpUTMNorthing = new mInput(), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		mainPanel.addLast(btnGps = new mButton(&quot;GPS&quot;), CellConstants.HSTRETCH, (CellConstants.HFILL));
 
-		//	mainPanel.addLast(new mLabel(MyLocale.getMsg(1405,&quot;To load coordinates from GC, enter GCxxxxx below&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL)).setTag(SPAN,new Dimension(4,1));
+		// mainPanel.addLast(new mLabel(MyLocale.getMsg(1405,&quot;To load coordinates from GC, enter GCxxxxx below&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL)).setTag(SPAN,new Dimension(4,1));
 		// Input for free Text
-		mainPanel.addNext(inpText = new mInput(),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		inpText.toolTip=MyLocale.getMsg(1406,&quot;Enter coordinates in any format or GCxxxxx&quot;);
-		inpText.setTag(SPAN,new Dimension(3,1));
-		mainPanel.addLast(btnParse = new mButton(MyLocale.getMsg(619,&quot;Parse&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL));
+		mainPanel.addNext(inpText = new mInput(), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		inpText.toolTip = MyLocale.getMsg(1406, &quot;Enter coordinates in any format or GCxxxxx&quot;);
+		inpText.setTag(SPAN, new Dimension(3, 1));
+		mainPanel.addLast(btnParse = new mButton(MyLocale.getMsg(619, &quot;Parse&quot;)), CellConstants.HSTRETCH, (CellConstants.HFILL));
 
 		// Buttons for cancel and apply, copy and paste
-		btnCancel = new mButton(MyLocale.getMsg(614,&quot;Cancel&quot;));
+		btnCancel = new mButton(MyLocale.getMsg(614, &quot;Cancel&quot;));
 		btnCancel.setHotKey(0, IKeys.ESCAPE);
-		mainPanel.addNext(btnCancel,CellConstants.HSTRETCH, (CellConstants.HFILL));
-		//btnCancel.setTag(SPAN,new Dimension(4,1));
-		mainPanel.addNext(btnApply = new mButton(MyLocale.getMsg(615,&quot;Apply&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL));
-		//btnApply.setTag(SPAN,new Dimension(4,1));
-		mainPanel.addNext(btnPaste = new mButton(MyLocale.getMsg(617,&quot;Paste&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL));
-		//btnParse.setTag(SPAN,new Dimension(4,1));
-		mainPanel.addLast(btnCopy = new mButton(MyLocale.getMsg(618,&quot;Copy&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL));
-		//btnCopy.setTag(SPAN,new Dimension(4,1));
-		chcNS.exitKeys=exitKeys; chcEW.exitKeys=exitKeys;
-		//add Panels
-		this.addLast(mainPanel,CellConstants.DONTSTRETCH, CellConstants.WEST);
+		mainPanel.addNext(btnCancel, CellConstants.HSTRETCH, (CellConstants.HFILL));
+		// btnCancel.setTag(SPAN,new Dimension(4,1));
+		mainPanel.addNext(btnApply = new mButton(MyLocale.getMsg(615, &quot;Apply&quot;)), CellConstants.HSTRETCH, (CellConstants.HFILL));
+		// btnApply.setTag(SPAN,new Dimension(4,1));
+		mainPanel.addNext(btnPaste = new mButton(MyLocale.getMsg(617, &quot;Paste&quot;)), CellConstants.HSTRETCH, (CellConstants.HFILL));
+		// btnParse.setTag(SPAN,new Dimension(4,1));
+		mainPanel.addLast(btnCopy = new mButton(MyLocale.getMsg(618, &quot;Copy&quot;)), CellConstants.HSTRETCH, (CellConstants.HFILL));
+		// btnCopy.setTag(SPAN,new Dimension(4,1));
+		chcNS.exitKeys = exitKeys;
+		chcEW.exitKeys = exitKeys;
+		// add Panels
+		this.addLast(mainPanel, CellConstants.DONTSTRETCH, CellConstants.WEST);
 		chcNS.takeFocus(ControlConstants.ByKeyboard);
-		
-		
+
 	}
 
-	public void activateFields(int format){
-		//inpEWDeg.wantReturn=false; inpEWm.wantReturn=false; inpEWs.wantReturn=false; inpUTMNorthing.wantReturn=false;
+	public void activateFields(int format) {
+		// inpEWDeg.wantReturn=false; inpEWm.wantReturn=false; inpEWs.wantReturn=false; inpUTMNorthing.wantReturn=false;
 
-		switch (format){
+		switch (format) {
 		case TransformCoordinates.DD:
-			enable(chcNS); enable(inpNSDeg); disable(inpNSm); disable(inpNSs);
-			enable(chcEW); enable(inpEWDeg); disable(inpEWm); disable(inpEWs);
-			//inpEWDeg.wantReturn=true;
-			disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+			enable(chcNS);
+			enable(inpNSDeg);
+			disable(inpNSm);
+			disable(inpNSs);
+			enable(chcEW);
+			enable(inpEWDeg);
+			disable(inpEWm);
+			disable(inpEWs);
+			// inpEWDeg.wantReturn=true;
+			disable(inpUTMZone);
+			disable(inpUTMNorthing);
+			disable(inpUTMEasting);
 			break;
-		case TransformCoordinates.DMM: 	
-			enable(chcNS); enable(inpNSDeg); enable(inpNSm); disable(inpNSs);
-			enable(chcEW); enable(inpEWDeg); enable(inpEWm); disable(inpEWs);
-			//inpEWm.wantReturn=true;
-			disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+		case TransformCoordinates.DMM:
+			enable(chcNS);
+			enable(inpNSDeg);
+			enable(inpNSm);
+			disable(inpNSs);
+			enable(chcEW);
+			enable(inpEWDeg);
+			enable(inpEWm);
+			disable(inpEWs);
+			// inpEWm.wantReturn=true;
+			disable(inpUTMZone);
+			disable(inpUTMNorthing);
+			disable(inpUTMEasting);
 			break;
-		case TransformCoordinates.DMS: 	
-			enable(chcNS); enable(inpNSDeg); enable(inpNSm); enable(inpNSs);
-			enable(chcEW); enable(inpEWDeg); enable(inpEWm); enable(inpEWs);
-			//inpEWs.wantReturn=true;
-			disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+		case TransformCoordinates.DMS:
+			enable(chcNS);
+			enable(inpNSDeg);
+			enable(inpNSm);
+			enable(inpNSs);
+			enable(chcEW);
+			enable(inpEWDeg);
+			enable(inpEWm);
+			enable(inpEWs);
+			// inpEWs.wantReturn=true;
+			disable(inpUTMZone);
+			disable(inpUTMNorthing);
+			disable(inpUTMEasting);
 			break;
-		default: 	
-			disable(chcNS); disable(inpNSDeg); disable(inpNSm); disable(inpNSs);
-			disable(chcEW); disable(inpEWDeg); disable(inpEWm); disable(inpEWs);
-			if (TransformCoordinates.localSystems[localCooSystem.getInt()].zoneSeperatly) enable(inpUTMZone);
-			else disable(inpUTMZone); 
-			enable(inpUTMNorthing); enable(inpUTMEasting);
-			//inpUTMNorthing.wantReturn=true;
+		default:
+			disable(chcNS);
+			disable(inpNSDeg);
+			disable(inpNSm);
+			disable(inpNSs);
+			disable(chcEW);
+			disable(inpEWDeg);
+			disable(inpEWm);
+			disable(inpEWs);
+			if (TransformCoordinates.localSystems[localCooSystem.getInt()].zoneSeperatly)
+				enable(inpUTMZone);
+			else
+				disable(inpUTMZone);
+			enable(inpUTMNorthing);
+			enable(inpUTMEasting);
+			// inpUTMNorthing.wantReturn=true;
 			break;
 		}
 
@@ -210,54 +242,57 @@
 		this.repaintNow();
 	}
 
-	private void enable(Control c) {c.modify(ControlConstants.TakesKeyFocus,ControlConstants.Disabled); }
-	private void disable(Control c) {c.modify(ControlConstants.Disabled,ControlConstants.TakesKeyFocus); }
+	private void enable(Control c) {
+		c.modify(ControlConstants.TakesKeyFocus, ControlConstants.Disabled);
+	}
 
-	public void readFields(CWPoint coords){
+	private void disable(Control c) {
+		c.modify(ControlConstants.Disabled, ControlConstants.TakesKeyFocus);
+	}
+
+	public void readFields(CWPoint coords) {
 		String NS, EW;
 		if (localSystemToformatSel(currFormat) &gt;= formatSelToLocalSystem.length) {
 			if (TransformCoordinates.getLocalSystem(currFormat).zoneSeperatly)
-				coords.set(inpUTMNorthing.getText(), inpUTMEasting.getText(), inpUTMZone.getText(), currFormat); 
+				coords.set(inpUTMNorthing.getText(), inpUTMEasting.getText(), inpUTMZone.getText(), currFormat);
 			else
-				coords.set(inpUTMNorthing.getText(), inpUTMEasting.getText(), currFormat);			
+				coords.set(inpUTMNorthing.getText(), inpUTMEasting.getText(), currFormat);
+		} else {
+			NS = chcNS.getInt() == 0 ? &quot;N&quot; : &quot;S&quot;;
+			EW = chcEW.getInt() == 0 ? &quot;E&quot; : &quot;W&quot;;
+			coords.set(NS, inpNSDeg.getText(), inpNSm.getText(), inpNSs.getText(), EW, inpEWDeg.getText(), inpEWm.getText(), inpEWs.getText(), currFormat);
 		}
-		else {
-			NS = chcNS.getInt()== 0?&quot;N&quot;:&quot;S&quot;;
-			EW = chcEW.getInt()== 0?&quot;E&quot;:&quot;W&quot;;
-			coords.set(NS, inpNSDeg.getText(), inpNSm.getText(), inpNSs.getText(),
-					EW, inpEWDeg.getText(), inpEWm.getText(), inpEWs.getText(),
-					currFormat);
-		}
 		int formatsel = combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt());
 		currFormat = getLocalSystem(formatsel);
 		return;
 	}
+
 	public void setFields(CWPoint coords, int format) {
-		int formatsel = localSystemToformatSel(format); 
-		if ( formatsel &gt;= formatSelToLocalSystem.length){ // projected point = neither dd, dd&#176; mm.mm nor dd&#176; mm' ss.s&quot;
-			if (coords.isValid()){
+		int formatsel = localSystemToformatSel(format);
+		if (formatsel &gt;= formatSelToLocalSystem.length) { // projected point = neither dd, dd&#176; mm.mm nor dd&#176; mm' ss.s&quot;
+			if (coords.isValid()) {
 				localCooSystem.setInt(formatsel - formatSelToLocalSystem.length);
 				ProjectedPoint pp = TransformCoordinates.wgs84ToLocalsystem(coords, format);
 				inpText.setText(pp.toHumanReadableString());
-				inpUTMNorthing.setText(Common.DoubleToString(pp.getNorthing(),0,0));
-				inpUTMEasting.setText(Common.DoubleToString(pp.getEasting(),0,0));
-				if (TransformCoordinates.getLocalSystem(format).zoneSeperatly) inpUTMZone.setText(pp.getZoneString()); 
-				else inpUTMZone.setText(&quot;&quot;);
-			}
-			else {
+				inpUTMNorthing.setText(Common.DoubleToString(pp.getNorthing(), 0, 0));
+				inpUTMEasting.setText(Common.DoubleToString(pp.getEasting(), 0, 0));
+				if (TransformCoordinates.getLocalSystem(format).zoneSeperatly)
+					inpUTMZone.setText(pp.getZoneString());
+				else
+					inpUTMZone.setText(&quot;&quot;);
+			} else {
 				inpUTMNorthing.setText(&quot;0&quot;);
 				inpUTMEasting.setText(&quot;0&quot;);
 			}
-		}
-		else {
-			chcNS.setInt(coords.getNSLetter().equals(&quot;N&quot;)?0:1);
-			chcEW.setInt(coords.getEWLetter().equals(&quot;E&quot;)?0:1);
+		} else {
+			chcNS.setInt(coords.getNSLetter().equals(&quot;N&quot;) ? 0 : 1);
+			chcEW.setInt(coords.getEWLetter().equals(&quot;E&quot;) ? 0 : 1);
 
-			inpNSDeg.setText(STRreplace.replace(coords.getLatDeg(format),&quot;-&quot;,&quot;&quot;));
+			inpNSDeg.setText(STRreplace.replace(coords.getLatDeg(format), &quot;-&quot;, &quot;&quot;));
 			inpNSm.setText(coords.getLatMin(format));
 			inpNSs.setText(coords.getLatSec(format));
 
-			inpEWDeg.setText(STRreplace.replace(coords.getLonDeg(format),&quot;-&quot;,&quot;&quot;));
+			inpEWDeg.setText(STRreplace.replace(coords.getLonDeg(format), &quot;-&quot;, &quot;&quot;));
 			inpEWm.setText(coords.getLonMin(format));
 			inpEWs.setText(coords.getLonSec(format));
 		}
@@ -267,140 +302,139 @@
 		activateFields(format);
 	}
 
-	public CWPoint getCoords(){
+	public CWPoint getCoords() {
 		return coordInp;
 	}
 
+	public void onEvent(Event ev) {
 
-	
-	public void onEvent(Event ev){
-
 		// Ensure that the Enter key moves to the appropriate field
 		// for Checkboxes and Choice controls this is done via the exitKeys
 		// For input fields we use the wantReturn field
 
-		if(ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.EXITED){
-			if (((ControlEvent)ev).target==chkDD || ((ControlEvent)ev).target==chkDMM ||
-					((ControlEvent)ev).target==chkDMS) Gui.takeFocus(chcNS,ControlConstants.ByKeyboard);	
-			if (((ControlEvent)ev).target==chkCustom) Gui.takeFocus(inpUTMEasting,ControlConstants.ByKeyboard);
-			if (((ControlEvent)ev).target==chcNS) Gui.takeFocus(inpNSDeg,ControlConstants.ByKeyboard);
-			if (((ControlEvent)ev).target==chcEW) Gui.takeFocus(inpEWDeg,ControlConstants.ByKeyboard);
+		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.EXITED) {
+			if (((ControlEvent) ev).target == chkDD || ((ControlEvent) ev).target == chkDMM || ((ControlEvent) ev).target == chkDMS)
+				Gui.takeFocus(chcNS, ControlConstants.ByKeyboard);
+			if (((ControlEvent) ev).target == chkCustom)
+				Gui.takeFocus(inpUTMEasting, ControlConstants.ByKeyboard);
+			if (((ControlEvent) ev).target == chcNS)
+				Gui.takeFocus(inpNSDeg, ControlConstants.ByKeyboard);
+			if (((ControlEvent) ev).target == chcEW)
+				Gui.takeFocus(inpEWDeg, ControlConstants.ByKeyboard);
 		}
-		if(ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED){
-			if (((ControlEvent)ev).target==inpEWDeg || ((ControlEvent)ev).target==inpEWm ||
-					((ControlEvent)ev).target==inpEWs || ((ControlEvent)ev).target==inpUTMNorthing) Gui.takeFocus(btnApply,ControlConstants.ByKeyboard);	
-			
-			
-			if (ev.target == chkFormat || ev.target == localCooSystem){
-				if (ev.target == localCooSystem) chkFormat.selectIndex(3);
+		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED) {
+			if (((ControlEvent) ev).target == inpEWDeg || ((ControlEvent) ev).target == inpEWm || ((ControlEvent) ev).target == inpEWs || ((ControlEvent) ev).target == inpUTMNorthing)
+				Gui.takeFocus(btnApply, ControlConstants.ByKeyboard);
+
+			if (ev.target == chkFormat || ev.target == localCooSystem) {
+				if (ev.target == localCooSystem)
+					chkFormat.selectIndex(3);
 				readFields(coordInp);
 				setFields(coordInp, currFormat);
 				this.repaintNow();
 			}
 
-			if (ev.target == btnCancel){
+			if (ev.target == btnCancel) {
 				this.close(IDCANCEL);
 			}
 
-			if (ev.target == btnApply){
+			if (ev.target == btnApply) {
 				currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
 				readFields(coordInp);
-				if (coordInp.isValid()) this.close(IDOK);
+				if (coordInp.isValid())
+					this.close(IDOK);
 				else {
-					if	( allowInvalid ) {
-						if ((new MessageBox(MyLocale.getMsg(144,&quot;Warnung&quot;),MyLocale.getMsg(1412,&quot;Coordinates invalid. Apply anyway?&quot;),FormBase.DEFOKB|FormBase.NOB)).execute() == FormBase.IDOK ) {
-							this.close(IDOK);						
+					if (allowInvalid) {
+						if ((new MessageBox(MyLocale.getMsg(144, &quot;Warnung&quot;), MyLocale.getMsg(1412, &quot;Coordinates invalid. Apply anyway?&quot;), FormBase.DEFOKB | FormBase.NOB)).execute() == FormBase.IDOK) {
+							this.close(IDOK);
 						}
 					} else {
-						(new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(1411,&quot;Please enter valid coordinates&quot;), FormBase.OKB)).execute();						
+						(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1411, &quot;Please enter valid coordinates&quot;), FormBase.OKB)).execute();
 					}
 				}
 			}
 
-			if (ev.target == btnPaste){
+			if (ev.target == btnPaste) {
 				inpText.setText(Vm.getClipboardText(&quot;&quot;));
 			}
 
-			if (ev.target == btnCopy){
+			if (ev.target == btnCopy) {
 				readFields(coordInp); // TODO was anderes als Gau&#223;-Kr&#252;ger unterst&#252;tzen
 				Vm.setClipboardText(coordInp.toString(currFormat));
 			}
 
-			if (ev.target == btnParse){
+			if (ev.target == btnParse) {
 				// try to parse coords
 				CWPoint coord;
-				String inp=inpText.getText().trim().toUpperCase();
+				String inp = inpText.getText().trim().toUpperCase();
 				if (inp.startsWith(&quot;GC&quot;)) {
 					SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
 					coord = new CWPoint(spider.getCacheCoordinates(inp));
-				} else {	
+					Global.getPref().setOldGCLanguage();
+				} else {
 					coord = new CWPoint(inp);
 				}
-				if (!coord.isValid()){
-					MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(4111,&quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;), FormBase.OKB);
+				if (!coord.isValid()) {
+					MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(4111, &quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;), FormBase.OKB);
 					tmpMB.exec();
-				}else {
-					currFormat =  getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
-					setFields(coord,currFormat);
+				} else {
+					currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
+					setFields(coord, currFormat);
 					this.repaintNow();
 				}
 			}
 
-			if (ev.target == btnGps){
-				Navigate nav=Global.mainTab.nav;
-				if (nav.gpsPos.isValid()){
+			if (ev.target == btnGps) {
+				Navigate nav = Global.mainTab.nav;
+				if (nav.gpsPos.isValid()) {
 					CWPoint coord = nav.gpsPos;
 					currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
-					setFields(coord,currFormat);
+					setFields(coord, currFormat);
 				}
 			}
 
-			if (ev.target == btnClear){
-				CWPoint coord = new CWPoint(91,361);
+			if (ev.target == btnClear) {
+				CWPoint coord = new CWPoint(91, 361);
 				currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
-				setFields(coord,currFormat);
+				setFields(coord, currFormat);
 			}
-			
+
 			if (ev.target == btnSearch) {
-				GeoCodeGui s = new GeoCodeGui(); 
+				GeoCodeGui s = new GeoCodeGui();
 				int ok = s.execute();
 				if (ok == FormBase.IDOK) {
 					currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
-					setFields(s.coordInp,currFormat);
+					setFields(s.coordInp, currFormat);
 				}
 			}
 		}
 		super.onEvent(ev);
 	}
-	
 
-	private static final int[] formatSelToLocalSystem = {
-		TransformCoordinates.DD,
-		TransformCoordinates.DMM,
-		TransformCoordinates.DMS,
-	};
+	private static final int[] formatSelToLocalSystem = { TransformCoordinates.DD, TransformCoordinates.DMM, TransformCoordinates.DMS, };
 
 	public int localSystemToformatSel(int cwpointformat) {
-		for (int i=0; i &lt; formatSelToLocalSystem.length; i++) 
-			if (formatSelToLocalSystem[i] == cwpointformat) return i;
-		for (int i=0; i &lt; TransformCoordinates.localSystems.length; i++) 
-			if (TransformCoordinates.localSystems[i].code == cwpointformat) return i + formatSelToLocalSystem.length;
-		
+		for (int i = 0; i &lt; formatSelToLocalSystem.length; i++)
+			if (formatSelToLocalSystem[i] == cwpointformat)
+				return i;
+		for (int i = 0; i &lt; TransformCoordinates.localSystems.length; i++)
+			if (TransformCoordinates.localSystems[i].code == cwpointformat)
+				return i + formatSelToLocalSystem.length;
+
 		throw new IllegalArgumentException(&quot;CoordScreen.CWPointformatToformatSel: cwpointformat &quot; + cwpointformat + &quot;not supported&quot;);
 	}
 
 	public static final int getLocalSystem(int formatsel) { // be carefull: this method is also used by CalcPanel
-		if (formatsel &lt; formatSelToLocalSystem.length) return formatSelToLocalSystem[formatsel];
+		if (formatsel &lt; formatSelToLocalSystem.length)
+			return formatSelToLocalSystem[formatsel];
 		return TransformCoordinates.localSystems[formatsel - formatSelToLocalSystem.length].code;
 	}
-	
+
 	public static final int combineToFormatSel(int radiobuttonindex, int choiceindex) {
 		int ret = radiobuttonindex;
-		if (ret == formatSelToLocalSystem.length) ret += choiceindex;
+		if (ret == formatSelToLocalSystem.length)
+			ret += choiceindex;
 		return ret;
 	}
 
 }
-
-
-

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/MainMenu.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -354,6 +354,7 @@
 				cacheDB.clear();
 				profile.readIndex();
 				tbp.resetModel();
+				pref.setOldGCLanguage();
 			}
 			if (mev.selectedItem == spiderRoute) {
 				SpiderGC spGC = new SpiderGC(pref, profile);
@@ -362,6 +363,7 @@
 				cacheDB.clear();
 				profile.readIndex();
 				tbp.resetModel();
+				pref.setOldGCLanguage();
 			}
 			if (mev.selectedItem == spiderQuick) {
 				SpiderGC spGC = new SpiderGC(pref, profile);
@@ -370,6 +372,7 @@
 				cacheDB.clear();
 				profile.readIndex();
 				tbp.resetModel();
+				pref.setOldGCLanguage();
 			}
 			if (mev.selectedItem == spiderAllFinds) {
 				SpiderGC spGC = new SpiderGC(pref, profile);
@@ -378,6 +381,7 @@
 				cacheDB.clear();
 				profile.readIndex();
 				tbp.resetModel();
+				pref.setOldGCLanguage();
 			}
 			if (mev.selectedItem == loadGCVotes) {
 				if (sGCV == null)
@@ -417,6 +421,7 @@
 				Global.getProfile().setShowBlacklisted(false);
 				filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 				tbp.resetModel();
+				pref.setOldGCLanguage();
 			}
 			if (mev.selectedItem == loadOC) {
 				OCXMLImporter oc = new OCXMLImporter(pref, profile);
@@ -431,8 +436,10 @@
 				filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 				tbp.resetModel();
 			}
-			if (mev.selectedItem == update)
+			if (mev.selectedItem == update) {
 				updateSelectedCaches(tbp);
+				pref.setOldGCLanguage();
+			}
 			if (mev.selectedItem == mnuForceLogin) {
 				mnuForceLogin.modifiers ^= MenuItem.Checked;
 				Global.getPref().forceLogin = (mnuForceLogin.modifiers &amp; MenuItem.Checked) != 0;

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/Preferences.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -314,18 +314,16 @@
 	/** Width and height of free defined tile size */
 	public int tilewidth;
 	public int tileheight;
-
 	/** ShowCachesOnMap */
 	public boolean showCachesOnMap = true;
-
 	/** SortingGroupedByCache */
 	public boolean SortingGroupedByCache = true;
-
 	/** useOwnSymbols */
 	public boolean useOwnSymbols = true;
-
 	/** TRUE if we want automatic sorting **/
 	public boolean sortAutomatic = true;
+	//
+	public String oldLanguageCtl = &quot;&quot;;
 
 	// ////////////////////////////////////////////
 	/**
@@ -1342,4 +1340,12 @@
 			absoluteBaseDir += &quot;/&quot;;
 	}
 
+	public void setOldGCLanguage() {
+		if (oldLanguageCtl.length() != 0)
+			try {
+				UrlFetcher.fetch(oldLanguageCtl);
+			} catch (IOException e) {
+				// dann halt nicht
+			}
+	}
 }

Modified: trunk/src/CacheWolf/TravelbugJourneyScreen.java
===================================================================
--- trunk/src/CacheWolf/TravelbugJourneyScreen.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/TravelbugJourneyScreen.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -1,28 +1,28 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
 
 /**
@@ -78,8 +78,8 @@
 import ewe.ui.mLabel;
 import ewe.ui.mTabbedPanel;
 
-public class TravelbugJourneyScreen extends Form  {
-	
+public class TravelbugJourneyScreen extends Form {
+
 	/** The list control */
 	private tbListControl tcTbJourneyList;
 	/** The list model */
@@ -88,588 +88,612 @@
 	private TravelbugJourneyList tblMyTravelbugJourneys;
 	/** The panel for the lower half of the screen */
 	private CellPanel lowerpane;
-	private mInput inpName,inpTrackingNo, 
-		   inpFromDate, inpFromProfile, inpFromWaypoint, 
-	       inpToDate, inpToProfile, inpToWaypoint;
+	private mInput inpName, inpTrackingNo, inpFromDate, inpFromProfile, inpFromWaypoint, inpToDate, inpToProfile, inpToWaypoint;
 	private mLabel lblId;
-	private mButton btnFromDate,btnToDate;
+	private mButton btnFromDate, btnToDate;
 	private mCheckBox chkFromLogged, chkToLogged;
 	private HtmlDisplay txtMission;
 	private mTabbedPanel pnlTab;
-    /**	 List of TBs in the current cache */
-	private TravelbugList tblSrcCache; 
+	/** List of TBs in the current cache */
+	private TravelbugList tblSrcCache;
 	/** The currently selected row */
-	private int selectedRow=-1;
-	/** A label which holds the number of currently displayed travelbug journeys*/
+	private int selectedRow = -1;
+	/** A label which holds the number of currently displayed travelbug journeys */
 	private mLabel lblNumVisibleJourneys;
-	private final Color RED=new Color(255,0,0);
-	private int exitKeys[]={75009};
-	/** A flag to track whether the current cache has to be saved because a travelbug
+	private final Color RED = new Color(255, 0, 0);
+	private int exitKeys[] = { 75009 };
+	/**
+	 * A flag to track whether the current cache has to be saved because a travelbug
 	 * was added to or taken from it.
 	 */
-	private boolean chDmodified=false;
-	
+	private boolean chDmodified = false;
+
 	/** The current cache */
 	private CacheHolderDetail chD;
 	/** The base data of the current cache */
 	private CacheHolder ch;
 	/** The name of the current waypoint */
-	private String waypoint=&quot;&quot;;
-	
+	private String waypoint = &quot;&quot;;
+
 	public TravelbugJourneyScreen() {
-		CacheDB cacheDB=Global.getProfile().cacheDB;
+		CacheDB cacheDB = Global.getProfile().cacheDB;
 		SplittablePanel split = new SplittablePanel(PanelSplitter.VERTICAL);
 		CellPanel tablepane = split.getNextPanel();
-		int curCacheNo=Global.mainTab.tbP.getSelectedCache();
-		String cache=&quot;&quot;;
-		if (curCacheNo&gt;=0 &amp;&amp; curCacheNo&lt;cacheDB.size()) {
-			ch=cacheDB.get(curCacheNo);
-			cache=MyLocale.getMsg(6022,&quot;: Current cache: &quot;)+ch.getWayPoint()+&quot; - &quot;+ch.getCacheName();
-			waypoint=ch.getWayPoint();
-			chD=ch.getCacheDetails(true);
-			tblSrcCache=ch.getCacheDetails(true).Travelbugs;
+		int curCacheNo = Global.mainTab.tbP.getSelectedCache();
+		String cache = &quot;&quot;;
+		if (curCacheNo &gt;= 0 &amp;&amp; curCacheNo &lt; cacheDB.size()) {
+			ch = cacheDB.get(curCacheNo);
+			cache = MyLocale.getMsg(6022, &quot;: Current cache: &quot;) + ch.getWayPoint() + &quot; - &quot; + ch.getCacheName();
+			waypoint = ch.getWayPoint();
+			chD = ch.getCacheDetails(true);
+			tblSrcCache = ch.getCacheDetails(true).Travelbugs;
 		}
-		title=&quot;Travelbugs&quot;+cache;
-		tcTbJourneyList=new tbListControl();
-		tcTbJourneyList.setTableModel(modTbJourneyList=new tbListTableModel());
-		tablepane.addLast(new MyScrollBarPanel(tcTbJourneyList,ScrollablePanel.AlwaysShowVerticalScrollers),STRETCH,FILL);
-	
+		title = &quot;Travelbugs&quot; + cache;
+		tcTbJourneyList = new tbListControl();
+		tcTbJourneyList.setTableModel(modTbJourneyList = new tbListTableModel());
+		tablepane.addLast(new MyScrollBarPanel(tcTbJourneyList, ScrollablePanel.AlwaysShowVerticalScrollers), STRETCH, FILL);
+
 		lowerpane = split.getNextPanel();
-		
-		pnlTab=new mTabbedPanel();
-		pnlTab.extraControlsRight=lblNumVisibleJourneys=new mLabel(&quot;  0&quot;);
-		//------------------------------------------------
+
+		pnlTab = new mTabbedPanel();
+		pnlTab.extraControlsRight = lblNumVisibleJourneys = new mLabel(&quot;  0&quot;);
+		// ------------------------------------------------
 		// First Tab - Name &amp; Tracking #
-		//------------------------------------------------
-		CellPanel pnlName=new CellPanel();
-		pnlName.addNext(new mLabel(MyLocale.getMsg(6025,&quot;Name:&quot;)),DONTSTRETCH,DONTFILL);
-		pnlName.addLast(inpName=new mInput(),HSTRETCH,HFILL);
-		pnlName.addNext(new mLabel(MyLocale.getMsg(6026,&quot;Tracking #:&quot;)),DONTSTRETCH,DONTFILL);
-		pnlName.addLast(inpTrackingNo=new mInput(),HSTRETCH,HFILL);
-		pnlName.addNext(new mLabel(MyLocale.getMsg(6027,&quot;ID/GUID:&quot;)),DONTSTRETCH,DONTFILL);
-		pnlName.addLast(lblId=new mLabel(&quot;&quot;),HSTRETCH,HFILL);
-		pnlTab.addCard(pnlName,MyLocale.getMsg(6028,&quot;Name&quot;),&quot;Name&quot;);
-		
-		//------------------------------------------------
+		// ------------------------------------------------
+		CellPanel pnlName = new CellPanel();
+		pnlName.addNext(new mLabel(MyLocale.getMsg(6025, &quot;Name:&quot;)), DONTSTRETCH, DONTFILL);
+		pnlName.addLast(inpName = new mInput(), HSTRETCH, HFILL);
+		pnlName.addNext(new mLabel(MyLocale.getMsg(6026, &quot;Tracking #:&quot;)), DONTSTRETCH, DONTFILL);
+		pnlName.addLast(inpTrackingNo = new mInput(), HSTRETCH, HFILL);
+		pnlName.addNext(new mLabel(MyLocale.getMsg(6027, &quot;ID/GUID:&quot;)), DONTSTRETCH, DONTFILL);
+		pnlName.addLast(lblId = new mLabel(&quot;&quot;), HSTRETCH, HFILL);
+		pnlTab.addCard(pnlName, MyLocale.getMsg(6028, &quot;Name&quot;), &quot;Name&quot;);
+
+		// ------------------------------------------------
 		// Second Tab - Where was the TB picked up from
-		//------------------------------------------------
-		CellPanel pnlFrom=new CellPanel();
-		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6029,&quot;Profile/Cache:&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		pnlFrom.addNext(inpFromProfile=new mInput(),HSTRETCH,HFILL);
-		pnlFrom.addLast(inpFromWaypoint=new mInput(),HSTRETCH,HFILL);
-		
-		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6030,&quot;Date found:&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		pnlFrom.addNext(inpFromDate=new mInput(),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		pnlFrom.addLast(btnFromDate=new mButton(new mImage(&quot;calendar.png&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		btnFromDate.modify(0,ControlConstants.TakesKeyFocus);
-		
-		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6031,&quot;Logged:&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		pnlFrom.addLast(chkFromLogged=new mCheckBox(&quot;&quot;),DONTSTRETCH,DONTFILL|WEST);
-		chkFromLogged.exitKeys=exitKeys;
+		// ------------------------------------------------
+		CellPanel pnlFrom = new CellPanel();
+		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6029, &quot;Profile/Cache:&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		pnlFrom.addNext(inpFromProfile = new mInput(), HSTRETCH, HFILL);
+		pnlFrom.addLast(inpFromWaypoint = new mInput(), HSTRETCH, HFILL);
+
+		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6030, &quot;Date found:&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		pnlFrom.addNext(inpFromDate = new mInput(), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		pnlFrom.addLast(btnFromDate = new mButton(new mImage(&quot;calendar.png&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		btnFromDate.modify(0, ControlConstants.TakesKeyFocus);
+
+		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6031, &quot;Logged:&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		pnlFrom.addLast(chkFromLogged = new mCheckBox(&quot;&quot;), DONTSTRETCH, DONTFILL | WEST);
+		chkFromLogged.exitKeys = exitKeys;
 		pnlFrom.addLast(new mLabel(&quot;&quot;));
-		
-		pnlTab.addCard(pnlFrom,MyLocale.getMsg(6032,&quot;From&quot;),&quot;From&quot;);
 
-		//------------------------------------------------
+		pnlTab.addCard(pnlFrom, MyLocale.getMsg(6032, &quot;From&quot;), &quot;From&quot;);
+
+		// ------------------------------------------------
 		// Third Tab - Where was the TB dropped
-		//------------------------------------------------
-		CellPanel pnlTo=new CellPanel();
-		pnlTo.addNext(new mLabel(MyLocale.getMsg(6029,&quot;Profile/Cache:&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		pnlTo.addNext(inpToProfile=new mInput(),HSTRETCH,HFILL);
-		pnlTo.addLast(inpToWaypoint=new mInput(),HSTRETCH,HFILL);
-		
-		pnlTo.addNext(new mLabel(MyLocale.getMsg(6033,&quot;Date dropped:&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		pnlTo.addNext(inpToDate=new mInput(),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		//inpToDate.modifyAll(DisplayOnly,0);
-		pnlTo.addLast(btnToDate=new mButton(new mImage(&quot;calendar.png&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		btnToDate.modify(0,ControlConstants.TakesKeyFocus);
-		//pnlTo.addLast(new mLabel(&quot;&quot;));
-		
-		pnlTo.addNext(new mLabel(MyLocale.getMsg(6031,&quot;Logged:&quot;)),DONTSTRETCH,DONTFILL|WEST);
-		pnlTo.addLast(chkToLogged=new mCheckBox(&quot;&quot;),DONTSTRETCH,DONTFILL|WEST);
-		chkToLogged.exitKeys=exitKeys;
+		// ------------------------------------------------
+		CellPanel pnlTo = new CellPanel();
+		pnlTo.addNext(new mLabel(MyLocale.getMsg(6029, &quot;Profile/Cache:&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		pnlTo.addNext(inpToProfile = new mInput(), HSTRETCH, HFILL);
+		pnlTo.addLast(inpToWaypoint = new mInput(), HSTRETCH, HFILL);
+
+		pnlTo.addNext(new mLabel(MyLocale.getMsg(6033, &quot;Date dropped:&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		pnlTo.addNext(inpToDate = new mInput(), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		// inpToDate.modifyAll(DisplayOnly,0);
+		pnlTo.addLast(btnToDate = new mButton(new mImage(&quot;calendar.png&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		btnToDate.modify(0, ControlConstants.TakesKeyFocus);
+		// pnlTo.addLast(new mLabel(&quot;&quot;));
+
+		pnlTo.addNext(new mLabel(MyLocale.getMsg(6031, &quot;Logged:&quot;)), DONTSTRETCH, DONTFILL | WEST);
+		pnlTo.addLast(chkToLogged = new mCheckBox(&quot;&quot;), DONTSTRETCH, DONTFILL | WEST);
+		chkToLogged.exitKeys = exitKeys;
 		pnlTo.addLast(new mLabel(&quot;&quot;));
-		
-		pnlTab.addCard(pnlTo,MyLocale.getMsg(6034,&quot;To&quot;),&quot;To&quot;);
-		
-		//------------------------------------------------
+
+		pnlTab.addCard(pnlTo, MyLocale.getMsg(6034, &quot;To&quot;), &quot;To&quot;);
+
+		// ------------------------------------------------
 		// Last Panel - TB Mission
-		//------------------------------------------------
-		CellPanel pnlDest=new CellPanel();
-		pnlDest.addLast(new mLabel(MyLocale.getMsg(6035,&quot;Mission:&quot;)));
-		pnlDest.addLast(txtMission=new HtmlDisplay(),STRETCH,FILL);
-		txtMission.rows=3;
-		pnlTab.addCard(pnlDest,MyLocale.getMsg(6036,&quot;Mission&quot;),&quot;Mission&quot;);
+		// ------------------------------------------------
+		CellPanel pnlDest = new CellPanel();
+		pnlDest.addLast(new mLabel(MyLocale.getMsg(6035, &quot;Mission:&quot;)));
+		pnlDest.addLast(txtMission = new HtmlDisplay(), STRETCH, FILL);
+		txtMission.rows = 3;
+		pnlTab.addCard(pnlDest, MyLocale.getMsg(6036, &quot;Mission&quot;), &quot;Mission&quot;);
 
-		
-		lowerpane.addLast(pnlTab,STRETCH,FILL);
-		
-		
-		split.setSplitter(PanelSplitter.AFTER|PanelSplitter.HIDDEN,PanelSplitter.BEFORE|PanelSplitter.HIDDEN,0);
-		addLast(split,STRETCH,FILL);
-		//setPreferredSize(MyLocale.getScreenWidth()&lt;=240?240:MyLocale.getScreenWidth()*2/3,240);
-		
-		tblMyTravelbugJourneys=new TravelbugJourneyList();
+		lowerpane.addLast(pnlTab, STRETCH, FILL);
+
+		split.setSplitter(PanelSplitter.AFTER | PanelSplitter.HIDDEN, PanelSplitter.BEFORE | PanelSplitter.HIDDEN, 0);
+		addLast(split, STRETCH, FILL);
+		// setPreferredSize(MyLocale.getScreenWidth()&lt;=240?240:MyLocale.getScreenWidth()*2/3,240);
+
+		tblMyTravelbugJourneys = new TravelbugJourneyList();
 		tblMyTravelbugJourneys.readTravelbugsFile();
-		modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
+		modTbJourneyList.numRows = tblMyTravelbugJourneys.size();
 		// Get the columns to display and their widths from preferences
-		modTbJourneyList.columnMap=
-			TableColumnChooser.str2Array(Global.getPref().travelbugColMap,0,11,0, -1);
-		modTbJourneyList.colWidth=
-			TableColumnChooser.str2Array(Global.getPref().travelbugColWidth,10,1024,50, -1);
-		modTbJourneyList.numCols=modTbJourneyList.columnMap.length;
-		
-		modTbJourneyList.select(0,12,true);
+		modTbJourneyList.columnMap = TableColumnChooser.str2Array(Global.getPref().travelbugColMap, 0, 11, 0, -1);
+		modTbJourneyList.colWidth = TableColumnChooser.str2Array(Global.getPref().travelbugColWidth, 10, 1024, 50, -1);
+		modTbJourneyList.numCols = modTbJourneyList.columnMap.length;
+
+		modTbJourneyList.select(0, 12, true);
 		/* Restore the saved setting about showing only non-logged bugs */
 		if (Global.getPref().travelbugShowOnlyNonLogged) {
 			tcTbJourneyList.toggleNonLogged();
 		}
 		updateNumBugs();
 	}
-	
+
 	/** Indicate the number of journeys currently displayed */
 	private void updateNumBugs() {
-		lblNumVisibleJourneys.setText(&quot;&quot;+modTbJourneyList.numRows);
+		lblNumVisibleJourneys.setText(&quot;&quot; + modTbJourneyList.numRows);
 		lblNumVisibleJourneys.repaint();
 	}
-	
+
 	/** The control which had the last focus */
 	private Control currentControl;
-	
-	public void onEvent(Event ev){
-		// Update the table from the input form  
-		if ((ev instanceof MultiPanelEvent || ev instanceof ControlEvent || ev instanceof DataChangeEvent) &amp;&amp; selectedRow!=-1 &amp;&amp;
-				selectedRow&lt;tblMyTravelbugJourneys.size()){
-			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
-			if (currentControl==inpName) 			tbj.getTb().setName(inpName.getText());
-			else if (currentControl==inpTrackingNo)  tbj.getTb().setTrackingNo(inpTrackingNo.getText());
-			else if (currentControl==inpFromProfile) tbj.setFromProfile(inpFromProfile.getText());
-			else if (currentControl==inpFromWaypoint)tbj.setFromWaypoint(inpFromWaypoint.getText());
-			else if (currentControl==inpFromDate)    tbj.setFromDate(inpFromDate.getText());
-			else if (currentControl==chkFromLogged)  tbj.setFromLogged(chkFromLogged.state);
-			else if (currentControl==inpToProfile)   tbj.setToProfile(inpToProfile.getText());
-			else if (currentControl==inpToWaypoint)  tbj.setToWaypoint(inpToWaypoint.getText());
-			else if (currentControl==inpToDate)      tbj.setToDate(inpToDate.getText());
-			else if (currentControl==chkToLogged)    tbj.setToLogged(chkToLogged.state);
-			//else if (ev.target==txtMission)     tb.setMission(txtMission.getText());
+
+	public void onEvent(Event ev) {
+		// Update the table from the input form
+		if ((ev instanceof MultiPanelEvent || ev instanceof ControlEvent || ev instanceof DataChangeEvent) &amp;&amp; selectedRow != -1 &amp;&amp; selectedRow &lt; tblMyTravelbugJourneys.size()) {
+			TravelbugJourney tbj = tblMyTravelbugJourneys.getTBJourney(selectedRow);
+			if (currentControl == inpName)
+				tbj.getTb().setName(inpName.getText());
+			else if (currentControl == inpTrackingNo)
+				tbj.getTb().setTrackingNo(inpTrackingNo.getText());
+			else if (currentControl == inpFromProfile)
+				tbj.setFromProfile(inpFromProfile.getText());
+			else if (currentControl == inpFromWaypoint)
+				tbj.setFromWaypoint(inpFromWaypoint.getText());
+			else if (currentControl == inpFromDate)
+				tbj.setFromDate(inpFromDate.getText());
+			else if (currentControl == chkFromLogged)
+				tbj.setFromLogged(chkFromLogged.state);
+			else if (currentControl == inpToProfile)
+				tbj.setToProfile(inpToProfile.getText());
+			else if (currentControl == inpToWaypoint)
+				tbj.setToWaypoint(inpToWaypoint.getText());
+			else if (currentControl == inpToDate)
+				tbj.setToDate(inpToDate.getText());
+			else if (currentControl == chkToLogged)
+				tbj.setToLogged(chkToLogged.state);
+			// else if (ev.target==txtMission) tb.setMission(txtMission.getText());
 			tcTbJourneyList.repaint();
 		}
-		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED &amp;&amp; selectedRow!=-1){
-			if (ev.target==inpTrackingNo) {pnlTab.selectNextTab(true,true); Gui.takeFocus(inpFromProfile,ControlConstants.ByKeyboard);pnlTab.repaint(); }
-			if (ev.target==inpFromDate) Gui.takeFocus(chkFromLogged,ControlConstants.ByKeyboard);
-			if (ev.target==inpToDate) Gui.takeFocus(chkToLogged,ControlConstants.ByKeyboard);
-			if (ev.target==btnFromDate || ev.target==btnToDate) {
-				mInput inpDate=ev.target==btnFromDate ? inpFromDate : inpToDate;
-				DateTimeChooser dc=new DateTimeChooser(Vm.getLocale());
-				dc.title=MyLocale.getMsg(328,&quot;Date found&quot;); 
-				dc.setPreferredSize(240,240);
-				String foundDate=inpDate.getText();
-				Time t=new Time();
+		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED &amp;&amp; selectedRow != -1) {
+			if (ev.target == inpTrackingNo) {
+				pnlTab.selectNextTab(true, true);
+				Gui.takeFocus(inpFromProfile, ControlConstants.ByKeyboard);
+				pnlTab.repaint();
+			}
+			if (ev.target == inpFromDate)
+				Gui.takeFocus(chkFromLogged, ControlConstants.ByKeyboard);
+			if (ev.target == inpToDate)
+				Gui.takeFocus(chkToLogged, ControlConstants.ByKeyboard);
+			if (ev.target == btnFromDate || ev.target == btnToDate) {
+				mInput inpDate = ev.target == btnFromDate ? inpFromDate : inpToDate;
+				DateTimeChooser dc = new DateTimeChooser(Vm.getLocale());
+				dc.title = MyLocale.getMsg(328, &quot;Date found&quot;);
+				dc.setPreferredSize(240, 240);
+				String foundDate = inpDate.getText();
+				Time t = new Time();
 				try {
-					t.parse(foundDate,&quot;y-M-d H:m&quot;);
-				} catch(IllegalArgumentException e) {
+					t.parse(foundDate, &quot;y-M-d H:m&quot;);
+				} catch (IllegalArgumentException e) {
 					try {
-						t.parse(foundDate,&quot;y-M-d&quot;);
-					} catch(IllegalArgumentException e1) {
+						t.parse(foundDate, &quot;y-M-d&quot;);
+					} catch (IllegalArgumentException e1) {
 						// Can't parse date - should not happen
 					}
-				};
+				}
+				;
 				dc.reset(t);
-				if (dc.execute()==ewe.ui.FormBase.IDOK) {
-				  inpDate.setText(Convert.toString(dc.year)+&quot;-&quot;+MyLocale.formatLong(dc.month,&quot;00&quot;)+&quot;-&quot;+MyLocale.formatLong(dc.day,&quot;00&quot;)+&quot; &quot;+dc.time);
-				  if (ev.target==btnFromDate){ 
-					  tblMyTravelbugJourneys.getTBJourney(selectedRow).setFromDate(inpDate.getText());
-					  Gui.takeFocus(chkFromLogged,ControlConstants.ByKeyboard);
-				  } else {
-					  tblMyTravelbugJourneys.getTBJourney(selectedRow).setToDate(inpDate.getText());
-					  Gui.takeFocus(chkToLogged,ControlConstants.ByKeyboard);
-				  } tcTbJourneyList.repaint();
-				}				
+				if (dc.execute() == ewe.ui.FormBase.IDOK) {
+					inpDate.setText(Convert.toString(dc.year) + &quot;-&quot; + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot; + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot; + dc.time);
+					if (ev.target == btnFromDate) {
+						tblMyTravelbugJourneys.getTBJourney(selectedRow).setFromDate(inpDate.getText());
+						Gui.takeFocus(chkFromLogged, ControlConstants.ByKeyboard);
+					} else {
+						tblMyTravelbugJourneys.getTBJourney(selectedRow).setToDate(inpDate.getText());
+						Gui.takeFocus(chkToLogged, ControlConstants.ByKeyboard);
+					}
+					tcTbJourneyList.repaint();
+				}
 			}
 		}
-		if(ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.EXITED){
-			pnlTab.selectNextTab(true,true); 
-			if (ev.target==chkFromLogged) Gui.takeFocus(inpToProfile,ControlConstants.ByKeyboard);
-			if (ev.target==chkToLogged) Gui.takeFocus(txtMission,ControlConstants.ByKeyboard);
+		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.EXITED) {
+			pnlTab.selectNextTab(true, true);
+			if (ev.target == chkFromLogged)
+				Gui.takeFocus(inpToProfile, ControlConstants.ByKeyboard);
+			if (ev.target == chkToLogged)
+				Gui.takeFocus(txtMission, ControlConstants.ByKeyboard);
 		}
 		// The user closed the travelbugs screen
-		if (ev instanceof FormEvent &amp;&amp; ev.type==FormEvent.CLOSED  &amp;&amp; chD!=null) {
+		if (ev instanceof FormEvent &amp;&amp; ev.type == FormEvent.CLOSED &amp;&amp; chD != null) {
 			tblMyTravelbugJourneys.saveTravelbugsFile();
 			tblMyTravelbugJourneys.clear();
 			// Save the flag about showing non-logged journeys only
-			boolean old=Global.getPref().travelbugShowOnlyNonLogged;
-			Global.getPref().travelbugShowOnlyNonLogged=(tcTbJourneyList.mnuToggleList.modifiers &amp; MenuItem.Checked) == MenuItem.Checked;
-			String travelbugColWidth=modTbJourneyList.getColWidths();
+			boolean old = Global.getPref().travelbugShowOnlyNonLogged;
+			Global.getPref().travelbugShowOnlyNonLogged = (tcTbJourneyList.mnuToggleList.modifiers &amp; MenuItem.Checked) == MenuItem.Checked;
+			String travelbugColWidth = modTbJourneyList.getColWidths();
 			// If the preferences changed, save the pref.xml file
 			Vm.showWait(true);
-			if (!Global.getPref().travelbugColWidth.equals(travelbugColWidth) ||
-				old!=Global.getPref().travelbugShowOnlyNonLogged) {
-				Global.getPref().travelbugColWidth=travelbugColWidth;
+			if (!Global.getPref().travelbugColWidth.equals(travelbugColWidth) || old != Global.getPref().travelbugShowOnlyNonLogged) {
+				Global.getPref().travelbugColWidth = travelbugColWidth;
 				Global.getPref().savePreferences();
 			}
 			// If the list of travelbugs in the cache was modified, we need to save the cache too
 			if (chDmodified) {
-				ch.setHas_bugs(chD.Travelbugs.size()&gt;0);
+				ch.setHas_bugs(chD.Travelbugs.size() &gt; 0);
 				ch.save();
 			}
 			Vm.showWait(false);
-			chD=null;
+			chD = null;
 		}
 		updateNumBugs();
-		currentControl=Gui.focusedControl();
+		currentControl = Gui.focusedControl();
 	}
-	
-	
-//==============================================================
-// tbListTableModel
-//==============================================================
-class tbListTableModel extends TableModel {
-	private FontMetrics fm;
-	private Image imgRed;
-	tbListTableModel() {
-		
-		fillToEqualHeights=true;
-		allRowsSameSize=true;
-		hasRowHeaders=false;
-		//shadeAlternateRows=true;
-		cursorSize=new Dimension(12,1);
-		clipData=true;
-		fm=getFontMetrics();
-		// A red dot indicates that the journey has not been completely logged
-		imgRed = new Image(&quot;red.png&quot;);
-	}
-    private int colWidth[];
-	private int columnMap[];
-	
-	public Object getCellText(int row, int col) {
-		return null;
-	}
 
-	public Object getCellData(int row, int col){
-		if(row == -1){
-			return TravelbugJourney.getElementNameByNumber(columnMap[col]);
-		} else {
-			int map=columnMap[col];
-			// If we have not yet logged the from or the to, a red dot is placed in front of the first item
-			if (col==0 &amp;&amp; (!tblMyTravelbugJourneys.getTBJourney(row).getFromLogged() ||
-				!tblMyTravelbugJourneys.getTBJourney(row).getToLogged())) { 
-				// Is it a column with a checkbox?
-				if (map!=7 &amp;&amp; map!=11) 
-					return new IconAndText((IImage)imgRed,(String) tblMyTravelbugJourneys.getTBJourney(row).getElementByNumber(map),fm);
-				else { // Checkbox - special treatment
-					IconAndText iat=new IconAndText(imgRed,&quot;&quot;,fm);
-					iat.addColumn(tblMyTravelbugJourneys.getTBJourney(row).getElementByNumber(map));
-					return iat;
-				}
-			} else 
-				return tblMyTravelbugJourneys.getTBJourney(row).getElementByNumber(map);
-		}	
-	}
-	public int calculateRowHeight(int row) {
-		return charHeight+2;
-	}
-	
-	public int calculateColWidth(int col){
-		if(col == -1) 
-        	return 0;
-        else if (col&lt;numCols)
-        	return colWidth[columnMap[col]];
-        else return 0;
-	}
-	
-	public TableCellAttributes getCellAttributes(int row,int col,boolean isSelected,TableCellAttributes ta) {
-		ta=super.getCellAttributes(row,col,isSelected,ta);
-		ta.alignment = CellConstants.LEFT;
-		ta.anchor = CellConstants.LEFT;
-		// Color the elements red, if we have not yet logged
-		if (row&gt;=0)
-		switch (columnMap[col]) {
-		case 6: // fromDate
-				if (!tblMyTravelbugJourneys.getTBJourney(row).getFromLogged()) ta.foreground=RED;
-				break;
-		case 10: // toDate
-				if (!tblMyTravelbugJourneys.getTBJourney(row).getToLogged()) ta.foreground=RED;
-				break;
+	// ==============================================================
+	// tbListTableModel
+	// ==============================================================
+	class tbListTableModel extends TableModel {
+		private FontMetrics fm;
+		private Image imgRed;
+
+		tbListTableModel() {
+
+			fillToEqualHeights = true;
+			allRowsSameSize = true;
+			hasRowHeaders = false;
+			// shadeAlternateRows=true;
+			cursorSize = new Dimension(12, 1);
+			clipData = true;
+			fm = getFontMetrics();
+			// A red dot indicates that the journey has not been completely logged
+			imgRed = new Image(&quot;red.png&quot;);
 		}
-		return ta;
-	}
 
-	private void showFields(TravelbugJourney tbj) {
-	   	inpName.setText(tbj.getTb().getName());
-		inpTrackingNo.setText(tbj.getTb().getTrackingNo());
-		lblId.setText(tbj.getTb().getGuid());
-		inpFromProfile.setText(tbj.getFromProfile());
-		inpFromWaypoint.setText(tbj.getFromWaypoint());
-		inpFromDate.setText(tbj.getFromDate());
-		chkFromLogged.setState(tbj.getFromLogged());
-		inpToProfile.setText(tbj.getToProfile());
-		inpToWaypoint.setText(tbj.getToWaypoint());
-		inpToDate.setText(tbj.getToDate());
-		chkToLogged.setState(tbj.getToLogged());
-		txtMission.setHtml(tbj.getTb().getMission());
-	}
-	
-	private boolean sortAsc=false;
-	private int sortedBy = -1;
-	private int lastRow=-1;
-	public int penEventModifiers; 
+		private int colWidth[];
+		private int columnMap[];
 
-	public boolean penPressed(Point onTable,Point cell){
-		boolean retval=false;
-		if(cell!=null &amp;&amp; cell.y == -1){ // Hit a header =&gt; sort the table accordingly
-			Vm.showWait(true);
-			if (cell.x == sortedBy) sortAsc=!sortAsc;
-			else sortAsc = false;
-			sortedBy = cell.x;
-			// Check whether the list only shows non-logged journeys. If so, a subset
-			// of the table must be sorted
-			if ((tcTbJourneyList.mnuToggleList.modifiers &amp; MenuItem.Checked) == MenuItem.Checked) {
-				tblMyTravelbugJourneys.sortFirstHalf(columnMap[cell.x], sortAsc,modTbJourneyList.numRows);
-			} else { // Showing all journeys - sort the full table
-				tblMyTravelbugJourneys.sort(columnMap[cell.x], sortAsc);
+		public Object getCellText(int row, int col) {
+			return null;
+		}
+
+		public Object getCellData(int row, int col) {
+			if (row == -1) {
+				return TravelbugJourney.getElementNameByNumber(columnMap[col]);
+			} else {
+				int map = columnMap[col];
+				// If we have not yet logged the from or the to, a red dot is placed in front of the first item
+				if (col == 0 &amp;&amp; (!tblMyTravelbugJourneys.getTBJourney(row).getFromLogged() || !tblMyTravelbugJourneys.getTBJourney(row).getToLogged())) {
+					// Is it a column with a checkbox?
+					if (map != 7 &amp;&amp; map != 11)
+						return new IconAndText((IImage) imgRed, (String) tblMyTravelbugJourneys.getTBJourney(row).getElementByNumber(map), fm);
+					else { // Checkbox - special treatment
+						IconAndText iat = new IconAndText(imgRed, &quot;&quot;, fm);
+						iat.addColumn(tblMyTravelbugJourneys.getTBJourney(row).getElementByNumber(map));
+						return iat;
+					}
+				} else
+					return tblMyTravelbugJourneys.getTBJourney(row).getElementByNumber(map);
 			}
-			tcTbJourneyList.repaint();
-			Vm.showWait(false);
-			retval = true;
-		} else if (cell!=null &amp;&amp; cell.y&gt;=0 &amp;&amp; (penEventModifiers &amp; IKeys.SHIFT)&gt;0) {
-			// A range of rows can be marked by shift-click on the first and last row
-			if (lastRow!=-1) { // Second row being marked with shift key pressed
-				if (lastRow&lt;cell.y)
-					toggleSelect(lastRow,cell.y);
-				else
-					toggleSelect(cell.y,lastRow);
-				lastRow=-1;
-				retval=true;
-			} else { // Remember this row as start of range, but don't toggle yet
-				lastRow=cell.y;
-			}
-		} else { // Single row marked
-			lastRow=-1;
 		}
-		return retval;
-	}
 
-	/** Select a range of rows */
-	private void toggleSelect(int fromRow, int toRow) {
-		tcTbJourneyList.clearSelection(null);
-		tcTbJourneyList.addToSelection(new Rect(0,fromRow,numCols,toRow-fromRow+1),false,true);
-	}
-	
-	/**
-	 * Return the column widths as a comma delimited string for storing in the preferences
-	 * @return
-	 */
-	private String getColWidths() {
-		// Update the list with the current widths
-		for (int col=0; col&lt;numCols; col++) {
-			colWidth[columnMap[col]]=getColWidth(col);
+		public int calculateRowHeight(int row) {
+			return charHeight + 2;
 		}
-		// Convert to string
-		StringBuffer sb=new StringBuffer(40);
-		for (int i=0; i&lt;colWidth.length; i++) {
-			if (sb.length()!=0) sb.append(',');
-			sb.append(colWidth[i]);
-		}
-		return sb.toString();
-	}
-}
 
-//==============================================================
-//tbListControl
-//==============================================================
-class tbListControl extends TableControl {
-	private MenuItem mnuNewTB, mnuDeleteTB,mnuGetMission,mnuOpenOnline,mnuDropTB,mnuPickupTB,mnuDeleteTBs;
-	public MenuItem mnuToggleList;
-	private Menu mnuFullMenu,mnuDeleteMenu;
-	
-	tbListControl() {
-		MenuItem[] TBMenuItems=new MenuItem[10];
-		TBMenuItems[0]= mnuPickupTB = new MenuItem(MyLocale.getMsg(6040,&quot;Pick up TB from current cache&quot;));
-		TBMenuItems[1]= mnuDropTB = new MenuItem(MyLocale.getMsg(6041,&quot;Drop TB in cache&quot;));
-		TBMenuItems[2]= new MenuItem(&quot;-&quot;);
-		TBMenuItems[3]= mnuNewTB = new MenuItem(MyLocale.getMsg(6042,&quot;New Travelbug&quot;));
-		TBMenuItems[4]= mnuDeleteTB = new MenuItem(MyLocale.getMsg(6043,&quot;Delete Travelbug&quot;));
-		TBMenuItems[5]= new MenuItem(&quot;-&quot;);
-		TBMenuItems[6]= mnuGetMission = new MenuItem(MyLocale.getMsg(6044,&quot;Get Mission&quot;));
-		TBMenuItems[7]= mnuOpenOnline = new MenuItem(MyLocale.getMsg(6045,&quot;Open on-line&quot;));
-		TBMenuItems[8]= new MenuItem(&quot;-&quot;);
-		TBMenuItems[9]= mnuToggleList = new MenuItem(MyLocale.getMsg(6046,&quot;Show only not logged&quot;));
-		mnuFullMenu=new Menu(TBMenuItems,&quot;&quot;);
-		// A second pop-up menu with only one entry, if a range of rows is selected
-		MenuItem[] TBMenuItemsDel=new MenuItem[1];
-		TBMenuItemsDel[0]=mnuDeleteTBs=new MenuItem(MyLocale.getMsg(6047,&quot;Delete selected Travelbugs&quot;));
-		mnuDeleteMenu=new Menu(TBMenuItemsDel,&quot;&quot;);
-		mnuDropTB.modifiers|=MenuItem.Disabled;
-		mnuDeleteTB.modifiers|=MenuItem.Disabled;
-		mnuGetMission.modifiers|=MenuItem.Disabled;
-		mnuOpenOnline.modifiers|=MenuItem.Disabled;
-	}
-	
-	public void onEvent(Event ev) {
-		Rect sel=getSelection(null);
-		if (sel.y&lt;tblMyTravelbugJourneys.size()) {
-			mnuDeleteTB.modifiers&amp;=~MenuItem.Disabled;
-			mnuGetMission.modifiers&amp;=~MenuItem.Disabled;
-			mnuOpenOnline.modifiers&amp;=~MenuItem.Disabled;
-			if (tblMyTravelbugJourneys.getTBJourney(sel.y).inMyPosession()) 
-				mnuDropTB.modifiers&amp;=~MenuItem.Disabled;
+		public int calculateColWidth(int col) {
+			if (col == -1)
+				return 0;
+			else if (col &lt; numCols)
+				return colWidth[columnMap[col]];
 			else
-				mnuDropTB.modifiers|=MenuItem.Disabled;
-		} else {
-			mnuDeleteTB.modifiers|=MenuItem.Disabled;
-			mnuGetMission.modifiers|=MenuItem.Disabled;
-			mnuOpenOnline.modifiers|=MenuItem.Disabled;
+				return 0;
 		}
-		// If more than one row is selected, show the limited pop-up menu
-		if (sel.height&gt;1)
-			setMenu(mnuDeleteMenu);
-		else
-			setMenu(mnuFullMenu);
-	    if (ev instanceof PenEvent) modTbJourneyList.penEventModifiers=((PenEvent)ev).modifiers;
-		super.onEvent(ev);
-	}
 
-	public void penRightReleased(Point p){
-		menuState.doShowMenu(p,true,null); // direct call (not through doMenu) is neccesary because it will exclude the whole table
-	}
+		public TableCellAttributes getCellAttributes(int row, int col, boolean isSelected, TableCellAttributes ta) {
+			ta = super.getCellAttributes(row, col, isSelected, ta);
+			ta.alignment = CellConstants.LEFT;
+			ta.anchor = CellConstants.LEFT;
+			// Color the elements red, if we have not yet logged
+			if (row &gt;= 0)
+				switch (columnMap[col]) {
+				case 6: // fromDate
+					if (!tblMyTravelbugJourneys.getTBJourney(row).getFromLogged())
+						ta.foreground = RED;
+					break;
+				case 10: // toDate
+					if (!tblMyTravelbugJourneys.getTBJourney(row).getToLogged())
+						ta.foreground = RED;
+					break;
+				}
+			return ta;
+		}
 
-	public void penHeld(Point p){
-		menuState.doShowMenu(p,true,null); 
-	}
+		private void showFields(TravelbugJourney tbj) {
+			inpName.setText(tbj.getTb().getName());
+			inpTrackingNo.setText(tbj.getTb().getTrackingNo());
+			lblId.setText(tbj.getTb().getGuid());
+			inpFromProfile.setText(tbj.getFromProfile());
+			inpFromWaypoint.setText(tbj.getFromWaypoint());
+			inpFromDate.setText(tbj.getFromDate());
+			chkFromLogged.setState(tbj.getFromLogged());
+			inpToProfile.setText(tbj.getToProfile());
+			inpToWaypoint.setText(tbj.getToWaypoint());
+			inpToDate.setText(tbj.getToDate());
+			chkToLogged.setState(tbj.getToLogged());
+			txtMission.setHtml(tbj.getTb().getMission());
+		}
 
-	public void popupMenuEvent(Object selectedItem){
-		if (selectedItem==mnuPickupTB) {
-			Travelbug tb=TravelbugPickup.pickupTravelbug(tblSrcCache);	
-			if (tb!=null) {
-				chDmodified=true;
-				tblMyTravelbugJourneys.addTbPickup(tb,Global.getProfile().name,waypoint);
-				modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
+		private boolean sortAsc = false;
+		private int sortedBy = -1;
+		private int lastRow = -1;
+		public int penEventModifiers;
+
+		public boolean penPressed(Point onTable, Point cell) {
+			boolean retval = false;
+			if (cell != null &amp;&amp; cell.y == -1) { // Hit a header =&gt; sort the table accordingly
+				Vm.showWait(true);
+				if (cell.x == sortedBy)
+					sortAsc = !sortAsc;
+				else
+					sortAsc = false;
+				sortedBy = cell.x;
+				// Check whether the list only shows non-logged journeys. If so, a subset
+				// of the table must be sorted
+				if ((tcTbJourneyList.mnuToggleList.modifiers &amp; MenuItem.Checked) == MenuItem.Checked) {
+					tblMyTravelbugJourneys.sortFirstHalf(columnMap[cell.x], sortAsc, modTbJourneyList.numRows);
+				} else { // Showing all journeys - sort the full table
+					tblMyTravelbugJourneys.sort(columnMap[cell.x], sortAsc);
+				}
 				tcTbJourneyList.repaint();
+				Vm.showWait(false);
+				retval = true;
+			} else if (cell != null &amp;&amp; cell.y &gt;= 0 &amp;&amp; (penEventModifiers &amp; IKeys.SHIFT) &gt; 0) {
+				// A range of rows can be marked by shift-click on the first and last row
+				if (lastRow != -1) { // Second row being marked with shift key pressed
+					if (lastRow &lt; cell.y)
+						toggleSelect(lastRow, cell.y);
+					else
+						toggleSelect(cell.y, lastRow);
+					lastRow = -1;
+					retval = true;
+				} else { // Remember this row as start of range, but don't toggle yet
+					lastRow = cell.y;
+				}
+			} else { // Single row marked
+				lastRow = -1;
 			}
+			return retval;
 		}
-		if (selectedItem==mnuDropTB) {
-			if (selectedRow&gt;=0 &amp;&amp; selectedRow&lt;modTbJourneyList.numRows) {
-				Travelbug tb=tblMyTravelbugJourneys.getTBJourney(selectedRow).getTb();
-				chD.Travelbugs.add(tb);
-				tblMyTravelbugJourneys.addTbDrop(tb,Global.getProfile().name,waypoint);
-				chDmodified=true;
-				ch.setHas_bugs(true);
+
+		/** Select a range of rows */
+		private void toggleSelect(int fromRow, int toRow) {
+			tcTbJourneyList.clearSelection(null);
+			tcTbJourneyList.addToSelection(new Rect(0, fromRow, numCols, toRow - fromRow + 1), false, true);
+		}
+
+		/**
+		 * Return the column widths as a comma delimited string for storing in the preferences
+		 * 
+		 * @return
+		 */
+		private String getColWidths() {
+			// Update the list with the current widths
+			for (int col = 0; col &lt; numCols; col++) {
+				colWidth[columnMap[col]] = getColWidth(col);
 			}
-			repaint();
+			// Convert to string
+			StringBuffer sb = new StringBuffer(40);
+			for (int i = 0; i &lt; colWidth.length; i++) {
+				if (sb.length() != 0)
+					sb.append(',');
+				sb.append(colWidth[i]);
+			}
+			return sb.toString();
 		}
-		if (selectedItem==mnuNewTB) {
-			TravelbugJourney tbj=new TravelbugJourney(&quot;New&quot;);
-			tbj.setFromProfile(Global.getProfile().name);
-			tbj.setFromWaypoint(waypoint);
-			tblMyTravelbugJourneys.add(tbj);
-			modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
-			cursorTo(tblMyTravelbugJourneys.size()-1,1,true);
-			tcTbJourneyList.repaint();
+	}
+
+	// ==============================================================
+	// tbListControl
+	// ==============================================================
+	class tbListControl extends TableControl {
+		private MenuItem mnuNewTB, mnuDeleteTB, mnuGetMission, mnuOpenOnline, mnuDropTB, mnuPickupTB, mnuDeleteTBs;
+		public MenuItem mnuToggleList;
+		private Menu mnuFullMenu, mnuDeleteMenu;
+
+		tbListControl() {
+			MenuItem[] TBMenuItems = new MenuItem[10];
+			TBMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(6040, &quot;Pick up TB from current cache&quot;));
+			TBMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6041, &quot;Drop TB in cache&quot;));
+			TBMenuItems[2] = new MenuItem(&quot;-&quot;);
+			TBMenuItems[3] = mnuNewTB = new MenuItem(MyLocale.getMsg(6042, &quot;New Travelbug&quot;));
+			TBMenuItems[4] = mnuDeleteTB = new MenuItem(MyLocale.getMsg(6043, &quot;Delete Travelbug&quot;));
+			TBMenuItems[5] = new MenuItem(&quot;-&quot;);
+			TBMenuItems[6] = mnuGetMission = new MenuItem(MyLocale.getMsg(6044, &quot;Get Mission&quot;));
+			TBMenuItems[7] = mnuOpenOnline = new MenuItem(MyLocale.getMsg(6045, &quot;Open on-line&quot;));
+			TBMenuItems[8] = new MenuItem(&quot;-&quot;);
+			TBMenuItems[9] = mnuToggleList = new MenuItem(MyLocale.getMsg(6046, &quot;Show only not logged&quot;));
+			mnuFullMenu = new Menu(TBMenuItems, &quot;&quot;);
+			// A second pop-up menu with only one entry, if a range of rows is selected
+			MenuItem[] TBMenuItemsDel = new MenuItem[1];
+			TBMenuItemsDel[0] = mnuDeleteTBs = new MenuItem(MyLocale.getMsg(6047, &quot;Delete selected Travelbugs&quot;));
+			mnuDeleteMenu = new Menu(TBMenuItemsDel, &quot;&quot;);
+			mnuDropTB.modifiers |= MenuItem.Disabled;
+			mnuDeleteTB.modifiers |= MenuItem.Disabled;
+			mnuGetMission.modifiers |= MenuItem.Disabled;
+			mnuOpenOnline.modifiers |= MenuItem.Disabled;
 		}
-		if (selectedItem==mnuDeleteTB &amp;&amp; selectedRow&gt;=0) {
-			tblMyTravelbugJourneys.remove(selectedRow);
-			modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
-			if (selectedRow&gt;0) 
-				cursorTo(selectedRow-1,0,true);
+
+		public void onEvent(Event ev) {
+			Rect sel = getSelection(null);
+			if (sel.y &lt; tblMyTravelbugJourneys.size()) {
+				mnuDeleteTB.modifiers &amp;= ~MenuItem.Disabled;
+				mnuGetMission.modifiers &amp;= ~MenuItem.Disabled;
+				mnuOpenOnline.modifiers &amp;= ~MenuItem.Disabled;
+				if (tblMyTravelbugJourneys.getTBJourney(sel.y).inMyPosession())
+					mnuDropTB.modifiers &amp;= ~MenuItem.Disabled;
+				else
+					mnuDropTB.modifiers |= MenuItem.Disabled;
+			} else {
+				mnuDeleteTB.modifiers |= MenuItem.Disabled;
+				mnuGetMission.modifiers |= MenuItem.Disabled;
+				mnuOpenOnline.modifiers |= MenuItem.Disabled;
+			}
+			// If more than one row is selected, show the limited pop-up menu
+			if (sel.height &gt; 1)
+				setMenu(mnuDeleteMenu);
 			else
-				modTbJourneyList.showFields(new TravelbugJourney(&quot;&quot;));
-			tcTbJourneyList.repaint();
+				setMenu(mnuFullMenu);
+			if (ev instanceof PenEvent)
+				modTbJourneyList.penEventModifiers = ((PenEvent) ev).modifiers;
+			super.onEvent(ev);
 		}
-		/* Delete a group of travelbugs which have been marked with Shift-Click */
-		if (selectedItem==mnuDeleteTBs) {  
-			Rect sel=getSelection(null);
-			for (int i=0; i&lt;sel.height; i++)
-				tblMyTravelbugJourneys.remove(sel.y);
-			modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
-			if (sel.y&lt;modTbJourneyList.numRows) 
-				cursorTo(sel.y,0,true);
-			else
-				modTbJourneyList.showFields(new TravelbugJourney(&quot;&quot;));
-			tcTbJourneyList.repaint();
+
+		public void penRightReleased(Point p) {
+			menuState.doShowMenu(p, true, null); // direct call (not through doMenu) is neccesary because it will exclude the whole table
 		}
-		if (selectedItem==mnuGetMission &amp;&amp; selectedRow&gt;-1) {
-			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
-			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile());
-			Vm.showWait(true);
-			
-			//if we have an ID, get mission by ID
-			if (tbj.getTb().getGuid().length()!=0) {
-				tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
-			} else {
-				//try to get mission and name by tracking number
-				boolean suceeded = false;
-				if (tbj.getTb().getTrackingNo().length() != 0) {
-					suceeded = spider.getBugMissionAndNameByTrackNr(tbj.getTb());
+
+		public void penHeld(Point p) {
+			menuState.doShowMenu(p, true, null);
+		}
+
+		public void popupMenuEvent(Object selectedItem) {
+			if (selectedItem == mnuPickupTB) {
+				Travelbug tb = TravelbugPickup.pickupTravelbug(tblSrcCache);
+				if (tb != null) {
+					chDmodified = true;
+					tblMyTravelbugJourneys.addTbPickup(tb, Global.getProfile().name, waypoint);
+					modTbJourneyList.numRows = tblMyTravelbugJourneys.size();
+					tcTbJourneyList.repaint();
 				}
-				//if this has't worked, try to get ID by name
-				if (!suceeded) {
-					tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName().trim()));
-					//if we have an ID now, get mission by ID
-					if (tbj.getTb().getGuid().length()!=0) {
-						tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
+			}
+			if (selectedItem == mnuDropTB) {
+				if (selectedRow &gt;= 0 &amp;&amp; selectedRow &lt; modTbJourneyList.numRows) {
+					Travelbug tb = tblMyTravelbugJourneys.getTBJourney(selectedRow).getTb();
+					chD.Travelbugs.add(tb);
+					tblMyTravelbugJourneys.addTbDrop(tb, Global.getProfile().name, waypoint);
+					chDmodified = true;
+					ch.setHas_bugs(true);
+				}
+				repaint();
+			}
+			if (selectedItem == mnuNewTB) {
+				TravelbugJourney tbj = new TravelbugJourney(&quot;New&quot;);
+				tbj.setFromProfile(Global.getProfile().name);
+				tbj.setFromWaypoint(waypoint);
+				tblMyTravelbugJourneys.add(tbj);
+				modTbJourneyList.numRows = tblMyTravelbugJourneys.size();
+				cursorTo(tblMyTravelbugJourneys.size() - 1, 1, true);
+				tcTbJourneyList.repaint();
+			}
+			if (selectedItem == mnuDeleteTB &amp;&amp; selectedRow &gt;= 0) {
+				tblMyTravelbugJourneys.remove(selectedRow);
+				modTbJourneyList.numRows = tblMyTravelbugJourneys.size();
+				if (selectedRow &gt; 0)
+					cursorTo(selectedRow - 1, 0, true);
+				else
+					modTbJourneyList.showFields(new TravelbugJourney(&quot;&quot;));
+				tcTbJourneyList.repaint();
+			}
+			/* Delete a group of travelbugs which have been marked with Shift-Click */
+			if (selectedItem == mnuDeleteTBs) {
+				Rect sel = getSelection(null);
+				for (int i = 0; i &lt; sel.height; i++)
+					tblMyTravelbugJourneys.remove(sel.y);
+				modTbJourneyList.numRows = tblMyTravelbugJourneys.size();
+				if (sel.y &lt; modTbJourneyList.numRows)
+					cursorTo(sel.y, 0, true);
+				else
+					modTbJourneyList.showFields(new TravelbugJourney(&quot;&quot;));
+				tcTbJourneyList.repaint();
+			}
+			if (selectedItem == mnuGetMission &amp;&amp; selectedRow &gt; -1) {
+				TravelbugJourney tbj = tblMyTravelbugJourneys.getTBJourney(selectedRow);
+				SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+				Vm.showWait(true);
+
+				// if we have an ID, get mission by ID
+				if (tbj.getTb().getGuid().length() != 0) {
+					tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
+				} else {
+					// try to get mission and name by tracking number
+					boolean suceeded = false;
+					if (tbj.getTb().getTrackingNo().length() != 0) {
+						suceeded = spider.getBugMissionAndNameByTrackNr(tbj.getTb());
 					}
+					// if this has't worked, try to get ID by name
+					if (!suceeded) {
+						tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName().trim()));
+						// if we have an ID now, get mission by ID
+						if (tbj.getTb().getGuid().length() != 0) {
+							tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
+						}
+					}
 				}
+
+				Vm.showWait(false);
+				tcTbJourneyList.repaint();
+				txtMission.setHtml(tbj.getTb().getMission());
+				inpName.setText(tbj.getTb().getName());
+				lblId.setText(tbj.getTb().getGuid());
+				lowerpane.repaint();
+				Global.getPref().setOldGCLanguage();
 			}
-			
-			Vm.showWait(false);
-			tcTbJourneyList.repaint();
-			txtMission.setHtml(tbj.getTb().getMission());
-			inpName.setText(tbj.getTb().getName());
-			lblId.setText(tbj.getTb().getGuid());
-			lowerpane.repaint();
-		}
-		if (selectedItem==mnuOpenOnline &amp;&amp; selectedRow&gt;=0) {
-			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
-			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile());
-			Vm.showWait(true);
-			// First check whether ID is set, if not get it
-			if (tbj.getTb().getGuid().length()==0) tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName()));
-			if (tbj.getTb().getGuid().length()!=0) {
-				Vm.showWait(false);
-				try {
-					String s;
-					if (tbj.getTb().getGuid().length()&gt;10)
-						s = &quot;<A HREF="http://www.geocaching.com/track/details.aspx?guid=">http://www.geocaching.com/track/details.aspx?guid=</A>&quot;+tbj.getTb().getGuid();
-					else
-						s = &quot;<A HREF="http://www.geocaching.com/track/details.aspx?id=">http://www.geocaching.com/track/details.aspx?id=</A>&quot;+tbj.getTb().getGuid();
+			if (selectedItem == mnuOpenOnline &amp;&amp; selectedRow &gt;= 0) {
+				TravelbugJourney tbj = tblMyTravelbugJourneys.getTBJourney(selectedRow);
+				SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+				Vm.showWait(true);
+				// First check whether ID is set, if not get it
+				if (tbj.getTb().getGuid().length() == 0)
+					tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName()));
+				if (tbj.getTb().getGuid().length() != 0) {
+					Vm.showWait(false);
+					try {
+						String s;
+						if (tbj.getTb().getGuid().length() &gt; 10)
+							s = &quot;<A HREF="http://www.geocaching.com/track/details.aspx?guid=">http://www.geocaching.com/track/details.aspx?guid=</A>&quot; + tbj.getTb().getGuid();
+						else
+							s = &quot;<A HREF="http://www.geocaching.com/track/details.aspx?id=">http://www.geocaching.com/track/details.aspx?id=</A>&quot; + tbj.getTb().getGuid();
 
-					CWWrapper.exec(Global.getPref().browser, s);
-					Global.getPref().log(&quot;Executed: \&quot;&quot;+Global.getPref().browser+&quot;\&quot; \&quot;&quot;+s+&quot;\&quot;&quot;);
-				} catch (Exception ioex) {
-					// Global.getPref().log(&quot;Ignored Exception&quot;, ioex, true);
+						CWWrapper.exec(Global.getPref().browser, s);
+						Global.getPref().log(&quot;Executed: \&quot;&quot; + Global.getPref().browser + &quot;\&quot; \&quot;&quot; + s + &quot;\&quot;&quot;);
+					} catch (Exception ioex) {
+						// Global.getPref().log(&quot;Ignored Exception&quot;, ioex, true);
+					}
 				}
+				Global.getPref().setOldGCLanguage();
 			}
+			if (selectedItem == mnuToggleList) {
+				toggleNonLogged();
+			}
+			updateNumBugs();
 		}
-		if (selectedItem==mnuToggleList) {
-			toggleNonLogged();
+
+		/** Toggle between displaying all journeys or just those which still need to be logged */
+		public void toggleNonLogged() {
+			mnuToggleList.modifiers ^= MenuItem.Checked;
+			if ((mnuToggleList.modifiers &amp; MenuItem.Checked) == MenuItem.Checked) {
+				// First sort the non-logged items to the top
+				tblMyTravelbugJourneys.sort(TravelbugJourney.BOTHLOGGED, false);
+				// modListTable.numRows=tblMyTravelbugJourneys.size();
+				modTbJourneyList.numRows = tblMyTravelbugJourneys.countNonLogged();
+			} else {
+				modTbJourneyList.numRows = tblMyTravelbugJourneys.size();
+			}
+			tcTbJourneyList.repaint();
 		}
-		updateNumBugs();
-	}
-	
-	/** Toggle between displaying all journeys or just those which still need to be logged */
-	public void toggleNonLogged() {
-		mnuToggleList.modifiers^=MenuItem.Checked;
-		if ((mnuToggleList.modifiers &amp; MenuItem.Checked) == MenuItem.Checked) {
-			// First sort the non-logged items to the top
-			tblMyTravelbugJourneys.sort(TravelbugJourney.BOTHLOGGED, false);
-			// 		modListTable.numRows=tblMyTravelbugJourneys.size();
-			modTbJourneyList.numRows=tblMyTravelbugJourneys.countNonLogged();
-		} else {
-			modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
+
+		public void cursorTo(int row, int col, boolean selectNew) {
+			super.cursorTo(row, col, selectNew);
+			selectedRow = row;
+			if (row &gt;= 0) {
+				modTbJourneyList.showFields(tblMyTravelbugJourneys.getTBJourney(row));
+			} else {
+				modTbJourneyList.showFields(new TravelbugJourney(&quot;&quot;));
+			}
 		}
-		tcTbJourneyList.repaint();
 	}
-	
-	
-	public void cursorTo(int row,int col,boolean selectNew) {
-		super.cursorTo(row,col,selectNew);
-		selectedRow=row;
-		if (row&gt;=0) { 
-			modTbJourneyList.showFields(tblMyTravelbugJourneys.getTBJourney(row));
-		} else {
-			modTbJourneyList.showFields(new TravelbugJourney(&quot;&quot;));
-		}
-	}
-}
 
 }

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -255,9 +255,11 @@
 				dest = n;
 			}
 			char c = what[i];
+			// removed || c == '&amp;'
+			// added || c == '$' || c == '/' || c == ','
 			if (spaceToPlus &amp;&amp; c == ' ')
 				c = '+';
-			else if (c &lt;= ' ' || c &gt;= 127 || c == '+' || c == '&amp;' || c == '%' || c == '=' || c == '|' || c == '{' || c == '}' || c == '$' || c == '/') {
+			else if (c &lt;= ' ' || c &gt;= 127 || c == '+' || c == '%' || c == '=' || c == '|' || c == '{' || c == '}' || c == '$' || c == '/' || c == ',') {
 				dest[d++] = '%';
 				dest[d++] = hex.charAt((c &gt;&gt; 4) &amp; 0xf);
 				dest[d++] = hex.charAt(c &amp; 0xf);

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -142,17 +142,10 @@
 	private static String propFirstPage2;
 	private static String propFirstPageFinds;
 	private static String gotoNextPage = &quot;ctl00$ContentBody$pgrTop$ctl08&quot;;
-	private static String gotoNextBlock = &quot;ctl00$ContentBody$pgrTop$ctl06&quot;; // change
-																			// to
-																			// the
-																			// block
-																			// (10pages)
-																			// of
-																			// the
-																			// wanted
-																			// page
-	private static String gotoPage = &quot;ctl00$ContentBody$pgrTop$lbGoToPage_&quot;; // add
-																				// pagenumber
+	// change to the block (10pages) of the wanted page
+	private static String gotoNextBlock = &quot;ctl00$ContentBody$pgrTop$ctl06&quot;;
+	// add pagenumber
+	private static String gotoPage = &quot;ctl00$ContentBody$pgrTop$lbGoToPage_&quot;;
 	private static String propMaxDistance;
 	private static String propShowOnlyFound;
 	private static Regex RexPropListBlock;
@@ -545,7 +538,7 @@
 				ch.initStates(false);
 		}
 
-		double halfSideLength = maxDistance; // halbe Seitenl&#228;nge eines Quadrats
+		double halfSideLength = maxDistance; // halbe Seitenl&#195;&#164;nge eines Quadrats
 												// ums Zentrum in km
 		if (pref.metricSystem == Metrics.IMPERIAL) {
 			halfSideLength = Metrics.convertUnit(maxDistance, Metrics.MILES, Metrics.KILOMETER);
@@ -1130,7 +1123,7 @@
 			if (loggedIn)
 				return FormBase.IDOK;
 			else {
-				(new MessageBox(&quot;Login&quot;, &quot;Check UserID in preferences | Einstellungen, or check GC-Language. Must be English.&quot;, FormBase.OKB)).execute();
+				(new MessageBox(&quot;Login&quot;, &quot;Check UserID in preferences | Einstellungen.&quot;, FormBase.OKB)).execute();
 				return ERR_LOGIN;
 			}
 		} else {
@@ -1290,7 +1283,7 @@
 
 	private boolean switchToEnglish() {
 		// change language to EN , further operations relay on English
-		String url = &quot;<A HREF="http://www.geocaching.com/">http://www.geocaching.com/</A>&quot;;
+		String url = &quot;<A HREF="http://www.geocaching.com/default.aspx">http://www.geocaching.com/default.aspx</A>&quot;;
 		String page = &quot;&quot;;
 		String loggedInEnglish = &quot;&gt;Sign Out&lt;&quot;;
 		String userID = &quot;userid=&quot; + pref.userID;
@@ -1328,31 +1321,23 @@
 		}
 		if (page.indexOf(loggedInEnglish) &gt; -1) {
 			pref.log(&quot;already English&quot;);
+			pref.oldLanguageCtl = &quot;&quot;; // nothing to reset
 			return true;
 		}
-
-		// todo next doesn't work correct don't know why
 		// switch to english now goes into gc account Display Preferences (is permanent, must be reset)
-		final Regex rexViewstate = new Regex(&quot;id=\&quot;__VIEWSTATE\&quot; value=\&quot;(.*?)\&quot; /&gt;&quot;);
-		String viewstate = &quot;&quot;;
-		rexViewstate.search(page);
-		if (rexViewstate.didMatch()) {
-			viewstate = rexViewstate.stringMatched(1);
-		} else
-			return false;
-		final String strEnglishPage = &quot;ctl00$uxLocaleList$uxLocaleList$ctl01$uxLocaleItem&quot;;
-		String postStr = &quot;__EVENTTARGET=&quot; + UrlFetcher.encodeURL(strEnglishPage, false) + &quot;&amp;__EVENTARGUMENT=&quot; + &quot;&amp;__VIEWSTATE=&quot; + UrlFetcher.encodeURL(viewstate, false);
-		// postStr += UrlFetcher.encodeURL(&quot;&amp;ctl00$ContentBody$tbSearch=postal code, country, etc.&quot;, true);
+		String languages[] = { &quot;English&quot;, &quot;Deutsch&quot;, &quot;Fran&#195;&#167;ais&quot;, &quot;Portugu&#195;&#170;s&quot;, &quot;&#196;&#140;e&#197;&#161;tina&quot;, &quot;Svenska&quot;, &quot;Nederlands&quot;, &quot;Catal&#195;&#160;&quot;, &quot;Polski&quot;, &quot;Eesti&quot;, &quot;Norsk, Bokm&#195;&#165;l&quot;, &quot;&#237;&#149;&#156;&#234;&#181;&#173;&#236;&#150;&#180;&quot;, &quot;Espa&#195;&#177;ol&quot; };
+		String oldLanguage = new Extractor(page, &quot;&lt;a href=\&quot;#\&quot;&gt;&quot;, &quot;&#9660;&lt;/a&gt;&quot;, 0, true).findNext();
+		for (int i = 0; i &lt; languages.length; i++) {
+			if (oldLanguage.equals(languages[i])) {
+				pref.oldLanguageCtl = url + &quot;?__EVENTTARGET=&quot; + UrlFetcher.encodeURL(&quot;ctl00$uxLocaleList$uxLocaleList$ctl&quot; + MyLocale.formatLong(i, &quot;00&quot;) + &quot;$uxLocaleItem&quot;, false);
+				break;
+			}
+		}
+		final String strEnglishPage = &quot;ctl00$uxLocaleList$uxLocaleList$ctl00$uxLocaleItem&quot;;
+		url += &quot;?__EVENTTARGET=&quot; + UrlFetcher.encodeURL(strEnglishPage, false);
 		try {
-			UrlFetcher.setpostData(postStr);
-			// UrlFetcher.setRequestorProperty(&quot;Referer&quot;, url);
-			// UrlFetcher.setRequestorProperty(&quot;Origin&quot;, &quot;<A HREF="http://www.geocaching.com">http://www.geocaching.com</A>&quot;);
-			// UrlFetcher.setRequestorProperty(&quot;Cache-Control&quot;, &quot;max-age=0&quot;);
-			// UrlFetcher.setRequestorProperty(&quot;Accept-Charset&quot;, &quot;ISO-8859-1,utf-8;q=0.7,*;q=0.3&quot;);
-			// UrlFetcher.setRequestorProperty(&quot;Accept-Language&quot;, &quot;de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4&quot;);
-			// cookie = &quot;company_history=%5B%5B%22http%3A//feedback.geocaching.com/geocaching%22%2C%22Geocaching%22%5D%5D; Send2GPS=garmin; __qca=P0-675333427-1299837942815; &quot; + cookie;
-			// UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;, cookie);
 			page = UrlFetcher.fetch(url);
+			// String s = new Extractor(page, &quot;&lt;a href=\&quot;#\&quot;&gt;&quot;, &quot;&#9660;&lt;/a&gt;&quot;, 0, true).findNext();
 			if (page.indexOf(loggedInEnglish) &gt; -1) {
 				pref.log(&quot;Switched to English&quot;);
 				return true;
@@ -1361,7 +1346,7 @@
 				return false;
 			}
 		} catch (final Exception ex) {
-			pref.log(&quot;Error switching to English: check &quot; + url + &quot; : &quot; + postStr, ex);
+			pref.log(&quot;Error switching to English: check &quot; + url, ex);
 			return false;
 		}
 
@@ -1547,7 +1532,7 @@
 				ch.initStates(false);
 		}
 
-		double halfSideLength = maxDistance; // halbe Seitenl&#228;nge eines Quadrats ums Zentrum in km
+		double halfSideLength = maxDistance; // halbe Seitenl&#195;&#164;nge eines Quadrats ums Zentrum in km
 		if (pref.metricSystem == Metrics.IMPERIAL) {
 			halfSideLength = Metrics.convertUnit(maxDistance, Metrics.MILES, Metrics.KILOMETER);
 		}
@@ -1930,8 +1915,8 @@
 			if (ret.indexOf(&quot;ere&quot;) &gt; -1)
 				return distanceAndDirection; // zur Zeit &quot; Here -1&quot;
 			// Versuch den DistanceCodeKey automatisch zu bestimmen
-			// da dieser von gc mal wieder ge&#228;ndert wurde.
-			// todo Ben&#246;tigt ev noch weitere Anpassungen: | am Anfang, and calc
+			// da dieser von gc mal wieder ge&#195;&#164;ndert wurde.
+			// todo Ben&#195;&#182;tigt ev noch weitere Anpassungen: | am Anfang, and calc
 			// of keylength
 
 			// String thereitis=&quot;|0.34 km|102.698&quot;;
@@ -1965,7 +1950,7 @@
 			final String coded = ewe.net.URL.decodeURL(RexPropDistanceCode.stringMatched(1));
 			final String newkey = decodeXor(coded, thereitis);
 			final int keylength = 13; // wenn nicht 13 dann newkey auf
-										// wiederholung pr&#252;fen
+										// wiederholung pr&#195;&#188;fen
 			DistanceCodeKey = newkey.substring(0, keylength);
 			ret = decodeXor(stmp, DistanceCodeKey).replace('|', ' ');
 			pref.log(&quot;Automatic key: &quot; + DistanceCodeKey + &quot; result: &quot; + ret + Preferences.NEWLINE);

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/myTableControl.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -286,6 +286,7 @@
 
 		if (selectedItem == miUpdate) {
 			MainMenu.updateSelectedCaches(tbp);
+			pref.setOldGCLanguage();
 		} else
 
 		if (selectedItem == miChangeBlack) {

Modified: trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java
===================================================================
--- trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -104,9 +104,7 @@
 
 	/** The panel for the lower half of the screen */
 	private CellPanel lowerpane;
-	private mInput inpName, inpTrackingNo,
-			inpFromDate, inpFromProfile, inpFromWaypoint,
-			inpToDate, inpToProfile, inpToWaypoint;
+	private mInput inpName, inpTrackingNo, inpFromDate, inpFromProfile, inpFromWaypoint, inpToDate, inpToProfile, inpToWaypoint;
 	private mLabel lblId;
 	private mButton btnFromDate, btnToDate;
 	private mCheckBox chkFromLogged, chkToLogged;
@@ -136,7 +134,7 @@
 
 	// =========== MODEL
 	// Set to Public to implement MVC-Pattern [AP]
-//	public TravelbugJourneyList tblMyTravelbugJourneys;
+	// public TravelbugJourneyList tblMyTravelbugJourneys;
 	/** List of TBs in the current cache */
 	// Set to Public to implement MVC-Pattern [AP]
 	public TravelbugList tblSrcCache;
@@ -170,8 +168,7 @@
 		title = &quot;Travelbugs&quot; + cache;
 		tcTbJourneyList = new tbListControl(model);
 		tcTbJourneyList.setTableModel(modTbJourneyList = new tbListTableModel());
-		tablepane.addLast(new MyScrollBarPanel(tcTbJourneyList, ScrollablePanel.AlwaysShowVerticalScrollers), STRETCH,
-				FILL);
+		tablepane.addLast(new MyScrollBarPanel(tcTbJourneyList, ScrollablePanel.AlwaysShowVerticalScrollers), STRETCH, FILL);
 
 		lowerpane = split.getNextPanel();
 
@@ -255,10 +252,8 @@
 
 		modTbJourneyList.numRows = model.allTravelbugJourneys.size();
 		// Get the columns to display and their widths from preferences
-		modTbJourneyList.columnMap =
-				TableColumnChooser.str2Array(Global.getPref().travelbugColMap, 0, 11, 0, -1);
-		modTbJourneyList.colWidth =
-				TableColumnChooser.str2Array(Global.getPref().travelbugColWidth, 10, 1024, 50, -1);
+		modTbJourneyList.columnMap = TableColumnChooser.str2Array(Global.getPref().travelbugColMap, 0, 11, 0, -1);
+		modTbJourneyList.colWidth = TableColumnChooser.str2Array(Global.getPref().travelbugColWidth, 10, 1024, 50, -1);
 		modTbJourneyList.numCols = modTbJourneyList.columnMap.length;
 
 		modTbJourneyList.select(0, 12, true);
@@ -281,9 +276,7 @@
 
 	public void onEvent(Event ev) {
 		// Update the table from the input form
-		if ((ev instanceof MultiPanelEvent || ev instanceof ControlEvent || ev instanceof DataChangeEvent)
-				&amp;&amp; selectedRow != -1 &amp;&amp;
-				selectedRow &lt; model.allTravelbugJourneys.size()) {
+		if ((ev instanceof MultiPanelEvent || ev instanceof ControlEvent || ev instanceof DataChangeEvent) &amp;&amp; selectedRow != -1 &amp;&amp; selectedRow &lt; model.allTravelbugJourneys.size()) {
 			TravelbugJourney tbj = model.allTravelbugJourneys.getTBJourney(selectedRow);
 			if (currentControl == inpName)
 				tbj.getTb().setName(inpName.getText());
@@ -338,8 +331,7 @@
 				;
 				dc.reset(t);
 				if (dc.execute() == ewe.ui.FormBase.IDOK) {
-					inpDate.setText(Convert.toString(dc.year) + &quot;-&quot; + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-							+ MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot; + dc.time);
+					inpDate.setText(Convert.toString(dc.year) + &quot;-&quot; + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot; + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot; + dc.time);
 					if (ev.target == btnFromDate) {
 						model.allTravelbugJourneys.getTBJourney(selectedRow).setFromDate(inpDate.getText());
 						Gui.takeFocus(chkFromLogged, ControlConstants.ByKeyboard);
@@ -368,8 +360,7 @@
 			String travelbugColWidth = modTbJourneyList.getColWidths();
 			// If the preferences changed, save the pref.xml file
 			Vm.showWait(true);
-			if (!Global.getPref().travelbugColWidth.equals(travelbugColWidth) ||
-					old != Global.getPref().travelbugShowOnlyNonLogged) {
+			if (!Global.getPref().travelbugColWidth.equals(travelbugColWidth) || old != Global.getPref().travelbugShowOnlyNonLogged) {
 				Global.getPref().travelbugColWidth = travelbugColWidth;
 				Global.getPref().savePreferences();
 			}
@@ -421,12 +412,10 @@
 				int map = columnMap[col];
 				// If we have not yet logged the from or the to, a red dot is
 				// placed in front of the first item
-				if (col == 0 &amp;&amp; (!model.allTravelbugJourneys.getTBJourney(row).getFromLogged() ||
-						!model.allTravelbugJourneys.getTBJourney(row).getToLogged())) {
+				if (col == 0 &amp;&amp; (!model.allTravelbugJourneys.getTBJourney(row).getFromLogged() || !model.allTravelbugJourneys.getTBJourney(row).getToLogged())) {
 					// Is it a column with a checkbox?
 					if (map != 7 &amp;&amp; map != 11)
-						return new IconAndText((IImage) imgRed, (String) model.allTravelbugJourneys.getTBJourney(row)
-								.getElementByNumber(map), fm);
+						return new IconAndText((IImage) imgRed, (String) model.allTravelbugJourneys.getTBJourney(row).getElementByNumber(map), fm);
 					else { // Checkbox - special treatment
 						IconAndText iat = new IconAndText(imgRed, &quot;&quot;, fm);
 						iat.addColumn(model.allTravelbugJourneys.getTBJourney(row).getElementByNumber(map));
@@ -721,6 +710,7 @@
 				inpName.setText(tbj.getTb().getName());
 				lblId.setText(tbj.getTb().getGuid());
 				lowerpane.repaint();
+				Global.getPref().setOldGCLanguage();
 			}
 			if (selectedItem == mnuOpenOnline &amp;&amp; selectedRow &gt;= 0) {
 				TravelbugJourney tbj = tbModel.allTravelbugJourneys.getTBJourney(selectedRow);
@@ -749,6 +739,7 @@
 				toggleNonLogged();
 			}
 			updateNumBugs();
+			Global.getPref().setOldGCLanguage();
 		}
 
 		/**

Modified: trunk/src/CacheWolf/view/ewe/TravelbugMenu.java
===================================================================
--- trunk/src/CacheWolf/view/ewe/TravelbugMenu.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/view/ewe/TravelbugMenu.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -19,8 +19,7 @@
 import ewe.ui.PullDownMenu;
 
 /**
- * Controller for the {@link TravelbugList}. Preferrably used by
- * {@link TravelbugJourneyScreen}
+ * Controller for the {@link TravelbugList}. Preferrably used by {@link TravelbugJourneyScreen}
  * 
  * @author andi
  * 
@@ -43,7 +42,6 @@
 	public TravelbugJourneyScreen view;
 	private TravelBugScreenModel model;
 
-	
 	public TravelbugMenu(TravelBugScreenModel model) {
 		this.model = model;
 		MenuItem[] TBMenuItems = new MenuItem[9];
@@ -147,6 +145,7 @@
 						}
 					}
 				}
+				Global.getPref().setOldGCLanguage();
 			} else if (mev.selectedItem == mnuOpenOnline &amp;&amp; view.selectedRow &gt;= 0) {
 				TravelbugJourney tbj = model.allTravelbugJourneys.getTBJourney(view.selectedRow);
 				SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
@@ -169,6 +168,7 @@
 						Global.getPref().log(&quot;Ignored Exception&quot;, ioex, true);
 					}
 				}
+				Global.getPref().setOldGCLanguage();
 			}
 
 		}

Modified: trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java	2011-05-14 20:57:48 UTC (rev 3004)
+++ trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java	2011-05-15 18:20:09 UTC (rev 3005)
@@ -55,12 +55,12 @@
 				journeyScreen.model.allTravelbugJourneys.addTbDrop(tb, Global.getProfile().name, ch.getWayPoint());
 				ch.setHas_bugs(true);
 				ch.save();
-				//Set Input fields to the new Values:
+				// Set Input fields to the new Values:
 				view.getInpToWaypoint().setText(view.getTravelbug().getToWaypoint());
 				view.getInpToProfile().setText(view.getTravelbug().getToProfile());
 				view.getInpToDate().setText(view.getTravelbug().getToDate());
-				//Save now. The action won't recognize the changes:
-				journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();	
+				// Save now. The action won't recognize the changes:
+				journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();
 			}
 			journeyScreen.setupTBButtons();
 			exit(0);
@@ -87,6 +87,7 @@
 					Global.getPref().log(&quot;Ignored Exception&quot;, ioex, true);
 				}
 			}
+			Global.getPref().setOldGCLanguage();
 			exit(0);
 		} else if (action.equals(SPIDER)) {
 			Travelbug tb = view.getTravelbug().getTb();
@@ -113,16 +114,15 @@
 			}
 			journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();
 			Vm.showWait(false);
+			Global.getPref().setOldGCLanguage();
 			exit(0);
 		} else if (action.equals(DELETE)) {
 			// LOESCHEN DES TB's aus der Datenbank ist Boese!!!
 			// Erst mal eine Sicherheitesabfrage bauen:
-			int r = PDAOptionPane.showConfirmDialog(this.getFrame(), &quot;Sind Sie Sicher???&quot;,
-					&quot;Wollen Sie wirklich den TB l&#246;schen??&quot;);
+			int r = PDAOptionPane.showConfirmDialog(this.getFrame(), &quot;Sind Sie Sicher???&quot;, &quot;Wollen Sie wirklich den TB l&#246;schen??&quot;);
 			if (r == PDAOptionPane.OK) {
 				for (int i = 0; i &lt; journeyScreen.model.allTravelbugJourneys.size(); i++) {
-					TravelbugJourney tbJourney =
-							journeyScreen.model.allTravelbugJourneys.getTBJourney(i);
+					TravelbugJourney tbJourney = journeyScreen.model.allTravelbugJourneys.getTBJourney(i);
 					if (tbJourney.getTb().getTrackingNo().equals(view.getTravelbug().getTb().getTrackingNo())) {
 						journeyScreen.model.allTravelbugJourneys.remove(i);
 						journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002993.html">[Cachewolf-svn] r3002 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/exp src/CacheWolf/imp
</A></li>
	<LI>Next message: <A HREF="002998.html">[Cachewolf-svn] r3007 - in trunk/src/CacheWolf: . imp navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2996">[ date ]</a>
              <a href="thread.html#2996">[ thread ]</a>
              <a href="subject.html#2996">[ subject ]</a>
              <a href="author.html#2996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
