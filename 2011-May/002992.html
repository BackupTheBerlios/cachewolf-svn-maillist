<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r3001 - in trunk/src/CacheWolf: . imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3001%20-%20in%20trunk/src/CacheWolf%3A%20.%20imp&In-Reply-To=%3C20110512204201.0E82E4813C4%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002991.html">
   <LINK REL="Next"  HREF="002994.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r3001 - in trunk/src/CacheWolf: . imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r3001%20-%20in%20trunk/src/CacheWolf%3A%20.%20imp&In-Reply-To=%3C20110512204201.0E82E4813C4%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r3001 - in trunk/src/CacheWolf: . imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Thu May 12 10:42:00 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002991.html">[Cachewolf-svn] r3000 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
</A></li>
        <LI>Next message: <A HREF="002994.html">[Cachewolf-svn] r3003 - in trunk/src/CacheWolf: . exp imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2992">[ date ]</a>
              <a href="thread.html#2992">[ thread ]</a>
              <a href="subject.html#2992">[ subject ]</a>
              <a href="author.html#2992">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2011-05-12 22:42:00 +0200 (Thu, 12 May 2011)
New Revision: 3001

Modified:
   trunk/src/CacheWolf/InfoBox.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MyComparer.java
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/imp/OCLinkImporter.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/myTableModel.java
Log:
1. Import OC Links only for visible Caches. Starting &quot;-&quot; means : not yet logged at OC
2. log OC - Cache from found GC-Cache in Browser. Text in Clipboard.
3. log OC - Cache from found GC-Cache without Browser if clicked in OC-IDx Column. Error Result shown with ! in front of OC - Waypoint.

(All restricted to opencaching.de at the moment)

Modified: trunk/src/CacheWolf/InfoBox.java
===================================================================
--- trunk/src/CacheWolf/InfoBox.java	2011-05-11 23:04:45 UTC (rev 3000)
+++ trunk/src/CacheWolf/InfoBox.java	2011-05-12 20:42:00 UTC (rev 3001)
@@ -1,29 +1,30 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
+
 import ewe.ui.CellConstants;
 import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
@@ -37,7 +38,7 @@
 import ewe.ui.mInput;
 import ewe.ui.mLabel;
 
-public class InfoBox extends Form{
+public class InfoBox extends Form {
 	TextMessage msgArea;
 	mCheckBox mCB;
 	TextMessage warnings;
@@ -50,28 +51,21 @@
 	public final static int DISPLAY_ONLY = 3;
 	public final static int PROGRESS_WITH_WARNINGS = 4;
 	private int type = 0;
-	/** This variable is set to true if the user closed the Info window by
-	 *  clicking the &quot;close&quot; button. It can be used to check if a lengthy task needs to be
-	 *  aborted (i.e. spidering)
+	/**
+	 * This variable is set to true if the user closed the Info window by clicking the &quot;close&quot; button. It can be used to check if a lengthy task needs to be aborted (i.e. spidering)
 	 */
-	public boolean isClosed=false;
+	public boolean isClosed = false;
 
-	public InfoBox(String title, String info){
+	public InfoBox(String title, String info) {
 		this(title, info, DISPLAY_ONLY);
 
-		/*this.setPreferredSize(170,50);
-		this.title = title;
-		msgArea = new MessageArea(&quot;&quot;), CellConstants.STRETCH, CellConstants.FILL)
-		this.addLast(scP = new ScrollBarPanel(msgArea));
-		msgArea.setText(info);
-		mB.setHotKey(0, IKeys.ACTION);
-		mB.setHotKey(0, IKeys.ENTER);
-		//mB.set(Control.Invisible, true);
-		//this.addLast(mB, CellConstants.STRETCH, CellConstants.FILL);
+		/*
+		 * this.setPreferredSize(170,50); this.title = title; msgArea = new MessageArea(&quot;&quot;), CellConstants.STRETCH, CellConstants.FILL) this.addLast(scP = new ScrollBarPanel(msgArea)); msgArea.setText(info); mB.setHotKey(0, IKeys.ACTION); mB.setHotKey(0,
+		 * IKeys.ENTER); //mB.set(Control.Invisible, true); //this.addLast(mB, CellConstants.STRETCH, CellConstants.FILL);
 		 */
 	}
 
-	public String getInput(){
+	public String getInput() {
 		return feedback.getText();
 	}
 
@@ -80,29 +74,43 @@
 		this.repaintNow();
 	}
 
-	public InfoBox(String title, String info, int ty){
-		this(title, info, ty, true);
-//		this.setPreferredSize(170, 50);
+	public InfoBox(String title, String info, int type) {
+		this(title, info, type, true);
+		// this.setPreferredSize(170, 50);
 		relayout(false);
 	}
 
 	public InfoBox(String title, String info, int ty, boolean autoWrap) {
 		type = ty;
-//		this.setPreferredSize(150,50);
+		// this.setPreferredSize(150,50);
 		// Resize InfoBox with Fontsize
-		Preferences pref=Global.getPref();
+		Preferences pref = Global.getPref();
 		int fs = pref.fontSize;
 		int sw = MyLocale.getScreenWidth();
-		int psx; int psy;
-		psx=170;psy=50;
-		if((fs &gt; 11) &amp;&amp; (sw &gt;= 200)){psx=200;psy=70;}
-		if((fs &gt; 16) &amp;&amp; (sw &gt;= 250)){psx=250;psy=90;}
-		if((fs &gt; 21) &amp;&amp; (sw &gt;= 300)){psx=300;psy=110;}
-		if((fs &gt; 24) &amp;&amp; (sw &gt;= 350)){psx=350;psy=130;}
+		int psx;
+		int psy;
+		psx = 170;
+		psy = 50;
+		if ((fs &gt; 11) &amp;&amp; (sw &gt;= 200)) {
+			psx = 200;
+			psy = 70;
+		}
+		if ((fs &gt; 16) &amp;&amp; (sw &gt;= 250)) {
+			psx = 250;
+			psy = 90;
+		}
+		if ((fs &gt; 21) &amp;&amp; (sw &gt;= 300)) {
+			psx = 300;
+			psy = 110;
+		}
+		if ((fs &gt; 24) &amp;&amp; (sw &gt;= 350)) {
+			psx = 350;
+			psy = 130;
+		}
 		this.setPreferredSize(psx, psy);
 		this.title = title;
 		switch (type) {
-		case CHECKBOX: 
+		case CHECKBOX:
 			mCB = new mCheckBox(info);
 			this.addLast(mCB, CellConstants.STRETCH, CellConstants.FILL);
 			break;
@@ -123,11 +131,11 @@
 			msgArea.autoWrap = autoWrap;
 			msgArea.alignment = CellConstants.CENTER;
 			msgArea.anchor = CellConstants.CENTER;
-			msgArea.setPreferredSize(psx-20, psy);
+			msgArea.setPreferredSize(psx - 20, psy);
 			this.addLast(msgArea.getScrollablePanel(), CellConstants.HEXPAND | CellConstants.HGROW, CellConstants.HEXPAND | CellConstants.HGROW);
 			warnings = new TextMessage(&quot;&quot;);
 			warnings.autoWrap = autoWrap;
-			this.addLast(warnings.getScrollablePanel(), CellConstants.HEXPAND | CellConstants.VEXPAND |CellConstants.VGROW, CellConstants.HEXPAND | CellConstants.VEXPAND |CellConstants.VGROW);
+			this.addLast(warnings.getScrollablePanel(), CellConstants.HEXPAND | CellConstants.VEXPAND | CellConstants.VGROW, CellConstants.HEXPAND | CellConstants.VEXPAND | CellConstants.VGROW);
 			mB.set(ControlConstants.Disabled, true);
 			mB.setPreferredSize(40, 20);
 			addLast(mB, CellConstants.DONTSTRETCH, CellConstants.DONTFILL);
@@ -142,48 +150,52 @@
 		}
 	}
 
-	public void setInfo(String info){
+	public void setInfo(String info) {
 		msgArea.setText(info);
 		this.repaintNow();
 	}
-	
+
 	public void setInfoHeight(int heighti) {
 		msgArea.setPreferredSize(getPreferredSize(null).width, heighti);
 	}
+
 	public void setInfoWidth(int widthi) {
-		msgArea.setPreferredSize(widthi,getPreferredSize(null).height);
+		msgArea.setPreferredSize(widthi, getPreferredSize(null).height);
 	}
-	public String getInfo(){
+
+	public String getInfo() {
 		return msgArea.getText();
 	}
 
-	public void addWarning (String w) {
+	public void addWarning(String w) {
 		warnings.setText(warnings.text + w);
 	}
-	public void addOkButton() { //unfortunately this doesn't work
+
+	public void addOkButton() { // unfortunately this doesn't work
 		mB.set(ControlConstants.Disabled, false);
-		//addNext(mB);
-		//relayout(true);
-		//mB.set(Control.Invisible, false);
+		// addNext(mB);
+		// relayout(true);
+		// mB.set(Control.Invisible, false);
 		this.repaintNow();
 	}
 
-	public void onEvent(Event ev){
+	public void onEvent(Event ev) {
 		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED) {
-			if(ev.target == mB){
-				if(type == CHECKBOX) mCB_state = mCB.getState();
+			if (ev.target == mB) {
+				if (type == CHECKBOX)
+					mCB_state = mCB.getState();
 				this.close(FormBase.IDOK);
 			}
-			if(ev.target == mC){
+			if (ev.target == mC) {
 				this.close(FormBase.IDCANCEL);
 			}
 		}
 		super.onEvent(ev);
 	}
-	
+
 	protected boolean canExit(int exitCode) {
-		isClosed=true;
+		isClosed = true;
 		return true;
 	}
-	
+
 }
\ No newline at end of file

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2011-05-11 23:04:45 UTC (rev 3000)
+++ trunk/src/CacheWolf/MainMenu.java	2011-05-12 20:42:00 UTC (rev 3001)
@@ -79,7 +79,7 @@
  * @see MainTab Last change: 20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
  */
 public class MainMenu extends MenuBar {
-	private MenuItem preferences, mnuContext, loadcaches, loadOC, loadOCFinds, /* savenexit, */savenoxit, exit, search, searchAll, searchClr;
+	private MenuItem preferences, mnuContext, loadcaches, loadOC, loadOCFinds, savenoxit, exit, search, searchAll, searchClr;
 	private MenuItem downloadmap, kalibmap, importmap, selectMapPath;
 	private MenuItem spider, spiderRoute, spiderQuick, spiderAllFinds, loadGCVotes, fetchOCLink, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
@@ -96,7 +96,6 @@
 	private static boolean searchInDescriptionAndNotes = false;
 	private static boolean searchInLogs = false;
 	GCVoteImporter sGCV = null;
-	OCLinkImporter sOCL = null;
 
 	public MainMenu(Form f) {
 
@@ -107,8 +106,11 @@
 		// /////////////////////////////////////////////////////////////////////
 		// subMenu for profiles, part of &quot;Application&quot; menu below
 		// /////////////////////////////////////////////////////////////////////
-		MenuItem[] mnuProfile = { mnuNewProfile = new MenuItem(MyLocale.getMsg(1107, &quot;New&quot;)), mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109, &quot;Open&quot;)), mnuDeleteProfile = new MenuItem(MyLocale.getMsg(1125, &quot;Delete&quot;)),
-				mnuRenameProfile = new MenuItem(MyLocale.getMsg(1126, &quot;Rename&quot;)), };
+		MenuItem[] mnuProfile = { mnuNewProfile = new MenuItem(MyLocale.getMsg(1107, &quot;New&quot;)), //
+				mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109, &quot;Open&quot;)), //
+				mnuDeleteProfile = new MenuItem(MyLocale.getMsg(1125, &quot;Delete&quot;)), //
+				mnuRenameProfile = new MenuItem(MyLocale.getMsg(1126, &quot;Rename&quot;)), //
+		};
 		Menu profileMenu = new Menu(mnuProfile, MyLocale.getMsg(121, &quot;Profiles&quot;));
 
 		// /////////////////////////////////////////////////////////////////////
@@ -118,11 +120,22 @@
 			spiderRoute = new MenuItem(MyLocale.getMsg(137, &quot;Download along a Route from geocaching.com&quot;));
 		else
 			spiderRoute = mnuSeparator;
-		MenuItem[] mnuImport = { loadcaches = new MenuItem(MyLocale.getMsg(129, &quot;Import GPX&quot;)), mnuSeparator, loadOC = new MenuItem(MyLocale.getMsg(130, &quot;Download from opencaching&quot;)),
-				loadOCFinds = new MenuItem(MyLocale.getMsg(163, &quot;Finds from opencaching&quot;)), mnuSeparator, spider = new MenuItem(MyLocale.getMsg(131, &quot;Download from geocaching.com&quot;)), spiderRoute,
-				spiderAllFinds = new MenuItem(MyLocale.getMsg(217, &quot;Spider all finds from geocaching.com&quot;)), spiderQuick = new MenuItem(MyLocale.getMsg(138, &quot;from GC quick&quot;)), update = new MenuItem(MyLocale.getMsg(1014, &quot;Update cache data&quot;)),
-				mnuSeparator, loadGCVotes = new MenuItem(MyLocale.getMsg(1208, &quot;Import ratings from GCVote&quot;)), fetchOCLink = new MenuItem(MyLocale.getMsg(1209, &quot;Fetch link to OC - Cache&quot;)), mnuSeparator,
-				mnuForceLogin = new MenuItem(MyLocale.getMsg(216, &quot;Always login to GC&quot;)), };
+		MenuItem[] mnuImport = { loadcaches = new MenuItem(MyLocale.getMsg(129, &quot;Import GPX&quot;)), //
+				mnuSeparator, //
+				loadOC = new MenuItem(MyLocale.getMsg(130, &quot;Download from opencaching&quot;)), //
+				loadOCFinds = new MenuItem(MyLocale.getMsg(163, &quot;Finds from opencaching&quot;)), //
+				mnuSeparator, //
+				spider = new MenuItem(MyLocale.getMsg(131, &quot;Download from geocaching.com&quot;)), //
+				spiderRoute, //
+				spiderAllFinds = new MenuItem(MyLocale.getMsg(217, &quot;Spider all finds from geocaching.com&quot;)), //
+				spiderQuick = new MenuItem(MyLocale.getMsg(138, &quot;from GC quick&quot;)), //
+				update = new MenuItem(MyLocale.getMsg(1014, &quot;Update cache data&quot;)), //
+				mnuSeparator, //
+				loadGCVotes = new MenuItem(MyLocale.getMsg(1208, &quot;Import ratings from GCVote&quot;)), //
+				fetchOCLink = new MenuItem(MyLocale.getMsg(1209, &quot;Fetch link to OC - Cache&quot;)), //
+				mnuSeparator, //
+				mnuForceLogin = new MenuItem(MyLocale.getMsg(216, &quot;Always login to GC&quot;)), //
+		};
 		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175, &quot;Import&quot;));
 		if (Global.getPref().forceLogin)
 			mnuForceLogin.modifiers ^= MenuItem.Checked;
@@ -130,54 +143,89 @@
 		// /////////////////////////////////////////////////////////////////////
 		// subMenu for export, part of &quot;Application&quot; menu below
 		// /////////////////////////////////////////////////////////////////////
-		MenuItem[] exitems = { exporthtml = new MenuItem(MyLocale.getMsg(100, &quot;to HTML&quot;)), exportGpxNg = new MenuItem(MyLocale.getMsg(101, &quot;to GPX Test&quot;)), exporttop50 = new MenuItem(MyLocale.getMsg(102, &quot;to TOP50 ASCII&quot;)),
-				exportASC = new MenuItem(MyLocale.getMsg(104, &quot;to CSV&quot;)), exportTomTom = new MenuItem(MyLocale.getMsg(105, &quot;to TomTom&quot;)), exportMSARCSV = new MenuItem(MyLocale.getMsg(106, &quot;to MS AutoRoute CSV&quot;)),
-				exportLOC = new MenuItem(MyLocale.getMsg(215, &quot;to LOC&quot;)), exportGPS = new MenuItem(MyLocale.getMsg(122, &quot;to GPS&quot;)), exportOZI = new MenuItem(MyLocale.getMsg(124, &quot;to OZI&quot;)),
-				exportKML = new MenuItem(MyLocale.getMsg(125, &quot;to Google Earth&quot;)), exportExplorist = new MenuItem(MyLocale.getMsg(132, &quot;to Explorist&quot;)), exportTPL = new MenuItem(MyLocale.getMsg(128, &quot;via Template&quot;)),
-				exportSpoilerPOI = new MenuItem(MyLocale.getMsg(135, &quot;to SpoilerPOI&quot;)), };
+		MenuItem[] exitems = { exporthtml = new MenuItem(MyLocale.getMsg(100, &quot;to HTML&quot;)), //
+				exportGpxNg = new MenuItem(MyLocale.getMsg(101, &quot;to GPX Test&quot;)), //
+				exporttop50 = new MenuItem(MyLocale.getMsg(102, &quot;to TOP50 ASCII&quot;)), //
+				exportASC = new MenuItem(MyLocale.getMsg(104, &quot;to CSV&quot;)), //
+				exportTomTom = new MenuItem(MyLocale.getMsg(105, &quot;to TomTom&quot;)), //
+				exportMSARCSV = new MenuItem(MyLocale.getMsg(106, &quot;to MS AutoRoute CSV&quot;)), //
+				exportLOC = new MenuItem(MyLocale.getMsg(215, &quot;to LOC&quot;)), //
+				exportGPS = new MenuItem(MyLocale.getMsg(122, &quot;to GPS&quot;)), //
+				exportOZI = new MenuItem(MyLocale.getMsg(124, &quot;to OZI&quot;)), //
+				exportKML = new MenuItem(MyLocale.getMsg(125, &quot;to Google Earth&quot;)), //
+				exportExplorist = new MenuItem(MyLocale.getMsg(132, &quot;to Explorist&quot;)), //
+				exportTPL = new MenuItem(MyLocale.getMsg(128, &quot;via Template&quot;)), //
+				exportSpoilerPOI = new MenuItem(MyLocale.getMsg(135, &quot;to SpoilerPOI&quot;)), //
+		};
 		if (Global.getPref().gpsbabel == null) {
 			exportGPS.modifiers = MenuItem.Disabled;
 			exportGPS.setText(MyLocale.getMsg(136, &quot;to GPS : gpsbabel missing.&quot;));
 		}
-
 		Menu exportMenu = new Menu(exitems, MyLocale.getMsg(107, &quot;Export&quot;));
 
 		// /////////////////////////////////////////////////////////////////////
 		// subMenu for maps, part of &quot;Application&quot; menu below
 		// /////////////////////////////////////////////////////////////////////
-		MenuItem[] mapMenuItems = { downloadmap = new MenuItem(MyLocale.getMsg(162, &quot;Download calibrated&quot;)), importmap = new MenuItem(MyLocale.getMsg(150, &quot;Import&quot;)), kalibmap = new MenuItem(MyLocale.getMsg(151, &quot;Calibrate&quot;)),
-				selectMapPath = new MenuItem(MyLocale.getMsg(4236, &quot;Change map directory$c&quot;)), };
+		MenuItem[] mapMenuItems = { downloadmap = new MenuItem(MyLocale.getMsg(162, &quot;Download calibrated&quot;)), //
+				importmap = new MenuItem(MyLocale.getMsg(150, &quot;Import&quot;)), //
+				kalibmap = new MenuItem(MyLocale.getMsg(151, &quot;Calibrate&quot;)), //
+				selectMapPath = new MenuItem(MyLocale.getMsg(4236, &quot;Change map directory$c&quot;)), //
+		};
 		Menu mapsMenu = new Menu(mapMenuItems, null);
 
 		// Now we start with the horizontal menu bar &quot;Application&quot;, &quot;Search&quot;, &quot;Filter&quot;, &quot;Organise&quot;, &quot;About&quot;
 		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Application&quot; pulldown menu
 		// /////////////////////////////////////////////////////////////////////
-		MenuItem[] appMenuItems = { new MenuItem(MyLocale.getMsg(121, &quot;Profile&quot;), 0, profileMenu), preferences = new MenuItem(MyLocale.getMsg(108, &quot;Preferences&quot;)), mnuEditCenter = new MenuItem(MyLocale.getMsg(1110, &quot;Centre&quot;)),
-				mnuContext = new MenuItem(MyLocale.getMsg(134, &quot;Current Cache&quot;)), mnuSeparator, new MenuItem(MyLocale.getMsg(175, &quot;Import&quot;), 0, importMenu), new MenuItem(MyLocale.getMsg(107, &quot;Export&quot;), 0, exportMenu),
-				new MenuItem(MyLocale.getMsg(149, &quot;Maps&quot;), 0, mapsMenu), mnuSeparator, savenoxit = new MenuItem(MyLocale.getMsg(127, &quot;Save&quot;)),
-				// savenexit = new MenuItem(MyLocale.getMsg(110,&quot;Save &amp; Exit&quot;)),
-				exit = new MenuItem(MyLocale.getMsg(111, &quot;Exit&quot;)), };
+		MenuItem[] appMenuItems = { new MenuItem(MyLocale.getMsg(121, &quot;Profile&quot;), 0, profileMenu), //
+				preferences = new MenuItem(MyLocale.getMsg(108, &quot;Preferences&quot;)), //
+				mnuEditCenter = new MenuItem(MyLocale.getMsg(1110, &quot;Centre&quot;)), //
+				mnuContext = new MenuItem(MyLocale.getMsg(134, &quot;Current Cache&quot;)), //
+				mnuSeparator, new MenuItem(MyLocale.getMsg(175, &quot;Import&quot;), 0, importMenu), //
+				new MenuItem(MyLocale.getMsg(107, &quot;Export&quot;), 0, exportMenu), //
+				new MenuItem(MyLocale.getMsg(149, &quot;Maps&quot;), 0, mapsMenu), //
+				mnuSeparator, //
+				savenoxit = new MenuItem(MyLocale.getMsg(127, &quot;Save&quot;)), //
+				exit = new MenuItem(MyLocale.getMsg(111, &quot;Exit&quot;)), //
+		};
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(120, &quot;Application&quot;), new Menu(appMenuItems, null)));
 
 		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Search&quot; pulldown menu
 		// /////////////////////////////////////////////////////////////////////
-		MenuItem[] searchMenuItems = { search = new MenuItem(MyLocale.getMsg(112, &quot;Search$&quot; + (char) 6)),// char 6 = ctrl +f
-				searchAll = new MenuItem(MyLocale.getMsg(133, &quot;Search All&quot;)), searchClr = new MenuItem(MyLocale.getMsg(113, &quot;Clear search&quot;)), };
+		MenuItem[] searchMenuItems = { search = new MenuItem(MyLocale.getMsg(112, &quot;Search$&quot; + (char) 6)), // char 6 = ctrl +f
+				searchAll = new MenuItem(MyLocale.getMsg(133, &quot;Search All&quot;)), //
+				searchClr = new MenuItem(MyLocale.getMsg(113, &quot;Clear search&quot;)), //
+		};
 
 		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Filter&quot; pulldown menu
 		// /////////////////////////////////////////////////////////////////////
 		MenuItem[] filterMenuItems = { filtApply = new MenuItem(MyLocale.getMsg(709, &quot;Apply&quot;)), filtCreate = new MenuItem(MyLocale.getMsg(114, &quot;Create&quot;)), filtInvert = new MenuItem(MyLocale.getMsg(115, &quot;Invert&quot;)),
-				filtClear = new MenuItem(MyLocale.getMsg(116, &quot;Clear&quot;)), mnuSeparator, filtSelected = new MenuItem(MyLocale.getMsg(160, &quot;Filter selected&quot;)), filtNonSelected = new MenuItem(MyLocale.getMsg(1011, &quot;Filter out non selected&quot;)), mnuSeparator,
-				filtBlack = new MenuItem(MyLocale.getMsg(161, &quot;Show Blacklist&quot;)), };
+				filtClear = new MenuItem(MyLocale.getMsg(116, &quot;Clear&quot;)), //
+				mnuSeparator, //
+				filtSelected = new MenuItem(MyLocale.getMsg(160, &quot;Filter selected&quot;)), //
+				filtNonSelected = new MenuItem(MyLocale.getMsg(1011, &quot;Filter out non selected&quot;)), //
+				mnuSeparator, filtBlack = new MenuItem(MyLocale.getMsg(161, &quot;Show Blacklist&quot;)), //
+		};
 		filtBlack.modifiers = Global.getProfile().showBlacklisted() ? filtBlack.modifiers | MenuItem.Checked : filtBlack.modifiers &amp; ~MenuItem.Checked;
 
 		// /////////////////////////////////////////////////////////////////////
 		// Create a combined &quot;Filter and Search&quot; pulldown menu for devices with small screens
 		// /////////////////////////////////////////////////////////////////////
-		MenuItem[] filterAndSearchMenuItems = { filtApply, filtCreate, filtInvert, filtClear, mnuSeparator, filtSelected, filtNonSelected, mnuSeparator, filtBlack, mnuSeparator, search, searchClr, };
+		MenuItem[] filterAndSearchMenuItems = { filtApply, //
+				filtCreate, //
+				filtInvert, //
+				filtClear, //
+				mnuSeparator, //
+				filtSelected, //
+				filtNonSelected, //
+				mnuSeparator, //
+				filtBlack, //
+				mnuSeparator, //
+				search, //
+				searchClr, //
+		};
 
 		// Depending on screen width display either filter and search menus or the combined menu
 		if (MyLocale.getScreenWidth() &gt; 300) {
@@ -190,9 +238,17 @@
 		// /////////////////////////////////////////////////////////////////////
 		// Create the &quot;Organise&quot; pulldown menu
 		// /////////////////////////////////////////////////////////////////////
-		MenuItem[] organiseMenuItems = { orgNewWP = new MenuItem(MyLocale.getMsg(214, &quot;New Waypoint&quot;)), mnuSeparator, orgCopy = new MenuItem(MyLocale.getMsg(141, &quot;Copy&quot;)), orgMove = new MenuItem(MyLocale.getMsg(142, &quot;Move&quot;)),
-				orgDelete = new MenuItem(MyLocale.getMsg(143, &quot;Delete&quot;)), orgRebuild = new MenuItem(MyLocale.getMsg(208, &quot;Rebuild Index&quot;)), orgCheckNotesAndSolver = new MenuItem(MyLocale.getMsg(220, &quot;Check Notes/Solver&quot;)), mnuSeparator,
-				orgTravelbugs = new MenuItem(MyLocale.getMsg(139, &quot;Manage travelbugs&quot;)), cacheTour = new MenuItem(MyLocale.getMsg(198, &quot;Cachetour&quot;)), };
+		MenuItem[] organiseMenuItems = { orgNewWP = new MenuItem(MyLocale.getMsg(214, &quot;New Waypoint&quot;)), //
+				mnuSeparator, //
+				orgCopy = new MenuItem(MyLocale.getMsg(141, &quot;Copy&quot;)), //
+				orgMove = new MenuItem(MyLocale.getMsg(142, &quot;Move&quot;)), //
+				orgDelete = new MenuItem(MyLocale.getMsg(143, &quot;Delete&quot;)), //
+				orgRebuild = new MenuItem(MyLocale.getMsg(208, &quot;Rebuild Index&quot;)), //
+				orgCheckNotesAndSolver = new MenuItem(MyLocale.getMsg(220, &quot;Check Notes/Solver&quot;)), //
+				mnuSeparator, //
+				orgTravelbugs = new MenuItem(MyLocale.getMsg(139, &quot;Manage travelbugs&quot;)), //
+				cacheTour = new MenuItem(MyLocale.getMsg(198, &quot;Cachetour&quot;)), //
+		};
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(140, &quot;Organise&quot;), new Menu(organiseMenuItems, null)));
 
 		// /////////////////////////////////////////////////////////////////////
@@ -223,10 +279,6 @@
 		}
 	}
 
-	public void setForceLogin() {
-		mnuForceLogin.modifiers = Global.getPref().forceLogin ? Global.mainTab.mnuMain.modifiers | MenuItem.Checked : Global.mainTab.mnuMain.modifiers &amp; ~MenuItem.Checked;
-	}
-
 	public static void search() {
 		SearchBox inp = new SearchBox(MyLocale.getMsg(119, &quot;Search for:&quot;));
 		String srch = inp.input(null, &quot;&quot;, searchInDescriptionAndNotes, searchInLogs, 10);
@@ -332,9 +384,7 @@
 				tbp.resetModel();
 			}
 			if (mev.selectedItem == fetchOCLink) {
-				if (sOCL == null)
-					sOCL = new OCLinkImporter();
-				sOCL.doIt();
+				OCLinkImporter.doIt();
 				tbp.resetModel();
 			}
 			if (mev.selectedItem == loadcaches) {

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2011-05-11 23:04:45 UTC (rev 3000)
+++ trunk/src/CacheWolf/MyComparer.java	2011-05-12 20:42:00 UTC (rev 3001)
@@ -136,7 +136,10 @@
 			for (int i = 0; i &lt; visibleSize; i++) {
 				CacheHolder ch = cacheDB.get(i);
 				if (ch.getWayPoint().startsWith(&quot;GC&quot;))
-					ch.sort = ch.getOcCacheID();
+					if (ch.getOcCacheID().length() == 0)
+						ch.sort = &quot;\uFFFF&quot;;
+					else
+						ch.sort = ch.getOcCacheID();
 				else {
 					String[] stmp = mString.split(ch.getCacheOwner(), '/');
 					int l = stmp.length - 1;

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-05-11 23:04:45 UTC (rev 3000)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-05-12 20:42:00 UTC (rev 3001)
@@ -226,7 +226,7 @@
 		AsciiCodec asciicod = new AsciiCodec();
 		CharArray utf8bytes = new CharArray();
 		asciicod.decodeText(utf8.data, 0, utf8.length, true, utf8bytes);
-		return encodeURL(utf8bytes.toString(), false);
+		return encodeURL(utf8bytes.toString(), true);
 	}
 
 	final static String hex = ewe.util.TextEncoder.hex;

Modified: trunk/src/CacheWolf/imp/OCLinkImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCLinkImporter.java	2011-05-11 23:04:45 UTC (rev 3000)
+++ trunk/src/CacheWolf/imp/OCLinkImporter.java	2011-05-12 20:42:00 UTC (rev 3001)
@@ -33,47 +33,58 @@
 import ewe.ui.ProgressBarForm;
 
 public class OCLinkImporter {
-	private CacheDB cacheDB;
+	private static CacheDB cacheDB = null;
 
-	public OCLinkImporter() {
-		this.cacheDB = Global.getProfile().cacheDB;
-	}
+	public static void doIt() {
 
-	public void doIt() {
+		if (cacheDB == null)
+			cacheDB = Global.getProfile().cacheDB;
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
 
 		pbf.showMainTask = false;
 		pbf.setTask(h, &quot;Import OC names ...&quot;);
 		pbf.exec();
-		OCGPXfetch.login();
-		for (int o = 0; o &lt; cacheDB.size(); o += 1) {
-			CacheHolder ch = cacheDB.get(o);
-			String wp = ch.getWayPoint();
-			if (wp.startsWith(&quot;GC&quot;)) {
-				String url = &quot;<A HREF="http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=">http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=</A>&quot; + wp;
+		if (OCGPXfetch.login()) {
+			for (int o = 0; o &lt; cacheDB.size(); o += 1) {
 				h.progress = (float) o / (float) (cacheDB.size() - 1);
-				h.changed();
-				try {
-					String result = UrlFetcher.fetch(url);
-					boolean found = false;
-					int start = result.indexOf(&quot;found=\&quot;&quot;) + 7;
-					if (result.substring(start).startsWith(&quot;1&quot;))
-						found = true;
-					start = result.indexOf(&quot;wpoc=\&quot;&quot;) + 6;
-					if (start &gt; 5) {
-						int idend = result.indexOf(&quot;\&quot;&quot;, start);
-						String ocwp = result.substring(start, idend);
-						if (!found)
-							ocwp = &quot;-&quot; + ocwp;
-						ch.setOcCacheID(ocwp);
-					}
-				} catch (Exception e) {
-					// dann halt nicht
-				}
+				if (o % 100 == 0)
+					h.changed();
+				if (pbf.exitValue == -1)
+					break;
+				CacheHolder ch = cacheDB.get(o);
+				if (ch.isVisible())
+					updateOCLink(ch);
 			}
 		}
 		pbf.exit(0);
 	}
 
+	public static void updateOCLink(CacheHolder ch) {
+		String wp = ch.getWayPoint();
+		if (wp.startsWith(&quot;GC&quot;)) {
+			String url = &quot;<A HREF="http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=">http://www.opencaching.de/map2.php?mode=wpsearch&amp;wp=</A>&quot; + wp;
+			ch.setOcCacheID(&quot;&quot;);
+			try {
+				String result = UrlFetcher.fetch(url);
+				boolean found = false;
+				int start = result.indexOf(&quot;found=\&quot;&quot;) + 7;
+				if (result.substring(start).startsWith(&quot;1&quot;))
+					found = true;
+				start = result.indexOf(&quot;wpoc=\&quot;&quot;) + 6;
+				if (start &gt; 5) {
+					int idend = result.indexOf(&quot;\&quot;&quot;, start);
+					String ocwp = result.substring(start, idend);
+					if (!found)
+						ocwp = &quot;-&quot; + ocwp;
+					ch.setOcCacheID(ocwp);
+					ch.save();
+				}
+			} catch (Exception e) {
+				// dann halt nicht
+			}
+		}
+		// return ch;
+	}
+
 }

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2011-05-11 23:04:45 UTC (rev 3000)
+++ trunk/src/CacheWolf/myTableControl.java	2011-05-12 20:42:00 UTC (rev 3001)
@@ -1,30 +1,32 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
 
-    Copyright (C) 2006  CacheWolf development team
-    See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
-    for more information.
-    Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
-    			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
+Copyright (C) 2006  CacheWolf development team
+See <A HREF="http://developer.berlios.de/projects/cachewolf/">http://developer.berlios.de/projects/cachewolf/</A>
+for more information.
+Contact: 	<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">bilbowolf at users.berlios.de</A>
+			<A HREF="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">kalli at users.berlios.de</A>
 
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
 package CacheWolf;
 
+import CacheWolf.imp.OCGPXfetch;
+import CacheWolf.imp.OCLinkImporter;
 import CacheWolf.utils.CWWrapper;
 import CacheWolf.utils.FileBugfix;
 import ewe.fx.IconAndText;
@@ -34,6 +36,7 @@
 import ewe.io.IOException;
 import ewe.sys.Handle;
 import ewe.sys.Locale;
+import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.Control;
 import ewe.ui.DragContext;
@@ -52,15 +55,17 @@
 import ewe.ui.mList;
 
 /**
- *	Implements the user interaction of the list view. Works together with myTableModel and TablePanel
+ * Implements the user interaction of the list view. Works together with myTableModel and TablePanel
  */
-public class myTableControl extends TableControl{
+public class myTableControl extends TableControl {
 
 	public Preferences pref;
 	public Profile profile;
 	public CacheDB cacheDB;
 	public TablePanel tbp;
 
+	public int clickedColumn = 0;
+
 	private MenuItem miOpen, miGoto, miCenter, miUnhideAddis;
 	private MenuItem miOpenOnline, miOpenOffline, miLogOnline, miOpenGmaps;
 	private MenuItem miDelete, miUpdate, miChangeBlack;
@@ -71,47 +76,47 @@
 	private Menu mSmall;
 
 	myTableControl(TablePanel tablePanel) {
-		profile=Global.getProfile();
+		profile = Global.getProfile();
 		cacheDB = profile.cacheDB;
 		pref = Global.getPref();
-		tbp =tablePanel;
+		tbp = tablePanel;
 		allowDragSelection = false; // allow only one row to be selected at one time
-	MenuItem[] mnuFull = {
-			miOpen = new MenuItem(MyLocale.getMsg(1021,&quot;Open description&quot;)),
-			miGoto = new MenuItem(MyLocale.getMsg(1010,&quot;Goto&quot;)),
-		  	miCenter = new MenuItem(MyLocale.getMsg(1019,&quot;Center&quot;)),
-		  	miUnhideAddis = new MenuItem(MyLocale.getMsg(1042,&quot;Unhide Addis&quot;)),
-		  	miSeparator = new MenuItem(&quot;-&quot;),
-		  	miOpenOnline = new MenuItem(MyLocale.getMsg(1020,&quot;Open in $browser online&quot;)),
-		  	miOpenOffline = new MenuItem(MyLocale.getMsg(1018,&quot;Open in browser offline&quot;)),
-		  	miLogOnline = new MenuItem(MyLocale.getMsg(1052,&quot;Log online in Browser&quot;)),
-		  	miOpenGmaps = new MenuItem(MyLocale.getMsg(1053,&quot;Open in Google maps online&quot;)),
-		  	miSeparator,
-		  	miDelete = new MenuItem(MyLocale.getMsg(1012,&quot;Delete selected&quot;)),
-		  	miUpdate = new MenuItem(MyLocale.getMsg(1014,&quot;Update&quot;)),
-		  	miChangeBlack = new MenuItem(MyLocale.getMsg(1054, &quot;Change Blacklist&quot;)),
-		  	miSeparator,
-		  	miTickAll = new MenuItem(MyLocale.getMsg(1015,&quot;Select all&quot;)),
-		  	miUntickAll = new MenuItem(MyLocale.getMsg(1016,&quot;De-select all&quot;))
-	};
-  	mFull = new Menu(mnuFull, MyLocale.getMsg(1013,&quot;With selection&quot;));
-  	MenuItem[] mnuSmall = new MenuItem[8];
-  	mnuSmall[0] = miOpen;
-  	mnuSmall[1] = miGoto;
-  	mnuSmall[2] = miCenter;
-  	mnuSmall[3] = miUnhideAddis;
-  	mnuSmall[4] = miSeparator;
-  	mnuSmall[5] = miOpenOnline;
-  	mnuSmall[6] = miOpenOffline;
-  	mnuSmall[7] = miLogOnline;
-  	mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013,&quot;With selection&quot;));
+		MenuItem[] mnuFull = { miOpen = new MenuItem(MyLocale.getMsg(1021, &quot;Open description&quot;)), //
+				miGoto = new MenuItem(MyLocale.getMsg(1010, &quot;Goto&quot;)), //
+				miCenter = new MenuItem(MyLocale.getMsg(1019, &quot;Center&quot;)), //
+				miUnhideAddis = new MenuItem(MyLocale.getMsg(1042, &quot;Unhide Addis&quot;)), //
+				miSeparator = new MenuItem(&quot;-&quot;), //
+				miOpenOnline = new MenuItem(MyLocale.getMsg(1020, &quot;Open in $browser online&quot;)), //
+				miOpenOffline = new MenuItem(MyLocale.getMsg(1018, &quot;Open in browser offline&quot;)), //
+				miLogOnline = new MenuItem(MyLocale.getMsg(1052, &quot;Log online in Browser&quot;)), //
+				miOpenGmaps = new MenuItem(MyLocale.getMsg(1053, &quot;Open in Google maps online&quot;)), //
+				miSeparator, //
+				miDelete = new MenuItem(MyLocale.getMsg(1012, &quot;Delete selected&quot;)), //
+				miUpdate = new MenuItem(MyLocale.getMsg(1014, &quot;Update&quot;)), //
+				miChangeBlack = new MenuItem(MyLocale.getMsg(1054, &quot;Change Blacklist&quot;)), //
+				miSeparator, //
+				miTickAll = new MenuItem(MyLocale.getMsg(1015, &quot;Select all&quot;)), //
+				miUntickAll = new MenuItem(MyLocale.getMsg(1016, &quot;De-select all&quot;)) //
+		};
+		mFull = new Menu(mnuFull, MyLocale.getMsg(1013, &quot;With selection&quot;));
+
+		MenuItem[] mnuSmall = new MenuItem[8];
+		mnuSmall[0] = miOpen;
+		mnuSmall[1] = miGoto;
+		mnuSmall[2] = miCenter;
+		mnuSmall[3] = miUnhideAddis;
+		mnuSmall[4] = miSeparator;
+		mnuSmall[5] = miOpenOnline;
+		mnuSmall[6] = miOpenOffline;
+		mnuSmall[7] = miLogOnline;
+		mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013, &quot;With selection&quot;));
 	}
 
 	/** Full menu when listview includes checkbox */
 	public void setMenuFull() {
 		setMenu(mFull);
-//		if (!Vm.getPlatform().equals(&quot;Win32&quot;) &amp;&amp; !Vm.getPlatform().equals(&quot;Java&quot;))
-//		   ((MenuItem)mFull.items.get(5)).modifiers|=MenuItem.Disabled;
+		// if (!Vm.getPlatform().equals(&quot;Win32&quot;) &amp;&amp; !Vm.getPlatform().equals(&quot;Java&quot;))
+		// ((MenuItem)mFull.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
 
 	public Menu getMenuFull() {
@@ -121,51 +126,60 @@
 	/** Small menu when listview does not include checkbox */
 	public void setMenuSmall() {
 		setMenu(mSmall);
-		//if (!Vm.getPlatform().equals(&quot;Win32&quot;) &amp;&amp; !Vm.getPlatform().equals(&quot;Java&quot;))
-		//	   ((MenuItem)mSmall.items.get(5)).modifiers|=MenuItem.Disabled;
+		// if (!Vm.getPlatform().equals(&quot;Win32&quot;) &amp;&amp; !Vm.getPlatform().equals(&quot;Java&quot;))
+		// ((MenuItem)mSmall.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
 
-	public void penRightReleased(Point p){
-		if (cacheDB.size()&gt;0) { // No context menu when DB is empty
+	public void penRightReleased(Point p) {
+		if (cacheDB.size() &gt; 0) { // No context menu when DB is empty
 			adjustAddiHideUnhideMenu();
-			menuState.doShowMenu(p,true,null); // direct call (not through doMenu) is neccesary because it will exclude the whole table
+			menuState.doShowMenu(p, true, null); // direct call (not through doMenu) is neccesary because it will exclude the whole table
 
 		}
 	}
 
-    public void penHeld(Point p){
-		if (cacheDB.size()&gt;0) // No context menu when DB is empty
+	public void penHeld(Point p) {
+		if (cacheDB.size() &gt; 0) // No context menu when DB is empty
 			adjustAddiHideUnhideMenu();
-			menuState.doShowMenu(p,true,null);
+		menuState.doShowMenu(p, true, null);
 	}
 
 	public void onKeyEvent(KeyEvent ev) {
-		if (ev.type == KeyEvent.KEY_PRESS &amp;&amp; ev.target == this){
-			if ( (ev.modifiers &amp; IKeys.CONTROL) &gt; 0 &amp;&amp; ev.key == 1){ // &lt;ctrl-a&gt; gives 1, &lt;ctrl-b&gt; == 2
+		if (ev.type == KeyEvent.KEY_PRESS &amp;&amp; ev.target == this) {
+			if ((ev.modifiers &amp; IKeys.CONTROL) &gt; 0 &amp;&amp; ev.key == 1) { // &lt;ctrl-a&gt; gives 1, &lt;ctrl-b&gt; == 2
 				// select all on &lt;ctrl-a&gt;
 				setSelectForAll(true);
 				ev.consumed = true;
-			}
-			else  {
+			} else {
 				Global.mainTab.clearDetails();
-				if (ev.key == IKeys.HOME) Global.mainTab.tbP.selectRow(0); //  cursorTo(0,cursor.x+listMode,true);
-				else if (ev.key == IKeys.END) Global.mainTab.tbP.selectRow(model.numRows-1); //cursorTo(model.numRows-1,cursor.x+listMode,true);
-				else if (ev.key == IKeys.PAGE_DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ getOnScreen(null).height-1, model.numRows-1)); //cursorTo(java.lang.Math.min(cursor.y+ getOnScreen(null).height-1, model.numRows-1),cursor.x+listMode,true); // I don't know why this doesn't work: tbp.doScroll(IScroll.Vertical, IScroll.PageHigher, 1);
-				else if (ev.key == IKeys.PAGE_UP) Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y-getOnScreen(null).height+1, 0)); // cursorTo(java.lang.Math.max(cursor.y-getOnScreen(null).height+1, 0),cursor.x+listMode,true);
-				else if (ev.key == IKeys.ACTION || ev.key == IKeys.ENTER) Global.mainTab.select(Global.mainTab.descP);
-				else if (ev.key == IKeys.DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ 1, model.numRows-1));
-				else if (ev.key == IKeys.UP) Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y-1, 0));
-				else if (ev.key == IKeys.LEFT &amp;&amp; Global.mainForm.cacheListVisible &amp;&amp; cursor.y&gt;=0 &amp;&amp; cursor.y&lt;tbp.myMod.numRows) Global.mainForm.cacheList.addCache(cacheDB.get(cursor.y).getWayPoint());
+				if (ev.key == IKeys.HOME)
+					Global.mainTab.tbP.selectRow(0); // cursorTo(0,cursor.x+listMode,true);
+				else if (ev.key == IKeys.END)
+					Global.mainTab.tbP.selectRow(model.numRows - 1); // cursorTo(model.numRows-1,cursor.x+listMode,true);
+				else if (ev.key == IKeys.PAGE_DOWN)
+					Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y + getOnScreen(null).height - 1, model.numRows - 1)); // cursorTo(java.lang.Math.min(cursor.y+ getOnScreen(null).height-1, model.numRows-1),cursor.x+listMode,true); // I don't
+																																	// know why this doesn't work: tbp.doScroll(IScroll.Vertical, IScroll.PageHigher, 1);
+				else if (ev.key == IKeys.PAGE_UP)
+					Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y - getOnScreen(null).height + 1, 0)); // cursorTo(java.lang.Math.max(cursor.y-getOnScreen(null).height+1, 0),cursor.x+listMode,true);
+				else if (ev.key == IKeys.ACTION || ev.key == IKeys.ENTER)
+					Global.mainTab.select(Global.mainTab.descP);
+				else if (ev.key == IKeys.DOWN)
+					Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y + 1, model.numRows - 1));
+				else if (ev.key == IKeys.UP)
+					Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y - 1, 0));
+				else if (ev.key == IKeys.LEFT &amp;&amp; Global.mainForm.cacheListVisible &amp;&amp; cursor.y &gt;= 0 &amp;&amp; cursor.y &lt; tbp.myMod.numRows)
+					Global.mainForm.cacheList.addCache(cacheDB.get(cursor.y).getWayPoint());
 				else if (ev.key == IKeys.RIGHT) {
 					CacheHolder ch;
 					ch = cacheDB.get(tbp.getSelectedCache());
 					Global.mainTab.gotoP.setDestinationAndSwitch(ch);
-				}
-				else if (ev.key == 6 ) MainMenu.search(); // (char)6 == ctrl + f
-				else super.onKeyEvent(ev);
+				} else if (ev.key == 6)
+					MainMenu.search(); // (char)6 == ctrl + f
+				else
+					super.onKeyEvent(ev);
 			}
-		}
-		else super.onKeyEvent(ev);
+		} else
+			super.onKeyEvent(ev);
 	}
 
 	/** Set all caches either as selected or as deselected, depending on argument */
@@ -174,48 +188,46 @@
 		tbp.refreshTable();
 	}
 
-
 	/** always select a whole row */
-	public boolean isSelected(int pRow,int pCol) {
-		return pRow==selection.y;
+	public boolean isSelected(int pRow, int pCol) {
+		return pRow == selection.y;
 	}
+
 	private void callExternalProgram(String program, String parameter) {
 		// invalid path will be handled by try
 		try {
 			CWWrapper.exec(program, parameter); // maybe this works on some PDAs?
 		} catch (IOException ex) {
-			(new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;),
-					MyLocale.getMsg(1034,&quot;Cannot start &quot;+program+&quot;!&quot;) + &quot;\n&quot; + ex.toString() + &quot;\n&quot; +
-					MyLocale.getMsg(1035,&quot;Possible reason:&quot;) + &quot;\n&quot; +
-					MyLocale.getMsg(1036,&quot;A bug in ewe VM, please be&quot;) + &quot;\n&quot; +
-					MyLocale.getMsg(1037,&quot;patient for an update&quot;),FormBase.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1034, &quot;Cannot start &quot; + program + &quot;!&quot;) + &quot;\n&quot; + ex.toString() + &quot;\n&quot; + MyLocale.getMsg(1035, &quot;Possible reason:&quot;) + &quot;\n&quot; + MyLocale.getMsg(1036, &quot;A bug in ewe VM, please be&quot;)
+					+ &quot;\n&quot; + MyLocale.getMsg(1037, &quot;patient for an update&quot;), FormBase.OKB)).execute();
 		}
 	}
 
-	public void popupMenuEvent(Object selectedItem){
-		if (selectedItem == null) return;
+	public void popupMenuEvent(Object selectedItem) {
+		if (selectedItem == null)
+			return;
 		CacheHolder ch;
-		if (selectedItem == miTickAll){
+		if (selectedItem == miTickAll) {
 			setSelectForAll(true);
 		} else
 
-		if (selectedItem == miUntickAll){
+		if (selectedItem == miUntickAll) {
 			setSelectForAll(false);
 		} else
 
-		if (selectedItem == miDelete){
+		if (selectedItem == miDelete) {
 			Vm.showWait(true);
 			// Count # of caches to delete
-			int allCount=0;
-			int mainNonVisibleCount=0;
-			int addiNonVisibleCount=0;
-			int shouldDeleteCount=0;
-			boolean deleteFiltered=true;  // Bisheriges Verhalten
-			for(int i = cacheDB.size()-1; i &gt;=0; i--){
+			int allCount = 0;
+			int mainNonVisibleCount = 0;
+			int addiNonVisibleCount = 0;
+			int shouldDeleteCount = 0;
+			boolean deleteFiltered = true; // Bisheriges Verhalten
+			for (int i = cacheDB.size() - 1; i &gt;= 0; i--) {
 				CacheHolder currCache = cacheDB.get(i);
-				if ( currCache.is_Checked) {
+				if (currCache.is_Checked) {
 					allCount++;
-					if (! currCache.isVisible()) {
+					if (!currCache.isVisible()) {
 						if (currCache.isAddiWpt()) {
 							addiNonVisibleCount++;
 						} else {
@@ -226,62 +238,60 @@
 			}
 			// Warn if there are ticked but invisible caches - and ask if they should be deleted too.
 			shouldDeleteCount = allCount;
-			if (addiNonVisibleCount + mainNonVisibleCount &gt; 0){
-				if ((new MessageBox(MyLocale.getMsg(144,&quot;Warning&quot;),
-						            MyLocale.getMsg(1029, &quot;There are caches that are ticked but invisible.\n(Main caches: &quot;) +
-						            	mainNonVisibleCount + MyLocale.getMsg(1030, &quot;, additional Waypoints: &quot;) +
-						            	addiNonVisibleCount+&quot;)\n&quot; + MyLocale.getMsg(1031, &quot;Delete them, too?&quot;),
-						            	FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
+			if (addiNonVisibleCount + mainNonVisibleCount &gt; 0) {
+				if ((new MessageBox(MyLocale.getMsg(144, &quot;Warning&quot;), MyLocale.getMsg(1029, &quot;There are caches that are ticked but invisible.\n(Main caches: &quot;) + mainNonVisibleCount + MyLocale.getMsg(1030, &quot;, additional Waypoints: &quot;) + addiNonVisibleCount
+						+ &quot;)\n&quot; + MyLocale.getMsg(1031, &quot;Delete them, too?&quot;), FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
 					deleteFiltered = true;
 				} else {
 					deleteFiltered = false;
 					shouldDeleteCount = allCount - mainNonVisibleCount - addiNonVisibleCount;
 				}
 			}
-			if (shouldDeleteCount&gt;0) {
-				if ((new MessageBox(MyLocale.getMsg(144,&quot;Warning&quot;),MyLocale.getMsg(1022, &quot;Delete selected caches (&quot;) + shouldDeleteCount + MyLocale.getMsg(1028, &quot;) ?&quot;), FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
-					DataMover dm=new DataMover();
+			if (shouldDeleteCount &gt; 0) {
+				if ((new MessageBox(MyLocale.getMsg(144, &quot;Warning&quot;), MyLocale.getMsg(1022, &quot;Delete selected caches (&quot;) + shouldDeleteCount + MyLocale.getMsg(1028, &quot;) ?&quot;), FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
+					DataMover dm = new DataMover();
 					myProgressBarForm pbf = new myProgressBarForm();
 					Handle h = new Handle();
-					int nDeleted=0;
-					int size=cacheDB.size();
-					pbf.setTask(h,&quot;Be patient. Reading directory&quot;);
+					int nDeleted = 0;
+					int size = cacheDB.size();
+					pbf.setTask(h, &quot;Be patient. Reading directory&quot;);
 					pbf.exec();
-					h.progress = (float)0.5;
+					h.progress = (float) 0.5;
 					h.changed();
-					String[] CacheFiles = new FileBugfix(profile.dataDir).list(null, FileBase.LIST_FILES_ONLY|FileBase.LIST_DONT_SORT);
-					pbf.setTask(h,MyLocale.getMsg(1012, &quot;Delete selected&quot;));
-					for(int i = size-1; i &gt;=0; i--){// Start Counting down, as the size decreases with each deleted cache
+					String[] CacheFiles = new FileBugfix(profile.dataDir).list(null, FileBase.LIST_FILES_ONLY | FileBase.LIST_DONT_SORT);
+					pbf.setTask(h, MyLocale.getMsg(1012, &quot;Delete selected&quot;));
+					for (int i = size - 1; i &gt;= 0; i--) {// Start Counting down, as the size decreases with each deleted cache
 						ch = cacheDB.get(i);
-						if(ch.is_Checked &amp;&amp; (ch.isVisible() || deleteFiltered)) {
+						if (ch.is_Checked &amp;&amp; (ch.isVisible() || deleteFiltered)) {
 							nDeleted++;
-							h.progress = ((float)nDeleted)/(float)allCount;
+							h.progress = ((float) nDeleted) / (float) allCount;
 							h.changed();
 							cacheDB.removeElementAt(i);
-							dm.deleteCacheFiles(ch.getWayPoint(),profile.dataDir,CacheFiles);
-							ch=null;
-							if (pbf.isClosed) break;
+							dm.deleteCacheFiles(ch.getWayPoint(), profile.dataDir, CacheFiles);
+							ch = null;
+							if (pbf.isClosed)
+								break;
 						}
 					}
 					pbf.exit(0);
-					tbp.myMod.numRows-=nDeleted;
-					profile.saveIndex(pref,true);
+					tbp.myMod.numRows -= nDeleted;
+					profile.saveIndex(pref, true);
 					tbp.refreshTable();
 				}
 			}
 			Vm.showWait(false);
 		} else
 
-		if (selectedItem == miUpdate){
+		if (selectedItem == miUpdate) {
 			MainMenu.updateSelectedCaches(tbp);
 		} else
-		
-		if (selectedItem == miChangeBlack){
+
+		if (selectedItem == miChangeBlack) {
 			Vm.showWait(true);
 			try {
-				for(int i = cacheDB.size()-1; i &gt;=0; i--){
+				for (int i = cacheDB.size() - 1; i &gt;= 0; i--) {
 					CacheHolder currCache = cacheDB.get(i);
-					if ( currCache.isVisible() &amp;&amp; currCache.is_Checked) {
+					if (currCache.isVisible() &amp;&amp; currCache.is_Checked) {
 						if (currCache.isAddiWpt()) {
 							// currCache.setBlack(!currCache.is_black());
 						} else {
@@ -295,18 +305,19 @@
 				tbp.refreshTable();
 			} finally {
 				Vm.showWait(false);
-			};
+			}
+			;
 		} else
 
-		if (selectedItem == miCenter){
+		if (selectedItem == miCenter) {
 			if (tbp.getSelectedCache() &lt; 0) {
 				Global.getPref().log(&quot;[myTableControl:popupMenuEvent] getSelectedCache() &lt; 0&quot;);
 				return;
 			}
 			CacheHolder thisCache = cacheDB.get(tbp.getSelectedCache());
-			CWPoint cp=new CWPoint(thisCache.getLatLon());
-			if (!cp.isValid()){
-				MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(4111,&quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;), FormBase.OKB);
+			CWPoint cp = new CWPoint(thisCache.getLatLon());
+			if (!cp.isValid()) {
+				MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(4111, &quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;), FormBase.OKB);
 				tmpMB.execute();
 			} else {
 				pref.setCurCentrePt(cp);
@@ -317,79 +328,128 @@
 			// This toggles the &quot;showAddis&quot; Flag
 			ch = cacheDB.get(tbp.getSelectedCache());
 			ch.setShowAddis(!ch.showAddis());
-			if (ch.addiWpts.size()&gt;0) {
+			if (ch.addiWpts.size() &gt; 0) {
 				tbp.refreshTable();
 			} else {
 				// This should never occur, as we check prior to activating the menu if the
 				// cache has addis. But just in case...
-				new MessageBox(MyLocale.getMsg(4201, &quot;Info&quot;), MyLocale.getMsg(1043, &quot;This cache has no additional waypoints.&quot;),FormBase.OKB).execute();
+				new MessageBox(MyLocale.getMsg(4201, &quot;Info&quot;), MyLocale.getMsg(1043, &quot;This cache has no additional waypoints.&quot;), FormBase.OKB).execute();
 			}
 		} else
 
-		if (selectedItem == miGoto){
+		if (selectedItem == miGoto) {
 			ch = cacheDB.get(tbp.getSelectedCache());
 			Global.mainTab.gotoP.setDestinationAndSwitch(ch);
 		} else
 
-		if (selectedItem == miOpenOnline){
-				ch = cacheDB.get(tbp.getSelectedCache());
-				CacheHolderDetail chD=ch.getCacheDetails(true);
-				if (chD != null) { callExternalProgram(pref.browser, chD.URL); }
+		if (selectedItem == miOpenOnline) {
+			ch = cacheDB.get(tbp.getSelectedCache());
+			CacheHolder mainCache = ch;
+			if (ch.isAddiWpt() &amp;&amp; (ch.mainCache != null)) {
+				mainCache = ch.mainCache;
+			}
+			CacheHolderDetail chD = mainCache.getCacheDetails(true);
+			String url = chD.URL;
+			if (clickedColumn == 14 &amp;&amp; mainCache.getOcCacheID().length() &gt; 0) {
+				if (!mainCache.getOcCacheID().startsWith(&quot;OC&quot;)) {
+					url = &quot;<A HREF="http://www.opencaching.de/viewcache.php?wp=">http://www.opencaching.de/viewcache.php?wp=</A>&quot; + mainCache.getOcCacheID().substring(1);
+				} else {
+					url = &quot;<A HREF="http://www.opencaching.de/viewcache.php?wp=">http://www.opencaching.de/viewcache.php?wp=</A>&quot; + mainCache.getOcCacheID();
+				}
+			}
+			if (url != null) {
+				callExternalProgram(pref.browser, url);
+			}
 		} else
 
 		if (selectedItem == miOpenGmaps) {
 			ch = cacheDB.get(tbp.getSelectedCache());
 			if (ch.pos.isValid()) {
-				String lat=&quot;&quot;+ch.pos.getLatDeg(CWPoint.DD);
-				String lon=&quot;&quot;+ch.pos.getLonDeg(CWPoint.DD);
-				String nameOfCache=ewe.net.URL.encodeURL(ch.cacheName,false).replace('#','N').replace('@','_');
-				String language=Vm.getLocale().getString(Locale.LANGUAGE_SHORT, 0, 0);
-				if (!pref.language.equalsIgnoreCase(&quot;auto&quot;)) {language=pref.language;}
-				String url=&quot;<A HREF="http://maps.google.">http://maps.google.</A>&quot;+language+&quot;/maps?q=&quot;+nameOfCache+&quot;@&quot;+lat+&quot;,&quot;+lon;
+				String lat = &quot;&quot; + ch.pos.getLatDeg(CWPoint.DD);
+				String lon = &quot;&quot; + ch.pos.getLonDeg(CWPoint.DD);
+				String nameOfCache = ewe.net.URL.encodeURL(ch.cacheName, false).replace('#', 'N').replace('@', '_');
+				String language = Vm.getLocale().getString(Locale.LANGUAGE_SHORT, 0, 0);
+				if (!pref.language.equalsIgnoreCase(&quot;auto&quot;)) {
+					language = pref.language;
+				}
+				String url = &quot;<A HREF="http://maps.google.">http://maps.google.</A>&quot; + language + &quot;/maps?q=&quot; + nameOfCache + &quot;@&quot; + lat + &quot;,&quot; + lon;
 				callExternalProgram(pref.browser, url);
-				url=&quot;<A HREF="http://www.geocaching.com/map/default.aspx?lat=">http://www.geocaching.com/map/default.aspx?lat=</A>&quot;+lat+&quot;&amp;lng=&quot;+lon;
+				url = &quot;<A HREF="http://www.geocaching.com/map/default.aspx?lat=">http://www.geocaching.com/map/default.aspx?lat=</A>&quot; + lat + &quot;&amp;lng=&quot; + lon;
 				callExternalProgram(pref.browser, url);
 			}
 		} else
 
 		if (selectedItem == miOpenOffline) {
-			ShowCacheInBrowser sc=new ShowCacheInBrowser();
+			ShowCacheInBrowser sc = new ShowCacheInBrowser();
 			sc.showCache(cacheDB.get(tbp.getSelectedCache()));
 		} else
 
-		if (selectedItem == miLogOnline){
-				ch = cacheDB.get(tbp.getSelectedCache());
-				CacheHolder mainCache = ch;
-				if (ch.isAddiWpt() &amp;&amp; (ch.mainCache != null)) {
-					mainCache = ch.mainCache;
-				}
-				if (mainCache.isCacheWpt()) {
-					CacheHolderDetail chD=mainCache.getCacheDetails(true);
-						if (chD != null) {
-							String URL = &quot;&quot;;
-							if (ch.isOC()) {
-								URL = chD.URL;
-								if (URL.indexOf(&quot;viewcache&quot;) &gt;= 0) {
-									URL = STRreplace.replace(URL, &quot;viewcache&quot;, &quot;log&quot;);
-								} else {
-									URL = &quot;&quot;;
+		if (selectedItem == miLogOnline) {
+			ch = cacheDB.get(tbp.getSelectedCache());
+			CacheHolder mainCache = ch;
+			if (ch.isAddiWpt() &amp;&amp; (ch.mainCache != null)) {
+				mainCache = ch.mainCache;
+			}
+			if (mainCache.isCacheWpt()) {
+				CacheHolderDetail chD = mainCache.getCacheDetails(true);
+				if (chD != null) {
+					String URL = &quot;&quot;;
+					String notes = chD.getCacheNotes();
+					if (notes.length() &gt; 0) {
+						Vm.setClipboardText(notes);
+					}
+					if (ch.isOC()) {
+						URL = chD.URL;
+						if (URL.indexOf(&quot;viewcache&quot;) &gt;= 0) {
+							URL = STRreplace.replace(URL, &quot;viewcache&quot;, &quot;log&quot;);
+						} else {
+							URL = &quot;&quot;;
+						}
+					} else {
+						if (chD.OwnLogId.length() &gt; 0 &amp;&amp; mainCache.getOcCacheID().startsWith(&quot;-&quot;)) {
+							URL = &quot;<A HREF="http://www.opencaching.de/log.php?wp=">http://www.opencaching.de/log.php?wp=</A>&quot; + mainCache.getOcCacheID().substring(1);
+							if (clickedColumn == 14) {
+								// take GC log direct to OC
+								if (OCGPXfetch.login()) {
+									String page = &quot;&quot;;
+									try {
+										page = UrlFetcher.fetch(URL);
+										String ocCacheId = new Extractor(page, &quot;viewcache.php?cacheid=&quot;, &quot;\&quot;&gt;&quot;, 0, true).findNext();
+										String postData = &quot;cacheid=&quot; + ocCacheId + &quot;&amp;version3=1&amp;descMode=3&amp;logtype=1&quot;;
+										Time logDate = DateFormat.toDate(chD.OwnLog.getDate());
+										postData += &quot;&amp;logday=&quot; + logDate.day;
+										postData += &quot;&amp;logmonth=&quot; + logDate.month;
+										postData += &quot;&amp;logyear=&quot; + logDate.year;
+										postData += &quot;&amp;logtext=&quot; + UrlFetcher.toUtf8Url(chD.OwnLog.getMessage());
+										postData += &quot;&amp;submitform=Log+eintragen&quot;;
+										UrlFetcher.setpostData(postData);
+										page = UrlFetcher.fetch(URL);
+										OCLinkImporter.updateOCLink(ch);
+										if (ch.getOcCacheID().startsWith(&quot;-&quot;)) {
+											ch.setOcCacheID(&quot;!&quot; + ch.getOcCacheID().substring(1));
+											ch.save();
+										}
+									} catch (IOException e) {
+										// dann nicht
+									}
 								}
+								URL = &quot;&quot;;
 							} else {
-								URL = &quot;<A HREF="http://www.geocaching.com/seek/log.aspx?ID=">http://www.geocaching.com/seek/log.aspx?ID=</A>&quot; + mainCache.GetCacheID();
+								// open OC logpage with GC Logtext in Clipboard
+								Vm.setClipboardText(chD.OwnLog.getDate() + '\n' + &quot;&lt;br&gt;&quot; + chD.OwnLog.getMessage());
 							}
+						} else
+							URL = &quot;<A HREF="http://www.geocaching.com/seek/log.aspx?ID=">http://www.geocaching.com/seek/log.aspx?ID=</A>&quot; + mainCache.GetCacheID();
+					}
 
-							if (URL.length() &gt; 0) {
-								String notes = chD.getCacheNotes();
-								if (notes.length() &gt; 0) {
-									Vm.setClipboardText(notes);
-								}
-								callExternalProgram(pref.browser, URL);
-							}
-						}
+					if (URL.length() &gt; 0) {
+						callExternalProgram(pref.browser, URL);
+					}
 				}
+			}
 		} else
 
-		if (selectedItem == miOpen){
+		if (selectedItem == miOpen) {
 			penDoubleClicked(null);
 		}
 
@@ -400,18 +460,16 @@
 	}
 
 	public void onEvent(Event ev) {
-		if (ev instanceof PenEvent &amp;&amp; (ev.type == PenEvent.PEN_DOWN) ){
-			Global.mainTab.tbP.myMod.penEventModifiers=((PenEvent)ev).modifiers;
-	    }
+		if (ev instanceof PenEvent &amp;&amp; (ev.type == PenEvent.PEN_DOWN)) {
+			Global.mainTab.tbP.myMod.penEventModifiers = ((PenEvent) ev).modifiers;
+		}
 
 		super.onEvent(ev);
 	}
 
 	/**
-	 * Adjusting the menu item for hiding or unhiding additional waypoints. If the cache has no
-	 * addis, then the menu is deactivated. If it has addis, then the menu text is adapted according
-	 * to the current value of the property &lt;code&gt;showAddis()&lt;/code&gt;.
-	 *
+	 * Adjusting the menu item for hiding or unhiding additional waypoints. If the cache has no addis, then the menu is deactivated. If it has addis, then the menu text is adapted according to the current value of the property &lt;code&gt;showAddis()&lt;/code&gt;.
+	 * 
 	 */
 	public void adjustAddiHideUnhideMenu() {
 		if (tbp.getSelectedCache() &lt; 0) {
@@ -437,97 +495,103 @@
 
 	// /////////////////////////////////////////////////
 	// Allow the caches to be dragged into a cachelist
-    ///////////////////////////////////////////////////
+	// /////////////////////////////////////////////////
 
 	IconAndText imgDrag;
 	String wayPoint;
 	int row;
 
 	public void startDragging(DragContext dc) {
-		 Point p=cellAtPoint(dc.start.x,dc.start.y,null);
-		 if (p==null) {super.startDragging(dc); return;}
-		 wayPoint=null;
-		 if (p.y&gt;=0) {
+		Point p = cellAtPoint(dc.start.x, dc.start.y, null);
+		if (p == null) {
+			super.startDragging(dc);
+			return;
+		}
+		wayPoint = null;
+		if (p.y &gt;= 0) {
 			if (!Global.mainForm.cacheListVisible) {
-				dc.cancelled=true;
+				dc.cancelled = true;
 				return;
 			}
-			 row=p.y;
-			 CacheHolder ch=cacheDB.get(p.y);
-			 wayPoint=ch.getWayPoint();
-			 imgDrag=new IconAndText();
-			 imgDrag.addColumn(CacheType.getTypeImage(ch.getType()));
-			 imgDrag.addColumn(ch.getWayPoint());
-			 dc.dragData=dc.startImageDrag(imgDrag,new Point(8,8),this);
-		 } else super.startDragging(dc);
-	 }
+			row = p.y;
+			CacheHolder ch = cacheDB.get(p.y);
+			wayPoint = ch.getWayPoint();
+			imgDrag = new IconAndText();
+			imgDrag.addColumn(CacheType.getTypeImage(ch.getType()));
+			imgDrag.addColumn(ch.getWayPoint());
+			dc.dragData = dc.startImageDrag(imgDrag, new Point(8, 8), this);
+		} else
+			super.startDragging(dc);
+	}
 
-	 public void stopDragging(DragContext dc) {
-		 if (wayPoint!=null &amp;&amp; !dc.cancelled) {
-			 dc.stopImageDrag(true);
-			 Point p = Gui.getPosInParent(this,getWindow());
-			 p.x += dc.curPoint.x;
-			 p.y += dc.curPoint.y;
-			 Control c = getWindow().findChild(p.x,p.y);
-		     if (c instanceof mList &amp;&amp; c.text.equals(&quot;CacheList&quot;)) {
-		    	 if (Global.mainForm.cacheList.addCache(wayPoint)) {
-		    		 c.repaintNow();
-		    		 ((mList) c).makeItemVisible(((mList)c).itemsSize()-1);
-		    	 }
-		     }
-		     Global.mainTab.tbP.selectRow(row);
-		 }else super.stopDragging(dc);
-	 }
+	public void stopDragging(DragContext dc) {
+		if (wayPoint != null &amp;&amp; !dc.cancelled) {
+			dc.stopImageDrag(true);
+			Point p = Gui.getPosInParent(this, getWindow());
+			p.x += dc.curPoint.x;
+			p.y += dc.curPoint.y;
+			Control c = getWindow().findChild(p.x, p.y);
+			if (c instanceof mList &amp;&amp; c.text.equals(&quot;CacheList&quot;)) {
+				if (Global.mainForm.cacheList.addCache(wayPoint)) {
+					c.repaintNow();
+					((mList) c).makeItemVisible(((mList) c).itemsSize() - 1);
+				}
+			}
+			Global.mainTab.tbP.selectRow(row);
+		} else
+			super.stopDragging(dc);
+	}
 
-	 public void dragged(DragContext dc) {
-	 	if (wayPoint!=null)
-		   dc.imageDrag();
-	 	else
-	 		super.dragged(dc);
-	 }
+	public void dragged(DragContext dc) {
+		if (wayPoint != null)
+			dc.imageDrag();
+		else
+			super.dragged(dc);
+	}
 
-	 public void cursorTo(int pRow,int pCol,boolean selectNew) {
-		if (pRow != -2 &amp;&amp; pCol != -2 &amp;&amp; !canSelect(pRow,pCol)) return;
-		cursor.set(pCol,pRow);
-		if (selectNew){
+	public void cursorTo(int pRow, int pCol, boolean selectNew) {
+		if (pRow != -2 &amp;&amp; pCol != -2 &amp;&amp; !canSelect(pRow, pCol))
+			return;
+		cursor.set(pCol, pRow);
+		if (selectNew) {
 			clearSelectedCells(oldExtendedSelection);
-			paintCells(null,oldExtendedSelection);
-			if (pRow != -2 &amp;&amp; pCol != -2){
-				if (scrollToVisible(pRow,pCol)) repaintNow();
-				addToSelection(Rect.buff.set(0,pRow,model.numCols,1),true);
-				//fireSelectionEvent(TableEvent.FLAG_SELECTED_BY_ARROWKEY);
+			paintCells(null, oldExtendedSelection);
+			if (pRow != -2 &amp;&amp; pCol != -2) {
+				if (scrollToVisible(pRow, pCol))
+					repaintNow();
+				addToSelection(Rect.buff.set(0, pRow, model.numCols, 1), true);
+				// fireSelectionEvent(TableEvent.FLAG_SELECTED_BY_ARROWKEY);
 				clickedFlags = TableEvent.FLAG_SELECTED_BY_ARROWKEY;
-				if (clickMode) clicked(pRow,pCol);
+				if (clickMode)
+					clicked(pRow, pCol);
 				clickedFlags = 0;
 			}
 		}
-	 }
+	}
 
-	 /**
-	  * this is only necessary to hinder the user to unselect
-	  */
-	 public void penReleased(Point p,boolean isDouble)
-	 {
-		 Point p2 = cellAtPoint(p.x,p.y,null);
-		 super.penReleased(p, isDouble);
-		 Rect sel = getSelection(null);
-		 if ((sel.height == 0 || sel.height == 0) &amp;&amp; p2 != null) cursorTo(p2.y,p2.x, true); // if the selection is gone -&gt; reselect it
+	/**
+	 * this is only necessary to hinder the user to unselect
+	 */
+	public void penReleased(Point p, boolean isDouble) {
+		Point p2 = cellAtPoint(p.x, p.y, null);
+		super.penReleased(p, isDouble);
+		Rect sel = getSelection(null);
+		if ((sel.height == 0 || sel.height == 0) &amp;&amp; p2 != null)
+			cursorTo(p2.y, p2.x, true); // if the selection is gone -&gt; reselect it
 
-	 }
+	}
 
-	 class myProgressBarForm extends ProgressBarForm {
+	class myProgressBarForm extends ProgressBarForm {
 
-		 boolean isClosed=false;
+		boolean isClosed = false;
 
-		 protected boolean canExit(int exitCode) {
-			isClosed=true;
+		protected boolean canExit(int exitCode) {
+			isClosed = true;
 			return true;
-		 }
+		}
 
-	 }
+	}
 
-
-
 	public Menu getMenuSmall() {
 		return mSmall;
 	}

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2011-05-11 23:04:45 UTC (rev 3000)
+++ trunk/src/CacheWolf/myTableModel.java	2011-05-12 20:42:00 UTC (rev 3001)
@@ -501,17 +501,18 @@
 			return false;
 		try {
 			// Check whether the click is on the checkbox image
+			tcControl.clickedColumn = colMap[cell.x];
 			if (cell.y &gt;= 0 &amp;&amp; colMap[cell.x] == 0) {
 				Global.getProfile().selectionChanged = true;
 				if ((penEventModifiers &amp; IKeys.SHIFT) &gt; 0) {
-					if (tcControl.cursor.y &gt;= 0) { // Second row being marked
-													// with shift key pressed
+					if (tcControl.cursor.y &gt;= 0) {
+						// Second row being marked with shift key pressed
 						if (tcControl.cursor.y &lt; cell.y)
 							toggleSelect(tcControl.cursor.y + 1, cell.y, cell.x);
 						else
 							toggleSelect(cell.y, tcControl.cursor.y - 1, cell.x);
-					} else { // Remember this row as start of range, but don't
-								// toggle yet
+					} else {
+						// Remember this row as start of range, but don't toggle yet
 					}
 				} else { // Single row marked
 					toggleSelect(cell.y, cell.y, cell.x);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002991.html">[Cachewolf-svn] r3000 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
</A></li>
	<LI>Next message: <A HREF="002994.html">[Cachewolf-svn] r3003 - in trunk/src/CacheWolf: . exp imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2992">[ date ]</a>
              <a href="thread.html#2992">[ thread ]</a>
              <a href="subject.html#2992">[ subject ]</a>
              <a href="author.html#2992">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
