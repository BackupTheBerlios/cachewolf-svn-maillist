From pfeffer at mail.berlios.de  Tue Apr  1 00:35:19 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 1 Apr 2008 00:35:19 +0200
Subject: [Cachewolf-svn] r1323 - trunk/src/CacheWolf
Message-ID: <200803312235.m2VMZJHn027074@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-01 00:35:13 +0200 (Tue, 01 Apr 2008)
New Revision: 1323

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Details: Bug fixed: they were not saved, if program was exited, choosing "dont save changes" --> this causes a problem, because the database becomes inconsitant: in the <cache>.xml the changes are saved anyway, but the same data is not saved in the index.xml

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-03-31 18:55:24 UTC (rev 1322)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-03-31 22:35:13 UTC (rev 1323)
@@ -514,6 +514,7 @@
 		  dirty_notes=false;
 		  dirty_details=false;
 		  setIsNew(false);
+		  thisCache.getCacheDetails(true).hasUnsavedChanges = true;
 		  
 		  // Global.mainTab.tbP.refreshTable(); this is done in mainTab.onLeavingPanel
 		  ////Vm.debug("New status updated!");



From bilbowolf at mail.berlios.de  Wed Apr  2 04:38:25 2008
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Wed, 2 Apr 2008 04:38:25 +0200
Subject: [Cachewolf-svn] r1324 - trunk/docs/CacheWolf Doku
Message-ID: <200804020238.m322cP4Q023595@sheep.berlios.de>

Author: bilbowolf
Date: 2008-04-02 04:38:22 +0200 (Wed, 02 Apr 2008)
New Revision: 1324

Removed:
   trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.html
Modified:
   trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml
   trunk/docs/CacheWolf Doku/ansichten.xml
   trunk/docs/CacheWolf Doku/benutzte_dateien.xml
   trunk/docs/CacheWolf Doku/menu.xml
Log:


Deleted: trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.html
===================================================================
--- trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.html	2008-03-31 22:35:13 UTC (rev 1323)
+++ trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.html	2008-04-02 02:38:22 UTC (rev 1324)
@@ -1,3 +0,0 @@
-<html><head>
-      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
-   <title>CacheWolf Dokumentation</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.70.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>CacheWolf Dokumentation</h1></div></div><hr></div><div class="toc"><dl><dt><span class="chapter"><a href="#d0e4">1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e34">1.1. Welche Cachewolf - Version f&uuml;r was?</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e38">1.1.1. Windows</a></span></dt><dt><span class="section"><a href="#d0e43">1.1.2. Java</a></span></dt><dt><span class="section"><a href="#d0e52">1.1.3. Pocket PC</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e111">1.1.3.1. Wichtige Information zur Nutzung von GPS Empf&auml;ngern</a></span></dt></dl></dd><dt><span class!
 ="section"><a href="#d0e127">1.1.4. Zaurus</a></span></dt></dl></dd></dl></dd></dl></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e4"></a>Chapter&nbsp;1.&nbsp;Installation</h2></div><div><div class="author"><h3 class="author"><span class="surname">Marc Schnitzler</span></h3></div></div><div><p class="releaseinfo">Review f&uuml;r Freigabe</p></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 0.1</td><td align="left">7. September 2007</td><td align="left"><span class="surname">Marc Schnitzler<br></span></td></tr><tr><td align="left" colspan="3"><p>Erster Entwurf, kopiert www.cachewolf.de</p></td></tr></table></div></div></div></div><p>Cachewolf ist verf&uuml;gbar in verschiedenen Versionen f&uuml;r Windows, Linux, PocketPC (ARM/PPC) und Zaurus. Die prim&auml;re Downloadseite i!
 st BerliOS, als Alternative kannst du dir den Cachewolf auch d!
 irekt un
ter <code class="uri">http://www.cachewolf.de/wiki/pmwiki.php/Main/Download</code> herunterladen.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e34"></a>1.1.&nbsp;Welche Cachewolf - Version f&uuml;r was?</h2></div></div></div><p></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e38"></a>1.1.1.&nbsp;Windows</h3></div></div></div><p>Hier ist die Installation sehr einfach. Einfach die .zip-Datei in ein Verzeichnis Deiner Wahl entpacken. Durch einen Doppelklick auf das CacheWolf Icon startet das Programm.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e43"></a>1.1.2.&nbsp;Java</h3></div></div></div><p>F&uuml;r den Einsatz der Java-Version ben&ouml;tigst du eine Java-Runtime in der Version 1.5 oder h&ouml;her. Diese bekommst du entweder direkt bei Sun oder &uuml;ber die Linux-eigene Paketverwaltung (SuSE: YaST,!
  Debian: apt-get,...).</p><p>&Uuml;ber die Kommandozeile startest du das Programm mittels: <code class="literal">java -jar "/Pfadzucachewolf/CacheWolf.jar" &amp;</code></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e52"></a>1.1.3.&nbsp;Pocket PC</h3></div></div></div><p>Der Cachewolf l&auml;uft auf PocketPC's &uuml;ber eine sogenannte virtuelle Maschine (EWE VM). Diese stellt die Grundlage aller Funktionen des CW dar und dadurch l&auml;uft er auf fast allen PocketPC's.</p><p>Es existieren zwei optimierte Versionen von Cachewolf f&uuml;r den PocketPC: f&uuml;r Ger&auml;te mit ARM-Prozessor und f&uuml;r Ger&auml;te mit Intel-Prozessor. Welche Version ben&ouml;tigt wird, kann man auch durch Probieren ermitteln. (Teilweise laufen auch beide Versionen.)</p><p>CacheWolf erkennt &uuml;brigens VGA-Ger&auml;te und stellt die Aufl&ouml;sung entsprechend ein.</p><table bgcolor="#FFFFCC"><tr><td><div class="highlights"><p>Aus der !
 FAQ:</p><p>Frage 3: Welche Version von CacheWolf ist die richt!
 ige f&uu
ml;r mein Pocket PC?</p><p>Antwort: Diese Frage ist leider nicht so einfach zu beantworten.</p><p>Auf dieser Seite www.pocketpc-users.de gibt es eine sehr gute Beschreibung.</p><p>Vielleicht hilft aber folgende (kurze) Zusammenfassung:</p><p>* Hast Du ein Pocket PC 2000 Ger&auml;t, dann benutzt es wahrscheinlich einen ARM (kompatiblen) Prozessor. Es gibt allerdings Ausnahmen, die einen SH3 oder MIPS Prozessor nutzen.</p><p>* Pocket PC 2002 und 2003 Ger&auml;te nutzen ausschlie&szlig; einen ARM (kompatiblen) Prozessor.</p><p>* Hast Du eine Ger&auml;t, da&szlig; Du in der zweiten H&auml;lfte 2004 gekauft hast, dann solltest Du die "PocketPC" Version von CacheWolf installieren. Beispiele (von Nutzern): PocketPCArm: XDA Trion, ASUS632,Yakumo Delta GPS, Loox N520, Compaq IPAQ 6915, Medion MDPPC250, FSC Loox N560, Dell Axim X51V, Yakumo DeltaX5BT, Acer N35 PocketPC: Loox N520, Mio Digi Walker P550 Zaurus: Sharp SL-C1000</p><p>Sagt dir das alles gar nichts probier einfach die Versi!
 onen durch - eine wird auf jeden Fall funktionieren!</p></div></td></tr></table><p>Die Installation ist ein mehrstufiger Prozess:</p><div class="itemizedlist"><ul type="disc"><li><p>Zuerst muss die EWE VM (Virtual Machine) installiert werden:</p><div class="itemizedlist"><ul type="circle"><li><p>EWE VM unter <code class="uri">http://www.ewesoft.com/Downloads/Downloads.html#_Toc105819897</code> herunterladen.</p><p>Hier darauf achten, die richtige Version ("Low Resolution" f&uuml;r normale PDA's oder "High Resolution" f&uuml;r VGA-PDA's zu laden.</p></li><li><p>Installation der VM wie unter dem Download Link beschrieben: die cab-Datei auf den PDA &uuml;bertragen (mittels Speicherkarte oder ActiveSync) und dann auf dem PDA ausf&uuml;hren.</p></li><li><p>Nach erfolgter Installation unter Start -&gt; Programme -&gt; EWE das Programm EWE starten. Damit werden noch notwendige Systemeintr&auml;ge gemacht und die VM ist nun funktionsf&auml;hig. Das Programm wieder schlie&szlig;en u!
 nd die Funktion &uuml;berpr&uuml;fen, indem eines der beiligen!
 den Prog
ramme (z.B. Solitaire) gestartet wird.</p></li></ul></div></li><li><p>Die entsprechende CacheWolf .zip-Datei auf dem PC entpacken.</p></li><li><p>Die ganzen Dateien dann auf den PocketPC in ein Verzeichnis deiner Wahl kopiert werden.</p></li><li><p>Nach dem Kopieren wird CacheWolf durch Klick auf die Cachewolf.exe gestartet.</p></li></ul></div><p></p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e111"></a>1.1.3.1.&nbsp;Wichtige Information zur Nutzung von GPS Empf&auml;ngern</h4></div></div></div><p>Bevor der Cachewolf sauber l&auml;uft gilt es, je nach PDA ein paar Hindernisse zu umschiffen (die aber nicht vom CW stammen!).</p><div class="orderedlist"><ol type="1"><li><p><span class="bold"><strong>Zugriff auf GPS:</strong></span> Solltest du neben dem CW noch weitere Software einsetzen (z.B. Navi-Software), die Zugriff auf das GPS haben will so kann es (je nach Software und PDA) vorkommen dass diese Software - einmal gestartet !
 - den Zugriff auf das GPS exklusiv nimmt und andere Programme das nachsehen haben (auch wenn z.B. die Navi-Software gerade nicht mehr l&auml;uft!) \\ Die L&ouml;sung besteht darin, das GPS-Signal zu splitten, was beispielsweise der VirtCommMgr kann.</p></li><li><p><span class="bold"><strong>Static Navigation:</strong></span> dies bezeichnet ein "Feature" f&uuml;r Navis, die die Routenf&uuml;hrung aussetzt wenn man sich langsamer als 6 km/h bewegt. F&uuml;rs cachen nat&uuml;rlich etwas doof, aber man kann es (ohne Nebenwirkungen f&uuml;r Navi-Software) abschalten - z.B. mittels des Programms SirfTech.</p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e127"></a>1.1.4.&nbsp;Zaurus</h3></div></div></div><p>Wie auch beim PocketPC ist die Installation ein mehrstufiger Prozess.</p><div class="itemizedlist"><ul type="disc"><li><p>Zuerst muss die EWE VM (Virtual Machine) installiert werden: Download hier: <cod!
 e class="uri">http://www.ewesoft.com/Downloads/Downloads.html#!
 _Toc105<
/code></p></li><li><p>F&uuml;r den Zaurus existiert eine .ipk-Datei, womit die Installation recht einfach ist.</p></li><li><p>Danach muss der Inhalt der CacheWolf .zip-Datei in ein Verzeichnis deiner Wahl auf den Zaurus &uuml;bertragen werden.</p></li><li><p>Das Programm wird mit CacheWolf.ewe gestartet.</p></li></ul></div></div></div></div></div></body></html>
\ No newline at end of file

Modified: trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml
===================================================================
--- trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml	2008-03-31 22:35:13 UTC (rev 1323)
+++ trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml	2008-04-02 02:38:22 UTC (rev 1324)
@@ -5,6 +5,7 @@
 <!ENTITY __DerersteStart__f6anus0g SYSTEM "Der%20erste%20Start.xml">
 <!ENTITY __ansichten__f6anvxip SYSTEM "ansichten.xml">
 <!ENTITY __menu__fay2x5r3 SYSTEM "menu.xml">
+<!ENTITY __benutzte_dateien__fe71ytbk SYSTEM "benutzte_dateien.xml">
 ]>
 <book>
   <title>CacheWolf Dokumentation</title>
@@ -14,7 +15,7 @@
 
     <productnumber>1.0</productnumber>
 
-    <pubdate>Ver?ffentlicht am 11.12.2008</pubdate>
+    <pubdate>Noch nicht ver?ffentlicht!</pubdate>
 
     <releaseinfo>Dieses Dokument in der Ausgabe 1.0 bezieht sich auf die
     CacheWolf Version 1.0.</releaseinfo>
@@ -27,4 +28,6 @@
   &__ansichten__f6anvxip;
 
   &__menu__fay2x5r3;
+
+  &__benutzte_dateien__fe71ytbk;
 </book>
\ No newline at end of file

Modified: trunk/docs/CacheWolf Doku/ansichten.xml
===================================================================
--- trunk/docs/CacheWolf Doku/ansichten.xml	2008-03-31 22:35:13 UTC (rev 1323)
+++ trunk/docs/CacheWolf Doku/ansichten.xml	2008-04-02 02:38:22 UTC (rev 1324)
@@ -515,7 +515,7 @@
   </section>
 
   <section>
-    <title>L?ser</title>
+    <title id="loeser">L?ser</title>
 
     <para>Der L?ser wurde geschaffen, um die bei uns beliebten
     "Rechne-Dir-einen-Wolf"-Multis zu erleichtern. Er hat viele Funktionen,

Modified: trunk/docs/CacheWolf Doku/benutzte_dateien.xml
===================================================================
--- trunk/docs/CacheWolf Doku/benutzte_dateien.xml	2008-03-31 22:35:13 UTC (rev 1323)
+++ trunk/docs/CacheWolf Doku/benutzte_dateien.xml	2008-04-02 02:38:22 UTC (rev 1324)
@@ -33,7 +33,7 @@
   <para></para>
 
   <section>
-    <title id="start">pref.xml</title>
+    <title>pref.xml</title>
 
     <para></para>
   </section>

Modified: trunk/docs/CacheWolf Doku/menu.xml
===================================================================
--- trunk/docs/CacheWolf Doku/menu.xml	2008-03-31 22:35:13 UTC (rev 1323)
+++ trunk/docs/CacheWolf Doku/menu.xml	2008-04-02 02:38:22 UTC (rev 1324)
@@ -116,6 +116,74 @@
       <title>Import</title>
 
       <para></para>
+
+      <section>
+        <title>Importiere GPX</title>
+
+        <para>Um an Geocaching.com GPX-Dateien zu kommen, muss man
+        Premium?Mitglied sein. Diese Dateien werden per Mail verschickt. Die
+        Dateien k?nnen einfach in ein Verzeichnis abgelegt werden. Die Dateien
+        m?ssen nicht entpackt werden.</para>
+
+        <para>Den Import startest Du durch anw?hlen von "Anwendung -&gt;
+        Importiere GPX". Du kannst eine Datei oder mit der Verwendung der
+        Umschalt - Taste mehrere Dateien ausw?hlen.</para>
+
+        <para>Nach der Wahl der Datei, die du importieren m?chtest, bekommst
+        du die Frage, ob Du auch Bilder und herunterladen m?chtest und ob
+        bereits gefundene Caches auch geladen werden sollen.</para>
+
+        <para><inlinemediaobject>
+            <imageobject>
+              <imagedata fileref="???" />
+            </imageobject>
+          </inlinemediaobject></para>
+
+        <para>Aktivierst du diese Option(en), solltest du eine bestehende
+        Verbindung ins Internet haben. Hast Du die Option "Bilder" angekreuzt
+        wird CacheWolf beim Einlesen der GPX?Datei auf der Cacheseite
+        nachschauen, ob Bilder in der Beschreibung bzw. ob Spoilerbilder
+        vorhanden sind. Diese werden heruntergeladen. Das Herunterladen von
+        Bildern ben?tigt etwas Zeit.</para>
+
+        <para><emphasis>Hinweis zu den Additional Waypoints:</emphasis> Leider
+        werden von geocaching.com in der GPX - Datei nur die "Additional
+        Waypoints" mitgeschickt, die auch eine g?ltige Koordinate haben. Das
+        Dilemma ist aber, dass bei den meisten Multis, diese Koordinaten erst
+        ermittelt werden m?ssen. Normalerweise stellt dies noch immer kein
+        Problem dar; aber einige Geocacher beschreiben die einzelnen Stationen
+        innerhalb der "Additional Waypoints", da diese aber keine Koordinaten
+        haben und nicht in der GPX Datei nicht mitgeschickt werden, fehlen
+        vitale Informationen. Dem kann aber abgeholfen werden: CacheWolf
+        bietet die M?glichkeit, einzelne Caches aktualisieren zu k?nnen und
+        hier werden auch die Additional Waypoints direkt von der Cacheseite
+        geladen, die keine Koordinaten haben (siehe <xref
+        linkend="markierte_akt" />).</para>
+      </section>
+
+      <section>
+        <title>Download von Opencaching.de</title>
+
+        <para></para>
+      </section>
+
+      <section>
+        <title>Spider von geocaching.com</title>
+
+        <para></para>
+      </section>
+
+      <section>
+        <title id="markierte_akt">Markierte aktualisieren</title>
+
+        <para></para>
+      </section>
+
+      <section>
+        <title>Always login to gc.com</title>
+
+        <para></para>
+      </section>
     </section>
 
     <section>
@@ -127,7 +195,20 @@
         <title id="zu_garmin" xreflabel="Export zu Garmin">Zu Garmin</title>
 
         <para>Dieser Men?eintrag ist nur dann Aktiv, wenn GPSBabel in dem
-        CacheWolf Verzeichnis gefunden wurde.</para>
+        CacheWolf Verzeichnis gefunden wurde. Von GPSBabel m?ssen die beiden
+        Dateien:</para>
+
+        <orderedlist>
+          <listitem>
+            <para>gpsbabel.exe, und</para>
+          </listitem>
+
+          <listitem>
+            <para>libexpat.dll</para>
+          </listitem>
+        </orderedlist>
+
+        <para>vorhanden sein.</para>
       </section>
     </section>
 
@@ -277,7 +358,7 @@
         befinden (Leider werden die Karten selbst in dem Verzeichnis nicht
         angezeigt). Wenn sich ebenfalls .map Deteien in dem Verzeichjnis
         befinden, wird CacheWolf diese Dateien zum Kalibrieren der
-        gleichnamigen Kartendatei verwenden. </para>
+        gleichnamigen Kartendatei verwenden.</para>
 
         <para><example>
             <title>Kartendatei mit zugeh?rige .map Datei</title>
@@ -287,7 +368,34 @@
 
         <para>Mit einer .map Datei meinen wir eine Datei im OziExplorer
         format: <ulink
-        url="http://www.rus-roads.ru/gps/help_ozi/map_file_format.html">http://www.rus-roads.ru/gps/help_ozi/map_file_format.html</ulink></para>
+        url="http://www.rus-roads.ru/gps/help_ozi/map_file_format.html">http://www.rus-roads.ru/gps/help_ozi/map_file_format.html</ulink>.
+        CacheWolf nutzt die Zeilen mit den Pr?fixen MMPXY und MMPLL; also
+        m?ssen insgesamt 8 Zeilen vorhanden sein: und zwar zuerst die MMPXY
+        zeilen und dann die MMPLL Zeilen.</para>
+
+        <example>
+          <title>Map Beispieldatei</title>
+
+          <para>MMPNUM,4</para>
+
+          <para>MMPXY,1,10,10</para>
+
+          <para>MMPXY,2,982,815</para>
+
+          <para>MMPXY,3,10,815</para>
+
+          <para>MMPXY,4,982,10</para>
+
+          <para>MMPLL,1, 12.966397, 50.827195</para>
+
+          <para>MMPLL,2, 13.009637, 50.801890</para>
+
+          <para>MMPLL,3, 12.964382, 50.803439</para>
+
+          <para>MMPLL,4, 13.011675, 50.825644</para>
+        </example>
+
+        <para></para>
       </section>
 
       <section>
@@ -296,27 +404,75 @@
         <para>Zum Kalibrieren einer Karte muss man f?r mindestens drei Punkte
         auf der Karte die GPS Koordinaten (WGS84, DMM) kennen. CacheWolf kann
         aber auch mit mehr Koordinaten arbeiten; dadurch wird die Kalibrierung
-        genauer. Durch klick auf Anwendung -&gt; Karten -&gt; Kalibrieren
-        erh?lt man folgendes Bild:</para>
+        genauer. Durch klick auf <literal>Anwendung -&gt; Karten -&gt;
+        Kalibrieren</literal> erh?lt man folgendes Bild:</para>
+
+        <para><inlinemediaobject>
+            <imageobject>
+              <imagedata fileref="pics/kalib.png" />
+            </imageobject>
+          </inlinemediaobject></para>
+
+        <para>Zum kalibrieren nun eine Karte aus der Liste "Nicht kalibrierte
+        Karten" ausw?hlen und auf "Laden" klicken. Danach erscheint die Karte
+        in einem neuen Fenster. Ich empfehle dieses Fenster auf die volle
+        Bildschirmgr??e zu vergr??ern.</para>
+
+        <para><inlinemediaobject>
+            <imageobject>
+              <imagedata fileref="pics/karte.png" />
+            </imageobject>
+          </inlinemediaobject></para>
+
+        <para>Jetzt musste Du f?r drei Punkte auf der Karte die GPS
+        Koordinaten eingeben. Hierzu einen entsprechenden Referenzpunkt mit
+        der Maus anklicken: an der Stelle wird ein rotes Kreuz auf der Karte
+        gezeichnet und ein Eingabefenster erscheint, um die Koordinaten
+        einzugeben (siehe <xref linkend="zentrum" />).</para>
+
+        <para>Nachdem Du drei Punkte angegeben hast wird Cachewolf ab dem
+        vierten Punkt die errechneten Koordinaten unterhalb der Karte
+        anzeigen:</para>
+
+        <para><inlinemediaobject>
+            <imageobject>
+              <imagedata fileref="pics/die_vierte.png" />
+            </imageobject>
+          </inlinemediaobject></para>
+
+        <para>Die Kalibrierung wird beendet durch einen klick auf den
+        "Fertig!" Knopf.</para>
+
+        <para>Du kannst die kalibrierung jederzeit erneuern in dem Du im
+        Kartenauswahlfenster einfach eine Karte aus der Liste "Kalibrierte
+        Karten" l?dst.</para>
+
+        <para>Die Karten werden angeiegt, wenn man in der Goto-Ansicht auf
+        "map" klickt oder in dem man in der Details-Ansicht auf die gr?n
+        angedeutete Weltkugel klickt.</para>
       </section>
     </section>
 
     <section>
       <title>Speichern</title>
 
-      <para></para>
+      <para>Notizen werden durch den Wechsel aus der Detailansicht sofort
+      gespeichert. Alle anderen ?nderungen, die man in der Detailansicht
+      (siehe <xref lang="" linkend="detailansicht" />) zu einem Cache werden
+      erst gespeichert, wenn man diese Men?option w?hlt.</para>
     </section>
 
     <section>
       <title>Speichern &amp; Beenden</title>
 
-      <para></para>
+      <para>Zus?tzlich zum Speichern, wird durch diesen Men?eintrag CacheWolf
+      beendet.</para>
     </section>
 
     <section>
       <title>Beenden</title>
 
-      <para></para>
+      <para>Beenden beendet CacheWolf!</para>
     </section>
   </section>
 
@@ -328,13 +484,19 @@
     <section>
       <title>Suchen</title>
 
-      <para></para>
+      <para>CacheWolf sucht im Namen und im Wegpunkt nach ?bereinstimmung zum
+      eingegebenen Suchbegriff. Es wird nach Bestandteilen gesucht und nicht
+      nach einer genauen! ?bereinstimmung. Das Ergebnis der Suche wird in der
+      Listenansicht dargestellt. Caches, die nicht passen werden
+      ausgeblendet!</para>
     </section>
 
     <section>
       <title>Suche aufheben</title>
 
-      <para></para>
+      <para>Weil Caches, die den Suchbegriff nicht erf?llen, ausgeblendet
+      werden, kann man alle Caches mit dieser Men?option wieder anzeigen
+      lassen.</para>
     </section>
   </section>
 
@@ -389,24 +551,43 @@
   <section>
     <title id="verwalten">Verwalten</title>
 
-    <para></para>
+    <para>Diese Men?gruppe stellt einige n?tzliche Funktionen zur
+    Massenverwaltung der ?Datenbank?, dem Profil. Es ist wichtig zu wissen,
+    dass diese Funktionen auf alle sichtbaren Caches in der Listenansicht
+    angewendet werden. Man muss also vorher mit dem Filter arbeiten, um die
+    Caches zu identifizieren, die man kopieren, l?schen oder verschieben
+    m?chte.</para>
 
     <section>
       <title>Kopieren</title>
 
-      <para></para>
+      <para>Mit dieser Funktion werden die Caches in der Listenansicht in ein
+      Zielverzeichnis kopiert. Die Caches bleiben allerdings in der Datenbank
+      (Profil) erhalten. In dem Zielverzeichnis befinden sich nach dem
+      Kopieren alle Cachebeschreibungen (\*.xml), Bilder zu den Caches und die
+      index.xml. Man hat also eine neue Datenbank erzeugt! Diese l?sst sich
+      durch die Einstellung in den Pr?ferenzen (oder in den Profilen)
+      ?ffnen.</para>
     </section>
 
     <section>
       <title>Verschieben</title>
 
-      <para></para>
+      <para>Mit dieser Funktion werden die Caches in der Listenansicht in ein
+      Zielverzeichnis verschoben. Die Caches werden aus der aktuellen
+      Datenbank (Profil) gel?scht. In dem Zielverzeichnis befinden sich nach
+      dem Verschieben alle Cachebeschreibungen (\*.xml), Bilder zu den Caches
+      und die index.xml. Man hat also einen neue Datenbank erzeugt! Diese
+      l?sst sich durch die Einstellung in den Pr?ferenzen (oder in den
+      Profilen) ?ffnen.</para>
     </section>
 
     <section>
       <title>L?schen</title>
 
-      <para></para>
+      <para>Mit dieser Funktion werden die Caches in der aktuellen Datenbank
+      unwiderruflich gel?scht. Man kann also mit dieser Funktion Speicherplatz
+      frei machen.</para>
     </section>
 
     <section>
@@ -425,6 +606,39 @@
   <section>
     <title>?ber</title>
 
-    <para></para>
+    <section>
+      <title>?ber</title>
+
+      <para>Eine kleine Einf?hrung in CacheWolf und wer die Software
+      geschrieben hat.</para>
+    </section>
+
+    <section>
+      <title>Legende</title>
+
+      <para>Anzeigen der Legende der Farben und Symbole</para>
+    </section>
+
+    <section>
+      <title>WolfLanguage</title>
+
+      <para>Dieser Men?punkt ?ffnet eine Hilfeseite f?r die im L?ser
+      verf?gbaren Kommandos (bekommt man ?brigens auch direkt in der <xref
+      linkend="loeser" /> Ansicht).</para>
+    </section>
+
+    <section>
+      <title>System</title>
+
+      <para>Dieser Men?punkt zeigt eine Auswahl von Systeminformationen. Diese
+      sind f?r den Support wichtig.</para>
+    </section>
+
+    <section>
+      <title>Version Pr?fen</title>
+
+      <para>Pr?ft auf neue Versionen von cacheWolf (Internetverbindung
+      notwendig!)</para>
+    </section>
   </section>
 </chapter>
\ No newline at end of file



From bilbowolf at mail.berlios.de  Wed Apr  2 04:49:44 2008
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Wed, 2 Apr 2008 04:49:44 +0200
Subject: [Cachewolf-svn] r1325 - trunk/docs/CacheWolf Doku/pics
Message-ID: <200804020249.m322niB2024135@sheep.berlios.de>

Author: bilbowolf
Date: 2008-04-02 04:49:00 +0200 (Wed, 02 Apr 2008)
New Revision: 1325

Added:
   trunk/docs/CacheWolf Doku/pics/die_vierte.png
   trunk/docs/CacheWolf Doku/pics/kalib.png
   trunk/docs/CacheWolf Doku/pics/karte.png
   trunk/docs/CacheWolf Doku/pics/karte_mit_eingabe.png
Log:


Added: trunk/docs/CacheWolf Doku/pics/die_vierte.png
===================================================================
(Binary files differ)


Property changes on: trunk/docs/CacheWolf Doku/pics/die_vierte.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/docs/CacheWolf Doku/pics/kalib.png
===================================================================
(Binary files differ)


Property changes on: trunk/docs/CacheWolf Doku/pics/kalib.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/docs/CacheWolf Doku/pics/karte.png
===================================================================
(Binary files differ)


Property changes on: trunk/docs/CacheWolf Doku/pics/karte.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/docs/CacheWolf Doku/pics/karte_mit_eingabe.png
===================================================================
(Binary files differ)


Property changes on: trunk/docs/CacheWolf Doku/pics/karte_mit_eingabe.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From mik77 at mail.berlios.de  Thu Apr  3 12:56:21 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 3 Apr 2008 12:56:21 +0200
Subject: [Cachewolf-svn] r1326 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804031056.m33AuLpS023986@sheep.berlios.de>

Author: mik77
Date: 2008-04-03 12:56:02 +0200 (Thu, 03 Apr 2008)
New Revision: 1326

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MainTab.java
Log:
- Added "New Waypoint" to "Organise" menu on MainTab
- "New Waypoint" on DetailsPanel now creates an Addi Wpt by default

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-02 02:49:00 UTC (rev 1325)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-03 10:56:02 UTC (rev 1326)
@@ -103,6 +103,7 @@
 		211=%0aDavon hinzugef%fcgt:+  
 		212=Alle .xml Dateien (und Bilder) l%f6schen, die nicht in index.xml sind
 		213=Verwaiste .xml Dateien l%f6schen
+		214=Neuer Wegpunkt
 		300=Type:
 		301=Gr%f6%dfe:
 		302=Wegpunkt:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-02 02:49:00 UTC (rev 1325)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-03 10:56:02 UTC (rev 1326)
@@ -103,6 +103,7 @@
 		211=%0aThereof added:+  
 		212=Delete all .xml files not in index.xml and associated pictures
 		213=Deleting orphans
+		214=New Waypoint
 		300=Type:
 		301=Size:
 		302=Waypoint:

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2008-04-02 02:49:00 UTC (rev 1325)
+++ trunk/res_noewe/languages/NL.cfg	2008-04-03 10:56:02 UTC (rev 1326)
@@ -95,6 +95,7 @@
 		204=Oplosser
 		205=Radar
 		206=Lijst
+		214=Nieuwe Waypoint
 		300=Type:
 		301=Grote:
 		302=Waypoint:

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-04-02 02:49:00 UTC (rev 1325)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-04-03 10:56:02 UTC (rev 1326)
@@ -33,7 +33,7 @@
 	private boolean dirty_details = false;
 	private boolean blackStatus = false;
 	private boolean blackStatusChanged=false;
-	private boolean isNewWpt = false;
+	private boolean needsTableUpdate = false;
 	
 	Preferences pref; // Test
 	Profile profile;
@@ -146,16 +146,16 @@
 		attV.clear();
 	}
 
-	public void setIsNew(boolean isnew) {
-		isNewWpt = isnew;
+	public void setNeedsTableUpdate(boolean tableUpdate) {
+		needsTableUpdate = tableUpdate;
 	}
 	
-	public boolean isNew() {
-		return isNewWpt;
+	public boolean needsTableUpdate() {
+		return needsTableUpdate;
 	}
 	
 	public boolean isDirty() {
-		return dirty_notes || dirty_details || isNewWpt;
+		return dirty_notes || dirty_details || needsTableUpdate;
 	}
 	public boolean hasBlackStatusChanged() {
 		return blackStatusChanged;
@@ -312,6 +312,7 @@
 	public void onEvent(Event ev){
 		if (ev instanceof DataChangeEvent ) {
 			dirty_details = true;
+			needsTableUpdate  = true;
 			profile.hasUnsavedChanges=true;
 			if (ev.target==chcType) {
 				createWptName();
@@ -380,7 +381,11 @@
 				blackStatusChanged=true;
 			}
 			else if (ev.target == btnNewWpt){
-				Global.mainTab.newWaypoint(new CacheHolder());
+				CacheHolder ch = new CacheHolder();
+				ch.LatLon = thisCache.LatLon;
+				ch.pos = new CWPoint( thisCache.pos );
+				ch.type = "51";
+				Global.mainTab.newWaypoint(ch);
 			}
 			else if (ev.target == btnGoto){
 				// TODO if something changed saveWpt();
@@ -513,7 +518,7 @@
 		  ch.setAttributesToAddiWpts();
 		  dirty_notes=false;
 		  dirty_details=false;
-		  setIsNew(false);
+		  setNeedsTableUpdate(false);
 		  thisCache.getCacheDetails(true).hasUnsavedChanges = true;
 		  
 		  // Global.mainTab.tbP.refreshTable(); this is done in mainTab.onLeavingPanel
@@ -597,10 +602,7 @@
 				} else 
 					super.popupMenuEvent(selectedItem);
 			}
-		}
-
-	
+		}	
 	}
 
-
 }

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-02 02:49:00 UTC (rev 1325)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-03 10:56:02 UTC (rev 1326)
@@ -31,7 +31,7 @@
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
 	private MenuItem exportGPS, exportCacheMate,mnuSeparator;
-	private MenuItem orgCopy, orgMove, orgDelete,orgRebuild;
+	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild;
 	public MenuItem filtCacheTour,orgTravelbugs, mnuForceLogin;
 	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditCenter;
 	private Form father;
@@ -168,13 +168,14 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Organise" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] organiseMenuItems=new MenuItem[6];
-		organiseMenuItems[0] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy")); 
-		organiseMenuItems[1] = orgMove  = new MenuItem(MyLocale.getMsg(142,"Move")); 
-		organiseMenuItems[2] = orgDelete   = new MenuItem(MyLocale.getMsg(143,"Delete"));
-		organiseMenuItems[3] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,"Rebuild Index"));
-		organiseMenuItems[4] = mnuSeparator;
-		organiseMenuItems[5] = orgTravelbugs = new MenuItem(MyLocale.getMsg(139,"Manage travelbugs"));
+		MenuItem[] organiseMenuItems=new MenuItem[7];
+		organiseMenuItems[0] = orgNewWP = new MenuItem(MyLocale.getMsg(214,"New Waypoint"));
+		organiseMenuItems[1] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy")); 
+		organiseMenuItems[2] = orgMove  = new MenuItem(MyLocale.getMsg(142,"Move")); 
+		organiseMenuItems[3] = orgDelete   = new MenuItem(MyLocale.getMsg(143,"Delete"));
+		organiseMenuItems[4] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,"Rebuild Index"));
+		organiseMenuItems[5] = mnuSeparator;
+		organiseMenuItems[6] = orgTravelbugs = new MenuItem(MyLocale.getMsg(139,"Manage travelbugs"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(140,"Organise"),new Menu(organiseMenuItems,null)));
 
 		///////////////////////////////////////////////////////////////////////
@@ -530,6 +531,11 @@
 			///////////////////////////////////////////////////////////////////////
 			// "Organise" pulldown menu
 			///////////////////////////////////////////////////////////////////////
+			if(mev.selectedItem == orgNewWP){
+				Global.mainTab.lastselected = ((CacheHolder)cacheDB.get(Global.mainTab.tbP.getSelectedCache())).wayPoint;
+				Global.mainTab.newWaypoint(new CacheHolder());
+			}
+
 			if(mev.selectedItem == orgCopy){
 				profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 				DataMover dm = new DataMover();

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-04-02 02:49:00 UTC (rev 1325)
+++ trunk/src/CacheWolf/MainTab.java	2008-04-03 10:56:02 UTC (rev 1326)
@@ -155,9 +155,9 @@
 			// Update chD with Details
 			if(detP.isDirty()) {
 				cacheDirty=true;
-				boolean isNew = detP.isNew();
+				boolean needTableUpdate = detP.needsTableUpdate();
 				detP.saveDirtyWaypoint();
-				if (isNew) {
+				if (needTableUpdate) {
 					tbP.myMod.updateRows();// This sorts the waypoint (if it is new) into the right position
 					tbP.selectRow(profile.getCacheIndex(detP.thisCache.wayPoint));
 				}
@@ -300,8 +300,13 @@
 	 */
 	public void newWaypoint(CacheHolder ch){
 		//When creating a new waypoint, simulate a change to the list view
-		onLeavingPanel(oldCard);
+		//if we are currently NOT in the list view
+		if (oldCard != 0)
+		{
+			onLeavingPanel(oldCard);
+		}
 		updatePendingChanges(); // was: onEnteringPanel(0); oldCard=0;
+		
 		mainCache=lastselected;
 		int selectedIndex = profile.getCacheIndex( lastselected );
 		if (selectedIndex >= 0) {
@@ -311,7 +316,7 @@
 			}			
 		}
 		Global.getProfile().hasUnsavedChanges=true;
-		detP.setIsNew(true);
+		detP.setNeedsTableUpdate(true);
 		if (ch.type == null || ch.type.equals("")) ch.type = "0";
 		if (CacheType.isAddiWpt(ch.type) && mainCache!=null && mainCache.length()>2) {
 			ch.wayPoint = profile.getNewAddiWayPointName(mainCache);
@@ -328,7 +333,7 @@
 		tbP.myMod.numRows++;
 		detP.setDetails(ch);
 		oldCard=1;
-		if (this.cardPanel.selectedItem !=1) select(detP);
+		if (this.cardPanel.selectedItem != 1) select(detP);
 		solverP.setInstructions("");
 		//tbP.refreshTable(); // moved this instruction to onLeavingPanel
 
@@ -416,3 +421,5 @@
 }
 // 
 
+
+



From salzkammergut at mail.berlios.de  Sat Apr  5 00:18:39 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 5 Apr 2008 00:18:39 +0200
Subject: [Cachewolf-svn] r1327 - trunk/src/CacheWolf
Message-ID: <200804042218.m34MId4N005906@sheep.berlios.de>

Author: salzkammergut
Date: 2008-04-05 00:18:33 +0200 (Sat, 05 Apr 2008)
New Revision: 1327

Modified:
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/Tokenizer.java
Log:
Parser: Bugfix. Comparison with > was not done correctly

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2008-04-03 10:56:02 UTC (rev 1326)
+++ trunk/src/CacheWolf/Parser.java	2008-04-04 22:18:33 UTC (rev 1327)
@@ -798,8 +798,15 @@
 			parseStringExp();
 			checkNextSymIs("THEN");
 			getNextTokenOtherThanSemi();
-			// If the first expression is a string, compare as string.
-			if (calcStack.get(calcStack.size()-2) instanceof String) {
+			boolean compAsString=false; //calcStack.get(calcStack.size()-2) instanceof String;
+			// If we can parse the first argument as a double, we will do a numeric comparison
+			try {
+				Common.parseDoubleException((String)calcStack.get(calcStack.size()-2) );
+			} catch (Exception ex) {
+				compAsString=true;
+			}
+			// If the first expression is not a double, compare as string.
+			if (compAsString) {
 				String b=popCalcStackAsString();
 				String a=popCalcStackAsString();
 				switch (compOp) {

Modified: trunk/src/CacheWolf/Tokenizer.java
===================================================================
--- trunk/src/CacheWolf/Tokenizer.java	2008-04-03 10:56:02 UTC (rev 1326)
+++ trunk/src/CacheWolf/Tokenizer.java	2008-04-04 22:18:33 UTC (rev 1327)
@@ -193,7 +193,7 @@
 			currentStream=currentStream.substring(0,1);
 			if (currentStream.equals("=")) emitToken(TokenObj.TT_EQ);
 			else if (currentStream.equals("<")) emitToken(TokenObj.TT_LT);
-			else if (currentStream.equals(">")) emitToken(TokenObj.TT_LT);
+			else if (currentStream.equals(">")) emitToken(TokenObj.TT_GT);
 			else emitToken(TokenObj.TT_SYMBOL);
 		} else
 			emitToken(TokenObj.TT_SYMBOL); 		



From engywuck at mail.berlios.de  Sat Apr  5 16:02:26 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sat, 5 Apr 2008 16:02:26 +0200
Subject: [Cachewolf-svn] r1328 - trunk/docs
Message-ID: <200804051402.m35E2QPA011224@sheep.berlios.de>

Author: engywuck
Date: 2008-04-05 16:02:24 +0200 (Sat, 05 Apr 2008)
New Revision: 1328

Added:
   trunk/docs/CW mit Eclipse.txt
Log:
Added document how to start CW in Eclipse.

Added: trunk/docs/CW mit Eclipse.txt
===================================================================
--- trunk/docs/CW mit Eclipse.txt	2008-04-04 22:18:33 UTC (rev 1327)
+++ trunk/docs/CW mit Eclipse.txt	2008-04-05 14:02:24 UTC (rev 1328)
@@ -0,0 +1,46 @@
+?How to build your own development environment for CacheWolf
+===========================================================
+
+It is quite easy. All you need is 
+1. a java compiler (javac from sun or gcj)
+2. a svn client
+3. if you want comfortable programming: an integrated development environment (IDE). We recommend to use Eclipse.
+
+For most easy installing, you can use the package "EasyEclipse Desktop" as it contains all 3 items in one installation package and is available for Windows, Linux and MacOS. (In eclipse the plugin "subclipse" is the svn client)
+
+Steps:
+
+1. goto http://www.easyeclipse.org/site/distributions/index.html and download the newest "EasyEclipse for java" (any version should work, I used "EasyEclipse Desktop v1.3.1.1").
+
+2. install it.
+
+3. start eclipse, you will be asked for an directory name where to store eclipse projects. Select / create an directory in your home dir. 
+
+4. In eclipse create a new projet from svn: 
+a) click: File -> new -> Projet, 
+b) select SVN, and "Check out projects from SVN" -> next
+c) select "Create a new repositoy location" -> next
+d) enter: http://svn.berlios.de/svnroot/repos/cachewolf -> next
+e) wait until the directories appear, select the first item, ending with "trunk" -> next
+f) select "Check out as project using new project wizard" 
+g) new project wizard appears. Select Java Project and enter a project name, e.g. "cachewolf" -> finish, wait until all the source code and supplemental programs from the svn is downloaded
+h) if you still see the "welcome screen" click on "workbench"
+
+5. Now we need to configure the project. Therefore:
+a) Click in the menu: project -> properties -> Run/Debug Settings, Click "New..." and choose "Java Application"
+b) In the "Name" field enter "CacheWolf" (or any other name that is convenient)
+c) in field "Main Class" enter "Ewe"
+d) click on the tab "Arguments" and enter as "Program arguments" "CacheWolf.CacheWolf", und "working directory" select "other", click on button "workspace" and select "work" -> ok.
+e) click on the tab "classpath", select "user entries" and remove all entries below.
+f) select "user entries", "Add projects", select "Cachewolf" -> ok
+g) select "user entries" and click on button "add JARs", select cachewolf/lib/JavaEwe.zip -> ok.
+h) select "user entries" and click on "Advanced", keep "Add Folder", click "Ok", select cachewolf/lib
+i) Click ok till all windows are closed.
+
+6. copy the needed ressources into the working directory by double clicking on getres.bat or getres.sh on the filemanager (windows exploprer)
+
+7. to compile and run cachewolf click in the menu in eclipse the menu run -> run or click the "play" icon or press ctrl-f11.
+
+*******************************************************************
+Last edited: $Date$
+*******************************************************************
\ No newline at end of file


Property changes on: trunk/docs/CW mit Eclipse.txt
___________________________________________________________________
Name: svn:keywords
   + Date



From mik77 at mail.berlios.de  Sat Apr  5 17:05:34 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 5 Apr 2008 17:05:34 +0200
Subject: [Cachewolf-svn] r1329 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804051505.m35F5YnD017053@sheep.berlios.de>

Author: mik77
Date: 2008-04-05 17:05:30 +0200 (Sat, 05 Apr 2008)
New Revision: 1329

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/NewProfileForm.java
Log:
Ask for center coordinates when creating a new profile.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-05 14:02:24 UTC (rev 1328)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-05 15:05:30 UTC (rev 1329)
@@ -306,6 +306,9 @@
 		1119=Alte Profile
 		1120=Schwier
 		1121=Gel%e4nde
+		1122='maps' ist f%fcr das Kartenverzeichnis reserviert.
+		1123=Zur Festlegung der Zentrumskoordinaten dieses Profils, klicken Sie auf "Weiter".
+		1124=Weiter
 		1200=Liste
 		1201=Details
 		1202=Beschreibung

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-05 14:02:24 UTC (rev 1328)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-05 15:05:30 UTC (rev 1329)
@@ -307,6 +307,9 @@
 		1119=Old Profiles
 		1120=Diff
 		1121=Terr
+		1122='maps' is reserved for the maps directory.
+		1123=Click "Next" to define the center coordinates for this profile.
+		1124=Next
 		1200=List
 		1201=Details
 		1202=Description

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-05 14:02:24 UTC (rev 1328)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-05 15:05:30 UTC (rev 1329)
@@ -236,11 +236,19 @@
 				Global.mainTab.saveUnsavedChanges(true);
 				NewProfileForm f=new NewProfileForm(pref.baseDir);
 				int code=f.execute(getFrame(), Gui.CENTER_FRAME);
-				if (code==0) { 
+				if (code==0) {
 					profile.clearProfile(); 
 					pref.lastProfile=profile.name=f.profileDir;
 					pref.savePreferences(); // Remember that this was the last profile used
 					profile.dataDir=pref.baseDir+f.profileDir+"/";
+					
+					CoordsScreen cs = new CoordsScreen();
+					cs.setFields(new CWPoint(), CWPoint.CW);
+					if (cs.execute() == FormBase.IDOK) {
+						profile.centre.set(cs.getCoords());
+						profile.hasUnsavedChanges=true;
+					}
+
 					Filter.showBlacklisted=false;
 					filtBlack.modifiers&=~MenuItem.Checked;
 					tbp.refreshTable();

Modified: trunk/src/CacheWolf/NewProfileForm.java
===================================================================
--- trunk/src/CacheWolf/NewProfileForm.java	2008-04-05 14:02:24 UTC (rev 1328)
+++ trunk/src/CacheWolf/NewProfileForm.java	2008-04-05 15:05:30 UTC (rev 1329)
@@ -1,17 +1,12 @@
 package CacheWolf;
 
 import ewe.io.File;
-import ewe.ui.ControlEvent;
-import ewe.ui.Event;
-import ewe.ui.Form;
-import ewe.ui.IKeys;
-import ewe.ui.MessageBox;
-import ewe.ui.mButton;
-import ewe.ui.mInput;
+import ewe.ui.*;
 
 public class NewProfileForm extends Form {
 	private mButton btnCancel,btnOK;
 	private mInput inpDir;
+	private TextMessage description;
 	public String profileDir;
 	private String baseDir;
 	//private Profile profile;
@@ -21,13 +16,16 @@
 		//profile=prof;
         title = MyLocale.getMsg(1111,"Create new profile:");
 		addLast(inpDir=new mInput(MyLocale.getMsg(1112,"New profile name")),HSTRETCH,HFILL|LEFT);
+		description = new TextMessage(MyLocale.getMsg(1123,"Click 'Next' to define the center coordinates for this profile."));
+		description.setPreferredSize(240, -1);
+		addLast(description,HSTRETCH,HFILL|LEFT);
 		btnCancel = new mButton(MyLocale.getMsg(708,"Cancel"));
 		btnCancel.setHotKey(0, IKeys.ESCAPE);
 		addNext(btnCancel,HSTRETCH,LEFT);
-		btnOK = new mButton(MyLocale.getMsg(1605,"OK"));
+		btnOK = new mButton(MyLocale.getMsg(1124,"Next"));
 		btnOK.setHotKey(0, IKeys.ENTER);
 		addLast(btnOK,HSTRETCH,HFILL|RIGHT);
-		this.setPreferredSize(240,50);
+		this.setPreferredSize(240,80);
 		this.baseDir=baseDir;
 	}
 	
@@ -38,21 +36,27 @@
 			}
 			if (ev.target == btnOK){
 				profileDir=inpDir.getDisplayText();
-				File f=new File(baseDir+profileDir);
-				if (f.exists()) {
-					MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1114,"Directory exists already."),MBOK);
+				if (profileDir.equalsIgnoreCase("maps")) {
+					MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1122,"'maps' is reserved for the maps directory."),MBOK);
 					mb.execute();
 					profileDir="";
 				} else {
-					if (profileDir.indexOf("/")>=0 || profileDir.indexOf("\\")>=0 || !f.createDir()) {
-						MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1113,"Cannot create directory"),MBOK);
+					File f=new File(baseDir+profileDir);
+					if (f.exists()) {
+						MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1114,"Directory exists already."),MBOK);
 						mb.execute();
 						profileDir="";
-						this.close(-1);
+					} else {
+						if (profileDir.indexOf("/")>=0 || profileDir.indexOf("\\")>=0 || !f.createDir()) {
+							MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1113,"Cannot create directory"),MBOK);
+							mb.execute();
+							profileDir="";
+							this.close(-1);
+						}
+						Global.getProfile().filterActive=Filter.FILTER_INACTIVE;
+						Global.getProfile().filterInverted=false;
+						this.close(0);
 					}
-					Global.getProfile().filterActive=Filter.FILTER_INACTIVE;
-					Global.getProfile().filterInverted=false;
-					this.close(0);
 				}
 			}
 		}



From mik77 at mail.berlios.de  Sat Apr  5 17:22:10 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 5 Apr 2008 17:22:10 +0200
Subject: [Cachewolf-svn] r1330 - trunk/src/CacheWolf/navi
Message-ID: <200804051522.m35FMAlk018275@sheep.berlios.de>

Author: mik77
Date: 2008-04-05 17:22:08 +0200 (Sat, 05 Apr 2008)
New Revision: 1330

Modified:
   trunk/src/CacheWolf/navi/TrackOverlay.java
Log:
Reduce shown trackpoints (halve after 5, 15 and 30 minutes) for better map performance.
(Just a workaround till we find a better solution)

Modified: trunk/src/CacheWolf/navi/TrackOverlay.java
===================================================================
--- trunk/src/CacheWolf/navi/TrackOverlay.java	2008-04-05 15:05:30 UTC (rev 1329)
+++ trunk/src/CacheWolf/navi/TrackOverlay.java	2008-04-05 15:22:08 UTC (rev 1330)
@@ -97,8 +97,9 @@
 			if (tr.num > 0) {
 				for (i=0; i < tr.num; i++) {
 					n++;
-					if  ((numberOfPoints - n > 30*60) && ((n & 1) == 0)) continue;
-					if  ((numberOfPoints - n > 60*60) && ((n & 2) == 0)) continue;
+					if  ((numberOfPoints - n > 5*60) && ((n & 1) == 0)) continue;
+					if  ((numberOfPoints - n > 15*60) && ((n & 2) == 0)) continue;
+					if  ((numberOfPoints - n > 30*60) && ((n & 4) == 0)) continue;
 					paintPoint(tr.trackColor, tr.TrackPoints[i]);
 				}
 			}



From mik77 at mail.berlios.de  Sat Apr  5 23:25:29 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 5 Apr 2008 23:25:29 +0200
Subject: [Cachewolf-svn] r1331 - trunk/src/CacheWolf/navi
Message-ID: <200804052125.m35LPTnW003661@sheep.berlios.de>

Author: mik77
Date: 2008-04-05 23:25:26 +0200 (Sat, 05 Apr 2008)
New Revision: 1331

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Removed unnecessary calculations.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2008-04-05 15:22:08 UTC (rev 1330)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2008-04-05 21:25:26 UTC (rev 1331)
@@ -276,14 +276,10 @@
 					dd.value = dd.value * 1000; 
 					dd.decimalPlaces = 0;
 					d = MyLocale.getMsg(4206, "Dist: ") + dd.toString() + "m";
-					int digits = (int)java.lang.Math.floor( java.lang.Math.log(dd.value) / java.lang.Math.log(10.0) );
-					digits = java.lang.Math.max(0, digits);
 				} 
 				else {
 					dd.decimalPlaces = 2;
 					d = MyLocale.getMsg(4206, "Dist: ") + dd.toString() + "km";
-					int digits = (int)java.lang.Math.floor( java.lang.Math.log(dd.value) / java.lang.Math.log(10.0) );
-					digits = java.lang.Math.max(0, digits);
 				}
 				
 				int backgroundWidth = fm.getTextWidth(d) + 4;



From pfeffer at mail.berlios.de  Sun Apr  6 16:06:12 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 6 Apr 2008 16:06:12 +0200
Subject: [Cachewolf-svn] r1332 - trunk/src/CacheWolf/navi
Message-ID: <200804061406.m36E6CaH019534@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-06 16:06:11 +0200 (Sun, 06 Apr 2008)
New Revision: 1332

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
Expedia Map Downloader: dirty fix for Teneriffa not correctly calibrated, see http://www.geoclub.de/viewtopic.php?f=40&t=23553

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2008-04-05 21:25:26 UTC (rev 1331)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2008-04-06 14:06:11 UTC (rev 1332)
@@ -671,7 +671,8 @@
 	public String getUrlForCenterScale(CWPoint center, float scale, Point pixelsize) {
 		int zoomlevel = getZoomlevel(scale);
 		String zone;
-		if (center.lonDec <= -10) zone = "USA0409";
+		if (     (center.lonDec <= -30   && center.lonDec >= -170) || 
+				( center.lonDec > 360-30 && center.lonDec <= 360-170) ) zone = "USA0409"; // TODO test which zone-code ist best for asia
 		else zone = "EUR0809";
 		String quelle = MainUrl + "&CenP=" + center.toString(CWPoint.LAT_LON);
 		quelle = quelle + "&Alti="+Convert.toString(zoomlevel)+"&Lang="+zone+"&Size="+Convert.toString(pixelsize.x)+","+Convert.toString(pixelsize.y)+"&Offs=0,0&MapS=0"; //&Pins=|" + latD.toString().replace(',', '.') + "," + lonD.toString().replace(',', '.') + "|5|";



From pfeffer at mail.berlios.de  Sun Apr  6 17:04:18 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 6 Apr 2008 17:04:18 +0200
Subject: [Cachewolf-svn] r1333 - trunk/res_noewe/languages
Message-ID: <200804061504.m36F4IlL026723@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-06 17:04:17 +0200 (Sun, 06 Apr 2008)
New Revision: 1333

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
Log:
Languages: small bugs corrected

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-06 14:06:11 UTC (rev 1332)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-06 15:04:17 UTC (rev 1333)
@@ -641,11 +641,10 @@
 		4700=Ignoriere Fehler beim%0aLaden der Kalibrierungsdatei%0a
 		4701=Suche nach bester Karte
 		4702=Optimierung
-		4703=Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?%0aIt can take several minutes.
-		4703=Cachewolf kann das Laden von Karten beschleunigen indem eine Markierung zum Dateinamen hinzugef%fcgt wird. Soll dies jetzt getan werden?%0aEs kann einige Minuten dauern.
+		4703=Cachewolf kann das Laden von Karten beschleunigen, indem eine Markierung zum Dateinamen hinzugef%fcgt wird. Soll dies jetzt getan werden?%0aEs kann einige Minuten dauern.
 		4704=%0aUmbenennen der Datei:
 		4705=Fehler beim Umbenennen:%0a
-		4706=%0anach:%0an
+		4706=%0anach:%0a
 		4707=E/A-Fehler beim Lesen von: 
 		4708=Fehler beim Lesen von: 
 		4800=Lade Onlinekartendienste

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-06 14:06:11 UTC (rev 1332)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-06 15:04:17 UTC (rev 1333)
@@ -628,7 +628,7 @@
 		4700=Ignoring error while%0areading calibration file%0a
 		4701=Searching for best map
 		4702=Optimisation
-		4703=Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?%0aIt can take several minutes.
+		4703=Cachewolf can make loading maps much faster by adding an identification mark to the filename. Do you want me to do this now?%0aIt can take several minutes.
 		4704=%0aRenaming file:
 		4705=Failed to rename:%0a
 		4706=%0ato:%0an



From pfeffer at mail.berlios.de  Sun Apr  6 17:56:43 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 6 Apr 2008 17:56:43 +0200
Subject: [Cachewolf-svn] r1334 - trunk/src/CacheWolf/navi
Message-ID: <200804061556.m36FuhSw001717@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-06 17:56:41 +0200 (Sun, 06 Apr 2008)
New Revision: 1334

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
Log:
MapsList: Rename for faster access: Better error message: in the case that to a .wfl-file no assiciated image could be found

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2008-04-06 15:04:17 UTC (rev 1333)
+++ trunk/src/CacheWolf/navi/MapsList.java	2008-04-06 15:56:41 UTC (rev 1334)
@@ -455,9 +455,16 @@
 					if (!new File(f).rename(to))
 						(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4705,"Failed to rename:\n")+f+".wfl"+MyLocale.getMsg(4706,"\nto:\n")+to, FormBase.OKB)).exec();
 					f = Common.getImageName(path+filename);
-					to = sortEntryBBox+"E-"+filename+Common.getFilenameExtension(f);
-					if (!new File(f).rename(to)) 
-						(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4705,"Failed to rename:\n")+f+".wfl"+MyLocale.getMsg(4706,"\nto:\n")+to, FormBase.OKB)).exec();
+					if (f != null) {
+						to = sortEntryBBox+"E-"+filename+Common.getFilenameExtension(f);
+						if (!new File(f).rename(to)) {
+							Global.getPref().log("MapListEntry (String pathi, String filenamei): Failed to rename: "+path+filename+": "+f+".wfl to: "+to);
+							(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4705,"Failed to rename:\n")+f+".wfl"+MyLocale.getMsg(4706,"\nto:\n")+to, FormBase.OKB)).exec();
+						}
+					} else {
+						Global.getPref().log("MapListEntry (String pathi, String filenamei): Could not find image assiciated to: "+path+filename+".wfl");
+						(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4709,"Could not find image assiciated to:\n")+path+filename+".wfl", FormBase.OKB)).exec();
+					}
 					filename = sortEntryBBox+"E-"+filename;
 					map.mapName = sortEntryBBox+"E-"+map.mapName;
 					map.fileNameWFL = path + filename + ".wfl";



From mik77 at mail.berlios.de  Sun Apr  6 18:01:06 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 6 Apr 2008 18:01:06 +0200
Subject: [Cachewolf-svn] r1335 - trunk/src/CacheWolf
Message-ID: <200804061601.m36G16Lu002663@sheep.berlios.de>

Author: mik77
Date: 2008-04-06 18:01:03 +0200 (Sun, 06 Apr 2008)
New Revision: 1335

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
Disable hour class when an exception occurs while sorting list

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2008-04-06 15:56:41 UTC (rev 1334)
+++ trunk/src/CacheWolf/myTableModel.java	2008-04-06 16:01:03 UTC (rev 1335)
@@ -337,7 +337,10 @@
 				tcControl.update(true);
 				retval = true;
 			}
-		} catch(NullPointerException npex){Global.getPref().log("NPE in myTableModel.Penpressed");}
+		} catch(NullPointerException npex){
+			Global.getPref().log("NPE in myTableModel.Penpressed");
+			Vm.showWait(false);
+			}
 		return retval;
 	}
 	



From mik77 at mail.berlios.de  Sun Apr  6 18:45:09 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 6 Apr 2008 18:45:09 +0200
Subject: [Cachewolf-svn] r1336 - trunk/src/CacheWolf
Message-ID: <200804061645.m36Gj9HX031369@sheep.berlios.de>

Author: mik77
Date: 2008-04-06 18:45:00 +0200 (Sun, 06 Apr 2008)
New Revision: 1336

Modified:
   trunk/src/CacheWolf/TablePanel.java
Log:
Select previous selected Cache after filtering (if available)

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2008-04-06 16:01:03 UTC (rev 1335)
+++ trunk/src/CacheWolf/TablePanel.java	2008-04-06 16:45:00 UTC (rev 1336)
@@ -94,9 +94,16 @@
 	/** Move all filtered caches to the end of the table and redisplay table */
 	//TODO Add a sort here to restore the sort after a filter
 	public void refreshTable(){
+		String wayPoint = ((CacheHolder)cacheDB.get(getSelectedCache())).wayPoint;
 		myMod.updateRows();
+
 		// Check whether the currently selected cache is still visible
-		selectRow(getSelectedCache());
+		int rownum = Global.getProfile().getCacheIndex(wayPoint);
+		if ( (rownum < 0) || (rownum>=myMod.numRows) )
+			rownum = 0;	
+
+		selectRow(rownum);
+
 		tc.update(true); // Update and repaint
 		if (statBar!=null) statBar.updateDisplay();
 	}



From mik77 at mail.berlios.de  Mon Apr  7 20:50:38 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 7 Apr 2008 20:50:38 +0200
Subject: [Cachewolf-svn] r1337 - trunk/src/CacheWolf/navi
Message-ID: <200804071850.m37Iocak004943@sheep.berlios.de>

Author: mik77
Date: 2008-04-07 20:50:35 +0200 (Mon, 07 Apr 2008)
New Revision: 1337

Modified:
   trunk/src/CacheWolf/navi/GotoPanel.java
Log:
Center current coordinates on GotoPanel

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2008-04-06 16:45:00 UTC (rev 1336)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2008-04-07 18:50:35 UTC (rev 1337)
@@ -117,13 +117,18 @@
 		lblGPS.backGround = RED;
 		lblGPS.setMenu(mnuContextFormt);
 		lblGPS.modifyAll(ControlConstants.WantHoldDown, 0);
-		CoordsP.addLast(lblPosition = new mLabel(myNavigation.gpsPos.toString(currFormat)),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+
+		lblPosition = new mLabel(myNavigation.gpsPos.toString(currFormat));
+		lblPosition.anchor = mLabel.CENTER;
 		lblPosition.setMenu(mnuContextFormt);
 		lblPosition.modifyAll(ControlConstants.WantHoldDown, 0);
+		CoordsP.addLast(lblPosition, CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+
 		CoordsP.addNext(lblDST = new mLabel(MyLocale.getMsg(1500,"DST:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		lblDST.backGround = new Color(0,0,255);
 		lblDST.setMenu(mnuContextFormt);
 		lblDST.modifyAll(ControlConstants.WantHoldDown, 0);
+
 		CoordsP.addLast(btnGoto = new mButton(getGotoBtnText()),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		
 		//Rose for bearing



From engywuck at mail.berlios.de  Mon Apr  7 21:38:10 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Mon, 7 Apr 2008 21:38:10 +0200
Subject: [Cachewolf-svn] r1338 - trunk/src/CacheWolf
Message-ID: <200804071938.m37JcAj6010656@sheep.berlios.de>

Author: engywuck
Date: 2008-04-07 21:38:06 +0200 (Mon, 07 Apr 2008)
New Revision: 1338

Added:
   trunk/src/CacheWolf/MyEditor.java
Modified:
   trunk/src/CacheWolf/GPSPortOptions.java
   trunk/src/CacheWolf/PreferencesScreen.java
Log:
GPSPortOptions: Ok/Cancel-Buttons now take the whole place at the bottom of the form to let them be accessible when the keyboard icon is active on PDAs. (http://www.geoclub.de/viewtopic.php?f=40&t=23661)

Modified: trunk/src/CacheWolf/GPSPortOptions.java
===================================================================
--- trunk/src/CacheWolf/GPSPortOptions.java	2008-04-07 18:50:35 UTC (rev 1337)
+++ trunk/src/CacheWolf/GPSPortOptions.java	2008-04-07 19:38:06 UTC (rev 1338)
@@ -30,6 +30,7 @@
 import ewe.io.*;
 import ewe.ui.formatted.TextDisplay;
 import ewe.reflect.FieldTransfer;
+import ewe.reflect.Reflect;
 import ewe.sys.*;
 import ewe.util.*;
 
@@ -88,9 +89,30 @@
 	boolean gpsRunning = false;
 
 	
-	public Editor getEditor(int whichEditor){
-		Editor ed;
-		ed = super.getEditor(0);
+	public Editor getEditor(){
+		MyEditor ed = new MyEditor();
+		// The following lines are mainly copied from SerialPortOptions.
+		// Reason: We want to use MyEditor instead of the default Editor,
+		//         because the latter places the ok/cancel buttons centered.
+		// Because this is from the general SerialPortOptions class, maybe not all of the code
+		// must be necessary.
+		ed.objectClass = Reflect.getForObject(this);
+		ed.sampleObject = this;
+		ed.setObject(this);
+		ed.title = "Serial Port Options";
+		InputStack is = new InputStack();
+		ed.addLast(is).setCell(CellConstants.HSTRETCH);
+		CellPanel cp = new CellPanel();
+		ed.addField(cp.addNext(new mComboBox()).setCell(CellConstants.HSTRETCH),"portName");
+		ed.addField(cp.addLast(new mButton("Update Ports$u")).setCell(CellConstants.DONTSTRETCH),"update");
+		is.add(cp,"Port:$p");
+		mComboBox cb = new mComboBox();
+		is.add(ed.addField(cb,"baudRate"),"Baud:$b");
+		cb.choice.addItems(ewe.util.mString.split("110|300|1200|2400|4800|9600|19200|38400|57600|115200"));
+		//
+		// End of copy from SerialPortOptions.
+		//
+		ed.buttonConstraints = CellConstants.HFILL;
 		ed.addField(ed.addNext(new mButton("Scan$u")).setCell(CellConstants.DONTSTRETCH),"scan");
 		btnTest = new mButton("Test$u");
 		ed.addField(ed.addLast(btnTest.setCell(CellConstants.DONTSTRETCH)),"test");
@@ -116,7 +138,6 @@
 		inputBoxLogTimer.setText("10");
 		ed.addField(ed.addLast(inputBoxLogTimer,0 , (CellConstants.WEST | CellConstants.HFILL)), "GPSLogTimer");
 
-		
 		gpsRunning = false;
 		return ed;
 	}
@@ -216,4 +237,4 @@
 		gpsPort.close();
 		return false;
 	}
-}
+}
\ No newline at end of file

Added: trunk/src/CacheWolf/MyEditor.java
===================================================================
--- trunk/src/CacheWolf/MyEditor.java	2008-04-07 18:50:35 UTC (rev 1337)
+++ trunk/src/CacheWolf/MyEditor.java	2008-04-07 19:38:06 UTC (rev 1338)
@@ -0,0 +1,65 @@
+package CacheWolf;
+
+import ewe.fx.Color;
+import ewe.fx.Insets;
+import ewe.ui.*;
+
+/**
+ * Descendant from ewe.ui.Editor to allow more flexibility when needed
+ * @author engywuck
+ */
+public class MyEditor extends Editor {
+
+	// Constraint used to align buttons of MyEditor
+	public int buttonConstraints = CellConstants.CENTER;
+
+	/** 
+	 * Mainly overwritten of ewe.ui.Editor, except for the placement constraints for
+	 * the buttons which allow for variable buttonConstraints.
+	 */
+	protected void checkButtons() {
+		if (buttons != null) {
+			if (buttons.size() != 0) {
+				if (Gui.isSmartPhone && getSoftKeyBarFor(null) == null) {
+					buttonsToSoftKeyBar(buttons, (no != null && cancel != null) ? "No/Cancel"
+							: "Actions", BUTTONS_TO_SOFT_KEY_FIRST_BUTTON_SEPARATE);
+				} else {
+					CellPanel p = new CellPanel();
+					p.defaultTags.set(INSETS, new Insets(0, 1, 0, 1));
+					p.modify(AlwaysEnabled | NotAnEditor, 0); // Just in case a dialog pops up
+																// with global disabling.
+					for (int i = 0; i < buttons.size(); i++) {
+						p.addNext((Control) buttons.get(i));
+						if ((buttonsPerRow > 0) && (((i + 1) % buttonsPerRow) == 0))
+							p.endRow();
+					}
+					p.endRow();
+					CellPanel p2 = buttonsPanel = new CellPanel();
+					p.defaultTags.set(INSETS, new Insets(2, 2, 2, 2));
+					//
+					// Here is difference from ewe.ui.Editor: CENTER -> buttonConstraints
+					//
+					p2.addLast(p).setControl(buttonConstraints);// p2.borderStyle =
+																// Graphics.EDGE_SUNKEN;
+				}
+			}
+		}
+		if (!hasExitButton()) {
+			if (Gui.isSmartPhone) {
+				if (getSoftKeyBarFor(null) == null) {
+					SoftKeyBar sk = makeSoftKeys();
+					sk.setKey(1, "Close|" + EXIT_IDCANCEL, close, null);
+				}
+			} else {
+				titleOK = new mButton(close);// getButton("OK");
+				titleOK.backGround = Color.DarkBlue;
+				((mButton) titleOK).insideColor = getBackground();
+			}
+		}
+		if (titleOK != null)
+			titleOK.modify(AlwaysEnabled | NotAnEditor, 0);
+		if (titleCancel != null)
+			titleCancel.modify(AlwaysEnabled | NotAnEditor, 0);
+	}
+
+}

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2008-04-07 18:50:35 UTC (rev 1337)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2008-04-07 19:38:06 UTC (rev 1338)
@@ -306,35 +306,25 @@
 				if(fc.execute() != FormBase.IDCANCEL)	DataDir.setText(fc.getChosen()+"/");
 			}
 			if (ev.target == gpsB){
-				GPSPortOptions spo = new GPSPortOptions();
-				spo.portName = pref.mySPO.portName;
-				spo.baudRate = pref.mySPO.baudRate;
-				Editor s = spo.getEditor(SerialPortOptions.ADVANCED_EDITOR);
-				spo.forwardGpsChkB.setState(pref.forwardGPS);
-				spo.inputBoxForwardHost.setText(pref.forwardGpsHost);
-				spo.logGpsChkB.setState(pref.logGPS);
-				spo.inputBoxLogTimer.setText(pref.logGPSTimer);
+				GPSPortOptions gpo = new GPSPortOptions();
+				gpo.portName = pref.mySPO.portName;
+				gpo.baudRate = pref.mySPO.baudRate;
+				Editor s = gpo.getEditor();
+				gpo.forwardGpsChkB.setState(pref.forwardGPS);
+				gpo.inputBoxForwardHost.setText(pref.forwardGpsHost);
+				gpo.logGpsChkB.setState(pref.logGPS);
+				gpo.inputBoxLogTimer.setText(pref.logGPSTimer);
 				Gui.setOKCancel(s);
 				if (s.execute()== FormBase.IDOK) {
-					pref.mySPO.portName = spo.portName; 
-					pref.mySPO.baudRate = spo.baudRate;
-					pref.forwardGPS = spo.forwardGpsChkB.getState();
-					pref.forwardGpsHost = spo.inputBoxForwardHost.getText();
-					pref.logGPS = spo.logGpsChkB.getState();
-					pref.logGPSTimer = spo.inputBoxLogTimer.getText();
+					pref.mySPO.portName = gpo.portName; 
+					pref.mySPO.baudRate = gpo.baudRate;
+					pref.forwardGPS = gpo.forwardGpsChkB.getState();
+					pref.forwardGpsHost = gpo.inputBoxForwardHost.getText();
+					pref.logGPS = gpo.logGpsChkB.getState();
+					pref.logGPSTimer = gpo.inputBoxLogTimer.getText();
 					inpGPS.setText(pref.mySPO.portName+"/"+pref.mySPO.baudRate);
 				}
 			}
-			// change destination waypoint
-			/*if (ev.target == btnCentre){
-				CoordsScreen cs = new CoordsScreen();
-				cs.setFields(pref.curCentrePt, CWPoint.CW);
-				if (cs.execute()== CoordsScreen.IDOK){
-					pref.curCentrePt.set(cs.getCoords());
-					btnCentre.setText(pref.curCentrePt.toString(CWPoint.CW));
-				}
-			}
-			*/
 		}
 		super.onEvent(ev);
 	}



From engywuck at mail.berlios.de  Mon Apr  7 22:45:32 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Mon, 7 Apr 2008 22:45:32 +0200
Subject: [Cachewolf-svn] r1339 - trunk/src/CacheWolf
Message-ID: <200804072045.m37KjWqt017271@sheep.berlios.de>

Author: engywuck
Date: 2008-04-07 22:45:27 +0200 (Mon, 07 Apr 2008)
New Revision: 1339

Modified:
   trunk/src/CacheWolf/HintLogPanel.java
Log:
Hint/Log-Tab: Scrollbar doesn't hide ride side of logs anymore. (http://www.geoclub.de/viewtopic.php?f=40&t=23688)
But the solution is far from being elegant... Maybe there is a better way?

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2008-04-07 19:38:06 UTC (rev 1338)
+++ trunk/src/CacheWolf/HintLogPanel.java	2008-04-07 20:45:27 UTC (rev 1339)
@@ -32,6 +32,8 @@
 	mButton decodeButton = new mButton("Decode");
 	mButton moreBt = new mButton(">>");
 	mButton prevBt = new mButton("<<");
+	private MyScrollBarPanel sbplog;
+	
 	public HintLogPanel(){
 		SplittablePanel split = new SplittablePanel(PanelSplitter.VERTICAL);
 		CellPanel logpane = split.getNextPanel();
@@ -48,7 +50,7 @@
 		hintpane.addLast(moreBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
 		hint.modify(ControlConstants.NotEditable,0);
 
-		ScrollBarPanel sbplog = new MyScrollBarPanel(htmlImagDisp, ScrollablePanel.NeverShowHorizontalScrollers);
+		sbplog = new MyScrollBarPanel(htmlImagDisp, ScrollablePanel.NeverShowHorizontalScrollers);
 		//logpane.addLast(sbplog,CellConstants.STRETCH, CellConstants.FILL);
 		Rect r = new Rect(new Dimension (Global.getPref().myAppWidth-sbplog.vbar.getRect().width, 20));
 		htmlImagDisp.virtualSize = r;
@@ -114,6 +116,13 @@
 		htmlImagDisp.virtualSize = r;
 		htmlImagDisp.origin = new Point();
 		htmlImagDisp.checkScrolls();
+		// Can I get a reasonable value for scrollbarWidth before calling checkScrolls() 
+		// and in a more reasonable way?
+		// Now its ugly: I paint it, calculate the scrollbars and then resize the panel...
+		int scrollbarWidth = sbplog.vbar.getRect().width;
+		// And do it again, sam... *sigh*
+		logs.resizeTo(htmlTxtImage.getWidth()-scrollbarWidth, htmlTxtImage.getHeight());
+		logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
 
 		htmlImagDisp.repaintNow();
 		repaintNow();



From mik77 at mail.berlios.de  Mon Apr  7 23:21:19 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 7 Apr 2008 23:21:19 +0200
Subject: [Cachewolf-svn] r1340 - trunk/src/CacheWolf/navi
Message-ID: <200804072121.m37LLJUu021566@sheep.berlios.de>

Author: mik77
Date: 2008-04-07 23:21:17 +0200 (Mon, 07 Apr 2008)
New Revision: 1340

Modified:
   trunk/src/CacheWolf/navi/CWGPSPoint.java
Log:
Write all NMEA data to log. Not only first line.

Modified: trunk/src/CacheWolf/navi/CWGPSPoint.java
===================================================================
--- trunk/src/CacheWolf/navi/CWGPSPoint.java	2008-04-07 20:45:27 UTC (rev 1339)
+++ trunk/src/CacheWolf/navi/CWGPSPoint.java	2008-04-07 21:21:17 UTC (rev 1340)
@@ -173,6 +173,7 @@
 	 */
 	public boolean examine(String NMEA){ 
 		boolean interpreted = false;
+		boolean logWritten = false;
 		try {
 			int i, start, end;
 			String latDeg="0", latMin="0", latNS="N"; 
@@ -189,9 +190,9 @@
 			}
 */			while(true){
 				start = NMEA.indexOf("$GP", end);  
-				if (start == -1) return interpreted;  
+				if (start == -1) break;
 				end = NMEA.indexOf("*", start);  
-				if ((end == -1)||(end+3 > NMEA.length())) return interpreted;  
+				if ((end == -1)||(end+3 > NMEA.length())) break;  
 
 
 				//Vm.debug(NMEA.substring(start,end+3));
@@ -203,7 +204,7 @@
 				if (writeLog && (logFlag & LOGRAW) > 0){ 
 					try {
 						logFile.write(NMEA.substring(start,end+3)+"\n");
-						writeLog = false;
+						logWritten = true;
 					} catch (IOException e) {}
 				}
 
@@ -328,8 +329,12 @@
 		} catch (Exception e) {
 			Global.getPref().log("Exception in examine in CWGPSPoint", e, true);
 			e.printStackTrace();
-			return interpreted;
 		}
+
+		if	(logWritten)
+			writeLog = false;
+
+		return interpreted;
 	}
 
 	private boolean checkSumOK(String nmea){
@@ -366,3 +371,4 @@
 	}
 }
 
+



From engywuck at mail.berlios.de  Tue Apr  8 08:18:23 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Tue, 8 Apr 2008 08:18:23 +0200
Subject: [Cachewolf-svn] r1341 - trunk/src/CacheWolf
Message-ID: <200804080618.m386INWu002979@sheep.berlios.de>

Author: engywuck
Date: 2008-04-08 08:18:22 +0200 (Tue, 08 Apr 2008)
New Revision: 1341

Modified:
   trunk/src/CacheWolf/HintLogPanel.java
Log:
Tuning for Rev. 1339. Now its much better...

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2008-04-07 21:21:17 UTC (rev 1340)
+++ trunk/src/CacheWolf/HintLogPanel.java	2008-04-08 06:18:22 UTC (rev 1341)
@@ -33,6 +33,7 @@
 	mButton moreBt = new mButton(">>");
 	mButton prevBt = new mButton("<<");
 	private MyScrollBarPanel sbplog;
+	private int lastScrollbarWidth = 0;
 	
 	public HintLogPanel(){
 		SplittablePanel split = new SplittablePanel(PanelSplitter.VERTICAL);
@@ -109,7 +110,7 @@
 		htmlTxtImage.setLocation(0, 0);
 		htmlTxtImage.properties |= mImage.IsMoveable;
 		Graphics draw = new Graphics(htmlTxtImage.image);
-		logs.resizeTo(htmlTxtImage.getWidth(), htmlTxtImage.getHeight());
+		logs.resizeTo(htmlTxtImage.getWidth()-lastScrollbarWidth, htmlTxtImage.getHeight());
 		logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
 		htmlImagDisp.addImage(htmlTxtImage);
 		Rect r = new Rect(new Dimension (width, h));
@@ -119,11 +120,14 @@
 		// Can I get a reasonable value for scrollbarWidth before calling checkScrolls() 
 		// and in a more reasonable way?
 		// Now its ugly: I paint it, calculate the scrollbars and then resize the panel...
+		// Better: Now I only redo it when the scrollbar width changed, which is not the case
+		// normally.
 		int scrollbarWidth = sbplog.vbar.getRect().width;
-		// And do it again, sam... *sigh*
-		logs.resizeTo(htmlTxtImage.getWidth()-scrollbarWidth, htmlTxtImage.getHeight());
-		logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
-
+		if (scrollbarWidth != lastScrollbarWidth) { 
+		    lastScrollbarWidth = scrollbarWidth;
+    		    logs.resizeTo(htmlTxtImage.getWidth()-scrollbarWidth, htmlTxtImage.getHeight());
+    		    logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
+		}
 		htmlImagDisp.repaintNow();
 		repaintNow();
 		Vm.showWait(false);



From kappler at mail.berlios.de  Tue Apr  8 12:15:58 2008
From: kappler at mail.berlios.de (kappler at mail.berlios.de)
Date: Tue, 8 Apr 2008 12:15:58 +0200
Subject: [Cachewolf-svn] r1342 - trunk/src/CacheWolf
Message-ID: <200804081015.m38AFwKX024243@sheep.berlios.de>

Author: kappler
Date: 2008-04-08 12:15:57 +0200 (Tue, 08 Apr 2008)
New Revision: 1342

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Show notes in Detail-Panel on devices with larger screen-resolution.

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-04-08 06:18:22 UTC (rev 1341)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-04-08 10:15:57 UTC (rev 1342)
@@ -28,12 +28,14 @@
 	int dbIndex = -1;
 	CellPanel pnlTools = new CellPanel(); 
 	AttributesViewer attV;
+	mTextPad mNotes;
 	
 	private boolean dirty_notes = false;
 	private boolean dirty_details = false;
 	private boolean blackStatus = false;
 	private boolean blackStatusChanged=false;
 	private boolean needsTableUpdate = false;
+	private boolean isBigScreen = false;
 	
 	Preferences pref; // Test
 	Profile profile;
@@ -139,7 +141,13 @@
 		attV=new AttributesViewer();
 		this.addLast(attV);
 		
-		
+		if ((MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600)){
+			isBigScreen = true;  
+			this.addLast(new mLabel(MyLocale.getMsg(308,"Notes:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			mNotes = new mTextPad();
+			mNotes.modify(ControlConstants.NotEditable,0);
+			this.addLast(new MyScrollBarPanel(mNotes));
+		}
 	}
 	
 	public void clear() {
@@ -211,6 +219,8 @@
 		attV.showImages(ch.getCacheDetails(true).attributes);
 		lblTerr.setText((ch.terrain.length()>0) ? (MyLocale.getMsg(1001,"T")+": "+ch.terrain) : "");
 		lblDiff.setText((ch.hard.length()>0)    ? (MyLocale.getMsg(1000,"D")+": "+ch.hard) : ""); 
+
+		if(isBigScreen)	mNotes.setText(ch.details.CacheNotes);
 	}
 	
 	
@@ -323,6 +333,7 @@
 				dirty_notes=true; // TODO I think this is redundant, because the notes are saved seperately by the notes screen itself
 				NotesScreen nsc = new NotesScreen(thisCache.getCacheDetails(true));
 				nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
+				if(isBigScreen) mNotes.setText(thisCache.getCacheDetails(true).CacheNotes);
 			}
 			else if(ev.target == btnShowMap){
 				Global.mainTab.SwitchToMovingMap(thisCache.pos, true);



From engywuck at mail.berlios.de  Tue Apr  8 12:54:08 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Tue, 8 Apr 2008 12:54:08 +0200
Subject: [Cachewolf-svn] r1343 - trunk/src/CacheWolf
Message-ID: <200804081054.m38As8ii001405@sheep.berlios.de>

Author: engywuck
Date: 2008-04-08 12:54:06 +0200 (Tue, 08 Apr 2008)
New Revision: 1343

Modified:
   trunk/src/CacheWolf/CWPoint.java
Log:
Function project: Now use library function to convert to radians. Should improve accuracy.

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2008-04-08 10:15:57 UTC (rev 1342)
+++ trunk/src/CacheWolf/CWPoint.java	2008-04-08 10:54:06 UTC (rev 1343)
@@ -511,8 +511,9 @@
 		float c, az;
 		
 		LatLonPoint llsrc = new LatLonPoint(this.latDec, this.lonDec);
-		c = (float)(distance/1.852);
-		c = (float)(java.lang.Math.PI/(180*60))*c;
+		c = (float)Length.KM.toRadians(distance);
+//		c = (float)(distance/1.852);
+//		c = (float)(java.lang.Math.PI/(180*60))*c;
 		az = (float)((degrees/180)*java.lang.Math.PI);
 		// c = (float) (distance * 1000 / ((TransformCoordinates.WGS84.a + TransformCoordinates.WGS84.b) / 2)); 
 		LatLonPoint lldst = llsrc.getPoint(c,az);



From mik77 at mail.berlios.de  Tue Apr  8 13:31:24 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 8 Apr 2008 13:31:24 +0200
Subject: [Cachewolf-svn] r1344 - trunk/res_noewe/webmapservices
Message-ID: <200804081131.m38BVOV0024360@sheep.berlios.de>

Author: mik77
Date: 2008-04-08 13:31:17 +0200 (Tue, 08 Apr 2008)
New Revision: 1344

Modified:
   trunk/res_noewe/webmapservices/de-sa_photo.wms
   trunk/res_noewe/webmapservices/de-sa_topo_10.wms
   trunk/res_noewe/webmapservices/de-sa_topo_50.wms
Log:
Use correct abbreviation ST for Sachsen-Anhalt

Modified: trunk/res_noewe/webmapservices/de-sa_photo.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sa_photo.wms	2008-04-08 10:54:06 UTC (rev 1343)
+++ trunk/res_noewe/webmapservices/de-sa_photo.wms	2008-04-08 11:31:17 UTC (rev 1344)
@@ -1,7 +1,7 @@
 # please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
 GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.sa Luftbild
+Name:	de.st Luftbild
 MapType:	photo
 MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de-sa_topo_10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sa_topo_10.wms	2008-04-08 10:54:06 UTC (rev 1343)
+++ trunk/res_noewe/webmapservices/de-sa_topo_10.wms	2008-04-08 11:31:17 UTC (rev 1344)
@@ -1,7 +1,7 @@
 # please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
 GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.sa Topo 10
+Name:	de.st Topo 10
 MapType:	topo
 MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de-sa_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sa_topo_50.wms	2008-04-08 10:54:06 UTC (rev 1343)
+++ trunk/res_noewe/webmapservices/de-sa_topo_50.wms	2008-04-08 11:31:17 UTC (rev 1344)
@@ -1,7 +1,7 @@
 # please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
 GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.sa Topo 50
+Name:	de.st Topo 50
 MapType:	topo
 MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
 ServiceTypeUrlPart:	SERVICE=WMS 



From mik77 at mail.berlios.de  Tue Apr  8 13:33:20 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 8 Apr 2008 13:33:20 +0200
Subject: [Cachewolf-svn] r1345 - trunk/res_noewe/webmapservices
Message-ID: <200804081133.m38BXKae024460@sheep.berlios.de>

Author: mik77
Date: 2008-04-08 13:33:12 +0200 (Tue, 08 Apr 2008)
New Revision: 1345

Added:
   trunk/res_noewe/webmapservices/de-st_photo.wms
   trunk/res_noewe/webmapservices/de-st_topo_10.wms
   trunk/res_noewe/webmapservices/de-st_topo_50.wms
Removed:
   trunk/res_noewe/webmapservices/de-sa_photo.wms
   trunk/res_noewe/webmapservices/de-sa_topo_10.wms
   trunk/res_noewe/webmapservices/de-sa_topo_50.wms
Log:
Use correct abbreviation ST for Sachsen-Anhalt

Deleted: trunk/res_noewe/webmapservices/de-sa_photo.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sa_photo.wms	2008-04-08 11:31:17 UTC (rev 1344)
+++ trunk/res_noewe/webmapservices/de-sa_photo.wms	2008-04-08 11:33:12 UTC (rev 1345)
@@ -1,20 +0,0 @@
-# please refer to readme_wms.txt for an explantion of this file format
-TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
-GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.st Luftbild
-MapType:	photo
-MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf:   31468
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:31468
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=layer_601
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 53.222636 E 10.5012
-BoundingBoxButtomRightWGS84:   N 50.5272 E 13.4957
-MinScale:   0.00001
-MaxScale:   24.95
-RecommendedScale:	1.0
-ImageFileExtension: .png 

Deleted: trunk/res_noewe/webmapservices/de-sa_topo_10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sa_topo_10.wms	2008-04-08 11:31:17 UTC (rev 1344)
+++ trunk/res_noewe/webmapservices/de-sa_topo_10.wms	2008-04-08 11:33:12 UTC (rev 1345)
@@ -1,20 +0,0 @@
-# please refer to readme_wms.txt for an explantion of this file format
-TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
-GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.st Topo 10
-MapType:	topo
-MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf:   31468
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:31468
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=layer_603
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 53.2226 E 10.5012
-BoundingBoxButtomRightWGS84:   N 50.5272 E 13.4957
-MinScale:   0.000499
-MaxScale:   249.451559
-RecommendedScale:	1.0
-ImageFileExtension: .png 

Deleted: trunk/res_noewe/webmapservices/de-sa_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sa_topo_50.wms	2008-04-08 11:31:17 UTC (rev 1344)
+++ trunk/res_noewe/webmapservices/de-sa_topo_50.wms	2008-04-08 11:33:12 UTC (rev 1345)
@@ -1,20 +0,0 @@
-# please refer to readme_wms.txt for an explantion of this file format
-TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
-GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.st Topo 50
-MapType:	topo
-MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf:   31468
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:31468
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=layer_607
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 53.2226 E 10.5012
-BoundingBoxButtomRightWGS84:   N 50.5272 E 13.4957
-MinScale:   4.989031
-MaxScale:   124.725779
-RecommendedScale:	5.0
-ImageFileExtension: .png 

Copied: trunk/res_noewe/webmapservices/de-st_photo.wms (from rev 1344, trunk/res_noewe/webmapservices/de-sa_photo.wms)

Copied: trunk/res_noewe/webmapservices/de-st_topo_10.wms (from rev 1344, trunk/res_noewe/webmapservices/de-sa_topo_10.wms)

Copied: trunk/res_noewe/webmapservices/de-st_topo_50.wms (from rev 1344, trunk/res_noewe/webmapservices/de-sa_topo_50.wms)



From mik77 at mail.berlios.de  Tue Apr  8 22:45:30 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 8 Apr 2008 22:45:30 +0200
Subject: [Cachewolf-svn] r1346 - in trunk/src/CacheWolf: . navi
Message-ID: <200804082045.m38KjU6i009725@sheep.berlios.de>

Author: mik77
Date: 2008-04-08 22:45:25 +0200 (Tue, 08 Apr 2008)
New Revision: 1346

Added:
   trunk/src/CacheWolf/navi/GeodeticCalculator.java
Modified:
   trunk/src/CacheWolf/CWPoint.java
   trunk/src/CacheWolf/navi/Ellipsoid.java
Log:
Distance calculation and projection adapted from http://www.gavaghan.org/blog/free-source-code/geodesy-library-vincentys-formula-java/

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2008-04-08 11:33:12 UTC (rev 1345)
+++ trunk/src/CacheWolf/CWPoint.java	2008-04-08 20:45:25 UTC (rev 1346)
@@ -4,6 +4,7 @@
 import CacheWolf.navi.TrackPoint;
 import CacheWolf.navi.GkPoint;
 import CacheWolf.navi.TransformCoordinates;
+import CacheWolf.navi.GeodeticCalculator;
 
 import com.bbn.openmap.proj.coords.*;
 import com.bbn.openmap.proj.*;
@@ -30,7 +31,9 @@
 	public static final int LAT_LON = 7;
 	public static final int LON_LAT = 8;
 	
-	
+	/** Degrees/Radians conversion constant. */
+	static private final double PiOver180 = Math.PI / 180.0;	
+
 	/**
 	 * Create CWPoint by using lat and lon 
 	 * @param lat Latitude as decimal
@@ -508,17 +511,7 @@
 	 * @return projected waypoint
 	 */
 	public CWPoint project(double degrees, double distance){
-		float c, az;
-		
-		LatLonPoint llsrc = new LatLonPoint(this.latDec, this.lonDec);
-		c = (float)Length.KM.toRadians(distance);
-//		c = (float)(distance/1.852);
-//		c = (float)(java.lang.Math.PI/(180*60))*c;
-		az = (float)((degrees/180)*java.lang.Math.PI);
-		// c = (float) (distance * 1000 / ((TransformCoordinates.WGS84.a + TransformCoordinates.WGS84.b) / 2)); 
-		LatLonPoint lldst = llsrc.getPoint(c,az);
-		
-		return new CWPoint(lldst);
+		return new CWPoint( GeodeticCalculator.calculateEndingGlobalCoordinates(TransformCoordinates.WGS84, this, degrees, distance * 1000.0) );
 	}
 
 	/**
@@ -528,15 +521,8 @@
 	 */	
 	public double getBearing(CWPoint dest){
 		if (!this.isValid() || dest == null || !dest.isValid()) return 361;
-		float az;
-		LatLonPoint src = new LatLonPoint(this.latDec, this.lonDec);
 		
-		az = src.azimuth(new LatLonPoint(dest.latDec, dest.lonDec));
-		if (az >= 0)
-			return az * 180 /java.lang.Math.PI;
-		else
-			return (2 * Math.PI + az) * 180 /Math.PI; 
-		
+		return GeodeticCalculator.calculateBearing(TransformCoordinates.WGS84 , this, dest);
 	}
 	
 	/**
@@ -566,8 +552,7 @@
 	 * @return  distance to waypoint in KM
 	 */	
 	public double getDistance (CWPoint dest){
-		return getDistance(dest.latDec, dest.lonDec);
-		
+		return GeodeticCalculator.calculateDistance(TransformCoordinates.WGS84 , this, dest) / 1000.0;
 	}
 
 	/**
@@ -576,7 +561,7 @@
 	 * @return  distance to waypoint in KM
 	 */	
 	public double getDistance (double latDecD, double lonDecD){
-		return Length.KM.fromRadians(getDistanceRad(latDecD, lonDecD));
+		return getDistance( new CWPoint(latDecD, lonDecD));
 	}
 
 	/**
@@ -585,8 +570,15 @@
 	 * @return  distance to waypoint in Rad
 	 */	
 	public double getDistanceRad (double latDecD, double lonDecD){
-		LatLonPoint src = new LatLonPoint(this.latDec, this.lonDec);
-		return src.distance(new LatLonPoint(latDecD, lonDecD));
+		double phi1 = this.latDec * PiOver180;
+		double lambda0 = this.lonDec * PiOver180;
+		double phi = latDecD * PiOver180;
+		double lambda = lonDecD * PiOver180;
+		double pdiff =  Math.sin(((phi - phi1) / 2.0));
+		double ldiff =  Math.sin((lambda - lambda0) / 2.0);
+		double rval =  Math.sqrt((pdiff * pdiff) +  Math.cos(phi1) *  Math.cos(phi) * (ldiff * ldiff));
+
+		return 2.0 *  Math.asin(rval);		
 	}
 	
 	public double getDistanceRad (CWPoint ll) {

Modified: trunk/src/CacheWolf/navi/Ellipsoid.java
===================================================================
--- trunk/src/CacheWolf/navi/Ellipsoid.java	2008-04-08 11:33:12 UTC (rev 1345)
+++ trunk/src/CacheWolf/navi/Ellipsoid.java	2008-04-08 20:45:25 UTC (rev 1346)
@@ -15,4 +15,39 @@
 			b = a - (1/bi) * a;
 		}
 	}
-}
+	
+	   /**
+	    * Get semi-major axis.
+	    * @return semi-major axis (in meters).
+	    */
+	   public double getSemiMajorAxis()
+	   {
+	     return a;
+	   }
+
+	   /**
+	    * Get semi-minor axis.
+	    * @return semi-minor axis (in meters).
+	    */
+	   public double getSemiMinorAxis()
+	   {
+	     return b;
+	   }
+
+	   /**
+	    * Get flattening
+	    * @return
+	    */
+	   public double getFlattening()
+	   {
+	     return (a - b) / a;
+	   }
+
+	   /**
+	    * Get inverse flattening.
+	    * @return
+	    */
+	   public double getInverseFlattening()
+	   {
+	     return a / (a - b);
+	   }}

Added: trunk/src/CacheWolf/navi/GeodeticCalculator.java
===================================================================
--- trunk/src/CacheWolf/navi/GeodeticCalculator.java	2008-04-08 11:33:12 UTC (rev 1345)
+++ trunk/src/CacheWolf/navi/GeodeticCalculator.java	2008-04-08 20:45:25 UTC (rev 1346)
@@ -0,0 +1,345 @@
+/* Geodesy by Mike Gavaghan
+ * 
+ * http://www.gavaghan.org/blog/free-source-code/geodesy-library-vincentys-formula/
+ * 
+ * This code may be freely used and modified on any personal or professional
+ * project.  It comes with no warranty.
+ */
+//package org.gavaghan.geodesy;
+package CacheWolf.navi;
+
+/**
+ * <p>
+ * Implementation of Thaddeus Vincenty's algorithms to solve the direct and inverse
+ * geodetic problems. For more information, see Vincent's original publication on
+ * the NOAA website:
+ * </p>
+ * See http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf
+ * 
+ * @author Mike Gavaghan
+ * 
+ * Adapted for CacheWolf by Michael Kunz (MiK77)
+ */
+public class GeodeticCalculator
+{
+   static private final double TwoPi = 2.0 * Math.PI;
+   
+   /** Degrees/Radians conversion constant. */
+   static private final double PiOver180 = Math.PI / 180.0;
+
+   /**
+    * Calculate the destination and final bearing after traveling a specified
+    * distance, and a specified starting bearing, for an initial location. This
+    * is the solution to the direct geodetic problem.
+    * 
+    * @param ellipsoid reference ellipsoid to use
+    * @param start starting location
+    * @param startBearing starting bearing (degrees)
+    * @param distance distance to travel (meters)
+    * @param endBearing bearing at destination (degrees) element at index 0 will
+    *            be populated with the result
+    * @return
+    */
+   static public TrackPoint calculateEndingGlobalCoordinates(Ellipsoid ellipsoid, TrackPoint start, double startBearing, double distance,
+         double[] endBearing)
+   {
+      double a = ellipsoid.getSemiMajorAxis();
+      double b = ellipsoid.getSemiMinorAxis();
+      double aSquared = a * a;
+      double bSquared = b * b;
+      double f = ellipsoid.getFlattening();
+      double phi1 = start.latDec  * PiOver180;
+      double alpha1 = startBearing * PiOver180;
+      double cosAlpha1 = Math.cos(alpha1);
+      double sinAlpha1 = Math.sin(alpha1);
+      double s = distance;
+      double tanU1 = (1.0 - f) * Math.tan(phi1);
+      double cosU1 = 1.0 / Math.sqrt(1.0 + tanU1 * tanU1);
+      double sinU1 = tanU1 * cosU1;
+
+      // eq. 1
+      double sigma1 = Math.atan2(tanU1, cosAlpha1);
+
+      // eq. 2
+      double sinAlpha = cosU1 * sinAlpha1;
+
+      double sin2Alpha = sinAlpha * sinAlpha;
+      double cos2Alpha = 1 - sin2Alpha;
+      double uSquared = cos2Alpha * (aSquared - bSquared) / bSquared;
+
+      // eq. 3
+      double A = 1 + (uSquared / 16384) * (4096 + uSquared * (-768 + uSquared * (320 - 175 * uSquared)));
+
+      // eq. 4
+      double B = (uSquared / 1024) * (256 + uSquared * (-128 + uSquared * (74 - 47 * uSquared)));
+
+      // iterate until there is a negligible change in sigma
+      double deltaSigma;
+      double sOverbA = s / (b * A);
+      double sigma = sOverbA;
+      double sinSigma;
+      double prevSigma = sOverbA;
+      double sigmaM2;
+      double cosSigmaM2;
+      double cos2SigmaM2;
+
+      for (;;)
+      {
+         // eq. 5
+         sigmaM2 = 2.0 * sigma1 + sigma;
+         cosSigmaM2 = Math.cos(sigmaM2);
+         cos2SigmaM2 = cosSigmaM2 * cosSigmaM2;
+         sinSigma = Math.sin(sigma);
+         double cosSignma = Math.cos(sigma);
+
+         // eq. 6
+         deltaSigma = B
+               * sinSigma
+               * (cosSigmaM2 + (B / 4.0)
+                     * (cosSignma * (-1 + 2 * cos2SigmaM2) - (B / 6.0) * cosSigmaM2 * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2SigmaM2)));
+
+         // eq. 7
+         sigma = sOverbA + deltaSigma;
+
+         // break after converging to tolerance
+         if (Math.abs(sigma - prevSigma) < 0.0000000000001) break;
+
+         prevSigma = sigma;
+      }
+
+      sigmaM2 = 2.0 * sigma1 + sigma;
+      cosSigmaM2 = Math.cos(sigmaM2);
+      cos2SigmaM2 = cosSigmaM2 * cosSigmaM2;
+
+      double cosSigma = Math.cos(sigma);
+      sinSigma = Math.sin(sigma);
+
+      // eq. 8
+      double phi2 = Math.atan2(sinU1 * cosSigma + cosU1 * sinSigma * cosAlpha1, (1.0 - f)
+            * Math.sqrt(sin2Alpha + Math.pow(sinU1 * sinSigma - cosU1 * cosSigma * cosAlpha1, 2.0)));
+
+      // eq. 9
+      double tanLambda = sinSigma * sinAlpha1 / (cosU1 * cosSigma - sinU1 * sinSigma * cosAlpha1);
+      double lambda = Math.atan(tanLambda);
+
+      // eq. 10
+      double C = (f / 16) * cos2Alpha * (4 + f * (4 - 3 * cos2Alpha));
+
+      // eq. 11
+      double L = lambda - (1 - C) * f * sinAlpha * (sigma + C * sinSigma * (cosSigmaM2 + C * cosSigma * (-1 + 2 * cos2SigmaM2)));
+
+      // eq. 12
+      double alpha2 = Math.atan2(sinAlpha, -sinU1 * sinSigma + cosU1 * cosSigma * cosAlpha1);
+
+      // build result
+      double latitude = phi2 / PiOver180;
+      double longitude = start.lonDec + (L / PiOver180);
+
+      if ((endBearing != null) && (endBearing.length > 0))
+      {
+         endBearing[0] = alpha2 / PiOver180;
+      }
+
+      return new TrackPoint(latitude, longitude);
+   }
+
+   /**
+    * Calculate the destination after traveling a specified distance, and a
+    * specified starting bearing, for an initial location. This is the solution
+    * to the direct geodetic problem.
+    * 
+    * @param ellipsoid reference ellipsoid to use
+    * @param start starting location
+    * @param startBearing starting bearing (degrees)
+    * @param distance distance to travel (meters)
+    * @return
+    */
+   static public TrackPoint calculateEndingGlobalCoordinates(Ellipsoid ellipsoid, TrackPoint start, double startBearing, double distance)
+   {
+      return calculateEndingGlobalCoordinates(ellipsoid, start, startBearing, distance, null);
+   }
+
+   /**
+    * Calculate the geodetic curve between two points on a specified reference
+    * ellipsoid. This is the solution to the inverse geodetic problem.
+    * 
+    * @param ellipsoid reference ellipsoid to use
+    * @param start starting coordinates
+    * @param end ending coordinates
+    * @return
+    */
+//   public GeodeticCurve calculateGeodeticCurve(Ellipsoid ellipsoid, TrackPoint start, TrackPoint end)
+   static public double calculateDistanceAndBearing(Ellipsoid ellipsoid, TrackPoint start, TrackPoint end, double[] bearing)
+   {
+      //
+      // All equation numbers refer back to Vincenty's publication:
+      // See http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf
+      //
+
+      // get constants
+      double a = ellipsoid.getSemiMajorAxis();
+      double b = ellipsoid.getSemiMinorAxis();
+      double f = ellipsoid.getFlattening();
+
+      // get parameters as radians
+      double phi1 = start.latDec * PiOver180;
+      double lambda1 = start.lonDec * PiOver180;
+      double phi2 = end.latDec * PiOver180;
+      double lambda2 = end.lonDec * PiOver180;
+
+      // calculations
+      double a2 = a * a;
+      double b2 = b * b;
+      double a2b2b2 = (a2 - b2) / b2;
+
+      double omega = lambda2 - lambda1;
+
+      double tanphi1 = Math.tan(phi1);
+      double tanU1 = (1.0 - f) * tanphi1;
+      double U1 = Math.atan(tanU1);
+      double sinU1 = Math.sin(U1);
+      double cosU1 = Math.cos(U1);
+
+      double tanphi2 = Math.tan(phi2);
+      double tanU2 = (1.0 - f) * tanphi2;
+      double U2 = Math.atan(tanU2);
+      double sinU2 = Math.sin(U2);
+      double cosU2 = Math.cos(U2);
+
+      double sinU1sinU2 = sinU1 * sinU2;
+      double cosU1sinU2 = cosU1 * sinU2;
+      double sinU1cosU2 = sinU1 * cosU2;
+      double cosU1cosU2 = cosU1 * cosU2;
+
+      // eq. 13
+      double lambda = omega;
+
+      // intermediates we'll need to compute 's'
+      double A = 0.0;
+      double B = 0.0;
+      double sigma = 0.0;
+      double deltasigma = 0.0;
+      double lambda0;
+      boolean converged = false;
+
+      for (int i = 0; i < 20; i++)
+      {
+         lambda0 = lambda;
+
+         double sinlambda = Math.sin(lambda);
+         double coslambda = Math.cos(lambda);
+
+         // eq. 14
+         double sin2sigma = (cosU2 * sinlambda * cosU2 * sinlambda) + (cosU1sinU2 - sinU1cosU2 * coslambda) * (cosU1sinU2 - sinU1cosU2 * coslambda);
+         double sinsigma = Math.sqrt(sin2sigma);
+
+         // eq. 15
+         double cossigma = sinU1sinU2 + (cosU1cosU2 * coslambda);
+
+         // eq. 16
+         sigma = Math.atan2(sinsigma, cossigma);
+
+         // eq. 17 Careful! sin2sigma might be almost 0!
+         double sinalpha = (sin2sigma == 0) ? 0.0 : cosU1cosU2 * sinlambda / sinsigma;
+         double alpha = Math.asin(sinalpha);
+         double cosalpha = Math.cos(alpha);
+         double cos2alpha = cosalpha * cosalpha;
+
+         // eq. 18 Careful! cos2alpha might be almost 0!
+         double cos2sigmam = cos2alpha == 0.0 ? 0.0 : cossigma - 2 * sinU1sinU2 / cos2alpha;
+         double u2 = cos2alpha * a2b2b2;
+
+         double cos2sigmam2 = cos2sigmam * cos2sigmam;
+
+         // eq. 3
+         A = 1.0 + u2 / 16384 * (4096 + u2 * (-768 + u2 * (320 - 175 * u2)));
+
+         // eq. 4
+         B = u2 / 1024 * (256 + u2 * (-128 + u2 * (74 - 47 * u2)));
+
+         // eq. 6
+         deltasigma = B * sinsigma
+               * (cos2sigmam + B / 4 * (cossigma * (-1 + 2 * cos2sigmam2) - B / 6 * cos2sigmam * (-3 + 4 * sin2sigma) * (-3 + 4 * cos2sigmam2)));
+
+         // eq. 10
+         double C = f / 16 * cos2alpha * (4 + f * (4 - 3 * cos2alpha));
+
+         // eq. 11 (modified)
+         lambda = omega + (1 - C) * f * sinalpha * (sigma + C * sinsigma * (cos2sigmam + C * cossigma * (-1 + 2 * cos2sigmam2)));
+
+         // see how much improvement we got
+         double change = Math.abs((lambda - lambda0) / lambda);
+
+         if ((i > 1) && (change < 0.0000000000001))
+         {
+            converged = true;
+            break;
+         }
+      }
+
+      // eq. 19
+      double s = b * A * (sigma - deltasigma);      
+      double alpha1;
+      double alpha2;
+
+      // didn't converge? must be N/S
+      if (!converged)
+      {
+         if (phi1 > phi2)
+         {
+            alpha1 = 180.0;
+            alpha2 = 0.0;
+         }
+         else if (phi1 < phi2)
+         {
+            alpha1 = 0.0;
+            alpha2 = 180.0;
+         }
+         else
+         {
+            alpha1 = Double.NaN;
+            alpha2 = Double.NaN;
+         }
+      }
+
+      // else, it converged, so do the math
+      else
+      {
+         double radians;
+
+         // eq. 20
+         radians = Math.atan2(cosU2 * Math.sin(lambda), (cosU1sinU2 - sinU1cosU2 * Math.cos(lambda)));
+         if (radians < 0.0) radians += TwoPi;
+         alpha1 = radians / PiOver180;
+
+         // eq. 21
+         radians = Math.atan2(cosU1 * Math.sin(lambda), (-sinU1cosU2 + cosU1sinU2 * Math.cos(lambda))) + Math.PI;
+         if (radians < 0.0) radians += TwoPi;
+         alpha2 = radians / PiOver180;
+      }
+
+      if (alpha1 >= 360.0) alpha1 -= 360.0;
+      if (alpha2 >= 360.0) alpha2 -= 360.0;
+      
+      if ((bearing != null) && (bearing.length > 0))
+      {
+         bearing[0] = alpha1;
+      }
+
+//      return new GeodeticCurve(s, alpha1, alpha2);
+      return s;
+   }
+   
+   static public double calculateDistance(Ellipsoid ellipsoid, TrackPoint start, TrackPoint end)
+   {
+	   return calculateDistanceAndBearing(ellipsoid, start, end, null);
+   }
+   
+   static public double calculateBearing(Ellipsoid ellipsoid, TrackPoint start, TrackPoint end)
+   {
+	   double bearing[]={0.0};
+	   calculateDistanceAndBearing(ellipsoid, start, end, bearing);
+	   return bearing[0];
+   }
+
+}
\ No newline at end of file



From pfeffer at mail.berlios.de  Wed Apr  9 01:41:33 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 9 Apr 2008 01:41:33 +0200
Subject: [Cachewolf-svn] r1347 - trunk/src/CacheWolf
Message-ID: <200804082341.m38NfXYl014962@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-09 01:41:31 +0200 (Wed, 09 Apr 2008)
New Revision: 1347

Added:
   trunk/src/CacheWolf/NewProfileWizard.java
Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/ProfilesForm.java
Log:
NewProfileWizard: now also displayed when started from the selection of profiles
Details: the <cache>.xml are now saved regardless on wheter "save unsaved changes" is ansered with "no"

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-08 20:45:25 UTC (rev 1346)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-08 23:41:31 UTC (rev 1347)
@@ -233,28 +233,11 @@
 			// subMenu for profiles, part of "Application" menu 
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == mnuNewProfile){
-				Global.mainTab.saveUnsavedChanges(true);
-				NewProfileForm f=new NewProfileForm(pref.baseDir);
-				int code=f.execute(getFrame(), Gui.CENTER_FRAME);
-				if (code==0) {
-					profile.clearProfile(); 
-					pref.lastProfile=profile.name=f.profileDir;
-					pref.savePreferences(); // Remember that this was the last profile used
-					profile.dataDir=pref.baseDir+f.profileDir+"/";
-					
-					CoordsScreen cs = new CoordsScreen();
-					cs.setFields(new CWPoint(), CWPoint.CW);
-					if (cs.execute() == FormBase.IDOK) {
-						profile.centre.set(cs.getCoords());
-						profile.hasUnsavedChanges=true;
-					}
-
+				if (NewProfileWizard.startNewProfileWizard(getFrame()) ) {
 					Filter.showBlacklisted=false;
 					filtBlack.modifiers&=~MenuItem.Checked;
-					tbp.refreshTable();
-					Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
+					tbp.refreshTable(); // TODO if the list was empty before a new profile was created, this causes a ArrayIndexOutOfBoundsException, it doesn't cause any harm, but should be caught at the appropriate point
 				}
-				f.close(0);
 			}
 			if(mev.selectedItem == mnuOpenProfile){
 				Global.mainTab.saveUnsavedChanges(true);
@@ -458,6 +441,7 @@
 			}
 			if(mev.selectedItem == exit){
 				Global.mainTab.saveUnsavedChanges(true);
+				CacheHolder.saveAllModifiedDetails();
 				tbp.saveColWidth(pref);
 				ewe.sys.Vm.exit(0);
 			}

Added: trunk/src/CacheWolf/NewProfileWizard.java
===================================================================
--- trunk/src/CacheWolf/NewProfileWizard.java	2008-04-08 20:45:25 UTC (rev 1346)
+++ trunk/src/CacheWolf/NewProfileWizard.java	2008-04-08 23:41:31 UTC (rev 1347)
@@ -0,0 +1,31 @@
+package CacheWolf;
+
+import ewe.ui.FormBase;
+import ewe.ui.Gui;
+
+public class NewProfileWizard {
+
+	static public boolean startNewProfileWizard(ewe.ui.Frame parent) {
+		if (Global.mainTab != null) Global.mainTab.saveUnsavedChanges(true);
+		Preferences pref = Global.getPref();
+		NewProfileForm f=new NewProfileForm(pref.baseDir);
+		int code=f.execute(parent, Gui.CENTER_FRAME);
+		if (code==0) {
+			Profile profile = Global.getProfile();
+			profile.clearProfile(); 
+			pref.lastProfile=profile.name=f.profileDir;
+			pref.savePreferences(); // Remember that this was the last profile used
+			profile.dataDir=pref.baseDir+f.profileDir+"/";
+			
+			CoordsScreen cs = new CoordsScreen();
+			cs.setFields(new CWPoint(), CWPoint.CW);
+			if (cs.execute() == FormBase.IDOK) {
+				profile.centre.set(cs.getCoords());
+				profile.hasUnsavedChanges=true;
+			}
+			Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
+		}
+		f.close(0);
+		return (code == 0);
+	}
+}

Modified: trunk/src/CacheWolf/ProfilesForm.java
===================================================================
--- trunk/src/CacheWolf/ProfilesForm.java	2008-04-08 20:45:25 UTC (rev 1346)
+++ trunk/src/CacheWolf/ProfilesForm.java	2008-04-08 23:41:31 UTC (rev 1347)
@@ -121,8 +121,10 @@
 				}
 			}
 			if (ev.target == btnNew){
-				newSelectedProfile=createNewProfile();
-				if (newSelectedProfile.length()>0) close(1);
+				if (NewProfileWizard.startNewProfileWizard(getFrame()) ) {
+					newSelectedProfile = Global.getProfile().name;
+					close(1);
+				}
 			}
 		}
 		super.onEvent(ev);



From mik77 at mail.berlios.de  Wed Apr  9 20:58:09 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 9 Apr 2008 20:58:09 +0200
Subject: [Cachewolf-svn] r1348 - trunk/src/CacheWolf
Message-ID: <200804091858.m39Iw9Zb001029@sheep.berlios.de>

Author: mik77
Date: 2008-04-09 20:58:07 +0200 (Wed, 09 Apr 2008)
New Revision: 1348

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
Disable hour class when canceling deletion of caches

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-08 23:41:31 UTC (rev 1347)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-09 18:58:07 UTC (rev 1348)
@@ -127,7 +127,10 @@
 				if ( ((CacheHolder)cacheDB.get(i)).is_Checked) count++;
 			}
 			if (count>0) {
-				if ((new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1022, "Delete all caches that have a tick?"), FormBase.YESB | FormBase.NOB)).execute() != FormBase.IDYES) return;
+				if ((new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1022, "Delete all caches that have a tick?"), FormBase.YESB | FormBase.NOB)).execute() != FormBase.IDYES) {
+					Vm.showWait(false);
+					return;
+				}
 				DataMover dm=new DataMover();
 				myProgressBarForm pbf = new myProgressBarForm();
 				Handle h = new Handle();



From mik77 at mail.berlios.de  Wed Apr  9 23:42:38 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 9 Apr 2008 23:42:38 +0200
Subject: [Cachewolf-svn] r1349 - trunk/src/CacheWolf/navi
Message-ID: <200804092142.m39LgcKD015488@sheep.berlios.de>

Author: mik77
Date: 2008-04-09 23:42:37 +0200 (Wed, 09 Apr 2008)
New Revision: 1349

Modified:
   trunk/src/CacheWolf/navi/GeodeticCalculator.java
Log:
Avoid devision by zero when calculating distance.

Modified: trunk/src/CacheWolf/navi/GeodeticCalculator.java
===================================================================
--- trunk/src/CacheWolf/navi/GeodeticCalculator.java	2008-04-09 18:58:07 UTC (rev 1348)
+++ trunk/src/CacheWolf/navi/GeodeticCalculator.java	2008-04-09 21:42:37 UTC (rev 1349)
@@ -268,7 +268,15 @@
          lambda = omega + (1 - C) * f * sinalpha * (sigma + C * sinsigma * (cos2sigmam + C * cossigma * (-1 + 2 * cos2sigmam2)));
 
          // see how much improvement we got
-         double change = Math.abs((lambda - lambda0) / lambda);
+         // modification by MiK77: check if lambda is zero to avoid division by zero. Use lambda0 for division in this case.
+         double change = 1.0;
+         if (lambda != 0) {
+        	 change = Math.abs((lambda - lambda0) / lambda);
+         } else if (lambda0 != 0){
+        	 change = Math.abs((lambda - lambda0) / lambda0); 
+         } else {
+        	 change = 0.0;
+         }
 
          if ((i > 1) && (change < 0.0000000000001))
          {



From pfeffer at mail.berlios.de  Thu Apr 10 15:14:24 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 10 Apr 2008 15:14:24 +0200
Subject: [Cachewolf-svn] r1350 - trunk/src/CacheWolf
Message-ID: <200804101314.m3ADEOXB026914@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-10 15:14:23 +0200 (Thu, 10 Apr 2008)
New Revision: 1350

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
Log:
CacheDetails: Bug fixed: writes <cache>.xml in low case letters and accepts also upper case letters

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2008-04-09 21:42:37 UTC (rev 1349)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2008-04-10 13:14:23 UTC (rev 1350)
@@ -4,6 +4,7 @@
 import ewe.filechooser.FileChooserBase;
 import ewe.io.BufferedWriter;
 import ewe.io.File;
+import ewe.io.FileNotFoundException;
 import ewe.io.FileReader;
 import ewe.io.FileWriter;
 import ewe.io.IOException;
@@ -142,7 +143,10 @@
 		*/
 		public void readCache(String dir) throws IOException{
 			String dummy;
-			FileReader in = new FileReader(dir+wayPoint+".xml");
+			FileReader in = null;
+			if (new File(dir + wayPoint.toLowerCase() + ".xml").exists()) in = new FileReader(dir+wayPoint.toLowerCase() + ".xml");
+			if (new File(dir + wayPoint + ".xml").exists()) in = new FileReader(dir+wayPoint + ".xml");
+			if (in == null) throw new FileNotFoundException(dir+wayPoint.toLowerCase()+".xml");
 			String text= in.readAll();
 			in.close();
 			Extractor ex = new Extractor(text, "<DETAILS><![CDATA[", "]]></DETAILS>", 0, true);		
@@ -261,9 +265,9 @@
 			}
 			//Vm.debug("Writing to: " +dir + "for: " + wayPoint);
 			try{
-			  detfile = new PrintWriter(new BufferedWriter(new FileWriter(dir + wayPoint + ".xml")));
+			  detfile = new PrintWriter(new BufferedWriter(new FileWriter(dir + wayPoint.toLowerCase() + ".xml")));
 			} catch (Exception e) {
-				Global.getPref().log("Problem opening details file",e,true);
+				Global.getPref().log("Problem creating details file",e,true);
 				return;
 			}
 			try{



From mirabilos at mail.berlios.de  Thu Apr 10 15:25:31 2008
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Thu, 10 Apr 2008 15:25:31 +0200
Subject: [Cachewolf-svn] r1351 - trunk/src/CacheWolf
Message-ID: <200804101325.m3ADPVEC028261@sheep.berlios.de>

Author: mirabilos
Date: 2008-04-10 15:25:30 +0200 (Thu, 10 Apr 2008)
New Revision: 1351

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/SafeXML.java
Log:
Dr. Pfeffer asked me to make a bugfix for
| http://www.geoclub.de/viewtopic.php?f=40&t=23781&start=10
so here it is ;-)

I might not be the best Java(tm) coder, but...
works for me when creating a profile named "W&G"


Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-04-10 13:14:23 UTC (rev 1350)
+++ trunk/src/CacheWolf/Preferences.java	2008-04-10 13:25:30 UTC (rev 1351)
@@ -348,38 +348,38 @@
 			PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(datei)));
 			outp.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n");
 			outp.print("<preferences>\n");
-			outp.print("	<basedir dir = \""+ baseDir +"\"/>\n");
-			outp.print("    <lastprofile autoreload=\""+autoReloadLastProfile+"\">"+lastProfile+"</lastprofile>\n"); //RB
+			outp.print("	<basedir dir = \"" + SafeXML.strxmlencode(baseDir) + "\"/>\n");
+			outp.print("    <lastprofile autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\">" + SafeXML.strxmlencode(lastProfile) + "</lastprofile>\n"); //RB
 			outp.print("	<alias name =\""+ SafeXML.clean(myAlias) +"\" password=\""+SafeXML.clean(password)+"\" />\n");
 			outp.print("	<alias2 name =\""+ SafeXML.clean(myAlias2) +"\"/>\n");
-			outp.print("	<browser name = \""+browser+"\"/>\n");
-			outp.print("	<proxy prx = \""+ myproxy+"\" prt = \""+ myproxyport + "\" active = \""+ proxyActive +"\" />\n");
-			outp.print("	<port portname = \""+ mySPO.portName +"\" baud = \""+ mySPO.baudRate+"\"/>\n");
-			outp.print("	<portforward active= \""+ Convert.toString(forwardGPS)+"\" destinationHost = \""+ forwardGpsHost+"\"/>\n");
-			outp.print("	<portlog active= \""+ Convert.toString(logGPS)+"\" logTimer = \""+ logGPSTimer +"\"/>\n");
-			outp.print("    <font size =\""+fontSize+"\"/>\n");
-			outp.print("    <screen menuattop=\""+menuAtTop+"\" tabsattop=\""+tabsAtTop+"\" showstatus=\""+showStatus+"\" hasclosebutton=\""+hasCloseButton+"\"/>\n");
-			outp.print("    <fixedsip state = \""+fixSIP+"\"/>\n");
-			outp.print("    <listview colmap=\""+listColMap+"\" colwidths=\""+listColWidth+"\" />\n");
-			outp.print("    <travelbugs colmap=\""+travelbugColMap+"\" colwidths=\""+travelbugColWidth+"\" shownonlogged=\""+travelbugShowOnlyNonLogged+"\" />\n");
-			outp.print("    <descpanel showimages=\""+descShowImg+"\" />\n");
-			outp.print("    <imagepanel showdeletedimages=\""+showDeletedImages+"\"/>\n");
-			outp.print("    <hintlogpanel logsperpage=\""+logsPerPage+"\" initialhintheight=\""+initialHintHeight+"\"  maxspiderlogs=\""+maxLogsToSpider+"\" />\n");
-			outp.print("    <solver ignorevariablecase=\""+solverIgnoreCase+"\" degMode=\""+solverDegMode+"\" />\n");
-			outp.print("    <garmin connection = \""+garminConn+"\" GPSBabelOptions = \""+garminGPSBabelOptions+"\" MaxWaypointLength = \""+garminMaxLen+"\" />\n");
-			outp.print("    <opencaching downloadPicsOC=\""+downloadPicsOC+"\" downloadMaps=\""+downloadMapsOC+"\" downloadMissing=\""+downloadmissingOC+"\"/>\n");
-			outp.print("	<location lat = \""+curCentrePt.getLatDeg(CWPoint.DD)+"\" long = \""+curCentrePt.getLonDeg(CWPoint.DD)+"\"/>\n");
-			outp.print("    <spider forcelogin=\""+forceLogin+"\"/>\n");
-			outp.print("    <gotopanel northcentered=\""+northCenteredGoto+"\" />\n");
-			outp.print("    <details cacheSize=\""+maxDetails+"\" delete=\""+deleteDetails+"\"/>\n");
-			if (customMapsPath!=null) outp.print("	<mapspath dir = \""+ customMapsPath.replace('\\','/') +"\"/>\n");
+			outp.print("	<browser name = \"" + SafeXML.strxmlencode(browser) + "\"/>\n");
+			outp.print("	<proxy prx = \"" + SafeXML.strxmlencode(myproxy) + "\" prt = \"" + SafeXML.strxmlencode(myproxyport) + "\" active = \"" + SafeXML.strxmlencode(proxyActive) + "\" />\n");
+			outp.print("	<port portname = \"" + SafeXML.strxmlencode(mySPO.portName) + "\" baud = \"" + SafeXML.strxmlencode(mySPO.baudRate) + "\"/>\n");
+			outp.print("	<portforward active= \"" + SafeXML.strxmlencode(Convert.toString(forwardGPS)) + "\" destinationHost = \"" + SafeXML.strxmlencode(forwardGpsHost) + "\"/>\n");
+			outp.print("	<portlog active= \"" + SafeXML.strxmlencode(Convert.toString(logGPS)) + "\" logTimer = \"" + SafeXML.strxmlencode(logGPSTimer) + "\"/>\n");
+			outp.print("    <font size =\"" + SafeXML.strxmlencode(fontSize) + "\"/>\n");
+			outp.print("    <screen menuattop=\"" + SafeXML.strxmlencode(menuAtTop) + "\" tabsattop=\"" + SafeXML.strxmlencode(tabsAtTop) + "\" showstatus=\"" + SafeXML.strxmlencode(showStatus) + "\" hasclosebutton=\"" + SafeXML.strxmlencode(hasCloseButton) + "\"/>\n");
+			outp.print("    <fixedsip state = \"" + SafeXML.strxmlencode(fixSIP) + "\"/>\n");
+			outp.print("    <listview colmap=\"" + SafeXML.strxmlencode(listColMap) + "\" colwidths=\"" + SafeXML.strxmlencode(listColWidth) + "\" />\n");
+			outp.print("    <travelbugs colmap=\"" + SafeXML.strxmlencode(travelbugColMap) + "\" colwidths=\"" + SafeXML.strxmlencode(travelbugColWidth) + "\" shownonlogged=\"" + SafeXML.strxmlencode(travelbugShowOnlyNonLogged) + "\" />\n");
+			outp.print("    <descpanel showimages=\"" + SafeXML.strxmlencode(descShowImg) + "\" />\n");
+			outp.print("    <imagepanel showdeletedimages=\"" + SafeXML.strxmlencode(showDeletedImages) + "\"/>\n");
+			outp.print("    <hintlogpanel logsperpage=\"" + SafeXML.strxmlencode(logsPerPage) + "\" initialhintheight=\"" + SafeXML.strxmlencode(initialHintHeight) + "\"  maxspiderlogs=\"" + SafeXML.strxmlencode(maxLogsToSpider) + "\" />\n");
+			outp.print("    <solver ignorevariablecase=\"" + SafeXML.strxmlencode(solverIgnoreCase) + "\" degMode=\"" + SafeXML.strxmlencode(solverDegMode) + "\" />\n");
+			outp.print("    <garmin connection = \"" + SafeXML.strxmlencode(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.strxmlencode(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) + "\" />\n");
+			outp.print("    <opencaching downloadPicsOC=\"" + SafeXML.strxmlencode(downloadPicsOC) + "\" downloadMaps=\"" + SafeXML.strxmlencode(downloadMapsOC) + "\" downloadMissing=\"" + SafeXML.strxmlencode(downloadmissingOC) + "\"/>\n");
+			outp.print("	<location lat = \"" + SafeXML.strxmlencode(curCentrePt.getLatDeg(CWPoint.DD)) + "\" long = \"" + SafeXML.strxmlencode(curCentrePt.getLonDeg(CWPoint.DD)) + "\"/>\n");
+			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\"/>\n");
+			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
+			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
+			if (customMapsPath!=null) outp.print("	<mapspath dir = \"" + SafeXML.strxmlencode(customMapsPath.replace('\\','/')) + "\"/>\n");
 			if (debug) outp.print("    <debug value=\"true\" />\n"); // Keep the debug switch if it is set
 			// save last path of different exporters
 			Iterator itPath = exporterPaths.entries();
 			MapEntry entry;
 			while(itPath.hasNext()){
 				entry = (MapEntry) itPath.next();
-				outp.print("    <expPath key = \"" + entry.getKey().toString() + "\" value = \"" + entry.getValue().toString().replace('\\', '/') + "\"/>\n");
+				outp.print("    <expPath key = \"" + SafeXML.strxmlencode(entry.getKey().toString()) + "\" value = \"" + SafeXML.strxmlencode(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
 			}
 			outp.print("</preferences>");
 			outp.close();

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2008-04-10 13:14:23 UTC (rev 1350)
+++ trunk/src/CacheWolf/SafeXML.java	2008-04-10 13:25:30 UTC (rev 1351)
@@ -388,4 +388,128 @@
 		return dummy;
 	}
 
+	/**
+	 * Converts a data string to something that is safe to use inside
+	 * an XML file (like prefs.xml) - entities like &amp; are *NOT*
+	 * valid XML unless declared specially, so we must use the numerical
+	 * values here.
+	 *
+	 * @param src (String) raw text to be processed
+	 *
+	 * @return (String) translated text, or null if input is null
+	 */
+	public static String strxmlencode(boolean src) {
+		/* bools are always safe */
+		return (src ? "true" : "false");
+	}
+	public static String strxmlencode(int src) {
+		/* numbers are always safe */
+		return (Integer.toString(src));
+	}
+	public static String strxmlencode(String src) {
+		int i, slen = src.length();
+		char tmp[];
+		StringBuffer dst = new StringBuffer(slen);
+
+		if (src == null)
+			return (null);
+		tmp = new char[slen];
+		src.getChars(0, slen, tmp, 0);
+		for (i = 0; i < slen; ++i)
+			if (tmp[i] == '&' || tmp[i] == '<' ||
+			    tmp[i] == '>' || tmp[i] > 0x7E) {
+				dst.append("&#");
+				dst.append((int)tmp[i]);
+				dst.append(';');
+			} else
+				dst.append(tmp[i]);
+		return (dst.toString());
+	}
+
+	/**
+	 * Converts a string that is safe to use inside an XML file (like
+	 * prefs.xml) back to a data string - entities like &amp; are *NOT*
+	 * valid XML unless declared specially, so we must use the numerical
+	 * values here. We also try to decode non-standard entities.
+	 *
+	 * @param src (String) translated text to be processed
+	 *
+	 * @return (String) raw text, or null if input is null
+	 */
+	public static String strxmldecode(String src) {
+		int i, j, slen = src.length();
+		char ch, tmp[];
+		StringBuffer dst = new StringBuffer(slen);
+		boolean isinval;
+
+		if (src == null)
+			return (null);
+		tmp = new char[slen];
+		src.getChars(0, slen, tmp, 0);
+		i = 0;
+		while (i < slen)
+			if (tmp[i] == '&') {
+				/* first scan if we have a trailing ; */
+				if (src.indexOf(';', i) == -1) {
+					/* no - ignore and proceed */
+					i++;
+					dst.append(0xFFFD);
+				} else if (tmp[++i] == '#') {
+					/* yes - numerical value? */
+					i++;
+					ch = 0;
+					isinval = false;
+					if (tmp[i] == 'x' || tmp[i] == 'X') {
+						/* hexadecimal numeric */
+						i++;
+						while ((j = tmp[i++]) != ';') {
+							ch *= 16;
+							if (j < 0x30)
+								isinval = true;
+							else if (j < 0x3A)
+								ch += j - 0x30;
+							else if (j < 0x41)
+								isinval = true;
+							else if (j < 0x47)
+								ch += j - 0x37;
+							else if (j < 0x61)
+								isinval = true;
+							else if (j < 0x67)
+								ch += j - 0x57;
+							else
+								isinval = true;
+						}
+					} else
+						/* decimal numeric */
+						while ((j = tmp[i++]) != ';') {
+							ch *= 10;
+							if (j < 0x30)
+								isinval = true;
+							else if (j < 0x3A)
+								ch += j - 0x30;
+							else
+								isinval = true;
+						}
+					if (isinval)
+						ch = 0xFFFD;
+					dst.append(ch);
+				} else {
+					/* yes - string value */
+					StringBuffer tconv = new StringBuffer("#");
+					String tc;
+
+					do {
+						tconv.append(tmp[i]);
+					} while (tmp[i++] != ';');
+
+					if ((tc = (String)iso2htmlMappings.get(tconv)) == null)
+						/* invalid entity, just retain it */
+						dst.append(tconv);
+					else
+						dst.append(tc);
+				}
+			} else
+				dst.append(tmp[i++]);
+		return (dst.toString());
+	}
 }



From pfeffer at mail.berlios.de  Thu Apr 10 15:52:01 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 10 Apr 2008 15:52:01 +0200
Subject: [Cachewolf-svn] r1352 - trunk/src/CacheWolf
Message-ID: <200804101352.m3ADq1FO031107@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-10 15:51:59 +0200 (Thu, 10 Apr 2008)
New Revision: 1352

Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/TablePanel.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Bug fixed: avoid ArrayIndexOutOfBoundException in case of an empty profile

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-10 13:25:30 UTC (rev 1351)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-10 13:51:59 UTC (rev 1352)
@@ -524,7 +524,7 @@
 			// "Organise" pulldown menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == orgNewWP){
-				Global.mainTab.lastselected = ((CacheHolder)cacheDB.get(Global.mainTab.tbP.getSelectedCache())).wayPoint;
+				if (Global.mainTab.tbP.getSelectedCache() >= 0) Global.mainTab.lastselected = ((CacheHolder)cacheDB.get(Global.mainTab.tbP.getSelectedCache())).wayPoint;
 				Global.mainTab.newWaypoint(new CacheHolder());
 			}
 

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2008-04-10 13:25:30 UTC (rev 1351)
+++ trunk/src/CacheWolf/TablePanel.java	2008-04-10 13:51:59 UTC (rev 1352)
@@ -94,14 +94,18 @@
 	/** Move all filtered caches to the end of the table and redisplay table */
 	//TODO Add a sort here to restore the sort after a filter
 	public void refreshTable(){
-		String wayPoint = ((CacheHolder)cacheDB.get(getSelectedCache())).wayPoint;
+		String wayPoint;
+		if (getSelectedCache() >= 0) wayPoint = ((CacheHolder)cacheDB.get(getSelectedCache())).wayPoint;
+		else wayPoint = null;
 		myMod.updateRows();
 
 		// Check whether the currently selected cache is still visible
-		int rownum = Global.getProfile().getCacheIndex(wayPoint);
-		if ( (rownum < 0) || (rownum>=myMod.numRows) )
-			rownum = 0;	
-
+		int rownum = 0;
+		if (wayPoint != null) {
+			rownum = Global.getProfile().getCacheIndex(wayPoint);
+			if ( (rownum < 0) || (rownum>=myMod.numRows) )
+				rownum = 0;	
+		}
 		selectRow(rownum);
 
 		tc.update(true); // Update and repaint

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-10 13:25:30 UTC (rev 1351)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-10 13:51:59 UTC (rev 1352)
@@ -159,6 +159,10 @@
 		}
 
 		if (selectedItem.toString().equals(MyLocale.getMsg(1019,"Centre"))){
+			if (tbp.getSelectedCache() < 0) {
+				Global.getPref().log("popupMenuEvent: getSelectedCache() < 0");
+				return;
+			}
 			CacheHolder thisCache = (CacheHolder)cacheDB.get(tbp.getSelectedCache());
 			CWPoint cp=new CWPoint(thisCache.LatLon);
 			if (!cp.isValid()){



From mik77 at mail.berlios.de  Thu Apr 10 22:03:36 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 10 Apr 2008 22:03:36 +0200
Subject: [Cachewolf-svn] r1353 - trunk/src/CacheWolf
Message-ID: <200804102003.m3AK3aOo020443@sheep.berlios.de>

Author: mik77
Date: 2008-04-10 22:03:34 +0200 (Thu, 10 Apr 2008)
New Revision: 1353

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
Log:
Don't try again to open file, if it is already opened.

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2008-04-10 13:51:59 UTC (rev 1352)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2008-04-10 20:03:34 UTC (rev 1353)
@@ -145,7 +145,9 @@
 			String dummy;
 			FileReader in = null;
 			if (new File(dir + wayPoint.toLowerCase() + ".xml").exists()) in = new FileReader(dir+wayPoint.toLowerCase() + ".xml");
-			if (new File(dir + wayPoint + ".xml").exists()) in = new FileReader(dir+wayPoint + ".xml");
+			if (in == null) {
+				if (new File(dir + wayPoint + ".xml").exists()) in = new FileReader(dir+wayPoint + ".xml");
+			}
 			if (in == null) throw new FileNotFoundException(dir+wayPoint.toLowerCase()+".xml");
 			String text= in.readAll();
 			in.close();



From mik77 at mail.berlios.de  Thu Apr 10 22:32:51 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 10 Apr 2008 22:32:51 +0200
Subject: [Cachewolf-svn] r1354 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804102032.m3AKWpBp022699@sheep.berlios.de>

Author: mik77
Date: 2008-04-10 22:32:47 +0200 (Thu, 10 Apr 2008)
New Revision: 1354

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Translate some untranslated strings and allow setting invalid coordinates in DetailsPanel

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-10 20:03:34 UTC (rev 1353)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-10 20:32:47 UTC (rev 1354)
@@ -330,6 +330,8 @@
 		1408=Fu%df
 		1409=Yards
 		1410=Meilen
+		1411=Bitte g%fcltige Koordinaten eingeben.
+		1412=Koordinaten ung%fcltig. Trotzdem %fcbernehmen?
 		1500=Ziel:
 		1501=Aktuell
 		1502=Grad

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-10 20:03:34 UTC (rev 1353)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-10 20:32:47 UTC (rev 1354)
@@ -331,6 +331,8 @@
 		1408=feet
 		1409=yards
 		1410=miles
+		1411=Please enter valid coordinates
+		1412=Coordinates invalid. Apply anyway?
 		1500=DST:
 		1501=Current
 		1502=deg

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2008-04-10 20:03:34 UTC (rev 1353)
+++ trunk/src/CacheWolf/CoordsScreen.java	2008-04-10 20:32:47 UTC (rev 1354)
@@ -26,6 +26,8 @@
 	int exitKeys[]={75009};
 	int currFormat;
 	
+	boolean allowInvalid = false;
+	
 	public CoordsScreen()
 	{
 		this.setTitle("");
@@ -225,7 +227,15 @@
 				currFormat = chkFormat.getSelectedIndex();
 				readFields(coordInp, currFormat);
 				if (coordInp.isValid()) this.close(IDOK);
-				else (new MessageBox("Error", "Please enter valid coordinates", FormBase.OKB)).execute();
+				else {
+					if	( allowInvalid ) {
+						if ((new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1412,"Coordinates invalid. Apply anyway?"),FormBase.DEFOKB|FormBase.NOB)).execute() == FormBase.IDOK ) {
+							this.close(IDOK);						
+						}
+					} else {
+						(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(1411,"Please enter valid coordinates"), FormBase.OKB)).execute();						
+					}
+				}
 			}
 			
 			if (ev.target == btnPaste){
@@ -249,7 +259,7 @@
 					coord = new CWPoint(inp);
 				}
 				if (coord.latDec == -91 && coord.lonDec == -361){
-					MessageBox tmpMB = new MessageBox(MyLocale.getMsg(312,"Error"), MyLocale.getMsg(4111,"Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM"), FormBase.OKB);
+					MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4111,"Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM"), FormBase.OKB);
 					tmpMB.exec();
 				}else {
 					currFormat = chkFormat.getSelectedIndex();

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-04-10 20:03:34 UTC (rev 1353)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-04-10 20:32:47 UTC (rev 1354)
@@ -405,6 +405,7 @@
 			else if (ev.target == btnWayLoc){
 				CWPoint coords = new CWPoint(btnWayLoc.getText(),CWPoint.CW);
 				CoordsScreen cs = new CoordsScreen();
+				cs.allowInvalid = true;
 				cs.setFields(coords, CWPoint.CW);
 				if (cs.execute()== FormBase.IDOK){
 					dirty_details=true;



From mik77 at mail.berlios.de  Thu Apr 10 22:53:15 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 10 Apr 2008 22:53:15 +0200
Subject: [Cachewolf-svn] r1355 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804102053.m3AKrFr1024804@sheep.berlios.de>

Author: mik77
Date: 2008-04-10 22:53:11 +0200 (Thu, 10 Apr 2008)
New Revision: 1355

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/myTableControl.java
Log:
Show number of marked caches that will be deleted.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-10 20:32:47 UTC (rev 1354)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-10 20:53:11 UTC (rev 1355)
@@ -282,12 +282,13 @@
 		1019=Diesen als Zentrum setzen
 		1020=Im Browser online %f6ffnen
 		1021=Beschreibung %f6ffnen
-		1022=Alle mit H%e4kchen markierten Caches l%f6schen?
+		1022=Alle mit H%e4kchen markierten Caches (
 		1023=Diese Funktion steht gegenw%e4rtig nur f%fcr Geocaching.com zur Verf%fcgung
 		1024=Entfernungen in der Listenansicht~vom aktuellen Standpunkt aus~neu berechnet
 		1025=Kann Zentrum nicht setzen (GPS-Position unzul%e4ssig)
 		1026=#Rec
 		1027=OC-Idx
+		1028=) l%f6schen?
 		1100=Profile
 		1105=Suchen
 		1106=Profil w%e4hlen oder Neu

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-10 20:32:47 UTC (rev 1354)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-10 20:53:11 UTC (rev 1355)
@@ -34,8 +34,8 @@
 		130=Download from opencaching.de
 		131=Spider from geocaching.com
 		132=to Explorist
-        133=Search all
-        134=Selected Cache
+    133=Search all
+    134=Selected Cache
 		139=Manage Travelbugs
 		140=Organise            
 		141=Copy 
@@ -283,12 +283,13 @@
 		1019=Set this as centre
 		1020=Open online in Browser
 		1021=Open cache description
-		1022=Delete all caches that have a tick?
+		1022=Delete all caches that have a tick (
 		1023=This function is currently only available for geocaching.com
 		1024=Distances in list view recalculated~from current position
 		1025=Cannot set centre (Invalid GPS position)
 		1026=#Rec
 		1027=OC-Idx
+		1028=)?
 		1100=Profiles
 		1105=Browse
 		1106=Choose profile or New

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-10 20:32:47 UTC (rev 1354)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-10 20:53:11 UTC (rev 1355)
@@ -127,7 +127,7 @@
 				if ( ((CacheHolder)cacheDB.get(i)).is_Checked) count++;
 			}
 			if (count>0) {
-				if ((new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1022, "Delete all caches that have a tick?"), FormBase.YESB | FormBase.NOB)).execute() != FormBase.IDYES) {
+				if ((new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1022, "Delete all caches that have a tick (") + count + MyLocale.getMsg(1028, ")?"), FormBase.YESB | FormBase.NOB)).execute() != FormBase.IDYES) {
 					Vm.showWait(false);
 					return;
 				}



From mik77 at mail.berlios.de  Fri Apr 11 11:48:05 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 11 Apr 2008 11:48:05 +0200
Subject: [Cachewolf-svn] r1356 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804110948.m3B9m5Bw027813@sheep.berlios.de>

Author: mik77
Date: 2008-04-11 11:47:55 +0200 (Fri, 11 Apr 2008)
New Revision: 1356

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/src/CacheWolf/MainMenu.java
Log:
- Separator after new menu entry 'New Waypoint"
- 'preferences' is now translated to 'Einstellungen'

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-10 20:53:11 UTC (rev 1355)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-11 09:47:55 UTC (rev 1356)
@@ -9,7 +9,7 @@
 		105=nach TomTom
 		106=nach MS AutoRoute CSV
 		107=Export
-		108=Pr%e4ferenzen
+		108=Einstellungen
 		109=Cacheliste laden
 		110=Speichern & Beenden
 		111=Beenden
@@ -157,7 +157,7 @@
 		597=Wegpunkt
 		598=Type
 		599=Auswahlbox
-		600=Pr%e4ferenzen
+		600=Einstellungen
 		601=Dein Alias:
 		602=Heimatkoordinaten:
 		603=Verzeichnis f%fcr Profile
@@ -232,7 +232,7 @@
 		733=Addi Wpt
 		734=Kein Hauptwegpunkt gefunden zu
 		735=Addi Waypoints m%fcssen das Format xxYYYY haben, wobei xx beliebige Zeichen und YYYY die Zeichen des Hauptcaches nach dem GC sind
-		736=Zu viele Logs (Maximum in Pr%e4ferenzen einstellen)
+		736=Zu viele Logs (Maximum in den Einstellungen %e4ndern)
 		737=Cache-Attribute
 		738=Attribute
 		739=Filter mit

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-10 20:53:11 UTC (rev 1355)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-11 09:47:55 UTC (rev 1356)
@@ -168,14 +168,15 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Organise" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] organiseMenuItems=new MenuItem[7];
+		MenuItem[] organiseMenuItems=new MenuItem[8];
 		organiseMenuItems[0] = orgNewWP = new MenuItem(MyLocale.getMsg(214,"New Waypoint"));
-		organiseMenuItems[1] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy")); 
-		organiseMenuItems[2] = orgMove  = new MenuItem(MyLocale.getMsg(142,"Move")); 
-		organiseMenuItems[3] = orgDelete   = new MenuItem(MyLocale.getMsg(143,"Delete"));
-		organiseMenuItems[4] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,"Rebuild Index"));
-		organiseMenuItems[5] = mnuSeparator;
-		organiseMenuItems[6] = orgTravelbugs = new MenuItem(MyLocale.getMsg(139,"Manage travelbugs"));
+		organiseMenuItems[1] = mnuSeparator;
+		organiseMenuItems[2] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy")); 
+		organiseMenuItems[3] = orgMove  = new MenuItem(MyLocale.getMsg(142,"Move")); 
+		organiseMenuItems[4] = orgDelete   = new MenuItem(MyLocale.getMsg(143,"Delete"));
+		organiseMenuItems[5] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,"Rebuild Index"));
+		organiseMenuItems[6] = mnuSeparator;
+		organiseMenuItems[7] = orgTravelbugs = new MenuItem(MyLocale.getMsg(139,"Manage travelbugs"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(140,"Organise"),new Menu(organiseMenuItems,null)));
 
 		///////////////////////////////////////////////////////////////////////



From engywuck at mail.berlios.de  Fri Apr 11 16:06:47 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 11 Apr 2008 16:06:47 +0200
Subject: [Cachewolf-svn] r1357 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804111406.m3BE6lM1018434@sheep.berlios.de>

Author: engywuck
Date: 2008-04-11 16:06:43 +0200 (Fri, 11 Apr 2008)
New Revision: 1357

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/myTableControl.java
Log:
Little Enhancement: When there are ticked but invisible caches, then the user is asked, if he wants to delete the invisible ones, too. (http://www.geoclub.de/viewtopic.php?f=40&t=23763)

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-11 09:47:55 UTC (rev 1356)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-11 14:06:43 UTC (rev 1357)
@@ -289,6 +289,9 @@
 		1026=#Rec
 		1027=OC-Idx
 		1028=) l%f6schen?
+		1029=Es gibt angew%e4hlte aber nicht sichtbare Caches.%0a(Caches:+
+        1030=, zus%e4tzliche Wegpunkte:+
+        1031=Diese auch l%f6schen?
 		1100=Profile
 		1105=Suchen
 		1106=Profil w%e4hlen oder Neu

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-11 09:47:55 UTC (rev 1356)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-11 14:06:43 UTC (rev 1357)
@@ -290,6 +290,9 @@
 		1026=#Rec
 		1027=OC-Idx
 		1028=)?
+		1029=There are caches that are ticked but invisible.%0a(Main caches:+
+		1030=, additional Waypoints:+
+		1031=Delete them, too? 
 		1100=Profiles
 		1105=Browse
 		1106=Choose profile or New

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2008-04-11 09:47:55 UTC (rev 1356)
+++ trunk/res_noewe/languages/NL.cfg	2008-04-11 14:06:43 UTC (rev 1357)
@@ -262,10 +262,14 @@
 		1019=Zet deze als middelpunt.
 		1020=Toon online in Browser.
 		1021=Toon cachebeschrijving
-		1022=Verwijder alle caches die zijn aangevinkt.
+		1022=Verwijder alle aangevinkte caches (.
 		1023=Deze functie is momenteel alleen beschikbaar voor geocaching.com.
 		1024=Afstand in lijst is~ten opzichte van de huidige positie~herberekend.
 		1025=Kan middelpunt niet toepassen (verkeerde GPS co?rdinaten).
+		1028=)?
+		1029=Er zijn verwinkte maar niet zichtbare caches.%0a(Caches:+
+        1030=, additionele Waypoints:+
+        1031=Deeze ook verwijdern?
 		1100=Profielen
 		1105=Bladeren
 		1106=Kies profiel of nieuw.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-11 09:47:55 UTC (rev 1356)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-11 14:06:43 UTC (rev 1357)
@@ -122,38 +122,65 @@
 		if (selectedItem.toString().equals(MyLocale.getMsg(1012,"Delete"))){
 			Vm.showWait(true);
 			// Count # of caches to delete
-			int count=0;
+			int allCount=0;
+			int mainFilteredCount=0;
+			int addiFilteredCount=0;
+			int shouldDeleteCount=0;
+			boolean deleteFiltered=true;  // Bisheriges Verhalten
 			for(int i = cacheDB.size()-1; i >=0; i--){
-				if ( ((CacheHolder)cacheDB.get(i)).is_Checked) count++;
+				CacheHolder currCache = (CacheHolder)cacheDB.get(i);
+				if ( currCache.is_Checked) {
+					allCount++;
+					if (currCache.is_filtered) {
+						if (currCache.isAddiWpt()) {
+							addiFilteredCount++;
+						} else {
+							mainFilteredCount++;
+						}
+					}
+				}
 			}
-			if (count>0) {
-				if ((new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1022, "Delete all caches that have a tick (") + count + MyLocale.getMsg(1028, ")?"), FormBase.YESB | FormBase.NOB)).execute() != FormBase.IDYES) {
-					Vm.showWait(false);
-					return;
+			// Warn if there are ticked but invisible caches - and ask if they should be deleted,
+			// too.
+			shouldDeleteCount = allCount;
+			if (addiFilteredCount + mainFilteredCount > 0){
+				if ((new MessageBox(MyLocale.getMsg(144,"Warning"),
+						            MyLocale.getMsg(1029, "There are caches that are ticked but invisible.\n(Main caches: ") + 
+						            	mainFilteredCount + MyLocale.getMsg(1030, ", additional Waypoints: ") + 
+						            	addiFilteredCount+")\n" + MyLocale.getMsg(1031, "Delete them, too?"), 
+						            	FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
+					deleteFiltered = true;
+				} else {
+					deleteFiltered = false;
+					shouldDeleteCount = allCount - mainFilteredCount - addiFilteredCount;
 				}
-				DataMover dm=new DataMover();
-				myProgressBarForm pbf = new myProgressBarForm();
-				Handle h = new Handle();
-				pbf.setTask(h,MyLocale.getMsg(1012, "Delete selected"));
-				pbf.exec();
-				int nDeleted=0;
-				int size=cacheDB.size();
-				for(int i = size-1; i >=0; i--){// Start Counting down, as the size decreases with each deleted cache
-					ch = (CacheHolder)cacheDB.get(i);
-					if(ch.is_Checked == true) {
-						nDeleted++;
-						h.progress = ((float)nDeleted)/(float)count;
-						h.changed();
-						dm.deleteCacheFiles(ch.wayPoint,profile.dataDir);
-						cacheDB.remove(ch);
-						ch.releaseCacheDetails();
-						ch=null;
-						if (pbf.isClosed) break;
+			}
+			if (shouldDeleteCount>0) {
+				if ((new MessageBox(MyLocale.getMsg(144,"Warning"),MyLocale.getMsg(1022, "Delete selected caches (") + shouldDeleteCount + MyLocale.getMsg(1028, ") ?"), FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
+					DataMover dm=new DataMover();
+					myProgressBarForm pbf = new myProgressBarForm();
+					Handle h = new Handle();
+					pbf.setTask(h,MyLocale.getMsg(1012, "Delete selected"));
+					pbf.exec();
+					int nDeleted=0;
+					int size=cacheDB.size();
+					for(int i = size-1; i >=0; i--){// Start Counting down, as the size decreases with each deleted cache
+						ch = (CacheHolder)cacheDB.get(i);
+						if(ch.is_Checked && (!ch.is_filtered || deleteFiltered)) {
+							nDeleted++;
+							h.progress = ((float)nDeleted)/(float)allCount;
+							h.changed();
+							dm.deleteCacheFiles(ch.wayPoint,profile.dataDir);
+							cacheDB.remove(ch);
+							ch.releaseCacheDetails();
+							ch=null;
+							if (pbf.isClosed) break;
+						}
 					}
+					pbf.exit(0);
+					profile.saveIndex(pref,true);	
+					tbp.refreshTable();
 				}
-				pbf.exit(0);
-				profile.saveIndex(pref,true);	
-				tbp.refreshTable();
 			}
 			Vm.showWait(false);
 		}



From engywuck at mail.berlios.de  Fri Apr 11 17:54:28 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 11 Apr 2008 17:54:28 +0200
Subject: [Cachewolf-svn] r1358 - trunk/src/CacheWolf
Message-ID: <200804111554.m3BFsSn5030168@sheep.berlios.de>

Author: engywuck
Date: 2008-04-11 17:54:27 +0200 (Fri, 11 Apr 2008)
New Revision: 1358

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
After saving the cache file, the cache is no longer dirty.

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-04-11 14:06:43 UTC (rev 1357)
+++ trunk/src/CacheWolf/MainTab.java	2008-04-11 15:54:27 UTC (rev 1358)
@@ -385,6 +385,7 @@
 	void updatePendingChanges() {
 		if (cacheDirty) {
 			chD.saveCacheDetails(Global.getProfile().dataDir);
+			cacheDirty = false;
 		}
 	}
 	



From pfeffer at mail.berlios.de  Sat Apr 12 09:16:43 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 09:16:43 +0200
Subject: [Cachewolf-svn] r1359 - in trunk/src/CacheWolf: . navi
Message-ID: <200804120716.m3C7Gh9K013615@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 09:16:41 +0200 (Sat, 12 Apr 2008)
New Revision: 1359

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/TablePanel.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
   trunk/src/CacheWolf/navi/MapsList.java
Log:
New Profile: Bug fixed: ArrayIndexOutOfBoundException avoided
ListPanel: user hindered to unselect (ungrey) the selected cache in order to avoid internal inconsistencies
DescriptenPanel: Bug fixed: if no cache in list, NullPointerException avoided
MapLoaderGui: accept "," and "." as decimal seperator

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-04-11 15:54:27 UTC (rev 1358)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-04-12 07:16:41 UTC (rev 1359)
@@ -36,12 +36,16 @@
 	*/
 	//String description = null;
 	public void setText(CacheHolderDetail cache){
-		boolean isHtml=cache.is_HTML;
+		boolean isHtml;
 		//if (currCache == cache) return;
 		int scrollto = 0;
-		if (cache.hasSameMainCache(currCache)) scrollto = disp.getTopLine();
-		if (cache == null) desc = "";
+		if (cache == null) {
+			desc = "";
+			isHtml = false;
+		}
 		else {
+			if (cache.hasSameMainCache(currCache)) scrollto = disp.getTopLine();
+			isHtml=cache.is_HTML;
 			if (cache.isAddiWpt()) {
 				CacheHolderDetail mainCache=cache.mainCache.getCacheDetails(true);
 				isHtml=mainCache.is_HTML;

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2008-04-11 15:54:27 UTC (rev 1358)
+++ trunk/src/CacheWolf/TablePanel.java	2008-04-12 07:16:41 UTC (rev 1359)
@@ -95,7 +95,8 @@
 	//TODO Add a sort here to restore the sort after a filter
 	public void refreshTable(){
 		String wayPoint;
-		if (getSelectedCache() >= 0) wayPoint = ((CacheHolder)cacheDB.get(getSelectedCache())).wayPoint;
+		if (getSelectedCache() >= 0)
+			wayPoint = ((CacheHolder)cacheDB.get(getSelectedCache())).wayPoint;
 		else wayPoint = null;
 		myMod.updateRows();
 

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-11 15:54:27 UTC (rev 1358)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-12 07:16:41 UTC (rev 1359)
@@ -309,7 +309,19 @@
 			}
 		}
 	 }
-	 
+
+	 /**
+	  * this is only necessary to hinder the user to unselect
+	  */
+	 public void penReleased(Point p,boolean isDouble)
+	 {
+		 Point p2 = cellAtPoint(p.x,p.y,null);
+		 super.penReleased(p, isDouble);
+		 Rect sel = getSelection(null); 
+		 if ((sel.height == 0 || sel.height == 0) && p2 != null) cursorTo(p2.y,p2.x, true); // if the selection is gone -> reselect it 
+			 
+	 }
+
 	 class myProgressBarForm extends ProgressBarForm {
 
 		 boolean isClosed=false;
@@ -320,6 +332,8 @@
 		 }
 		 
 	 }
+	 
+	 
 
 	public Menu getMenuSmall() {
 		return mSmall;

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2008-04-11 15:54:27 UTC (rev 1358)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2008-04-12 07:16:41 UTC (rev 1359)
@@ -6,6 +6,7 @@
 import CacheWolf.Global;
 import CacheWolf.InfoBox;
 import CacheWolf.MyLocale;
+import CacheWolf.NewProfileWizard;
 import CacheWolf.Preferences;
 import ewe.io.FileBase;
 import ewe.sys.Convert;
@@ -277,8 +278,8 @@
 					if (forSelectedChkBox.getSelectedItem().toString().equalsIgnoreCase(MyLocale.getMsg(1804, "all"))) onlySelected = false;
 					else onlySelected = true;
 					overviewmap = overviewChkBox.getState();
-					radius = Convert.toFloat(distanceInput.getText());
-					scale = Convert.toFloat(scaleInput.getText());
+					radius = (float)CacheWolf.Common.parseDouble(distanceInput.getText());
+					scale = (float)CacheWolf.Common.parseDouble(scaleInput.getText());
 					overlapping = Convert.toInt(overlappingInput.getText());
 					if (!forCachesChkBox.getState()) {
 						if (radius <= 0) { 

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2008-04-11 15:54:27 UTC (rev 1358)
+++ trunk/src/CacheWolf/navi/MapsList.java	2008-04-12 07:16:41 UTC (rev 1359)
@@ -493,6 +493,7 @@
 	public static void loadingFinished() {
 		if (renameProgressInfoB != null) renameProgressInfoB.close(0);
 		renameProgressInfoB = null;
+		rename = 0;
 	}
 	
 	/*



From mik77 at mail.berlios.de  Sat Apr 12 09:29:07 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 12 Apr 2008 09:29:07 +0200
Subject: [Cachewolf-svn] r1360 - in trunk: res_noewe/languages
	res_noewe/webmapservices src/CacheWolf
Message-ID: <200804120729.m3C7T73P015668@sheep.berlios.de>

Author: mik77
Date: 2008-04-12 09:29:03 +0200 (Sat, 12 Apr 2008)
New Revision: 1360

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/webmapservices/de-rlp_photo.wms
   trunk/res_noewe/webmapservices/de-rlp_topo_50.wms
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/Parser.java
Log:
- Add Clear Button to CoordsScreen if invalid coordinates are allowed
- URL in RLB WMS corrected
- Create new additional waypoints if needed in skeleton command


Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-12 07:16:41 UTC (rev 1359)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-12 07:29:03 UTC (rev 1360)
@@ -336,6 +336,7 @@
 		1410=Meilen
 		1411=Bitte g%fcltige Koordinaten eingeben.
 		1412=Koordinaten ung%fcltig. Trotzdem %fcbernehmen?
+		1413=L%f6schen
 		1500=Ziel:
 		1501=Aktuell
 		1502=Grad

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-12 07:16:41 UTC (rev 1359)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-12 07:29:03 UTC (rev 1360)
@@ -337,6 +337,7 @@
 		1410=miles
 		1411=Please enter valid coordinates
 		1412=Coordinates invalid. Apply anyway?
+		1413=Clear
 		1500=DST:
 		1501=Current
 		1502=deg

Modified: trunk/res_noewe/webmapservices/de-rlp_photo.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-rlp_photo.wms	2008-04-12 07:16:41 UTC (rev 1359)
+++ trunk/res_noewe/webmapservices/de-rlp_photo.wms	2008-04-12 07:29:03 UTC (rev 1360)
@@ -1,9 +1,9 @@
 # please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://geodaten.service24.rlp.de/cgi/wms.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+GetCapabilitiesUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
 Name:	de.rlp Luftbild
 MapType:	photo
-MainUrl:	http://geodaten.service24.rlp.de/cgi/wms.cgi?
+MainUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?
 ServiceTypeUrlPart:	SERVICE=WMS 
 VersionUrlPart:	VERSION=1.1.1 
 CoordinateReferenceSystemCacheWolf:   31466 31467

Modified: trunk/res_noewe/webmapservices/de-rlp_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-rlp_topo_50.wms	2008-04-12 07:16:41 UTC (rev 1359)
+++ trunk/res_noewe/webmapservices/de-rlp_topo_50.wms	2008-04-12 07:29:03 UTC (rev 1360)
@@ -1,9 +1,9 @@
 # please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://geodaten.service24.rlp.de/cgi/wms.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+GetCapabilitiesUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
 Name:	de.rlp Topo 50
 MapType:	topo
-MainUrl:	http://geodaten.service24.rlp.de/cgi/wms.cgi?
+MainUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?
 ServiceTypeUrlPart:	SERVICE=WMS 
 VersionUrlPart:	VERSION=1.1.1 
 CoordinateReferenceSystemCacheWolf:   31466 31467

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2008-04-12 07:16:41 UTC (rev 1359)
+++ trunk/src/CacheWolf/CoordsScreen.java	2008-04-12 07:29:03 UTC (rev 1360)
@@ -19,17 +19,29 @@
 	mInput inpNSDeg, inpNSm, inpNSs, inpEWDeg, inpEWm, inpEWs;
 	mInput inpUTMZone, inpUTMNorthing, inpUTMEasting;
 	mInput inpText;
-	mButton btnCancel, btnApply, btnCopy, btnPaste, btnParse, btnGps;
+	mButton btnCancel, btnApply, btnCopy, btnPaste, btnParse, btnGps, btnClear;
 	CWPoint coordInp = new CWPoint();
 	CellPanel topLinePanel = new CellPanel();
 	CellPanel mainPanel = new CellPanel();
 	int exitKeys[]={75009};
 	int currFormat;
 	
-	boolean allowInvalid = false;
+	private boolean allowInvalid = false;
 	
+	public CoordsScreen(boolean allowInvalidCoords)
+	{
+		allowInvalid = allowInvalidCoords;
+		
+		InitCoordsScreen();		
+	}
+	
 	public CoordsScreen()
 	{
+		InitCoordsScreen();		
+	}
+	
+	private void InitCoordsScreen()
+	{
 		this.setTitle("");
 		//Radiobuttons for format
 		topLinePanel.addNext(chkDD =new mCheckBox("d.d?"),CellConstants.DONTSTRETCH, CellConstants.WEST);
@@ -60,10 +72,17 @@
 		mainPanel.addLast(inpEWs = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 
 		// Input for UTM
-		mainPanel.addNext(new mLabel(MyLocale.getMsg(1400,"Zone")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addNext(new mLabel(MyLocale.getMsg(1402,"Easting")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		mainPanel.addLast(new mLabel(MyLocale.getMsg(1401,"Northing")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-
+		if (allowInvalid){
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1400,"Zone")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402,"Easting")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1401,"Northing")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+			mainPanel.addLast(btnClear = new mButton(MyLocale.getMsg(1413,"Clear")),CellConstants.HSTRETCH, (CellConstants.HFILL));
+		} else {
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1400,"Zone")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402,"Easting")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+			mainPanel.addLast(new mLabel(MyLocale.getMsg(1401,"Northing")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+		}
+		
 		mainPanel.addNext(inpUTMZone = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		mainPanel.addNext(inpUTMEasting = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		mainPanel.addNext(inpUTMNorthing = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
@@ -278,6 +297,13 @@
 					activateFields(currFormat);
 				}
 			}
+			
+			if (ev.target == btnClear){
+				CWPoint coord = new CWPoint(91,361);
+				currFormat = chkFormat.getSelectedIndex();
+				setFields(coord,currFormat);
+				activateFields(currFormat);
+			}
 		}
 		super.onEvent(ev);
 	}

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-04-12 07:16:41 UTC (rev 1359)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-04-12 07:29:03 UTC (rev 1360)
@@ -404,8 +404,7 @@
 			}
 			else if (ev.target == btnWayLoc){
 				CWPoint coords = new CWPoint(btnWayLoc.getText(),CWPoint.CW);
-				CoordsScreen cs = new CoordsScreen();
-				cs.allowInvalid = true;
+				CoordsScreen cs = new CoordsScreen(true);
 				cs.setFields(coords, CWPoint.CW);
 				if (cs.execute()== FormBase.IDOK){
 					dirty_details=true;

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2008-04-12 07:16:41 UTC (rev 1359)
+++ trunk/src/CacheWolf/Parser.java	2008-04-12 07:29:03 UTC (rev 1360)
@@ -662,9 +662,16 @@
 			for (int i=0; i<nStages; i++) {
 				String stage=MyLocale.formatLong(i,"00");
 				String stageWpt="$"+stage+waypointName.substring(2);
+				String stageName = "Stage "+(i+1);
+				String type = "51";
+				if (i == nStages - 1) {
+					stageName = "Final";
+					type = "53";
+				}
+				createWptIfNeeded(stage+waypointName.substring(2), stageName, type);
 				op.append("IF "+stageWpt+"=\"\" THEN\n");
 				op.append("  "+stageWpt+" = \"\"\n");
-				op.append("  \"Stage "+(i+1)+" = \" "+stageWpt+"\n");
+				op.append("  \""+stageName+" = \" "+stageWpt+"\n");
 				op.append("  goto("+stageWpt+"); STOP\n");
 				op.append("ENDIF\n");
 			}		
@@ -1059,4 +1066,24 @@
 		}
 	}
 	
+	private void createWptIfNeeded(String wayPoint, String name, String type){
+	   	int ci=Global.getProfile().getCacheIndex(wayPoint);
+    	if (ci >= 0) return;
+    	
+    	Global.mainTab.updatePendingChanges();
+
+		CacheHolder ch = new CacheHolder();
+		ch.wayPoint = wayPoint;
+		ch.type = type;
+		ch.CacheSize = "None";
+		ch.CacheName= name;
+		
+		Global.getProfile().hasUnsavedChanges=true;
+		Global.getProfile().setAddiRef(ch);
+
+		Global.mainTab.cacheDB.add(ch);
+		Global.mainTab.tbP.myMod.numRows++;
+		Global.mainTab.tbP.refreshTable();
+	}
+	
 }



From pfeffer at mail.berlios.de  Sat Apr 12 09:54:00 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 09:54:00 +0200
Subject: [Cachewolf-svn] r1361 - trunk/res_noewe/languages
Message-ID: <200804120754.m3C7s088019057@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 09:53:58 +0200 (Sat, 12 Apr 2008)
New Revision: 1361

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
Log:
MapsOptimizer: Some time ago I forgot to commit the according languages files for a better error message

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-12 07:29:03 UTC (rev 1360)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-12 07:53:58 UTC (rev 1361)
@@ -652,8 +652,9 @@
 		4704=%0aUmbenennen der Datei:
 		4705=Fehler beim Umbenennen:%0a
 		4706=%0anach:%0a
-		4707=E/A-Fehler beim Lesen von: 
-		4708=Fehler beim Lesen von: 
+		4707=E/A-Fehler beim Lesen von:+
+		4708=Fehler beim Lesen von:+
+		4709=Konnte Kartenbild zu folgender Kalibrierungsdatei nicht finden:%0a
 		4800=Lade Onlinekartendienste
 		4801=Ignoriere Fehler beim %0a Lesen der Web Map Service Definitionsdatei %0a
 		4802=Lade kalibriertes (georeferenziertes) %0a Kartenbild %0a '

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-12 07:29:03 UTC (rev 1360)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-12 07:53:58 UTC (rev 1361)
@@ -641,6 +641,7 @@
 		4706=%0ato:%0an
 		4707=I/O-Error while reading: 
 		4708=Error while reading: 
+		4709=Could not find image assiciated to:%0a
 		4800=Loading online map services
 		4801=Ignoring error while %0a reading web map service definition file %0a
 		4802=Downloading calibrated (georeferenced) %0a map image %0a '



From pfeffer at mail.berlios.de  Sat Apr 12 11:03:10 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 11:03:10 +0200
Subject: [Cachewolf-svn] r1362 - trunk/src/CacheWolf
Message-ID: <200804120903.m3C93AkS028597@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 11:03:09 +0200 (Sat, 12 Apr 2008)
New Revision: 1362

Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/TablePanel.java
Log:
NewProfile: Bug fixed: MiK found another case, in which a IndexOutOfBoundException could occur

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-12 07:53:58 UTC (rev 1361)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-12 09:03:09 UTC (rev 1362)
@@ -237,7 +237,7 @@
 				if (NewProfileWizard.startNewProfileWizard(getFrame()) ) {
 					Filter.showBlacklisted=false;
 					filtBlack.modifiers&=~MenuItem.Checked;
-					tbp.refreshTable(); // TODO if the list was empty before a new profile was created, this causes a ArrayIndexOutOfBoundsException, it doesn't cause any harm, but should be caught at the appropriate point
+					tbp.refreshTable();
 				}
 			}
 			if(mev.selectedItem == mnuOpenProfile){

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2008-04-12 07:53:58 UTC (rev 1361)
+++ trunk/src/CacheWolf/TablePanel.java	2008-04-12 09:03:09 UTC (rev 1362)
@@ -95,8 +95,9 @@
 	//TODO Add a sort here to restore the sort after a filter
 	public void refreshTable(){
 		String wayPoint;
-		if (getSelectedCache() >= 0)
-			wayPoint = ((CacheHolder)cacheDB.get(getSelectedCache())).wayPoint;
+		int sel = getSelectedCache();
+		if ((sel >= 0) && (sel < cacheDB.size()) ) // sel > cacheDB.size() can happen if you load a new profile, which is smaller than the old profile and you selected one cache that exceeds the number of caches in the new profile  
+			wayPoint = ((CacheHolder)cacheDB.get(sel)).wayPoint;
 		else wayPoint = null;
 		myMod.updateRows();
 



From pfeffer at mail.berlios.de  Sat Apr 12 11:53:56 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 11:53:56 +0200
Subject: [Cachewolf-svn] r1363 - trunk/src/CacheWolf
Message-ID: <200804120953.m3C9ruHu002207@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 11:53:55 +0200 (Sat, 12 Apr 2008)
New Revision: 1363

Modified:
   trunk/src/CacheWolf/SafeXML.java
Log:
SafeXML: small (but anyway unlikely) Bug fixed (just saw it by chance)

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2008-04-12 09:03:09 UTC (rev 1362)
+++ trunk/src/CacheWolf/SafeXML.java	2008-04-12 09:53:55 UTC (rev 1363)
@@ -437,13 +437,12 @@
 	 * @return (String) raw text, or null if input is null
 	 */
 	public static String strxmldecode(String src) {
+		if (src == null) return (null);
 		int i, j, slen = src.length();
 		char ch, tmp[];
 		StringBuffer dst = new StringBuffer(slen);
 		boolean isinval;
 
-		if (src == null)
-			return (null);
 		tmp = new char[slen];
 		src.getChars(0, slen, tmp, 0);
 		i = 0;



From mirabilos at mail.berlios.de  Sat Apr 12 12:11:49 2008
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Sat, 12 Apr 2008 12:11:49 +0200
Subject: [Cachewolf-svn] r1364 - trunk/src/CacheWolf
Message-ID: <200804121011.m3CABnYx005890@sheep.berlios.de>

Author: mirabilos
Date: 2008-04-12 12:11:49 +0200 (Sat, 12 Apr 2008)
New Revision: 1364

Modified:
   trunk/src/CacheWolf/SafeXML.java
Log:
thanks for the bugfix, but it looks much better like this ;)
and also fixes the other place affected


Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2008-04-12 09:53:55 UTC (rev 1363)
+++ trunk/src/CacheWolf/SafeXML.java	2008-04-12 10:11:49 UTC (rev 1364)
@@ -407,12 +407,15 @@
 		return (Integer.toString(src));
 	}
 	public static String strxmlencode(String src) {
-		int i, slen = src.length();
+		int i, slen;
 		char tmp[];
-		StringBuffer dst = new StringBuffer(slen);
+		StringBuffer dst;
 
 		if (src == null)
 			return (null);
+
+		slen = src.length();
+		dst = new StringBuffer(slen);
 		tmp = new char[slen];
 		src.getChars(0, slen, tmp, 0);
 		for (i = 0; i < slen; ++i)
@@ -437,12 +440,16 @@
 	 * @return (String) raw text, or null if input is null
 	 */
 	public static String strxmldecode(String src) {
-		if (src == null) return (null);
-		int i, j, slen = src.length();
+		int i, j, slen;
 		char ch, tmp[];
-		StringBuffer dst = new StringBuffer(slen);
+		StringBuffer dst;
 		boolean isinval;
 
+		if (src == null)
+			return (null);
+
+		slen = src.length();
+		dst = new StringBuffer(slen);
 		tmp = new char[slen];
 		src.getChars(0, slen, tmp, 0);
 		i = 0;



From salzkammergut at mail.berlios.de  Sat Apr 12 12:31:15 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 12 Apr 2008 12:31:15 +0200
Subject: [Cachewolf-svn] r1365 - trunk/src/CacheWolf
Message-ID: <200804121031.m3CAVFbZ011689@sheep.berlios.de>

Author: salzkammergut
Date: 2008-04-12 12:31:13 +0200 (Sat, 12 Apr 2008)
New Revision: 1365

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Parser: Fix for Rev 1360. Under certain circumstances the "loading..." message was not deleted from the solver panel.

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2008-04-12 10:11:49 UTC (rev 1364)
+++ trunk/src/CacheWolf/Parser.java	2008-04-12 10:31:13 UTC (rev 1365)
@@ -659,7 +659,8 @@
 			   "Station 1 = " $01xxxx
 			   goto($01xxxx); STOP
 			ENDIF*/
-			for (int i=0; i<nStages; i++) {
+			boolean didCreateWp=false;
+    		for (int i=0; i<nStages; i++) {
 				String stage=MyLocale.formatLong(i,"00");
 				String stageWpt="$"+stage+waypointName.substring(2);
 				String stageName = "Stage "+(i+1);
@@ -668,7 +669,7 @@
 					stageName = "Final";
 					type = "53";
 				}
-				createWptIfNeeded(stage+waypointName.substring(2), stageName, type);
+				didCreateWp|=createWptIfNeeded(stage+waypointName.substring(2), stageName, type);
 				op.append("IF "+stageWpt+"=\"\" THEN\n");
 				op.append("  "+stageWpt+" = \"\"\n");
 				op.append("  \""+stageName+" = \" "+stageWpt+"\n");
@@ -676,6 +677,10 @@
 				op.append("ENDIF\n");
 			}		
 			Global.mainTab.solverP.mText.appendText(op.toString(),true);
+			if (didCreateWp) {
+		    	Global.mainTab.updatePendingChanges();
+				Global.mainTab.tbP.refreshTable();
+			}
     	} else {
 	    	int i=Global.getProfile().getCacheIndex(waypointName);
 			if (i<0) err(MyLocale.getMsg(1714,"Goto: Waypoint does not exist: ")+waypointName);
@@ -1066,12 +1071,10 @@
 		}
 	}
 	
-	private void createWptIfNeeded(String wayPoint, String name, String type){
+	private boolean createWptIfNeeded(String wayPoint, String name, String type){
 	   	int ci=Global.getProfile().getCacheIndex(wayPoint);
-    	if (ci >= 0) return;
+    	if (ci >= 0) return false;
     	
-    	Global.mainTab.updatePendingChanges();
-
 		CacheHolder ch = new CacheHolder();
 		ch.wayPoint = wayPoint;
 		ch.type = type;
@@ -1083,7 +1086,7 @@
 
 		Global.mainTab.cacheDB.add(ch);
 		Global.mainTab.tbP.myMod.numRows++;
-		Global.mainTab.tbP.refreshTable();
+		return true;
 	}
 	
 }



From mik77 at mail.berlios.de  Sat Apr 12 13:35:41 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 12 Apr 2008 13:35:41 +0200
Subject: [Cachewolf-svn] r1366 - trunk/src/CacheWolf
Message-ID: <200804121135.m3CBZfE1008785@sheep.berlios.de>

Author: mik77
Date: 2008-04-12 13:35:39 +0200 (Sat, 12 Apr 2008)
New Revision: 1366

Modified:
   trunk/src/CacheWolf/HintLogPanel.java
Log:
Replace <br> in hints by newlines

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2008-04-12 10:31:13 UTC (rev 1365)
+++ trunk/src/CacheWolf/HintLogPanel.java	2008-04-12 11:35:39 UTC (rev 1366)
@@ -64,7 +64,7 @@
 	public void setText(CacheHolderDetail cache){
 		this.cache = cache;
 		if(!cache.Hints.equals("null")) 
-			hint.setText(cache.Hints);
+			hint.setText(STRreplace.replace(cache.Hints, "<br>", "\n"));
 		else
 			hint.setText("");
 		crntLogPosition = 0;



From mik77 at mail.berlios.de  Sat Apr 12 13:56:55 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 12 Apr 2008 13:56:55 +0200
Subject: [Cachewolf-svn] r1367 - trunk/src/CacheWolf
Message-ID: <200804121156.m3CButa5011234@sheep.berlios.de>

Author: mik77
Date: 2008-04-12 13:56:54 +0200 (Sat, 12 Apr 2008)
New Revision: 1367

Modified:
   trunk/src/CacheWolf/MainMenu.java
Log:
"Toggle cachetour" added to organize menu.

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-12 11:35:39 UTC (rev 1366)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-12 11:56:54 UTC (rev 1367)
@@ -31,7 +31,7 @@
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
 	private MenuItem exportGPS, exportCacheMate,mnuSeparator;
-	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild;
+	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild,orgToggleCacheTour;
 	public MenuItem filtCacheTour,orgTravelbugs, mnuForceLogin;
 	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditCenter;
 	private Form father;
@@ -168,7 +168,7 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Organise" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] organiseMenuItems=new MenuItem[8];
+		MenuItem[] organiseMenuItems=new MenuItem[9];
 		organiseMenuItems[0] = orgNewWP = new MenuItem(MyLocale.getMsg(214,"New Waypoint"));
 		organiseMenuItems[1] = mnuSeparator;
 		organiseMenuItems[2] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy")); 
@@ -177,6 +177,7 @@
 		organiseMenuItems[5] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,"Rebuild Index"));
 		organiseMenuItems[6] = mnuSeparator;
 		organiseMenuItems[7] = orgTravelbugs = new MenuItem(MyLocale.getMsg(139,"Manage travelbugs"));
+		organiseMenuItems[8] = orgToggleCacheTour = new MenuItem(MyLocale.getMsg(197,"Show/Hide cachetour"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(140,"Organise"),new Menu(organiseMenuItems,null)));
 
 		///////////////////////////////////////////////////////////////////////
@@ -560,6 +561,10 @@
 				tbs.execute(); //getFrame(), Gui.CENTER_FRAME);
 				tbs.close(0);
 			}
+			if (mev.selectedItem == orgToggleCacheTour){
+				Global.mainForm.toggleCacheListVisible();			
+			}
+
 			///////////////////////////////////////////////////////////////////////
 			// "About" pulldown menu
 			///////////////////////////////////////////////////////////////////////



From salzkammergut at mail.berlios.de  Sat Apr 12 14:00:04 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 12 Apr 2008 14:00:04 +0200
Subject: [Cachewolf-svn] r1368 - trunk/src/CacheWolf
Message-ID: <200804121200.m3CC04Bc011509@sheep.berlios.de>

Author: salzkammergut
Date: 2008-04-12 14:00:02 +0200 (Sat, 12 Apr 2008)
New Revision: 1368

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
myTableControl: Bugfix: When the last cache was selected and ticked, a "delete selected" via the context menu caused an exception.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-12 11:56:54 UTC (rev 1367)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-12 12:00:02 UTC (rev 1368)
@@ -178,6 +178,7 @@
 						}
 					}
 					pbf.exit(0);
+					tbp.myMod.numRows-=nDeleted;
 					profile.saveIndex(pref,true);	
 					tbp.refreshTable();
 				}



From pfeffer at mail.berlios.de  Sat Apr 12 14:01:36 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 14:01:36 +0200
Subject: [Cachewolf-svn] r1369 - trunk/res_noewe/languages
Message-ID: <200804121201.m3CC1a13011641@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 14:01:35 +0200 (Sat, 12 Apr 2008)
New Revision: 1369

Modified:
   trunk/res_noewe/languages/DE.cfg
Log:
MovingMap: Menu: german localization: shortened menu text, in order to avoid scroll bars in the menu

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-12 12:00:02 UTC (rev 1368)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-12 12:01:35 UTC (rev 1369)
@@ -598,8 +598,8 @@
 		4240=Karte ausblenden
 		4241=Karte ausblenden
 		4242=Modus f%fcr automatischen Kartenwechsel
-		4244=H%f6chster Detailgrad mit aktueller und Zielposition
-		4245=H%f6chster Detailgrad mit aktueller und Zielposition
+		4244=H%f6chster Detailgrad m. aktueller u. Zielpos.
+		4245=H%f6chster Detailgrad m. aktueller u. Zielpos.
 		4246=H%f6chster verf%fcgbarer Detailgrad
 		4247=H%f6chster verf%fcgbarer Detailgrad
 		4248=Manuellen Detailgrad m%f6glichst beibehalten



From pfeffer at mail.berlios.de  Sat Apr 12 14:43:36 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 14:43:36 +0200
Subject: [Cachewolf-svn] r1370 - trunk/src/CacheWolf
Message-ID: <200804121243.m3CChaEE015914@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 14:43:35 +0200 (Sat, 12 Apr 2008)
New Revision: 1370

Modified:
   trunk/src/CacheWolf/CoordsScreen.java
Log:
CoordScreen: added Hotkey for cancel (ESC)

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2008-04-12 12:01:35 UTC (rev 1369)
+++ trunk/src/CacheWolf/CoordsScreen.java	2008-04-12 12:43:35 UTC (rev 1370)
@@ -96,7 +96,9 @@
 		mainPanel.addLast(btnParse = new mButton(MyLocale.getMsg(619,"Parse")),CellConstants.HSTRETCH, (CellConstants.HFILL));
 		
 		// Buttons for cancel and apply, copy and paste
-		mainPanel.addNext(btnCancel = new mButton(MyLocale.getMsg(614,"Cancel")),CellConstants.HSTRETCH, (CellConstants.HFILL));
+		btnCancel = new mButton(MyLocale.getMsg(614,"Cancel"));
+		btnCancel.setHotKey(0, IKeys.ESCAPE);
+		mainPanel.addNext(btnCancel,CellConstants.HSTRETCH, (CellConstants.HFILL));
 		//btnCancel.setTag(SPAN,new Dimension(4,1));
 		mainPanel.addNext(btnApply = new mButton(MyLocale.getMsg(615,"Apply")),CellConstants.HSTRETCH, (CellConstants.HFILL));
 		//btnApply.setTag(SPAN,new Dimension(4,1));



From pfeffer at mail.berlios.de  Sat Apr 12 15:02:38 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 15:02:38 +0200
Subject: [Cachewolf-svn] r1371 - trunk/src/CacheWolf
Message-ID: <200804121302.m3CD2cpu017642@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 15:02:31 +0200 (Sat, 12 Apr 2008)
New Revision: 1371

Modified:
   trunk/src/CacheWolf/NewProfileForm.java
Log:
NewProfileWizard: auto resize window

Modified: trunk/src/CacheWolf/NewProfileForm.java
===================================================================
--- trunk/src/CacheWolf/NewProfileForm.java	2008-04-12 12:43:35 UTC (rev 1370)
+++ trunk/src/CacheWolf/NewProfileForm.java	2008-04-12 13:02:31 UTC (rev 1371)
@@ -25,7 +25,7 @@
 		btnOK = new mButton(MyLocale.getMsg(1124,"Next"));
 		btnOK.setHotKey(0, IKeys.ENTER);
 		addLast(btnOK,HSTRETCH,HFILL|RIGHT);
-		this.setPreferredSize(240,80);
+		this.setPreferredSize(240,-1);
 		this.baseDir=baseDir;
 	}
 	



From pfeffer at mail.berlios.de  Sat Apr 12 15:27:05 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 15:27:05 +0200
Subject: [Cachewolf-svn] r1372 - trunk/res_noewe/languages
Message-ID: <200804121327.m3CDR5sm020476@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 15:27:03 +0200 (Sat, 12 Apr 2008)
New Revision: 1372

Modified:
   trunk/res_noewe/languages/EN.cfg
Log:
Localisation english: uniformly use "tick" for caches, which are marked with a tick

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-12 13:02:31 UTC (rev 1371)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-12 13:27:03 UTC (rev 1372)
@@ -35,7 +35,7 @@
 		131=Spider from geocaching.com
 		132=to Explorist
     133=Search all
-    134=Selected Cache
+    134=Ticked Cache
 		139=Manage Travelbugs
 		140=Organise            
 		141=Copy 
@@ -57,7 +57,7 @@
 		157=System
 		158=Version Check
 		159=Filter
-		160=Filter out selected
+		160=Filter out ticked
 		161=Show Blacklist
 		162=Download calibrated
 		170=Select base directory for cache data
@@ -213,8 +213,8 @@
 		713=Save filter
 		714=Bearing & Distance
 		715=Show all caches with status:
-		716=Deselect all
-		717=Select all
+		716=untick all
+		717=tick all
 		718=Cache ratings
 		719=Cache types
 		720=Status
@@ -272,12 +272,12 @@
 		1008=Dist
 		1009=Bear
 		1010=Goto this one
-		1011=Filter out non-selected
-		1012=Delete selected
-		1013=With selection
-		1014=Update selected caches
-		1015=Select all
-		1016=Deselect all
+		1011=Filter out non-ticked
+		1012=Delete ticked
+		1013=selected / ticked
+		1014=Update ticked caches
+		1015=Tick all
+		1016=untick all
 		1017=S
 		1018=Open offline in Browser
 		1019=Set this as centre
@@ -417,7 +417,7 @@
 		1802=Download georeferenced maps%0a Select online service:
 		1803=for
 		1804=all
-		1805=selected
+		1805=ticked
 		1806=caches
 		1807=Approx. m per pixel:
 		1808=overlapping in pixel:
@@ -429,7 +429,7 @@
 		1814=Per cache
 		1815=Downloading georeferenced maps
 		1816=Downloading georeferenced maps%0a %0a %0a %0a %0a
-		1817=No caches are seleted
+		1817=No caches are ticked
 		1818=getSortedMapServiceIndex: index 
 		1819=not found
 		1820=Downloading map '
@@ -569,7 +569,7 @@
 		4212=less
 		4213=more
 		4214=+detailed map available
-		4215=No caches selected by check mark
+		4215=No caches selected by a tick
 		4216=Loading map...
 		4217=Could not find image associated with: %0a
 		4218=Could not load map: %0a



From pfeffer at mail.berlios.de  Sat Apr 12 15:36:26 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 15:36:26 +0200
Subject: [Cachewolf-svn] r1373 - trunk/res_noewe/languages
Message-ID: <200804121336.m3CDaQWC021255@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 15:36:24 +0200 (Sat, 12 Apr 2008)
New Revision: 1373

Modified:
   trunk/res_noewe/languages/EN.cfg
Log:
Localisation english: thanx to MiK: case corrections

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-12 13:27:03 UTC (rev 1372)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-12 13:36:24 UTC (rev 1373)
@@ -213,8 +213,8 @@
 		713=Save filter
 		714=Bearing & Distance
 		715=Show all caches with status:
-		716=untick all
-		717=tick all
+		716=Untick all
+		717=Tick all
 		718=Cache ratings
 		719=Cache types
 		720=Status
@@ -277,7 +277,7 @@
 		1013=selected / ticked
 		1014=Update ticked caches
 		1015=Tick all
-		1016=untick all
+		1016=Untick all
 		1017=S
 		1018=Open offline in Browser
 		1019=Set this as centre



From pfeffer at mail.berlios.de  Sat Apr 12 16:09:41 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 16:09:41 +0200
Subject: [Cachewolf-svn] r1374 - trunk/src/CacheWolf
Message-ID: <200804121409.m3CE9fw5026871@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 16:09:40 +0200 (Sat, 12 Apr 2008)
New Revision: 1374

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
MainMenu: avoid NullPointerException in case that ESC was pressed after opening a menu

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-12 13:36:24 UTC (rev 1373)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-12 14:09:40 UTC (rev 1374)
@@ -110,6 +110,7 @@
 	}
 	
 	public void popupMenuEvent(Object selectedItem){
+		if (selectedItem == null) return;
 		CacheHolder ch;
 		if (selectedItem.toString().equals(MyLocale.getMsg(1015,"Select all"))){
 			setSelectForAll(true);



From pfeffer at mail.berlios.de  Sat Apr 12 21:09:04 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 12 Apr 2008 21:09:04 +0200
Subject: [Cachewolf-svn] r1375 - in trunk: res_noewe resources
Message-ID: <200804121909.m3CJ94SP010835@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-12 21:09:01 +0200 (Sat, 12 Apr 2008)
New Revision: 1375

Removed:
   trunk/res_noewe/11.gif
   trunk/res_noewe/12.gif
   trunk/res_noewe/13.gif
   trunk/res_noewe/1858.gif
   trunk/res_noewe/2.gif
   trunk/res_noewe/3.gif
   trunk/res_noewe/4.gif
   trunk/res_noewe/5.gif
   trunk/res_noewe/6.gif
   trunk/res_noewe/8.gif
   trunk/resources/137.gif
Log:
Ressources: removed some obsolete images

Deleted: trunk/res_noewe/11.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/12.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/13.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/1858.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/2.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/3.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/4.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/5.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/6.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/8.gif
===================================================================
(Binary files differ)

Deleted: trunk/resources/137.gif
===================================================================
(Binary files differ)



From kappler at mail.berlios.de  Sun Apr 13 06:57:50 2008
From: kappler at mail.berlios.de (kappler at mail.berlios.de)
Date: Sun, 13 Apr 2008 06:57:50 +0200
Subject: [Cachewolf-svn] r1376 - trunk/res_noewe
Message-ID: <200804130457.m3D4voQj014394@sheep.berlios.de>

Author: kappler
Date: 2008-04-13 06:57:34 +0200 (Sun, 13 Apr 2008)
New Revision: 1376

Added:
   trunk/res_noewe/11.gif
   trunk/res_noewe/12.gif
   trunk/res_noewe/13.gif
   trunk/res_noewe/137.gif
   trunk/res_noewe/1858.gif
   trunk/res_noewe/2.gif
   trunk/res_noewe/3.gif
   trunk/res_noewe/4.gif
   trunk/res_noewe/5.gif
   trunk/res_noewe/6.gif
   trunk/res_noewe/8.gif
Modified:
   trunk/res_noewe/POIIcons.zip
Log:
Undo 1375 - still needed for offline viewing

Added: trunk/res_noewe/11.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/11.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/12.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/12.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/13.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/13.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/137.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/137.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/1858.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/1858.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/3.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/3.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/4.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/4.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/5.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/5.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/6.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/6.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/8.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/8.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/POIIcons.zip
===================================================================
(Binary files differ)



From mik77 at mail.berlios.de  Wed Apr 16 13:40:20 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 16 Apr 2008 13:40:20 +0200
Subject: [Cachewolf-svn] r1377 - in trunk: res_noewe resources
Message-ID: <200804161140.m3GBeKqV015254@sheep.berlios.de>

Author: mik77
Date: 2008-04-16 13:40:13 +0200 (Wed, 16 Apr 2008)
New Revision: 1377

Added:
   trunk/res_noewe/recommendedlog.gif
Removed:
   trunk/resources/recommendedlog.gif
Log:
recommendedlog.gif moved to correct directory

Copied: trunk/res_noewe/recommendedlog.gif (from rev 1376, trunk/resources/recommendedlog.gif)

Deleted: trunk/resources/recommendedlog.gif
===================================================================
(Binary files differ)



From kappler at mail.berlios.de  Thu Apr 17 11:47:12 2008
From: kappler at mail.berlios.de (kappler at mail.berlios.de)
Date: Thu, 17 Apr 2008 11:47:12 +0200
Subject: [Cachewolf-svn] r1378 - trunk/src/CacheWolf
Message-ID: <200804170947.m3H9lCLW024829@sheep.berlios.de>

Author: kappler
Date: 2008-04-17 11:47:10 +0200 (Thu, 17 Apr 2008)
New Revision: 1378

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
Check for correct browser-pathnbefore showing cache in external browser. Results in more precise error-message.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-16 11:40:13 UTC (rev 1377)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-17 09:47:10 UTC (rev 1378)
@@ -4,6 +4,7 @@
 import ewe.sys.*;
 import ewe.ui.*;
 import ewe.fx.*;
+import ewe.io.File;
 import ewe.io.IOException;
 import ewe.util.*;
 
@@ -209,27 +210,40 @@
 			Global.mainTab.gotoPoint(ch.pos);
 		}
 		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1020,"Open online in Browser"))){
-			ch = (CacheHolder)cacheDB.get(tbp.getSelectedCache());
-			CacheHolderDetail chD=ch.getCacheDetails(false, true);
-			try {
-				if (chD != null) {
-					//String cmd = "\""+pref.browser+ "\" \"" + chD.URL+"\"";
-					CWWrapper.exec(pref.browser, chD.URL); // maybe this works on some PDAs?
+			if(browserPathIsValid()){
+				ch = (CacheHolder)cacheDB.get(tbp.getSelectedCache());
+				CacheHolderDetail chD=ch.getCacheDetails(false, true);
+				try {
+					if (chD != null) {
+						//String cmd = "\""+pref.browser+ "\" \"" + chD.URL+"\"";
+						CWWrapper.exec(pref.browser, chD.URL); // maybe this works on some PDAs?
+					}
+				} catch (IOException ex) {
+					(new MessageBox("Error", "Cannot start browser!\n"+ex.toString()+"\nPossible reason:\n * An bug in ewe VM, please be \npatient for an update",FormBase.OKB)).execute();
 				}
-			} catch (IOException ex) {
-				(new MessageBox("Error", "Cannot start browser!\n"+ex.toString()+"\nThe are two possible reasons:\n * path to internet browser in \npreferences not correct\n * An bug in ewe VM, please be \npatient for an update",FormBase.OKB)).execute();
 			}
 		}
 		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1018,"Open in browser offline"))) {
-			ShowCacheInBrowser sc=new ShowCacheInBrowser();
-			sc.showCache(((CacheHolder)cacheDB.get(tbp.getSelectedCache())).getCacheDetails(false, true));
+			if(browserPathIsValid()){
+				ShowCacheInBrowser sc=new ShowCacheInBrowser();
+				sc.showCache(((CacheHolder)cacheDB.get(tbp.getSelectedCache())).getCacheDetails(false, true));
+			}
 		}
 		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1021,"Open description"))){
 			penDoubleClicked(null);
 		}
 
 	}
-
+	
+	public Boolean browserPathIsValid() {
+		if(!new File(pref.browser).exists()){
+			(new MessageBox("Error", "Path to browser:\n"+pref.browser+"\nis incorrect!",FormBase.OKB)).execute();
+			return false;
+		}
+		else
+			return true;
+	}
+	
 	public void penDoubleClicked(Point where) {
 		Global.mainTab.select(Global.mainTab.descP);
 	}



From pfeffer at mail.berlios.de  Thu Apr 17 19:23:27 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 17 Apr 2008 19:23:27 +0200
Subject: [Cachewolf-svn] r1379 - trunk
Message-ID: <200804171723.m3HHNR4I000748@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-17 19:23:24 +0200 (Thu, 17 Apr 2008)
New Revision: 1379

Modified:
   trunk/cw-pc.jnf
   trunk/cw-pda.jnf
Log:
ewe-builder: a semicolon at the end of the file mask for the resource directory caused jewel to add any file to the .ewe from that directory

Modified: trunk/cw-pc.jnf
===================================================================
--- trunk/cw-pc.jnf	2008-04-17 09:47:10 UTC (rev 1378)
+++ trunk/cw-pc.jnf	2008-04-17 17:23:24 UTC (rev 1379)
@@ -1 +1 @@
-command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DJar%25252B-%25252BJava%25252B1.2%252526%25253Dx86%25252B-%25252BWin32%25252B-%25252BStatic%25252BLinked&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/exp%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dexp/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico!
 ;%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/utils%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dutils/%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources/Cac!
 heWolf.ico
+command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DJar%25252B-%25252BJava%25252B1.2%252526%25253Dx86%25252B-%25252BWin32%25252B-%25252BStatic%25252BLinked&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/exp%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dexp/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico!
 %252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/utils%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dutils/%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources/Cach!
 eWolf.ico

Modified: trunk/cw-pda.jnf
===================================================================
--- trunk/cw-pda.jnf	2008-04-17 09:47:10 UTC (rev 1378)
+++ trunk/cw-pda.jnf	2008-04-17 17:23:24 UTC (rev 1379)
@@ -1 +1 @@
-command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D/Xmx%2B12M&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DPocketPC%25252B2003%252526%25253DPocketPC%25252B-%25252BARM/XScale%252526%25253DPocketPC%25252B-%25252BMIPS%252526%25253DPocketPC%25252B-%25252BSH3&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/exp%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dexp/%2526ewesoft/apps/jewel/EweDirEntry%253Dp!
 ath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico;%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/utils%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dutils/%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D/Xmx%252B12M%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3!
 Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources!
 /CacheWo
lf.ico
+command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3DCacheWolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26ewes%3D%26extra%3D%26pathToEwe%3D%26nativeStack%3D0%26vmStack%3D0%26appletWidth%3D0%26appletHeight%3D0%26appletInFrame%3Dfalse%26locale%3D%26useResources%3Dtrue%26noPopupWindows%3Dfalse%26vmOptions%3D/Xmx%2B12M&eweFiles=&targets=%253DTarget%3Dewe/data/MultiListSelect$SelectedItems%253D%25253DPocketPC%25252B2003%252526%25253DPocketPC%25252B-%25252BARM/XScale%252526%25253DPocketPC%25252B-%25252BMIPS%252526%25253DPocketPC%25252B-%25252BSH3&createWithPnf=true&eweInfo=outputFile%3Dwork/CacheWolf.ewe%26entries%3Dewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/CacheWolf/%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253DCacheWolf/%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/exp%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dexp/%2526ewesoft/apps/jewel/EweDirEntry%253Dp!
 ath%25253Dresources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dlib%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEwe%25253D%2526ewesoft/apps/jewel/EweDirEntry%253Dpath%25253Dbin/utils%252526mask%25253D*.class%252526includeSubdirectories%25253Dfalse%252526pathInEwe%25253Dutils/%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253DCacheWolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526ewes%253D%2526extra%253D%2526pathToEwe%253D%2526nativeStack%253D0%2526vmStack%253D0%2526appletWidth%253D0%2526appletHeight%253D0%2526appletInFrame%253Dfalse%2526locale%253D%2526useResources%253Dtrue%2526noPopupWindows%253Dfalse%2526vmOptions%253D/Xmx%252B12M%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3D!
 false%26usePool%3Dfalse%26useClassPool%3Dfalse&icon=resources/!
 CacheWol
f.ico



From mik77 at mail.berlios.de  Thu Apr 17 22:03:51 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 17 Apr 2008 22:03:51 +0200
Subject: [Cachewolf-svn] r1380 - trunk/src/CacheWolf
Message-ID: <200804172003.m3HK3pBk031631@sheep.berlios.de>

Author: mik77
Date: 2008-04-17 22:03:49 +0200 (Thu, 17 Apr 2008)
New Revision: 1380

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
Use boolean instead of Boolean.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-17 17:23:24 UTC (rev 1379)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-17 20:03:49 UTC (rev 1380)
@@ -235,7 +235,7 @@
 
 	}
 	
-	public Boolean browserPathIsValid() {
+	public boolean browserPathIsValid() {
 		if(!new File(pref.browser).exists()){
 			(new MessageBox("Error", "Path to browser:\n"+pref.browser+"\nis incorrect!",FormBase.OKB)).execute();
 			return false;



From mik77 at mail.berlios.de  Thu Apr 17 23:25:57 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 17 Apr 2008 23:25:57 +0200
Subject: [Cachewolf-svn] r1381 - in trunk/src: CacheWolf exp
Message-ID: <200804172125.m3HLPvh7005023@sheep.berlios.de>

Author: mik77
Date: 2008-04-17 23:25:54 +0200 (Thu, 17 Apr 2008)
New Revision: 1381

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/exp/TPLExporter.java
Log:
Additional variables STATUS_DATE and STATUS_TIME for template export.

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2008-04-17 20:03:49 UTC (rev 1380)
+++ trunk/src/CacheWolf/CacheHolder.java	2008-04-17 21:25:54 UTC (rev 1381)
@@ -1,5 +1,7 @@
 package CacheWolf;
 
+import com.stevesoft.ewe_pat.Regex;
+
 import ewe.io.IOException;
 import ewe.sys.Convert;
 import ewe.ui.FormBase;
@@ -539,4 +541,39 @@
    Vm.debug("CacheHolder: "+nObjects+" objects left");
 }
 	 */
+	
+	public String GetStatusDate() {
+		String statusDate = "";
+		
+		if (is_found) {
+			Regex rexDate=new Regex("([0-9]{4}-[0-9]{2}-[0-9]{2})");
+			rexDate.search(CacheStatus);
+			if (rexDate.stringMatched(1)!= null) {
+				statusDate = rexDate.stringMatched(1);
+			}
+		}
+
+		return statusDate;		
+	}
+	
+	public String GetStatusTime() {
+		String statusTime = "";
+
+		if (is_found) {
+			Regex rexTime=new Regex("([0-9]{1,2}:[0-9]{2})");
+			rexTime.search(CacheStatus);
+			if (rexTime.stringMatched(1)!= null) {
+				statusTime = rexTime.stringMatched(1);
+			}
+			else {
+				Regex rexDate=new Regex("([0-9]{4}-[0-9]{2}-[0-9]{2})");
+				rexDate.search(CacheStatus);
+				if (rexDate.stringMatched(1)!= null) {
+					statusTime = "00:00";
+				}
+			}
+		}
+
+		return statusTime;		
+	}
 }
\ No newline at end of file

Modified: trunk/src/exp/TPLExporter.java
===================================================================
--- trunk/src/exp/TPLExporter.java	2008-04-17 20:03:49 UTC (rev 1380)
+++ trunk/src/exp/TPLExporter.java	2008-04-17 21:25:54 UTC (rev 1381)
@@ -216,6 +216,8 @@
 						varParams.put("LAT", dec.replaceAll(holder.pos.getLatDeg(CWPoint.DD)));
 						varParams.put("LON", dec.replaceAll(holder.pos.getLonDeg(CWPoint.DD)));
 						varParams.put("STATUS", holder.CacheStatus);
+						varParams.put("STATUS_DATE", holder.GetStatusDate());
+						varParams.put("STATUS_TIME", holder.GetStatusTime());
 						varParams.put("DATE", holder.DateHidden);
 						varParams.put("URL", holder.URL);
 						varParams.put("NOTES", holder.CacheNotes);



From mik77 at mail.berlios.de  Thu Apr 17 23:48:38 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 17 Apr 2008 23:48:38 +0200
Subject: [Cachewolf-svn] r1382 - trunk/res_noewe
Message-ID: <200804172148.m3HLmcNu006365@sheep.berlios.de>

Author: mik77
Date: 2008-04-17 23:48:35 +0200 (Thu, 17 Apr 2008)
New Revision: 1382

Added:
   trunk/res_noewe/java_ewe.dll
Log:
Added java_ewe.dll for access to serial port wit Java-Version. Perhaps we will find a better place than res_noewe later.

Added: trunk/res_noewe/java_ewe.dll
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/java_ewe.dll
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From engywuck at mail.berlios.de  Fri Apr 18 09:04:40 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 18 Apr 2008 09:04:40 +0200
Subject: [Cachewolf-svn] r1383 - trunk/resources
Message-ID: <200804180704.m3I74ebW016730@sheep.berlios.de>

Author: engywuck
Date: 2008-04-18 09:04:08 +0200 (Fri, 18 Apr 2008)
New Revision: 1383

Modified:
   trunk/resources/0.png
   trunk/resources/108.png
   trunk/resources/108_vga.png
   trunk/resources/109.png
   trunk/resources/11.png
   trunk/resources/110.png
   trunk/resources/12.png
   trunk/resources/13.png
   trunk/resources/137.png
   trunk/resources/1858.png
   trunk/resources/2.png
   trunk/resources/3.png
   trunk/resources/4.png
   trunk/resources/453.png
   trunk/resources/5.png
   trunk/resources/6.png
   trunk/resources/8.png
   trunk/resources/arrow_down.png
   trunk/resources/arrow_left.png
   trunk/resources/arrow_right.png
   trunk/resources/arrow_up.png
   trunk/resources/bug_table.png
   trunk/resources/cachetour.png
   trunk/resources/cachetour_vga.png
   trunk/resources/calc.png
   trunk/resources/calendar.png
   trunk/resources/calendar_vga.png
   trunk/resources/center_blue.png
   trunk/resources/center_green.png
   trunk/resources/center_yellow.png
   trunk/resources/checkboxTicked.png
   trunk/resources/checkboxUnticked.png
   trunk/resources/clnew.png
   trunk/resources/clopen.png
   trunk/resources/clsave.png
   trunk/resources/clsaveas.png
   trunk/resources/down_tria.png
   trunk/resources/filter.png
   trunk/resources/filter_vga.png
   trunk/resources/flag.png
   trunk/resources/goto.png
   trunk/resources/goto_map.png
   trunk/resources/goto_vga.png
   trunk/resources/green.png
   trunk/resources/is_black.png
   trunk/resources/is_black_vga.png
   trunk/resources/logo.png
   trunk/resources/loupe_all.png
   trunk/resources/loupe_better_overview.png
   trunk/resources/loupe_more_details.png
   trunk/resources/lupe.png
   trunk/resources/lupe_activated.png
   trunk/resources/lupe_activated_vga.png
   trunk/resources/lupe_activated_zin.png
   trunk/resources/lupe_activated_zin_vga.png
   trunk/resources/lupe_activated_zout.png
   trunk/resources/lupe_activated_zout_vga.png
   trunk/resources/lupe_better_overview.png
   trunk/resources/lupe_more_details.png
   trunk/resources/lupe_vga.png
   trunk/resources/map_cd.png
   trunk/resources/map_off.png
   trunk/resources/map_on.png
   trunk/resources/map_open.png
   trunk/resources/mark_cache.png
   trunk/resources/move2center.png
   trunk/resources/move2goto.png
   trunk/resources/move2gps.png
   trunk/resources/newwpt.png
   trunk/resources/newwpt_vga.png
   trunk/resources/no_1_log.png
   trunk/resources/no_2_log.png
   trunk/resources/no_3_log.png
   trunk/resources/no_4_log.png
   trunk/resources/no_black.png
   trunk/resources/no_black_vga.png
   trunk/resources/no_picture.png
   trunk/resources/pkg.png
   trunk/resources/position_green.png
   trunk/resources/position_green_vga.png
   trunk/resources/position_red.png
   trunk/resources/position_red_vga.png
   trunk/resources/position_yellow.png
   trunk/resources/position_yellow_vga.png
   trunk/resources/puzzle.png
   trunk/resources/res_gps_goto.png
   trunk/resources/res_high.png
   trunk/resources/res_manuell.png
   trunk/resources/rose.png
   trunk/resources/sizeLarge.png
   trunk/resources/sizeMicro.png
   trunk/resources/sizeReg.png
   trunk/resources/sizeSmall.png
   trunk/resources/sizeVLarge.png
   trunk/resources/skull.png
   trunk/resources/stage.png
   trunk/resources/trailhead.png
   trunk/resources/up_tria.png
   trunk/resources/waypoint.png
   trunk/resources/zoom1to1.png
   trunk/resources/zoom1to1_vga.png
Log:
Used "fast compression" for png files in ressource folder. (http://www.geoclub.de/viewtopic.php?f=40&t=23997)

Modified: trunk/resources/0.png
===================================================================
(Binary files differ)

Modified: trunk/resources/108.png
===================================================================
(Binary files differ)

Modified: trunk/resources/108_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/109.png
===================================================================
(Binary files differ)

Modified: trunk/resources/11.png
===================================================================
(Binary files differ)

Modified: trunk/resources/110.png
===================================================================
(Binary files differ)

Modified: trunk/resources/12.png
===================================================================
(Binary files differ)

Modified: trunk/resources/13.png
===================================================================
(Binary files differ)

Modified: trunk/resources/137.png
===================================================================
(Binary files differ)

Modified: trunk/resources/1858.png
===================================================================
(Binary files differ)

Modified: trunk/resources/2.png
===================================================================
(Binary files differ)

Modified: trunk/resources/3.png
===================================================================
(Binary files differ)

Modified: trunk/resources/4.png
===================================================================
(Binary files differ)

Modified: trunk/resources/453.png
===================================================================
(Binary files differ)

Modified: trunk/resources/5.png
===================================================================
(Binary files differ)

Modified: trunk/resources/6.png
===================================================================
(Binary files differ)

Modified: trunk/resources/8.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_down.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_left.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_right.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_up.png
===================================================================
(Binary files differ)

Modified: trunk/resources/bug_table.png
===================================================================
--- trunk/resources/bug_table.png	2008-04-17 21:48:35 UTC (rev 1382)
+++ trunk/resources/bug_table.png	2008-04-18 07:04:08 UTC (rev 1383)
@@ -1,5 +1,5 @@
 ?PNG
 
-
-?????????????s??;?=?MQ????>??#??M#A?iz?0???ts EQ???y?????O???!?????,
-??EQ?e?8:?s9?eAk??[??.M?}????O?4?R??q?g??h@??sTU?%y??S]??%a???0???,m?N???]?ij??ir#??x?????0]?m?8??E????????30?)V???
\ No newline at end of file
+
+???Ryf_rvf'B?
+?/D?sU?????????h?qZ???`??x?_"N?[??/?o??
\ No newline at end of file

Modified: trunk/resources/cachetour.png
===================================================================
(Binary files differ)

Modified: trunk/resources/cachetour_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/calc.png
===================================================================
(Binary files differ)

Modified: trunk/resources/calendar.png
===================================================================
(Binary files differ)

Modified: trunk/resources/calendar_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/center_blue.png
===================================================================
(Binary files differ)

Modified: trunk/resources/center_green.png
===================================================================
(Binary files differ)

Modified: trunk/resources/center_yellow.png
===================================================================
(Binary files differ)

Modified: trunk/resources/checkboxTicked.png
===================================================================
(Binary files differ)

Modified: trunk/resources/checkboxUnticked.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clnew.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clopen.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clsave.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clsaveas.png
===================================================================
(Binary files differ)

Modified: trunk/resources/down_tria.png
===================================================================
(Binary files differ)

Modified: trunk/resources/filter.png
===================================================================
(Binary files differ)

Modified: trunk/resources/filter_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/flag.png
===================================================================
(Binary files differ)

Modified: trunk/resources/goto.png
===================================================================
(Binary files differ)

Modified: trunk/resources/goto_map.png
===================================================================
(Binary files differ)

Modified: trunk/resources/goto_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/green.png
===================================================================
(Binary files differ)

Modified: trunk/resources/is_black.png
===================================================================
(Binary files differ)

Modified: trunk/resources/is_black_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/logo.png
===================================================================
(Binary files differ)

Modified: trunk/resources/loupe_all.png
===================================================================
(Binary files differ)

Modified: trunk/resources/loupe_better_overview.png
===================================================================
(Binary files differ)

Modified: trunk/resources/loupe_more_details.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zin.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zin_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zout.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zout_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_better_overview.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_more_details.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_cd.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_off.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_on.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_open.png
===================================================================
(Binary files differ)

Modified: trunk/resources/mark_cache.png
===================================================================
(Binary files differ)

Modified: trunk/resources/move2center.png
===================================================================
(Binary files differ)

Modified: trunk/resources/move2goto.png
===================================================================
(Binary files differ)

Modified: trunk/resources/move2gps.png
===================================================================
(Binary files differ)

Modified: trunk/resources/newwpt.png
===================================================================
(Binary files differ)

Modified: trunk/resources/newwpt_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_1_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_2_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_3_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_4_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_black.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_black_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_picture.png
===================================================================
(Binary files differ)

Modified: trunk/resources/pkg.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_green.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_green_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_red.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_red_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_yellow.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_yellow_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/puzzle.png
===================================================================
(Binary files differ)

Modified: trunk/resources/res_gps_goto.png
===================================================================
(Binary files differ)

Modified: trunk/resources/res_high.png
===================================================================
(Binary files differ)

Modified: trunk/resources/res_manuell.png
===================================================================
(Binary files differ)

Modified: trunk/resources/rose.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeLarge.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeMicro.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeReg.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeSmall.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeVLarge.png
===================================================================
(Binary files differ)

Modified: trunk/resources/skull.png
===================================================================
(Binary files differ)

Modified: trunk/resources/stage.png
===================================================================
(Binary files differ)

Modified: trunk/resources/trailhead.png
===================================================================
(Binary files differ)

Modified: trunk/resources/up_tria.png
===================================================================
(Binary files differ)

Modified: trunk/resources/waypoint.png
===================================================================
(Binary files differ)

Modified: trunk/resources/zoom1to1.png
===================================================================
(Binary files differ)

Modified: trunk/resources/zoom1to1_vga.png
===================================================================
(Binary files differ)



From kappler at mail.berlios.de  Fri Apr 18 09:51:31 2008
From: kappler at mail.berlios.de (kappler at mail.berlios.de)
Date: Fri, 18 Apr 2008 09:51:31 +0200
Subject: [Cachewolf-svn] r1384 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804180751.m3I7pV5K020160@sheep.berlios.de>

Author: kappler
Date: 2008-04-18 09:51:28 +0200 (Fri, 18 Apr 2008)
New Revision: 1384

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Add internationalisation for some error-messages

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-18 07:04:08 UTC (rev 1383)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-18 07:51:28 UTC (rev 1384)
@@ -292,6 +292,12 @@
 		1029=Es gibt angew%e4hlte aber nicht sichtbare Caches.%0a(Caches:+
         1030=, zus%e4tzliche Wegpunkte:+
         1031=Diese auch l%f6schen?
+		1032=Pfad zum Browser:
+		1033=ist falsch!
+		1034=Browser kann nicht ge%f6ffnet werden!
+		1035=M%f6gliche Ursache:
+		1036=Ein Fehler in der Ewe-VM
+		1037=Bitte Geduld bis zu einem Update
 		1100=Profile
 		1105=Suchen
 		1106=Profil w%e4hlen oder Neu

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-18 07:04:08 UTC (rev 1383)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-18 07:51:28 UTC (rev 1384)
@@ -293,6 +293,12 @@
 		1029=There are caches that are ticked but invisible.%0a(Main caches:+
 		1030=, additional Waypoints:+
 		1031=Delete them, too? 
+		1032=Path to browser:
+		1033=is incorrect!
+		1034=Cannot start browser!
+		1035=Possible reason:
+		1036=A bug in ewe VM, please be
+		1037=patient for an update
 		1100=Profiles
 		1105=Browse
 		1106=Choose profile or New

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2008-04-18 07:04:08 UTC (rev 1383)
+++ trunk/res_noewe/languages/NL.cfg	2008-04-18 07:51:28 UTC (rev 1384)
@@ -270,6 +270,12 @@
 		1029=Er zijn verwinkte maar niet zichtbare caches.%0a(Caches:+
         1030=, additionele Waypoints:+
         1031=Deeze ook verwijdern?
+		1032=Path to browser:
+		1033=is incorrect!
+		1034=Cannot start browser!
+		1035=Possible reason:
+		1036=A bug in ewe VM, please be
+		1037=patient for an update
 		1100=Profielen
 		1105=Bladeren
 		1106=Kies profiel of nieuw.

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2008-04-18 07:04:08 UTC (rev 1383)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2008-04-18 07:51:28 UTC (rev 1384)
@@ -1,12 +1,17 @@
 package CacheWolf;
+import utils.CWWrapper;
+
 import com.stevesoft.ewe_pat.Regex;
 
 import ewe.io.BufferedWriter;
 import ewe.io.FileBase;
 import ewe.io.FileWriter;
+import ewe.io.IOException;
 import ewe.io.PrintWriter;
 import ewe.sys.Convert;
 import ewe.sys.Vm;
+import ewe.ui.FormBase;
+import ewe.ui.MessageBox;
 import ewe.util.*;
 import HTML.Template;
 
@@ -206,11 +211,13 @@
 			//detfile.print(tpl.output());
 			detfile.close();
 			try {
-				String s = "\""+Global.getPref().browser+"\" \"file://"+saveTo+"\"";
-
-				Vm.exec(s); //Global.getPref().browser+" \"file:"+saveTo+"\"");
-				Global.getPref().log("Executing: "+s); //Global.getPref().browser+" \""+saveTo+"\"");
-			} catch (Exception ioex) {
+				CWWrapper.exec(Global.getPref().browser, "\"file://"+saveTo+"\""); // maybe this works on some PDAs?
+			} catch (IOException ex) {
+				(new MessageBox(MyLocale.getMsg(321,"Error"),
+						MyLocale.getMsg(1034,"Cannot start browser!") + "\n" + ex.toString() + "\n" +
+						MyLocale.getMsg(1035,"Possible reason:") + "\n" +
+						MyLocale.getMsg(1036,"A bug in ewe VM, please be") + "\n" +
+						MyLocale.getMsg(1037,"patient for an update"),FormBase.OKB)).execute();
 			}
 			
 		} catch(Exception e) {

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-18 07:04:08 UTC (rev 1383)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-18 07:51:28 UTC (rev 1384)
@@ -219,7 +219,11 @@
 						CWWrapper.exec(pref.browser, chD.URL); // maybe this works on some PDAs?
 					}
 				} catch (IOException ex) {
-					(new MessageBox("Error", "Cannot start browser!\n"+ex.toString()+"\nPossible reason:\n * An bug in ewe VM, please be \npatient for an update",FormBase.OKB)).execute();
+					(new MessageBox(MyLocale.getMsg(321,"Error"),
+							MyLocale.getMsg(1034,"Cannot start browser!") + "\n" + ex.toString() + "\n" +
+							MyLocale.getMsg(1035,"Possible reason:") + "\n" +
+							MyLocale.getMsg(1036,"A bug in ewe VM, please be") + "\n" +
+							MyLocale.getMsg(1037,"patient for an update"),FormBase.OKB)).execute();
 				}
 			}
 		}
@@ -237,7 +241,7 @@
 	
 	public boolean browserPathIsValid() {
 		if(!new File(pref.browser).exists()){
-			(new MessageBox("Error", "Path to browser:\n"+pref.browser+"\nis incorrect!",FormBase.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(1032,"Path to browser:")+"\n"+pref.browser+"\n"+MyLocale.getMsg(1033,"is incorrect!"),FormBase.OKB)).execute();
 			return false;
 		}
 		else



From engywuck at mail.berlios.de  Fri Apr 18 13:12:01 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 18 Apr 2008 13:12:01 +0200
Subject: [Cachewolf-svn] r1385 - trunk/resources
Message-ID: <200804181112.m3IBC1Zu027252@sheep.berlios.de>

Author: engywuck
Date: 2008-04-18 13:11:59 +0200 (Fri, 18 Apr 2008)
New Revision: 1385

Modified:
   trunk/resources/109.png
Log:
Wrong picture. 

Modified: trunk/resources/109.png
===================================================================
(Binary files differ)



From mik77 at mail.berlios.de  Sat Apr 19 10:38:41 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 19 Apr 2008 10:38:41 +0200
Subject: [Cachewolf-svn] r1386 - trunk/src/CacheWolf
Message-ID: <200804190838.m3J8cf5g009347@sheep.berlios.de>

Author: mik77
Date: 2008-04-19 10:38:37 +0200 (Sat, 19 Apr 2008)
New Revision: 1386

Modified:
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
Log:
Remove Cachetour from Filter menu.

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2008-04-18 11:11:59 UTC (rev 1385)
+++ trunk/src/CacheWolf/MainForm.java	2008-04-19 08:38:37 UTC (rev 1386)
@@ -153,12 +153,12 @@
 			// Make the splitterbar visible with a width of 6 
 			split.theSplitter.modify(0,Invisible);
 			split.theSplitter.resizeTo(6,split.theSplitter.getRect().height);
-			Global.mainForm.mMenu.filtCacheTour.modifiers|=MenuItem.Checked;
+			Global.mainForm.mMenu.cacheTour.modifiers|=MenuItem.Checked;
 		} else {
 			// Hide the splitterbar and set width to 0
 			split.theSplitter.modify(Invisible,0);
 			split.theSplitter.resizeTo(0,split.theSplitter.getRect().height);
-			Global.mainForm.mMenu.filtCacheTour.modifiers&=~MenuItem.Checked;
+			Global.mainForm.mMenu.cacheTour.modifiers&=~MenuItem.Checked;
 		}
 		split.theSplitter.doOpenClose(cacheListVisible);
 		Global.mainForm.mMenu.repaint();

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-18 11:11:59 UTC (rev 1385)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-19 08:38:37 UTC (rev 1386)
@@ -31,8 +31,8 @@
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
 	private MenuItem exportGPS, exportCacheMate,mnuSeparator;
-	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild,orgToggleCacheTour;
-	public MenuItem filtCacheTour,orgTravelbugs, mnuForceLogin;
+	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild;
+	public MenuItem cacheTour,orgTravelbugs, mnuForceLogin;
 	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditCenter;
 	private Form father;
 	private TablePanel tbp;
@@ -125,7 +125,7 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Filter" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] filterMenuItems=new MenuItem[11];
+		MenuItem[] filterMenuItems=new MenuItem[9];
 		filterMenuItems[0] = filtApply  = new MenuItem(MyLocale.getMsg(709,"Apply")); 
 		filterMenuItems[1] = filtCreate  = new MenuItem(MyLocale.getMsg(114,"Create")); 
 		filterMenuItems[2] = filtInvert  = new MenuItem(MyLocale.getMsg(115,"Invert")); 
@@ -135,13 +135,13 @@
 		filterMenuItems[6] = filtNonSelected = new MenuItem(MyLocale.getMsg(1011,"Filter out non selected"));
 		filterMenuItems[7] = mnuSeparator;
 		filterMenuItems[8] = filtBlack   = new MenuItem(MyLocale.getMsg(161,"Show Blacklist"));
-		filterMenuItems[9] = mnuSeparator;
-		filterMenuItems[10] = filtCacheTour = new MenuItem(MyLocale.getMsg(198,"Cachetour"));
+		//filterMenuItems[9] = mnuSeparator;
+		//filterMenuItems[10] = cacheTour;
 
 		///////////////////////////////////////////////////////////////////////
 		// Create a combined "Filter and Search" pulldown menu for devices with small screens
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] filterAndSearchMenuItems=new MenuItem[14];
+		MenuItem[] filterAndSearchMenuItems=new MenuItem[12];
 		filterAndSearchMenuItems[0]=filtApply;
 		filterAndSearchMenuItems[1]=filtCreate;
 		filterAndSearchMenuItems[2]=filtInvert;
@@ -154,8 +154,8 @@
 		filterAndSearchMenuItems[9]=mnuSeparator;
 		filterAndSearchMenuItems[10]=search;
 		filterAndSearchMenuItems[11]=searchClr;
-		filterAndSearchMenuItems[12] = mnuSeparator;
-		filterAndSearchMenuItems[13] = filtCacheTour;
+		//filterAndSearchMenuItems[12] = mnuSeparator;
+		//filterAndSearchMenuItems[13] = cacheTour;
 
 		// Depending on screen width display either filter and search menus or the combined menu 
 		if (MyLocale.getScreenWidth()>300) {
@@ -177,7 +177,8 @@
 		organiseMenuItems[5] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,"Rebuild Index"));
 		organiseMenuItems[6] = mnuSeparator;
 		organiseMenuItems[7] = orgTravelbugs = new MenuItem(MyLocale.getMsg(139,"Manage travelbugs"));
-		organiseMenuItems[8] = orgToggleCacheTour = new MenuItem(MyLocale.getMsg(197,"Show/Hide cachetour"));
+		cacheTour = new MenuItem(MyLocale.getMsg(198,"Cachetour"));
+		organiseMenuItems[8] = cacheTour;
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(140,"Organise"),new Menu(organiseMenuItems,null)));
 
 		///////////////////////////////////////////////////////////////////////
@@ -518,10 +519,6 @@
 				flt.clearFilter();
 				tbp.refreshTable();
 			}
-			if(mev.selectedItem == filtCacheTour){
-				filtCacheTour.modifiers^=MenuItem.Checked;
-				Global.mainForm.toggleCacheListVisible();			
-			}
 			///////////////////////////////////////////////////////////////////////
 			// "Organise" pulldown menu
 			///////////////////////////////////////////////////////////////////////
@@ -561,10 +558,11 @@
 				tbs.execute(); //getFrame(), Gui.CENTER_FRAME);
 				tbs.close(0);
 			}
-			if (mev.selectedItem == orgToggleCacheTour){
+			if(mev.selectedItem == cacheTour){
+				cacheTour.modifiers^=MenuItem.Checked;
 				Global.mainForm.toggleCacheListVisible();			
 			}
-
+			
 			///////////////////////////////////////////////////////////////////////
 			// "About" pulldown menu
 			///////////////////////////////////////////////////////////////////////



From mik77 at mail.berlios.de  Sat Apr 19 11:29:07 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 19 Apr 2008 11:29:07 +0200
Subject: [Cachewolf-svn] r1387 - trunk/src/CacheWolf
Message-ID: <200804190929.m3J9T7So011750@sheep.berlios.de>

Author: mik77
Date: 2008-04-19 11:29:06 +0200 (Sat, 19 Apr 2008)
New Revision: 1387

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Don't load page with all logs, if only 5 or less logs should be spidered.

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-04-19 08:38:37 UTC (rev 1386)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-04-19 09:29:06 UTC (rev 1387)
@@ -222,7 +222,8 @@
 				pref.log("No .XML file found for cache "+chD.wayPoint);
 			};
 */			// Read the cache data from GC.COM and compare to old data
-			ret=getCacheByWaypointName(chD,true,true,false,true);
+			boolean loadAllLogs = (MAXLOGS > 5);
+			ret=getCacheByWaypointName(chD,true,true,false,loadAllLogs);
 			// Save the spidered data
 			if (ret) {
 				pref.log("Saving to:" + profile.dataDir);
@@ -441,6 +442,8 @@
 		//=======
 		// Now ready to spider each cache in the list
 		//=======
+		boolean loadAllLogs = (MAXLOGS > 5);
+
 		for(int i = 0; i<cachesToLoad.size(); i++){
 			if (infB.isClosed) break;
 
@@ -450,7 +453,7 @@
 				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + wpt +" (" + (i+1) + " / " + cachesToLoad.size() + ")");
 				chD = new CacheHolderDetail();
 				chD.wayPoint=wpt;
-				if (!getCacheByWaypointName(chD,false,getImages,doNotgetFound,true)) break;
+				if (!getCacheByWaypointName(chD,false,getImages,doNotgetFound,loadAllLogs)) break;
 				if (!chD.is_found || !doNotgetFound ) {
 					chD.saveCacheDetails(profile.dataDir);
 					cacheDB.add(new CacheHolder(chD)); 



From mik77 at mail.berlios.de  Sat Apr 19 13:27:11 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 19 Apr 2008 13:27:11 +0200
Subject: [Cachewolf-svn] r1388 - trunk/src/CacheWolf
Message-ID: <200804191127.m3JBRBhO011315@sheep.berlios.de>

Author: mik77
Date: 2008-04-19 13:27:09 +0200 (Sat, 19 Apr 2008)
New Revision: 1388

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Always copy CacheHolder data to CacheHolderDetails when saving waypoint data in DetailsPanel and not vice versa. 

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-04-19 09:29:06 UTC (rev 1387)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-04-19 11:27:09 UTC (rev 1388)
@@ -530,6 +530,7 @@
 		  dirty_notes=false;
 		  dirty_details=false;
 		  setNeedsTableUpdate(false);
+		  if (thisCache.details != null) thisCache.details.hasUnsavedChanges = false;
 		  thisCache.getCacheDetails(true).hasUnsavedChanges = true;
 		  
 		  // Global.mainTab.tbP.refreshTable(); this is done in mainTab.onLeavingPanel



From pfeffer at mail.berlios.de  Sat Apr 19 14:51:37 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 19 Apr 2008 14:51:37 +0200
Subject: [Cachewolf-svn] r1389 - in trunk/src: CacheWolf/navi utils
Message-ID: <200804191251.m3JCpbao022298@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-19 14:51:34 +0200 (Sat, 19 Apr 2008)
New Revision: 1389

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
   trunk/src/utils/FileBugfix.java
Log:
MovingMap: Bug fixed: in some cases an error message "cannot start map - null" appeared - this is avoided now

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2008-04-19 11:27:09 UTC (rev 1388)
+++ trunk/src/CacheWolf/navi/MapsList.java	2008-04-19 12:51:34 UTC (rev 1389)
@@ -48,6 +48,7 @@
 			files = new FileBugfix(mapsPath+"/"+dirs.get(j));
 			//ewe.sys.Vm.debug("mapd-Dirs:"+files);
 			dateien = files.list("*.wfl", FileBase.LIST_FILES_ONLY); //"*.xyz" doesn't work on some systems -> use FileBugFix
+			if (dateien == null) continue;
 			for(int i = 0; i < dateien.length;i++){
 				// if (!dateien[i].endsWith(".wfl")) continue;
 				rawFileName = dateien[i].substring(0, dateien[i].lastIndexOf("."));

Modified: trunk/src/utils/FileBugfix.java
===================================================================
--- trunk/src/utils/FileBugfix.java	2008-04-19 11:27:09 UTC (rev 1388)
+++ trunk/src/utils/FileBugfix.java	2008-04-19 12:51:34 UTC (rev 1389)
@@ -3,6 +3,7 @@
  */
 package utils;
 
+import CacheWolf.STRreplace;
 import ewe.io.*;
 import ewe.util.FileComparer;
 import ewe.util.mString;
@@ -12,8 +13,9 @@
  * so I get all the files wich null in spite of the mask and filter afterwords 
  */
 public class FileBugfix extends File{
-	public FileBugfix(String path) 
-	{super(path);}
+	public FileBugfix(String path) {
+		super(STRreplace.replace(path, "//", "/"));
+	}
 
 	public String[] list(final String mask,final int listAndSortOptions)
 	{
@@ -33,22 +35,25 @@
 		 */
 		return listBugFixed (compositeMask, listAndSortOptions);
 	}
-	
+
 	public String[] listBugFixed(final String compositeMask,final int listAndSortOptions) {
+		File ewefile = ewe.sys.Vm.newFileObject();
+		ewefile.set(null, name);
+
 		String mask = (compositeMask == null) ? "*.*" : compositeMask; 
 		String[] found; //the following code is mainly copoed from FileBase.listmultiple to avoid recursion it is not called
 		char c = mask.indexOf(',') == -1 ? ';' : ',';
 		String masks [] = mString.split(mask,c);
 		String dirs [] = new String[0];
 		if ((listAndSortOptions & LIST_FILES_ONLY) == 0)
-			dirs = super.list(null,LIST_DIRECTORIES_ONLY); // add dirs if not only asked for files
+			dirs = ewefile.list(null,LIST_DIRECTORIES_ONLY); // add dirs if not only asked for files
 		if ((listAndSortOptions & LIST_DIRECTORIES_ONLY) == 0)
-			found = super.list(null,FileBase.LIST_FILES_ONLY|listAndSortOptions); // add files if not dirs only
+			found = ewefile.list(null,FileBase.LIST_FILES_ONLY|listAndSortOptions); // add files if not dirs only
 		else {
 			found = dirs; // if dirs only -> aplpy masks to the dirs
 			dirs = new String[0]; // this line is missing in ewe FileBase.listmultiple -> doubled dirs when using listmultiple with the option dirs_only
 		}
-
+		if (found == null) return null;
 		ewe.util.FileComparer [] fcs = new ewe.util.FileComparer[masks.length];
 
 		for (int i = 0; i<masks.length; i++)
@@ -75,4 +80,46 @@
 		found = isMatching;
 		return found;
 	}
+
+	/**
+	 * this is needed in order to be able to use the simulated 
+	 * file system _filesystem.zip when running as applet 
+	 */
+	public boolean exists() {
+		File ewefile = ewe.sys.Vm.newFileObject();
+		ewefile.set(null, name);
+		return (ewefile.exists());
+	}
+
+	public boolean isDirectory() {
+		File ewefile = ewe.sys.Vm.newFileObject();
+		ewefile.set(null, name);
+		return (ewefile.isDirectory());
+	}
+
+	public boolean createDir() {
+		File ewefile = ewe.sys.Vm.newFileObject();
+		ewefile.set(null, name);
+		return (ewefile.createDir());
+
+	}
+	public boolean delete() {
+		File ewefile = ewe.sys.Vm.newFileObject();
+		ewefile.set(null, name);
+		return (ewefile.delete());
+	}
+	public int getLength() {
+		File ewefile = ewe.sys.Vm.newFileObject();
+		ewefile.set(null, name);
+		return (ewefile.getLength());
+	}
+
+	public String getDrivePath() {
+		File ewefile = ewe.sys.Vm.newFileObject();
+		ewefile.set(null, name);
+		return (ewefile.getDrivePath());
+	}
+
+
+
 }



From mik77 at mail.berlios.de  Sat Apr 19 16:04:27 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 19 Apr 2008 16:04:27 +0200
Subject: [Cachewolf-svn] r1390 - trunk/resources
Message-ID: <200804191404.m3JE4RVh005446@sheep.berlios.de>

Author: mik77
Date: 2008-04-19 16:03:50 +0200 (Sat, 19 Apr 2008)
New Revision: 1390

Modified:
   trunk/resources/0.png
   trunk/resources/108.png
   trunk/resources/108_vga.png
   trunk/resources/109.png
   trunk/resources/11.png
   trunk/resources/110.png
   trunk/resources/12.png
   trunk/resources/13.png
   trunk/resources/137.png
   trunk/resources/1858.png
   trunk/resources/2.png
   trunk/resources/3.png
   trunk/resources/4.png
   trunk/resources/453.png
   trunk/resources/5.png
   trunk/resources/6.png
   trunk/resources/8.png
   trunk/resources/arrow_down.png
   trunk/resources/arrow_left.png
   trunk/resources/arrow_right.png
   trunk/resources/arrow_up.png
   trunk/resources/bug_table.png
   trunk/resources/cachetour.png
   trunk/resources/cachetour_vga.png
   trunk/resources/calc.png
   trunk/resources/calendar.png
   trunk/resources/calendar_vga.png
   trunk/resources/center_blue.png
   trunk/resources/center_green.png
   trunk/resources/center_yellow.png
   trunk/resources/checkboxTicked.png
   trunk/resources/checkboxUnticked.png
   trunk/resources/clnew.png
   trunk/resources/clopen.png
   trunk/resources/clsave.png
   trunk/resources/clsaveas.png
   trunk/resources/down_tria.png
   trunk/resources/filter.png
   trunk/resources/filter_vga.png
   trunk/resources/flag.png
   trunk/resources/goto.png
   trunk/resources/goto_map.png
   trunk/resources/goto_vga.png
   trunk/resources/green.png
   trunk/resources/is_black.png
   trunk/resources/is_black_vga.png
   trunk/resources/logo.png
   trunk/resources/loupe_all.png
   trunk/resources/loupe_better_overview.png
   trunk/resources/loupe_more_details.png
   trunk/resources/lupe.png
   trunk/resources/lupe_activated.png
   trunk/resources/lupe_activated_vga.png
   trunk/resources/lupe_activated_zin.png
   trunk/resources/lupe_activated_zin_vga.png
   trunk/resources/lupe_activated_zout.png
   trunk/resources/lupe_activated_zout_vga.png
   trunk/resources/lupe_better_overview.png
   trunk/resources/lupe_more_details.png
   trunk/resources/lupe_vga.png
   trunk/resources/map_cd.png
   trunk/resources/map_off.png
   trunk/resources/map_on.png
   trunk/resources/map_open.png
   trunk/resources/mark_cache.png
   trunk/resources/move2center.png
   trunk/resources/move2goto.png
   trunk/resources/move2gps.png
   trunk/resources/newwpt.png
   trunk/resources/newwpt_vga.png
   trunk/resources/no_1_log.png
   trunk/resources/no_2_log.png
   trunk/resources/no_3_log.png
   trunk/resources/no_4_log.png
   trunk/resources/no_black.png
   trunk/resources/no_black_vga.png
   trunk/resources/no_picture.png
   trunk/resources/pkg.png
   trunk/resources/position_green.png
   trunk/resources/position_green_vga.png
   trunk/resources/position_red.png
   trunk/resources/position_red_vga.png
   trunk/resources/position_yellow.png
   trunk/resources/position_yellow_vga.png
   trunk/resources/puzzle.png
   trunk/resources/res_gps_goto.png
   trunk/resources/res_high.png
   trunk/resources/res_manuell.png
   trunk/resources/rose.png
   trunk/resources/sizeLarge.png
   trunk/resources/sizeMicro.png
   trunk/resources/sizeReg.png
   trunk/resources/sizeSmall.png
   trunk/resources/sizeVLarge.png
   trunk/resources/skull.png
   trunk/resources/stage.png
   trunk/resources/trailhead.png
   trunk/resources/up_tria.png
   trunk/resources/waypoint.png
   trunk/resources/zoom1to1.png
   trunk/resources/zoom1to1_vga.png
Log:
revert revisions 1383 and 1385 because they had errors and didn't fix the problem

Modified: trunk/resources/0.png
===================================================================
(Binary files differ)

Modified: trunk/resources/108.png
===================================================================
(Binary files differ)

Modified: trunk/resources/108_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/109.png
===================================================================
(Binary files differ)

Modified: trunk/resources/11.png
===================================================================
(Binary files differ)

Modified: trunk/resources/110.png
===================================================================
(Binary files differ)

Modified: trunk/resources/12.png
===================================================================
(Binary files differ)

Modified: trunk/resources/13.png
===================================================================
(Binary files differ)

Modified: trunk/resources/137.png
===================================================================
(Binary files differ)

Modified: trunk/resources/1858.png
===================================================================
(Binary files differ)

Modified: trunk/resources/2.png
===================================================================
(Binary files differ)

Modified: trunk/resources/3.png
===================================================================
(Binary files differ)

Modified: trunk/resources/4.png
===================================================================
(Binary files differ)

Modified: trunk/resources/453.png
===================================================================
(Binary files differ)

Modified: trunk/resources/5.png
===================================================================
(Binary files differ)

Modified: trunk/resources/6.png
===================================================================
(Binary files differ)

Modified: trunk/resources/8.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_down.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_left.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_right.png
===================================================================
(Binary files differ)

Modified: trunk/resources/arrow_up.png
===================================================================
(Binary files differ)

Modified: trunk/resources/bug_table.png
===================================================================
--- trunk/resources/bug_table.png	2008-04-19 12:51:34 UTC (rev 1389)
+++ trunk/resources/bug_table.png	2008-04-19 14:03:50 UTC (rev 1390)
@@ -1,5 +1,5 @@
 ?PNG
 
-
-???Ryf_rvf'B?
-?/D?sU?????????h?qZ???`??x?_"N?[??/?o??
\ No newline at end of file
+
+?????????????s??;?=?MQ????>??#??M#A?iz?0???ts EQ???y?????O???!?????,
+??EQ?e?8:?s9?eAk??[??.M?}????O?4?R??q?g??h@??sTU?%y??S]??%a???0???,m?N???]?ij??ir#??x?????0]?m?8??E????????30?)V???
\ No newline at end of file

Modified: trunk/resources/cachetour.png
===================================================================
(Binary files differ)

Modified: trunk/resources/cachetour_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/calc.png
===================================================================
(Binary files differ)

Modified: trunk/resources/calendar.png
===================================================================
(Binary files differ)

Modified: trunk/resources/calendar_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/center_blue.png
===================================================================
(Binary files differ)

Modified: trunk/resources/center_green.png
===================================================================
(Binary files differ)

Modified: trunk/resources/center_yellow.png
===================================================================
(Binary files differ)

Modified: trunk/resources/checkboxTicked.png
===================================================================
(Binary files differ)

Modified: trunk/resources/checkboxUnticked.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clnew.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clopen.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clsave.png
===================================================================
(Binary files differ)

Modified: trunk/resources/clsaveas.png
===================================================================
(Binary files differ)

Modified: trunk/resources/down_tria.png
===================================================================
(Binary files differ)

Modified: trunk/resources/filter.png
===================================================================
(Binary files differ)

Modified: trunk/resources/filter_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/flag.png
===================================================================
(Binary files differ)

Modified: trunk/resources/goto.png
===================================================================
(Binary files differ)

Modified: trunk/resources/goto_map.png
===================================================================
(Binary files differ)

Modified: trunk/resources/goto_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/green.png
===================================================================
(Binary files differ)

Modified: trunk/resources/is_black.png
===================================================================
(Binary files differ)

Modified: trunk/resources/is_black_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/logo.png
===================================================================
(Binary files differ)

Modified: trunk/resources/loupe_all.png
===================================================================
(Binary files differ)

Modified: trunk/resources/loupe_better_overview.png
===================================================================
(Binary files differ)

Modified: trunk/resources/loupe_more_details.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zin.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zin_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zout.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_activated_zout_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_better_overview.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_more_details.png
===================================================================
(Binary files differ)

Modified: trunk/resources/lupe_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_cd.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_off.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_on.png
===================================================================
(Binary files differ)

Modified: trunk/resources/map_open.png
===================================================================
(Binary files differ)

Modified: trunk/resources/mark_cache.png
===================================================================
(Binary files differ)

Modified: trunk/resources/move2center.png
===================================================================
(Binary files differ)

Modified: trunk/resources/move2goto.png
===================================================================
(Binary files differ)

Modified: trunk/resources/move2gps.png
===================================================================
(Binary files differ)

Modified: trunk/resources/newwpt.png
===================================================================
(Binary files differ)

Modified: trunk/resources/newwpt_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_1_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_2_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_3_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_4_log.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_black.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_black_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_picture.png
===================================================================
(Binary files differ)

Modified: trunk/resources/pkg.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_green.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_green_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_red.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_red_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_yellow.png
===================================================================
(Binary files differ)

Modified: trunk/resources/position_yellow_vga.png
===================================================================
(Binary files differ)

Modified: trunk/resources/puzzle.png
===================================================================
(Binary files differ)

Modified: trunk/resources/res_gps_goto.png
===================================================================
(Binary files differ)

Modified: trunk/resources/res_high.png
===================================================================
(Binary files differ)

Modified: trunk/resources/res_manuell.png
===================================================================
(Binary files differ)

Modified: trunk/resources/rose.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeLarge.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeMicro.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeReg.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeSmall.png
===================================================================
(Binary files differ)

Modified: trunk/resources/sizeVLarge.png
===================================================================
(Binary files differ)

Modified: trunk/resources/skull.png
===================================================================
(Binary files differ)

Modified: trunk/resources/stage.png
===================================================================
(Binary files differ)

Modified: trunk/resources/trailhead.png
===================================================================
(Binary files differ)

Modified: trunk/resources/up_tria.png
===================================================================
(Binary files differ)

Modified: trunk/resources/waypoint.png
===================================================================
(Binary files differ)

Modified: trunk/resources/zoom1to1.png
===================================================================
(Binary files differ)

Modified: trunk/resources/zoom1to1_vga.png
===================================================================
(Binary files differ)



From mik77 at mail.berlios.de  Sat Apr 19 16:32:12 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 19 Apr 2008 16:32:12 +0200
Subject: [Cachewolf-svn] r1391 - trunk/res_noewe/languages
Message-ID: <200804191432.m3JEWCxS010162@sheep.berlios.de>

Author: mik77
Date: 2008-04-19 16:32:10 +0200 (Sat, 19 Apr 2008)
New Revision: 1391

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
Log:
Clarify that applying a Cachetour is like a filter

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-19 14:03:50 UTC (rev 1390)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-19 14:32:10 UTC (rev 1391)
@@ -15,7 +15,7 @@
 		111=Beenden
 		112=Suchen
 		113=Suche aufheben
-		114=Erzeugen
+		114=Erstellen
 		115=Umkehren
 		116=Aufheben
 		117=%dcber
@@ -79,7 +79,7 @@
 		186=Addi Wegpunkte mitziehen
 		187=Nur diese Wegpunkte anzeigen
 		188=CACHETOUR: NEU
-		189=Liste anwenden
+		189=Tourfilter anwenden
 		190=Nur diese Wegpunkte zeigen
 		191=Datei w%e4hlen
 		192=%c4nderungen speichern

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-19 14:03:50 UTC (rev 1390)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-19 14:32:10 UTC (rev 1391)
@@ -79,7 +79,7 @@
 		186=Also drag Addi Wpts
 		187=Show only these waypoints
 		188=CACHETOUR: NEW
-		189=Apply list
+		189=Apply tour filter
 		190=Show only these waypoints
 		191=Select file
 		192=Save changes



From mirabilos at mail.berlios.de  Sun Apr 20 14:10:47 2008
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Sun, 20 Apr 2008 14:10:47 +0200
Subject: [Cachewolf-svn] r1392 - in trunk: . lib res_noewe
Message-ID: <200804201210.m3KCAlCI001322@sheep.berlios.de>

Author: mirabilos
Date: 2008-04-20 14:10:46 +0200 (Sun, 20 Apr 2008)
New Revision: 1392

Added:
   trunk/lib/java_ewe.dll
Removed:
   trunk/res_noewe/java_ewe.dll
Modified:
   trunk/fwrtsnapshot.sh
Log:
? move win32-only blob into the Jar directory
  cf. http://www.geoclub.de/viewtopic.php?f=40&t=23920
? make lines <80c wide and ?./foo/? ? ?foo? while here


Modified: trunk/fwrtsnapshot.sh
===================================================================
--- trunk/fwrtsnapshot.sh	2008-04-19 14:32:10 UTC (rev 1391)
+++ trunk/fwrtsnapshot.sh	2008-04-20 12:10:46 UTC (rev 1392)
@@ -7,10 +7,13 @@
     ed -s src/CacheWolf/Version.java
 rm -rf bin
 mkdir -p bin/CacheWolf
-javac -source 1.3 -target 1.1 -encoding windows-1252 -cp ./lib/CompileEwe.zip:./lib/  -d ./bin/ -deprecation -nowarn ./src/CacheWolf/*.java ./src/CacheWolf/*/*.java ./src/exp/*.java ./src/utils/*.java
+javac -source 1.3 -target 1.1 -encoding windows-1252 \
+    -cp lib/CompileEwe.zip:lib -d bin -deprecation -nowarn \
+    src/CacheWolf/*.java src/CacheWolf/*/*.java src/exp/*.java src/utils/*.java
 /usr/local/bin/ewecl programs/Jewel.ewe -c cw-pda.jnf
 /usr/local/bin/ewecl programs/Jewel.ewe -c cw-pc.jnf
-# Dont change the order above because the PC version has to overwrite the PDA version of the EWE-file
+# Don?t change the order of the above Jewel commands because
+# the PC version has to overwrite the PDA version of the EWE file
 rm -rf published
 if test '!' -e programs/CacheWolf/Jar/CacheWolf.bat; then
 	rm -rf bin
@@ -21,6 +24,7 @@
 mkdir -p published/dat/languages
 mv programs/CacheWolf/* published/
 chmod 755 published/*
+cp lib/java_ewe.dll published/Jar/
 chmod 644 published/*/*
 chmod 755 published/dat/attributes
 chmod 755 published/dat/webmapservices

Copied: trunk/lib/java_ewe.dll (from rev 1391, trunk/res_noewe/java_ewe.dll)

Deleted: trunk/res_noewe/java_ewe.dll
===================================================================
(Binary files differ)



From mik77 at mail.berlios.de  Sun Apr 20 16:22:14 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 20 Apr 2008 16:22:14 +0200
Subject: [Cachewolf-svn] r1393 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804201422.m3KEME7i014126@sheep.berlios.de>

Author: mik77
Date: 2008-04-20 16:22:09 +0200 (Sun, 20 Apr 2008)
New Revision: 1393

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/SpiderGC.java
Log:
Better error handling and more detailed error messages while loading caches from GC.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-20 12:10:46 UTC (rev 1392)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-20 14:22:09 UTC (rev 1393)
@@ -704,7 +704,7 @@
 		5002=: Diese Funktion steht gegenw%e4rtig nur f%fcr Geocaching.com und Opencaching.de zur Verf%fcgung.
 		5497=Fehler: Ein Tag in spider.def fehlt
 		5498=Login nicht m%f6glich. Fehler beim Laden der Seite nach Login.
-		5499=Fehler beim Laden der Login Seite
+		5499=Fehler beim Laden der Login Seite.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung.
 		5500=Fehler
 		5501=Login nicht m%f6glich. Falscher Name oder Passwort?
 		5502=Lade erste Seite ...
@@ -720,6 +720,7 @@
 		5512=+Caches
 		5513=Laden von:+
 		5514=%0aTravelbug:+ 
+		5515=Fehler beim Laden des Caches.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung.%0aWeiter versuchen?
 		6000=Guid
 		6001=Name
 		6002=Track#

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-20 12:10:46 UTC (rev 1392)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-20 14:22:09 UTC (rev 1393)
@@ -678,7 +678,7 @@
 		4827= (measured in meters per pixel vertically)
 		4828=Coordinate system not supported by Cachewolf: 
 		4829=getUrlForBoundingBox: Point: 
-		4830=No matching Gau?-Kr?ger-Stripe in the EPSG-code list in the .wms
+		4830=No matching Gau%df-Kr%fcger-Stripe in the EPSG-code list in the .wms
 		4831=getMapInfoObject: Coordinate system not supported by Cachewolf: 
 		4900=+is not a german Gauss-Krueger coordinate
 		4920=EPSG code+
@@ -687,7 +687,7 @@
 		4923=fromWgs84: EPSG code+
 		4924=ToWgs84: EPSG code+
 		5498=Login failed. Error loading page after login. 
-		5499=Error loading login page
+		5499=Error loading login page.%0aPlease check your internet connection.
 		5000=Load Cachelist
 		5001=Can't spider additional waypoint directly.%0aPlease check main cache.
 		5002=: At the moment this function is only applicable for geocaching.com and opencaching.de.
@@ -707,6 +707,7 @@
 		5512=+caches
 		5513=Loading:+
 		5514=%0aGetting bug:+
+		5515=Failed to load cache.%0aPlease check your internet connection.%0aRetry?
 		6000=Guid
 		6001=Name
 		6002=track#

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-04-20 12:10:46 UTC (rev 1392)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-04-20 14:22:09 UTC (rev 1393)
@@ -104,11 +104,16 @@
 			pref.log("[login]:Fetching login page");
 			//Access the page once to get a viewstate
 			start = fetch(loginPage);   //http://www.geocaching.com/login/Default.aspx
+			if (start.equals("")) {
+				infB.close(0);
+				(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5499,"Error loading login page.%0aPlease check your internet connection."), FormBase.OKB)).execute();
+				pref.log("[login]:Could not fetch: gc.com login page");
+				return ERR_LOGIN;
+			}
 		} catch(Exception ex){
 			infB.close(0);
-			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5499,"Error loading login page"), FormBase.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5499,"Error loading login page.%0aPlease check your internet connection."), FormBase.OKB)).execute();
 			pref.log("[login]:Could not fetch: gc.com login page",ex);
-			passwort="";
 			return ERR_LOGIN;
 		}
 		if (!infB.isClosed) { // If user has not aborted, we continue
@@ -481,144 +486,170 @@
 	 * @return false if the infoBox was closed
 	 */
 	private boolean getCacheByWaypointName(CacheHolderDetail chD, boolean isUpdate, boolean fetchImages, boolean doNotGetFound, boolean fetchAllLogs) {
-		String completeWebPage;
-		int spiderTrys=0;
-		int MAX_SPIDER_TRYS=3;
-		while (spiderTrys++<MAX_SPIDER_TRYS) {
-			try{
-				String doc = p.getProp("getPageByName") + chD.wayPoint +(fetchAllLogs?p.getProp("fetchAllLogs"):"");
-				pref.log("Fetching: " + chD.wayPoint);
-				completeWebPage = fetch(doc);
-			}catch(Exception ex){
-				pref.log("Could not fetch " + chD.wayPoint,ex);
-				chD.is_incomplete = true;
-				return !infB.isClosed; // Only return false (which terminates the loop over all caches) if infB is closed
-			}
-			// Only analyse the cache data and fetch pictures if user has not closed the progress window
-			if (!infB.isClosed) {
+		boolean canceled = false;
+		while (true) {
+			String completeWebPage;
+			int spiderTrys=0;
+			int MAX_SPIDER_TRYS=3;
+			while (spiderTrys++<MAX_SPIDER_TRYS) {
 				try{
-					chD.is_new = !isUpdate;
-					chD.is_update = false;
-					chD.is_log_update=false;
-					chD.is_HTML = true;
-					chD.is_available = true;
-					chD.is_archived = false;
-					chD.is_incomplete = false;
-					// Save size of logs to be able to check whether any new logs were added
-					//int logsz = chD.CacheLogs.size();
-					//chD.CacheLogs.clear();
-					chD.addiWpts.clear();
-					chD.Images.clear();
-					chD.ImagesText.clear();
-					chD.ImagesInfo.clear();
-	
-					if(completeWebPage.indexOf(p.getProp("cacheUnavailable")) >= 0) chD.is_available = false;
-					if(completeWebPage.indexOf(p.getProp("cacheArchived")) >= 0) chD.is_archived = true;
-					//==========
-					// General Cache Data
-					//==========
-					chD.setLatLon(getLatLon(completeWebPage));
-					pref.log("LatLon: " + chD.LatLon);
-					if (pref.debug) pref.log("chD.pos: " + chD.pos.toString());
-					if (chD.LatLon.equals("???")) {
-						pref.log(">>>> Failed to spider Cache. Retry.");
-						continue; // Restart the spider
+					String doc = p.getProp("getPageByName") + chD.wayPoint +(fetchAllLogs?p.getProp("fetchAllLogs"):"");
+					pref.log("Fetching: " + chD.wayPoint);
+					completeWebPage = fetch(doc);
+					if	( completeWebPage.equals("")) {
+						pref.log("Could not fetch " + chD.wayPoint);
+						if (!infB.isClosed) {
+							continue;
+						} else {
+							chD.is_incomplete = true;
+							return false;
+						}
 					}
-					pref.log("Trying description");
-					chD.setLongDescription(getLongDesc(completeWebPage));
-					pref.log("Got description");
-	
-					pref.log("Getting cache name");
-					chD.CacheName = SafeXML.cleanback(getName(completeWebPage));
-					if (pref.debug) pref.log("Name: " + chD.CacheName); else pref.log("Got name");
-						
-					pref.log("Trying owner");
-					chD.CacheOwner = SafeXML.cleanback(getOwner(completeWebPage)).trim();
-					if(chD.CacheOwner.equals(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equals(pref.myAlias2))) chD.is_owned = true;
-					if (pref.debug) pref.log("Owner: " + chD.CacheOwner +"; is_owned = "+chD.is_owned+";  alias1,2 = ["+pref.myAlias+"|"+pref.myAlias2+"]");
-					else pref.log("Got owner");
+				}catch(Exception ex){
+					pref.log("Could not fetch " + chD.wayPoint,ex);
+					if (!infB.isClosed) {
+						continue;
+					} else {
+						chD.is_incomplete = true;
+						return false;
+					}
+				}
+				// Only analyse the cache data and fetch pictures if user has not closed the progress window
+				if (!infB.isClosed) {
+					try{
+						chD.is_new = !isUpdate;
+						chD.is_update = false;
+						chD.is_log_update=false;
+						chD.is_HTML = true;
+						chD.is_available = true;
+						chD.is_archived = false;
+						chD.is_incomplete = false;
+						// Save size of logs to be able to check whether any new logs were added
+						//int logsz = chD.CacheLogs.size();
+						//chD.CacheLogs.clear();
+						chD.addiWpts.clear();
+						chD.Images.clear();
+						chD.ImagesText.clear();
+						chD.ImagesInfo.clear();
 
-						
-					pref.log("Trying date hidden");
-					chD.DateHidden = DateFormat.MDY2YMD(getDateHidden(completeWebPage));
-					if (pref.debug) pref.log("Hidden: " + chD.DateHidden);
-					else pref.log("Got date hidden");
-					
-					pref.log("Trying hints");
-					chD.setHints(getHints(completeWebPage));
-					if (pref.debug) pref.log("Hints: " + chD.Hints);
-					else pref.log("Got hints");
-					
-					pref.log("Trying size");
-					chD.CacheSize = getSize(completeWebPage);
-					if (pref.debug) pref.log("Size: " + chD.CacheSize);
-					else pref.log("Got size");
-	
-					pref.log("Trying difficulty");
-					chD.hard = getDiff(completeWebPage);
-					if (pref.debug) pref.log("Hard: " + chD.hard);
-					else pref.log("Got difficulty");
-	
-					pref.log("Trying terrain");
-					chD.terrain = getTerr(completeWebPage);
-					if (pref.debug) pref.log("Terr: " + chD.terrain);
-					else pref.log("Got terrain");
-	
-					pref.log("Trying cache type");
-					chD.type = getType(completeWebPage);
-					if (pref.debug) pref.log("Type: " + chD.type);
-					else pref.log("Got cache type");
-	
-					//==========
-					// Logs
-					//==========
-					pref.log("Trying logs");
-					chD.setCacheLogs(getLogs(completeWebPage, chD));
-					pref.log("Found logs");
-	
-					// If the switch is set to not store found caches and we found the cache => return
-					if (chD.is_found && doNotGetFound) return !infB.isClosed;
-	
-					//==========
-					// Bugs
-					//==========
-					// As there may be several bugs, we check whether the user has aborted
-					if (!infB.isClosed) getBugs(chD,completeWebPage);
-					chD.has_bug = chD.Travelbugs.size()>0;
-	
-					//==========
-					// Images
-					//==========
-					if(fetchImages){
-						pref.log("Trying images");
-						getImages(completeWebPage, chD);
-						pref.log("Got images");
+						if(completeWebPage.indexOf(p.getProp("cacheUnavailable")) >= 0) chD.is_available = false;
+						if(completeWebPage.indexOf(p.getProp("cacheArchived")) >= 0) chD.is_archived = true;
+						//==========
+						// General Cache Data
+						//==========
+						chD.setLatLon(getLatLon(completeWebPage));
+						pref.log("LatLon: " + chD.LatLon);
+						if (pref.debug) pref.log("chD.pos: " + chD.pos.toString());
+						if (chD.LatLon.equals("???")) {
+							pref.log(">>>> Failed to spider Cache. Retry.");
+							continue; // Restart the spider
+						}
+						pref.log("Trying description");
+						chD.setLongDescription(getLongDesc(completeWebPage));
+						pref.log("Got description");
+
+						pref.log("Getting cache name");
+						chD.CacheName = SafeXML.cleanback(getName(completeWebPage));
+						if (pref.debug) pref.log("Name: " + chD.CacheName); else pref.log("Got name");
+
+						pref.log("Trying owner");
+						chD.CacheOwner = SafeXML.cleanback(getOwner(completeWebPage)).trim();
+						if(chD.CacheOwner.equals(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equals(pref.myAlias2))) chD.is_owned = true;
+						if (pref.debug) pref.log("Owner: " + chD.CacheOwner +"; is_owned = "+chD.is_owned+";  alias1,2 = ["+pref.myAlias+"|"+pref.myAlias2+"]");
+						else pref.log("Got owner");
+
+
+						pref.log("Trying date hidden");
+						chD.DateHidden = DateFormat.MDY2YMD(getDateHidden(completeWebPage));
+						if (pref.debug) pref.log("Hidden: " + chD.DateHidden);
+						else pref.log("Got date hidden");
+
+						pref.log("Trying hints");
+						chD.setHints(getHints(completeWebPage));
+						if (pref.debug) pref.log("Hints: " + chD.Hints);
+						else pref.log("Got hints");
+
+						pref.log("Trying size");
+						chD.CacheSize = getSize(completeWebPage);
+						if (pref.debug) pref.log("Size: " + chD.CacheSize);
+						else pref.log("Got size");
+
+						pref.log("Trying difficulty");
+						chD.hard = getDiff(completeWebPage);
+						if (pref.debug) pref.log("Hard: " + chD.hard);
+						else pref.log("Got difficulty");
+
+						pref.log("Trying terrain");
+						chD.terrain = getTerr(completeWebPage);
+						if (pref.debug) pref.log("Terr: " + chD.terrain);
+						else pref.log("Got terrain");
+
+						pref.log("Trying cache type");
+						chD.type = getType(completeWebPage);
+						if (pref.debug) pref.log("Type: " + chD.type);
+						else pref.log("Got cache type");
+
+						//==========
+						// Logs
+						//==========
+						pref.log("Trying logs");
+						chD.setCacheLogs(getLogs(completeWebPage, chD));
+						pref.log("Found logs");
+
+						// If the switch is set to not store found caches and we found the cache => return
+						if (chD.is_found && doNotGetFound) return !infB.isClosed;
+
+						//==========
+						// Bugs
+						//==========
+						// As there may be several bugs, we check whether the user has aborted
+						if (!infB.isClosed) getBugs(chD,completeWebPage);
+						chD.has_bug = chD.Travelbugs.size()>0;
+
+						//==========
+						// Images
+						//==========
+						if(fetchImages){
+							pref.log("Trying images");
+							getImages(completeWebPage, chD);
+							pref.log("Got images");
+						}
+						//==========
+						// Addi waypoints
+						//==========
+
+						pref.log("Getting additional waypoints");
+						getAddWaypoints(completeWebPage, chD.wayPoint, chD.is_found);
+						pref.log("Got additional waypoints");
+
+						//==========
+						// Attributes
+						//==========
+						pref.log("Getting attributes");
+						getAttributes(completeWebPage, chD);
+						pref.log("Got attributes");
+						if (chD.is_new) chD.is_update=false;
+						break;
+					}catch(Exception ex){
+						pref.log("Error reading cache: "+chD.wayPoint);
+						pref.log("Exception in getCacheByWaypointName: ",ex);
 					}
-					//==========
-					// Addi waypoints
-					//==========
-	
-					pref.log("Getting additional waypoints");
-					getAddWaypoints(completeWebPage, chD.wayPoint, chD.is_found);
-					pref.log("Got additional waypoints");
-	
-					//==========
-					// Attributes
-					//==========
-					pref.log("Getting attributes");
-					getAttributes(completeWebPage, chD);
-					pref.log("Got attributes");
-					if (chD.is_new) chD.is_update=false;
+					finally{}
+				} else {
 					break;
-				}catch(Exception ex){
-					pref.log("Error reading cache: "+chD.wayPoint);
-					pref.log("Exception in getCacheByWaypointName: ",ex);
 				}
-				finally{}
+			} // spiderTrys
+			if (spiderTrys>=MAX_SPIDER_TRYS) {
+				pref.log(">>> Failed to spider cache. Number of retrys exhausted.");
+				if ((new MessageBox(MyLocale.getMsg(5500,"Error"),MyLocale.getMsg(5515,"Failed to load cache.%0aPleas check your internet connection.%0aRetry?"),FormBase.DEFOKB|FormBase.NOB)).execute() == FormBase.IDOK ) {
+					continue;						
+				} else {
+					canceled = true;
+				}
 			}
-		} // spiderTrys
-		if (spiderTrys==MAX_SPIDER_TRYS) pref.log(">>> Failed to spider cache. Number of retrys exhausted.");
-		boolean ret=!infB.isClosed; // If the infoBox was closed before getting here, we return false
+			break;
+		}//while(true)
+		boolean ret=!infB.isClosed && !canceled; // If the infoBox was closed before getting here, we return false
 		return ret;
 	} // getCacheByWaypointName
 



From pfeffer at mail.berlios.de  Sun Apr 20 19:26:45 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 20 Apr 2008 19:26:45 +0200
Subject: [Cachewolf-svn] r1394 - trunk/src/CacheWolf
Message-ID: <200804201726.m3KHQjxQ021414@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-20 19:26:43 +0200 (Sun, 20 Apr 2008)
New Revision: 1394

Modified:
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MainTab.java
Log:
MainMenu: removed MenuItem "save and exit" and automatically save any changes when exiting

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2008-04-20 14:22:09 UTC (rev 1393)
+++ trunk/src/CacheWolf/MainForm.java	2008-04-20 17:26:43 UTC (rev 1394)
@@ -115,7 +115,7 @@
 		}
 		*/
 		mMenu.setTablePanel(mTab.getTablePanel());
-		infB.close(0);
+		if (infB != null) infB.close(0);
 		mTab.tbP.selectFirstRow();
 		//mTab.tbP.tc.paintSelection();
 		Vm.showWait(false);

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-20 14:22:09 UTC (rev 1393)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-20 17:26:43 UTC (rev 1394)
@@ -23,7 +23,7 @@
  *     20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
  */
 public class MainMenu extends MenuBar {
-	private MenuItem profiles, preferences, mnuContext,loadcaches,loadOC,savenexit,savenoxit,exit,search,searchAll,searchClr;
+	private MenuItem profiles, preferences, mnuContext,loadcaches,loadOC, /* savenexit, */ savenoxit,exit,search,searchAll,searchClr;
 	private MenuItem downloadmap, kalibmap, importmap;
 	private MenuItem spider, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
@@ -99,7 +99,7 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Application" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem [] appMenuItems=new MenuItem[12];
+		MenuItem [] appMenuItems=new MenuItem[11];
 		appMenuItems[0] = profiles 	 = new MenuItem(MyLocale.getMsg(121,"Profile"), 0, profileMenu); 
 		appMenuItems[1] = preferences = new MenuItem(MyLocale.getMsg(108,"Preferences")); 
 		appMenuItems[2] = mnuEditCenter = new MenuItem(MyLocale.getMsg(1110,"Centre"));
@@ -110,8 +110,8 @@
 		appMenuItems[7] = new MenuItem(MyLocale.getMsg(149,"Maps"),0,mapsMenu);
 		appMenuItems[8] = mnuSeparator;
 		appMenuItems[9] = savenoxit = new MenuItem(MyLocale.getMsg(127,"Save")); 
-		appMenuItems[10] = savenexit = new MenuItem(MyLocale.getMsg(110,"Save & Exit")); 
-		appMenuItems[11] = exit = new MenuItem(MyLocale.getMsg(111,"Exit"));
+		//appMenuItems[10] = savenexit = new MenuItem(MyLocale.getMsg(110,"Save & Exit")); 
+		appMenuItems[10] = exit = new MenuItem(MyLocale.getMsg(111,"Exit"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(120,"Application"),new Menu(appMenuItems,null)));
 
 		///////////////////////////////////////////////////////////////////////
@@ -436,16 +436,15 @@
 				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 				tbp.saveColWidth(pref);
 			}
-
+/*
 			if(mev.selectedItem == savenexit){
 				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 				tbp.saveColWidth(pref);
 				ewe.sys.Vm.exit(0);
 			}
+*/
 			if(mev.selectedItem == exit){
 				Global.mainTab.saveUnsavedChanges(true);
-				CacheHolder.saveAllModifiedDetails();
-				tbp.saveColWidth(pref);
 				ewe.sys.Vm.exit(0);
 			}
 

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-04-20 14:22:09 UTC (rev 1393)
+++ trunk/src/CacheWolf/MainTab.java	2008-04-20 17:26:43 UTC (rev 1394)
@@ -377,7 +377,7 @@
 					Global.getPref().log("Error starting mavoing map (1): " + e.getMessage(), e, true);
 					(new MessageBox("Error", "This must not happen please report to pfeffer how to produce this error message", FormBase.OKB)).execute(); } 
 			}
-		} catch (Exception e) { 
+		} catch (Exception e) { // TODO swith waiting indication clock off
 			Global.getPref().log("Error starting moving map (2): " + e.getMessage(), e, true);
 			(new MessageBox("Error", "Error starting moving map: " + e.getMessage(), FormBase.OKB)).execute(); }
 	}
@@ -391,7 +391,7 @@
 	
 	/** Save the index file
 	 * 
-	 * @param askForConfirmation If true, the save can be cancelled by user
+	 * @param askForConfirmation is ignored, old: If true, the save can be cancelled by user
 	 */
 	public void saveUnsavedChanges(boolean askForConfirmation) {
 		if (oldCard!=0) {
@@ -399,15 +399,9 @@
 			onEnteringPanel(0);
 			oldCard=0;
 		}
-		boolean saveIndex=!askForConfirmation; // Definitely save it if no confirmation needed
 		updatePendingChanges();
-		if (askForConfirmation) { // Don't know whether to save, have to ask
-			if (profile.hasUnsavedChanges &&     // Only ask if there were changes 
-					(new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1207,"Your profile has unsaved changes. Do you want to save?"),FormBase.DEFOKB|FormBase.NOB)).execute()==FormBase.IDOK) {
-				saveIndex=true; 
-			}
-		}
-		if (saveIndex) profile.saveIndex(Global.getPref(),false);
+		if (profile.hasUnsavedChanges) profile.saveIndex(Global.getPref(),true);
+	    this.tbP.saveColWidth(pref);
 		Global.getPref().savePreferences();
 	}
 	



From engywuck at mail.berlios.de  Sun Apr 20 20:19:23 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 20 Apr 2008 20:19:23 +0200
Subject: [Cachewolf-svn] r1395 - trunk/src/CacheWolf
Message-ID: <200804201819.m3KIJNrN027354@sheep.berlios.de>

Author: engywuck
Date: 2008-04-20 20:19:21 +0200 (Sun, 20 Apr 2008)
New Revision: 1395

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
Log:
Now change of font size in Cache Description doesn't loose images anymore. (http://www.geoclub.de/viewtopic.php?f=40&t=23983)

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-04-20 17:26:43 UTC (rev 1394)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-04-20 18:19:21 UTC (rev 1395)
@@ -142,6 +142,7 @@
 		disp.setPlainText("loading ...");
 	}
 	
+	// Probably not needed anymore (Change in Rev. 1395)
 	private void redraw() {
 		int currLine;
 
@@ -164,7 +165,7 @@
 				currFont = currFont.changeNameAndSize(null, currFont.getSize() + 2);
 				disp.setFont(currFont);
 				disp.displayPropertiesChanged();
-				redraw();
+				//redraw();
 			}
 
 			if (ev.target == btnMinus){
@@ -172,7 +173,7 @@
 				currFont = currFont.changeNameAndSize(null, currFont.getSize() - 2);
 				disp.setFont(currFont);
 				disp.displayPropertiesChanged();
-				redraw();
+				//redraw();
 			}
 		}
 		super.onEvent(ev);



From engywuck at mail.berlios.de  Sun Apr 20 21:21:50 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 20 Apr 2008 21:21:50 +0200
Subject: [Cachewolf-svn] r1396 - trunk/src/CacheWolf
Message-ID: <200804201921.m3KJLood000859@sheep.berlios.de>

Author: engywuck
Date: 2008-04-20 21:21:48 +0200 (Sun, 20 Apr 2008)
New Revision: 1396

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
Log:
Formatting unreadable method DescriptionPanel.setText do regain readability.

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-04-20 18:19:21 UTC (rev 1395)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-04-20 19:21:48 UTC (rev 1396)
@@ -32,91 +32,95 @@
 	}
 	
 	/**
-	*	Set the text to display. Text should be HTML formated.
-	*/
-	//String description = null;
-	public void setText(CacheHolderDetail cache){
-		boolean isHtml;
-		//if (currCache == cache) return;
-		int scrollto = 0;
-		if (cache == null) {
-			desc = "";
-			isHtml = false;
-		}
-		else {
-			if (cache.hasSameMainCache(currCache)) scrollto = disp.getTopLine();
-			isHtml=cache.is_HTML;
-			if (cache.isAddiWpt()) {
-				CacheHolderDetail mainCache=cache.mainCache.getCacheDetails(true);
-				isHtml=mainCache.is_HTML;
-				if (cache.LongDescription != null && cache.LongDescription.length() > 0)
-					 desc = cache.LongDescription + (isHtml?"<hr>\n":"\n")+mainCache.LongDescription;
-				else 
-					desc = mainCache.LongDescription;
-			} else // not an addi-wpt
-				desc = cache.LongDescription;
-		}
-		//if (!desc.equals(description)) {
-			//disp.getDecoderProperties().setBoolean("allowImages",true);
-			Vm.showWait(true); 
-			if (isHtml) {
-				int imageNo=0;
-				if (Global.getPref().descShowImg) {
-					Vector Images;
-					if (cache.isAddiWpt()) {
-						Images = cache.mainCache.getCacheDetails(true).Images;
-					} else {
-						Images = cache.Images;						
-					}					
-					StringBuffer s=new StringBuffer(desc.length()+Images.size()*100);
-					int start=0;
-					int pos;
-					Regex imgRex = new Regex("src=(?:\\s*[^\"|']*?)(?:\"|')(.*?)(?:\"|')");
-					if (Images.getCount() > 0) {
-						while (start>=0 && (pos=desc.indexOf("<img",start))>0) {
-							s.append(desc.substring(start,pos));
-							imgRex.searchFrom(desc,pos);
-							String imgUrl=imgRex.stringMatched(1);
-							//Vm.debug("imgUrl "+imgUrl);
-							if (imgUrl.lastIndexOf('.')>0 && imgUrl.toLowerCase().startsWith("http")) {
-								String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
-								// If we have an image which we stored when spidering, we can display it
-								if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
-									s.append("<img src=\""+
-											//Global.getProfile().dataDir+
-											Images.get(imageNo)+"\">");
-									imageNo++;
-								}
-							}
-							start=desc.indexOf(">",pos);
-							if (start>=0) start++;
-							if (imageNo >= Images.getCount())break;
-						}
-					}
-					if (start>=0) s.append(desc.substring(start));
-					desc=s.toString();
-				}
-				if (cache.hasImageInfo()) {
-					desc+=getPicDesc(imageNo,cache);
-				}
-				//disp.setHtml(desc);
-				disp.startHtml();
-				disp.getDecoderProperties().set("documentroot",Global.getProfile().dataDir);
-				disp.addHtml(desc,new ewe.sys.Handle());
-				disp.endHtml();
-				
-			}
-			else {
-				disp.startHtml(); // To clear the old HTML display
-				disp.endHtml();
-				disp.setPlainText(desc);
-			}
-			disp.scrollTo(scrollto,false);
-			//description = desc;
-			Vm.showWait(false);
-		//}
-		currCache = cache;
-	}
+         * Set the text to display. Text should be HTML formated.
+         */
+    // String description = null;
+    public void setText(CacheHolderDetail cache) {
+        boolean isHtml;
+        // if (currCache == cache) return;
+        int scrollto = 0;
+        if (cache == null) {
+            desc = "";
+            isHtml = false;
+        } else {
+            if (cache.hasSameMainCache(currCache))
+                scrollto = disp.getTopLine();
+            isHtml = cache.is_HTML;
+            if (cache.isAddiWpt()) {
+                CacheHolderDetail mainCache = cache.mainCache.getCacheDetails(true);
+                isHtml = mainCache.is_HTML;
+                if (cache.LongDescription != null && cache.LongDescription.length() > 0)
+                    desc = cache.LongDescription + (isHtml ? "<hr>\n" : "\n")
+                            + mainCache.LongDescription;
+                else
+                    desc = mainCache.LongDescription;
+            } else
+                // not an addi-wpt
+                desc = cache.LongDescription;
+        }
+        Vm.showWait(true);
+        if (isHtml) {
+            int imageNo = 0;
+            if (Global.getPref().descShowImg) {
+                Vector Images;
+                if (cache.isAddiWpt()) {
+                    Images = cache.mainCache.getCacheDetails(true).Images;
+                } else {
+                    Images = cache.Images;
+                }
+                StringBuffer s = new StringBuffer(desc.length() + Images.size() * 100);
+                int start = 0;
+                int pos;
+                Regex imgRex = new Regex("src=(?:\\s*[^\"|']*?)(?:\"|')(.*?)(?:\"|')");
+                if (Images.getCount() > 0) {
+                    while (start >= 0 && (pos = desc.indexOf("<img", start)) > 0) {
+                        s.append(desc.substring(start, pos));
+                        imgRex.searchFrom(desc, pos);
+                        String imgUrl = imgRex.stringMatched(1);
+                        // Vm.debug("imgUrl "+imgUrl);
+                        if (imgUrl.lastIndexOf('.') > 0 && imgUrl.toLowerCase().startsWith("http")) {
+                            String imgType = (imgUrl.substring(imgUrl.lastIndexOf("."))
+                                    .toLowerCase() + "    ").substring(0, 4).trim();
+                            // If we have an image which we stored when spidering, we can display it
+                            if (!imgType.startsWith(".com") && !imgType.startsWith(".php")
+                                    && !imgType.startsWith(".exe")) {
+                                s.append("<img src=\"" +
+                                // Global.getProfile().dataDir+
+                                        Images.get(imageNo) + "\">");
+                                imageNo++;
+                            }
+                        }
+                        start = desc.indexOf(">", pos);
+                        if (start >= 0)
+                            start++;
+                        if (imageNo >= Images.getCount())
+                            break;
+                    }
+                }
+                if (start >= 0)
+                    s.append(desc.substring(start));
+                desc = s.toString();
+            }
+            if (cache.hasImageInfo()) {
+                desc += getPicDesc(imageNo, cache);
+            }
+            //disp.setHtml(desc);
+            disp.startHtml();
+            disp.getDecoderProperties().set("documentroot", Global.getProfile().dataDir);
+            disp.addHtml(desc, new ewe.sys.Handle());
+            disp.endHtml();
+
+        } else {
+            disp.startHtml(); // To clear the old HTML display
+            disp.endHtml();
+            disp.setPlainText(desc);
+        }
+        disp.scrollTo(scrollto, false);
+        //description = desc;
+        Vm.showWait(false);
+        //}
+        currCache = cache;
+    }
 	
 	/**
 	 * Get the descriptions for the pictures (if they exist)



From engywuck at mail.berlios.de  Sun Apr 20 21:53:30 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 20 Apr 2008 21:53:30 +0200
Subject: [Cachewolf-svn] r1397 - trunk/src/CacheWolf
Message-ID: <200804201953.m3KJrUu9003035@sheep.berlios.de>

Author: engywuck
Date: 2008-04-20 21:53:29 +0200 (Sun, 20 Apr 2008)
New Revision: 1397

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
Log:
Avoid re-setting Cache description when coming back to description panel and the cache hasn't been changed.

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-04-20 19:21:48 UTC (rev 1396)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-04-20 19:53:29 UTC (rev 1397)
@@ -37,7 +37,7 @@
     // String description = null;
     public void setText(CacheHolderDetail cache) {
         boolean isHtml;
-        // if (currCache == cache) return;
+        if (currCache == cache) return;
         int scrollto = 0;
         if (cache == null) {
             desc = "";
@@ -144,6 +144,7 @@
 	
 	public void clear() {
 		disp.setPlainText("loading ...");
+		currCache = null;
 	}
 	
 	// Probably not needed anymore (Change in Rev. 1395)



From engywuck at mail.berlios.de  Mon Apr 21 17:14:03 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Mon, 21 Apr 2008 17:14:03 +0200
Subject: [Cachewolf-svn] r1398 - trunk/src/CacheWolf
Message-ID: <200804211514.m3LFE3uD021036@sheep.berlios.de>

Author: engywuck
Date: 2008-04-21 17:14:01 +0200 (Mon, 21 Apr 2008)
New Revision: 1398

Modified:
   trunk/src/CacheWolf/HintLogPanel.java
Log:
On opening logs/hints tab, data is only loaded, when we open a new cache. If its the same, don't touch the data. (Fixed like in Rev. 1397 for description tab.)

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2008-04-20 19:53:29 UTC (rev 1397)
+++ trunk/src/CacheWolf/HintLogPanel.java	2008-04-21 15:14:01 UTC (rev 1398)
@@ -22,7 +22,7 @@
  */
 public class HintLogPanel extends CellPanel{
 	int crntLogPosition = 0;
-	CacheHolderDetail cache;
+	CacheHolderDetail currCache;
 	private final int DEFAULT_STRINGBUFFER_SIZE=8000;
 	mTextPad hint = new mTextPad();
 	//mTextPad logs = new mTextPad();
@@ -62,22 +62,24 @@
 	}
 
 	public void setText(CacheHolderDetail cache){
-		this.cache = cache;
-		if(!cache.Hints.equals("null")) 
-			hint.setText(STRreplace.replace(cache.Hints, "<br>", "\n"));
-		else
-			hint.setText("");
-		crntLogPosition = 0;
-		setLogs(0);
-		moreBt.modify(0,ControlConstants.Disabled);
-		prevBt.modify(0,ControlConstants.Disabled);
-//		if (Gui.screenIs(Gui.PDA_SCREEN) && Vm.isMobile()) {
-//		Vm.setSIP(0);
-//		}
-		////Vm.debug("In log: " + cache.CacheLogs);
+	        if (currCache != cache){
+	            this.currCache = cache;
+	            if(!cache.Hints.equals("null")) 
+	                hint.setText(STRreplace.replace(cache.Hints, "<br>", "\n"));
+	            else
+	                hint.setText("");
+	            crntLogPosition = 0;
+	            setLogs(0);
+	            moreBt.modify(0,ControlConstants.Disabled);
+	            prevBt.modify(0,ControlConstants.Disabled);
+	        }
 	}
 
 	public void clear() {
+	    clearOutput();
+	    currCache = null;
+	}
+	private void clearOutput() {
 		if (htmlTxtImage != null) {
 			htmlImagDisp.removeImage(htmlTxtImage);
 			htmlTxtImage.free();		
@@ -87,14 +89,14 @@
 		Vm.showWait(true);
 		StringBuffer dummy = new StringBuffer(DEFAULT_STRINGBUFFER_SIZE);
 		int counter = 0;
-		int nLogs=cache.CacheLogs.size();
+		int nLogs=currCache.CacheLogs.size();
 		int logsPerPage=Global.getPref().logsPerPage;
 		for(int i = crntLogPosition; i<nLogs; i++){
-			dummy.append(cache.CacheLogs.getLog(i).toHtml());
+			dummy.append(currCache.CacheLogs.getLog(i).toHtml());
 			dummy.append("</br>");
 			if(++counter >= logsPerPage) break;
 		}
-		clear();
+		clearOutput();
 		logs.resizeTo(width, 50);
 		// The cache GCP0T6 crashes the HtmlDisplay
 		// As a temporary fix
@@ -141,14 +143,14 @@
 	 */
 	public void onEvent(Event ev){
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
-			int minLogs = java.lang.Math.min(Global.getPref().logsPerPage, cache.CacheLogs.size());
+			int minLogs = java.lang.Math.min(Global.getPref().logsPerPage, currCache.CacheLogs.size());
 			if(ev.target == moreBt){
 				prevBt.modify(0,ControlConstants.Disabled);
 				prevBt.repaintNow();
 				crntLogPosition += minLogs;
-				if(crntLogPosition >= cache.CacheLogs.size()) {
+				if(crntLogPosition >= currCache.CacheLogs.size()) {
 					//crntLogPosition = cache.CacheLogs.size()-5;
-					crntLogPosition = cache.CacheLogs.size()- minLogs;
+					crntLogPosition = currCache.CacheLogs.size()- minLogs;
 					moreBt.modify(ControlConstants.Disabled,0);
 					moreBt.repaintNow();
 				}



From engywuck at mail.berlios.de  Mon Apr 21 18:59:23 2008
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Mon, 21 Apr 2008 18:59:23 +0200
Subject: [Cachewolf-svn] r1399 - trunk/src/CacheWolf
Message-ID: <200804211659.m3LGxNfm007648@sheep.berlios.de>

Author: engywuck
Date: 2008-04-21 18:59:19 +0200 (Mon, 21 Apr 2008)
New Revision: 1399

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Setting Found Date by Date dialog sets flag that index save is needed.

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-04-21 15:14:01 UTC (rev 1398)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-04-21 16:59:19 UTC (rev 1399)
@@ -436,6 +436,7 @@
 				if (dc.execute()==ewe.ui.FormBase.IDOK) {
 				  chcStatus.setText(MyLocale.getMsg(318,"Found")+" "+Convert.toString(dc.year)+"-"+MyLocale.formatLong(dc.month,"00")+"-"+MyLocale.formatLong(dc.day,"00")+" "+dc.time);
 				  dirty_details=true;
+				  profile.hasUnsavedChanges=true;
 				}
 			}
 			else if (ev.target==btnHiddenDate) {
@@ -455,6 +456,7 @@
 				if (dc.execute()==ewe.ui.FormBase.IDOK) {
 				  inpHidden.setText(Convert.toString(dc.year)+"-"+MyLocale.formatLong(dc.month,"00")+"-"+MyLocale.formatLong(dc.day,"00"));
 				  dirty_details=true;
+				  profile.hasUnsavedChanges=true;
 				}
 			}
 			ev.consumed=true;



From pfeffer at mail.berlios.de  Mon Apr 21 20:43:47 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 21 Apr 2008 20:43:47 +0200
Subject: [Cachewolf-svn] r1400 - in trunk: . src/CacheWolf
Message-ID: <200804211843.m3LIhlAG013782@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-21 20:43:45 +0200 (Mon, 21 Apr 2008)
New Revision: 1400

Modified:
   trunk/currentversions.txt
   trunk/src/CacheWolf/Version.java
Log:
last commit before Release (Candidate): change currentversions.txt and Version.java

Modified: trunk/currentversions.txt
===================================================================
--- trunk/currentversions.txt	2008-04-21 16:59:19 UTC (rev 1399)
+++ trunk/currentversions.txt	2008-04-21 18:43:45 UTC (rev 1400)
@@ -4,9 +4,9 @@
 T0Revision: 0
 
 # ReleaseCandidate
-T1VersionMajor: 0
-T1VersionMinor: 9
-T1SvnRevision: 800
+T1VersionMajor: 1
+T1VersionMinor: 0
+T1SvnRevision: 1400
 
 # InDevelopmentStable
 T2VersionMajor: 0

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2008-04-21 16:59:19 UTC (rev 1399)
+++ trunk/src/CacheWolf/Version.java	2008-04-21 18:43:45 UTC (rev 1400)
@@ -12,11 +12,11 @@
  */
 
 public class Version {
-	static final int VER_MAJOR = 0;
-	static final int VER_MINOR = 9;
+	static final int VER_MAJOR = 1;
+	static final int VER_MINOR = 0;
 	static final String VER_SVN ="$LastChangedRevision$"; // the number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	static final int SVN_REVISION = Common.parseInt(VER_SVN.substring(VER_SVN.indexOf(" ")+1, VER_SVN.lastIndexOf(" ")));
-	static final int VERSION_TYPE = 3;
+	static final int VERSION_TYPE = 1;
 	public static final String[] VERSION_TYPES = {
 		"Release", 
 		"ReleaseCandidate",



From mik77 at mail.berlios.de  Wed Apr 23 19:11:04 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 23 Apr 2008 19:11:04 +0200
Subject: [Cachewolf-svn] r1401 - trunk/src/CacheWolf/navi
Message-ID: <200804231711.m3NHB4GZ016511@sheep.berlios.de>

Author: mik77
Date: 2008-04-23 19:11:01 +0200 (Wed, 23 Apr 2008)
New Revision: 1401

Modified:
   trunk/src/CacheWolf/navi/GotoPanel.java
Log:
Adjust font size in compass rose only by screen width (for 240x240 screens)

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2008-04-21 18:43:45 UTC (rev 1400)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2008-04-23 17:11:01 UTC (rev 1401)
@@ -509,7 +509,7 @@
 		g.setColor(Color.White);
 		g.fillRect(0, 0, location.width, location.height);
 
-		int fontSize = java.lang.Math.min(location.width, location.height) / 15;
+		int fontSize = location.width / 17;
 		mainFont = new Font("Verdana", Font.BOLD, fontSize);
 		g.setFont(mainFont);
 		fm = g.getFontMetrics(mainFont);



From mik77 at mail.berlios.de  Wed Apr 23 22:48:38 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 23 Apr 2008 22:48:38 +0200
Subject: [Cachewolf-svn] r1402 - trunk/src/CacheWolf/navi
Message-ID: <200804232048.m3NKmcKa006187@sheep.berlios.de>

Author: mik77
Date: 2008-04-23 22:48:35 +0200 (Wed, 23 Apr 2008)
New Revision: 1402

Modified:
   trunk/src/CacheWolf/navi/CWGPSPoint.java
Log:
Remove line, which slipped in by c&p error

Modified: trunk/src/CacheWolf/navi/CWGPSPoint.java
===================================================================
--- trunk/src/CacheWolf/navi/CWGPSPoint.java	2008-04-23 17:11:01 UTC (rev 1401)
+++ trunk/src/CacheWolf/navi/CWGPSPoint.java	2008-04-23 20:48:35 UTC (rev 1402)
@@ -321,7 +321,6 @@
 						case 3: this.numSatsInView = Convert.toInt(currToken); interpreted = true; break;
 						} // switch
 					} // while
-					if (Fix > 0) this.set(latNS, latDeg, latMin, "0", lonEW, lonDeg, lonMin, "0", CWPoint.DMM);
 				} // if
 				
 				//Vm.debug("End of examine");



From pfeffer at mail.berlios.de  Wed Apr 23 23:59:53 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 23 Apr 2008 23:59:53 +0200
Subject: [Cachewolf-svn] r1403 - trunk/src/CacheWolf/navi
Message-ID: <200804232159.m3NLxr7u011229@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-23 23:59:51 +0200 (Wed, 23 Apr 2008)
New Revision: 1403

Modified:
   trunk/src/CacheWolf/navi/CWGPSPoint.java
Log:
GPS interpreter: Bug fixed: don't beleave the GPSr if it indicates a fix but doesn't provide lat/lon correctly -> indicate no fix to higher API

Modified: trunk/src/CacheWolf/navi/CWGPSPoint.java
===================================================================
--- trunk/src/CacheWolf/navi/CWGPSPoint.java	2008-04-23 20:48:35 UTC (rev 1402)
+++ trunk/src/CacheWolf/navi/CWGPSPoint.java	2008-04-23 21:59:51 UTC (rev 1403)
@@ -69,6 +69,9 @@
 		return this.Time;
 	}
 
+	/**
+	 * @return > 0: fixed <br> 0: not fixed <br> -1: no data from serial port <br> -2 data from serial port could not be interpreted
+	 */
 	public int getFix(){
 		return this.Fix;
 	}
@@ -214,23 +217,35 @@
 					//Vm.debug("In $GPGGA");
 					i = 0;
 					while(ex.endOfSearch() != true){
+						boolean latlonerror = false; // indicate that some error occured in the data -> in this case frace fix to non-fixed in order to avoid invalid coordinates when a fix is indicated to the higher level API
 						currToken = ex.findNext();
 						i++;
-						if (currToken.length()==0) continue; // sometimes there are 2 colons directly one after the other like ",," (e.g. loox)
+						if (currToken.length()==0) {
+							if (i >= 2 && i <= 5) latlonerror = true; // force non-fix if lat-lon not contained
+							continue; // sometimes there are 2 colons directly one after the other like ",," (e.g. loox)
+						}
 						switch (i){
 						case 1: this.Time = currToken; break;
-						case 2: try {latDeg = currToken.substring(0,2); interpreted = true;} catch (IndexOutOfBoundsException e) {}
-						try {latMin = currToken.substring(2,currToken.length()); interpreted = true;} catch (IndexOutOfBoundsException e) {}
+						case 2: try {latDeg = currToken.substring(0,2); interpreted = true;} catch (IndexOutOfBoundsException e) {latlonerror = true;}
+						try {latMin = currToken.substring(2,currToken.length()); interpreted = true;} catch (IndexOutOfBoundsException e) {latlonerror = true;}
 						break;
 						case 3: latNS = currToken;
 						break;
 
-						case 4: try {lonDeg = currToken.substring(0,3); interpreted = true;} catch (IndexOutOfBoundsException e) {}
-						try {lonMin = currToken.substring(3,currToken.length()); interpreted = true; } catch (IndexOutOfBoundsException e) {}
+						case 4: try {lonDeg = currToken.substring(0,3); interpreted = true;} catch (IndexOutOfBoundsException e) {latlonerror = true;}
+						try {lonMin = currToken.substring(3,currToken.length()); interpreted = true; } catch (IndexOutOfBoundsException e) {latlonerror = true;}
 						break;
 						case 5: lonEW = currToken;
 						break;
-						case 6: this.Fix = Convert.toInt(currToken); interpreted = true; break;
+						case 6: 
+							if (!latlonerror) {
+								this.Fix = Convert.toInt(currToken); 
+								interpreted = true; 
+								break;
+							} else {
+								this.Fix = 0; 
+								break;
+							}
 						case 7: this.numSat = Convert.toInt(currToken); interpreted = true; break;
 						case 8: try {this.HDOP = Common.parseDouble(currToken); interpreted = true; } catch (NumberFormatException e) {} break;
 						case 9: try {this.Alt = Common.parseDouble(currToken); interpreted = true; } catch (NumberFormatException e) {} break;
@@ -260,9 +275,14 @@
 					//Vm.debug("In $GPRMC");
 					i = 0;
 					String status = "V";
+					boolean latlonerror = false;
 					while(ex.endOfSearch() != true){
 						currToken = ex.findNext();
 						i++;
+						if (currToken.length()==0) {
+							if (i >= 2 && i <= 6) latlonerror = true; // force non-fix if lat-lon not contained
+							continue; // sometimes there are 2 colons directly one after the other like ",," (e.g. loox)
+						}
 						if (currToken.length()==0) continue;
 						//Vm.debug("zz: " + i);
 						//Vm.debug(currToken);
@@ -274,9 +294,9 @@
 						interpreted = true;
 						break;
 						case 3: 	//Vm.debug("Here--->");
-							try {latDeg = currToken.substring(0,2); interpreted = true;} catch (IndexOutOfBoundsException e) {}
+							try {latDeg = currToken.substring(0,2); interpreted = true;} catch (IndexOutOfBoundsException e) {latlonerror = true;}
 							//Vm.debug(":" + latDeg);
-							try {latMin = currToken.substring(2,currToken.length()); interpreted = true;} catch (IndexOutOfBoundsException e) {}
+							try {latMin = currToken.substring(2,currToken.length()); interpreted = true;} catch (IndexOutOfBoundsException e) {latlonerror = true;}
 							//Vm.debug(":" + latMin);
 							break;
 						case 4: latNS = currToken; interpreted = true;
@@ -304,9 +324,12 @@
 						break;
 						} // switch
 					} // while
-					if (status.equals("A")){
-						this.set(latNS, latDeg, latMin, "0",
-								lonEW, lonDeg, lonMin, "0", CWPoint.DMM);				
+					if (latlonerror) this.Fix = 0;
+					else {
+						if (status.equals("A")){
+							this.set(latNS, latDeg, latMin, "0",
+									lonEW, lonDeg, lonMin, "0", CWPoint.DMM);				
+						}
 					}
 				} // if
 



From mik77 at mail.berlios.de  Thu Apr 24 00:19:46 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 24 Apr 2008 00:19:46 +0200
Subject: [Cachewolf-svn] r1404 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804232219.m3NMJk9k013067@sheep.berlios.de>

Author: mik77
Date: 2008-04-24 00:19:42 +0200 (Thu, 24 Apr 2008)
New Revision: 1404

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Allow skipping of caches, if there is an error while spidering. Automatically skip cache, if cache page could be loaded but not interpreted.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-23 21:59:51 UTC (rev 1403)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-23 22:19:42 UTC (rev 1404)
@@ -720,7 +720,8 @@
 		5512=+Caches
 		5513=Laden von:+
 		5514=%0aTravelbug:+ 
-		5515=Fehler beim Laden des Caches.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung.%0aWeiter versuchen?
+		5515=Fehler beim Laden des Caches.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung.%0aNoch einmal versuchen?
+		5516=+Cachebeschreibungen%0akonnten nicht geladen werden.
 		6000=Guid
 		6001=Name
 		6002=Track#

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-23 21:59:51 UTC (rev 1403)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-23 22:19:42 UTC (rev 1404)
@@ -708,6 +708,7 @@
 		5513=Loading:+
 		5514=%0aGetting bug:+
 		5515=Failed to load cache.%0aPlease check your internet connection.%0aRetry?
+		5516=+cache descriptions%0acould not be loaded.
 		6000=Guid
 		6001=Name
 		6002=track#

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-23 21:59:51 UTC (rev 1403)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-23 22:19:42 UTC (rev 1404)
@@ -624,7 +624,6 @@
 		Vm.showWait(true);
 		boolean alreadySaid = false;
 		boolean alreadySaid2 = false;
-		boolean test = true;
 		InfoBox infB = new InfoBox("Info", "Loading", InfoBox.PROGRESS_WITH_WARNINGS);
 		infB.exec();
 		
@@ -656,21 +655,31 @@
 			}
 		}
 
+		int spiderErrors = 0;
 		for(int j = 0; j <	cachesToUpdate.size(); j++){
 			int i = ((Integer)cachesToUpdate.get(j)).intValue();
 			ch = (CacheHolder)cacheDB.get(i);
 //			infB.setInfo("Loading: " + ch.wayPoint);
 			infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + ch.wayPoint +" (" + (j+1) + " / " + cachesToUpdate.size() + ")");
 			infB.redisplay();
-			if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))   
-				test = spider.spiderSingle(i, infB);
-			else  
-				test = ocSync.syncSingle(i, infB);
-			if (!test) {
-				infB.close(0);
-				break;
-			} else 
-				profile.hasUnsavedChanges=true;	
+			if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")) {
+				int test = spider.spiderSingle(i, infB);
+				if (test == -1) {
+					infB.close(0);
+					break;
+				} else if (test == 0) {
+					spiderErrors++;
+				} else {
+					profile.hasUnsavedChanges=true;	
+				}
+			}
+			else {
+				if (!ocSync.syncSingle(i, infB)) {
+					infB.close(0);
+					break;
+				} else 
+					profile.hasUnsavedChanges=true;	
+			}
 
 //			cacheDB.clear();
 //			profile.readIndex();
@@ -682,7 +691,9 @@
 		profile.updateBearingDistance();
 		tbp.refreshTable();
 		Vm.showWait(false);
-		
+		if ( spiderErrors > 0) {
+			new MessageBox(MyLocale.getMsg(5500,"Error"),spiderErrors + MyLocale.getMsg(5516," cache descriptions%0acould not be loaded."),FormBase.DEFOKB).execute();
+		}		
 	}
 	
 }

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-04-23 21:59:51 UTC (rev 1403)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-04-23 22:19:42 UTC (rev 1404)
@@ -205,17 +205,17 @@
 	/**
 	 * Method to spider a single cache.
 	 * It assumes a login has already been performed!
-	 * @return True if spider was successful, false if spider was cancelled by closing the infobox
+	 * @return 1 if spider was successful, -1 if spider was cancelled by closing the infobox, 0 error, but continue with next cache
 	 */
-	public boolean spiderSingle(int number, InfoBox infB){
-		boolean ret=false;
+	public int spiderSingle(int number, InfoBox infB){
+		int ret=-1;
 		this.infB = infB;
 		CacheHolder ch = (CacheHolder)cacheDB.get(number);
-		if (ch.isAddiWpt()) return false;  // No point re-spidering an addi waypoint, comes with parent
+		if (ch.isAddiWpt()) return -1;  // No point re-spidering an addi waypoint, comes with parent
 
 		// check if we need to login
 		if (!loggedIn){
-			if (this.login()!=FormBase.IDOK) return false;
+			if (this.login()!=FormBase.IDOK) return -1;
 			// loggedIn is already set by this.login()
 		}
 		CacheHolderDetail chD=ch.getCacheDetails(true); //new CacheHolderDetail(ch);
@@ -230,7 +230,7 @@
 			boolean loadAllLogs = (MAXLOGS > 5);
 			ret=getCacheByWaypointName(chD,true,true,false,loadAllLogs);
 			// Save the spidered data
-			if (ret) {
+			if (ret == 1) {
 				pref.log("Saving to:" + profile.dataDir);
 				chD.saveCacheDetails(profile.dataDir);
 				((CacheHolder) cacheDB.get(number)).update(chD);
@@ -449,6 +449,7 @@
 		//=======
 		boolean loadAllLogs = (MAXLOGS > 5);
 
+		int spiderErrors = 0;
 		for(int i = 0; i<cachesToLoad.size(); i++){
 			if (infB.isClosed) break;
 
@@ -458,15 +459,24 @@
 				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + wpt +" (" + (i+1) + " / " + cachesToLoad.size() + ")");
 				chD = new CacheHolderDetail();
 				chD.wayPoint=wpt;
-				if (!getCacheByWaypointName(chD,false,getImages,doNotgetFound,loadAllLogs)) break;
-				if (!chD.is_found || !doNotgetFound ) {
-					chD.saveCacheDetails(profile.dataDir);
-					cacheDB.add(new CacheHolder(chD)); 
+				int test = getCacheByWaypointName(chD,false,getImages,doNotgetFound,loadAllLogs);
+				if (test == -1) {
+					break;
+				} else if (test == 0) {
+					spiderErrors++;
+				} else {
+					if (!chD.is_found || !doNotgetFound ) {
+						chD.saveCacheDetails(profile.dataDir);
+						cacheDB.add(new CacheHolder(chD)); 
+					}
 				}
 			}
 		}
 		infB.close(0);
 		Vm.showWait(false);
+		if ( spiderErrors > 0) {
+			new MessageBox(MyLocale.getMsg(5500,"Error"),spiderErrors + MyLocale.getMsg(5516," cache descriptions%0acould not be loaded."),FormBase.DEFOKB).execute();
+		}
 		Global.getProfile().saveIndex(Global.getPref(),true);
 	}
 
@@ -483,15 +493,16 @@
 	 * @param boolean doNotGetFound True if the cache is not to be spidered if it has already been found
 	 * @param boolean fetchAllLogs True if all logs are to be fetched (by adding option '&logs=y' to command line).
 	 *     This is normally false when spidering from GPXImport as the logs are part of the GPX file, and true otherwise
-	 * @return false if the infoBox was closed
+	 * @return -1 if the infoBox was closed (cancel spidering), 0 if there was an error (continue with next cache), 1 if everything ok
 	 */
-	private boolean getCacheByWaypointName(CacheHolderDetail chD, boolean isUpdate, boolean fetchImages, boolean doNotGetFound, boolean fetchAllLogs) {
-		boolean canceled = false;
+	private int getCacheByWaypointName(CacheHolderDetail chD, boolean isUpdate, boolean fetchImages, boolean doNotGetFound, boolean fetchAllLogs) {
+		int ret = 1;
 		while (true) {
 			String completeWebPage;
 			int spiderTrys=0;
 			int MAX_SPIDER_TRYS=3;
 			while (spiderTrys++<MAX_SPIDER_TRYS) {
+				ret = 1;
 				try{
 					String doc = p.getProp("getPageByName") + chD.wayPoint +(fetchAllLogs?p.getProp("fetchAllLogs"):"");
 					pref.log("Fetching: " + chD.wayPoint);
@@ -502,7 +513,7 @@
 							continue;
 						} else {
 							chD.is_incomplete = true;
-							return false;
+							return -1;
 						}
 					}
 				}catch(Exception ex){
@@ -511,7 +522,7 @@
 						continue;
 					} else {
 						chD.is_incomplete = true;
-						return false;
+						return -1;
 					}
 				}
 				// Only analyse the cache data and fetch pictures if user has not closed the progress window
@@ -523,7 +534,7 @@
 						chD.is_HTML = true;
 						chD.is_available = true;
 						chD.is_archived = false;
-						chD.is_incomplete = false;
+						chD.is_incomplete = true;
 						// Save size of logs to be able to check whether any new logs were added
 						//int logsz = chD.CacheLogs.size();
 						//chD.CacheLogs.clear();
@@ -542,6 +553,7 @@
 						if (pref.debug) pref.log("chD.pos: " + chD.pos.toString());
 						if (chD.LatLon.equals("???")) {
 							pref.log(">>>> Failed to spider Cache. Retry.");
+							ret = 0;
 							continue; // Restart the spider
 						}
 						pref.log("Trying description");
@@ -597,7 +609,13 @@
 						pref.log("Found logs");
 
 						// If the switch is set to not store found caches and we found the cache => return
-						if (chD.is_found && doNotGetFound) return !infB.isClosed;
+						if (chD.is_found && doNotGetFound) {
+							if (infB.isClosed) {
+								return -1;
+							} else {
+								return 1;
+							}
+						}
 
 						//==========
 						// Bugs
@@ -629,6 +647,7 @@
 						getAttributes(completeWebPage, chD);
 						pref.log("Got attributes");
 						if (chD.is_new) chD.is_update=false;
+						chD.is_incomplete = false;
 						break;
 					}catch(Exception ex){
 						pref.log("Error reading cache: "+chD.wayPoint);
@@ -639,17 +658,22 @@
 					break;
 				}
 			} // spiderTrys
-			if (spiderTrys>=MAX_SPIDER_TRYS) {
+			if ( ( spiderTrys >= MAX_SPIDER_TRYS ) && ( ret == 1 ) ) {
 				pref.log(">>> Failed to spider cache. Number of retrys exhausted.");
-				if ((new MessageBox(MyLocale.getMsg(5500,"Error"),MyLocale.getMsg(5515,"Failed to load cache.%0aPleas check your internet connection.%0aRetry?"),FormBase.DEFOKB|FormBase.NOB)).execute() == FormBase.IDOK ) {
+				int decision = (new MessageBox(MyLocale.getMsg(5500,"Error"),MyLocale.getMsg(5515,"Failed to load cache.%0aPleas check your internet connection.%0aRetry?"),FormBase.DEFOKB|FormBase.NOB|FormBase.CANCELB)).execute();
+				if ( decision == FormBase.IDOK ) {
 					continue;						
+				} else if ( decision == FormBase.IDNO ){
+					ret = 0;
 				} else {
-					canceled = true;
+					ret = -1;
 				}
 			}
 			break;
 		}//while(true)
-		boolean ret=!infB.isClosed && !canceled; // If the infoBox was closed before getting here, we return false
+		if (infB.isClosed) {// If the infoBox was closed before getting here, we return -1
+			return -1;
+		}
 		return ret;
 	} // getCacheByWaypointName
 



From mik77 at mail.berlios.de  Thu Apr 24 00:44:39 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 24 Apr 2008 00:44:39 +0200
Subject: [Cachewolf-svn] r1405 - trunk/src/CacheWolf
Message-ID: <200804232244.m3NMid53005311@sheep.berlios.de>

Author: mik77
Date: 2008-04-24 00:44:36 +0200 (Thu, 24 Apr 2008)
New Revision: 1405

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/Profile.java
Log:
- refresh list correctly after blacklist-change with disabled filter
- don't deactivate tour filter when disabling search

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-04-23 22:19:42 UTC (rev 1404)
+++ trunk/src/CacheWolf/MainTab.java	2008-04-23 22:44:36 UTC (rev 1405)
@@ -193,7 +193,7 @@
 			updatePendingChanges();
 			if (detP.hasBlackStatusChanged()) {
 				// Restore the filter status (this automatically sets the status for blacklisted caches)
-				Global.getProfile().restoreFilter();
+				Global.getProfile().restoreFilter( true );
 				tbP.refreshTable();
 			}
 			break;
@@ -418,3 +418,4 @@
 
 
 
+

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2008-04-23 22:19:42 UTC (rev 1404)
+++ trunk/src/CacheWolf/Profile.java	2008-04-23 22:44:36 UTC (rev 1405)
@@ -291,6 +291,10 @@
 	 *  The values of Filter.isActive and Filter.isInactive are set by the filter 
 	 **/
 	void restoreFilter() {
+		restoreFilter( false );		
+	}
+	
+	void restoreFilter(boolean clearIfInactive) {
 		boolean inverted=filterInverted; // Save it as doFilter will clear filterInverted
 		Filter flt=new Filter();
 		if (filterActive==Filter.FILTER_ACTIVE) {
@@ -301,7 +305,12 @@
 				filterInverted=true; // Needed because previous line inverts filterInverted
 			}
 		} else if (filterActive==Filter.FILTER_CACHELIST) {
+			Global.mainForm.cacheList.applyCacheList();
 			//flt.filterActive=filterActive;
+		} else if (filterActive==Filter.FILTER_INACTIVE) {
+			if (clearIfInactive) {
+				flt.clearFilter();
+			}
 		}
 	}
 



From mik77 at mail.berlios.de  Thu Apr 24 00:59:44 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 24 Apr 2008 00:59:44 +0200
Subject: [Cachewolf-svn] r1406 - trunk/src/CacheWolf
Message-ID: <200804232259.m3NMxi1o023936@sheep.berlios.de>

Author: mik77
Date: 2008-04-24 00:59:40 +0200 (Thu, 24 Apr 2008)
New Revision: 1406

Modified:
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
Log:
Patch from Pfeffer: set center correctly when creating new profile

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2008-04-23 22:44:36 UTC (rev 1405)
+++ trunk/src/CacheWolf/MainForm.java	2008-04-23 22:59:40 UTC (rev 1406)
@@ -76,7 +76,7 @@
 			pref.curCentrePt.set(profile.centre);
 			profile.updateBearingDistance();
 			profile.restoreFilter();
-			profile.hasUnsavedChanges=false;
+			//profile.hasUnsavedChanges=false;
 			setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 		} catch (Exception e){
 			if(pref.debug == true) Vm.debug("MainForm:: Exception:: " + e.toString());

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-23 22:44:36 UTC (rev 1405)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-23 22:59:40 UTC (rev 1406)
@@ -237,6 +237,7 @@
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == mnuNewProfile){
 				if (NewProfileWizard.startNewProfileWizard(getFrame()) ) {
+					pref.curCentrePt = new CWPoint(profile.centre);
 					Filter.showBlacklisted=false;
 					filtBlack.modifiers&=~MenuItem.Checked;
 					tbp.refreshTable();
@@ -260,7 +261,6 @@
 					Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 					infB.close(0);
 					tbp.resetModel();
-					Global.getProfile().hasUnsavedChanges=false;
 				}
 			}
 			if(mev.selectedItem == mnuEditCenter){

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-04-23 22:44:36 UTC (rev 1405)
+++ trunk/src/CacheWolf/Preferences.java	2008-04-23 22:59:40 UTC (rev 1406)
@@ -543,11 +543,14 @@
 				int code = f.execute();
 				// If no profile chosen (includes a new one), terminate
 				if (code==-1) return false; // Cancel pressed
+				CWPoint savecenter = new CWPoint(prof.centre);
 				prof.clearProfile();
-				curCentrePt.set(0,0); // No centre yet
+				prof.centre = savecenter;
+				prof.hasUnsavedChanges = true;
+				//curCentrePt.set(0,0); // No centre yet
 				lastProfile=f.newSelectedProfile;
 			}
-			profileExists=(new File(baseDir+lastProfile)).exists();
+			profileExists=(new FileBugfix(baseDir+lastProfile)).exists();
 			if (!profileExists) (new MessageBox(MyLocale.getMsg(144,"Warning"),
 					           MyLocale.getMsg(171,"Profile does not exist: ")+lastProfile,FormBase.MBOK)).execute();
 		} while (profileExists==false);

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2008-04-23 22:44:36 UTC (rev 1405)
+++ trunk/src/CacheWolf/Profile.java	2008-04-23 22:59:40 UTC (rev 1406)
@@ -276,6 +276,7 @@
 			//Vm.debug("End  :"+endT.format("H:mm:ss.SSS"));	
 			// Build references between caches and addi wpts
 			buildReferences();
+			hasUnsavedChanges = false;
 		} catch (FileNotFoundException e) {
 			Global.getPref().log("index.xml not found in directory "+dataDir); // Normal when profile is opened for first time
 			//e.printStackTrace();
@@ -283,7 +284,6 @@
 			Global.getPref().log("Problem reading index.xml in dir: "+dataDir,e,true); 
 		}
 		normaliseFilters();
-		hasUnsavedChanges=false;
 	}
 
 	/** Restore the filter to the values stored in this profile 



From mik77 at mail.berlios.de  Thu Apr 24 01:01:13 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 24 Apr 2008 01:01:13 +0200
Subject: [Cachewolf-svn] r1407 - trunk/src/CacheWolf
Message-ID: <200804232301.m3NN1DJ2025396@sheep.berlios.de>

Author: mik77
Date: 2008-04-24 01:01:10 +0200 (Thu, 24 Apr 2008)
New Revision: 1407

Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Update ticked caches back in context menu

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-23 22:59:40 UTC (rev 1406)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-23 23:01:10 UTC (rev 1407)
@@ -321,7 +321,7 @@
 				tbp.resetModel();
 			}
 			if (mev.selectedItem == update) 
-				updateSelectedCaches();
+				updateSelectedCaches(tbp);
 			if(mev.selectedItem == mnuForceLogin) {
 				mnuForceLogin.modifiers^=MenuItem.Checked;
 				Global.getPref().forceLogin=(mnuForceLogin.modifiers&MenuItem.Checked)!=0;
@@ -612,7 +612,7 @@
 		}
 	}
 
-	private void updateSelectedCaches() {
+	public static void updateSelectedCaches(TablePanel tablePanel) {
 		Preferences pref=Global.getPref();
 		Profile profile=Global.getProfile();
 		Vector cacheDB=profile.cacheDB;
@@ -689,7 +689,7 @@
 		profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 		profile.restoreFilter();
 		profile.updateBearingDistance();
-		tbp.refreshTable();
+		tablePanel.refreshTable();
 		Vm.showWait(false);
 		if ( spiderErrors > 0) {
 			new MessageBox(MyLocale.getMsg(5500,"Error"),spiderErrors + MyLocale.getMsg(5516," cache descriptions%0acould not be loaded."),FormBase.DEFOKB).execute();

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-23 22:59:40 UTC (rev 1406)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-23 23:01:10 UTC (rev 1407)
@@ -26,6 +26,7 @@
 			MyLocale.getMsg(1018,"Open in browser offline"),
 			"-",
 			MyLocale.getMsg(1012,"Delete selected"),
+			MyLocale.getMsg(1014,"Update"),
 			"-",
 			MyLocale.getMsg(1015,"Select all"),
 			MyLocale.getMsg(1016,"De-select all")},
@@ -187,6 +188,10 @@
 			}
 			Vm.showWait(false);
 		}
+		
+		if (selectedItem.toString().equals(MyLocale.getMsg(1014,"Update"))){
+			MainMenu.updateSelectedCaches(tbp);
+		}
 
 		if (selectedItem.toString().equals(MyLocale.getMsg(1019,"Centre"))){
 			if (tbp.getSelectedCache() < 0) {



From kappler at mail.berlios.de  Thu Apr 24 07:55:36 2008
From: kappler at mail.berlios.de (kappler at mail.berlios.de)
Date: Thu, 24 Apr 2008 07:55:36 +0200
Subject: [Cachewolf-svn] r1408 - trunk/src/CacheWolf
Message-ID: <200804240555.m3O5ta5P019701@sheep.berlios.de>

Author: kappler
Date: 2008-04-24 07:55:34 +0200 (Thu, 24 Apr 2008)
New Revision: 1408

Modified:
   trunk/src/CacheWolf/Rebuild.java
Log:
Fix bug in rebuilding the cache-index

Modified: trunk/src/CacheWolf/Rebuild.java
===================================================================
--- trunk/src/CacheWolf/Rebuild.java	2008-04-23 23:01:10 UTC (rev 1407)
+++ trunk/src/CacheWolf/Rebuild.java	2008-04-24 05:55:34 UTC (rev 1408)
@@ -26,10 +26,10 @@
 		int orphans=0; // xml Files without entry in database
 		int nAdded=0;  // caches added to database
 		for (i=0; i<xmlFiles.length; i++) {
-			int pos=xmlFiles[i].indexOf('.');
+			int pos=xmlFiles[i].lastIndexOf('.');
 			if (pos<0) continue;
-			String wayPoint=xmlFiles[i].substring(0,pos);
-			if (wayPoint.charAt(0)=='i' || 			// Check for index.xml and index.bak
+			String wayPoint=xmlFiles[i].substring(0,pos).toUpperCase();
+			if (wayPoint.charAt(0)=='I' || 			// Check for index.xml and index.bak
 				prof.getCacheIndex(wayPoint)>=0)		// Check for waypoints already in database 
 				xmlFiles[i]=null;   				// Remove existing caches or index.xml
 			else {



From kappler at mail.berlios.de  Thu Apr 24 14:27:04 2008
From: kappler at mail.berlios.de (kappler at mail.berlios.de)
Date: Thu, 24 Apr 2008 14:27:04 +0200
Subject: [Cachewolf-svn] r1409 - trunk/src/CacheWolf
Message-ID: <200804241227.m3OCR4o0006925@sheep.berlios.de>

Author: kappler
Date: 2008-04-24 14:27:01 +0200 (Thu, 24 Apr 2008)
New Revision: 1409

Modified:
   trunk/src/CacheWolf/Rebuild.java
Log:
Fix another possible bug in rebuilding the cache-index

Modified: trunk/src/CacheWolf/Rebuild.java
===================================================================
--- trunk/src/CacheWolf/Rebuild.java	2008-04-24 05:55:34 UTC (rev 1408)
+++ trunk/src/CacheWolf/Rebuild.java	2008-04-24 12:27:01 UTC (rev 1409)
@@ -29,7 +29,7 @@
 			int pos=xmlFiles[i].lastIndexOf('.');
 			if (pos<0) continue;
 			String wayPoint=xmlFiles[i].substring(0,pos).toUpperCase();
-			if (wayPoint.charAt(0)=='I' || 			// Check for index.xml and index.bak
+			if (wayPoint.equalsIgnoreCase("index") || 			// Check for index.xml and index.bak
 				prof.getCacheIndex(wayPoint)>=0)		// Check for waypoints already in database 
 				xmlFiles[i]=null;   				// Remove existing caches or index.xml
 			else {



From mik77 at mail.berlios.de  Thu Apr 24 22:56:27 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 24 Apr 2008 22:56:27 +0200
Subject: [Cachewolf-svn] r1410 - trunk/res_noewe/languages
Message-ID: <200804242056.m3OKuRtt020426@sheep.berlios.de>

Author: mik77
Date: 2008-04-24 22:56:25 +0200 (Thu, 24 Apr 2008)
New Revision: 1410

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
Log:
Some language changes

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-24 12:27:01 UTC (rev 1409)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-24 20:56:25 UTC (rev 1410)
@@ -15,7 +15,7 @@
 		111=Beenden
 		112=Suchen
 		113=Suche aufheben
-		114=Erstellen
+		114=%c4ndern & Anwenden
 		115=Umkehren
 		116=Aufheben
 		117=%dcber
@@ -60,7 +60,7 @@
 		160=Markierte ausfiltern
 		161=Zeige Blacklist
 		162=Kalibrierte herunterladen
-		170=Basisverzeichnis f%fcr die Profile w%e4hlen
+		170=Datenverzeichnis w%e4hlen
 		171=Profil existiert nicht:+
 		172=Kann das Kartenverzeichnis nicht erstellen:%0a
 		173=GPSBabel:
@@ -160,7 +160,7 @@
 		600=Einstellungen
 		601=Dein Alias:
 		602=Heimatkoordinaten:
-		603=Verzeichnis f%fcr Profile
+		603=Datenverzeichnis
 		604=Suchen
 		605=Tabellenspalten:
 		606=Schwierigkeit
@@ -275,8 +275,8 @@
 		1012=Markierte l%f6schen
 		1013=Auswahl
 		1014=Markierte aktualisieren
-		1015=Alle w%e4hlen
-		1016=Alle abw%e4hlen
+		1015=Alle markieren
+		1016=Alle Markierungen aufheben
 		1017=G
 		1018=Im Browser offline %f6ffnen
 		1019=Diesen als Zentrum setzen

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-24 12:27:01 UTC (rev 1409)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-24 20:56:25 UTC (rev 1410)
@@ -15,7 +15,7 @@
 		111=Exit
 		112=Search
 		113=Clear Search
-		114=Create filter
+		114=Edit & apply filter
 		115=Invert filter
 		116=Clear filter
 		117=About
@@ -35,7 +35,7 @@
 		131=Spider from geocaching.com
 		132=to Explorist
     133=Search all
-    134=Ticked Cache
+    134=Selected Cache
 		139=Manage Travelbugs
 		140=Organise            
 		141=Copy 
@@ -60,7 +60,7 @@
 		160=Filter out ticked
 		161=Show Blacklist
 		162=Download calibrated
-		170=Select base directory for cache data
+		170=Select data directory
 		171=Profile does not exist:+
 		172=Error: cannot create maps directory:%0a
 		173=GPSBabel:
@@ -161,7 +161,7 @@
 		600=Preferences
 		601=Your alias:
 		602=Home coordinates:
-		603=Profile directory
+		603=Data directory
 		604=Search
 		605=Table columns:
 		606=Difficulty



From pfeffer at mail.berlios.de  Fri Apr 25 00:29:41 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 25 Apr 2008 00:29:41 +0200
Subject: [Cachewolf-svn] r1411 - trunk/src/CacheWolf
Message-ID: <200804242229.m3OMTfUI027200@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-25 00:29:40 +0200 (Fri, 25 Apr 2008)
New Revision: 1411

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
data dir selection: Bug fixed: if in the pref.xml a non-existing dir was given, then the dialog could not be used to leave the non existing root dir.

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-04-24 20:56:25 UTC (rev 1410)
+++ trunk/src/CacheWolf/Preferences.java	2008-04-24 22:29:40 UTC (rev 1411)
@@ -526,7 +526,7 @@
 		// If datadir is empty, ask for one
 		if (baseDir.length()==0 || !(new File(baseDir)).exists()) {
 			do {
-				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT,baseDir);
+				FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT,"/");
 				fc.title = MyLocale.getMsg(170,"Select base directory for cache data");
 				// If no base directory given, terminate
 				if (fc.execute() == FormBase.IDCANCEL) ewe.sys.Vm.exit(0);



From mik77 at mail.berlios.de  Fri Apr 25 18:23:55 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 25 Apr 2008 18:23:55 +0200
Subject: [Cachewolf-svn] r1412 - trunk/src/CacheWolf
Message-ID: <200804251623.m3PGNtc4017954@sheep.berlios.de>

Author: mik77
Date: 2008-04-25 18:23:49 +0200 (Fri, 25 Apr 2008)
New Revision: 1412

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
double updating of caches, when selected from Application menu removed.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-04-24 22:29:40 UTC (rev 1411)
+++ trunk/src/CacheWolf/myTableControl.java	2008-04-25 16:23:49 UTC (rev 1412)
@@ -17,35 +17,46 @@
 	public Profile profile;
 	public Vector cacheDB;
 	public TablePanel tbp;
-	private Menu mFull = new Menu(new String[]{
-			MyLocale.getMsg(1021,"Open description"),
-			MyLocale.getMsg(1010,"Goto"),
-			MyLocale.getMsg(1019,"Enter"),
-			"-",
-			MyLocale.getMsg(1020,"Open in $browser online"),
-			MyLocale.getMsg(1018,"Open in browser offline"),
-			"-",
-			MyLocale.getMsg(1012,"Delete selected"),
-			MyLocale.getMsg(1014,"Update"),
-			"-",
-			MyLocale.getMsg(1015,"Select all"),
-			MyLocale.getMsg(1016,"De-select all")},
-			MyLocale.getMsg(1013,"With selection"));
-	private Menu mSmall = new Menu(new String[]{
-			MyLocale.getMsg(1021,"Open description"),
-			MyLocale.getMsg(1010,"Goto"),
-			MyLocale.getMsg(1019,"Enter"),
-			"-",
-			MyLocale.getMsg(1020,"Open in $browser online"),
-			MyLocale.getMsg(1018,"Open in browser offline")},
-			MyLocale.getMsg(1013,"With selection"));
+	
+	private MenuItem miOpen, miGoto, miCenter;
+	private MenuItem miOpenOnline, miOpenOffline;
+	private MenuItem miDelete, miUpdate;
+	private MenuItem miTickAll, miUntickAll;
+	private MenuItem miSeparator;
 
+	private Menu mFull;
+	private Menu mSmall;
+
 	myTableControl(TablePanel tablePanel) {
 		profile=Global.getProfile();
 		cacheDB = profile.cacheDB;
 		pref = Global.getPref();
 		tbp =tablePanel;
 		allowDragSelection = false; // allow only one row to be selected at one time
+				
+		MenuItem[] mnuFull = new MenuItem[12];
+  	mnuFull[0] = miOpen = new MenuItem(MyLocale.getMsg(1021,"Open description"));
+  	mnuFull[1] = miGoto = new MenuItem(MyLocale.getMsg(1010,"Goto"));
+  	mnuFull[2] = miCenter = new MenuItem(MyLocale.getMsg(1019,"Center"));
+  	mnuFull[3] = miSeparator = new MenuItem("-");
+  	mnuFull[4] = miOpenOnline = new MenuItem(MyLocale.getMsg(1020,"Open in $browser online"));
+  	mnuFull[5] = miOpenOffline = new MenuItem(MyLocale.getMsg(1018,"Open in browser offline"));
+  	mnuFull[6] = miSeparator;
+  	mnuFull[7] = miDelete = new MenuItem(MyLocale.getMsg(1012,"Delete selected"));
+  	mnuFull[8] = miUpdate = new MenuItem(MyLocale.getMsg(1014,"Update"));
+  	mnuFull[9] = miSeparator;
+  	mnuFull[10] = miTickAll = new MenuItem(MyLocale.getMsg(1015,"Select all"));
+  	mnuFull[11] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,"De-select all"));	
+  	mFull = new Menu(mnuFull, MyLocale.getMsg(1013,"With selection"));
+
+  	MenuItem[] mnuSmall = new MenuItem[6];
+  	mnuSmall[0] = miOpen;
+  	mnuSmall[1] = miGoto;
+  	mnuSmall[2] = miCenter;
+  	mnuSmall[3] = miSeparator;
+  	mnuSmall[4] = miOpenOnline;
+  	mnuSmall[5] = miOpenOffline;
+  	mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013,"With selection"));	
 	}
 
 	/** Full menu when listview includes checkbox */
@@ -114,15 +125,15 @@
 	public void popupMenuEvent(Object selectedItem){
 		if (selectedItem == null) return;
 		CacheHolder ch;
-		if (selectedItem.toString().equals(MyLocale.getMsg(1015,"Select all"))){
+		if (selectedItem == miTickAll){
 			setSelectForAll(true);
 		}
 
-		if (selectedItem.toString().equals(MyLocale.getMsg(1016,"De-select all"))){
+		if (selectedItem == miUntickAll){
 			setSelectForAll(false);
 		}
 
-		if (selectedItem.toString().equals(MyLocale.getMsg(1012,"Delete"))){
+		if (selectedItem == miDelete){
 			Vm.showWait(true);
 			// Count # of caches to delete
 			int allCount=0;
@@ -188,12 +199,12 @@
 			}
 			Vm.showWait(false);
 		}
-		
-		if (selectedItem.toString().equals(MyLocale.getMsg(1014,"Update"))){
+				
+		if (selectedItem == miUpdate){
 			MainMenu.updateSelectedCaches(tbp);
 		}
 
-		if (selectedItem.toString().equals(MyLocale.getMsg(1019,"Centre"))){
+		if (selectedItem == miCenter){
 			if (tbp.getSelectedCache() < 0) {
 				Global.getPref().log("popupMenuEvent: getSelectedCache() < 0");
 				return;
@@ -210,11 +221,11 @@
 			}
 		}
 
-		if (selectedItem.toString().equals(MyLocale.getMsg(1010,"Goto"))){
+		if (selectedItem == miGoto){
 			ch = (CacheHolder)cacheDB.get(tbp.getSelectedCache());
 			Global.mainTab.gotoPoint(ch.pos);
 		}
-		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1020,"Open online in Browser"))){
+		if (selectedItem == miOpenOnline){
 			if(browserPathIsValid()){
 				ch = (CacheHolder)cacheDB.get(tbp.getSelectedCache());
 				CacheHolderDetail chD=ch.getCacheDetails(false, true);
@@ -232,13 +243,13 @@
 				}
 			}
 		}
-		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1018,"Open in browser offline"))) {
+		if (selectedItem == miOpenOffline) {
 			if(browserPathIsValid()){
 				ShowCacheInBrowser sc=new ShowCacheInBrowser();
 				sc.showCache(((CacheHolder)cacheDB.get(tbp.getSelectedCache())).getCacheDetails(false, true));
 			}
 		}
-		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1021,"Open description"))){
+		if (selectedItem == miOpen){
 			penDoubleClicked(null);
 		}
 



From pfeffer at mail.berlios.de  Fri Apr 25 19:15:40 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 25 Apr 2008 19:15:40 +0200
Subject: [Cachewolf-svn] r1413 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804251715.m3PHFeXo009043@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-25 19:15:29 +0200 (Fri, 25 Apr 2008)
New Revision: 1413

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/GPXImporter.java
Log:
GPX Importer: Bug fixed: show correct number of caches being imported, see http://www.geoclub.de/viewtopic.php?f=40&t=24099&st=0&sk=t&sd=a&start=40

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-25 16:23:49 UTC (rev 1412)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-25 17:15:29 UTC (rev 1413)
@@ -548,7 +548,8 @@
 		2587=Keine Cachewartung notwendig
 		2588=Cache-wartung notwendig
 		3000=Schlie%dfen
-		4000=Geladene Caches:
+		4000=Geladene Caches:+
+		4001=GPX-Dateien von Opencaching enthalten keine Informationen zu Bildern, sie werden nicht heruntergeladen. Am besten Caches von Opencaching holen per Men%fc /Anwendung/Import/Download von Opencaching
 		4100=Verzeichnis w%e4hlen:
 		4101=Karten
 		4102=Kalibrierte Karten

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-25 16:23:49 UTC (rev 1412)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-25 17:15:29 UTC (rev 1413)
@@ -543,7 +543,8 @@
 		2587=No maintenance needed
 		2588=Needs maintenance
 		3000=Close
-		4000=Loaded caches
+		4000=Loaded caches:+
+		4001=GPX files from opencaching don't contain information of images, they cannot be laoded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching
 		4101=Maps
 		4102=Calibrated maps
 		4103=Not calibrated maps

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2008-04-25 16:23:49 UTC (rev 1412)
+++ trunk/src/CacheWolf/GPXImporter.java	2008-04-25 17:15:29 UTC (rev 1413)
@@ -120,7 +120,7 @@
 						// skip over PRC-files
 						if (zipEnt.getName().endsWith("gpx")){
 							r = new ewe.io.InputStreamReader(zif.getInputStream(zipEnt));
-							infB = new InfoBox(zipEnt.toString(),(MyLocale.getMsg(4000,"Loaded caches") + ":" + zaehlerGel));
+							infB = new InfoBox(zipEnt.toString(),(MyLocale.getMsg(4000,"Loaded caches: ") + zaehlerGel));
 							infB.exec();
 							parse(r);
 							r.close();
@@ -130,14 +130,14 @@
 				}
 				else {
 					r = new ewe.io.InputStreamReader(new ewe.io.FileInputStream(file));
-					infB = new InfoBox("Info",(MyLocale.getMsg(4000,"Loaded caches") + ":" + zaehlerGel));
+					infB = new InfoBox("Info",(MyLocale.getMsg(4000,"Loaded caches: ") + zaehlerGel));
 					infB.show();
 					parse(r);
 					r.close();
 					infB.close(0);
 				}
 				// save Index 
-				profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
+				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 				infB.close(0);
 			}
 				Vm.showWait(false);
@@ -159,7 +159,7 @@
 			if (atts.getValue("creator").startsWith("TerraCaching")) fromTC = true;
 			else fromTC = false;
 
-			if (fromOC && doSpider) (new MessageBox("Warnung", "GPX-Dateien von Opencaching enthalten keine Informationen zu Bildern, sie werden nicht heruntergeladen. Am besten Caches von Opencaching holen per Men? /Anwendung/Download von Opencaching", FormBase.OKB)).execute();
+			if (fromOC && doSpider) (new MessageBox("Warnung", MyLocale.getMsg(4001, "GPX files from opencaching don't contain information of images, they cannot be laoded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching"), FormBase.OKB)).execute();
 			zaehlerGel = 0;
 		}
 		if (name.equals("wpt")) {
@@ -170,6 +170,8 @@
 			inLogs = false;
 			inBug = false;
 			nameFound = false;
+			zaehlerGel++;
+			infB.setInfo(MyLocale.getMsg(4000,"Loaded caches: ") + zaehlerGel);
 			return;
 		}
 		



From pfeffer at mail.berlios.de  Fri Apr 25 20:20:14 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 25 Apr 2008 20:20:14 +0200
Subject: [Cachewolf-svn] r1414 - trunk/src/CacheWolf
Message-ID: <200804251820.m3PIKEqP018465@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-25 20:20:13 +0200 (Fri, 25 Apr 2008)
New Revision: 1414

Modified:
   trunk/src/CacheWolf/MainForm.java
Log:
Profile.hasUnsavedChanges: Bug fixed: applying automatically a filter when loading a profile hasUnsavedChanges will be left unchanged (leave to false) in order to avoid unnecessary save operation when cachewolf exits

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2008-04-25 17:15:29 UTC (rev 1413)
+++ trunk/src/CacheWolf/MainForm.java	2008-04-25 18:20:13 UTC (rev 1414)
@@ -75,8 +75,9 @@
 			profile.readIndex();
 			pref.curCentrePt.set(profile.centre);
 			profile.updateBearingDistance();
-			profile.restoreFilter();
-			//profile.hasUnsavedChanges=false;
+			boolean saveHasUnsavedChanges = profile.hasUnsavedChanges; 
+			profile.restoreFilter(); // this method sets hasUnsavedChanges to true 
+			profile.hasUnsavedChanges = saveHasUnsavedChanges ; // in case that the profile is new, it hasUnsavedChanges, so set it back
 			setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 		} catch (Exception e){
 			if(pref.debug == true) Vm.debug("MainForm:: Exception:: " + e.toString());



From pfeffer at mail.berlios.de  Sat Apr 26 01:41:10 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 26 Apr 2008 01:41:10 +0200
Subject: [Cachewolf-svn] r1415 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200804252341.m3PNfA2n002679@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-26 01:41:08 +0200 (Sat, 26 Apr 2008)
New Revision: 1415

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/GPSPortOptions.java
Log:
GPS options dialog: added internationalization

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-04-25 18:20:13 UTC (rev 1414)
+++ trunk/res_noewe/languages/DE.cfg	2008-04-25 23:41:08 UTC (rev 1415)
@@ -732,7 +732,7 @@
 		6006=Von Datum
 		6007=Von Log
 		6008=Nach Prof
-	  6009=Nach Wegpt
+		6009=Nach Wegpt
 		6010=Nach Datum
 		6011=Nach Log
 		6015=*** ANDERER ***
@@ -789,6 +789,15 @@
 		7021=Dieser Versiontyp
 		7022=Versionstyp
 		7023=Fehler beim Download der aktuellen Versionsinformationen
+		7100=Einstellungen serieller Port
+		7101=Ports auflisten
+		7102=Baud:$b
+		7103=Suchen$u
+		7104=Testen$t
+		7105=GPS-Daten weiterleiten an Host
+		7106=Alle Daten vom GPS-Empf?nger werden an den eingetragenen Host an TCP-Port 23 weitergeleitet. Mit dem Programm HW Virtual Serial Port kann damit ein virtueller COM-Port eingerichtet werden
+		7107=Position alle X Sekunden speichern (NMEA-LOG)
+		
 		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-04-25 18:20:13 UTC (rev 1414)
+++ trunk/res_noewe/languages/EN.cfg	2008-04-25 23:41:08 UTC (rev 1415)
@@ -771,6 +771,14 @@
 		7021=type of this version
 		7022=Type of version
 		7023=Error downloading current version information
+		7100=Serial Port Options
+		7101=Update Ports$u
+		7102=Baud:$b
+		7103=Scan$u
+		7104=Test$t
+		7105=Forward GPS data to host
+		7106=All data from GPS will be sent to TCP-port 23%0a and can be redirected there to a serial port%0a by 
+		7107=Interval in sec for logging
 		{..}
 	{..}
 {..}

Modified: trunk/src/CacheWolf/GPSPortOptions.java
===================================================================
--- trunk/src/CacheWolf/GPSPortOptions.java	2008-04-25 18:20:13 UTC (rev 1414)
+++ trunk/src/CacheWolf/GPSPortOptions.java	2008-04-25 23:41:08 UTC (rev 1415)
@@ -99,39 +99,39 @@
 		ed.objectClass = Reflect.getForObject(this);
 		ed.sampleObject = this;
 		ed.setObject(this);
-		ed.title = "Serial Port Options";
+		ed.title = MyLocale.getMsg(7100, "Serial Port Options");
 		InputStack is = new InputStack();
 		ed.addLast(is).setCell(CellConstants.HSTRETCH);
 		CellPanel cp = new CellPanel();
 		ed.addField(cp.addNext(new mComboBox()).setCell(CellConstants.HSTRETCH),"portName");
-		ed.addField(cp.addLast(new mButton("Update Ports$u")).setCell(CellConstants.DONTSTRETCH),"update");
+		ed.addField(cp.addLast(new mButton(MyLocale.getMsg(7101,"Update Ports$u"))).setCell(CellConstants.DONTSTRETCH),"update");
 		is.add(cp,"Port:$p");
 		mComboBox cb = new mComboBox();
-		is.add(ed.addField(cb,"baudRate"),"Baud:$b");
+		is.add(ed.addField(cb,"baudRate"),MyLocale.getMsg(7102,"Baud:$b"));
 		cb.choice.addItems(ewe.util.mString.split("110|300|1200|2400|4800|9600|19200|38400|57600|115200"));
 		//
 		// End of copy from SerialPortOptions.
 		//
 		ed.buttonConstraints = CellConstants.HFILL;
-		ed.addField(ed.addNext(new mButton("Scan$u")).setCell(CellConstants.DONTSTRETCH),"scan");
-		btnTest = new mButton("Test$u");
+		ed.addField(ed.addNext(new mButton(MyLocale.getMsg(7103,"Scan$u"))).setCell(CellConstants.DONTSTRETCH),"scan");
+		btnTest = new mButton(MyLocale.getMsg(7104,"Test$t"));
 		ed.addField(ed.addLast(btnTest.setCell(CellConstants.DONTSTRETCH)),"test");
 		txtOutput = new TextDisplay();
 		ScrollBarPanel sbp = new MyScrollBarPanel(txtOutput);
 		sbp.setOptions(ScrollablePanel.AlwaysShowVerticalScrollers | ScrollablePanel.AlwaysShowHorizontalScrollers);
 		ed.addField(ed.addLast(sbp),"out");
-		forwardGpsChkB = new mCheckBox("z");
-		ed.addField(ed.addNext(forwardGpsChkB, CellConstants.DONTSTRETCH, (CellConstants.WEST | CellConstants.DONTFILL)), "forwardGpsChkB");
-		labelForwardHost = new mLabel("Forward GPS data to host");
+		forwardGpsChkB = new mCheckBox("");
+		ed.addField(ed.addNext(forwardGpsChkB, CellConstants.DONTSTRETCH, (CellConstants.EAST | CellConstants.DONTFILL)), "forwardGpsChkB");
+		labelForwardHost = new mLabel(MyLocale.getMsg(7105, "Forward GPS data to host"));
 		ed.addField(ed.addNext(labelForwardHost, CellConstants.DONTSTRETCH, (CellConstants.WEST | CellConstants.DONTFILL)), "labelForwardIP");
 		inputBoxForwardHost = new mInput("tcpForwardHost");
 		inputBoxForwardHost.setPromptControl(labelForwardHost);
+		inputBoxForwardHost.setToolTip(MyLocale.getMsg(7106, "All data from GPS will be sent to TCP-port 23\n and can be redirected there to a serial port\n by HW Virtual Serial Port"));
+		ed.addField(ed.addLast(inputBoxForwardHost,0 , (CellConstants.WEST | CellConstants.HFILL)), "tcpForwardHost");
 		inputBoxForwardHost.setText("192.168.178.23");
-		inputBoxForwardHost.setToolTip("All data from GPS will be sent to TCP-port 23\n and can be redirected there to a serial port\n by HW Virtual Serial Port");
-		ed.addField(ed.addLast(inputBoxForwardHost,0 , (CellConstants.WEST | CellConstants.HFILL)), "tcpForwardHost");
-		logGpsChkB = new mCheckBox("z");
-		ed.addField(ed.addNext(logGpsChkB, CellConstants.DONTSTRETCH, (CellConstants.WEST | CellConstants.DONTFILL)), "logGpsChkB");
-		labelLogTimer = new mLabel("Interval in sec for logging");
+		logGpsChkB = new mCheckBox("");
+		ed.addField(ed.addNext(logGpsChkB, CellConstants.DONTSTRETCH, (CellConstants.EAST | CellConstants.DONTFILL)), "logGpsChkB");
+		labelLogTimer = new mLabel(MyLocale.getMsg(7107, "Interval in sec for logging"));
 		ed.addField(ed.addNext(labelLogTimer, CellConstants.DONTSTRETCH, (CellConstants.WEST | CellConstants.DONTFILL)), "labelLogTimer");
 		inputBoxLogTimer = new mInput("GPSLogTimer");
 		inputBoxLogTimer.setPromptControl(labelLogTimer);



From pfeffer at mail.berlios.de  Sat Apr 26 01:43:29 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 26 Apr 2008 01:43:29 +0200
Subject: [Cachewolf-svn] r1416 - trunk/src/CacheWolf
Message-ID: <200804252343.m3PNhTe3003040@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-26 01:43:27 +0200 (Sat, 26 Apr 2008)
New Revision: 1416

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Preferences: Bug fixed: if log not writable an NullPointerException could stop CW from working

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-04-25 23:41:08 UTC (rev 1415)
+++ trunk/src/CacheWolf/Preferences.java	2008-04-25 23:43:27 UTC (rev 1416)
@@ -605,7 +605,7 @@
 		}catch(Exception ex){
 			Vm.debug("Error writing to log file!");
 		}finally{
-			strout.close();
+			if (strout != null) strout.close();
 		}
 	}
 



From pfeffer at mail.berlios.de  Sat Apr 26 01:46:14 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 26 Apr 2008 01:46:14 +0200
Subject: [Cachewolf-svn] r1417 - trunk/src/CacheWolf
Message-ID: <200804252346.m3PNkEkZ003147@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-26 01:46:13 +0200 (Sat, 26 Apr 2008)
New Revision: 1417

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
GPS options: provide usefull defaults

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-04-25 23:43:27 UTC (rev 1416)
+++ trunk/src/CacheWolf/Preferences.java	2008-04-25 23:46:13 UTC (rev 1417)
@@ -82,11 +82,11 @@
 	/** True if the GPS data should be forwarded to an IP address */
 	public boolean forwardGPS = false;
 	/** IP address for forwarding GPS data */
-	public String forwardGpsHost = "";
+	public String forwardGpsHost = "192.168.1.15";
 	/** True if the GPS data should be logged to a file */
 	public boolean logGPS = false;
 	/** Timer for logging GPS data */
-	public String logGPSTimer = "";
+	public String logGPSTimer = "5";
 	/** The default font size */
 	public int fontSize = 11;
 	// These settings govern where the menu and the tabs are displayed and whether the statusbas is shown



From pfeffer at mail.berlios.de  Sat Apr 26 02:21:13 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 26 Apr 2008 02:21:13 +0200
Subject: [Cachewolf-svn] r1418 - trunk/src/CacheWolf
Message-ID: <200804260021.m3Q0LDPm006293@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-26 02:21:11 +0200 (Sat, 26 Apr 2008)
New Revision: 1418

Modified:
   trunk/src/CacheWolf/GPSPortOptions.java
Log:
GPS options: set first focus not in the text field in order to avoid popping up of the SIP

Modified: trunk/src/CacheWolf/GPSPortOptions.java
===================================================================
--- trunk/src/CacheWolf/GPSPortOptions.java	2008-04-25 23:46:13 UTC (rev 1417)
+++ trunk/src/CacheWolf/GPSPortOptions.java	2008-04-26 00:21:11 UTC (rev 1418)
@@ -78,7 +78,7 @@
 
 public class GPSPortOptions extends SerialPortOptions {
 	TextDisplay txtOutput;
-	mButton btnTest;
+	mButton btnTest, btnUpdatePortList;
 	public mInput inputBoxForwardHost;
 	mLabel  labelForwardHost;
 	public mCheckBox forwardGpsChkB;
@@ -87,10 +87,10 @@
 	public mCheckBox logGpsChkB;
 	mySerialThread serThread;
 	boolean gpsRunning = false;
+	MyEditor ed = new MyEditor();
 
 	
 	public Editor getEditor(){
-		MyEditor ed = new MyEditor();
 		// The following lines are mainly copied from SerialPortOptions.
 		// Reason: We want to use MyEditor instead of the default Editor,
 		//         because the latter places the ok/cancel buttons centered.
@@ -104,7 +104,8 @@
 		ed.addLast(is).setCell(CellConstants.HSTRETCH);
 		CellPanel cp = new CellPanel();
 		ed.addField(cp.addNext(new mComboBox()).setCell(CellConstants.HSTRETCH),"portName");
-		ed.addField(cp.addLast(new mButton(MyLocale.getMsg(7101,"Update Ports$u"))).setCell(CellConstants.DONTSTRETCH),"update");
+		btnUpdatePortList = new mButton(MyLocale.getMsg(7101,"Update Ports$u"));
+		ed.addField(cp.addLast(btnUpdatePortList).setCell(CellConstants.DONTSTRETCH),"update");
 		is.add(cp,"Port:$p");
 		mComboBox cb = new mComboBox();
 		is.add(ed.addField(cb,"baudRate"),MyLocale.getMsg(7102,"Baud:$b"));
@@ -128,16 +129,14 @@
 		inputBoxForwardHost.setPromptControl(labelForwardHost);
 		inputBoxForwardHost.setToolTip(MyLocale.getMsg(7106, "All data from GPS will be sent to TCP-port 23\n and can be redirected there to a serial port\n by HW Virtual Serial Port"));
 		ed.addField(ed.addLast(inputBoxForwardHost,0 , (CellConstants.WEST | CellConstants.HFILL)), "tcpForwardHost");
-		inputBoxForwardHost.setText("192.168.178.23");
 		logGpsChkB = new mCheckBox("");
 		ed.addField(ed.addNext(logGpsChkB, CellConstants.DONTSTRETCH, (CellConstants.EAST | CellConstants.DONTFILL)), "logGpsChkB");
 		labelLogTimer = new mLabel(MyLocale.getMsg(7107, "Interval in sec for logging"));
 		ed.addField(ed.addNext(labelLogTimer, CellConstants.DONTSTRETCH, (CellConstants.WEST | CellConstants.DONTFILL)), "labelLogTimer");
 		inputBoxLogTimer = new mInput("GPSLogTimer");
 		inputBoxLogTimer.setPromptControl(labelLogTimer);
-		inputBoxLogTimer.setText("10");
 		ed.addField(ed.addLast(inputBoxLogTimer,0 , (CellConstants.WEST | CellConstants.HFILL)), "GPSLogTimer");
-
+		this.ed.firstFocus = btnUpdatePortList;
 		gpsRunning = false;
 		return ed;
 	}
@@ -178,13 +177,15 @@
 	}
 	
 	public void fieldEvent(FieldTransfer xfer, Editor editor, Object event){
-		try {
+		if ( event != null && event instanceof EditorEvent) {
 			EditorEvent ev = (EditorEvent) event;
-			if (xfer.fieldName.equals("_editor_") && (ev.type == EditorEvent.CLOSED)) {
-				if (serThread != null) serThread.stop();
+			if (xfer.fieldName.equals("_editor_")) {
+				if (ev.type == EditorEvent.CLOSED) {
+					if (serThread != null) serThread.stop();
+				}
 			}
-		} catch (ClassCastException e) { } // happens if event is not an EditorEvent
-		super.fieldEvent(xfer,editor,event);
+			super.fieldEvent(xfer,editor,event);
+		}
 	}
 	
 	private boolean testPort(String port, int baud){



From mik77 at mail.berlios.de  Sat Apr 26 13:08:51 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 26 Apr 2008 13:08:51 +0200
Subject: [Cachewolf-svn] r1419 - trunk/src/CacheWolf
Message-ID: <200804261108.m3QB8pem013402@sheep.berlios.de>

Author: mik77
Date: 2008-04-26 13:08:46 +0200 (Sat, 26 Apr 2008)
New Revision: 1419

Modified:
   trunk/src/CacheWolf/CacheList.java
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/SearchCache.java
Log:
Set selectionChanged when changing filter to update icons in moving map.

Modified: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2008-04-26 00:21:11 UTC (rev 1418)
+++ trunk/src/CacheWolf/CacheList.java	2008-04-26 11:08:46 UTC (rev 1419)
@@ -251,6 +251,7 @@
 
 	/** Apply the cache list */
 	public void applyCacheList() {
+		Global.getProfile().selectionChanged = true;
 		Vector cacheDB=Global.getProfile().cacheDB;
 		CacheHolder ch;
 		int wrongBlackStatus=0;

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2008-04-26 00:21:11 UTC (rev 1418)
+++ trunk/src/CacheWolf/Filter.java	2008-04-26 11:08:46 UTC (rev 1419)
@@ -117,6 +117,7 @@
 	*	possible is currently: DD MM.mmm
 	*/
 	public void doFilterRoute(File routeFile, double distance){
+		Global.getProfile().selectionChanged = true;
 		Vector cacheDB=Global.getProfile().cacheDB;
 		//load file into a vector:
 		Vector wayPoints = new Vector();
@@ -333,6 +334,7 @@
 			clearFilter();
 			return;
 		}
+		Global.getProfile().selectionChanged = true;
 		CacheHolder ch;
 		int cacheTypePattern;
 		int cacheRosePattern;
@@ -528,6 +530,7 @@
 		Vector cacheDB=Global.getProfile().cacheDB;
 		CacheHolder ch;
 		if (cacheDB.size()==0) return;
+		Global.getProfile().selectionChanged = true;
 		boolean showBlackListed=Filter.showBlacklisted;
 		for(int i = cacheDB.size()-1; i >=0 ; i--){
 			ch = (CacheHolder)cacheDB.get(i);
@@ -544,6 +547,7 @@
 	*	Clear the is_filtered flag from the cache database.
 	*/
 	public void clearFilter(){
+		Global.getProfile().selectionChanged = true;
 		Vector cacheDB=Global.getProfile().cacheDB;
 		CacheHolder ch;
 		for(int i = cacheDB.size()-1; i >=0 ; i--){

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-04-26 00:21:11 UTC (rev 1418)
+++ trunk/src/CacheWolf/MainMenu.java	2008-04-26 11:08:46 UTC (rev 1419)
@@ -490,6 +490,7 @@
 				tbp.refreshTable();
 			}
 			if(mev.selectedItem == filtSelected){ // incremental filter
+				Global.getProfile().selectionChanged = true;
 				CacheHolder ch;
 				for(int i = cacheDB.size()-1; i>=0; i--){
 					ch = (CacheHolder)cacheDB.get(i);
@@ -500,6 +501,7 @@
 				tbp.refreshTable();
 			}
 			if (mev.selectedItem == filtNonSelected){
+				Global.getProfile().selectionChanged = true;
 				CacheHolder ch;
 				for(int i = cacheDB.size()-1; i >=0; i--){
 					ch = (CacheHolder)cacheDB.get(i);

Modified: trunk/src/CacheWolf/SearchCache.java
===================================================================
--- trunk/src/CacheWolf/SearchCache.java	2008-04-26 00:21:11 UTC (rev 1418)
+++ trunk/src/CacheWolf/SearchCache.java	2008-04-26 11:08:46 UTC (rev 1419)
@@ -23,6 +23,7 @@
 	*/
 	public void search(String searchStr){
 		if(searchStr.length()>0){
+			Global.getProfile().selectionChanged = true;
 			searchStr = searchStr.toUpperCase();
 			CacheHolder ch;
 			//Search through complete database
@@ -49,6 +50,7 @@
 	* cache database. Restore to the state of the filter
 	*/
 	public void clearSearch(){
+		Global.getProfile().selectionChanged = true;
 		for(int i = cacheDB.size()-1;i >=0;i--){
 			CacheHolder ch=((CacheHolder)cacheDB.get(i));
 			ch.is_flaged=false;



From mik77 at mail.berlios.de  Sat Apr 26 14:54:09 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 26 Apr 2008 14:54:09 +0200
Subject: [Cachewolf-svn] r1420 - trunk/src/CacheWolf
Message-ID: <200804261254.m3QCs93s024557@sheep.berlios.de>

Author: mik77
Date: 2008-04-26 14:54:07 +0200 (Sat, 26 Apr 2008)
New Revision: 1420

Modified:
   trunk/src/CacheWolf/CacheList.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/TablePanel.java
Log:
- Null pointer exception when last cache was deleted removed.
- Select first cache if previous selected is no longer visible

Modified: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2008-04-26 11:08:46 UTC (rev 1419)
+++ trunk/src/CacheWolf/CacheList.java	2008-04-26 12:54:07 UTC (rev 1420)
@@ -337,10 +337,7 @@
 	
 	void updateScreen(int numRows) {
 		Global.mainTab.tbP.myMod.numRows=numRows;
-		// Check whether the currently selected cache is still visible
-		//selectRow(getSelectedCache());
-		Global.mainTab.tbP.tc.update(true); // Update and repaint
-		if (Global.mainTab.tbP.statBar!=null) Global.mainTab.tbP.statBar.updateDisplay();
+		Global.mainTab.tbP.refreshTable(); // Update and repaint
 		int selPanel;
 		if ((selPanel=Global.mainTab.cardPanel.selectedItem)>-1) {
 			if (selPanel==1) {

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-04-26 11:08:46 UTC (rev 1419)
+++ trunk/src/CacheWolf/MainTab.java	2008-04-26 12:54:07 UTC (rev 1420)
@@ -384,7 +384,8 @@
 
 	void updatePendingChanges() {
 		if (cacheDirty) {
-			chD.saveCacheDetails(Global.getProfile().dataDir);
+			if (chD != null)
+				chD.saveCacheDetails(Global.getProfile().dataDir);
 			cacheDirty = false;
 		}
 	}

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2008-04-26 11:08:46 UTC (rev 1419)
+++ trunk/src/CacheWolf/TablePanel.java	2008-04-26 12:54:07 UTC (rev 1420)
@@ -55,15 +55,18 @@
 		}
 	}
 	
-	/** Returns the index of the currently selected cache or -1 of the cache is no longer visible
+	/** Returns the index of the currently selected cache or 0 if the cache is no longer visible
 	 * due to a sort/filter or search operation
-	 * @return index of selected cache (-1 if not visible)
+	 * -1 if no cache is visible
+	 * @return index of selected cache (0 if not visible, -1 if no cache is visible)
 	 */
 	public int getSelectedCache(){
+		if ( myMod.numRows < 1 )
+			return -1;
 		// If the selected Cache is no longer visible (e.g. after applying a filter)
-		// select the last row
+		// select the first row
 		if (tc.cursor.y>=myMod.numRows)
-			return myMod.numRows-1;
+			return 0;
 		return tc.cursor.y;
 	}
 	



From pfeffer at mail.berlios.de  Sat Apr 26 15:55:48 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 26 Apr 2008 15:55:48 +0200
Subject: [Cachewolf-svn] r1421 - trunk/src/CacheWolf/navi
Message-ID: <200804261355.m3QDtmHg030607@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-26 15:55:47 +0200 (Sat, 26 Apr 2008)
New Revision: 1421

Modified:
   trunk/src/CacheWolf/navi/MapInfoObject.java
Log:
Empty Maps: Bug fixed: affine was not correctly calculated 

Modified: trunk/src/CacheWolf/navi/MapInfoObject.java
===================================================================
--- trunk/src/CacheWolf/navi/MapInfoObject.java	2008-04-26 12:54:07 UTC (rev 1420)
+++ trunk/src/CacheWolf/navi/MapInfoObject.java	2008-04-26 13:55:47 UTC (rev 1421)
@@ -84,7 +84,7 @@
 		double meters2deg = 1/(1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
 		double pixel2deg = meters2deg * scalei;
 		affine[0]=0; //x2lat
-		affine[1]=pixel2deg / java.lang.Math.cos(lat); //x2lon
+		affine[1]=pixel2deg / java.lang.Math.cos(lat*java.lang.Math.PI / 180); //x2lon
 		affine[2]=-pixel2deg; //y2lat
 		affine[3]=0; //y2lon
 		topleft.latDec=1; //top



From pfeffer at mail.berlios.de  Sat Apr 26 16:04:17 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 26 Apr 2008 16:04:17 +0200
Subject: [Cachewolf-svn] r1422 - trunk/src/CacheWolf/navi
Message-ID: <200804261404.m3QE4HJW031249@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-26 16:04:11 +0200 (Sat, 26 Apr 2008)
New Revision: 1422

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: Bug fixed: avoid NullPointerException, which happend when there is no (non-empty) map and "load a map for all selected caches" was selected  

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2008-04-26 13:55:47 UTC (rev 1421)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2008-04-26 14:04:11 UTC (rev 1422)
@@ -1053,6 +1053,18 @@
 			Rect screen = (Rect) s[1]; 
 			newmap = maps.getBestMap(cll, screen, Float.MAX_VALUE -1, false);
 		}
+		if (newmap == null) { // no map is covering any area of the caches -> zoom an empty map to cover all caches on screen
+			try {
+				Object [] s = getRectForMapChange(posCircle.where);
+			//	CWPoint cll = (CWPoint) s[0]; 
+				Rect screen = (Rect) s[1]; 
+				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.buttomright.lonDec) * 1000 / screen.width);
+				float neededscaley = (float) (sur.topleft.getDistance(sur.buttomright.latDec, sur.topleft.lonDec) * 1000 / screen.height);
+				newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
+				newmap.zoom(newmap.scale * newmap.zoomFactor / (neededscalex > neededscaley ? neededscalex : neededscaley), 0, 0);
+				forceMapLoad = true;
+			} catch (IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4279, "loadMapForAllCaches: IO-Exception in: newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap();"), FormBase.OKB)).exec(); }
+		}
 		boolean saveGpsIgnStatus = dontUpdatePos;
 		dontUpdatePos = true;
 		setMap(newmap, posCircle.where);



From pfeffer at mail.berlios.de  Sat Apr 26 16:15:22 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 26 Apr 2008 16:15:22 +0200
Subject: [Cachewolf-svn] r1423 - trunk/src/CacheWolf/navi
Message-ID: <200804261415.m3QEFMTB000460@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-26 16:15:21 +0200 (Sat, 26 Apr 2008)
New Revision: 1423

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: When in empty map and "load map for all ticked caches" is selected, choose a scale, that can show all cache symbols completly

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2008-04-26 14:04:11 UTC (rev 1422)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2008-04-26 14:15:21 UTC (rev 1423)
@@ -1058,8 +1058,8 @@
 				Object [] s = getRectForMapChange(posCircle.where);
 			//	CWPoint cll = (CWPoint) s[0]; 
 				Rect screen = (Rect) s[1]; 
-				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.buttomright.lonDec) * 1000 / screen.width);
-				float neededscaley = (float) (sur.topleft.getDistance(sur.buttomright.latDec, sur.topleft.lonDec) * 1000 / screen.height);
+				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.buttomright.lonDec) * 1000 / (screen.width-15)); // 15 for the size of the cache image
+				float neededscaley = (float) (sur.topleft.getDistance(sur.buttomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height-15)); // 15 for the size of the cache image
 				newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
 				newmap.zoom(newmap.scale * newmap.zoomFactor / (neededscalex > neededscaley ? neededscalex : neededscaley), 0, 0);
 				forceMapLoad = true;



From mik77 at mail.berlios.de  Mon Apr 28 17:44:20 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 28 Apr 2008 17:44:20 +0200
Subject: [Cachewolf-svn] r1424 - trunk/res_noewe
Message-ID: <200804281544.m3SFiKpi000039@sheep.berlios.de>

Author: mik77
Date: 2008-04-28 17:44:09 +0200 (Mon, 28 Apr 2008)
New Revision: 1424

Modified:
   trunk/res_noewe/info.html
Log:
New Developers added.

Modified: trunk/res_noewe/info.html
===================================================================
--- trunk/res_noewe/info.html	2008-04-26 14:15:21 UTC (rev 1423)
+++ trunk/res_noewe/info.html	2008-04-28 15:44:09 UTC (rev 1424)
@@ -3,7 +3,7 @@
 <font face="Tahoma" size = "3">
 <strong>A geocaching programm</strong><br>
 <font face="Tahoma" size = "2"><em>
-from Bilbowolf, Kalli, Pfeffer, salzkammergut, MiK, Blackeye501, mirabilos<br>
+from Bilbowolf, Kalli, Pfeffer, salzkammergut, MiK, Blackeye501, mirabilos, Kappler, Engywuck<br>
 for Windows, Linux and Pocket PC</em><br>
 <br>
 CacheWolf was created sometime 2003 to enable paperless caching with a Sharp Zaurus.



From mik77 at mail.berlios.de  Mon Apr 28 23:50:36 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 28 Apr 2008 23:50:36 +0200
Subject: [Cachewolf-svn] r1425 - trunk/src/CacheWolf/navi
Message-ID: <200804282150.m3SLoa4f024042@sheep.berlios.de>

Author: mik77
Date: 2008-04-28 23:50:33 +0200 (Mon, 28 Apr 2008)
New Revision: 1425

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Allow panning in HIGHEST_RESOLUTION_GPS_DEST mode. Scale keeps the same till GPS is back on screen.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2008-04-28 15:44:09 UTC (rev 1424)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2008-04-28 21:50:33 UTC (rev 1425)
@@ -76,6 +76,8 @@
 	
 	Point lastRepaintMapPos = null;
 	double lastDistance = -1;
+	
+	float lastHighestResolutionGPSDestScale = -1;
 
 	public MovingMap(Navigate nav, Vector cacheDB){
 		this.cacheDB = cacheDB;
@@ -161,6 +163,7 @@
 		//updateDistance(); // fill Rect with transparent color
 		scaleWanted = 1;
 		mapChangeModus = HIGHEST_RESOLUTION_GPS_DEST;
+		lastHighestResolutionGPSDestScale = -1;
 		
 		lastRepaintMapPos = new Point(pref.myAppWidth +1, pref.myAppHeight +1);
 	}
@@ -579,7 +582,7 @@
 										} // this happens if a position jump occured
 								}}}}}}} // close all IFs
 		Vm.gc(); // call garbage collection
-		Vm.debug("Overlayrearanged"+TrackOverlays.toString());
+		//Vm.debug("Overlayrearanged"+TrackOverlays.toString());
 	}
 
 	public void ShowLastAddedPoint(Track tr) {
@@ -930,23 +933,41 @@
 		Object [] s = getRectForMapChange(where);
 		CWPoint cll = (CWPoint) s[0]; 
 		Rect screen = (Rect) s[1]; 
+		boolean posCircleOnScreen = ((Boolean) s[2]).booleanValue();
 		MapInfoObject newmap = null;
 		//if (mapChangeModus == 0) mapChangeModus = HIGHEST_RESOLUTION_GPS_DEST;
 		wantMapTest = true;
 		switch (mapChangeModus) {
 		case NORMAL_KEEP_RESOLUTION: 
+			lastHighestResolutionGPSDestScale = -1;
 			newmap = maps.getBestMap(cll, screen, scaleWanted, false);
 			if (newmap == null) newmap = currentMap;
 			if (MapsList.scaleEquals(scaleWanted, newmap)) wantMapTest = false;
 			break;
-		case HIGHEST_RESOLUTION: newmap = maps.getBestMap(cll, screen, 0.000001f, false); break;
+		case HIGHEST_RESOLUTION:
+			lastHighestResolutionGPSDestScale = -1;
+			newmap = maps.getBestMap(cll, screen, 0.000001f, false);
+			break;
 		case HIGHEST_RESOLUTION_GPS_DEST: 
 			if (gotoPos!= null && GpsStatus != noGPS && posCircle.where.isValid()) {
-				newmap = maps.getMapForArea(posCircle.where, gotoPos.where); // TODO use home-coos if no gps? - consider start from details panel and from gotopanel
-				if (newmap == null) newmap = maps.getBestMap(cll, screen, 10000000000000000000000000000000000f, false); // use map with most available overview if no map containing PosCircle and GotoPos is available
+				if ( ( !posCircleOnScreen ) && ( lastHighestResolutionGPSDestScale > 0 ) ) {
+					newmap = maps.getBestMap(cll, screen, lastHighestResolutionGPSDestScale , false);
+				} else {
+					newmap = maps.getMapForArea(posCircle.where, gotoPos.where); // TODO use home-coos if no gps? - consider start from details panel and from gotopanel
+					if (newmap == null)	newmap = maps.getBestMap(cll, screen, 10000000000000000000000000000000000f, false); // use map with most available overview if no map containing PosCircle and GotoPos is available
+					
+					lastHighestResolutionGPSDestScale = newmap.scale;	
+					
+					if (!posCircleOnScreen) {
+						newmap = maps.getBestMap(cll, screen, lastHighestResolutionGPSDestScale , false);
+					}
+				}
 			}
 			//	either Goto-Pos or GPS-Pos not set
-			else newmap = maps.getBestMap(cll, screen, 0.000001f, false); 
+			else {
+				lastHighestResolutionGPSDestScale = -1;
+				newmap = maps.getBestMap(cll, screen, 0.000001f, false); 
+			}
 			break;
 		default: (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4208, "Bug: \nillegal mapChangeModus: ") + mapChangeModus, FormBase.OKB)).execute(); break;
 		}
@@ -977,6 +998,7 @@
 		scaleWanted = currentMap.scale;
 		if (mapChangeModus == modus) return;
 		mapChangeModus = modus;
+		lastHighestResolutionGPSDestScale = -1;
 		if (modus != NORMAL_KEEP_RESOLUTION) setBestMap(posCircle.where, true);
 	}
 	/**
@@ -994,7 +1016,9 @@
 		int h = (height != 0 ? height : pref.myAppHeight);
 		int x, y;
 		CWPoint cll;
+		Boolean posCircleOnScreen = java.lang.Boolean.FALSE;
 		if (posCircleX >= 0 && posCircleX <= w && posCircleY >= 0 && posCircleY <= h && ll.isValid()) {
+			posCircleOnScreen = java.lang.Boolean.TRUE;
 			x = posCircleX; // posCircle is inside the screen
 			y = posCircleY; // TODO eigentlich interessiert, ob nach dem evtl. Kartenwechsel PosCircle on Screen ist. So wie es jetzt ist, kann 2mal der gleiche Aufruf zum laden unterschiedlicher Karten f?hren, wenn vorher PosCircle nicht auf dem SChirm war, nach dem ersten Laden aber schon.
 			cll = new CWPoint(ll);
@@ -1003,9 +1027,10 @@
 			x = w/2;
 			y = h/2;
 		} 
-		Object[] ret = new Object[2];
+		Object[] ret = new Object[3];
 		ret[0] = cll;
 		ret[1] = new Rect(x, y, w, h);
+		ret[2] = posCircleOnScreen;
 		return ret; 
 	}
 



From salzkammergut at mail.berlios.de  Tue Apr 29 21:12:01 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 29 Apr 2008 21:12:01 +0200
Subject: [Cachewolf-svn] r1426 - trunk/src/CacheWolf
Message-ID: <200804291912.m3TJC1de013773@sheep.berlios.de>

Author: salzkammergut
Date: 2008-04-29 21:11:55 +0200 (Tue, 29 Apr 2008)
New Revision: 1426

Modified:
   trunk/src/CacheWolf/SafeXML.java
Log:
SafeXML: Added new entry for bullet (&#8226;) as used in GC16AJH, GC1BG7D and GC1BGAK

Modified: trunk/src/CacheWolf/SafeXML.java
===================================================================
--- trunk/src/CacheWolf/SafeXML.java	2008-04-28 21:50:33 UTC (rev 1425)
+++ trunk/src/CacheWolf/SafeXML.java	2008-04-29 19:11:55 UTC (rev 1426)
@@ -231,6 +231,7 @@
 				"&#8221;", "\"",
 				"&#8222;", "\"",
 				"&#8223;", "\"",
+				"&#8226;", "?",
 				"&#8242;", "'",
 				"&#8243;", "\""
 				};



From pfeffer at mail.berlios.de  Wed Apr 30 02:00:12 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 30 Apr 2008 02:00:12 +0200
Subject: [Cachewolf-svn] r1427 - trunk/src/CacheWolf
Message-ID: <200804300000.m3U00CWl028886@sheep.berlios.de>

Author: pfeffer
Date: 2008-04-30 02:00:10 +0200 (Wed, 30 Apr 2008)
New Revision: 1427

Modified:
   trunk/src/CacheWolf/PreferencesScreen.java
Log:
PreferencesScreen: set default Hotkeys

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2008-04-29 19:11:55 UTC (rev 1426)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2008-04-30 00:00:10 UTC (rev 1427)
@@ -246,8 +246,12 @@
 				MyLocale.getMsg(6011,"To Log")},pref.travelbugColMap),"T-bugs",null);
 		
 		this.addLast(mTab);
-		addNext(cancelB = new mButton(MyLocale.getMsg(614,"Cancel")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		addLast(applyB = new mButton(MyLocale.getMsg(615,"Apply")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		cancelB = new mButton(MyLocale.getMsg(614,"Cancel"));
+		cancelB.setHotKey(0, IKeys.ESCAPE);
+		addNext(cancelB,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		applyB = new mButton(MyLocale.getMsg(615,"Apply"));
+		applyB.setHotKey(0, IKeys.ACTION);
+		addLast(applyB,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 	}
 	
 	public void onEvent(Event ev){



From salzkammergut at mail.berlios.de  Wed Apr 30 22:21:54 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 30 Apr 2008 22:21:54 +0200
Subject: [Cachewolf-svn] r1428 - trunk/src/CacheWolf
Message-ID: <200804302021.m3UKLsgO018203@sheep.berlios.de>

Author: salzkammergut
Date: 2008-04-30 22:21:49 +0200 (Wed, 30 Apr 2008)
New Revision: 1428

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
Log:
DescriptionPanel did not display <sup> tag correctly. To overcome this <sup>xxx</sup> is replaced by ^(xxx). Example cache: GC1BJ1P

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-04-30 00:00:10 UTC (rev 1427)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-04-30 20:21:49 UTC (rev 1428)
@@ -58,6 +58,11 @@
                 // not an addi-wpt
                 desc = cache.LongDescription;
         }
+        // HtmlDisplay does not show the <sup> tag correctly, so we need to replace with ^
+        if (desc.indexOf("<sup>")>=0) {
+        	desc=STRreplace.replace(desc,"<sup>","^(");
+        	desc=STRreplace.replace(desc, "</sup>",")");
+        }
         Vm.showWait(true);
         if (isHtml) {
             int imageNo = 0;



