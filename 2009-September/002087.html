<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2163 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2163%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/imp&In-Reply-To=%3C200909091128.n89BSAsj005224%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002086.html">
   <LINK REL="Next"  HREF="002088.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2163 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp</H1>
    <B>pfeffer at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2163%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/CacheWolf/imp&In-Reply-To=%3C200909091128.n89BSAsj005224%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2163 - in trunk: res_noewe/languages src/CacheWolf	src/CacheWolf/imp">pfeffer at mail.berlios.de
       </A><BR>
    <I>Wed Sep  9 13:28:10 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002086.html">[Cachewolf-svn] r2162 - trunk/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="002088.html">[Cachewolf-svn] r2164 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2087">[ date ]</a>
              <a href="thread.html#2087">[ thread ]</a>
              <a href="subject.html#2087">[ subject ]</a>
              <a href="author.html#2087">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pfeffer
Date: 2009-09-09 13:28:05 +0200 (Wed, 09 Sep 2009)
New Revision: 2163

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/imp/LOCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
opencaching remove &quot;.de&quot; was not complete
opencaching download: bug fixed: &lt;waypoint&gt;.xml were not created at first download. In order to solve this problem, Cacheholder.CachesWithLoadedDetails now again holds a vector of the Cacheholders directly, not a list of waypoint names, see <A HREF="http://www.geoclub.de/viewtopic.php?f=40&amp;t=33289&amp;start=20">http://www.geoclub.de/viewtopic.php?f=40&amp;t=33289&amp;start=20</A> for details

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/DE.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -31,7 +31,7 @@
 		127=Speichern
 		128=%fcber Template
 		129=Importiere GPX
-		130=Download von opencaching.de
+		130=Download von opencaching
 		131=Spider von geocaching.com
 		132=nach Explorist
 		133=Suche alle
@@ -418,7 +418,7 @@
 		1512=Wegpunkt
 		1513=Kann Karte nicht ohne g%fcltige Koordinaten anzeigen - Bitte Koordinaten als Ziel, Zentrum oder im gew%e4hlten Cache eingeben oder GPS starten
 		1514=Kann Entfernungen nicht neuberechnen, weil keine GPS-Position gesetzt ist (kein GPS-Empfang ist/war)
-		1600=Opencaching Download
+		1600=+Download
 		1601=max. Abstand:
 		1602=Bilder downloaden
 		1603=Karten downloaden

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/EN.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -418,7 +418,7 @@
 		1512=Waypoint
 		1513=Cannot start moving map without valid coordinates. Please enter coordinates as destination as center or in selected cache, or start GPS
 		1514=Cannot recalculate distances, because the GPS position is not set
-		1600=Opencahing.de Download
+		1600=+Download
 		1601=Distance:
 		1602=Download images
 		1603=Download maps

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/FR.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -406,7 +406,7 @@
 		1511=Ne peut pas interpr%e9ter les donn%e9es du GPS%0aCauses possibles:%0aMauvais Port,%0amauvais baud,%0apas de protocole NMEA%0aConnexion ferm%e9e%0aDerni%e8re cha%eene de lettres:%0a
 		1512=Waypoint
 		1513=Ne peut pas afficher carte sans coordonn%e9es valides - Merci d'entrer coordonn%e9es comme destination, centre ou dans le cache choisi et d%e9marrer GPS
-		1600=T%e9l%e9chargement Opencaching.de
+		1600=+T%e9l%e9chargement
 		1601=Distance maximum:
 		1602=T%e9l%e9charger images
 		1603=T%e9l%e9charger cartes

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/NL.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -371,7 +371,7 @@
 		1512=Wegpunt
 		1513=Kan moving map niet draaien zonder geldige co%f6rdinaten. Geef Centrums- of Doelco%f6rdinaten of start het GPS AUB.
 		1514=Kan afstanden niet opnieuw berekenen doordat er geen GPS positie gegeven is (geen receptie is/was)
-		1600=Download van Opencaching.de
+		1600=+Download
 		1601=Afstand:
 		1602=Download afbeeldingen
 		1603=Download kaarten

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/res_noewe/languages/PL.cfg	2009-09-09 11:28:05 UTC (rev 2163)
@@ -418,7 +418,7 @@
                 1512=Waypoint
                 1513=Nie mozna poruszac mapy bez prawidlowych wspolrzednych.%0a Prosze Wprowadz Wspolrzedne srodka %0alub na wybrana skrzynke, lub pozycja GPS
                 1514=Nie mo&#191;na przeliczyc odleglosci, pozycja GPS nie ustawiona
-                1600=Opencahing.de Download
+                1600=+Download
                 1601=Odleglosc:
                 1602=Sciagnij obrazki
                 1603=Sciagnij mapy

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-09-09 11:28:05 UTC (rev 2163)
@@ -708,10 +708,11 @@
 			}
 			if (details != null
 					  // for importing/spidering reasons helper objects with same waypoint are created
-					&amp;&amp; !cachesWithLoadedDetails.contains(this.getWayPoint())
+					&amp;&amp; !cachesWithLoadedDetails.contains(this)
 					  // helper objects may have empty waypoint
-					&amp;&amp; !this.getWayPoint().equals(CacheHolder.EMPTY)) {
-				cachesWithLoadedDetails.add(this.getWayPoint());
+					//&amp;&amp; !this.getWayPoint().equals(CacheHolder.EMPTY)
+					) {
+				cachesWithLoadedDetails.add(this);
 				if (cachesWithLoadedDetails.size() &gt;= Global.getPref().maxDetails) removeOldestDetails();
 			}
 		}
@@ -752,24 +753,28 @@
 			details.saveCacheDetails(Global.getProfile().dataDir);
 		}
 		details = null;
-		cachesWithLoadedDetails.remove(this.getWayPoint());
+		cachesWithLoadedDetails.remove(this);
 	}
 
 	//final static int maxDetails = 50; 
 	static Vector cachesWithLoadedDetails = new Vector(Global.getPref().maxDetails);
 
 	public static void removeOldestDetails() {
+		CacheHolder ch;
 		for (int i=0; i&lt;Global.getPref().deleteDetails; i++) {
-			String wp = (String) cachesWithLoadedDetails.get(i);
-			CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+//			String wp = (String) cachesWithLoadedDetails.get(i);
+	//		CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+			ch = (CacheHolder) cachesWithLoadedDetails.get(i);
 			if (ch!=null) ch.releaseCacheDetails();
 		}	
 	}
 
 	public static void removeAllDetails() {
+		CacheHolder ch;
 		for (int i=cachesWithLoadedDetails.size()-1; i&gt;=0; i--) {
-			String wp = (String) cachesWithLoadedDetails.get(i);
-			CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+			// String wp = (String) cachesWithLoadedDetails.get(i);
+			// CacheHolder ch = Global.getProfile().cacheDB.get(wp);
+			ch = (CacheHolder) cachesWithLoadedDetails.get(i);
 			if (ch!=null &amp;&amp; ch.detailsLoaded()) ch.releaseCacheDetails();
 		}
 	}
@@ -782,8 +787,9 @@
 		CacheHolder ch;
 		CacheHolderDetail chD;
 		for (int i=cachesWithLoadedDetails.size()-1; i&gt;=0; i--) {
-			String wp = (String) cachesWithLoadedDetails.get(i);
-			ch = Global.getProfile().cacheDB.get(wp);
+//			String wp = (String) cachesWithLoadedDetails.get(i);
+//			ch = Global.getProfile().cacheDB.get(wp);
+			ch = (CacheHolder) cachesWithLoadedDetails.get(i);
 			if (ch != null) {
 	            chD = ch.getExistingDetails();
 	            if (chD!=null &amp;&amp; chD.hasUnsavedChanges) {

Modified: trunk/src/CacheWolf/imp/LOCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/LOCXMLImporter.java	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/src/CacheWolf/imp/LOCXMLImporter.java	2009-09-09 11:28:05 UTC (rev 2163)
@@ -26,7 +26,6 @@
 
 package CacheWolf.imp;
 
-//TODO: move to CacheWOlf.imp
 
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 10:14:41 UTC (rev 2162)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-09-09 11:28:05 UTC (rev 2163)
@@ -64,7 +64,7 @@
 	boolean debugGPX = false;
 	CacheDB cacheDB;
 	InfoBox inf;
-	CacheHolder ch;
+	//CacheHolder ch;
 	CacheHolder holder;
 	Preferences pref;
 	Profile profile;
@@ -99,6 +99,7 @@
 			incUpdate = false;
 		}
 		user = p.myAlias.toLowerCase();
+		CacheHolder ch;
 		for(int i = 0; i&lt;cacheDB.size();i++){
 			ch = cacheDB.get(i);
 			if (!ch.getOcCacheID().equals(&quot;&quot;))
@@ -128,9 +129,10 @@
 	 * @return true, if some change was made to the cacheDB
 	 */
 	public boolean syncSingle(int number, InfoBox infB) {
+		CacheHolder ch;
 		ch = cacheDB.get(number);
+		setHostname(ch.getWayPoint());
 		holder= null; //new CacheHolderDetail(ch); //TODO is this still correct? use getDetails ?
-		setHostname(ch.getWayPoint());
 
 		if (infB.isClosed) {
 			if (askForOptions) return false; 
@@ -139,7 +141,7 @@
 		
 		if (askForOptions) {
 			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( 
-				MyLocale.getMsg(1600, hostname + &quot; Download&quot;),OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL);
+					hostname + MyLocale.getMsg(1600, &quot; Download&quot;),OCXMLImporterScreen.IMAGES | OCXMLImporterScreen.ALL);
 			if (importOpt.execute() == FormBase.IDCANCEL) {	return false; }
 			askForOptions = false;
 			reload = importOpt.missingCheckBox.getState();
@@ -193,7 +195,6 @@
 			(new MessageBox(&quot;Error&quot;, &quot;Coordinates for centre must be set&quot;, FormBase.OKB)).execute();
 			return;
 		}
-		setHostname(ch.getWayPoint());
 		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, hostname + &quot; Download&quot;),
 																 OCXMLImporterScreen.ALL | OCXMLImporterScreen.DIST | OCXMLImporterScreen.IMAGES);
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
@@ -217,6 +218,7 @@
 		}
 		profile.setDistOC(dist);
 		// Clear status of caches in db
+		CacheHolder ch;
 		for(int i = cacheDB.size()-1; i&gt;=0 ;i--){
 			ch = cacheDB.get(i);
 			ch.setUpdated(false);
@@ -316,7 +318,7 @@
 			if (holder != null)	finalMessage = MyLocale.getMsg(1615,&quot;Error parsing update file, state:&quot;)+&quot; &quot;+state+&quot;, waypoint: &quot;+ holder.getWayPoint();
 			else finalMessage = MyLocale.getMsg(1615,&quot;Error parsing update file, state:&quot;)+&quot; &quot;+state+&quot;, waypoint: &lt;unkown&gt;&quot;;
 			success = false;
-			Vm.debug(&quot;Parse error: &quot; + state + &quot; Exception:&quot; + e.toString()+&quot;   &quot;+holder.getOcCacheID());
+			//Vm.debug(&quot;Parse error: &quot; + state + &quot; Exception:&quot; + e.toString()+&quot;   &quot;+holder.getOcCacheID());
 			e.printStackTrace();
 		} finally {
 			if (tmpFile != null) tmpFile.delete();
@@ -470,8 +472,8 @@
 	}
 
 	// TODO Do we have to release the &quot;holder&quot; cache details ?
+	// for details see: <A HREF="http://www.geoclub.de/viewtopic.php?f=40&amp;t=33289">http://www.geoclub.de/viewtopic.php?f=40&amp;t=33289</A>
 	private void endCache(String name){
-		setHostname(ch.getWayPoint());
 		if (name.equals(&quot;cache&quot;)){
 			holder.setLastSync(dateOfthisSync.format(&quot;yyyyMMddHHmmss&quot;));
 			int index;
@@ -616,7 +618,6 @@
 	}
 	
 	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs
-		setHostname(ch.getWayPoint());
 		try {
 			//TODO this is not quite correct: actually the &quot;base&quot; URL must be known... 
 			// but anyway a different baseURL should not happen very often  - it doesn't in my area


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002086.html">[Cachewolf-svn] r2162 - trunk/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="002088.html">[Cachewolf-svn] r2164 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2087">[ date ]</a>
              <a href="thread.html#2087">[ thread ]</a>
              <a href="subject.html#2087">[ subject ]</a>
              <a href="author.html#2087">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
