From mik77 at mail.berlios.de  Mon Mar  2 19:41:27 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 19:41:27 +0100
Subject: [Cachewolf-svn] r1661 - trunk/src/CacheWolf
Message-ID: <200903021841.n22IfRpv018198@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 19:41:25 +0100 (Mon, 02 Mar 2009)
New Revision: 1661

Modified:
   trunk/src/CacheWolf/ProfilesForm.java
Log:
Don't show MAPS as profile if it is upper case

Modified: trunk/src/CacheWolf/ProfilesForm.java
===================================================================
--- trunk/src/CacheWolf/ProfilesForm.java	2009-02-28 20:23:42 UTC (rev 1660)
+++ trunk/src/CacheWolf/ProfilesForm.java	2009-03-02 18:41:25 UTC (rev 1661)
@@ -85,7 +85,7 @@
         // Now add these subdirectories to the list of profiles but
         // exclude the "maps" directory which will contain the moving maps
         for (int i=0; i<existingProfiles.length; i++) 
-			if (!existingProfiles[i].equals("maps")) choice.addItem(existingProfiles[i]);
+			if (!existingProfiles[i].equalsIgnoreCase("maps")) choice.addItem(existingProfiles[i]);
         // Highlight the profile that was used last
         choice.selectLastProfile(selectedProfile);
         // Add a scroll bar to the list of profiles



From mik77 at mail.berlios.de  Mon Mar  2 19:42:28 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 19:42:28 +0100
Subject: [Cachewolf-svn] r1662 - in trunk: res_noewe/languages
	src/CacheWolf/navi
Message-ID: <200903021842.n22IgSrR018254@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 19:42:24 +0100 (Mon, 02 Mar 2009)
New Revision: 1662

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Set new goto target to shown waypoint directly in moving map

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-02 18:41:25 UTC (rev 1661)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-02 18:42:24 UTC (rev 1662)
@@ -638,6 +638,7 @@
 		4276=Abbrechen
 		4277=Ausw%e4hlen
 		4278=Kann folgende .wfl-Datei nicht laden:+%0a
+		4279=Setze Ziel auf
 		4300=Leer 1 Punkt =+
 		4301=+meter
 		4302=Breite/L%e4nge au%dferhalb des zul%e4ssigen Bereiches beim Lesen von+

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-02 18:41:25 UTC (rev 1661)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-02 18:42:24 UTC (rev 1662)
@@ -627,6 +627,7 @@
 		4276=Cancel
 		4277=Select
 		4278=Cannot load wfl-file: \n
+		4279=Goto
 		4300=empty 1 Pixel =+
 		4301=+meters
 		4302=Lat/Lon out of range while reading+

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-03-02 18:41:25 UTC (rev 1661)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-03-02 18:42:24 UTC (rev 1662)
@@ -1472,7 +1472,7 @@
 	Menu kontextMenu;
 	MenuItem gotoMenuItem = new MenuItem(MyLocale.getMsg(4230, "Goto here$g"), 0, null);
 	MenuItem newWayPointMenuItem = new MenuItem(MyLocale.getMsg(4232, "Create new Waypoint here$n"), 0, null);;
-	MenuItem openCacheDescMenuItem,addCachetoListMenuItem;
+	MenuItem openCacheDescMenuItem,addCachetoListMenuItem,gotoCacheMenuItem;
 	
 	MenuItem miLuminary[];
 
@@ -1755,6 +1755,8 @@
 					if (clickedCache != null) {
 						openCacheDescMenuItem = new MenuItem(MyLocale.getMsg(4270, "Open")+" '"+(clickedCache.CacheName.length()>0 ? clickedCache.CacheName : clickedCache.wayPoint)+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
 						kontextMenu.addItem(openCacheDescMenuItem);
+						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto")+ " '"+(clickedCache.CacheName.length()>0 ? clickedCache.CacheName : clickedCache.wayPoint)+"'$g"); // clickedCache == null can happen if clicked on the goto-symbol
+						kontextMenu.addItem(gotoCacheMenuItem);
 						if (Global.mainForm.cacheListVisible) { 
 							addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
 							kontextMenu.addItem(addCachetoListMenuItem);
@@ -1869,6 +1871,10 @@
 						MainTab mainT = Global.mainTab;
 						mainT.openDescriptionPanel(clickedCache);
 					}
+					if (action == gotoCacheMenuItem) {
+						kontextMenu.close();
+						mm.myNavigation.setDestination(clickedCache.pos);	
+					}
 					if (action == newWayPointMenuItem) {
 						kontextMenu.close();
 						WindowEvent close = new WindowEvent();
@@ -2211,3 +2217,5 @@
 }
 
 
+
+



From mik77 at mail.berlios.de  Mon Mar  2 20:18:07 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 20:18:07 +0100
Subject: [Cachewolf-svn] r1663 - in trunk/src: CacheWolf exp
Message-ID: <200903021918.n22JI7qm022212@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 20:18:05 +0100 (Mon, 02 Mar 2009)
New Revision: 1663

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/exp/GPXExporter.java
Log:
- CacheId added to GPX-Export for Colorado/Oregon
- Some smaller adjustments for Colorado/Oregon

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-03-02 18:42:24 UTC (rev 1662)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-03-02 19:18:05 UTC (rev 1663)
@@ -620,4 +620,37 @@
 
 		return statusTime;		
 	}
+		
+	public String GetCacheID() {
+		String result = "";
+		
+		if ( wayPoint.toUpperCase().startsWith( "GC" ) ) {
+			int gcId = 0;
+
+			String sequence = "0123456789ABCDEFGHJKMNPQRTVWXYZ";
+			
+			String rightPart = wayPoint.substring( 2 ).toUpperCase();
+			
+			int base = 31;
+			if ((rightPart.length() < 4) || (rightPart.length() == 4 && sequence.indexOf(rightPart.charAt(0)) < 16)) {
+				base = 16;
+			}
+			
+			for ( int pos = 0; pos < rightPart.length(); pos++ ) {
+				gcId *= base;
+				gcId += sequence.indexOf(rightPart.charAt(pos));
+			}
+			
+	        if ( base == 31 ) {
+	        	gcId += java.lang.Math.pow(16, 4) - 16 * java.lang.Math.pow(31, 3);
+	        }
+	        
+	        result = Integer.toString(gcId);	        
+		} else if ( wayPoint.toUpperCase().startsWith( "OC" ) ) {
+        	result = ocCacheID;
+        }
+
+		return result;
+	}
 }
+

Modified: trunk/src/exp/GPXExporter.java
===================================================================
--- trunk/src/exp/GPXExporter.java	2009-03-02 18:42:24 UTC (rev 1662)
+++ trunk/src/exp/GPXExporter.java	2009-03-02 19:18:05 UTC (rev 1663)
@@ -63,18 +63,31 @@
 			strBuf.append("    <url>http://www.geocaching.com/seek/cache_details.aspx?wp=").append(ch.wayPoint).append("&amp;Submit6=Find</url>\r\n");
 			strBuf.append("    <urlname>").append(SafeXML.cleanGPX(ch.CacheName)).append(" by ").append(SafeXML.cleanGPX(ch.CacheOwner)).append("</urlname>\r\n");
 			if (!ch.isAddiWpt()){
-				strBuf.append("    <sym>Geocache</sym>\r\n");
+				if ( ch.is_found ) {
+					strBuf.append("    <sym>Geocache Found</sym>\r\n");					
+				} else {
+					strBuf.append("    <sym>Geocache</sym>\r\n");
+				}
 				strBuf.append("    <type>Geocache|").append(CacheType.transType(ch.type)).append("</type>\r\n");
 				String dummyAvailable = ch.is_available ? STRING_TRUE:STRING_FALSE;
 				String dummyArchived = ch.is_archived ? STRING_TRUE:STRING_FALSE;
-				strBuf.append("    <groundspeak:cache available=\"").append( dummyAvailable ).append( "\" archived=\"" ).append( dummyArchived).append( "\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\r\n");
+				strBuf.append("    <groundspeak:cache id=\"").append( ch.GetCacheID() ).append( "\" available=\"" ).append( dummyAvailable ).append( "\" archived=\"" ).append( dummyArchived).append( "\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\r\n");
 				strBuf.append("      <groundspeak:name>").append(SafeXML.cleanGPX(ch.CacheName)).append("</groundspeak:name>\r\n");
 				strBuf.append("      <groundspeak:placed_by>").append(SafeXML.cleanGPX(ch.CacheOwner)).append("</groundspeak:placed_by>\r\n");
 				strBuf.append("      <groundspeak:owner>").append(SafeXML.cleanGPX(ch.CacheOwner)+"</groundspeak:owner>\r\n");
 				strBuf.append("      <groundspeak:type>").append(CacheType.transType(ch.type)).append("</groundspeak:type>\r\n");
 				strBuf.append("      <groundspeak:container>").append(ch.CacheSize).append("</groundspeak:container>\r\n");
-				strBuf.append("      <groundspeak:difficulty>").append(ch.hard.replace(',','.')).append("</groundspeak:difficulty>\r\n");
-				strBuf.append("      <groundspeak:terrain>").append(ch.terrain.replace(',','.')).append("</groundspeak:terrain>\r\n");
+				//for Colorado/Oregon: 2.0 -> 2
+				String diffTerr = ch.hard.replace(',','.');
+				if ( diffTerr.endsWith( ".0" ) ) {
+					diffTerr = diffTerr.substring(0, 1);
+				}
+				strBuf.append("      <groundspeak:difficulty>").append(diffTerr).append("</groundspeak:difficulty>\r\n");
+				diffTerr = ch.terrain.replace(',','.');
+				if ( diffTerr.endsWith( ".0" ) ) {
+					diffTerr = diffTerr.substring(0, 1);
+				}
+				strBuf.append("      <groundspeak:terrain>").append(diffTerr).append("</groundspeak:terrain>\r\n");
 				String dummyHTML = ch.is_HTML ? STRING_TRUE:STRING_FALSE;
 				strBuf.append("      <groundspeak:long_description html=\"" ).append( dummyHTML ).append( "\">\r\n");
 				strBuf.append("      ").append(SafeXML.cleanGPX(ch.LongDescription));



From mik77 at mail.berlios.de  Mon Mar  2 21:49:57 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 21:49:57 +0100
Subject: [Cachewolf-svn] r1664 - experiments/EVEhist/src/cachewolf
Message-ID: <200903022049.n22KnvW6031392@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 21:49:45 +0100 (Mon, 02 Mar 2009)
New Revision: 1664

Modified:
   experiments/EVEhist/src/cachewolf/ProfilesForm.java
Log:
Don't show MAPS as profile if it is upper case

Modified: experiments/EVEhist/src/cachewolf/ProfilesForm.java
===================================================================
--- experiments/EVEhist/src/cachewolf/ProfilesForm.java	2009-03-02 19:18:05 UTC (rev 1663)
+++ experiments/EVEhist/src/cachewolf/ProfilesForm.java	2009-03-02 20:49:45 UTC (rev 1664)
@@ -86,7 +86,7 @@
         // Now add these subdirectories to the list of profiles but
         // exclude the "maps" directory which will contain the moving maps
         for (int i=0; i<existingProfiles.length; i++)
-			if (!existingProfiles[i].equals("maps")) choice.addItem(existingProfiles[i]);
+			if (!existingProfiles[i].equalsIgnoreCase("maps")) choice.addItem(existingProfiles[i]);
         // Highlight the profile that was used last
         choice.selectLastProfile(selectedProfile);
         // Add a scroll bar to the list of profiles



From mik77 at mail.berlios.de  Mon Mar  2 21:51:45 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 21:51:45 +0100
Subject: [Cachewolf-svn] r1665 - in experiments/EVEhist: res_noewe/languages
	src/cachewolf/navi
Message-ID: <200903022051.n22KpjdW031900@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 21:51:34 +0100 (Mon, 02 Mar 2009)
New Revision: 1665

Modified:
   experiments/EVEhist/res_noewe/languages/DE.cfg
   experiments/EVEhist/res_noewe/languages/EN.cfg
   experiments/EVEhist/src/cachewolf/navi/MovingMap.java
Log:
Set new goto target to shown waypoint directly in moving map

Modified: experiments/EVEhist/res_noewe/languages/DE.cfg
===================================================================
--- experiments/EVEhist/res_noewe/languages/DE.cfg	2009-03-02 20:49:45 UTC (rev 1664)
+++ experiments/EVEhist/res_noewe/languages/DE.cfg	2009-03-02 20:51:34 UTC (rev 1665)
@@ -636,6 +636,7 @@
 		4276=Abbrechen
 		4277=Ausw%e4hlen
 		4278=Kann folgende .wfl-Datei nicht laden:+%0a
+		4279=Setze Ziel auf
 		4300=Leer 1 Punkt =+
 		4301=+meter
 		4302=Breite/L%e4nge au%dferhalb des zul%e4ssigen Bereiches beim Lesen von+

Modified: experiments/EVEhist/res_noewe/languages/EN.cfg
===================================================================
--- experiments/EVEhist/res_noewe/languages/EN.cfg	2009-03-02 20:49:45 UTC (rev 1664)
+++ experiments/EVEhist/res_noewe/languages/EN.cfg	2009-03-02 20:51:34 UTC (rev 1665)
@@ -625,6 +625,7 @@
 		4276=Cancel
 		4277=Select
 		4278=Cannot load wfl-file: \n
+		4279=Goto
 		4300=empty 1 Pixel =+
 		4301=+meters
 		4302=Lat/Lon out of range while reading+

Modified: experiments/EVEhist/src/cachewolf/navi/MovingMap.java
===================================================================
--- experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-03-02 20:49:45 UTC (rev 1664)
+++ experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-03-02 20:51:34 UTC (rev 1665)
@@ -1421,7 +1421,7 @@
 	Menu kontextMenu;
 	MenuItem gotoMenuItem = new MenuItem(MyLocale.getMsg(4230, "Goto here$g"), 0, null);
 	MenuItem newWayPointMenuItem = new MenuItem(MyLocale.getMsg(4232, "Create new Waypoint here$n"), 0, null);;
-	MenuItem openCacheDescMenuItem,addCachetoListMenuItem;
+	MenuItem openCacheDescMenuItem,addCachetoListMenuItem,gotoCacheMenuItem;
 
 	MenuItem miLuminary[];
 
@@ -1706,7 +1706,9 @@
 					if (clickedCache != null) {
 						openCacheDescMenuItem = new MenuItem(MyLocale.getMsg(4270, "Open")+" '"+(clickedCache.cacheName.length()>0 ? clickedCache.cacheName : clickedCache.wayPoint)+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
 						kontextMenu.addItem(openCacheDescMenuItem);
-						if (Global.mainForm.cacheListVisible) {
+						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto")+ " '"+(clickedCache.cacheName.length()>0 ? clickedCache.cacheName : clickedCache.wayPoint)+"'$g"); // clickedCache == null can happen if clicked on the goto-symbol
+						kontextMenu.addItem(gotoCacheMenuItem);
+						if (Global.mainForm.cacheListVisible) { 
 							addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
 							kontextMenu.addItem(addCachetoListMenuItem);
 						}
@@ -1820,6 +1822,10 @@
 						MainTab mainT = Global.mainTab;
 						mainT.openDescriptionPanel(clickedCache);
 					}
+					if (action == gotoCacheMenuItem) {
+						kontextMenu.close();
+						mm.myNavigation.setDestination(clickedCache.pos);	
+					}
 					if (action == newWayPointMenuItem) {
 						kontextMenu.close();
 						WindowEvent close = new WindowEvent();
@@ -2162,3 +2168,5 @@
 }
 
 
+
+



From mik77 at mail.berlios.de  Mon Mar  2 21:52:51 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 21:52:51 +0100
Subject: [Cachewolf-svn] r1666 - in experiments/EVEhist/src/cachewolf: . exp
Message-ID: <200903022052.n22KqpIk031949@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 21:52:50 +0100 (Mon, 02 Mar 2009)
New Revision: 1666

Modified:
   experiments/EVEhist/src/cachewolf/CacheHolder.java
   experiments/EVEhist/src/cachewolf/exp/GPXExporter.java
Log:
- CacheId added to GPX-Export for Colorado/Oregon
- Some smaller adjustments for Colorado/Oregon

Modified: experiments/EVEhist/src/cachewolf/CacheHolder.java
===================================================================
--- experiments/EVEhist/src/cachewolf/CacheHolder.java	2009-03-02 20:51:34 UTC (rev 1665)
+++ experiments/EVEhist/src/cachewolf/CacheHolder.java	2009-03-02 20:52:50 UTC (rev 1666)
@@ -607,4 +607,36 @@
    Vm.debug("CacheHolder: "+nObjects+" objects left");
 }
 	 */
-}
\ No newline at end of file
+
+	public String GetCacheID() {
+		String result = "";
+		
+		if ( wayPoint.toUpperCase().startsWith( "GC" ) ) {
+			int gcId = 0;
+
+			String sequence = "0123456789ABCDEFGHJKMNPQRTVWXYZ";
+			
+			String rightPart = wayPoint.substring( 2 ).toUpperCase();
+			
+			int base = 31;
+			if ((rightPart.length() < 4) || (rightPart.length() == 4 && sequence.indexOf(rightPart.charAt(0)) < 16)) {
+				base = 16;
+			}
+			
+			for ( int pos = 0; pos < rightPart.length(); pos++ ) {
+				gcId *= base;
+				gcId += sequence.indexOf(rightPart.charAt(pos));
+			}
+			
+	        if ( base == 31 ) {
+	        	gcId += java.lang.Math.pow(16, 4) - 16 * java.lang.Math.pow(31, 3);
+	        }
+	        
+	        result = Integer.toString(gcId);	        
+		} else if ( wayPoint.toUpperCase().startsWith( "OC" ) ) {
+        	result = ocCacheID;
+        }
+
+		return result;
+	}
+}

Modified: experiments/EVEhist/src/cachewolf/exp/GPXExporter.java
===================================================================
--- experiments/EVEhist/src/cachewolf/exp/GPXExporter.java	2009-03-02 20:51:34 UTC (rev 1665)
+++ experiments/EVEhist/src/cachewolf/exp/GPXExporter.java	2009-03-02 20:52:50 UTC (rev 1666)
@@ -62,18 +62,31 @@
 			strBuf.append("    <url>http://www.geocaching.com/seek/cache_details.aspx?wp=").append(ch.wayPoint).append("&amp;Submit6=Find</url>\r\n");
 			strBuf.append("    <urlname>").append(SafeXML.cleanGPX(ch.cacheName)).append(" by ").append(SafeXML.cleanGPX(ch.cacheOwner)).append("</urlname>\r\n");
 			if (!ch.isAddiWpt()){
-				strBuf.append("    <sym>Geocache</sym>\r\n");
+				if ( ch.is_found ) {
+					strBuf.append("    <sym>Geocache Found</sym>\r\n");					
+				} else {
+					strBuf.append("    <sym>Geocache</sym>\r\n");
+				}
 				strBuf.append("    <type>Geocache|").append(CacheType.transType(ch.type)).append("</type>\r\n");
 				String dummyAvailable = ch.is_available ? STRING_TRUE:STRING_FALSE;
 				String dummyArchived = ch.is_archived ? STRING_TRUE:STRING_FALSE;
-				strBuf.append("    <groundspeak:cache available=\"").append( dummyAvailable ).append( "\" archived=\"" ).append( dummyArchived).append( "\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\r\n");
+				strBuf.append("    <groundspeak:cache id=\"").append( ch.GetCacheID() ).append( "\" available=\"" ).append( dummyAvailable ).append( "\" archived=\"" ).append( dummyArchived).append( "\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\r\n");
 				strBuf.append("      <groundspeak:name>").append(SafeXML.cleanGPX(ch.cacheName)).append("</groundspeak:name>\r\n");
 				strBuf.append("      <groundspeak:placed_by>").append(SafeXML.cleanGPX(ch.cacheOwner)).append("</groundspeak:placed_by>\r\n");
 				strBuf.append("      <groundspeak:owner>").append(SafeXML.cleanGPX(ch.cacheOwner)+"</groundspeak:owner>\r\n");
 				strBuf.append("      <groundspeak:type>").append(CacheType.transType(ch.type)).append("</groundspeak:type>\r\n");
 				strBuf.append("      <groundspeak:container>").append(ch.getCacheSize()).append("</groundspeak:container>\r\n");
-				strBuf.append("      <groundspeak:difficulty>").append(ch.hard.replace(',','.')).append("</groundspeak:difficulty>\r\n");
-				strBuf.append("      <groundspeak:terrain>").append(ch.terrain.replace(',','.')).append("</groundspeak:terrain>\r\n");
+				//for Colorado/Oregon: 2.0 -> 2
+				String diffTerr = ch.hard.replace(',','.');
+				if ( diffTerr.endsWith( ".0" ) ) {
+					diffTerr = diffTerr.substring(0, 1);
+				}
+				strBuf.append("      <groundspeak:difficulty>").append(diffTerr).append("</groundspeak:difficulty>\r\n");
+				diffTerr = ch.terrain.replace(',','.');
+				if ( diffTerr.endsWith( ".0" ) ) {
+					diffTerr = diffTerr.substring(0, 1);
+				}
+				strBuf.append("      <groundspeak:terrain>").append(diffTerr).append("</groundspeak:terrain>\r\n");
 				String dummyHTML = ch.is_HTML ? STRING_TRUE:STRING_FALSE;
 				strBuf.append("      <groundspeak:long_description html=\"" ).append( dummyHTML ).append( "\">\r\n");
 				strBuf.append("      ").append(SafeXML.cleanGPX(ch.longDescription));



From mik77 at mail.berlios.de  Mon Mar  2 22:10:47 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 22:10:47 +0100
Subject: [Cachewolf-svn] r1667 - trunk/src/CacheWolf/navi
Message-ID: <200903022110.n22LAlTK000922@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 22:10:45 +0100 (Mon, 02 Mar 2009)
New Revision: 1667

Modified:
   trunk/src/CacheWolf/navi/GotoPanel.java
Log:
 - speed strings corrected

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-03-02 20:52:50 UTC (rev 1666)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-03-02 21:10:45 UTC (rev 1667)
@@ -597,8 +597,8 @@
 		// Allow for different metric systems
 		if (Global.getPref().metricSystem == Metrics.METRIC) {
 			tmp.set(m_speed);
-			unit = " km";
-			strSpeed = "- km/k";
+			unit = " km/h";
+			strSpeed = "- km/h";
 		} else if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
 			tmp.set(Metrics.convertUnit(m_speed, Metrics.KILOMETER, Metrics.MILES));
 			unit = " mph";



From mik77 at mail.berlios.de  Mon Mar  2 22:55:56 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 22:55:56 +0100
Subject: [Cachewolf-svn] r1668 - trunk/src/CacheWolf/navi
Message-ID: <200903022155.n22LtuPN007036@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 22:55:55 +0100 (Mon, 02 Mar 2009)
New Revision: 1668

Modified:
   trunk/src/CacheWolf/navi/GotoPanel.java
Log:
Always use metric system, if nothing else is set.

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-03-02 21:10:45 UTC (rev 1667)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-03-02 21:55:55 UTC (rev 1668)
@@ -553,17 +553,17 @@
 		int smallUnit = -1;
 		double threshold = -1;
 		// Allow for different metric systems
-		if (metricSystem == Metrics.METRIC) {
-			bigUnit = Metrics.KILOMETER;
-			smallUnit = Metrics.METER;
-			threshold = 1.0;
-			newDistance = distance;
-		} else if (metricSystem == Metrics.IMPERIAL) {
+		if (metricSystem == Metrics.IMPERIAL) {
 			// Why these values? See: http://tinyurl.com/b4nn9m
 			bigUnit = Metrics.MILES;
 			smallUnit = Metrics.FEET;
 			threshold = 0.1;
 			newDistance = Metrics.convertUnit(distance, Metrics.KILOMETER, Metrics.MILES);
+		} else {
+			bigUnit = Metrics.KILOMETER;
+			smallUnit = Metrics.METER;
+			threshold = 1.0;
+			newDistance = distance;
 		}
 		if ( newDistance >= 0.0f ) {
 			tmp.set(newDistance);
@@ -595,14 +595,14 @@
 		String unit = null;
 
 		// Allow for different metric systems
-		if (Global.getPref().metricSystem == Metrics.METRIC) {
+		if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
+			tmp.set(Metrics.convertUnit(m_speed, Metrics.KILOMETER, Metrics.MILES));
+			unit = " mph";
+			strSpeed = "- mph";
+		} else {
 			tmp.set(m_speed);
 			unit = " km/h";
 			strSpeed = "- km/h";
-		} else if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
-			tmp.set(Metrics.convertUnit(m_speed, Metrics.KILOMETER, Metrics.MILES));
-			unit = " mph";
-			strSpeed = "- mph";
 		}
 		if (tmp.value >= 0) {
 			if (tmp.value >= 100) {



From greiol at mail.berlios.de  Mon Mar  2 23:04:58 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 2 Mar 2009 23:04:58 +0100
Subject: [Cachewolf-svn] r1669 - trunk/docs
Message-ID: <200903022204.n22M4wcM007779@sheep.berlios.de>

Author: greiol
Date: 2009-03-02 23:04:18 +0100 (Mon, 02 Mar 2009)
New Revision: 1669

Modified:
   trunk/docs/cachewolf_auf_linux_bauen.txt
Log:
typos fixed

Modified: trunk/docs/cachewolf_auf_linux_bauen.txt
===================================================================
--- trunk/docs/cachewolf_auf_linux_bauen.txt	2009-03-02 21:55:55 UTC (rev 1668)
+++ trunk/docs/cachewolf_auf_linux_bauen.txt	2009-03-02 22:04:18 UTC (rev 1669)
@@ -19,13 +19,13 @@
 ======================
 
 Viele CW-Entwickler arbeiten mit Windows und dort nutzt eclipse zunaechst die
-Standardzeichenkodierung windows-1252. Ich habe jedoch noch kein Linux Version
+Standardzeichenkodierung windows-1252. Ich habe jedoch noch keine Linux Version
 mit brauchbarer windows-1252 Unterstuetzung gefunden. Das naechstbeste was
 Linux bietet ist ISO-8859-1. Wenn du den Sourcecode als ISO-8859-1 anzeigen
 laesst (rechte Maustaste / Eigenschaten) wird fast(!) alles korrekt angezeigt.
 Aber:
 
-Die beiden Zeichensaetze sind nicht identisch!
+!!Die beiden Zeichensaetze sind nicht identisch!!
 
 Um herauszufinden welche Dateien Probleme bereiten koennen, kannst du das Tool
 pcregrep benutzen (eventuell musst du es nachinstallieren) und dann folgendes
@@ -44,4 +44,4 @@
 
 Aenderungen (bzw. Commits ins SVN-Repository) an Dateien die von diesem Script 
 gemeldet werden, solltest du vorsichtshalber von einem Mitentwickler der Windows 
-benutzt vornehmen lassen, damit es nicht zu Durcheinander kommt.
+benutzt vornehmen lassen, damit es nicht zu Durcheinander kommt.
\ No newline at end of file



From mik77 at mail.berlios.de  Mon Mar  2 23:11:33 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 2 Mar 2009 23:11:33 +0100
Subject: [Cachewolf-svn] r1670 - in trunk/src/CacheWolf: . navi
Message-ID: <200903022211.n22MBXAB008163@sheep.berlios.de>

Author: mik77
Date: 2009-03-02 23:11:31 +0100 (Mon, 02 Mar 2009)
New Revision: 1670

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Always use metric system, if nothing else is set. (Some more places)

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-03-02 22:04:18 UTC (rev 1669)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-03-02 22:11:31 UTC (rev 1670)
@@ -252,20 +252,20 @@
 			if (this.kilom >= 0) {
 				double newValue = 0;
 				switch (Global.getPref().metricSystem) {
+				case Metrics.IMPERIAL:
+					newValue = Metrics.convertUnit(this.kilom, Metrics.KILOMETER, Metrics.MILES);
+					newUnit = Metrics.getUnit(Metrics.MILES);
+					break;
 				case Metrics.METRIC:
+				default:
 					newValue = this.kilom;
 					newUnit = Metrics.getUnit(Metrics.KILOMETER);
 					break;
-				case Metrics.IMPERIAL:
-					newValue = Metrics.convertUnit(this.kilom, Metrics.KILOMETER, Metrics.MILES);
-					newUnit = Metrics.getUnit(Metrics.MILES);
-					break;
 				}
 				result = MyLocale.formatDouble(newValue, "0.00") + " " + newUnit;
 			} else {
 				result = "? "
-				        + (Global.getPref().metricSystem == Metrics.METRIC ? Metrics
-				                .getUnit(Metrics.KILOMETER) : Metrics.getUnit(Metrics.MILES));
+				        + (Global.getPref().metricSystem == Metrics.IMPERIAL ? Metrics.getUnit(Metrics.MILES) : Metrics.getUnit(Metrics.KILOMETER));
 			}
 			// Caching values, so reevaluation is only done when really needed
 			this.lastKilom = this.kilom;

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-03-02 22:04:18 UTC (rev 1669)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-03-02 22:11:31 UTC (rev 1670)
@@ -320,18 +320,18 @@
 				int smallUnit = -1;
 				double threshold = -1;
 				// Allow for different metric systems
-				if (metricSystem == Metrics.METRIC) {
-					bigUnit = Metrics.KILOMETER;
-					smallUnit = Metrics.METER;
-					threshold = 1.0;
-					localizedDistance = currentDistance;
-				} else if (metricSystem == Metrics.IMPERIAL) {
+				if (metricSystem == Metrics.IMPERIAL) {
 					// Why these values? See: http://tinyurl.com/b4nn9m
 					bigUnit = Metrics.MILES;
 					smallUnit = Metrics.FEET;
 					threshold = 0.1;
 					localizedDistance = Metrics.convertUnit(currentDistance, Metrics.KILOMETER, Metrics.MILES);
-				}
+				} else {
+					bigUnit = Metrics.KILOMETER;
+					smallUnit = Metrics.METER;
+					threshold = 1.0;
+					localizedDistance = currentDistance;
+				} 
 				dd.set(localizedDistance);
 				if (dd.value >= threshold){
 					d = MyLocale.formatDouble(dd,"0.000") + Metrics.getUnit(bigUnit);



From wpawlas at online.de  Tue Mar  3 07:52:25 2009
From: wpawlas at online.de (Waldemar Pawlasczyk)
Date: Tue, 03 Mar 2009 07:52:25 +0100
Subject: [Cachewolf-svn] (kein Betreff)
Message-ID: <49ACD3A9.90506@online.de>




From mik77 at mail.berlios.de  Tue Mar  3 09:51:11 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 3 Mar 2009 09:51:11 +0100
Subject: [Cachewolf-svn] r1671 - trunk/src/CacheWolf
Message-ID: <200903030851.n238pBpc025284@sheep.berlios.de>

Author: mik77
Date: 2009-03-03 09:51:05 +0100 (Tue, 03 Mar 2009)
New Revision: 1671

Modified:
   trunk/src/CacheWolf/CWPoint.java
Log:
Let's allow NW and SE again.

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2009-03-02 22:11:31 UTC (rev 1670)
+++ trunk/src/CacheWolf/CWPoint.java	2009-03-03 08:51:05 UTC (rev 1671)
@@ -439,7 +439,7 @@
 	 */
 	public String getNSLetter() {
             String result = "N";
-            if (this.latDec >= -90 && this.lonDec < 0) {
+            if (this.latDec >= -90 && this.latDec < 0) {
                 result = "S";
             }
             return  result;



From engywuck at mail.berlios.de  Tue Mar  3 18:20:10 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Tue, 3 Mar 2009 18:20:10 +0100
Subject: [Cachewolf-svn] r1672 - trunk/src/CacheWolf/navi
Message-ID: <200903031720.n23HKAS5005071@sheep.berlios.de>

Author: engywuck
Date: 2009-03-03 18:20:09 +0100 (Tue, 03 Mar 2009)
New Revision: 1672

Modified:
   trunk/src/CacheWolf/navi/Metrics.java
Log:
- Adding JavaDoc to convert function
- Improving Exception message when trying unsupported unit conversion

Modified: trunk/src/CacheWolf/navi/Metrics.java
===================================================================
--- trunk/src/CacheWolf/navi/Metrics.java	2009-03-03 08:51:05 UTC (rev 1671)
+++ trunk/src/CacheWolf/navi/Metrics.java	2009-03-03 17:20:09 UTC (rev 1672)
@@ -3,6 +3,8 @@
  */
 package CacheWolf.navi;
 
+import CacheWolf.Global;
+
 /**
  * @author Engywuck
  *
@@ -25,6 +27,17 @@
 	private static final double FCT_MILE2YARD = 1760;
 	private static final double FCT_MILE2FOOT = 5280;
 	
+	/**
+	 * Converts values from one to another unit.
+	 * @param value Value to convert
+	 * @param sourceUnit Constant from class Metrics to represent unit in which 
+	 * <code>value</code> is meant. 
+	 * @param targetUnit Constant from class Metrics to represent the unit in 
+	 * which <code>value</code> has to be transformed
+	 * @return The new converted value
+	 * @throws UnsupportedOperationException when the conversion between the two units
+	 * is not programmed.
+	 */
 	public static final double convertUnit(double value, int sourceUnit, int targetUnit) {
 		double result = Double.NaN;
 		if (sourceUnit == targetUnit) {
@@ -113,9 +126,9 @@
 				break;
 			}
 		}
-		if (result == Double.NaN) {
-			// TODO Meldung verbessern
-			throw new UnsupportedOperationException("Cannot convert");
+		if (String.valueOf(result).equals("NaN")) {
+			Global.getPref().log("Cannot convert "+getUnit(sourceUnit)+ " to "+getUnit(targetUnit));
+			throw new UnsupportedOperationException("Cannot convert "+getUnit(sourceUnit)+ " to "+targetUnit);
 		}
 		return result;
 	}



From araber95 at mail.berlios.de  Wed Mar  4 19:40:40 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 4 Mar 2009 19:40:40 +0100
Subject: [Cachewolf-svn] r1673 - trunk/src/CacheWolf/navi
Message-ID: <200903041840.n24IeeXe002824@sheep.berlios.de>

Author: araber95
Date: 2009-03-04 19:40:18 +0100 (Wed, 04 Mar 2009)
New Revision: 1673

Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
Trennlinie bei Auswahl mapServices nach Services deren BoundingBox das aktuelle Zentrum einschliesst.
Seperator in Choice of mapService after services with BoundingBox surrounding the active center.

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-03 17:20:09 UTC (rev 1672)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-04 18:40:18 UTC (rev 1673)
@@ -139,24 +139,28 @@
 	 *
 	 */	
 	private void sortMapServices() {
-		sortingMapServices = new int[unsortedMapServices.length];
+		sortingMapServices = new int[unsortedMapServices.length+1];
 		inbound = new boolean[unsortedMapServices.length];
 		int j=0;
-		for (int i=0; i < sortingMapServices.length; i++) {
+		for (int i=0; i < sortingMapServices.length-1; i++) {
 			if( ((OnlineMapService)mapLoader.onlineMapServices.get(i)).boundingBox.isInBound(center)) {
 				sortingMapServices[j] = i;
 				j++;
 				inbound[i] = true;
 			} else inbound[i] = false;
 		}
-		sortedmapServices = new String[unsortedMapServices.length];
-		for (int i=0; i < sortedmapServices.length; i++) {
+		int k=j;
+		sortedmapServices = new String[unsortedMapServices.length+1];
+		for (int i=0; i < sortedmapServices.length-1; i++) {
 			if (!inbound[i]) { 
 				sortingMapServices[j] = i;
 				j++;
 			}
 			sortedmapServices[i] = ((OnlineMapService)mapLoader.onlineMapServices.get(sortingMapServices[i])).getName();
 		}
+		sortedmapServices[j]=sortedmapServices[k];
+		sortedmapServices[k]="===== ===== ===== ===== ===== ===== =====";
+		sortingMapServices[j]=sortingMapServices[k];
 	}
 	
 	private int getSortedMapServiceIndex(int originalindex) {



From engywuck at mail.berlios.de  Wed Mar  4 22:39:17 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Wed, 4 Mar 2009 22:39:17 +0100
Subject: [Cachewolf-svn] r1674 - experiments/EVEhist/src/cachewolf
Message-ID: <200903042139.n24LdH2A015518@sheep.berlios.de>

Author: engywuck
Date: 2009-03-04 22:39:15 +0100 (Wed, 04 Mar 2009)
New Revision: 1674

Modified:
   experiments/EVEhist/src/cachewolf/CWPoint.java
Log:
Let's allow NW and SE even for EVE.

Modified: experiments/EVEhist/src/cachewolf/CWPoint.java
===================================================================
--- experiments/EVEhist/src/cachewolf/CWPoint.java	2009-03-04 18:40:18 UTC (rev 1673)
+++ experiments/EVEhist/src/cachewolf/CWPoint.java	2009-03-04 21:39:15 UTC (rev 1674)
@@ -445,7 +445,7 @@
 	 */
 	public String getNSLetter() {
         String result = "N";
-        if (this.latDec >= -90 && this.lonDec < 0) {
+        if (this.latDec >= -90 && this.latDec < 0) {
             result = "S";
         }
         return  result;



From pfeffer at mail.berlios.de  Thu Mar  5 00:13:24 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 5 Mar 2009 00:13:24 +0100
Subject: [Cachewolf-svn] r1675 - in trunk: res_noewe/languages
	src/CacheWolf/navi
Message-ID: <200903042313.n24NDOH7024655@sheep.berlios.de>

Author: pfeffer
Date: 2009-03-05 00:13:23 +0100 (Thu, 05 Mar 2009)
New Revision: 1675

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
MapLoaderGUI: give an error if separetor line is selected as WMS

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-04 21:39:15 UTC (rev 1674)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-04 23:13:23 UTC (rev 1675)
@@ -455,6 +455,7 @@
 		1830=Der gew%e4hlte Kartendienst bietet Karten in einem Ma%dfstab von 
 		1831= bis 
 		1832=%0a Bitte 'Ca. m pro Pixel' entsprechend anpassen
+		1833=Bitte w?hlen Sie nicht die Trennlinie als WMS-Service
 		2000=GPX Export
 		2001=von
 		2100=Explorist Exporter

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-04 21:39:15 UTC (rev 1674)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-04 23:13:23 UTC (rev 1675)
@@ -455,6 +455,7 @@
 		1830=The selected online map service provides map in the scale from 
 		1831= to 
 		1832=%0a please adjust 'Approx. meter pro pixel' accordingly
+		1833=Please don't select the separetor line in the wms service option
 		2000=GPX Export
 		2001=of
 		2500=Error loading attributes or unknown attribute

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-04 21:39:15 UTC (rev 1674)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-04 23:13:23 UTC (rev 1675)
@@ -161,6 +161,7 @@
 		sortedmapServices[j]=sortedmapServices[k];
 		sortedmapServices[k]="===== ===== ===== ===== ===== ===== =====";
 		sortingMapServices[j]=sortingMapServices[k];
+		sortingMapServices[k]=-1;
 	}
 	
 	private int getSortedMapServiceIndex(int originalindex) {
@@ -276,6 +277,9 @@
 				this.close(FormBase.IDCANCEL);
 			}
 			if (ev.target == okBtiles || ev.target == okBPerCache){
+				if (sortingMapServices[mapServiceChoice.selectedIndex] == -1) {
+					(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1833, "Please don't select the separetor line in the wms service option"), FormBase.OKB)).execute(); 
+				}
 				mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
 				if (ev.target == okBtiles) { // get tiles
 					perCache = false;



From engywuck at mail.berlios.de  Thu Mar  5 18:11:50 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Thu, 5 Mar 2009 18:11:50 +0100
Subject: [Cachewolf-svn] r1676 - in trunk/src/CacheWolf: . navi
Message-ID: <200903051711.n25HBow9011918@sheep.berlios.de>

Author: engywuck
Date: 2009-03-05 18:11:48 +0100 (Thu, 05 Mar 2009)
New Revision: 1676

Modified:
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/navi/Metrics.java
Log:
Redesign of conversion function. 

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-03-04 23:13:23 UTC (rev 1675)
+++ trunk/src/CacheWolf/Parser.java	2009-03-05 17:11:48 UTC (rev 1676)
@@ -487,8 +487,7 @@
     	double distKM = cwPt.getDistance(new CWPoint(coordB));
     	result = distKM*1000.0;
     	if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
-    		result = Metrics.convertUnit(distKM, Metrics.KILOMETER, Metrics.MILES);
-    		result = Metrics.convertUnit(result, Metrics.MILES, Metrics.YARDS);
+    		result = Metrics.convertUnit(distKM, Metrics.KILOMETER, Metrics.YARDS);
     	}
     	return result;
     }
@@ -629,8 +628,7 @@
 		if (!isValidCoord(coord)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coord);
     	cwPt.set(coord);
     	if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
-    		distance = Metrics.convertUnit(distance, Metrics.YARDS, Metrics.MILES);
-    		distance = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
+    		distance = Metrics.convertUnit(distance, Metrics.YARDS, Metrics.KILOMETER);
     	} else {
     		distance = distance / 1000.0;
     	}

Modified: trunk/src/CacheWolf/navi/Metrics.java
===================================================================
--- trunk/src/CacheWolf/navi/Metrics.java	2009-03-04 23:13:23 UTC (rev 1675)
+++ trunk/src/CacheWolf/navi/Metrics.java	2009-03-05 17:11:48 UTC (rev 1676)
@@ -29,107 +29,80 @@
 	
 	/**
 	 * Converts values from one to another unit.
-	 * @param value Value to convert
-	 * @param sourceUnit Constant from class Metrics to represent unit in which 
-	 * <code>value</code> is meant. 
-	 * @param targetUnit Constant from class Metrics to represent the unit in 
-	 * which <code>value</code> has to be transformed
+	 * 
+	 * @param value
+	 *            Value to convert
+	 * @param sourceUnit
+	 *            Constant from class Metrics to represent unit in which <code>value</code> is
+	 *            meant.
+	 * @param targetUnit
+	 *            Constant from class Metrics to represent the unit in which <code>value</code>
+	 *            has to be transformed
 	 * @return The new converted value
-	 * @throws UnsupportedOperationException when the conversion between the two units
-	 * is not programmed.
+	 * @throws UnsupportedOperationException
+	 *             when the conversion between the two units is not programmed.
 	 */
 	public static final double convertUnit(double value, int sourceUnit, int targetUnit) {
+		/*
+		 * Strategy: For each metrical system we define a standard unit: km and mi. In a first step
+		 * any input value is converted to the standard unit in its system Then (if required) the
+		 * standard units are converted between the systems. Last step: The converted unit is
+		 * converted to the target unit (which is in the same metrical system).
+		 */
+
 		double result = Double.NaN;
-		if (sourceUnit == targetUnit) {
-			result = value;
-		} else {
-			switch (sourceUnit) {
-			case KILOMETER:
-				switch (targetUnit) {
-				case METER:
-					result = value * 1000;
-					break;
-				case MILES:
-					result = value / FCT_MILE2KILOMETER;
-					break;
-				case YARDS:
-					result = (value / FCT_MILE2KILOMETER) * FCT_MILE2YARD;
-					break;
-				case FEET:
-					result = (value / FCT_MILE2KILOMETER) * FCT_MILE2FOOT;
-					break;
-				}
-				break;
-			case METER:
-				switch (targetUnit) {
-				case KILOMETER:
-					result = value / 1000;
-					break;
-				case MILES:
-					result = (value / 1000) / FCT_MILE2KILOMETER;
-					break;
-				case YARDS:
-					result = ((value / 1000) / FCT_MILE2KILOMETER) * FCT_MILE2YARD;
-					break;
-				case FEET:
-					result = ((value / 1000) / FCT_MILE2KILOMETER) * FCT_MILE2FOOT;
-					break;
-				}
-				break;
-			case MILES:
-				switch (targetUnit) {
-				case KILOMETER:
-					result = value * FCT_MILE2KILOMETER;
-					break;
-				case METER:
-					result = value * FCT_MILE2KILOMETER * 1000;
-					break;
-				case YARDS:
-					result = value * FCT_MILE2YARD;
-					break;
-				case FEET:
-					result = value * FCT_MILE2FOOT;
-					break;
-				}
-				break;
-			case YARDS:
-				switch (targetUnit) {
-				case KILOMETER:
-					result = (value / FCT_MILE2YARD) * FCT_MILE2KILOMETER;
-					break;
-				case METER:
-					result = (value / FCT_MILE2YARD) * FCT_MILE2KILOMETER * 1000;
-					break;
-				case MILES:
-					result = value / FCT_MILE2YARD;
-					break;
-				case FEET:
-					result = value / FCT_MILE2YARD * FCT_MILE2FOOT;
-					break;
-				}
-				break;
-			case FEET:
-				switch (targetUnit) {
-				case KILOMETER:
-					result = (value / FCT_MILE2FOOT) * FCT_MILE2KILOMETER;
-					break;
-				case METER:
-					result = (value / FCT_MILE2FOOT) * FCT_MILE2KILOMETER * 1000;
-					break;
-				case MILES:
-					result = value / FCT_MILE2FOOT;
-					break;
-				case YARDS:
-					result = value * FCT_MILE2YARD / FCT_MILE2FOOT;
-					break;
-				}
-				break;
-			}
-		}
-		if (String.valueOf(result).equals("NaN")) {
-			Global.getPref().log("Cannot convert "+getUnit(sourceUnit)+ " to "+getUnit(targetUnit));
-			throw new UnsupportedOperationException("Cannot convert "+getUnit(sourceUnit)+ " to "+targetUnit);
-		}
+	    if (sourceUnit == targetUnit) {
+	    	result = value;
+	    } else {
+	    	double stdValue;
+	    	int sourceStdUnit = getMetricSystemStdUnit(sourceUnit);
+	    	int targetStdUnit = getMetricSystemStdUnit(targetUnit);
+	    	switch (sourceUnit) {
+	    	case KILOMETER:
+	    	case MILES:
+	    		stdValue = value;
+	    		break;
+	    	case METER: 
+	    		stdValue = value / 1000.0;
+	    		break;
+	    	case YARDS:
+	    		stdValue = value / FCT_MILE2YARD;
+	    		break;
+	    	case FEET:
+	    		stdValue = value / FCT_MILE2FOOT;
+	    		break;
+	    	default:
+	    		Global.getPref().log("Cannot convert unit"+getUnit(sourceUnit));
+	    		throw new UnsupportedOperationException("Cannot convert unit"+getUnit(sourceUnit));
+	    	}
+	    	
+	    	// Convert between standard units of imperial systems
+	    	if (sourceStdUnit == KILOMETER && targetStdUnit == MILES) {
+	    		stdValue = stdValue / FCT_MILE2KILOMETER; 
+	    	} else if (sourceStdUnit == MILES && targetStdUnit == KILOMETER) {
+	    		stdValue = stdValue * FCT_MILE2KILOMETER; 
+	    	} 
+	    	
+	    	// Convert to unit from standard unit
+	    	switch (targetUnit) {
+	    	case KILOMETER:
+	    	case MILES:
+	    		result = stdValue;
+	    		break;
+	    	case METER: 
+	    		result = stdValue * 1000.0;
+	    		break;
+	    	case YARDS:
+	    		result = stdValue * FCT_MILE2YARD;
+	    		break;
+	    	case FEET:
+	    		result = stdValue * FCT_MILE2FOOT;
+	    		break;
+	    	default:
+	    		Global.getPref().log("Cannot convert unit"+getUnit(targetUnit));
+	    		throw new UnsupportedOperationException("Cannot convert unit"+getUnit(targetUnit));
+	    	}
+	    }	
 		return result;
 	}
 	
@@ -156,4 +129,23 @@
 		}
 		return result;
 	}
+	
+	/**
+	 * Returns the constant for the metric systems standard unit (km or mi.) a given unit belongs to.
+	 * @param unit Unit to examine
+	 * @return Constant of the standard unit
+	 */
+	private static int getMetricSystemStdUnit(int unit) {
+		switch (unit) {
+		case KILOMETER:
+		case METER:
+			return KILOMETER;
+		case MILES:
+		case YARDS:
+		case FEET:
+			return MILES;
+		default:
+			throw new UnsupportedOperationException("Unknown unit: "+String.valueOf(unit));			
+		}
+	}
 }



From pfeffer at mail.berlios.de  Thu Mar  5 23:52:44 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 5 Mar 2009 23:52:44 +0100
Subject: [Cachewolf-svn] r1677 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200903052252.n25Mqina023470@sheep.berlios.de>

Author: pfeffer
Date: 2009-03-05 23:52:42 +0100 (Thu, 05 Mar 2009)
New Revision: 1677

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
Log:
better gpsbabel integration, should work now in linux

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-05 17:11:48 UTC (rev 1676)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-05 22:52:42 UTC (rev 1677)
@@ -104,6 +104,7 @@
 		212=Alle .xml Dateien (und Bilder) l%f6schen, die nicht in index.xml sind
 		213=Verwaiste .xml Dateien l%f6schen
 		214=Neuer Wegpunkt
+		215=nach LOC
 		300=Type:
 		301=Gr%f6%dfe:
 		302=Wegpunkt:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-05 17:11:48 UTC (rev 1676)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-05 22:52:42 UTC (rev 1677)
@@ -104,6 +104,7 @@
 		212=Delete all .xml files not in index.xml and associated pictures
 		213=Deleting orphans
 		214=New Waypoint
+		215=to LOC
 		300=Type:
 		301=Size:
 		302=Waypoint:
@@ -125,7 +126,6 @@
 		318=Found
 		319=Not Found
 		320=Owner
-		320=Besitzer
 		321=Error
 		322=Couldn't find image/map
 		323=Fehler beim Schreiben der Datei

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-03-05 17:11:48 UTC (rev 1676)
+++ trunk/src/CacheWolf/MainMenu.java	2009-03-05 22:52:42 UTC (rev 1677)
@@ -30,7 +30,7 @@
 	private MenuItem exportpcx5, exporthtml, exporttop50, exportGPX, exportASC, exportTomTom, exportMSARCSV;
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
-	private MenuItem exportGPS, exportCacheMate,mnuSeparator;
+	private MenuItem exportLOC, exportGPS, exportCacheMate,mnuSeparator;
 	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild;
 	public MenuItem cacheTour,orgTravelbugs, mnuForceLogin;
 	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditCenter;
@@ -66,7 +66,7 @@
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for export, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] exitems = new MenuItem[12];
+		MenuItem[] exitems = new MenuItem[13];
 		//Vm.debug("Hi in MainMenu "+lr);
 		exitems[0] = exporthtml = new MenuItem(MyLocale.getMsg(100,"to HTML"));
 		exitems[1] = exportpcx5 = new MenuItem(MyLocale.getMsg(101,"to PCX5 Mapsource"));
@@ -75,14 +75,21 @@
 		exitems[4] = exportASC = new MenuItem(MyLocale.getMsg(104,"to CSV"));
 		exitems[5] = exportTomTom = new MenuItem(MyLocale.getMsg(105,"to TomTom"));
 		exitems[6] = exportMSARCSV = new MenuItem(MyLocale.getMsg(106,"to MS AutoRoute CSV"));
-		exitems[7] = exportGPS = new MenuItem(MyLocale.getMsg(122,"to GPS"));
-		if(!(new File(cwd + "/gpsbabel.exe")).exists()) exitems[7].modifiers = MenuItem.Disabled;
+		exitems[7] = exportLOC = new MenuItem(MyLocale.getMsg(215,"to LOC"));
+		exitems[8] = exportGPS = new MenuItem(MyLocale.getMsg(122,"to GPS"));
+		try{
+			// this will *only* work with ewe.jar at the moment
+			ewe.sys.Process p = Vm.exec("gpsbabel -V");
+			p.waitFor();
+		}catch(IOException ioex){
+			exitems[8].modifiers = MenuItem.Disabled;
+		}
 		//exitems[8] = exportCacheMate = new MenuItem(MyLocale.getMsg(123,"to Cachemate"));
 		//if(!(new File(cwd + "/cmconvert/cmconvert.exe")).exists()) exitems[8].modifiers = MenuItem.Disabled;
-		exitems[8] = exportOZI = new MenuItem(MyLocale.getMsg(124,"to OZI"));
-		exitems[9] = exportKML = new MenuItem(MyLocale.getMsg(125,"to Google Earth"));
-		exitems[10] = exportExplorist = new MenuItem(MyLocale.getMsg(132,"to Explorist"));
-		exitems[11] = exportTPL = new MenuItem(MyLocale.getMsg(128,"via Template"));
+		exitems[9] = exportOZI = new MenuItem(MyLocale.getMsg(124,"to OZI"));
+		exitems[10] = exportKML = new MenuItem(MyLocale.getMsg(125,"to Google Earth"));
+		exitems[11] = exportExplorist = new MenuItem(MyLocale.getMsg(132,"to Explorist"));
+		exitems[12] = exportTPL = new MenuItem(MyLocale.getMsg(128,"via Template"));
 
 		Menu exportMenu = new Menu(exitems, MyLocale.getMsg(107,"Export"));
 
@@ -357,6 +364,10 @@
 				MSARCSVExporter msar = new MSARCSVExporter(pref,profile);
 				msar.doIt();
 			}
+			if(mev.selectedItem == exportLOC){
+				LocExporter loc = new LocExporter();
+				loc.doIt();
+			}
 			if(mev.selectedItem == exportGPS){
 				Vm.showWait(true);
 				LocExporter loc = new LocExporter();
@@ -365,9 +376,9 @@
 				loc.doIt(LocExporter.MODE_AUTO);
 				ProgressBarForm.display(MyLocale.getMsg(950,"Transfer"),MyLocale.getMsg(951,"Sending to GPS"), null);
 				try{
-					pref.log("gpsbabel.exe "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					pref.log("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
 					// this will *only* work with ewe.jar at the moment
-					ewe.sys.Process p = Vm.exec("gpsbabel.exe "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					ewe.sys.Process p = Vm.exec("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
 					p.waitFor();
 				}catch(IOException ioex){
 					Vm.showWait(false);

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-03-05 17:11:48 UTC (rev 1676)
+++ trunk/src/CacheWolf/Preferences.java	2009-03-05 22:52:42 UTC (rev 1677)
@@ -657,6 +657,7 @@
 	 * @param text to log
 	 */
 	public void log(String text){
+		Vm.debug(text);
 		Time dtm = new Time();
 		dtm.getTime();
 		dtm.setFormat("dd.MM.yyyy'/'HH:mm");



From mirabilos at mail.berlios.de  Fri Mar  6 12:34:08 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Fri, 6 Mar 2009 12:34:08 +0100
Subject: [Cachewolf-svn] r1678 - trunk
Message-ID: <200903061134.n26BY8Tj019940@sheep.berlios.de>

Author: mirabilos
Date: 2009-03-06 12:34:07 +0100 (Fri, 06 Mar 2009)
New Revision: 1678

Modified:
   trunk/fwrtsnapshot.sh
Log:
after reading http://pub.naturalnet.de/~nik/CacheWolf-BE/zlog_fwrtsnapshot.txt
attempt to improve the build process (this includes delivering the
untested WMSes to the user as well)


Modified: trunk/fwrtsnapshot.sh
===================================================================
--- trunk/fwrtsnapshot.sh	2009-03-05 22:52:42 UTC (rev 1677)
+++ trunk/fwrtsnapshot.sh	2009-03-06 11:34:07 UTC (rev 1678)
@@ -2,7 +2,9 @@
 # $Id$
 
 PATH=$PATH:/usr/local/bin:/usr/bin:$HOME/bin
-export PATH
+LC_ALL=C
+unset LANG LANGUAGE
+export PATH LC_ALL
 
 # natureshadow insists on using ?which?? so be it
 # allow the caller to override the paths to the tools
@@ -11,7 +13,7 @@
 
 set -x
 v=$(svn info | sed -n '/Revision: /s///p')
-printf '/VER_SVN =/s/\$.*\$/$LastChangedRevision: %s $/\nwq\n' $v | \
+printf '/VER_SVN =/s/\$.*\$/$LastChanged''Revision: %s $/\nw\nq\n' $v | \
     ed -s src/CacheWolf/Version.java
 rm -rf bin
 mkdir -p bin/CacheWolf
@@ -28,22 +30,16 @@
 	exit 1
 fi
 mkdir -p published/dat/attributes
-mkdir -p published/dat/webmapservices
-mkdir -p published/dat/languages
 mv programs/CacheWolf/* published/
-chmod 755 published/*
 cp lib/java_ewe.dll published/Jar/
-chmod 644 published/*/*
-chmod 755 published/dat/attributes
-chmod 755 published/dat/webmapservices
-chmod 755 published/dat/languages
-printf '1,$g/ 12M/s///\nwq\n' | ed -s published/Jar/CacheWolf.bat
-install -c -m 644 work/CacheWolf.ewe published/
-install -c -m 644 res_noewe/* published/dat/
-install -c -m 644 resources/attributes-big/*.gif published/dat/attributes/
-install -c -m 644 resources/attributes/*-non.gif published/dat/attributes/
-install -c -m 644 res_noewe/webmapservices/* published/dat/webmapservices/
-install -c -m 644 res_noewe/languages/* published/dat/languages/
+chmod -R u+w published
+printf '1,$g/ 12M/s///\nw\nq\n' | ed -s published/Jar/CacheWolf.bat
+cp work/CacheWolf.ewe published/
+(cd res_noewe && cp -R * ../published/dat/)
+cp resources/attributes-big/*.gif resources/attributes/*-non.gif \
+    published/dat/attributes/
+chmod -R 0755 published
+find published -type f -print0 | xargs -0 chmod 0644
 (
 	cd published/dat
 	find * -type f | sort >../flst



From mirabilos at mail.berlios.de  Fri Mar  6 13:30:23 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Fri, 6 Mar 2009 13:30:23 +0100
Subject: [Cachewolf-svn] r1679 - trunk
Message-ID: <200903061230.n26CUNji009718@sheep.berlios.de>

Author: mirabilos
Date: 2009-03-06 13:30:22 +0100 (Fri, 06 Mar 2009)
New Revision: 1679

Modified:
   trunk/fwrtsnapshot.sh
Log:
we do not want to package the .svn meta-directories into the
datfiles tarball/zipfile


Modified: trunk/fwrtsnapshot.sh
===================================================================
--- trunk/fwrtsnapshot.sh	2009-03-06 11:34:07 UTC (rev 1678)
+++ trunk/fwrtsnapshot.sh	2009-03-06 12:30:22 UTC (rev 1679)
@@ -42,7 +42,7 @@
 find published -type f -print0 | xargs -0 chmod 0644
 (
 	cd published/dat
-	find * -type f | sort >../flst
+	find * -type f | fgrep -v /.svn/ | sort >../flst
 	$CPIO -oC512 -Hustar -Mdist <../flst | gzip -n9 >../datfiles.tgz
 	zip -X ../datfiles.zip -@ <../flst
 )



From mirabilos at mail.berlios.de  Fri Mar  6 21:45:27 2009
From: mirabilos at mail.berlios.de (mirabilos at mail.berlios.de)
Date: Fri, 6 Mar 2009 20:45:27 +0000 (UTC)
Subject: [Cachewolf-svn] r1645 - trunk/src/CacheWolf/navi
In-Reply-To: <200902211353.n1LDrgoh015248@sheep.berlios.de>
References: <200902211353.n1LDrgoh015248@sheep.berlios.de>
Message-ID: <Pine.BSM.4.64L.0903062045050.31507@herc.mirbsd.org>

mirabilos at BerliOS dixit:

>New Revision: 1645

>commit untested diff that has been lying around in my tree since 2008-10-17:

Tested now, works well.

//mirabilos
-- 
?It is inappropriate to require that a time represented as
 seconds since the Epoch precisely represent the number of
 seconds between the referenced time and the Epoch.?
	-- IEEE Std 1003.1b-1993 (POSIX) Section B.2.2.2


From pfeffer at mail.berlios.de  Sun Mar  8 00:59:50 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 8 Mar 2009 00:59:50 +0100
Subject: [Cachewolf-svn] r1680 - trunk/res_noewe/webmapservices
Message-ID: <200903072359.n27Nxo1S012698@sheep.berlios.de>

Author: pfeffer
Date: 2009-03-08 00:59:46 +0100 (Sun, 08 Mar 2009)
New Revision: 1680

Added:
   trunk/res_noewe/webmapservices/eu_topo_osm.wms
Removed:
   trunk/res_noewe/webmapservices/de_osm_1000.wms
Log:
wms: OSM should work now again for whole Europe

Deleted: trunk/res_noewe/webmapservices/de_osm_1000.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_osm_1000.wms	2009-03-06 12:30:22 UTC (rev 1679)
+++ trunk/res_noewe/webmapservices/de_osm_1000.wms	2009-03-07 23:59:46 UTC (rev 1680)
@@ -1,89 +0,0 @@
-# Url where the GetCapabilitiesUrl is taken from, in order to be able
-# to gather some information about the map
-TakenFromUrl:	http://www.geoclub.de/viewtopic.php?f=40&t=24369&p=403662#p403662
-GetCapabilitiesUrl:	http://karto.giub.uni-bonn.de:8080/geoserver/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities	
-
-#
-# friendly name, choose yourself. By convention start with the internet domanin
-# of the covered region and add the type of map and the scale of the original map 
-# multiplied by 1000, e.g. "de.nrw Luftbild" or
-# "en Airial photo" or "de.th Topo 1:50"
-Name:	de OpenStreetMap
-
-# taken from getCapabilieties answer: <HTTP><GET><OnlineResource xlink:href=
-# note: if it doesn't work, please try adding an "?" to the URL got from there
-MainUrl:	http://karto.giub.uni-bonn.de:8080/geoserver/wms?SERVICE=WMS&amp;
-
-# if this service delivers topografical maps, fill in here "topo"
-# if it delivers aerial photographs fill in "photo".
-# Please use only lower case letters and no special characters
-# in order to avoid problems using this file on different platforms
-# CacheWolf will store all maps of the same Type in the same 
-# directory.
-MapType: topo
-
-# this is fix, dont change it
-ServiceTypeUrlPart:	SERVICE=WMS 
-
-# taken from the getCapabilities request: <WMT_MS_Capabilities version=
-VersionUrlPart:	VERSION=1.1.1 
-
-# The EPSG-Code, supported by cachewolf: german gau?-kr?ger (31466, 31467, 31468, 
-# 31469), italian Gau?-Boaga (3003 and 3004) and WGS84 (4326)
-# You get a list of supported coordinate systems from the WMS in the getCapabilieties 
-# answer under <Layer><SRS> or <CRS>
-# Plases feel free to ask for another coordinate system to be supported by cachewolf 
-# if you need it
-# In case the wms server accepts coordinates in more than one Gau?-Kr?ger stripe
-# you can list the epsg codes here, seperated by a space. CacheWolf will
-# automatically make use of the correct stripe. 
-# The sequens of strings in the UrlPart must match sequence of the corresponding numbers here.
-# Sometimes the wms-Server provides only one stripe, in spite of the fact, that
-# the map it provides is not completely within this stripe. In this case
-# just list only this epsg code. CacheWolf will automatically calculate the
-# Gau?-Kr?ger coordinates for that stripe.
-# The automatic for the stripe selection only works if a german EPSG code
-# is the first one in the space seperated list
-# remark: some WMS offer WGS84 (EPSG 4326), but they are sometimes working not
-# correctly (for example the WMS of the Landesvermessungsamt NRW as of nov. 2007)
-# In this case don't list it.
-CoordinateReferenceSystemCacheWolf:	31466 31467 31468 31469
-# this usually will match the number above
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469
-# Post not supported by Cachewolf --> dont change this
-RequestUrlPart:	REQUEST=GetMap
-# comma seperated (without spaces) list of layers to combine
-# all of supported layers you get from the getCapabilities request <Layer><Name>
-# these names are to be used. Special characters must be URL-encode
-LayersUrlPart:	LAYERS=osm%3Aworld,osm%3Awaterways,osm%3Anaturals080424,osm%3Anaturals080416small,osm%3Aroads080424,osm%3Aroads080410small,osm%3Apoints080424,osm%3Abuildings080424,osm%3Aplaces080424
-
-# if the WMS supports different rendering styles, select the one you need here
-# comma seperated (without spaces) list of style commands for map rendering (do not delete this item even if it is empty
-StylesUrlPart:	STYLES=
-
-# format, dont forget to set ImageFileExtension accordingly
-# you get a list of supported image formats from getCapabilieties answer: <GetMap><Format>
-ImageFormatUrlPart:	FORMAT=image/png
-# Limits of the service in WGS84 coordinates. 
-# You can use any format here, which is accepted by the input coordinates dialog in cachewolf
-# remark: more than 8 digits after the decimal seperator will cause the
-# program to not recognize it
-# taken from getCapabilieties answer: <BoundingBox SRS="EPSG:4326", dont forget to add "N"/"S" and "E"/"W"
-BoundingBoxTopLeftWGS84:	N 54.9019 E 5.8887
-BoundingBoxButtomRightWGS84:	N 47.3239 E 15.0513
-
-# scale range that the service supports in meters per pixel (measured diagonal)
-# Please don't wonder that they do mot match the scale given in
-# the map download dialog as that scale is measured vertically 
-# (multiply it ba sqrt(2) and you get the scale used here
-# taken from the getCapabilities request "<Layer><ScaleHint min="
-MinScale:	1.4142
-MaxScale:	28.286
-# Plaes recommend a scale for this WMS. This scale will appear in the
-# map download dialog as default. Scale is measured in meters per pixel
-# vertical, so, multiply it by 1.41 (=sqrt(2)) to get the scale as measured
-# above in MinScale and MaxScale
-RecommendedScale:	10.0
-# set this according to ImageFormatUrlPart (must start with ".")
-ImageFileExtension: .png
-

Copied: trunk/res_noewe/webmapservices/eu_topo_osm.wms (from rev 1679, trunk/res_noewe/webmapservices/de_osm_1000.wms)



From pfeffer at mail.berlios.de  Sun Mar  8 01:15:42 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 8 Mar 2009 01:15:42 +0100
Subject: [Cachewolf-svn] r1681 - trunk/res_noewe/webmapservices
Message-ID: <200903080015.n280FguM028052@sheep.berlios.de>

Author: pfeffer
Date: 2009-03-08 01:15:33 +0100 (Sun, 08 Mar 2009)
New Revision: 1681

Modified:
   trunk/res_noewe/webmapservices/eu_topo_osm.wms
Log:
WMS OSM: last commit didn't do what I expected it to do :-(

Modified: trunk/res_noewe/webmapservices/eu_topo_osm.wms
===================================================================
--- trunk/res_noewe/webmapservices/eu_topo_osm.wms	2009-03-07 23:59:46 UTC (rev 1680)
+++ trunk/res_noewe/webmapservices/eu_topo_osm.wms	2009-03-08 00:15:33 UTC (rev 1681)
@@ -1,89 +1,20 @@
-# Url where the GetCapabilitiesUrl is taken from, in order to be able
-# to gather some information about the map
-TakenFromUrl:	http://www.geoclub.de/viewtopic.php?f=40&t=24369&p=403662#p403662
-GetCapabilitiesUrl:	http://karto.giub.uni-bonn.de:8080/geoserver/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities	
-
-#
-# friendly name, choose yourself. By convention start with the internet domanin
-# of the covered region and add the type of map and the scale of the original map 
-# multiplied by 1000, e.g. "de.nrw Luftbild" or
-# "en Airial photo" or "de.th Topo 1:50"
-Name:	de OpenStreetMap
-
-# taken from getCapabilieties answer: <HTTP><GET><OnlineResource xlink:href=
-# note: if it doesn't work, please try adding an "?" to the URL got from there
-MainUrl:	http://karto.giub.uni-bonn.de:8080/geoserver/wms?SERVICE=WMS&amp;
-
-# if this service delivers topografical maps, fill in here "topo"
-# if it delivers aerial photographs fill in "photo".
-# Please use only lower case letters and no special characters
-# in order to avoid problems using this file on different platforms
-# CacheWolf will store all maps of the same Type in the same 
-# directory.
-MapType: topo
-
-# this is fix, dont change it
-ServiceTypeUrlPart:	SERVICE=WMS 
-
-# taken from the getCapabilities request: <WMT_MS_Capabilities version=
-VersionUrlPart:	VERSION=1.1.1 
-
-# The EPSG-Code, supported by cachewolf: german gau?-kr?ger (31466, 31467, 31468, 
-# 31469), italian Gau?-Boaga (3003 and 3004) and WGS84 (4326)
-# You get a list of supported coordinate systems from the WMS in the getCapabilieties 
-# answer under <Layer><SRS> or <CRS>
-# Plases feel free to ask for another coordinate system to be supported by cachewolf 
-# if you need it
-# In case the wms server accepts coordinates in more than one Gau?-Kr?ger stripe
-# you can list the epsg codes here, seperated by a space. CacheWolf will
-# automatically make use of the correct stripe. 
-# The sequens of strings in the UrlPart must match sequence of the corresponding numbers here.
-# Sometimes the wms-Server provides only one stripe, in spite of the fact, that
-# the map it provides is not completely within this stripe. In this case
-# just list only this epsg code. CacheWolf will automatically calculate the
-# Gau?-Kr?ger coordinates for that stripe.
-# The automatic for the stripe selection only works if a german EPSG code
-# is the first one in the space seperated list
-# remark: some WMS offer WGS84 (EPSG 4326), but they are sometimes working not
-# correctly (for example the WMS of the Landesvermessungsamt NRW as of nov. 2007)
-# In this case don't list it.
-CoordinateReferenceSystemCacheWolf:	31466 31467 31468 31469
-# this usually will match the number above
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469
-# Post not supported by Cachewolf --> dont change this
-RequestUrlPart:	REQUEST=GetMap
-# comma seperated (without spaces) list of layers to combine
-# all of supported layers you get from the getCapabilities request <Layer><Name>
-# these names are to be used. Special characters must be URL-encode
-LayersUrlPart:	LAYERS=osm%3Aworld,osm%3Awaterways,osm%3Anaturals080424,osm%3Anaturals080416small,osm%3Aroads080424,osm%3Aroads080410small,osm%3Apoints080424,osm%3Abuildings080424,osm%3Aplaces080424
-
-# if the WMS supports different rendering styles, select the one you need here
-# comma seperated (without spaces) list of style commands for map rendering (do not delete this item even if it is empty
-StylesUrlPart:	STYLES=
-
-# format, dont forget to set ImageFileExtension accordingly
-# you get a list of supported image formats from getCapabilieties answer: <GetMap><Format>
-ImageFormatUrlPart:	FORMAT=image/png
-# Limits of the service in WGS84 coordinates. 
-# You can use any format here, which is accepted by the input coordinates dialog in cachewolf
-# remark: more than 8 digits after the decimal seperator will cause the
-# program to not recognize it
-# taken from getCapabilieties answer: <BoundingBox SRS="EPSG:4326", dont forget to add "N"/"S" and "E"/"W"
-BoundingBoxTopLeftWGS84:	N 54.9019 E 5.8887
-BoundingBoxButtomRightWGS84:	N 47.3239 E 15.0513
-
-# scale range that the service supports in meters per pixel (measured diagonal)
-# Please don't wonder that they do mot match the scale given in
-# the map download dialog as that scale is measured vertically 
-# (multiply it ba sqrt(2) and you get the scale used here
-# taken from the getCapabilities request "<Layer><ScaleHint min="
-MinScale:	1.4142
-MaxScale:	28.286
-# Plaes recommend a scale for this WMS. This scale will appear in the
-# map download dialog as default. Scale is measured in meters per pixel
-# vertical, so, multiply it by 1.41 (=sqrt(2)) to get the scale as measured
-# above in MinScale and MaxScale
-RecommendedScale:	10.0
-# set this according to ImageFormatUrlPart (must start with ".")
+# de_topo_OSM.wms - Version 0.2
+TakenFromUrl: http://www.wheregroup.com/de/freier_wms_mit_openstreetmap_daten
+GetCapabilitiesUrl: http://osm.wheregroup.com/cgi-bin/mapserv?map=/data/umn/osm/osm_basic.map&REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.1.1
+Name: eu OpenStreetMap
+MainUrl:  http://osm.wheregroup.com/cgi-bin/osm_basic.xml?
+MapType:  topo
+ServiceTypeUrlPart:   SERVICE=WMS 
+VersionUrlPart:   VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart: REQUEST=GetMap
+LayersUrlPart:  LAYERS=Landwirtschaft,Industriegebiet,Bauland,Gruenflaeche,unkultiviertes_Land,Park,Naherholungsgebiet,Wald,Wiese,Wasser,Fluesse,Baeche,Kanal,Insel,Kueste,Strand,Fussgaengerzone,Fussgaengerweg,Radweg,Wege,Wohnstrasse,Zufahrtswege,einfache_Strasse,Landstrasse,Bundesstrasse,Kraftfahrstrasse,Autobahn,Ortschaft,Weiler,Dorf,Stadt,Grossstadt,Bahn,Bahnhof,Gebaeude
+StylesUrlPart:  STYLES=
+ImageFormatUrlPart: FORMAT=image/png
+BoundingBoxTopLeftWGS84:  N 74.1 W 10.4
+BoundingBoxButtomRightWGS84:  N 35.7 E 43.0
+MinScale: 0.6
+MaxScale: 99.99
+RecommendedScale: 5
 ImageFileExtension: .png
-



From mik77 at mail.berlios.de  Mon Mar  9 19:41:10 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 9 Mar 2009 19:41:10 +0100
Subject: [Cachewolf-svn] r1682 - trunk/src/CacheWolf
Message-ID: <200903091841.n29IfAfe027496@sheep.berlios.de>

Author: mik77
Date: 2009-03-09 19:41:07 +0100 (Mon, 09 Mar 2009)
New Revision: 1682

Modified:
   trunk/src/CacheWolf/MainMenu.java
Log:
 - don't use path and quotes for export to Garmin, so it should work on more systems
 - check for gpsbabel and gpsbabel.exe

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-03-08 00:15:33 UTC (rev 1681)
+++ trunk/src/CacheWolf/MainMenu.java	2009-03-09 18:41:07 UTC (rev 1682)
@@ -37,6 +37,7 @@
 	private Form father;
 	private TablePanel tbp;
 	private FilterScreen scnFilter=new FilterScreen();
+	private boolean addExeToGpsbabel = false;
 
 	public MainMenu(Form f){
 		father = f;
@@ -77,13 +78,29 @@
 		exitems[6] = exportMSARCSV = new MenuItem(MyLocale.getMsg(106,"to MS AutoRoute CSV"));
 		exitems[7] = exportLOC = new MenuItem(MyLocale.getMsg(215,"to LOC"));
 		exitems[8] = exportGPS = new MenuItem(MyLocale.getMsg(122,"to GPS"));
+		boolean gpsbabelFound = false;
 		try{
 			// this will *only* work with ewe.jar at the moment
 			ewe.sys.Process p = Vm.exec("gpsbabel -V");
 			p.waitFor();
+			gpsbabelFound = true;
 		}catch(IOException ioex){
-			exitems[8].modifiers = MenuItem.Disabled;
 		}
+		if ( !gpsbabelFound ) {
+			try{
+				// this will *only* work with ewe.jar at the moment
+				ewe.sys.Process p = Vm.exec("gpsbabel.exe -V");
+				p.waitFor();
+				addExeToGpsbabel = true;
+				gpsbabelFound = true;
+			}catch(IOException ioex){
+			}
+		}		
+		
+		if ( !gpsbabelFound ) {
+			exitems[8].modifiers = MenuItem.Disabled;	
+		}
+		
 		//exitems[8] = exportCacheMate = new MenuItem(MyLocale.getMsg(123,"to Cachemate"));
 		//if(!(new File(cwd + "/cmconvert/cmconvert.exe")).exists()) exitems[8].modifiers = MenuItem.Disabled;
 		exitems[9] = exportOZI = new MenuItem(MyLocale.getMsg(124,"to OZI"));
@@ -371,14 +388,23 @@
 			if(mev.selectedItem == exportGPS){
 				Vm.showWait(true);
 				LocExporter loc = new LocExporter();
-				String tmpFileName = FileBase.getProgramDirectory() + "/temp.loc";
+				//String tmpFileName = FileBase.getProgramDirectory() + "/temp.loc";
+                //Must not contain special characters, because we don't quote below, because quoting causes problems on some platforms.
+				//Find another way, when CW can be started from outside the program directory.
+				String tmpFileName = "temp.loc";
 				loc.setTmpFileName(tmpFileName);
 				loc.doIt(LocExporter.MODE_AUTO);
 				ProgressBarForm.display(MyLocale.getMsg(950,"Transfer"),MyLocale.getMsg(951,"Sending to GPS"), null);
 				try{
-					pref.log("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					String gpsBabelCommand = "";
+					if ( addExeToGpsbabel ) {
+						gpsBabelCommand = "gpsbabel.exe "+pref.garminGPSBabelOptions+" -i geo -f "+ tmpFileName +" -o garmin -F " + pref.garminConn +":";
+					} else {
+						gpsBabelCommand = "gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f "+ tmpFileName +" -o garmin -F " + pref.garminConn +":";						
+					}
+					pref.log( gpsBabelCommand );
 					// this will *only* work with ewe.jar at the moment
-					ewe.sys.Process p = Vm.exec("gpsbabel "+pref.garminGPSBabelOptions+" -i geo -f \""+ tmpFileName +"\" -o garmin -F " + pref.garminConn +":");
+					ewe.sys.Process p = Vm.exec( gpsBabelCommand );
 					p.waitFor();
 				}catch(IOException ioex){
 					Vm.showWait(false);



From mik77 at mail.berlios.de  Mon Mar  9 20:31:41 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 9 Mar 2009 20:31:41 +0100
Subject: [Cachewolf-svn] r1683 - trunk/src/CacheWolf
Message-ID: <200903091931.n29JVfCf016890@sheep.berlios.de>

Author: mik77
Date: 2009-03-09 20:31:40 +0100 (Mon, 09 Mar 2009)
New Revision: 1683

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Don't delete existing coordinates if coordinates could not be extracted (PM only now?)

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-09 18:41:07 UTC (rev 1682)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-09 19:31:40 UTC (rev 1683)
@@ -537,6 +537,15 @@
 						chD.is_new = !isUpdate;
 						chD.is_update = false;
 						chD.is_log_update=false;
+
+						//first check if coordinates are available to prevent deleting existing coorinates
+						String latLon = getLatLon(completeWebPage);
+						if (latLon.equals("???")) {
+							pref.log(">>>> Failed to spider Cache. Retry.");
+							ret = 0;
+							continue; // Restart the spider
+						}
+
 						chD.is_HTML = true;
 						chD.is_available = true;
 						chD.is_archived = false;
@@ -554,14 +563,10 @@
 						//==========
 						// General Cache Data
 						//==========
-						chD.setLatLon(getLatLon(completeWebPage));
+						chD.setLatLon(latLon);
 						pref.log("LatLon: " + chD.LatLon);
 						if (pref.debug) pref.log("chD.pos: " + chD.pos.toString());
-						if (chD.LatLon.equals("???")) {
-							pref.log(">>>> Failed to spider Cache. Retry.");
-							ret = 0;
-							continue; // Restart the spider
-						}
+
 						pref.log("Trying description");
 						chD.setLongDescription(getLongDesc(completeWebPage));
 						pref.log("Got description");



From mik77 at mail.berlios.de  Mon Mar  9 22:22:15 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 9 Mar 2009 22:22:15 +0100
Subject: [Cachewolf-svn] r1684 - trunk/src/CacheWolf
Message-ID: <200903092122.n29LMFJq003901@sheep.berlios.de>

Author: mik77
Date: 2009-03-09 22:22:14 +0100 (Mon, 09 Mar 2009)
New Revision: 1684

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
 - first attempt to correct disabled/archived status when spidering

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-09 19:31:40 UTC (rev 1683)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-09 21:22:14 UTC (rev 1684)
@@ -29,6 +29,8 @@
 import ewe.sys.*;
 import ewe.sys.Double;
 import ewe.util.*;
+import CacheWolf.navi.Metrics;
+
 import com.stevesoft.ewe_pat.*;
 import ewe.ui.*;
 import ewe.data.Property;
@@ -321,6 +323,18 @@
 		boolean doNotgetFound = options.foundCheckBox.getState();
 		boolean getImages = options.imagesCheckBox.getState();
 		options.close(0);
+		
+		Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
+		double distanceInKm = distance;
+		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
+			distanceInKm = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
+		}
+		for(int i = 0; i<cacheDB.size();i++){
+			ch = (CacheHolder)cacheDB.get(i);
+			if ( (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found) ) {
+				cachesToUpdate.put(ch.wayPoint, new Integer(i));
+			}
+		}
 
 		//=======
 		// Prepare list of all caches that are to be spidered
@@ -407,6 +421,8 @@
 								ch.is_available=is_available_GC;
 								chD=ch.getCacheDetails(true,false);
 								ch.detailsAdded();
+							} else {
+								cachesToUpdate.remove( ch.wayPoint );
 							}
 						}
 					} else distance = 0;
@@ -456,17 +472,19 @@
 		boolean loadAllLogs = (MAXLOGS > 5);
 
 		int spiderErrors = 0;
+		int totalCachesToLoad = cachesToLoad.size() + cachesToUpdate.size();
 		for(int i = 0; i<cachesToLoad.size(); i++){
 			if (infB.isClosed) break;
 
 			wpt = (String)cachesToLoad.get(i);
 			// Get only caches not already available in the DB
 			if(searchWpt(wpt) == -1){
-				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + wpt +" (" + (i+1) + " / " + cachesToLoad.size() + ")");
+				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + wpt +" (" + (i+1) + " / " + totalCachesToLoad + ")");
 				chD = new CacheHolderDetail();
 				chD.wayPoint=wpt;
 				int test = getCacheByWaypointName(chD,false,getImages,doNotgetFound,loadAllLogs);
 				if (test == -1) {
+					infB.close(0);
 					break;
 				} else if (test == 0) {
 					spiderErrors++;
@@ -478,6 +496,27 @@
 				}
 			}
 		}
+		
+		if (!infB.isClosed) {
+			int j = 1;
+			for (Enumeration e = cachesToUpdate.elements() ; e.hasMoreElements() ; j++) {
+				int i = ((Integer)e.nextElement()).intValue();
+				ch = (CacheHolder)cacheDB.get(i);
+				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + ch.wayPoint +" (" + (cachesToLoad.size()+j) + " / " + totalCachesToLoad + ")");
+				infB.redisplay();
+				if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")) {
+					int test = spiderSingle(i, infB,false);
+					if (test == -1) {
+						break;
+					} else if (test == 0) {
+						spiderErrors++;
+					} else {
+						profile.hasUnsavedChanges=true;	
+					}
+				}
+			}
+		}
+		
 		infB.close(0);
 		Vm.showWait(false);
 		if ( spiderErrors > 0) {



From mik77 at mail.berlios.de  Mon Mar  9 22:29:42 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 9 Mar 2009 22:29:42 +0100
Subject: [Cachewolf-svn] r1685 - trunk/src/CacheWolf
Message-ID: <200903092129.n29LTgBR005695@sheep.berlios.de>

Author: mik77
Date: 2009-03-09 22:29:41 +0100 (Mon, 09 Mar 2009)
New Revision: 1685

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Don't update archived, if they are still archived

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-09 21:22:14 UTC (rev 1684)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-09 21:29:41 UTC (rev 1685)
@@ -331,7 +331,7 @@
 		}
 		for(int i = 0; i<cacheDB.size();i++){
 			ch = (CacheHolder)cacheDB.get(i);
-			if ( (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found) ) {
+			if ( (!ch.is_archived) && (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found) ) {
 				cachesToUpdate.put(ch.wayPoint, new Integer(i));
 			}
 		}
@@ -413,6 +413,9 @@
 							boolean is_available_GC=lineRex.stringMatched(1).indexOf("<strike>")==-1;
 							if (ch.is_archived!=is_archived_GC) { // Update the database with the cache status
 								pref.log("Updating status of "+waypoint+" to "+(is_archived_GC?"archived":"not archived"));
+								if ( ch.is_archived ) {
+									cachesToUpdate.put(ch.wayPoint, nr);
+								}
 								ch.is_archived=is_archived_GC;
 								chD=ch.getCacheDetails(true,false);
 								ch.detailsAdded();



From greiol at mail.berlios.de  Mon Mar  9 23:14:07 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 9 Mar 2009 23:14:07 +0100
Subject: [Cachewolf-svn] r1686 - trunk
Message-ID: <200903092214.n29ME7hr014231@sheep.berlios.de>

Author: greiol
Date: 2009-03-09 23:13:32 +0100 (Mon, 09 Mar 2009)
New Revision: 1686

Added:
   trunk/build.xml
Log:
first draft of an ant based build

Added: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-09 21:29:41 UTC (rev 1685)
+++ trunk/build.xml	2009-03-09 22:13:32 UTC (rev 1686)
@@ -0,0 +1,192 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<project name="CacheWolf" default="release">
+
+	<property name="pkg.dir" value="packages"/>
+	<property name="classes.dir" value="bin"/>
+	<property name="assemble.dir" value="assemble"/>
+
+	<property name="template.files" value="**/*.tpl"/>
+	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png"/>
+	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif"/>
+	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4,gif,3,gif,2.gif,1858.gif,13.gif,137.gif,12.gif"/>
+	<property name="addon.files" value="Garmin*.zip"/>
+	<property name="doc.files" value="wolflang.html,GCTemplate.html,info.html,legende.html"/>
+
+	<fail message="pleasy specify property ewecl.exe Hint: -Dewecl.exe=/path/to/ewecl" unless="ewecl.exe"/>
+
+	<target name="fixreleasenumber" description="fix the release number in " depends="clean">
+		<!-- TODO: find out how to do this platform independent -->
+		<echo message="fixing the build number is not working yet"/>
+	</target>
+
+	<target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
+		<echo message="packages for all platforms are now in ${pkg.dir}"/>
+	</target>
+	
+	<target name="CW-ARM" depends="ewebuild" description="package ARM release of CacheWolf">
+		<mkdir dir="${assemble.dir}"/>
+
+		<mkdir dir="${pkg.dir}"/>
+
+		<antcall target="copyres"/>
+
+		<zip destfile="${pkg.dir}/CacheWolf-ARM.zip" basedir="${assemble.dir}"/>
+
+		<delete dir="${assemble.dir}"/>
+	</target>
+	
+	<target name="CW-MIPS" depends="ewebuild" description="package MIPS release of CacheWolf">
+		<mkdir dir="${assemble.dir}"/>
+
+		<mkdir dir="${pkg.dir}"/>
+
+		<antcall target="copyres"/>
+
+		<zip destfile="${pkg.dir}/CacheWolf-MIPS.zip" basedir="${assemble.dir}"/>
+
+		<delete dir="${assemble.dir}"/>
+	</target>
+
+	<target name="CW-SH3" depends="ewebuild" description="package SH3 release of CacheWolf">
+		<mkdir dir="${assemble.dir}"/>
+
+		<mkdir dir="${pkg.dir}"/>
+
+		<antcall target="copyres"/>
+
+		<zip destfile="${pkg.dir}/CacheWolf-SH3.zip" basedir="${assemble.dir}"/>
+
+		<delete dir="${assemble.dir}"/>
+	</target>
+
+	<target name="CW-PPC2003" depends="ewebuild" description="package PocketPC 2003 release of CacheWolf">
+		<mkdir dir="${assemble.dir}"/>
+
+		<mkdir dir="${pkg.dir}"/>
+
+		<antcall target="copyres"/>
+
+		<zip destfile="${pkg.dir}/CacheWolf-PPC2003.zip" basedir="${assemble.dir}"/>
+
+		<delete dir="${assemble.dir}"/>
+	</target>
+	
+	<target name="CW-EWE" depends="ewebuild" description="package Ewe release of CacheWolf">
+		<mkdir dir="${assemble.dir}"/>
+
+		<mkdir dir="${pkg.dir}"/>
+
+		<copy file="work/CacheWolf.ewe" todir="${assemble.dir}"/>
+		<antcall target="copyres"/>
+
+		<zip destfile="${pkg.dir}/CacheWolf-EWE.zip" basedir="${assemble.dir}"/>
+
+		<delete dir="${assemble.dir}"/>
+	</target>
+	
+	<target name="CW-Win32" depends="ewebuild" description="package Win32 release of CacheWolf">
+		<mkdir dir="${assemble.dir}"/>
+
+		<mkdir dir="${pkg.dir}"/>
+
+		<antcall target="copyres"/>
+
+		<zip destfile="${pkg.dir}/CacheWolf-Win32.zip" basedir="${assemble.dir}"/>
+
+		<delete dir="${assemble.dir}"/>
+	</target>
+	
+	<target name="CW-Java" depends="ewebuild" description="package Java release of CacheWolf">
+		<mkdir dir="${assemble.dir}"/>
+
+		<copy file="programs/CacheWolf/Jar/CacheWolf.jar" todir="${assemble.dir}"/>
+		<antcall target="copyres"/>
+
+		<mkdir dir="${pkg.dir}"/>
+		<zip destfile="${pkg.dir}/CacheWolf-Java.zip" basedir="${assemble.dir}"/>
+
+		<delete dir="${assemble.dir}"/>
+	</target>
+	
+	<target name="ewebuild" depends="compile" description="build platform files">
+		<exec executable="${ewecl.exe}">
+			<arg value="programs/Jewel.ewe"/>
+			<arg value="-c cw-pda.jnf"/>
+		</exec>
+		<exec executable="${ewecl.exe}">
+			<arg value="programs/Jewel.ewe"/>
+			<arg value="-c cw-pc.jnf"/>
+		</exec>
+	</target>
+	
+	<target name="clean" description="clean up before build">
+		<delete dir="${pkg.dir}"/>
+		<delete dir="${classes.dir}"/>
+		<delete dir="programs/CacheWolf"/>
+		<delete dir="${assemble.dir}"/>
+	</target>
+
+	<target name="compile" depends="fixreleasenumber" description="compile sources with java">
+		<mkdir dir="${classes.dir}"/>
+		<javac
+			source="1.3" 
+			target="1.1" 
+			encoding="windows-1252"
+			classpath="./lib/CompileEwe.zip:./lib/"
+			destdir="${classes.dir}"
+			deprecation="off"
+			nowarn="on"
+			srcdir="src"
+			includes="CacheWolf/*.java,CacheWolf/*/*.java,exp/*.java,utils/*.java"
+		/>
+
+	</target>
+
+	<target name="copyres" description="copy images to the assembly directory">
+		<!-- copy templates -->
+		<copy todir="${assemble.dir}">
+			<fileset dir="res_noewe">
+				<include name="${template.files}"/>
+			</fileset>
+		</copy>
+		<!-- copy gui icons -->
+		<copy todir="${assemble.dir}">
+			<fileset dir="res_noewe" includes="${icons.gui.files}"/>
+		</copy>
+		<!-- copy cache icons -->
+		<copy todir="${assemble.dir}">
+			<fileset dir="res_noewe" includes="${icons.cache.files}"/>
+		</copy>
+		<!-- copy log icons -->
+		<copy todir="${assemble.dir}">
+			<fileset dir="res_noewe" includes="${icons.log.files}"/>
+		</copy>
+		<!-- copy webmapservices -->
+		<copy todir="${assemble.dir}/webmapservices">
+			<fileset dir="res_noewe/webmapservices"/>
+		</copy>
+		<!-- copy languages -->
+		<copy todir="${assemble.dir}/languages">
+			<fileset dir="res_noewe/languages"/>
+		</copy>
+		<!-- copy attributes -->
+		<copy todir="${assemble.dir}/attributes">
+			<fileset dir="resources/attributes"/>
+		</copy>
+		<!-- copy big attributes -->
+		<copy todir="${assemble.dir}/attributes-big">
+			<fileset dir="resources/attributes-big"/>
+		</copy>
+		<!-- copy addons -->
+		<copy todir="${assemble.dir}/addons">
+			<fileset dir="res_noewe">
+				<include name="${addon.files}"/>
+			</fileset>
+		</copy>
+		<!-- copy documentation -->
+		<copy todir="${assemble.dir}">
+			<fileset dir="res_noewe" includes="${doc.files}"/>
+		</copy>
+
+	</target>
+</project>



From mik77 at mail.berlios.de  Tue Mar 10 00:11:31 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 10 Mar 2009 00:11:31 +0100
Subject: [Cachewolf-svn] r1687 - trunk/src/CacheWolf
Message-ID: <200903092311.n29NBVJm020778@sheep.berlios.de>

Author: mik77
Date: 2009-03-10 00:11:30 +0100 (Tue, 10 Mar 2009)
New Revision: 1687

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
total spider count corrected

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-09 22:13:32 UTC (rev 1686)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-09 23:11:30 UTC (rev 1687)
@@ -331,7 +331,7 @@
 		}
 		for(int i = 0; i<cacheDB.size();i++){
 			ch = (CacheHolder)cacheDB.get(i);
-			if ( (!ch.is_archived) && (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found) ) {
+			if ( (!ch.is_archived) && (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found) && (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")) ) {
 				cachesToUpdate.put(ch.wayPoint, new Integer(i));
 			}
 		}
@@ -476,6 +476,7 @@
 
 		int spiderErrors = 0;
 		int totalCachesToLoad = cachesToLoad.size() + cachesToUpdate.size();
+
 		for(int i = 0; i<cachesToLoad.size(); i++){
 			if (infB.isClosed) break;
 
@@ -507,15 +508,14 @@
 				ch = (CacheHolder)cacheDB.get(i);
 				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + ch.wayPoint +" (" + (cachesToLoad.size()+j) + " / " + totalCachesToLoad + ")");
 				infB.redisplay();
-				if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")) {
-					int test = spiderSingle(i, infB,false);
-					if (test == -1) {
-						break;
-					} else if (test == 0) {
-						spiderErrors++;
-					} else {
-						profile.hasUnsavedChanges=true;	
-					}
+
+				int test = spiderSingle(i, infB,false);
+				if (test == -1) {
+					break;
+				} else if (test == 0) {
+					spiderErrors++;
+				} else {
+					profile.hasUnsavedChanges=true;	
 				}
 			}
 		}



From greiol at mail.berlios.de  Tue Mar 10 19:00:27 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 10 Mar 2009 19:00:27 +0100
Subject: [Cachewolf-svn] r1688 - trunk
Message-ID: <200903101800.n2AI0RCl026009@sheep.berlios.de>

Author: greiol
Date: 2009-03-10 19:00:01 +0100 (Tue, 10 Mar 2009)
New Revision: 1688

Modified:
   trunk/build.xml
Log:
it starts getting useful, but some images are still missing after the build

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-09 23:11:30 UTC (rev 1687)
+++ trunk/build.xml	2009-03-10 18:00:01 UTC (rev 1688)
@@ -1,6 +1,13 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no"?>
 <project name="CacheWolf" default="release">
 
+	<!-- TODO: find out how to get svn revision information platform independent. -->
+	<!-- TODO: especially since svnversion would give better information if current directory is up to date -->
+	<!-- set a default build.version as long as not defined otherwiese on command line -->
+	<tstamp><format property="build.version" pattern="yyyyMMdd"/></tstamp>
+	<!-- set build type to experimental as long as not defined otherwiese on command line -->
+	<property name="build.type" value="3"/>
+
 	<property name="pkg.dir" value="packages"/>
 	<property name="classes.dir" value="bin"/>
 	<property name="assemble.dir" value="assemble"/>
@@ -9,14 +16,20 @@
 	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png"/>
 	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif"/>
 	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4,gif,3,gif,2.gif,1858.gif,13.gif,137.gif,12.gif"/>
-	<property name="addon.files" value="Garmin*.zip"/>
 	<property name="doc.files" value="wolflang.html,GCTemplate.html,info.html,legende.html"/>
 
 	<fail message="pleasy specify property ewecl.exe Hint: -Dewecl.exe=/path/to/ewecl" unless="ewecl.exe"/>
 
 	<target name="fixreleasenumber" description="fix the release number in " depends="clean">
-		<!-- TODO: find out how to do this platform independent -->
-		<echo message="fixing the build number is not working yet"/>
+		<echo message="setting build version: ${build.version}" />
+		<replaceregexp file="src/CacheWolf/Version.java" 
+			match="static final int SVN_REVISION = (.*);" 
+			replace="static final int SVN_REVISION = ${build.version};"/>
+		<echo message="setting build type: ${build.type}" />
+		<replaceregexp file="src/CacheWolf/Version.java" 
+			match="static final int VERSION_TYPE = (.*);" 
+			replace="static final int VERSION_TYPE = ${build.type};"/>
+
 	</target>
 
 	<target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
@@ -30,6 +43,7 @@
 
 		<antcall target="copyres"/>
 
+		<copy file="programs/CacheWolf/PocketPC-ARM/CacheWolf.exe" todir="${assemble.dir}"/>
 		<zip destfile="${pkg.dir}/CacheWolf-ARM.zip" basedir="${assemble.dir}"/>
 
 		<delete dir="${assemble.dir}"/>
@@ -42,6 +56,7 @@
 
 		<antcall target="copyres"/>
 
+		<copy file="programs/CacheWolf/PocketPC-MIPS/CacheWolf.exe" todir="${assemble.dir}"/>
 		<zip destfile="${pkg.dir}/CacheWolf-MIPS.zip" basedir="${assemble.dir}"/>
 
 		<delete dir="${assemble.dir}"/>
@@ -52,6 +67,7 @@
 
 		<mkdir dir="${pkg.dir}"/>
 
+		<copy file="programs/CacheWolf/PocketPC-SH3/CacheWolf.exe" todir="${assemble.dir}"/>
 		<antcall target="copyres"/>
 
 		<zip destfile="${pkg.dir}/CacheWolf-SH3.zip" basedir="${assemble.dir}"/>
@@ -64,6 +80,7 @@
 
 		<mkdir dir="${pkg.dir}"/>
 
+		<copy file="programs/CacheWolf/PocketPC2003/CacheWolf.exe" todir="${assemble.dir}"/>
 		<antcall target="copyres"/>
 
 		<zip destfile="${pkg.dir}/CacheWolf-PPC2003.zip" basedir="${assemble.dir}"/>
@@ -89,6 +106,7 @@
 
 		<mkdir dir="${pkg.dir}"/>
 
+		<copy file="programs/CacheWolf/x86-Win32-StaticLinked/CacheWolf.exe" todir="${assemble.dir}"/>
 		<antcall target="copyres"/>
 
 		<zip destfile="${pkg.dir}/CacheWolf-Win32.zip" basedir="${assemble.dir}"/>
@@ -180,9 +198,13 @@
 		<!-- copy addons -->
 		<copy todir="${assemble.dir}/addons">
 			<fileset dir="res_noewe">
-				<include name="${addon.files}"/>
+				<include name="Garmin*.zip"/>
+				<include name="POI*.zip"/>
 			</fileset>
 		</copy>
+		<!-- copy logos -->
+		<copy todir="${assemble.dir}" file="docs/cachewolf.svg"/>
+		<copy todir="${assemble.dir}" file="resources/CacheWolf.ico"/>
 		<!-- copy documentation -->
 		<copy todir="${assemble.dir}">
 			<fileset dir="res_noewe" includes="${doc.files}"/>



From greiol at mail.berlios.de  Tue Mar 10 19:28:28 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 10 Mar 2009 19:28:28 +0100
Subject: [Cachewolf-svn] r1689 - trunk
Message-ID: <200903101828.n2AISSHd026768@sheep.berlios.de>

Author: greiol
Date: 2009-03-10 19:28:10 +0100 (Tue, 10 Mar 2009)
New Revision: 1689

Modified:
   trunk/getRes.sh
Log:
make it a little less "noisy"

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2009-03-10 18:00:01 UTC (rev 1688)
+++ trunk/getRes.sh	2009-03-10 18:28:10 UTC (rev 1689)
@@ -1,23 +1,19 @@
 #!/bin/sh
 
 # clean up
-rm ./work/*.png
-rm ./work/*.gif
-rm ./work/*.html
-rm ./work/*.tpl
-rm ./work/*.ico
-rm ./work/languages/*
-rm ./work/attributes/*
-rm ./work/webmapservices/*
+rm -rf work
 
 #make directorys if they don't exist
-mkdir work/attributes
-mkdir work/webmapservices
-mkdir work/languages
+mkdir -p work/attributes
+mkdir -p work/webmapservices
+mkdir -p work/languages
 
 # get ressources
-cp resources/*.* work
-cp res_noewe/*.* work
-cp resources/attributes/* work/attributes
-cp res_noewe/webmapservices/* work/webmapservices/
-cp res_noewe/languages/* work/languages/
+cp -fa resources/*.* work
+cp -fa res_noewe/*.* work
+cp -fa resources/attributes/* work/attributes
+cp -fa res_noewe/webmapservices/* work/webmapservices/
+cp -fa res_noewe/languages/* work/languages/
+
+find work -type f | xargs chmod 644
+find work -type d | xargs chmod 755
\ No newline at end of file



From greiol at mail.berlios.de  Tue Mar 10 19:44:35 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 10 Mar 2009 19:44:35 +0100
Subject: [Cachewolf-svn] r1690 - trunk
Message-ID: <200903101844.n2AIiZsb018450@sheep.berlios.de>

Author: greiol
Date: 2009-03-10 19:44:08 +0100 (Tue, 10 Mar 2009)
New Revision: 1690

Modified:
   trunk/build.xml
Log:
changed output folder from packages to published since there already is a svnignore for it

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-10 18:28:10 UTC (rev 1689)
+++ trunk/build.xml	2009-03-10 18:44:08 UTC (rev 1690)
@@ -8,7 +8,7 @@
 	<!-- set build type to experimental as long as not defined otherwiese on command line -->
 	<property name="build.type" value="3"/>
 
-	<property name="pkg.dir" value="packages"/>
+	<property name="pkg.dir" value="published"/>
 	<property name="classes.dir" value="bin"/>
 	<property name="assemble.dir" value="assemble"/>
 



From greiol at mail.berlios.de  Tue Mar 10 19:45:28 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 10 Mar 2009 19:45:28 +0100
Subject: [Cachewolf-svn] r1691 - trunk/work
Message-ID: <200903101845.n2AIjSAd018760@sheep.berlios.de>

Author: greiol
Date: 2009-03-10 19:45:14 +0100 (Tue, 10 Mar 2009)
New Revision: 1691

Modified:
   trunk/work/
Log:
also ignore subdirectories in work


Property changes on: trunk/work
___________________________________________________________________
Name: svn:ignore
   - 
*.png
*.gif
*.bat
*.ewe
*.exe
*.ico
*.jar
*.tpl
*.html
*.dll
*.xml

   + *
*.*




From engywuck at mail.berlios.de  Tue Mar 10 21:39:50 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Tue, 10 Mar 2009 21:39:50 +0100
Subject: [Cachewolf-svn] r1692 - experiments
Message-ID: <200903102039.n2AKdoML007709@sheep.berlios.de>

Author: engywuck
Date: 2009-03-10 21:39:49 +0100 (Tue, 10 Mar 2009)
New Revision: 1692

Removed:
   experiments/EVE/
Log:
No longer needed and leeds to confusion (http://www.geoclub.de/viewtopic.php?f=40&t=32018), so it should be removed. 



From greiol at mail.berlios.de  Tue Mar 10 21:55:04 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 10 Mar 2009 21:55:04 +0100
Subject: [Cachewolf-svn] r1693 - trunk/res_noewe
Message-ID: <200903102055.n2AKt4AU010525@sheep.berlios.de>

Author: greiol
Date: 2009-03-10 21:54:09 +0100 (Tue, 10 Mar 2009)
New Revision: 1693

Added:
   trunk/res_noewe/icon_redlight.gif
Log:
geh?rt zum logtyp retract. taucht dem entsprechend eher selten auf

Added: trunk/res_noewe/icon_redlight.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/icon_redlight.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From greiol at mail.berlios.de  Tue Mar 10 23:47:07 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 10 Mar 2009 23:47:07 +0100
Subject: [Cachewolf-svn] r1694 - trunk
Message-ID: <200903102247.n2AMl7or000741@sheep.berlios.de>

Author: greiol
Date: 2009-03-10 23:46:40 +0100 (Tue, 10 Mar 2009)
New Revision: 1694

Modified:
   trunk/build.xml
Log:
small fixes to get complete packages

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-10 20:54:09 UTC (rev 1693)
+++ trunk/build.xml	2009-03-10 22:46:40 UTC (rev 1694)
@@ -14,8 +14,9 @@
 
 	<property name="template.files" value="**/*.tpl"/>
 	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png"/>
-	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif"/>
-	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4,gif,3,gif,2.gif,1858.gif,13.gif,137.gif,12.gif"/>
+	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif,icon_greenlight.gif,icon_redlight.gif"/>
+	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4.gif,3.gif,2.gif,1858.gif,13.gif,137.gif,12.gif"/>
+	<property name="icons.browser.files" value="g.png,g2.png,y.png,y2.png"/>
 	<property name="doc.files" value="wolflang.html,GCTemplate.html,info.html,legende.html"/>
 
 	<fail message="pleasy specify property ewecl.exe Hint: -Dewecl.exe=/path/to/ewecl" unless="ewecl.exe"/>
@@ -32,7 +33,8 @@
 
 	</target>
 
-	<target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
+<!--	<target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms"> -->
+	<target name="release" depends="CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
 		<echo message="packages for all platforms are now in ${pkg.dir}"/>
 	</target>
 	
@@ -81,6 +83,10 @@
 		<mkdir dir="${pkg.dir}"/>
 
 		<copy file="programs/CacheWolf/PocketPC2003/CacheWolf.exe" todir="${assemble.dir}"/>
+		<!-- copy big attributes -->
+		<copy todir="${assemble.dir}/attributes-big">
+			<fileset dir="resources/attributes-big"/>
+		</copy>
 		<antcall target="copyres"/>
 
 		<zip destfile="${pkg.dir}/CacheWolf-PPC2003.zip" basedir="${assemble.dir}"/>
@@ -118,6 +124,8 @@
 		<mkdir dir="${assemble.dir}"/>
 
 		<copy file="programs/CacheWolf/Jar/CacheWolf.jar" todir="${assemble.dir}"/>
+		<copy file="lib/java_ewe.dll" todir="${assemble.dir}"/>
+		<copy file="docs/cachewolf.svg" todir="${assemble.dir}"/>
 		<antcall target="copyres"/>
 
 		<mkdir dir="${pkg.dir}"/>
@@ -171,6 +179,10 @@
 		<copy todir="${assemble.dir}">
 			<fileset dir="res_noewe" includes="${icons.gui.files}"/>
 		</copy>
+		<!-- copy browser icons -->
+		<copy todir="${assemble.dir}">
+			<fileset dir="res_noewe" includes="${icons.browser.files}"/>
+		</copy>
 		<!-- copy cache icons -->
 		<copy todir="${assemble.dir}">
 			<fileset dir="res_noewe" includes="${icons.cache.files}"/>
@@ -191,10 +203,6 @@
 		<copy todir="${assemble.dir}/attributes">
 			<fileset dir="resources/attributes"/>
 		</copy>
-		<!-- copy big attributes -->
-		<copy todir="${assemble.dir}/attributes-big">
-			<fileset dir="resources/attributes-big"/>
-		</copy>
 		<!-- copy addons -->
 		<copy todir="${assemble.dir}/addons">
 			<fileset dir="res_noewe">
@@ -202,13 +210,13 @@
 				<include name="POI*.zip"/>
 			</fileset>
 		</copy>
-		<!-- copy logos -->
-		<copy todir="${assemble.dir}" file="docs/cachewolf.svg"/>
+		<!-- copy logo -->
 		<copy todir="${assemble.dir}" file="resources/CacheWolf.ico"/>
 		<!-- copy documentation -->
 		<copy todir="${assemble.dir}">
 			<fileset dir="res_noewe" includes="${doc.files}"/>
 		</copy>
-
+		<!-- spider.def -->
+		<copy todir="${assemble.dir}" file="res_noewe/spider.def"/>
 	</target>
 </project>



From greiol at mail.berlios.de  Wed Mar 11 20:30:14 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 11 Mar 2009 20:30:14 +0100
Subject: [Cachewolf-svn] r1695 - trunk
Message-ID: <200903111930.n2BJUEQ5015043@sheep.berlios.de>

Author: greiol
Date: 2009-03-11 20:29:46 +0100 (Wed, 11 Mar 2009)
New Revision: 1695

Modified:
   trunk/build.xml
Log:
assume ewe.exe or ewecl are in program/
only run on windows and linux

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-10 22:46:40 UTC (rev 1694)
+++ trunk/build.xml	2009-03-11 19:29:46 UTC (rev 1695)
@@ -1,6 +1,18 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no"?>
 <project name="CacheWolf" default="release">
 
+	<!-- ewe builder on exist for windows and linux -->
+	<fail message="unsupport operating system. sorry">
+		<condition>
+			<not>
+				<or>
+					<os family="windows"/>
+					<os name="Linux"/>
+				</or>
+			</not>
+		</condition>
+	</fail>
+
 	<!-- TODO: find out how to get svn revision information platform independent. -->
 	<!-- TODO: especially since svnversion would give better information if current directory is up to date -->
 	<!-- set a default build.version as long as not defined otherwiese on command line -->
@@ -8,10 +20,12 @@
 	<!-- set build type to experimental as long as not defined otherwiese on command line -->
 	<property name="build.type" value="3"/>
 
+	<!-- define output directorties -->
 	<property name="pkg.dir" value="published"/>
 	<property name="classes.dir" value="bin"/>
 	<property name="assemble.dir" value="assemble"/>
 
+	<!-- lists of files to be packaged, this should become less confusing later on -->
 	<property name="template.files" value="**/*.tpl"/>
 	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png"/>
 	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif,icon_greenlight.gif,icon_redlight.gif"/>
@@ -19,8 +33,6 @@
 	<property name="icons.browser.files" value="g.png,g2.png,y.png,y2.png"/>
 	<property name="doc.files" value="wolflang.html,GCTemplate.html,info.html,legende.html"/>
 
-	<fail message="pleasy specify property ewecl.exe Hint: -Dewecl.exe=/path/to/ewecl" unless="ewecl.exe"/>
-
 	<target name="fixreleasenumber" description="fix the release number in " depends="clean">
 		<echo message="setting build version: ${build.version}" />
 		<replaceregexp file="src/CacheWolf/Version.java" 
@@ -33,7 +45,7 @@
 
 	</target>
 
-<!--	<target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms"> -->
+	<!-- <target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms"> -->
 	<target name="release" depends="CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
 		<echo message="packages for all platforms are now in ${pkg.dir}"/>
 	</target>
@@ -135,14 +147,23 @@
 	</target>
 	
 	<target name="ewebuild" depends="compile" description="build platform files">
-		<exec executable="${ewecl.exe}">
+		<echo message="Operating System ${os.name} Version ${os.version} Arch ${os.arch}"/>
+		<exec executable="programs/ewecl" os="Linux">
 			<arg value="programs/Jewel.ewe"/>
 			<arg value="-c cw-pda.jnf"/>
 		</exec>
-		<exec executable="${ewecl.exe}">
+		<exec executable="programs/ewecl" os="Linux">
 			<arg value="programs/Jewel.ewe"/>
 			<arg value="-c cw-pc.jnf"/>
 		</exec>
+		<exec executable="programs/ewe.exe" osfamily="windows">
+			<arg value="programs/Jewel.ewe"/>
+			<arg value="-c cw-pda.jnf"/>
+		</exec>
+		<exec executable="programs/ewe.exe" osfamily="windows">
+			<arg value="programs/Jewel.ewe"/>
+			<arg value="-c cw-pc.jnf"/>
+		</exec>
 	</target>
 	
 	<target name="clean" description="clean up before build">



From greiol at mail.berlios.de  Wed Mar 11 21:27:56 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 11 Mar 2009 21:27:56 +0100
Subject: [Cachewolf-svn] r1696 - trunk/programs
Message-ID: <200903112027.n2BKRubc025560@sheep.berlios.de>

Author: greiol
Date: 2009-03-11 21:27:03 +0100 (Wed, 11 Mar 2009)
New Revision: 1696

Added:
   trunk/programs/ewecl
Log:
at present linux users will need this to build working JARs

Added: trunk/programs/ewecl
===================================================================
(Binary files differ)


Property changes on: trunk/programs/ewecl
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream



From greiol at mail.berlios.de  Wed Mar 11 23:28:25 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 11 Mar 2009 23:28:25 +0100
Subject: [Cachewolf-svn] r1697 - trunk/docs
Message-ID: <200903112228.n2BMSPUX003555@sheep.berlios.de>

Author: greiol
Date: 2009-03-11 23:27:38 +0100 (Wed, 11 Mar 2009)
New Revision: 1697

Added:
   trunk/docs/CacheWolf_on_Linux.pdf
Removed:
   trunk/docs/cachewolf_auf_linux_bauen.txt
Log:
eine etwas ausfuehrlichere anleitung fuer linux

Added: trunk/docs/CacheWolf_on_Linux.pdf
===================================================================
(Binary files differ)


Property changes on: trunk/docs/CacheWolf_on_Linux.pdf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/docs/cachewolf_auf_linux_bauen.txt
===================================================================
--- trunk/docs/cachewolf_auf_linux_bauen.txt	2009-03-11 20:27:03 UTC (rev 1696)
+++ trunk/docs/cachewolf_auf_linux_bauen.txt	2009-03-11 22:27:38 UTC (rev 1697)
@@ -1,47 +0,0 @@
-Zusatzsoftware
-==============
-
-Um CacheWolf unter Linux x86 komplett zu bauen, braucht man noch das Linux Paket
-von http://www.ewesoft.com/Downloads/Downloads.html#_Toc105819901. Derzeit ist
-das Ewe149-Linux-x86.zip. Aus dem Paket benoetigt man nur ewecl aus dem Unter-
-verzeichnis CommandLine.
-
-Die Software ist gegen eine aeltere Version der libc gelinkt. Die meisten
-Distributionen verfuegen ueber Paket zur Kompatibilitaet: compat-libstdc++-33
-
-Bitte dieses Paket nach den Anweisungen des Distributionsherstellers
-zusaetzlich einspielen.
-
-Wer mutig ist, kann auch versuchen alles aus dem Sourcen selber zu bauen.
-http://www.ewesoft.com/Downloads/Downloads.html#_Toc105819911
-
-Anmerkungen zu eclipse
-======================
-
-Viele CW-Entwickler arbeiten mit Windows und dort nutzt eclipse zunaechst die
-Standardzeichenkodierung windows-1252. Ich habe jedoch noch keine Linux Version
-mit brauchbarer windows-1252 Unterstuetzung gefunden. Das naechstbeste was
-Linux bietet ist ISO-8859-1. Wenn du den Sourcecode als ISO-8859-1 anzeigen
-laesst (rechte Maustaste / Eigenschaten) wird fast(!) alles korrekt angezeigt.
-Aber:
-
-!!Die beiden Zeichensaetze sind nicht identisch!!
-
-Um herauszufinden welche Dateien Probleme bereiten koennen, kannst du das Tool
-pcregrep benutzen (eventuell musst du es nachinstallieren) und dann folgendes
-Script ausfuehren:
-
-----------------------------------------------------------------------
-#!/bin/sh
-
-for high in 8 9 ; do
-        for low in 0 1 2 3 4 5 6 7 8 9 a b c d e f ; do
-                echo "checking for hex $high$low"
-                find src -name *.java | xargs pcregrep -n  "\x$high$low"
-         done
-done
-----------------------------------------------------------------------
-
-Aenderungen (bzw. Commits ins SVN-Repository) an Dateien die von diesem Script 
-gemeldet werden, solltest du vorsichtshalber von einem Mitentwickler der Windows 
-benutzt vornehmen lassen, damit es nicht zu Durcheinander kommt.
\ No newline at end of file



From greiol at mail.berlios.de  Thu Mar 12 20:58:27 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 12 Mar 2009 20:58:27 +0100
Subject: [Cachewolf-svn] r1698 - trunk/docs
Message-ID: <200903121958.n2CJwRXD000871@sheep.berlios.de>

Author: greiol
Date: 2009-03-12 20:57:53 +0100 (Thu, 12 Mar 2009)
New Revision: 1698

Modified:
   trunk/docs/CacheWolf_on_Linux.pdf
Log:
Nach Hinweis von Engywuck (danke dafuer) noch ein paar Korrekturen bei den Classpath und Buildpath Einstellungen eingepflegt

Modified: trunk/docs/CacheWolf_on_Linux.pdf
===================================================================
(Binary files differ)



From wpawlas at online.de  Thu Mar 12 20:59:05 2009
From: wpawlas at online.de (Waldemar Pawlasczyk)
Date: Thu, 12 Mar 2009 20:59:05 +0100
Subject: [Cachewolf-svn] (kein Betreff)
Message-ID: <49B96989.40808@online.de>



From mik77 at mail.berlios.de  Sat Mar 14 13:28:42 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 14 Mar 2009 13:28:42 +0100
Subject: [Cachewolf-svn] r1699 - trunk/src/utils
Message-ID: <200903141228.n2ECSgJJ001495@sheep.berlios.de>

Author: mik77
Date: 2009-03-14 13:28:37 +0100 (Sat, 14 Mar 2009)
New Revision: 1699

Modified:
   trunk/src/utils/CWWrapper.java
Log:
Only set quotes in external calls when spaces are present.

Modified: trunk/src/utils/CWWrapper.java
===================================================================
--- trunk/src/utils/CWWrapper.java	2009-03-12 19:57:53 UTC (rev 1698)
+++ trunk/src/utils/CWWrapper.java	2009-03-14 12:28:37 UTC (rev 1699)
@@ -23,11 +23,17 @@
 		if (Vm.getPlatform().equals("WinCE") ||
 		    Vm.getPlatform().equals("Win32")) {
 			/* we need extra quotes here, see vm/nmwin32_c.c */
-			arg = "\"" + arg + "\"";
+			if (arg.indexOf(" ") > -1)
+				arg = "\"" + arg + "\"";
 		} else if (Vm.getPlatform().equals("Java")) {
-			/* we need extra quotes here, see ewe/sys/Vm.java */
-			cmd = "\"" + cmd + "\"";
-			arg = "\"" + arg + "\"";
+			/* on win32 we need extra quotes here to support filenames whith spaces
+			 * (see ewe/sys/Vm.java)			 *
+			 * on linux (and os x?) we must not have extra quotes, filenames with spaces are unsupported
+			 * */
+			if (cmd.indexOf(" ") > -1)
+				cmd = "\"" + cmd + "\"";
+			if (arg.indexOf(" ") > -1)
+				arg = "\"" + arg + "\"";
 		}
 		Vm.exec(cmd, arg, 0, false);
 	}



From mik77 at mail.berlios.de  Sat Mar 14 14:35:15 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 14 Mar 2009 14:35:15 +0100
Subject: [Cachewolf-svn] r1700 - in trunk: res_noewe src/CacheWolf
Message-ID: <200903141335.n2EDZFYY029138@sheep.berlios.de>

Author: mik77
Date: 2009-03-14 14:35:12 +0100 (Sat, 14 Mar 2009)
New Revision: 1700

Modified:
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/SpiderGC.java
Log:
Add max spider radius to URL. So we can get caches more than 80km away. This should also reduce load for GC when spidering smaller distances

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-03-14 12:28:37 UTC (rev 1699)
+++ trunk/res_noewe/spider.def	2009-03-14 13:35:12 UTC (rev 1700)
@@ -24,6 +24,7 @@
 # Version 4.0 - 20080725 adaption to new GC-design
 # Version 4.1 - 20080725 adaption to new GC-design (images and travelbugs)
 # Version 4.2 - 20081031 Fix for cache type (background image with name of type)
+# Version 4.3 - 20090314 maxDistance string added
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -48,6 +49,7 @@
 distRex            = <br\ />(.*?)(?:km|mi)(?:\\s*)</td>
 waypointRex        = \\(GC(.*?)\\)<br\ />
 showOnlyFound      = &f=1
+maxDistance        = &dist=
 firstLine          = http://www.geocaching.com/seek/nearest.aspx?
 nextListPage       = /seek/nearest.aspx
 

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-14 12:28:37 UTC (rev 1699)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-14 13:35:12 UTC (rev 1700)
@@ -323,7 +323,15 @@
 		boolean doNotgetFound = options.foundCheckBox.getState();
 		boolean getImages = options.imagesCheckBox.getState();
 		options.close(0);
-		
+
+		//max distance in miles for URL, so we can get more than 80km
+		double saveDistanceInMiles = distance;
+		if ( Global.getPref().metricSystem != Metrics.IMPERIAL ) {
+			saveDistanceInMiles = Metrics.convertUnit(distance, Metrics.KILOMETER, Metrics.MILES);
+		}
+		// add a mile to be save from different distance calculations in CW and at GC
+		saveDistanceInMiles = java.lang.Math.ceil(saveDistanceInMiles) + 1;
+
 		Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
 		double distanceInKm = distance;
 		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
@@ -344,8 +352,9 @@
 		infB.exec();
 		//Get first page
 		try{
-			ln = p.getProp("firstPage") + origin.getLatDeg(CWPoint.DD) + p.getProp("firstPage2") +origin.getLonDeg(CWPoint.DD);
-			if(doNotgetFound) ln = ln + "&f=1";
+			ln = p.getProp("firstPage") + origin.getLatDeg(CWPoint.DD) + p.getProp("firstPage2") + origin.getLonDeg(CWPoint.DD)
+			                            + p.getProp("maxDistance") + Integer.toString( (int)saveDistanceInMiles );			
+			if(doNotgetFound) ln = ln + p.getProp("showOnlyFound");;
 			pref.log("Getting first page: "+ln);
 			start = fetch(ln);
 			pref.log("Got first page");
@@ -433,7 +442,8 @@
 				}
 				infB.setInfo(MyLocale.getMsg(5511,"Found ") + cachesToLoad.size() + MyLocale.getMsg(5512," caches"));
 				if(found_on_page < 20) distance = 0;
-				postStr = p.getProp("firstLine") + origin.getLatDeg(CWPoint.DD) + "&" + origin.getLonDeg(CWPoint.DD);
+				postStr = p.getProp("firstLine") + origin.getLatDeg(CWPoint.DD) + "&" + origin.getLonDeg(CWPoint.DD)
+							                     + p.getProp("maxDistance") + Integer.toString( (int)saveDistanceInMiles );			
 				if(doNotgetFound) postStr = postStr + p.getProp("showOnlyFound");
 				if(distance > 0){
 					page_number++;



From mik77 at mail.berlios.de  Sat Mar 14 18:04:20 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 14 Mar 2009 18:04:20 +0100
Subject: [Cachewolf-svn] r1701 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200903141704.n2EH4KwU018555@sheep.berlios.de>

Author: mik77
Date: 2009-03-14 18:04:17 +0100 (Sat, 14 Mar 2009)
New Revision: 1701

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Updating caches when spidering made configurable.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-14 13:35:12 UTC (rev 1700)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-14 17:04:17 UTC (rev 1701)
@@ -199,7 +199,11 @@
 		635=Gr%f6%dfe
 		636=OC Empfehlungen
 		637=OC Index
-		638=Bilder in Beschreibung anzeigen		
+		638=Bilder in Beschreibung anzeigen
+		639=Caches beim Spidern aktualisieren?
+		640=Ja
+		641=Nein
+		642=Nachfragen
 		700=Filter setzen
 		701=Entfernung
 		702=Schwierigkeit
@@ -730,6 +734,8 @@
 		5514=%0aTravelbug:+ 
 		5515=Fehler beim Laden des Caches.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung.%0aNoch einmal versuchen?
 		5516=+Cachebeschreibungen%0akonnten nicht geladen werden.
+		5517=Aktualisierungen spidern?
+		5518=+Caches in der Datenbank sollten aktualisiert werden. Jetzt aktualisieren?
 		6000=Guid
 		6001=Name
 		6002=Track#

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-14 13:35:12 UTC (rev 1700)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-14 17:04:17 UTC (rev 1701)
@@ -199,7 +199,11 @@
 		635=Size
 		636=OC Recs
 		637=OC Index
-		638=Show pictures in description		
+		638=Show pictures in description
+		639=Update caches when spidering?
+		640=Yes
+		641=No
+		642=Ask
 		700=Set filter
 		701=Distance
 		702=Difficulty
@@ -718,6 +722,8 @@
 		5514=%0aGetting bug:+
 		5515=Failed to load cache.%0aPlease check your internet connection.%0aRetry?
 		5516=+cache descriptions%0acould not be loaded.
+		5517=Spider updates?
+		5518=+caches in database need an update. Update now?
 		6000=Guid
 		6001=Name
 		6002=track#

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-03-14 13:35:12 UTC (rev 1700)
+++ trunk/src/CacheWolf/Preferences.java	2009-03-14 17:04:17 UTC (rev 1701)
@@ -20,6 +20,9 @@
 	public final int DEFAULT_MAX_LOGS_TO_SPIDER=250;
 	public final int DEFAULT_LOGS_PER_PAGE=5;
 	public final int DEFAULT_INITIAL_HINT_HEIGHT=10;
+	public static final int YES = 0;
+	public static final int NO = 1;
+	public static final int ASK = 2;
 
 	//////////////////////////////////////////////////////////////////////////////////////
     // Constructor
@@ -196,6 +199,8 @@
 	public String language="";
 	/** The metric system to use */
 	public int metricSystem = Metrics.METRIC;
+	/** Load updated caches while spidering */
+	public int spiderUpdates = ASK;
 
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
@@ -361,6 +366,8 @@
 		}
 		else if (name.equals("spider")) {
 			forceLogin = Boolean.valueOf(atts.getValue("forcelogin")).booleanValue();
+			tmp = atts.getValue("spiderUpdates");
+			if (tmp != null) spiderUpdates=Convert.parseInt(tmp);
 		}
 		else if (name.equals("details")) {
 			maxDetails=Common.parseInt(atts.getValue("cacheSize"));
@@ -432,7 +439,7 @@
 			outp.print("    <garmin connection = \"" + SafeXML.strxmlencode(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.strxmlencode(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) + "\" />\n");
 			outp.print("    <opencaching downloadPicsOC=\"" + SafeXML.strxmlencode(downloadPicsOC) + "\" downloadMaps=\"" + SafeXML.strxmlencode(downloadMapsOC) + "\" downloadMissing=\"" + SafeXML.strxmlencode(downloadmissingOC) + "\"/>\n");
 			outp.print("	<location lat = \"" + SafeXML.strxmlencode(curCentrePt.getLatDeg(CWPoint.DD)) + "\" long = \"" + SafeXML.strxmlencode(curCentrePt.getLonDeg(CWPoint.DD)) + "\"/>\n");
-			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\"/>\n");
+			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\"/>\n");
 			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
 			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
 			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\"/>\n");

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2009-03-14 13:35:12 UTC (rev 1700)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2009-03-14 17:04:17 UTC (rev 1701)
@@ -16,8 +16,8 @@
 */
 public class PreferencesScreen extends Form {
 	mButton cancelB, applyB, brwBt, gpsB,btnCentre;
-	mChoice NS, EW, inpLanguage, inpMetric;
-	mInput NSDeg, NSm, EWDeg, EWm, DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, inpGPS, 
+	mChoice inpLanguage, inpMetric, inpSpiderUpdates;
+	mInput DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, inpGPS, 
 	       inpLogsPerPage,inpMaxLogsToSpider,inpPassword;
 	mCheckBox dif, ter, loc, own, hid, stat, dist, bear, chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, 
 	          chkTabsAtTop, chkShowStatus,chkHasCloseButton,chkSynthShort,chkProxyActive, chkDescShowImg;
@@ -175,10 +175,15 @@
 		inpLogsPerPage.setPreferredSize(40,-1);
 		//inpLogsPerPage.setTag(INSETS,new Insets(0,0,2,0));
 		//lblHlP.setTag(INSETS,new Insets(6,0,2,0));
+
 		frmHintLog.addNext(new mLabel(MyLocale.getMsg(633,"Max. logs to spider")),CellConstants.DONTSTRETCH,CellConstants.DONTFILL);	
 		frmHintLog.addLast(inpMaxLogsToSpider=new mInput(),CellConstants.DONTSTRETCH,CellConstants.DONTFILL|CellConstants.EAST);
 		inpMaxLogsToSpider.setText(Convert.toString(pref.maxLogsToSpider));
 		inpMaxLogsToSpider.setPreferredSize(40,-1);
+		
+		String [] spiderUpdateOptions = { MyLocale.getMsg(640,"Yes"), MyLocale.getMsg(641,"No"), MyLocale.getMsg(642,"Ask") };
+		frmHintLog.addNext(new mLabel( MyLocale.getMsg(639,"Update caches when spidering?") ),DONTSTRETCH,DONTFILL|WEST);
+		frmHintLog.addLast(inpSpiderUpdates=new mChoice(spiderUpdateOptions, pref.spiderUpdates),DONTSTRETCH,DONTFILL|WEST);
 		pnlDisplay.addLast(frmHintLog,CellConstants.STRETCH,CellConstants.FILL);
 
 		/////////////////////////////////////////////////////////
@@ -308,6 +313,7 @@
 				pref.descShowImg=chkDescShowImg.getState();
 				Global.mainTab.tbP.myMod.setColumnNamesAndWidths();
 				pref.metricSystem = inpMetric.getInt() == 0 ? Metrics.METRIC : Metrics.IMPERIAL;
+				pref.spiderUpdates = inpSpiderUpdates.getInt();
 				pref.savePreferences();
 				pref.dirty = true; // Need to update table in case columns were enabled/disabled
 				this.close(0);

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-14 13:35:12 UTC (rev 1700)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-14 17:04:17 UTC (rev 1701)
@@ -476,7 +476,8 @@
 			Vm.showWait(false);
 			return;
 		}
-		pref.log("Found " + cachesToLoad.size() + " caches");
+		pref.log("Found " + cachesToLoad.size() + " new caches");
+		pref.log("Found " + cachesToUpdate.size() + " caches for update");
 		if (!infB.isClosed) infB.setInfo(MyLocale.getMsg(5511,"Found ") + cachesToLoad.size() + MyLocale.getMsg(5512," caches"));
 
 		//=======
@@ -485,6 +486,21 @@
 		boolean loadAllLogs = (MAXLOGS > 5);
 
 		int spiderErrors = 0;
+		
+		if ( cachesToUpdate.size() > 0 ) {
+			switch (pref.spiderUpdates) {
+			case Preferences.NO:
+				cachesToUpdate.clear();
+				break;
+			case Preferences.ASK:
+				MessageBox mBox = new MessageBox(MyLocale.getMsg(5517,"Spider Updates?"), "" + cachesToUpdate.size() + MyLocale.getMsg(5518," caches in database need an update. Update now?") , FormBase.IDYES |FormBase.IDNO);
+				if (mBox.execute() != FormBase.IDOK){
+					cachesToUpdate.clear();
+				}
+				break;
+			}
+		}
+		
 		int totalCachesToLoad = cachesToLoad.size() + cachesToUpdate.size();
 
 		for(int i = 0; i<cachesToLoad.size(); i++){



From silas at mail.berlios.de  Sat Mar 14 19:57:07 2009
From: silas at mail.berlios.de (silas at mail.berlios.de)
Date: Sat, 14 Mar 2009 19:57:07 +0100
Subject: [Cachewolf-svn] r1702 - trunk/src/CacheWolf
Message-ID: <200903141857.n2EIv7bL002639@sheep.berlios.de>

Author: silas
Date: 2009-03-14 19:56:58 +0100 (Sat, 14 Mar 2009)
New Revision: 1702

Modified:
   trunk/src/CacheWolf/HintLogPanel.java
Log:
added feature for partial hint decoding

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2009-03-14 17:04:17 UTC (rev 1701)
+++ trunk/src/CacheWolf/HintLogPanel.java	2009-03-14 18:56:58 UTC (rev 1702)
@@ -1,260 +1,281 @@
-package CacheWolf;
-
-import ewe.ui.*;
-import ewe.fx.Dimension;
-import ewe.fx.Graphics;
-import ewe.fx.Point;
-import ewe.fx.mImage;
-import ewe.graphics.AniImage;
-import ewe.graphics.ImageDragContext;
-import ewe.graphics.InteractivePanel;
-import ewe.sys.*;
-import ewe.fx.Image;
-import ewe.fx.Rect;
-
-/**
- *	Class to create the panel that holds hints and logs.
- *	It holds a method to cryt and decrypt hints.
- *	Two buttons allow for navigation through the logs. 5 logs are displayed at
- *   together. This was implemented to allow for better performance on the
- *	PocketPC. This number can be changed in the preferences.
- *	Class ID=400
- */
-public class HintLogPanel extends CellPanel{
-	int crntLogPosition = 0;
-	CacheHolderDetail currCache;
-	private final int DEFAULT_STRINGBUFFER_SIZE=8000;
-	mTextPad hint = new mTextPad();
-	//mTextPad logs = new mTextPad();
-	HtmlDisplay logs = new HtmlDisplay();
-	AniImage htmlTxtImage;
-	fastScrollText htmlImagDisp = new fastScrollText();
-	mButton decodeButton = new mButton("Decode");
-	mButton moreBt = new mButton(">>");
-	mButton prevBt = new mButton("<<");
-	private MyScrollBarPanel sbplog;
-	private int lastScrollbarWidth = 0;
-	
-	public HintLogPanel(){
-		SplittablePanel split = new SplittablePanel(PanelSplitter.VERTICAL);
-		CellPanel logpane = split.getNextPanel();
-		CellPanel hintpane = split.getNextPanel();
-		split.setSplitter(PanelSplitter.AFTER|PanelSplitter.HIDDEN,PanelSplitter.BEFORE|PanelSplitter.HIDDEN,0);
-		int initialHintHeight=Global.getPref().initialHintHeight;
-		if (initialHintHeight<0 || initialHintHeight>1000) initialHintHeight=Global.getPref().DEFAULT_INITIAL_HINT_HEIGHT;
-		hintpane.setPreferredSize(100,initialHintHeight); 
-		ScrollBarPanel sbphint = new MyScrollBarPanel(hint);
-		hintpane.addLast(sbphint,CellConstants.STRETCH, (CellConstants.FILL|CellConstants.WEST));
-		hintpane.addNext(prevBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		hintpane.addNext(decodeButton,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		decodeButton.setMinimumSize(MyLocale.getScreenWidth()*2/3,10);
-		hintpane.addLast(moreBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
-		hint.modify(ControlConstants.NotEditable,0);
-
-		sbplog = new MyScrollBarPanel(htmlImagDisp, ScrollablePanel.NeverShowHorizontalScrollers);
-		//logpane.addLast(sbplog,CellConstants.STRETCH, CellConstants.FILL);
-		Rect r = new Rect(new Dimension (Global.getPref().myAppWidth-sbplog.vbar.getRect().width, 20));
-		htmlImagDisp.virtualSize = r;
-		htmlImagDisp.checkScrolls();
-		logpane.addLast(sbplog.getScrollablePanel(), CellConstants.STRETCH, CellConstants.FILL);
-		this.addLast(split);
-		clear();
-	}
-
-	public void setText(CacheHolderDetail cache){
-	        if (currCache != cache){
-	            this.currCache = cache;
-	            if(!cache.Hints.equals("null")) 
-	                hint.setText(STRreplace.replace(cache.Hints, "<br>", "\n"));
-	            else
-	                hint.setText("");
-	            crntLogPosition = 0;
-	            setLogs(0);
-	            moreBt.modify(0,ControlConstants.Disabled);
-	            prevBt.modify(0,ControlConstants.Disabled);
-	        }
-	}
-
-	public void clear() {
-	    clearOutput();
-	    currCache = null;
-	}
-	private void clearOutput() {
-		if (htmlTxtImage != null) {
-			htmlImagDisp.removeImage(htmlTxtImage);
-			htmlTxtImage.free();		
-		}
-	}
-	void setLogs(int crntLogPosition) {
-		Vm.showWait(true);
-		StringBuffer dummy = new StringBuffer(DEFAULT_STRINGBUFFER_SIZE);
-		int counter = 0;
-		int nLogs=currCache.CacheLogs.size();
-		int logsPerPage=Global.getPref().logsPerPage;
-		for(int i = crntLogPosition; i<nLogs; i++){
-			dummy.append(currCache.CacheLogs.getLog(i).toHtml());
-			dummy.append("</br>");
-			if(++counter >= logsPerPage) break;
-		}
-		clearOutput();
-		logs.resizeTo(width, 50);
-		// The cache GCP0T6 crashes the HtmlDisplay
-		// As a temporary fix
-		try {
-			logs.setHtml(dummy.toString());
-		} catch (Exception e) {
-			logs=new HtmlDisplay();
-			Global.getPref().log("Error rendering HTML",e,true);
-			logs.setPlainText("Ewe VM: Internal error displaying logs");
-		}
-		int h = logs.getLineHeight() * logs.getNumLines();
-		htmlTxtImage = new AniImage(new Image(width, h));
-		htmlTxtImage.setLocation(0, 0);
-		htmlTxtImage.properties |= mImage.IsMoveable;
-		Graphics draw = new Graphics(htmlTxtImage.image);
-		logs.resizeTo(htmlTxtImage.getWidth()-lastScrollbarWidth, htmlTxtImage.getHeight());
-		logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
-		htmlImagDisp.addImage(htmlTxtImage);
-		Rect r = new Rect(new Dimension (width, h));
-		htmlImagDisp.virtualSize = r;
-		htmlImagDisp.origin = new Point();
-		htmlImagDisp.checkScrolls();
-		// Can I get a reasonable value for scrollbarWidth before calling checkScrolls() 
-		// and in a more reasonable way?
-		// Now its ugly: I paint it, calculate the scrollbars and then resize the panel...
-		// Better: Now I only redo it when the scrollbar width changed, which is not the case
-		// normally.
-		int scrollbarWidth = sbplog.vbar.getRect().width;
-		if (scrollbarWidth != lastScrollbarWidth) { 
-		    lastScrollbarWidth = scrollbarWidth;
-    		    logs.resizeTo(htmlTxtImage.getWidth()-scrollbarWidth, htmlTxtImage.getHeight());
-    		    logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
-		}
-		htmlImagDisp.repaintNow();
-		repaintNow();
-		Vm.showWait(false);
-	}
-
-	/**
-	 * Method that handles user input on this panel.
-	 * It handles decryption of hints and navigation through
-	 * the logs (always 5 at a time). Navigation of logs is required
-	 * for performance reasons on the pocketpc.
-	 */
-	public void onEvent(Event ev){
-		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
-			int minLogs = java.lang.Math.min(Global.getPref().logsPerPage, currCache.CacheLogs.size());
-			if(ev.target == moreBt){
-				prevBt.modify(0,ControlConstants.Disabled);
-				prevBt.repaintNow();
-				crntLogPosition += minLogs;
-				if(crntLogPosition >= currCache.CacheLogs.size()) {
-					//crntLogPosition = cache.CacheLogs.size()-5;
-					crntLogPosition = currCache.CacheLogs.size()- minLogs;
-					moreBt.modify(ControlConstants.Disabled,0);
-					moreBt.repaintNow();
-				}
-				setLogs(crntLogPosition);
-			} // = moreBt
-			if(ev.target == prevBt){
-				moreBt.modify(0,ControlConstants.Disabled);
-				moreBt.repaintNow();
-				crntLogPosition -= minLogs;
-				if(crntLogPosition <= 0) {
-					prevBt.modify(ControlConstants.Disabled,0);
-					prevBt.repaintNow();
-					crntLogPosition = 0;
-				}
-				setLogs(crntLogPosition);
-			}
-			if(ev.target == decodeButton){
-				hint.setText(Common.rot13(hint.getText()));
-			}
-		}
-	}
-}
-
-class fastScrollText extends InteractivePanel { // TODO extend this class in a way that text can be marked and copied
-	public boolean scrollVertical = true;
-	public boolean scrollHorizontal = false;
-	public boolean imageNotDragged(ImageDragContext drag,Point where) {
-		if (drag == null || drag.image == null) return super.imageNotDragged(drag, where);
-		getDim(null);
-		if (drag.image.location.y <= 0 ){
-			drag.image.move(0, drag.image.location.y);
-		} else {
-			drag.image.move(0, 0);
-		}
-		return	super.imageNotDragged(drag, where);
-	}
-	
-	// I copied it here because the original has a bug when scrolling
-	// added the support for scrolling / draggin only vertically
-	// rewrite to support for images bigger than the canvas
-	// the return value is never used
-//	============================================================
-	public boolean imageDragged(ImageDragContext dc,Point where)
-//	============================================================
-	{
-		dc.curPoint = new Point(where.x,where.y);
-		AniImage moving = dc.image;
-		Rect r = getDim(null);
-		boolean didAutoScroll = false;
-		Point to = new Point(where.x-dc.start.x,where.y-dc.start.y);
-		if (!scrollHorizontal) to.x = 0;
-		if (!scrollVertical) to.y = 0;
-		//if (origin.y - to.y < 0 || origin.y - to.y + r.height > moving.location.height) return true; 
-		if (moving == null) { // this is not used only copied
-			if (!dragBackground) return true;
-			int dx = dc.start.x-where.x, dy = dc.start.y-where.y;
-			if (where.x < origin.x || where.x >= origin.x+r.width || where.y < origin.y || where.y >= origin.y+r.height && autoScrolling){
-				if (where.x <= origin.x) dx = scrollStep;
-				if (where.x >= origin.x+r.width) dx = -scrollStep;
-				if (where.y <= origin.y) dy = scrollStep;
-				if (where.y >= origin.y+r.height) dy = -scrollStep; // here +/- is wrong in InteractivePanel.java
-				dc.start.x = where.x; dc.start.y = where.y;
-			}
-			//dc.start.move(where.x,where.y);
-			if (dx != 0 || dy != 0) scroll(dx,dy);
-			refresh();
-			return true;
-		}else if (true || where.x < origin.x || where.x >= origin.x+r.width || where.y < origin.y || where.y >= origin.y+r.height){
-	 			if (autoScrolling) {
-					didAutoScroll = true;
-					scroll(-to.x,-to.y);
-			}
-		}
-/*		if (moving.canGo(to)) {
-			moving.move(to.x,to.y);
-			draggingImage(dc);
-			if (ri != null) ri.dragEvent(this,ri.Drag,dc);
-		}
-	*/	checkTouching(dc,false);
-		if (didAutoScroll) refresh();
-		else refresh(dc.image,null);//updateImage(dc.image);
-		return(true);
-	}
-	public void onKeyEvent(KeyEvent ev) {
-		if (ev.type == KeyEvent.KEY_PRESS) {
-			if (ev.key == IKeys.DOWN) {
-				 doScroll(IScroll.Vertical, IScroll.ScrollHigher, 1);
-				 refresh();
-			}
-			if (ev.key == IKeys.UP) {
-				 doScroll(IScroll.Vertical, IScroll.ScrollLower, 1);
-				 refresh();
-			}
-			if (ev.key == IKeys.PAGE_DOWN) {
-				 doScroll(IScroll.Vertical, IScroll.PageHigher, 1);
-				 refresh();
-			}
-			if (ev.key == IKeys.PAGE_UP) {
-				 doScroll(IScroll.Vertical, IScroll.PageLower, 1);
-				 refresh();
-			}
-		}
-	}
-
-	
-	
-}
+package CacheWolf;
+
+import ewe.ui.*;
+import ewe.fx.Dimension;
+import ewe.fx.Graphics;
+import ewe.fx.Point;
+import ewe.fx.mImage;
+import ewe.graphics.AniImage;
+import ewe.graphics.ImageDragContext;
+import ewe.graphics.InteractivePanel;
+import ewe.sys.*;
+import ewe.fx.Image;
+import ewe.fx.Rect;
+
+/**
+ *	Class to create the panel that holds hints and logs.
+ *	It holds a method to cryt and decrypt hints.
+ *	Two buttons allow for navigation through the logs. 5 logs are displayed at
+ *   together. This was implemented to allow for better performance on the
+ *	PocketPC. This number can be changed in the preferences.
+ *	Class ID=400
+ */
+public class HintLogPanel extends CellPanel{
+	int crntLogPosition = 0;
+	CacheHolderDetail currCache;
+	private final int DEFAULT_STRINGBUFFER_SIZE=8000;
+	mTextPad hint = new mTextPad();
+	//mTextPad logs = new mTextPad();
+	HtmlDisplay logs = new HtmlDisplay();
+	AniImage htmlTxtImage;
+	fastScrollText htmlImagDisp = new fastScrollText();
+	mButton decodeButton = new mButton("Decode");
+	mButton moreBt = new mButton(">>");
+	mButton prevBt = new mButton("<<");
+	private MyScrollBarPanel sbplog;
+	private int lastScrollbarWidth = 0;
+	private boolean hintIsDecoded = false;
+
+	public HintLogPanel(){
+		SplittablePanel split = new SplittablePanel(PanelSplitter.VERTICAL);
+		CellPanel logpane = split.getNextPanel();
+		CellPanel hintpane = split.getNextPanel();
+		split.setSplitter(PanelSplitter.AFTER|PanelSplitter.HIDDEN,PanelSplitter.BEFORE|PanelSplitter.HIDDEN,0);
+		int initialHintHeight=Global.getPref().initialHintHeight;
+		if (initialHintHeight<0 || initialHintHeight>1000) initialHintHeight=Global.getPref().DEFAULT_INITIAL_HINT_HEIGHT;
+		hintpane.setPreferredSize(100,initialHintHeight); 
+		ScrollBarPanel sbphint = new MyScrollBarPanel(hint);
+		hintpane.addLast(sbphint,CellConstants.STRETCH, (CellConstants.FILL|CellConstants.WEST));
+		hintpane.addNext(prevBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		hintpane.addNext(decodeButton,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		decodeButton.setMinimumSize(MyLocale.getScreenWidth()*2/3,10);
+		hintpane.addLast(moreBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
+		hint.modify(ControlConstants.NotEditable,0);
+
+		sbplog = new MyScrollBarPanel(htmlImagDisp, ScrollablePanel.NeverShowHorizontalScrollers);
+		//logpane.addLast(sbplog,CellConstants.STRETCH, CellConstants.FILL);
+		Rect r = new Rect(new Dimension (Global.getPref().myAppWidth-sbplog.vbar.getRect().width, 20));
+		htmlImagDisp.virtualSize = r;
+		htmlImagDisp.checkScrolls();
+		logpane.addLast(sbplog.getScrollablePanel(), CellConstants.STRETCH, CellConstants.FILL);
+		this.addLast(split);
+		clear();
+	}
+
+	public void setText(CacheHolderDetail cache){
+		if (currCache != cache){
+			this.currCache = cache;
+			resetHintText();
+			crntLogPosition = 0;
+			setLogs(0);
+			moreBt.modify(0,ControlConstants.Disabled);
+			prevBt.modify(0,ControlConstants.Disabled);
+		}
+	}
+	public void clear() {
+	    clearOutput();
+	    currCache = null;
+	}
+	private void clearOutput() {
+		if (htmlTxtImage != null) {
+			htmlImagDisp.removeImage(htmlTxtImage);
+			htmlTxtImage.free();		
+		}
+	}
+	void setLogs(int crntLogPosition) {
+		Vm.showWait(true);
+		StringBuffer dummy = new StringBuffer(DEFAULT_STRINGBUFFER_SIZE);
+		int counter = 0;
+		int nLogs=currCache.CacheLogs.size();
+		int logsPerPage=Global.getPref().logsPerPage;
+		for(int i = crntLogPosition; i<nLogs; i++){
+			dummy.append(currCache.CacheLogs.getLog(i).toHtml());
+			dummy.append("</br>");
+			if(++counter >= logsPerPage) break;
+		}
+		clearOutput();
+		logs.resizeTo(width, 50);
+		// The cache GCP0T6 crashes the HtmlDisplay
+		// As a temporary fix
+		try {
+			logs.setHtml(dummy.toString());
+		} catch (Exception e) {
+			logs=new HtmlDisplay();
+			Global.getPref().log("Error rendering HTML",e,true);
+			logs.setPlainText("Ewe VM: Internal error displaying logs");
+		}
+		int h = logs.getLineHeight() * logs.getNumLines();
+		htmlTxtImage = new AniImage(new Image(width, h));
+		htmlTxtImage.setLocation(0, 0);
+		htmlTxtImage.properties |= mImage.IsMoveable;
+		Graphics draw = new Graphics(htmlTxtImage.image);
+		logs.resizeTo(htmlTxtImage.getWidth()-lastScrollbarWidth, htmlTxtImage.getHeight());
+		logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
+		htmlImagDisp.addImage(htmlTxtImage);
+		Rect r = new Rect(new Dimension (width, h));
+		htmlImagDisp.virtualSize = r;
+		htmlImagDisp.origin = new Point();
+		htmlImagDisp.checkScrolls();
+		// Can I get a reasonable value for scrollbarWidth before calling checkScrolls() 
+		// and in a more reasonable way?
+		// Now its ugly: I paint it, calculate the scrollbars and then resize the panel...
+		// Better: Now I only redo it when the scrollbar width changed, which is not the case
+		// normally.
+		int scrollbarWidth = sbplog.vbar.getRect().width;
+		if (scrollbarWidth != lastScrollbarWidth) { 
+		    lastScrollbarWidth = scrollbarWidth;
+    		    logs.resizeTo(htmlTxtImage.getWidth()-scrollbarWidth, htmlTxtImage.getHeight());
+    		    logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
+		}
+		htmlImagDisp.repaintNow();
+		repaintNow();
+		Vm.showWait(false);
+	}
+
+	/**
+	 * Method that handles user input on this panel.
+	 * It handles decryption of hints and navigation through
+	 * the logs (always 5 at a time). Navigation of logs is required
+	 * for performance reasons on the pocketpc.
+	 */
+	public void onEvent(Event ev){
+		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
+			int minLogs = java.lang.Math.min(Global.getPref().logsPerPage, currCache.CacheLogs.size());
+			if(ev.target == moreBt){
+				prevBt.modify(0,ControlConstants.Disabled);
+				prevBt.repaintNow();
+				crntLogPosition += minLogs;
+				if(crntLogPosition >= currCache.CacheLogs.size()) {
+					//crntLogPosition = cache.CacheLogs.size()-5;
+					crntLogPosition = currCache.CacheLogs.size()- minLogs;
+					moreBt.modify(ControlConstants.Disabled,0);
+					moreBt.repaintNow();
+				}
+				setLogs(crntLogPosition);
+			} // = moreBt
+			if(ev.target == prevBt){
+				moreBt.modify(0,ControlConstants.Disabled);
+				moreBt.repaintNow();
+				crntLogPosition -= minLogs;
+				if(crntLogPosition <= 0) {
+					prevBt.modify(ControlConstants.Disabled,0);
+					prevBt.repaintNow();
+					crntLogPosition = 0;
+				}
+				setLogs(crntLogPosition);
+			}
+			if(ev.target == decodeButton){
+				if(!hintIsDecoded)
+					decodeHintText();
+				else
+					resetHintText();
+			}
+		}
+	}
+
+	private void decodeHintText() {
+		if (hint.getText().length() > 0) {
+			Object selection = hint.getSelection();
+			if(selection != null)
+				hint.replaceSelection(Common.rot13(selection.toString()));
+			else
+				hint.setText(Common.rot13(hint.getText()));
+			decodeButton.setText("Encode");
+			hintIsDecoded = true;
+		}
+	}
+	private void resetHintText() {
+		if(!currCache.Hints.equals("null"))
+			hint.setText(STRreplace.replace(this.currCache.Hints, "<br>", "\n"));
+		else
+			hint.setText("");
+		decodeButton.setText("Decode");
+		hintIsDecoded = false;
+	}
+
+}
+
+class fastScrollText extends InteractivePanel { // TODO extend this class in a way that text can be marked and copied
+	public boolean scrollVertical = true;
+	public boolean scrollHorizontal = false;
+	public boolean imageNotDragged(ImageDragContext drag,Point where) {
+		if (drag == null || drag.image == null) return super.imageNotDragged(drag, where);
+		getDim(null);
+		if (drag.image.location.y <= 0 ){
+			drag.image.move(0, drag.image.location.y);
+		} else {
+			drag.image.move(0, 0);
+		}
+		return	super.imageNotDragged(drag, where);
+	}
+	
+	// I copied it here because the original has a bug when scrolling
+	// added the support for scrolling / draggin only vertically
+	// rewrite to support for images bigger than the canvas
+	// the return value is never used
+//	============================================================
+	public boolean imageDragged(ImageDragContext dc,Point where)
+//	============================================================
+	{
+		dc.curPoint = new Point(where.x,where.y);
+		AniImage moving = dc.image;
+		Rect r = getDim(null);
+		boolean didAutoScroll = false;
+		Point to = new Point(where.x-dc.start.x,where.y-dc.start.y);
+		if (!scrollHorizontal) to.x = 0;
+		if (!scrollVertical) to.y = 0;
+		//if (origin.y - to.y < 0 || origin.y - to.y + r.height > moving.location.height) return true; 
+		if (moving == null) { // this is not used only copied
+			if (!dragBackground) return true;
+			int dx = dc.start.x-where.x, dy = dc.start.y-where.y;
+			if (where.x < origin.x || where.x >= origin.x+r.width || where.y < origin.y || where.y >= origin.y+r.height && autoScrolling){
+				if (where.x <= origin.x) dx = scrollStep;
+				if (where.x >= origin.x+r.width) dx = -scrollStep;
+				if (where.y <= origin.y) dy = scrollStep;
+				if (where.y >= origin.y+r.height) dy = -scrollStep; // here +/- is wrong in InteractivePanel.java
+				dc.start.x = where.x; dc.start.y = where.y;
+			}
+			//dc.start.move(where.x,where.y);
+			if (dx != 0 || dy != 0) scroll(dx,dy);
+			refresh();
+			return true;
+		}else if (true || where.x < origin.x || where.x >= origin.x+r.width || where.y < origin.y || where.y >= origin.y+r.height){
+	 			if (autoScrolling) {
+					didAutoScroll = true;
+					scroll(-to.x,-to.y);
+			}
+		}
+/*		if (moving.canGo(to)) {
+			moving.move(to.x,to.y);
+			draggingImage(dc);
+			if (ri != null) ri.dragEvent(this,ri.Drag,dc);
+		}
+	*/	checkTouching(dc,false);
+		if (didAutoScroll) refresh();
+		else refresh(dc.image,null);//updateImage(dc.image);
+		return(true);
+	}
+	public void onKeyEvent(KeyEvent ev) {
+		if (ev.type == KeyEvent.KEY_PRESS) {
+			if (ev.key == IKeys.DOWN) {
+				 doScroll(IScroll.Vertical, IScroll.ScrollHigher, 1);
+				 refresh();
+			}
+			if (ev.key == IKeys.UP) {
+				 doScroll(IScroll.Vertical, IScroll.ScrollLower, 1);
+				 refresh();
+			}
+			if (ev.key == IKeys.PAGE_DOWN) {
+				 doScroll(IScroll.Vertical, IScroll.PageHigher, 1);
+				 refresh();
+			}
+			if (ev.key == IKeys.PAGE_UP) {
+				 doScroll(IScroll.Vertical, IScroll.PageLower, 1);
+				 refresh();
+			}
+		}
+	}
+
+	
+	
+}



From mik77 at mail.berlios.de  Sat Mar 14 20:08:02 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 14 Mar 2009 20:08:02 +0100
Subject: [Cachewolf-svn] r1703 - in trunk: res_noewe res_noewe/languages
	src/CacheWolf
Message-ID: <200903141908.n2EJ82fi003426@sheep.berlios.de>

Author: mik77
Date: 2009-03-14 20:07:58 +0100 (Sat, 14 Mar 2009)
New Revision: 1703

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Spidering all finds added

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-14 18:56:58 UTC (rev 1702)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-14 19:07:58 UTC (rev 1703)
@@ -105,6 +105,8 @@
 		213=Verwaiste .xml Dateien l%f6schen
 		214=Neuer Wegpunkt
 		215=nach LOC
+		216=Immer bei GC einloggen
+		217=Spider alle Funde von geocaching.com
 		300=Type:
 		301=Gr%f6%dfe:
 		302=Wegpunkt:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-14 18:56:58 UTC (rev 1702)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-14 19:07:58 UTC (rev 1703)
@@ -105,6 +105,8 @@
 		213=Deleting orphans
 		214=New Waypoint
 		215=to LOC
+		216=Always login to GC
+		217=Spider all finds from geocaching.com
 		300=Type:
 		301=Size:
 		302=Waypoint:

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-03-14 18:56:58 UTC (rev 1702)
+++ trunk/res_noewe/spider.def	2009-03-14 19:07:58 UTC (rev 1703)
@@ -25,6 +25,7 @@
 # Version 4.1 - 20080725 adaption to new GC-design (images and travelbugs)
 # Version 4.2 - 20081031 Fix for cache type (background image with name of type)
 # Version 4.3 - 20090314 maxDistance string added
+# Version 4.4 - 20090314 firstPageFinds string added
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -43,7 +44,8 @@
 #--------------------------------------
 firstPage          = http://www.geocaching.com/seek/nearest.aspx?lat=
 firstPage2         = &lon=
-# Regex to search for cachenames
+firstPageFinds     = http://www.geocaching.com/seek/nearest.aspx?ul=
+# Regex to search for cachenames 
 listBlockRex       = <table id="ctl00_ContentBody_dlResults"((?s).*?)</table>
 lineRex            = <tr\ bgcolor='#.{6}'>(?:(?s).*?)<td\ valign="top"\ align="left">((?s).*?)</tr>
 distRex            = <br\ />(.*?)(?:km|mi)(?:\\s*)</td>

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-03-14 18:56:58 UTC (rev 1702)
+++ trunk/src/CacheWolf/MainMenu.java	2009-03-14 19:07:58 UTC (rev 1703)
@@ -25,7 +25,7 @@
 public class MainMenu extends MenuBar {
 	private MenuItem profiles, preferences, mnuContext,loadcaches,loadOC, /* savenexit, */ savenoxit,exit,search,searchAll,searchClr;
 	private MenuItem downloadmap, kalibmap, importmap;
-	private MenuItem spider, update, chkVersion;
+	private MenuItem spider, spiderAllFinds, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
 	private MenuItem exportpcx5, exporthtml, exporttop50, exportGPX, exportASC, exportTomTom, exportMSARCSV;
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
@@ -54,13 +54,14 @@
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for import, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] mnuImport = new MenuItem[6];
+		MenuItem[] mnuImport = new MenuItem[7];
 		mnuImport[0] = loadcaches  = new MenuItem(MyLocale.getMsg(129,"Import GPX")); //TODO internationalization
 		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download von opencaching.de")); 
 		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider von geocaching.com")); 
-		mnuImport[3] = update      = new MenuItem(MyLocale.getMsg(1014,"Update cache data"));
-		mnuImport[4] = mnuSeparator = new MenuItem("-"); 
-		mnuImport[5] = mnuForceLogin      = new MenuItem("Always login to GC"); 
+		mnuImport[3] = spiderAllFinds = new MenuItem(MyLocale.getMsg(217,"Spider all finds from geocaching.com")); 
+		mnuImport[4] = update         = new MenuItem(MyLocale.getMsg(1014,"Update cache data"));
+		mnuImport[5] = mnuSeparator   = new MenuItem("-"); 
+		mnuImport[6] = mnuForceLogin  = new MenuItem(MyLocale.getMsg(216,"Always login to GC")); 
 		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175,"Import"));
 		if (Global.getPref().forceLogin) mnuForceLogin.modifiers^=MenuItem.Checked;
 
@@ -303,6 +304,14 @@
 				profile.readIndex();
 				tbp.resetModel();
 			}
+			if(mev.selectedItem == spiderAllFinds){
+				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				Global.mainTab.saveUnsavedChanges(false);
+				spGC.doIt(true);
+				cacheDB.clear();
+				profile.readIndex();
+				tbp.resetModel();
+			}
 			if(mev.selectedItem == loadcaches){
 				FileChooser fc = new FileChooser(FileChooserBase.OPEN|FileChooserBase.MULTI_SELECT, pref.baseDir);
 				fc.addMask("*.gpx,*.zip,*.loc");

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-03-14 18:56:58 UTC (rev 1702)
+++ trunk/src/CacheWolf/Preferences.java	2009-03-14 19:07:58 UTC (rev 1703)
@@ -271,7 +271,7 @@
 			if (tmp != null) password=tmp;
 			SpiderGC.passwort=password;
 		}
-		else if(name.equals("alias2")) SafeXML.cleanback(myAlias2 = atts.getValue("name"));
+		else if(name.equals("alias2")) myAlias2 = SafeXML.cleanback(atts.getValue("name"));
 		else if(name.equals("location")){
 			curCentrePt.set(atts.getValue("lat")+" "+atts.getValue("long"));
 		}

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-14 18:56:58 UTC (rev 1702)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-14 19:07:58 UTC (rev 1703)
@@ -280,11 +280,14 @@
 	*	Method to start the spider for a search around the centre coordinates
 	*/
 	public void doIt(){
+		doIt(false);
+	}
+	public void doIt(boolean spiderAllFinds){
 		String postStr, dummy, ln, wpt;
 		Regex lineRex;
 		CacheHolderDetail chD;
 		CWPoint origin = pref.curCentrePt; // No need to copy curCentrePt as it is only read and not written
-		if (!origin.isValid()) {
+		if ( !spiderAllFinds && !origin.isValid()) {
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5509,"Coordinates for centre must be set"), FormBase.OKB)).execute();
 			return;
 		}
@@ -308,19 +311,29 @@
 			if(login() != FormBase.IDOK) return;
 		}
 
-		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(5510,"Spider Options"),	OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST| OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC);
-		if (options.execute() == FormBase.IDCANCEL) {return; }
-		String dist = options.distanceInput.getText();
-		if (dist.length()== 0) return;
-		distance = Common.parseDouble(dist);
-		
-		//save last radius to profile
-		Double distDouble = new Double();
-		distDouble.value = distance;
-		dist = distDouble.toString(0, 1, 0).replace(',', '.');
-		profile.distGC = dist;
+		boolean doNotgetFound = false;
 
-		boolean doNotgetFound = options.foundCheckBox.getState();
+		OCXMLImporterScreen options;
+		if (spiderAllFinds) {
+			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,"Spider Options"), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC);
+			if (options.execute() == FormBase.IDCANCEL) {return; }
+
+			distance = 1;
+		} else {
+			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,"Spider Options"),	OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST| OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC);		if (options.execute() == FormBase.IDCANCEL) {return; }
+			String dist = options.distanceInput.getText();
+			if (dist.length()== 0) return;
+			distance = Common.parseDouble(dist);
+			
+			//save last radius to profile
+			Double distDouble = new Double();
+			distDouble.value = distance;
+			dist = distDouble.toString(0, 1, 0).replace(',', '.');
+			profile.distGC = dist;
+
+			doNotgetFound = options.foundCheckBox.getState();
+		}
+
 		boolean getImages = options.imagesCheckBox.getState();
 		options.close(0);
 
@@ -339,8 +352,14 @@
 		}
 		for(int i = 0; i<cacheDB.size();i++){
 			ch = (CacheHolder)cacheDB.get(i);
-			if ( (!ch.is_archived) && (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found) && (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")) ) {
-				cachesToUpdate.put(ch.wayPoint, new Integer(i));
+			if (spiderAllFinds) {
+				if ( (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")) ) {
+					cachesToUpdate.put(ch.wayPoint, new Integer(i));
+				}
+			} else {
+				if ( (!ch.is_archived) && (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found) && (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")) ) {
+					cachesToUpdate.put(ch.wayPoint, new Integer(i));
+				}
 			}
 		}
 
@@ -352,9 +371,13 @@
 		infB.exec();
 		//Get first page
 		try{
-			ln = p.getProp("firstPage") + origin.getLatDeg(CWPoint.DD) + p.getProp("firstPage2") + origin.getLonDeg(CWPoint.DD)
-			                            + p.getProp("maxDistance") + Integer.toString( (int)saveDistanceInMiles );			
-			if(doNotgetFound) ln = ln + p.getProp("showOnlyFound");;
+			if (spiderAllFinds) {
+				ln = p.getProp("firstPageFinds") + encodeUTF8URL(Utils.encodeJavaUtf8String(pref.myAlias));
+			} else {
+				ln = p.getProp("firstPage") + origin.getLatDeg(CWPoint.DD) + p.getProp("firstPage2") + origin.getLonDeg(CWPoint.DD)
+			                              + p.getProp("maxDistance") + Integer.toString( (int)saveDistanceInMiles );			
+				if(doNotgetFound) ln = ln + p.getProp("showOnlyFound");
+			}
 			pref.log("Getting first page: "+ln);
 			start = fetch(ln);
 			pref.log("Got first page");
@@ -442,9 +465,13 @@
 				}
 				infB.setInfo(MyLocale.getMsg(5511,"Found ") + cachesToLoad.size() + MyLocale.getMsg(5512," caches"));
 				if(found_on_page < 20) distance = 0;
-				postStr = p.getProp("firstLine") + origin.getLatDeg(CWPoint.DD) + "&" + origin.getLonDeg(CWPoint.DD)
-							                     + p.getProp("maxDistance") + Integer.toString( (int)saveDistanceInMiles );			
-				if(doNotgetFound) postStr = postStr + p.getProp("showOnlyFound");
+				if (spiderAllFinds) {
+					postStr = p.getProp("firstLine");
+				} else {
+					postStr = p.getProp("firstLine") + origin.getLatDeg(CWPoint.DD) + "&" + origin.getLonDeg(CWPoint.DD)
+							                             + p.getProp("maxDistance") + Integer.toString( (int)saveDistanceInMiles );			
+					if(doNotgetFound) postStr = postStr + p.getProp("showOnlyFound");
+				}
 				if(distance > 0){
 					page_number++;
 					if(page_number >= 15) page_number = 5;



From mik77 at mail.berlios.de  Sun Mar 15 01:35:27 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 15 Mar 2009 01:35:27 +0100
Subject: [Cachewolf-svn] r1704 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200903150035.n2F0ZRfB004856@sheep.berlios.de>

Author: mik77
Date: 2009-03-15 01:35:23 +0100 (Sun, 15 Mar 2009)
New Revision: 1704

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/OCXMLImporterScreen.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Maximum number of caches to spider can now be entered.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-14 19:07:58 UTC (rev 1703)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-15 00:35:23 UTC (rev 1704)
@@ -391,6 +391,8 @@
 		1620=download eingebundener Bilder:+
 		1621=Fehler beim Interpretieren%0a der Update-Datei,%0aDies ist vermutlich ein Fehler bei Opencaching.de%0aSp%e4ter erneut versuchen%0a Status:
 		1622=Gefundene Caches nicht laden
+		1623=Max. Anzahl:
+		1624=+Caches
 		1700=Fehler in Zeile: 
 		1701=Spalte: 
 		1702=Variable nicht definiert: 
@@ -738,6 +740,8 @@
 		5516=+Cachebeschreibungen%0akonnten nicht geladen werden.
 		5517=Aktualisierungen spidern?
 		5518=+Caches in der Datenbank sollten aktualisiert werden. Jetzt aktualisieren?
+		5519=Information
+		5520=Nur das eingestellte Maximum an Caches wurde geladen.%0aWiederholen sie das Spidern sp%e4ter um weitere Caches zu laden.%0aEs wurden keine vorhandenen Caches aktualisiert.
 		6000=Guid
 		6001=Name
 		6002=Track#

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-14 19:07:58 UTC (rev 1703)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-15 00:35:23 UTC (rev 1704)
@@ -390,6 +390,9 @@
 		1619=: could not download image from URL:+
 		1620=downloading embedded images:+
 		1621=Error while interpreting data%0a from Opencaching.de,%0aThis is most probaly a bug at Opencaching.de%0aRetry later%0a Status:
+		1622=Exclude found caches
+		1623=Max. number:
+		1624=+caches
 		1700=Error on line: 
 		1701= position: 
 		1702=Variable not defined: 
@@ -726,6 +729,8 @@
 		5516=+cache descriptions%0acould not be loaded.
 		5517=Spider updates?
 		5518=+caches in database need an update. Update now?
+		5519=Information
+		5520=Only the given maximum of caches were loaded.%0aRepeat spidering later to load more caches.%0aNo already existing caches were updated.
 		6000=Guid
 		6001=Name
 		6002=track#

Modified: trunk/src/CacheWolf/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporterScreen.java	2009-03-14 19:07:58 UTC (rev 1703)
+++ trunk/src/CacheWolf/OCXMLImporterScreen.java	2009-03-15 00:35:23 UTC (rev 1704)
@@ -15,14 +15,17 @@
 	mButton cancelB, okB;
 	Preferences pref;
 	mInput distanceInput;
+	mInput maxNumberInput;
 	mCheckBox imagesCheckBox, /*mapsCheckBox, */ missingCheckBox, foundCheckBox;
 	mLabel distLbl;
+	mLabel maxNumberLbl;
 	mLabel distUnit;
 	static int DIST = 1;
 	static int IMAGES = 2;
 	static int ALL = 4;
 	static int INCLUDEFOUND = 8;
 	static int ISGC = 16;
+	static int MAXNUMBER = 32;
 
 	
 	public OCXMLImporterScreen(String title, int options) {
@@ -49,6 +52,19 @@
 			this.addNext(distanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 			this.addLast(distUnit = new mLabel(" km/mi."),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		}
+		
+		if ((options & MAXNUMBER) > 0) {
+			this.addNext(maxNumberLbl = new mLabel(MyLocale.getMsg(1623,"Max. number:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			maxNumberInput = new mInput();
+			if ( pref.maxSpiderNumber < 0 ) {
+				maxNumberInput.setText("");
+			} else {
+				maxNumberInput.setText(Integer.toString(pref.maxSpiderNumber));
+			}
+			maxNumberInput.setText(Integer.toString(pref.maxSpiderNumber));
+			this.addNext(maxNumberInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			this.addLast( new mLabel(MyLocale.getMsg(1624," caches")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		}
 
 		if ((options & IMAGES) > 0) {
 			imagesCheckBox = new mCheckBox();

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-03-14 19:07:58 UTC (rev 1703)
+++ trunk/src/CacheWolf/Preferences.java	2009-03-15 00:35:23 UTC (rev 1704)
@@ -201,6 +201,8 @@
 	public int metricSystem = Metrics.METRIC;
 	/** Load updated caches while spidering */
 	public int spiderUpdates = ASK;
+	/** Maximum number of new caches to spider */
+	public int maxSpiderNumber = 200;
 
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
@@ -368,6 +370,8 @@
 			forceLogin = Boolean.valueOf(atts.getValue("forcelogin")).booleanValue();
 			tmp = atts.getValue("spiderUpdates");
 			if (tmp != null) spiderUpdates=Convert.parseInt(tmp);
+			tmp = atts.getValue("maxSpiderNumber");
+			if (tmp != null) maxSpiderNumber=Convert.parseInt(tmp);
 		}
 		else if (name.equals("details")) {
 			maxDetails=Common.parseInt(atts.getValue("cacheSize"));
@@ -439,7 +443,7 @@
 			outp.print("    <garmin connection = \"" + SafeXML.strxmlencode(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.strxmlencode(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) + "\" />\n");
 			outp.print("    <opencaching downloadPicsOC=\"" + SafeXML.strxmlencode(downloadPicsOC) + "\" downloadMaps=\"" + SafeXML.strxmlencode(downloadMapsOC) + "\" downloadMissing=\"" + SafeXML.strxmlencode(downloadmissingOC) + "\"/>\n");
 			outp.print("	<location lat = \"" + SafeXML.strxmlencode(curCentrePt.getLatDeg(CWPoint.DD)) + "\" long = \"" + SafeXML.strxmlencode(curCentrePt.getLonDeg(CWPoint.DD)) + "\"/>\n");
-			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\"/>\n");
+			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\"/>\n");
 			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
 			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
 			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\"/>\n");

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-14 19:07:58 UTC (rev 1703)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-15 00:35:23 UTC (rev 1704)
@@ -315,12 +315,13 @@
 
 		OCXMLImporterScreen options;
 		if (spiderAllFinds) {
-			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,"Spider Options"), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC);
+			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,"Spider Options"), OCXMLImporterScreen.MAXNUMBER|OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC);
 			if (options.execute() == FormBase.IDCANCEL) {return; }
 
 			distance = 1;
 		} else {
-			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,"Spider Options"),	OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST| OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC);		if (options.execute() == FormBase.IDCANCEL) {return; }
+			options = new OCXMLImporterScreen(MyLocale.getMsg(5510,"Spider Options"),	OCXMLImporterScreen.MAXNUMBER|OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST| OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.ISGC);
+			if (options.execute() == FormBase.IDCANCEL) {return; }
 			String dist = options.distanceInput.getText();
 			if (dist.length()== 0) return;
 			distance = Common.parseDouble(dist);
@@ -333,6 +334,18 @@
 
 			doNotgetFound = options.foundCheckBox.getState();
 		}
+		
+		int maxNumber = -1;
+		String maxNumberString = options.maxNumberInput.getText();
+		if (maxNumberString.length()!= 0) {
+			maxNumber = Common.parseInt(maxNumberString);
+		}
+		if (maxNumber != pref.maxSpiderNumber) {
+			pref.maxSpiderNumber = maxNumber;
+			pref.savePreferences();
+		}
+		if (maxNumber == 0) return;
+		boolean maxNumberAbort = false;
 
 		boolean getImages = options.imagesCheckBox.getState();
 		options.close(0);
@@ -436,7 +449,17 @@
 						String waypoint=getWP(lineRex.stringMatched(1));
 						Integer nr;
 						if((nr=(Integer)indexDB.get(waypoint)) == null){
-							cachesToLoad.add(waypoint);
+							if ( (maxNumber > 0) && (cachesToLoad.size() >= maxNumber) ) {
+								maxNumberAbort = true;
+								
+								//add no more caches
+								distance = 0;
+								
+								//don't update existing caches, because list is not correct when aborting
+								cachesToUpdate.clear();
+							} else {
+								cachesToLoad.add(waypoint);
+							}
 						} else {
 							pref.log(waypoint+" already in DB");
 							ch=(CacheHolder) cacheDB.get(nr.intValue());
@@ -520,7 +543,7 @@
 				cachesToUpdate.clear();
 				break;
 			case Preferences.ASK:
-				MessageBox mBox = new MessageBox(MyLocale.getMsg(5517,"Spider Updates?"), "" + cachesToUpdate.size() + MyLocale.getMsg(5518," caches in database need an update. Update now?") , FormBase.IDYES |FormBase.IDNO);
+				MessageBox mBox = new MessageBox(MyLocale.getMsg(5517,"Spider Updates?"), cachesToUpdate.size() + MyLocale.getMsg(5518," caches in database need an update. Update now?") , FormBase.IDYES |FormBase.IDNO);
 				if (mBox.execute() != FormBase.IDOK){
 					cachesToUpdate.clear();
 				}
@@ -578,6 +601,9 @@
 		if ( spiderErrors > 0) {
 			new MessageBox(MyLocale.getMsg(5500,"Error"),spiderErrors + MyLocale.getMsg(5516," cache descriptions%0acould not be loaded."),FormBase.DEFOKB).execute();
 		}
+		if ( maxNumberAbort ) {
+			new MessageBox(MyLocale.getMsg(5519,"Information"),MyLocale.getMsg(5520,"Only the given maximum of caches were loaded.%0aRepeat spidering later to load more caches.%0aNo already existing caches were updated."),FormBase.DEFOKB).execute();			
+		}
 		Global.getProfile().saveIndex(Global.getPref(),true);
 	}
 



From mik77 at mail.berlios.de  Sun Mar 15 14:12:55 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 15 Mar 2009 14:12:55 +0100
Subject: [Cachewolf-svn] r1705 - in trunk: res_noewe/languages src/CacheWolf
	src/exp
Message-ID: <200903151312.n2FDCtQB020259@sheep.berlios.de>

Author: mik77
Date: 2009-03-15 14:12:51 +0100 (Sun, 15 Mar 2009)
New Revision: 1705

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/exp/Exporter.java
   trunk/src/exp/LocExporter.java
Log:
Add some cache details to Garmin export

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-15 00:35:23 UTC (rev 1704)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-15 13:12:51 UTC (rev 1705)
@@ -206,6 +206,9 @@
 		640=Ja
 		641=Nein
 		642=Nachfragen
+		643=Cachedetails anh%e4ngen an:
+		644=Wegpunkt
+		645=Name
 		700=Filter setzen
 		701=Entfernung
 		702=Schwierigkeit

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-15 00:35:23 UTC (rev 1704)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-15 13:12:51 UTC (rev 1705)
@@ -206,6 +206,9 @@
 		640=Yes
 		641=No
 		642=Ask
+		643=Append cache details to:
+		644=waypoint
+		645=name
 		700=Set filter
 		701=Distance
 		702=Difficulty

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-03-15 00:35:23 UTC (rev 1704)
+++ trunk/src/CacheWolf/Preferences.java	2009-03-15 13:12:51 UTC (rev 1705)
@@ -203,6 +203,10 @@
 	public int spiderUpdates = ASK;
 	/** Maximum number of new caches to spider */
 	public int maxSpiderNumber = 200;
+	/** Add short details to waypoint on export */
+	public boolean addDetailsToWaypoint = false;
+	/** Add short details to name on export */
+	public boolean addDetailsToName = false;
 
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
@@ -319,7 +323,11 @@
 			tmp = atts.getValue("GPSBabelOptions");
 			if (tmp != null) garminGPSBabelOptions=tmp;
 			tmp = atts.getValue("MaxWaypointLength");
-			if (tmp != null) garminMaxLen=Convert.toInt(atts.getValue("MaxWaypointLength"));
+			if (tmp != null) garminMaxLen=Convert.toInt(tmp);
+			tmp = atts.getValue("addDetailsToWaypoint");
+			if (tmp != null) addDetailsToWaypoint = Boolean.valueOf(tmp).booleanValue();
+			tmp = atts.getValue("addDetailsToName");
+			if (tmp != null) addDetailsToName = Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("imagepanel")) {
 			showDeletedImages = Boolean.valueOf(atts.getValue("showdeletedimages")).booleanValue();
@@ -440,7 +448,8 @@
 			outp.print("    <imagepanel showdeletedimages=\"" + SafeXML.strxmlencode(showDeletedImages) + "\"/>\n");
 			outp.print("    <hintlogpanel logsperpage=\"" + SafeXML.strxmlencode(logsPerPage) + "\" initialhintheight=\"" + SafeXML.strxmlencode(initialHintHeight) + "\"  maxspiderlogs=\"" + SafeXML.strxmlencode(maxLogsToSpider) + "\" />\n");
 			outp.print("    <solver ignorevariablecase=\"" + SafeXML.strxmlencode(solverIgnoreCase) + "\" degMode=\"" + SafeXML.strxmlencode(solverDegMode) + "\" />\n");
-			outp.print("    <garmin connection = \"" + SafeXML.strxmlencode(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.strxmlencode(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) + "\" />\n");
+			outp.print("    <garmin connection = \"" + SafeXML.strxmlencode(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.strxmlencode(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) +
+					        "\" addDetailsToWaypoint = \"" + SafeXML.strxmlencode(addDetailsToWaypoint) + "\" addDetailsToName = \"" + SafeXML.strxmlencode(addDetailsToName) + "\" />\n");
 			outp.print("    <opencaching downloadPicsOC=\"" + SafeXML.strxmlencode(downloadPicsOC) + "\" downloadMaps=\"" + SafeXML.strxmlencode(downloadMapsOC) + "\" downloadMissing=\"" + SafeXML.strxmlencode(downloadmissingOC) + "\"/>\n");
 			outp.print("	<location lat = \"" + SafeXML.strxmlencode(curCentrePt.getLatDeg(CWPoint.DD)) + "\" long = \"" + SafeXML.strxmlencode(curCentrePt.getLonDeg(CWPoint.DD)) + "\"/>\n");
 			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\"/>\n");

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2009-03-15 00:35:23 UTC (rev 1704)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2009-03-15 13:12:51 UTC (rev 1705)
@@ -15,12 +15,12 @@
 *	Class ID=600
 */
 public class PreferencesScreen extends Form {
-	mButton cancelB, applyB, brwBt, gpsB,btnCentre;
+	mButton cancelB, applyB, brwBt, gpsB;
 	mChoice inpLanguage, inpMetric, inpSpiderUpdates;
-	mInput DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, inpGPS, 
+	mInput DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, 
 	       inpLogsPerPage,inpMaxLogsToSpider,inpPassword;
-	mCheckBox dif, ter, loc, own, hid, stat, dist, bear, chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, 
-	          chkTabsAtTop, chkShowStatus,chkHasCloseButton,chkSynthShort,chkProxyActive, chkDescShowImg;
+	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus,chkHasCloseButton,
+	          chkSynthShort,chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
 	mLabel lblGarmin;
@@ -105,11 +105,7 @@
 		pnlGeneral.addLast(pnlBrowser,HSTRETCH,HFILL);
 		
 		pnlGeneral.addLast(gpsB = new mButton("GPS: " + pref.mySPO.portName+"/"+pref.mySPO.baudRate),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		//content.addNext(Alias.setTag(Control.SPAN, new Dimension(3,1)),content.DONTSTRETCH, (content.HFILL|content.WEST));
-/*		pnlGeneral.addLast(inpGPS=new mInput(""));
-		inpGPS.modify(ControlConstants.Disabled|ControlConstants.NoFocus,0);
-		inpGPS.setText(pref.mySPO.portName+"/"+pref.mySPO.baudRate);
-	*/	
+
 		// Garmin and GPSBabel
 		pnlGeneral.addNext(lblGarmin=new mLabel(MyLocale.getMsg(173,"Garmin:  PC Port:")),DONTSTRETCH,LEFT);
 //		lblGarmin.setTag(INSETS,new Insets(4,0,0,0));
@@ -122,7 +118,12 @@
 		//frmGarmin.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_TOP;
 		//frmGarmin.setTag(INSETS,new Insets(4,0,0,0));
 		//pnlGeneral.addLast(frmGarmin);
-		pnlGeneral.addLast(new mLabel(""));
+		pnlGeneral.addNext(new mLabel(MyLocale.getMsg(643,"Append cache details to:")),DONTSTRETCH,LEFT);
+		pnlGeneral.addNext(chkAddDetailsToWaypoint=new mCheckBox(MyLocale.getMsg(644,"waypoints")),DONTSTRETCH,RIGHT);
+		chkAddDetailsToWaypoint.setState(pref.addDetailsToWaypoint);
+		pnlGeneral.addLast(chkAddDetailsToName=new mCheckBox(MyLocale.getMsg(645,"names")),STRETCH,LEFT);
+		chkAddDetailsToName.setState(pref.addDetailsToName);
+		//pnlGeneral.addLast(new mLabel(""));
 		
 		/////////////////////////////////////////////////////////
 		// Second panel - Screen
@@ -314,6 +315,9 @@
 				Global.mainTab.tbP.myMod.setColumnNamesAndWidths();
 				pref.metricSystem = inpMetric.getInt() == 0 ? Metrics.METRIC : Metrics.IMPERIAL;
 				pref.spiderUpdates = inpSpiderUpdates.getInt();
+				pref.addDetailsToWaypoint = chkAddDetailsToWaypoint.getState();
+				pref.addDetailsToName = chkAddDetailsToName.getState();
+
 				pref.savePreferences();
 				pref.dirty = true; // Need to update table in case columns were enabled/disabled
 				this.close(0);

Modified: trunk/src/exp/Exporter.java
===================================================================
--- trunk/src/exp/Exporter.java	2009-03-15 00:35:23 UTC (rev 1704)
+++ trunk/src/exp/Exporter.java	2009-03-15 13:12:51 UTC (rev 1705)
@@ -415,5 +415,20 @@
         return ( sb.length() == originalTextLength ) ? text : sb.toString();
     } // end insertEntities
 
+    public static String getShortDetails( CacheHolder ch ) {
+    	StringBuffer strBuf = new StringBuffer(7);
+    	strBuf.append(ch.CacheSize.substring(0, 1).toLowerCase());
+    	strBuf.append(ch.hard.charAt(0));
+    	if ( ch.hard.endsWith(".5") ) {
+    		strBuf.append("5");
+    	}
+    	strBuf.append("/");
+    	strBuf.append(ch.terrain.charAt(0));
+    	if ( ch.terrain.endsWith(".5") ) {
+    		strBuf.append("5");
+    	}
 
+    	return strBuf.toString();
+    }
+
 }

Modified: trunk/src/exp/LocExporter.java
===================================================================
--- trunk/src/exp/LocExporter.java	2009-03-15 00:35:23 UTC (rev 1704)
+++ trunk/src/exp/LocExporter.java	2009-03-15 13:12:51 UTC (rev 1705)
@@ -22,6 +22,9 @@
 		super();
 		this.setMask("*.loc");
 		this.setHowManyParams(NO_PARAMS);
+		if (Global.getPref().addDetailsToName) {
+			this.setNeedCacheDetails(true);
+		}
 		if ((new File(FileBase.getProgramDirectory()+"/garminmap.xml")).exists()) {
 			gm=new GarminMap();
 			gm.readGarminMap();
@@ -38,6 +41,9 @@
 		StringBuffer strBuf = new StringBuffer(200);
 		strBuf.append("<waypoint>\r\n   <name id=\"");
 		String wptName=simplifyString(chD.wayPoint);
+		if (Global.getPref().addDetailsToWaypoint) {
+			wptName += getShortDetails( chD );			
+		}
 		if (Global.getPref().garminMaxLen==0)
 			strBuf.append(wptName);
 		else {
@@ -47,6 +53,16 @@
 		}
 		strBuf.append("\"><![CDATA[");
 		strBuf.append(simplifyString(chD.CacheName));
+		if (Global.getPref().addDetailsToName) {
+			strBuf.append(", ");
+			strBuf.append(CacheType.wayType[Common.parseInt(chD.type)][CacheType.WPT_TEXT]);			
+			strBuf.append(" ");
+			strBuf.append( getShortDetails( chD ) );
+			if (!chD.Hints.equals("null")) {
+				strBuf.append("; Hint:");
+				strBuf.append( simplifyString(Common.rot13(chD.Hints)) );			
+			}
+		}
 		strBuf.append("]]></name>\r\n   <coord lat=\"");
 		strBuf.append(chD.pos.getLatDeg(CWPoint.DD));
 		strBuf.append("\" lon=\"");



From silas at mail.berlios.de  Sun Mar 15 17:13:37 2009
From: silas at mail.berlios.de (silas at mail.berlios.de)
Date: Sun, 15 Mar 2009 17:13:37 +0100
Subject: [Cachewolf-svn] r1706 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200903151613.n2FGDbpb000293@sheep.berlios.de>

Author: silas
Date: 2009-03-15 17:13:13 +0100 (Sun, 15 Mar 2009)
New Revision: 1706

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/HintLogPanel.java
Log:
added translation for decode/encode

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-15 13:12:51 UTC (rev 1705)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-15 16:13:13 UTC (rev 1706)
@@ -37,15 +37,15 @@
 		133=Suche alle
 		134=Gew%e4hlter Cache
 		139=Travelbugs verwalten
-		140=Verwalten 
-		141=Kopieren 
-		142=Verschieben 
+		140=Verwalten
+		141=Kopieren
+		142=Verschieben
 		143=L%f6schen
-		144=Warnung 
-		145=Daten ALLER ANGEZEIGTEN Wegpunkte werden gel%f6scht!  Weiter? 
-		146=Daten ALLER ANGEZEIGTEN Wegpunkte werden kopiert!  Weiter? 
-		147=Daten ALLER ANGEZEIGTEN Wegpunkte werden verschoben!  Weiter? 
-		148=Zielverzeichnis w%e4hlen 
+		144=Warnung
+		145=Daten ALLER ANGEZEIGTEN Wegpunkte werden gel%f6scht!  Weiter?
+		146=Daten ALLER ANGEZEIGTEN Wegpunkte werden kopiert!  Weiter?
+		147=Daten ALLER ANGEZEIGTEN Wegpunkte werden verschoben!  Weiter?
+		148=Zielverzeichnis w%e4hlen
 		149=Karten
 		150=Importieren
 		151=Kalibrieren
@@ -84,11 +84,11 @@
 		191=Datei w%e4hlen
 		192=%c4nderungen speichern
 		193=Addis hinzuf%fcgen
-		195=Derzeitiges Zentrum		
+		195=Derzeitiges Zentrum
 		196=Gesamte # Caches (GC&OC)%0aGesamt # sichtbar%0aGesamt # gefunden
 		197=Cachetour anzeigen/verbergen
 		198=Cachetour
-		199=Zu Cachetour hinzuf%fcgen	
+		199=Zu Cachetour hinzuf%fcgen
 		200=Details
 		201=Beschreibung
 		202=Bilder
@@ -100,7 +100,7 @@
 		208=Index neu erstellen
 		209=Wiederaufbau Index
 		210=Caches nicht in index.xml:+
-		211=%0aDavon hinzugef%fcgt:+  
+		211=%0aDavon hinzugef%fcgt:+
 		212=Alle .xml Dateien (und Bilder) l%f6schen, die nicht in index.xml sind
 		213=Verwaiste .xml Dateien l%f6schen
 		214=Neuer Wegpunkt
@@ -150,6 +150,7 @@
 		350=Zeitstempel zu Notizen hinzuf%fcgen
 		351=Notizen hinzuf%fcgen/%e4ndern
 		400=Dekodieren
+		401=Kodieren
 		500=Umschalten
 		588=L%e4ngeneinheiten
 		589=Metrisch (km)
@@ -194,7 +195,7 @@
 		628=Status
 		629=Profil auto. laden
 		630=Hinweise/Logs:  Logs pro Seite
-		631=PDA hat Schliessen Button 
+		631=PDA hat Schliessen Button
 		632=Mehr
 		633=Max. logs spidern
 		634=Proxy verwenden
@@ -367,7 +368,7 @@
 		1508=Breite
 		1509=L%e4nge
 		1510=Keine Daten vom GPS%0aVerbindung zum seriellen Port geschlossen
-		1511=Kann Daten vom GPS nicht interpretieren%0a M%f6gliche Gr%fcnde:%0afalscher Port,%0afalsche Baudrate,%0akein NMEA-Protokoll%0aVerbindung zum seriellen Port geschlossen%0aLetzter String:%0a 
+		1511=Kann Daten vom GPS nicht interpretieren%0a M%f6gliche Gr%fcnde:%0afalscher Port,%0afalsche Baudrate,%0akein NMEA-Protokoll%0aVerbindung zum seriellen Port geschlossen%0aLetzter String:%0a
 		1512=Wegpunkt
 		1513=Kann Karte nicht ohne g%fcltige Koordinaten anzeigen - Bitte Koordinaten als Ziel, Zentrum oder im gew%e4hlten Cache eingeben oder GPS starten
 		1514=Kann Entfernungen nicht neuberechnen, weil keine GPS-Position gesetzt ist (kein GPS-Empfang ist/war)
@@ -380,10 +381,10 @@
 		1606=Alle neu downloaden
 		1607=Update von opencaching erfolgreich
 		1608=Daten von opencaching downloaden...
-		1609=Importiere Cache: 
+		1609=Importiere Cache:
 		1610=download der fehlenden Karte
-		1611=Importiere Cachebeschreibung: 
-		1612=Importiere Log: 
+		1611=Importiere Cachebeschreibung:
+		1612=Importiere Log:
 		1613=Importiere Bild:
 		1614=Fehler beim Entpacken der Update-Datei
 		1615=Fehler beim Interpretieren der Update-Datei, Status:
@@ -396,21 +397,21 @@
 		1622=Gefundene Caches nicht laden
 		1623=Max. Anzahl:
 		1624=+Caches
-		1700=Fehler in Zeile: 
-		1701=Spalte: 
-		1702=Variable nicht definiert: 
-		1703=Keine erlaubte Zahl: 
+		1700=Fehler in Zeile:
+		1701=Spalte:
+		1702=Variable nicht definiert:
+		1703=Keine erlaubte Zahl:
 		1704=Unerwartetes Ende des Pogrammes
 		1705=Fehlendes ENDIF
-		1706=Erwartet: 
-		1707=Gefunden: 
-		1708=Funktionsname nicht eindeutig: 
-		1709=Unbekannte Funktion: 
+		1706=Erwartet:
+		1707=Gefunden:
+		1708=Funktionsname nicht eindeutig:
+		1709=Unbekannte Funktion:
 		1710=Kann leere Zeichenkette nicht z%e4hlen
 		1711=Ersatzzeichenketten m%fcssen gleiche L%e4nge haben
-		1712=Unzul%e4ssige Koordinate: 
+		1712=Unzul%e4ssige Koordinate:
 		1713=Falsches Koordinatenformat. Erlaubt sind CW/DD/DMM/DMS/UTM
-		1714=Goto: Wegpunkt existiert nicht: 
+		1714=Goto: Wegpunkt existiert nicht:
 		1715=instr: Startposition nicht in Zeichenkette
 		1716=mid: Ganzzahliger Parameter erwartet
 		1717=mid: Parameter ausserhalb des erlaubten Bereichs
@@ -418,11 +419,11 @@
 		1719=Winkel muss im Bereich [0;360] sein
 		1720=Kann die Wurzel einer negativen Zahl nicht berechnen
 		1723=Vergleichsoperator erwartet
-		1724=Variable hat keinen Wert: 
-		1725=Unerwartete(s) Zeichen: 
-		1726=Funktion hat zu viele Argumente 
+		1724=Variable hat keinen Wert:
+		1725=Unerwartete(s) Zeichen:
+		1726=Funktion hat zu viele Argumente
 		1727=Funktion hat falsche Anzahl von Argumenten
-		1728=Funktion noch nicht implementiert: 
+		1728=Funktion noch nicht implementiert:
 		1729=Division durch 0
 		1730=Fehlendes " am Ende der Zeichenkette
 		1731=Nicht erlaubtes Formatierungzeichen
@@ -432,7 +433,7 @@
 		1735=Rechne!
 		1736=Laden
 		1737=Speichern
-		1738=Speichern als	
+		1738=Speichern als
 		1739=Winkel muss im Bereich [0;2*PI] sein
 		1800=Georeferenzierte Karten herunterladen
 		1801=Kacheln herunterladen
@@ -445,27 +446,27 @@
 		1808=%dcberlappung in Pixel:
 		1809=Lade %dcbersichtskarte
 		1810=In einem Rechteck von:
-		1811=um das Zentrum: 
+		1811=um das Zentrum:
 		1812=Kacheln
 		1813=Lade Karte f%fcr
-		1814=Pro Cache		
+		1814=Pro Cache
 		1815=Lade georeferenzierte Karten
 		1816=Lade georeferenzierte Karten%0a %0a %0a %0a %0a
 		1817=Keine Caches selektiert
-		1818=getSortedMapServiceIndex: Index 
+		1818=getSortedMapServiceIndex: Index
 		1819=nicht gefunden
 		1820=Lade Karte '
 		1821=%0a f%fcr Cache:%0a
-		1822=Cache: 
-		1823=Ignoriere Fehler: 
+		1822=Cache:
+		1823=Ignoriere Fehler:
 		1824=Lade %dcberblickskarte
-		1825=%dcberblickskarte: Ignoriere Fehler: 
+		1825=%dcberblickskarte: Ignoriere Fehler:
 		1826=Laden und Kalibrieren der Karten beendet
 		1827='Radius' muss gr%f6%dfer als 0 sein
 		1828='%dcberlappung' muss gr%f6%dfer oder gleich 0 sein
 		1829=Bitte 'Zentrum' eingeben, um das die Karten geladen werden sollen
-		1830=Der gew%e4hlte Kartendienst bietet Karten in einem Ma%dfstab von 
-		1831= bis 
+		1830=Der gew%e4hlte Kartendienst bietet Karten in einem Ma%dfstab von
+		1831= bis
 		1832=%0a Bitte 'Ca. m pro Pixel' entsprechend anpassen
 		1833=Bitte w?hlen Sie nicht die Trennlinie als WMS-Service
 		2000=GPX Export
@@ -635,7 +636,7 @@
 		4255=Karte mit mehr Details laden
 		4256=Karte mit mehr %dcberblick laden
 		4257=Karte mit mehr %dcberblick laden
-		4258=Karte verschieben und neue laden		
+		4258=Karte verschieben und neue laden
 		4260=Karte zum Ziel verschieben
 		4261=Karte zum Ziel verschieben
 		4262=Karte zum GPS verschieben
@@ -683,13 +684,13 @@
 		4800=Lade Onlinekartendienste
 		4801=Ignoriere Fehler beim %0a Lesen der Web Map Service Definitionsdatei %0a
 		4802=Lade kalibriertes (georeferenziertes) %0a Kartenbild %0a '
-		4803=' %0a Lade Kachel %0a Reihe 
-		4804= Spalte 
-		4805=Kachel 
-		4806=: Ignoriere Fehler: 
+		4803=' %0a Lade Kachel %0a Reihe
+		4804= Spalte
+		4805=Kachel
+		4806=: Ignoriere Fehler:
 		4807=loadTo: Karte laden fehlgeschlagen: Kein http-redirect erhalten
-		4808=downloadImage: content-type: 
-		4809= ist kein Bild, Anfang des Inhalts: 
+		4808=downloadImage: content-type:
+		4809= ist kein Bild, Anfang des Inhalts:
 		4810=Fehler beim Laden oder Speichern der Karte:%0a
 		4811=OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):%0a Diese Methode muss %fcberladen werden um sie zu nutzen
 		4812=WebMapService: Eigenschaft >Name:< fehlt in Datei:%0a
@@ -702,16 +703,16 @@
 		4819=)%fcbereinstimmen. Benutzte normale Leerschritte als Trenner
 		4820=WebMapService: Eigenschaft >CoordinateReferenceSystemUrlPart:< fehlerhaft in Datei:%0a
 		4821=WebMapService: Eigenschaft >ImageFileExtension:< fehlt in Datei:%0a
-		4822=Bereich: 
-		4823= wird vom Dienst: 
-		4824=+nicht abgedeckt, Dienstbereich: 
-		4825=Ma%dfstab 
-		4826= wird von diesem Kartendienst nicht unterst%fctzt, unterst%fctzter Ma%dfstabsbereich: 
+		4822=Bereich:
+		4823= wird vom Dienst:
+		4824=+nicht abgedeckt, Dienstbereich:
+		4825=Ma%dfstab
+		4826= wird von diesem Kartendienst nicht unterst%fctzt, unterst%fctzter Ma%dfstabsbereich:
 		4827= (gemessen vertikal in Metern pro Pixel)
-		4828=Koordinatensystem wird von Cachewolf nicht unterst%fctzt: 
-		4829=getUrlForBoundingBox: Punkt: 
+		4828=Koordinatensystem wird von Cachewolf nicht unterst%fctzt:
+		4829=getUrlForBoundingBox: Punkt:
 		4830=Kein passender Gau%df-Kr%fcger-Streifen in der EPSG-Codeliste in der .wms-Datei
-		4831=getMapInfoObject: Koordinatensystem wird von Cachewolf nicht unterst%fctzt: 
+		4831=getMapInfoObject: Koordinatensystem wird von Cachewolf nicht unterst%fctzt:
 		4900=+ist keine deutsche Gau%df-Kr%fcger-Koordinate
 		4920=EPSG-Code+
 		4921=+nicht unterst%fctzt
@@ -738,7 +739,7 @@
 		5511=Gefunden+
 		5512=+Caches
 		5513=Laden von:+
-		5514=%0aTravelbug:+ 
+		5514=%0aTravelbug:+
 		5515=Fehler beim Laden des Caches.%0aBitte %fcberpr%fcfen Sie Ihre Internetverbindung.%0aNoch einmal versuchen?
 		5516=+Cachebeschreibungen%0akonnten nicht geladen werden.
 		5517=Aktualisierungen spidern?

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-15 13:12:51 UTC (rev 1705)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-15 16:13:13 UTC (rev 1706)
@@ -37,15 +37,15 @@
     133=Search all
     134=Selected Cache
 		139=Manage Travelbugs
-		140=Organise            
-		141=Copy 
-		142=Move 
-		143=Delete 
-		144=Warning 
-		145=Data of ALL SHOWN waypoints will be deleted! Continue? 
-		146=Data of ALL SHOWN waypoints will be copied! Continue? 
-		147=Data of ALL SHOWN waypoints will be moved! Continue? 
-		148=Select Target directory 
+		140=Organise
+		141=Copy
+		142=Move
+		143=Delete
+		144=Warning
+		145=Data of ALL SHOWN waypoints will be deleted! Continue?
+		146=Data of ALL SHOWN waypoints will be copied! Continue?
+		147=Data of ALL SHOWN waypoints will be moved! Continue?
+		148=Select Target directory
 		149=Maps
 		150=Import
 		151=Calibrate
@@ -86,7 +86,7 @@
 		193=add Addis
 		195=Current Centre
 		196=Total # of caches (GC&OC)%0aTotal # visible%0aTotal # found
-		197=Show/Hide cachetour	
+		197=Show/Hide cachetour
 		198=Cachetour
 		199=Add to cachetour
 		200=Details
@@ -100,7 +100,7 @@
 		208=Rebuild index
 		209=Rebuilding index
 		210=Caches not in index.xml:+
-		211=%0aThereof added:+  
+		211=%0aThereof added:+
 		212=Delete all .xml files not in index.xml and associated pictures
 		213=Deleting orphans
 		214=New Waypoint
@@ -149,7 +149,8 @@
 		349=Toggle Blacklist status
 		350=Add timestamp to notes
 		351=Add/Edit notes
-		400=Dekode
+		400=Decode
+		401=Encode
 		500=Switch
 		588=Unit System
 		589=Metric (km)
@@ -193,7 +194,7 @@
 		627=Tabs top
 		628=Status
 		629=Autoload last profile
-		630=HintLogPanel:  Logs per page 
+		630=HintLogPanel:  Logs per page
 		631=PDA has close Button
 		632=More
 		633=Max. logs to spider
@@ -304,7 +305,7 @@
 		1028=)?
 		1029=There are waypoints that are ticked but invisible.%0a(Main caches:+
 		1030=, additional Waypoints:+
-		1031=Delete them, too? 
+		1031=Delete them, too?
 		1032=Path to browser:
 		1033=is incorrect!
 		1034=Cannot start browser!
@@ -367,7 +368,7 @@
 		1508=latitude
 		1509=longitude
 		1510=No data from GPS%0aConnection to serial port closed
-		1511=Cannot interpret data from GPS%0a possible reasons:%0a wrong Port,%0a wrong Baudrate,%0a not NMEA-Protocol%0aConnection to serial port closed%0aLast String tried to interprete:%0a 
+		1511=Cannot interpret data from GPS%0a possible reasons:%0a wrong Port,%0a wrong Baudrate,%0a not NMEA-Protocol%0aConnection to serial port closed%0aLast String tried to interprete:%0a
 		1512=Waypoint
 		1513=Cannot start moving map without valid coordinates. Please enter coordinates as destination as center or in selected cache, or start GPS
 		1514=Cannot recalculate distances, because the GPS position is not set
@@ -380,10 +381,10 @@
 		1606=redownload all
 		1607=Update from opencaching successful
 		1608=Downloading data from opencaching...
-		1609=Importing Cache: 
+		1609=Importing Cache:
 		1610=download missing map
-		1611=Importing cache description: 
-		1612=Importing Log: 
+		1611=Importing cache description:
+		1612=Importing Log:
 		1613=Importing picture:
 		1614=Error while unzipping udpate file
 		1615=Error parsing update file, state:
@@ -396,21 +397,21 @@
 		1622=Exclude found caches
 		1623=Max. number:
 		1624=+caches
-		1700=Error on line: 
-		1701= position: 
-		1702=Variable not defined: 
-		1703=Not a valid number: 
+		1700=Error on line:
+		1701= position:
+		1702=Variable not defined:
+		1703=Not a valid number:
 		1704=Unexpected end of source
 		1705=Missing ENDIF
-		1706=Expected 
-		1707=Found: 
-		1708=Ambiguous function name: 
-		1709=Unknown function: 
+		1706=Expected
+		1707=Found:
+		1708=Ambiguous function name:
+		1709=Unknown function:
 		1710=Cannot count empty string
 		1711=Replacement characters strings must be of equal length
-		1712=Invalid coordinate: 
+		1712=Invalid coordinate:
 		1713=Invalid coordinate format. Allowed are CW/DD/DMM/DMS/UTM
-		1714=Goto: Waypoint does not exist: 
+		1714=Goto: Waypoint does not exist:
 		1715=instr: Start position not in string
 		1716=mid: Integer argument expected
 		1717=mid: Argument out of range
@@ -418,21 +419,21 @@
 		1719=Projection degrees must be in interval [0;360]
 		1720=Cannot calculate square root of a negative number
 		1723=Comparison operator expected
-		1724=Variable not set: 
-		1725=Unexpected character(s): 
-		1726=Too many arguments for function 
+		1724=Variable not set:
+		1725=Unexpected character(s):
+		1726=Too many arguments for function
 		1727=Invalid number of arguments
-		1728=Function not yet implemented: 
+		1728=Function not yet implemented:
 		1729=Division by 0
 		1730=Unterminated string
 		1731=Invalid format character
 		1732=Invalid character
-		1733=Input command	
+		1733=Input command
 		1734=Clear output
 		1735=Solve!
 		1736=Load
 		1737=Save
-		1738=SaveAs	
+		1738=SaveAs
 		1739=Projection degrees must be in interval [0;2*PI]
 		1800=Download georeferenced maps
 		1801=Download tiles
@@ -445,27 +446,27 @@
 		1808=overlapping in pixel:
 		1809=download an overview map
 		1810=Within a rectangle of:
-		1811=around the centre: 
+		1811=around the centre:
 		1812=Tiles
 		1813=Download one map for
 		1814=Per cache
 		1815=Downloading georeferenced maps
 		1816=Downloading georeferenced maps%0a %0a %0a %0a %0a
 		1817=No caches are ticked
-		1818=getSortedMapServiceIndex: index 
+		1818=getSortedMapServiceIndex: index
 		1819=not found
 		1820=Downloading map '
 		1821=%0a for cache:%0a
-		1822=Cache: 
-		1823=Ignoring error: 
+		1822=Cache:
+		1823=Ignoring error:
 		1824=downloading overview map
-		1825=Overview map: Ignoring error: 
+		1825=Overview map: Ignoring error:
 		1826=Finished downloading and calibration of maps
 		1827='radius' must be graeter than 0
-		1828='overlapping' must be greater or equal 0 
+		1828='overlapping' must be greater or equal 0
 		1829=Please enter the 'centre' around which the maps shall be downloaded
-		1830=The selected online map service provides map in the scale from 
-		1831= to 
+		1830=The selected online map service provides map in the scale from
+		1831= to
 		1832=%0a please adjust 'Approx. meter pro pixel' accordingly
 		1833=Please don't select the separetor line in the wms service option
 		2000=GPX Export
@@ -666,19 +667,19 @@
 		4704=%0aRenaming file:
 		4705=Failed to rename:%0a
 		4706=%0ato:%0an
-		4707=I/O-Error while reading: 
-		4708=Error while reading: 
+		4707=I/O-Error while reading:
+		4708=Error while reading:
 		4709=Could not find image assiciated to:%0a
 		4800=Loading online map services
 		4801=Ignoring error while %0a reading web map service definition file %0a
 		4802=Downloading calibrated (georeferenced) %0a map image %0a '
-		4803=' %0a Downloading tile %0a row 
-		4804= column 
-		4805=Tile 
-		4806=: Ignoring error: 
+		4803=' %0a Downloading tile %0a row
+		4804= column
+		4805=Tile
+		4806=: Ignoring error:
 		4807=loadTo: failed to download map: didn't get http-redirect
-		4808=downloadImage: content-type: 
-		4809= is not an image, begin of content: 
+		4808=downloadImage: content-type:
+		4809= is not an image, begin of content:
 		4810=Error while downloading or saving map:%0a
 		4811=OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):%0a This method must be overloaded in order to be able to use it
 		4812=WebMapService: property >Name:< missing in file:%0a
@@ -691,23 +692,23 @@
 		4819=) use normal space as separator
 		4820=WebMapService: property >CoordinateReferenceSystemUrlPart:< incorrect in file:%0a
 		4821=WebMapService: property >ImageFileExtension:< missing in file:%0a
-		4822=area: 
-		4823= not covered by service: 
-		4824=, service area: 
-		4825=scale 
-		4826= not supported by online map service, supported scale range: 
+		4822=area:
+		4823= not covered by service:
+		4824=, service area:
+		4825=scale
+		4826= not supported by online map service, supported scale range:
 		4827= (measured in meters per pixel vertically)
-		4828=Coordinate system not supported by Cachewolf: 
-		4829=getUrlForBoundingBox: Point: 
+		4828=Coordinate system not supported by Cachewolf:
+		4829=getUrlForBoundingBox: Point:
 		4830=No matching Gau%df-Kr%fcger-Stripe in the EPSG-code list in the .wms
-		4831=getMapInfoObject: Coordinate system not supported by Cachewolf: 
+		4831=getMapInfoObject: Coordinate system not supported by Cachewolf:
 		4900=+is not a german Gauss-Krueger coordinate
 		4920=EPSG code+
 		4921=+not supported
 		4922=EPSG code missing in:+
 		4923=fromWgs84: EPSG code+
 		4924=ToWgs84: EPSG code+
-		5498=Login failed. Error loading page after login. 
+		5498=Login failed. Error loading page after login.
 		5499=Error loading login page.%0aPlease check your internet connection.
 		5000=Load Cachelist
 		5001=Can't spider additional waypoint directly.%0aPlease check main cache.
@@ -801,7 +802,7 @@
 		7103=Scan$u
 		7104=Test$t
 		7105=Forward GPS data to host
-		7106=All data from GPS will be sent to TCP-port 23%0a and can be redirected there to a serial port%0a by 
+		7106=All data from GPS will be sent to TCP-port 23%0a and can be redirected there to a serial port%0a by
 		7107=Interval in sec for logging
 		7108=Error: Failed to open serial port:+
 		7109=Error: Could not get list of available serial ports%0a

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2009-03-15 13:12:51 UTC (rev 1705)
+++ trunk/src/CacheWolf/HintLogPanel.java	2009-03-15 16:13:13 UTC (rev 1706)
@@ -29,7 +29,9 @@
 	HtmlDisplay logs = new HtmlDisplay();
 	AniImage htmlTxtImage;
 	fastScrollText htmlImagDisp = new fastScrollText();
-	mButton decodeButton = new mButton("Decode");
+	private String decodeCaption = MyLocale.getMsg(400, "Decode");
+	private String encodeCaption = MyLocale.getMsg(401, "Encode");
+	mButton decodeButton = new mButton(this.decodeCaption);
 	mButton moreBt = new mButton(">>");
 	mButton prevBt = new mButton("<<");
 	private MyScrollBarPanel sbplog;
@@ -43,7 +45,7 @@
 		split.setSplitter(PanelSplitter.AFTER|PanelSplitter.HIDDEN,PanelSplitter.BEFORE|PanelSplitter.HIDDEN,0);
 		int initialHintHeight=Global.getPref().initialHintHeight;
 		if (initialHintHeight<0 || initialHintHeight>1000) initialHintHeight=Global.getPref().DEFAULT_INITIAL_HINT_HEIGHT;
-		hintpane.setPreferredSize(100,initialHintHeight); 
+		hintpane.setPreferredSize(100,initialHintHeight);
 		ScrollBarPanel sbphint = new MyScrollBarPanel(hint);
 		hintpane.addLast(sbphint,CellConstants.STRETCH, (CellConstants.FILL|CellConstants.WEST));
 		hintpane.addNext(prevBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
@@ -79,7 +81,7 @@
 	private void clearOutput() {
 		if (htmlTxtImage != null) {
 			htmlImagDisp.removeImage(htmlTxtImage);
-			htmlTxtImage.free();		
+			htmlTxtImage.free();
 		}
 	}
 	void setLogs(int crntLogPosition) {
@@ -116,13 +118,13 @@
 		htmlImagDisp.virtualSize = r;
 		htmlImagDisp.origin = new Point();
 		htmlImagDisp.checkScrolls();
-		// Can I get a reasonable value for scrollbarWidth before calling checkScrolls() 
+		// Can I get a reasonable value for scrollbarWidth before calling checkScrolls()
 		// and in a more reasonable way?
 		// Now its ugly: I paint it, calculate the scrollbars and then resize the panel...
 		// Better: Now I only redo it when the scrollbar width changed, which is not the case
 		// normally.
 		int scrollbarWidth = sbplog.vbar.getRect().width;
-		if (scrollbarWidth != lastScrollbarWidth) { 
+		if (scrollbarWidth != lastScrollbarWidth) {
 		    lastScrollbarWidth = scrollbarWidth;
     		    logs.resizeTo(htmlTxtImage.getWidth()-scrollbarWidth, htmlTxtImage.getHeight());
     		    logs.doPaint(draw, new Rect(0,0,htmlTxtImage.getWidth(), htmlTxtImage.getHeight()));
@@ -180,7 +182,7 @@
 				hint.replaceSelection(Common.rot13(selection.toString()));
 			else
 				hint.setText(Common.rot13(hint.getText()));
-			decodeButton.setText("Encode");
+			decodeButton.setText(this.encodeCaption);
 			hintIsDecoded = true;
 		}
 	}
@@ -189,7 +191,7 @@
 			hint.setText(STRreplace.replace(this.currCache.Hints, "<br>", "\n"));
 		else
 			hint.setText("");
-		decodeButton.setText("Decode");
+		decodeButton.setText(this.decodeCaption);
 		hintIsDecoded = false;
 	}
 
@@ -208,7 +210,7 @@
 		}
 		return	super.imageNotDragged(drag, where);
 	}
-	
+
 	// I copied it here because the original has a bug when scrolling
 	// added the support for scrolling / draggin only vertically
 	// rewrite to support for images bigger than the canvas
@@ -224,7 +226,7 @@
 		Point to = new Point(where.x-dc.start.x,where.y-dc.start.y);
 		if (!scrollHorizontal) to.x = 0;
 		if (!scrollVertical) to.y = 0;
-		//if (origin.y - to.y < 0 || origin.y - to.y + r.height > moving.location.height) return true; 
+		//if (origin.y - to.y < 0 || origin.y - to.y + r.height > moving.location.height) return true;
 		if (moving == null) { // this is not used only copied
 			if (!dragBackground) return true;
 			int dx = dc.start.x-where.x, dy = dc.start.y-where.y;
@@ -276,6 +278,6 @@
 		}
 	}
 
-	
-	
+
+
 }



From greiol at mail.berlios.de  Sun Mar 15 19:01:25 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 15 Mar 2009 19:01:25 +0100
Subject: [Cachewolf-svn] r1707 - trunk/docs
Message-ID: <200903151801.n2FI1PeN000616@sheep.berlios.de>

Author: greiol
Date: 2009-03-15 19:00:40 +0100 (Sun, 15 Mar 2009)
New Revision: 1707

Removed:
   trunk/docs/CacheWolf_on_Linux.pdf
Log:
auf anweisung von //mirabilos geloescht


Deleted: trunk/docs/CacheWolf_on_Linux.pdf
===================================================================
(Binary files differ)



From greiol at mail.berlios.de  Sun Mar 15 19:03:42 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 15 Mar 2009 19:03:42 +0100
Subject: [Cachewolf-svn] r1708 - trunk
Message-ID: <200903151803.n2FI3ghe003247@sheep.berlios.de>

Author: greiol
Date: 2009-03-15 19:03:39 +0100 (Sun, 15 Mar 2009)
New Revision: 1708

Modified:
   trunk/getRes.sh
Log:
make someone happy

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2009-03-15 18:00:40 UTC (rev 1707)
+++ trunk/getRes.sh	2009-03-15 18:03:39 UTC (rev 1708)
@@ -16,4 +16,5 @@
 cp -fa res_noewe/languages/* work/languages/
 
 find work -type f | xargs chmod 644
-find work -type d | xargs chmod 755
\ No newline at end of file
+find work -type d | xargs chmod 755
+#



From mirabilos at mail.berlios.de  Sun Mar 15 19:07:42 2009
From: mirabilos at mail.berlios.de (mirabilos at mail.berlios.de)
Date: Sun, 15 Mar 2009 18:07:42 +0000 (UTC)
Subject: [Cachewolf-svn] r1707 - trunk/docs
In-Reply-To: <200903151801.n2FI1PeN000616@sheep.berlios.de>
References: <200903151801.n2FI1PeN000616@sheep.berlios.de>
Message-ID: <Pine.BSM.4.64L.0903151806520.21030@herc.mirbsd.org>

greiol at mail.berlios.de dixit:

>Author: greiol
>Date: 2009-03-15 19:00:40 +0100 (Sun, 15 Mar 2009)
>New Revision: 1707
>
>Removed:
>   trunk/docs/CacheWolf_on_Linux.pdf
>Log:
>auf anweisung von //mirabilos geloescht

Du sollst das nicht l?schen sondern die Quellen f?r das
PDF hinzuf?gen, damit alle das bearbeiten k?nnen.

//mirabilos
-- 
Solange man keine schmutzigen Tricks macht, und ich meine *wirklich*
schmutzige Tricks, wie bei einer doppelt verketteten Liste beide
Pointer XORen und in nur einem Word speichern, funktioniert Boehm ganz
hervorragend.		-- Andreas Bogk ?ber boehm-gc in d.a.s.r


From abo at robert-arnold.de  Sun Mar 15 20:32:48 2009
From: abo at robert-arnold.de (Robert Arnold)
Date: Sun, 15 Mar 2009 20:32:48 +0100
Subject: [Cachewolf-svn] r1707 - trunk/docs
In-Reply-To: <200903151801.n2FI1PeN000616@sheep.berlios.de>
References: <200903151801.n2FI1PeN000616@sheep.berlios.de>
Message-ID: <op.uqulwyy3f2sikt@leichter>

hier hat niemand Anweisungen zu erteilen. Hier hat nur das bessere  
Argument zu z?hlen. Wir arbeiten hier alle zusammen, es gibt keinen /  
keine Chefs.

Gru?,
    Pfeffer.

Am 15.03.2009, 19:01 Uhr, schrieb <greiol at mail.berlios.de>:

> Author: greiol
> Date: 2009-03-15 19:00:40 +0100 (Sun, 15 Mar 2009)
> New Revision: 1707
>
> Removed:
>    trunk/docs/CacheWolf_on_Linux.pdf
> Log:
> auf anweisung von //mirabilos geloescht
>
>
> Deleted: trunk/docs/CacheWolf_on_Linux.pdf
> ===================================================================
> (Binary files differ)
>
> _______________________________________________
> Cachewolf-svn mailing list
> Cachewolf-svn at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/cachewolf-svn



-- 
Erstellt mit Operas revolution?rem E-Mail-Modul: http://www.opera.com/mail/


From greiol at mail.berlios.de  Sun Mar 15 21:17:12 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 15 Mar 2009 21:17:12 +0100
Subject: [Cachewolf-svn] r1709 - trunk/docs
Message-ID: <200903152017.n2FKHCX0027387@sheep.berlios.de>

Author: greiol
Date: 2009-03-15 21:17:10 +0100 (Sun, 15 Mar 2009)
New Revision: 1709

Added:
   trunk/docs/cachewolf_on_linux.txt
Log:
sigh

Added: trunk/docs/cachewolf_on_linux.txt
===================================================================
--- trunk/docs/cachewolf_on_linux.txt	2009-03-15 18:03:39 UTC (rev 1708)
+++ trunk/docs/cachewolf_on_linux.txt	2009-03-15 20:17:10 UTC (rev 1709)
@@ -0,0 +1 @@
+see http://cbr2008nrw.ohost.de/CacheWolf_on_Linux.pdf until we agree on a documentation format



From engy at gmx.de  Sun Mar 15 21:21:42 2009
From: engy at gmx.de (Thorsten Koch)
Date: Sun, 15 Mar 2009 21:21:42 +0100
Subject: [Cachewolf-svn] r1709 - trunk/docs
In-Reply-To: <200903152017.n2FKHCX0027387@sheep.berlios.de>
Message-ID: <CAEPJMOJFPDFLJPPPINOAEKHDCAA.engy@gmx.de>

Committe es doch als Word-Dokument ;-)

*duck*

Engywuck

> -----Ursprungliche Nachricht-----
> Von: cachewolf-svn-bounces at lists.berlios.de
> [mailto:cachewolf-svn-bounces at lists.berlios.de]Im Auftrag von
> greiol at mail.berlios.de
> Gesendet: Sonntag, 15. Marz 2009 21:17
> An: cachewolf-svn at lists.berlios.de
> Betreff: [Cachewolf-svn] r1709 - trunk/docs
> 
> 
> Author: greiol
> Date: 2009-03-15 21:17:10 +0100 (Sun, 15 Mar 2009)
> New Revision: 1709
> 
> Added:
>    trunk/docs/cachewolf_on_linux.txt
> Log:
> sigh
> 
> Added: trunk/docs/cachewolf_on_linux.txt
> ===================================================================
> --- trunk/docs/cachewolf_on_linux.txt	2009-03-15 18:03:39 UTC (rev 1708)
> +++ trunk/docs/cachewolf_on_linux.txt	2009-03-15 20:17:10 UTC (rev 1709)
> @@ -0,0 +1 @@
> +see http://cbr2008nrw.ohost.de/CacheWolf_on_Linux.pdf until we 
> agree on a documentation format
> 
> _______________________________________________
> Cachewolf-svn mailing list
> Cachewolf-svn at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/cachewolf-svn


From mik77 at mail.berlios.de  Sun Mar 15 21:59:32 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 15 Mar 2009 21:59:32 +0100
Subject: [Cachewolf-svn] r1710 - in trunk: res_noewe src/CacheWolf
Message-ID: <200903152059.n2FKxWM8030416@sheep.berlios.de>

Author: mik77
Date: 2009-03-15 21:59:28 +0100 (Sun, 15 Mar 2009)
New Revision: 1710

Modified:
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/GPXImporter.java
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Some more information in CacheHolderDetail

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-03-15 20:17:10 UTC (rev 1709)
+++ trunk/res_noewe/spider.def	2009-03-15 20:59:28 UTC (rev 1710)
@@ -26,6 +26,7 @@
 # Version 4.2 - 20081031 Fix for cache type (background image with name of type)
 # Version 4.3 - 20090314 maxDistance string added
 # Version 4.4 - 20090314 firstPageFinds string added
+# Version 4.5 - 20090315 strings for spidering country/state/logId
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -73,6 +74,7 @@
 difficultyRex      = <span\ id="Difficulty">.*?alt="(.*?)\ out\ of
 terrainRex         = <span\ id="Terrain">.*?alt="(.*?)\ out\ of
 cacheTypeRex       = \\./images/WptTypes/(.*?)\\.gif
+cacheLocationRex   = <span\ id="Location">In\ ((?s).*?)</span>
 
 #--------------------------------------
 #Section2a: Logs
@@ -94,6 +96,8 @@
 dateExEnd          = \ by\ <
 logExStart         = found)<br\ />
 logExEnd           = <br\ />[
+logIdExStart         = by\ <a\ name="
+logIdExEnd           = "\ style="
 # Die Icons, die einen erfolgreichen Fund signalisieren
 icon_smile         = icon_smile.gif
 icon_camera        = icon_camera.gif

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-03-15 20:17:10 UTC (rev 1709)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-03-15 20:59:28 UTC (rev 1710)
@@ -33,6 +33,10 @@
 	  //public String Bugs = EMPTY; Superceded by Travelbugs
 	  public String URL = EMPTY;
 	  public String Solver = EMPTY;
+	  public String OwnLogId = EMPTY;
+	  public String OwnLogText = EMPTY;
+	  public String Country = EMPTY;
+	  public String State = EMPTY;
 	  /** For faster cache import (from opencaching) changes are only written when the details are freed from memory 
 	   * If you want to save the changes automatically when the details are unloaded, set this to true */ 
 	  public boolean hasUnsavedChanges = false;
@@ -105,6 +109,12 @@
 		  setHints(newCh.Hints);
 		  setCacheLogs(newCh.CacheLogs);
 		  
+		  if (newCh.OwnLogId.length()>0) this.OwnLogId=newCh.OwnLogId;
+		  if (newCh.OwnLogText.length()>0) this.OwnLogText=newCh.OwnLogText;
+		  
+		  if (newCh.Country.length()>0) this.Country=newCh.Country;
+		  if (newCh.State.length()>0) this.State=newCh.State;
+		  
 		  if (newCh.Solver.length()>0) this.Solver=newCh.Solver;
 	 	return this;
 	  }
@@ -154,14 +164,22 @@
 			in.close();
 			Extractor ex = new Extractor(text, "<DETAILS><![CDATA[", "]]></DETAILS>", 0, true);		
 			LongDescription = ex.findNext();
-			ex = new Extractor(text, "<HINTS><![CDATA[", "]]></HINTS>", 0, true);
-			Hints = ex.findNext();
+			ex = new Extractor(text, "<COUNTRY><![CDATA[", "]]></COUNTRY>", 0, true);
+			Country = ex.findNext();
+			ex = new Extractor(text, "<STATE><![CDATA[", "]]></STATE>", 0, true);
+			State = ex.findNext();
 			// Attributes
 			ex = new Extractor(text,"<ATTRIBUTES>","</ATTRIBUTES>",0,true);
 			attributes.XmlAttributesEnd(ex.findNext());
 			
+			ex = new Extractor(text, "<HINTS><![CDATA[", "]]></HINTS>", 0, true);
+			Hints = ex.findNext();
 			ex = new Extractor(text, "<LOGS>","</LOGS>", 0, true);
 			dummy = ex.findNext();
+			ex = new Extractor(dummy, "<OWNLOGID>","</OWNLOGID>", 0, true);
+			OwnLogId = ex.findNext();
+			ex = new Extractor(dummy, "<OWNLOG><![CDATA[", "]]></OWNLOG>", 0, true);
+			OwnLogText = ex.findNext();
 			CacheLogs.clear();
 			ex = new Extractor(dummy, "<LOG>","</LOG>", 0, true);
 			
@@ -278,9 +296,13 @@
 				  detfile.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n");
 				  detfile.print("<CACHEDETAILS>\r\n");
 				  detfile.print("<DETAILS><![CDATA["+LongDescription+"]]></DETAILS>\r\n");
+				  detfile.print("<COUNTRY><![CDATA["+Country+"]]></COUNTRY>\n");
+				  detfile.print("<STATE><![CDATA["+State+"]]></STATE>\n");
 				  detfile.print(attributes.XmlAttributesWrite());
 				  detfile.print("<HINTS><![CDATA["+Hints+"]]></HINTS>\r\n");
 				  detfile.print("<LOGS>\r\n");
+				  detfile.print("<OWNLOGID>"+OwnLogId+"</OWNLOGID>\r\n");
+				  detfile.print("<OWNLOG><![CDATA["+OwnLogText+"]]></OWNLOG>\r\n");
 				  for(int i = 0; i < CacheLogs.size(); i++){
 					  detfile.print(CacheLogs.getLog(i).toXML());
 				  }

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2009-03-15 20:17:10 UTC (rev 1709)
+++ trunk/src/CacheWolf/GPXImporter.java	2009-03-15 20:59:28 UTC (rev 1710)
@@ -19,7 +19,7 @@
 	Profile profile;
 	Vector cacheDB;
 	CacheHolderDetail chD;
-	String strData, saveDir, logData, logIcon, logDate, logFinder;
+	String strData, saveDir, logData, logIcon, logDate, logFinder, logId;
 	boolean inWpt, inCache, inLogs, inBug;
 	public XMLElement document;
 	private Vector files = new Vector();
@@ -223,10 +223,15 @@
 			chD.is_HTML= true;
 		}
 
-		if (name.equals("groundspeak:logs") || name.equals("log") || name.equals("terra:logs")) {
+		if (name.equals("groundspeak:logs") || name.equals("logs") || name.equals("terra:logs")) {
 			inLogs = true;
 			return;
 		}
+		if (name.equals("groundspeak:log") || name.equals("log") || name.equals("terra:log")) {
+			inLogs = true;
+			logId = atts.getValue("id");
+			return;
+		}
 		if (name.equals("groundspeak:travelbugs")) {
 			inBug = true;
 			return;
@@ -266,6 +271,8 @@
 						  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
 							chD.CacheStatus=logDate;
 							chD.is_found=true;
+							chD.OwnLogId = logId;
+							chD.OwnLogText = logData;
 				}
 				return;
 			}
@@ -428,7 +435,14 @@
 			chD.CacheSize = strData;
 			return;
 		}
-		
+		if (name.equals("groundspeak:country")|| name.equals("country")){
+			chD.Country = strData;
+			return;
+		}
+		if (name.equals("groundspeak:state")|| name.equals("state")){
+			chD.State = strData;
+			return;
+		}
 		if (name.equals("terra:size")){
 			chD.CacheSize = TCSizetoText(strData);
 		}

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2009-03-15 20:17:10 UTC (rev 1709)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2009-03-15 20:59:28 UTC (rev 1710)
@@ -55,7 +55,7 @@
 	String ocSeekUrl = new String("http://"+OPENCACHING_HOST+"/viewcache.php?cacheid=");
 	String cacheID = new String();
 
-	String logData, logIcon, logDate, logFinder;
+	String logData, logIcon, logDate, logFinder, logId;
 	boolean loggerRecommended;
 	int logtype;
 	String user;
@@ -409,11 +409,7 @@
 			logtype = Convert.toInt(atts.getValue("id"));
 			switch (logtype) {
 			case 1: 
-				logIcon = GPXImporter.typeText2Image("Found"); 
-				if (logFinder.equalsIgnoreCase(user) || logFinder.equalsIgnoreCase(pref.myAlias2)) { // see also endCacheLog
-					chD.is_found = true; 
-					chD.CacheStatus = MyLocale.getMsg(318,"Found");
-				}
+				logIcon = GPXImporter.typeText2Image("Found");
 				break;
 			case 2:	logIcon = GPXImporter.typeText2Image("Not Found"); 
 			chD.noFindLogs += 1;
@@ -423,7 +419,10 @@
 			loggerRecommended = atts.getValue("recommended").equals("1");
 			return;
 		}
-
+		
+		if (name.equals("id")){
+			logId = atts.getValue("id");
+		}
 	}
 
 	private void endCache(String name){
@@ -500,6 +499,10 @@
 			chD.DateHidden = strData.substring(0,10); //Date;
 			return;
 		}
+		if (name.equals("country")){
+			chD.Country = strData;
+			return;
+		}
 	}
 
 	private void endCacheDesc(String name){
@@ -638,6 +641,12 @@
 	private void endCacheLog(String name){
 		if (name.equals("cachelog")){ // </cachelog>
 			chD.CacheLogs.merge(new Log(logIcon, logDate, logFinder, logData, loggerRecommended));
+			if((logFinder.toLowerCase().compareTo(user) == 0 || logFinder.equalsIgnoreCase(pref.myAlias2)) && logtype == 1) {
+						chD.CacheStatus=logDate;
+						chD.is_found=true;
+						chD.OwnLogId = logId;
+						chD.OwnLogText = logData;
+			}
 			chD.hasUnsavedChanges = true; //chD.saveCacheDetails(profile.dataDir);
 			return;
 		}
@@ -650,17 +659,10 @@
 
 		if (name.equals("date"))  {
 			logDate = new String(strData);
-			if (chD.is_found) {
-				chD.CacheStatus=strData.substring(0,10);
-			}
 			return;
 		}
 		if (name.equals("userid")){
 			logFinder = new String(strData);
-			if((logFinder.toLowerCase().compareTo(user) == 0 || logFinder.equalsIgnoreCase(pref.myAlias2)) && logtype == 1){
-				chD.is_found = true; // see startCacheLog - in the current .xml this is set by startCacheLog but we sequence in the xml from opencaching might change, so I leave this also here
-				chD.CacheStatus = MyLocale.getMsg(318,"Found");
-			}
 			return;
 		}
 		if (name.equals("text")){ 

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-15 20:17:10 UTC (rev 1709)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-15 20:59:28 UTC (rev 1710)
@@ -695,6 +695,24 @@
 						pref.log("Getting cache name");
 						chD.CacheName = SafeXML.cleanback(getName(completeWebPage));
 						if (pref.debug) pref.log("Name: " + chD.CacheName); else pref.log("Got name");
+						
+						pref.log("Trying location (country/state)");
+						String location = getLocation(completeWebPage);
+						if (location.length() != 0) {
+							int countryStart = location.indexOf(",");
+							if (countryStart > -1) {
+								chD.Country = SafeXML.cleanback(location.substring(countryStart + 1).trim());
+								chD.State = SafeXML.cleanback(location.substring(0, countryStart).trim());								
+							} else {
+								chD.Country = location.trim();
+								chD.State = "";
+							}
+							pref.log("Got location (country/state)");							
+						} else {
+							chD.Country = "";
+							chD.State = "";
+							pref.log("No location (country/state) found");
+						}
 
 						pref.log("Trying owner");
 						chD.CacheOwner = SafeXML.cleanback(getOwner(completeWebPage)).trim();
@@ -876,6 +894,19 @@
 	}
 
 	/**
+	 * Get the cache location (country and state)
+	 * @param doc A previously fetched cachepage
+	 * @return the location (country and state) of the cache
+	 */
+	private String getLocation(String doc) throws Exception{
+		inRex = new Regex(p.getProp("cacheLocationRex"));
+		inRex.search(doc);
+		if (!inRex.didMatch()) return "";
+						
+		return inRex.stringMatched(1);
+	}
+		
+	/**
 	 * Get the cache name
 	 * @param doc A previously fetched cachepage
 	 * @return the name of the cache
@@ -980,6 +1011,8 @@
 	private LogList getLogs(String doc, CacheHolderDetail chD) throws Exception{
 		String icon = "";
 		String name = "";
+		String logText = "";
+		String logId = "";
 		LogList reslts = new LogList();
 		Regex blockRex = new Regex(p.getProp("blockRex"));
 		blockRex.search(doc);
@@ -994,6 +1027,7 @@
 		Extractor exName = new Extractor(nameTemp, p.getProp("nameExStart"), p.getProp("nameExEnd"), 0 , true);
 		Extractor exDate = new Extractor(singleLog,p.getProp("dateExStart"), p.getProp("dateExEnd"), 0 , true);
 		Extractor exLog = new Extractor(singleLog, p.getProp("logExStart"), p.getProp("logExEnd"), 0, true);
+		Extractor exLogId = new Extractor(singleLog, p.getProp("logIdExStart"), p.getProp("logIdExEnd"), 0, true);
 		//Vm.debug("Log Block: " + singleLog);
 		int nLogs=0;
 		while(exSingleLog.endOfSearch() == false){
@@ -1007,13 +1041,17 @@
 			//Vm.debug("--------------------------------------------");
 			icon = exIcon.findNext();
 			name = exName.findNext();
+			logText = exLog.findNext();
+			logId = exLogId.findNext();
 			String d=DateFormat.logdate2YMD(exDate.findNext());
 			if((icon.equals(p.getProp("icon_smile")) || icon.equals(p.getProp("icon_camera")) || icon.equals(p.getProp("icon_attended"))) &&
 				(name.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && name.equalsIgnoreCase(pref.myAlias2))) )  {
 				chD.is_found = true;
 				chD.CacheStatus = d;
+				chD.OwnLogId = logId;
+				chD.OwnLogText = logText;
 			}
-			if (nLogs<=MAXLOGS) reslts.add(new Log(icon,d,name,exLog.findNext()));
+			if (nLogs<=MAXLOGS) reslts.add(new Log(icon,d,name,logText));
 
 			singleLog = exSingleLog.findNext();
 			exIcon.setSource(singleLog);
@@ -1022,9 +1060,10 @@
 			exName.setSource(nameTemp);
 			exDate.setSource(singleLog);
 			exLog.setSource(singleLog);
+			exLogId.setSource(singleLog);
 			// We cannot simply stop if we have reached MAXLOGS just in case we are waiting for
 			// a log by our alias that happened earlier.
-			if (nLogs>=MAXLOGS && chD.is_found) break;
+			if (nLogs>=MAXLOGS && chD.is_found && (chD.OwnLogId.length() != 0)) break;
 		}
 		if (nLogs>MAXLOGS) {
 			reslts.add(Log.maxLog());



From araber95 at mail.berlios.de  Mon Mar 16 13:38:34 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 16 Mar 2009 13:38:34 +0100
Subject: [Cachewolf-svn] r1711 - trunk/src/CacheWolf/navi
Message-ID: <200903161238.n2GCcYa7023150@sheep.berlios.de>

Author: araber95
Date: 2009-03-16 13:38:21 +0100 (Mon, 16 Mar 2009)
New Revision: 1711

Modified:
   trunk/src/CacheWolf/navi/MapsList.java
Log:
Auf dem Pocket PC werden jetzt auch die Dateien des MapVerzeichnisses benutzt.
Files of the MapsPath itself are now used on the Pocket PC.

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2009-03-15 20:59:28 UTC (rev 1710)
+++ trunk/src/CacheWolf/navi/MapsList.java	2009-03-16 12:38:21 UTC (rev 1711)
@@ -32,13 +32,11 @@
 		super(); // forget already loaded maps
 		//if (mmp.mapImage != null) 
 		String dateien[];
-		FileBugfix files = new FileBugfix(mapsPath);
-		String rawFileName = new String();
-		String[] dirstmp = files.list(null, FileBase.LIST_DIRECTORIES_ONLY);
-		Vector dirs;
-		if (dirstmp != null) dirs = new Vector(dirstmp);
-		else dirs = new Vector();
-		dirs.add("."); // include the mapsPath itself
+		FileBugfix files;
+		String rawFileName;
+		String[] dirstmp;
+		Vector dirs = new Vector();
+		dirs.add(""); // start with the mapsPath (only this one , without its subdirs)
 		MapListEntry tempMIO;
 		MessageBox f = null; 
 		// sort(new StandardComparer(), false);



From mik77 at mail.berlios.de  Tue Mar 17 22:48:03 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 17 Mar 2009 22:48:03 +0100
Subject: [Cachewolf-svn] r1712 - in trunk/src: CacheWolf exp
Message-ID: <200903172148.n2HLm3kn015553@sheep.berlios.de>

Author: mik77
Date: 2009-03-17 22:48:01 +0100 (Tue, 17 Mar 2009)
New Revision: 1712

Modified:
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/exp/Exporter.java
   trunk/src/exp/LocExporter.java
Log:
Short cache details in Garmin export improved.

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2009-03-16 12:38:21 UTC (rev 1711)
+++ trunk/src/CacheWolf/CacheType.java	2009-03-17 21:48:01 UTC (rev 1712)
@@ -165,6 +165,30 @@
 			{"Question","52"},{"Final","53"},
 			{"Trailhead","54"},{"Reference","55"},{"WhereIGo","1858"}};
 
+	public static String shortType(String typeNum){
+		String shortType = new String("O");
+		if(typeNum.equals("0")) shortType = "C";
+		if(typeNum.equals("2")) shortType = "T";
+		if(typeNum.equals("3")) shortType = "M";
+		if(typeNum.equals("4")) shortType = "V";
+		if(typeNum.equals("5")) shortType = "L";
+		if(typeNum.equals("6")) shortType = "O";
+		if(typeNum.equals("11")) shortType = "W";
+		if(typeNum.equals("8")) shortType = "U";
+		if(typeNum.equals("12")) shortType = "O";
+		if(typeNum.equals("13")) shortType = "O";
+		if(typeNum.equals("137")) shortType = "E";
+		if(typeNum.equals("453")) shortType = "O";
+		if(typeNum.equals("1858")) shortType = "O";
+		if(typeNum.equals("50")) shortType = "P";
+		if(typeNum.equals("51")) shortType = "S";
+		if(typeNum.equals("52")) shortType = "Q";
+		if(typeNum.equals("53")) shortType = "F";
+		if(typeNum.equals("54")) shortType = "H";
+		if(typeNum.equals("55")) shortType = "R";
+		return shortType;
+	}
+
 	public static String transType(String geoNum){
 		String geo = new String("Unknown");
 		if(geoNum.equals("2")) geo = "Traditional Cache";

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-03-16 12:38:21 UTC (rev 1711)
+++ trunk/src/CacheWolf/Preferences.java	2009-03-17 21:48:01 UTC (rev 1712)
@@ -207,6 +207,8 @@
 	public boolean addDetailsToWaypoint = false;
 	/** Add short details to name on export */
 	public boolean addDetailsToName = false;
+	/** The own GC member ID */
+	public String gcMemberId = "";
 
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
@@ -278,6 +280,7 @@
 			SpiderGC.passwort=password;
 		}
 		else if(name.equals("alias2")) myAlias2 = SafeXML.cleanback(atts.getValue("name"));
+		else if(name.equals("gcmemberid")) gcMemberId = atts.getValue("name");
 		else if(name.equals("location")){
 			curCentrePt.set(atts.getValue("lat")+" "+atts.getValue("long"));
 		}
@@ -433,6 +436,7 @@
 			outp.print("    <lastprofile autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\">" + SafeXML.strxmlencode(lastProfile) + "</lastprofile>\n"); //RB
 			outp.print("	<alias name =\""+ SafeXML.clean(myAlias) +"\" password=\""+SafeXML.clean(password)+"\" />\n");
 			outp.print("	<alias2 name =\""+ SafeXML.clean(myAlias2) +"\"/>\n");
+			outp.print("	<gcmemberid name =\""+ SafeXML.clean(gcMemberId) +"\"/>\n");
 			outp.print("	<browser name = \"" + SafeXML.strxmlencode(browser) + "\"/>\n");
 			outp.print("	<proxy prx = \"" + SafeXML.strxmlencode(myproxy) + "\" prt = \"" + SafeXML.strxmlencode(myproxyport) + "\" active = \"" + SafeXML.strxmlencode(proxyActive) + "\" />\n");
 			outp.print("	<port portname = \"" + SafeXML.strxmlencode(mySPO.portName) + "\" baud = \"" + SafeXML.strxmlencode(mySPO.baudRate) + "\"/>\n");

Modified: trunk/src/exp/Exporter.java
===================================================================
--- trunk/src/exp/Exporter.java	2009-03-16 12:38:21 UTC (rev 1711)
+++ trunk/src/exp/Exporter.java	2009-03-17 21:48:01 UTC (rev 1712)
@@ -417,16 +417,21 @@
 
     public static String getShortDetails( CacheHolder ch ) {
     	StringBuffer strBuf = new StringBuffer(7);
-    	strBuf.append(ch.CacheSize.substring(0, 1).toLowerCase());
-    	strBuf.append(ch.hard.charAt(0));
-    	if ( ch.hard.endsWith(".5") ) {
-    		strBuf.append("5");
+    	strBuf.append(CacheType.shortType(ch.type).toLowerCase());			
+    	if (!ch.isAddiWpt()) {
+    		if ( (ch.hard.length() > 0) && (ch.terrain.length() > 0) ) {
+    			strBuf.append(ch.hard.charAt(0));
+    			if ( ch.hard.endsWith(".5") ) {
+    				strBuf.append("5");
+    			}
+    			strBuf.append("/");
+    			strBuf.append(ch.terrain.charAt(0));
+    			if ( ch.terrain.endsWith(".5") ) {
+    				strBuf.append("5");
+    			}
+    		}
+    		strBuf.append(ch.CacheSize.substring(0, 1).toLowerCase());
     	}
-    	strBuf.append("/");
-    	strBuf.append(ch.terrain.charAt(0));
-    	if ( ch.terrain.endsWith(".5") ) {
-    		strBuf.append("5");
-    	}
 
     	return strBuf.toString();
     }

Modified: trunk/src/exp/LocExporter.java
===================================================================
--- trunk/src/exp/LocExporter.java	2009-03-16 12:38:21 UTC (rev 1711)
+++ trunk/src/exp/LocExporter.java	2009-03-17 21:48:01 UTC (rev 1712)
@@ -54,12 +54,9 @@
 		strBuf.append("\"><![CDATA[");
 		strBuf.append(simplifyString(chD.CacheName));
 		if (Global.getPref().addDetailsToName) {
-			strBuf.append(", ");
-			strBuf.append(CacheType.wayType[Common.parseInt(chD.type)][CacheType.WPT_TEXT]);			
-			strBuf.append(" ");
 			strBuf.append( getShortDetails( chD ) );
-			if (!chD.Hints.equals("null")) {
-				strBuf.append("; Hint:");
+			if ( (!chD.Hints.equals("null")) && (chD.Hints.length() > 0) ) {
+				strBuf.append("H:");
 				strBuf.append( simplifyString(Common.rot13(chD.Hints)) );			
 			}
 		}



From greiol at mail.berlios.de  Tue Mar 17 23:26:23 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 17 Mar 2009 23:26:23 +0100
Subject: [Cachewolf-svn] r1713 - in trunk/src: . build
Message-ID: <200903172226.n2HMQNA4020145@sheep.berlios.de>

Author: greiol
Date: 2009-03-17 23:26:22 +0100 (Tue, 17 Mar 2009)
New Revision: 1713

Added:
   trunk/src/build/
   trunk/src/build/CabHelper.java
Log:
if it compiles, release it

Added: trunk/src/build/CabHelper.java
===================================================================
--- trunk/src/build/CabHelper.java	2009-03-17 21:48:01 UTC (rev 1712)
+++ trunk/src/build/CabHelper.java	2009-03-17 22:26:22 UTC (rev 1713)
@@ -0,0 +1,141 @@
+package build;
+
+// yes, it is possible to write terrible code in any language ;-)
+
+import java.io.*;
+import java.util.*;
+import java.util.zip.*;
+
+public class CabHelper {
+	
+	public static void main(String[] args) {
+		File zipFile;
+		File outDir;
+		String outDirName;
+		Integer numDirectories = 0;
+		Integer numFiles = 0;
+		HashMap<String,HashMap<String,String>> cabMapping = new HashMap<String, HashMap<String, String>> ();
+		
+		if (args.length != 2) {
+			throw new IllegalArgumentException("please specify zipfile and output directory");
+		}
+		
+		zipFile = new File(args[0]);
+		outDirName = args[1];
+		outDir = new File(outDirName);
+		
+		if (! zipFile.exists() || ! zipFile.canRead() || ! zipFile.isFile()) {
+			throw new IllegalArgumentException("zip file not readable");
+		}
+		
+		if (outDir.exists()) {
+			if (outDir.isDirectory()) {
+				String[] files = outDir.list();
+				if (files.length > 0) {
+					throw new IllegalArgumentException("out directory not empty");
+				}
+			} else {
+				throw new IllegalArgumentException("output directory exists, but is not a directory");
+			}
+		} else {
+			boolean success = outDir.mkdir();
+			if (!success) {
+				throw new IllegalArgumentException("unable to create output directory");
+			}
+		}
+		
+		try {
+			ZipFile zip = new ZipFile(zipFile);
+			Enumeration<? extends ZipEntry> zipList;
+			zipList = zip.entries();
+
+			while (zipList.hasMoreElements()) {
+				ZipEntry zipEntry = (ZipEntry) zipList.nextElement();
+				if (zipEntry.isDirectory()) {
+					String dirName = zipEntry.getName();
+					dirName = dirName.replace(File.separatorChar, '\\');
+					if (dirName.endsWith("\\")) {
+						dirName = dirName.substring(0, dirName.length()-1);
+					}
+					if (cabMapping.get(dirName) == null) {
+						cabMapping.put(dirName, new HashMap <String, String>());
+						numDirectories++;
+					}
+				} else {
+					String inFileName = zipEntry.getName().replace(File.separatorChar, '\\');
+					String outFileName = String.format("CW%06d.DMY", numFiles);
+					String inDirName = "";
+					copyInputStream(zip.getInputStream(zipEntry), new BufferedOutputStream(new FileOutputStream(outDirName+File.separator+outFileName)));
+					Integer lastSlash = inFileName.lastIndexOf('\\');
+					if (lastSlash == -1) {
+						inDirName = "";
+					} else {
+						inDirName = inFileName.substring(0,lastSlash);
+						inFileName = inFileName.substring(lastSlash+1);
+					}
+					if (cabMapping.get(inDirName) == null) {
+						cabMapping.put(inDirName, new HashMap <String, String>());
+						numDirectories++;
+					}
+					cabMapping.get(inDirName).put(outFileName, inFileName);
+										
+					numFiles++;
+				}
+			}
+		} catch (Exception e) {
+			e.printStackTrace();
+			System.exit(1);
+		}
+		
+		StringBuffer outBuffer = new StringBuffer();
+		String dosNL = "\r\n";
+		outBuffer.append("<wap-provisioningdoc>").append(dosNL);
+		outBuffer.append("\t<characteristic type=\"Install\">").append(dosNL);
+		outBuffer.append("\t\t<parm name=\"InstallPhase\" value=\"install\" />").append(dosNL);
+		outBuffer.append("\t\t<parm name=\"AppName\" value=\"CW-test\" />").append(dosNL);
+		outBuffer.append("\t\t<parm name=\"InstallDir\" value=\"%CE1%\\CW-test\" translation=\"install\" />").append(dosNL);
+		outBuffer.append(String.format("\t\t<parm name=\"NumDirs\" value=\"%d\" />",numDirectories)).append(dosNL);
+		outBuffer.append(String.format("\t\t<parm name=\"NumFiles\" value=\"%d\" />",numFiles)).append(dosNL);
+		outBuffer.append("\t\t<parm name=\"NumRegKeys\" value=\"0\" />").append(dosNL);
+		outBuffer.append("\t\t<parm name=\"NumRegVals\" value=\"0\" />").append(dosNL);
+		outBuffer.append("\t\t<parm name=\"NumShortcuts\" value=\"0\" />").append(dosNL);
+		outBuffer.append("\t</characteristic>").append(dosNL);
+		outBuffer.append("\t<characteristic type=\"FileOperation\">").append(dosNL);
+		for ( String outKey : cabMapping.keySet() ) {
+			outBuffer.append(String.format("\t\t<characteristic type=\"%%InstallDir%%\\%s\" translation=\"install\">",outKey)).append(dosNL);
+			outBuffer.append("\t\t\t<characteristic type=\"MakeDir\" />").append(dosNL);
+			
+			for (String inKey: cabMapping.get(outKey).keySet()) {
+				outBuffer.append(String.format("\t\t\t<characteristic type=\"%s\" translation=\"install\">",cabMapping.get(outKey).get(inKey))).append(dosNL);
+				outBuffer.append("\t\t\t\t<characteristic type=\"Extract\">").append(dosNL);
+				outBuffer.append(String.format("\t\t\t\t\t<parm name=\"Source\" value=\"%s\"/>",inKey)).append(dosNL);
+				outBuffer.append("\t\t\t\t</characteristic>").append(dosNL);
+				outBuffer.append("\t\t\t</characteristic>").append(dosNL);
+			}
+			outBuffer.append("\t\t</characteristic>").append(dosNL);
+		}
+		outBuffer.append("\t</characteristic>").append(dosNL);
+		outBuffer.append("</wap-provisioningdoc>").append(dosNL);
+		try {
+			BufferedOutputStream outStream = new BufferedOutputStream(new FileOutputStream(outDirName+File.separator+"_setup.xml"));
+			outStream.write(outBuffer.toString().getBytes());
+			outStream.flush();
+			outStream.close();
+		} catch (Exception e) {
+			e.printStackTrace();
+			System.exit(1);
+		}
+	}
+	
+	public static final void copyInputStream(InputStream in, OutputStream out) throws IOException {
+		byte[] buffer = new byte[1024];
+		int len;
+
+		while((len = in.read(buffer)) >= 0) {
+			out.write(buffer, 0, len);
+		}
+		
+		in.close();
+		out.close();
+	}
+}



From greiol at mail.berlios.de  Tue Mar 17 23:27:20 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 17 Mar 2009 23:27:20 +0100
Subject: [Cachewolf-svn] r1714 - trunk
Message-ID: <200903172227.n2HMRK4E020281@sheep.berlios.de>

Author: greiol
Date: 2009-03-17 23:27:19 +0100 (Tue, 17 Mar 2009)
New Revision: 1714

Modified:
   trunk/build.xml
Log:
added experimental cab building support

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-17 22:26:22 UTC (rev 1713)
+++ trunk/build.xml	2009-03-17 22:27:19 UTC (rev 1714)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no"?>
 <project name="CacheWolf" default="release">
 
-	<!-- ewe builder on exist for windows and linux -->
+	<!-- ewe builder only exist for windows and linux -->
 	<fail message="unsupport operating system. sorry">
 		<condition>
 			<not>
@@ -26,7 +26,7 @@
 	<property name="assemble.dir" value="assemble"/>
 
 	<!-- lists of files to be packaged, this should become less confusing later on -->
-	<property name="template.files" value="**/*.tpl"/>
+	<property name="template.files" value="*/*.tpl"/>
 	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png"/>
 	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif,icon_greenlight.gif,icon_redlight.gif"/>
 	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4.gif,3.gif,2.gif,1858.gif,13.gif,137.gif,12.gif"/>
@@ -46,9 +46,20 @@
 	</target>
 
 	<!-- <target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms"> -->
-	<target name="release" depends="CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
+	<target name="release" depends="CW-PPC2003,CW-PPC2003-CAB,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
 		<echo message="packages for all platforms are now in ${pkg.dir}"/>
 	</target>
+
+	<target name="CW-PPC2003-CAB" depends="CW-PPC2003,compilecabhelper" description="package PPC2003 build as CAB" if="build.cab">
+		<delete dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}"/>
+		<java classname="build.CabHelper" classpath="bin">
+			<arg value="${pkg.dir}/CacheWolf-PPC2003.zip"/>
+			<arg value="${assemble.dir}"/>
+		</java>
+		<cab cabfile="${pkg.dir}/CacheWolf-PPC2003.cab" basedir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}"/>
+	</target>
 	
 	<target name="CW-ARM" depends="ewebuild" description="package ARM release of CacheWolf">
 		<mkdir dir="${assemble.dir}"/>
@@ -225,7 +236,7 @@
 			<fileset dir="resources/attributes"/>
 		</copy>
 		<!-- copy addons -->
-		<copy todir="${assemble.dir}/addons">
+		<copy todir="${assemble.dir}">
 			<fileset dir="res_noewe">
 				<include name="Garmin*.zip"/>
 				<include name="POI*.zip"/>
@@ -240,4 +251,16 @@
 		<!-- spider.def -->
 		<copy todir="${assemble.dir}" file="res_noewe/spider.def"/>
 	</target>
+
+	<target name="compilecabhelper" description="helper classes for building cabs" if="build.cab">
+		<mkdir dir="${classes.dir}"/>
+		<javac
+			source="1.5" 
+			target="1.5" 
+			encoding="windows-1252"
+			destdir="${classes.dir}"
+			srcdir="src"
+			includes="build/*.java"
+		/>
+	</target>
 </project>



From mik77 at mail.berlios.de  Wed Mar 18 07:49:04 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 18 Mar 2009 07:49:04 +0100
Subject: [Cachewolf-svn] r1715 - trunk/src/exp
Message-ID: <200903180649.n2I6n4dK015150@sheep.berlios.de>

Author: mik77
Date: 2009-03-18 07:49:02 +0100 (Wed, 18 Mar 2009)
New Revision: 1715

Modified:
   trunk/src/exp/LocExporter.java
Log:
Don't add short details to name when already in waypoint

Modified: trunk/src/exp/LocExporter.java
===================================================================
--- trunk/src/exp/LocExporter.java	2009-03-17 22:27:19 UTC (rev 1714)
+++ trunk/src/exp/LocExporter.java	2009-03-18 06:49:02 UTC (rev 1715)
@@ -54,9 +54,11 @@
 		strBuf.append("\"><![CDATA[");
 		strBuf.append(simplifyString(chD.CacheName));
 		if (Global.getPref().addDetailsToName) {
-			strBuf.append( getShortDetails( chD ) );
+			if ( !Global.getPref().addDetailsToWaypoint ) {
+				strBuf.append( getShortDetails( chD ) );
+			}
 			if ( (!chD.Hints.equals("null")) && (chD.Hints.length() > 0) ) {
-				strBuf.append("H:");
+				strBuf.append(":");
 				strBuf.append( simplifyString(Common.rot13(chD.Hints)) );			
 			}
 		}



From silas at mail.berlios.de  Wed Mar 18 21:32:32 2009
From: silas at mail.berlios.de (silas at mail.berlios.de)
Date: Wed, 18 Mar 2009 21:32:32 +0100
Subject: [Cachewolf-svn] r1716 - trunk/src/CacheWolf
Message-ID: <200903182032.n2IKWWKF013808@sheep.berlios.de>

Author: silas
Date: 2009-03-18 21:32:30 +0100 (Wed, 18 Mar 2009)
New Revision: 1716

Modified:
   trunk/src/CacheWolf/HintLogPanel.java
Log:
improved log rendering performance on internet connected PDAs

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2009-03-18 06:49:02 UTC (rev 1715)
+++ trunk/src/CacheWolf/HintLogPanel.java	2009-03-18 20:32:30 UTC (rev 1716)
@@ -8,6 +8,7 @@
 import ewe.graphics.AniImage;
 import ewe.graphics.ImageDragContext;
 import ewe.graphics.InteractivePanel;
+import ewe.io.File;
 import ewe.sys.*;
 import ewe.fx.Image;
 import ewe.fx.Rect;
@@ -92,7 +93,7 @@
 		int logsPerPage=Global.getPref().logsPerPage;
 		for(int i = crntLogPosition; i<nLogs; i++){
 			dummy.append(currCache.CacheLogs.getLog(i).toHtml());
-			dummy.append("</br>");
+			dummy.append("<br>");
 			if(++counter >= logsPerPage) break;
 		}
 		clearOutput();
@@ -100,7 +101,11 @@
 		// The cache GCP0T6 crashes the HtmlDisplay
 		// As a temporary fix
 		try {
-			logs.setHtml(dummy.toString());
+			logs.startHtml();
+			// set documentroot to prevent html renderer from loading remote images
+			logs.getDecoderProperties().set("documentroot", File.getProgramDirectory());
+			logs.addHtml(dummy.toString(), new ewe.sys.Handle());
+			logs.endHtml();
 		} catch (Exception e) {
 			logs=new HtmlDisplay();
 			Global.getPref().log("Error rendering HTML",e,true);



From greiol at mail.berlios.de  Wed Mar 18 22:52:29 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 18 Mar 2009 22:52:29 +0100
Subject: [Cachewolf-svn] r1717 - trunk/src/build
Message-ID: <200903182152.n2ILqTb3025815@sheep.berlios.de>

Author: greiol
Date: 2009-03-18 22:52:28 +0100 (Wed, 18 Mar 2009)
New Revision: 1717

Modified:
   trunk/src/build/CabHelper.java
Log:
code cleanup step 1/x
added shortcut to start menu

Modified: trunk/src/build/CabHelper.java
===================================================================
--- trunk/src/build/CabHelper.java	2009-03-18 20:32:30 UTC (rev 1716)
+++ trunk/src/build/CabHelper.java	2009-03-18 21:52:28 UTC (rev 1717)
@@ -7,43 +7,60 @@
 import java.util.zip.*;
 
 public class CabHelper {
-	
+
+	private static final Boolean DEBUG = true;
+	private static final String PROJECT_NAME = "CW-Test";
+	private static final String DOSNL = "\r\n";
+
 	public static void main(String[] args) {
 		File zipFile;
 		File outDir;
 		String outDirName;
 		Integer numDirectories = 0;
 		Integer numFiles = 0;
-		HashMap<String,HashMap<String,String>> cabMapping = new HashMap<String, HashMap<String, String>> ();
+		HashMap<String, HashMap<String, String>> cabMapping = new HashMap<String, HashMap<String, String>>();
+		StringBuffer outBuffer = new StringBuffer();
 		
+		//
+		// check arguments and environment
+		//
+		
 		if (args.length != 2) {
-			throw new IllegalArgumentException("please specify zipfile and output directory");
+			throw new IllegalArgumentException(
+					"please specify zipfile and output directory");
 		}
-		
+
 		zipFile = new File(args[0]);
 		outDirName = args[1];
 		outDir = new File(outDirName);
-		
-		if (! zipFile.exists() || ! zipFile.canRead() || ! zipFile.isFile()) {
+
+		if (!zipFile.exists() || !zipFile.canRead() || !zipFile.isFile()) {
 			throw new IllegalArgumentException("zip file not readable");
 		}
-		
+
 		if (outDir.exists()) {
 			if (outDir.isDirectory()) {
 				String[] files = outDir.list();
 				if (files.length > 0) {
-					throw new IllegalArgumentException("out directory not empty");
+					throw new IllegalArgumentException(
+							"out directory not empty");
 				}
 			} else {
-				throw new IllegalArgumentException("output directory exists, but is not a directory");
+				throw new IllegalArgumentException(
+						"output directory exists, but is not a directory");
 			}
 		} else {
 			boolean success = outDir.mkdir();
 			if (!success) {
-				throw new IllegalArgumentException("unable to create output directory");
+				throw new IllegalArgumentException(
+						"unable to create output directory");
 			}
 		}
 		
+		//
+		// input parsing
+		//
+
 		try {
 			ZipFile zip = new ZipFile(zipFile);
 			Enumeration<? extends ZipEntry> zipList;
@@ -52,33 +69,33 @@
 			while (zipList.hasMoreElements()) {
 				ZipEntry zipEntry = (ZipEntry) zipList.nextElement();
 				if (zipEntry.isDirectory()) {
-					String dirName = zipEntry.getName();
-					dirName = dirName.replace(File.separatorChar, '\\');
-					if (dirName.endsWith("\\")) {
-						dirName = dirName.substring(0, dirName.length()-1);
-					}
+					String dirName = winifyPath(zipEntry.getName());
 					if (cabMapping.get(dirName) == null) {
-						cabMapping.put(dirName, new HashMap <String, String>());
+						cabMapping.put(dirName, new HashMap<String, String>());
 						numDirectories++;
 					}
 				} else {
-					String inFileName = zipEntry.getName().replace(File.separatorChar, '\\');
-					String outFileName = String.format("CW%06d.DMY", numFiles);
+					String inFileName = zipEntry.getName().replace(
+							File.separatorChar, '\\');
+					String outFileName = String.format("%08d.DMY", numFiles);
 					String inDirName = "";
-					copyInputStream(zip.getInputStream(zipEntry), new BufferedOutputStream(new FileOutputStream(outDirName+File.separator+outFileName)));
+					copyInputStream(zip.getInputStream(zipEntry),
+							new BufferedOutputStream(new FileOutputStream(
+									outDirName + File.separator + outFileName)));
 					Integer lastSlash = inFileName.lastIndexOf('\\');
 					if (lastSlash == -1) {
 						inDirName = "";
 					} else {
-						inDirName = inFileName.substring(0,lastSlash);
-						inFileName = inFileName.substring(lastSlash+1);
+						inDirName = inFileName.substring(0, lastSlash);
+						inFileName = inFileName.substring(lastSlash + 1);
 					}
 					if (cabMapping.get(inDirName) == null) {
-						cabMapping.put(inDirName, new HashMap <String, String>());
+						cabMapping
+								.put(inDirName, new HashMap<String, String>());
 						numDirectories++;
 					}
 					cabMapping.get(inDirName).put(outFileName, inFileName);
-										
+
 					numFiles++;
 				}
 			}
@@ -87,55 +104,168 @@
 			System.exit(1);
 		}
 		
-		StringBuffer outBuffer = new StringBuffer();
-		String dosNL = "\r\n";
-		outBuffer.append("<wap-provisioningdoc>").append(dosNL);
-		outBuffer.append("\t<characteristic type=\"Install\">").append(dosNL);
-		outBuffer.append("\t\t<parm name=\"InstallPhase\" value=\"install\" />").append(dosNL);
-		outBuffer.append("\t\t<parm name=\"AppName\" value=\"CW-test\" />").append(dosNL);
-		outBuffer.append("\t\t<parm name=\"InstallDir\" value=\"%CE1%\\CW-test\" translation=\"install\" />").append(dosNL);
-		outBuffer.append(String.format("\t\t<parm name=\"NumDirs\" value=\"%d\" />",numDirectories)).append(dosNL);
-		outBuffer.append(String.format("\t\t<parm name=\"NumFiles\" value=\"%d\" />",numFiles)).append(dosNL);
-		outBuffer.append("\t\t<parm name=\"NumRegKeys\" value=\"0\" />").append(dosNL);
-		outBuffer.append("\t\t<parm name=\"NumRegVals\" value=\"0\" />").append(dosNL);
-		outBuffer.append("\t\t<parm name=\"NumShortcuts\" value=\"0\" />").append(dosNL);
-		outBuffer.append("\t</characteristic>").append(dosNL);
-		outBuffer.append("\t<characteristic type=\"FileOperation\">").append(dosNL);
-		for ( String outKey : cabMapping.keySet() ) {
-			outBuffer.append(String.format("\t\t<characteristic type=\"%%InstallDir%%\\%s\" translation=\"install\">",outKey)).append(dosNL);
-			outBuffer.append("\t\t\t<characteristic type=\"MakeDir\" />").append(dosNL);
+		//
+		// output generation
+		//
+
+		// header of the xml file, mandatory
+		outBuffer.append("<wap-provisioningdoc>").append(DOSNL);
+		
+		// header section with summary
+		outBuffer.append("\t<characteristic type=\"Install\">").append(DOSNL);
+		outBuffer.append("\t\t<parm name=\"InstallPhase\" value=\"install\" />").append(DOSNL);
+		outBuffer.append(String.format("\t\t<parm name=\"AppName\" value=\"%s\" />",PROJECT_NAME)).append(DOSNL);
+		outBuffer.append(String.format("\t\t<parm name=\"InstallDir\" value=\"%%CE1%%\\%s\" translation=\"install\" />",PROJECT_NAME)).append(DOSNL);
+		outBuffer.append(String.format("\t\t<parm name=\"NumDirs\" value=\"%d\" />",numDirectories)).append(DOSNL);
+		outBuffer.append(String.format("\t\t<parm name=\"NumFiles\" value=\"%d\" />",numFiles)).append(DOSNL);
+		outBuffer.append("\t\t<parm name=\"NumRegKeys\" value=\"0\" />").append(DOSNL);
+		outBuffer.append("\t\t<parm name=\"NumRegVals\" value=\"0\" />").append(DOSNL);
+		outBuffer.append("\t\t<parm name=\"NumShortcuts\" value=\"1\" />").append(DOSNL);
+		outBuffer.append("\t</characteristic>").append(DOSNL);
+		
+		// start of fileoperation section
+		outBuffer.append("\t<characteristic type=\"FileOperation\">").append(DOSNL);
+		
+		for (String outKey : cabMapping.keySet()) {
 			
-			for (String inKey: cabMapping.get(outKey).keySet()) {
-				outBuffer.append(String.format("\t\t\t<characteristic type=\"%s\" translation=\"install\">",cabMapping.get(outKey).get(inKey))).append(dosNL);
-				outBuffer.append("\t\t\t\t<characteristic type=\"Extract\">").append(dosNL);
-				outBuffer.append(String.format("\t\t\t\t\t<parm name=\"Source\" value=\"%s\"/>",inKey)).append(dosNL);
-				outBuffer.append("\t\t\t\t</characteristic>").append(dosNL);
-				outBuffer.append("\t\t\t</characteristic>").append(dosNL);
+			// begin of directory structure
+			outBuffer.append(
+					String.format("\t\t<characteristic type=\"%s\" translation=\"install\">",winifyPath("%InstallDir%\\" + outKey))
+				).append(DOSNL);
+			outBuffer.append("\t\t\t<characteristic type=\"MakeDir\" />").append(DOSNL);
+
+			// iterate through the file entries. file entries must follow the the directory definition 
+			for (String inKey : cabMapping.get(outKey).keySet()) {
+				outBuffer.append(
+						generateCabFileEntry(
+								cabMapping.get(outKey).get(inKey), 
+								inKey
+						)
+				);
 			}
-			outBuffer.append("\t\t</characteristic>").append(dosNL);
+			
+			// end of directory structur
+			outBuffer.append("\t\t</characteristic>").append(DOSNL);
 		}
-		outBuffer.append("\t</characteristic>").append(dosNL);
-		outBuffer.append("</wap-provisioningdoc>").append(dosNL);
+		
+		// add shortcut to start menu
+
+		outBuffer.append("\t\t<characteristic type=\"%CE11%\" translation=\"install\">").append(DOSNL);
+		outBuffer.append("\t\t\t<characteristic type=\"MakeDir\" />").append(DOSNL);
+		outBuffer.append(String.format("\t\t\t<characteristic type=\"%s.lnk\" translation=\"install\">", PROJECT_NAME)).append(DOSNL);
+		outBuffer.append("\t\t\t\t<characteristic type=\"Shortcut\">").append(DOSNL);
+		outBuffer.append("\t\t\t\t\t<parm name=\"Source\" value=\"%InstallDir%\\CacheWolf.exe\" translation=\"install\" />").append(DOSNL);
+		outBuffer.append("\t\t\t\t</characteristic>").append(DOSNL);
+		outBuffer.append("\t\t\t</characteristic>").append(DOSNL);
+		outBuffer.append("\t\t</characteristic>").append(DOSNL);
+
+		// end of fileoperation section
+		outBuffer.append("\t</characteristic>").append(DOSNL);
+
+		// add favorite to internet explorer
+/*
+		// does not work yet, since %InstallDir% is not expanded correctly :-(
+		outBuffer.append("\t<characteristic type=\"BrowserFavorite\">").append(DOSNL);
+		outBuffer.append(String.format("\t\t<characteristic type=\"%s local\">", PROJECT_NAME)).append(DOSNL);
+		outBuffer.append("\t\t\t<parm name=\"URL\" value=\"file://%InstallDir%\\temp.html\"/>").append(DOSNL);
+		outBuffer.append("\t\t</characteristic>").append(DOSNL);
+		outBuffer.append("\t</characteristic>").append(DOSNL);
+*/
+
+		// footer of the xml file, mandatory
+		outBuffer.append("</wap-provisioningdoc>").append(DOSNL);
+
+		//
+		// store output to file
+		//
+
 		try {
-			BufferedOutputStream outStream = new BufferedOutputStream(new FileOutputStream(outDirName+File.separator+"_setup.xml"));
+			
+			BufferedOutputStream outStream = new BufferedOutputStream(
+					new FileOutputStream(
+							outDirName + File.separator + "_setup.xml"
+					)
+			);
 			outStream.write(outBuffer.toString().getBytes());
 			outStream.flush();
 			outStream.close();
+			
 		} catch (Exception e) {
+			
 			e.printStackTrace();
 			System.exit(1);
+			
 		}
 	}
-	
-	public static final void copyInputStream(InputStream in, OutputStream out) throws IOException {
+
+	/**
+	 * copies content of a given input stream to a given output stream
+	 * 
+	 * @param in input stream
+	 * @param out output stream
+	 * @throws IOException
+	 */
+	private static final void copyInputStream(InputStream in, OutputStream out)	throws IOException {
 		byte[] buffer = new byte[1024];
 		int len;
 
-		while((len = in.read(buffer)) >= 0) {
+		while ((len = in.read(buffer)) >= 0) {
 			out.write(buffer, 0, len);
 		}
-		
+
 		in.close();
 		out.close();
 	}
+	
+	/**
+	 * generate the XML snippet that represents a file for the CAB
+	 * 
+	 * @param original filename that will later be seen in the PocktPC file system
+	 * @param translated safe 8.3 noted filename stored inside the CAB
+	 * @return characteristic structure for including a file in an installable PocketPC CAB
+	 */
+	private static final String generateCabFileEntry(String original, String translated) {
+		StringBuffer retBuffer = new StringBuffer();
+		
+		retBuffer.append(String.format("\t\t\t<characteristic type=\"%s\" translation=\"install\">",original)).append(DOSNL);
+		retBuffer.append("\t\t\t\t<characteristic type=\"Extract\">").append(DOSNL);
+		retBuffer.append(String.format("\t\t\t\t\t<parm name=\"Source\" value=\"%s\"/>",translated)).append(DOSNL);
+		retBuffer.append("\t\t\t\t</characteristic>").append(DOSNL);
+		retBuffer.append("\t\t\t</characteristic>").append(DOSNL);
+
+		return retBuffer.toString();
+	}
+	
+	/**
+	 * generate a path information from the given paramter suitable for usage in
+	 * a cab file this includes converting all separators from the current os (/
+	 * or \)to the format later used by the PocketPC (\) and cutting of any
+	 * leading or trainling \
+	 * 
+	 * @param path
+	 *            path to normalize for use in cab
+	 * @return normalized path
+	 */
+	private static final String winifyPath(String path) {
+			path = path.replace(File.separatorChar, '\\');
+		if (path.indexOf('\\') == 0) {
+			path = path.substring(1);
+		}
+		if (path.lastIndexOf('\\') == path.length() - 1) {
+			path = path.substring(0, path.length() - 1);
+		}
+		return path;
+	}
+	
+	/**
+	 * mostly for my convenience so I won't have to search for all the System.out.println
+	 * to disable debug output
+	 * 
+	 * @param str string to log
+	 */
+	private static final void log(String str) {
+		if (DEBUG) {
+			System.out.println(str);
+		}
+	}
 }



From mik77 at mail.berlios.de  Thu Mar 19 09:18:01 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 19 Mar 2009 09:18:01 +0100
Subject: [Cachewolf-svn] r1718 - trunk/src/CacheWolf
Message-ID: <200903190818.n2J8I1vj004431@sheep.berlios.de>

Author: mik77
Date: 2009-03-19 09:17:53 +0100 (Thu, 19 Mar 2009)
New Revision: 1718

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
 - additional debug output removed. If you want all log messages as console output, please set the debug pref.

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-03-18 21:52:28 UTC (rev 1717)
+++ trunk/src/CacheWolf/Preferences.java	2009-03-19 08:17:53 UTC (rev 1718)
@@ -681,7 +681,6 @@
 	 * @param text to log
 	 */
 	public void log(String text){
-		Vm.debug(text);
 		Time dtm = new Time();
 		dtm.getTime();
 		dtm.setFormat("dd.MM.yyyy'/'HH:mm");



From greiol at mail.berlios.de  Thu Mar 19 20:42:05 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 19 Mar 2009 20:42:05 +0100
Subject: [Cachewolf-svn] r1719 - trunk
Message-ID: <200903191942.n2JJg5MW028124@sheep.berlios.de>

Author: greiol
Date: 2009-03-19 20:42:04 +0100 (Thu, 19 Mar 2009)
New Revision: 1719

Modified:
   trunk/build.xml
Log:
make cab build fail if cap structure could no be set up properly

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-19 08:17:53 UTC (rev 1718)
+++ trunk/build.xml	2009-03-19 19:42:04 UTC (rev 1719)
@@ -53,7 +53,7 @@
 	<target name="CW-PPC2003-CAB" depends="CW-PPC2003,compilecabhelper" description="package PPC2003 build as CAB" if="build.cab">
 		<delete dir="${assemble.dir}"/>
 		<mkdir dir="${assemble.dir}"/>
-		<java classname="build.CabHelper" classpath="bin">
+		<java classname="build.CabHelper" classpath="bin" failonerror="true">
 			<arg value="${pkg.dir}/CacheWolf-PPC2003.zip"/>
 			<arg value="${assemble.dir}"/>
 		</java>



From greiol at mail.berlios.de  Thu Mar 19 21:57:58 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 19 Mar 2009 21:57:58 +0100
Subject: [Cachewolf-svn] r1720 - trunk/src/build
Message-ID: <200903192057.n2JKvwcl006222@sheep.berlios.de>

Author: greiol
Date: 2009-03-19 21:57:54 +0100 (Thu, 19 Mar 2009)
New Revision: 1720

Modified:
   trunk/src/build/CabHelper.java
Log:
code cleanup 2/x
added stub to fix version warning at install time, but need more input
add empty log file, so it will be removed with package. prefs.xml still stays in directory

Modified: trunk/src/build/CabHelper.java
===================================================================
--- trunk/src/build/CabHelper.java	2009-03-19 19:42:04 UTC (rev 1719)
+++ trunk/src/build/CabHelper.java	2009-03-19 20:57:54 UTC (rev 1720)
@@ -11,14 +11,15 @@
 	private static final Boolean DEBUG = true;
 	private static final String PROJECT_NAME = "CW-Test";
 	private static final String DOSNL = "\r\n";
+	
+	private static HashMap<String, HashMap<String, String>> cabMapping = new HashMap<String, HashMap<String, String>>();
+	private static Integer numFiles = 0;
+	private static Integer numDirectories = 0;
 
 	public static void main(String[] args) {
 		File zipFile;
 		File outDir;
 		String outDirName;
-		Integer numDirectories = 0;
-		Integer numFiles = 0;
-		HashMap<String, HashMap<String, String>> cabMapping = new HashMap<String, HashMap<String, String>>();
 		StringBuffer outBuffer = new StringBuffer();
 		
 		//
@@ -67,35 +68,30 @@
 			zipList = zip.entries();
 
 			while (zipList.hasMoreElements()) {
+				
 				ZipEntry zipEntry = (ZipEntry) zipList.nextElement();
+				
 				if (zipEntry.isDirectory()) {
 					String dirName = winifyPath(zipEntry.getName());
-					if (cabMapping.get(dirName) == null) {
-						cabMapping.put(dirName, new HashMap<String, String>());
-						numDirectories++;
-					}
+					pushDirToMap(winifyPath(dirName));
 				} else {
-					String inFileName = zipEntry.getName().replace(
-							File.separatorChar, '\\');
-					String outFileName = String.format("%08d.DMY", numFiles);
-					String inDirName = "";
+					String inCabFileName;
+					String outCabFileName;
+					String inCabDirName;
+					File dummyFile;
+					
+					dummyFile = new File(zipEntry.getName());
+					
+					inCabFileName = dummyFile.getName();
+					inCabDirName = pushDirToMap(winifyPath(dummyFile.getParent()));
+					outCabFileName = String.format("%08d.DMY", numFiles);
+					
 					copyInputStream(zip.getInputStream(zipEntry),
 							new BufferedOutputStream(new FileOutputStream(
-									outDirName + File.separator + outFileName)));
-					Integer lastSlash = inFileName.lastIndexOf('\\');
-					if (lastSlash == -1) {
-						inDirName = "";
-					} else {
-						inDirName = inFileName.substring(0, lastSlash);
-						inFileName = inFileName.substring(lastSlash + 1);
-					}
-					if (cabMapping.get(inDirName) == null) {
-						cabMapping
-								.put(inDirName, new HashMap<String, String>());
-						numDirectories++;
-					}
-					cabMapping.get(inDirName).put(outFileName, inFileName);
+									outDirName + File.separator + outCabFileName)));
 
+					cabMapping.get(inCabDirName).put(outCabFileName, inCabFileName);
+
 					numFiles++;
 				}
 			}
@@ -104,6 +100,17 @@
 			System.exit(1);
 		}
 		
+		// create an empty logfile and push it on the stack
+		try {
+			File dummyFile = new File(outDirName + File.separator + String.format("%08d.DMY", numFiles));
+			dummyFile.createNewFile();
+			cabMapping.get("").put(String.format("%08d.DMY", numFiles), "log.txt");
+			numFiles++;
+		} catch (Exception e) {
+			e.printStackTrace();
+			System.exit(1);
+		}
+
 		//
 		// output generation
 		//
@@ -114,6 +121,11 @@
 		// header section with summary
 		outBuffer.append("\t<characteristic type=\"Install\">").append(DOSNL);
 		outBuffer.append("\t\t<parm name=\"InstallPhase\" value=\"install\" />").append(DOSNL);
+/*
+		// this should remove the version warning at the end of the cab install, but we need more input
+                outBuffer.append("\t\t<parm name=\"OSVersionMin\" value=\"1.0\" />").append(DOSNL);
+                outBuffer.append("\t\t<parm name=\"OSVersionMax\" value=\"6.99\" />").append(DOSNL);
+*/
 		outBuffer.append(String.format("\t\t<parm name=\"AppName\" value=\"%s\" />",PROJECT_NAME)).append(DOSNL);
 		outBuffer.append(String.format("\t\t<parm name=\"InstallDir\" value=\"%%CE1%%\\%s\" translation=\"install\" />",PROJECT_NAME)).append(DOSNL);
 		outBuffer.append(String.format("\t\t<parm name=\"NumDirs\" value=\"%d\" />",numDirectories)).append(DOSNL);
@@ -242,12 +254,14 @@
 	 * or \)to the format later used by the PocketPC (\) and cutting of any
 	 * leading or trainling \
 	 * 
-	 * @param path
-	 *            path to normalize for use in cab
+	 * @param path path to normalize for use in cab
 	 * @return normalized path
 	 */
 	private static final String winifyPath(String path) {
-			path = path.replace(File.separatorChar, '\\');
+		if (path == null) {
+			return "";
+		}
+		path = path.replace(File.separatorChar, '\\');
 		if (path.indexOf('\\') == 0) {
 			path = path.substring(1);
 		}
@@ -268,4 +282,24 @@
 			System.out.println(str);
 		}
 	}
+	
+	/**
+	 * check if a given directory already is a key in cabMapping
+	 * if directory is not a key yet, put it on the map and
+	 * associate an empty hashmap to it
+	 *
+	 * @param directory name of directory that was pushed to the map
+	 */
+	private static final String pushDirToMap(String directory) {
+		if ( directory == null ) {
+			directory = "";
+		}
+		
+		if (cabMapping.get(directory) == null) {
+			cabMapping.put(directory, new HashMap<String, String>());
+			numDirectories++;
+		}
+		
+		return directory;
+	}
 }



From araber95 at mail.berlios.de  Fri Mar 20 01:02:05 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 20 Mar 2009 01:02:05 +0100
Subject: [Cachewolf-svn] r1721 - trunk/src/CacheWolf/navi
Message-ID: <200903200002.n2K0258C025427@sheep.berlios.de>

Author: araber95
Date: 2009-03-20 01:01:48 +0100 (Fri, 20 Mar 2009)
New Revision: 1721

Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
Nach dem Download von Karten wird das Baisverzeichnis f??r die Karten auf den kleinsten gemeinsamen Nenner gebracht. Wenn nicht, dann das wohin die Karten gerade geladen wurden.
Former mappath will be merged with the latest maps download path.

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-19 20:57:54 UTC (rev 1720)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-20 00:01:48 UTC (rev 1721)
@@ -173,10 +173,39 @@
 
 	public String getMapsDir() {
 		String ret = Global.getPref().getMapDownloadSavePath(mapLoader.currentOnlineMapService.getMapType());
-		Global.getPref().saveCustomMapsPath(ret);
+		Global.getPref().saveCustomMapsPath(getEqualLeadingPathSubString(ret,Global.getPref().getMapLoadPath()));
+		// Global.getPref().saveCustomMapsPath(ret);
+		// eigentlich d?rft das erst gespeichert werden, wenn erfolgreich heruntergeladen wurde
 		return ret;
 	}
-
+	
+	private String getEqualLeadingPathSubString(String neu , String alt) {
+		String gemeinsam=null;
+		int j=neu.length();
+		int k=alt.length();
+		if (k<j) {j=k;};
+		if (neu.substring(0,j).equals(alt.substring(0, j))) {
+			gemeinsam = neu.substring(0,j);
+		}
+		else {
+			boolean istKeinTeilstring = true;
+			// res erh?lt nur einen neuen Wert, wenn sich beide Strings bis zur Stelle j unterscheiden
+			for (int i = 0; i < j; i++) {
+				if (neu.charAt(i) != (alt.charAt(i))) {
+					gemeinsam=neu.substring(0,i);
+					k=gemeinsam.lastIndexOf("/"); // das Verzeichnis-Trennzeichen bei Java und ?
+					gemeinsam=gemeinsam.substring(0,k+1); // falls die letzten Verzeichnisse gleich beginnen
+					i=j;
+					istKeinTeilstring = false;
+	 			}		
+			}
+			if (istKeinTeilstring) {
+				gemeinsam=neu; // der neue Pfad
+			}
+		}
+		return gemeinsam;
+	}
+	
 	public void downloadTiles() {
 		String mapsDir = getMapsDir();
 		if (mapsDir == null) return;



From greiol at mail.berlios.de  Fri Mar 20 07:42:06 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 20 Mar 2009 07:42:06 +0100
Subject: [Cachewolf-svn] r1722 - trunk/src/build
Message-ID: <200903200642.n2K6g6mt020801@sheep.berlios.de>

Author: greiol
Date: 2009-03-20 07:42:05 +0100 (Fri, 20 Mar 2009)
New Revision: 1722

Modified:
   trunk/src/build/CabHelper.java
Log:
hopefully the os warning for the cab will now be gone. but it will work even with the warning

Modified: trunk/src/build/CabHelper.java
===================================================================
--- trunk/src/build/CabHelper.java	2009-03-20 00:01:48 UTC (rev 1721)
+++ trunk/src/build/CabHelper.java	2009-03-20 06:42:05 UTC (rev 1722)
@@ -121,11 +121,10 @@
 		// header section with summary
 		outBuffer.append("\t<characteristic type=\"Install\">").append(DOSNL);
 		outBuffer.append("\t\t<parm name=\"InstallPhase\" value=\"install\" />").append(DOSNL);
-/*
-		// this should remove the version warning at the end of the cab install, but we need more input
-                outBuffer.append("\t\t<parm name=\"OSVersionMin\" value=\"1.0\" />").append(DOSNL);
-                outBuffer.append("\t\t<parm name=\"OSVersionMax\" value=\"6.99\" />").append(DOSNL);
-*/
+		// this should remove the version warning at the end of the cab install 
+		// but even with a warning it will work
+		outBuffer.append("\t\t<parm name=\"OSVersionMin\" value=\"4.0\" />").append(DOSNL);
+		outBuffer.append("\t\t<parm name=\"OSVersionMax\" value=\"5.9\" />").append(DOSNL);
 		outBuffer.append(String.format("\t\t<parm name=\"AppName\" value=\"%s\" />",PROJECT_NAME)).append(DOSNL);
 		outBuffer.append(String.format("\t\t<parm name=\"InstallDir\" value=\"%%CE1%%\\%s\" translation=\"install\" />",PROJECT_NAME)).append(DOSNL);
 		outBuffer.append(String.format("\t\t<parm name=\"NumDirs\" value=\"%d\" />",numDirectories)).append(DOSNL);



From greiol at mail.berlios.de  Fri Mar 20 08:04:34 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 20 Mar 2009 08:04:34 +0100
Subject: [Cachewolf-svn] r1723 - trunk
Message-ID: <200903200704.n2K74Ymb029846@sheep.berlios.de>

Author: greiol
Date: 2009-03-20 08:04:33 +0100 (Fri, 20 Mar 2009)
New Revision: 1723

Modified:
   trunk/build.xml
Log:
added information about command line switches for build

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-20 06:42:05 UTC (rev 1722)
+++ trunk/build.xml	2009-03-20 07:04:33 UTC (rev 1723)
@@ -1,5 +1,29 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no"?>
 <project name="CacheWolf" default="release">
+	
+	<!--
+		This is the ant (http://ant.apache.org/) build file for CacheWolf
+		
+		Arguments:
+			-Dbuild.version=integer
+					source code version covered by the build. of "official" builds this shoul be the
+					svn revision number
+					Default: todays date (YYYYMMDD)
+			
+			-Dbuild.type=interger
+					see src/CacheWolf/Version.kava VERSION_TYPES for valid values
+					Default: 3 (InDevelopmentNewest)
+			
+			-Dbuild.cab=true
+					also build a cab version from the PPC2003 zip file. 
+					Default: do not build it
+					make sure to check the prerequisites on http://ant.apache.org/manual/OptionalTasks/cab.html
+					
+		futher information about ant can be found at
+			http://ant.apache.org/manual/
+			http://help.eclipse.org/help33/topic/org.eclipse.platform.doc.user/gettingStarted/qs-81_basics.htm
+			or check one of the many ant tutorials on the web
+	-->
 
 	<!-- ewe builder only exist for windows and linux -->
 	<fail message="unsupport operating system. sorry">



From mik77 at mail.berlios.de  Sat Mar 21 16:45:56 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 21 Mar 2009 16:45:56 +0100
Subject: [Cachewolf-svn] r1724 - trunk/res_noewe/languages
Message-ID: <200903211545.n2LFjuBZ008601@sheep.berlios.de>

Author: mik77
Date: 2009-03-21 16:45:54 +0100 (Sat, 21 Mar 2009)
New Revision: 1724

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
Log:
Some strings shortened.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-03-20 07:04:33 UTC (rev 1723)
+++ trunk/res_noewe/languages/DE.cfg	2009-03-21 15:45:54 UTC (rev 1724)
@@ -203,11 +203,11 @@
 		636=OC Empfehlungen
 		637=OC Index
 		638=Bilder in Beschreibung anzeigen
-		639=Caches beim Spidern aktualisieren?
+		639=Beim Spidern aktualisieren?
 		640=Ja
 		641=Nein
 		642=Nachfragen
-		643=Cachedetails anh%e4ngen an:
+		643=Cachedetails in:
 		644=Wegpunkt
 		645=Name
 		700=Filter setzen

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-03-20 07:04:33 UTC (rev 1723)
+++ trunk/res_noewe/languages/EN.cfg	2009-03-21 15:45:54 UTC (rev 1724)
@@ -203,11 +203,11 @@
 		636=OC Recs
 		637=OC Index
 		638=Show pictures in description
-		639=Update caches when spidering?
+		639=Update when spidering?
 		640=Yes
 		641=No
 		642=Ask
-		643=Append cache details to:
+		643=Cache details in:
 		644=waypoint
 		645=name
 		700=Set filter



From engywuck at mail.berlios.de  Sun Mar 22 09:14:27 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 22 Mar 2009 09:14:27 +0100
Subject: [Cachewolf-svn] r1725 - trunk
Message-ID: <200903220814.n2M8ERVJ029634@sheep.berlios.de>

Author: engywuck
Date: 2009-03-22 09:14:25 +0100 (Sun, 22 Mar 2009)
New Revision: 1725

Modified:
   trunk/.classpath
Log:
Excluding folger *build* from source path, because class CabHelper is not needed within CacheWolf and subject to compile problems.

Modified: trunk/.classpath
===================================================================
--- trunk/.classpath	2009-03-21 15:45:54 UTC (rev 1724)
+++ trunk/.classpath	2009-03-22 08:14:25 UTC (rev 1725)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <classpath>
-	<classpathentry kind="src" path="src"/>
+	<classpathentry excluding="build/" kind="src" path="src"/>
 	<classpathentry kind="lib" path="lib/CompileEwe.zip" sourcepath="lib/JavaEwe.zip"/>
 	<classpathentry kind="lib" path="lib"/>
 	<classpathentry kind="output" path="bin"/>



From araber95 at mail.berlios.de  Sun Mar 22 15:44:43 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 22 Mar 2009 15:44:43 +0100
Subject: [Cachewolf-svn] r1726 - trunk/src/CacheWolf/navi
Message-ID: <200903221444.n2MEihn0014979@sheep.berlios.de>

Author: araber95
Date: 2009-03-22 15:44:30 +0100 (Sun, 22 Mar 2009)
New Revision: 1726

Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
Code changed for quality reason, doing the same as the last commit (get leading path)

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-22 08:14:25 UTC (rev 1725)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-03-22 14:44:30 UTC (rev 1726)
@@ -173,37 +173,28 @@
 
 	public String getMapsDir() {
 		String ret = Global.getPref().getMapDownloadSavePath(mapLoader.currentOnlineMapService.getMapType());
-		Global.getPref().saveCustomMapsPath(getEqualLeadingPathSubString(ret,Global.getPref().getMapLoadPath()));
+		Global.getPref().saveCustomMapsPath(getLeadingPath(ret,Global.getPref().getMapLoadPath()));
 		// Global.getPref().saveCustomMapsPath(ret);
 		// eigentlich d?rft das erst gespeichert werden, wenn erfolgreich heruntergeladen wurde
 		return ret;
 	}
-	
-	private String getEqualLeadingPathSubString(String neu , String alt) {
-		String gemeinsam=null;
-		int j=neu.length();
-		int k=alt.length();
-		if (k<j) {j=k;};
-		if (neu.substring(0,j).equals(alt.substring(0, j))) {
-			gemeinsam = neu.substring(0,j);
-		}
-		else {
-			boolean istKeinTeilstring = true;
-			// res erh?lt nur einen neuen Wert, wenn sich beide Strings bis zur Stelle j unterscheiden
-			for (int i = 0; i < j; i++) {
-				if (neu.charAt(i) != (alt.charAt(i))) {
-					gemeinsam=neu.substring(0,i);
-					k=gemeinsam.lastIndexOf("/"); // das Verzeichnis-Trennzeichen bei Java und ?
-					gemeinsam=gemeinsam.substring(0,k+1); // falls die letzten Verzeichnisse gleich beginnen
-					i=j;
-					istKeinTeilstring = false;
-	 			}		
+
+	private String getLeadingPath(String newPath , String oldPath) {
+		String LeadingPath="";
+		int StartPos=0;
+		int EndPos;
+		int LastPos = java.lang.Math.min(newPath.length(),oldPath.length());
+		do {
+			EndPos=newPath.indexOf("/", StartPos);
+			if (newPath.substring(StartPos,EndPos).equals(oldPath.substring(StartPos, EndPos))) {
+				LeadingPath=LeadingPath.concat(newPath.substring(StartPos,EndPos+1));
+				StartPos=EndPos+1;
 			}
-			if (istKeinTeilstring) {
-				gemeinsam=neu; // der neue Pfad
+			else {
+				break;
 			}
-		}
-		return gemeinsam;
+		} while (StartPos<LastPos);
+		return LeadingPath;
 	}
 	
 	public void downloadTiles() {



From admin at berlios.de  Mon Mar 23 15:21:42 2009
From: admin at berlios.de (admin at berlios.de)
Date: Mon, 23 Mar 2009 15:21:42 +0100 (CET)
Subject: [Bug #15427] Speichermglichkeit fr Filter und Zentrumspunkte
Message-ID: <200903231421.n2NELgig029597@unicorn.berlios.de>

Bug #15427, was updated on 2009-Mar-23 15:21
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Other
Status: Open
Resolution: None
Bug Group: Feature Request
Priority: 5
Submitted by: toje
Assigned to : none
Summary: Speicherm?glichkeit f?r Filter und Zentrumspunkte

Details: Es w?re nett, wenn es eine Speicherm?glichkeit f?r Filter (idealerweise auf Wunsch gemeinsam mit dem jeweils eingestellten Zentrumspunkt) g?be. Ich habe mehrere unterschiedliche "Cachestandorte" (Wohnung, Arbeitsstelle, Wochenendaufenthalt) mit unterschiedlichen Pr?ferenzen, was Cachemerkmale angeht, und es ist etwas l?stig, jeweils den Filter komplett per Hand ?ndern zu m?ssen.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15427&group_id=2211


From greiol at mail.berlios.de  Mon Mar 23 19:48:43 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 23 Mar 2009 19:48:43 +0100
Subject: [Cachewolf-svn] r1727 - trunk
Message-ID: <200903231848.n2NImhrP007796@sheep.berlios.de>

Author: greiol
Date: 2009-03-23 19:48:41 +0100 (Mon, 23 Mar 2009)
New Revision: 1727

Modified:
   trunk/build.xml
Log:
introduced ewe.progdir since ewe.exe and ewecl use different output directories 

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-03-22 14:44:30 UTC (rev 1726)
+++ trunk/build.xml	2009-03-23 18:48:41 UTC (rev 1727)
@@ -36,6 +36,11 @@
 			</not>
 		</condition>
 	</fail>
+	
+	<!-- seems the ewe compiler uses different paths on windows and linux :-( -->
+	<condition property="ewe.progdir" value="CacheWolf" else="programs/CacheWolf" >
+		<os family="windows"/>
+	</condition>
 
 	<!-- TODO: find out how to get svn revision information platform independent. -->
 	<!-- TODO: especially since svnversion would give better information if current directory is up to date -->
@@ -92,7 +97,7 @@
 
 		<antcall target="copyres"/>
 
-		<copy file="programs/CacheWolf/PocketPC-ARM/CacheWolf.exe" todir="${assemble.dir}"/>
+		<copy file="${ewe.progdir]/PocketPC-ARM/CacheWolf.exe" todir="${assemble.dir}"/>
 		<zip destfile="${pkg.dir}/CacheWolf-ARM.zip" basedir="${assemble.dir}"/>
 
 		<delete dir="${assemble.dir}"/>
@@ -105,7 +110,7 @@
 
 		<antcall target="copyres"/>
 
-		<copy file="programs/CacheWolf/PocketPC-MIPS/CacheWolf.exe" todir="${assemble.dir}"/>
+		<copy file="${ewe.progdir}/PocketPC-MIPS/CacheWolf.exe" todir="${assemble.dir}"/>
 		<zip destfile="${pkg.dir}/CacheWolf-MIPS.zip" basedir="${assemble.dir}"/>
 
 		<delete dir="${assemble.dir}"/>
@@ -116,7 +121,7 @@
 
 		<mkdir dir="${pkg.dir}"/>
 
-		<copy file="programs/CacheWolf/PocketPC-SH3/CacheWolf.exe" todir="${assemble.dir}"/>
+		<copy file="${ewe.progdir}/PocketPC-SH3/CacheWolf.exe" todir="${assemble.dir}"/>
 		<antcall target="copyres"/>
 
 		<zip destfile="${pkg.dir}/CacheWolf-SH3.zip" basedir="${assemble.dir}"/>
@@ -129,7 +134,7 @@
 
 		<mkdir dir="${pkg.dir}"/>
 
-		<copy file="programs/CacheWolf/PocketPC2003/CacheWolf.exe" todir="${assemble.dir}"/>
+		<copy file="${ewe.progdir}/PocketPC2003/CacheWolf.exe" todir="${assemble.dir}"/>
 		<!-- copy big attributes -->
 		<copy todir="${assemble.dir}/attributes-big">
 			<fileset dir="resources/attributes-big"/>
@@ -159,7 +164,7 @@
 
 		<mkdir dir="${pkg.dir}"/>
 
-		<copy file="programs/CacheWolf/x86-Win32-StaticLinked/CacheWolf.exe" todir="${assemble.dir}"/>
+		<copy file="${ewe.progdir}/x86-Win32-StaticLinked/CacheWolf.exe" todir="${assemble.dir}"/>
 		<antcall target="copyres"/>
 
 		<zip destfile="${pkg.dir}/CacheWolf-Win32.zip" basedir="${assemble.dir}"/>
@@ -170,7 +175,7 @@
 	<target name="CW-Java" depends="ewebuild" description="package Java release of CacheWolf">
 		<mkdir dir="${assemble.dir}"/>
 
-		<copy file="programs/CacheWolf/Jar/CacheWolf.jar" todir="${assemble.dir}"/>
+		<copy file="${ewe.progdir}/Jar/CacheWolf.jar" todir="${assemble.dir}"/>
 		<copy file="lib/java_ewe.dll" todir="${assemble.dir}"/>
 		<copy file="docs/cachewolf.svg" todir="${assemble.dir}"/>
 		<antcall target="copyres"/>
@@ -189,15 +194,18 @@
 		</exec>
 		<exec executable="programs/ewecl" os="Linux">
 			<arg value="programs/Jewel.ewe"/>
-			<arg value="-c cw-pc.jnf"/>
+			<arg value="-c"/>
+			<arg value="cw-pc.jnf"/>
 		</exec>
 		<exec executable="programs/ewe.exe" osfamily="windows">
 			<arg value="programs/Jewel.ewe"/>
-			<arg value="-c cw-pda.jnf"/>
+			<arg value="-c"/>
+			<arg value="cw-pda.jnf"/>
 		</exec>
 		<exec executable="programs/ewe.exe" osfamily="windows">
 			<arg value="programs/Jewel.ewe"/>
-			<arg value="-c cw-pc.jnf"/>
+			<arg value="-c" />
+			<arg value="cw-pc.jnf"/>
 		</exec>
 	</target>
 	



From greiol at mail.berlios.de  Mon Mar 23 20:32:44 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 23 Mar 2009 20:32:44 +0100
Subject: [Cachewolf-svn] r1728 - trunk/src/build
Message-ID: <200903231932.n2NJWiJE013070@sheep.berlios.de>

Author: greiol
Date: 2009-03-23 20:32:43 +0100 (Mon, 23 Mar 2009)
New Revision: 1728

Modified:
   trunk/src/build/CabHelper.java
Log:


Modified: trunk/src/build/CabHelper.java
===================================================================
--- trunk/src/build/CabHelper.java	2009-03-23 18:48:41 UTC (rev 1727)
+++ trunk/src/build/CabHelper.java	2009-03-23 19:32:43 UTC (rev 1728)
@@ -1,6 +1,7 @@
 package build;
 
-// yes, it is possible to write terrible code in any language ;-)
+// this is plain java, since it is only needed if you want to build CABs for
+// PocketPCs with the ant build. It will not be used by CacheWolf itself
 
 import java.io.*;
 import java.util.*;



From araber95 at mail.berlios.de  Tue Mar 24 08:49:44 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 24 Mar 2009 08:49:44 +0100
Subject: [Cachewolf-svn] r1729 - trunk/src/CacheWolf/navi
Message-ID: <200903240749.n2O7ni9c028563@sheep.berlios.de>

Author: araber95
Date: 2009-03-24 08:49:42 +0100 (Tue, 24 Mar 2009)
New Revision: 1729

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
changemapresolution now doing the correct original map resolution on searching new map (http://www.geoclub.de/viewtopic.php?f=40&t=32408)

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-03-23 19:32:43 UTC (rev 1728)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-03-24 07:49:42 UTC (rev 1729)
@@ -1108,7 +1108,7 @@
 			cll = new CWPoint(posCircle.where);
 		}
 		
-		MapInfoObject m = maps.getMapChangeResolution(cll, screen, currentMap.scale / currentMap.zoomFactor, !betterOverview);
+		MapInfoObject m = maps.getMapChangeResolution(cll, screen, currentMap.scale * currentMap.zoomFactor, !betterOverview);
 		if (m != null) {
 			boolean saveGpsIgnStatus = dontUpdatePos;
 			dontUpdatePos = true;



From engywuck at mail.berlios.de  Thu Mar 26 17:15:28 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Thu, 26 Mar 2009 17:15:28 +0100
Subject: [Cachewolf-svn] r1730 - in trunk/src: CacheWolf CacheWolf/navi exp
Message-ID: <200903261615.n2QGFSfY027650@sheep.berlios.de>

Author: engywuck
Date: 2009-03-26 17:15:18 +0100 (Thu, 26 Mar 2009)
New Revision: 1730

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/CalcPanel.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/MyComparer.java
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/SpiderGC.java
   trunk/src/CacheWolf/navi/GotoPanel.java
   trunk/src/exp/ExploristExporter.java
   trunk/src/exp/KMLExporter.java
   trunk/src/exp/LocExporter.java
   trunk/src/exp/TomTomExporter.java
Log:
Changed data type of cache type from string to int. (Applied changes already done in Rev. 1318/1319)

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -55,7 +55,7 @@
 	/** The terrain rating of the cache from 1 to 5 in .5 incements */
 	public String terrain = EMPTY;
 	/** The cache type (@see CacheType for translation table)  */
-	public String type = "0"; //TODO Should be an int
+	public int type = 0; 
 	/** True if the cache has been archived */
 	public boolean is_archived = false;
 	/** True if the cache is available for searching */
@@ -157,7 +157,7 @@
 			CacheStatus = xmlString.substring(start+1,end);
 
 			start=xmlString.indexOf('"',end+1); end=xmlString.indexOf('"',start+1);
-			type = xmlString.substring(start+1,end);
+			type = new Integer(xmlString.substring(start+1,end)).intValue();
 
 			start=xmlString.indexOf('"',end+1); end=xmlString.indexOf('"',start+1);
 			hard = xmlString.substring(start+1,end);

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/CacheType.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -165,50 +165,49 @@
 			{"Question","52"},{"Final","53"},
 			{"Trailhead","54"},{"Reference","55"},{"WhereIGo","1858"}};
 
-	public static String shortType(String typeNum){
+	public static String shortType(int typeNum){
 		String shortType = new String("O");
-		if(typeNum.equals("0")) shortType = "C";
-		if(typeNum.equals("2")) shortType = "T";
-		if(typeNum.equals("3")) shortType = "M";
-		if(typeNum.equals("4")) shortType = "V";
-		if(typeNum.equals("5")) shortType = "L";
-		if(typeNum.equals("6")) shortType = "O";
-		if(typeNum.equals("11")) shortType = "W";
-		if(typeNum.equals("8")) shortType = "U";
-		if(typeNum.equals("12")) shortType = "O";
-		if(typeNum.equals("13")) shortType = "O";
-		if(typeNum.equals("137")) shortType = "E";
-		if(typeNum.equals("453")) shortType = "O";
-		if(typeNum.equals("1858")) shortType = "O";
-		if(typeNum.equals("50")) shortType = "P";
-		if(typeNum.equals("51")) shortType = "S";
-		if(typeNum.equals("52")) shortType = "Q";
-		if(typeNum.equals("53")) shortType = "F";
-		if(typeNum.equals("54")) shortType = "H";
-		if(typeNum.equals("55")) shortType = "R";
+		if(typeNum == 0) shortType = "C";
+		if(typeNum == 2) shortType = "T";
+		if(typeNum == 3) shortType = "M";
+		if(typeNum == 4) shortType = "V";
+		if(typeNum == 5) shortType = "L";
+		if(typeNum == 6) shortType = "O";
+		if(typeNum == 11) shortType = "W";
+		if(typeNum == 8) shortType = "U";
+		if(typeNum == 12) shortType = "O";
+		if(typeNum == 13) shortType = "O";
+		if(typeNum == 137) shortType = "E";
+		if(typeNum == 453) shortType = "O";
+		if(typeNum == 1858) shortType = "O";
+		if(typeNum == 50) shortType = "P";
+		if(typeNum == 51) shortType = "S";
+		if(typeNum == 52) shortType = "Q";
+		if(typeNum == 53) shortType = "F";
+		if(typeNum == 54) shortType = "H";
+		if(typeNum == 55) shortType = "R";
 		return shortType;
 	}
-
-	public static String transType(String geoNum){
+	public static String transType(int geoNum){
 		String geo = new String("Unknown");
-		if(geoNum.equals("2")) geo = "Traditional Cache";
-		if(geoNum.equals("3")) geo = "Multi-cache";
-		if(geoNum.equals("4")) geo = "Virtual Cache";
-		if(geoNum.equals("5")) geo = "Letterbox Hybrid";
-		if(geoNum.equals("6")) geo = "Event Cache";
-		if(geoNum.equals("11")) geo = "Webcam Cache";
-		if(geoNum.equals("8")) geo = "Unknown Cache";
-		if(geoNum.equals("12")) geo = "Locationless Cache";
-		if(geoNum.equals("13")) geo = "Cache In Trash Out Event";
-		if(geoNum.equals("137")) geo = "Earthcache";
-		if(geoNum.equals("453")) geo = "Mega Event Cache";
-		if(geoNum.equals("1858")) geo = "WhereIGo Cache";
-		if(geoNum.equals("50")) geo = "Parking Area";
-		if(geoNum.equals("51")) geo = "Stages of a Multicache";
-		if(geoNum.equals("52")) geo = "Question to Answer";
-		if(geoNum.equals("53")) geo = "Final Location";
-		if(geoNum.equals("54")) geo = "Trailhead";
-		if(geoNum.equals("55")) geo = "Reference Point";
+		if(geoNum == 2) geo = "Traditional Cache";
+		if(geoNum == 3) geo = "Multi-cache";
+		if(geoNum == 4) geo = "Virtual Cache";
+		if(geoNum == 5) geo = "Letterbox Hybrid";
+		if(geoNum == 6) geo = "Event Cache";
+		if(geoNum == 11) geo = "Webcam Cache";
+		if(geoNum == 8) geo = "Unknown Cache";
+		if(geoNum == 12) geo = "Locationless Cache";
+		if(geoNum == 13) geo = "Cache In Trash Out Event";
+		if(geoNum == 137) geo = "Earthcache";
+		if(geoNum == 453) geo = "Mega Event Cache";
+		if(geoNum == 1858) geo = "WhereIGo Cache";
+		if(geoNum == 50) geo = "Parking Area";
+		if(geoNum == 51) geo = "Stages of a Multicache";
+		if(geoNum == 52) geo = "Question to Answer";
+		if(geoNum == 53) geo = "Final Location";
+		if(geoNum == 54) geo = "Trailhead";
+		if(geoNum == 55) geo = "Reference Point";
 		return geo;
 	}
 	
@@ -244,37 +243,31 @@
 		}
 	}
 
-	public static boolean isAddiWpt(String type){
-		if (type.equals("50")) return true;
-		if (type.equals("51")) return true;
-		if (type.equals("52")) return true;
-		if (type.equals("53")) return true;
-		if (type.equals("54")) return true;
-		if (type.equals("55")) return true;
-		return false;
+	public static boolean isAddiWpt(int type){
+		return (type >= 50 && type <= 55);
 	}
 
-	public static String typeText2Number(String typeText){
-		if (typeText.equals("Traditional Cache") || typeText.equals("Traditional")|| typeText.equals("Classic")) return "2";
-		if (typeText.equals("Multi-cache") || typeText.equals("Multi") || typeText.equals("Offset")) return "3";
-		if (typeText.equals("Virtual Cache") || typeText.equals("Virtual")) return "4";
-		if (typeText.equals("Letterbox Hybrid")) return "5";
-		if (typeText.equals("Event Cache") || typeText.equals("Event")) return "6";
-		if (typeText.equals("Unknown Cache") || typeText.equals("Other") || typeText.equals("Quiz")) return "8";
-		if (typeText.equals("Webcam Cache") || typeText.equals("Webcam")) return "11";
-		if (typeText.equals("Locationless (Reverse) Cache")) return "12";
-		if (typeText.equals("Cache In Trash Out Event")) return "13";
-		if (typeText.equals("Earthcache") || typeText.equals("Earth")) return "137";
-		if (typeText.equals("Mega-Event Cache")) return "453";
-		if (typeText.equals("Wherigo Cache")) return "1858";
-		if (typeText.equals("Waypoint|Parking Area")) return "50";
-		if (typeText.equals("Waypoint|Stages of a Multicache")) return "51";
-		if (typeText.equals("Waypoint|Question to Answer")) return "52";
-		if (typeText.equals("Waypoint|Final Coordinates")||typeText.equals("Waypoint|Final Location")) return "53";
-		if (typeText.equals("Waypoint|Trailhead")) return "54";
-		if (typeText.equals("Waypoint|Reference Point")) return "55";
+	public static int typeText2Number(String typeText){
+		if (typeText.equals("Traditional Cache") || typeText.equals("Traditional")|| typeText.equals("Classic")) return 2;
+		if (typeText.equals("Multi-cache") || typeText.equals("Multi") || typeText.equals("Offset")) return 3;
+		if (typeText.equals("Virtual Cache") || typeText.equals("Virtual")) return 4;
+		if (typeText.equals("Letterbox Hybrid")) return 5;
+		if (typeText.equals("Event Cache") || typeText.equals("Event")) return 6;
+		if (typeText.equals("Unknown Cache") || typeText.equals("Other") || typeText.equals("Quiz")) return 8;
+		if (typeText.equals("Webcam Cache") || typeText.equals("Webcam")) return 11;
+		if (typeText.equals("Locationless (Reverse) Cache")) return 12;
+		if (typeText.equals("Cache In Trash Out Event")) return 13;
+		if (typeText.equals("Earthcache") || typeText.equals("Earth")) return 137;
+		if (typeText.equals("Mega-Event Cache")) return 453;
+		if (typeText.equals("Wherigo Cache")) return 1858;
+		if (typeText.equals("Waypoint|Parking Area")) return 50;
+		if (typeText.equals("Waypoint|Stages of a Multicache")) return 51;
+		if (typeText.equals("Waypoint|Question to Answer")) return 52;
+		if (typeText.equals("Waypoint|Final Coordinates")||typeText.equals("Waypoint|Final Location")) return 53;
+		if (typeText.equals("Waypoint|Trailhead")) return 54;
+		if (typeText.equals("Waypoint|Reference Point")) return 55;
 		Vm.debug("Unknown Cache Type:" + typeText);
-		return "0";
+		return 0;
 	}
 
 	/**
@@ -292,31 +285,30 @@
 		*	9		??		Moving		9->109 (ok)
 		*	10		??		Drive-In		10->110 (ok)
 		*/
-		public static String transOCType(String type){
-			if(type.equals("1")) return "8";
-			if(type.equals("2")) return "2";
-			if(type.equals("3")) return "3";	
-			if(type.equals("4")) return "4";
-			if(type.equals("5")) return "11";
-			if(type.equals("6")) return "6";
-			if(type.equals("7")) return "8";
-			if(type.equals("8")|| type.equals("9") ||type.equals("10")) return "8";
+		public static int transOCType(int type){
+			if(type == 1) return 8;
+			if(type == 2) return 2;
+			if(type == 3) return 3;	
+			if(type == 4) return 4;
+			if(type == 5) return 11;
+			if(type == 6) return 6;
+			if(type == 7) return 8;
+			if(type >= 8 || type <= 10) return 8;
 	/* Not supportet at the moment
 			if(type.equals("8")) return "108";
 			if(type.equals("9")) return "109";
 			if(type.equals("10")) return "110";
 	*/
 			//no match found? return custom type!
-			return "0";
+			return 0;
 		}
 
 		
-	public static Image cache2Img(String cacheType) {
-		int ct=Convert.parseInt(cacheType);
-		if (ct==1858)
+	public static Image cache2Img(int cacheType) {
+		if (cacheType==1858)
 			return cacheImages[WHERIGO];
 		else	
-			return cacheImages[ct]; // TODO save in cacheholder as int
+			return cacheImages[cacheType]; // TODO save in cacheholder as int
 	}
 
 }

Modified: trunk/src/CacheWolf/CalcPanel.java
===================================================================
--- trunk/src/CacheWolf/CalcPanel.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/CalcPanel.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -201,7 +201,7 @@
 				coordOut = coordInp.project(bd.degrees, bd.distance);
 				ch.LatLon = coordOut.toString();
 				ch.pos.set(coordOut);
-				ch.type = "51"; // see CacheType.GC_AW_STAGE_OF_MULTI // TODO unfertig
+				ch.type = 51; // see CacheType.GC_AW_STAGE_OF_MULTI // TODO unfertig
 				mainT.newWaypoint(ch);
 			}
 			

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -229,10 +229,11 @@
 	*	Translate the cache type to the value in the cache type dropdown
 	*	control.
 	*/
-	private int transType(String type){
+	private int transType(int type){
+		// TODO Hab ich so eine ?bersetzungstabelle nicht schon an anderer Stelle gesehen ??? Redundanz ??
 		int c_type = 0;
 		int tt = 0;
-		tt = Convert.parseInt(type);
+		tt = type;
 		switch(tt){
 			case 0: c_type = 0; break;
 			case 2: c_type = 1; break;
@@ -266,28 +267,28 @@
 	*	This transformation is required to ease the display of the cache type
 	*	icon in the table display.
 	*/
-	public String transSelect(int num){
-		String ret = new String("");
+	public int transSelect(int num){
+		int ret = 0;
 		switch(num){
-			case 0: ret = "0"; break;
-			case 1: ret = "2"; break;
-			case 2: ret = "3"; break;
-			case 3: ret = "4"; break;
-			case 4: ret = "5"; break;
-			case 5: ret = "6"; break;
-			case 6: ret = "453"; break;
-			case 7: ret = "8"; break;
-			case 8: ret = "11"; break;
-			case 9: ret = "12"; break;
-			case 10: ret = "13";break;
-			case 11: ret = "137";break;
-			case 12: ret = "1858"; break;
-			case 13: ret = "50";break;
-			case 14: ret = "51";break;
-			case 15: ret = "52";break;
-			case 16: ret = "53";break;
-			case 17: ret = "54";break;
-			case 18: ret = "55";break;
+			case 0: ret = 0; break;
+			case 1: ret = 2; break;
+			case 2: ret = 3; break;
+			case 3: ret = 4; break;
+			case 4: ret = 5; break;
+			case 5: ret = 6; break;
+			case 6: ret = 453; break;
+			case 7: ret = 8; break;
+			case 8: ret = 11; break;
+			case 9: ret = 12; break;
+			case 10: ret = 13; break;
+			case 11: ret = 137; break;
+			case 12: ret = 1858; break;
+			case 13: ret = 50; break;
+			case 14: ret = 51; break;
+			case 15: ret = 52; break;
+			case 16: ret = 53; break;
+			case 17: ret = 54; break;
+			case 18: ret = 55; break;
 
 			default: Vm.debug("Unknown cachetype: " + num);
 			break;
@@ -400,7 +401,7 @@
 				CacheHolder ch = new CacheHolder();
 				ch.LatLon = thisCache.LatLon;
 				ch.pos = new CWPoint( thisCache.pos );
-				ch.type = "51";
+				ch.type = 51;
 				Global.mainTab.newWaypoint(ch);
 			}
 			else if (ev.target == btnGoto){
@@ -500,7 +501,7 @@
 		  thisCache.CacheName = inpName.getText().trim();
 		  thisCache.LatLon = thisCache.pos.toString();
 		  thisCache.DateHidden = inpHidden.getText().trim();
-		  String oldType=thisCache.type;
+		  int oldType=thisCache.type;
 		  thisCache.type = transSelect(chcType.getInt());
 		 // thisCache.saveCacheDetails(profile.dataDir); // this is redundant, because all changes affecting the details are immediately saved
 		  // Now update the table

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/Filter.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -357,25 +357,25 @@
 			if (hasTypeMatchPattern) { // Only do the checks if we have a filter
 				cacheTypePattern = 0;
 				// As each cache can only have one type, we can use else if and set the type
-				if (ch.type.equals("0")) cacheTypePattern = CUSTOM;
-				else if(ch.type.equals("2")) cacheTypePattern = TRADITIONAL;
-				else if(ch.type.equals("3")) cacheTypePattern = MULTI;
-				else if(ch.type.equals("4")) cacheTypePattern = VIRTUAL;
-				else if(ch.type.equals("5")) cacheTypePattern = LETTER;
-				else if(ch.type.equals("6")) cacheTypePattern = EVENT;
-				else if(ch.type.equals("8")) cacheTypePattern = MYSTERY;
-				else if(ch.type.equals("11")) cacheTypePattern = WEBCAM;
-				else if(ch.type.equals("12")) cacheTypePattern = LOCLESS;
-				else if(ch.type.equals("137"))cacheTypePattern = EARTH;
-				else if(ch.type.equals("453"))cacheTypePattern = MEGA;
-				else if(ch.type.equals("50"))cacheTypePattern = PARKING;
-				else if(ch.type.equals("51"))cacheTypePattern = STAGE;
-				else if(ch.type.equals("52"))cacheTypePattern = QUESTION;
-				else if(ch.type.equals("53"))cacheTypePattern = FINAL;
-				else if(ch.type.equals("54"))cacheTypePattern = TRAILHEAD;
-				else if(ch.type.equals("55"))cacheTypePattern = REFERENCE;
-				else if(ch.type.equals("13"))cacheTypePattern = CITO;
-				else if(ch.type.equals("1858"))cacheTypePattern = WHERIGO;
+				if (ch.type == 0) cacheTypePattern = CUSTOM;
+				else if(ch.type == 2) cacheTypePattern = TRADITIONAL;
+				else if(ch.type == 3) cacheTypePattern = MULTI;
+				else if(ch.type == 4) cacheTypePattern = VIRTUAL;
+				else if(ch.type == 5) cacheTypePattern = LETTER;
+				else if(ch.type == 6) cacheTypePattern = EVENT;
+				else if(ch.type == 8) cacheTypePattern = MYSTERY;
+				else if(ch.type == 11) cacheTypePattern = WEBCAM;
+				else if(ch.type == 12) cacheTypePattern = LOCLESS;
+				else if(ch.type == 137)cacheTypePattern = EARTH;
+				else if(ch.type == 453)cacheTypePattern = MEGA;
+				else if(ch.type == 50)cacheTypePattern = PARKING;
+				else if(ch.type == 51)cacheTypePattern = STAGE;
+				else if(ch.type == 52)cacheTypePattern = QUESTION;
+				else if(ch.type == 53)cacheTypePattern = FINAL;
+				else if(ch.type == 54)cacheTypePattern = TRAILHEAD;
+				else if(ch.type == 55)cacheTypePattern = REFERENCE;
+				else if(ch.type == 13)cacheTypePattern = CITO;
+				else if(ch.type == 1858)cacheTypePattern = WHERIGO;
 				if ((cacheTypePattern & typeMatchPattern) == 0) { ch.is_filtered=true; continue; }
 			}			
 			///////////////////////////////

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/MainTab.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -318,13 +318,12 @@
 		}
 		Global.getProfile().hasUnsavedChanges=true;
 		detP.setNeedsTableUpdate(true);
-		if (ch.type == null || ch.type.equals("")) ch.type = "0";
 		if (CacheType.isAddiWpt(ch.type) && mainCache!=null && mainCache.length()>2) {
 			ch.wayPoint = profile.getNewAddiWayPointName(mainCache);
 			profile.setAddiRef(ch);
 		} else { 
 			ch.wayPoint = profile.getNewWayPointName();
-			ch.type="0";
+			ch.type=0;
 			lastselected=ch.wayPoint;
 		}
 		ch.CacheSize = "None";

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/MyComparer.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -20,7 +20,7 @@
 		if (colToCompare==1) {
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=(CacheHolder) cacheDB.get(i);
-				ch.sort=ch.type;
+				ch.sort=String.valueOf(ch.type);
 			}
 		} else if (colToCompare==2) {
 			for (int i=0; i<visibleSize; i++) {

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -356,7 +356,7 @@
 			cacheID = atts.getValue("id");
 		}
 		if(name.equals("type")){
-			chD.type = CacheType.transOCType(atts.getValue("id"));
+			chD.type = CacheType.transOCType(new Integer(atts.getValue("id")).intValue()); 
 			return;
 		}
 		if(name.equals("status")){

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/Parser.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -689,10 +689,10 @@
 				String stage=MyLocale.formatLong(i,"00");
 				String stageWpt="$"+stage+waypointName.substring(2);
 				String stageName = "Stage "+(i+1);
-				String type = "51";
+				int type = 51;
 				if (i == nStages - 1) {
 					stageName = "Final";
-					type = "53";
+					type = 53;
 				}
 				didCreateWp|=createWptIfNeeded(stage+waypointName.substring(2), stageName, type);
 				op.append("IF "+stageWpt+"=\"\" THEN\n");
@@ -1096,7 +1096,7 @@
 		}
 	}
 
-	private boolean createWptIfNeeded(String wayPoint, String name, String type){
+	private boolean createWptIfNeeded(String wayPoint, String name, int type){
 	   	int ci=Global.getProfile().getCacheIndex(wayPoint);
     	if (ci >= 0) return false;
 

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -194,7 +194,7 @@
 							addis.put("WAYPOINT",ch.wayPoint);
 							addis.put("NAME",ch.CacheName);
 							addis.put("LATLON",ch.LatLon);
-							addis.put("IMG","<img src=\""+CacheType.type2pic(Convert.parseInt(ch.type))+"\">");
+							addis.put("IMG","<img src=\""+CacheType.type2pic(ch.type)+"\">");
 							CacheHolderDetail chDA=new CacheHolderDetail(ch);
 							chDA.readCache(Global.getProfile().dataDir);
 							addis.put("LONGDESC",chDA.LongDescription); // Do we need to treat longDesc as above ?

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/SpiderGC.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -995,11 +995,11 @@
 	 * @param doc A previously fetched cachepage
 	 * @return the waypoint type (Tradi, Multi, etc.)
 	 */
-	private String getType(String doc) throws Exception{
+	private int getType(String doc) throws Exception{
 		inRex = new Regex(p.getProp("cacheTypeRex"));
 		inRex.search(doc);
-		if(inRex.didMatch()) return inRex.stringMatched(1);
-		else return "";
+		if(inRex.didMatch()) return new Integer(inRex.stringMatched(1)).intValue();
+		else return 0;
 	}
 
 	/**

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -410,7 +410,7 @@
 				CacheHolder ch = new CacheHolder();
 				ch.LatLon = myNavigation.gpsPos.toString();
 				ch.pos = new CWPoint(myNavigation.gpsPos);
-				ch.type = "51"; // see CacheType.GC_AW_STAGE_OF_MULTI // TODO unfertig
+				ch.type = 51; // see CacheType.GC_AW_STAGE_OF_MULTI // TODO unfertig
 				mainT.newWaypoint(ch);
 			}
 			// change destination waypoint

Modified: trunk/src/exp/ExploristExporter.java
===================================================================
--- trunk/src/exp/ExploristExporter.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/exp/ExploristExporter.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -230,17 +230,17 @@
 		sb.append(",");
 		String add = "";
 		if (chD.isAddiWpt()) {
-			if (chD.type.equals("50")) {
+			if (chD.type == 50) {
 				add = "Pa:";
-			} else if (chD.type.equals("51")) {
+			} else if (chD.type == 51) {
 				add = "St:";
-			} else if (chD.type.equals("52")) {
+			} else if (chD.type == 52) {
 				add = "Qu:"; 
-			} else if (chD.type.equals("53")) {	
+			} else if (chD.type == 53) {	
 				add = "Fi:";
-			} else if (chD.type.equals("54")) {
+			} else if (chD.type == 54) {
 				add = "Tr:";
-			} else if (chD.type.equals("55")) {	
+			} else if (chD.type == 55) {	
 				add = "Re:";
 			}
 			sb.append(add).append(removeCommas(chD.CacheName));
@@ -255,7 +255,7 @@
 		
 		if (!add.equals("")) { // Set Picture in Explorist to Virtual
 			sb.append("Virtual Cache");
-		} else if (!chD.type.equals("8")) { // Rewrite Unknown Caches
+		} else if (chD.type != 8) { // Rewrite Unknown Caches
 			sb.append(CacheType.transType(chD.type));
 		} else {
 			sb.append("Mystery Cache");

Modified: trunk/src/exp/KMLExporter.java
===================================================================
--- trunk/src/exp/KMLExporter.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/exp/KMLExporter.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -100,7 +100,7 @@
 					tmp = (Vector)entry.getValue();
 					// skip over empty cachetypes
 					if (tmp.size() == 0) continue;
-					outp.print(startFolder(CacheType.transType((String)entry.getKey())));
+					outp.print(startFolder(CacheType.transType(new Integer((String)entry.getKey()).intValue())));
 
 					for(int i = 0; i<tmp.size(); i++){
 						ch = (CacheHolder) tmp.get(i);
@@ -177,12 +177,13 @@
 		// fill structure with data from cacheDB
 		for(int i = 0; i<cacheDB.size(); i++){
 			ch=(CacheHolder)cacheDB.get(i);
+			// TODO Das Argument nach STring zu casten gef?llt mir nicht ganz...
 			if(ch.is_black == false && ch.is_filtered == false && !ch.isAddiWpt()){
-				if (ch.is_found) { tmp = (Vector) outCacheDB[FOUND].get(ch.type);}
-				else if (ch.is_owned) { tmp = (Vector) outCacheDB[OWNED].get(ch.type);}
-				else if (ch.is_archived || !ch.is_available){ tmp = (Vector) outCacheDB[NOT_AVAILABLE].get(ch.type);}
-				else if (ch.is_available){ tmp = (Vector) outCacheDB[AVAILABLE].get(ch.type);}
-				else { tmp = (Vector) outCacheDB[UNKNOWN].get(ch.type);}
+				if (ch.is_found) { tmp = (Vector) outCacheDB[FOUND].get(String.valueOf(ch.type));}
+				else if (ch.is_owned) { tmp = (Vector) outCacheDB[OWNED].get(String.valueOf(ch.type));}
+				else if (ch.is_archived || !ch.is_available){ tmp = (Vector) outCacheDB[NOT_AVAILABLE].get(String.valueOf(ch.type));}
+				else if (ch.is_available){ tmp = (Vector) outCacheDB[AVAILABLE].get(String.valueOf(ch.type));}
+				else { tmp = (Vector) outCacheDB[UNKNOWN].get(String.valueOf(ch.type));}
 				
 				tmp.add(ch);
 			}
@@ -291,7 +292,7 @@
 		strBuf.append("      <IconStyle>\r\n");
 		strBuf.append("         <Icon>\r\n");
 //		strBuf.append("            <href>"+ File.getProgramDirectory()+ "/" + CacheType.type2pic(Convert.parseInt(ch.type))+ "</href>\r\n");
-		strBuf.append("            <href>"+ CacheType.type2pic(Convert.parseInt(ch.type))+ "</href>\r\n");
+		strBuf.append("            <href>"+ CacheType.type2pic(ch.type)+ "</href>\r\n");
 		strBuf.append("         </Icon>\r\n");
 		strBuf.append("      </IconStyle>\r\n");
 		strBuf.append("      <LabelStyle>\r\n");

Modified: trunk/src/exp/LocExporter.java
===================================================================
--- trunk/src/exp/LocExporter.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/exp/LocExporter.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -119,11 +119,12 @@
 			// First check if there is a mapping for "cache found"
 			if (chD.is_found) {
 				for (int i=0; i<mapSize; i++)
-					if (symbols[i].onlyIfFound!=null && symbols[i].type.equals(chD.type)) return symbols[i].name;
+					// TODO Geht das noch sch?ner...? ................ <------------------------------>
+					if (symbols[i].onlyIfFound!=null && symbols[i].type.equals(String.valueOf(chD.type))) return symbols[i].name;
 			}
 			// Now try mapping the cache irrespective of the "found" status
 			for (int i=0; i<mapSize; i++)
-				if (symbols[i].type.equals(chD.type)) return symbols[i].name;
+				if (symbols[i].type.equals(String.valueOf(chD.type))) return symbols[i].name;
 		
 			// If it is not a mapped type, just use the standard mapping
 			if (chD.is_found)

Modified: trunk/src/exp/TomTomExporter.java
===================================================================
--- trunk/src/exp/TomTomExporter.java	2009-03-24 07:49:42 UTC (rev 1729)
+++ trunk/src/exp/TomTomExporter.java	2009-03-26 16:15:18 UTC (rev 1730)
@@ -93,7 +93,7 @@
 				out =  new RandomAccessFile(fileName,"rw");
 				for(int i = 0; i<cacheDB.size(); i++){
 					holder=(CacheHolder)cacheDB.get(i);
-					if(holder.type.equals(CacheType.wayType[j][TT_WPT_NUM]) && holder.is_black == false && holder.is_filtered == false){
+					if(holder.type == new Integer(CacheType.wayType[j][TT_WPT_NUM]).intValue() && holder.is_black == false && holder.is_filtered == false){
 						currExp++;
 						h.progress = (float)currExp/(float)counter;
 						h.changed();



From mik77 at mail.berlios.de  Fri Mar 27 09:45:53 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 27 Mar 2009 09:45:53 +0100
Subject: [Cachewolf-svn] r1731 - in trunk: . src/CacheWolf
Message-ID: <200903270845.n2R8jr3L015680@sheep.berlios.de>

Author: mik77
Date: 2009-03-27 09:45:45 +0100 (Fri, 27 Mar 2009)
New Revision: 1731

Modified:
   trunk/currentversions.txt
   trunk/src/CacheWolf/Version.java
Log:
Version infos updated.

Modified: trunk/currentversions.txt
===================================================================
--- trunk/currentversions.txt	2009-03-26 16:15:18 UTC (rev 1730)
+++ trunk/currentversions.txt	2009-03-27 08:45:45 UTC (rev 1731)
@@ -17,7 +17,7 @@
 T3VersionMajor: 1
 T3VersionMinor: 0
 #T3SvnRevision: http://flyingfish.freewrt.org:8180/job/Cachewolf/lastBuild/ (?i)Revision[\\s]*[:=][\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
-T3SvnRevision: http://pub.naturalnet.de/~hawks/own/CacheWolf-BE/zcurrent.txt [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
+T3SvnRevision: http://pub.naturalnet.de/~nik/own/CacheWolf-BE/zcurrent.txt [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
 
 RecommendedType: 3
 

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2009-03-26 16:15:18 UTC (rev 1730)
+++ trunk/src/CacheWolf/Version.java	2009-03-27 08:45:45 UTC (rev 1731)
@@ -16,7 +16,7 @@
 	static final int VER_MINOR = 0;
 	static final String VER_SVN ="$LastChangedRevision$"; // the number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	static final int SVN_REVISION = Common.parseInt(VER_SVN.substring(VER_SVN.indexOf(" ")+1, VER_SVN.lastIndexOf(" ")));
-	static final int VERSION_TYPE = 0;
+	static final int VERSION_TYPE = 3;
 	public static final String[] VERSION_TYPES = {
 		"Release", 
 		"ReleaseCandidate",



From araber95 at mail.berlios.de  Mon Mar 30 13:40:45 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 30 Mar 2009 13:40:45 +0200
Subject: [Cachewolf-svn] r1732 - trunk/src/CacheWolf
Message-ID: <200903301140.n2UBej7l032288@sheep.berlios.de>

Author: araber95
Date: 2009-03-30 13:40:42 +0200 (Mon, 30 Mar 2009)
New Revision: 1732

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
save changes to profile (example changed coordinates of waypoint)

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-03-27 08:45:45 UTC (rev 1731)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-03-30 11:40:42 UTC (rev 1732)
@@ -536,6 +536,7 @@
 		  // set status also on addi wpts
 		  ch.setAttributesToAddiWpts();
 		  dirty_notes=false;
+		  if (dirty_details) { Global.getProfile().hasUnsavedChanges=true;}
 		  dirty_details=false;
 		  setNeedsTableUpdate(false);
 		  if (thisCache.details != null) thisCache.details.hasUnsavedChanges = false;



