<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2297 - in trunk: res_noewe/languages	res_noewe/webmapservices resources src/CacheWolf/navi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-October/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2297%20-%20in%20trunk%3A%20res_noewe/languages%0A%09res_noewe/webmapservices%20resources%20src/CacheWolf/navi&In-Reply-To=%3C200910201840.n9KIegNH004596%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002220.html">
   <LINK REL="Next"  HREF="002222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2297 - in trunk: res_noewe/languages	res_noewe/webmapservices resources src/CacheWolf/navi</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2297%20-%20in%20trunk%3A%20res_noewe/languages%0A%09res_noewe/webmapservices%20resources%20src/CacheWolf/navi&In-Reply-To=%3C200910201840.n9KIegNH004596%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2297 - in trunk: res_noewe/languages	res_noewe/webmapservices resources src/CacheWolf/navi">araber95 at mail.berlios.de
       </A><BR>
    <I>Tue Oct 20 20:40:42 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002220.html">[Cachewolf-svn] r2296 - in trunk: res_noewe/symbols	res_noewe/symbols/oder1 src/CacheWolf src/CacheWolf/navi
</A></li>
        <LI>Next message: <A HREF="002222.html">[Cachewolf-svn] r2298 - trunk/res_noewe/symbols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2221">[ date ]</a>
              <a href="thread.html#2221">[ thread ]</a>
              <a href="subject.html#2221">[ subject ]</a>
              <a href="author.html#2221">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2009-10-20 20:40:31 +0200 (Tue, 20 Oct 2009)
New Revision: 2297

Added:
   trunk/res_noewe/webmapservices/OSMCycleMap.wms
   trunk/res_noewe/webmapservices/OSMMapnik.wms
   trunk/res_noewe/webmapservices/OSMOsmarender.wms
   trunk/resources/OSMCycleMap.kpr
   trunk/resources/OSMMapnik.kpr
   trunk/resources/OSMOsmarender.kpr
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
Added possibility to download OSM maps with aids of Kosmos (<A HREF="http://wiki.openstreetmap.org/wiki/Kosmos">http://wiki.openstreetmap.org/wiki/Kosmos</A>).
Kosmos must be installed on your local computer and you must edit the path to Kosmos.Console.exe into the wms-file.
There is a lot of playground to change the outfit of the downloaded maps.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -538,6 +538,7 @@
 		1831= bis
 		1832=%0a Bitte 'Ca. m pro Pixel' entsprechend anpassen
 		1833=Bitte w&#228;hlen Sie nicht die Trennlinie als WMS-Service
+		1834=Bitte den Pfad zur Kosmos.Console.exe in die wms-Datei richtig eintragen.
 		2000=GPX Export
 		2001=von
 		2100=Explorist Exporter

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -537,6 +537,7 @@
 		1831= to
 		1832=%0a please adjust 'Approx. meter pro pixel' accordingly
 		1833=Please don't select the separetor line in the wms service option
+		1834=Please enter the correct path to Kosmos.Console.exe into the wms-file.
 		2000=GPX Export
 		2001=of
 		2500=Error loading attributes or unknown attribute

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -528,6 +528,8 @@
 		1830=Le service de cartes choisi offre cartes en %e9chelle de
 		1831= %e0
 		1832=%0a Adaptez 'Ca. m par pixel' respectivement, svp.
+		1833=[Please don't select the separetor line in the wms service option]
+		1834=[Please enter the correct path to Kosmos.Console.exe into the wms-file.]
 		2000=GPX Export
 		2001=de
 		2100=Explorist Exporter

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -472,6 +472,8 @@
 		1743=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
 		1800=Downloaden GEO gerelateerde kaarten.
 		1801=Downloaden tegels
+		1833=[Please don't select the separetor line in the wms service option]
+		1834=[Please enter the correct path to Kosmos.Console.exe into the wms-file.]
 		2000=Exporten GPX
 		2001=Van
 		2500=Fout bij laden of onbekende pictogrammen.

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -536,6 +536,7 @@
                 1831= do
                 1832=%0a Prosze dostosowac 'Approx. meter pro pixel' accordingly
                 1833=Prosze nie wybierac lini separatora w opcjach serwisu wms
+		1834=[Please enter the correct path to Kosmos.Console.exe into the wms-file.]
                 2000=GPX Export
                 2001=of
                 2500=Blad wczytywania albo bledne atrybuty

Added: trunk/res_noewe/webmapservices/OSMCycleMap.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMCycleMap.wms	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/webmapservices/OSMCycleMap.wms	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,19 @@
+TakenFromUrl:
+GetCapabilitiesUrl:
+Name:               OSMCycleMap World
+MapType:                        topo
+MainUrl:            C:\\Programme\\Kosmos-2.5.405.6\\Console\\Kosmos.Console.exe
+ServiceTypeUrlPart: OSMCycleMap.kpr
+VersionUrlPart:
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     Kosmos
+LayersUrlPart:
+StylesUrlPart:
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
+BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/OSMMapnik.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMMapnik.wms	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/webmapservices/OSMMapnik.wms	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,19 @@
+TakenFromUrl:
+GetCapabilitiesUrl:
+Name:               OSMMapnik World
+MapType:                        topo
+MainUrl:            C:\\Programme\\Kosmos-2.5.405.6\\Console\\Kosmos.Console.exe
+ServiceTypeUrlPart: OSMMapnik.kpr
+VersionUrlPart:
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     Kosmos
+LayersUrlPart:
+StylesUrlPart:
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
+BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/OSMOsmarender.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMOsmarender.wms	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/webmapservices/OSMOsmarender.wms	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,19 @@
+TakenFromUrl:
+GetCapabilitiesUrl:
+Name:               OSMOsmarender World
+MapType:                        topo
+MainUrl:            C:\\Programme\\Kosmos-2.5.405.6\\Console\\Kosmos.Console.exe
+ServiceTypeUrlPart: OSMOsmarender.kpr
+VersionUrlPart:
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     Kosmos
+LayersUrlPart:
+StylesUrlPart:
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
+BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/resources/OSMCycleMap.kpr
===================================================================
--- trunk/resources/OSMCycleMap.kpr	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/resources/OSMCycleMap.kpr	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,13 @@
+&lt;KosmosProject Version=&quot;2.2&quot;&gt;
+  &lt;RulesSource&gt;
+    &lt;WikiPage&gt;<A HREF="http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules&lt;/WikiPage">http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules&lt;/WikiPage</A>&gt;
+  &lt;/RulesSource&gt;
+  &lt;DataFiles&gt;
+    &lt;WebMap&gt;
+      &lt;Provider&gt;OSM CycleMap&lt;/Provider&gt;
+      &lt;Transparency&gt;100&lt;/Transparency&gt;
+    &lt;/WebMap&gt;
+  &lt;/DataFiles&gt;
+  &lt;PrintSettings&gt;
+  &lt;/PrintSettings&gt;
+&lt;/KosmosProject&gt;
\ No newline at end of file

Added: trunk/resources/OSMMapnik.kpr
===================================================================
--- trunk/resources/OSMMapnik.kpr	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/resources/OSMMapnik.kpr	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,13 @@
+&lt;KosmosProject Version=&quot;2.2&quot;&gt;
+  &lt;RulesSource&gt;
+    &lt;WikiPage&gt;<A HREF="http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules&lt;/WikiPage">http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules&lt;/WikiPage</A>&gt;
+  &lt;/RulesSource&gt;
+  &lt;DataFiles&gt;
+    &lt;WebMap&gt;
+      &lt;Provider&gt;OSM Mapnik&lt;/Provider&gt;
+      &lt;Transparency&gt;100&lt;/Transparency&gt;
+    &lt;/WebMap&gt;
+  &lt;/DataFiles&gt;
+  &lt;PrintSettings&gt;
+  &lt;/PrintSettings&gt;
+&lt;/KosmosProject&gt;
\ No newline at end of file

Added: trunk/resources/OSMOsmarender.kpr
===================================================================
--- trunk/resources/OSMOsmarender.kpr	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/resources/OSMOsmarender.kpr	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,13 @@
+&lt;KosmosProject Version=&quot;2.2&quot;&gt;
+  &lt;RulesSource&gt;
+    &lt;WikiPage&gt;<A HREF="http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules&lt;/WikiPage">http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules&lt;/WikiPage</A>&gt;
+  &lt;/RulesSource&gt;
+  &lt;DataFiles&gt;
+    &lt;WebMap&gt;
+      &lt;Provider&gt;OSM Osmarender&lt;/Provider&gt;
+      &lt;Transparency&gt;100&lt;/Transparency&gt;
+    &lt;/WebMap&gt;
+  &lt;/DataFiles&gt;
+  &lt;PrintSettings&gt;
+  &lt;/PrintSettings&gt;
+&lt;/KosmosProject&gt;
\ No newline at end of file

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-20 18:40:31 UTC (rev 2297)
@@ -44,7 +44,7 @@
 	float tileScale;
 
 	/**
-	 * 
+	 *
 	 * @param prxy
 	 * @param prt
 	 * @param wmspath without trailing &quot;/&quot;
@@ -59,21 +59,21 @@
 		FileBugfix files = new FileBugfix(wmspath);
 		String FileName;
 		OnlineMapService tempOMS;
-		MessageBox f = null; 
+		MessageBox f = null;
 		dateien = files.list(&quot;*.wms&quot;, FileBase.LIST_FILES_ONLY); //&quot;*.xyz&quot; doesn't work on some systems -&gt; use FileBugFix
 		for(int i = 0; i &lt; dateien.length;i++){
 			FileName = dateien[i];
 			try {
 				if (!showprogress &amp;&amp; ((i &amp; 0) == 0) &amp;&amp; (new Time().getTime()-start  &gt; 100) ) { // reason for (i &amp; 7 == 0): test time only after i is incremented 15 times
-					showprogress = true;      
+					showprogress = true;
 					progressBox = new InfoBox(MyLocale.getMsg(327, &quot;Info&quot;), MyLocale.getMsg(4800, &quot;Loading online map services&quot;));
-					progressBox.exec(); 
+					progressBox.exec();
 					progressBox.waitUntilPainted(500);
 					ewe.sys.Vm.showWait(true);
 				}
 				tempOMS = new WebMapService(STRreplace.replace(wmspath + &quot;/&quot; + FileName, &quot;//&quot;, &quot;/&quot;));
 				onlineMapServices.add(tempOMS);
-			}catch(Exception ex){ 
+			}catch(Exception ex){
 				if (f == null) (f=new MessageBox(MyLocale.getMsg(144, &quot;Warning&quot;), MyLocale.getMsg(4801, &quot;Ignoring error while \n reading web map service definition file \n&quot;)+ex.toString(), FormBase.OKB)).exec();
 			}
 		}
@@ -115,7 +115,7 @@
 	}
 
 	/**
-	 * download maps from expedia at zoomlevel alti and save the maps and the .wfl 
+	 * download maps from expedia at zoomlevel alti and save the maps and the .wfl
 	 * in path
 	 * @param center centre of all tiles
 	 * @param radius in meters
@@ -123,7 +123,7 @@
 	 * @param size in pixels
 	 * @param overlapping in pixels
 	 * @param path without &quot;/&quot; at the end
-	 * 
+	 *
 	 */
 	public void setTiles (CWPoint center, float radius, float scale, Point size, int overlapping) {
 		double metersPerLat = (1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
@@ -145,8 +145,8 @@
 		double pixelsPerLon = metersPerLon / metersperpixel;
 
 		//over all pixelsize without borders
-		double pixelsY = (topleft.latDec - buttomright.latDec) * pixelsPerLat; 
-		double pixelsX = -(topleft.lonDec - buttomright.lonDec) * pixelsPerLon ; 
+		double pixelsY = (topleft.latDec - buttomright.latDec) * pixelsPerLat;
+		double pixelsX = -(topleft.lonDec - buttomright.lonDec) * pixelsPerLon ;
 
 		//border sizes around given area and overlapping between tiles
 		//int borderX = (int) java.lang.Math.round((float)size.x * (overlapping - 1.0));
@@ -205,7 +205,7 @@
 		progressInfobox = progrssInfoboxi;
 	}
 	/**
-	 * 
+	 *
 	 * @param center
 	 * @param scale
 	 * @param pixelsize
@@ -217,8 +217,25 @@
 		String filename = createFilename(mio.getCenter(), mio.scale);
 		String imagename = mio.setName(path, filename) + currentOnlineMapService.getImageFileExt();
 		String url = currentOnlineMapService.getUrlForCenterScale(center, scale, pixelsize);
-		downloadImage(url, path+imagename);
-		mio.saveWFL();
+		WebMapService wms = (WebMapService) currentOnlineMapService;
+		if (wms.requestUrlPart.equalsIgnoreCase(&quot;Kosmos&quot;)) {
+			url=&quot;bitmapgen&quot;+
+				&quot; \&quot;&quot;+FileBase.getProgramDirectory().replace('/','\\')+&quot;\\&quot;+wms.serviceTypeUrlPart+&quot; \&quot;&quot;+
+				&quot; \&quot;&quot;+path.replace('/','\\')+imagename+&quot;\&quot;&quot;+
+				&quot; -mb &quot;+url; // + minx miny maxx maxy + pixelsize.x
+			File f=new FileBugfix(wms.MainUrl);
+			if (!f.exists()) {
+				MessageBox mb=new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;),MyLocale.getMsg(1834,&quot;Please enter the correct path to Kosmos.Console.exe into the wms-file.&quot;),ewe.ui.MessageBox.OKB);
+				mb.execute();
+			} else {
+				Vm.exec(wms.MainUrl, url, 0, true);
+				mio.saveWFL();
+			}
+		}
+		else {
+			downloadImage(url, path+imagename);
+			mio.saveWFL();
+		}
 	}
 
 	public String createFilename(CWPoint center, float scale) {
@@ -228,10 +245,10 @@
 	}
 
 	/**
-	 * @param url usual URL. If a redirect is requiered (as in the case of 
+	 * @param url usual URL. If a redirect is requiered (as in the case of
 	 * Expedia, add an &quot;R&quot; before &quot;<A HREF="http://">http://</A>&quot; --&gt; Don't download the url, retry until getting a http-redirect
 	 * this is necessary for expedia as it delivers the image only after a http-redirect
-	 * and sometimes doesn't send a redirect on the first try 
+	 * and sometimes doesn't send a redirect on the first try
 	 * @param datei path and name of file to save to
 	 */
 	public void downloadImage(String url, String datei) throws IOException {
@@ -277,7 +294,7 @@
 					String tmp = connImg.readText(sockImg, null).toString(); // TODO if the content is binary will will get an Exception in InfoBox, trying to display the content
 					tmp = tmp.substring(0, (tmp.length() &lt; 1000 ? tmp.length() : 1000));
 					sockImg.close();
-					throw new IOException(MyLocale.getMsg(4808, &quot;downloadImage: content-type:&quot;)+&quot; &quot; + ct + MyLocale.getMsg(4809, &quot; is not an image, begin of content:&quot;)+&quot; &quot; + tmp); 
+					throw new IOException(MyLocale.getMsg(4808, &quot;downloadImage: content-type:&quot;)+&quot; &quot; + ct + MyLocale.getMsg(4809, &quot; is not an image, begin of content:&quot;)+&quot; &quot; + tmp);
 				}
 				daten = connImg.readData(sockImg);
 				fos = new FileOutputStream(datei); // note: using the constructor (File) instead of (String) will cause not to use the fake file system
@@ -299,7 +316,7 @@
 	String name;
 	/** Type of map (used as directory name when downloading maps. We currently have &quot;topo&quot; and &quot;photo&quot; defined as map types */
 	String mapType;
-	/** Esentially the same as name, but used for the file system. It will be part of the names of the downloaded images */ 
+	/** Esentially the same as name, but used for the file system. It will be part of the names of the downloaded images */
 	String filename;
 	String MainUrl; //<A HREF="http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS">http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS</A>
 	/** including &quot;.&quot; */
@@ -310,11 +327,11 @@
 	double maxscale;
 	Area boundingBox;
 
-	/** 
-	 * This method is used in case the online map service provides only certain steps of 
+	/**
+	 * This method is used in case the online map service provides only certain steps of
 	 * zoomlevels. In this case the scale in meters per pixel must be returned, which
-	 * will be used instead of the wished scale. 
-	 * 
+	 * will be used instead of the wished scale.
+	 *
 	 * @param scale
 	 * @return
 	 */
@@ -326,7 +343,7 @@
 		return imageFileExt;
 	}
 
-	/** 
+	/**
 	 * Overlaod this to integrate name of layers
 	 * @return friendly service name
 	 */
@@ -334,8 +351,8 @@
 		return name;
 	}
 
-	/** 
-	 * This method is called to get a name of the 
+	/**
+	 * This method is called to get a name of the
 	 * online map service which will be part of the filename
 	 * used for the downloaded image
 	 * @return friendly service name
@@ -390,11 +407,11 @@
 		return bbox;
 	}
 
-	
+
 	protected MapInfoObject getMapInfoObjectInternal(Area maparea, Point pixelsize) {
 		throw new IllegalArgumentException(MyLocale.getMsg(4811, &quot;OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):\n This method must be overloaded in order to be able to use it&quot;));
 	}
-	
+
 	/**
 	 * Overload this (don't call super()) or alternatively overload getMapInfoObjectInternal
 	 * @param center
@@ -414,17 +431,17 @@
 class WebMapService extends OnlineMapService {
 	String layersUrlPart; //
 	String versionUrlPart; // VERSION=1.1.0
-	String serviceTypeUrlPart; //&quot;SERVICE=WMS&quot; 
-	int coordinateReferenceSystem[]; // WGS84: 4326, German GK: 31466 / 
+	String serviceTypeUrlPart; //&quot;SERVICE=WMS&quot;
+	int coordinateReferenceSystem[]; // WGS84: 4326, German GK: 31466 /
 	String coordinateReferenceSystemUrlPart[]; //&amp;SRS=EPSG:31466
-	String requestUrlPart;
+	public String requestUrlPart;
 	String imageFormatUrlPart; // FORMAT=image/png
 	String stylesUrlPart; // STYLES=
 	double minscaleWMS;
 	double maxscaleWMS;
 
 	/**
-	 * 
+	 *
 	 * @param filename without file extension
 	 * @throws IOException
 	 * @throws IllegalArgumentException
@@ -500,7 +517,7 @@
 	private static final int TOPRIGHT_INDEX = 2;
 	private static final int BUTTOMLEFT_INDEX = 3;
 	/**
-	 * 
+	 *
 	 * @param maparea
 	 * @return [0] = topleft, [1] = buttomright, [2] = topright, [3] = buttomleft
 	 */
@@ -515,13 +532,13 @@
 		ret[BUTTOMRIGHT_INDEX] = TransformCoordinates.wgs84ToEpsg(maparea.buttomright, coordinateReferenceSystem[crs]);
 		ret[TOPRIGHT_INDEX] =  ret[BUTTOMRIGHT_INDEX].cloneIt();
 		ret[TOPRIGHT_INDEX].shift(ret[TOPLEFT_INDEX].getNorthing() - ret[BUTTOMRIGHT_INDEX].getNorthing(), 0); // was: new GkPoint(ret[BUTTOMRIGHT_INDEX].getEasting(region), ret[TOPLEFT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
-		ret[BUTTOMLEFT_INDEX] = ret[BUTTOMRIGHT_INDEX].cloneIt(); 
+		ret[BUTTOMLEFT_INDEX] = ret[BUTTOMRIGHT_INDEX].cloneIt();
 		ret[BUTTOMLEFT_INDEX].shift(ret[TOPLEFT_INDEX].getEasting() - ret[BUTTOMRIGHT_INDEX].getEasting(), 1); // was: new GkPoint(ret[TOPLEFT_INDEX].getEasting(region), ret[BUTTOMRIGHT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
 		//Vm.debug(&quot;rot left direkt: &quot; + TransformCoordinates.GkToWgs84(ret[TOPLEFT_INDEX], region).getBearing(TransformCoordinates.GkToWgs84(ret[BUTTOMLEFT_INDEX], region)));
 		//Vm.debug(&quot;rot right direkt: &quot; + TransformCoordinates.GkToWgs84(ret[TOPRIGHT_INDEX], region).getBearing(TransformCoordinates.GkToWgs84(ret[BUTTOMRIGHT_INDEX], region)));
 		//ret[2] = TransformCoordinates.wgs84ToGermanGk(topright, coordinateReferenceSystem[crs]);
 		//ret[3] = TransformCoordinates.wgs84ToGermanGk(buttomleft, coordinateReferenceSystem[crs]);
-		return ret;	
+		return ret;
 	}
 	public Area CenterScaleToArea(CWPoint center, float scale, Point pixelsize) {
 		Area bbox = new Area();
@@ -559,13 +576,13 @@
 		// <A HREF="http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS&amp;VERSION=1.1.0&amp;REQUEST=GetMap&amp;SRS=EPSG:31466&amp;BBOX=2577567.0149,5607721.7566,2578567.0077,5608721.7602&amp;WIDTH=500&amp;HEIGHT=500&amp;LAYERS=Raster:TK25_KMF:Farbkombination&amp;STYLES=&amp;FORMAT=image/png">http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS&amp;VERSION=1.1.0&amp;REQUEST=GetMap&amp;SRS=EPSG:31466&amp;BBOX=2577567.0149,5607721.7566,2578567.0077,5608721.7602&amp;WIDTH=500&amp;HEIGHT=500&amp;LAYERS=Raster:TK25_KMF:Farbkombination&amp;STYLES=&amp;FORMAT=image/png</A>
 		CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
 		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
-		double scaleh = maparea.buttomright.getDistance(buttomleft) * 1000 / pixelsize.x; 
-		double scalev = maparea.topleft.getDistance(topright) * 1000 / pixelsize.y; 
+		double scaleh = maparea.buttomright.getDistance(buttomleft) * 1000 / pixelsize.x;
+		double scalev = maparea.topleft.getDistance(topright) * 1000 / pixelsize.y;
 		double scale = Math.sqrt(scaleh * scaleh + scalev * scalev); // meters per pixel measured diagonal
 		if ( scale &lt; minscaleWMS || scale &gt; maxscaleWMS ) throw new IllegalArgumentException(MyLocale.getMsg(4825, &quot;scale&quot;)+&quot; &quot; + scale / Math.sqrt(2)+ MyLocale.getMsg(4826, &quot; not supported by online map service, supported scale range:&quot;)+&quot; &quot; + minscale + &quot; - &quot; + maxscale + MyLocale.getMsg(4827, &quot; (measured in meters per pixel vertically)&quot;));
 		int crs = 0;
 		String bbox = &quot;BBOX=&quot;;
-		int localsystem = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]); 
+		int localsystem = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]);
 		if (localsystem &gt; 0) {
 			crs = getCrs(maparea.getCenter());
 			ProjectedPoint[] gk = getGkArea(maparea);
@@ -573,13 +590,19 @@
 			topright = TransformCoordinates.ProjectedEpsgToWgs84(gk[TOPRIGHT_INDEX], coordinateReferenceSystem[crs]);
 			bbox += TransformCoordinates.wgs84ToEpsg(buttomleft, coordinateReferenceSystem[crs]).toString(2, &quot;&quot;, &quot;,&quot;);
 			bbox += &quot;,&quot; + TransformCoordinates.wgs84ToEpsg(topright, coordinateReferenceSystem[crs]).toString(2, &quot;&quot;, &quot;,&quot;);
-		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84) 
+		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84)
 			bbox += buttomleft.toString(TransformCoordinates.LON_LAT)  + &quot;,&quot; + topright.toString(TransformCoordinates.LON_LAT);
 		else throw new IllegalArgumentException(MyLocale.getMsg(4828, &quot;Coordinate system not supported by cachewolf:&quot;)+&quot; &quot; + coordinateReferenceSystem.toString());
-		String ret = MainUrl + &quot;SERVICE=WMS&quot; + &quot;&amp;&quot;+ versionUrlPart + &quot;&amp;&quot; + requestUrlPart + &quot;&amp;&quot; + 
-		coordinateReferenceSystemUrlPart[crs] + &quot;&amp;&quot; + bbox + 
-		&quot;&amp;WIDTH=&quot; + pixelsize.x + &quot;&amp;HEIGHT=&quot; + pixelsize.y + &quot;&amp;&quot; + 
+		String ret = MainUrl + &quot;SERVICE=WMS&quot; + &quot;&amp;&quot;+ versionUrlPart + &quot;&amp;&quot; + requestUrlPart + &quot;&amp;&quot; +
+		coordinateReferenceSystemUrlPart[crs] + &quot;&amp;&quot; + bbox +
+		&quot;&amp;WIDTH=&quot; + pixelsize.x + &quot;&amp;HEIGHT=&quot; + pixelsize.y + &quot;&amp;&quot; +
 		layersUrlPart + &quot;&amp;&quot; + stylesUrlPart + &quot;&amp;&quot; + imageFormatUrlPart;
+		if (requestUrlPart.equalsIgnoreCase(&quot;Kosmos&quot;)) {
+			// minlat minlng maxlat maxlng
+			ret=buttomleft.toString(TransformCoordinates.LAT_LON).replace(',',' ')+&quot; &quot;+
+				topright.toString(TransformCoordinates.LAT_LON).replace(',',' ')+
+				&quot; -w &quot;+pixelsize.x;
+		}
 		Global.getPref().log(ret + &quot; WGS84: Buttom left: &quot; + buttomleft.toString(TransformCoordinates.DD) + &quot;top right: &quot; + topright.toString(TransformCoordinates.DD));
 		return ret;
 	}
@@ -588,7 +611,7 @@
 	 * This method gives the number in the array of coordinateReferenceSystems, which should be used
 	 * a) if only one is in the array 0 is returned
 	 * b) if there are more, find out which one matches the correct zone (e.g. Gau&#223;-K&#252;ger stripe)
-	 * Call this routine with center of the area (use Area.getcenter()) 
+	 * Call this routine with center of the area (use Area.getcenter())
 	 * @param p Point for which the epsg code is searched for
 	 * @return
 	 */
@@ -599,14 +622,14 @@
 			ProjectedPoint gkbl = TransformCoordinates.wgs84ToLocalsystem(p, ls); // TODO: think / read about what to do if buttom left and top right are not in the same Gau&#223;-Kr&#252;ger stripe?
 			int wantepsg = gkbl.getEpsgCode();
 			for (crsindex = 0; crsindex &lt; coordinateReferenceSystem.length; crsindex++) {
-				if (coordinateReferenceSystem[crsindex] == wantepsg) break; 
+				if (coordinateReferenceSystem[crsindex] == wantepsg) break;
 			}
 			if (crsindex &gt;= coordinateReferenceSystem.length) { // not match
 				for (crsindex = 0; crsindex &lt; coordinateReferenceSystem.length; crsindex++) {
-					if (Math.abs(coordinateReferenceSystem[crsindex] - wantepsg) == 1) break; // accept 1 zone deviation 
+					if (Math.abs(coordinateReferenceSystem[crsindex] - wantepsg) == 1) break; // accept 1 zone deviation
 				}
 				if (crsindex &gt;= coordinateReferenceSystem.length) crsindex = -1;
-				
+
 			}
 			if (crsindex &lt; 0) throw new IllegalArgumentException(MyLocale.getMsg(4829, &quot;getUrlForBoundingBox: Point:&quot;)+&quot; &quot; + gkbl.toString() + MyLocale.getMsg(4830, &quot;no matching Gau&#223;-Kr&#252;ger-Stripe in the EPSG-code list in the .wms&quot;));
 		}
@@ -622,9 +645,9 @@
 		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
 		CWPoint topleft = new CWPoint(maparea.topleft);
 		CWPoint buttomright = new CWPoint(maparea.buttomright);
-		double metersperpixalhorizontal = ( buttomright.getDistance(buttomleft) + topleft.getDistance(topright))/2 * 1000 / pixelsize.x; 
+		double metersperpixalhorizontal = ( buttomright.getDistance(buttomleft) + topleft.getDistance(topright))/2 * 1000 / pixelsize.x;
 		double metersperpixalvertical = ( buttomright.getDistance(topright) + topleft.getDistance(buttomleft))/2 * 1000 / pixelsize.y;
-		int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]); 
+		int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]);
 		if ( region &gt; 0) {
 			ProjectedPoint[] gk = getGkArea(maparea);
 			// bounding box in WMS is defined around the pixels, not exactly on the pixels --&gt; the bounding box must be reduced on all edges by half a pixel
@@ -673,19 +696,19 @@
 
 class ExpediaMapService extends OnlineMapService {
 	/*
-	 * information from: DownloadMouseMode.properties in project GPSylon ( in directory gpsylon_src-0.5.2\plugins\downloadmousemode\auxiliary\org\dinopolis\gpstool\plugin\downloadmousemode and DownloadMapCalculator.java in Dir gpsylon_src-0.5.2\plugins\downloadmousemode\src\org\dinopolis\gpstool\plugin\downloadmousemode 
+	 * information from: DownloadMouseMode.properties in project GPSylon ( in directory gpsylon_src-0.5.2\plugins\downloadmousemode\auxiliary\org\dinopolis\gpstool\plugin\downloadmousemode and DownloadMapCalculator.java in Dir gpsylon_src-0.5.2\plugins\downloadmousemode\src\org\dinopolis\gpstool\plugin\downloadmousemode
 	 * download.map.url.expedia_east=http\://www.expedia.com/pub/agent.dll?qscr=mrdt&amp;ID=3XNsF.&amp;CenP={0,number,#.########},{1,number,#.########}&amp;Lang=EUR0809&amp;Alti={2,number,#}&amp;Size={3,number,#},{4,number,#}&amp;Offs=0.000000,0.000000\&amp;BCheck=1
 	 * download.map.url.expedia_east.title=Url of Expedia Europe
 	 * download.map.scale_factor.expedia_east=3950
 	 */
 	final static float downloadMapScaleFactorExpedia_east = 3950;
 	final static float MAPBLAST_METERS_PER_PIXEL = 1.0f/2817.947378f;
-	final static float EXPEDIA_METERS_PER_PIXEL = downloadMapScaleFactorExpedia_east * MAPBLAST_METERS_PER_PIXEL; 
+	final static float EXPEDIA_METERS_PER_PIXEL = downloadMapScaleFactorExpedia_east * MAPBLAST_METERS_PER_PIXEL;
 
 	public ExpediaMapService() {
 		name = &quot;Expedia&quot;;
 		filename = &quot;expedia&quot;;
-		MainUrl = &quot;<A HREF="Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&amp;ID=3kQaz.">Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&amp;ID=3kQaz.</A>&quot;; //&quot;<A HREF="Rhttp://">Rhttp://</A>&quot; forces doenloadUrl to retry the URL until it gets an http-redirect and then downloads from there 
+		MainUrl = &quot;<A HREF="Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&amp;ID=3kQaz.">Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&amp;ID=3kQaz.</A>&quot;; //&quot;<A HREF="Rhttp://">Rhttp://</A>&quot; forces doenloadUrl to retry the URL until it gets an http-redirect and then downloads from there
 		imageFileExt = &quot;.gif&quot;;
 		mapType = &quot;expedia&quot;;
 		recommendedScales = new double[]{5};
@@ -697,7 +720,7 @@
 	public float getMetersPerPixel(float scale) {
 		return EXPEDIA_METERS_PER_PIXEL * getZoomlevel(scale);
 	}
-	
+
 	private int getZoomlevel(float scale) {
 		return (int)(Math.ceil(scale / EXPEDIA_METERS_PER_PIXEL));
 	}
@@ -705,7 +728,7 @@
 	public String getUrlForCenterScale(CWPoint center, float scale, Point pixelsize) {
 		int zoomlevel = getZoomlevel(scale);
 		String zone;
-		if (     (center.lonDec &lt;= -30   &amp;&amp; center.lonDec &gt;= -170) || 
+		if (     (center.lonDec &lt;= -30   &amp;&amp; center.lonDec &gt;= -170) ||
 				( center.lonDec &gt; 360-30 &amp;&amp; center.lonDec &lt;= 360-170) ) zone = &quot;USA0409&quot;; // TODO test which zone-code ist best for asia
 		else zone = &quot;EUR0809&quot;;
 		String quelle = MainUrl + &quot;&amp;CenP=&quot; + center.toString(TransformCoordinates.LAT_LON);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002220.html">[Cachewolf-svn] r2296 - in trunk: res_noewe/symbols	res_noewe/symbols/oder1 src/CacheWolf src/CacheWolf/navi
</A></li>
	<LI>Next message: <A HREF="002222.html">[Cachewolf-svn] r2298 - trunk/res_noewe/symbols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2221">[ date ]</a>
              <a href="thread.html#2221">[ thread ]</a>
              <a href="subject.html#2221">[ subject ]</a>
              <a href="author.html#2221">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
