<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2285 - in trunk/src/CacheWolf: . exp imp navi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-October/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2285%20-%20in%20trunk/src/CacheWolf%3A%20.%20exp%20imp%20navi&In-Reply-To=%3C200910161543.n9GFhWEw029980%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002208.html">
   <LINK REL="Next"  HREF="002210.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2285 - in trunk/src/CacheWolf: . exp imp navi</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2285%20-%20in%20trunk/src/CacheWolf%3A%20.%20exp%20imp%20navi&In-Reply-To=%3C200910161543.n9GFhWEw029980%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2285 - in trunk/src/CacheWolf: . exp imp navi">araber95 at mail.berlios.de
       </A><BR>
    <I>Fri Oct 16 17:43:32 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002208.html">[Cachewolf-svn] r2284 - in trunk: res_noewe/languages src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="002210.html">[Cachewolf-svn] r2286 - trunk/src/CacheWolf/navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2209">[ date ]</a>
              <a href="thread.html#2209">[ thread ]</a>
              <a href="subject.html#2209">[ subject ]</a>
              <a href="author.html#2209">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2009-10-16 17:43:20 +0200 (Fri, 16 Oct 2009)
New Revision: 2285

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/ProfileDataForm.java
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/TablePanel.java
   trunk/src/CacheWolf/exp/OVLExporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/navi/GotoPanel.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
sorting table on new current centre

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -50,7 +50,7 @@
 	/** way point coordinates, open change coordinates dialog. */
 	private static mButton btnCoordinates;
 	/** set center to current way point. */
-	private static mButton btnCenter;
+	// private static mButton btnCenter;
 	/** add time stamp to notes. */
 	private static mButton btnAddDateTime;
 	/** create a new way point. */
@@ -251,10 +251,10 @@
 		imgShowBug = new mImage(useBigIcons ? &quot;bug_vga.gif&quot;:&quot;bug.gif&quot;);
 		imgShowBugNo = new mImage(useBigIcons ? &quot;bug_no_vga.gif&quot;:&quot;bug_no.gif&quot;);
 	}
-	
+
 	private CellPanel createToolsPanel() {
 		final CellPanel pnlTools = new CellPanel();
-		
+
 		btnNewWpt = new mButton(imgNewWpt = new mImage(useBigIcons ? &quot;newwpt_vga.png&quot; : &quot;newwpt.png&quot;));
 		// FIXME: get an image with proper transparency
 		imgNewWpt.transparentColor = new Color(255, 0, 0);
@@ -286,7 +286,7 @@
 
 		btnAddDateTime = new mButton(new mImage(useBigIcons ? &quot;date_time_vga.gif&quot; : &quot;date_time.gif&quot;));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, &quot;Add timestamp to notes&quot;));
-		
+
 		pnlTools.addNext(btnNewWpt);
 		pnlTools.addNext(btnGoto);
 		pnlTools.addNext(btnShowBug);
@@ -297,7 +297,7 @@
 		pnlTools.addLast(btnAddDateTime);
 
 		pnlTools.stretchFirstRow = true;
-		
+
 		return pnlTools;
 	}
 
@@ -330,7 +330,7 @@
 		inpName.setText(ch.getCacheName());
 		btnCoordinates.setText(ch.pos.toString());
 		inpHidden.setText(mainCache.getDateHidden());
-		inpOwner.setText(mainCache.getCacheOwner());			
+		inpOwner.setText(mainCache.getCacheOwner());
 
 		if (ch.getCacheStatus().length() &gt;= 10 &amp;&amp; ch.getCacheStatus().charAt(4) == '-') {
 			chcStatus.setText(MyLocale.getMsg(318, &quot;Found&quot;) + &quot; &quot; + ch.getCacheStatus());
@@ -382,7 +382,7 @@
 			activateControl(btnShowBug);
 			activateControl(btnBlack);
 		}
-		
+
 		if (ch.isCustomWpt()) {
 			btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + DTINVALID);
 			btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + DTINVALID);
@@ -407,7 +407,7 @@
 				}
 			}
 		}
-		
+
 		int addiCount = 0;
 		if (ch.mainCache == null) {
 			addiCount = ch.addiWpts.size();
@@ -427,10 +427,10 @@
 	 */
 	public void createWptName() {
 		final String wpt = inpWaypoint.getText().toUpperCase();
-		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) 
-				&amp;&amp; Global.mainTab.mainCache != null 
-				&amp;&amp; (Global.mainTab.mainCache.startsWith(&quot;GC&quot;) 
-					|| CacheHolder.isOCWaypoint(Global.mainTab.mainCache) || Global.mainTab.mainCache.startsWith(&quot;CW&quot;)) 
+		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
+				&amp;&amp; Global.mainTab.mainCache != null
+				&amp;&amp; (Global.mainTab.mainCache.startsWith(&quot;GC&quot;)
+					|| CacheHolder.isOCWaypoint(Global.mainTab.mainCache) || Global.mainTab.mainCache.startsWith(&quot;CW&quot;))
 				&amp;&amp; wpt.startsWith(&quot;CW&quot;)) {
 			// for what was this?:
 			Global.mainTab.lastselected = Global.mainTab.mainCache; // I don't know exactly, but it's needed for creating a series of Addis
@@ -508,11 +508,11 @@
 				// is.execute();
 				final TravelbugInCacheScreen ts = new TravelbugInCacheScreen(cache.getCacheDetails(true).Travelbugs.toHtml(),	&quot;Travelbugs&quot;);
 				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
+			/* not fully implemented
 			} else if (ev.target == btnCenter) {
 				final CWPoint cp = new CWPoint(cache.LatLon);
 				if (cp.isValid()) {
-					pref.curCentrePt.set(cp);
-					Global.mainTab.updateBearDist();
+					pref.setCurCentrePt(cp);
 				} else {
 					final MessageBox tmpMB = new MessageBox(
 							MyLocale.getMsg(312, &quot;Error&quot;),
@@ -520,22 +520,23 @@
 							FormBase.OKB);
 					tmpMB.exec();
 				}
+			*/
 
 			} else if (ev.target == btnAddDateTime) {
 				dirtyNotes = true;
-				
+
 				final StringBuffer newNote = new StringBuffer();
 				newNote.append(cache.getCacheDetails(true).getCacheNotes());
-				
+
 				final Time dtm = new Time();
 				dtm.getTime();
 				dtm.setFormat(&quot;E dd.MM.yyyy '/' HH:mm&quot;);
-				
+
 				if (newNote.length() &gt; 0) {
 					newNote.append('\n');
 				}
 				newNote.append(dtm.toString()).append('\n');
-				
+
 				cache.getCacheDetails(true).setCacheNotes(newNote.toString());
 				//FIXME: better use saveDirtyWaypoint()?
 				cache.save();
@@ -578,9 +579,9 @@
 					btnCoordinates.setText(coords.toString());
 					cache.LatLon = coords.toString();
 					// If the current centre is valid, calculate the distance and bearing to it
-					final CWPoint centre = Global.getPref().curCentrePt;
+					final CWPoint centre = Global.getPref().getCurCentrePt();
 					if (centre.isValid()) {
-						cache.calcDistance(centre);
+						cache.calcDistance(centre); // todo perhaps sortTable
 					}
 				}
 			} else if (ev.target == btnFoundDate) {
@@ -637,9 +638,9 @@
 				}
 			} else if (ev.target == btnTerr) {
 				int returnValue;
-				final TerrDiffForm tdf = new TerrDiffForm(true, 
-						decodeTerrDiff(btnTerr, 
-								MyLocale.getMsg(1001, &quot;T&quot;), 
+				final TerrDiffForm tdf = new TerrDiffForm(true,
+						decodeTerrDiff(btnTerr,
+								MyLocale.getMsg(1001, &quot;T&quot;),
 								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
 							)
 						);
@@ -650,13 +651,13 @@
 				}
 			} else if (ev.target == btnDiff) {
 				int returnValue;
-				final TerrDiffForm tdf = new TerrDiffForm(false, 
-						decodeTerrDiff(btnDiff, 
-								MyLocale.getMsg(1001, &quot;D&quot;), 
+				final TerrDiffForm tdf = new TerrDiffForm(false,
+						decodeTerrDiff(btnDiff,
+								MyLocale.getMsg(1001, &quot;D&quot;),
 								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
 							)
 						);
-						
+
 				returnValue = tdf.execute();
 				if (returnValue == 1) {
 					btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: &quot;
@@ -667,7 +668,7 @@
 			ev.consumed = true;
 		}
 	}
-	
+
 	/** allow user input on control item */
 	private void activateControl(final Control ctrl) {
 		if (ctrl.change(0, ControlConstants.Disabled))
@@ -685,13 +686,13 @@
 		//FIXME: take care of renaming waypoints
 		//FIXME: add method to convert back text of difficulty &amp; terrain buttons
 		//FIXME: check if manual changes have converted a cache from incomplete to complete
-		
+
 		// We have to update two objects: thisCache (a CacheHolderDetail) which
 		// contains
 		// the full cache which will be written to the cache.xml file AND
 		// the CacheHolder object which sits in cacheDB
 		//FIXME: so how do we do this??
-		
+
 		// Strip the found message if the status contains a date
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, &quot;Found&quot;))
 				&amp;&amp; chcStatus.getText().length() &gt;= MyLocale
@@ -750,11 +751,11 @@
 		// because all changes
 		// affecting the details are immediately saved
 		// Now update the table
-		
+
 		cache.checkIncomplete();
-		
+
 		/*
-		 * The references have to be rebuilt if: 
+		 * The references have to be rebuilt if:
 		 * - the cachetype changed from addi-&gt;normal or from normal-&gt;addi
 		 * - the old cachetype or the new cachetype were 'addi' and the waypointname has changed
 		 */
@@ -778,13 +779,13 @@
 		if (!oldWaypoint.equals(cache.getWayPoint())){
 		 // Delete old XML - File
 			cache.getFreshDetails().deleteFile(Global.getProfile().dataDir+oldWaypoint+&quot;.xml&quot;);
-		}		
+		}
 	}
-	
+
 	/**
 	 * convert the string displayed in the terrain in difficulty buttons to a byte for intrernal use&lt;br&gt;
 	 * assumes that the relevant information will at positions 3 and 5 in a 0 indexed string
-	 * @param button button control to get the text from 
+	 * @param button button control to get the text from
 	 * @param td localized string for abbreviation of terrain or difficulty
 	 * @param isCache true if waypoint is a cache, false for addis and custom
 	 * @return 0 for additional or custum waypoints, -1 for caches if td is not valid, parsed byte otherwise
@@ -792,7 +793,7 @@
 	private byte decodeTerrDiff(mButton button, String td, boolean isCache) {
 		// terrain and difficulty are always unset for non cache waypoints
 		if (! isCache) return CacheTerrDiff.CW_DT_UNSET;
-		
+
 		// cut off beginning of string
 		String buttonText = button.getText().substring(td.length()+2);
 		// we now should have a string of length 3
@@ -803,7 +804,7 @@
 
 		// unset value is invalid
 		if (&quot;--&quot;.equals(buttonText)) return CacheTerrDiff.CW_DT_ERROR;
-		
+
 		return Byte.parseByte(buttonText);
 	}
 
@@ -811,8 +812,8 @@
 
 		private final DispPanel disp = new DispPanel();
 		private final mButton btCancel;
-		
 
+
 		TravelbugInCacheScreen(String text, String title) {
 			super();
 			this.setTitle(title);

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/MainForm.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -89,8 +89,7 @@
 			infB.exec();
 			infB.waitUntilPainted(100);
 			profile.readIndex(infB);
-			pref.curCentrePt.set(profile.centre);
-			profile.updateBearingDistance();
+			pref.setCurCentrePt(profile.centre);
 			setTitle(&quot;Cachewolf &quot;+Version.getRelease()+&quot; - &quot;+profile.name);
 		} catch (Exception e){
 			if(pref.debug == true) Vm.debug(&quot;MainForm:: Exception:: &quot; + e.toString());

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/MainMenu.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -70,11 +70,11 @@
 	private static boolean searchInLogs = false;
 
 	public MainMenu(Form f){
-		
+
 		Global.getPref().setgpsbabel();
-		
+
 		father = f;
-	
+
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for profiles, part of &quot;Application&quot; menu below
 		///////////////////////////////////////////////////////////////////////
@@ -90,12 +90,12 @@
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] mnuImport = new MenuItem[7];
 		mnuImport[0] = loadcaches  = new MenuItem(MyLocale.getMsg(129,&quot;Import GPX&quot;)); //TODO internationalization
-		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,&quot;Download from opencaching&quot;)); 
-		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,&quot;Spider from geocaching.com&quot;)); 
-		mnuImport[3] = spiderAllFinds = new MenuItem(MyLocale.getMsg(217,&quot;Spider all finds from geocaching.com&quot;)); 
+		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,&quot;Download from opencaching&quot;));
+		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,&quot;Spider from geocaching.com&quot;));
+		mnuImport[3] = spiderAllFinds = new MenuItem(MyLocale.getMsg(217,&quot;Spider all finds from geocaching.com&quot;));
 		mnuImport[4] = update         = new MenuItem(MyLocale.getMsg(1014,&quot;Update cache data&quot;));
-		mnuImport[5] = mnuSeparator   = new MenuItem(&quot;-&quot;); 
-		mnuImport[6] = mnuForceLogin  = new MenuItem(MyLocale.getMsg(216,&quot;Always login to GC&quot;)); 
+		mnuImport[5] = mnuSeparator   = new MenuItem(&quot;-&quot;);
+		mnuImport[6] = mnuForceLogin  = new MenuItem(MyLocale.getMsg(216,&quot;Always login to GC&quot;));
 		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175,&quot;Import&quot;));
 		if (Global.getPref().forceLogin) mnuForceLogin.modifiers^=MenuItem.Checked;
 
@@ -114,7 +114,7 @@
 		exitems[7] = exportLOC = new MenuItem(MyLocale.getMsg(215,&quot;to LOC&quot;));
 		exitems[8] = exportGPS = new MenuItem(MyLocale.getMsg(122,&quot;to GPS&quot;));
 		if ( Global.getPref().gpsbabel == null ) {
-			exitems[8].modifiers = MenuItem.Disabled;	
+			exitems[8].modifiers = MenuItem.Disabled;
 		}
 		exitems[9] = exportOZI = new MenuItem(MyLocale.getMsg(124,&quot;to OZI&quot;));
 		exitems[10] = exportKML = new MenuItem(MyLocale.getMsg(125,&quot;to Google Earth&quot;));
@@ -137,8 +137,8 @@
 		// Create the &quot;Application&quot; pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem [] appMenuItems=new MenuItem[11];
-		appMenuItems[0] = new MenuItem(MyLocale.getMsg(121,&quot;Profile&quot;), 0, profileMenu); 
-		appMenuItems[1] = preferences = new MenuItem(MyLocale.getMsg(108,&quot;Preferences&quot;)); 
+		appMenuItems[0] = new MenuItem(MyLocale.getMsg(121,&quot;Profile&quot;), 0, profileMenu);
+		appMenuItems[1] = preferences = new MenuItem(MyLocale.getMsg(108,&quot;Preferences&quot;));
 		appMenuItems[2] = mnuEditCenter = new MenuItem(MyLocale.getMsg(1110,&quot;Centre&quot;));
 		appMenuItems[3] = mnuContext = new MenuItem(MyLocale.getMsg(134,&quot;Current Cache&quot;));
 		appMenuItems[4] = mnuSeparator;
@@ -146,8 +146,8 @@
 		appMenuItems[6] = new MenuItem(MyLocale.getMsg(107,&quot;Export&quot;),0,exportMenu);
 		appMenuItems[7] = new MenuItem(MyLocale.getMsg(149,&quot;Maps&quot;),0,mapsMenu);
 		appMenuItems[8] = mnuSeparator;
-		appMenuItems[9] = savenoxit = new MenuItem(MyLocale.getMsg(127,&quot;Save&quot;)); 
-		//appMenuItems[10] = savenexit = new MenuItem(MyLocale.getMsg(110,&quot;Save &amp; Exit&quot;)); 
+		appMenuItems[9] = savenoxit = new MenuItem(MyLocale.getMsg(127,&quot;Save&quot;));
+		//appMenuItems[10] = savenexit = new MenuItem(MyLocale.getMsg(110,&quot;Save &amp; Exit&quot;));
 		appMenuItems[10] = exit = new MenuItem(MyLocale.getMsg(111,&quot;Exit&quot;));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(120,&quot;Application&quot;),new Menu(appMenuItems,null)));
 
@@ -155,7 +155,7 @@
 		// Create the &quot;Search&quot; pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] searchMenuItems=new MenuItem[3];
-		searchMenuItems[0] = search = new MenuItem(MyLocale.getMsg(112,&quot;Search$&quot;+(char)6)); // char 6 = ctrl +f 
+		searchMenuItems[0] = search = new MenuItem(MyLocale.getMsg(112,&quot;Search$&quot;+(char)6)); // char 6 = ctrl +f
 		searchMenuItems[1] = searchAll = new MenuItem(MyLocale.getMsg(133,&quot;Search All&quot;));
 		searchMenuItems[2] = searchClr = new MenuItem(MyLocale.getMsg(113,&quot;Clear search&quot;));
 
@@ -163,9 +163,9 @@
 		// Create the &quot;Filter&quot; pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] filterMenuItems=new MenuItem[9];
-		filterMenuItems[0] = filtApply  = new MenuItem(MyLocale.getMsg(709,&quot;Apply&quot;)); 
-		filterMenuItems[1] = filtCreate  = new MenuItem(MyLocale.getMsg(114,&quot;Create&quot;)); 
-		filterMenuItems[2] = filtInvert  = new MenuItem(MyLocale.getMsg(115,&quot;Invert&quot;)); 
+		filterMenuItems[0] = filtApply  = new MenuItem(MyLocale.getMsg(709,&quot;Apply&quot;));
+		filterMenuItems[1] = filtCreate  = new MenuItem(MyLocale.getMsg(114,&quot;Create&quot;));
+		filterMenuItems[2] = filtInvert  = new MenuItem(MyLocale.getMsg(115,&quot;Invert&quot;));
 		filterMenuItems[3] = filtClear   = new MenuItem(MyLocale.getMsg(116,&quot;Clear&quot;));
 		filterMenuItems[4] = mnuSeparator;
 		filterMenuItems[5] = filtSelected = new MenuItem(MyLocale.getMsg(160,&quot;Filter selected&quot;));
@@ -195,7 +195,7 @@
 		//filterAndSearchMenuItems[12] = mnuSeparator;
 		//filterAndSearchMenuItems[13] = cacheTour;
 
-		// Depending on screen width display either filter and search menus or the combined menu 
+		// Depending on screen width display either filter and search menus or the combined menu
 		if (MyLocale.getScreenWidth()&gt;300) {
 			this.addMenu(new PullDownMenu(MyLocale.getMsg(112,&quot;Search&quot;),new Menu(searchMenuItems,null)));
 			this.addMenu(new PullDownMenu(MyLocale.getMsg(159,&quot;Filter&quot;),new Menu(filterMenuItems,null)));
@@ -209,8 +209,8 @@
 		MenuItem[] organiseMenuItems=new MenuItem[11];
 		organiseMenuItems[0] = orgNewWP = new MenuItem(MyLocale.getMsg(214,&quot;New Waypoint&quot;));
 		organiseMenuItems[1] = mnuSeparator;
-		organiseMenuItems[2] = orgCopy  = new MenuItem(MyLocale.getMsg(141,&quot;Copy&quot;)); 
-		organiseMenuItems[3] = orgMove  = new MenuItem(MyLocale.getMsg(142,&quot;Move&quot;)); 
+		organiseMenuItems[2] = orgCopy  = new MenuItem(MyLocale.getMsg(141,&quot;Copy&quot;));
+		organiseMenuItems[3] = orgMove  = new MenuItem(MyLocale.getMsg(142,&quot;Move&quot;));
 		organiseMenuItems[4] = orgDelete   = new MenuItem(MyLocale.getMsg(143,&quot;Delete&quot;));
 		organiseMenuItems[5] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,&quot;Rebuild Index&quot;));
 		organiseMenuItems[6] = orgCheckNotesAndSolver = new MenuItem(MyLocale.getMsg(220,&quot;Check Notes/Solver&quot;));
@@ -226,10 +226,10 @@
 		// Create the &quot;About&quot; pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] aboutMenuItems=new MenuItem[5];
-		aboutMenuItems[0] = about = new MenuItem(MyLocale.getMsg(117,&quot;About&quot;)); 
-		aboutMenuItems[1] = legend = new MenuItem(MyLocale.getMsg(155,&quot;Legend&quot;)); 
-		aboutMenuItems[2] = wolflang = new MenuItem(MyLocale.getMsg(118,&quot;WolfLanguage&quot;)); 
-		aboutMenuItems[3] = sysinfo = new MenuItem(MyLocale.getMsg(157,&quot;System&quot;)); 
+		aboutMenuItems[0] = about = new MenuItem(MyLocale.getMsg(117,&quot;About&quot;));
+		aboutMenuItems[1] = legend = new MenuItem(MyLocale.getMsg(155,&quot;Legend&quot;));
+		aboutMenuItems[2] = wolflang = new MenuItem(MyLocale.getMsg(118,&quot;WolfLanguage&quot;));
+		aboutMenuItems[3] = sysinfo = new MenuItem(MyLocale.getMsg(157,&quot;System&quot;));
 		aboutMenuItems[4] = chkVersion = new MenuItem(MyLocale.getMsg(158,&quot;Version Check&quot;));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(117,&quot;About&quot;),new Menu(aboutMenuItems,null)));
 	}
@@ -241,7 +241,7 @@
 				mnuContext.subMenu = tbp.tc.getMenuFull();
 			else
 				mnuContext.subMenu = tbp.tc.getMenuSmall();
-		}		
+		}
 	}
 
 	public void allowProfileChange(boolean profileChangeAllowed) {
@@ -278,11 +278,11 @@
 		if (ev instanceof MenuEvent){ //&amp;&amp; ev.type == MenuEvent.PRESSED
 			MenuEvent mev = (MenuEvent)ev;
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for profiles, part of &quot;Application&quot; menu 
+			// subMenu for profiles, part of &quot;Application&quot; menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == mnuNewProfile){
 				if (NewProfileWizard.startNewProfileWizard(getFrame()) ) {
-					pref.curCentrePt = new CWPoint(profile.centre);
+					pref.setCurCentrePt(profile.centre);
 		            filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
 					tbp.refreshTable();
 				}
@@ -299,7 +299,7 @@
 					Vm.showWait(infB, true);
 					profile.readIndex(infB);
 					Vm.showWait(infB, false);
-					pref.curCentrePt.set(profile.centre);
+					pref.setCurCentrePt(profile.centre);
                     filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
 					Global.mainForm.setTitle(&quot;Cachewolf &quot;+Version.getRelease()+&quot; - &quot;+profile.name);
 					infB.close(0);
@@ -319,7 +319,7 @@
 				f.close(0);
 			}
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for import, part of &quot;Application&quot; menu 
+			// subMenu for import, part of &quot;Application&quot; menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == spider){
 				SpiderGC spGC = new SpiderGC(pref, profile, true);
@@ -356,9 +356,9 @@
 							else how = GPXImporter.DOIT_NOSPOILER;
 					}
 					 */
-					
+
 					int how = GPXImporter.DOIT_ASK;
-					for (int i = 0; i &lt; files.length; i++){ 
+					for (int i = 0; i &lt; files.length; i++){
 						String file = dir + &quot;/&quot; + files[i];
 						if (file.endsWith(&quot;loc&quot;)){
 							LOCXMLImporter loc = new LOCXMLImporter(pref, profile, file);
@@ -382,7 +382,7 @@
                 filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
 				tbp.resetModel();
 			}
-			if (mev.selectedItem == update) 
+			if (mev.selectedItem == update)
 				updateSelectedCaches(tbp);
 			if(mev.selectedItem == mnuForceLogin) {
 				mnuForceLogin.modifiers^=MenuItem.Checked;
@@ -390,7 +390,7 @@
 				Global.getPref().savePreferences();
 			}
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for export, part of &quot;Application&quot; menu 
+			// subMenu for export, part of &quot;Application&quot; menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == exporthtml){
 				HTMLExporter htm = new HTMLExporter(pref, profile);
@@ -399,7 +399,7 @@
 			if(mev.selectedItem == exportGpxNg){
 				GpxExportNg gpx = new GpxExportNg();
 				gpx.doit();
-			} 
+			}
 			if(mev.selectedItem == exporttop50){
 				OVLExporter ovl = new OVLExporter(pref, profile);
 				ovl.doIt();
@@ -471,7 +471,7 @@
 				mag.doIt();
 			}
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for maps, part of &quot;Application&quot; menu 
+			// subMenu for maps, part of &quot;Application&quot; menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == downloadmap){
 				MapLoaderGui mLG = new MapLoaderGui(cacheDB);
@@ -529,13 +529,13 @@
 			if(mev.selectedItem == searchAll){
 				SearchCache ssc = new SearchCache(cacheDB);
 				ssc.clearSearch();
-				tbp.refreshTable();		
+				tbp.refreshTable();
                 search();
 			}
 			if(mev.selectedItem == searchClr){
 				SearchCache ssc = new SearchCache(cacheDB);
 				ssc.clearSearch();
-				tbp.refreshTable();		
+				tbp.refreshTable();
 			}
 			///////////////////////////////////////////////////////////////////////
 			// &quot;Filter&quot; pulldown menu
@@ -663,13 +663,13 @@
 			}
 			if(mev.selectedItem == cacheTour){
 				cacheTour.modifiers^=MenuItem.Checked;
-				Global.mainForm.toggleCacheListVisible();			
+				Global.mainForm.toggleCacheListVisible();
 			}
 			if(mev.selectedItem == orgRater) {
 				Rating rater = new Rating();
 				rater.run();
 			}
-			
+
 			///////////////////////////////////////////////////////////////////////
 			// &quot;About&quot; pulldown menu
 			///////////////////////////////////////////////////////////////////////
@@ -699,11 +699,11 @@
 				sb.append(&quot;&lt;br&gt;&quot;);
 				sb.append(MyLocale.getMsg(261, &quot;Locale lang is:&quot;));
 				sb.append(' ');
-				sb.append(MyLocale.getLocaleLanguage()); 
+				sb.append(MyLocale.getLocaleLanguage());
 				sb.append(&quot;&lt;br&gt;&quot;);
 				sb.append(MyLocale.getMsg(262, &quot;Locale country is:&quot;));
 				sb.append(' ');
-				sb.append(MyLocale.getLocaleCountry()); 
+				sb.append(MyLocale.getLocaleCountry());
 				sb.append(&quot;&lt;br&gt;&quot;);
 				sb.append(MyLocale.getMsg(263, &quot;Decimal separator is:&quot;));
 				sb.append(&quot; \&quot;&quot;);
@@ -715,8 +715,8 @@
 				sb.append(&quot;&lt;br&gt;&quot;);
 				sb.append(MyLocale.getMsg(265, &quot;Screen:&quot;));
 				sb.append(' ');
-				sb.append(MyLocale.getScreenWidth()); 
-				sb.append(&quot; x &quot;);	 sb.append(MyLocale.getScreenHeight()); 
+				sb.append(MyLocale.getScreenWidth());
+				sb.append(&quot; x &quot;);	 sb.append(MyLocale.getScreenHeight());
 				sb.append(&quot;&lt;br&gt;&quot;);
 				sb.append(MyLocale.getMsg(266, &quot;Font size:&quot;));
 				sb.append(' ');
@@ -752,11 +752,11 @@
 			if(mev.selectedItem == chkVersion){
 				(new MessageBox(MyLocale.getMsg(178, &quot;Version Checking&quot;), Version.getUpdateMessage(), FormBase.OKB)).execute();
 			}
-			
+
 			// In case that the triggered event was due to one of the context menu items, process
 			// the event by the context menu handler
 			tbp.tc.popupMenuEvent(mev.selectedItem);
-			
+
 		} else if (ev instanceof ControlEvent) {
 			if (ev.type == ControlEvent.MENU_SHOWN) {
 				Global.mainTab.tbP.tc.adjustAddiHideUnhideMenu();
@@ -769,10 +769,10 @@
 		Profile profile=Global.getProfile();
 		CacheDB cacheDB=profile.cacheDB;
 		CacheHolder ch;
-		
+
 		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(5003,&quot;Options&quot;), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.ALL);
 		if (options.execute() == FormBase.IDCANCEL) {	return; }
-				
+
 		SpiderGC spider = new SpiderGC(pref, profile, false);
 		OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
 		//Vm.debug(&quot;ByPass? &quot; + profile.byPassIndexActive);
@@ -781,9 +781,9 @@
 		boolean alreadySaid2 = false;
 		InfoBox infB = new InfoBox(&quot;Info&quot;, &quot;Loading&quot;, InfoBox.PROGRESS_WITH_WARNINGS);
 		infB.exec();
-		
+
 		boolean loadAllLogs = (pref.maxLogsToSpider &gt; 5);
-		
+
 		Vector cachesToUpdate = new Vector();
 		for(int i = 0; i &lt;	cacheDB.size(); i++){
 			ch = cacheDB.get(i);
@@ -828,7 +828,7 @@
 				} else if (test == SpiderGC.SPIDER_ERROR) {
 					spiderErrors++;
 				} else {
-					//profile.hasUnsavedChanges=true;	
+					//profile.hasUnsavedChanges=true;
 				}
 				forceLogin=false;
 			}
@@ -836,9 +836,9 @@
 				if (!ocSync.syncSingle(i, infB)) {
 					infB.close(0);
 					break;
-				} else { 
+				} else {
 					//profile.hasUnsavedChanges=true;
-				}	
+				}
 			}
 
 //			cacheDB.clear();
@@ -852,7 +852,7 @@
 		Vm.showWait(false);
 		if ( spiderErrors &gt; 0) {
 			new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;),spiderErrors + MyLocale.getMsg(5516,&quot; cache descriptions%0acould not be loaded.&quot;),FormBase.DEFOKB).execute();
-		}		
+		}
 	}
-	
+
 }

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/MainTab.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -420,10 +420,14 @@
 		if (pref.setCurrentCentreFromGPSPosition){
 			boolean gpsPosIsValid=nav.gpsPos.isValid();
 			if (gpsPosIsValid) {
-				CWPoint whereAmI = nav.gpsPos;
-				if (whereAmI != pref.curCentrePt) {
-					pref.curCentrePt.set(whereAmI);
-					this.updateBearDist();
+				double latWhereAmI, lonWhereAmI, latCurCentr, lonCurCentr;
+				latWhereAmI = nav.gpsPos.latDec;
+				lonWhereAmI = nav.gpsPos.lonDec;
+				latCurCentr = pref.getCurCentrePt().latDec;
+				lonCurCentr = pref.getCurCentrePt().lonDec;
+				if (latWhereAmI != latCurCentr ||
+					lonWhereAmI != lonCurCentr ) {
+					pref.setCurCentrePt(nav.gpsPos);
 				}
 			}
 		}

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/Parser.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -402,12 +402,11 @@
     /** Get or set the current centre */
 	private void funcCenter(int nargs) throws Exception {
 		if (nargs==0) {
-			calcStack.add(Global.getPref().curCentrePt.toString());
+			calcStack.add(Global.getPref().getCurCentrePt().toString());
 		} else {
 	    	String coordA=popCalcStackAsString();
 			if (!isValidCoord(coordA)) err(MyLocale.getMsg(1712,&quot;Invalid coordinate: &quot;)+coordA);
-			Global.getPref().curCentrePt.set(coordA);
-			Global.getProfile().updateBearingDistance();
+			Global.getPref().setCurCentrePt(new CWPoint(coordA));
 		}
 	}
 
@@ -553,7 +552,7 @@
     		}
     		ch.LatLon=cwPt.toString(TransformCoordinates.CW);
     		ch.pos.set(cwPt);
-    		ch.calcDistance(Global.getPref().curCentrePt); // Update distance/bearing
+    		ch.calcDistance(Global.getPref().getCurCentrePt()); // Update distance/bearing
     		nav.setDestination(ch);
     	    Global.getProfile().selectionChanged=true; // Tell moving map to updated displayed waypoints
     	}
@@ -1003,7 +1002,7 @@
 				if (cwPt.isValid() || coord.equals(&quot;&quot;)) { // Can clear coord with empty string
 					ch.LatLon=cwPt.toString(TransformCoordinates.CW);
 					ch.pos.set(cwPt);
-					ch.calcDistance(Global.getPref().curCentrePt); // Update distance and bearing
+					ch.calcDistance(Global.getPref().getCurCentrePt()); // Update distance and bearing
 		    	    Global.getProfile().selectionChanged=true; // Tell moving map to updated displayed waypoints
 				    return;
 				} else

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -201,7 +201,7 @@
 	public boolean downloadmissingOC = false;
 	/** The currently used centre point, can be different from the profile's centrepoint. This is used
 	 *  for spidering */
-	public CWPoint curCentrePt=new CWPoint();
+	private CWPoint curCentrePt=new CWPoint();
 	/** True if a login screen is displayed on each spider operation */
 	public boolean forceLogin=true;
 	/** True if the goto panel is North centered */
@@ -709,6 +709,23 @@
 		}
 	}
 
+	private myTableModel table;
+	public void setMyTableModel(myTableModel myTableModel) {table=myTableModel;}
+	public CWPoint getCurCentrePt() {return curCentrePt;}
+	public void setCurCentrePt(CWPoint newCentre) {
+		curCentrePt.set(newCentre);
+		Global.getProfile().updateBearingDistance();
+		// if corresponding column ist sorted
+		if (table != null) {
+			if (table.sortedBy == 10) {
+				table.sortTable(10, table.sortAscending);
+				// oder ??? 
+				// TablePanel.refreshTable();
+			}
+			else table.tcControl.repaint();
+		}
+	}
+
 	/**
 	 * gets the path to the calibrated maps
 	 * it first tries if there are manually imported maps

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/Profile.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -168,7 +168,7 @@
 			return;
 		}
 		CWPoint savedCentre=centre;
-		if (centre==null || !centre.isValid() || (savedCentre.latDec==0.0 &amp;&amp; savedCentre.lonDec==0.0)) savedCentre=pref.curCentrePt;
+		if (centre==null || !centre.isValid() || (savedCentre.latDec==0.0 &amp;&amp; savedCentre.lonDec==0.0)) savedCentre=pref.getCurCentrePt();
 
 		try{
 			detfile.print(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;ISO-8859-1\&quot;?&gt;\n&quot;);
@@ -548,7 +548,7 @@
 	 *	@see	Extractor
 	 */
 	public void updateBearingDistance(){
-		CWPoint centerPoint = new CWPoint(Global.getPref().curCentrePt); // Clone current centre to be sure
+		CWPoint centerPoint = new CWPoint(Global.getPref().getCurCentrePt()); // Clone current centre to be sure
 		int anz = cacheDB.size();
 		CacheHolder ch;
 		// Jetzt durch die CacheDaten schleifen

Modified: trunk/src/CacheWolf/ProfileDataForm.java
===================================================================
--- trunk/src/CacheWolf/ProfileDataForm.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/ProfileDataForm.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -29,18 +29,18 @@
 		super();
 		pref=p;
 		profile=prof;
-		
+
     	resizable =  false;
 		content.setText(MyLocale.getMsg(1115,&quot;Centre&quot;));
 		content.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_RECT;
-	    //defaultTags.set(this.INSETS,new Insets(2,2,2,2));		
+	    //defaultTags.set(this.INSETS,new Insets(2,2,2,2));
 		title = MyLocale.getMsg(1118,&quot;Profile&quot;)+&quot;: &quot;+profile.name;
-		content.addNext(new mLabel(MyLocale.getMsg(600,&quot;Preferences&quot;)));		
+		content.addNext(new mLabel(MyLocale.getMsg(600,&quot;Preferences&quot;)));
 		content.addLast(chkSetCurrentCentreFromGPSPosition = new mCheckBox(MyLocale.getMsg(646,&quot;centre from GPS&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		// content.addLast(btnGPS2Cur=new mButton(&quot;   v   &quot;),DONTSTRETCH,DONTFILL|LEFT);
-		if (pref.setCurrentCentreFromGPSPosition) chkSetCurrentCentreFromGPSPosition.setState(true);		
+		if (pref.setCurrentCentreFromGPSPosition) chkSetCurrentCentreFromGPSPosition.setState(true);
 		content.addNext(new mLabel(MyLocale.getMsg(1116,&quot;Current&quot;)));
-		content.addLast(btnCurrentCentre=new mButton(pref.curCentrePt.toString()),HSTRETCH,HFILL|LEFT);
+		content.addLast(btnCurrentCentre=new mButton(pref.getCurCentrePt().toString()),HSTRETCH,HFILL|LEFT);
 		content.addNext(new mLabel(&quot;      &quot;),HSTRETCH,HFILL);
 		content.addNext(btnCur2Prof=new mButton(&quot;   v   &quot;),DONTSTRETCH,DONTFILL|LEFT);
 		content.addNext(new mLabel(MyLocale.getMsg(1117,&quot;copy&quot;)));
@@ -52,7 +52,7 @@
 		//addNext(btnCancel = new mButton(MyLocale.getMsg(1604,&quot;Cancel&quot;)),DONTSTRETCH,DONTFILL|LEFT);
 		addLast(btnOK = new mButton(&quot;OK&quot;),DONTSTRETCH,HFILL|RIGHT);
 	}
-	
+
 	/**
 	*	The event handler to react to a users selection.
 	*	A return value is created and passed back to the calling form
@@ -69,10 +69,10 @@
 			}
 			if (ev.target == btnCurrentCentre){
 				CoordsScreen cs = new CoordsScreen();
-				cs.setFields(pref.curCentrePt, TransformCoordinates.CW);
+				cs.setFields(pref.getCurCentrePt(), TransformCoordinates.CW);
 				if (cs.execute()== FormBase.IDOK){
-					pref.curCentrePt.set(cs.getCoords());
-					btnCurrentCentre.setText(pref.curCentrePt.toString());
+					pref.setCurCentrePt(cs.getCoords());
+					btnCurrentCentre.setText(pref.getCurCentrePt().toString());
 					Global.getProfile().updateBearingDistance();
 				}
 			}
@@ -86,13 +86,13 @@
 				}
 			}
 			if (ev.target == btnCur2Prof){
-				profile.notifyUnsavedChanges(pref.curCentrePt.equals(profile.centre));
-				profile.centre.set(pref.curCentrePt);
+				profile.notifyUnsavedChanges(pref.getCurCentrePt().equals(profile.centre));
+				profile.centre.set(pref.getCurCentrePt());
 				btnProfileCentre.setText(profile.centre.toString());
 			}
 			if (ev.target == btnProf2Cur){
-				pref.curCentrePt.set(profile.centre);
-				btnCurrentCentre.setText(pref.curCentrePt.toString());
+				pref.setCurCentrePt(profile.centre);
+				btnCurrentCentre.setText(pref.getCurCentrePt().toString());
 				Global.getProfile().updateBearingDistance();
 			}
 		}

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/StatusBar.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -83,7 +83,7 @@
 		// Otherwise it forces a scrollbar
 		// This can happen even on bigger screens with big fonts
 		if ((MyLocale.getScreenWidth()&gt;=320) &amp;&amp; !(MobileVGA &amp;&amp; (pref.fontSize &gt; 20)))
-			strCenter=&quot;  \u00a4 &quot; + pref.curCentrePt.toString();
+			strCenter=&quot;  \u00a4 &quot; + pref.getCurCentrePt().toString();
 
 		lblCenter.setText(strCenter);
 		relayout(true); // in case the numbers increased and need more space

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/TablePanel.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -39,6 +39,7 @@
 		myMod.hasColumnHeaders  = true;
 		tc.setTableModel(myMod);
 		statBar.setMyTableModel(myMod);
+		pref.setMyTableModel(myMod);
 	}
 	
 	/** Mark the row as selected so that myTableModel can color it grey */

Modified: trunk/src/CacheWolf/exp/OVLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/OVLExporter.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/exp/OVLExporter.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -8,13 +8,13 @@
 *	the TOP50 map products (mainly available in german speaking countries).
 */
 public class OVLExporter extends Exporter{
-	
+
 	public OVLExporter(Preferences p, Profile prof){
 		super();
 		this.setMask(&quot;*.ovl&quot;);
 		this.setHowManyParams(LAT_LON|COUNT);
 	}
-	
+
 	public String record(CacheHolder ch, String lat, String lon, int counter){
 		StringBuffer str = new StringBuffer(200);
 		double tmp;
@@ -47,7 +47,7 @@
 
 		return str.toString();
 	}
-	
+
 	public String trailer(int counter){
 		StringBuffer str = new StringBuffer(200);
 
@@ -58,8 +58,8 @@
 		str.append(&quot;MapName=Gesamtes Bundesgebiet (D1000)\r\n&quot;);
 		str.append(&quot;DimmFc=100\r\n&quot;);
 		str.append(&quot;ZoomFc=100\r\n&quot;);
-		str.append(&quot;CenterLat=&quot;+pref.curCentrePt.getLatDeg(TransformCoordinates.CW)+&quot;.00\r\n&quot;);
-		str.append(&quot;CenterLong=&quot;+pref.curCentrePt.getLonDeg(TransformCoordinates.CW)+&quot;.00\r\n&quot;);
+		str.append(&quot;CenterLat=&quot;+pref.getCurCentrePt().getLatDeg(TransformCoordinates.CW)+&quot;.00\r\n&quot;);
+		str.append(&quot;CenterLong=&quot;+pref.getCurCentrePt().getLonDeg(TransformCoordinates.CW)+&quot;.00\r\n&quot;);
 		str.append(&quot;RefColor=255\r\n&quot;);
 		str.append(&quot;RefRad=58\r\n&quot;);
 		str.append(&quot;RefLine=6\r\n&quot;);
@@ -68,7 +68,7 @@
 		return str.toString();
 	}
 
-	
+
 /*	public void doIt(){
 		CacheHolder holder;
 		ParseLatLon pll;
@@ -112,7 +112,7 @@
 						outp.print(&quot;Text=&quot;+holder.wayPoint+&quot;\r\n&quot;);
 						symCounter++;
 					}//if holder...
-				}//for ... i &lt; cacheDB ...			
+				}//for ... i &lt; cacheDB ...
 				// overlay section
 				outp.print(&quot;[Overlay]\r\n&quot;);
 				outp.print(&quot;Symbols=&quot;+Convert.toString(symCounter-1)+&quot;\r\n&quot;);
@@ -128,7 +128,7 @@
 				outp.print(&quot;RefLine=6\r\n&quot;);
 				outp.print(&quot;RefOn=0\r\n&quot;);
 				outp.print(&quot;\r\n&quot;);
-				
+
 				outp.close();
 			}catch(Exception e){
 				Vm.debug(&quot;Error writing to OVL file! &quot;+e.toString());

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -34,7 +34,7 @@
 import ewe.sys.Double;
 
 /**
- *	Class to import Data from opencaching. 
+ *	Class to import Data from opencaching.
  *	It uses the lastmodified parameter to identify new or changed caches.
  *	See here: <A HREF="http://www.opencaching.com/phpBB2/viewtopic.php?t=281">http://www.opencaching.com/phpBB2/viewtopic.php?t=281</A> (out-dated)
  *   See here: <A HREF="http://www.opencaching.de/doc/xml/xml11.htm">http://www.opencaching.de/doc/xml/xml11.htm</A> and <A HREF="http://develforum.opencaching.de/viewtopic.php?t=135&amp;postdays=0&amp;postorder=asc&amp;start=0">http://develforum.opencaching.de/viewtopic.php?t=135&amp;postdays=0&amp;postorder=asc&amp;start=0</A>
@@ -46,7 +46,7 @@
 	static protected final int STAT_CACHE_DESC = 2;
 	static protected final int STAT_CACHE_LOG = 3;
 	static protected final int STAT_PICTURE = 4;
-	
+
 	public final static String OPENCACHING_DE_HOST = &quot;www.opencaching.de&quot;;
 	public final static String OPENCACHING_DE_PATTERN = &quot;OC&quot;;
 	public final static String OPENCACHING_PL_HOST = &quot;www.opencaching.pl&quot;;
@@ -55,9 +55,9 @@
 	public final static String OPENCACHING_CZ_PATTERN = &quot;OZ&quot;;
 	public final static String OPENCACHING_UK_HOST = &quot;www.opencaching.org.uk&quot;;
 	public final static String OPENCACHING_UK_PATTERN = &quot;OK&quot;;
-	
+
 	String hostname;
-	
+
 	int state = STAT_INIT;
 	int numCacheImported, numDescImported, numLogImported= 0;
 
@@ -106,9 +106,9 @@
 			if (!ch.getOcCacheID().equals(&quot;&quot;))
 				DBindexID.put(ch.getOcCacheID(), new Integer(i));
 		}//for
-		
+
 	}
-	
+
 	protected void setHostname(String wpName){
 		if(wpName.startsWith(OPENCACHING_DE_PATTERN))
 			hostname = OPENCACHING_DE_HOST;
@@ -121,7 +121,7 @@
 	}
 
 	/**
-	 * 
+	 *
 	 * @param number
 	 * @param infB
 	 * @return true, if some change was made to the cacheDB
@@ -131,7 +131,7 @@
 		ch = cacheDB.get(number);
 		setHostname(ch.getWayPoint());
 		holder= null;
-		
+
 		if (infB.isClosed) {
 			// there could have been an update before
 			return true;
@@ -141,7 +141,7 @@
 		inf.setPreferredSize(220, 300);
 		inf.relayout(false);
 		inf.exec();
-		String lastS; 
+		String lastS;
 		/** pref.downloadmissingOC = true, if not the last syncdate shall be used,
 		 *  but the caches shall be reloaded
 		 *  only used in syncSingle  */
@@ -152,8 +152,8 @@
 		}
 		dateOfthisSync = new Time();
 		dateOfthisSync.parse(lastS, &quot;yyyyMMddHHmmss&quot;);
-	
 
+
 		String url = new String();
 		picCnt = 0;
 		//Build url
@@ -161,7 +161,7 @@
 			+ &quot;modifiedsince=&quot; + lastS
 			+ &quot;&amp;cache=1&quot;
 			+ &quot;&amp;cachedesc=1&quot;;
-		
+
 		if (pref.downloadPics) url += &quot;&amp;picture=1&quot;;
 		else url += &quot;&amp;picture=0&quot;;
 		url += &quot;&amp;cachelog=1&quot;
@@ -182,7 +182,7 @@
 		String url = new String();
 
 		String lastS =  profile.getLast_sync_opencaching();
-		CWPoint centre = pref.curCentrePt; // No need to clone curCentrePt as centre is only read
+		CWPoint centre = pref.getCurCentrePt(); // No need to clone curCentrePt as centre is only read
 		if (!centre.isValid()) {
 			(new MessageBox(&quot;Error&quot;, &quot;Coordinates for centre must be set&quot;, FormBase.OKB)).execute();
 			return;
@@ -193,12 +193,12 @@
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
 		Vm.showWait(true);
 		String dist = importOpt.distanceInput.getText();
-		
+
 		if (importOpt.domains.getSelectedItem()!=null)
 			hostname = (String)importOpt.domains.getSelectedItem();
-		
+
 		if (dist.length()== 0) return;
-		
+
 		Double distDouble = new Double();
 		distDouble.value = Common.parseDouble(dist);
 		dist = distDouble.toString(0, 1, 0).replace(',', '.');
@@ -217,7 +217,7 @@
 			ch.setUpdated(false);
 			ch.setNew(false);
 			ch.setLog_updated(false);
-		}	
+		}
 		picCnt = 0;
 		//Build url
 		url = &quot;<A HREF="http://">http://</A>&quot; + hostname + &quot;/xml/ocxml11.php?&quot;
@@ -245,7 +245,7 @@
 		if (success) {
 			profile.setLast_sync_opencaching(dateOfthisSync.format(&quot;yyyyMMddHHmmss&quot;));
 			//pref.savePreferences();
-			finalMessage = MyLocale.getMsg(1607,&quot;Update from opencaching successful&quot;); 
+			finalMessage = MyLocale.getMsg(1607,&quot;Update from opencaching successful&quot;);
 			inf.addWarning(&quot;\nNumber of&quot;+
 			&quot;\n...caches new/updated: &quot; + numCacheImported +
 			&quot;\n...cache descriptions new/updated: &quot; + numDescImported +
@@ -254,7 +254,7 @@
 		}
 		inf.addOkButton();
 	}
-	
+
 	private boolean syncOC(String url) {
 		String finalMessage = new String();
 		boolean success=true;
@@ -263,7 +263,7 @@
 		String file = new String();
 
 		//inf = new InfoBox(&quot;Opencaching download&quot;, MyLocale.getMsg(1608,&quot;downloading data\n from opencaching&quot;), InfoBox.PROGRESS_WITH_WARNINGS, false);
-		
+
 		picCnt = 0;
 		try{
 			holder = null;
@@ -278,7 +278,7 @@
 			ZipFile zif = new ZipFile (profile.dataDir + file);
 			ZipEntry zipEnt;
 			Enumeration zipEnum = zif.entries();
-			inf.setInfo(&quot;...unzipping update file&quot;); 
+			inf.setInfo(&quot;...unzipping update file&quot;);
 			while (zipEnum.hasMoreElements())
 			{
 				zipEnt = (ZipEntry) zipEnum.nextElement();
@@ -358,7 +358,7 @@
 		//examine data
 		switch (state) {
 		case STAT_CACHE: startCache(name, atts); break;
-		case STAT_CACHE_DESC: startCacheDesc(name, atts); break; 
+		case STAT_CACHE_DESC: startCacheDesc(name, atts); break;
 		case STAT_CACHE_LOG: startCacheLog(name, atts); break;
 		case STAT_PICTURE: startPicture(name,atts); break;
 		}
@@ -400,10 +400,10 @@
 		if(name.equals(&quot;status&quot;)){
             // meaning of OC status :
 			//  1=Kann gesucht werden ;
-			//  2=Momentan nicht verf&#252;gbar ; 
-			//  3=Archiviert ; 
-			//  4= ; 
-			//  5= ; 
+			//  2=Momentan nicht verf&#252;gbar ;
+			//  3=Archiviert ;
+			//  4= ;
+			//  5= ;
 			//  6=Gesperrt ;
 			//  are there more ? ;
 			if (atts.getValue(&quot;id&quot;).equals(&quot;1&quot;)) {
@@ -428,8 +428,8 @@
 		}
 
 	}
-	
 
+
 	private void startCacheDesc(String name, AttributeList atts){
 		inf.setInfo(MyLocale.getMsg(1611,&quot;Importing cache description:&quot;)+&quot; &quot; + numDescImported);
 		if (name.equals(&quot;cachedesc&quot;)){
@@ -438,7 +438,7 @@
 		if (name.equals(&quot;desc&quot;)){
 			holder.setHTML(atts.getValue(&quot;html&quot;).equals(&quot;1&quot;)?true:false);
 		}
-		
+
 		if (name.equals(&quot;language&quot;)) {
 			processingDescLang = atts.getValue(&quot;id&quot;);
 		}
@@ -455,10 +455,10 @@
 		if (name.equals(&quot;logtype&quot;)){
 			logtype = Convert.toInt(atts.getValue(&quot;id&quot;));
 			switch (logtype) {
-			case 1: 
+			case 1:
 				logIcon = GPXImporter.typeText2Image(&quot;Found&quot;);
 				break;
-			case 2:	logIcon = GPXImporter.typeText2Image(&quot;Not Found&quot;); 
+			case 2:	logIcon = GPXImporter.typeText2Image(&quot;Not Found&quot;);
 			holder.setNoFindLogs((byte)(holder.getNoFindLogs()+1));
 			break;
 			case 3: logIcon = GPXImporter.typeText2Image(&quot;Note&quot;);
@@ -466,7 +466,7 @@
 			loggerRecommended = atts.getValue(&quot;recommended&quot;).equals(&quot;1&quot;);
 			return;
 		}
-		
+
 		if (name.equals(&quot;id&quot;)){
 			logId = atts.getValue(&quot;id&quot;);
 		}
@@ -499,7 +499,7 @@
 
 			// save all
 			holder.getFreshDetails().hasUnsavedChanges = true; // this makes CachHolder save the details in case that they are unloaded from memory
-			// chD.saveCacheDetails(profile.dataDir); 
+			// chD.saveCacheDetails(profile.dataDir);
 			// profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR); // this is done after .xml is completly processed
 			return;
 		}
@@ -560,7 +560,7 @@
 				int numDownloaded=1;
 				while (imgRegexUrl.searchFrom(holder.getFreshDetails().LongDescription, descIndex)) { // &quot;img&quot; found
 					imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte &lt;img ...&gt;-tag
-					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen 
+					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen
 					if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
 					if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
 						inf.addWarning(MyLocale.getMsg(1617, &quot;Ignoriere Fehler in html-Cache-Description: \&quot;&lt;img\&quot; without \&quot;src=\&quot; in cache &quot;+holder.getWayPoint()));
@@ -571,8 +571,8 @@
 						imgAltText=imgRegexAlt.stringMatched(1);
 						if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
 						// no alternative text as image title -&gt; use filename
-					} else { 
-						if (fetchUrl.toLowerCase().indexOf(&quot;opencaching.&quot;) &gt; 0 || fetchUrl.toLowerCase().indexOf(&quot;geocaching.com&quot;) &gt; 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend 
+					} else {
+						if (fetchUrl.toLowerCase().indexOf(&quot;opencaching.&quot;) &gt; 0 || fetchUrl.toLowerCase().indexOf(&quot;geocaching.com&quot;) &gt; 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
 							imgAltText = new String(&quot;No image title&quot;);
 						else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf(&quot;/&quot;)+1);
 					}
@@ -592,13 +592,13 @@
 		}
 
 		if (name.equals(&quot;shortdesc&quot;)){
-			String linebraek; 
+			String linebraek;
 
 			if (holder.is_HTML())	linebraek = &quot;&lt;br&gt;\n&quot;;
 			else 					linebraek = &quot;\n&quot;;
 
 			if (holder.is_updated())	holder.getFreshDetails().LongDescription += linebraek + processingDescLang + &quot;:&quot; +  linebraek + strData; // if a long description is already updated, then this one is likely to be in another language
-			else 					 	holder.getFreshDetails().LongDescription =              processingDescLang + &quot;:&quot; +  linebraek + strData; 
+			else 					 	holder.getFreshDetails().LongDescription =              processingDescLang + &quot;:&quot; +  linebraek + strData;
 			return;
 		}
 
@@ -608,7 +608,7 @@
 			return;
 		}
 		if (name.equals(&quot;hint&quot;)){
-			if (holder.is_updated()) 	
+			if (holder.is_updated())
 				holder.getFreshDetails().Hints += &quot;\n&quot; +  processingDescLang + &quot;: &quot; + Common.rot13(strData);
 			else						holder.getFreshDetails().Hints = Common.rot13(strData);
 			holder.setUpdated(true); // remark: this is used in &quot;shortdesc&quot; to decide weather the description should be appended or replaced
@@ -620,13 +620,13 @@
 		String fileName = holder.getWayPoint() + &quot;_&quot; + fetchURL.substring(fetchURL.lastIndexOf(&quot;/&quot;)+1);
 		return Common.ClearForFileName(fileName).toLowerCase();
 	}
-	
+
 	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs
 		try {
-			//TODO this is not quite correct: actually the &quot;base&quot; URL must be known... 
+			//TODO this is not quite correct: actually the &quot;base&quot; URL must be known...
 			// but anyway a different baseURL should not happen very often  - it doesn't in my area
 			if (!fetchURL.startsWith(&quot;<A HREF="http://">http://</A>&quot;)) fetchURL = new URL(
-				new URL(&quot;<A HREF="http://">http://</A>&quot; + hostname+&quot;/&quot;), fetchURL).toString(); 
+				new URL(&quot;<A HREF="http://">http://</A>&quot; + hostname+&quot;/&quot;), fetchURL).toString();
 			String fileName = createPicFilename(fetchURL);
 			ImageInfo imageInfo = new ImageInfo();
 			// add title
@@ -653,11 +653,11 @@
 				if (e == null) ErrMessage = &quot;Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: &quot;+fileName+&quot; from URL:&quot;+fetchURL;
 				else {
 					if (e.getMessage().equalsIgnoreCase(&quot;could not connect&quot;) ||
-							e.getMessage().equalsIgnoreCase(&quot;unkown host&quot;)) { 
+							e.getMessage().equalsIgnoreCase(&quot;unkown host&quot;)) {
 						// is there a better way to find out what happened?
 						ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;)&quot;+MyLocale.getMsg(1619,&quot;: could not download image from URL: &quot;)+fetchURL;
 					} else
-						ErrMessage = new String (MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;): ignoring IOException: &quot;+e.getMessage()+ &quot; while downloading picture:&quot;+fileName+&quot; from URL:&quot;+fetchURL); 
+						ErrMessage = new String (MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;): ignoring IOException: &quot;+e.getMessage()+ &quot; while downloading picture:&quot;+fileName+&quot; from URL:&quot;+fetchURL);
 				}
 				inf.addWarning(&quot;\n&quot;+ErrMessage);
 				//(new MessageBox(MyLocale.getMsg(144, &quot;Warning&quot;), ErrMessage, MessageBox.OKB)).exec();
@@ -665,7 +665,7 @@
 				e.printStackTrace();
 			}
 		} catch (MalformedURLException e) {
-			String ErrMessage = new String (MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;) + holder.getWayPoint() + &quot;: ignoring MalformedUrlException: &quot; + e.getMessage()+ &quot; while downloading from URL:&quot; + fetchURL); 
+			String ErrMessage = new String (MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;) + holder.getWayPoint() + &quot;: ignoring MalformedUrlException: &quot; + e.getMessage()+ &quot; while downloading from URL:&quot; + fetchURL);
 			inf.addWarning(&quot;\n&quot;+ErrMessage);
 			pref.log(ErrMessage);
 		}
@@ -693,7 +693,7 @@
 			holder = getHolder(strData);
 			return;
 		}
-		if(name.equals(&quot;picture&quot;)){ 
+		if(name.equals(&quot;picture&quot;)){
 			//String fileName = holder.wayPoint + &quot;_&quot; + picUrl.substring(picUrl.lastIndexOf(&quot;/&quot;)+1);
 			getPic(picUrl,picTitle);
 			holder.getFreshDetails().hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
@@ -728,7 +728,7 @@
 			logFinder = new String(strData);
 			return;
 		}
-		if (name.equals(&quot;text&quot;)){ 
+		if (name.equals(&quot;text&quot;)){
 			logData = new String(strData);
 			return;
 		}
@@ -769,7 +769,7 @@
 	private CacheHolder getHolder(String wpt){// See also LOCXMLImporter
 		CacheHolder chx;
 		int index;
-		
+
 		index = cacheDB.getIndex(wpt);
 		if (index == -1) index = searchID(wpt);
 		if (index == -1) {

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -80,7 +80,7 @@
 	public static int SPIDER_ERROR = 0;
 	/** Cache was spidered without problems */
 	public static int SPIDER_OK = 1;
-	
+
 	private static int ERR_LOGIN = -10;
 	private static Preferences pref;
 	private Profile profile;
@@ -338,7 +338,7 @@
 		String postStr, dummy, ln, wpt;
 		Regex lineRex;
 		CacheHolder holder;
-		CWPoint origin = pref.curCentrePt; // No need to copy curCentrePt as it is only read and not written
+		CWPoint origin = pref.getCurCentrePt(); // No need to copy curCentrePt as it is only read and not written
 		if ( !spiderAllFinds &amp;&amp; !origin.isValid()) {
 			(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(5509,&quot;Coordinates for centre must be set&quot;), FormBase.OKB)).execute();
 			return;
@@ -413,7 +413,7 @@
 		saveDistanceInMiles = java.lang.Math.ceil(saveDistanceInMiles) + 1;
 
 		Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
-		
+
 		if (pref.spiderUpdates != Preferences.NO) {
   		double distanceInKm = distance;
   		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
@@ -529,7 +529,7 @@
 								cachesToUpdate.clear();
 							} else {
 								cachesToLoad.add(waypoint);
-								
+
 								//if we don't want to update caches, we can stop directly after adding the maximum of new caches.
 								if ( (pref.spiderUpdates == Preferences.NO) &amp;&amp; (maxNumber &gt; 0) &amp;&amp; (cachesToLoad.size() &gt;= maxNumber)) {
 								  maxNumberAbort = true;
@@ -1215,13 +1215,13 @@
 		Extractor exImgBlock,exImgComment;
 		int idxUrl; // Index of already spidered Url in list of spideredUrls
 		CacheImages lastImages=null;
-		
+
 		// First: Get current image object of waypoint before spidering images.
 		CacheHolder oldCh = Global.getProfile().cacheDB.get(chD.getParent().getWayPoint());
 		if (oldCh != null) {
 			lastImages = oldCh.getFreshDetails().images;
 		}
-		
+
 		//========
 		//In the long description
 		//========
@@ -1775,7 +1775,7 @@
 				(new MessageBox(MyLocale.getMsg(5500,&quot;Error&quot;), MyLocale.getMsg(5504,&quot;Could not load 'spider.def'&quot;), FormBase.OKB)).execute();
 			}
 		}
-		
+
 		/**
 		 * Gets an entry in spider.def by its key (tag)
 		 * @param key The key which is attributed to a specific entry

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/myTableControl.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -1,6 +1,5 @@
 package CacheWolf;
 
-import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.utils.CWWrapper;
 import ewe.sys.*;
 import ewe.ui.*;
@@ -17,7 +16,7 @@
 	public Profile profile;
 	public CacheDB cacheDB;
 	public TablePanel tbp;
-	
+
 	private MenuItem miOpen, miGoto, miCenter, miUnhideAddis;
 	private MenuItem miOpenOnline, miOpenOffline, miLogOnline;
 	private MenuItem miDelete, miUpdate;
@@ -33,7 +32,7 @@
 		pref = Global.getPref();
 		tbp =tablePanel;
 		allowDragSelection = false; // allow only one row to be selected at one time
-				
+
 		MenuItem[] mnuFull = new MenuItem[14];
   	mnuFull[0] = miOpen = new MenuItem(MyLocale.getMsg(1021,&quot;Open description&quot;));
   	mnuFull[1] = miGoto = new MenuItem(MyLocale.getMsg(1010,&quot;Goto&quot;));
@@ -48,7 +47,7 @@
   	mnuFull[10] = miUpdate = new MenuItem(MyLocale.getMsg(1014,&quot;Update&quot;));
   	mnuFull[11] = miSeparator;
   	mnuFull[12] = miTickAll = new MenuItem(MyLocale.getMsg(1015,&quot;Select all&quot;));
-  	mnuFull[13] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,&quot;De-select all&quot;));	
+  	mnuFull[13] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,&quot;De-select all&quot;));
   	mFull = new Menu(mnuFull, MyLocale.getMsg(1013,&quot;With selection&quot;));
 
   	MenuItem[] mnuSmall = new MenuItem[8];
@@ -60,7 +59,7 @@
   	mnuSmall[5] = miOpenOnline;
   	mnuSmall[6] = miOpenOffline;
   	mnuSmall[7] = miLogOnline;
-  	mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013,&quot;With selection&quot;));	
+  	mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013,&quot;With selection&quot;));
 	}
 
 	/** Full menu when listview includes checkbox */
@@ -69,7 +68,7 @@
 //		if (!Vm.getPlatform().equals(&quot;Win32&quot;) &amp;&amp; !Vm.getPlatform().equals(&quot;Java&quot;))
 //		   ((MenuItem)mFull.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
-	
+
 	public Menu getMenuFull() {
 		return mFull;
 	}
@@ -80,19 +79,19 @@
 		//if (!Vm.getPlatform().equals(&quot;Win32&quot;) &amp;&amp; !Vm.getPlatform().equals(&quot;Java&quot;))
 		//	   ((MenuItem)mSmall.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
-	
+
 	public void penRightReleased(Point p){
 		if (cacheDB.size()&gt;0) { // No context menu when DB is empty
 			adjustAddiHideUnhideMenu();
 			menuState.doShowMenu(p,true,null); // direct call (not through doMenu) is neccesary because it will exclude the whole table
-			
+
 		}
 	}
 
     public void penHeld(Point p){
 		if (cacheDB.size()&gt;0) // No context menu when DB is empty
 			adjustAddiHideUnhideMenu();
-			menuState.doShowMenu(p,true,null); 
+			menuState.doShowMenu(p,true,null);
 	}
 
 	public void onKeyEvent(KeyEvent ev) {
@@ -109,15 +108,15 @@
 				else if (ev.key == IKeys.PAGE_DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ getOnScreen(null).height-1, model.numRows-1)); //cursorTo(java.lang.Math.min(cursor.y+ getOnScreen(null).height-1, model.numRows-1),cursor.x+listMode,true); // I don't know why this doesn't work: tbp.doScroll(IScroll.Vertical, IScroll.PageHigher, 1);
 				else if (ev.key == IKeys.PAGE_UP) Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y-getOnScreen(null).height+1, 0)); // cursorTo(java.lang.Math.max(cursor.y-getOnScreen(null).height+1, 0),cursor.x+listMode,true);
 				else if (ev.key == IKeys.ACTION || ev.key == IKeys.ENTER) Global.mainTab.select(Global.mainTab.descP);
-				else if (ev.key == IKeys.DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ 1, model.numRows-1)); 
+				else if (ev.key == IKeys.DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ 1, model.numRows-1));
 				else if (ev.key == IKeys.UP) Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y-1, 0));
-				else if (ev.key == IKeys.LEFT &amp;&amp; Global.mainForm.cacheListVisible &amp;&amp; cursor.y&gt;=0 &amp;&amp; cursor.y&lt;tbp.myMod.numRows) Global.mainForm.cacheList.addCache(cacheDB.get(cursor.y).getWayPoint()); 
+				else if (ev.key == IKeys.LEFT &amp;&amp; Global.mainForm.cacheListVisible &amp;&amp; cursor.y&gt;=0 &amp;&amp; cursor.y&lt;tbp.myMod.numRows) Global.mainForm.cacheList.addCache(cacheDB.get(cursor.y).getWayPoint());
 				else if (ev.key == IKeys.RIGHT) {
 					CacheHolder ch;
 					ch = cacheDB.get(tbp.getSelectedCache());
-					Global.mainTab.gotoP.setDestinationAndSwitch(ch); 
+					Global.mainTab.gotoP.setDestinationAndSwitch(ch);
 				}
-				else if (ev.key == 6 ) MainMenu.search(); // (char)6 == ctrl + f 
+				else if (ev.key == 6 ) MainMenu.search(); // (char)6 == ctrl + f
 				else super.onKeyEvent(ev);
 			}
 		}
@@ -129,13 +128,13 @@
 		Global.getProfile().setSelectForAll(selectStatus);
 		tbp.refreshTable();
 	}
-	
-	 
+
+
 	/** always select a whole row */
 	public boolean isSelected(int pRow,int pCol) {
 		return pRow==selection.y;
 	}
-	
+
 	public void popupMenuEvent(Object selectedItem){
 		if (selectedItem == null) return;
 		CacheHolder ch;
@@ -173,9 +172,9 @@
 			shouldDeleteCount = allCount;
 			if (addiNonVisibleCount + mainNonVisibleCount &gt; 0){
 				if ((new MessageBox(MyLocale.getMsg(144,&quot;Warning&quot;),
-						            MyLocale.getMsg(1029, &quot;There are caches that are ticked but invisible.\n(Main caches: &quot;) + 
-						            	mainNonVisibleCount + MyLocale.getMsg(1030, &quot;, additional Waypoints: &quot;) + 
-						            	addiNonVisibleCount+&quot;)\n&quot; + MyLocale.getMsg(1031, &quot;Delete them, too?&quot;), 
+						            MyLocale.getMsg(1029, &quot;There are caches that are ticked but invisible.\n(Main caches: &quot;) +
+						            	mainNonVisibleCount + MyLocale.getMsg(1030, &quot;, additional Waypoints: &quot;) +
+						            	addiNonVisibleCount+&quot;)\n&quot; + MyLocale.getMsg(1031, &quot;Delete them, too?&quot;),
 						            	FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
 					deleteFiltered = true;
 				} else {
@@ -206,13 +205,13 @@
 					}
 					pbf.exit(0);
 					tbp.myMod.numRows-=nDeleted;
-					profile.saveIndex(pref,true);	
+					profile.saveIndex(pref,true);
 					tbp.refreshTable();
 				}
 			}
 			Vm.showWait(false);
 		} else
-				
+
 		if (selectedItem == miUpdate){
 			MainMenu.updateSelectedCaches(tbp);
 		} else
@@ -227,13 +226,11 @@
 			if (!cp.isValid()){
 				MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(4111,&quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;), FormBase.OKB);
 				tmpMB.execute();
-			} else {				
-				pref.curCentrePt.set(cp);
-				Global.mainTab.updateBearDist(); // Update the distances with a warning message
-				//tbp.refreshTable();
+			} else {
+				pref.setCurCentrePt(cp);
 			}
 		} else
-		
+
 		if (selectedItem == miUnhideAddis) {
 			// This toggles the &quot;showAddis&quot; Flag
 			ch = cacheDB.get(tbp.getSelectedCache());
@@ -249,9 +246,9 @@
 
 		if (selectedItem == miGoto){
 			ch = cacheDB.get(tbp.getSelectedCache());
-			Global.mainTab.gotoP.setDestinationAndSwitch(ch); 
+			Global.mainTab.gotoP.setDestinationAndSwitch(ch);
 		} else
-		    
+
 		if (selectedItem == miOpenOnline){
 			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
@@ -269,14 +266,14 @@
 				}
 			}
 		} else
-		    
+
 		if (selectedItem == miOpenOffline) {
 			if(browserPathIsValid()){
 				ShowCacheInBrowser sc=new ShowCacheInBrowser();
 				sc.showCache(cacheDB.get(tbp.getSelectedCache()));
 			}
 		} else
-			
+
 		if (selectedItem == miLogOnline){
 			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
@@ -298,7 +295,7 @@
 									URL = &quot;&quot;;
 								}
 							} else {
-								URL = &quot;<A HREF="http://www.geocaching.com/seek/log.aspx?ID=">http://www.geocaching.com/seek/log.aspx?ID=</A>&quot; + mainCache.GetCacheID();								
+								URL = &quot;<A HREF="http://www.geocaching.com/seek/log.aspx?ID=">http://www.geocaching.com/seek/log.aspx?ID=</A>&quot; + mainCache.GetCacheID();
 							}
 
 							if (URL.length() &gt; 0) {
@@ -320,13 +317,13 @@
 			}
 		} else
 
-		    
+
 		if (selectedItem == miOpen){
 			penDoubleClicked(null);
 		}
 
 	}
-	
+
 	public boolean browserPathIsValid() {
 		if(!new File(pref.browser).exists()){
 			(new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(1032,&quot;Path to browser:&quot;)+&quot;\n&quot;+pref.browser+&quot;\n&quot;+MyLocale.getMsg(1033,&quot;is incorrect!&quot;),FormBase.OKB)).execute();
@@ -335,15 +332,15 @@
 		else
 			return true;
 	}
-	
+
 	public void penDoubleClicked(Point where) {
 		Global.mainTab.select(Global.mainTab.descP);
 	}
-	
+
 	public void onEvent(Event ev) {
 		if (ev instanceof PenEvent &amp;&amp; (ev.type == PenEvent.PEN_DOWN) ){
 			Global.mainTab.tbP.myMod.penEventModifiers=((PenEvent)ev).modifiers;
-	    } 
+	    }
 
 		super.onEvent(ev);
 	}
@@ -352,7 +349,7 @@
 	 * Adjusting the menu item for hiding or unhiding additional waypoints. If the cache has no
 	 * addis, then the menu is deactivated. If it has addis, then the menu text is adapted according
 	 * to the current value of the property &lt;code&gt;showAddis()&lt;/code&gt;.
-	 * 
+	 *
 	 */
 	public void adjustAddiHideUnhideMenu() {
 		if (tbp.getSelectedCache() &lt; 0) {
@@ -375,19 +372,19 @@
 			}
 		}
 	}
-	
+
 	// /////////////////////////////////////////////////
 	// Allow the caches to be dragged into a cachelist
     ///////////////////////////////////////////////////
-	
+
 	IconAndText imgDrag;
 	String wayPoint;
 	int row;
-	
+
 	public void startDragging(DragContext dc) {
 		 Point p=cellAtPoint(dc.start.x,dc.start.y,null);
 		 wayPoint=null;
-		 if (p.y&gt;=0) { 
+		 if (p.y&gt;=0) {
 			if (!Global.mainForm.cacheListVisible) {
 				dc.cancelled=true;
 				return;
@@ -421,7 +418,7 @@
 			 //Vm.debug(&quot;Control &quot;+c.toString()+&quot;/&quot;+c.text);
 		 }else super.stopDragging(dc);
 	 }
-	 
+
 	 public void dragged(DragContext dc) {
 	 	if (wayPoint!=null)
 		   dc.imageDrag();
@@ -453,24 +450,24 @@
 	 {
 		 Point p2 = cellAtPoint(p.x,p.y,null);
 		 super.penReleased(p, isDouble);
-		 Rect sel = getSelection(null); 
-		 if ((sel.height == 0 || sel.height == 0) &amp;&amp; p2 != null) cursorTo(p2.y,p2.x, true); // if the selection is gone -&gt; reselect it 
-			 
+		 Rect sel = getSelection(null);
+		 if ((sel.height == 0 || sel.height == 0) &amp;&amp; p2 != null) cursorTo(p2.y,p2.x, true); // if the selection is gone -&gt; reselect it
+
 	 }
 
 	 class myProgressBarForm extends ProgressBarForm {
 
 		 boolean isClosed=false;
-		 
+
 		 protected boolean canExit(int exitCode) {
 			isClosed=true;
 			return true;
 		 }
-		 
+
 	 }
-	 
-	 
 
+
+
 	public Menu getMenuSmall() {
 		return mSmall;
 	}

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -70,7 +70,7 @@
 	MenuItem miNorthCentered;
 
 	/**
-	 * Create GotoPanel 
+	 * Create GotoPanel
 	 * @param Preferences 	global preferences
 	 * @param MainTab		reference to MainTable
 	 * @param DetailsPanel 	reference to DetailsPanel
@@ -90,7 +90,7 @@
 		ButtonP.addNext(btnSave = new mButton(MyLocale.getMsg(311,&quot;Create Waypoint&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		ButtonP.addLast(btnMap = new mButton(MyLocale.getMsg(1506,&quot;Map&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 
-		//Format selection for coords		
+		//Format selection for coords
 		//context menu
 		mnuContextFormt = new Menu();
 		currFormatSel = 1; // default to d&#176; m.m
@@ -174,7 +174,7 @@
 		//		// myGPS.noInterpretableData();
 
 
-		//		}	
+		//		}
 	}
 
 	public void resizeTo(int pWidth, int pHeight){
@@ -185,19 +185,19 @@
 			//some space for the SIP button
 			if ( (Vm.getParameter(VmConstants.VM_FLAGS) &amp; (VmConstants.VM_FLAG_SIP_BUTTON_ON_SCREEN)) == (VmConstants.VM_FLAG_SIP_BUTTON_ON_SCREEN) ){
 				Rect screen = (Rect)Window.getGuiInfo(WindowConstants.INFO_SCREEN_RECT,null,new Rect(),0);
-				roseHeight -= screen.height / 14;				
+				roseHeight -= screen.height / 14;
 			}
 		}
-		roseP.resizeTo(pWidth, roseHeight); 
+		roseP.resizeTo(pWidth, roseHeight);
 		icRose.resizeTo(pWidth, roseHeight);
 		compassRose.resize(pWidth, roseHeight);
 	}
 
 
 	/**
-	 * set the coords of the destination  
+	 * set the coords of the destination
 	 * @param dest destination
-	 */ 
+	 */
 	public void setDestination(CWPoint dest){
 		myNavigation.setDestination(dest);
 		if (!myNavigation.destination.isValid()) (new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(1507,&quot;Coordinates are out of range:&quot;) +&quot;\n&quot;+MyLocale.getMsg(1508,&quot;latitude&quot;)+&quot;: &quot;+myNavigation.destination.latDec+&quot;\n &quot;+MyLocale.getMsg(1509,&quot;longditue&quot;)+&quot;: &quot;+myNavigation.destination.lonDec, FormBase.OKB)).execute();
@@ -211,9 +211,9 @@
 
 
 	/**
-	 * set the coords of the destination and switch to gotoPanel  
+	 * set the coords of the destination and switch to gotoPanel
 	 * @param LatLon destination
-	 */ 
+	 */
 	public void setDestinationAndSwitch(CWPoint where) {
 		myNavigation.setDestination(where);
 		mainT.select(this);
@@ -238,8 +238,8 @@
 	}
 
 	/**
-	 * method which is called if a timer is set up  
-	 */ 
+	 * method which is called if a timer is set up
+	 */
 	public void updateGps(int fix) {
 		Double bearMov = new Double();
 		Double speed = new Double();
@@ -306,21 +306,21 @@
 			else {
 				if (mainT.ch != null &amp;&amp; mainT.ch.pos.isValid()) centerTo = new CWPoint(mainT.ch.pos);
 				else {
-					if (pref.curCentrePt.isValid()) centerTo = new CWPoint(pref.curCentrePt);
+					if (pref.getCurCentrePt().isValid()) centerTo = new CWPoint(pref.getCurCentrePt());
 				}
 			}
 		}
 		if (centerTo != null &amp;&amp; centerTo.isValid())
 			mainT.SwitchToMovingMap(centerTo, false);
 		else
-			(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1513, &quot;Cannot start moving map without valid coordinates. Please enter coordinates as destination, as center, in selected cache or start GPS&quot;), FormBase.OKB)).execute(); 
+			(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1513, &quot;Cannot start moving map without valid coordinates. Please enter coordinates as destination, as center, in selected cache or start GPS&quot;), FormBase.OKB)).execute();
 	}
 
 	/**
 	 * Eventhandler
 	 */
 	public void onEvent(Event ev){
-		if (ev instanceof MenuEvent) { 
+		if (ev instanceof MenuEvent) {
 			if (ev.type == MenuEvent.SELECTED) {
 				if (((MenuEvent)ev).menu == mnuContextFormt) {
 					mnuContextFormt.close();
@@ -343,7 +343,7 @@
 						if (action == miNorthCentered) {
 							if (compassRose.isNorthCentered()) {
 								compassRose.setNorthCentered(false);
-								miNorthCentered.modifiers &amp;= ~MenuItem.Checked;							
+								miNorthCentered.modifiers &amp;= ~MenuItem.Checked;
 							}
 							else
 							{
@@ -363,19 +363,16 @@
 				else myNavigation.stopGps();
 			}
 
-			// set current position as centre and recalculate distance of caches in MainTab 
+			// set current position as centre and recalculate distance of caches in MainTab
 			if (ev.target == btnCenter){
 				if (myNavigation.gpsPos.isValid()) {
-					Vm.showWait(true);
-					pref.curCentrePt.set(myNavigation.gpsPos);
-					mainT.updateBearDist();
-					Vm.showWait(false);
+					pref.setCurCentrePt(myNavigation.gpsPos);
 				} else (new MessageBox(MyLocale.getMsg(312, &quot;Error&quot;), MyLocale.getMsg(1514, &quot;Cannot recalculate distances, because the GPS position is not set&quot;), FormBase.OKB)).execute();
 			}
 			//Start moving map
 			if (ev.target == btnMap){
 				switchToMovingMap();
-			} 
+			}
 			// create new waypoint with current GPS-position
 			if (ev.target == btnSave){
 				CacheHolder ch = new CacheHolder();
@@ -511,16 +508,16 @@
 		String strTemp = MyLocale.getMsg(1512, &quot;Waypoint&quot;);
 		g.setColor(Color.DarkBlue);
 		g.fillRect(0, 0, fm.getTextWidth(strTemp) + 4, lineHeight);
-		g.setColor(Color.White);		
+		g.setColor(Color.White);
 		g.drawText(strTemp, 2, 0);
 
-		g.setColor(Color.Black);		
+		g.setColor(Color.Black);
 
 		int metricSystem = Global.getPref().metricSystem;
 		Double tmp = new Double();
 		strTemp = &quot;&quot;;
 		double newDistance = 0;
-		int bigUnit = -1; 
+		int bigUnit = -1;
 		int smallUnit = -1;
 		double threshold = -1;
 		// Allow for different metric systems
@@ -577,7 +574,7 @@
 		}
 		if (tmp.value &gt;= 0) {
 			if (tmp.value &gt;= 100) {
-				strSpeed = MyLocale.formatDouble(tmp,&quot;0&quot;) + unit;				
+				strSpeed = MyLocale.formatDouble(tmp,&quot;0&quot;) + unit;
 			}
 			else {
 				strSpeed = MyLocale.formatDouble(tmp,&quot;0.0&quot;) + unit;
@@ -595,8 +592,8 @@
 		int startX = location.width - (textWidth + 4);
 		g.fillRect(startX, 0, location.width - startX, lineHeight);
 
-		g.setColor(Color.Black);		
-		g.drawText(strHeadline, startX + 2, 0);		
+		g.setColor(Color.Black);
+		g.drawText(strHeadline, startX + 2, 0);
 		g.drawText(strSpeed, startX + 2, lineHeight);
 		g.drawText(strMoveDir, startX + 2, 2*lineHeight);
 	}
@@ -615,7 +612,7 @@
 		int startY = location.height - 2*lineHeight;
 		g.fillRect(0, startY, textWidth + 4, location.height - startY);
 
-		g.setColor(Color.Black);		
+		g.setColor(Color.Black);
 		g.drawText(m_Luminary, 2, startY);
 		g.drawText(strSunDir, 2, startY + lineHeight);
 	}
@@ -705,8 +702,8 @@
 					g.drawLine(location.width/2, location.height/2 - radius, location.width/2, location.height/2 + radius);
 
 					if (gotoDir &lt; 360 &amp;&amp; gotoDir &gt; -360) drawThinArrow(g, gotoDir - moveDir, Color.DarkBlue, moveDirColor, 1.0f);
-					if (sunDir &lt; 360 &amp;&amp; sunDir &gt; -360) drawSunArrow(g, sunDir - moveDir, YELLOW, 0.75f);					
-				}				
+					if (sunDir &lt; 360 &amp;&amp; sunDir &gt; -360) drawSunArrow(g, sunDir - moveDir, YELLOW, 0.75f);
+				}
 			}
 		}
 	}
@@ -767,7 +764,7 @@
 		g.fillPolygon(pointsX, pointsY, 4);
 		if (colPoint != null) {
 			g.setBrush(new Brush(colPoint, Brush.SOLID));
-			g.fillPolygon(pointsX, pointsY, 3);			
+			g.fillPolygon(pointsX, pointsY, 3);
 		}
 	}
 
@@ -781,7 +778,7 @@
 			drawRosePart(g,  45 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, &quot;NE&quot;, bDrawText);
 			drawRosePart(g, 135 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, &quot;SE&quot;, bDrawText);
 			drawRosePart(g, 225 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, &quot;SW&quot;, bDrawText);
-			drawRosePart(g, 315 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, &quot;NW&quot;, bDrawText);	
+			drawRosePart(g, 315 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, &quot;NW&quot;, bDrawText);
 		}
 
 		drawRosePart(g,   0 + angle, colNorthLeft, colNorthRight, colBorder, colText, scale * subScale1, innerScale, &quot;N&quot;, bDrawText);

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -17,7 +17,7 @@
 /**
  * @author pfeffer
  * This Class is the Dialog for Download calibrated from expedia.com
- * is called from 
+ * is called from
  *  * start offset for language file: 1800
  */
 
@@ -67,8 +67,8 @@
 
 	public MapLoaderGui(CacheDB cacheDBi) {
 		super();
-		this.title = MyLocale.getMsg(1800, &quot;Download georeferenced maps&quot;); 
-		center = new CWPoint(pref.curCentrePt);
+		this.title = MyLocale.getMsg(1800, &quot;Download georeferenced maps&quot;);
+		center = new CWPoint(pref.getCurCentrePt());
 		cacheDB = cacheDBi;
 		mapLoader = new MapLoader(FileBase.getProgramDirectory()+&quot;/&quot;+&quot;webmapservices&quot;);
 
@@ -76,7 +76,7 @@
 		unsortedMapServices = mapLoader.getAvailableOnlineMapServices();
 		sortMapServices();
 		mapServiceChoice = new mChoice(sortedmapServices, 0);
-		MessageArea desc = new MessageArea(descString); 
+		MessageArea desc = new MessageArea(descString);
 		desc.modifyAll(ControlConstants.NotEditable | ControlConstants.DisplayOnly | ControlConstants.NoFocus, ControlConstants.TakesKeyFocus);
 		desc.borderStyle = UIConstants.BDR_NOBORDER;
 		this.addLast(desc);
@@ -137,7 +137,7 @@
 		setRecommScaleInput();
 		this.addLast(mTab);
 	}
-	
+
 	private void setRecommScaleInput(){
 		String[] recScales = new String[mapLoader.currentOnlineMapService.recommendedScales.length];
 		for (int i=0; i&lt;recScales.length; i++) {
@@ -151,10 +151,10 @@
 
 	/**
 	 * sort the map services in order to have the services, which cover
-	 * the current center first in the list 
+	 * the current center first in the list
 	 * this sets inbound[], sortedMapServices[] and sortingmapServices[]
 	 *
-	 */	
+	 */
 	private void sortMapServices() {
 		sortingMapServices = new int[unsortedMapServices.length+1];
 		inbound = new boolean[unsortedMapServices.length];
@@ -169,7 +169,7 @@
 		int k=j;
 		sortedmapServices = new String[unsortedMapServices.length+1];
 		for (int i=0; i &lt; sortedmapServices.length-1; i++) {
-			if (!inbound[i]) { 
+			if (!inbound[i]) {
 				sortingMapServices[j] = i;
 				j++;
 			}
@@ -180,7 +180,7 @@
 		sortingMapServices[j]=sortingMapServices[k];
 		sortingMapServices[k]=-1;
 	}
-	
+
 	private int getSortedMapServiceIndex(int originalindex) {
 		for (int i = 0; i &lt; sortingMapServices.length; i++) {
 			if (sortingMapServices[i] == originalindex) return i;
@@ -213,7 +213,7 @@
 		} while (StartPos&lt;LastPos);
 		return LeadingPath;
 	}
-	
+
 	public void downloadTiles() {
 		String mapsDir = getMapsDir();
 		if (mapsDir == null) return;
@@ -245,12 +245,12 @@
 				return;
 			}
 			mapLoader.setTiles(surArea.topleft, surArea.buttomright, scale, size, overlapping );
-		} else 
+		} else
 		{ // calculate from centre point an radius
 			mapLoader.setTiles(center, radius * 1000, scale, size, overlapping);
 		}
 		if (overviewmap) {
-			progressBox.setInfo(MyLocale.getMsg(1824, &quot;downloading overview map&quot;)); 
+			progressBox.setInfo(MyLocale.getMsg(1824, &quot;downloading overview map&quot;));
 			float overviewScale = MapLoader.getScale(center, radius * 1000, size);
 			try {
 				mapLoader.downloadMap(center, overviewScale, size, mapsDir);
@@ -262,7 +262,7 @@
 			mapLoader.setProgressInfoBox(progressBox);
 			mapLoader.downlaodTiles(mapsDir);
 		} else { // per cache
-			CacheHolder ch; 
+			CacheHolder ch;
 			CWPoint tmpca = new CWPoint();
 			int numdownloaded = 0;
 			Global.getProfile().getSourroundingArea(onlySelected); // calculate numCachesInArea
@@ -292,7 +292,7 @@
 		progressBox.waitUntilClosed();
 		mapLoader.setProgressInfoBox(null);
 		//progressBox.close(0);
-		if(Global.mainTab.mm != null) Global.mainTab.mm.mapsloaded = false; 
+		if(Global.mainTab.mm != null) Global.mainTab.mm.mapsloaded = false;
 		//	(new MessageBox(&quot;Download maps&quot;, &quot;Downloaded and calibrated the maps successfully&quot;, MessageBox.OKB)).execute();
 	}
 
@@ -326,7 +326,7 @@
 			}
 			else if (ev.target == okBtiles || ev.target == okBPerCache){
 				if (sortingMapServices[mapServiceChoice.selectedIndex] == -1) {
-					(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1833, &quot;Please don't select the separator line in the wms service option&quot;), FormBase.OKB)).execute(); 
+					(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1833, &quot;Please don't select the separator line in the wms service option&quot;), FormBase.OKB)).execute();
 				}
 				mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
 				if (ev.target == okBtiles) { // get tiles
@@ -338,11 +338,11 @@
 					scale = (float)CacheWolf.Common.parseDouble(scaleInput.getText());
 					overlapping = Convert.toInt(overlappingInput.getText());
 					if (!forCachesChkBox.getState()) {
-						if (radius &lt;= 0) { 
+						if (radius &lt;= 0) {
 							(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1827, &quot;'radius' must be greater than 0&quot;), FormBase.OKB)).execute();
 							return;
 						}
-						if (overlapping &lt; 0) { 
+						if (overlapping &lt; 0) {
 							(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1828, &quot;'overlapping' must be greater or equal 0&quot;), FormBase.OKB)).execute();
 							return;
 						}
@@ -369,7 +369,7 @@
 					(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), &quot;! &quot; + scale + &quot;\n&quot; + MyLocale.getMsg(1830, &quot;The selected online map service provides map in the scale from&quot;) + &quot; &quot; + mapLoader.currentOnlineMapService.minscale + MyLocale.getMsg(1831, &quot; to&quot;) + &quot; &quot; + mapLoader.currentOnlineMapService.maxscale + MyLocale.getMsg(1832, &quot;\n please adjust 'Approx. meter pro pixel' accordingly&quot;), FormBase.OKB)).execute();
 					return;
 				}
-				this.close(FormBase.IDOK); 
+				this.close(FormBase.IDOK);
 				this.downloadTiles();
 			}
 			else if (ev.target == coosBtn) {

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -414,17 +414,17 @@
 		running = true;
 
 		// to load maplist + place a map on screen otherwise no symbol can be placed
-		updatePosition(centerTo); 
-		
+		updatePosition(centerTo);
+
 		// update cache symbols in map
 		if (Global.getProfile().selectionChanged) {
 			// this means marking has changed
 			Global.getProfile().selectionChanged = false;
-			if (getShowCachesOnMap()) removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap			
+			if (getShowCachesOnMap()) removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap
 		}
 		setMarkedCache(Global.mainTab.ch); // this is the selected one (not necessary marked)
 		showCachesOnMap();
-		
+
 		addTrack(myNavigation.curTrack);
 		if (tracks != null &amp;&amp; tracks.size() &gt; 0 &amp;&amp; ((Track)tracks.get(0)).num &gt; 0)
 			rebuildOverlaySet(); // show points which where added when MavingMap was not running
@@ -435,7 +435,7 @@
 		else {
 			destChanged(myNavigation.destination);
 		}
-		
+
 		repaint();
 		return ret;
 	}
@@ -1012,7 +1012,7 @@
 		if (forceMapLoad || wantMapTest || screenNotCompletlyCovered) { // if force || want || map doesn't cover the screen completly
 			// Vm.debug(&quot;Screen not completly covered by map&quot;);
 			if (forceMapLoad ||
-				(java.lang.Math.abs(lastCompareX - mapPos.x) &gt; this.width / 10 || 
+				(java.lang.Math.abs(lastCompareX - mapPos.x) &gt; this.width / 10 ||
 				 java.lang.Math.abs(lastCompareY - mapPos.y) &gt; this.height / 10)) {
 				// more then 1/10 of screen moved since last time we tried to find a better map
 				if (autoSelectMap) {
@@ -1080,18 +1080,18 @@
 				else {
 					// remove the right one , as
 					// possibly more than one picture associated with ch (target,selected ..)
-					removeMapSymbol(ch.cacheName); 
+					removeMapSymbol(ch.cacheName);
 				}
 			}
 		}
-		// adding target and selected 
+		// adding target and selected
 		// show target
 		if (gotoPos != null) {
 			// the CacheHolder Symbol must be inserted too, even if not marked (if it is Cache)
-			// anywhere there if all Caches shown on map 
+			// anywhere there if all Caches shown on map
 			CacheHolder gotoPosCH = null;
 			if (gotoPos.mapObject instanceof CacheHolder) {
-				gotoPosCH = (CacheHolder) gotoPos.mapObject;				
+				gotoPosCH = (CacheHolder) gotoPos.mapObject;
 			}
 			if (!getShowCachesOnMap() &amp;&amp; (gotoPosCH != null)) {
 				addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType()), gotoPosCH.pos);
@@ -1114,7 +1114,7 @@
 			AniImage im = (AniImage) mmp.images.get(i);
 			if (!(im instanceof MapImage) ||
 				(im instanceof MapSymbol) ||
-				(im instanceof TrackOverlay) || 
+				(im instanceof TrackOverlay) ||
 				mmp.mapImage == im) {
 				icons.add(im);
 			}
@@ -2181,7 +2181,7 @@
 			if (mm.gotoPos != null) moveToDestMI.modifiers &amp;= ~MenuItem.Disabled;
 			else moveToDestMI.modifiers |= MenuItem.Disabled;
 			mapsMenu.addItem(moveToDestMI);
-			if (Global.getPref().curCentrePt.isValid()) moveToCenterMI.modifiers &amp;= ~MenuItem.Disabled;
+			if (Global.getPref().getCurCentrePt().isValid()) moveToCenterMI.modifiers &amp;= ~MenuItem.Disabled;
 			else moveToCenterMI.modifiers |= MenuItem.Disabled;
 			mapsMenu.addItem(moveToCenterMI);
 			mapsMenu.addItem(moveToGpsMI);
@@ -2343,7 +2343,7 @@
 						// moveto position
 						else if (action == moveToCenterMI) {
 							mapsMenu.close();
-							mm.setCenterOfScreen(Global.getPref().curCentrePt, true);
+							mm.setCenterOfScreen(Global.getPref().getCurCentrePt(), true);
 						}
 						else if (action == moveToDestMI) {
 							mapsMenu.close();


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002208.html">[Cachewolf-svn] r2284 - in trunk: res_noewe/languages src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="002210.html">[Cachewolf-svn] r2286 - trunk/src/CacheWolf/navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2209">[ date ]</a>
              <a href="thread.html#2209">[ thread ]</a>
              <a href="subject.html#2209">[ subject ]</a>
              <a href="author.html#2209">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
