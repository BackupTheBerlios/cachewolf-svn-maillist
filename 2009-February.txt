From admin at berlios.de  Sun Feb  1 12:07:05 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 1 Feb 2009 12:07:05 +0100 (CET)
Subject: [Cachewolf-svn] [Bug #15178] Bad profil craches map start
Message-ID: <200902011107.n11B753o015970@unicorn.berlios.de>

Bug #15178, was updated on 2009-Feb-01 12:07
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Map
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: pfeffer
Assigned to : none
Summary: Bad profil craches map start

Details: see http://www.geoclub.de/viewtopic.php?f=40&t=30629

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15178&group_id=2211


From admin at berlios.de  Sun Feb  1 12:07:59 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 1 Feb 2009 12:07:59 +0100 (CET)
Subject: [Cachewolf-svn] [Bug #15148] Memory Leak in der Java Version beim
	Spidern/Aktualisieren
Message-ID: <200902011107.n11B7xr7016704@unicorn.berlios.de>

Bug #15148, was updated on 2009-Jan-28 20:41
Here is a current snapshot of the bug.

Project: CacheWolf
Category: GC-Spider
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: greiol
Assigned to : none
Summary: Memory Leak in der Java Version beim Spidern/Aktualisieren

Details: Die Javaversion verliert bei Spidern / Aktualisieren immer mehr Old-Generation Heap der auch nach dem Ende des Speicherns mit einer erzwungenen GC nicht freigegebn wird. Dazu kommt es immer wieder zu Out of Memory Exceptions (siehe diverse Freds im Forum).

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15148&group_id=2211


From admin at berlios.de  Sun Feb  1 12:20:49 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 1 Feb 2009 12:20:49 +0100 (CET)
Subject: [Cachewolf-svn] [Bug #15178] Bad profil craches map start
Message-ID: <200902011120.n11BKnTP025934@unicorn.berlios.de>

Bug #15178, was updated on 2009-Feb-01 12:07
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Map
Status: Open
Resolution: None
Bug Group: Bug confirmed
Priority: 5
Submitted by: pfeffer
Assigned to : none
Summary: Bad profil craches map start

Details: see http://www.geoclub.de/viewtopic.php?f=40&t=30629

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15178&group_id=2211


From admin at berlios.de  Sun Feb  1 12:21:00 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 1 Feb 2009 12:21:00 +0100 (CET)
Subject: [Cachewolf-svn] [Bug #15148] Memory Leak in der Java Version beim
	Spidern/Aktualisieren
Message-ID: <200902011121.n11BL0AQ026108@unicorn.berlios.de>

Bug #15148, was updated on 2009-Jan-28 20:41
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Bug confirmed
Priority: 5
Submitted by: greiol
Assigned to : none
Summary: Memory Leak in der Java Version beim Spidern/Aktualisieren

Details: Die Javaversion verliert bei Spidern / Aktualisieren immer mehr Old-Generation Heap der auch nach dem Ende des Speicherns mit einer erzwungenen GC nicht freigegebn wird. Dazu kommt es immer wieder zu Out of Memory Exceptions (siehe diverse Freds im Forum).

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15148&group_id=2211


From admin at berlios.de  Sun Feb  1 12:21:40 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 1 Feb 2009 12:21:40 +0100 (CET)
Subject: [Cachewolf-svn] [Bug #15147] Garmin Export obsolet
Message-ID: <200902011121.n11BLeGV026591@unicorn.berlios.de>

Bug #15147, was updated on 2009-Jan-28 20:39
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Feature Request
Priority: 5
Submitted by: greiol
Assigned to : none
Summary: Garmin Export obsolet

Details: Der derzeitige Garmin Export via Men? erzeugt PCX5 Dateien. PCX5 wird seit vielen Versionen nicht mehr von Garmin unterst?tzt und kommt auch mit den "neuen langen" WP Identifiern von GC.com zurecht.

Vorschlag: entfernen

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15147&group_id=2211


From admin at berlios.de  Sun Feb  1 12:22:30 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 1 Feb 2009 12:22:30 +0100 (CET)
Subject: [Bug #15146] GPX Importer erkennt Funddatum nicht für Events und Webcams
Message-ID: <200902011122.n11BMUt4027141@unicorn.berlios.de>

Bug #15146, was updated on 2009-Jan-28 20:34
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Bug reason found in code
Priority: 5
Submitted by: greiol
Assigned to : none
Summary: GPX Importer erkennt Funddatum nicht f?r Events und Webcams

Details: Der GPX Importer erkennt das Funddatum bei Webcams und Events nicht, da nur auf icon_smile, nicht aber auf 11.png und icon_attended gepr?ft wird.

fix:
in GPXImporter.java die zeile
if(logIcon.equals("icon_smile.gif") &&
durch die zeile
if((logIcon.equals("icon_smile.gif") || logIcon.equals("11.png") || logIcon.equals("icon_attended.gif")) &&
ersetzen. 

leider kann ich kein patchfile anh?ngen

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15146&group_id=2211


From engywuck at mail.berlios.de  Sun Feb  1 12:37:27 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 1 Feb 2009 12:37:27 +0100
Subject: [Cachewolf-svn] r1607 - in experiments/EVEhist/src: . eve eve/ui
	eve/ui/formatted eve/ui/formatted/data
Message-ID: <200902011137.n11BbRSf002421@sheep.berlios.de>

Author: engywuck
Date: 2009-02-01 12:37:18 +0100 (Sun, 01 Feb 2009)
New Revision: 1607

Added:
   experiments/EVEhist/src/eve/
   experiments/EVEhist/src/eve/ui/
   experiments/EVEhist/src/eve/ui/formatted/
   experiments/EVEhist/src/eve/ui/formatted/FormattedTextMaker.java
   experiments/EVEhist/src/eve/ui/formatted/FormattedTextMakerBase.java
   experiments/EVEhist/src/eve/ui/formatted/HotSpot.java
   experiments/EVEhist/src/eve/ui/formatted/HtmlDisplay.java
   experiments/EVEhist/src/eve/ui/formatted/ImageResolver.java
   experiments/EVEhist/src/eve/ui/formatted/StreamImageResolver.java
   experiments/EVEhist/src/eve/ui/formatted/TextDisplay.java
   experiments/EVEhist/src/eve/ui/formatted/TextFormatter.java
   experiments/EVEhist/src/eve/ui/formatted/TextPosition.java
   experiments/EVEhist/src/eve/ui/formatted/data/
   experiments/EVEhist/src/eve/ui/formatted/data/HtmlViewer.java
   experiments/EVEhist/src/eve/ui/formatted/data/WebBrowser.java
Log:
Added source of eve.ui.formatted as workround for HtmlDisplay bug on VGA PDAs. (http://www.ewesoft.com/cgi-local/eve-yabb/YaBB.pl?num=1211749027)

Added: experiments/EVEhist/src/eve/ui/formatted/FormattedTextMaker.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/FormattedTextMaker.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/FormattedTextMaker.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,1999 @@
+
+package eve.ui.formatted;
+import java.util.Hashtable;
+import java.util.Vector;
+
+import eve.data.MutableTreeNodeObject;
+import eve.data.PropertyList;
+import eve.fx.Color;
+import eve.fx.Dimension;
+import eve.fx.DisplayLine;
+import eve.fx.DisplayLineSpecs;
+import eve.fx.Font;
+import eve.fx.FormattedTextSpecs;
+import eve.fx.IImage;
+import eve.fx.ImageDecoder;
+import eve.fx.PixelBuffer;
+import eve.io.File;
+import eve.sys.Convert;
+import eve.sys.Event;
+import eve.sys.EventListener;
+import eve.sys.Gate;
+import eve.sys.Handle;
+import eve.sys.Task;
+import eve.sys.TimeOut;
+import eve.sys.Vm;
+import eve.sys.YieldToEvents;
+import eve.sys.mThread;
+import eve.ui.Application;
+import eve.ui.ReportException;
+import eve.ui.TextPad;
+import eve.ui.event.ControlEvent;
+import eve.util.ByteArray;
+import eve.util.CharArray;
+import eve.util.FormattedDataSource;
+import eve.util.Range;
+import eve.util.SubString;
+import eve.util.TagList;
+import eve.util.Utils;
+import eve.util.mString;
+/**
+* This is used to build up formatted text - via add() or parseHtml(), which
+* is then added to a TextDisplay.
+**/
+//##################################################################
+public class FormattedTextMaker extends FormattedTextMakerBase implements EventListener, ImageResolver{
+//##################################################################
+
+CharArray text = new CharArray();
+Vector entries = new Vector();
+Vector creating = new Vector();
+
+//===================================================================
+public FormattedTextMaker()
+//===================================================================
+{
+	//rmatters.set(TEST,new TestFormatter());
+}
+//===================================================================
+public void add(String toAdd)
+//===================================================================
+{
+	add(Vm.getStringChars(toAdd),0,toAdd.length());
+}
+//===================================================================
+public void add(char []toAdd,int start,int length)
+//===================================================================
+{
+	//if (!stopAdding)
+	text.append(toAdd,start,length);
+}
+
+boolean inPreFormat = false;
+
+/*
+//===================================================================
+int indexOf(char[] data,int start,int length,char[] look,int lookStart,int lookLength,int startIndex)
+//===================================================================
+{
+	if (lookLength > length) return -1;
+	for (int s = startIndex; s<length; s++){
+		int idx = SubString.indexOf(look[0],data,start,length,s,0);
+		if (idx == -1) return -1;
+		if (SubString.equals(data,idx,length-idx,look,lookStart,lookLength,SubString.STARTS_WITH)) return idx;
+		s = idx;
+	}
+	return -1;
+}
+boolean debug = false;
+*/
+SubString replaced = new SubString();
+//===================================================================
+void doReplacements(SubString data,Object [] replacers)
+//===================================================================
+{
+	if (replacers.length == 0) return;
+	if (replacers[0] instanceof String)
+		for (int i = 0; i<replacers.length; i++)
+			replacers[i] = Vm.getStringChars((String)replacers[i]);
+	for (int i = 0; i<replacers.length; i+=2)
+		data.replace((char [])replacers[i],(char [])replacers[i+1]);
+}
+//===================================================================
+public void addHtml(String toAdd)
+//===================================================================
+{
+	if (ampList == null)
+		new SubString().set(amps).split('|',(ampList = new Vector()),0);
+	if (replaced.data == null || replaced.data.length < toAdd.length())
+		replaced.data = new char[toAdd.length()];
+	mString.copyInto(toAdd,replaced.data,0);
+	replaced.length = toAdd.length();
+	replaced.start = 0;
+	//doReplacements(replaced,replacements);
+	char [] chars = replaced.data;
+	int end = replaced.start+replaced.length;
+	int start = replaced.start;
+	for (int i = start; i<end; i++){
+		if (chars[i] == '&'){
+			int e = i+1;
+			for (; e<end; e++)
+				if (chars[e] == ';') break;
+			if (e == end) break;
+			char toSub = '?';
+			if (chars[i+1] == '#')
+				toSub = (char)Convert.toInt(new String(chars,i+2,e-i-2));
+			else{
+				int max = ampList.size();
+				for (int j = 0; j<max; j++){
+					SubString s = (SubString)ampList.get(j);
+					if (SubString.equals(chars,i+1,e-(i+1),s.data,s.start+1,s.length-1,SubString.IGNORE_CASE))
+						toSub = s.data[s.start];
+				}
+			}
+			if (e != end-1) System.arraycopy(chars,e+1,chars,i+1,end-(e+1));
+			chars[i] = toSub;
+			end -= (e+1)-(i+1);
+		}
+	}	
+	replaced.length = end-replaced.start;
+	if (inPreFormat) {
+		for (int i = start; i<end; i++)
+			if (chars[i] == ' ') chars[i] = 160;
+			else if (chars[i] == '\r') chars[i] = ' ';
+		//doReplacements(replaced,preReplacements);
+	}else {
+		//doReplacements(replaced,htmlReplacements);
+		for (int i = start; i<end; i++){
+			char c = chars[i];
+			if (c <= 27) {
+				chars[i] = ' ';
+			}
+		}
+		int first = -1;
+		for (int i = start; i<end; i++){
+			if (chars[i] == ' '){
+				if (first == -1) first = i;
+			}else{
+				if (first != -1 && first != i-1){
+					System.arraycopy(chars,i,chars,first+1,end-i);
+					end -= i-first-1;
+				}
+				first = -1;
+			}
+		}
+		if (first != -1) end = first+1;
+		replaced.length = end-replaced.start;
+		
+		if (replaced.length > 0){
+			if (replaced.data[replaced.start] == ' '){
+				char c = text.length == 0 ? '\n' : text.data[text.length-1];
+				if (c == '\n' || c == ' ') {
+					replaced.start++;
+					replaced.length--;
+				}
+			}
+		}
+	}
+	if (replaced.length != 0){
+		add(replaced.data,replaced.start,replaced.length);
+		startFresh = endedParagraph = endedTag = false;
+	}
+}
+
+//===================================================================
+public void lineBreak()
+//===================================================================
+{
+	//if (cancel(PARAGRAPH) != null) addBlankLine();
+	//else 
+		add("\n");
+}
+//===================================================================
+public void conditionalLineBreak()
+//===================================================================
+{
+	//if (cancel(PARAGRAPH) != null) addBlankLine();
+	//else{
+		if (text.length == 0) return;
+		else if (text.data[text.length-1] == '\n') return;
+		add("\n");
+	//}
+}
+//===================================================================
+public void addBlankLine()
+//===================================================================
+{
+	if (text.length != 0 && text.data[text.length-1] == '\n'){
+		if (text.length == 1) ;
+		else if (text.data[text.length-2] != '\n')
+			add("\n");
+	}else if (text.length == 0) add("\n");
+	else add("\n\n");
+}
+//===================================================================
+Color toColor(Object colorOrName)
+//===================================================================
+{
+	return toColor(colorOrName,Color.Black);
+}
+//===================================================================
+Color toColor(Object colorOrName,Color defaultColor)
+//===================================================================
+{
+	if (colorOrName instanceof Color) return ((Color)colorOrName);
+	String color = (colorOrName instanceof String) ? (String)colorOrName : null;
+	if (color == null || color.length() == 0) return defaultColor;
+	int col = 0, max = color.length();
+	if (color.charAt(0) != '#'){
+		color = color.toLowerCase();
+		int where = colors.indexOf(color);
+		if (where == -1) color = '#'+color;//return Color.Black;
+		else try{
+			color = '#'+colors.substring(where+color.length(),where+color.length()+6);
+		}catch(Exception e){
+			return defaultColor;
+		}
+	}
+	max = color.length();
+	color = color.toUpperCase();
+	for (int i = 1; i<max; i++){
+		char c = color.charAt(i);
+		if (c >= '0' && c <= '9')
+			col = col*16+(c-'0');
+		else if (c >= 'A' && c <= 'F')
+			col = col*16+10+(c-'A');
+		else
+			return defaultColor;
+	}
+	return new Color((col >> 16) & 0xff,(col >> 8) & 0xff, col & 0xff);
+}
+
+
+//===================================================================
+String findStyle(char [] source,String styleName)
+//===================================================================
+{
+	if (source == null || styleName == null) return null;
+	char [] look = Vm.getStringChars(styleName);
+	
+	for (int i = 0;;i++){
+		i = SubString.indexOf(':',source,0,source.length,i,0);
+		//Vm.debug("Look: "+styleName+" at "+i);
+		if (i == -1) return null;
+		if (i == 0) continue;
+		int e, s;
+		for (e = i-1; e>=0 && Character.isWhitespace(source[e]); e--)
+			;
+		if (e<0) continue;
+		for (s = e; s>=0 && source[s] != ';' && !Character.isWhitespace(source[s]); s--)
+			;
+		s++;
+		int len = e-s+1;
+		if (!SubString.equals(look,0,look.length,source,s,len,SubString.IGNORE_CASE))
+			continue;
+		//
+		//Vm.debug("Found: "+styleName);
+		//
+		for (s = i+1; s<source.length && Character.isWhitespace(source[s]); s++)
+			;
+		if (s >= source.length) return null;
+		if (source[s] == '"' || source[s] == '\''){
+			char eq = source[s++];
+			for (e = s; e<source.length && source[e] != eq; e++)
+				;
+			e--;
+		}else{
+			for (e = s; e<source.length && source[e] != ';' && !Character.isWhitespace(source[e]); e++)
+				;
+			e--;
+		}
+		if (e<s) return "";
+		else return new String(source,s,e-s+1);
+	}
+}
+
+//===================================================================
+int nextProperty(int start,char [] source,PropertyList list)
+//===================================================================
+{
+	int ei = -1;
+	for (int i = start; i<source.length; i++)
+		if (source[i] == '=') {
+			ei = i;
+			break;
+		}
+	if (ei == -1) return -1;
+	String name = new String(source,start,ei-start).trim().toLowerCase();
+	char quote = 0;
+	int si = ei+1;
+	if (si < source.length && (source[si] == '"' || source[si] == '\''))
+		quote = source[si++];
+	for (ei = si; ei<source.length; ei++){
+		char c = source[ei];
+		if (((c == ' ' || c == '\n' || c == '\t')&& quote == 0) || c == quote) break;
+	}
+	if (ei > si){
+		String value = new String(source,si,ei-si);
+		if (name.equals("color")){
+			list.add(name,toColor(value));
+		}else
+			list.add(name,value);
+	}	
+	return quote == 0 ? ei : ei+1;
+}
+
+//===================================================================
+PropertyList toProperties(String attributes)
+//===================================================================
+{
+	if (attributes == null || attributes.length() == 0) return null;
+	char [] source = Vm.getStringChars(attributes);
+	PropertyList pl = new PropertyList();
+	for (int i = nextProperty(0,source,pl); i != -1; i = nextProperty(i,source,pl))
+		;
+	String name = pl.getString("id",null);
+	if (name != null) pl.set("name",name);
+	return pl;
+}
+
+void printTree()
+{
+	String depth = "";
+	for (Entry et = curEntry; et != null; et = (Entry)et.getParent())
+		depth += "->"+valueToName(et.type);
+	Vm.debug(depth);
+}
+
+int maxEntries = 0, nowEntries = 0;
+//-------------------------------------------------------------------
+Entry addType(int type,PropertyList attributes)
+//-------------------------------------------------------------------
+{
+	Entry e = new Entry();
+	e.type = type;
+	e.startIndex = text.length;
+	e.attributes = attributes;
+	creating.add(e);
+	curEntry.addChild(e);
+	curEntry = e;
+	nowEntries++;
+	if (nowEntries > maxEntries) {
+		//Vm.debug("Max: "+nowEntries);
+		//if (true || nowEntries == 50){
+			//printTree();
+		//}
+		maxEntries = nowEntries;
+	}
+	return e;
+}
+TagList formatters = new TagList();
+
+//-------------------------------------------------------------------
+protected void setupHotspot(HotSpot hs)
+//-------------------------------------------------------------------
+{
+	//hs.color = null;
+	//hs.fontFlags |= hs.FONT_CHANGE|Font.UNDERLINE;
+}
+//-------------------------------------------------------------------
+Entry findLast(int type,boolean removeIt)
+//-------------------------------------------------------------------
+{
+	int cs = creating.size()-1;
+	for (int i = cs; i >= 0; i--){
+		Entry e = (Entry)creating.get(i);
+		if (e.type == type) {
+			e.length = text.length-e.startIndex;
+			//if (e.length == 0 && type == HYPERLINK) e.length = 1;
+			TextFormatter tf = (TextFormatter)formatters.getValue(type,null);
+			String anchor = null;
+			if (tf == null){
+				if (type == HYPERLINK && e.attributes != null){
+					tf = new HotSpot();
+					if ((anchor = PropertyList.getString(e.attributes,"href",null)) != null){
+						tf.data = anchor;
+						tf.toolTip = PropertyList.getString(e.attributes,"title",null);
+						setupHotspot((HotSpot)tf);
+						
+					}else if ((anchor = e.attributes.getString("name",null)) != null){
+						tf.data = "!"+anchor;
+						tf.fontFlags = 0;
+						tf.cursor = 0;
+						tf.color = null;
+					}
+				}
+				if (tf == null) tf = new TextFormatter();
+				gatherFormats(e,tf);
+			}
+			e.formatter = tf;
+			//
+			/*
+			if (i != cs){
+				while(true){
+					int j = creating.size()-1;
+					if (j <= i) break;
+					int ty = ((Entry)creating.get(j)).type;
+					Vm.debug("Force ending: "+valueToName(ty));
+					end(ty);
+				}
+			}
+			*/
+			if (removeIt) creating.remove(e);
+			//
+			// If any of the children are still open, then consider them my siblings instead.
+			//
+			/*
+			if (e.getParent() != null){
+				int max = e.getChildCount();
+				for (int c = 0; c<
+			}
+			*/
+			return e;
+		}
+	}
+	return null;
+}
+
+//-------------------------------------------------------------------
+Color getStyleColor(char [] styles,String name)
+//-------------------------------------------------------------------
+{
+	String c = findStyle(styles,name);
+	if (c == null) return null;
+	return toColor(c,null);
+}
+
+//===================================================================
+public void setFormatFlags(Entry myEntry,TextFormatter tf, Entry e,boolean isFirst,PropertyList attributes)
+//===================================================================
+{
+	attributes = PropertyList.toPropertyList(attributes);
+	PropertyList ea = PropertyList.toPropertyList(e.attributes);
+	String style = ea.getString("style",null);
+	char [] st = style == null ? null : Vm.getStringChars(style);
+	
+	if (st != null){
+		if ((tf.fontFlags & tf.FONT_FREEZE) == 0){
+			Color color = getStyleColor(st,"color");
+			if (color != null) {
+				tf.fontFlags |= tf.FONT_CHANGE;
+				tf.color = color;
+			}
+		}
+		Color back = getStyleColor(st,"background");
+		if (back != null) {
+			tf.backgroundColor = back;
+			tf.lineFlags |= tf.LINE_BACKGROUND_COLOR_CHANGE;
+		}
+	}
+	
+		switch(e.type){
+			case HYPERLINK:
+				if (PropertyList.getString(e.attributes,"href",null) != null){
+					if (tf.color == null || (tf.fontFlags & tf.FONT_FREEZE) == 0) {
+						tf.color = (Color)bodyData.getValue("link",HotSpot.hotColor);
+					}
+					tf.fontFlags |= tf.FONT_CHANGE|Font.UNDERLINE;
+				}
+				break;
+			case HR:
+				tf.lineFlags |= tf.LINE_DRAW_RULE;
+				break;
+			case STRONG:
+			case BOLD:
+				tf.fontFlags |= tf.FONT_CHANGE|Font.BOLD;
+				break;
+			case DFN:
+			case EM:
+			case ITALIC:
+				tf.fontFlags |= tf.FONT_CHANGE|Font.ITALIC;
+				break;
+			case UNDERLINE:
+				tf.fontFlags |= tf.FONT_CHANGE|Font.UNDERLINE;
+				break;
+			case CENTERED:
+				if (isFirst){
+					tf.lineFlags |= tf.LINE_CENTERED;
+				}
+				break;
+			case BLOCKQUOTE:
+				if (isFirst){
+					tf.lineFlags |= tf.LINE_RESPLIT;
+					tf.leftMarginShift += 40;
+				}
+				break;
+				
+			case TITLE:
+				tf.lineFlags |= tf.LINE_RIGHT_ALIGNED;
+				tf.fontFlags |= tf.FONT_CHANGE|Font.ITALIC;
+				break;
+				
+			case TELETYPE:
+				tf.fontFlags |= tf.FONT_CHANGE|tf.FONT_FREEZE;
+				tf.fontName = Application.findFont("fixed",true).getName();
+				break;
+			case BIG:
+				tf.fontFlags |= tf.FONT_CHANGE;
+				tf.fontSizeChange += 2;
+				break;
+			case SMALL:
+				tf.fontFlags |= tf.FONT_CHANGE;
+				tf.fontSizeChange -= 4;
+				break;
+			case FONT:
+				if ((tf.fontFlags & tf.FONT_FREEZE) != 0) break;
+				tf.fontFlags |= tf.FONT_CHANGE|tf.FONT_FREEZE;
+				Color c = (Color)ea.getValue("color",null);
+				if (c != null) tf.color = c;
+				String face = ea.getString("face",null);
+				if (face != null) tf.fontName = face;
+				Object size = ea.getValue("size",null);
+				if (size instanceof String){
+					String siz = (String)size;
+					if (siz.charAt(0) == '+' || siz.charAt(0) == '-'){
+						int sz = Convert.toInt(siz.substring(1));
+						if (siz.charAt(0) == '-') sz *= -1;
+						ea.set("sizeChange",new Integer(sz*2));
+						size = null;
+					}else{
+						int sz = Convert.toInt(siz);
+						ea.set("size",size = new Integer(sz*2+12));
+					}
+				}
+				if (size instanceof Integer){
+					tf.fontSize = ((Integer)size).intValue();
+				}
+				tf.fontSizeChange = ea.getInt("sizeChange",0);
+				break;
+				
+			case PREFORMAT:
+				tf.fontFlags |= tf.FONT_CHANGE|tf.FONT_FREEZE;
+				tf.fontName = Application.findFont("fixed",true).getName();
+				if (isFirst){
+					tf.lineFlags |= tf.LINE_RESPLIT;
+				}
+				break;
+			case DD:
+				if (isFirst){
+					tf.lineFlags |= tf.LINE_RESPLIT;
+					tf.leftMarginShift += 40;
+				}
+				break;
+			case OLI:
+			case ULI:
+				if (isFirst){
+					tf.lineFlags |= tf.LINE_RESPLIT|tf.LINE_HEADER_RIGHT_ALIGN|tf.LINE_ADD_FIRST_LINE_HEADER;
+					tf.leftMarginShift += 40;
+				}
+				break;
+			case SPAN:
+				break;
+			case TABLE:
+				if (isFirst)
+					tf.lineFlags |= tf.LINE_CANCEL_ALIGNMENTS;
+					//break;
+			case TROW:
+			case TCELL:
+				if (isFirst){
+					String bg = ea.getString("bgcolor",null);
+					if (bg != null){
+						Color col = toColor(bg,null);
+						if (col != null) {
+							tf.lineFlags |= tf.LINE_BACKGROUND_COLOR_CHANGE;
+							tf.backgroundColor = col;
+						}
+					}
+				}
+				break;
+			case DIV:
+			case PARAGRAPH:
+				String align = PropertyList.getString(e.attributes,"align","").toLowerCase();
+				if (isFirst){
+					if (align.equals("right")){
+						tf.lineFlags |= tf.LINE_RIGHT_ALIGNED;
+					}else if (align.equals("center")){
+						tf.lineFlags |= tf.LINE_CENTERED;
+					}
+				}
+				break;
+			case BODY:
+				/*
+				Object tc = PropertyList.getValue(e.attributes,"text",null);
+				if (tc != null){
+					Color color = toColor(tc);
+					if (color != null){
+						tf.fontFlags |= tf.FONT_CHANGE;
+						tf.color = color;
+						if (e.attributes != null) e.attributes.set("text",color);
+					}
+				}
+				*/
+				break;
+				
+			case TEST:
+				tf.fontFlags |= tf.FONT_CHANGE;
+				tf.fontName = Application.findFont("fixed",true).getName();
+				if (isFirst){
+					tf.lineFlags |= tf.LINE_RESPLIT;
+					tf.lineFlags |= tf.LINE_RIGHT_ALIGNED;
+				}
+				break;
+			case ADDRESS:
+				tf.fontFlags |= tf.FONT_CHANGE|Font.ITALIC;
+				break;
+			case HEADING1:
+					tf.fontFlags |= tf.FONT_CHANGE|Font.BOLD;
+					tf.fontSizeChange = 2;
+					break;
+			case HEADING2:
+					tf.fontFlags |= tf.FONT_CHANGE|Font.BOLD;
+					tf.fontSizeChange = 1;
+					break;
+			case HEADING3:
+					tf.fontFlags |= tf.FONT_CHANGE|Font.BOLD;
+					break;
+			case HEADING4: case HEADING5: case HEADING6:
+					tf.fontFlags |= tf.FONT_CHANGE|Font.UNDERLINE;
+					break;
+	}
+	if (e.type >= HEADING1 && e.type <= HEADING6){
+		String align = PropertyList.getString(e.attributes,"align","").toLowerCase();
+		if (isFirst){
+			if (align.equals("right"))
+				tf.lineFlags |= tf.LINE_RIGHT_ALIGNED;
+			else if (align.equals("center")) 
+				tf.lineFlags |= tf.LINE_CENTERED;
+		}
+	}
+}
+//===================================================================
+void gatherFormats(Entry e,TextFormatter tf)
+//===================================================================
+{
+	int idx = creating.indexOf(e);
+	for (int i = idx; i >= 0; i--){
+		Entry et = (Entry)creating.get(i);
+		setFormatFlags(e,tf,et,i == idx,e.attributes);
+		//if (et.type >= CENTERED) break;
+	}
+}
+//===================================================================
+public Entry start(int type)
+//===================================================================
+{
+	return addType(type,null);
+}
+//===================================================================
+public Entry start(int type,PropertyList attributes)
+//===================================================================
+{
+	//if (type >= FIRST_SINGLE_LINE && type <= LAST_SINGLE_LINE) conditionalLineBreak();
+	if ((type & BLOCK_LEVEL) != 0){
+		end(PARAGRAPH);
+		//addBlankLine();
+		conditionalLineBreak();
+		//if (((type & IS_PARAGRAPH) != 0) && (endedParagraph||!endedTag)) addBlankLine();
+		if (((type & IS_PARAGRAPH) != 0) && !startFresh) addBlankLine();
+	}
+	endedParagraph = false;
+	if ((type & STARTS_FRESH) != 0) startFresh = true;
+	return addType(type,attributes);
+}
+
+Entry lastEntry = null;
+boolean endedParagraph = false;
+boolean startFresh = false;
+boolean endedTag = false;
+//===================================================================
+public Entry end(int type)
+//===================================================================
+{
+	Entry e = findLast(type,true);
+	if (e == null) return null;
+	entries.add(e);
+	//if (type >= FIRST_SINGLE_LINE && type <= LAST_SINGLE_LINE) conditionalLineBreak();
+	if ((type & BLOCK_LEVEL) != 0){
+		end(PARAGRAPH);
+		conditionalLineBreak();
+	}
+	//if (type >= HEADING1 && type <= HEADING6) addBlankLine();
+	if (type == PARAGRAPH) endedParagraph = true;
+	if ((type & IS_PARAGRAPH) != 0) endedParagraph = true;
+	endedTag = true;
+	if (e == curEntry){
+		curEntry = (Entry)e.getParent();
+		nowEntries--;
+	}else{
+		Entry tn;
+		for(tn = curEntry; tn != null && tn.getParent() != e; tn = (Entry)tn.getParent())
+			;		
+		if (tn != null){
+			e.removeChild(tn);
+			((Entry)e.getParent()).addChild(tn);
+		}
+		nowEntries--;
+	}
+	if (curEntry == null) curEntry = root;
+	//printTree();	
+	return lastEntry = e;
+}
+//===================================================================
+public void removeEntry(Entry e)
+//===================================================================
+{
+	entries.remove(e);
+}
+//===================================================================
+public Entry startOrEnd(int type,PropertyList attributes,boolean ending)
+//===================================================================
+{
+	if (ending) return end(type);
+	else return start(type,attributes);
+}
+
+//===================================================================
+public Entry findFirst(int [] types)
+//===================================================================
+{
+	for (int i = creating.size()-1; i >= 0; i--){
+		Entry e = (Entry)creating.get(i);
+		for (int j = 0; j<types.length; j++){
+			if (e.type == types[j]) return e;
+		}
+	}
+	return null;
+}
+//===================================================================
+public Entry cancel(int type)
+//===================================================================
+{
+	for (int i = creating.size()-1; i >= 0; i--){
+		Entry e = (Entry)creating.get(i);
+		if (e.type == type) {
+			creating.removeElementAt(i);
+			return e;
+		}
+	}
+	return null;
+}
+
+int building = 0;
+boolean shown = false;
+
+Gate splitLock = new Gate();
+
+//===================================================================
+public void linesSplit(TextDisplay pad)
+//===================================================================
+{
+	splitLock.synchronize(); try{
+	try{
+		/*
+		if (false && !shown){
+			TreeControl tc = new TreeControl();
+			tc.getTreeTableModel().setRootObject(root);
+			Form f = new Form();
+			f.addLast(new ScrollBarPanel(tc)).setPreferredSize(300,400);
+			f.title = "HTML Elements";
+			f.show();
+			shown = true;
+		}
+		*/
+		if (pad.getDim(null).width <= 0) return;
+		//Vm.debug("-----------------");
+		pad.clearTextFormatters();
+		Vector v = new Vector(entries.size()+10);
+		root.startIndex = 0;
+		root.length = text.length;
+		root.formatter = new TextFormatter();
+		root.formatter.startLine = 0;
+		root.formatter.numLines = pad.getNumLines();
+		
+		if (!root.reformat(pad,new TextPosition(pad),v)) {
+			return;
+		}
+		if (root.needPass2){
+			//Vm.debug("Need pass 2");
+			Vector s = new Vector();
+			root.getLineSpacers(pad,0,pad.getLine(0),s);
+			int numSpacers = s.size();
+			if (numSpacers != 0){
+				int [] all = new int[pad.getNumLines()];
+				Utils.getIntSequence(all,0);
+				for (int i = 0; i<numSpacers; i++)
+					((Entry)s.get(i)).addLineSpacers(pad,all);
+				root.fixFormatter(all);
+			}
+		}
+		/*
+		IntArray blanks = new IntArray();
+		root.addBlankLines(pad,blanks);
+		for (int i = 0; i<blanks.length; i+=2){
+			Vm.debug("Line: "+blanks.data[i]+", add: "+blanks.data[i+1]);
+		}
+		*/
+		int max = v.size();
+		for (int i = 0; i<max; i++){
+			TextFormatter tf = (TextFormatter)v.get(i);
+			pad.addTextFormatter(tf);
+		}
+		pad.formattersSet();
+	}catch(Throwable e){
+		new ReportException(e,null,null,false).execute();//show();
+		//Vm.debug(Vm.getStackTrace(e,10));
+	}
+	}finally{splitLock.unlock();}
+}
+
+TextDisplay myDisplay;
+//===================================================================
+public void addTo(TextDisplay pad)
+//===================================================================
+{
+	myDisplay = pad;
+	pad.addListener(this);
+	pad.setText(new String(text.data,0,text.length));
+}
+//===================================================================
+public void removeFrom(TextDisplay pad)
+//===================================================================
+{
+	pad.removeListener(this);
+	if (pad == myDisplay)
+		myDisplay = null;
+}
+//===================================================================
+public void onEvent(Event ev)
+//===================================================================
+{
+	if (ev instanceof ControlEvent && ev.type == TextDisplay.LINES_SPLIT){
+		linesSplit((TextDisplay)ev.target);
+	}
+}
+
+
+int lastNewType = 200;
+
+Entry root = new Entry(), curEntry = root;
+
+//===================================================================
+public int addType(TextFormatter f)
+//===================================================================
+{
+	formatters.set(lastNewType++,f);
+	return lastNewType-1;
+}
+
+static int EndFormatterFlags = TextFormatter.LINE_CENTERED|TextFormatter.LINE_RIGHT_ALIGNED;
+
+	
+	TextPosition temp = new TextPosition();
+	static Range range = new Range(0,0);
+	
+	//##################################################################
+	public class Entry extends MutableTreeNodeObject{
+	//##################################################################
+	int startIndex;
+	int length;
+	TextFormatter formatter, endFormatter;
+	PropertyList attributes;
+	int type = 0;
+	int curSequence;
+	int groupID;
+	Object data;
+	int visit;
+	public String getName() {return toString()+", "+attributes;}
+	public String toString() {return valueToName(type)+": ("+startIndex+"->"+(startIndex+length)+")";}
+	boolean needPass2 = false;
+	int putLinesAbove = 0;
+	int needAbove, needBelow;
+	
+	//===================================================================
+	public Entry getRoot()
+	//===================================================================
+	{
+		for (Entry e = this; e != null; e = (Entry)e.getParent())
+			if (e.getParent() == null) return e;
+		return null;
+	}
+	
+	//===================================================================
+	public void reset()
+	//===================================================================
+	{
+		curSequence = 0;
+	}
+	//===================================================================
+	int countLinesInMe(DisplayLine start, int indexOfLineCharacters)
+	//===================================================================
+	{
+		int num = 1;
+		int curIndex = indexOfLineCharacters+start.trueLength();
+		for (DisplayLine s = (DisplayLine)start.next; s != null; s = (DisplayLine)s.next){
+			int tl = 0;
+			if (curIndex >= startIndex && curIndex < startIndex+length){
+				num++;
+				curIndex += s.trueLength();
+			}else 
+				break;
+		}
+		return num;
+	}
+	/*
+	//===================================================================
+	TextFormatter getFormatterFor(int lineIndex)
+	//===================================================================
+	{
+		try{
+			TextFormatter ret = (TextFormatter)formatter.getCopy();
+			ret.line = lineIndex;
+			ret.groupID = groupID;
+			ret.groupIndex = curSequence++;
+			return ret;
+		}catch(RuntimeException e){
+			Vm.debug(Vm.getStackTrace(e,10));
+			return new TextFormatter();
+		}
+	}
+	*/
+	boolean amOpen = true;
+	/*
+	//===================================================================
+	public void getChildrenFormatters(TextPad pad,TextPosition t,Vector dest)
+	//===================================================================
+	{
+		int max = getChildCount();
+		for (int i = 0; i<max; i++){
+			Entry e = (Entry)getChild(i);
+			e.getFormatter(pad,t,dest);
+			if (e.needPass2) needPass2 = true;
+		}
+	}
+	*/
+	/*
+	//===================================================================
+	public void addBlankLines(TextPad pad,IntArray blanks)
+	//===================================================================
+	{
+		if (!hasImage) return;
+		if (putLinesAbove != 0){
+			DisplayLine dl = pad.getLine(formatter.startLine);
+			int added = pad.ensureBlankLines(dl,putLinesAbove,true);
+			if (added != 0){
+				int len = blanks.length;
+				if (len == 0) {
+					blanks.append(formatter.startLine);
+					blanks.append(added);
+				}else if (blanks.data[len-2] == formatter.startLine){
+					blanks.data[len-1] += added;
+				}else{
+					blanks.append(formatter.startLine);
+					blanks.append(added+blanks.data[len-1]);
+				}
+			}
+		}
+		int max = getChildCount();
+		for (int i = 0; i<max; i++){
+			((Entry)getChild(i)).addBlankLines(pad,blanks);
+		}
+		
+	}
+	*/
+	
+	TextPosition start;
+	
+	//-------------------------------------------------------------------
+	void linesInsertedAbove(TextPosition t, int startLine, int numInserted)
+	//-------------------------------------------------------------------
+	{
+		//Vm.debug(numInserted+" inserted above: "+startLine);
+		if (start == null){
+			int sl = formatter.startLine, nl = formatter.numLines;
+			if (formatter.startLine == startLine){
+				formatter.startLine += numInserted;
+				if (type == IMAGE || type == BLOCKIMAGE)
+					formatter.imageLine += numInserted;
+			}else if (formatter.startLine+formatter.numLines > startLine){
+				if (type == IMAGE || type == BLOCKIMAGE){
+					formatter.startLine += numInserted;
+					formatter.imageLine += numInserted;
+				}else
+					formatter.numLines += numInserted;
+			}else return;
+			//Vm.debug("Type: "+type+", I  was: "+sl+"->"+nl);
+			//Vm.debug("Type: "+type+", am now: "+formatter.startLine+"->"+formatter.numLines);
+		}else{
+			int sl = start.lineIndex, nl = start.characterIndex;
+			start.copyFrom(t);
+			start.findCharacter(startIndex);
+			t.copyFrom(start);
+			int max = getChildCount();
+			for (int i = 0; i<max; i++)
+				((Entry)getChild(i)).linesInsertedAbove(t,startLine,numInserted);
+			if (length != 0) t.findCharacter(startIndex+length-1);
+			//Vm.debug(hashCode()+" Type: "+type+", I  was: "+sl+" @ "+nl);
+			//Vm.debug(hashCode()+" Type: "+type+", am now: "+start.lineIndex+" @ "+start.characterIndex);
+		}
+	}
+	
+	//-------------------------------------------------------------------
+	void updateEndFormatter()
+	//-------------------------------------------------------------------
+	{
+		if (endFormatter != null){
+			endFormatter.startLine = formatter.startLine;
+			endFormatter.numLines = formatter.numLines;
+			endFormatter.startCharacter = formatter.startCharacter;
+			endFormatter.endCharacter = formatter.endCharacter;
+		}
+	}
+	//-------------------------------------------------------------------
+	void setupFormatter(TextPosition start,TextPosition current)
+	//-------------------------------------------------------------------
+	{
+		if (formatter == null){
+			formatter = new TextFormatter();
+			length = text.length-startIndex;
+		}
+		TextPosition t = current;
+		TextFormatter tf = formatter;
+		
+		if (type == IMAGE){
+			for (Entry p = (Entry)getParent(); p != null; p = (Entry)p.getParent()){
+				if (p.type == HYPERLINK && PropertyList.getString(p.attributes,"href",null) != null){
+					formatter.linkedTo = p.formatter;
+					break;
+				}
+			}
+		}
+
+		//
+		// An image type with an imageChar of -1 is a right or left aligned image.
+		if (type == IMAGE && tf.imageChar == -1)
+			return;
+		//
+		if (length > 0)
+			t.findCharacter(startIndex+length-1);
+		tf.startLine = start.lineIndex;
+		tf.numLines = t.lineIndex-start.lineIndex+1;
+		//
+		if (type == IMAGE){
+			tf.startCharacter = 0;
+			tf.endCharacter = -1;
+		}else if ((type & BLOCK_LEVEL) != 0){
+			tf.startCharacter = 0;
+			tf.endCharacter = -1;
+		}else if (length == 0){
+			tf.startCharacter =  tf.endCharacter = -1;	
+			if (type != IMAGE && type != HYPERLINK) tf.notUsed = true;
+		}else{
+			tf.startCharacter = startIndex-start.characterIndex;
+			tf.endCharacter = (startIndex+length-1)-t.characterIndex;
+		}
+		if (endFormatter != null) updateEndFormatter();
+	}
+	
+	//-------------------------------------------------------------------
+	boolean getFormatterForLine(int lineIndex,DisplayLine line,Vector dest,Entry stopAt)
+	//-------------------------------------------------------------------
+	{
+		if (stopAt == this) return false;
+		if (start != null){
+			temp.copyFrom(start);
+			setupFormatter(start,temp);
+		}
+		if (formatter == null) return true;
+		if (formatter.getCharRange(lineIndex,line,range) == null) {
+			return true;
+		}
+		dest.add(formatter);
+		int max = getChildCount();
+		for (int i = 0; i<max; i++)
+			if (!((Entry)getChild(i)).getFormatterForLine(lineIndex,line,dest,stopAt))
+				return false;
+		return true;
+	}
+	//-------------------------------------------------------------------
+	void addLineSpacers(TextPad pad,int lineIndex,DisplayLine line,int above,int below,int [] indexes)
+	//-------------------------------------------------------------------
+	{
+		if (above > 0) above = pad.ensureBlankLines(line,above,true);
+		if (below > 0) below = pad.ensureBlankLines(line,below,false);
+		if (above == 0 && below == 0) return;
+		indexes[lineIndex] += above;
+		above += below;
+		for (int i = lineIndex+1; i<indexes.length; i++)
+			indexes[i] += above;
+	}
+	//-------------------------------------------------------------------
+	void addLineSpacers(TextPad pad,int [] indexes)
+	//-------------------------------------------------------------------
+	{
+		addLineSpacers(pad,myLineIndex,myLine,needAbove,needBelow,indexes);
+	}
+	DisplayLine myLine;
+	int myLineIndex;
+	//-------------------------------------------------------------------
+	void getLineSpacers(TextPad pad,int lineIndex,DisplayLine line,Vector dest)
+	//-------------------------------------------------------------------
+	{
+		if (!needPass2) return;
+		int more = formatter.startLine-lineIndex;
+		if (more != 0){
+			line = (DisplayLine)line.getNext(line,more);
+			lineIndex += more;
+		}
+		myLineIndex = lineIndex;
+		myLine = line;
+		if (needAbove != 0 || needBelow != 0)
+			dest.add(this);
+		int max = getChildCount();
+		for (int i = 0; i<max; i++){
+			Entry e = (Entry)getChild(i);
+			if (!e.needPass2) continue;
+			e.getLineSpacers(pad,lineIndex,line,dest);
+		}
+	}
+	//-------------------------------------------------------------------
+	void fixFormatter(int [] indexes)
+	//-------------------------------------------------------------------
+	{
+		try{
+		if (type == IMAGE){
+			formatter.imageLine = indexes[formatter.imageLine];
+			if (formatter.imageChar == -1){
+				formatter.startLine = formatter.imageLine;
+			}else{
+				formatter.startLine = formatter.imageLine-needAbove;
+				formatter.numLines = 1+needAbove+needBelow;
+			}
+		}else{
+			int endLine = formatter.startLine+formatter.numLines-1;
+			formatter.startLine = indexes[formatter.startLine];
+			formatter.numLines = indexes[endLine]-formatter.startLine+1;
+		}
+		if (endFormatter != null) updateEndFormatter();
+		}catch(Exception e){}
+		int max = getChildCount();
+		for (int i = 0; i<max; i++)
+			((Entry)getChild(i)).fixFormatter(indexes);
+	}
+	/**
+	* This reformats the lines.
+	**/
+	//===================================================================
+	public boolean reformat(TextPad pad,TextPosition t,Vector addTo)
+	//===================================================================
+	{
+		try{
+			start = t.getCopy();
+			//Vm.debug(type+" for: "+start.characterIndex+" on "+start.lineIndex);
+			if (!start.findCharacter(startIndex)){
+				//Vm.debug("Not found: "+type+", "+startIndex);
+				return false;
+			}
+			/*
+			int depth = 0;
+			for (ewe.data.TreeNode tn = this; tn != null; tn = tn.getParent())
+				depth++;
+			Vm.debug(type+", "+depth);
+			*/
+			//
+			// Now start points to the start of the text for this Entry.
+			//
+			t.copyFrom(start);
+			setupFormatter(start,t);
+			if (formatter.applyBefore())
+				addTo.add(formatter.getStartFormatter(formatter));
+			
+			//
+			// Resplit if necessary.
+			//
+			if (length != 0){
+					DisplayLine newLine = formatter.creatingFor(pad,start.line,t.lineIndex-start.lineIndex+1,start.lineIndex);
+			}
+			if (type == IMAGE){
+				//needPass2 = true;
+				TextFormatter tf = formatter;
+				tf.vSpace = PropertyList.getInt(attributes,"vspace",tf.vSpace);
+				tf.hSpace = PropertyList.getInt(attributes,"hspace",tf.hSpace);
+				tf.borderWidth = PropertyList.getInt(attributes,"border",tf.borderWidth);
+				final int extraWidth = tf.image.getWidth()+(tf.borderWidth+tf.hSpace)*2;
+				String align = PropertyList.getString(attributes,"align","bottom").toLowerCase();
+				int lh = pad.getLineHeight();
+				int ih = tf.image == null ? lh : tf.image.getHeight()+(tf.borderWidth+tf.vSpace)*2;
+				//
+				if (align.equals("bottom")){ 
+					ih += pad.getLineHeight()-pad.getBaselineHeight();
+					//Vm.debug(tf.image.getHeight()+", "+pad.getLineHeight()+", "+pad.getBaselineHeight());
+				}
+				//
+				int numLines = tf.image == null ? 1 : (ih+lh-1)/lh;
+				Vector v = new Vector();
+				root.getFormatterForLine(start.lineIndex,start.line,v,this);
+				FormattedTextSpecs fts = pad.getTextPositions(start.lineIndex,start.line,null,null,false);
+				int max = v.size();
+				for (int i = 0; i<max; i++){
+					((TextFormatter)v.get(i)).applySpecialFormat(pad,start.lineIndex,start.line,fts);
+				}
+				int allowedSpace = start.line.displayWidth;
+				final int fullLineSpace = pad.getAvailableWidth()-fts.leftMargin-fts.rightMargin;
+				//
+				// First see if inserting the image will cause it to go over the line.
+				//
+				if (align.equals("left") || align.equals("right")){
+					tf.startLine = start.lineIndex;
+					tf.numLines = numLines;
+					tf.startCharacter = 0;
+					tf.endCharacter = -1;
+					tf.imageLine = tf.startLine;
+					tf.imageChar = -1;
+					tf.imageY = 0;
+					tf.imageX = align.equals("left") ? 0 : -1;
+					
+					int didLines = 0;
+					DisplayLine first = start.line;
+					final int linesToDo = numLines;
+					final int fullWidth = fullLineSpace;
+					final int lineWidth = allowedSpace-extraWidth;
+					while(didLines < numLines){
+						int num = first.countToSectionEnd();
+						final int done = didLines;
+						pad.resplit(first,num,0,new DisplayLine.WidthProvider(){
+							int total = done;
+							public int getWidthFor(DisplayLineSpecs specs, int lineIndex, int startingCharacterIndex, DisplayLine splitSoFar)
+							{
+								int ret = (total >= linesToDo) ? fullWidth : lineWidth;
+								total++;
+								//Vm.debug(lineIndex+", "+ret+", "+fullWidth+", "+lineWidth);
+								return ret;
+							}
+						}
+							,null,null);
+						num = first.countToSectionEnd();
+						didLines += num;
+						if (num >= numLines) break;
+						first = (DisplayLine)first.getNext(first,num-1);//Go to line before the section end.
+						if (first.next == null) break; //No more lines? Then break.
+						first = (DisplayLine)first.next;
+					}
+					if (didLines < numLines){
+						pad.ensureBlankLines(first,numLines-didLines,false);
+					}
+					return true;
+				}else{
+					//
+					//
+					//
+					int before = startIndex-start.characterIndex;
+					int width = before == 0 ? 0 : fts.calculatedPositions[before-1];
+					width += fts.leftMargin+pad.spacing;
+					int widthUsed = before == 0 ? 0 : fts.calculatedPositions[before-1];
+					if (widthUsed+extraWidth >= allowedSpace){
+						DisplayLine dl = pad.breakLineBefore(start.line,startIndex-start.characterIndex);
+						if (dl != null){
+							start.lineIndex++;
+							start.line = dl;
+							start.characterIndex += startIndex-start.characterIndex;
+							start.line.displayWidth = allowedSpace;//normalWidth;
+						}
+						allowedSpace = fullLineSpace;
+					}
+					tf.numLines = 1;
+					tf.startLine = start.lineIndex;
+					tf.imageLine = start.lineIndex;
+					tf.imageChar = startIndex-start.characterIndex;
+					tf.startCharacter = 0;
+					tf.endCharacter = -1;
+					//
+					//
+					int num = start.line.countToSectionEnd();
+					final int firstLineWidth = allowedSpace-extraWidth;
+					start.line = pad.resplit(start.line,num,0,new DisplayLine.WidthProvider(){
+						public int getWidthFor(DisplayLineSpecs specs, int lineIndex, int startingCharacterIndex, DisplayLine splitSoFar)
+						{
+							int ret = lineIndex == 0 ? firstLineWidth : fullLineSpace;
+							return ret;
+						}
+					},null,null);
+					//
+					// Find out how much space we need above and below.
+					//
+					if (numLines != 1 || true){
+						if (align.equals("top")) {
+							needBelow = numLines-1;
+							tf.imageY = 0;
+						}else if (align.equals("middle")){
+							needAbove = needBelow = numLines/2;
+							numLines = needAbove+needBelow+1;
+							tf.imageY = ((numLines*lh)-ih)/2;
+						}else{
+							needAbove = numLines-1;
+							tf.imageY = (numLines*lh)-ih;
+							//Vm.debug("Bottom: "+tf.image.getHeight()+", "+ih+", "+numLines+", "+tf.imageY);
+						}
+						needPass2 = numLines != 1;//true;
+					}else{
+						if (align.equals("top"))
+							tf.imageY = 0;
+						else if (align.equals("middle"))
+							tf.imageY = (lh-ih)/2;
+						else
+							tf.imageY = (lh-ih);
+					}
+					return true; //Images never have any children.
+				}
+			}		
+			//
+			t.copyFrom(start);
+			int max = getChildCount();
+			for (int i = 0; i<max; i++){
+				Entry e = (Entry)getChild(i);
+				t.copyFrom(start);
+				if (!e.reformat(pad,t,addTo))
+					;
+					//return false;
+				if (e.needPass2) needPass2 = true;
+			}
+			if (length != 0 && formatter.applyAfter()){
+				endFormatter = formatter.getEndFormatter(endFormatter);
+				addTo.add(endFormatter);
+			}
+			t.copyFrom(start);
+			setupFormatter(start,t);
+			return true;
+		}finally{
+		
+		}
+	}
+	/*
+	//===================================================================
+	public boolean getTextFormatter(TextPad pad,TextPosition t,Vector addTo)
+	//===================================================================
+	{
+		start = t.getCopy();
+		if (!start.findCharacter(startIndex)) return false;
+		//
+		// Now start points to the start of the text for this Entry.
+		//
+		t.copyFrom(start);
+		addTo.add(formatter);
+		int max = getChildCount();
+		for (int i = 0; i<max; i++)
+			if (!((Entry)getChild(i)).getTextFormatter(pad,t,addTo))
+				return false;
+		setupFormatter(start,t);
+		return true;
+	}
+	*/
+/*	
+	//===================================================================
+	public boolean getFormatter(TextPad pad,TextPosition t,Vector dest)
+	//===================================================================
+	{
+		if (type == IMAGE) needPass2 = true;
+		if (formatter == null) return false;
+		start = t.getCopy();
+		start.copyFrom(t);
+		if (!start.findCharacter(startIndex)) return false;
+		if (length != 0){
+			if (!t.findCharacter(startIndex+length-1))
+				return false;
+		}else{
+			t.copyFrom(start);
+		}
+		//
+		// Resplit if necessary.
+		//
+		if (length != 0){
+			DisplayLine newLine = formatter.creatingFor(pad,start.line,t.lineIndex-start.lineIndex+1,start.lineIndex);
+			if (newLine != start.line && newLine != null) start.line = newLine;
+		}
+		// Setup the formatter to cover the lines as they now are.
+		if (type != IMAGE) {
+			setupFormatter(start,t);
+		}
+		dest.add(formatter);
+		//
+		if (type == IMAGE){ //length will be zero!
+			TextFormatter tf = formatter;
+			tf.vSpace = PropertyList.getInt(attributes,"vspace",tf.vSpace);
+			tf.hSpace = PropertyList.getInt(attributes,"hspace",tf.hSpace);
+			tf.borderWidth = PropertyList.getInt(attributes,"border",tf.borderWidth);
+			final int extraWidth = tf.image.getWidth()+(tf.borderWidth+tf.hSpace)*2;
+			String align = PropertyList.getString(attributes,"align","bottom").toLowerCase();
+			//
+			// First see if inserting the image will cause it to go over the line.
+			//
+			Vector v = new Vector();
+			root.getFormatterForLine(start.lineIndex,start.line,v,this);
+			FormattedTextSpecs fts = pad.getTextPositions(start.lineIndex,start.line,null,null,false);
+			int max = v.size();
+			for (int i = 0; i<max; i++)
+				((TextFormatter)v.get(i)).applySpecialFormat(pad,start.lineIndex,start.line,fts);
+			//
+			//
+			//
+			int before = startIndex-start.characterIndex;
+			int width = before == 0 ? 0 : fts.calculatedPositions[before-1];
+			width += fts.leftMargin+pad.spacing;
+			//Vm.debug(start.line.displayWidth+", "+width+", "+extraWidth);
+			int pw = pad.getSize(null).width;
+			final int normalWidth = pw-(pad.spacing*2)-pad.rightMargin-fts.leftMargin;
+			//Vm.debug((pw-pad.spacing-pad.rightMargin)+", "+width+", "+extraWidth+", "+(displayWidth-extraWidth));
+			if (width+extraWidth >= normalWidth){
+				//Vm.debug("Splitting!");
+				DisplayLine dl = pad.breakLineBefore(start.line,startIndex-start.characterIndex);
+				if (dl != null){
+					start.lineIndex++;
+					start.line = dl;
+					start.line.displayWidth = normalWidth;
+					start.characterIndex += startIndex-start.characterIndex;
+				}
+			}
+			final int displayWidth = start.line.displayWidth;
+			tf.numLines = 1;
+			tf.startLine = start.lineIndex;
+			tf.imageLine = start.lineIndex;
+			tf.imageChar = startIndex-start.characterIndex;
+			//Vm.debug(tf.imageLine+", "+tf.imageChar);
+			tf.startCharacter = 0;
+			tf.endCharacter = -1;
+			
+			int lh = pad.getLineHeight();
+			int ih = tf.image == null ? lh : tf.image.getHeight()+(tf.borderWidth+tf.vSpace)*2;
+			int numLines = tf.image == null ? 1 : (ih+lh-1)/lh;
+			int needAbove = 0, needBelow = 0;
+			if (numLines != 1){
+				if (align.equals("top")) {
+					needBelow = numLines-1;
+					tf.imageY = 0;
+				}else if (align.equals("center")){
+					needAbove = needBelow = numLines/2;
+					numLines = needAbove+needBelow+1;
+					tf.imageY = ((numLines*lh)-ih)/2;
+				}else{
+					needAbove = numLines-1;
+					tf.imageY = (numLines*lh)-ih;
+				}
+				int num = start.line.countToSectionEnd();
+				start.line = pad.resplit(start.line,num,0,new DisplayLine.WidthProvider(){
+					public int getWidthFor(DisplayLineSpecs specs, int lineIndex, int startingCharacterIndex, DisplayLine splitSoFar)
+					{
+						int ret = lineIndex == 0 ? displayWidth-extraWidth : normalWidth;
+						return ret;
+					}
+				},null,null);
+				t.copyFrom(start);
+			}
+			int lineIndex = start.lineIndex;
+			tf.numLines = 1;
+			int added = true ? 0 : pad.ensureBlankLines(start.line,needAbove,true);
+			if (added > 0) {
+				//Vm.debug(hashCode()+" - adding: "+added);
+				getRoot().linesInsertedAbove(new TextPosition(pad),start.lineIndex,added);
+			}
+			tf.numLines += added;
+			t.lineIndex += added;
+			
+			start.lineIndex = lineIndex+added;
+			tf.imageLine = start.lineIndex;
+			
+			added = true ? 0 : pad.ensureBlankLines(start.line,needBelow,false);
+			
+			putLinesAbove = needAbove;
+		}else{
+			// Reposition to start.
+			if (start.line.invalid) start = new TextPosition(pad,start.lineIndex,start.characterIndex);
+			t.copyFrom(start);
+			getChildrenFormatters(pad,t,dest);
+			//
+			// Now lines may have been modified, so setup Formatter again.
+			//
+			setupFormatter(start,t);
+			if (type == ITALIC) Vm.debug(formatter.toString());
+		}
+		start = null;
+		return true;
+	}
+	*/
+	//##################################################################
+	}
+	//##################################################################
+
+
+private static String [] htmlTags = 
+{"p","b","i","u","center",
+"h1","h2","h3","h4","h5","h6",
+"tt","big","small","div","span","font","a","title","strong","em","dfn","blockquote","address",
+"body","dir","menu","code"
+//,"table","tr","td","th"
+};
+private static int [] htmlTypes =
+{PARAGRAPH,BOLD,ITALIC,UNDERLINE,CENTERED,
+HEADING1,HEADING2,HEADING3,HEADING4,HEADING5,HEADING6,
+TELETYPE,BIG,SMALL,DIV,SPAN,FONT,HYPERLINK,TITLE,STRONG,EM,DFN,BLOCKQUOTE,ADDRESS,
+BODY,PARAGRAPH,PARAGRAPH,TELETYPE
+//,TABLE,TROW,TCELL,TCELL
+};
+private static int [] listTypes = {UL,OL,OLI,ULI};
+private static int [] listStarts = {UL,OL};
+private static int [] defLists = {DT,DD,DL};
+private static int [] tableTypes = {TABLE,TROW,TCELL};
+private static int [] tableStarts = {TABLE};
+
+//===================================================================
+void endTableCellOrRow(boolean isTR)
+//===================================================================
+{
+	Entry s = findFirst(tableStarts);
+	if (s == null) return;
+	while(true){
+		Entry e = findFirst(tableTypes);
+		if (e == null) return;
+		if (e.type == TABLE) return;
+		if (e.type == TROW && !isTR) return;
+		conditionalLineBreak();
+		end(e.type);
+	}
+}
+//===================================================================
+void endListItem()
+//===================================================================
+{
+	Entry s = findFirst(listStarts);
+	if (s == null) return;
+	Object data = s.data;
+	Entry e = findFirst(listTypes);
+	if (e == null) return;
+	if (e.type != OLI && e.type != ULI) return;
+	conditionalLineBreak();
+	e = end(e.type);
+	e.formatter.data = data;
+	// Update the data.
+	if (data != null && e.type == OLI){
+		String dt = data.toString();
+		int value = Convert.toInt(dt);
+		if (value == 0 && !dt.equals("0")){
+			char [] ch = dt.toCharArray();
+			if (ch.length != 0) ch[0]++;
+			dt = new String(ch);
+		}else{
+			dt += ".";
+			e.formatter.data = dt;
+			dt = Convert.toString(value+1);
+		}
+		s.data = dt;
+	}
+}
+//===================================================================
+void endDefDataOrTerm()
+//===================================================================
+{
+	Entry e = findFirst(defLists);
+	if (e == null) return;
+	if (e.type != DD && e.type != DT) return;
+	conditionalLineBreak();
+	end(e.type);
+}
+public PropertyList headerData = new PropertyList();
+public PropertyList bodyData = new PropertyList();
+
+boolean waitingToRefresh = false, needRefresh = false;
+
+//-------------------------------------------------------------------
+protected Handle getAnImage(Object nameOrProperties,boolean documentImage)
+//-------------------------------------------------------------------
+{
+	if (properties.getBoolean("allowImages",true) && nameOrProperties != null) {
+		ImageResolver ir = (ImageResolver)properties.getValue("imageResolver",imageResolver);
+		if (ir != null){
+			PropertyList pl = (nameOrProperties instanceof PropertyList) ? (PropertyList)nameOrProperties : null;
+			if (pl == null) pl = PropertyList.make("src|"+nameOrProperties);
+			return ir.resolveImage(pl,documentImage ? properties.getBoolean("allowAnimatedImages",true) : false,
+			documentImage ? (Dimension)properties.getValue("maxImageSize",null) : null);
+		}
+	}
+	return new Handle(Handle.Failed,null);
+}
+//===================================================================
+public void parseHtml(final TextDisplay forDisplay,String text,Handle handle)
+//===================================================================
+{
+	//ewe.ui.Notepad np = new ewe.ui.Notepad();
+	//np.theText = text;
+	//np.execute();
+	myDisplay = forDisplay;
+	splitLock.synchronize(); try{
+	char [] source = Vm.getStringChars(text);
+	int len = source.length;
+	String headerTag = null;
+	boolean pastHeader = false;
+	boolean inHeader = false;
+	boolean inForm = false;
+	if (handle == null) handle = new Handle();
+	handle.resetProgress(0.1f);
+	YieldToEvents ye = new YieldToEvents(10,100);
+	for(int reached = 0; reached < len && !handle.shouldStop;){
+		ye.yield();
+		float progress = (float)((double)reached/len);
+		handle.setProgress(progress);
+		int idx = text.indexOf('<',reached);
+		if (idx != -1){
+			if (idx <= len-6 && source[idx+1] == '!' && source[idx+2] == '-' && source[idx+3] == '-'){ // Comment
+				int end = text.indexOf("-->",idx+3);
+				if (end != -1){ // Missing --> implies a comment in error.
+					if (!inForm) addHtml(text.substring(reached,idx));
+					reached = end+3;
+					continue;
+				}/*else
+					break;*/
+			}
+		}
+		int idx2 = idx == -1 ? -1 : text.indexOf('>',idx);
+		if (idx == -1 || idx2 == -1){
+			String ss = text.substring(reached);
+			if (!inForm){
+				if (headerTag == null) addHtml(ss);
+				else headerData.set(headerTag,headerData.getString(headerTag,"")+ss);
+			}
+			break;
+		}
+		int idx3 = text.indexOf('<',idx+1);
+		if (idx3 != -1 && idx3 < idx2){
+			String ss = text.substring(reached,idx3);
+			if (!inForm){
+				if (headerTag == null) addHtml(ss);
+				else headerData.set(headerTag,headerData.getString(headerTag,"")+ss);
+			}
+			reached = idx3;
+			continue;
+		}
+		if (!inForm){
+			if (headerTag == null) addHtml(text.substring(reached,idx));
+			else headerData.set(headerTag,headerData.getString(headerTag,"")+text.substring(reached,idx));
+		}		
+		reached = idx2+1;
+		if (idx+1 == idx2) continue;
+		String insideTag = text.substring(idx+1,idx2);
+		boolean ending = insideTag.charAt(0) == '/';
+		int space = insideTag.indexOf(' ');
+		int sp2 = insideTag.indexOf('\n');
+		if (sp2 != -1 && (space == -1 || sp2 < space)) space = sp2;
+		sp2 = insideTag.indexOf('\r');
+		if (sp2 != -1 && (space == -1 || sp2 < space)) space = sp2;
+		sp2 = insideTag.indexOf('\t');
+		if (sp2 != -1 && (space == -1 || sp2 < space)) space = sp2;
+			
+		String tag = space == -1 ? insideTag : insideTag.substring(0,space);
+		if (ending) tag = tag.substring(1);
+		tag = tag.toLowerCase();
+		if (inForm){
+			if (tag.equals("form") || tag.equals("script"))
+				if (ending) inForm = false;
+			continue;
+		}else if ((tag.equals("form") || tag.equals("script"))&& !inForm){
+			inForm = true;
+			continue;
+		}
+		if (!pastHeader){
+			if (tag.equals("head")){
+				if (ending){
+					headerTag = null;
+					pastHeader = true;
+					inHeader = false;
+				}else{
+					inHeader = true;
+				}
+				continue;
+			}else if (tag.equals("body")){
+				headerTag = null;
+				pastHeader = true;
+				inHeader = false;
+				//continue;
+			}else if (inHeader){
+				if (ending) headerTag = null;
+				else headerTag = tag;
+				continue;
+			}else if (tag.equals("title")){
+				inHeader = true;
+				headerTag = tag;
+				continue;
+			}
+		}
+		if (tag.equals("pre") && !inPreFormat){
+			if (reached < len && text.charAt(reached) == '\r') reached++;
+			if (reached < len && text.charAt(reached) == '\n') reached++;
+		}
+		String attr = space == -1 ? null : insideTag.substring(space+1);
+		PropertyList attributes = toProperties(attr);
+		boolean did = false;
+		Entry didE = null;
+		for (int i = 0; !did && i<htmlTags.length; i++){
+			if (htmlTags[i].equals(tag)){
+				did = true;
+				didE = startOrEnd(htmlTypes[i],attributes,ending);
+			}
+		}
+		if (tag.equals("body")){
+			if (!ending){
+				PropertyList a = PropertyList.toPropertyList(attributes);
+				final Handle h = getAnImage(a.getString("background",null),false);
+				if ((h.check() & h.Success) != 0)
+					bodyData.set("backgroundImage",h.returnValue);
+				else if ((h.check() & h.Stopped) == 0){
+					new Task(){
+						protected void doRun(){
+							if (waitOnSuccess(h,TimeOut.Forever,false)){
+								bodyData.set("backgroundImage",h.returnValue);
+								if (myDisplay != null) {
+									myDisplay.displayPropertiesChanged();
+								}
+							}
+						}
+					}.start();
+				}
+				bodyData.set("background",toColor(a.getValue("bgcolor",Color.White),Color.White));
+				bodyData.set("foreground",toColor(a.getValue("text",Color.Black),Color.Black));
+				bodyData.set("link",toColor(a.getValue("link",HotSpot.hotColor),HotSpot.hotColor));
+			}
+			continue;
+		}else if (tag.equals("a") && ending && didE != null){
+			if (this.text.length != 0 && this.text.data[this.text.length-1] == ' ')
+				didE.length--;
+		}
+		if (!did){
+			if (tag.equals("br")) add("\n");
+			else if (tag.equals("hr")){
+				conditionalLineBreak();
+				start(HR,attributes);
+				add(" ");
+				end(HR);
+				/*
+			}else if (tag.equals("test")){
+				if (!ending) lineBreak();
+				startOrEnd(TEST,attributes,ending);
+				if (ending) lineBreak();
+				*/
+			}else if (tag.equals("pre")){
+				//conditionalLineBreak();
+				inPreFormat = !ending;
+				startOrEnd(PREFORMAT,attributes,ending);
+			}else if (tag.equals("table")){
+				if (ending) endTableCellOrRow(true);
+				startOrEnd(TABLE,attributes,ending);
+			}else if (tag.equals("tr")){
+				if (ending) endTableCellOrRow(false);
+				else endTableCellOrRow(true);
+				startOrEnd(TROW,attributes,ending);
+			}else if (tag.equals("td") || tag.equals("th")){
+				if (!ending) endTableCellOrRow(false);
+				startOrEnd(TCELL,attributes,ending);
+			}else if (tag.equals("ul")){
+				if (ending) endListItem();
+				else {
+					conditionalLineBreak();
+					//lineBreak();
+				}
+				Entry e = startOrEnd(UL,attributes,ending);
+				if (!ending) e.data = TextFormatter.SOLID_CIRCLE;
+				//else removeEntry(e);
+			}else if (tag.equals("ol")){
+				if (ending) endListItem();
+				else {
+					conditionalLineBreak();
+					//lineBreak();
+				}
+				Entry e = startOrEnd(OL,attributes,ending);
+				if (!ending) e.data = PropertyList.getString(attributes,"start","1");
+				//else removeEntry(e);
+			}else if (tag.equals("li")){
+				endListItem();
+				if (!ending){
+					int typeToUse = OLI;
+					Entry e = findFirst(listStarts);
+					if (e == null) continue;
+					if (e.type == UL) typeToUse = ULI;
+					startOrEnd(typeToUse,attributes,ending);
+				}
+			}else if (tag.equals("dl")){
+				if (ending) endDefDataOrTerm();
+				else conditionalLineBreak();
+				startOrEnd(DL,attributes,ending);
+			}else if (tag.equals("dt")){
+				if (!ending) {
+					endDefDataOrTerm();
+					conditionalLineBreak();
+				}
+				startOrEnd(DT,attributes,ending);
+			}else if (tag.equals("dd")){
+				if (!ending) {
+					endDefDataOrTerm();
+					conditionalLineBreak();
+				}
+				startOrEnd(DD,attributes,ending);
+				}else if (tag.equals("img")){
+					start(IMAGE,attributes);
+					final Entry e = end(IMAGE);
+					final IImage ui = TextFormatter.getUnknownImage();
+					e.formatter.image = ui;
+					if (properties.getBoolean("allowImages",true)){
+						Object toGet = PropertyList.toPropertyList(attributes);
+						final Handle h = getAnImage(toGet,true);
+						/*
+						ImageResolver ir = (ImageResolver)properties.getValue("imageResolver",imageResolver);
+						final Handle h = ir.resolveImage(PropertyList.toPropertyList(attributes),
+						properties.getBoolean("allowAnimatedImages",true),
+						(Dimension)properties.getValue("maxImageSize",null));
+						*/
+						//mThread.yield();
+						if ((h.check() & h.Success) != 0)
+							e.formatter.image = (IImage)h.returnValue;
+						else if ((h.check() & h.Failure) != 0){
+							//Vm.debug("Could not resolve: "+toGet);
+							e.formatter.image = TextFormatter.getBrokenImage();
+						}else
+							new Thread(){
+								public void run(){
+										try{
+											h.waitOn(h.Success);
+											e.formatter.image = (IImage)h.returnValue;
+										}catch(Exception ex){
+											e.formatter.image = TextFormatter.getBrokenImage();
+										}
+										if (e.formatter.image.getWidth() == ui.getWidth() && e.formatter.image.getHeight() == ui.getHeight()){
+											e.formatter.repaint(forDisplay,null);
+											return;
+										}
+										if (waitingToRefresh){
+											needRefresh = true;
+										}else{
+											waitingToRefresh = true;
+											needRefresh = false;
+											while(true){
+												mThread.nap(500);
+												if (!needRefresh) break;
+												needRefresh = false;
+											}
+											waitingToRefresh = false;
+											splitLock.synchronize(); try{
+												if (forDisplay == myDisplay)
+													forDisplay.setText(forDisplay.text);
+											}finally{splitLock.unlock();}
+										}
+								}						
+							}.start();
+					}
+					String prop = PropertyList.getString(attributes,"align","").toLowerCase();
+					if (!prop.equals("left") && !prop.equals("right"))
+						add(" ");
+				/*
+					start(ITALIC,null);
+					add("<Image");
+					if (alt != null) add(": "+alt);
+					add(">");
+					end(ITALIC);
+				*/
+				}
+		}
+	}
+	}catch(Exception e){
+		Vm.debug(Vm.getStackTrace(e,10));
+	}finally{splitLock.unlock(); if (handle != null) handle.setProgress(1.0f);}
+}
+//===================================================================
+public void endHtml()
+//===================================================================
+{
+	if (end(PARAGRAPH) != null) addBlankLine();
+	conditionalLineBreak();
+}
+
+//===================================================================
+public PropertyList properties = new PropertyList();
+//===================================================================
+
+ImageResolver imageResolver = this;
+
+Hashtable imageCache;
+
+//===================================================================
+public Handle resolveImage(final PropertyList imageProperties,final boolean allowAnimatedImages,final Dimension maxSize)
+//===================================================================
+{
+	final String src = imageProperties.getString("src",null);
+	if (src == null) return new Handle(Handle.Failed,null);
+	if (false){
+		IImage got = resolveImageNow(src,allowAnimatedImages,maxSize,imageProperties);
+		if (got == null) return new Handle(Handle.Failed,null);
+		else return new Handle(Handle.Succeeded,got);
+	}
+	
+	return new Task(){
+		protected void doRun(){
+			Handle handle = this;
+			IImage got = resolveImageNow(src,allowAnimatedImages,maxSize,imageProperties);
+			if (got == null) handle.set(Handle.Failed);
+			else {
+				handle.returnValue = got;
+				handle.set(Handle.Succeeded);
+			}
+		}
+	}.start();
+}
+
+private static ByteArray scaleArray;
+//===================================================================
+public IImage resolveImageNow(String src,boolean allowAnimatedImages,Dimension maxSize,PropertyList imageProperties)
+//===================================================================
+{
+	//Vm.debug("Going to resolve: "+src);
+	if (scaleArray == null) scaleArray = new ByteArray();
+	String path = File.removeTrailingSlash(properties.getString("documentRoot",""));
+	if (path.equals("/")) path += src;
+	else path += "/"+src;
+	if (imageCache == null) imageCache = new Hashtable();
+	Object found = imageCache.get(path);
+	if (found instanceof IImage) {
+		//Vm.debug("I found in cache: "+path);
+		return (IImage)found;
+	}
+	try{
+		IImage got = null;
+		ByteArray all = Vm.readResource(null,path,null);
+		//Vm.debug("Read resource: "+path);
+		if (all == null) throw new IllegalArgumentException();
+		//Vm.debug("I resolved: "+path);
+		/*
+		ImageInfo info = Image.getImageInfo(ba,null);
+		if (info.format == ImageInfo.FORMAT_GIF && allowAnimatedImages){
+			ewe.io.MemoryFile mf = new ewe.io.MemoryFile();
+			mf.data = ba;
+			got = ewe.graphics.AnimatedIcon.getAnimatedImageFromGIF(mf);
+		}
+		if (maxSize != null && !(got instanceof AniImage)){
+			if (got == null) 
+				got = info.canScale && (info.width > maxSize.width || info.height > maxSize.height) 
+					? 
+					new Image(ba,0,maxSize.width,maxSize.height) : 
+					new Image(ba,0);
+			if (got.getWidth() > maxSize.width || got.getHeight() > maxSize.height){
+				got = new PixelBuffer(got).scale(maxSize.width,maxSize.height,null,PixelBuffer.SCALE_KEEP_ASPECT_RATIO,scaleArray).toMImage();
+			}
+			if (got instanceof Image) got = new mImage(got);
+		}else if (got == null)
+			got = new Picture(new FormattedDataSource().set(ba),0);
+		*/
+		if (got == null){
+			FormattedDataSource fds = new FormattedDataSource().set(all);
+			got = ImageDecoder.decodeScaledPicture(fds, maxSize, true, true, null);
+		}
+		PropertyList pl = PropertyList.toPropertyList(imageProperties);
+		int ww = pl.getInt("width",got.getWidth());
+		int hh = pl.getInt("height",got.getHeight());
+		if (ww <= 0) ww = got.getWidth();
+		if (hh <= 0) hh = got.getHeight();
+		if (maxSize != null){
+			if (ww > maxSize.width) ww = maxSize.width;
+			if (hh > maxSize.height) hh = maxSize.height;
+		}
+		if (ww != got.getWidth() && hh != got.getHeight())
+			got = new PixelBuffer(got).scale(ww,hh,null,0,scaleArray).toPicture();
+		imageCache.put(path,got);
+		return got;
+	/*
+		if (imageCache == null) imageCache = new ImageCache();
+		return imageCache.getImage(path);
+	*/
+	}catch(Exception e){
+		//Vm.debug("Bad image: "+path);
+		//Vm.debug(Vm.getStackTrace(e,10));
+	}
+	return null;
+}
+//##################################################################
+}
+//##################################################################
+
+

Added: experiments/EVEhist/src/eve/ui/formatted/FormattedTextMakerBase.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/FormattedTextMakerBase.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/FormattedTextMakerBase.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,124 @@
+
+package eve.ui.formatted;
+import java.util.Vector;
+
+//##################################################################
+class FormattedTextMakerBase{
+//##################################################################
+
+
+final static String nbsp = ""+(char)0xa0;
+static Object [] replacements = {"&gt;",">","&lt;","<","&nbsp;",nbsp,"&copy;",""+(char)169,"&quot;","\"","&amp;","&"};
+static Object [] htmlReplacements = {"\r"," ","\n"," ","\t"," ","  "," "};
+static Object [] preReplacements = {" ",nbsp};
+
+static String amps =(char)34+"quot|"+(char)38+"amp|"+(char)60+"lt|"+(char)62+"gt|"+
+(char)128+"euro|"+(char)130+"sbquo|"+(char)131+"fnof|"+(char)132+"bdquo|"+
+(char)133+"hellip|"+(char)134+"dagger|"+(char)135+"Dagger|"+(char)136+"circ|"+
+(char)137+"permil|"+(char)138+"Scaron|"+(char)139+"lsaquo|"+(char)140+"OElig|"+
+(char)145+"lsquo|"+(char)146+"rsquo|"+(char)147+"ldquo|"+(char)148+"rdquo|"+
+(char)149+"bull|"+(char)150+"ndash|"+(char)151+"mdash|"+(char)152+"tilde|"+
+(char)153+"trade|"+(char)154+"scaron|"+(char)155+"rsaquo|"+(char)156+"oelig|"+
+(char)159+"Yuml|"+(char)160+"nbsp|"+(char)161+"iexcl|"+(char)162+"cent|"+
+(char)163+"pound|"+(char)164+"curren|"+(char)165+"yen|"+(char)166+"brvbar|"+
+(char)167+"sect|"+(char)168+"uml|"+(char)169+"copy|"+(char)170+"ordf|"+
+(char)171+"laquo|"+(char)172+"not|"+(char)173+"shy|"+(char)174+"reg|"+
+(char)175+"macr|"+(char)176+"deg|"+(char)177+"plusmn|"+(char)178+"sup2|"+
+(char)179+"sup3|"+(char)180+"acute|"+(char)181+"micro|"+(char)182+"para|"+
+(char)183+"middot|"+(char)184+"cedil|"+(char)185+"sup1|"+(char)186+"ordm|"+
+(char)187+"raquo|"+(char)188+"frac14|"+(char)189+"frac12|"+(char)190+"frac34|"+
+(char)191+"iquest|"+(char)192+"Agrave|"+(char)193+"Aacute|"+(char)194+"Acirc|"+
+(char)195+"Atilde|"+(char)196+"Auml|"+(char)197+"Aring|"+(char)198+"AElig|"+
+(char)199+"Ccedil|"+(char)200+"Egrave|"+(char)201+"Eacute|"+(char)202+"Ecirc|"+
+(char)203+"Euml|"+(char)204+"Igrave|"+(char)205+"Iacute|"+(char)206+"Icirc|"+
+(char)207+"Iuml|"+(char)208+"ETH|"+(char)209+"Ntilde|"+(char)210+"Ograve|"+
+(char)211+"Oacute|"+(char)212+"Ocirc|"+(char)213+"Otilde|"+(char)214+"Ouml|"+
+(char)215+"times|"+	(char)216+"Oslash|"+(char)217+"Ugrave|"+(char)218+"Uacute|"+
+(char)219+"Ucirc|"+	(char)220+"Uuml|"+(char)221+"Yacute|"+(char)222+"THORN|"+
+(char)223+"szlig|"+	(char)224+"agrave|"+(char)225+"aacute|"+(char)226+"acirc|"+
+(char)227+"atilde|"+(char)228+"auml|"+(char)229+"aring|"+(char)230+"aelig|"+
+(char)231+"ccedil|"+(char)232+"egrave|"+(char)233+"eacute|"+(char)234+"ecirc|"+
+(char)235+"euml|"+(char)236+"igrave|"+(char)237+"iacute|"+(char)238+"icirc|"+
+(char)239+"iuml|"+(char)240+"eth|"+(char)241+"ntilde|"+(char)242+"ograve|"+
+(char)243+"oacute|"+(char)244+"ocirc|"+(char)245+"otilde|"+(char)246+"ouml|"+
+(char)247+"divide|"+(char)248+"oslash|"+(char)249+"ugrave|"+(char)250+"uacute|"+
+(char)251+"ucirc|"+(char)252+"uuml|"+(char)253+"yacute|"+(char)254+"thorn|"+
+(char)255+"yuml";
+
+
+static Vector ampList;
+static final String colors = "black000000green008000silverC0C0C0lime00FF00"+
+"gray808080olive808000"+
+"whiteFFFFFFyellowFFFF00"+
+"maroon800000navy000080"+
+"redFF0000blue0000FF"+
+"purple800080teal008080"+
+"fuchsiaFF00FFaqua00FFFF"; 
+protected static final int LF_ORDERED_LIST = 0x80000000;
+public static final int BOLD = 1;
+public static final int ITALIC = 2;
+public static final int UNDERLINE = 3;
+public static final int HYPERLINK = 9;
+public static final int ANCHOR = 10;
+public static final int SPAN = 12;
+public static final int FONT = 14;
+public static final int BIG = 15;
+public static final int SMALL = 16;
+public static final int TELETYPE = 17;
+public static final int EM = 18;
+public static final int STRONG = 19;
+public static final int DFN = 20;
+public static final int IMAGE = 21;
+
+//public static final int FIRST_SINGLE_LINE = 100;
+//public static final int FIRST_BLOCK_LEVEL = 100;
+
+public static final int BLOCK_LEVEL = 0x08000000;
+public static final int STARTS_FRESH = 0x04000000;
+public static final int IS_PARAGRAPH = 0x02000000;
+
+public static final int CENTERED = 100|BLOCK_LEVEL;
+public static final int HEADING1 = 101|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int HEADING2 = 102|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int HEADING3 = 103|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int HEADING4 = 104|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int HEADING5 = 105|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int HEADING6 = 106|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int TITLE = 107|BLOCK_LEVEL;
+public static final int HR = 108|BLOCK_LEVEL;
+public static final int PARAGRAPH = 109|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int DIV = 110|BLOCK_LEVEL;
+public static final int PREFORMAT = 111|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int BLOCKQUOTE = 112|BLOCK_LEVEL;
+public static final int BLOCKIMAGE = 113|BLOCK_LEVEL;
+public static final int ADDRESS = 114|BLOCK_LEVEL;
+public static final int BODY = 115|BLOCK_LEVEL;
+public static final int TABLE = 116|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int TROW = 117|BLOCK_LEVEL;//|IS_PARAGRAPH;
+public static final int TCELL = 118|BLOCK_LEVEL;//|IS_PARAGRAPH;
+//public static final int LAST_SINGLE_LINE = 199;
+
+public static final int TEST = 211|BLOCK_LEVEL;
+
+public static final int UL = 212|BLOCK_LEVEL;
+public static final int OL = 213|BLOCK_LEVEL;
+public static final int ULI = 214|BLOCK_LEVEL|STARTS_FRESH;
+public static final int OLI = 215|BLOCK_LEVEL|STARTS_FRESH;
+public static final int DL = 216|BLOCK_LEVEL|IS_PARAGRAPH;
+public static final int DT = 217|BLOCK_LEVEL|STARTS_FRESH;
+public static final int DD = 218|BLOCK_LEVEL;
+//public static final int LAST_BLOCK_LEVEL = 299;
+
+private static int[] theValues = {BOLD,ITALIC,UNDERLINE,HYPERLINK,ANCHOR,SPAN,FONT,BIG,SMALL,TELETYPE,EM,STRONG,DFN,IMAGE,BLOCK_LEVEL,STARTS_FRESH,IS_PARAGRAPH,CENTERED,HEADING1,HEADING2,HEADING3,HEADING4,HEADING5,HEADING6,TITLE,HR,PARAGRAPH,DIV,PREFORMAT,BLOCKQUOTE,BLOCKIMAGE,ADDRESS,BODY,TABLE,TROW,TCELL,TEST,UL,OL,ULI,OLI,DL,DT,DD};
+private static String[] theNames = {"BOLD","ITALIC","UNDERLINE","HYPERLINK","ANCHOR","SPAN","FONT","BIG","SMALL","TELETYPE","EM","STRONG","DFN","IMAGE","BLOCK_LEVEL","STARTS_FRESH","IS_PARAGRAPH","CENTERED","HEADING1","HEADING2","HEADING3","HEADING4","HEADING5","HEADING6","TITLE","HR","PARAGRAPH","DIV","PREFORMAT","BLOCKQUOTE","BLOCKIMAGE","ADDRESS","BODY","TABLE","TROW","TCELL","TEST","UL","OL","ULI","OLI","DL","DT","DD"};
+public String valueToName(int value)
+{
+for (int i = 0; i<theValues.length; i++)
+	if (theValues[i] == value) return theNames[i];
+return null;
+}
+
+//##################################################################
+}
+//##################################################################
+

Added: experiments/EVEhist/src/eve/ui/formatted/HotSpot.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/HotSpot.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/HotSpot.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,58 @@
+package eve.ui.formatted;
+import eve.fx.Color;
+import eve.fx.gui.Cursor;
+
+/**
+* A HotSpot represents a Hyperlink to a location within this document (if the link starts with '#')
+* or to another document. It is also used to represent a location within a document that another
+* HotSpot can link to (in which case it is effectively invisible).<p>
+* 
+* The hyperlink that the HotSpot refers to is stored in the "data" member variable as a String.
+* If this String starts with '!' then it is a book mark in the document that other hyperlinks
+* will refer to. If it does not start with '!' then it is a clickable hyperlink to another
+* location or document.
+**/
+
+	//##################################################################
+	public class HotSpot extends TextFormatter{
+	//##################################################################
+	public static Color hotColor = new Color(0,0,255);
+	{
+		cursor = Cursor.HAND_CURSOR;
+		color = hotColor;
+	}
+	
+	//===================================================================
+	public HotSpot()
+	//===================================================================
+	{
+	}
+	//===================================================================
+	public HotSpot(int line,int character,int length)
+	//===================================================================
+	{
+		super(line,character,length);
+	}
+		/**
+	 * Returns if this need to be applied at the start or during the line.
+	 */
+	//===================================================================
+	public boolean applyBefore()
+	//===================================================================
+	{
+		return true;
+	}
+/*
+	//===================================================================
+	public Object getToolTip()
+	//===================================================================
+	{
+		Object got = super.getToolTip();
+		if (got != null) return got;
+		return (cursor != 0) ? data.toString() : null;
+	}
+*/
+	//##################################################################
+	}
+	//##################################################################
+

Added: experiments/EVEhist/src/eve/ui/formatted/HtmlDisplay.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/HtmlDisplay.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/HtmlDisplay.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,149 @@
+package eve.ui.formatted;
+import eve.data.PropertyList;
+import eve.fx.Color;
+import eve.fx.IImage;
+import eve.sys.Handle;
+//##################################################################
+public class HtmlDisplay extends TextDisplay  {
+//##################################################################
+
+{
+	forcedActualWidth = 5000;
+	spacing = 2;
+}
+private FormattedTextMaker maker;
+
+public PropertyList headerData = new PropertyList();
+public PropertyList bodyData = new PropertyList();
+/*
+public void repaintNow()
+{
+	if ((getModifiers(true) & Invisible) != 0) return;
+	new Exception().printStackTrace();
+	super.repaintNow();
+}
+*/
+//===================================================================
+public HtmlDisplay(){}
+//===================================================================
+public HtmlDisplay(int rows,int columns)
+//===================================================================
+{
+	super(rows,columns);
+}
+/**
+* Call this before setting properties for the HTML decoder.
+**/
+//===================================================================
+public void startHtml()
+//===================================================================
+{
+	if (maker != null) maker.removeFrom(this);
+	maker = new FormattedTextMaker();
+}
+/**
+* Make sure you call startHtml(), before calling this.
+* After you do that you can then set properties for the decoder. These
+* include:<dl>
+* <dt>"documentRoot"<dd>The root of the document. Images with relative path
+* names will be searched for relative to this path.
+* </dl>
+**/
+//===================================================================
+public PropertyList getDecoderProperties()
+//===================================================================
+{
+	if (maker != null) return maker.properties;
+	else return PropertyList.nullPropertyList;
+}
+//===================================================================
+public void addHtml(String htmlText,Handle h)
+//===================================================================
+{
+	maker.parseHtml(this,htmlText,h);
+}
+//===================================================================
+public FormattedTextMaker endHtml()
+//===================================================================
+{
+	maker.endHtml();
+	return endMaker();
+}
+
+//-------------------------------------------------------------------
+FormattedTextMaker endMaker()
+//-------------------------------------------------------------------
+{
+	headerData = maker.headerData;
+	bodyData = maker.bodyData;
+	try{
+		pageColor = (Color)PropertyList.getValue(bodyData,"background",Color.White);
+		foreGround =(Color)PropertyList.getValue(bodyData,"foreground",Color.Black); 
+		backgroundImage = (IImage)PropertyList.getValue(bodyData,"backgroundImage",null); 
+	}catch(Exception e){}
+	int was = modify(Invisible,0);
+	maker.addTo(this);
+	scrollTo(0,false);
+	restore(was,Invisible);
+	repaintDataNow();
+	
+	//clearHistory();
+	//markHistory();
+	return maker;
+}
+//===================================================================
+public void displayPropertiesChanged()
+//===================================================================
+{
+	try{
+		pageColor = (Color)PropertyList.getValue(bodyData,"background",Color.White);
+		foreGround =(Color)PropertyList.getValue(bodyData,"foreground",Color.Black); 
+		backgroundImage = (IImage)PropertyList.getValue(bodyData,"backgroundImage",null); 
+	}catch(Exception e){}
+	super.displayPropertiesChanged();
+}
+//===================================================================
+public void setHtml(String htmlText)
+//===================================================================
+{
+	setHtml(htmlText,null,new Handle());
+}
+//===================================================================
+public FormattedTextMaker setHtml(String htmlText,PropertyList properties,Handle h)
+//===================================================================
+{
+	startHtml();
+	if (properties != null) getDecoderProperties().set(properties);
+	addHtml(htmlText,h);
+	return endHtml();
+}
+
+//===================================================================
+public void setHtml(FormattedTextMaker maker,PropertyList properties)
+//===================================================================
+{
+	if (this.maker != null) this.maker.removeFrom(this);
+	this.maker = maker;
+	if (properties != null) getDecoderProperties().set(properties);
+	endMaker();
+}
+
+//===================================================================
+public void formClosing()
+//===================================================================
+{
+	super.formClosing();
+	if (maker != null) maker.removeFrom(this);
+}
+//===================================================================
+public void setPlainText(String text)
+//===================================================================
+{
+	if (maker != null) maker.removeFrom(this);
+	setText(text);
+	//markHistory();
+}
+//##################################################################
+}
+//##################################################################
+

Added: experiments/EVEhist/src/eve/ui/formatted/ImageResolver.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/ImageResolver.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/ImageResolver.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,25 @@
+package eve.ui.formatted;
+import eve.data.PropertyList;
+import eve.fx.Dimension;
+import eve.sys.Handle;
+
+//##################################################################
+public interface ImageResolver{
+//##################################################################
+/**
+* Resolve the image.
+* @param imageProperties The properties for the Image. This should contain at least one property called "src".
+* @param allowAnimatedImages If this is true then animated images will be resolved into
+* an AnimatedIcon.
+* @param maxSize An optional limit to the size of the image returned.
+* @return A Handle that can be used to monitor the progress of the resolution. When the Handle
+* status reports Handle.Succeeded then the returnValue of the Handle will hold the resolved
+* image.
+*/
+public Handle resolveImage(PropertyList imageProperties, boolean allowAnimatedImages, Dimension maxSize);
+
+//##################################################################
+}
+//##################################################################
+
+

Added: experiments/EVEhist/src/eve/ui/formatted/StreamImageResolver.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/StreamImageResolver.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/StreamImageResolver.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,148 @@
+
+package eve.ui.formatted;
+import java.io.IOException;
+import java.io.InputStream;
+import java.util.Hashtable;
+
+import eve.data.PropertyList;
+import eve.fx.Dimension;
+import eve.fx.IImage;
+import eve.fx.ImageDecoder;
+import eve.fx.PixelBuffer;
+import eve.io.File;
+import eve.io.StreamUtils;
+import eve.sys.Handle;
+import eve.sys.Task;
+import eve.sys.TimeOut;
+import eve.util.ByteArray;
+import eve.util.FormattedDataSource;
+import eve.util.Tag;
+
+//##################################################################
+public class StreamImageResolver implements ImageResolver{
+//##################################################################
+
+//-------------------------------------------------------------------
+protected Tag getStreamFor(String imageName) throws IOException
+//-------------------------------------------------------------------
+{
+	File f = File.getNewFile(imageName);
+	if (!f.canRead()) throw new IOException();
+	Tag t = new Tag();
+	t.value = f.toReadableStream();
+	t.tag = (int)f.getLength();
+	return t;
+}
+
+private static ByteArray scaleArray;
+private Hashtable imageCache = new Hashtable();
+private static int numResolving;
+
+//===================================================================
+public Handle resolveImage(final String name,final boolean allowAnimatedImages,final Dimension maxSize)
+//===================================================================
+{
+	return new Task(){
+		protected void doRun(){
+			if (scaleArray == null) scaleArray = new ByteArray();
+			Handle handle = this;
+			try{
+				Tag tag = getStreamFor(name);
+				Object in = tag.value;
+				InputStream is = null;
+				if (in instanceof InputStream) is = (InputStream)in;
+				if (is == null) throw new IOException("Could not get Stream to image.");
+				int length = tag.tag;
+				if (length == 0){
+					is.close();
+					throw new IOException();
+				}
+				try{
+					IImage got = null;
+					handle.doing = "Reading bytes...";
+					ByteArray ba = StreamUtils.readAllBytes(handle,is,null,length,0);
+					if (ba == null) {
+						handle.set(handle.Aborted|handle.Stopped);
+						return;
+					}
+					handle.doing = "Decoding image...";
+					handle.setProgress(0);
+					synchronized(StreamImageResolver.class){
+						numResolving++;
+						//Vm.debug("Start: "+numResolving+" = "+name+": "+ba.length+" = "+ba.getChecksum());
+					}
+					try{
+						Dimension m = maxSize;
+						//m = new Dimension(50,50); //Just to test scaling.
+						FormattedDataSource fds = new FormattedDataSource().set(ba);
+						got = ImageDecoder.decodeScaledPicture(fds, m, true, true, null);
+					}finally{
+						synchronized(StreamImageResolver.class){
+							numResolving--;
+							//Vm.debug("Stop: "+numResolving+" = "+name);
+						}
+					}
+					handle.returnValue = got;
+					handle.set(Handle.Succeeded);
+				}catch(Exception e){
+					//e.printStackTrace();
+					handle.fail(e);					
+				}
+			}catch(IOException e){
+				//.printStackTrace();
+				handle.fail(e);
+			}
+		}
+	}.start();
+}
+//===================================================================
+public Handle resolveImage(final PropertyList imageProperties,final boolean allowAnimatedImages,Dimension maxImageSize)
+//===================================================================
+{
+	final Dimension maxSize = maxImageSize; //new Dimension(100,100);
+	final String src = imageProperties.getString("src",null);
+	if (src == null) return new Handle(Handle.Failed,null);
+	return new Task(){
+		protected void doRun(){
+			Handle handle = this;
+			Handle res = (Handle)imageCache.get(src);
+			if (res == null) {
+				res = resolveImage(src,allowAnimatedImages,maxSize);
+				imageCache.put(src,res);
+			}
+			if (!waitOn(res,res.Success,TimeOut.Forever,true)){
+				handle.set(Handle.Failed);
+			}else{
+				IImage got = (IImage)res.returnValue;
+				//
+				if (maxSize != null){// && !(got instanceof AniImage)){
+					if (got.getWidth() > maxSize.width || got.getHeight() > maxSize.height){
+						//System.out.println("Scaling: "+maxSize);
+						got = new PixelBuffer(got).scale(maxSize.width,maxSize.height,null,PixelBuffer.SCALE_KEEP_ASPECT_RATIO,scaleArray).toPicture();
+					}//else System.out.println("Not Scaling: "+maxSize);
+				}
+				//
+				PropertyList pl = PropertyList.toPropertyList(imageProperties);
+				int ww = pl.getInt("width",got.getWidth());
+				int hh = pl.getInt("height",got.getHeight());
+				if (ww <= 0) ww = got.getWidth();
+				if (hh <= 0) hh = got.getHeight();
+				if (maxSize != null){
+					if (ww > maxSize.width) ww = maxSize.width;
+					if (hh > maxSize.height) hh = maxSize.height;
+				}
+				if (ww != got.getWidth() && hh != got.getHeight())
+					got = new PixelBuffer(got).scale(ww,hh,null,0,scaleArray).toPicture();
+				handle.returnValue = got;
+				handle.set(Handle.Succeeded);
+			}
+		}
+	}.start();
+}
+
+
+
+//##################################################################
+}
+//##################################################################
+

Added: experiments/EVEhist/src/eve/ui/formatted/TextDisplay.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/TextDisplay.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/TextDisplay.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,570 @@
+
+package eve.ui.formatted;
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.Iterator;
+import java.util.Vector;
+
+import eve.fx.Color;
+import eve.fx.Dimension;
+import eve.fx.DisplayLine;
+import eve.fx.FormattedTextSpecs;
+import eve.fx.Graphics;
+import eve.fx.IImage;
+import eve.fx.ImageRefresher;
+import eve.fx.OnScreenImage;
+import eve.fx.Point;
+import eve.ui.Gui;
+import eve.ui.TextPad;
+import eve.ui.event.ControlEvent;
+import eve.ui.event.PenEvent;
+import eve.util.IntArray;
+import eve.util.Range;
+
+//##################################################################
+public class TextDisplay extends TextPad implements ImageRefresher{
+//##################################################################
+
+//===================================================================
+public TextDisplay()
+//===================================================================
+{
+	
+}
+//===================================================================
+public TextDisplay(int rows,int columns)
+//===================================================================
+{
+	super(rows,columns);
+}
+
+{
+	modify(DisplayOnly,0);
+	disableCursor = true;
+	disableTextChanges = true;
+	rightMargin = leftMargin = 5;
+	dontWantPopup = true;
+}
+
+Vector formatters = new Vector();
+
+/**
+* The color for hot spots. By default it is bright blue.
+**/
+public Color hotColor = new Color(0,0,255);
+
+public void repaintDataNow()
+{
+	repaintNow();
+}
+//-------------------------------------------------------------------
+private TextFormatter getTextFormatterFor(int hotIndex,int lineIndex)
+//-------------------------------------------------------------------
+{
+	if (formatterOffsets != null && lineIndex < formatterOffsets.length/2){
+		int where = formatterOffsets[lineIndex*2], num = formatterOffsets[lineIndex*2+1];
+		if (where != 0){
+			if (hotIndex >= num) return null;
+			else return (TextFormatter)formatters.get(formatterRefs.data[where+hotIndex]);
+		}
+	}
+	for (int i = 0; i<formatters.size(); i++){
+		TextFormatter hs = (TextFormatter)formatters.get(i);
+		int ll = getLineLength(lineIndex,false);
+		if ((lineIndex == hs.startLine) || (lineIndex > hs.startLine && lineIndex < hs.startLine+hs.numLines))
+		//if (hs.line == lineIndex && hs.character < ll && ((hs.length == 0) || (hs.length+hs.character <= ll)))
+			if (hotIndex == 0) return hs;
+			else hotIndex--;
+	}
+	return null;
+}
+//-------------------------------------------------------------------
+protected int getSpecialFormatCount(int lineIndex,DisplayLine theLine)
+//-------------------------------------------------------------------
+{
+	if (formatterOffsets == null || lineIndex >= formatterOffsets.length/2)
+		formattersSet();
+	int num = 0;
+	if (theLine == null) return 0;
+	int len = theLine.length();
+	if (lineIndex < formatterOffsets.length/2)
+			formatterOffsets[lineIndex*2] = formatterRefs.length;
+	for (int i = 0; i<formatters.size(); i++){
+		TextFormatter hs = (TextFormatter)formatters.get(i);
+		
+		if ((lineIndex == hs.startLine) || (lineIndex > hs.startLine && lineIndex < hs.startLine+hs.numLines)){
+		// && hs.character < len && hs.length+hs.character <= len){
+			num++;
+			formatterRefs.add(i);
+		}
+	}
+	if (lineIndex < formatterOffsets.length/2)
+			formatterOffsets[lineIndex*2+1] = num;
+	
+	return num;
+}
+
+private static Vector tempFormatters;
+private static Range range;
+//===================================================================
+public Vector getTextFormatter(Point onControl,Vector dest)
+//===================================================================
+{
+	if (dest == null) {
+		if (tempFormatters == null) tempFormatters = new Vector();
+		dest = tempFormatters;
+	}
+	dest.clear();
+	Point where = getCharAt(onControl);
+	if (where != null) { //Not on any character, possibly on an image?
+		DisplayLine dl = getLine(where.y);
+		for (int i = 0;;i++){
+			TextFormatter hs = getTextFormatterFor(i,where.y);
+			if (hs == null) break;
+			if (hs.image != null) continue;
+			if (range == null) range = new Range(0,0);
+			if (hs.getCharRange(where.y,dl,range) != null)
+				if (where.x >= range.first && where.x <= range.last){
+					dest.add(hs);
+					if (hs.linkedTo != null) dest.add(hs.linkedTo);
+				}
+		}
+	}
+	//See if on any images.
+	int h = getLineHeight();
+	int py = (onControl.y-spacing+getTopLine()*h)/h;
+	if (py >= getNumLines()) return dest;
+	FormattedTextSpecs f;
+	int [] got = (f = getTextPositions(py,getLine(py))).calculatedPositions;
+	for (int i = 0;;i++){
+		TextFormatter hs = getTextFormatterFor(i,py);
+		if (hs == null) break;
+		if (hs.image != null && hs.isOnImage(this,onControl.x-spacing+getLeftPosition(),f)){
+			dest.add(hs);
+			if (hs.linkedTo != null) dest.add(hs.linkedTo);
+		}
+	}
+	return dest;
+}
+//===================================================================
+public TextFormatter getTextFormatter(Point onControl)
+//===================================================================
+{
+	Vector v = getTextFormatter(onControl,null);
+	if (v.size() == 0) return null;
+	else return (TextFormatter)v.get(0);
+}
+
+//-------------------------------------------------------------------
+protected void applySpecialFormat(int formatIndex,int lineIndex,DisplayLine theLine,FormattedTextSpecs format)
+//-------------------------------------------------------------------
+{
+	TextFormatter hs = getTextFormatterFor(formatIndex,lineIndex);
+	if (hs == null) return;
+	hs.applySpecialFormat(this,lineIndex,theLine,format);
+}
+//-------------------------------------------------------------------
+protected void drawSpecialFormat(int formatIndex,int lineIndex,DisplayLine theLine,FormattedTextSpecs format,Graphics g,Color background)
+//-------------------------------------------------------------------
+{
+	TextFormatter hs = getTextFormatterFor(formatIndex,lineIndex);
+	if (hs == null) return;
+	hs.drawSpecialFormat(this,lineIndex,theLine,format,g,background);
+}
+
+Hashtable imageFormatters = new Hashtable();
+
+//===================================================================
+public void refresh(IImage image,int options)
+//===================================================================
+{
+	if (!Gui.requestPaint(this)) return;
+	TextFormatter [] found = (TextFormatter [])imageFormatters.get(image);
+	if (found != null){
+		for (int i = 0; i<found.length; i++)
+			found[i].repaint(this,null);
+	}
+}
+//===================================================================
+public void stopAniImages()
+//===================================================================
+{
+	for (Enumeration it = imageFormatters.keys(); it.hasMoreElements();){
+		Object obj = it.nextElement();
+		if (obj instanceof OnScreenImage)
+			((OnScreenImage)obj).changeRefresher(null,this);
+	}
+}
+//===================================================================
+public void formClosing()
+//===================================================================
+{
+	stopAniImages();
+	super.formClosing();
+}
+//===================================================================
+public void imageSet(TextFormatter formatter)
+//===================================================================
+{
+	if (formatter.image instanceof OnScreenImage){
+		OnScreenImage ai = (OnScreenImage)formatter.image;
+		TextFormatter [] was = (TextFormatter [])imageFormatters.get(ai);
+		TextFormatter [] now = new TextFormatter[was == null ? 1 : was.length+1];
+		now[0] = formatter;
+		if (was != null) System.arraycopy(was,0,now,1,was.length);
+		imageFormatters.put(ai, now);
+		//ai.displayControl = this;
+		ai.setRefresher(this);
+		refresh(ai,0);
+	}
+}
+//===================================================================
+public TextFormatter addTextFormatter(TextFormatter formatter)
+//===================================================================
+{
+	formatters.add(formatter);
+	if (formatter.image instanceof OnScreenImage) imageSet(formatter);
+	return formatter;
+}
+//===================================================================
+public TextFormatter addTextFormatter(int lineIndex,int characterIndex,int length,TextFormatter dest)
+//===================================================================
+{
+	if (dest == null) dest = new TextFormatter(lineIndex,characterIndex,length);
+	else {
+		dest.startLine = lineIndex;
+		dest.startCharacter = characterIndex;
+		dest.endCharacter = characterIndex+length-1;
+		dest.numLines = 1;
+	}
+	return addTextFormatter(dest);
+}
+//===================================================================
+public TextFormatter addTextFormatter(int lineIndex,int characterIndex,int length,int fontFlags,int lineFlags)
+//===================================================================
+{
+	return addTextFormatter(new TextFormatter(lineIndex,characterIndex,length,fontFlags,lineFlags));
+}
+//===================================================================
+public TextFormatter addTextFormatter(int lineIndex,int numLines,int fontFlags,int lineFlags)
+//===================================================================
+{
+	return addTextFormatter(new TextFormatter(lineIndex,numLines,fontFlags,lineFlags));
+}
+
+//===================================================================
+public void clearTextFormatters()
+//===================================================================
+{
+	formatters.clear();
+	stopAniImages();
+	imageFormatters.clear();
+}
+/*
+//===================================================================
+public void removeTextFormatter(TextFormatter hs)
+//===================================================================
+{
+	formatters.remove(hs);
+}
+*/
+//===================================================================
+public Iterator getTextFormatters()
+//===================================================================
+{
+	return formatters.iterator();
+}
+//===================================================================
+public TextFormatter addTextFormatter(int indexInFullText,int length,TextFormatter dest)
+//===================================================================
+{
+	Dimension d = getIndexLocation(indexInFullText,null);
+	if (d == null) return null;
+	return addTextFormatter(d.height,d.width,length,dest);
+}
+
+//------------------------------------------------------------------
+protected void splitLines(int width)
+//------------------------------------------------------------------
+{
+	super.splitLines(width);
+	postEvent(new ControlEvent(LINES_SPLIT,this));
+}
+
+private int[] formatterOffsets;
+private IntArray formatterRefs;
+/**
+* This tells the TextDisplay that formatters have been set and so it can optimize
+* itself based on this.
+**/
+//===================================================================
+public void formattersSet()
+//===================================================================
+{
+	formatterOffsets = new int[numLines*2];
+	formatterRefs = new IntArray();
+	formatterRefs.add(0);
+}
+//-------------------------------------------------------------------
+protected void getColors(boolean hasFocus,int flags)
+//-------------------------------------------------------------------
+{
+	super.getColors(hasFocus,flags);
+	colors[0] = getForeground();
+	colors[1] = pageColor;
+	colors[2] = colors[1];
+	colors[3] = Color.DarkBlue;//colors[0];
+}
+
+protected TextFormatter mouseOver;
+
+//-------------------------------------------------------------------
+protected void mouseMovedOnOff(TextFormatter tf,boolean movedOn){}
+//-------------------------------------------------------------------
+
+//===================================================================
+public void onPenEvent(PenEvent ev)
+//===================================================================
+{
+	if (ev.type == ev.PEN_MOVE){
+		Vector v = getTextFormatter(new Point(ev.x,ev.y),null);
+		//ewe.sys.Vm.debug(v.toString());
+		for (int i = 0; i<v.size(); i++){
+			TextFormatter hs = (TextFormatter)v.get(i);
+				if (hs.cursor != 0) {
+					setCursor(hs.cursor);
+					if (mouseOver != hs) {
+						if (mouseOver != null) mouseMovedOnOff(mouseOver,false);
+						mouseMovedOnOff(mouseOver = hs,true);
+					}
+					return;
+				}
+		}
+		if (mouseOver != null) mouseMovedOnOff(mouseOver,false);
+		mouseOver = null;
+	}else if (ev.type == ev.PEN_MOVED_OFF){
+		if (mouseOver != null) mouseMovedOnOff(mouseOver,false);
+		mouseOver = null;
+	}
+	super.onPenEvent(ev);
+}
+
+
+/**
+ * This tells the display to go to the specified anchor.
+ * @param anchorName The name of the anchor.
+ * @return true if the anchor is in the current document. False otherwise.
+ */
+//===================================================================
+public boolean goToAnchor(String anchorName)
+//===================================================================
+{
+	String lookFor = anchorName.toUpperCase();
+	if (lookFor.startsWith("#")) lookFor = lookFor.substring(1);
+	for (Iterator it = getTextFormatters(); it.hasNext();){
+		Object got = it.next();
+		if (got instanceof HotSpot){
+			HotSpot an = (HotSpot)got;
+			String anchor = an.data == null ? null : an.data.toString().toUpperCase();
+			if (anchor == null || anchor.length() < 2) continue;
+			if (anchor.charAt(0) == '!' && anchor.substring(1).equals(lookFor)){
+				goToLine(an.startLine);
+				return true;
+			}
+		}
+	}
+	return false;
+}
+
+//-------------------------------------------------------------------
+protected boolean hotspotPressed(HotSpot hs,Point where)
+//-------------------------------------------------------------------
+{
+	postEvent(new HotSpotEvent(HotSpotEvent.PRESSED,hs));
+	if (hs.data != null && hs.data.toString().startsWith("#")){
+		markHistory();
+		boolean ret = goToAnchor(hs.data.toString());
+		if (!ret) deleteLastHistory();
+		return ret;
+	}
+	return false;
+}
+/**
+ * Scroll to the specified line. An entry in the "goBack" history will be made with the
+ * current position.
+ * @param line The line to go to.
+ * @return true if scrolled, false otherwise.
+ */
+//===================================================================
+public boolean goToLine(int line)
+//===================================================================
+{
+	//markHistory();
+	scrollTo(line,false);
+	return true;
+}
+/**
+ * Clear the goBack history.
+ */
+//===================================================================
+public void clearHistory()
+//===================================================================
+{
+	states.clear();
+}
+/**
+ * Mark the current location in the goBack history.
+ */
+//===================================================================
+public void markHistory()
+//===================================================================
+{
+	states.add(getState());	
+}
+Vector states = new Vector();
+//===================================================================
+public void deleteLastHistory()
+//===================================================================
+{
+	int sz = states.size();
+	if (sz != 0) states.removeElementAt(sz-1);
+	if (states.size() == 0) 
+		markHistory();
+}
+/**
+* This goes back one place in the saved states for the HtmlDisplay.
+**/
+//===================================================================
+public void goBack()
+//===================================================================
+{
+	int sz = states.size();
+	if (sz == 0) scrollTo(0,false);
+	else{
+		setState(states.get(sz-1));
+		states.removeElementAt(sz-1);
+	}
+	if (states.size() == 0) 
+		markHistory();
+}
+
+/**
+* This is a type of Control event. It is sent after the text has been split into separate lines
+* by the TextDisplay. It can be used to trigger the setting up of the TextFormatters.
+**/
+public static final int LINES_SPLIT = 310;
+
+//##################################################################
+public class HotSpotEvent extends ControlEvent{
+//##################################################################
+
+
+public HotSpot hotSpot;
+
+//-------------------------------------------------------------------
+HotSpotEvent(int type,HotSpot spot)
+//-------------------------------------------------------------------
+{
+	super(type,TextDisplay.this);
+	this.hotSpot = spot;
+}
+
+//##################################################################
+}
+//##################################################################
+
+//===================================================================
+public void penPressed(Point where)
+//===================================================================
+{
+	Point p = where;
+	Vector v = getTextFormatter(where,null);
+	//ewe.sys.Vm.debug("-----------------");
+	//ewe.sys.Vm.debug(v.toString());
+	for (int i = 0; i<v.size(); i++){
+		TextFormatter hs = (TextFormatter)v.get(i);
+		if (hs instanceof HotSpot)
+			if (hotspotPressed((HotSpot)hs,p)){
+				clearSelection();
+				break;
+			}
+	}
+	super.penPressed(where);
+}
+
+//===================================================================
+public Object getToolTip(int x,int y)
+//===================================================================
+{
+	Vector v = getTextFormatter(new Point(x,y),null);
+	for (int i = 0; i<v.size(); i++){
+		TextFormatter hs = (TextFormatter)v.get(i);
+		Object tt = hs.getToolTip();
+		if (tt != null) return tt;
+	}
+	return super.getToolTip(x,y);
+}
+/**
+* Call this to indicate that something about the display has changed. By
+* default it simply does a repaintNow(), but HtmlDisplay will update its background images etc.
+**/
+//===================================================================
+public void displayPropertiesChanged()
+//===================================================================
+{
+	repaintNow();
+}
+
+/*
+//===================================================================
+public static void main(String args[])
+//===================================================================
+{
+	ewe.sys.Vm.startEwe(args);
+	Form f = new Form();
+	TextDisplay td; 
+	f.addLast(new ScrollBarPanel(td = new TextDisplay())).setPreferredSize(240,320);
+	td.font = new Font("Times New Roman",Font.PLAIN,20);
+	td.wrapToScreenSize = false;
+	td.setText(
+"Copyright (c) 2001 Michael L Brereton  All rights reserved.\n"+
+"\n"+
+"This software is furnished under the Gnu General Public License, Version 2, June 1991,\n"+
+"and may be used only in accordance with the terms of that license. This source code\n"+
+"must be distributed with a copy of this license. This software and documentation, \n"+
+"and its copyrights are owned by Michael L Brereton and are protected by copyright law.\n"+
+"\n"+
+"If this notice is followed by a Wabasoft Copyright notice, then this software\n"+
+"is a modified version of the original as provided by Wabasoft. Wabasoft also \n"+
+"retains all rights as stipulated in the Gnu General Public License. These modifications\n"+
+"were made to the Version 1.0 source code release of Waba, throughout 2000 and up to May \n"+
+"2001.\n"+
+"\n"+
+"THIS SOFTWARE AND REFERENCE MATERIALS ARE PROVIDED \"AS IS\" WITHOUT WARRANTY\n"+
+"AS TO THEIR PERFORMANCE, MERCHANTABILITY, FITNESS FOR ANY PARTICULAR PURPOSE,\n"+
+"OR AGAINST INFRINGEMENT. MICHAEL L BRERETON ASSUMES NO RESPONSIBILITY FOR THE USE OR\n"+
+"INABILITY TO USE THIS SOFTWARE. MICHAEL L BRERETON SHALL NOT BE LIABLE FOR INDIRECT,\n"+
+"SPECIAL OR CONSEQUENTIAL DAMAGES RESULTING FROM THE USE OF THIS PRODUCT.\n"+
+"\n"+
+"MICHAEL L BRERETON SHALL HAVE NO LIABILITY OR RESPONSIBILITY FOR SOFTWARE ALTERED,\n"+
+"MODIFIED, OR CONVERTED BY YOU OR A THIRD PARTY, DAMAGES RESULTING FROM\n"+
+"ACCIDENT, ABUSE OR MISAPPLICATION, OR FOR PROBLEMS DUE TO THE MALFUNCTION OF\n"+
+"YOUR EQUIPMENT OR SOFTWARE NOT SUPPLIED BY MICHAEL L BRERETON.\n"
+	);
+	TextFormatter tf;
+	//TextFormatter tf = td.addTextFormatter(3,4,TextFormatter.FONT_CHANGE|Font.BOLD,TextFormatter.LINE_ADD_FIRST_LINE_HEADER);
+	//tf.leftMarginShift = 20;
+	//tf.data = tf.DIAMOND;
+	tf = td.addTextFormatter(8,3,10,TextFormatter.FONT_CHANGE|Font.ITALIC|Font.BOLD,0);
+	tf.numLines = 4;
+	tf.endCharacter = 1;
+	tf.cursor = ewe.sys.Vm.HAND_CURSOR;
+	f.execute();
+	ewe.sys.Vm.exit(0);
+}
+*/
+//##################################################################
+}
+//##################################################################
+
+

Added: experiments/EVEhist/src/eve/ui/formatted/TextFormatter.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/TextFormatter.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/TextFormatter.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,606 @@
+package eve.ui.formatted;
+import eve.data.DataObject;
+import eve.fx.Color;
+import eve.fx.DisplayLine;
+import eve.fx.Font;
+import eve.fx.FontMetrics;
+import eve.fx.FormattedTextSpecs;
+import eve.fx.Graphics;
+import eve.fx.IImage;
+import eve.fx.Pen;
+import eve.fx.PixelBuffer;
+import eve.fx.Rect;
+import eve.ui.Control;
+import eve.ui.TextPad;
+import eve.util.Range;
+
+/**
+* A TextFormatter is used to format all or some of the text of a single line of an TextPad
+* display.
+**/
+	//##################################################################
+	public class TextFormatter extends DataObject{
+	//##################################################################
+	/**
+	* The first line of text covered by the formatter - where 0 indicates the first line of
+	* the display.
+	**/
+	public int startLine;
+	/**
+	* The number of lines covered by the formatter. - if it is greater than 1, then this is
+	* a block level formatter and the "character" and "length" members are not used. 
+	**/
+	public int numLines;
+	/**
+	* The first character in the line being covered by the formatter. If this is -1 then it is
+	* assumed that this formatter will not have any effect on the displayed text, but is really only used
+	* as some sort of flag or marker for the line or lines
+	**/
+	public int startCharacter;
+	/**
+	* The index of the last character in the last line being covered by the formatter. If this is -1 then it
+	* is assumed that the formatter is applied to ALL characters in ALL the lines covered by
+	* the formatter.
+	**/
+	public int endCharacter;
+	/**
+	* If this is not null then the text will be redrawn in this color <b>if</b> the FONT_CHANGE
+	* flag is set in fontFlags.
+	**/
+	public Color color = null;
+	/**
+	* This is a fontFlag. Other fontFlags could be Font.BOLD, Font.UNDERLINE and Font.ITALIC.
+	**/
+	public static final int FONT_CHANGE = 0x8000;
+	public static final int FONT_FREEZE = 0x10000;
+	/**
+	* This can be a combination of FONT_CHANGE along with Font.BOLD, Font.UNDERLINE and Font.ITALIC.
+	**/
+	public int fontFlags = 0;
+	/**
+	* This can be a combination of the LINE_XXX values.
+	**/
+	public int lineFlags = 0;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_CENTERED = 0x1;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_RIGHT_ALIGNED = 0x2;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_RESPLIT = 0x4;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_ADD_FIRST_LINE_HEADER = 0x8;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_LEFT_MARGIN_SHIFT_IS_CHARACTERS = 0x10;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_HEADER_RIGHT_ALIGN = 0x20;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_DRAW_RULE = 0x40;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_ALIGN_NOW = 0x80;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_CANCEL_ALIGNMENTS = 0x100;
+	/**
+	* This is a possible lineFlag.
+	**/
+	public static final int LINE_BACKGROUND_COLOR_CHANGE = 0x200;
+	
+	public Color backgroundColor;
+	
+	/**
+	 * Returns if this need to be applied at the start or during the line.
+	 */
+	//===================================================================
+	public boolean applyBefore()
+	//===================================================================
+	{
+		//if (true) return true;
+		if ((lineFlags & (LINE_BACKGROUND_COLOR_CHANGE|LINE_DRAW_RULE|LINE_ADD_FIRST_LINE_HEADER)) != 0)	return true;
+		if (leftMarginShift != 0) return true;
+		if (image != null) return true;
+		if ((fontFlags & FONT_CHANGE) != 0) return true;
+		return false;
+	}
+	/**
+	 * Returns if this need to be applied at the end of the line.
+	 */
+	//===================================================================
+	public boolean applyAfter()
+	//===================================================================
+	{
+		//if (true) return false;
+		if ((lineFlags & (LINE_CANCEL_ALIGNMENTS|LINE_RIGHT_ALIGNED|LINE_CENTERED)) != 0) return true;
+		return false;
+	}
+	//===================================================================
+	public TextFormatter getEndFormatter(TextFormatter dest)
+	//===================================================================
+	{
+		if (dest == null) dest = new TextFormatter();
+		dest.lineFlags = (lineFlags & (LINE_CANCEL_ALIGNMENTS|LINE_RIGHT_ALIGNED|LINE_CENTERED))|LINE_ALIGN_NOW;
+		return dest;
+	}
+	//===================================================================
+	public TextFormatter getStartFormatter(TextFormatter dest)
+	//===================================================================
+	{
+		if (dest == null) dest = new TextFormatter();
+		dest.lineFlags = lineFlags;
+		//lineFlags | LINE_ALIGN_NOW;
+		return dest;
+	}	
+	public Object data;
+	public Object toolTip = null;
+	public int cursor = 0;
+	public int leftMarginShift;
+	public int resplitWidthChange;
+	public String label;
+	//
+	// Used for displaying images.
+	//
+	public IImage image;
+	/**
+	* The line that the image is actually on.
+	**/
+	public int imageLine;
+	/**
+	* The character that comes after the image.
+	**/
+	public int imageChar;
+	public int imageX;
+	public int imageY;
+	public int hSpace = 0, vSpace = 0, borderWidth = 0;
+	
+	public TextFormatter linkedTo;
+	
+	static IImage UnknownImage, BrokenImage;
+	
+	public boolean notUsed;
+	
+	//===================================================================
+	public static IImage getUnknownImage()
+	//===================================================================
+	{
+ 		if (UnknownImage == null) 
+			UnknownImage = Control.loadImage("eve/imagesmall.png");
+		return UnknownImage;
+	}
+	//===================================================================
+	public static IImage getBrokenImage()
+	//===================================================================
+	{
+		if (BrokenImage == null){
+			PixelBuffer pb = new PixelBuffer(getUnknownImage());
+			Graphics g = pb.getDrawingBuffer(null,null,1.0);
+			g.changePen(Color.Red,Pen.SOLID,2);
+			g.drawLine(2,2,pb.getWidth()-4,pb.getHeight()-4);
+			g.drawLine(2,pb.getHeight()-4,pb.getWidth()-4,2);
+			pb.putDrawingBuffer(pb.PUT_BLEND);
+			BrokenImage = pb.toPicture();
+			pb.free();
+		}
+		return BrokenImage;
+	}
+	//===================================================================
+	public String rangeToString()
+	//===================================================================
+	{
+		return endCharacter == -1 ? startLine+"->"+(startLine+numLines-1) : "("+startLine+","+startCharacter+")->"+"("+(startLine+numLines-1)+","+endCharacter+")";
+	}
+	//===================================================================
+	public String toString()
+	//===================================================================
+	{
+		return label == null ?  rangeToString() : label;
+	}
+	/**
+	* The amount to change the font size by (FONT_CHANGE must be set).
+	**/
+	public int fontSizeChange = 0;
+	/**
+	* The amount to change the font to (FONT_CHANGE must be set).
+	**/
+	public int fontSize = 0;
+	/**
+	* The name of the new font to use (FONT_CHANGE must be set).
+	**/
+	public String fontName = null;
+	/**
+	* If you set this to a Font, the fontFlags, fontSizeChange and fontName values are ignored
+	* and this is used instead.
+	**/
+	public Font newFont;
+	/**
+	* The ID of the group this formatter belongs to.
+	**/
+	public int groupID;
+	/**
+	* The index of this formatter in the group this formatter belongs to.
+	**/
+	public int groupIndex;
+	//===================================================================
+	public TextFormatter()
+	//===================================================================
+	{
+	}
+	//===================================================================
+	public TextFormatter(int line,int character,int length)
+	//===================================================================
+	{
+		this.startLine = line;
+		this.startCharacter = character;
+		this.endCharacter = character+length-1;		
+		this.numLines = 1;
+	}
+	//===================================================================
+	public TextFormatter(int line,int character,int length,int fontFlags,int lineFlags)
+	//===================================================================
+	{
+		this.startLine = line;
+		this.startCharacter = character;
+		this.endCharacter = character+length-1;		
+		this.fontFlags = fontFlags;
+		this.lineFlags = lineFlags;
+		this.numLines = 1;
+	}
+	//===================================================================
+	public TextFormatter(int startLine,int numLines,int fontFlags,int lineFlags)
+	//===================================================================
+	{
+		this.startLine = startLine;
+		this.numLines = numLines;
+		this.startCharacter = 0;
+		this.endCharacter = -1;
+		this.fontFlags = fontFlags;
+		this.lineFlags = lineFlags;
+	}
+	//===================================================================
+	public Object getToolTip()
+	//===================================================================
+	{
+		return toolTip;
+	}
+
+
+//===================================================================
+public Font getFont(Font baseFont,int useSize)
+//===================================================================
+{
+	if ((fontFlags & FONT_CHANGE) == 0) return baseFont;
+	Font f = baseFont;
+	int ff = fontFlags & (Font.ITALIC|Font.BOLD|Font.PLAIN|Font.UNDERLINE);
+	int fs = useSize == 0 ? (fontSize == 0 ? f.getSize() : fontSize)+fontSizeChange : useSize;
+	return new Font(fontName == null ? f.getName() : fontName,f.getStyle()|ff,fs);
+}
+
+//-------------------------------------------------------------------
+protected FontMetrics getFontMetrics(TextPad pad,FontMetrics baseFont)
+//-------------------------------------------------------------------
+{
+	if (baseFont == null) baseFont = pad.getFontMetrics();
+	int ln = pad.getLineHeight();
+	for (int fs = 0;; fs--){
+		Font f = getFont(baseFont.getFont(),fs);
+		FontMetrics fm = baseFont.getNewFor(f);
+		if (fontSizeChange == 0){
+			if (fm.getCharWidth('X') <= baseFont.getCharWidth('X')) return fm;
+		}else{
+			if (fm.getHeight() <= ln) return fm;
+		}
+		fs = f.getSize();
+		if (fs <= 5) return fm;
+	}
+}
+/*
+//-------------------------------------------------------------------
+protected FontMetrics getFontMetrics(FormattedTextSpecs format)
+//-------------------------------------------------------------------
+{
+	Font f = getFont(format.metrics.getFont());
+	return format.metrics.getNewFor(f);
+}
+*/
+//===================================================================
+public Range getCharRange(int lineIndex,DisplayLine theLine,Range dest)
+//===================================================================
+{
+	if (notUsed) {
+		return null;
+	}
+	if (startCharacter == -1 || numLines == 0) return null;
+	if (dest == null) dest = new Range(0,0);
+	int ll = theLine.length();
+	dest.first = startCharacter;
+ 	dest.last = endCharacter;
+	if (lineIndex == startLine){ // This is the first line in the sequence.
+		if (numLines != 1) dest.last = ll-1;
+	}else if (lineIndex == startLine+numLines-1){ // This is the last line in the sequence.
+		dest.first = 0;
+	}else if (lineIndex > startLine && lineIndex < startLine+numLines-1){ // This must be between the first and lastLines.
+		dest.first = 0;
+		dest.last = ll-1;
+	}else
+		return null;
+	if (endCharacter == -1){ //Covers the entire line for all lines.
+		dest.first = 0;
+		dest.last = ll-1;
+	}
+	if (dest.last > ll-1) dest.last = ll-1;
+	return dest;
+}
+private static Range range = new Range(0,0);
+//private static int [] myPos;
+//-------------------------------------------------------------------
+protected void applySpecialFormat(TextPad source,int lineIndex,DisplayLine theLine,FormattedTextSpecs format)
+//-------------------------------------------------------------------
+{
+	try{
+		if (getCharRange(lineIndex,theLine,range) == null) {
+			return;
+		}
+		
+		if (image == null){
+			int character = range.first, length = range.last-range.first+1;
+			if (length < 0) return;
+			//
+			int [] ft = format.calculatedPositions;
+			FontMetrics fm = null;
+			if ((fontFlags & FONT_CHANGE) != 0){
+				String part = length == 0 ? "" : theLine.substring(character,character+length);
+				fm = getFontMetrics(source,format.metrics);
+				int [] got = fm.getFormattedTextPositions(part,format,null);
+				format.changeAndAdjustPositions(got,character,length);
+			}
+			//
+			if (lineFlags == 0 && image == null && leftMarginShift == 0) return;
+			//
+			int ll = theLine.length();
+			int fullWidth = ll == 0 ? 0 : format.calculatedPositions[ll-1];
+			fullWidth += format.firstCharPosition;
+			//
+			//ewe.sys.Vm.debug(format.lineFlags+"");
+			if ((format.lineFlags & format.LINE_FLAG_CANCEL_ALIGNMENTS) == 0){
+				if ((lineFlags & (LINE_CENTERED|LINE_ALIGN_NOW)) == (LINE_CENTERED|LINE_ALIGN_NOW)){
+					format.leftMargin = 
+					//((source.getAvailableWidth()-source.leftMargin-source.rightMargin-fullWidth)/2)+source.leftMargin;
+					((format.displayLineWidth-fullWidth-format.leftMargin-format.rightMargin)/2)+format.leftMargin;
+				}else if ((lineFlags & (LINE_RIGHT_ALIGNED|LINE_ALIGN_NOW)) == (LINE_RIGHT_ALIGNED|LINE_ALIGN_NOW))
+					format.leftMargin = format.displayLineWidth-fullWidth-format.rightMargin;//+format.leftMargin;
+			}
+			
+			if ((lineFlags & LINE_LEFT_MARGIN_SHIFT_IS_CHARACTERS) != 0){
+				if (fm == null) fm = getFontMetrics(source,format.metrics);
+				format.leftMargin += leftMarginShift*fm.getCharWidth('X');
+			}else{
+				format.leftMargin += leftMarginShift;
+			}
+			if ((lineFlags & (LINE_CANCEL_ALIGNMENTS|LINE_ALIGN_NOW)) == (LINE_CANCEL_ALIGNMENTS|LINE_ALIGN_NOW))
+				format.lineFlags |= format.LINE_FLAG_CANCEL_ALIGNMENTS;
+			if ((lineFlags & LINE_BACKGROUND_COLOR_CHANGE) != 0) 
+				format.backgroundColor = backgroundColor;
+			//
+		}else { //if (image != null){
+			FormattedTextSpecs f = format;
+		/*
+	 		if (imageLine > lineIndex){
+				DisplayLine nl = (DisplayLine)DisplayLine.getNext(theLine,imageLine-lineIndex);
+				f = source.getTextPositions(imageLine,nl,new FormattedTextSpecs(),myPos);
+			}else if (imageLine < lineIndex){
+				DisplayLine pl = (DisplayLine)DisplayLine.getPrev(theLine,lineIndex-imageLine);
+				f = source.getTextPositions(imageLine,pl,new FormattedTextSpecs(),myPos);
+			}
+			if (f != format) myPos = f.calculatedPositions;
+		*/
+			//
+			int allocatedWidth = image.getWidth()+(hSpace+borderWidth)*2;
+			if (imageChar == -1){ //Indicates a left or right aligned image.
+				if (imageX == 0) // Left aligned
+					f.leftMargin += allocatedWidth;//f.insertSpace(0,allocatedWidth);
+				else
+					f.rightMargin += allocatedWidth;
+				//f.extraSpaceUsed += allocatedWidth;
+			}else
+				if (imageLine == lineIndex){
+					f.insertSpace(imageChar,allocatedWidth);
+					f.extraSpaceUsed += allocatedWidth;
+				}
+
+			//
+		}
+		//
+		if (format.leftMargin < 0) format.leftMargin = 0;
+	}catch(Exception e){
+		
+	}
+}
+
+//===================================================================
+public static final Object SOLID_CIRCLE = new Object();
+public static final Object CIRCLE = new Object();
+public static final Object DIAMOND = new Object();
+//===================================================================
+
+//===================================================================
+public boolean isOnImage(TextPad source,int xPosition,FormattedTextSpecs specs)
+//===================================================================
+{
+	if (imageChar == -1){ //Left or right aligned image.
+				int ix = (imageX < 0) ? 
+					source.getAvailableWidth()-specs.rightMargin+hSpace:
+					source.leftMargin+hSpace;
+				return xPosition >= ix && xPosition <= ix+borderWidth*2+image.getWidth(); 
+	}else{
+		int ix = imageX+hSpace;
+		return xPosition >= ix && xPosition <= ix+borderWidth*2+image.getWidth(); 
+	}
+}
+//-------------------------------------------------------------------
+protected void drawSpecialFormat(TextPad source,int lineIndex,DisplayLine theLine,FormattedTextSpecs format,Graphics g,Color background)
+//-------------------------------------------------------------------
+{
+	try{
+	if (getCharRange(lineIndex,theLine,range) == null) return;
+	if (image == null){
+		int character = range.first, length = range.last-range.first+1;
+		if (length < 0) return;
+		//
+		FontMetrics fm = null;
+		if ((fontFlags & FONT_CHANGE) != 0){
+			Color was = g.getColor(Color.getCached());
+			fm = getFontMetrics(source,format.metrics);
+			Font f = fm.getFont();
+			//g.setColor(background);
+			//g.fillRect(format.leftMargin+(character == 0 ? 0 : format.calculatedPositions[character-1]),0,format.widthOf(character,length),format.displayLineHeight);
+			//if (color == null) color = was;
+			Color cc = background.equals(source.pageColor) ? color : source.pageColor;
+			if (cc == null) cc = was;
+			g.setColor(cc);
+			g.setFont(f);
+			g.drawFormattedText(format.charsToDraw,character,length,format.leftMargin+format.firstCharPosition,0,format);
+			char ctd = '\t';
+			for (int i = character; i<character+length; i++)
+				format.charsToDraw[i] = ctd;
+			g.setColor(was);
+			was.cache();
+		}
+		if (((lineFlags & LINE_ADD_FIRST_LINE_HEADER) != 0) && (lineIndex == startLine) && (data != null)){
+			String str = data.toString();
+			int blockWidth = format.displayLineHeight/3;
+			if (fm == null) fm = getFontMetrics(source,format.metrics);
+			int charSpace = fm.getCharWidth('X');
+			int ls = leftMarginShift;
+			if ((lineFlags & LINE_LEFT_MARGIN_SHIFT_IS_CHARACTERS) != 0)
+				ls = leftMarginShift*charSpace;
+			if ((lineFlags & LINE_HEADER_RIGHT_ALIGN) != 0){
+				if (data instanceof String) {
+					int full = charSpace+fm.getTextWidth(str);
+					g.drawText(str,format.leftMargin-full,0);
+				}else if (data == SOLID_CIRCLE) {
+					g.fillEllipse(format.leftMargin-blockWidth-charSpace,(format.displayLineHeight-blockWidth)/2,blockWidth,blockWidth);
+				}
+			}else{
+				if (data instanceof String)
+					g.drawText(str,format.leftMargin-ls,0);
+				else if (data == SOLID_CIRCLE)
+					g.fillEllipse(format.leftMargin-ls,(format.displayLineHeight-blockWidth)/2,blockWidth,blockWidth);
+				else if (data == CIRCLE)
+					g.drawEllipse(format.leftMargin-ls,(format.displayLineHeight-blockWidth)/2,blockWidth,blockWidth);
+				else if (data == DIAMOND)
+					g.drawDiamond(new Rect(format.leftMargin-ls,(format.displayLineHeight-blockWidth)/2,blockWidth,blockWidth),g.All);
+			}
+		}
+		if ((lineFlags & LINE_DRAW_RULE) != 0){
+			g.drawLine(source.leftMargin,format.displayLineHeight/2-1,format.displayLineWidth-source.leftMargin,format.displayLineHeight/2-1);
+			g.drawLine(source.leftMargin,format.displayLineHeight/2+1,format.displayLineWidth-source.leftMargin,format.displayLineHeight/2+1);
+		}
+	}else {//if (image != null){
+		FormattedTextSpecs f = format;
+ 		if (imageLine > lineIndex){
+			DisplayLine nl = (DisplayLine)DisplayLine.getNext(theLine,imageLine-lineIndex);
+			//ewe.sys.Vm.debug(nl.line);
+			f = source.getTextPositions(imageLine,nl,new FormattedTextSpecs(),new int[0],true);
+		}else if (imageLine < lineIndex){
+			DisplayLine pl = (DisplayLine)DisplayLine.getPrev(theLine,lineIndex-imageLine);
+			//ewe.sys.Vm.debug(pl.line);
+			f = source.getTextPositions(imageLine,pl,new FormattedTextSpecs(),new int[0],true);
+		}//else ewe.sys.Vm.debug("Yes, this is the line");
+		//if (f != format) myPos = f.calculatedPositions;
+		int y = (lineIndex-startLine)*source.getLineHeight();
+		int allocatedWidth = image.getWidth()+(hSpace+borderWidth)*2;
+		if (imageChar > -1){
+			imageX = imageChar == 0 ? 0 : f.calculatedPositions[imageChar-1];
+			imageX += f.leftMargin+f.firstCharPosition-allocatedWidth;
+			image.draw(g,imageX+hSpace+borderWidth,-y+imageY+vSpace+borderWidth,0);
+		}else{
+			//ewe.sys.Vm.debug("Line: "+lineIndex+", of: "+numLines);
+			if (imageX < 0)
+				image.draw(g,source.getAvailableWidth()-f.rightMargin+hSpace+borderWidth,-y+imageY+vSpace+borderWidth,0);
+			else
+				image.draw(g,source.leftMargin+hSpace+borderWidth/*-hSpace-borderWidth-image.getWidth()*/,-y+imageY+vSpace+borderWidth,0);
+		}
+		//ewe.sys.Vm.debug(numLines+", Range: "+range);
+		//image.draw(g,format.leftMargin,0,
+	}
+	}catch(Exception e){
+		//e.printStackTrace();
+	}
+}
+
+//-------------------------------------------------------------------
+protected void replace(TextPad pad, DisplayLine firstLine, int numLines, DisplayLine newLines)
+//-------------------------------------------------------------------
+{
+	pad.replaceDisplayLines(newLines,firstLine,(DisplayLine)firstLine.getNext(firstLine,numLines));
+}
+//-------------------------------------------------------------------
+protected DisplayLine resplit(TextPad pad, DisplayLine firstLine, int numLines,int forWidth,String newText)
+//-------------------------------------------------------------------
+{
+	FontMetrics fm = pad.getFontMetrics();
+	DisplayLine dl = pad.resplit(firstLine,numLines,forWidth,null,getFontMetrics(pad,null),newText);
+	return dl;
+}
+/*
+//-------------------------------------------------------------------
+protected DisplayLine resplit(TextPad pad, DisplayLine firstLine, int numLines,int lineIndex,DisplayLine.WidthProvider wp,String newText)
+//-------------------------------------------------------------------
+{
+	String text = newText != null ? newText : firstLine.concatenate(firstLine,0,numLines);
+	FontMetrics fm = pad.getFontMetrics();
+	DisplayLine dl = pad.splitLines(text,0,
+		fm.getNewFor(getFont(fm.getFont())),null,wp);
+	pad.replaceDisplayLines(dl,firstLine,(DisplayLine)firstLine.getNext(firstLine,numLines-1));
+	return dl;
+}
+*/
+/**
+* This gives the TextFormatter the chance to actually alter the lines being displayed.
+**/
+//===================================================================
+public DisplayLine creatingFor(TextPad pad, DisplayLine firstLine, int numLines,int lineIndex)
+//===================================================================
+{
+	if (((lineFlags & LINE_RESPLIT) != 0)){
+		int size = firstLine.displayWidth-leftMarginShift;//pad.getDim(null).width-(pad.spacing*2)-pad.leftMargin-leftMarginShift-pad.rightMargin+resplitWidthChange;
+		//ewe.sys.Vm.debug("Resplit: "+size);
+		return resplit(pad,firstLine,numLines,size,null);
+	}//else if (image != null){
+		//DisplayLine f = pad.addDisplayLine("",firstLine);
+		//pad.addDisplayLine("",(DisplayLine)firstLine.next);
+		//return f;
+	//}
+	return firstLine;
+}
+//===================================================================
+public void repaint(TextPad pad, Graphics gr)
+//===================================================================
+{
+	int first = pad.getTopLine();
+	int max = first+pad.getScreenRows()+1;
+	for (int i = startLine; i<startLine+numLines; i++){
+		if (i < first || i >= max) continue;
+		pad.paintLine(gr,i);
+	}
+}
+
+//##################################################################
+}
+//##################################################################
+

Added: experiments/EVEhist/src/eve/ui/formatted/TextPosition.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/TextPosition.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/TextPosition.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,82 @@
+package eve.ui.formatted;
+import eve.fx.DisplayLine;
+import eve.sys.Device;
+import eve.ui.TextPad;
+
+	//##################################################################
+	class TextPosition{
+	//##################################################################
+	// Do not move these next three -------------------
+	DisplayLine line;
+	int lineIndex;
+	int characterIndex;
+	//-------------------------------------------------
+	//===================================================================
+	public TextPosition(){}
+	//===================================================================
+	public TextPosition(TextPad pad)
+	//===================================================================
+	{
+		line = pad.getLine(0);
+		lineIndex = characterIndex = 0;
+	}
+	//===================================================================
+	public TextPosition(TextPad pad,int lineIndex,int charIndex)
+	//===================================================================
+	{
+		line = pad.getLine(lineIndex);
+		this.lineIndex = lineIndex;
+		this.characterIndex = charIndex;
+	}
+	//===================================================================
+	TextPosition getCopy()
+	//===================================================================
+	{
+		TextPosition tp = new TextPosition();
+		tp.copyFrom(this);
+		return tp;
+	}
+	//===================================================================
+	void copyFrom(TextPosition tp)
+	//===================================================================
+	{
+		line = tp.line;
+		lineIndex = tp.lineIndex;
+		characterIndex = tp.characterIndex;
+	}
+	native boolean nativeFindCharacter(int indexOfCharacter);
+	boolean hasNative = true;	
+	//===================================================================
+	boolean findCharacter(int indexOfCharacter)
+	//===================================================================
+	{
+		if (hasNative) try{
+			return nativeFindCharacter(indexOfCharacter);
+		}catch(Throwable t){
+			Device.checkNoNativeMethod(t);
+			hasNative = false;
+		}
+		if (characterIndex > indexOfCharacter) return false;
+		while(true){
+			int tl = line.trueLength();
+			if (characterIndex+tl > indexOfCharacter && tl != 0)
+				return true;
+			characterIndex += tl;
+			lineIndex++;
+			if (line.next == null) return false;
+			line = (DisplayLine)line.next;
+		}
+	}
+	//===================================================================
+	boolean moveToNextLine()
+	//===================================================================
+	{
+		lineIndex++;
+		characterIndex += line.trueLength();
+		line = (DisplayLine)line.next;
+		return line != null;
+	}
+	//##################################################################
+	}
+	//##################################################################
+

Added: experiments/EVEhist/src/eve/ui/formatted/data/HtmlViewer.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/data/HtmlViewer.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/data/HtmlViewer.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,864 @@
+
+package eve.ui.formatted.data;
+import java.io.IOException;
+import java.io.InputStream;
+import java.util.Hashtable;
+import java.util.Vector;
+
+import eve.data.PropertyList;
+import eve.fx.Dimension;
+import eve.fx.Font;
+import eve.fx.Point;
+import eve.io.AsciiCodec;
+import eve.io.File;
+import eve.io.StreamUtils;
+import eve.io.TextCodec;
+import eve.net.Link;
+import eve.net.URL;
+import eve.sys.Handle;
+import eve.sys.Task;
+import eve.sys.TimeOut;
+import eve.sys.Vm;
+import eve.ui.Application;
+import eve.ui.CardPanel;
+import eve.ui.CellPanel;
+import eve.ui.Control;
+import eve.ui.Gui;
+import eve.ui.InputStack;
+import eve.ui.Label;
+import eve.ui.MessageBox;
+import eve.ui.ProgressBarForm;
+import eve.ui.ProgressDisplay;
+import eve.ui.ScrollBarPanel;
+import eve.ui.Window;
+import eve.ui.data.AppForm;
+import eve.ui.data.Editor;
+import eve.ui.data.FontChooser;
+import eve.ui.filechooser.FileChooser;
+import eve.ui.formatted.FormattedTextMaker;
+import eve.ui.formatted.HotSpot;
+import eve.ui.formatted.HtmlDisplay;
+import eve.ui.formatted.TextFormatter;
+import eve.util.ByteArray;
+import eve.util.CharArray;
+import eve.util.mString;
+/**
+This is a useful Form that you can use to display HTML files. It consists
+of an HtmlDisplay along with optional controls.<p>
+The 
+**/
+//##################################################################
+public class HtmlViewer extends AppForm {
+//##################################################################
+
+HtmlDisplay display;
+//public FileSaver saver = new FileSaver();
+
+public PropertyList htmlProperties = new PropertyList();
+public FontChooser fontChooser;
+/**
+* Specifies if images should be displayed - true by default.
+**/
+public boolean showImages = true;
+/**
+* Specifies if animated images should be allowed - true on some systems by default.
+**/
+public boolean animatedImages = true;
+/**
+* A display option for the constructor.
+**/
+public final static int DISPLAY_NO_STATUS_BAR = 0x1;
+/**
+* A display option for the constructor.
+**/
+public final static int DISPLAY_NO_TOOL_BUTTONS = 0x2;
+/**
+* A display option for the constructor.
+**/
+public final static int DISPLAY_NO_TABS = 0x4;
+/**
+* A display option for the constructor.
+**/
+public final static int DISPLAY_NO_OPEN = 0x8;
+public String status = "";
+protected ProgressDisplay progress;
+protected Control stopButton;
+protected CardPanel statusCard;
+
+//##################################################################
+protected class HtmlViewerDisplay extends HtmlDisplay{
+//##################################################################
+
+
+
+//-------------------------------------------------------------------
+HtmlViewerDisplay()
+//-------------------------------------------------------------------
+{
+	super(20,60);
+}
+//-------------------------------------------------------------------
+protected boolean hotspotPressed(HotSpot hs,Point where)
+//-------------------------------------------------------------------
+{
+	if (super.hotspotPressed(hs,where)) return true;
+	return HtmlViewer.this.hotspotPressed(hs,where);
+}
+//-------------------------------------------------------------------
+protected void mouseMovedOnOff(TextFormatter tf,boolean movedOn)
+//-------------------------------------------------------------------
+{
+	if (movedOn) status = mString.toString(tf.data);
+	else status = "";
+	toControls("status");
+}
+//===================================================================
+public Object getState()
+//===================================================================
+{
+	Object [] ret = new Object[2];
+	ret[0] = currentURL;
+	ret[1] = super.getState();
+	return ret;
+}
+//===================================================================
+public boolean setState(Object state)
+//===================================================================
+{
+	Object [] st = (Object [])state;
+	if (st[0] == null) return false;
+	if (!st[0].equals(currentURL)){
+		try{
+			doOpen((String)st[0]).waitOn(Handle.Success);
+			return super.setState(st[1]);
+		}catch(Exception e){
+			return false;
+		}
+	}else return super.setState(st[1]);
+}
+//##################################################################
+}
+//##################################################################
+
+/**
+* This is the codec that will be used to decode text. If it is null then an
+* AsciiCodec will be used.
+**/
+public TextCodec codec;
+/*
+//===================================================================
+public TextCodec getCodec()
+//===================================================================
+{
+}
+*/
+/**
+ * Get a codec to decode a Web document. The properties of the document
+ * as provided by the Web Server are in the specified PropertyList parameter.
+ * @param pl the properties for the document.
+ * @return a non-null Codec for decoding the document. By default this returns
+ * the value of the "codec" field. If that is null an AsciiCodec is returned.
+ */
+//===================================================================
+public TextCodec getCodec(PropertyList pl)
+//===================================================================
+{
+	TextCodec c = codec;
+	if (c == null) c = new AsciiCodec();
+	return c;
+}
+
+/**
+ * This returns a String ONLY if the String is the name of a VALID URL resource. This could
+ * be a file name.
+ * @param root The current document root.
+ * @param document The document being referred to.
+ * @return the URL as a String if it is valid and can be retrieved by the Viewer.
+ */
+//-------------------------------------------------------------------
+protected String toFullURL(String root,String document)
+//-------------------------------------------------------------------
+{
+	File file = null;
+	if (document.indexOf(':') != -1 || document.indexOf('/') == 0) file = getNewFile(document);
+	else file = root.length() == 0 ? getNewFile(document) : getNewFile(root).getChild(document);
+	if (!file.canRead()) return null;
+	return file.getFullPath();
+}
+//-------------------------------------------------------------------
+protected Handle openDocument(String url,PropertyList pl)
+//-------------------------------------------------------------------
+{
+	try{
+		File file = getNewFile(url);
+		if (file.canRead()){
+			String root = file.getParent();
+			pl.set("documentRoot",root);
+		}
+		String nu = url.toLowerCase();
+		for (int i = 0; i<images.length; i++)
+			if (nu.endsWith(images[i])){
+				String toOpen = "<head><title>"+url+"</title></head><body><img src=\""+
+				//file.getFileExt()
+				(file.canRead() ? file.getFileExt() : url)
+				+"\"><br></body>";
+				return new Handle(Handle.Succeeded,toOpen);
+			}
+		return StreamUtils.readAllBytes(file.toReadableStream(),null);
+	}catch(Exception e){
+		return new Handle(Handle.Failed,null);
+	}
+}
+//-------------------------------------------------------------------
+protected boolean hotspotPressed(HotSpot hs,Point where)
+//-------------------------------------------------------------------
+{
+	if (hs.data == null) return false;
+	String href = hs.data.toString();
+	if (href == null) return false;
+	display.markHistory();
+	doOpen(href);
+	return true;
+}
+protected Handle loading;
+//-------------------------------------------------------------------
+protected void noLoading()
+//-------------------------------------------------------------------
+{
+	if (stopButton != null){
+		stopButton.modify(Disabled,0);
+		stopButton.repaintNow();
+	}
+	if (statusCard != null) statusCard.select("status");
+}
+//-------------------------------------------------------------------
+protected void startingLoad(Handle h)
+//-------------------------------------------------------------------
+{
+	if (statusCard != null) statusCard.select("progress");
+	if (progress != null) progress.setTask(h,"Loading");
+	if (stopButton != null){
+		stopButton.modify(0,Disabled);
+		stopButton.repaintNow();
+	}
+}
+//-------------------------------------------------------------------
+protected void endedLoad(Handle h)
+//-------------------------------------------------------------------
+{
+	if (loading == h) noLoading();
+}
+
+String currentURL;
+
+//===================================================================
+public String getCurrentURL()
+//===================================================================
+{
+	return currentURL;
+}
+
+//-------------------------------------------------------------------
+protected void newDocumentLoaded(String url){currentURL = url;}
+//-------------------------------------------------------------------
+
+/**
+ * Tell the viewer to load and display the URL. 
+ * @param url The url which can be an http:// url or a file name. It can also be relative to
+ * the current document.
+ * @return A Handle that can be used to monitor the progress of the display.
+ */
+//===================================================================
+public Handle setHtml(URL url)
+//===================================================================
+{
+	return setHtml(url,null,null);	
+}
+/**
+ * Tell the viewer to load and display the Link. A Link can be a URL in text form or it can
+ * be a file name or an anchor ('#') to a bookmark in the current document.
+ * @param link The link which can be an "http://" url or a file name. It can also be relative to
+ * the current document.
+ * @return A Handle that can be used to monitor the progress of the display.
+*/
+//===================================================================
+public Handle setHtml(Link link)
+//===================================================================
+{
+	return setHtml(link,null,null);
+}
+/**
+ * Set the Html text directly.
+ * @param htmlText An object representing htmlText. This can be:
+	<ul>
+	<li>A URL holding the URL you want the browser to fetch.
+	<li>A Link holding the URL or file that you want the browser to fetch.
+	<li>A String holding the HTML text.
+	<li>An eve.util.ByteArray holding the text encoded HTML text.
+	<li>A byte array (byte[]) holding the text encoded HTML.
+	<li>An InputStream object from which the text can be read.
+	<li>An eve.io.File object from which the text can be read.
+	</ul>
+ * @param urlToDisplay The URL to display for the data.
+ * @param bookmark An optional bookmark in the file to go to.
+ * @return A Handle that can be used to monitor the progress of the display.
+ */
+//===================================================================
+public Handle setHtml(Object htmlText,String urlToDisplay,String bookmark)
+//===================================================================
+{
+	String uu = urlToDisplay;
+	String aa = bookmark;
+	if (htmlText instanceof URL){
+		htmlText = new Link(htmlText.toString());
+	}
+	if (htmlText instanceof Link){
+		String href = htmlText.toString();
+		String file = mString.leftOf(href,'#');
+		aa = mString.rightOf(href,'#');
+		if (file.length() == 0) return new Handle(Handle.Failed,null);
+		uu = toFullURL(htmlProperties.getString("documentRoot",""),file);
+		if (uu == null) return new Handle(Handle.Failed,null);
+	}
+	final String url = uu;
+	final String anchor = aa;
+	//
+	FormattedTextMaker fm = findCached(url);
+	//
+	cancelLoading(true);
+	if (fm != null){
+		setHtml(fm);
+		htmlProperties.set("documentRoot",display.getDecoderProperties().getString("documentRoot","/"));
+		htmlProperties.set("document",url);
+		if (anchor != null && anchor.length() > 0) display.goToAnchor(anchor);
+		newDocumentLoaded(url);
+		return new Handle(Handle.Succeeded,fm);
+	}
+	final PropertyList pl = new PropertyList();
+	pl.set("document",url);
+
+	final Handle h = htmlText instanceof Link ? openDocument(url,pl) : new Handle(Handle.Succeeded,htmlText);
+	return new Task(){
+		protected void doRun(){
+			Handle handle = this;
+			try{
+				handle.doing = "Loading...";
+				startingLoad(loading = handle);
+				handle.setProgress(0);
+				if (!waitOnSuccess(h,TimeOut.Forever,true)){
+					if ((handle.check() & handle.Aborted) == 0){
+						new MessageBox("Load Error","Could not load document.\nError: "+h.getErrorText("Unknown"),MBOK).execute();
+						//if (handle.error != null) new ReportException(handle.error).execute();
+					}
+					return;
+				}
+				Object toDecode = h.returnValue;
+				handle.setProgress(0);
+				decodeHtml(toDecode,url,anchor,this,pl);
+			}finally{
+				endedLoad(handle);
+				loading = null;
+			}
+		}
+	}.start();
+}
+
+/**
+ * Setup the htmlProperties based on selected options.
+ */
+//===================================================================
+public void setupProperties()
+//===================================================================
+{
+	htmlProperties.setBoolean("allowAnimatedImages",animatedImages);
+	htmlProperties.setBoolean("allowImages",showImages);
+}
+/**
+* Use this to cancel a load/decode operation. If you intend to immediately start another
+* load using doOpen() then set startingNewLoad to true.
+**/
+//===================================================================
+public void cancelLoading(boolean startingNewLoad)
+//===================================================================
+{
+	if (loading == null) return;
+	loading.stop(0);
+	loading = null;
+	if (progress != null) progress.clearTask();
+	if (!startingNewLoad) noLoading();
+}
+
+//-------------------------------------------------------------------
+void decodeHtml(Object what,String url,String anchor,Task t,PropertyList pl)
+//-------------------------------------------------------------------
+{
+	Handle handle = t;
+	if (anchor == null) anchor = "";
+	try{
+		String html = null;
+		boolean closeStream = false;
+		while(true){
+			if (what instanceof String) html = (String)what;
+			else if (what instanceof ByteArray){
+				ByteArray ba = (ByteArray)what;
+				CharArray ca = getCodec(pl).decodeText(ba.data,0,ba.length,true,null);
+				html = new String(ca.data,0,ca.length);
+			}else if (what instanceof byte []){
+				byte [] d = (byte [])what;
+				CharArray ca = getCodec(pl).decodeText(d,0,d.length,true,null);
+				html = new String(ca.data,0,ca.length);
+			}else if (what instanceof InputStream){
+				ByteArray got = StreamUtils.readAllBytes(null,(InputStream)what,null);
+				if (closeStream) ((InputStream)what).close();
+				what = got;
+				continue;
+			}else if (what instanceof File){
+				what = ((File)what).toReadableStream();
+				closeStream = true;
+				continue;
+			}
+			if (html == null) throw new IOException("Cannot decode HTML");
+			else break;
+		}
+		handle.doing = "Decoding...";
+		handle.setProgress(0);
+		setupProperties();
+		htmlProperties.set(pl);
+		addPropertiesTo(htmlProperties);
+		String loadedDocument = htmlProperties.getString("document",url);
+		FormattedTextMaker fm = setHtml(html,htmlProperties,handle);
+		if (handle.shouldStop) throw new IOException();
+		handle.returnValue = fm;
+		cacheOpened(loadedDocument,fm);
+		if (anchor.length() > 0) 
+			display.goToAnchor(anchor);
+		
+		newDocumentLoaded(loadedDocument);
+		handle.progress = 0;
+		handle.doing = "";
+		handle.set(Handle.Succeeded);
+	}catch(Exception e){
+		handle.set(Handle.Failed);
+	}
+}
+/**
+* Open the file relative to the current document root, or as a new document/file.
+* @param fileOrUrl.
+* @return A Handle with which the progress of the load can be monitored.
+*/
+//===================================================================
+public Handle doOpen(String fileOrUrl)
+//===================================================================
+{
+		return setHtml(new Link(fileOrUrl),null,null);
+	/*
+	//
+	String href = fileOrUrl;
+	final String file = ewe.util.mString.leftOf(href,'#');
+	final String anchor = ewe.util.mString.rightOf(href,'#');
+	if (file.length() == 0) return new Handle(Handle.Failed,null);
+	//
+	final String url = toFullURL(htmlProperties.getString("documentRoot",""),file);
+	if (url == null) return  new Handle(Handle.Failed,null);
+	//
+	FormattedTextMaker fm = findCached(url);
+	//
+	cancelLoading(true);
+	if (fm != null){
+		setHtml(fm);
+		htmlProperties.set("documentRoot",display.getDecoderProperties().getString("documentRoot","/"));
+		htmlProperties.set("document",url);
+		if (anchor.length() > 0) display.goToAnchor(anchor);
+		newDocumentLoaded(url);
+		return new Handle(Handle.Succeeded,fm);
+	}
+	final PropertyList pl = new PropertyList();
+	pl.set("document",url);
+	final Handle h = openDocument(url,pl);
+	return new TaskObject(){
+		protected void doRun(){
+			handle.doing = "Loading...";
+			startingLoad(loading = handle);
+			try{
+				if (!waitOnSuccess(h,true)) {
+					if ((handle.check() & handle.Aborted) == 0)
+						new MessageBox("Load Error","Could not load document.\nError: "+h.getErrorText("Unknown"),MBOK).execute();
+					return;
+				}
+				try{
+					handle.progress = 0;
+					handle.doing = "Decoding...";
+					String html = null;
+					if (h.returnValue instanceof String) html = (String)h.returnValue;
+					if (h.returnValue instanceof ByteArray){
+						ByteArray ba = (ByteArray)h.returnValue;
+						CharArray ca = getCodec().decodeText(ba.data,0,ba.length,true,null);
+						html = new String(ca.data,0,ca.length);
+					}
+					setupProperties();
+					htmlProperties.set(pl);
+					addPropertiesTo(htmlProperties);
+					String loadedDocument = htmlProperties.getString("document",url);
+					FormattedTextMaker fm = setHtml(html,htmlProperties,handle);
+					if (handle.shouldStop) throw new IOException();
+					handle.returnValue = fm;
+					cacheOpened(loadedDocument,fm);
+					if (anchor.length() > 0) 
+						display.goToAnchor(anchor);
+					newDocumentLoaded(loadedDocument);
+					handle.progress = 0;
+					handle.doing = "";
+					handle.set(Handle.Succeeded);
+				}catch(IOException e){
+					handle.set(Handle.Failed);
+				}
+			}finally{
+				endedLoad(handle);
+				loading = null;
+			}
+		}		
+	}.startTask();
+	//return h;
+	*/
+}
+/**
+ * Create the viewer with full tools.
+ * @param displayOptions This can be any of the : DISPLAY_XXX options ORed together.
+ */
+//===================================================================
+public HtmlViewer()
+//===================================================================
+{
+	this(null,0);
+}
+/**
+ * Create the viewer the specified display options.
+ * @param displayOptions This can be any of the : DISPLAY_XXX options ORed together.
+ */
+//===================================================================
+public HtmlViewer(int displayOptions)
+//===================================================================
+{
+	this(null,displayOptions);
+}
+
+//-------------------------------------------------------------------
+protected HtmlDisplay createDisplay()
+//-------------------------------------------------------------------
+{
+	return new HtmlViewerDisplay();
+}
+/**
+ * Create the viewer with a particular HtmlDisplay and using the specified display options.
+ * @param display An HtmlDisplay to use (can be null).
+ * @param displayOptions This can be any of: DISPLAY_NO_STATUS_BAR, DISPLAY_NO_TOOL_BUTTONS, DISPLAY_NO_TABS OR'ed together.
+ */
+//===================================================================
+public HtmlViewer(HtmlDisplay display,int displayOptions)
+//===================================================================
+{
+	super((displayOptions & DISPLAY_NO_TABS) == 0,(displayOptions & DISPLAY_NO_TABS) == 0);
+	//
+	//String plat = Vm.getPlatform().toUpperCase();
+	//if (plat.equals("UNIX") || plat.equals("LINUX")) animatedImages = false;
+	Dimension sz = Gui.getScreenSize();
+	if (!Gui.screenIs(Gui.WIDE_SCREEN)) htmlProperties.set("maxImageSize",new Dimension(sz.width/2,sz.width/2));
+	int opts = Vm.getParameter(Vm.VM_FLAGS);
+	if ((opts & Vm.VM_FLAG_SLOW_MACHINE) != 0)
+		htmlProperties.setBoolean("allowAnimatedImages",animatedImages = false);
+	if (display == null) display = createDisplay();
+	acceptsDroppedFiles = true;
+	this.display = display;
+
+	title = "HTML Viewer";
+	ScrollBarPanel sbp = new ScrollBarPanel(display);
+	//
+	sbp.setOptions(sbp.Permanent);
+	data.addLast(sbp);
+	Vector t = new Vector();
+	
+	//pl.setBoolean("allowAnimatedImages",false);
+	//pl.set("maxImageSize",new ewe.fx.Dimension(50,50));
+	
+	if (tabs != null){
+		fontChooser = new FontChooser(false);
+		CellPanel tl = new CellPanel();
+		fontChooser.fromFont(display.getFont());
+		tl.addLast(addField(fontChooser.getEditor(0),"fontChooser")).setCell(HSHRINK);
+		tabs.addCard(tl,"Font",null).iconize("eve/fontsmall.png");
+		
+		InputStack is = new InputStack(); is.columns = 2;
+		addField(is.addCheckBox("Images"),"showImages");
+		addField(is.addCheckBox("Animated Images"),"animatedImages");
+		tabs.addCard(is,"Options",null).iconize("eve/optionssmall.png");
+	}
+	
+	if ((displayOptions & DISPLAY_NO_TOOL_BUTTONS) == 0){
+		if ((displayOptions & DISPLAY_NO_OPEN) == 0)
+			setupStandardFileCommands(this,SHOW_OPEN_BUTTON/*|SHOW_EXIT_BUTTON*/,tools,"HTML File");
+		addToolButton("back",loadImage("eve/leftarrowsmall.png"),"Go Back",true);
+		addToolButton("reload",loadImage("eve/reloadsmall.png"),"Reload",true);
+		stopButton = addToolButton("stop",stop,"Stop",true);
+		stopButton.modify(Disabled,0);
+		tools.modifyAll(NoFocus|MouseSensitive,TakesKeyFocus,true);
+	}
+	
+	if ((displayOptions & DISPLAY_NO_STATUS_BAR) == 0){
+		statusCard = new CardPanel();
+
+		statusCard.borderWidth = 3;
+		statusCard.borderStyle = EDGE_SUNKEN;
+		data.addLast(statusCard).setCell(HSTRETCH);
+		statusCard.addItem(addField(new Label(" "),"status"),"status",null);
+	//
+		ProgressBarForm pbf = new ProgressBarForm();
+		pbf.showMainTask = false;
+		pbf.showSubTask = true;
+		pbf.showTaskInBar = true;
+		pbf.exitOnCompletion = false;
+		pbf.bar.showPercent = false;
+		pbf.bar.incompleteColor = getBackground();
+		progress = pbf;
+		CellPanel cp2 = new CellPanel();
+		cp2.addNext(pbf).setControl(DONTFILL|WEST);
+		statusCard.addItem(cp2,"progress",null);
+	}
+}
+
+//===================================================================
+File getNewFile(String path)
+//===================================================================
+{
+	return File.getNewFile(path);
+}
+
+//===================================================================
+void htmlSet()
+//===================================================================
+{
+	title = display.headerData.getString("title","untitled");
+	Window w = getWindow();
+	if (w != null) w.setTitle(title);
+	htmlProperties.set(display.getDecoderProperties());
+}
+//===================================================================
+public void setHtml(FormattedTextMaker html)
+//===================================================================
+{
+	display.setHtml(html,null);
+	htmlSet();
+}
+//===================================================================
+public FormattedTextMaker setHtml(String html,PropertyList props,Handle h)
+//===================================================================
+{
+	if (html == null) return null;
+	addPropertiesTo(props);
+	FormattedTextMaker ftm = display.setHtml(html,props,h);
+	htmlSet();
+	return ftm;
+}
+
+static Hashtable opened = new Hashtable();
+
+//-------------------------------------------------------------------
+protected void addPropertiesTo(PropertyList pl)
+//-------------------------------------------------------------------
+{
+	
+}
+//===================================================================
+public FormattedTextMaker open(String data,String fileName)
+//===================================================================
+{
+	Gui.showWait(this,true);
+	try{
+		String root = getNewFile(fileName).getParent();
+		if (root == null) root = "";
+		root = File.removeTrailingSlash(root)+"/";
+		htmlProperties.set("documentRoot",root);
+		//htmlProperties.set("maxImageSize",new ewe.fx.Dimension(150,150));
+		return setHtml(data,htmlProperties,new Handle());
+	}finally{
+		Gui.showWait(this,false);
+	}
+}
+public static String [] images = {".jpeg",".jpg",".png",".bmp",".gif"};
+
+//===================================================================
+public void open(FormattedTextMaker maker)
+//===================================================================
+{
+	setHtml(maker);
+}
+//===================================================================
+public FormattedTextMaker findCached(String name)
+//===================================================================
+{
+	return (FormattedTextMaker)opened.get(name);
+}
+//===================================================================
+public FormattedTextMaker cacheOpened(String name,FormattedTextMaker maker)
+//===================================================================
+{
+	opened.put(name,maker);
+	return maker;
+}
+//===================================================================
+public void removeCached(String name)
+//===================================================================
+{
+	opened.remove(name);
+}
+//===================================================================
+public FormattedTextMaker open(String name)
+//===================================================================
+{
+	String fe = File.getFileExt(name);
+	try{
+		String nu = name.toLowerCase();
+		for (int i = 0; i<images.length; i++)
+			if (nu.endsWith(images[i])){
+				String toOpen = "<head><title>name</title></head><body><img src=\""+fe+"\"><br></body>";
+				return open(toOpen,name);
+			}
+		FormattedTextMaker ftm = findCached(name);
+		if (ftm != null){
+			open(ftm);
+			return ftm;
+		}
+		/*
+		String got = saver.openText(name,getFrame());
+		if (nu.endsWith(".txt") && got != null){
+			display.setPlainText(got);
+			return null;
+		}
+		if (got != null) 
+			return cacheOpened(name,open(got,name));
+		*/
+	}catch(Exception e){
+		
+	}
+		return null;
+}
+//===================================================================
+public void action(String fieldName,Editor ed)
+//===================================================================
+{
+	if (fieldName.equals("Exit")){
+		exit(0);
+	}else if (fieldName.equals("Open")){
+		open();
+	}else if (fieldName.equals("back")){
+		goBack();
+	}else if (fieldName.equals("stop")){
+		cancelLoading(false);
+	}else if (fieldName.equals("reload")){
+		reload();
+	}else
+		super.action(fieldName,ed);
+}
+
+
+/**
+ * Go to previous document/location. Acts as if the go back button had been pressed.
+ */
+//===================================================================
+public void goBack()
+//===================================================================
+{
+	display.goBack();
+}
+/**
+ * Open a new file. Acts as if the open button had been pressed.
+ */
+//===================================================================
+public void open()
+//===================================================================
+{
+	FileChooser fc = new FileChooser();
+	fc.title = "Open Web Document";
+	fc.addMask("*.html;*.htm - HTML Documents");
+	fc.addMask(fc.allFilesMask);
+	fc.persistentHistoryKey = "Ewesoft-HtmlViewer";
+	if (fc.execute() == IDCANCEL) return;
+	doOpen(fc.getChosenFile().getFullPath());
+	//String data = saver.open(null,getFrame());
+	//if (data != null) open(data,saver.lastSaved);
+}
+/**
+* Reload the current document. Acts as if the reload button had been pressed.
+**/
+//===================================================================
+public void reload()
+//===================================================================
+{
+	cancelLoading(false);
+	if (currentURL != null){
+		removeCached(currentURL);
+		doOpen(currentURL);
+	}
+}
+//===================================================================
+public void fieldChanged(String fieldName,Editor ed)
+//===================================================================
+{
+	if (fieldName.equals("fontChooser")){
+		display.font = fontChooser.toFont();
+		update();
+	}if (fieldName.equals("animatedImages") || fieldName.equals("showImages")){
+		setupProperties();
+	}
+}
+//===================================================================
+public void update()
+//===================================================================
+{
+		display.update();
+		display.repaintNow();
+}
+
+//===================================================================
+public void filesDropped(String[] fileName)
+//===================================================================
+{
+	doOpen(fileName[0]);
+}
+/**
+ * Set the display font.
+ */
+//===================================================================
+public void setDisplayFont(Font f)
+//===================================================================
+{
+	display.font = f;
+	fontChooser.fromFont(display.font);
+}
+
+//===================================================================
+public static HtmlViewer openAndDisplay(String url,int displayOptions,boolean execute)
+//===================================================================
+{
+	HtmlViewer np = new HtmlViewer(null,displayOptions);
+	if (url != null) {
+		np.doOpen(url);
+	}
+	if (execute) np.exec();
+	else np.show();
+	return np;
+}
+//===================================================================
+public static void main(String args[])
+//===================================================================
+{
+	Application.startApplication(args);
+	String toOpen = null;
+	if (args.length != 0) toOpen = args[0];
+	HtmlViewer np = openAndDisplay(toOpen,0,false);
+	np.exitSystemOnClose = true;
+}
+
+//##################################################################
+}
+//##################################################################
+

Added: experiments/EVEhist/src/eve/ui/formatted/data/WebBrowser.java
===================================================================
--- experiments/EVEhist/src/eve/ui/formatted/data/WebBrowser.java	2009-01-31 13:48:30 UTC (rev 1606)
+++ experiments/EVEhist/src/eve/ui/formatted/data/WebBrowser.java	2009-02-01 11:37:18 UTC (rev 1607)
@@ -0,0 +1,336 @@
+package eve.ui.formatted.data;
+import java.io.IOException;
+import java.net.Socket;
+import java.util.Vector;
+
+import eve.data.PropertyList;
+import eve.io.File;
+import eve.io.Io;
+import eve.net.HttpConnection;
+import eve.sys.Handle;
+import eve.sys.Task;
+import eve.sys.TimeOut;
+import eve.ui.Application;
+import eve.ui.Card;
+import eve.ui.CellPanel;
+import eve.ui.ComboBox;
+import eve.ui.IWebBrowser;
+import eve.ui.Input;
+import eve.ui.Label;
+import eve.ui.MessageBox;
+import eve.ui.data.Editor;
+import eve.ui.formatted.HtmlDisplay;
+import eve.ui.formatted.StreamImageResolver;
+import eve.util.Tag;
+
+//##################################################################
+public class WebBrowser extends HtmlViewer implements IWebBrowser{
+//##################################################################
+
+/**
+* If you wish to change this, set it to a new value and then call <b>toControls("goTo")</b>
+**/
+public String goTo =
+	//"http://www.ewesoft.com/eve/Downloads/Downloads.html";
+	"http://www.ewesoft.com/eve";
+	//"http://www.ewesoft.com/M2.htm"; 
+	//"http://www.huffingtonpost.com";
+	//"http://localhost/";
+
+//##################################################################
+protected class WebBrowserDisplay extends HtmlViewerDisplay{
+//##################################################################
+
+
+//##################################################################
+}
+//##################################################################
+
+protected Vector history = new Vector();
+protected ComboBox gotoBox;
+
+protected static String clearHistoryText = "Clear History...";
+protected static String HistoryKey = "Ewesoft\\WebBrowser\\History";
+
+//-------------------------------------------------------------------
+protected HtmlDisplay createDisplay()
+//-------------------------------------------------------------------
+{
+	return new WebBrowserDisplay();
+}
+
+//===================================================================
+public WebBrowser()
+//===================================================================
+{
+	this(0);
+}
+//===================================================================
+public WebBrowser(int displayOptions)
+//===================================================================
+{
+	super(null,displayOptions);
+	title = "Web Browser";
+	//
+	// Make sure there are tabs to add to.
+	//
+	if (tabs != null){
+		CellPanel cp = new CellPanel();
+		cp.addNext(new Label("URL:")).setCell(DONTSTRETCH);
+		gotoBox = new ComboBox();
+		gotoBox.actionOnChoiceSelect = true;
+		gotoBox.choice.shortenItems = true;
+		try{
+			Vector v = Io.getStringList(HistoryKey);
+			if (v != null) gotoBox.choice.items.addAll(v);
+		}catch(Exception e){}
+		Input mi = gotoBox.input;
+		mi.wantReturn = true;
+		cp.addNext(addField(gotoBox,"goTo"));
+		cp.addNext(addToolButton("go",loadImage("eve/rightarrowsmall.png"),"Go to URL",false)).setCell(DONTSTRETCH);
+		Card c = tabs.addCard(cp,"Web Document",null);
+		c.iconize("eve/websmall.png");
+	}
+}
+
+//-------------------------------------------------------------------
+protected void newDocumentLoaded(String url)
+//-------------------------------------------------------------------
+{
+	super.newDocumentLoaded(url);
+	goTo = url;
+	toControls("goTo");
+	addToHistory(url);
+}
+/**
+ * Create an HttpConnection object to fetch a web document. By default
+ * this creates and returns as standard HttpConnection object. You can
+ * override this to modify the HttpConnection as you wish.
+ * @param url the url that will be fetched.
+ * @return an HttpConnection object to use.
+ */
+protected HttpConnection getHttpConnection(String url)
+{
+	return new HttpConnection(url);
+}
+
+//-------------------------------------------------------------------
+protected void addPropertiesTo(final PropertyList pl)
+//-------------------------------------------------------------------
+{
+	super.addPropertiesTo(pl);
+	pl.set("imageResolver",new StreamImageResolver(){
+		//-------------------------------------------------------------------
+		protected Tag getStreamFor(String imageName) throws IOException
+		//-------------------------------------------------------------------
+		{
+			try{
+			String root = pl.getString("documentRoot","");
+			String url = null;
+			if (imageName.toLowerCase().startsWith("http://"))
+				url = imageName;
+			else if(root.toLowerCase().startsWith("http://"))
+				url = toFullURL(root,imageName);
+			if (url != null){
+				//ewe.sys.Vm.debug("Fetching: "+url);
+				HttpConnection ht = getHttpConnection(url);//root+"/"+imageName);
+				while(true){
+					Socket sock = ht.connect();
+					HttpConnection r = ht.redirectTo();
+					if (r != ht){
+						ht = r;
+						sock.close();
+						continue;
+					}
+					Tag t = new Tag();
+					t.value = ht.getInputStream();//sock;
+					t.tag = ht.documentProperties.getInt("content-length",-1);
+					return t;
+				}
+			}else{
+				File f = File.getNewFile(root).getChild(imageName);
+				if (f.canRead()) {
+					Tag t = new Tag();
+					t.value = f.toReadableStream();
+					t.tag = (int)f.getLength();
+					return t;
+				}
+			}
+				throw new IOException("Can't get: "+imageName);
+			}catch(IOException e){
+				//e.printStackTrace();
+				throw e;
+			}
+		}
+	});
+}
+
+//-------------------------------------------------------------------
+protected String toFullURL(String root,String document)
+//-------------------------------------------------------------------
+{
+	String ret = super.toFullURL(root,document);
+	if (ret != null) return ret;
+	if (document.startsWith("/")){
+		HttpConnection hr = new HttpConnection(root);
+		hr.document = document;
+		return hr.toURLString();
+	}
+	try{
+		HttpConnection hr = new HttpConnection(document.indexOf(':') == -1 ? root+"/"+document : document);
+		return hr.toURLString();
+	}catch(Exception e){
+		return null;
+	}
+}
+
+//===================================================================
+public Handle openWebDocument(final String url,final PropertyList pl)
+//===================================================================
+{
+	try{
+		return new Task(){
+			protected void doRun(){
+				Handle handle = this;
+				try{
+					String curUrl = url;
+					HttpConnection hr = getHttpConnection(curUrl);
+					while(true){
+						String d = hr.document;
+						int where = d.lastIndexOf('/');
+						if (where != -1) d = d.substring(0,where);
+						pl.set("documentRoot","http://"+hr.host+":"+hr.port+d);
+						pl.set("document",curUrl);
+						Handle h = hr.connectAsync();
+						if (!waitOnSuccess(h,TimeOut.Forever,true)) return;
+						Socket s = (Socket)h.returnValue;
+						HttpConnection redir = hr.redirectTo();
+						if (redir != hr){
+							s.close();
+							hr = redir;
+							curUrl = redir.toURLString();
+							continue;
+						}
+						pl.add(hr.documentProperties);
+						h = hr.readInData(s);
+						//h = ewe.io.StreamUtils.readAllBytes(hr.getInputStream(),null,hr.contentLength,0);
+						if (!waitOnSuccess(h,TimeOut.Forever,true)) return;
+						handle.returnValue = h.returnValue;
+						handle.set(Handle.Succeeded);
+						return;
+					}
+				}catch(Exception e){
+					handle.fail(e);
+				}
+			}
+		}.start();
+	}catch(Exception e){
+		return new Handle(Handle.Failed,null);
+	}
+}
+
+//-------------------------------------------------------------------
+protected Handle openDocument(String url,PropertyList pl)
+//-------------------------------------------------------------------
+{
+	Handle h = super.openDocument(url,pl);
+	if ((h.check() & h.Failure) == 0) return h;
+	return openWebDocument(url,pl);
+}
+
+/**
+* The maximum number of URLs to save in the history. By default it is 10.
+**/
+public static int MaxHistory = 10;
+
+//===================================================================
+public void addToHistory(String url)
+//===================================================================
+{
+	if (gotoBox == null) return;
+	Vector v = gotoBox.choice.items;
+	if (MaxHistory != 0){
+		for (int i = 0; i<v.size(); i++)
+			if (v.get(i).toString().equalsIgnoreCase(url))
+				return;
+		if (v.size() == 0) v.add(clearHistoryText);
+		v.insertElementAt(url,1);
+		while(v.size() > MaxHistory+1){
+			String was = v.get(v.size()-1).toString();
+			removeCached(was);
+			v.removeElementAt(v.size()-1);
+		}
+	}
+	try{
+		Io.saveStringList(v,HistoryKey,0);
+	}catch(Exception e){}
+}
+
+//===================================================================
+public void clearHistory()
+//===================================================================
+{
+	Vector v = gotoBox.choice.items;
+	v.clear();
+	try{
+		Io.saveStringList(v,"Ewesoft\\WebBrowser\\History",0);
+	}catch(Exception e){}
+}
+//===================================================================
+public void action(String fieldName, Editor ed)
+//===================================================================
+{
+	if (fieldName.equals("goTo") || fieldName.equals("go")){
+		if (goTo.equals(clearHistoryText)){
+			if (new MessageBox("Clear History","Clear your history?",MBYESNO).execute() == IDYES)
+				clearHistory();
+			goTo = getCurrentURL();
+			if (goTo == null) goTo = "";
+			ed.toControls("goTo");
+			return;
+		}
+		doOpen(goTo);		
+	}else super.action(fieldName,ed);
+}
+//===================================================================
+public static HtmlViewer openAndDisplay(String url,boolean execute)
+//===================================================================
+{
+	HtmlViewer np = new WebBrowser();
+	if (url != null) np.doOpen(url);
+	if (execute) np.exec();
+	else np.show();
+	return np;
+}
+//===================================================================
+public static void main(String args[])
+//===================================================================
+{
+	Application.startApplication(args);
+	String toOpen = null;
+	if (args.length != 0) toOpen = args[0];
+	HtmlViewer np = openAndDisplay(toOpen,false);
+	np.exitSystemOnClose = true;
+}
+//===================================================================
+public boolean showFor(String url, boolean execModal)
+//===================================================================
+{
+	if (url != null) doOpen(url);
+	if (execModal) exec();
+	else show();
+	return true;
+}
+//===================================================================
+public static HtmlViewer openAndDisplay(String url,int displayOptions,boolean execute)
+//===================================================================
+{
+	WebBrowser np = new WebBrowser(displayOptions);
+	np.showFor(url,execute);
+	return np;
+}
+
+//##################################################################
+}
+//##################################################################
+



From engywuck at mail.berlios.de  Sun Feb  1 12:47:49 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 1 Feb 2009 12:47:49 +0100
Subject: [Cachewolf-svn] r1608 - experiments/EVEhist/resources
Message-ID: <200902011147.n11BlnGe013708@sheep.berlios.de>

Author: engywuck
Date: 2009-02-01 12:47:39 +0100 (Sun, 01 Feb 2009)
New Revision: 1608

Added:
   experiments/EVEhist/resources/date_time_vga.png
Removed:
   experiments/EVEhist/resources/date_time_vga.gif
Log:
Renaming date_time_vga.gif to png. (As in Rev. 1567)

Deleted: experiments/EVEhist/resources/date_time_vga.gif
===================================================================
(Binary files differ)

Copied: experiments/EVEhist/resources/date_time_vga.png (from rev 1606, experiments/EVEhist/resources/date_time_vga.gif)


Property changes on: experiments/EVEhist/resources/date_time_vga.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 



From engywuck at mail.berlios.de  Sun Feb  1 14:39:35 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 1 Feb 2009 14:39:35 +0100
Subject: [Cachewolf-svn] r1609 - experiments/EVEhist/src/cachewolf
Message-ID: <200902011339.n11DdZsT026492@sheep.berlios.de>

Author: engywuck
Date: 2009-02-01 14:39:34 +0100 (Sun, 01 Feb 2009)
New Revision: 1609

Modified:
   experiments/EVEhist/src/cachewolf/DescriptionPanel.java
Log:
Displaying cache description even if "Display Images in Description" is false.

Modified: experiments/EVEhist/src/cachewolf/DescriptionPanel.java
===================================================================
--- experiments/EVEhist/src/cachewolf/DescriptionPanel.java	2009-02-01 11:47:39 UTC (rev 1608)
+++ experiments/EVEhist/src/cachewolf/DescriptionPanel.java	2009-02-01 13:39:34 UTC (rev 1609)
@@ -93,6 +93,8 @@
 					}
 					if (start>=0) s.append(desc.substring(start));
 					newDesc=s.toString(); // Don't store in desc as this could modify chD
+				} else {
+					newDesc = desc;
 				}
 				if (chD.hasImageInfo()) {
 					newDesc+=getPicDesc(imageNo,chD);
@@ -103,6 +105,7 @@
 				disp.addHtml(newDesc,new eve.sys.Handle());
 				tm=disp.endHtml();
 				
+				
 			}
 			else {
 				disp.startHtml(); // To clear the old HTML display



From salzkammergut at mail.berlios.de  Sun Feb  1 16:25:57 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Feb 2009 16:25:57 +0100
Subject: [Cachewolf-svn] r1610 - experiments/EVEhist/src/cachewolf
Message-ID: <200902011525.n11FPvFp007434@sheep.berlios.de>

Author: salzkammergut
Date: 2009-02-01 16:25:54 +0100 (Sun, 01 Feb 2009)
New Revision: 1610

Modified:
   experiments/EVEhist/src/cachewolf/PreferencesScreen.java
Log:
Preferences: Replaced Frames with Cellpanels to get checkboxes to work.

Modified: experiments/EVEhist/src/cachewolf/PreferencesScreen.java
===================================================================
--- experiments/EVEhist/src/cachewolf/PreferencesScreen.java	2009-02-01 13:39:34 UTC (rev 1609)
+++ experiments/EVEhist/src/cachewolf/PreferencesScreen.java	2009-02-01 15:25:54 UTC (rev 1610)
@@ -76,18 +76,18 @@
             /////////////////////////////////////////////////////////
             // First panel - General
             /////////////////////////////////////////////////////////
-            Frame frmDataDir=new Frame();
-            frmDataDir.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_BOTTOM;
-            frmDataDir.addNext(new Label(MyLocale.getMsg(603,"Data Directory:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+            CellPanel pnlDataDir=new CellPanel();
+            pnlDataDir.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_BOTTOM;
+            pnlDataDir.addNext(new Label(MyLocale.getMsg(603,"Data Directory:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
             //frmDataDir.setTag(TAG_INSETS,new Insets(10,10,10,10));
-            frmDataDir.addLast(brwBt = new Button(MyLocale.getMsg(604,"Browse")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.EAST));
+            pnlDataDir.addLast(brwBt = new Button(MyLocale.getMsg(604,"Browse")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.EAST));
             DataDir = new Input();
             DataDir.setText(pref.baseDir);
-            frmDataDir.addLast(DataDir.setTag(CellConstants.TAG_SPAN, new Dimension(3,1)),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
-            frmDataDir.addLast(chkAutoLoad = new CheckBox(MyLocale.getMsg(629,"Autoload last profile")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+            pnlDataDir.addLast(DataDir.setTag(CellConstants.TAG_SPAN, new Dimension(3,1)),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
+            pnlDataDir.addLast(chkAutoLoad = new CheckBox(MyLocale.getMsg(629,"Autoload last profile")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
             if (pref.autoReloadLastProfile) chkAutoLoad.setState(true);
             chkAutoLoad.setTag(TAG_INSETS,new Insets(0,0,2,0));
-            pnlGeneral.addLast(frmDataDir,HSTRETCH,HFILL);
+            pnlGeneral.addLast(pnlDataDir,HSTRETCH,HFILL);
 
             CellPanel pnlBrowser=new CellPanel();
             pnlBrowser.setTag(TAG_INSETS,new Insets(2,0,0,0));
@@ -130,58 +130,58 @@
             // Second panel - Screen
             /////////////////////////////////////////////////////////
 
-            Frame frmScreen=new Frame();
-            frmScreen.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER;
+            CellPanel pnlView=new CellPanel();
+            pnlView.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER;
             CellPanel pnlScreen=new CellPanel();
             pnlScreen.addNext(new Label(MyLocale.getMsg(625,"Screen (needs restart):")));
             pnlScreen.addNext(new Label("Font"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
             pnlScreen.addLast(fontSize = new Input(),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
             fontSize.maxLength=2;
             fontSize.setPreferredSize(40,-1);
-            frmScreen.addLast(pnlScreen,HSTRETCH,HFILL);
+            pnlView.addLast(pnlScreen,HSTRETCH,HFILL);
             fontSize.setText(Convert.toString(pref.fontSize));
 
-            frmScreen.addLast(chkHasCloseButton=new CheckBox(MyLocale.getMsg(631,"PDA has close Button")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+            pnlView.addLast(chkHasCloseButton=new CheckBox(MyLocale.getMsg(631,"PDA has close Button")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
     //lblTitle.setTag(TAG_INSETS,new Insets(2,0,0,0));
-    chkHasCloseButton.setState(pref.hasCloseButton);
-            frmScreen.addNext(chkMenuAtTop = new CheckBox(MyLocale.getMsg(626,"Menu top")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+            chkHasCloseButton.setState(pref.hasCloseButton);
+            pnlView.addNext(chkMenuAtTop = new CheckBox(MyLocale.getMsg(626,"Menu top")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
             chkMenuAtTop.setTag(TAG_INSETS,new Insets(0,0,2,0));
             chkMenuAtTop.setState(pref.menuAtTop);
-            frmScreen.addNext(chkTabsAtTop = new CheckBox(MyLocale.getMsg(627,"Tabs top")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+            pnlView.addNext(chkTabsAtTop = new CheckBox(MyLocale.getMsg(627,"Tabs top")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
             chkTabsAtTop.setState(pref.tabsAtTop);
             chkTabsAtTop.setTag(TAG_INSETS,new Insets(0,0,2,0));
-            frmScreen.addLast(chkShowStatus = new CheckBox(MyLocale.getMsg(628,"Status")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+            pnlView.addLast(chkShowStatus = new CheckBox(MyLocale.getMsg(628,"Status")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
             chkShowStatus.setState(pref.showStatus);
             chkShowStatus.setTag(TAG_INSETS,new Insets(0,0,2,0));
-            pnlDisplay.addLast(frmScreen,CellConstants.HSTRETCH,CellConstants.FILL);
+            pnlDisplay.addLast(pnlView,CellConstants.HSTRETCH,CellConstants.FILL);
 
-            Frame frmImages=new Frame();
-            frmImages.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_TOP|UIConstants.BF_BOTTOM;
+            CellPanel pnlImages=new CellPanel();
+            pnlImages.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_TOP|UIConstants.BF_BOTTOM;
             //frmImages.addNext(new mLabel(MyLocale.getMsg(623,"Images:")),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-            frmImages.addLast(chkShowDeletedImg = new CheckBox(MyLocale.getMsg(624,"Show deleted images")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+            pnlImages.addLast(chkShowDeletedImg = new CheckBox(MyLocale.getMsg(624,"Show deleted images")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
             chkShowDeletedImg.setTag(TAG_INSETS,new Insets(2,0,0,0));
             if (pref.showDeletedImages) chkShowDeletedImg.setState(true);
             //mLabel dummy;
             //frmImages.addNext(dummy=new mLabel(""),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
             //dummy.setTag(TAG_INSETS,new Insets(0,0,2,0));
-            frmImages.addLast(chkDescShowImg = new CheckBox(MyLocale.getMsg(638,"Show pictures in description")),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
+            pnlImages.addLast(chkDescShowImg = new CheckBox(MyLocale.getMsg(638,"Show pictures in description")),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
             chkDescShowImg.setTag(TAG_INSETS,new Insets(0,0,2,0));
             if (pref.descShowImg) chkDescShowImg.setState(true);
-            pnlDisplay.addLast(frmImages,CellConstants.STRETCH,CellConstants.FILL);
+            pnlDisplay.addLast(pnlImages,CellConstants.STRETCH,CellConstants.FILL);
 
-            Frame frmHintLog=new Frame();
+            CellPanel pnlHintLog=new CellPanel();
             //frmHintLog.borderStyle=CellPanel.BDR_RAISEDOUTER|CellPanel.BDR_SUNKENINNER|CellPanel.BF_BOTTOM;
-            frmHintLog.addNext(new Label(MyLocale.getMsg(630,"HintLogPanel:  Logs per page ")),CellConstants.DONTSTRETCH,CellConstants.DONTFILL);
-            frmHintLog.addLast(inpLogsPerPage=new Input(),CellConstants.DONTSTRETCH,CellConstants.DONTFILL|CellConstants.EAST);
+            pnlHintLog.addNext(new Label(MyLocale.getMsg(630,"HintLogPanel:  Logs per page ")),CellConstants.DONTSTRETCH,CellConstants.DONTFILL);
+            pnlHintLog.addLast(inpLogsPerPage=new Input(),CellConstants.DONTSTRETCH,CellConstants.DONTFILL|CellConstants.EAST);
             inpLogsPerPage.setText(Convert.toString(pref.logsPerPage));
             inpLogsPerPage.setPreferredSize(40,-1);
             //inpLogsPerPage.setTag(TAG_INSETS,new Insets(0,0,2,0));
             //lblHlP.setTag(TAG_INSETS,new Insets(6,0,2,0));
-            frmHintLog.addNext(new Label(MyLocale.getMsg(633,"Max. logs to spider")),CellConstants.DONTSTRETCH,CellConstants.DONTFILL);
-            frmHintLog.addLast(inpMaxLogsToSpider=new Input(),CellConstants.DONTSTRETCH,CellConstants.DONTFILL|CellConstants.EAST);
+            pnlHintLog.addNext(new Label(MyLocale.getMsg(633,"Max. logs to spider")),CellConstants.DONTSTRETCH,CellConstants.DONTFILL);
+            pnlHintLog.addLast(inpMaxLogsToSpider=new Input(),CellConstants.DONTSTRETCH,CellConstants.DONTFILL|CellConstants.EAST);
             inpMaxLogsToSpider.setText(Convert.toString(pref.maxLogsToSpider));
             inpMaxLogsToSpider.setPreferredSize(40,-1);
-            pnlDisplay.addLast(frmHintLog,CellConstants.STRETCH,CellConstants.FILL);
+            pnlDisplay.addLast(pnlHintLog,CellConstants.STRETCH,CellConstants.FILL);
 
             /////////////////////////////////////////////////////////
             // Third panel - More



From salzkammergut at mail.berlios.de  Sun Feb  1 16:35:10 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Feb 2009 16:35:10 +0100
Subject: [Cachewolf-svn] r1611 - experiments/EVEhist/src/cachewolf
Message-ID: <200902011535.n11FZA0u010033@sheep.berlios.de>

Author: salzkammergut
Date: 2009-02-01 16:35:03 +0100 (Sun, 01 Feb 2009)
New Revision: 1611

Modified:
   experiments/EVEhist/src/cachewolf/CacheHolderDetail.java
   experiments/EVEhist/src/cachewolf/Profile.java
   experiments/EVEhist/src/cachewolf/RadarPanel.java
Log:
Removed some debugging code

Modified: experiments/EVEhist/src/cachewolf/CacheHolderDetail.java
===================================================================
--- experiments/EVEhist/src/cachewolf/CacheHolderDetail.java	2009-02-01 15:25:54 UTC (rev 1610)
+++ experiments/EVEhist/src/cachewolf/CacheHolderDetail.java	2009-02-01 15:35:03 UTC (rev 1611)
@@ -33,10 +33,10 @@
 	  //public String Bugs = EMPTY; Superceded by Travelbugs
 	  public String URL = EMPTY;
 	  public String solver = EMPTY;
-	  /** For faster cache import (from opencaching) changes are only written when the details are freed from memory 
-	   * If you want to save the changes automatically when the details are unloaded, set this to true */ 
+	  /** For faster cache import (from opencaching) changes are only written when the details are freed from memory
+	   * If you want to save the changes automatically when the details are unloaded, set this to true */
 	  public boolean hasUnsavedChanges = false;
-	  
+
 	 public CacheHolderDetail() {
 	 }
 	 //public CacheHolderDetail(String wpt) {super(wpt); }
@@ -49,7 +49,7 @@
 	 	else if (!stripControlChars(this.longDescription).equals(stripControlChars(longDescription))) is_update=true;
 	 	this.longDescription = longDescription;
 	 }
-	 
+
 	 private String stripControlChars(String desc) {
 		 StringBuffer sb=new StringBuffer(desc.length());
 		 for (int i=0; i<desc.length(); i++) {
@@ -58,12 +58,12 @@
 		 }
 		 return sb.toString();
 	 }
-	 
+
 	 public void setHints(String hints) {
 	 	if (!this.hints.equals(hints)) is_update=true;
 	 	this.hints = hints;
 	 }
-	 
+
 	 public void setCacheLogs(LogList newLogs) {
 		 int size=newLogs.size();
 		 for (int i=size-1; i>=0; i--) { // Loop over all new logs, must start with oldest log
@@ -73,7 +73,7 @@
 		 noFindLogs=cacheLogs.countNotFoundLogs();
 	 }
 
-	 
+
 	  /**
 	 * Method to update an existing cache with new data. This is
 	 * necessary to avoid missing old logs. Called from GPX Importer
@@ -89,26 +89,26 @@
 		  //  we need to check whether the travelbug is already in the existing list
 		  this.has_bug = newCh.travelbugs.size()>0;
 		  for (int i=newCh.travelbugs.size()-1; i>=0; i--) {
-			 Travelbug tb=newCh.travelbugs.getTB(i);  
+			 Travelbug tb=newCh.travelbugs.getTB(i);
 		     Travelbug oldTB=this.travelbugs.find(tb.getName());
 		     // If the bug is already in the cache, we keep it
 		     if (oldTB!=null)
 		    	 newCh.travelbugs.replace(i,oldTB);
-		    
+
 		  }
 		  this.travelbugs = newCh.travelbugs;
-		  
+
 		  // URL
 		  this.URL = newCh.URL;
-		  
+
 		  setLongDescription(newCh.longDescription);
 		  setHints(newCh.hints);
 		  setCacheLogs(newCh.cacheLogs);
-		  
+
 		  if (newCh.solver.length()>0) this.solver=newCh.solver;
 	 	return this;
 	  }
-	  
+
 	  /**
 	   * Adds a user image to the cache data
 	   * @param profile
@@ -116,7 +116,7 @@
 		public void addUserImage(Profile profile){
 		  File imgFile;
 		  String imgDesc, imgDestName;
-		  
+
 		  //Get Image and description
 			FileChooser fc = new FileChooser(FileChooser.OPEN, profile.dataDir);
 			fc.title="Select image file:";
@@ -126,7 +126,7 @@
 				//Create Destination Filename
 				String ext = imgFile.getFileExt().substring(imgFile.getFileExt().lastIndexOf("."));
 				imgDestName = this.wayPoint + "_U_" + (this.userImages.size()+1) + ext;
-				
+
 				this.userImages.add(imgDestName);
 				this.userImagesText.add(imgDesc);
 				// Copy File
@@ -136,14 +136,13 @@
 			}
 	  }
 
-	  
+
 		/**
 		*	Method to parse a specific cache.xml file.
 		*	It fills information on cache details, hints, logs, notes and
 		*	images.
 		*/
 		public void readCache(String dir) throws IOException{
-eve.sys.Vm.debug("===chD:readDetail: "+wayPoint);
 			String dummy;
 			String filename=dir+wayPoint.toLowerCase()+".xml";
 			if (!new File(filename).exists()) {
@@ -156,19 +155,19 @@
 			in.close();
 			eve.util.CharArray ca=new eve.util.CharArray(buf); ca.setLength(len);
 			String text=(ca).toString();
-			Extractor ex = new Extractor(text, "<DETAILS><![CDATA[", "]]></DETAILS>", 0, true);		
+			Extractor ex = new Extractor(text, "<DETAILS><![CDATA[", "]]></DETAILS>", 0, true);
 			longDescription = ex.findNext();
 			ex = new Extractor(text, "<HINTS><![CDATA[", "]]></HINTS>", 0, true);
 			hints = ex.findNext();
 			// Attributes
 			ex = new Extractor(text,"<ATTRIBUTES>","</ATTRIBUTES>",0,true);
 			attributes.xmlAttributesEnd(ex.findNext());
-			
+
 			ex = new Extractor(text, "<LOGS>","</LOGS>", 0, true);
 			dummy = ex.findNext();
 			cacheLogs.clear();
 			ex = new Extractor(dummy, "<LOG>","</LOG>", 0, true);
-			
+
 			dummy = ex.findNext();
 			while(ex.endOfSearch()==false){
 				cacheLogs.add(new Log(dummy));
@@ -237,7 +236,7 @@
 				travelbugs.addFromHTML(Bugs);
 			} else
 				travelbugs.addFromXML(dummy);
-			
+
 			ex = new Extractor(text, "<URL><![CDATA[", "]]></URL>", 0, true);
 			// if no URL is stored, set default URL (at this time only possible for gc.com)
 			dummy = ex.findNext();
@@ -252,7 +251,7 @@
 			ex = new Extractor(text, "<SOLVER><![CDATA[", "]]></SOLVER>", 0, true);
 			solver=ex.findNext();
 		}
-		
+
 		/**
 		*	Method to save a cache.xml file.
 		*/
@@ -290,7 +289,7 @@
 					  detfile.print(cacheLogs.getLog(i).toXML());
 				  }
 				  detfile.print("</LOGS>\r\n");
-			
+
 				  detfile.print("<NOTES><![CDATA["+cacheNotes+"]]></NOTES>\n");
 				  detfile.print("<IMAGES>");
 				  String stbuf;
@@ -302,7 +301,7 @@
 						stbuf = (String)imagesText.get(i);
 						if (i < iis && imagesInfo.get(i) != null)
 							detfile.print("    <IMGTEXT>"+stbuf+"<DESC>"+imagesInfo.get(i)+"</DESC></IMGTEXT>\n");
-						else 
+						else
 							detfile.print("    <IMGTEXT>"+stbuf+"</IMGTEXT>\n");
 				  }
 				  for(int i = 0;i<logImages.size();i++){
@@ -339,23 +338,23 @@
 			}
 			hasUnsavedChanges = false;
 		}
-		
+
 		/**
 		 * Method for checking if to caches belongs to each other, e.g.
 		 * an additional waypoint belongs to the main cache.
 		 * Works currently only, if the last 4 or 5 chars of the waypoint are
-		 * the same, this is the gc.com way. 
+		 * the same, this is the gc.com way.
 		 * @param ch cache to check
 		 * @return true if there is a relation, false otherwise
 		 */
 /*		public boolean belongsTo (CacheHolder ch) {
-			
+
 			// avoid self referencing
 			if (this.wayPoint.equals(ch.wayPoint)) return false;
 
 			return this.wayPoint.endsWith(ch.wayPoint.substring(2));
 		}
-*/		
+*/
 		/**
 		 * Return true if this cache has additional info for some pictures
 		 * @return true if cache has additional info, false otherwise
@@ -366,8 +365,8 @@
 			return false;
 		}
 
-		
 
+
 //	   public void finalize() {
 //		   super.finalize();
 //		   Vm.debug("Destroying CacheHolder "+wayPoint);

Modified: experiments/EVEhist/src/cachewolf/Profile.java
===================================================================
--- experiments/EVEhist/src/cachewolf/Profile.java	2009-02-01 15:25:54 UTC (rev 1610)
+++ experiments/EVEhist/src/cachewolf/Profile.java	2009-02-01 15:35:03 UTC (rev 1611)
@@ -195,8 +195,8 @@
 	 *  Saves the index with the filter settings from Filter
 	 */
 	public void saveIndex(boolean showprogress) {
-		eve.util.OperationTimer ot=new eve.util.OperationTimer();
-		ot.start("SAVEINDEX");
+		//eve.util.OperationTimer ot=new eve.util.OperationTimer();
+		//ot.start("SAVEINDEX");
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
 		if(showprogress){
@@ -262,8 +262,8 @@
 			if(showprogress) pbf.exit(0);
 		}
 		hasUnsavedChanges=false;
-		ot.end();
-		eve.sys.Vm.debug(ot.toString());
+		//ot.end();
+		//pref.log(ot.toString());
 	}
 
 	/**

Modified: experiments/EVEhist/src/cachewolf/RadarPanel.java
===================================================================
--- experiments/EVEhist/src/cachewolf/RadarPanel.java	2009-02-01 15:25:54 UTC (rev 1610)
+++ experiments/EVEhist/src/cachewolf/RadarPanel.java	2009-02-01 15:35:03 UTC (rev 1611)
@@ -68,7 +68,7 @@
 		clearRadarPanel();
 		cacheDB=Global.getProfile().cacheDB;
 	}
-	
+
 	public void clearRadarPanel() {
 		int anz = iActP.images.size();
 		for(int i = 0; i<anz;i++){
@@ -78,7 +78,7 @@
 		iActP.refresh();
 		redrawCaches=true;
 	}
-	
+
 	/**
 	* Public method to draw the different caches and the
 	* radar background
@@ -92,7 +92,7 @@
 		drawCircle();
 		iActP.repaintNow();
 	}
-	
+
 	/**
 	* Private method to draw the caches.
 	*/
@@ -118,7 +118,7 @@
 							s=ch.wayPoint;
 						else
 							s=ch.cacheName;
-						if (s.length()>0) { 
+						if (s.length()>0) {
 							int tw;
 							Image img = new Image(tw=fm.getTextWidth(s),fm.getHeight());
 							Graphics g = new Graphics(img);
@@ -135,7 +135,7 @@
 					}
 					Picture imgCache=CacheType.cache2Img(ch.type);
 					// If we have no image for the cache type use a question mark
-					if (imgCache==null) imgCache=CacheType.cachePictures[8]; 
+					if (imgCache==null) imgCache=CacheType.cachePictures[8];
 					rpi = new RadarPanelImage(imgCache);
 					rpi.wayPoint = ch.wayPoint;
 					rpi.rownum = i;
@@ -145,12 +145,12 @@
 			}// if is_black...
 		}
 	}
-	
+
 	public void removeCircle() {
 		if (circle!=null) iActP.removeImage(circle);
-		circle=null; 
+		circle=null;
 	}
-	
+
 	private void drawCircle() {
 		removeCircle();
 		double pi180=java.lang.Math.PI / 180.0;
@@ -168,7 +168,7 @@
 			circle = new AniImage(imgCircle,Color.Black);
 			circle.properties = eve.fx.Drawing.IsNotHot;
 			circle.setLocation(centerX+x-9,centerY+y-9);
-			iActP.addImage(circle); 
+			iActP.addImage(circle);
 		}
 	}
 	/**
@@ -187,8 +187,8 @@
 		g.setColor(Color.Black);
 		//Vm.debug(Convert.toString(height));
 		g.fillRect(0,0,width, height);
-		
-		
+
+
 		if(width < height) {
 			scale = (double)scaleKm / (double)height;
 		} else {
@@ -199,7 +199,7 @@
 		//centerY = (int)(centerY-centerY*0.15);
 		g.setColor(GREEN);
 		int radstep= 0, steps=0, radius = 0;
-		
+
 		if(width > height){
 			radstep = (int)(10 / scale);
 			steps = width / radstep;
@@ -221,12 +221,12 @@
 			radius = radstep/5;
 			g.drawEllipse(centerX-radius/2,centerY-radius/2, radius,radius);
 			g.free();
-		}	
+		}
 		AniImage aImg = new AniImage(img);
 		iActP.backgroundImage = img;
 		aImg.refresh();
 	}
-	
+
 	public void onEvent(Event ev){
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if (ev.target == btPlus){
@@ -254,9 +254,9 @@
 		}
 
 	}
-	
+
 	public void resizeTo(int width, int height) {
-		eve.sys.Vm.debug("RadarP: resize: "+width+","+height);
+		//eve.sys.Vm.debug("RadarP: resize: "+width+","+height);
 		iActP.origin.x=(MyLocale.getScreenWidth()-width)/2;
 		iActP.origin.y=(MyLocale.getScreenHeight()- height)/2;
 		repaint();
@@ -266,7 +266,7 @@
 //################################################################################
 //   InteractiveRadarPanel
 //################################################################################
-	
+
 	/**
 	*	This class allows handling of a user click on a cache
 	*	in the radar panel.
@@ -281,28 +281,28 @@
 		String strTerrain=MyLocale.getMsg(1121,"Terr");
 		AniImage imgDrag; // Allows the dragging of the cache into the cachelist
 		boolean canScroll=true;
-		
+
 		private void clearInfo() {
 			removeImage(imgInfo);
 			imgInfo=null;
 			refresh();
 			onImage=null;
 		}
-		
+
 		public void imageClicked(AniImage which, Point pos){
 			long timePenOff=Vm.getTimeStampLong();
 			// If the pen rested more than 500 msec, we only display the info and don't treat it as a click
-			if (timePenOff-timePenOn<500 || !Device.isMobile()) { 
+			if (timePenOff-timePenOn<500 || !Device.isMobile()) {
 				if(which instanceof RadarPanelImage){
 					RadarPanelImage ich = (RadarPanelImage)which;
 					Global.mainTab.clearDetails();
 					Global.mainTab.selectAndActive(ich.rownum);
 				}
 			} else {
-				if (imgInfo!=null) clearInfo(); 
+				if (imgInfo!=null) clearInfo();
 			}
 		}
-		
+
 		public boolean imageMovedOn(AniImage which) {
 			timePenOn=Vm.getTimeStampLong();
 			setFont(font);
@@ -333,12 +333,12 @@
 			imgDrag=which;
 		return true;
 		}
-		
+
 		public boolean imageMovedOff(AniImage which) {
 			clearInfo();
 			return true;
 		}
-		
+
 		public void onPenEvent(PenEvent ev) {
 			super.onPenEvent(ev);
 			if (ev.type==PenEvent.PEN_UP) {
@@ -347,18 +347,18 @@
 				if (isDragging) penReleased(new Point(ev.x,ev.y));
 			}
 		}
-		
+
 	    ///////////////////////////////////////////////////
 		//  Allow the caches to be dragged into a cachelist
 	    ///////////////////////////////////////////////////
-		
+
 		String wayPoint;
-		
+
 		public void startDragging(DragContext dc) {
 			if (!Global.mainForm.cacheListVisible) return;
 			Vector cacheDB=Global.getProfile().cacheDB;
 	//Vm.debug("myIAP startDrag "+dc.start.x+"/"+dc.start.y);
-			int idx=Global.getProfile().getCacheIndex(wayPoint); 
+			int idx=Global.getProfile().getCacheIndex(wayPoint);
 			if (idx>=0) {
 				 CacheHolder ch=(CacheHolder) cacheDB.get(idx);
 				 //wayPoint=ch.wayPoint;
@@ -372,12 +372,12 @@
 			}
 		 }
 
-		 public void stopDragging(DragContext dc) {		 
+		 public void stopDragging(DragContext dc) {
 			canScroll=true;
 		 }
 		 public void draggingStarted(ImageDragContext dc) {}
 		 public void draggingStopped(ImageDragContext dc) {}
-		 
+
 		 public boolean imageBeginDragged(AniImage which,Point pos) {
 			if (!Global.mainForm.cacheListVisible) return false;
 			canScroll=false;
@@ -389,7 +389,7 @@
 				java.util.Vector cacheDB=Global.getProfile().cacheDB;
 				CacheHolder ch=(CacheHolder) cacheDB.get(imgRP.rownum);
 				wayPoint=ch.wayPoint;
-				
+
 				int tw,th;
 				Image img = new Image(tw=fm.getTextWidth(wayPoint)+17,th=fm.getHeight()>15?fm.getHeight():15);
 				Graphics g = new Graphics(img);
@@ -417,13 +417,13 @@
 			 	}
 			 	return super.imageDragged(drag,pos);
 		 }
-		 
+
 		 public boolean imageNotDragged(ImageDragContext drag, Point pos) {
 			if (drag.image!=null) {
 				images.remove(drag.image);
 				drag.image=null;
 				refresh();
-			}			
+			}
 			 Point p = Gui.getPosInParent(this,getWindow(),null);
 			 p.x += drag.curPoint.x-origin.x;
 			 p.y += drag.curPoint.y-origin.y;
@@ -434,9 +434,9 @@
 		    		 ((List) c).makeItemVisible(((List)c).itemsSize()-1);
 		    	 }
 		     }
-			 return false; 
+			 return false;
 		 }
-		 
+
 		 public boolean canScreenScroll() {
 			 return canScroll;
 		 }
@@ -460,12 +460,12 @@
 	public class RadarPanelImage extends AniImage{
 		public String wayPoint = "";
 		public int rownum;
-		
+
 		public RadarPanelImage(Picture i){
 			super(i);
 		}
 	}
-	
-	
 
+
+
 }



From engywuck at mail.berlios.de  Sun Feb  1 18:48:07 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 1 Feb 2009 18:48:07 +0100
Subject: [Cachewolf-svn] r1612 - in experiments/EVEhist: deploy res_noewe
	res_noewe/attributes res_noewe/attributes-big resources
Message-ID: <200902011748.n11Hm7pv017006@sheep.berlios.de>

Author: engywuck
Date: 2009-02-01 18:47:59 +0100 (Sun, 01 Feb 2009)
New Revision: 1612

Added:
   experiments/EVEhist/res_noewe/attributes-big/
   experiments/EVEhist/res_noewe/attributes/
Removed:
   experiments/EVEhist/resources/attributes-big/
   experiments/EVEhist/resources/attributes/
Modified:
   experiments/EVEhist/deploy/cw-eve-pc.enf
   experiments/EVEhist/deploy/cw-eve-pda.enf
Log:
Moving attributes-folder from ressources folder to folder res_noewe, because it seems that this folder needs to be present in cachewolf working directory.

Modified: experiments/EVEhist/deploy/cw-eve-pc.enf
===================================================================
--- experiments/EVEhist/deploy/cw-eve-pc.enf	2009-02-01 15:35:03 UTC (rev 1611)
+++ experiments/EVEhist/deploy/cw-eve-pc.enf	2009-02-01 17:47:59 UTC (rev 1612)
@@ -1 +1 @@
-advancedExes=&command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3Dcachewolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26eves%3D%26extra%3D%26pathToEve%3D\Program%2BFiles\Eve\Eve.exe%26nativeStack%3D0%26vmStack%3D0%26locale%3D%26vmOptions%3D&eveFiles=&targets=eve/data/Property%3Dname%253D%25253DTarget%2526value%253Deve/data/MultiListSelect$SelectedItems%25253D%2525253DExe%2525252B-%2525252BDesktop&createWithPnf=true&eveInfo=outputFile%3D../deploy/cachewolf.eve%26entries%3Dcom/eve/evemaker/EveDirEntry%253Dpath%25253D../bin%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../lib/lib-folder%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../work%252526mask%25253D*.gif;*.png;*.wms;*.cfg%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%26addCommandLine%3Dtrue%26commandLine%3D!
 programName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253Dcachewolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526eves%253D%2526extra%253D%2526pathToEve%253D\Program%252BFiles\Eve\Eve.exe%2526nativeStack%253D0%2526vmStack%253D0%2526locale%253D%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26makeZip%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse%26dontCreateEveInCommandLine%3Dfalse&icon=(Default)&librarySelect=0&exeClasses=2&alwaysShowClassTree=false&debugExternalZips=false&appletWidth=800&appletHeight=600&useResources=true&appletDisplay=0&splashScreens=splashScreens%3Dcom/eve/evemaker/SplashScreen%253DimageFile%25253D../resources/logo.png%252526changeSizeTo%25253Dtrue%252526width%25253D48%252526height%25253D43%252526keepAspect%25253Dtrue%252526trueWidth%25253D48%252526trueHeight%25253D43%26screenTitle%3DSplash%2BScreen&chosenMenuItem!
 =&textEncoderName=UTF-8
+advancedExes=&command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3Dcachewolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26eves%3D%26extra%3D%26pathToEve%3D\Program%2BFiles\Eve\Eve.exe%26nativeStack%3D0%26vmStack%3D0%26locale%3D%26vmOptions%3D&eveFiles=&targets=eve/data/Property%3Dname%253D%25253DTarget%2526value%253Deve/data/MultiListSelect$SelectedItems%25253D%2525253DExe%2525252B-%2525252BDesktop&createWithPnf=true&eveInfo=outputFile%3D../deploy/cachewolf.eve%26entries%3Dcom/eve/evemaker/EveDirEntry%253Dpath%25253D../bin%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../lib/lib-folder%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../resources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%26addCommandLine%3Dtrue%26commandLine%3Dp!
 rogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253Dcachewolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526eves%253D%2526extra%253D%2526pathToEve%253D\Program%252BFiles\Eve\Eve.exe%2526nativeStack%253D0%2526vmStack%253D0%2526locale%253D%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26makeZip%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse%26dontCreateEveInCommandLine%3Dfalse&icon=(Default)&librarySelect=0&exeClasses=2&alwaysShowClassTree=false&debugExternalZips=false&appletWidth=800&appletHeight=600&useResources=true&appletDisplay=0&splashScreens=splashScreens%3Dcom/eve/evemaker/SplashScreen%253DimageFile%25253D../resources/logo.png%252526changeSizeTo%25253Dtrue%252526width%25253D48%252526height%25253D43%252526keepAspect%25253Dtrue%252526trueWidth%25253D48%252526trueHeight%25253D43%26screenTitle%3DSplash%2BScreen&chosenMenuItem=!
 &textEncoderName=UTF-8

Modified: experiments/EVEhist/deploy/cw-eve-pda.enf
===================================================================
--- experiments/EVEhist/deploy/cw-eve-pda.enf	2009-02-01 15:35:03 UTC (rev 1611)
+++ experiments/EVEhist/deploy/cw-eve-pda.enf	2009-02-01 17:47:59 UTC (rev 1612)
@@ -1 +1 @@
-advancedExes=&command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3Dcachewolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26eves%3D%26extra%3D%26pathToEve%3D\Program%2BFiles\Eve\Eve.exe%26nativeStack%3D0%26vmStack%3D0%26locale%3D%26vmOptions%3D&eveFiles=&targets=eve/data/Property%3Dname%253D%25253DTarget%2526value%253Deve/data/MultiListSelect$SelectedItems%25253D%2525253DPocketPC%2525252B2003%2525252BSE%25252526%2525253DPocketPC%2525252BWindows%2525252BMobile%2525252B5%25252526%2525253DPocketPC%2525252BWindows%2525252BMobile%2525252B6&createWithPnf=true&eveInfo=outputFile%3D../deploy/cachewolf.eve%26entries%3Dcom/eve/evemaker/EveDirEntry%253Dpath%25253D../bin%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../lib/lib-folder%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../work%252526!
 mask%25253D*.gif;*.png;*.wms;*.cfg%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253Dcachewolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526eves%253D%2526extra%253D%2526pathToEve%253D\Program%252BFiles\Eve\Eve.exe%2526nativeStack%253D0%2526vmStack%253D0%2526locale%253D%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26makeZip%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse%26dontCreateEveInCommandLine%3Dfalse&icon=(Default)&librarySelect=0&exeClasses=2&alwaysShowClassTree=false&debugExternalZips=false&appletWidth=800&appletHeight=600&useResources=true&appletDisplay=0&splashScreens=splashScreens%3Dcom/eve/evemaker/SplashScreen%253DimageFile%25253D../resources/logo.png%252526changeSizeTo%25253Dtrue%252526width%25253D48%252526heig!
 ht%25253D43%252526keepAspect%25253Dtrue%252526trueWidth%25253D!
 48%25252
6trueHeight%25253D43%26screenTitle%3DSplash%2BScreen&chosenMenuItem=&textEncoderName=UTF-8
+advancedExes=&command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3Dcachewolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26eves%3D%26extra%3D%26pathToEve%3D\Program%2BFiles\Eve\Eve.exe%26nativeStack%3D0%26vmStack%3D0%26locale%3D%26vmOptions%3D&eveFiles=&targets=eve/data/Property%3Dname%253D%25253DTarget%2526value%253Deve/data/MultiListSelect$SelectedItems%25253D%2525253DPocketPC%2525252B2003%2525252BSE%25252526%2525253DPocketPC%2525252BWindows%2525252BMobile%2525252B5%25252526%2525253DPocketPC%2525252BWindows%2525252BMobile%2525252B6&createWithPnf=true&eveInfo=outputFile%3D../deploy/cachewolf.eve%26entries%3Dcom/eve/evemaker/EveDirEntry%253Dpath%25253D../bin%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../lib/lib-folder%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../resources%2!
 52526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253Dcachewolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526eves%253D%2526extra%253D%2526pathToEve%253D\Program%252BFiles\Eve\Eve.exe%2526nativeStack%253D0%2526vmStack%253D0%2526locale%253D%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26makeZip%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse%26dontCreateEveInCommandLine%3Dfalse&icon=(Default)&librarySelect=0&exeClasses=2&alwaysShowClassTree=false&debugExternalZips=false&appletWidth=800&appletHeight=600&useResources=true&appletDisplay=0&splashScreens=splashScreens%3Dcom/eve/evemaker/SplashScreen%253DimageFile%25253D../resources/logo.png%252526changeSizeTo%25253Dtrue%252526width%25253D48%252526heigh!
 t%25253D43%252526keepAspect%25253Dtrue%252526trueWidth%25253D4!
 8%252526
trueHeight%25253D43%26screenTitle%3DSplash%2BScreen&chosenMenuItem=&textEncoderName=UTF-8

Copied: experiments/EVEhist/res_noewe/attributes (from rev 1606, experiments/EVEhist/resources/attributes)


Property changes on: experiments/EVEhist/res_noewe/attributes
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/res_noewe/attributes-big (from rev 1606, experiments/EVEhist/resources/attributes-big)


Property changes on: experiments/EVEhist/res_noewe/attributes-big
___________________________________________________________________
Name: svn:mergeinfo
   + 



From salzkammergut at mail.berlios.de  Sun Feb  1 21:45:21 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Feb 2009 21:45:21 +0100
Subject: [Cachewolf-svn] r1613 - experiments/EVEhist/src/cachewolf
Message-ID: <200902012045.n11KjLhF028114@sheep.berlios.de>

Author: salzkammergut
Date: 2009-02-01 21:45:15 +0100 (Sun, 01 Feb 2009)
New Revision: 1613

Modified:
   experiments/EVEhist/src/cachewolf/MainMenu.java
Log:
SpiderSingle: Bugfix. When re-spidering a single cache with addis, the addis were not listed.

Modified: experiments/EVEhist/src/cachewolf/MainMenu.java
===================================================================
--- experiments/EVEhist/src/cachewolf/MainMenu.java	2009-02-01 17:47:59 UTC (rev 1612)
+++ experiments/EVEhist/src/cachewolf/MainMenu.java	2009-02-01 20:45:15 UTC (rev 1613)
@@ -718,6 +718,7 @@
 		infB.close(0);
 //		profile.hasUnsavedChanges=true;
 		profile.saveIndex(Profile.SHOW_PROGRESS_BAR);
+		profile.buildReferences();
 		profile.restoreFilter(true);
 		//profile.updateBearingDistance();
 		Global.mainTab.tbP.refreshTable();



From salzkammergut at mail.berlios.de  Sun Feb  1 22:33:17 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Feb 2009 22:33:17 +0100
Subject: [Cachewolf-svn] r1614 - experiments/EVEhist/src/cachewolf
Message-ID: <200902012133.n11LXHN6031849@sheep.berlios.de>

Author: salzkammergut
Date: 2009-02-01 22:33:13 +0100 (Sun, 01 Feb 2009)
New Revision: 1614

Modified:
   experiments/EVEhist/src/cachewolf/MainMenu.java
Log:
Spidersingle: Bugfix. Update bearing distances after respidering caches

Modified: experiments/EVEhist/src/cachewolf/MainMenu.java
===================================================================
--- experiments/EVEhist/src/cachewolf/MainMenu.java	2009-02-01 20:45:15 UTC (rev 1613)
+++ experiments/EVEhist/src/cachewolf/MainMenu.java	2009-02-01 21:33:13 UTC (rev 1614)
@@ -664,7 +664,7 @@
 						|| ch.wayPoint.substring(0,2).equalsIgnoreCase("OC")))
 //					if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
 //					Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
-//					Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
+//					Alter code pr???ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
 				{
 					cachesToUpdate.add(new Integer(i));
 				} else {
@@ -720,7 +720,7 @@
 		profile.saveIndex(Profile.SHOW_PROGRESS_BAR);
 		profile.buildReferences();
 		profile.restoreFilter(true);
-		//profile.updateBearingDistance();
+		profile.updateBearingDistance();
 		Global.mainTab.tbP.refreshTable();
 		Form.cancelWait();
 		if ( spiderErrors > 0) {



From engywuck at mail.berlios.de  Sun Feb  1 22:55:27 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 1 Feb 2009 22:55:27 +0100
Subject: [Cachewolf-svn] r1615 - experiments/EVEhist/programs
Message-ID: <200902012155.n11LtRaf000554@sheep.berlios.de>

Author: engywuck
Date: 2009-02-01 22:55:25 +0100 (Sun, 01 Feb 2009)
New Revision: 1615

Modified:
   experiments/EVEhist/programs/getres.bat
   experiments/EVEhist/programs/snapshot.sh
Log:
Scripts changed due to move of attributes directory.

Modified: experiments/EVEhist/programs/getres.bat
===================================================================
--- experiments/EVEhist/programs/getres.bat	2009-02-01 21:33:13 UTC (rev 1614)
+++ experiments/EVEhist/programs/getres.bat	2009-02-01 21:55:25 UTC (rev 1615)
@@ -4,8 +4,6 @@
 mkdir ..\work
 mkdir ..\work\attributes
 mkdir ..\work\attributes-big
-copy ..\resources\attributes\*.gif ..\work\attributes
-copy ..\resources\attributes-big\*.gif ..\work\attributes-big
 copy ..\resources\*.gif ..\work
 copy ..\resources\*.png ..\work
 mkdir ..\work\languages
@@ -13,6 +11,8 @@
 copy ..\res_noewe\languages\*.cfg ..\work\languages
 copy ..\res_noewe\webmapservices\*.wms ..\work\webmapservices
 copy ..\res_noewe\webmapservices\*.txt ..\work\webmapservices
+copy ..\res_noewe\attributes\*.gif ..\work\attributes
+copy ..\res_noewe\attributes-big\*.gif ..\work\attributes-big
 copy ..\res_noewe\*.def ..\work
 copy ..\res_noewe\*.html ..\work
 copy ..\res_noewe\*.png ..\work

Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-01 21:33:13 UTC (rev 1614)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-01 21:55:25 UTC (rev 1615)
@@ -43,8 +43,8 @@
 #printf '1,$g/ 12M/s///\nwq\n' | ed -s published/Jar/CacheWolf.bat
 #install -c -m 644 work/CacheWolf.ewe published/
 #install -c -m 644 res_noewe/* published/dat/
-#install -c -m 644 resources/attributes-big/*.gif published/dat/attributes/
-#install -c -m 644 resources/attributes/*-non.gif published/dat/attributes/
+#install -c -m 644 res_noewe/attributes-big/*.gif published/dat/attributes/
+#install -c -m 644 res_noewe/attributes/*-non.gif published/dat/attributes/
 #install -c -m 644 res_noewe/webmapservices/* published/dat/webmapservices/
 #install -c -m 644 res_noewe/languages/* published/dat/languages/
 #(



From pfeffer at mail.berlios.de  Mon Feb  2 01:12:33 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 2 Feb 2009 01:12:33 +0100
Subject: [Cachewolf-svn] r1616 - experiments/EVEhist/src/cachewolf/navi
Message-ID: <200902020012.n120CXbN024788@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-02 01:12:25 +0100 (Mon, 02 Feb 2009)
New Revision: 1616

Modified:
   experiments/EVEhist/src/cachewolf/navi/Navigate.java
Log:
Eve: Navigate: serial port / GPS works now

Modified: experiments/EVEhist/src/cachewolf/navi/Navigate.java
===================================================================
--- experiments/EVEhist/src/cachewolf/navi/Navigate.java	2009-02-01 21:55:25 UTC (rev 1615)
+++ experiments/EVEhist/src/cachewolf/navi/Navigate.java	2009-02-02 00:12:25 UTC (rev 1616)
@@ -2,6 +2,8 @@
 
 import eve.fx.Color;
 import java.io.IOException;
+import java.io.InputStream;
+
 import eve.io.SerialPort;
 import eve.ui.data.SerialPortOptions;
 import java.net.Socket;
@@ -14,19 +16,20 @@
 import eve.ui.MessageBox;
 import eve.util.mString;
 import eve.sys.Handle;
+import eve.sys.Vm;
 
 /**
- * Non-Gui Class to handle all things regarding navigation
- * (GPS, Sun direction etc.)
- * start offset in localisation file: 4400
+ * Non-Gui Class to handle all things regarding navigation (GPS, Sun direction
+ * etc.) start offset in localisation file: 4400
+ * 
  * @author Pfeffer
- *
+ * 
  */
 public class Navigate {
 	public CWPoint destination = new CWPoint();
 	public CWGPSPoint gpsPos = new CWGPSPoint();
 	public Track curTrack = null;
-	Color trackColor = new Color(255,0,0); // red
+	Color trackColor = new Color(255, 0, 0); // red
 	public CWPoint skyOrientationDir = new CWPoint();
 	public int luminary = SkyOrientation.SUN;
 
@@ -42,58 +45,93 @@
 	public void setGotoPanel(GotoPanel gp) {
 		gotoPanel = gp;
 	}
-	public void setMovingMap (MovingMap mm) {
+
+	public void setMovingMap(MovingMap mm) {
 		movingMap = mm;
-		if (gpsRunning) mm.gpsStarted();
+		if (gpsRunning)
+			mm.gpsStarted();
 	}
 
 	public void startGps(boolean loggingOn, int loggingIntervall) {
 		setRawLogging(loggingOn, loggingIntervall);
-		if (serThread != null) if ((serThread.check() & Handle.Running)!=0) return; // TODO use gpsRunning
+		if (serThread != null)
+			if ((serThread.check() & Handle.Running) != 0)
+				return; // TODO use gpsRunning
 		try {
-			serThread = new SerialThread(pref.mySPO, gpsPos, (pref.forwardGPS ? pref.forwardGpsHost : ""));
+			serThread = new SerialThread(pref.mySPO, gpsPos,
+					(pref.forwardGPS ? pref.forwardGpsHost : ""));
 			if (pref.forwardGPS && !serThread.tcpForward) {
-				(new MessageBox(MyLocale.getMsg(4400, "Warning"),
-						MyLocale.getMsg(4401, "Ignoring error:\n could not forward GPS data to host:\n")
-						+ pref.forwardGpsHost+"\n" + serThread.lastError
-						+ MyLocale.getMsg(4402, "\nstop and start GPS to retry"), MessageBox.OKB)).exec();
+				(new MessageBox(
+						MyLocale.getMsg(4400, "Warning"),
+						MyLocale
+								.getMsg(4401,
+										"Ignoring error:\n could not forward GPS data to host:\n")
+								+ pref.forwardGpsHost
+								+ "\n"
+								+ serThread.lastError
+								+ MyLocale.getMsg(4402,
+										"\nstop and start GPS to retry"),
+						MessageBox.OKB)).exec();
 			}
-			if (gpsPos.latDec == 0 && gpsPos.lonDec == 0) { // TODO use isValid() // TODO raus damit?
-				gpsPos.latDec = destination.latDec; // setze Zielpunkt als Ausgangspunkt
+			if (gpsPos.latDec == 0 && gpsPos.lonDec == 0) { // TODO use
+				// isValid() // TODO
+				// raus damit?
+				gpsPos.latDec = destination.latDec; // setze Zielpunkt als
+				// Ausgangspunkt
 				gpsPos.lonDec = destination.lonDec;
 			}
 			serThread.start();
 			startDisplayTimer();
 			gpsRunning = true;
-			curTrack = new Track(trackColor); // TODO addTrack here to MovingMap? see MovingMapPanel.snapToGps
-			if (lograw)	gpsPos.startLog(Global.getProfile().dataDir, logIntervall, CWGPSPoint.LOGALL);
-			if (gotoPanel != null) gotoPanel.gpsStarted();
-			if (movingMap != null) movingMap.gpsStarted();
+			curTrack = new Track(trackColor); // TODO addTrack here to
+			// MovingMap? see
+			// MovingMapPanel.snapToGps
+			if (lograw)
+				gpsPos.startLog(Global.getProfile().dataDir, logIntervall,
+						CWGPSPoint.LOGALL);
+			if (gotoPanel != null)
+				gotoPanel.gpsStarted();
+			if (movingMap != null)
+				movingMap.gpsStarted();
 		} catch (IOException e) {
-			(new MessageBox(MyLocale.getMsg(4403, "Error"),
-					MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ")
-					+ e.getMessage()
-					+ MyLocale.getMsg(4405, "\npossible reasons:\n Another (GPS-)program is blocking the port\nwrong port\nOn Loox: active infra-red port is blocking GPS"),
+			(new MessageBox(
+					MyLocale.getMsg(4403, "Error"),
+					MyLocale
+							.getMsg(4404,
+									"Could not connect to GPS-receiver.\n Error while opening serial Port ")
+							+ e.getMessage()
+							+ MyLocale
+									.getMsg(
+											4405,
+											"\npossible reasons:\n Another (GPS-)program is blocking the port\nwrong port\nOn Loox: active infra-red port is blocking GPS"),
 					MessageBox.OKB)).execute();
 		} catch (UnsatisfiedLinkError e) {
-			(new MessageBox(MyLocale.getMsg(4403, "Error"),
-					MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ")
-					+ MyLocale.getMsg(4406, "Please copy jave_eve.dll into the directory of the cachewolf program"),
+			(new MessageBox(
+					MyLocale.getMsg(4403, "Error"),
+					MyLocale
+							.getMsg(4404,
+									"Could not connect to GPS-receiver.\n Error while opening serial Port ")
+							+ MyLocale
+									.getMsg(4406,
+											"Please copy jave_eve.dll into the directory of the cachewolf program"),
 					MessageBox.OKB)).execute();
 		}
 	}
 
 	public void setRawLogging(boolean on, int intervall) {
 		lograw = on;
-		logIntervall = intervall; // TODO switch on and off during serthread running
+		logIntervall = intervall; // TODO switch on and off during serthread
+		// running
 	}
+
 	public void startDisplayTimer() {
 		tickerThread = new UpdateThread(this, 1000);
 		tickerThread.start();
 	}
 
-	public void stopDisplayTimer(){
-		if (tickerThread != null) tickerThread.stop();
+	public void stopDisplayTimer() {
+		if (tickerThread != null)
+			tickerThread.stop();
 	}
 
 	public void stopGps() {
@@ -101,89 +139,130 @@
 		stopDisplayTimer();
 		gpsPos.stopLog();
 		gpsRunning = false;
-		if (gotoPanel != null) gotoPanel.gpsStopped();
-		if (movingMap != null) movingMap.gpsStoped();
+		if (gotoPanel != null)
+			gotoPanel.gpsStopped();
+		if (movingMap != null)
+			movingMap.gpsStoped();
 	}
 
 	public boolean isGpsPosValid() {
-		return 	serThread != null && ((serThread.check()&Handle.Running)!=0) && gpsPos.isValid() ; // && gpsPos.getfiex();
+		return serThread != null && ((serThread.check() & Handle.Running) != 0)
+				&& gpsPos.isValid(); // && gpsPos.getfiex();
 
 	}
 
-
 	public void setDestination(String LatLon) {
 		setDestination(new CWPoint(LatLon));
 	}
 
-
 	public void setDestination(CWPoint d) {
-		destination = new CWPoint (d);
-		if (gotoPanel != null) gotoPanel.destChanged(destination);
-		if (movingMap != null) movingMap.destChanged(destination);
+		destination = new CWPoint(d);
+		if (gotoPanel != null)
+			gotoPanel.destChanged(destination);
+		if (movingMap != null)
+			movingMap.destChanged(destination);
 	}
+
 	/**
 	 * use the constants SkyOrientation.SUN, SkyOrientation.MOON etc.
+	 * 
 	 * @param lu
 	 */
 	public void setLuminary(int lu) {
 		luminary = lu;
 	}
+
 	public void ticked() {
 		int fix = gpsPos.getFix();
-		if (fix > 0 && (gpsPos.getSats()>= 0)) {
-			//gpsPosition.printAll();
-			//Vm.debug("currTrack.add: before");
-			if (curTrack == null) curTrack = new Track(trackColor);
+		if (fix > 0 && (gpsPos.getSats() >= 0)) {
+			// gpsPosition.printAll();
+			// Vm.debug("currTrack.add: before");
+			if (curTrack == null)
+				curTrack = new Track(trackColor);
 			try {
 				curTrack.add(gpsPos);
-			} catch (IndexOutOfBoundsException e) { // track full -> create a new one
+			} catch (IndexOutOfBoundsException e) { // track full -> create a
+				// new one
 				curTrack = new Track(trackColor);
 				curTrack.add(gpsPos);
-				if (movingMap != null) movingMap.addTrack(curTrack); // TODO maybe gotoPanel should also hold a list of Tracks, because otherwise they will be destroyed if not saved in mmp before
+				if (movingMap != null)
+					movingMap.addTrack(curTrack); // TODO maybe gotoPanel should
+				// also hold a list of
+				// Tracks, because otherwise
+				// they will be destroyed if
+				// not saved in mmp before
 			}
 			try {
-				SkyOrientation.getSunAzimut(gpsPos.time, gpsPos.date, gpsPos.latDec, gpsPos.lonDec);
-				double jd = SkyOrientation.utc2juliandate(gpsPos.time, gpsPos.date);
-				skyOrientationDir = SkyOrientation.getLuminaryDir(luminary, jd, gpsPos);
-				// eve.sys.Vm.debug("neu: "+ skyOrientationDir.lonDec+ "jd: " + jd);
-			} catch (NumberFormatException e) { // irgendeine Info zu Berechnung des Sonnenaziumt fehlt (insbesondere Datum und Uhrzeit sind nicht unbedingt gleichzeitig verf?gbar wenn es einen Fix gibt)
-				skyOrientationDir.set(-361, -361); // any value out of range (bigger than 360) will prevent drawArrows from drawing it
+				SkyOrientation.getSunAzimut(gpsPos.time, gpsPos.date,
+						gpsPos.latDec, gpsPos.lonDec);
+				double jd = SkyOrientation.utc2juliandate(gpsPos.time,
+						gpsPos.date);
+				skyOrientationDir = SkyOrientation.getLuminaryDir(luminary, jd,
+						gpsPos);
+				// eve.sys.Vm.debug("neu: "+ skyOrientationDir.lonDec+ "jd: " +
+				// jd);
+			} catch (NumberFormatException e) { // irgendeine Info zu Berechnung
+				// des Sonnenaziumt fehlt
+				// (insbesondere Datum und
+				// Uhrzeit sind nicht unbedingt
+				// gleichzeitig verf?gbar wenn
+				// es einen Fix gibt)
+				skyOrientationDir.set(-361, -361); // any value out of range
+				// (bigger than 360) will
+				// prevent drawArrows from
+				// drawing it
 			}
 
 		} else {
-			skyOrientationDir.set(-361, -361); // any value out of range (bigger than 360) will prevent drawArrows from drawing it
+			skyOrientationDir.set(-361, -361); // any value out of range (bigger
+			// than 360) will prevent
+			// drawArrows from drawing it
 		}
 		gotoPanel.updateGps(fix);
-		if (movingMap != null) movingMap.updateGps(fix);
+		if (movingMap != null)
+			movingMap.updateGps(fix);
 	}
 }
 
 /**
  * Thread for reading data from COM-port
- *
+ * 
  */
-class SerialThread extends eve.sys.Task{
+class SerialThread extends eve.sys.Task {
 	SerialPort comSp;
-	byte[] comBuff = new byte[1024*10]; // when some action takes a long time (eg. loading or zooming a map), a lot of data can be in the buffer, read that at once
+	InputStream serStream;
+	byte[] comBuff = new byte[1024 * 10]; // when some action takes a long time
+	// (eg. loading or zooming a map), a
+	// lot of data can be in the buffer,
+	// read that at once
 	int comLength = 0;
 	CWGPSPoint myGPS;
 	boolean run, tcpForward;
 	Socket tcpConn;
 	String lastError = "";
 
-	public SerialThread(SerialPortOptions spo, CWGPSPoint GPSPoint, String forwardIP) throws IOException {
-		try{
-			spo.portName = cachewolf.utils.Common.fixSerialPortName(spo.portName);
+	public SerialThread(SerialPortOptions spo, CWGPSPoint GPSPoint,
+			String forwardIP) throws IOException {
+		try {
+			spo.portName = cachewolf.utils.Common
+					.fixSerialPortName(spo.portName);
 			comSp = new SerialPort(spo);
+			serStream = comSp.getInputStream();
 		} catch (IOException e) {
 			throw new IOException(spo.portName);
-		} // catch (UnsatisfiedLinkError e) {} // TODO in original java-vm
-		if (forwardIP.length()>0) {
+		} catch (UnsatisfiedLinkError e) {
+			Vm.debug("UnsatisfiedLinkError");
+		} // TODO in original java-vm
+		if (forwardIP.length() > 0) {
 			try {
 				tcpConn = new Socket(forwardIP, 23);
 				tcpForward = true;
-			} catch (java.net.UnknownHostException e) { tcpForward = false; lastError = e.getMessage();
-			} catch (IOException e) { tcpForward = false; lastError = e.getMessage();
+			} catch (java.net.UnknownHostException e) {
+				tcpForward = false;
+				lastError = e.getMessage();
+			} catch (IOException e) {
+				tcpForward = false;
+				lastError = e.getMessage();
 			}
 		}
 		myGPS = GPSPoint;
@@ -193,46 +272,72 @@
 		int noData = 0;
 		int notinterpreted = 0;
 		run = true;
-		while (run){
+		try {
+			while (run) {
 				sleep(1000);
-				//Vm.debug("Loop? " + noData);
+				// Vm.debug("Loop? " + noData);
 				noData++;
-				if (noData > 5) { myGPS.noDataError(); }
-			if (comSp != null)	{
-//TODO Activate				comLength = comSp.nonBlockingRead(comBuff, 0 ,comBuff.length);
-				//Vm.debug("Length: " + comBuff.length);
-				if (comLength > 0)	{
-					noData = 0;
-					String str = mString.fromAscii(comBuff, 0, comLength);
-					if (tcpForward) {
-						try {
-							tcpConn.getOutputStream().write(comBuff, 0, comLength);
-						} catch (IOException e) { tcpForward = false; }
+				if (noData > 5) {
+					myGPS.noDataError();
+				}
+				if (comSp != null) {
+					comLength = serStream.read(comBuff, 0, comBuff.length);
+					// Vm.debug("Length: " + comBuff.length);
+					if (comLength > 0) {
+						noData = 0;
+						String str = mString.fromAscii(comBuff, 0, comLength);
+						if (tcpForward) {
+							try {
+								tcpConn.getOutputStream().write(comBuff, 0,
+										comLength);
+							} catch (IOException e) {
+								tcpForward = false;
+							}
+						}
+						// Vm.debug(str);
+						if (myGPS.examine(str))
+							notinterpreted = 0;
+						else
+							notinterpreted++;
+						if (notinterpreted > 22)
+							myGPS.noInterpretableData();
 					}
-					//Vm.debug(str);
-					if (myGPS.examine(str)) notinterpreted = 0; else notinterpreted++;
-					if (notinterpreted > 22) myGPS.noInterpretableData();
 				}
-			}
-		} // while
+			} // while
+		} catch (IOException e1) {
+			e1.printStackTrace(); // TODO report orderly
+		}
 		myGPS.noData();
 		try {
 			tcpConn.close();
-		} catch (Exception ex) {};
+		} catch (Exception ex) {
+		}
+		;
 	}
 
 	public void stop() {
 		try {
 			run = false;
-			if (comSp != null) comSp.close();
-		} catch(IOException ex) {}
+			if (comSp != null)
+				if (comSp != null) {
+					try {
+						comSp.shutdownInput();
+					} catch (IOException e) {
+						if (!e.getMessage().equalsIgnoreCase("already closed!"))
+							e.printStackTrace(); // TODO report orderly "error trying to close serial port"
+					}
+				}
+			comSp.close();
+		} catch (IOException ex) {
+		}
 	}
 }
 
 /**
- * Class for creating a new mThread to create timer ticks to be able to do form.close in the ticked-thread.
- * Using the Vm.requestTimer-Method causes "eve.sys.EventDirectionException: This task cannot be done within
- * a Timer Tick." in the eve-vm when form.close is called.
+ * Class for creating a new mThread to create timer ticks to be able to do
+ * form.close in the ticked-thread. Using the Vm.requestTimer-Method causes
+ * "eve.sys.EventDirectionException: This task cannot be done within a Timer
+ * Tick." in the eve-vm when form.close is called.
  */
 
 class UpdateThread extends eve.sys.Task {
@@ -240,15 +345,15 @@
 	public int calldelay;
 	public Navigate ticked;
 
-	public UpdateThread (Navigate gp, int cd) {
+	public UpdateThread(Navigate gp, int cd) {
 		ticked = gp;
 		calldelay = cd;
 	}
 
-	public void doRun () {
+	public void doRun() {
 		run = true;
 		while (run) {
-			sleep (calldelay);
+			sleep(calldelay);
 			ticked.ticked();
 		}
 	}
@@ -257,4 +362,3 @@
 		run = false;
 	}
 }
-



From engywuck at mail.berlios.de  Mon Feb  2 14:19:29 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Mon, 2 Feb 2009 14:19:29 +0100
Subject: [Cachewolf-svn] r1617 - experiments/EVEhist/programs
Message-ID: <200902021319.n12DJTBH014685@sheep.berlios.de>

Author: engywuck
Date: 2009-02-02 14:19:28 +0100 (Mon, 02 Feb 2009)
New Revision: 1617

Added:
   experiments/EVEhist/programs/compile.cmd
Log:
Adding compile script. Sorry, only Windows version ;-)

Added: experiments/EVEhist/programs/compile.cmd
===================================================================
--- experiments/EVEhist/programs/compile.cmd	2009-02-02 00:12:25 UTC (rev 1616)
+++ experiments/EVEhist/programs/compile.cmd	2009-02-02 13:19:28 UTC (rev 1617)
@@ -0,0 +1,11 @@
+cd %~d0%~p0
+cd ..
+javac -source 1.3 -target 1.1 -encoding windows-1252 -cp lib/CompileEve.zip;lib/lib-folder ^
+  -d bin -deprecation -nowarn src/cachewolf/*.java src/cachewolf/exp/*.java ^
+  src/cachewolf/imp/*.java src/cachewolf/navi/*.java src/cachewolf/utils/*.java ^
+  src/eve/ui/formatted/*.java src/eve/ui/formatted/data/*.java 
+rmdir /s /q bin\com > NUL
+rmdir /s /q bin\ewesoft > NUL
+rmdir /s /q bin\HTML > NUL
+
+pause



From engywuck at mail.berlios.de  Mon Feb  2 19:34:32 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Mon, 2 Feb 2009 19:34:32 +0100
Subject: [Cachewolf-svn] r1618 - in experiments/EVEhist: . programs
Message-ID: <200902021834.n12IYWmo000172@sheep.berlios.de>

Author: engywuck
Date: 2009-02-02 19:34:23 +0100 (Mon, 02 Feb 2009)
New Revision: 1618

Added:
   experiments/EVEhist/programs/getres.sh
Removed:
   experiments/EVEhist/getres.sh
Log:
Adaption for moved attributes folder. And moved to programs directory. I hope I didn't break the line endings...

Deleted: experiments/EVEhist/getres.sh
===================================================================
--- experiments/EVEhist/getres.sh	2009-02-02 13:19:28 UTC (rev 1617)
+++ experiments/EVEhist/getres.sh	2009-02-02 18:34:23 UTC (rev 1618)
@@ -1,16 +0,0 @@
-#!/bin/sh
-mkdir -p work/attributes work/attributes-big \
-    work/languages work/webmapservices
-cp resources/attributes/*.gif work/attributes/
-cp resources/attributes-big/*.gif work/attributes-big/
-cp resources/*.gif work/
-cp resources/*.png work/
-cp res_noewe/languages/*.cfg work/languages/
-cp res_noewe/webmapservices/*.wms work/webmapservices/
-cp res_noewe/webmapservices/*.txt work/webmapservices/
-cp res_noewe/*.def work/
-cp res_noewe/*.html work/
-cp res_noewe/*.png work/
-cp res_noewe/*.gif work/
-cp res_noewe/*.tpl work/
-cp res_noewe/*.zip work/

Copied: experiments/EVEhist/programs/getres.sh (from rev 1617, experiments/EVEhist/getres.sh)
===================================================================
--- experiments/EVEhist/getres.sh	2009-02-02 13:19:28 UTC (rev 1617)
+++ experiments/EVEhist/programs/getres.sh	2009-02-02 18:34:23 UTC (rev 1618)
@@ -0,0 +1,16 @@
+#!/bin/sh
+mkdir -p work/attributes work/attributes-big \
+    work/languages work/webmapservices
+cp resources/*.gif work/
+cp resources/*.png work/
+cp res_noewe/languages/*.cfg work/languages/
+cp res_noewe/webmapservices/*.wms work/webmapservices/
+cp res_noewe/webmapservices/*.txt work/webmapservices/
+cp res_noewe/attributes/*.gif work/attributes/
+cp res_noewe/attributes-big/*.gif work/attributes-big/
+cp res_noewe/*.def work/
+cp res_noewe/*.html work/
+cp res_noewe/*.png work/
+cp res_noewe/*.gif work/
+cp res_noewe/*.tpl work/
+cp res_noewe/*.zip work/


Property changes on: experiments/EVEhist/programs/getres.sh
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native



From engywuck at mail.berlios.de  Mon Feb  2 19:45:32 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Mon, 2 Feb 2009 19:45:32 +0100
Subject: [Cachewolf-svn] r1619 - experiments/EVEhist/programs
Message-ID: <200902021845.n12IjWYd001331@sheep.berlios.de>

Author: engywuck
Date: 2009-02-02 19:45:30 +0100 (Mon, 02 Feb 2009)
New Revision: 1619

Modified:
   experiments/EVEhist/programs/getres.sh
Log:
Need to change relative paths, too.

Modified: experiments/EVEhist/programs/getres.sh
===================================================================
--- experiments/EVEhist/programs/getres.sh	2009-02-02 18:34:23 UTC (rev 1618)
+++ experiments/EVEhist/programs/getres.sh	2009-02-02 18:45:30 UTC (rev 1619)
@@ -1,16 +1,16 @@
 #!/bin/sh
-mkdir -p work/attributes work/attributes-big \
-    work/languages work/webmapservices
-cp resources/*.gif work/
-cp resources/*.png work/
-cp res_noewe/languages/*.cfg work/languages/
-cp res_noewe/webmapservices/*.wms work/webmapservices/
-cp res_noewe/webmapservices/*.txt work/webmapservices/
-cp res_noewe/attributes/*.gif work/attributes/
-cp res_noewe/attributes-big/*.gif work/attributes-big/
-cp res_noewe/*.def work/
-cp res_noewe/*.html work/
-cp res_noewe/*.png work/
-cp res_noewe/*.gif work/
-cp res_noewe/*.tpl work/
-cp res_noewe/*.zip work/
+mkdir -p ../work/attributes ../work/attributes-big \
+    ../work/languages ../work/webmapservices
+cp ../resources/*.gif ../work/
+cp ../resources/*.png ../work/
+cp ../res_noewe/languages/*.cfg ../work/languages/
+cp ../res_noewe/webmapservices/*.wms ../work/webmapservices/
+cp ../res_noewe/webmapservices/*.txt ../work/webmapservices/
+cp ../res_noewe/attributes/*.gif ../work/attributes/
+cp ../res_noewe/attributes-big/*.gif ../work/attributes-big/
+cp ../res_noewe/*.def ../work/
+cp ../res_noewe/*.html ../work/
+cp ../res_noewe/*.png ../work/
+cp ../res_noewe/*.gif ../work/
+cp ../res_noewe/*.tpl ../work/
+cp ../res_noewe/*.zip ../work/



From natureshadow at mail.berlios.de  Tue Feb  3 22:11:06 2009
From: natureshadow at mail.berlios.de (natureshadow at mail.berlios.de)
Date: Tue, 3 Feb 2009 22:11:06 +0100
Subject: [Cachewolf-svn] r1620 - in experiments/EVEhist: deploy
	programs/resources
Message-ID: <200902032111.n13LB6fM009806@sheep.berlios.de>

Author: natureshadow
Date: 2009-02-03 22:10:40 +0100 (Tue, 03 Feb 2009)
New Revision: 1620

Added:
   experiments/EVEhist/programs/resources/linux-x86-cl_stub
   experiments/EVEhist/programs/resources/linux-x86-gtk2_stub
   experiments/EVEhist/programs/resources/linux-x86-x_stub
   experiments/EVEhist/programs/resources/pocketpc2003_arm_stub.exe
   experiments/EVEhist/programs/resources/pocketpc2003se_arm_stub.exe
   experiments/EVEhist/programs/resources/pocketpcwindowsmobile5_arm_stub.exe
   experiments/EVEhist/programs/resources/pocketpcwindowsmobile6_arm_stub.exe
   experiments/EVEhist/programs/resources/smartphone2003_arm_stub.exe
   experiments/EVEhist/programs/resources/smartphone2003se_arm_stub.exe
   experiments/EVEhist/programs/resources/smartphonewindowsmobile5_arm_stub.exe
   experiments/EVEhist/programs/resources/smartphonewindowsmobile6_arm_stub.exe
   experiments/EVEhist/programs/resources/smartphonewindowsmobile6_mips_stub.exe
Removed:
   experiments/EVEhist/programs/resources/Linux-x86-cl_stub
   experiments/EVEhist/programs/resources/Linux-x86-gtk2_stub
   experiments/EVEhist/programs/resources/Linux-x86-x_stub
   experiments/EVEhist/programs/resources/PocketPC2003SE_arm_stub.exe
   experiments/EVEhist/programs/resources/PocketPC2003_arm_stub.exe
   experiments/EVEhist/programs/resources/PocketPCWindowsMobile5_arm_stub.exe
   experiments/EVEhist/programs/resources/PocketPCWindowsMobile6_arm_stub.exe
   experiments/EVEhist/programs/resources/SmartPhone2003SE_arm_stub.exe
   experiments/EVEhist/programs/resources/SmartPhone2003_arm_stub.exe
   experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile5_arm_stub.exe
   experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile6_arm_stub.exe
   experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile6_mips_stub.exe
Modified:
   experiments/EVEhist/deploy/cw-eve-pc.enf
Log:
Updated enf to build JAR and Linux versions.
Renamed stubs to all lower-case.
Compilation for NBs works now!


Modified: experiments/EVEhist/deploy/cw-eve-pc.enf
===================================================================
--- experiments/EVEhist/deploy/cw-eve-pc.enf	2009-02-02 18:45:30 UTC (rev 1619)
+++ experiments/EVEhist/deploy/cw-eve-pc.enf	2009-02-03 21:10:40 UTC (rev 1620)
@@ -1 +1 @@
-advancedExes=&command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3Dcachewolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26eves%3D%26extra%3D%26pathToEve%3D\Program%2BFiles\Eve\Eve.exe%26nativeStack%3D0%26vmStack%3D0%26locale%3D%26vmOptions%3D&eveFiles=&targets=eve/data/Property%3Dname%253D%25253DTarget%2526value%253Deve/data/MultiListSelect$SelectedItems%25253D%2525253DExe%2525252B-%2525252BDesktop&createWithPnf=true&eveInfo=outputFile%3D../deploy/cachewolf.eve%26entries%3Dcom/eve/evemaker/EveDirEntry%253Dpath%25253D../bin%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../lib/lib-folder%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../resources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%26addCommandLine%3Dtrue%26commandLine%3Dp!
 rogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253Dcachewolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526eves%253D%2526extra%253D%2526pathToEve%253D\Program%252BFiles\Eve\Eve.exe%2526nativeStack%253D0%2526vmStack%253D0%2526locale%253D%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26makeZip%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse%26dontCreateEveInCommandLine%3Dfalse&icon=(Default)&librarySelect=0&exeClasses=2&alwaysShowClassTree=false&debugExternalZips=false&appletWidth=800&appletHeight=600&useResources=true&appletDisplay=0&splashScreens=splashScreens%3Dcom/eve/evemaker/SplashScreen%253DimageFile%25253D../resources/logo.png%252526changeSizeTo%25253Dtrue%252526width%25253D48%252526height%25253D43%252526keepAspect%25253Dtrue%252526trueWidth%25253D48%252526trueHeight%25253D43%26screenTitle%3DSplash%2BScreen&chosenMenuItem=!
 &textEncoderName=UTF-8
+advancedExes=&command=programName%3DCacheWolf%26width%3D0%26height%3D0%26startingClass%3Dcachewolf.CacheWolf%26windowTitle%3DWindow%2BTitle%26eves%3D%26extra%3D%26pathToEve%3D\Program%2BFiles\Eve\Eve.exe%26nativeStack%3D0%26vmStack%3D0%26locale%3D%26vmOptions%3D&eveFiles=&targets=eve/data/Property%3Dname%253D%25253DTarget%2526value%253Deve/data/MultiListSelect$SelectedItems%25253D%2525253DExe%2525252B-%2525252BDesktop%25252526%2525253DJar%2525252B-%2525252BJava%2525252B2%25252526%2525253DLinux-x86-GTK2&createWithPnf=true&eveInfo=outputFile%3D../deploy/cachewolf.eve%26entries%3Dcom/eve/evemaker/EveDirEntry%253Dpath%25253D../bin%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../lib/lib-folder%252526mask%25253D*.class%252526includeSubdirectories%25253Dtrue%252526pathInEve%25253D%2526com/eve/evemaker/EveDirEntry%253Dpath%25253D../resources%252526mask%25253D*.gif;*.png;*.ico%252526includeSubd!
 irectories%25253Dtrue%252526pathInEve%25253D%26addCommandLine%3Dtrue%26commandLine%3DprogramName%253DCacheWolf%2526width%253D0%2526height%253D0%2526startingClass%253Dcachewolf.CacheWolf%2526windowTitle%253DWindow%252BTitle%2526eves%253D%2526extra%253D%2526pathToEve%253D\Program%252BFiles\Eve\Eve.exe%2526nativeStack%253D0%2526vmStack%253D0%2526locale%253D%2526vmOptions%253D%26install%3Dtitle%253D%2526category%253DApplications%2526location%253D%2526icon%253D%2526args%253D%2526vmArgs%253D%26addInstallFile%3Dfalse%26makeZip%3Dfalse%26usePool%3Dfalse%26useClassPool%3Dfalse%26dontCreateEveInCommandLine%3Dfalse&icon=(Default)&librarySelect=0&exeClasses=2&alwaysShowClassTree=false&debugExternalZips=false&appletWidth=800&appletHeight=600&useResources=true&appletDisplay=0&splashScreens=splashScreens%3Dcom/eve/evemaker/SplashScreen%253DimageFile%25253D../resources/logo.png%252526changeSizeTo%25253Dtrue%252526width%25253D48%252526height%25253D43%252526keepAspect%25253Dtrue%252526trueWi!
 dth%25253D48%252526trueHeight%25253D43%26screenTitle%3DSplash%!
 2BScreen
&chosenMenuItem=&textEncoderName=UTF-8

Deleted: experiments/EVEhist/programs/resources/Linux-x86-cl_stub
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/Linux-x86-gtk2_stub
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/Linux-x86-x_stub
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/PocketPC2003SE_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/PocketPC2003_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/PocketPCWindowsMobile5_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/PocketPCWindowsMobile6_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/SmartPhone2003SE_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/SmartPhone2003_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile5_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile6_arm_stub.exe
===================================================================
(Binary files differ)

Deleted: experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile6_mips_stub.exe
===================================================================
(Binary files differ)

Copied: experiments/EVEhist/programs/resources/linux-x86-cl_stub (from rev 1619, experiments/EVEhist/programs/resources/Linux-x86-cl_stub)


Property changes on: experiments/EVEhist/programs/resources/linux-x86-cl_stub
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/linux-x86-gtk2_stub (from rev 1619, experiments/EVEhist/programs/resources/Linux-x86-gtk2_stub)


Property changes on: experiments/EVEhist/programs/resources/linux-x86-gtk2_stub
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/linux-x86-x_stub (from rev 1619, experiments/EVEhist/programs/resources/Linux-x86-x_stub)


Property changes on: experiments/EVEhist/programs/resources/linux-x86-x_stub
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/pocketpc2003_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/PocketPC2003_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/pocketpc2003_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/pocketpc2003se_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/PocketPC2003SE_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/pocketpc2003se_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/pocketpcwindowsmobile5_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/PocketPCWindowsMobile5_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/pocketpcwindowsmobile5_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/pocketpcwindowsmobile6_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/PocketPCWindowsMobile6_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/pocketpcwindowsmobile6_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/smartphone2003_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/SmartPhone2003_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/smartphone2003_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/smartphone2003se_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/SmartPhone2003SE_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/smartphone2003se_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/smartphonewindowsmobile5_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile5_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/smartphonewindowsmobile5_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/smartphonewindowsmobile6_arm_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile6_arm_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/smartphonewindowsmobile6_arm_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 

Copied: experiments/EVEhist/programs/resources/smartphonewindowsmobile6_mips_stub.exe (from rev 1619, experiments/EVEhist/programs/resources/SmartPhoneWindowsMobile6_mips_stub.exe)


Property changes on: experiments/EVEhist/programs/resources/smartphonewindowsmobile6_mips_stub.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream
Name: svn:mergeinfo
   + 



From natureshadow at mail.berlios.de  Tue Feb  3 22:15:17 2009
From: natureshadow at mail.berlios.de (natureshadow at mail.berlios.de)
Date: Tue, 3 Feb 2009 22:15:17 +0100
Subject: [Cachewolf-svn] r1621 - experiments/EVEhist/programs
Message-ID: <200902032115.n13LFHQ1010501@sheep.berlios.de>

Author: natureshadow
Date: 2009-02-03 22:15:15 +0100 (Tue, 03 Feb 2009)
New Revision: 1621

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
Snapshot script works now.


Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-03 21:10:40 UTC (rev 1620)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-03 21:15:15 UTC (rev 1621)
@@ -30,31 +30,32 @@
 java -cp evecl-gui.jar Eve EveMaker.eve -c ../deploy/cw-eve-pc.enf
 java -cp evecl-gui.jar Eve EveMaker.eve -c ../deploy/cw-eve-pda.enf
 
-#mkdir -p published/dat/attributes
-#mkdir -p published/dat/webmapservices
-#mkdir -p published/dat/languages
-#mv programs/CacheWolf/* published/
-#chmod 755 published/*
-#cp lib/java_ewe.dll published/Jar/
-#chmod 644 published/*/*
-#chmod 755 published/dat/attributes
-#chmod 755 published/dat/webmapservices
-#chmod 755 published/dat/languages
-#printf '1,$g/ 12M/s///\nwq\n' | ed -s published/Jar/CacheWolf.bat
-#install -c -m 644 work/CacheWolf.ewe published/
-#install -c -m 644 res_noewe/* published/dat/
-#install -c -m 644 res_noewe/attributes-big/*.gif published/dat/attributes/
-#install -c -m 644 res_noewe/attributes/*-non.gif published/dat/attributes/
-#install -c -m 644 res_noewe/webmapservices/* published/dat/webmapservices/
-#install -c -m 644 res_noewe/languages/* published/dat/languages/
-#(
-#	cd published/dat
-#	find * -type f | sort >../flst
-#	$CPIO -oC512 -Hustar -Mdist <../flst | gzip -n9 >../datfiles.tgz
-#	zip -X ../datfiles.zip -@ <../flst
-#)
-#rm -rf published/dat published/flst
-#chmod 644 published/datfiles.tgz published/datfiles.zip
-#mkdir -p $HOME/public_html/CacheWolf-BE/r$v
-#mv published/* $HOME/public_html/CacheWolf-BE/r$v/
-#rm -rf bin published
+cd ..
+mkdir -p published/dat/attributes
+mkdir -p published/dat/webmapservices
+mkdir -p published/dat/languages
+mv deploy/CacheWolf/* published/
+chmod 755 published/*
+cp lib/java_ewe.dll published/Jar/
+chmod 644 published/*/*
+chmod 755 published/dat/attributes
+chmod 755 published/dat/webmapservices
+chmod 755 published/dat/languages
+printf '1,$g/ 12M/s///\nwq\n' | ed -s published/Jar/CacheWolf.bat
+install -c -m 644 work/CacheWolf.ewe published/
+install -c -m 644 res_noewe/* published/dat/
+install -c -m 644 res_noewe/attributes-big/*.gif published/dat/attributes/
+install -c -m 644 res_noewe/attributes/*-non.gif published/dat/attributes/
+install -c -m 644 res_noewe/webmapservices/* published/dat/webmapservices/
+install -c -m 644 res_noewe/languages/* published/dat/languages/
+(
+	cd published/dat
+	find * -type f | sort >../flst
+	$CPIO -oC512 -Hustar -Mdist <../flst | gzip -n9 >../datfiles.tgz
+	zip -X ../datfiles.zip -@ <../flst
+)
+rm -rf published/dat published/flst
+chmod 644 published/datfiles.tgz published/datfiles.zip
+mkdir -p $HOME/public_html/CacheWolf-BE/r$v
+mv published/* $HOME/public_html/CacheWolf-BE/r$v/
+rm -rf bin published



From natureshadow at mail.berlios.de  Tue Feb  3 22:46:58 2009
From: natureshadow at mail.berlios.de (natureshadow at mail.berlios.de)
Date: Tue, 3 Feb 2009 22:46:58 +0100
Subject: [Cachewolf-svn] r1622 - experiments/EVEhist/programs
Message-ID: <200902032146.n13LkwBj014181@sheep.berlios.de>

Author: natureshadow
Date: 2009-02-03 22:46:56 +0100 (Tue, 03 Feb 2009)
New Revision: 1622

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
Removed SVN update from snapshot script.


Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-03 21:15:15 UTC (rev 1621)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-03 21:46:56 UTC (rev 1622)
@@ -7,9 +7,6 @@
 
 cd ..
 
-echo Updating SVN ...
-svn update
-
 echo Updating version number in code ...
 v=$(svn info | sed -n '/Revision: /s///p')
 # the '' below are so that svn doesn't ever fuck up _this_ file



From engywuck at mail.berlios.de  Thu Feb  5 22:05:05 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Thu, 5 Feb 2009 22:05:05 +0100
Subject: [Cachewolf-svn] r1623 - trunk/src/exp
Message-ID: <200902052105.n15L551x004776@sheep.berlios.de>

Author: engywuck
Date: 2009-02-05 22:05:03 +0100 (Thu, 05 Feb 2009)
New Revision: 1623

Modified:
   trunk/src/exp/HTMLExporter.java
Log:
Making HTML Export possible, even if image links contain infos that havn't been localized before (e.g. after import of GPX).

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2009-02-03 21:46:56 UTC (rev 1622)
+++ trunk/src/exp/HTMLExporter.java	2009-02-05 21:05:03 UTC (rev 1623)
@@ -82,7 +82,7 @@
 				h.changed();
 
 				ch = (CacheHolder)cacheDB.get(i);
-				if(ch.is_black == false && ch.is_filtered == false){
+				if(	ch.is_black == false && ch.is_filtered == false){
 					holder=ch.getCacheDetails(false,true);
 					varParams = new Hashtable();
 					varParams.put("TYPE", CacheType.transType(holder.type));
@@ -259,8 +259,16 @@
 			if (imgUrl.lastIndexOf('.')>0 && imgUrl.toLowerCase().startsWith("http")) {
 				String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
 				// If we have an image which we stored when spidering, we can display it
-				if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
-					s.append("<img src=\""+chD.Images.get(imageNo)+"\">");
+				if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe") && !imgType.startsWith(".pl")){
+					String localImageSource = null;
+					try {
+						localImageSource = chD.Images.get(imageNo).toString();
+					} catch (ArrayIndexOutOfBoundsException e) {
+						// If we haven't a local image for this image number, then take
+						// a link to the original URL - better than nothing.
+						localImageSource = imgUrl;
+					}
+					s.append("<img src=\""+localImageSource+"\">");
 					// The actual immages are copied elswhere
 					//DataMover.copy(profile.dataDir + chD.Images.get(imageNo),targetDir + chD.Images.get(imageNo));
 					imageNo++;



From engywuck at mail.berlios.de  Thu Feb  5 22:05:57 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Thu, 5 Feb 2009 22:05:57 +0100
Subject: [Cachewolf-svn] r1624 - experiments/EVEhist/src/cachewolf/exp
Message-ID: <200902052105.n15L5v6I004947@sheep.berlios.de>

Author: engywuck
Date: 2009-02-05 22:05:55 +0100 (Thu, 05 Feb 2009)
New Revision: 1624

Modified:
   experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java
Log:
Making HTML Export possible, even if image links contain infos that havn't been localized before (e.g. after import of GPX).

Modified: experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java
===================================================================
--- experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java	2009-02-05 21:05:03 UTC (rev 1623)
+++ experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java	2009-02-05 21:05:55 UTC (rev 1624)
@@ -268,7 +268,15 @@
 				String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
 				// If we have an image which we stored when spidering, we can display it
 				if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe") && !imgType.startsWith(".pl")){
-					s.append("<img src=\""+chD.images.get(imageNo)+"\">");
+					String localImageSource = null;
+					try {
+						localImageSource = chD.images.get(imageNo).toString();
+					} catch (ArrayIndexOutOfBoundsException e) {
+						// If we haven't a local image for this image number, then take
+						// a link to the original URL - better than nothing.
+						localImageSource = imgUrl;
+					}
+					s.append("<img src=\""+localImageSource+"\">");
 					// The actual immages are copied elswhere
 					//DataMover.copy(profile.dataDir + chD.Images.get(imageNo),targetDir + chD.Images.get(imageNo));
 					imageNo++;



From engywuck at mail.berlios.de  Fri Feb  6 18:08:32 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 6 Feb 2009 18:08:32 +0100
Subject: [Cachewolf-svn] r1625 - trunk/src/exp
Message-ID: <200902061708.n16H8Wnb018363@sheep.berlios.de>

Author: engywuck
Date: 2009-02-06 18:08:31 +0100 (Fri, 06 Feb 2009)
New Revision: 1625

Modified:
   trunk/src/exp/HTMLExporter.java
Log:
Improving handling of images in cache descriptions when exporting.

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2009-02-05 21:05:55 UTC (rev 1624)
+++ trunk/src/exp/HTMLExporter.java	2009-02-06 17:08:31 UTC (rev 1625)
@@ -260,14 +260,14 @@
 				String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
 				// If we have an image which we stored when spidering, we can display it
 				if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe") && !imgType.startsWith(".pl")){
-					String localImageSource = null;
-					try {
-						localImageSource = chD.Images.get(imageNo).toString();
-					} catch (ArrayIndexOutOfBoundsException e) {
-						// If we haven't a local image for this image number, then take
-						// a link to the original URL - better than nothing.
-						localImageSource = imgUrl;
+					// It may occur that there are less local images than
+					// image links in the description (eg. because of importing
+					// GPX files). We have to allow for this situation.
+					Object localImageSource = null;
+					if (imageNo < chD.Images.size()) {
+						localImageSource = chD.Images.get(imageNo);
 					}
+					if (localImageSource == null) localImageSource = imgUrl;
 					s.append("<img src=\""+localImageSource+"\">");
 					// The actual immages are copied elswhere
 					//DataMover.copy(profile.dataDir + chD.Images.get(imageNo),targetDir + chD.Images.get(imageNo));



From engywuck at mail.berlios.de  Fri Feb  6 18:08:50 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 6 Feb 2009 18:08:50 +0100
Subject: [Cachewolf-svn] r1626 - experiments/EVEhist/src/cachewolf/exp
Message-ID: <200902061708.n16H8oMn018520@sheep.berlios.de>

Author: engywuck
Date: 2009-02-06 18:08:48 +0100 (Fri, 06 Feb 2009)
New Revision: 1626

Modified:
   experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java
Log:
Improving handling of images in cache descriptions when exporting.

Modified: experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java
===================================================================
--- experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java	2009-02-06 17:08:31 UTC (rev 1625)
+++ experiments/EVEhist/src/cachewolf/exp/HTMLExporter.java	2009-02-06 17:08:48 UTC (rev 1626)
@@ -268,16 +268,16 @@
 				String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
 				// If we have an image which we stored when spidering, we can display it
 				if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe") && !imgType.startsWith(".pl")){
-					String localImageSource = null;
-					try {
-						localImageSource = chD.images.get(imageNo).toString();
-					} catch (ArrayIndexOutOfBoundsException e) {
-						// If we haven't a local image for this image number, then take
-						// a link to the original URL - better than nothing.
-						localImageSource = imgUrl;
+					// It may occur that there are less local images than
+					// image links in the description (eg. because of importing
+					// GPX files). We have to allow for this situation.
+					Object localImageSource = null;
+					if (imageNo < chD.images.size()) {
+						localImageSource = chD.images.get(imageNo);
 					}
+					if (localImageSource == null) localImageSource = imgUrl;
 					s.append("<img src=\""+localImageSource+"\">");
-					// The actual immages are copied elswhere
+					// The actual images are copied elsewhere
 					//DataMover.copy(profile.dataDir + chD.Images.get(imageNo),targetDir + chD.Images.get(imageNo));
 					imageNo++;
 				}



From admin at berlios.de  Sun Feb  8 22:19:30 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 8 Feb 2009 22:19:30 +0100 (CET)
Subject: [Cachewolf-svn] [Bug #15224] "update selected" makes OC to save the
	index for each cache
Message-ID: <200902082119.n18LJUHo007637@unicorn.berlios.de>

Bug #15224, was updated on 2009-Feb-08 22:19
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Bug reason found in code
Priority: 5
Submitted by: pfeffer
Assigned to : none
Summary: "update selected" makes OC to save the index for each cache

Details: "update selected" makes opencaching download to save the index for each cache, which makes it nearly unusable slow.

See: http://www.geoclub.de/viewtopic.php?f=40&t=27764&p=486856#p486856

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15224&group_id=2211


From engywuck at mail.berlios.de  Sun Feb  8 22:30:26 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 8 Feb 2009 22:30:26 +0100
Subject: [Cachewolf-svn] r1627 - trunk/src/CacheWolf
Message-ID: <200902082130.n18LUQYj010769@sheep.berlios.de>

Author: engywuck
Date: 2009-02-08 22:30:24 +0100 (Sun, 08 Feb 2009)
New Revision: 1627

Modified:
   trunk/src/CacheWolf/OCXMLImporter.java
Log:
When updating OC caches: Only saving index AFTER updating process, not in between. (http://www.geoclub.de/viewtopic.php?f=40&t=27764)

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2009-02-06 17:08:48 UTC (rev 1626)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2009-02-08 21:30:24 UTC (rev 1627)
@@ -202,6 +202,7 @@
 		inf.exec();
 
 		success = syncOC(url);
+		profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 		Vm.showWait(false);
 		if (success) {
 			profile.last_sync_opencaching = dateOfthisSync.format("yyyyMMddHHmmss");
@@ -284,7 +285,6 @@
 				ch.calcRecommendationScore();
 			}
 		} */
-		profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 		inf.setInfo(finalMessage);
 
 		return success;



From engywuck at mail.berlios.de  Sun Feb  8 22:31:03 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 8 Feb 2009 22:31:03 +0100
Subject: [Cachewolf-svn] r1628 - experiments/EVEhist/src/cachewolf/imp
Message-ID: <200902082131.n18LV3G0010952@sheep.berlios.de>

Author: engywuck
Date: 2009-02-08 22:31:01 +0100 (Sun, 08 Feb 2009)
New Revision: 1628

Modified:
   experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
Log:
When updating OC caches: Only saving index AFTER updating process, not in between. (http://www.geoclub.de/viewtopic.php?f=40&t=27764)

Modified: experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
===================================================================
--- experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-08 21:30:24 UTC (rev 1627)
+++ experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-08 21:31:01 UTC (rev 1628)
@@ -219,6 +219,7 @@
 		inf.exec();
 
 		success = syncOC(url);
+		profile.saveIndex(Profile.SHOW_PROGRESS_BAR);
 		Form.cancelWait();
 		if (success) {
 			profile.last_sync_opencaching = dateOfthisSync.format("yyyyMMddHHmmss");
@@ -301,7 +302,6 @@
 				ch.calcRecommendationScore();
 			}
 		} */
-		profile.saveIndex(Profile.SHOW_PROGRESS_BAR);
 		inf.setInfo(finalMessage);
 
 		return success;



From admin at berlios.de  Fri Feb 13 20:21:19 2009
From: admin at berlios.de (admin at berlios.de)
Date: Fri, 13 Feb 2009 20:21:19 +0100 (CET)
Subject: [Bug #15262] getres.sh "lärmt"
Message-ID: <200902131921.n1DJLJjh013378@unicorn.berlios.de>

Bug #15262, was updated on 2009-Feb-13 20:21
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Other
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: greiol
Assigned to : none
Summary: getres.sh "l?rmt"

Details: getres.sh nutzt einige kommandos so, dass unn?tige fehlermeldungen entstehen (haupts?chlich fehlen ein paar -f optionen)

ein patch liegt unter http://cbr2008nrw.ohost.de/getresh.sh.patch.zip



For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15262&group_id=2211


From admin at berlios.de  Fri Feb 13 22:58:09 2009
From: admin at berlios.de (admin at berlios.de)
Date: Fri, 13 Feb 2009 22:58:09 +0100 (CET)
Subject: [Bug #15262] getres.sh "lärmt"
Message-ID: <200902132158.n1DLw9Ov013912@unicorn.berlios.de>

Bug #15262, was updated on 2009-Feb-13 20:21
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Other
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: greiol
Assigned to : none
Summary: getres.sh "l?rmt"

Details: getres.sh nutzt einige kommandos so, dass unn?tige fehlermeldungen entstehen (haupts?chlich fehlen ein paar -f optionen)

ein patch liegt unter http://cbr2008nrw.ohost.de/getresh.sh.patch.zip



Follow-Ups:

Date: 2009-Feb-13 22:58
By: pfeffer

Comment:
danke

1. ich kann den patch leider nicht anwenden. Bei mir ist das R in getres.sh kleingeschrieben und liegt unter programs.

2. l?sst sich Dein ge?ndertes skript auch mit sh statt mit bash ausf?hren?

da es bei mir nicht klappt, wendet den patch jemand anders an?

Gru?,
   Pfeffer.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15262&group_id=2211


From pfeffer at mail.berlios.de  Sat Feb 14 02:08:58 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 14 Feb 2009 02:08:58 +0100
Subject: [Cachewolf-svn] r1629 - experiments/EVEhist/src/cachewolf/imp
Message-ID: <200902140108.n1E18wK7019970@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-14 02:08:56 +0100 (Sat, 14 Feb 2009)
New Revision: 1629

Modified:
   experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
Log:
Eve: OC-Import: Date-Time is expected by Eve separeted by spaces whereas Ewe didn't need spaces

Modified: experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
===================================================================
--- experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-08 21:31:01 UTC (rev 1628)
+++ experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-14 01:08:56 UTC (rev 1629)
@@ -139,7 +139,17 @@
 			else lastS = ch.lastSyncOC;
 		}
 		dateOfthisSync = new Time();
-		dateOfthisSync.parse(lastS, "yyyyMMddHHmmss");
+		// TODO This is a workaround necessary because the expected format changed from Ewe to Eve, expecting now spaces between year mounth day...
+		
+		StringBuffer tmp = new StringBuffer(lastS.length()+5);
+		tmp.append(lastS.substring(0, 4)).append(" ");
+		tmp.append(lastS.substring(4, 6)).append(" ");
+		tmp.append(lastS.substring(6, 8)).append(" ");
+		tmp.append(lastS.substring(8, 10)).append(" ");
+		tmp.append(lastS.substring(10,12)).append(" ");
+		tmp.append(lastS.substring(12, 14));
+		
+		dateOfthisSync.parse(tmp.toString(), "yyyyMMddHHmmss");
 	
 
 		String url = "";



From admin at berlios.de  Sat Feb 14 11:47:35 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 14 Feb 2009 11:47:35 +0100 (CET)
Subject: [Cachewolf-svn] [Bug #15224] "update selected" makes OC to save the
	index for each cache
Message-ID: <200902141047.n1EAlZrg010706@unicorn.berlios.de>

Bug #15224, was updated on 2009-Feb-08 22:19
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Fixed, ready to test
Priority: 5
Submitted by: pfeffer
Assigned to : none
Summary: "update selected" makes OC to save the index for each cache

Details: "update selected" makes opencaching download to save the index for each cache, which makes it nearly unusable slow.

See: http://www.geoclub.de/viewtopic.php?f=40&t=27764&p=486856#p486856

Follow-Ups:

Date: 2009-Feb-14 11:47
By: pfeffer

Comment:
it's working now - but I didn't understand why the fix works, so i am afraid that there are side effects (e.g. not saving in same cases)
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15224&group_id=2211


From pfeffer at mail.berlios.de  Sun Feb 15 20:58:05 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 15 Feb 2009 20:58:05 +0100
Subject: [Cachewolf-svn] r1630 - in experiments/EVEhist/src: . cachewolf
	cachewolf/imp eveWorkArounds
Message-ID: <200902151958.n1FJw5P5010868@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-15 20:58:03 +0100 (Sun, 15 Feb 2009)
New Revision: 1630

Added:
   experiments/EVEhist/src/eveWorkArounds/
   experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java
Modified:
   experiments/EVEhist/src/cachewolf/DetailsPanel.java
   experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java
   experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
Log:
Eve-Bug ( http://www.ewesoft.com/cgi-local/eve-yabb/YaBB.pl?num=1234142226 ) work-around

Modified: experiments/EVEhist/src/cachewolf/DetailsPanel.java
===================================================================
--- experiments/EVEhist/src/cachewolf/DetailsPanel.java	2009-02-14 01:08:56 UTC (rev 1629)
+++ experiments/EVEhist/src/cachewolf/DetailsPanel.java	2009-02-15 19:58:03 UTC (rev 1630)
@@ -6,6 +6,7 @@
 
 import eve.sys.*;
 import eve.ui.event.*;
+import eveWorkArounds.TimeWorkArounds;
 
 /**
 *	Class to create the panel to show the cache details.<br>
@@ -349,7 +350,7 @@
 				dc.setPreferredSize(240,240);
 				String foundDate=chcStatus.getText();
 				if (foundDate.startsWith(MyLocale.getMsg(318,"Found")+" ")) foundDate=foundDate.substring(MyLocale.getMsg(318,"Found").length()+1);
-				Time t=new Time();
+				Time t=new TimeWorkArounds();
 				try {
 					t.parse(foundDate,"y-M-d H:m");
 				} catch(IllegalArgumentException e) {

Modified: experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java
===================================================================
--- experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java	2009-02-14 01:08:56 UTC (rev 1629)
+++ experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java	2009-02-15 19:58:03 UTC (rev 1630)
@@ -31,6 +31,7 @@
 import eve.ui.event.ControlEvent;
 import eve.ui.event.FormEvent;
 import eve.ui.table.TableCellAttributes;
+import eveWorkArounds.TimeWorkArounds;
 
 public class TravelbugJourneyScreen extends Form  {
 	
@@ -223,7 +224,7 @@
 				dc.title=MyLocale.getMsg(328,"Date found"); 
 				dc.setPreferredSize(240,240);
 				String foundDate=inpDate.getText();
-				Time t=new Time();
+				Time t=new TimeWorkArounds();
 				try {
 					t.parse(foundDate,"y-M-d H:m");
 				} catch(IllegalArgumentException e) {

Modified: experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
===================================================================
--- experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-14 01:08:56 UTC (rev 1629)
+++ experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-15 19:58:03 UTC (rev 1630)
@@ -33,6 +33,7 @@
 import java.net.MalformedURLException;
 
 import eve.util.CharArray;
+import eveWorkArounds.TimeWorkArounds;
 
 /**
  *	Class to import Data from opencaching.de. 
@@ -138,18 +139,8 @@
 			if (ch.lastSyncOC.length() < 14) lastS = "20050801000000";
 			else lastS = ch.lastSyncOC;
 		}
-		dateOfthisSync = new Time();
-		// TODO This is a workaround necessary because the expected format changed from Ewe to Eve, expecting now spaces between year mounth day...
-		
-		StringBuffer tmp = new StringBuffer(lastS.length()+5);
-		tmp.append(lastS.substring(0, 4)).append(" ");
-		tmp.append(lastS.substring(4, 6)).append(" ");
-		tmp.append(lastS.substring(6, 8)).append(" ");
-		tmp.append(lastS.substring(8, 10)).append(" ");
-		tmp.append(lastS.substring(10,12)).append(" ");
-		tmp.append(lastS.substring(12, 14));
-		
-		dateOfthisSync.parse(tmp.toString(), "yyyyMMddHHmmss");
+		dateOfthisSync = new TimeWorkArounds();
+		dateOfthisSync.parse(lastS, "yyyyMMddHHmmss");
 	
 
 		String url = "";
@@ -326,7 +317,7 @@
 		strData ="";
 
 		if (name.equals("oc11xml")){
-			Time lastSync = new Time();
+			Time lastSync = new TimeWorkArounds();
 			try {
 				lastSync.parse(atts.getValue("date"),"yyyy-MM-dd HH:mm:ss");
 			}catch (IllegalArgumentException e){ // TODO Fehler werfen

Added: experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java
===================================================================
--- experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java	2009-02-14 01:08:56 UTC (rev 1629)
+++ experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java	2009-02-15 19:58:03 UTC (rev 1630)
@@ -0,0 +1,17 @@
+package eveWorkArounds;
+
+import eve.sys.Time;
+
+public class TimeWorkArounds extends Time {
+	public void parse(String dateValue,String dateFormat) throws IllegalArgumentException {
+		StringBuffer tmp = new StringBuffer(dateValue.length()+5);
+		tmp.append(dateValue.substring(0, 4)).append(" ");
+		tmp.append(dateValue.substring(4, 6)).append(" ");
+		tmp.append(dateValue.substring(6, 8)).append(" ");
+		tmp.append(dateValue.substring(8, 10)).append(" ");
+		tmp.append(dateValue.substring(10,12)).append(" ");
+		tmp.append(dateValue.substring(12, 14));
+		super.parse(tmp.toString(), dateFormat);
+	}
+
+}



From salzkammergut at mail.berlios.de  Sun Feb 15 22:55:38 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 15 Feb 2009 22:55:38 +0100
Subject: [Cachewolf-svn] r1631 - experiments/EVEhist/src/cachewolf
Message-ID: <200902152155.n1FLtcGx020478@sheep.berlios.de>

Author: salzkammergut
Date: 2009-02-15 22:55:35 +0100 (Sun, 15 Feb 2009)
New Revision: 1631

Modified:
   experiments/EVEhist/src/cachewolf/DetailsPanel.java
Log:
DetailsPanel: Bugfix. TimeWorkArounds results in Exception and is not needed. Removed it.

Modified: experiments/EVEhist/src/cachewolf/DetailsPanel.java
===================================================================
--- experiments/EVEhist/src/cachewolf/DetailsPanel.java	2009-02-15 19:58:03 UTC (rev 1630)
+++ experiments/EVEhist/src/cachewolf/DetailsPanel.java	2009-02-15 21:55:35 UTC (rev 1631)
@@ -6,7 +6,6 @@
 
 import eve.sys.*;
 import eve.ui.event.*;
-import eveWorkArounds.TimeWorkArounds;
 
 /**
 *	Class to create the panel to show the cache details.<br>
@@ -350,7 +349,7 @@
 				dc.setPreferredSize(240,240);
 				String foundDate=chcStatus.getText();
 				if (foundDate.startsWith(MyLocale.getMsg(318,"Found")+" ")) foundDate=foundDate.substring(MyLocale.getMsg(318,"Found").length()+1);
-				Time t=new TimeWorkArounds();
+				Time t=new Time();
 				try {
 					t.parse(foundDate,"y-M-d H:m");
 				} catch(IllegalArgumentException e) {



From salzkammergut at mail.berlios.de  Sun Feb 15 23:01:33 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 15 Feb 2009 23:01:33 +0100
Subject: [Cachewolf-svn] r1632 - experiments/EVEhist/src/cachewolf
Message-ID: <200902152201.n1FM1Xpi022417@sheep.berlios.de>

Author: salzkammergut
Date: 2009-02-15 23:01:31 +0100 (Sun, 15 Feb 2009)
New Revision: 1632

Modified:
   experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java
Log:
TravelBugJourneyScreen: TimeWorkArounds removed.

Modified: experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java
===================================================================
--- experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java	2009-02-15 21:55:35 UTC (rev 1631)
+++ experiments/EVEhist/src/cachewolf/TravelbugJourneyScreen.java	2009-02-15 22:01:31 UTC (rev 1632)
@@ -3,7 +3,7 @@
 /**
  * A list to manage the travelbugs. Each row represents one @see TravelbugJourney.
  * The lower half of the screen which is separated from the top by a splitter bar,
- * contains four tabs: One for the travelbug, one for the source (where the travelbug 
+ * contains four tabs: One for the travelbug, one for the source (where the travelbug
  * was picked up), one for the destination (where the travelbug was dropped) and one
  * for the mission. These tabs are used for inputting data about the travelbug journey.
  * The travelbugs are read from file travelbugs.xml which is stored in the base directory.
@@ -31,10 +31,10 @@
 import eve.ui.event.ControlEvent;
 import eve.ui.event.FormEvent;
 import eve.ui.table.TableCellAttributes;
-import eveWorkArounds.TimeWorkArounds;
 
+
 public class TravelbugJourneyScreen extends Form  {
-	
+
 	/** The list control */
 	private tbListControl tcTbJourneyList;
 	/** The list model */
@@ -43,8 +43,8 @@
 	private TravelbugJourneyList tblMyTravelbugJourneys;
 	/** The panel for the lower half of the screen */
 	private CellPanel lowerpane;
-	private Input inpName,inpTrackingNo, 
-		   inpFromDate, inpFromProfile, inpFromWaypoint, 
+	private Input inpName,inpTrackingNo,
+		   inpFromDate, inpFromProfile, inpFromWaypoint,
 	       inpToDate, inpToProfile, inpToWaypoint;
 	private Label lblId;
 	private Button btnFromDate,btnToDate;
@@ -52,7 +52,7 @@
 	private HtmlDisplay txtMission;
 	private TabbedPanel pnlTab;
     /**	 List of TBs in the current cache */
-	private TravelbugList tblSrcCache; 
+	private TravelbugList tblSrcCache;
 	/** The currently selected row */
 	private int selectedRow=-1;
 	/** A label which holds the number of currently displayed travelbug journeys*/
@@ -63,14 +63,14 @@
 	 * was added to or taken from it.
 	 */
 	private boolean chDmodified=false;
-	
+
 	/** The current cache */
 	private CacheHolderDetail chD;
 	/** The base data of the current cache */
 	private CacheHolder ch;
 	/** The name of the current waypoint */
 	private String waypoint="";
-	
+
 	public TravelbugJourneyScreen() {
 		Vector cacheDB=Global.getProfile().cacheDB;
 		SplittablePanel split = new SplittablePanel(PanelSplitter.VERTICAL);
@@ -93,9 +93,9 @@
 		tcTbJourneyList=new tbListControl();
 		tcTbJourneyList.setTableModel(modTbJourneyList=new tbListTableModel());
 		tablepane.addLast(new MyScrollBarPanel(tcTbJourneyList,ScrollBarPanel.AlwaysShowVerticalScrollers),STRETCH,FILL);
-	
+
 		lowerpane = split.getNextPanel();
-		
+
 		pnlTab=new TabbedPanel();
 		pnlTab.extraControlsRight=lblNumVisibleJourneys=new Label("  0");
 		//------------------------------------------------
@@ -109,7 +109,7 @@
 		pnlName.addNext(new Label(MyLocale.getMsg(6027,"ID/GUID:")),DONTSTRETCH,DONTFILL);
 		pnlName.addLast(lblId=new Label(""),HSTRETCH,HFILL);
 		pnlTab.addCard(pnlName,MyLocale.getMsg(6028,"Name"),"Name");
-		
+
 		//------------------------------------------------
 		// Second Tab - Where was the TB picked up from
 		//------------------------------------------------
@@ -117,17 +117,17 @@
 		pnlFrom.addNext(new Label(MyLocale.getMsg(6029,"Profile/Cache:")),DONTSTRETCH,DONTFILL|WEST);
 		pnlFrom.addNext(inpFromProfile=new Input(),HSTRETCH,HFILL);
 		pnlFrom.addLast(inpFromWaypoint=new Input(),HSTRETCH,HFILL);
-		
+
 		pnlFrom.addNext(new Label(MyLocale.getMsg(6030,"Date found:")),DONTSTRETCH,DONTFILL|WEST);
 		pnlFrom.addNext(inpFromDate=new Input(),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		pnlFrom.addLast(btnFromDate=new Button(new Picture("calendar.png")),DONTSTRETCH,DONTFILL|WEST);
 		btnFromDate.modify(0,ControlConstants.TakesKeyFocus);
-		
+
 		pnlFrom.addNext(new Label(MyLocale.getMsg(6031,"Logged:")),DONTSTRETCH,DONTFILL|WEST);
 		pnlFrom.addLast(chkFromLogged=new CheckBox(""),DONTSTRETCH,DONTFILL|WEST);
 		chkFromLogged.exitKeys=exitKeys;
 		pnlFrom.addLast(new Label(""));
-		
+
 		pnlTab.addCard(pnlFrom,MyLocale.getMsg(6032,"From"),"From");
 
 		//------------------------------------------------
@@ -137,21 +137,21 @@
 		pnlTo.addNext(new Label(MyLocale.getMsg(6029,"Profile/Cache:")),DONTSTRETCH,DONTFILL|WEST);
 		pnlTo.addNext(inpToProfile=new Input(),HSTRETCH,HFILL);
 		pnlTo.addLast(inpToWaypoint=new Input(),HSTRETCH,HFILL);
-		
+
 		pnlTo.addNext(new Label(MyLocale.getMsg(6033,"Date dropped:")),DONTSTRETCH,DONTFILL|WEST);
 		pnlTo.addNext(inpToDate=new Input(),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		//inpToDate.modifyAll(DisplayOnly,0);
 		pnlTo.addLast(btnToDate=new Button(new Picture("calendar.png")),DONTSTRETCH,DONTFILL|WEST);
 		btnToDate.modify(0,ControlConstants.TakesKeyFocus);
 		//pnlTo.addLast(new Label(""));
-		
+
 		pnlTo.addNext(new Label(MyLocale.getMsg(6031,"Logged:")),DONTSTRETCH,DONTFILL|WEST);
 		pnlTo.addLast(chkToLogged=new CheckBox(""),DONTSTRETCH,DONTFILL|WEST);
 		chkToLogged.exitKeys=exitKeys;
 		pnlTo.addLast(new Label(""));
-		
+
 		pnlTab.addCard(pnlTo,MyLocale.getMsg(6034,"To"),"To");
-		
+
 		//------------------------------------------------
 		// Last Panel - TB Mission
 		//------------------------------------------------
@@ -161,14 +161,14 @@
 		txtMission.rows=3;
 		pnlTab.addCard(pnlDest,MyLocale.getMsg(6036,"Mission"),"Mission");
 
-		
+
 		lowerpane.addLast(pnlTab,STRETCH,FILL);
-		
-		
+
+
 		split.setSplitter(PanelSplitter.AFTER|PanelSplitter.HIDDEN,PanelSplitter.BEFORE|PanelSplitter.HIDDEN,0);
 		addLast(split,STRETCH,FILL);
 		//setPreferredSize(MyLocale.getScreenWidth()<=240?240:MyLocale.getScreenWidth()*2/3,240);
-		
+
 		tblMyTravelbugJourneys=new TravelbugJourneyList();
 		tblMyTravelbugJourneys.readTravelbugsFile();
 		modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
@@ -178,7 +178,7 @@
 		modTbJourneyList.colWidth=
 			TableColumnChooser.str2Array(Global.getPref().travelbugColWidth,10,1024,50, -1);
 		modTbJourneyList.numCols=modTbJourneyList.columnMap.length;
-		
+
 		modTbJourneyList.select(0,12,true);
 		/* Restore the saved setting about showing only non-logged bugs */
 		if (Global.getPref().travelbugShowOnlyNonLogged) {
@@ -186,18 +186,18 @@
 		}
 		updateNumBugs();
 	}
-	
+
 	/** Indicate the number of journeys currently displayed */
 	private void updateNumBugs() {
 		lblNumVisibleJourneys.setText(""+modTbJourneyList.numRows);
 		lblNumVisibleJourneys.repaint();
 	}
-	
+
 	/** The control which had the last focus */
 	private Control currentControl;
-	
+
 	public void onEvent(Event ev){
-		// Update the table from the input form  
+		// Update the table from the input form
 		if ((ev instanceof MultiPanelEvent || ev instanceof ControlEvent || ev instanceof DataChangeEvent) && selectedRow!=-1 &&
 				selectedRow<tblMyTravelbugJourneys.size()){
 			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
@@ -221,10 +221,10 @@
 			if (ev.target==btnFromDate || ev.target==btnToDate) {
 				Input inpDate=ev.target==btnFromDate ? inpFromDate : inpToDate;
 				DateTimeChooser dc=new DateTimeChooser(Vm.getLocale(), false);
-				dc.title=MyLocale.getMsg(328,"Date found"); 
+				dc.title=MyLocale.getMsg(328,"Date found");
 				dc.setPreferredSize(240,240);
 				String foundDate=inpDate.getText();
-				Time t=new TimeWorkArounds();
+				Time t=new Time();
 				try {
 					t.parse(foundDate,"y-M-d H:m");
 				} catch(IllegalArgumentException e) {
@@ -235,18 +235,18 @@
 				dc.reset(t);
 				if (dc.execute()==eve.ui.FormBase.IDOK) {
 				  inpDate.setText(Convert.toString(dc.year)+"-"+MyLocale.formatLong(dc.month,"00")+"-"+MyLocale.formatLong(dc.day,"00")+" "+dc.time);
-				  if (ev.target==btnFromDate){ 
+				  if (ev.target==btnFromDate){
 					  tblMyTravelbugJourneys.getTBJourney(selectedRow).setFromDate(inpDate.getText());
 					  Gui.takeFocus(chkFromLogged,Control.ByKeyboard);
 				  } else {
 					  tblMyTravelbugJourneys.getTBJourney(selectedRow).setToDate(inpDate.getText());
 					  Gui.takeFocus(chkToLogged,Control.ByKeyboard);
 				  } tcTbJourneyList.repaint();
-				}				
+				}
 			}
 		}
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.EXITED){
-			pnlTab.selectNextTab(true,true); 
+			pnlTab.selectNextTab(true,true);
 			if (ev.target==chkFromLogged) Gui.takeFocus(inpToProfile,Control.ByKeyboard);
 			if (ev.target==chkToLogged) Gui.takeFocus(txtMission,Control.ByKeyboard);
 		}
@@ -276,8 +276,8 @@
 		updateNumBugs();
 		currentControl=Gui.focusedControl();
 	}
-	
-	
+
+
 //==============================================================
 // tbListTableModel
 //==============================================================
@@ -285,7 +285,7 @@
 	private FontMetrics fm;
 	private Picture imgRed;
 	tbListTableModel() {
-		
+
 		fillToEqualHeights=true;
 		allRowsSameSize=true;
 		hasRowHeaders=false;
@@ -298,7 +298,7 @@
 	}
     private int colWidth[];
 	private int columnMap[];
-	
+
 //	public Object getCellText(int row, int col) {
 //		return null;
 //	}
@@ -309,9 +309,9 @@
 		int map=columnMap[col];
 		// If we have not yet logged the from or the to, a red dot is placed in front of the first item
 		if (col==0 && (!tblMyTravelbugJourneys.getTBJourney(row).getFromLogged() ||
-			!tblMyTravelbugJourneys.getTBJourney(row).getToLogged())) { 
+			!tblMyTravelbugJourneys.getTBJourney(row).getToLogged())) {
 			// Is it a column with a checkbox?
-			if (map!=7 && map!=11) 
+			if (map!=7 && map!=11)
 				return new IconAndText((IImage)imgRed,(String) tblMyTravelbugJourneys.getTBJourney(row).getElementByNumber(map),fm);
 			// Checkbox - special treatment
 			IconAndText iat=new IconAndText(imgRed,"",fm);
@@ -323,15 +323,15 @@
 	public int calculateRowHeight(int row) {
 		return charHeight+2;
 	}
-	
+
 	public int calculateColWidth(int col){
-		if(col == -1) 
+		if(col == -1)
         	return 0;
         else if (col<numCols)
         	return colWidth[columnMap[col]];
         else return 0;
 	}
-	
+
 	public TableCellAttributes getCellAttributes(int row,int col,boolean isSelected,TableCellAttributes ta) {
 		ta=super.getCellAttributes(row,col,isSelected,ta);
 		ta.alignment = CellConstants.LEFT;
@@ -363,11 +363,11 @@
 		chkToLogged.setState(tbj.getToLogged());
 		txtMission.setHtml(tbj.getTb().getMission());
 	}
-	
+
 	private boolean sortAsc=false;
 	private int sortedBy = -1;
 	private int lastRow=-1;
-	public int penEventModifiers; 
+	public int penEventModifiers;
 
 	public boolean penPressed(Point onTable,Point cell){
 		boolean retval=false;
@@ -409,7 +409,7 @@
 		tcTbJourneyList.clearSelection(null);
 		tcTbJourneyList.addToSelection(new Rect(0,fromRow,numCols,toRow-fromRow+1),false,true);
 	}
-	
+
 	/**
 	 * Return the column widths as a comma delimited string for storing in the preferences
 	 * @return
@@ -436,7 +436,7 @@
 	private MenuItem mnuNewTB, mnuDeleteTB,mnuGetMission,mnuOpenOnline,mnuDropTB,mnuPickupTB,mnuDeleteTBs;
 	public MenuItem mnuToggleList;
 	private Menu mnuFullMenu,mnuDeleteMenu;
-	
+
 	tbListControl() {
 		MenuItem[] TBMenuItems=new MenuItem[10];
 		TBMenuItems[0]= mnuPickupTB = new MenuItem(MyLocale.getMsg(6040,"Pick up TB from current cache"));
@@ -459,14 +459,14 @@
 		mnuGetMission.modifiers|=MenuItem.Disabled;
 		mnuOpenOnline.modifiers|=MenuItem.Disabled;
 	}
-	
+
 	public void onEvent(Event ev) {
 		Rect sel=getSelection(null);
 		if (sel.y<tblMyTravelbugJourneys.size()) {
 			mnuDeleteTB.modifiers&=~MenuItem.Disabled;
 			mnuGetMission.modifiers&=~MenuItem.Disabled;
 			mnuOpenOnline.modifiers&=~MenuItem.Disabled;
-			if (tblMyTravelbugJourneys.getTBJourney(sel.y).inMyPosession()) 
+			if (tblMyTravelbugJourneys.getTBJourney(sel.y).inMyPosession())
 				mnuDropTB.modifiers&=~MenuItem.Disabled;
 			else
 				mnuDropTB.modifiers|=MenuItem.Disabled;
@@ -489,12 +489,12 @@
 	}
 
 	public void penHeld(Point p){
-		menuState.doShowMenu(p,true,null); 
+		menuState.doShowMenu(p,true,null);
 	}
 
 	public void popupMenuEvent(Object selectedItem){
 		if (selectedItem==mnuPickupTB) {
-			Travelbug tb=TravelbugPickup.pickupTravelbug(tblSrcCache);	
+			Travelbug tb=TravelbugPickup.pickupTravelbug(tblSrcCache);
 			if (tb!=null) {
 				chDmodified=true;
 				tblMyTravelbugJourneys.addTbPickup(tb,Global.getProfile().name,waypoint);
@@ -524,19 +524,19 @@
 		if (selectedItem==mnuDeleteTB && selectedRow>=0) {
 			tblMyTravelbugJourneys.remove(selectedRow);
 			modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
-			if (selectedRow>0) 
+			if (selectedRow>0)
 				cursorTo(selectedRow-1,0,true);
 			else
 				modTbJourneyList.showFields(new TravelbugJourney(""));
 			tcTbJourneyList.repaint();
 		}
 		/* Delete a group of travelbugs which have been marked with Shift-Click */
-		if (selectedItem==mnuDeleteTBs) {  
+		if (selectedItem==mnuDeleteTBs) {
 			Rect sel=getSelection(null);
 			for (int i=0; i<sel.height; i++)
 				tblMyTravelbugJourneys.remove(sel.y);
 			modTbJourneyList.numRows=tblMyTravelbugJourneys.size();
-			if (sel.y<modTbJourneyList.numRows) 
+			if (sel.y<modTbJourneyList.numRows)
 				cursorTo(sel.y,0,true);
 			else
 				modTbJourneyList.showFields(new TravelbugJourney(""));
@@ -546,7 +546,7 @@
 			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
 			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile(),false);
 			Form.showWait();
-			
+
 			//if we have an ID, get mission by ID
 			if (tbj.getTb().getGuid().length()!=0) {
 				tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
@@ -565,7 +565,7 @@
 					}
 				}
 			}
-			
+
 			Form.cancelWait();
 			tcTbJourneyList.repaint();
 			txtMission.setHtml(tbj.getTb().getMission());
@@ -587,9 +587,9 @@
 						s = "\""+Global.getPref().browser+"\" \"http://www.geocaching.com/track/details.aspx?guid="+tbj.getTb().getGuid()+"\"";
 					else
 						s = "\""+Global.getPref().browser+"\" \"http://www.geocaching.com/track/details.aspx?id="+tbj.getTb().getGuid()+"\"";
-									
+
 					Vm.execCommandLine(s);
-					Global.getPref().log("Executing: "+s); 
+					Global.getPref().log("Executing: "+s);
 				} catch (Exception ioex) {
 				}
 			}
@@ -599,7 +599,7 @@
 		}
 		updateNumBugs();
 	}
-	
+
 	/** Toggle between displaying all journeys or just those which still need to be logged */
 	public void toggleNonLogged() {
 		mnuToggleList.modifiers^=MenuItem.Checked;
@@ -613,12 +613,12 @@
 		}
 		tcTbJourneyList.repaint();
 	}
-	
-	
+
+
 	public void cursorTo(int row,int col,boolean selectNew) {
 		super.cursorTo(row,col,selectNew);
 		selectedRow=row;
-		if (row>=0) { 
+		if (row>=0) {
 			modTbJourneyList.showFields(tblMyTravelbugJourneys.getTBJourney(row));
 		} else {
 			modTbJourneyList.showFields(new TravelbugJourney(""));



From salzkammergut at mail.berlios.de  Sun Feb 15 23:09:49 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 15 Feb 2009 23:09:49 +0100
Subject: [Cachewolf-svn] r1633 - experiments/EVEhist/src/cachewolf/imp
Message-ID: <200902152209.n1FM9np9023310@sheep.berlios.de>

Author: salzkammergut
Date: 2009-02-15 23:09:47 +0100 (Sun, 15 Feb 2009)
New Revision: 1633

Modified:
   experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
Log:
OCXMLImporter: Distance specification must not contain a comma => replace it with decimal point.

Modified: experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java
===================================================================
--- experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-15 22:01:31 UTC (rev 1632)
+++ experiments/EVEhist/src/cachewolf/imp/OCXMLImporter.java	2009-02-15 22:09:47 UTC (rev 1633)
@@ -182,7 +182,7 @@
 		Form.showWait();
 		String dist = importOpt.distanceInput.getText();
 		if (dist.length()== 0) return;
-		dist=MyLocale.formatDouble(Common.parseDouble(dist),"00.0");
+		dist=MyLocale.formatDouble(Common.parseDouble(dist),"00.0").replace(',', '.');
 		//check, if distance is greater than before
 		if (Convert.toInt(dist) > Convert.toInt(profile.distOC) ||
 				pref.downloadmissingOC  ){



From pfeffer at mail.berlios.de  Sun Feb 15 23:23:13 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 15 Feb 2009 23:23:13 +0100
Subject: [Cachewolf-svn] r1634 - experiments/EVEhist/src/eveWorkArounds
Message-ID: <200902152223.n1FMNDj4025356@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-15 23:23:12 +0100 (Sun, 15 Feb 2009)
New Revision: 1634

Modified:
   experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java
Log:
make the work-around work more generally

Modified: experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java
===================================================================
--- experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java	2009-02-15 22:09:47 UTC (rev 1633)
+++ experiments/EVEhist/src/eveWorkArounds/TimeWorkArounds.java	2009-02-15 22:23:12 UTC (rev 1634)
@@ -4,14 +4,18 @@
 
 public class TimeWorkArounds extends Time {
 	public void parse(String dateValue,String dateFormat) throws IllegalArgumentException {
-		StringBuffer tmp = new StringBuffer(dateValue.length()+5);
-		tmp.append(dateValue.substring(0, 4)).append(" ");
-		tmp.append(dateValue.substring(4, 6)).append(" ");
-		tmp.append(dateValue.substring(6, 8)).append(" ");
-		tmp.append(dateValue.substring(8, 10)).append(" ");
-		tmp.append(dateValue.substring(10,12)).append(" ");
-		tmp.append(dateValue.substring(12, 14));
-		super.parse(tmp.toString(), dateFormat);
+		if (dateFormat.equals("yyyyMMddHHmmss")) {
+			StringBuffer tmp = new StringBuffer(dateValue.length()+5);
+			tmp.append(dateValue.substring(0, 4));
+			tmp.append(" ").append(dateValue.substring(4, 6));
+			tmp.append(" ").append(dateValue.substring(6, 8));
+			tmp.append(" ").append(dateValue.substring(8, 10));
+			tmp.append(" ").append(dateValue.substring(10,12));
+			tmp.append(" ").append(dateValue.substring(12,14));
+			super.parse(tmp.toString(), dateFormat);
+		} else {
+			super.parse(dateValue, dateFormat);
+		}
 	}
 
 }



From engywuck at mail.berlios.de  Wed Feb 18 10:52:56 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Wed, 18 Feb 2009 10:52:56 +0100
Subject: [Cachewolf-svn] r1635 - trunk/src/CacheWolf
Message-ID: <200902180952.n1I9qusI012120@sheep.berlios.de>

Author: engywuck
Date: 2009-02-18 10:52:44 +0100 (Wed, 18 Feb 2009)
New Revision: 1635

Modified:
   trunk/src/CacheWolf/CWPoint.java
Log:
Using letters N and E when displaying invalid coordinates. (http://www.geoclub.de/viewtopic.php?f=40&t=31450)

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2009-02-15 22:23:12 UTC (rev 1634)
+++ trunk/src/CacheWolf/CWPoint.java	2009-02-18 09:52:44 UTC (rev 1635)
@@ -438,14 +438,22 @@
 	 * Get "N" or "S" letter for latitude
 	 */
 	public String getNSLetter() {
-		return 	this.latDec < 0?"S":"N";
+            String result = "N";
+            if (this.latDec >= -90 && this.lonDec < 0) {
+                result = "S";
+            }
+            return  result;
 	}
 
 	/**
 	 * Get "E" or "W" letter for latitude
 	 */
 	public String getEWLetter() {
-		return  this.lonDec < 0?"W":"E";
+	    String result = "E";
+	    if (this.lonDec >= -180 && this.lonDec < 0) {
+	        result = "W";
+	    }
+	    return  result;
 	}
 
 	/**



From engywuck at mail.berlios.de  Wed Feb 18 21:15:09 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Wed, 18 Feb 2009 21:15:09 +0100
Subject: [Cachewolf-svn] r1636 - experiments/EVEhist/src/cachewolf
Message-ID: <200902182015.n1IKF9DP012302@sheep.berlios.de>

Author: engywuck
Date: 2009-02-18 21:15:08 +0100 (Wed, 18 Feb 2009)
New Revision: 1636

Modified:
   experiments/EVEhist/src/cachewolf/CWPoint.java
Log:
Using letters N and E when displaying invalid coordinates. (http://www.geoclub.de/viewtopic.php?f=40&t=31450)

Modified: experiments/EVEhist/src/cachewolf/CWPoint.java
===================================================================
--- experiments/EVEhist/src/cachewolf/CWPoint.java	2009-02-18 09:52:44 UTC (rev 1635)
+++ experiments/EVEhist/src/cachewolf/CWPoint.java	2009-02-18 20:15:08 UTC (rev 1636)
@@ -444,14 +444,22 @@
 	 * Get "N" or "S" letter for latitude
 	 */
 	public String getNSLetter() {
-		return 	this.latDec < 0?"S":"N";
-	}
+        String result = "N";
+        if (this.latDec >= -90 && this.lonDec < 0) {
+            result = "S";
+        }
+        return  result;
+}
 
 	/**
 	 * Get "E" or "W" letter for latitude
 	 */
 	public String getEWLetter() {
-		return  this.lonDec < 0?"W":"E";
+		String result = "E";
+		if (this.lonDec >= -180 && this.lonDec < 0) {
+			result = "W";
+		}
+		return  result;
 	}
 
 	/**



From natureshadow at mail.berlios.de  Sat Feb 21 00:57:14 2009
From: natureshadow at mail.berlios.de (natureshadow at mail.berlios.de)
Date: Sat, 21 Feb 2009 00:57:14 +0100
Subject: [Cachewolf-svn] r1637 - experiments/EVEhist/programs
Message-ID: <200902202357.n1KNvE9r009936@sheep.berlios.de>

Author: natureshadow
Date: 2009-02-21 00:57:12 +0100 (Sat, 21 Feb 2009)
New Revision: 1637

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
Added new package t osnapshot script.


Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-18 20:15:08 UTC (rev 1636)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-20 23:57:12 UTC (rev 1637)
@@ -20,7 +20,7 @@
 mkdir -p bin/cachewolf
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
     -cp lib/CompileEve.zip:lib/JavaEve.zip:lib/lib-folder -d bin \
-    -deprecation -nowarn src/cachewolf/*.java src/cachewolf/*/*.java
+    -deprecation -nowarn src/eveWorkArounds/*.java src/cachewolf/*.java src/cachewolf/*/*.java
 
 echo Linking executables ...
 cd programs



From pfeffer at mail.berlios.de  Sat Feb 21 01:04:03 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 21 Feb 2009 01:04:03 +0100
Subject: [Cachewolf-svn] r1638 - experiments/EVEhist/programs
Message-ID: <200902210004.n1L043mI014646@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-21 01:04:00 +0100 (Sat, 21 Feb 2009)
New Revision: 1638

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
Eve-Build: include the copied packages in order to make CW run on VGA-PDAs

Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-20 23:57:12 UTC (rev 1637)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-21 00:04:00 UTC (rev 1638)
@@ -20,7 +20,7 @@
 mkdir -p bin/cachewolf
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
     -cp lib/CompileEve.zip:lib/JavaEve.zip:lib/lib-folder -d bin \
-    -deprecation -nowarn src/eveWorkArounds/*.java src/cachewolf/*.java src/cachewolf/*/*.java
+    -deprecation -nowarn src/eveWorkArounds/*.java eve/*.java eve/*/*.java src/cachewolf/*.java src/cachewolf/*/*.java
 
 echo Linking executables ...
 cd programs



From pfeffer at mail.berlios.de  Sat Feb 21 02:25:05 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 21 Feb 2009 02:25:05 +0100
Subject: [Cachewolf-svn] r1639 - experiments/EVEhist/src/cachewolf/navi
Message-ID: <200902210125.n1L1P5fl014956@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-21 02:25:01 +0100 (Sat, 21 Feb 2009)
New Revision: 1639

Modified:
   experiments/EVEhist/src/cachewolf/navi/MovingMap.java
Log:
Eve: MovingMap: transparency in distanceImage and ScaleImage implemented - but maybe it can be optimized by making Image a member of MovingMap, in order to avoid recreation of Image by getDrawingBuffer()

Modified: experiments/EVEhist/src/cachewolf/navi/MovingMap.java
===================================================================
--- experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-02-21 00:04:00 UTC (rev 1638)
+++ experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-02-21 01:25:01 UTC (rev 1639)
@@ -67,10 +67,11 @@
 	AniImage buttonImageLensActivatedZoomIn;
 	AniImage buttonImageLensActivatedZoomOut;
 	AniImage buttonImageZoom1to1;
-	AniImage DistanceImage;
-	Graphics DistanceImageGraphics;
+	Image distanceImage;
+	AniImage distanceAniImage;
+	PixelBuffer distanceImagePxBuffer;
 	AniImage ScaleImage;
-	Graphics ScaleImageGraphics;
+	PixelBuffer ScaleImagePxBuffer;
 	MapSymbol posCircle;
 	String MARK_CACHE_IMAGE;
 	int posCircleX = 0, posCircleY = 0, lastCompareX = Integer.MAX_VALUE, lastCompareY = Integer.MAX_VALUE;
@@ -155,17 +156,14 @@
 		int fontSize = ( 3 * pref.fontSize ) / 2;
 		Font font = new Font("Helvetica", Font.PLAIN, fontSize );
 		fm = getFontMetrics(font);
-		DistanceImage = new AniImage();
-		DistanceImage.setImage(new Image(MyLocale.getScreenWidth()/2, fm.getHeight()).getImageData()); //, Color.White); // consider the size of the font used
-		DistanceImageGraphics = new Graphics((Image)DistanceImage.getImage());
-		DistanceImageGraphics.setFont(font);
-		DistanceImage.properties = AniImage.AlwaysOnTop;
-		mmp.addImage(DistanceImage);
+//		distanceImage = //, Color.White); // consider the size of the font used
+		distanceAniImage = new AniImage();
+		distanceAniImage.setImage(new Image(MyLocale.getScreenWidth()/2, fm.getHeight()));
+		distanceAniImage.properties = AniImage.AlwaysOnTop;
+		mmp.addImage(distanceAniImage);
 		//scale
 		ScaleImage = new AniImage();
 		ScaleImage.setImage(new Image(MyLocale.getScreenWidth()/2, fm.getHeight()).getImageData()); //, Color.White); // consider the size of the font used
-		ScaleImageGraphics = new Graphics((Image)ScaleImage.getImage());
-		ScaleImageGraphics.setFont(font);
 		ScaleImage.properties = AniImage.AlwaysOnTop;
 		mmp.addImage(ScaleImage);
 		//resizeTo(pref.myAppWidth, pref.myAppWidth); // is necessary to initialise mapImage.screenSize
@@ -177,7 +175,7 @@
 		//updateDistance(); // fill Rect with transparent color
 		scaleWanted = 1;
 		mapChangeModus = HIGHEST_RESOLUTION_GPS_DEST;
-	 	lastHighestResolutionGPSDestScale = -1;
+		lastHighestResolutionGPSDestScale = -1;
 
 		lastRepaintMapPos = new Point(pref.myAppWidth +1, pref.myAppHeight +1);
 	}
@@ -198,7 +196,7 @@
 		buttonImageLensActivated.setLocation(w - buttonImageLensActivated.getWidth()-10, h/2 - buttonImageLensActivated.getHeight()/2 );
 		buttonImageLensActivatedZoomIn.setLocation(w - buttonImageLensActivatedZoomIn.getWidth()-10, h/2 - buttonImageLensActivatedZoomIn.getHeight()/2 );
 		buttonImageLensActivatedZoomOut.setLocation(w - buttonImageLensActivatedZoomOut.getWidth()-10, h/2 - buttonImageLensActivatedZoomOut.getHeight()/2 );
-		DistanceImage.setLocation(0, h - DistanceImage.getHeight());
+		distanceAniImage.setLocation(0, h - distanceAniImage.getHeight());
 		ScaleImage.setLocation(w - ScaleImage.getWidth(), h - ScaleImage.getHeight());
 		if (mmp.mapImage != null) mmp.mapImage.screenDimChanged();
 		if (posCircle != null) posCircle.screenDimChanged();
@@ -241,7 +239,7 @@
 
 	public void updateScale() {
 		//TODO ScaleImageGraphics.setColor(ScaleImage.transparentColor);
-		ScaleImageGraphics.fillRect(0, 0, ScaleImage.location.width,ScaleImage.location.height);
+		if (ScaleImagePxBuffer == null) ScaleImagePxBuffer = new PixelBuffer(ScaleImage);
 
 		if (currentMap != null)
 		{
@@ -252,15 +250,11 @@
 
 			String lineLengthString;
 			if (lineLengthMeters < 1000)
-			{
-				lineLengthString = Convert.toString((int) lineLengthMeters) + "m";
-			}
-			else
-			{
-				lineLengthString = Convert.toString((int) lineLengthMeters / 1000) + "km";
-			}
+				   lineLengthString = Convert.toString((int) lineLengthMeters) + "m";
+			else   lineLengthString = Convert.toString((int) lineLengthMeters / 1000) + "km";
 
 			int backgroundStartX = ScaleImage.location.width - (lineLengthPixels + fm.getTextWidth(lineLengthString) + 7);
+			Graphics ScaleImageGraphics = ScaleImagePxBuffer.getDrawingBuffer(null, null, 1); // this creates a new Image filled with a transparent color
 
 			ScaleImageGraphics.setColor(new Color(250,250,250));
 			ScaleImageGraphics.fillRect(backgroundStartX, 0, ScaleImage.location.width - backgroundStartX ,ScaleImage.location.height);
@@ -268,57 +262,47 @@
 			ScaleImageGraphics.changePen(Color.DarkBlue,Pen.SOLID,3);
 			ScaleImageGraphics.drawLine(backgroundStartX + 2, ScaleImage.location.height / 2, backgroundStartX+2+lineLengthPixels, ScaleImage.location.height / 2);
 			ScaleImageGraphics.setColor(Color.DarkBlue);
+			ScaleImageGraphics.setFont(fm.getFont());
 			ScaleImageGraphics.drawText(lineLengthString , backgroundStartX + lineLengthPixels + 5, 0);
 		}
-
-		ScaleImageGraphics.drawImageData(ScaleImage.getImageData(),new Rect(0,0,ScaleImage.location.width,ScaleImage.location.height),new Rect(0,0,ScaleImage.location.width,ScaleImage.location.height),0); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed  Color.LightBlue,0,0,
-		ScaleImageGraphics.drawImageData(ScaleImage.getImageData(),new Rect(0,0,ScaleImage.location.width,ScaleImage.location.height),new Rect(0,0,ScaleImage.location.width,ScaleImage.location.height),0); // these 2 commands are necessary because of a bug or near to a bug in the eve-vm
+		ScaleImagePxBuffer.putDrawingBuffer(PixelBuffer.PUT_SET);
+		ScaleImage.setImage(ScaleImagePxBuffer);
 	}
-
+	
 	public void updateDistance(boolean repaint) {
-		//TODO DistanceImageGraphics.setColor(DistanceImage.transparentColor);
-		DistanceImageGraphics.fillRect(0, 0, DistanceImage.location.width,DistanceImage.location.height);
+		if (distanceImagePxBuffer == null) distanceImagePxBuffer = new PixelBuffer(distanceAniImage);
 		if (gotoPos != null && posCircle.where.isValid())
 		{
 			double currentDistance = gotoPos.where.getDistance(posCircle.where);
 			if (currentDistance != lastDistance)
 			{
 				lastDistance = currentDistance;
-				double dd=currentDistance;
+				double dd = currentDistance;
 				String d;
 				if (dd < 1) {
 					dd = dd * 1000;
 					d = MyLocale.getMsg(4206, "Dist: ") + Common.doubleToString(dd,0) + "m";
-					int digits = (int)java.lang.Math.floor( java.lang.Math.log(dd) / java.lang.Math.log(10.0) );
-					digits = java.lang.Math.max(0, digits);
-				}
-				else {
+				} else {
 					d = MyLocale.getMsg(4206, "Dist: ") + Common.doubleToString(dd,2) + "km";
-					int digits = (int)java.lang.Math.floor( java.lang.Math.log(dd) / java.lang.Math.log(10.0) );
-					digits = java.lang.Math.max(0, digits);
 				}
-
 				int backgroundWidth = fm.getTextWidth(d) + 4;
 
-				DistanceImageGraphics.setColor(new Color(250,250,250));
-				DistanceImageGraphics.fillRect(0, 0, backgroundWidth ,DistanceImage.location.height);
-
-				DistanceImageGraphics.setColor(Color.DarkBlue);
-				DistanceImageGraphics.drawText(d, 2, 0);
-
-				DistanceImageGraphics.drawImageData(DistanceImage.getImageData(),null,new Rect(0,0,DistanceImage.location.width,DistanceImage.location.height),0); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed
-				DistanceImageGraphics.drawImageData(DistanceImage.getImageData(),null,new Rect(0,0,DistanceImage.location.width,DistanceImage.location.height),0); // these 2 commands are necessary because of a bug or near to a bug in the eve-vm
-				if (repaint)
-				{
-					//TODO DistanceImage.updateImage();
-				}
+				Graphics gt = distanceImagePxBuffer.getDrawingBuffer(null, null, 1); // this creates a new Image filled with a transparent color
+				gt.setColor(new Color(250,250,250));
+				gt.fillRect(0, 0, backgroundWidth, distanceAniImage.location.height);
+				gt.setColor(Color.DarkBlue);
+				gt.setFont(fm.getFont());
+				gt.drawText(d, 2, 0);
+				distanceImagePxBuffer.putDrawingBuffer(PixelBuffer.PUT_SET);
+				distanceAniImage.setImage(distanceImagePxBuffer);
 			}
 		}
 		else
 		{
-			Rect area=new Rect(0,0,DistanceImage.location.width,DistanceImage.location.height);
-			DistanceImageGraphics.drawImageData(DistanceImage.getImageData(),area,area,0); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed Color.LightBlue,
-			DistanceImageGraphics.drawImageData(DistanceImage.getImageData(),area,area,0); // these 2 commands are necessary because of a bug or near to a bug in the eve-vm
+			distanceImagePxBuffer.clear();
+			//ttt = new PixelBuffer(distanceAniImage);
+			// ttt.clear(); // make it completely transparent
+			distanceAniImage.setImage(distanceImagePxBuffer);
 		}
 	}
 
@@ -1003,7 +987,7 @@
 			} catch (IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4209, "setBestMap: problem in: setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), lat, lon) lat/lon:") + where.toString(), MessageBox.OKB)).exec(); }
 			while (currentMap == null) { // this actually cannot happen, but maybe in case of an inconstistent code change (esp. regarding empty maps)
 				mmp.chooseMap(); // force the user to select a scale
-				 if (currentMap == null) (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4210, "Moving map cannot run without a map - please select one. \n You can select an empty map"), MessageBox.OKB)).execute();
+				if (currentMap == null) (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4210, "Moving map cannot run without a map - please select one. \n You can select an empty map"), MessageBox.OKB)).execute();
 			}
 		}
 		inBestMap = false;
@@ -1096,7 +1080,7 @@
 		if (newmap == null) { // no map is covering any area of the caches -> zoom an empty map to cover all caches on screen
 			try {
 				Object [] s = getRectForMapChange(posCircle.where);
-			//	CWPoint cll = (CWPoint) s[0];
+				//	CWPoint cll = (CWPoint) s[0];
 				Rect screen = (Rect) s[1];
 				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.buttomright.lonDec) * 1000 / (screen.width-15)); // 15 for the size of the cache image
 				float neededscaley = (float) (sur.topleft.getDistance(sur.buttomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height-15)); // 15 for the size of the cache image
@@ -1378,7 +1362,7 @@
 										mapImage1to1.getImageData(),
 										(int) (newImageRect.width*zoomFactor),
 										(int)(newImageRect.height*zoomFactor),0).getImageData(),0
-										)); //, newImageRect, 0));
+						)); //, newImageRect, 0));
 				currentMap.zoom(zoomFactor, newImageRect.x, newImageRect.y);
 			} catch (OutOfMemoryError e) {
 				(new MessageBox(MyLocale.getMsg(4207, "Error"),
@@ -1480,7 +1464,7 @@
 
 	public boolean imageBeginDragged(AniImage which,Point pos) {
 		if (mm.zoomingMode == true) { // zoom
-//			saveMapLoc = pos;
+			//			saveMapLoc = pos;
 			//		saveGpsIgnoreStatus = mm.ignoreGps;
 			//	mm.ignoreGps = true;
 			return false;
@@ -1615,7 +1599,7 @@
 		else gpspos = null;
 		ListBox l = new ListBox(mm.maps, gpspos, mm.getGotoPos(), mm.currentMap);
 		if(l.execute() == FormBase.IDOK){
-//			Vm.debug("Trying map: " + l.selectedMap.fileName);
+			//			Vm.debug("Trying map: " + l.selectedMap.fileName);
 			mm.autoSelectMap = false;
 			if (l.selectedMap.isInBound(mm.posCircle.where) || l.selectedMap.getImageFilename().length()==0) {
 				mm.setMap(l.selectedMap, mm.posCircle.where);
@@ -1976,9 +1960,9 @@
 				mapNum = Convert.toInt(it);
 				//	Vm.debug("Kartennummer: " + mapNum);
 				try {
-				selectedMap = ((MapListEntry)maps.get(mapNum)).getMap();
-				selected = true;
-				this.close(FormBase.IDOK);
+					selectedMap = ((MapListEntry)maps.get(mapNum)).getMap();
+					selected = true;
+					this.close(FormBase.IDOK);
 				} catch (IOException e) {
 					(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4278, "Cannot load wfl-file: \n")
 							+ ((MapListEntry)maps.get(mapNum)).filename, MessageBox.OKB)).execute();
@@ -2030,7 +2014,7 @@
 	Point[] northDirArrow = null;
 	int imageSize = Global.getPref().fontSize * 8;
 	int arrowThickness = imageSize / 28;
-	
+
 	/**
 	 * @param gd goto direction
 	 * @param sd sun direction
@@ -2076,7 +2060,7 @@
 		if (map == null || g == null) return;
 		drawArrows(g);
 		return;
-/*		if (!dirsChanged) {
+		/*		if (!dirsChanged) {
 			g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height); // the transparency with a transparent color doesn't work in eve-vm for pocketpc, it works in java-vm, eve-vm on pocketpc2003
 			return;
 		}
@@ -2088,56 +2072,56 @@
 		drawArrows(draw);
 		draw.drawImage(image,mask,Color.DarkBlue,0,0,location.width,location.height); // this trick (note: wrong transparentColor) forces a redraw
 		g.drawImage(image,mask,transparentColor,0,-minY,location.width,location.height);
-*/	}
+		 */	}
 
 	private void makeArrows(){
-			// draw only valid arrows
-			if (moveDir < 360 && moveDir > -360) {
-				if (moveDirArrow == null) moveDirArrow = new Point[2];
-				makeArrow(moveDirArrow, moveDir, 1.0f);
-			} else moveDirArrow = null;
-			if (gotoDir < 360 && gotoDir > -360) {
-				if (gotoDirArrow == null) gotoDirArrow = new Point[2];
-				makeArrow(gotoDirArrow, gotoDir, 1.0f);
-			} else gotoDirArrow = null;
-			if (sunDir < 360 && sunDir> -360) {
-				if (sunDirArrow == null ) sunDirArrow = new Point[2];
-				makeArrow(sunDirArrow, sunDir, 0.75f);
-			} else sunDirArrow = null;
-			if (java.lang.Math.abs(map.rotationRad) > 1.5 / 180 * java.lang.Math.PI)	{ // show northth arrow only if it has more than 1.5 degree deviation from vertical direction
-				if (northDirArrow == null) northDirArrow = new Point[2];
-				makeArrow(northDirArrow, 0, 1.0f); // north direction
-			} else northDirArrow = null;
+		// draw only valid arrows
+		if (moveDir < 360 && moveDir > -360) {
+			if (moveDirArrow == null) moveDirArrow = new Point[2];
+			makeArrow(moveDirArrow, moveDir, 1.0f);
+		} else moveDirArrow = null;
+		if (gotoDir < 360 && gotoDir > -360) {
+			if (gotoDirArrow == null) gotoDirArrow = new Point[2];
+			makeArrow(gotoDirArrow, gotoDir, 1.0f);
+		} else gotoDirArrow = null;
+		if (sunDir < 360 && sunDir> -360) {
+			if (sunDirArrow == null ) sunDirArrow = new Point[2];
+			makeArrow(sunDirArrow, sunDir, 0.75f);
+		} else sunDirArrow = null;
+		if (java.lang.Math.abs(map.rotationRad) > 1.5 / 180 * java.lang.Math.PI)	{ // show northth arrow only if it has more than 1.5 degree deviation from vertical direction
+			if (northDirArrow == null) northDirArrow = new Point[2];
+			makeArrow(northDirArrow, 0, 1.0f); // north direction
+		} else northDirArrow = null;
 
-			//select moveDirColor according to difference to gotoDir
-			moveDirColor = new Color(255,0,0); // red
+		//select moveDirColor according to difference to gotoDir
+		moveDirColor = new Color(255,0,0); // red
 
-			if (moveDirArrow != null && gotoDirArrow != null)
+		if (moveDirArrow != null && gotoDirArrow != null)
+		{
+			float diff = java.lang.Math.abs(moveDir - gotoDir);
+			while (diff > 360)
 			{
-				float diff = java.lang.Math.abs(moveDir - gotoDir);
-				while (diff > 360)
-				{
-					diff -= 360.0f;
-				}
-				if (diff > 180)
-				{
-					diff = 360.0f - diff;
-				}
+				diff -= 360.0f;
+			}
+			if (diff > 180)
+			{
+				diff = 360.0f - diff;
+			}
 
-				if (diff <= 5.0)
-				{
-					moveDirColor = new Color(0,192,0);// darkgreen
-				}
-				else if (diff <= 22.5)
-				{
-					moveDirColor = new Color(0,255,0);// green
-				}
-				else if (diff <= 45.0)
-				{
-					moveDirColor = new Color(255,128,0);// orange
-				}
+			if (diff <= 5.0)
+			{
+				moveDirColor = new Color(0,192,0);// darkgreen
 			}
+			else if (diff <= 22.5)
+			{
+				moveDirColor = new Color(0,255,0);// green
+			}
+			else if (diff <= 45.0)
+			{
+				moveDirColor = new Color(255,128,0);// orange
+			}
 		}
+	}
 
 	/**
 	 * make (calculate) Pixel array for a single arrow



From pfeffer at mail.berlios.de  Sat Feb 21 03:57:07 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 21 Feb 2009 03:57:07 +0100
Subject: [Cachewolf-svn] r1640 - experiments/EVEhist/src/cachewolf/navi
Message-ID: <200902210257.n1L2v71X030657@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-21 03:57:05 +0100 (Sat, 21 Feb 2009)
New Revision: 1640

Modified:
   experiments/EVEhist/src/cachewolf/navi/MovingMap.java
   experiments/EVEhist/src/cachewolf/navi/TrackOverlay.java
Log:
Eve: MovingMap: Transparency for the overlay showing the track (noch unfertig)

Modified: experiments/EVEhist/src/cachewolf/navi/MovingMap.java
===================================================================
--- experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-02-21 01:25:01 UTC (rev 1639)
+++ experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-02-21 02:57:05 UTC (rev 1640)
@@ -156,7 +156,6 @@
 		int fontSize = ( 3 * pref.fontSize ) / 2;
 		Font font = new Font("Helvetica", Font.PLAIN, fontSize );
 		fm = getFontMetrics(font);
-//		distanceImage = //, Color.White); // consider the size of the font used
 		distanceAniImage = new AniImage();
 		distanceAniImage.setImage(new Image(MyLocale.getScreenWidth()/2, fm.getHeight()));
 		distanceAniImage.properties = AniImage.AlwaysOnTop;
@@ -1102,7 +1101,7 @@
 		dontUpdatePos = false;
 		ignoreGps = false;
 		switch (status) {
-		case noGPS: 	{ posCircle.change(null); ignoreGps = true; break; }
+		case noGPS: 	{ posCircle.change(null); ignoreGps = true; break; } // TODO this causes a nullPointerExceptionin Eve
 		case gotFix:    { posCircle.change(statusImageHaveSignal); break; }
 		case lostFix:   { posCircle.change(statusImageNoSignal); break; }
 		case noGPSData: { posCircle.change(statusImageNoGps); break; }

Modified: experiments/EVEhist/src/cachewolf/navi/TrackOverlay.java
===================================================================
--- experiments/EVEhist/src/cachewolf/navi/TrackOverlay.java	2009-02-21 01:25:01 UTC (rev 1639)
+++ experiments/EVEhist/src/cachewolf/navi/TrackOverlay.java	2009-02-21 02:57:05 UTC (rev 1640)
@@ -4,9 +4,12 @@
 
 import eve.fx.Color;
 import eve.fx.Graphics;
+import eve.fx.ImageObject;
+import eve.fx.PixelBuffer;
 
 import eve.fx.Image;
 import eve.fx.Point;
+import eve.ui.advanced.database.GetSearchCriteria;
 
 import java.util.Vector;
 
@@ -14,76 +17,23 @@
 public class TrackOverlay extends MapImage {
 	public TrackPoint topLeft;
 	public TrackPoint bottomRight;
-	Graphics draw;
-	//Graphics drawMask;
-	//int test;
+	ImageObject drawImage;
 	MapInfoObject trans; 
 	Point pixelShift;
 	public Vector tracks;
-	boolean imageChangesDontShow = false;
-	public Point trackPixels[] = null;
-	public Color trackPixelsColor[] = null;
-	public int numPixels = 0;
-	final static int maxPixelsInCache = 100;
-	final static Color transparentColorForOverlay = Color.White; // only for use when transparent color is used
-	static boolean useTransparentColor;
 	public TrackOverlay (TrackPoint topLefti, int widthi, int highti, MapInfoObject transi) {
 		super();
 		topLeft = new TrackPoint(topLefti);
 		trans = transi;
 		pixelShift = trans.calcMapXY(topLeft);
 		bottomRight = trans.calcLatLon(widthi + pixelShift.x, highti + pixelShift.y);
-//TODO		if (eve.sys.Vm.getPlatform().equalsIgnoreCase("java")) {
-//			useTransparentColor = true; 
-//			setImage(new Image(widthi, highti), transparentColorForOverlay); // java-vm: transparency with a mask is very memory consuming, but transparency with a mask is much faster in eve-vm and doesn't consume more memory than a transparency color (eve 1.49)
-//		} else 
-		{
-			useTransparentColor = false; // // momentanously this it not used, but this is only because eve treats areas as opaque which has a non white color in the image, so that the mask doesn't need to be changed
-			//Image maski = new Image(widthi, highti);
-			//drawMask = new Graphics(maski);
-			//drawMask.setColor(Color.White);
-			//drawMask.fillRect(0, 0, maski.getWidth(), maski.getHeight());
-			setImage(new Image(widthi, highti), Color.White); // java-vm: transparency with a mask is very memory consuming, but transparency with a mask is much faster in eve-vm and doesn't consume more memory than a transparency color (eve 1.49)
-			//maski.free(); //setimage produces an inverted copy of the mask
-			//maski = null;
-		}
-		//properties = AlwaysOnTop; // arrows are above, so dont set it.
-		draw = new Graphics((Image) image);
-		draw.setDrawOp(Graphics.DRAW_OVER);
-		if (useTransparentColor) draw.setColor(transparentColorForOverlay);
-		else draw.setColor(Color.White);
-		draw.fillRect(0, 0, widthi, highti);
-		//int[] markImage = {0x00ff0000, 0x00ff0000, 0x00ff0000, 0x00ff0000};
-		//int[] markMaskOpaque = {0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff};
-		//mask.setPixels( markMaskOpaque, 0, 50, 50, 2, 2, 0);
-		//draw.fillRectRGB(50, 50, 52, 52, 0x00ff0000); // fillRectRGB has a Bug - it never returns - use fillRect instead
-		//image.setPixels(markImage, 0, 50, 50, 2, 2, 0); // out of an to me unkwon reason this doesn't work here, but it does in painttracks
+		drawImage = new PixelBuffer(widthi, highti);
+		setImage(drawImage); //, Color.White); // java-vm: transparency with a mask is very memory consuming, but transparency with a mask is much faster in eve-vm and doesn't consume more memory than a transparency color (eve 1.49)
+		changed();
 	}
 
-//TODO ImageSet is not used in project	
-/*	public void imageSet()
-//	==================================================================
-	{
-		IImage i = drawable;
-		if (i == null) i = image;
-		if (i != null){
-			location.width = i.getWidth();
-			location.height = i.getHeight();
-		}
-		if (image != null && image != sourceImage) image.freeze();
-//		if (mask != null && mask != sourceMask) mask.freeze(); // dont freeze the mask, it could change. Anyway momentanously it doesnt change, because when the image contains non-white in the opaque areas, it will be opaque without changing the mask
-		properties &= ~HasChanged;
-	}
-*/
 
 	public void paintTracks() {
-	// for debugging TrackOverlayPositions
-	// draw.setPen(new Pen(Color.LightBlue,Pen.SOLID,1));
-	// draw.fillRect(1, 1, image.getWidth()-1, image.getHeight()-1);
-		//draw.setColor(255,0,0);
-		//draw.setPen(new Pen(new Color(255,0,0),Pen.SOLID,3));
-		//draw.fillRect(50, 50, 4, 4); // fillRectRGB has a Bug - it never returns - use fillRect instead
-
 		if (tracks == null || tracks.size() == 0) return;
 		int tri, i;
 		Track tr;
@@ -93,11 +43,9 @@
 			numberOfPoints += (numberOfTracks - 1) * ((Track)tracks.get(0)).num;
 		}
 		int n = 0;
-		
+
 		for (tri=0; tri < numberOfTracks; tri++) {
 			tr = (Track)tracks.get(tri);
-			//draw.setPen(new Pen((Color) tr.trackColor,Pen.SOLID,3));
-			draw.setColor(tr.trackColor);
 			if (tr.num > 0) {
 				for (i=0; i < tr.num; i++) {
 					n++;
@@ -108,8 +56,8 @@
 			}
 		}
 	}
-	
 
+
 	/**
 	 * 
 	 * @param f
@@ -123,91 +71,29 @@
 		Point p = trans.calcMapXY(where);
 		int x = p.x - pixelShift.x;
 		int y = p.y - pixelShift.y;
-		//draw.drawLine(x, y, x, y);
 		//eve.sys.Vm.debug("showlastaddedpoint, x: "+x+"   y: "+y+"loc.x: "+location.x+"  loc.y:"+location.y);
-		draw.fillRect(x-1, y-1, 3, 3);
-		//drawMask.fillRect(x-1, y-1, 3, 3);
-		/*	if (image.bufferedImage != null) { // funktioniert gut, allerdings nur in der java-VM wenn eve.fx.Image.bufferedImage als public definiert
-			int yd;
-			for  (int xd=-1; xd<=1; xd++) {
-				for (yd=-1; yd<=1; yd++) {
-					((BufferedImage)image.bufferedImage).setRGB(x+xd, y+yd, -65536);
-				}
-			} */
-		if (imageChangesDontShow) {
-			try {addPixelIfNeccessary(x, y, f); }
-			catch (IndexOutOfBoundsException e) // thrown when there are more than pixels stored than possible
-			{ fixate();  }
-		}
+		//		draw.fillRect(x-1, y-1, 3, 3);
+		int[] bl = new int[3*3]; // TODO dies statisch machen
+		for (int i = 0 ; bl.length > i; i++)  bl[i] = f.toInt();
+		drawImage.setPixels(bl, 0, x-1, y-1, bl.length/3, 3, 0);
 		return true;
 	}
 
-	/**
-	 * this method forces eve to transfer the drawn points
-	 * from _awtImage to bufferedImage, which is drawn to the screen
-	 *
-	 */
-	private void fixate() {
-		if (numPixels == 0) return;
-		//	draw.drawImage(image,null,Color.DarkBlue,0,0,location.width,location.height); // changing the mask forces graphics to copy from image._awtImage to image.bufferedImage, which is displayed 
-		doDraw(draw,0);   // null, Color.Pink, 0, 0, 1, 1); // width and height is anyway ignored, evtl. testen,  
-		imageChangesDontShow = false;
-		removeAllPixels();
-	}
-
-	private void removeAllPixels() {
-		numPixels = 0;
-		trackPixels = null;
-		trackPixelsColor = null;
-	}
-
-	
 	public void addPixel(int x, int y, Color f) throws IndexOutOfBoundsException {
-		if (trackPixels==null) { trackPixels = new Point[maxPixelsInCache]; trackPixelsColor = new Color[maxPixelsInCache]; } 
-		trackPixels[numPixels] = new Point(x, y); // IndexOutOfBoundsException is handled in PaintPoint
-		trackPixelsColor[numPixels] = f.getCopy();
-		numPixels++;
 	}
 
 	public void addPixelIfNeccessary(int x, int y, Color f){
-		if (trackPixels != null) {
-			int ll =(numPixels<30 ? 0 : numPixels-30); // look in the last 50 added Pixels if the same Pixel is already in the list (for performance reasons dont look in the whole list)
-			for (int i=numPixels-1; i>=ll; i--) {
-				if (trackPixels[i].x == x && trackPixels[i].y == y && f.equals(trackPixelsColor[i])) 
-				{ return; } 
-			}
-		}
 		addPixel(x, y, f);
 	}
 
 	public static final int FIXATE_IF_NO_PIXELS_NUM = 60;
-	private int notOnThisOverlaySince = 0;
 
 	public void paintLastAddedPoint(Track tr) { 
-		//draw.setPen(new Pen((Color) tr.trackColor,Pen.SOLID,3));
-		draw.setColor(tr.trackColor);
-		if (paintPoint(tr.trackColor, tr.trackPoints[tr.num-1])) notOnThisOverlaySince = 0;
-		else notOnThisOverlaySince++;
-		if (notOnThisOverlaySince > FIXATE_IF_NO_PIXELS_NUM) { // zur Performanceverbesserung: wenn in den letzten 60 Updates keines mehr f?r dieses Overlay dabei war, Overlay Pixels fest schreiben, damit doDraw entlastet wird.
-			fixate();
-			notOnThisOverlaySince = 0;
-		}
-
+		paintPoint(tr.trackColor, tr.trackPoints[tr.num-1]);
 	}
 
 	public void doDraw(Graphics g,int options) { // this is automatically called when the image need to be (re-)drawn on the screen
 		super.doDraw(g, options);
-		imageChangesDontShow = true; // g.drawImage (in super) copies _awtImage into bufferedImage, any later changes to _awtImage dont show up until the mask or the image has changed - unfortunately bufferedImage is not accessable from outside
-		// draw trackpoints which were added after image changes don't show up on the screen
-		if (tracks == null || tracks.size() == 0) return;
-		int i;
-		for (i=0; i<numPixels; i++) {
-			g.setColor(trackPixelsColor[i]);
-			g.fillRect(trackPixels[i].x-1, trackPixels[i].y-1, 3, 3);
-		}
-		//g.drawText(Convert.toString(test), 10, 10);
-		//g.drawRect(10 + test, 10, 10, 10);
-		//test++;
 	}
 }
 



From admin at berlios.de  Sat Feb 21 10:35:31 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 21 Feb 2009 10:35:31 +0100 (CET)
Subject: [Bug #15299] GPX Exporter erzeugt ungültige Dateien
Message-ID: <200902210935.n1L9ZVQX019466@unicorn.berlios.de>

Bug #15299, was updated on 2009-Feb-21 10:35
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: greiol
Assigned to : none
Summary: GPX Exporter erzeugt ung?ltige Dateien

Details: Details und Patch siehe http://www.geoclub.de/viewtopic.php?f=40&t=31562

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15299&group_id=2211


From pfeffer at mail.berlios.de  Sat Feb 21 14:09:28 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 21 Feb 2009 14:09:28 +0100
Subject: [Cachewolf-svn] r1641 - experiments/EVEhist/programs
Message-ID: <200902211309.n1LD9SZh009181@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-21 14:09:27 +0100 (Sat, 21 Feb 2009)
New Revision: 1641

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
Eve-Build: let's see, if it works now

Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-21 02:57:05 UTC (rev 1640)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-21 13:09:27 UTC (rev 1641)
@@ -20,7 +20,7 @@
 mkdir -p bin/cachewolf
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
     -cp lib/CompileEve.zip:lib/JavaEve.zip:lib/lib-folder -d bin \
-    -deprecation -nowarn src/eveWorkArounds/*.java eve/*.java eve/*/*.java src/cachewolf/*.java src/cachewolf/*/*.java
+    -deprecation -nowarn src/eveWorkArounds/*.java eve/*/*.java src/cachewolf/*.java src/cachewolf/*/*.java
 
 echo Linking executables ...
 cd programs



From mirabilos at mail.berlios.de  Sat Feb 21 14:22:13 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Sat, 21 Feb 2009 14:22:13 +0100
Subject: [Cachewolf-svn] r1642 - experiments/EVEhist/programs
Message-ID: <200902211322.n1LDMDh8011247@sheep.berlios.de>

Author: mirabilos
Date: 2009-02-21 14:22:13 +0100 (Sat, 21 Feb 2009)
New Revision: 1642

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
? echo "This script must be run from inside the programs/ directory!"
  ? unnecessary, we can just cd to it
? use find(1) instead of enumerating, to solve the problems pfeffer
  and co. have with the building ? note that file names must not
  contain spaces or other fancy characters now!


Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-21 13:09:27 UTC (rev 1641)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-21 13:22:13 UTC (rev 1642)
@@ -1,12 +1,7 @@
 #!/bin/sh
 
-if [ ! -e snapshot.sh ]; then
-	echo "This script must be run from inside the programs/ directory!"
-	exit 1
-fi
+cd "$(dirname "$0")/.."
 
-cd ..
-
 echo Updating version number in code ...
 v=$(svn info | sed -n '/Revision: /s///p')
 # the '' below are so that svn doesn't ever fuck up _this_ file
@@ -20,7 +15,7 @@
 mkdir -p bin/cachewolf
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
     -cp lib/CompileEve.zip:lib/JavaEve.zip:lib/lib-folder -d bin \
-    -deprecation -nowarn src/eveWorkArounds/*.java eve/*/*.java src/cachewolf/*.java src/cachewolf/*/*.java
+    -deprecation -nowarn $(find eve src -name \*.java)
 
 echo Linking executables ...
 cd programs



From mirabilos at mail.berlios.de  Sat Feb 21 14:29:54 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Sat, 21 Feb 2009 14:29:54 +0100
Subject: [Cachewolf-svn] r1643 - experiments/EVEhist/programs
Message-ID: <200902211329.n1LDTsSX011963@sheep.berlios.de>

Author: mirabilos
Date: 2009-02-21 14:29:53 +0100 (Sat, 21 Feb 2009)
New Revision: 1643

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
? set locale to C so that non-German persons will understand the
  errors on http://pub.naturalnet.de/~cwnightly/CacheWolf-BE/zlog_snapshot.txt
? set $CPIO
? add some debugging output, to help further fix it


Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-21 13:22:13 UTC (rev 1642)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-21 13:29:53 UTC (rev 1643)
@@ -1,7 +1,15 @@
 #!/bin/sh
 
+export LC_ALL=C
+unset LANG LANGUAGE
 cd "$(dirname "$0")/.."
 
+set -x	# debug
+
+# note: you need paxmirabilis/mircpio for the below, for example
+# from https://www.freewrt.org/~tg/debs/dists/lenny/wtf/pkgs/mircpio/
+CPIO=$(which mircpio 2>/dev/null) || CPIO=cpio
+
 echo Updating version number in code ...
 v=$(svn info | sed -n '/Revision: /s///p')
 # the '' below are so that svn doesn't ever fuck up _this_ file
@@ -22,6 +30,15 @@
 java -cp evecl-gui.jar Eve EveMaker.eve -c ../deploy/cw-eve-pc.enf
 java -cp evecl-gui.jar Eve EveMaker.eve -c ../deploy/cw-eve-pda.enf
 
+echo ==================================================================
+echo DEBUGGING OUTPUT: list of files created?
+echo
+echo deploy; ls -la deploy
+echo
+echo published; ls -la published
+echo
+echo ==================================================================
+
 cd ..
 mkdir -p published/dat/attributes
 mkdir -p published/dat/webmapservices



From mirabilos at mail.berlios.de  Sat Feb 21 14:49:55 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Sat, 21 Feb 2009 14:49:55 +0100
Subject: [Cachewolf-svn] r1644 - experiments/EVEhist/programs
Message-ID: <200902211349.n1LDntmo014687@sheep.berlios.de>

Author: mirabilos
Date: 2009-02-21 14:49:55 +0100 (Sat, 21 Feb 2009)
New Revision: 1644

Modified:
   experiments/EVEhist/programs/snapshot.sh
Log:
it?s src/eve not eve ?

now someone must give the build process more memory


Modified: experiments/EVEhist/programs/snapshot.sh
===================================================================
--- experiments/EVEhist/programs/snapshot.sh	2009-02-21 13:29:53 UTC (rev 1643)
+++ experiments/EVEhist/programs/snapshot.sh	2009-02-21 13:49:55 UTC (rev 1644)
@@ -23,7 +23,7 @@
 mkdir -p bin/cachewolf
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
     -cp lib/CompileEve.zip:lib/JavaEve.zip:lib/lib-folder -d bin \
-    -deprecation -nowarn $(find eve src -name \*.java)
+    -deprecation -nowarn $(find src -name \*.java)
 
 echo Linking executables ...
 cd programs



From mirabilos at mail.berlios.de  Sat Feb 21 14:53:42 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Sat, 21 Feb 2009 14:53:42 +0100
Subject: [Cachewolf-svn] r1645 - trunk/src/CacheWolf/navi
Message-ID: <200902211353.n1LDrgoh015248@sheep.berlios.de>

Author: mirabilos
Date: 2009-02-21 14:53:41 +0100 (Sat, 21 Feb 2009)
New Revision: 1645

Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
commit untested diff that has been lying around in my tree since 2008-10-17:

Online Map download: when the given scale is too small or large,
not only display the dialogue box telling the user this fact, but
also adjust the value to the nearest possible valid value, so that
he just has to confirm again to make it work


Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-02-21 13:49:55 UTC (rev 1644)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-02-21 13:53:41 UTC (rev 1645)
@@ -303,7 +303,14 @@
 					scale = Convert.toFloat(scaleInputPerCache.getText());
 				}
 				if (scale < mapLoader.currentOnlineMapService.minscale || scale > mapLoader.currentOnlineMapService.maxscale) {
-					(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1830, "The selected online map service provides map in the scale from")+" " + mapLoader.currentOnlineMapService.minscale + MyLocale.getMsg(1831, " to")+" "+ mapLoader.currentOnlineMapService.maxscale +MyLocale.getMsg(1832, "\n please adjust 'Approx. meter pro pixel' accordingly"), FormBase.OKB)).execute();
+					if (scale < mapLoader.currentOnlineMapService.minscale) {
+						scaleInput.setText(Convert.toString(mapLoader.currentOnlineMapService.minscale));
+						scaleInputPerCache.setText(Convert.toString(mapLoader.currentOnlineMapService.minscale));
+					} else {
+						scaleInput.setText(Convert.toString(mapLoader.currentOnlineMapService.maxscale));
+						scaleInputPerCache.setText(Convert.toString(mapLoader.currentOnlineMapService.maxscale));
+					}
+					(new MessageBox(MyLocale.getMsg(321, "Error"), "! " + scale + "\n" + MyLocale.getMsg(1830, "The selected online map service provides map in the scale from") + " " + mapLoader.currentOnlineMapService.minscale + MyLocale.getMsg(1831, " to") + " " + mapLoader.currentOnlineMapService.maxscale + MyLocale.getMsg(1832, "\n please adjust 'Approx. meter pro pixel' accordingly"), FormBase.OKB)).execute();
 					return;
 				}
 				this.close(FormBase.IDOK); 



From pfeffer at mail.berlios.de  Sat Feb 21 18:17:00 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 21 Feb 2009 18:17:00 +0100
Subject: [Cachewolf-svn] r1646 - experiments/EVEhist/src/cachewolf/navi
Message-ID: <200902211717.n1LHH07c007866@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-21 18:16:59 +0100 (Sat, 21 Feb 2009)
New Revision: 1646

Modified:
   experiments/EVEhist/src/cachewolf/navi/MapImage.java
   experiments/EVEhist/src/cachewolf/navi/MovingMap.java
Log:
Eve: MovingMap should work now. There are still some bug which I don't know how to reproduce :-(

Modified: experiments/EVEhist/src/cachewolf/navi/MapImage.java
===================================================================
--- experiments/EVEhist/src/cachewolf/navi/MapImage.java	2009-02-21 13:53:41 UTC (rev 1645)
+++ experiments/EVEhist/src/cachewolf/navi/MapImage.java	2009-02-21 17:16:59 UTC (rev 1646)
@@ -52,7 +52,7 @@
 			properties &= ~AniImage.IsInvisible;
 		} else {
 			properties |= AniImage.IsInvisible;
-			super.move(0, 0);
+			super.setLocation(0, 0);
 		}
 	}
 

Modified: experiments/EVEhist/src/cachewolf/navi/MovingMap.java
===================================================================
--- experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-02-21 13:53:41 UTC (rev 1645)
+++ experiments/EVEhist/src/cachewolf/navi/MovingMap.java	2009-02-21 17:16:59 UTC (rev 1646)
@@ -1097,16 +1097,18 @@
 
 	public void setGpsStatus (int status) {
 		if (status == gpsStatus) return; // if ignoreGpsStatutsChanges == true than the Map is in manual-mode
+		if (gpsStatus == noGPS) 
+			mmp.addImage(posCircle);
 		gpsStatus = status;
 		dontUpdatePos = false;
 		ignoreGps = false;
 		switch (status) {
-		case noGPS: 	{ posCircle.change(null); ignoreGps = true; break; } // TODO this causes a nullPointerExceptionin Eve
+		case noGPS: 	{ mmp.removeImage(posCircle); ignoreGps = true; break; } // TODO doesn't always work: try: start MM, close it, stopp GPS, start MM
 		case gotFix:    { posCircle.change(statusImageHaveSignal); break; }
 		case lostFix:   { posCircle.change(statusImageNoSignal); break; }
 		case noGPSData: { posCircle.change(statusImageNoGps); break; }
 		}
-		mapMoved(0, 0); // positions the posCircle correctly accourding to its size (which can change when the image changes, e.g. from null to something else
+		mapMoved(0, 0); // positions the posCircle correctly according to its size (which can change when the image changes, e.g. from null to something else
 		posCircle.refresh(); // was refreshNow
 	}
 
@@ -1482,8 +1484,9 @@
 	public boolean imageNotDragged(ImageDragContext dc,Point pos){
 		boolean ret = super.imageNotDragged(dc, pos);
 		bringMaptoBack();
-		if (dc.image == null) moveMap(pos.x - saveMapLoc.x, pos.y - saveMapLoc.y);
-		else mapMoved(pos.x - saveMapLoc.x, pos.y - saveMapLoc.y);
+		Vm.debug("p1: " + dc.point1 + ", p2: " + dc.point2 + ", prevp: " + dc.prevPoint + ", pos: "+pos+", saveMapL: "+saveMapLoc);
+		if (dc.image == null) moveMap(pos.x - dc.prevPoint.x, pos.y - dc.prevPoint.y);
+		else mapMoved(pos.x - dc.prevPoint.x, pos.y - dc.prevPoint.y);
 		mm.dontUpdatePos = saveGpsIgnoreStatus;
 		this.repaintNow();
 		return ret;
@@ -1491,7 +1494,7 @@
 
 	public void onPenEvent(PenEvent ev) {
 		if (!mm.zoomingMode && ev.type == PenEvent.PEN_DOWN) {
-			saveMapLoc = new Point (ev.x, ev.y);
+			 saveMapLoc = new Point (ev.x, ev.y);
 		}
 		if (mm.zoomingMode && ev.type == PenEvent.PEN_DOWN) {
 			saveGpsIgnoreStatus = mm.dontUpdatePos;
@@ -1518,7 +1521,7 @@
 
 		if (mm.zoomingMode && paintingZoomArea && (ev.type == PenEvent.PEN_MOVED_ON || ev.type == PenEvent.PEN_MOVE || ev.type == PenEvent.PEN_DRAG)) {
 			int left, top;
-			Graphics dr = this.getGraphics().getGraphics();
+			Graphics dr = this.getGraphics().getGraphics(); // in Ewe stant nur 1x getGrafics
 			if (lastZoomWidth < 0)left = saveMapLoc.x + lastZoomWidth;
 			else left = saveMapLoc.x;
 			if (lastZoomHeight < 0)top = saveMapLoc.y + lastZoomHeight;



From greiol at mail.berlios.de  Sun Feb 22 10:35:37 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 22 Feb 2009 10:35:37 +0100
Subject: [Cachewolf-svn] r1647 - trunk/docs
Message-ID: <200902220935.n1M9ZbKI004406@sheep.berlios.de>

Author: greiol
Date: 2009-02-22 10:35:27 +0100 (Sun, 22 Feb 2009)
New Revision: 1647

Added:
   trunk/docs/cachewolf_auf_linux_bauen.txt
Log:
Informationen fuer den Bau von CW unter Linux

Added: trunk/docs/cachewolf_auf_linux_bauen.txt
===================================================================
--- trunk/docs/cachewolf_auf_linux_bauen.txt	2009-02-21 17:16:59 UTC (rev 1646)
+++ trunk/docs/cachewolf_auf_linux_bauen.txt	2009-02-22 09:35:27 UTC (rev 1647)
@@ -0,0 +1,13 @@
+Um CacheWolf unter Linux x86 komplett zu bauen, braucht man noch das Linux Paket
+von http://www.ewesoft.com/Downloads/Downloads.html#_Toc105819901. Derzeit ist
+das Ewe149-Linux-x86.zip. Aus dem Paket benoetigt man nur ewecl aus dem Unter-
+verzeichnis CommandLine.
+
+Die Software ist gegen eine ?ltere Version der libc gelinkt. Die meisten
+Distributionen verf?gen ueber Paket zur Kompatibilitaet: compat-libstdc++-33
+
+Bitte dieses Paket nach den Anweisungen des Distributionsherstellers
+zusaetzlich einspielen.
+
+Wer mutig ist, kann auch versuchen alles aus dem Sourcen selber zu bauen.
+http://www.ewesoft.com/Downloads/Downloads.html#_Toc105819911



From greiol at mail.berlios.de  Sun Feb 22 10:49:50 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 22 Feb 2009 10:49:50 +0100
Subject: [Cachewolf-svn] r1648 - trunk
Message-ID: <200902220949.n1M9noJa005567@sheep.berlios.de>

Author: greiol
Date: 2009-02-22 10:49:32 +0100 (Sun, 22 Feb 2009)
New Revision: 1648

Modified:
   trunk/compile.sh
Log:
make the java compiler use iso-8859-1 since most of cachewolf is still encoded in windows-1252 which may not be part of the charsets supported by the jvm (see http://java.sun.com/j2se/1.4.2/docs/api/java/nio/charset/Charset.html). iso will give you much better results than the fallback to one of the utf encodings

Modified: trunk/compile.sh
===================================================================
--- trunk/compile.sh	2009-02-22 09:35:27 UTC (rev 1647)
+++ trunk/compile.sh	2009-02-22 09:49:32 UTC (rev 1648)
@@ -1,2 +1,12 @@
 #!/bin/sh
-javac -cp ./lib/CompileEwe.zip:./lib/  -d ./bin/ -deprecation -nowarn ./src/CacheWolf/*.java ./src/CacheWolf/*/*.java ./src/exp/*.java ./src/utils/*.java
+javac	-source 1.3 \
+	-target 1.1 \
+	-encoding iso-8859-1 \
+	-cp ./lib/CompileEwe.zip:./lib/  \
+	-d ./bin/ \
+	-deprecation \
+	-nowarn \
+	./src/CacheWolf/*.java \
+	./src/CacheWolf/*/*.java \
+	./src/exp/*.java \
+	./src/utils/*.java



From greiol at mail.berlios.de  Mon Feb 23 22:45:09 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 23 Feb 2009 22:45:09 +0100
Subject: [Cachewolf-svn] r1649 - trunk
Message-ID: <200902232145.n1NLj9Fh004683@sheep.berlios.de>

Author: greiol
Date: 2009-02-23 22:44:59 +0100 (Mon, 23 Feb 2009)
New Revision: 1649

Modified:
   trunk/compile.sh
Log:
set default enconding to windows-1252 since most of cw source still uses it, but allow override for testing

Modified: trunk/compile.sh
===================================================================
--- trunk/compile.sh	2009-02-22 09:49:32 UTC (rev 1648)
+++ trunk/compile.sh	2009-02-23 21:44:59 UTC (rev 1649)
@@ -1,7 +1,11 @@
 #!/bin/sh
-javac	-source 1.3 \
+
+ENCODING=${ENCODING:=windows-1252}
+
+javac \
+	-source 1.3 \
 	-target 1.1 \
-	-encoding iso-8859-1 \
+	-encoding $ENCODING \
 	-cp ./lib/CompileEwe.zip:./lib/  \
 	-d ./bin/ \
 	-deprecation \



From greiol at mail.berlios.de  Mon Feb 23 23:20:06 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 23 Feb 2009 23:20:06 +0100
Subject: [Cachewolf-svn] r1650 - trunk/docs
Message-ID: <200902232220.n1NMK6nN007162@sheep.berlios.de>

Author: greiol
Date: 2009-02-23 23:19:58 +0100 (Mon, 23 Feb 2009)
New Revision: 1650

Modified:
   trunk/docs/cachewolf_auf_linux_bauen.txt
Log:
Anmerkungen zur Besonderheiten der Nutzung von eclipse unter Linux

Modified: trunk/docs/cachewolf_auf_linux_bauen.txt
===================================================================
--- trunk/docs/cachewolf_auf_linux_bauen.txt	2009-02-23 21:44:59 UTC (rev 1649)
+++ trunk/docs/cachewolf_auf_linux_bauen.txt	2009-02-23 22:19:58 UTC (rev 1650)
@@ -1,3 +1,6 @@
+Zusatzsoftware
+==============
+
 Um CacheWolf unter Linux x86 komplett zu bauen, braucht man noch das Linux Paket
 von http://www.ewesoft.com/Downloads/Downloads.html#_Toc105819901. Derzeit ist
 das Ewe149-Linux-x86.zip. Aus dem Paket benoetigt man nur ewecl aus dem Unter-
@@ -3,6 +6,6 @@
 verzeichnis CommandLine.
 
-Die Software ist gegen eine ?ltere Version der libc gelinkt. Die meisten
-Distributionen verf?gen ueber Paket zur Kompatibilitaet: compat-libstdc++-33
+Die Software ist gegen eine aeltere Version der libc gelinkt. Die meisten
+Distributionen verfuegen ueber Paket zur Kompatibilitaet: compat-libstdc++-33
 
 Bitte dieses Paket nach den Anweisungen des Distributionsherstellers
@@ -11,3 +14,34 @@
 
 Wer mutig ist, kann auch versuchen alles aus dem Sourcen selber zu bauen.
 http://www.ewesoft.com/Downloads/Downloads.html#_Toc105819911
+
+Anmerkungen zu eclipse
+======================
+
+Viele CW-Entwickler arbeiten mit Windows und dort nutzt eclipse zunaechst die
+Standardzeichenkodierung windows-1252. Ich habe jedoch noch kein Linux Version
+mit brauchbarer windows-1252 Unterstuetzung gefunden. Das naechstbeste was
+Linux bietet ist ISO-8859-1. Wenn du den Sourcecode als ISO-8859-1 anzeigen
+laesst (rechte Maustaste / Eigenschaten) wird fast(!) alles korrekt angezeigt.
+Aber:
+
+Die beiden Zeichensaetze sind nicht identisch!
+
+Um herauszufinden welche Dateien Probleme bereiten koennen, kannst du das Tool
+pcregrep benutzen (eventuell musst du es nachinstallieren) und dann folgendes
+Script ausfuehren:
+
+----------------------------------------------------------------------
+#!/bin/sh
+
+for high in 8 9 ; do
+        for low in 0 1 2 3 4 5 6 7 8 9 a b c d e f ; do
+                echo "checking for hex $high$low"
+                find src -name *.java | xargs pcregrep -n  "\x$high$low"
+         done
+done
+----------------------------------------------------------------------
+
+Aenderungen (bzw. Commits ins SVN-Repository) an Dateien die von diesem Script 
+gemeldet werden, solltest du vorsichtshalber von einem Mitentwickler der Windows 
+benutzt vornehmen lassen, damit es nicht zu Durcheinander kommt.



From pfeffer at mail.berlios.de  Tue Feb 24 00:37:53 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 24 Feb 2009 00:37:53 +0100
Subject: [Cachewolf-svn] r1651 - in trunk/res_noewe/webmapservices: .
	untested
Message-ID: <200902232337.n1NNbr3w019500@sheep.berlios.de>

Author: pfeffer
Date: 2009-02-24 00:37:31 +0100 (Tue, 24 Feb 2009)
New Revision: 1651

Added:
   trunk/res_noewe/webmapservices/de-sn_p.wms
   trunk/res_noewe/webmapservices/untested/
   trunk/res_noewe/webmapservices/untested/at-3_p.wms
   trunk/res_noewe/webmapservices/untested/at-3_t50.wms
   trunk/res_noewe/webmapservices/untested/at_p.wms
   trunk/res_noewe/webmapservices/untested/de-bb_t10.wms
   trunk/res_noewe/webmapservices/untested/de-bb_t25.wms
   trunk/res_noewe/webmapservices/untested/de-bw_p.wms
   trunk/res_noewe/webmapservices/untested/de-bw_t50.wms
   trunk/res_noewe/webmapservices/untested/de-by_p.wms
   trunk/res_noewe/webmapservices/untested/de-by_t50.wms
   trunk/res_noewe/webmapservices/untested/de-he_p.wms
   trunk/res_noewe/webmapservices/untested/de-he_t100.wms
   trunk/res_noewe/webmapservices/untested/de-he_t50.wms
   trunk/res_noewe/webmapservices/untested/de-mv_p.wms
   trunk/res_noewe/webmapservices/untested/de-mv_t10.wms
   trunk/res_noewe/webmapservices/untested/de-mv_t25.wms
   trunk/res_noewe/webmapservices/untested/de-mv_t50.wms
   trunk/res_noewe/webmapservices/untested/de-ni_pt.wms
   trunk/res_noewe/webmapservices/untested/de-ni_t100.wms
   trunk/res_noewe/webmapservices/untested/de-nw_p.wms
   trunk/res_noewe/webmapservices/untested/de-nw_t10.wms
   trunk/res_noewe/webmapservices/untested/de-nw_t25.wms
   trunk/res_noewe/webmapservices/untested/de-nw_t50.wms
   trunk/res_noewe/webmapservices/untested/de-rp_p.wms
   trunk/res_noewe/webmapservices/untested/de-rp_t50.wms
   trunk/res_noewe/webmapservices/untested/de-th_p.wms
   trunk/res_noewe/webmapservices/untested/de-th_t50.wms
   trunk/res_noewe/webmapservices/untested/de_t.wms
   trunk/res_noewe/webmapservices/untested/de_t1000.wms
   trunk/res_noewe/webmapservices/untested/de_t200.wms
   trunk/res_noewe/webmapservices/untested/de_t500.wms
   trunk/res_noewe/webmapservices/untested/es-an_p.wms
   trunk/res_noewe/webmapservices/untested/es-an_t.wms
   trunk/res_noewe/webmapservices/untested/es-an_t1.wms
   trunk/res_noewe/webmapservices/untested/es-ar_p.wms
   trunk/res_noewe/webmapservices/untested/es-ar_t.wms
   trunk/res_noewe/webmapservices/untested/es-cn_p.wms
   trunk/res_noewe/webmapservices/untested/es-cn_t.wms
   trunk/res_noewe/webmapservices/untested/es-cn_ts.wms
   trunk/res_noewe/webmapservices/untested/fr_t.wms
   trunk/res_noewe/webmapservices/untested/it-52_t.wms
   trunk/res_noewe/webmapservices/untested/it-52_tm.wms
   trunk/res_noewe/webmapservices/untested/it-88_m.wms
   trunk/res_noewe/webmapservices/untested/it-88_p.wms
   trunk/res_noewe/webmapservices/untested/it-88_t10.wms
   trunk/res_noewe/webmapservices/untested/it_t.wms
   trunk/res_noewe/webmapservices/untested/jp-t.wms
   trunk/res_noewe/webmapservices/untested/pt_t500.wms
   trunk/res_noewe/webmapservices/untested/us_t.wms
Modified:
   trunk/res_noewe/webmapservices/de-sn_topo_10.wms
   trunk/res_noewe/webmapservices/de-sn_topo_25.wms
   trunk/res_noewe/webmapservices/de-sn_topo_50.wms
   trunk/res_noewe/webmapservices/de-st_photo.wms
   trunk/res_noewe/webmapservices/de-st_topo_10.wms
   trunk/res_noewe/webmapservices/de-st_topo_50.wms
Log:
webmapservices: include all untested

Added: trunk/res_noewe/webmapservices/de-sn_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sn_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/de-sn_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVDOPFREE/WMSFREE_TK/WMSFREE_TK/wmsservice?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Sachsen photo
+MapType:	photo
+MainUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVDOPFREE/WMSFREE_TK/WMSFREE_TK/wmsservice?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=c
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 51.8592 E 11.7651
+BoundingBoxButtomRightWGS84:	N 50.0294 E 15.1358
+MinScale:	0.65
+MaxScale:	4.98853
+RecommendedScale:	1
+ImageFileExtension: .png

Modified: trunk/res_noewe/webmapservices/de-sn_topo_10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sn_topo_10.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/de-sn_topo_10.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -1,7 +1,6 @@
-# please refere to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
 GetCapabilitiesUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVTKFREE/WMSFREE_TK/wmsservice?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.sn Topo 10
+Name:	de.Sachsen topo 10
 MapType:	topo
 MainUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVTKFREE/WMSFREE_TK/wmsservice?
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de-sn_topo_25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sn_topo_25.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/de-sn_topo_25.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -1,7 +1,6 @@
-# please refere to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
 GetCapabilitiesUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVTKFREE/WMSFREE_TK/wmsservice?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.sn Topo 25
+Name:	de.Sachsen topo 25
 MapType:	topo
 MainUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVTKFREE/WMSFREE_TK/wmsservice?
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de-sn_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sn_topo_50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/de-sn_topo_50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -1,7 +1,6 @@
-# please refere to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
 GetCapabilitiesUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVTKFREE/WMSFREE_TK/wmsservice?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.sn Topo 50
+Name:	de.Sachsen topo 50
 MapType:	topo
 MainUrl:	http://www.landesvermessung.sachsen.de/ias/basiskarte/service/SRVTKFREE/WMSFREE_TK/wmsservice?
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de-st_photo.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-st_photo.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/de-st_photo.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -1,7 +1,6 @@
-# please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
 GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.st Luftbild
+Name:	de.Sachsen-Anhalt photo
 MapType:	photo
 MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
 ServiceTypeUrlPart:	SERVICE=WMS 

Modified: trunk/res_noewe/webmapservices/de-st_topo_10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-st_topo_10.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/de-st_topo_10.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -1,9 +1,9 @@
-# please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
 GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.st Topo 10
+Name:	de.Sachsen-Anhalt topo 10
 MapType:	topo
 MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
+#MainUrl:            http://geoportal.geodaten.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
 ServiceTypeUrlPart:	SERVICE=WMS 
 VersionUrlPart:	VERSION=1.1.1 
 CoordinateReferenceSystemCacheWolf:   31468

Modified: trunk/res_noewe/webmapservices/de-st_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-st_topo_50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/de-st_topo_50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -1,9 +1,9 @@
-# please refer to readme_wms.txt for an explantion of this file format
 TakenFromUrl:	http://www.lvermgeo.sachsen-anhalt.de/de/geoservice/viewer/main.htm
 GetCapabilitiesUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.st Topo 50
+Name:	de.Sachsen-Anhalt topo 50
 MapType:	topo
 MainUrl:	http://lsa-st317.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
+#MainUrl:            http://geoportal.geodaten.sachsen-anhalt.de/geodatenportal/servlet/gtEntryPoint?
 ServiceTypeUrlPart:	SERVICE=WMS 
 VersionUrlPart:	VERSION=1.1.1 
 CoordinateReferenceSystemCacheWolf:   31468

Added: trunk/res_noewe/webmapservices/untested/at-3_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/at-3_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/at-3_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,50 @@
+TakenFromUrl:       http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+GetCapabilitiesUrl: http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               at.Niederoesterreich photo
+MapType:                        photo
+MainUrl:            http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf: 4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+# 31466 31467 4326
+# SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=oek200|OEK200||
+#LayersUrlPart:     LAYERS=oek50|OEK50||
+#LayersUrlPart:     LAYERS=ortho1m_sw|Orthofoto SW||
+#LayersUrlPart:     LAYERS=isolinien|Isolinien|NaN|NaN
+#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
+#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Uebergangsgebiet|Uebergangsgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
+#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
+#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
+#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
+#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
+#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
+#LayersUrlPart:     LAYERS=Luftfahrthindernis|Luftfahrthindernis||
+#LayersUrlPart:     LAYERS=Grundwasserrahmenverfuegung|Grundwasser Rahmenverf??gung|NaN|99999999
+#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasser Schongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschutzgebiet|Grundwasser Schutzgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=hq100|Hochwasseranschlaglinie HQ100|NaN|99999999
+#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
+#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
+#LayersUrlPart:     LAYERS=see|Stehende Gew??sser||
+#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
+#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
+#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
+#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
+#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
+LayersUrlPart:     LAYERS=ortho1m_sw,flu_50t,see
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
+BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
+#BBox_Mitte: N 48.205281 E 15.862571
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png
+# Kalibrierung ?

Added: trunk/res_noewe/webmapservices/untested/at-3_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/at-3_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/at-3_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,50 @@
+TakenFromUrl:       http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+GetCapabilitiesUrl: http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               at.Niederoesterreich topo 50
+MapType:                        topo
+MainUrl:            http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf: 4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=oek200|OEK200||
+#LayersUrlPart:     LAYERS=oek50|OEK50||
+#LayersUrlPart:     LAYERS=ortho1m_sw|Orthofoto SW||
+#LayersUrlPart:     LAYERS=isolinien|Isolinien|NaN|NaN
+#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
+#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Uebergangsgebiet|Uebergangsgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
+#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
+#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
+#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
+#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
+#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
+#LayersUrlPart:     LAYERS=Luftfahrthindernis|Luftfahrthindernis||
+#LayersUrlPart:     LAYERS=Grundwasserrahmenverfuegung|Grundwasser Rahmenverf??gung|NaN|99999999
+#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasser Schongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschutzgebiet|Grundwasser Schutzgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=hq100|Hochwasseranschlaglinie HQ100|NaN|99999999
+#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
+#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
+#LayersUrlPart:     LAYERS=see|Stehende Gew??sser||
+#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
+#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
+#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
+#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
+#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
+LayersUrlPart:     LAYERS=oek50,flu_50t,see
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
+BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png
+# BBox ev. etwas zu weit s?dlich
+# keine Fehlermeldung bei Koordinaten ausserhalb
+# Skalierung ab 1 bis 15 (teils 17,5) (daruberhinaus nur die Wasserlayer)
+# Kalibrierung passt nicht zu Google

Added: trunk/res_noewe/webmapservices/untested/at_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/at_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/at_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,42 @@
+TakenFromUrl:   http://www.geoland.at
+GetCapabilitiesUrl:   http://www.geoland.at/geolandWMS/service.aspx?Name=geoland_at_wms&Service=WMS&Version=1.1.1&Request=GetCapabilities
+Name:   at photo
+MapType:   photo
+MainUrl:   http://www.geoland.at/geolandWMS/service.aspx?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#LayersUrlPart:   LAYERS=Bezirke		<ScaleHint min="0.935071009578714" max="187.08941170883" /> 
+#LayersUrlPart:   LAYERS=Gemeinden		<ScaleHint min="0.935071009578714" max="187.08866335268" /> 
+#LayersUrlPart:   LAYERS=Landesgrenzen		<ScaleHint min="0.935071009578714" max="9354.45187653775" />
+#LayersUrlPart:   LAYERS=Natura2000_SPA		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Natura 2000 Vogelschutzrichtlinie (SPA)
+#LayersUrlPart:   LAYERS=Natura2000_pSCI	<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Natura 2000 Habitatrichtlinie (SCI)
+#LayersUrlPart:   LAYERS=Naturpark		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Landschaftsschutzgebiet<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Nationalpark		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Naturschutzgebiet	<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Autobahn		<ScaleHint min="0.935071009578714" max="748.356524301095" />
+#LayersUrlPart:   LAYERS=Landesstr_B		<ScaleHint min="0.935071009578714" max="748.356524301095" /> 
+#LayersUrlPart:   LAYERS=Landesstr_L		<ScaleHint min="0.935071009578714" max="187.08941170883" />
+#LayersUrlPart:   LAYERS=Orientierungskarte	<ScaleHint min="0" max="9.35482605461281" />
+#LayersUrlPart:   LAYERS=S/W-Orthofoto		<ScaleHint min="0.935071009578714" max="9.35482605461281" />
+#LayersUrlPart:   LAYERS=Radwanderrouten	<ScaleHint min="3.74140657254004" max="187.08941170883" /> 
+#LayersUrlPart:   LAYERS=Startbild		<ScaleHint min="74.8363633684521" max="3741.78112479318" /> Hintergrund
+#LayersUrlPart:   LAYERS=Geonamen		<ScaleHint min="0.935071009578714" max="5.61229694784759" /> Orts- und Flurnamen
+#LayersUrlPart:   LAYERS=Flug_Orthofoto		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Flugjahr Orthofoto
+#LayersUrlPart:   LAYERS=Flug_ALS		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Flugjahr Laserscanning
+#LayersUrlPart:   LAYERS=S/W-Orthofoto,Bezirke,Gemeinden,Landesgrenzen,Autobahn,Landesstr_B,Landesstr_L,Radwanderrouten
+LayersUrlPart:   LAYERS=S/W-Orthofoto,Orientierungskarte,Geonamen,Autobahn,Landesstr_B,Landesstr_L
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
+BoundingBoxButtomRightWGS84:   N 46.357433 E 17.202733
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png
+# nicht ?berall Luftbilder
+# nicht ?berall gut kalibriert
+# bis Skalierung 4,3 gibts noch Fotos, ab 4,5 nur noch Strassen (schlecht kalibriert)

Added: trunk/res_noewe/webmapservices/untested/de-bb_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bb_t10.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-bb_t10.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:   http://isk.geobasis-bb.de/index.php?cms=1101
+GetCapabilitiesUrl:   http://isk.geobasis-bb.de/ows/dnm010.php?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1
+Name:   de.Berlin/Brandenburg topo 10
+MapType:   topo
+MainUrl:   http://isk.geobasis-bb.de/ows/dnm010.php?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=bg,siedlung,transport,vegetation,gewaesser,gewaessernamen,ortsnamen,strassennamen
+StylesUrlPart:   STYLES=2
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 53.5 E 11.2
+BoundingBoxButtomRightWGS84:   N 51.3 E 14.8
+MinScale:   0.0
+MaxScale:   14.001
+RecommendedScale:   1
+ImageFileExtension:   .png

Added: trunk/res_noewe/webmapservices/untested/de-bb_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bb_t25.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-bb_t25.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:   http://isk.geobasis-bb.de/index.php?cms=1101
+GetCapabilitiesUrl:   http://isk.geobasis-bb.de/ows/dnm025.php?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1%2
+Name:   de.Berlin/Brandenburg topo 25
+MapType:   topo
+MainUrl:   http://isk.geobasis-bb.de/ows/dnm025.php?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=bg,siedlung,transport,vegetation,gewaesser,gewaessernamen,ortsnamen,strassennamen
+StylesUrlPart:   STYLES=2
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 53.5 E 11.2
+BoundingBoxButtomRightWGS84:   N 51.3 E 14.8
+MinScale:   0.0
+MaxScale:   11.0485
+RecommendedScale:   2.5
+ImageFileExtension:   .png

Added: trunk/res_noewe/webmapservices/untested/de-bw_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bw_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-bw_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:   http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:   http://www.lv-bw.de/dv/capabilities.xml?login=dv&pw=anonymous&REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:   de.Baden-Wuerttemberg photo
+MapType:   photo
+MainUrl:   http://www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous&
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   31467
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:31467
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=DVDOP2
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 50.00 E 7.60
+BoundingBoxButtomRightWGS84:   N 47.40 E 10.00
+MinScale:   0.01
+MaxScale:   43
+RecommendedScale:   2.5
+ImageFileExtension: .png 
\ No newline at end of file

Added: trunk/res_noewe/webmapservices/untested/de-bw_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bw_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-bw_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Internetadressen
+GetCapabilitiesUrl:	http://www.lv-bw.de/dv/capabilities.xml?login=dv&pw=anonymous&REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Baden-Wuerttemberg topo 50
+MapType:	topo
+MainUrl:	http://www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous&
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf:	31467 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DVTK50K
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 50.00 E 7.60
+BoundingBoxButtomRightWGS84:	N 47.40 E 10.00
+MinScale:	0.01
+MaxScale:	40
+RecommendedScale:	5.0
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-by_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-by_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-by_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Bayern photo
+MapType:	photo
+MainUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DOP
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 50.6269 E 8.89292
+BoundingBoxButtomRightWGS84:	N 47.0828 E 13.9782
+MinScale:	2.82
+MaxScale:	200
+RecommendedScale:	2.0
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-by_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-by_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-by_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Bayern topo 50
+MapType:	topo
+MainUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=TK50
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 50.6269 E 8.89292
+BoundingBoxButtomRightWGS84:	N 47.0828 E 13.9782
+MinScale:	0.997806
+MaxScale:	24.9451
+RecommendedScale:	5.0
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-he_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-he_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-he_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-images.plx?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Hessen photo
+MapType:	photo
+MainUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-images.plx?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:	31467
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DOP04F1
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84:	N 51.6697 E 7.69911
+BoundingBoxButtomRightWGS84:	N 49.3455 E 11.3986
+MinScale:   0.399122
+MaxScale:   9.97806
+RecommendedScale:   0.4
+ImageFileExtension: .jpg
+

Added: trunk/res_noewe/webmapservices/untested/de-he_t100.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-he_t100.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-he_t100.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,21 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Hessen topo 100
+MapType:	topo
+MainUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?
+LayersName: 
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:	31467
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=ATKPG50-N1
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 51.6697 E 7.69911
+BoundingBoxButtomRightWGS84:	N 49.3455 E 11.3986
+MinScale:	1.49671
+MaxScale:	99.7806
+RecommendedScale:	10.0
+ImageFileExtension: .png
+

Added: trunk/res_noewe/webmapservices/untested/de-he_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-he_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-he_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Hessen topo 50
+MapType:	topo
+MainUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:	31467
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=ATKPG25-N1
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 51.6697 E 7.69911
+BoundingBoxButtomRightWGS84:	N 49.3455 E 11.3986
+MinScale:	1.49671
+MaxScale:	49.8903
+RecommendedScale:	5.0
+ImageFileExtension: .png
+

Added: trunk/res_noewe/webmapservices/untested/de-mv_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-mv_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DOP?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
+Name:	de.Mecklenburg-Vorpommern photo
+MapType:	photo
+MainUrl:	http://www.gaia-mv.de/dienste/DOP?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DOP
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
+BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+MinScale:	0.000374177136322228
+MaxScale:	37.4180878093591
+RecommendedScale:	0.4
+ImageFileExtension: .jpg

Added: trunk/res_noewe/webmapservices/untested/de-mv_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_t10.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-mv_t10.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DTK10f?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
+Name:	de.Mecklenburg-Vorpommern topo 10
+MapType:	topo
+MainUrl:	http://www.gaia-mv.de/dienste/DTK10f?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DTK10f
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
+BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+MinScale:	0.186714391024792
+MaxScale:	11.2256882668032
+RecommendedScale:	1.0
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-mv_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_t25.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-mv_t25.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DTK25Vf?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
+Name:	de.Mecklenburg-Vorpommern topo 25
+MapType:	topo
+MainUrl:	http://www.gaia-mv.de/dienste/DTK25Vf?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DTK25Vf
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
+BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+MinScale:	1.87051150447482
+MaxScale:	18.7092309932477
+RecommendedScale:	2.5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-mv_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-mv_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DTK50Vf?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
+Name:	de.Mecklenburg-Vorpommern topo 50
+MapType:	topo
+MainUrl:	http://www.gaia-mv.de/dienste/DTK50Vf?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DTK50Vf
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
+BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+MinScale:	5.6122828676971
+MaxScale:	28.0636594013034
+RecommendedScale:	5.0
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-ni_pt.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-ni_pt.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-ni_pt.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://www.umwelt.niedersachsen.de/master/C7065327_N6991478_L20_D0_I598.html
+GetCapabilitiesUrl:	http://geoportal.geodaten.niedersachsen.de/geodatenportal/servlet/gtEntryPoint?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1
+Name:	de.Niedersachsen photo/topo
+MapType:	photo
+MainUrl:	http://geoportal.geodaten.niedersachsen.de/geodatenportal/servlet/gtEntryPoint?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31466 31467 31468 31469
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=layer_1512,layer_1513,layer_1514,layer_1507,layer_1508,layer_1509,layer_1510,layer_1511,layer_1515
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+# transformed from Gau?-Kr?ger into wgs84
+BoundingBoxTopLeftWGS84:	N 53.99192 E 006.62073
+BoundingBoxButtomRightWGS84:	N 51.27316 E 011.58000
+MinScale:	0.267412
+MaxScale:	59899.495
+RecommendedScale:	5.0
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-ni_t100.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-ni_t100.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-ni_t100.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.mapserver.niedersachsen.de/freezoneogc/mapserverogc?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
+Name:	de.Niedersachsen topo 100
+MapType:	topo
+MainUrl:	http://www.mapserver.niedersachsen.de/freezoneogc/mapserverogc?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf: 31467
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=TK100
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 54.940306 E 6.180364
+BoundingBoxButtomRightWGS84:	N 50.502795 E 13.683332
+MinScale:	6.76160460880501
+MaxScale:	52.82503600628914
+RecommendedScale:	15.0
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de-nw_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-nw_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.gis2.nrw.de/wmsconnector/wms/luftbild?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS	
+Name:	de.Nordrhein-Westfalen photo
+MainUrl:	http://www.gis2.nrw.de/wmsconnector/wms/luftbild? 
+MapType: photo
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.0 
+CoordinateReferenceSystemCacheWolf:	31466 31467
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=Orthophoto%20Str.%202,Orthophoto%20Str.%203
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 52.7691 E 5.673
+BoundingBoxButtomRightWGS84:	N 49.9944 E 10.142
+MinScale:	0.1795783591567183
+MaxScale:	5.611823723647454
+RecommendedScale:	0.5
+ImageFileExtension: .png
+

Added: trunk/res_noewe/webmapservices/untested/de-nw_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_t10.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-nw_t10.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/DTK10?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.0
+Name:   de.Nordrhein-Westfalen topo 10
+MapType:	topo
+MainUrl:   http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/DTK10?
+ServiceTypeUrlPart:	SERVICE=WMS
+VersionUrlPart:	VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:	31466 31467
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=Raster%3ADTK10%3ADtk10G
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 52.7729742 E 5.672412
+BoundingBoxButtomRightWGS84:	N 49.998341 E 10.1417782
+MinScale:   0.0
+MaxScale:   14.001
+RecommendedScale:	1
+ImageFileExtension:	.png

Added: trunk/res_noewe/webmapservices/untested/de-nw_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_t25.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-nw_t25.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,21 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:   de.Nordrhein-Westfalen topo 25
+MapType:	topo
+MainUrl:	http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/TK25?
+ServiceTypeUrlPart:	SERVICE=WMS
+VersionUrlPart:	VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:	31466 31467
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=Raster%3ATK25%5FKMF%3AFarbkombination
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 52.7691 E 05.673
+BoundingBoxButtomRightWGS84:	N 49.9944 E 010.142
+MinScale:   0.0
+# the hintscale delivered from the getCapilibitiesUrl is a little bit higher (11.667) but this leads sometimes to empty maps
+# I tested that 11.0485 is probably the real MaxScale
+MaxScale:   11.0485
+RecommendedScale:	2.5
+ImageFileExtension:	.png

Added: trunk/res_noewe/webmapservices/untested/de-nw_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-nw_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:   http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Dialogbox
+GetCapabilitiesUrl:   http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK50?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.0
+Name: de.Nordrhein-Westfalen topo 50
+MapType:   topo
+MainUrl:   http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/TK50?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:   31466 31467
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=Raster%3ATK50%5FKMF%3AFarbkombination
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 52.7691 E 5.673
+BoundingBoxButtomRightWGS84:   N 49.9944 E 10.142
+MinScale:   0.0
+MaxScale:   23.335
+RecommendedScale:   5
+ImageFileExtension: .png
\ No newline at end of file

Added: trunk/res_noewe/webmapservices/untested/de-rp_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-rp_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-rp_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,28 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Rheinland-Pfalz photo
+MapType:	photo
+MainUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf:   31466 31467
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:31466 SRS=EPSG:31467
+RequestUrlPart:   REQUEST=GetMap
+#LayersUrlPart:     LAYERS=rlp:rlp|VermKV RLP||
+#LayersUrlPart:     LAYERS=rlp:ovw|?bersichtskarte Relief|100.001|5000
+#LayersUrlPart:     LAYERS=freedop:dop|Luftbilder|0.495|24.95
+#LayersUrlPart:     LAYERS=rlp:uek500|?bersichtskarte 1:500.000|60.001|100
+#LayersUrlPart:     LAYERS=rlp:uek250|?bersichtskarte 1:250.000|30.001|60
+#LayersUrlPart:     LAYERS=rlp:tk100|TK 1:100.000|15.001|30
+#LayersUrlPart:     LAYERS=rlp:tk50|TK 1:50.000|8.001|15
+#LayersUrlPart:     LAYERS=rlp:tk25|TK 1:25.000|1|8
+#LayersUrlPart:     LAYERS=likar:likar|Liegenschaftskarte-WA|0.001|3
+LayersUrlPart:   LAYERS=freedop%3Adop
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 50.400 E 6.000
+BoundingBoxButtomRightWGS84:   N 49.300 E 8.200
+MinScale:   0.5
+MaxScale:   24.95
+RecommendedScale:	0.4
+ImageFileExtension: .png 

Added: trunk/res_noewe/webmapservices/untested/de-rp_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-rp_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-rp_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,28 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
+Name:	de.Rheinland-Pfalz topo 50
+MapType:	topo
+MainUrl:	http://geodaten.service24.rlp.de/cgi-bin/wms.cgi?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf:   31466 31467
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:31466 SRS=EPSG:31467
+#LayersUrlPart:     LAYERS=rlp:rlp|VermKV RLP||
+#LayersUrlPart:     LAYERS=rlp:ovw|?bersichtskarte Relief|100.001|5000
+#LayersUrlPart:     LAYERS=freedop:dop|Luftbilder|0.495|24.95
+#LayersUrlPart:     LAYERS=rlp:uek500|?bersichtskarte 1:500.000|60.001|100
+#LayersUrlPart:     LAYERS=rlp:uek250|?bersichtskarte 1:250.000|30.001|60
+#LayersUrlPart:     LAYERS=rlp:tk100|TK 1:100.000|15.001|30
+#LayersUrlPart:     LAYERS=rlp:tk50|TK 1:50.000|8.001|15
+#LayersUrlPart:     LAYERS=rlp:tk25|TK 1:25.000|1|8
+#LayersUrlPart:     LAYERS=likar:likar|Liegenschaftskarte-WA|0.001|3
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=rlp%3Atk50
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 50.400 E 6.000
+BoundingBoxButtomRightWGS84:   N 49.300 E 8.200
+MinScale:   1
+MaxScale:   45
+RecommendedScale:	5.0
+ImageFileExtension: .png 
\ No newline at end of file

Added: trunk/res_noewe/webmapservices/untested/de-th_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-th_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-th_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://www.thueringen.de/de/tlvermgeo/onlineservice/web_map_service/content.html
+GetCapabilitiesUrl:	http://www.webmap-test.thueringen.de/deegreewms/wms?service=WMS&version=1.1.1&request=GetCapabilities
+Name:	de.Thueringen photo
+MapType:	photo
+MainUrl:	http://www.webmap-test.thueringen.de/deegreewms/wms?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:	31468
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=Orthophotos_TH-2m
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84:	N 52.0000 E 9.5000
+BoundingBoxButtomRightWGS84:	N 50.0000 E 13.0000
+MinScale:   0.399122
+MaxScale:   9.97806
+RecommendedScale:   2.0
+ImageFileExtension: .jpg
+

Added: trunk/res_noewe/webmapservices/untested/de-th_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-th_t50.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de-th_t50.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://www.thueringen.de/de/tlvermgeo/onlineservice/web_map_service/content.html
+GetCapabilitiesUrl:	http://www.webmap-test.thueringen.de/deegreewms/wms?service=WMS&version=1.1.1&request=GetCapabilities
+Name:	de.Thueringen topo 50
+MapType:	topo
+MainUrl:	http://www.webmap-test.thueringen.de/deegreewms/wms?
+ServiceTypeUrlPart:	SERVICE=WMS 
+VersionUrlPart:	VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:	31468
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=Top.Karte_50_gesamt
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 52.0000 E 9.5000
+BoundingBoxButtomRightWGS84:	N 50.0000 E 13.0000
+MinScale:	1.49671
+MaxScale:	49.8903
+RecommendedScale:	5.0
+ImageFileExtension: .png
+

Added: trunk/res_noewe/webmapservices/untested/de_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:   http://www.wheregroup.com/de/freier_wms_mit_openstreetmap_daten
+GetCapabilitiesUrl:   http://osm.wheregroup.com/cgi-bin/mapserv?map=/data/umn/osm/osm_basic.map&REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.1.1   
+Name:   de OSM
+MainUrl:   http://osm.wheregroup.com/cgi-bin/osm_basic.xml?
+MapType: topo
+ServiceTypeUrlPart:   SERVICE=WMS 
+VersionUrlPart:   VERSION=1.1.1 
+CoordinateReferenceSystemCacheWolf:   31467 4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:31467 SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=Landwirtschaft,Industriegebiet,Bauland,Gruenflaeche,unkultiviertes_Land,Park,Naherholungsgebiet,Wald,Wiese,Wasser,Fluesse,Baeche,Kanal,Insel,Kueste,Strand,Fussgaengerzone,Fussgaengerweg,Radweg,Wege,Wohnstrasse,Zufahrtswege,einfache_Strasse,Landstrasse,Bundesstrasse,Kraftfahrstrasse,Autobahn,Ortschaft,Weiler,Dorf,Stadt,Grossstadt,Bahn,Bahnhof,Gebaeude
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 55.0960681 E 6.07358734
+BoundingBoxButtomRightWGS84:   N 47.161701 E 16.05521058
+MinScale:   0.6
+MaxScale:   99.99
+RecommendedScale:   1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de_t1000.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t1000.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de_t1000.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&service=WMS&version=1.1.1&request=GetCapabilities
+Name:	de topo 1000
+MainUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&
+MapType:	topo
+ServiceTypeUrlPart:	SERVICE=WMS
+VersionUrlPart:	VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:	31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DTK1000
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 54.937 E 6.00242837
+BoundingBoxButtomRightWGS84:	N 46.95 E 16.12332498
+# there is no scale hint in the getCapabilities answer :-( --> allow all
+#MinScale:	0.01
+#MaxScale:	40
+RecommendedScale:	100
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/de_t200.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t200.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de_t200.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&service=WMS&version=1.1.1&request=GetCapabilities
+Name:	de topo 200
+MainUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&
+MapType:	topo
+ServiceTypeUrlPart:	SERVICE=WMS
+VersionUrlPart:	VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:	31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DTK200-V
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 55.0960681 E 6.07358734
+BoundingBoxButtomRightWGS84:	N 47.161701 E 16.05521058
+# there is no scale hint in the getCapabilities answer :-( --> allow all
+#MinScale:	0.01
+#MaxScale:	40
+RecommendedScale:	20
+ImageFileExtension: .png
\ No newline at end of file

Added: trunk/res_noewe/webmapservices/untested/de_t500.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t500.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/de_t500.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
+GetCapabilitiesUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&service=WMS&version=1.1.1&request=GetCapabilities
+Name:	de topo 500
+MainUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&
+MapType:	topo
+ServiceTypeUrlPart:	SERVICE=WMS
+VersionUrlPart:	VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:	31468 
+CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
+RequestUrlPart:	REQUEST=GetMap
+LayersUrlPart:	LAYERS=DTK500-V
+StylesUrlPart:	STYLES=
+ImageFormatUrlPart:	FORMAT=image/png
+BoundingBoxTopLeftWGS84:	N 54.9369973 E 6.00184962
+BoundingBoxButtomRightWGS84:	N 46.959702 E 16.12339886
+# there is no scale hint in the getCapabilities answer :-( --> allow all
+#MinScale:	0.01
+#MaxScale:	40
+RecommendedScale:	50
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/es-an_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-an_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-an_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://www.juntadeandalucia.es/medioambiente/servmap/wms/LANDSAT2004?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.andalucia photo
+MapType:   photo
+MainUrl:   http://www.juntadeandalucia.es/medioambiente/servmap/wms/LANDSAT2004?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=0
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
+BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+MinScale:   0
+MaxScale:   49.8902848429637
+RecommendedScale:   1.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/es-an_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-an_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-an_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.andaluciajunta.es/IDEAndalucia/OGC.shtml#ogc18
+GetCapabilitiesUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r_95?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.andalucia topo 10_95
+MapType:   topo
+MainUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r_95?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=mta10r
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
+BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+MinScale:   0
+MaxScale:   49.8902848429637
+RecommendedScale:   5.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/es-an_t1.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-an_t1.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-an_t1.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.andaluciajunta.es/IDEAndalucia/OGC.shtml#ogc2
+GetCapabilitiesUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.andalucia topo 10
+MapType:   topo
+MainUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=mta10r
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
+BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+MinScale:   0
+MaxScale:   49.8902848429637
+RecommendedScale:   5.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/es-ar_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-ar_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-ar_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,34 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://sitar.aragon.es/AragonWMS?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:   es.aragon photo
+MapType:   photo
+MainUrl:   http://sitar.aragon.es/AragonWMS?
+LayersName: Carretera
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#
+#LayersUrlPart:   LAYERS=ComunidadAutonoma,Provincia # Skal 260-2080
+#LayersUrlPart:   LAYERS=Comarca,ToponimoComarca # Skal 91-260
+#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio # skal 3,9-91
+#LayersUrlPart:   LAYERS=Planimetria5000,CurvaDirectora5000,CurvaNivel5000 # skal 0-1,3
+#LayersUrlPart:   LAYERS=Alti1000Ter,Alti1000Hue,Alti1000Zar,Plani1000Ter,Plani1000Hue,Plani1000Zar # skal 0-0,9
+#LayersUrlPart:   LAYERS=ComarcaLocalidad,ToponimoProvincia,ToponimoRio
+#LayersUrlPart:   LAYERS=Ortofoto,FechaOrtofoto,PNOA_2006_30,PNOA_2006_31
+#
+#LayersUrlPart:   LAYERS=Ortofoto #Skal=0,6..3,9; 4 geht auch
+#LayersUrlPart:   LAYERS=Carretera #Skal ab 5 geht
+#LayersUrlPart:   LAYERS=Municipio # Kommunalgrenzen
+#
+#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio
+LayersUrlPart:   LAYERS=Ortofoto,Planimetria5000,CurvaDirectora5000,CurvaNivel5000
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
+BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
+MinScale:   0
+MaxScale:   72
+RecommendedScale:   1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/es-ar_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-ar_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-ar_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,34 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://sitar.aragon.es/AragonWMS?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:   es.aragon topo
+MapType:   topo
+MainUrl:   http://sitar.aragon.es/AragonWMS?
+LayersName: Carretera
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#
+#LayersUrlPart:   LAYERS=ComunidadAutonoma,Provincia # Skal 260-2080
+#LayersUrlPart:   LAYERS=Comarca,ToponimoComarca # Skal 91-260
+#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio # skal 3,9-91
+#LayersUrlPart:   LAYERS=Planimetria5000,CurvaDirectora5000,CurvaNivel5000 # skal 0-1,3
+#LayersUrlPart:   LAYERS=Alti1000Ter,Alti1000Hue,Alti1000Zar,Plani1000Ter,Plani1000Hue,Plani1000Zar # skal 0-0,9
+#LayersUrlPart:   LAYERS=ComarcaLocalidad,ToponimoProvincia,ToponimoRio
+#LayersUrlPart:   LAYERS=Ortofoto,FechaOrtofoto,PNOA_2006_30,PNOA_2006_31
+#
+#LayersUrlPart:   LAYERS=Ortofoto #Skal=0,6..3,9; 4 geht auch
+#LayersUrlPart:   LAYERS=Carretera #Skal ab 5 geht
+#LayersUrlPart:   LAYERS=Municipio # Kommunalgrenzen
+#
+LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio
+#LayersUrlPart:   LAYERS=Ortofoto,Planimetria5000,CurvaDirectora5000,CurvaNivel5000
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
+BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
+MinScale:   0
+MaxScale:   72
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/es-cn_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-cn_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-cn_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,21 @@
+TakenFromUrl:       http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?
+GetCapabilitiesUrl: http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               es.Canarias photo
+MapType:                        photo
+MainUrl:            http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=WMS_OrtoExpress|IDECanarias OrtoExpress||
+#LayersUrlPart:     LAYERS=ortoexpress|OrtoExpress||
+LayersUrlPart:     LAYERS=WMS_OrtoExpress
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 29.8305 W 18.3099
+BoundingBoxButtomRightWGS84: N 26.1839 W 13.1373
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .jpg

Added: trunk/res_noewe/webmapservices/untested/es-cn_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-cn_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-cn_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.idecan.grafcan.es/idecan/content/view/24/36/#servicio2
+GetCapabilitiesUrl:   http://idecan2.grafcan.es/ServicioWMS/carto5?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.Canarias topo
+MapType:   topo
+MainUrl:   http://idecan2.grafcan.es/ServicioWMS/carto5?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=WMS_CARTO5
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
+BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
+MinScale:   1.49671
+MaxScale:   174.0000
+RecommendedScale:   5.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/es-cn_ts.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-cn_ts.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/es-cn_ts.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,22 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://idecan2.grafcan.es/ServicioWMS/Callejero?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.Canarias streets
+MapType:   topo
+MainUrl:   http://idecan2.grafcan.es/ServicioWMS/Callejero?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#LayersUrlPart:   LAYERS=TOPO,CONS,VIAS,MUN,FONDO,NUMP,POI
+LayersUrlPart:   LAYERS=WMS_CA
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
+BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
+MinScale:   0
+MaxScale:   2500.0000
+RecommendedScale:   5.000
+#RecommendedScale:   1.000 da stehen dann auch Strassennamen mit drin
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/fr_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/fr_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/fr_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,41 @@
+TakenFromUrl:       http://www.geosignal.org/cgi-bin/wmsmap?version=1.1.1&service=WMS&request=GetLegendGraphic&layer=Voirie&format=image/png
+GetCapabilitiesUrl: http://www.geosignal.org/cgi-bin/wmsmap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               fr topo 4000
+MapType:                        topo
+MainUrl:            http://www.geosignal.org/cgi-bin/wmsmap?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Serveur Geosignal|Serveur Geosignal||
+#LayersUrlPart:     LAYERS=Monde|Pays du monde||
+#LayersUrlPart:     LAYERS=RASTER4000k|Raster France 1/4 000 000|935.443|0
+#LayersUrlPart:     LAYERS=RASTER1000k|Raster France 1/1 000 000|280.633|935.443
+#LayersUrlPart:     LAYERS=RASTER500k|Raster France 1/500 000|140.316|280.633
+#LayersUrlPart:     LAYERS=RASTER250k|Raster France 1/250 000|65.481|140.316
+#LayersUrlPart:     LAYERS=RASTER100k|Raster France 1/100 000|28.0633|65.481
+#LayersUrlPart:     LAYERS=RASTER50k|Raster France 1/50 000|14.0316|28.0633
+#LayersUrlPart:     LAYERS=RASTER25k|Raster France 1/25 000|5.61266|14.0316
+#LayersUrlPart:     LAYERS=RASTER5k|Raster France 1/5 000|0.374177|5.61266
+#LayersUrlPart:     LAYERS=Communes|Communes||
+#LayersUrlPart:     LAYERS=Cantons|Cantons||
+#LayersUrlPart:     LAYERS=Arrondissements|Arrondissements||
+#LayersUrlPart:     LAYERS=Departements|Departements||
+#LayersUrlPart:     LAYERS=Regions|Regions||
+#LayersUrlPart:     LAYERS=Voirie|Voirie urbaine||
+#LayersUrlPart:     LAYERS=Autres|Autres equipements routiers||
+#LayersUrlPart:     LAYERS=Secondaires|Routes Secondaires||
+#LayersUrlPart:     LAYERS=Departementales|Routes Departementales||
+#LayersUrlPart:     LAYERS=Nationales|Routes Nationales||
+#LayersUrlPart:     LAYERS=Autoroutes|Autoroutes||
+#LayersUrlPart:     LAYERS=CommunesXY|Ponctuels des communes||
+LayersUrlPart:     LAYERS=RASTER4000k,Communes,Cantons,Arrondissements,Departements,Regions,Voirie,Autres,Secondaires,Departementales,Nationales,Autoroutes,CommunesXY
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
+BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/it-52_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/it-52_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/it-52_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,22 @@
+TakenFromUrl:   http://www.rete.toscana.it/sett/territorio/carto/repertorio/geoscopio_wms/
+GetCapabilitiesUrl:      http://web.rete.toscana.it/sgrwms/com.rt.wms.RTmap?ServiceName=_rt_wms_topogr&service=WMS&request=GetCapabilities
+Name:   it.Toskana topo 10
+# Simplistic AutoDetail
+MapType: topo
+MainUrl:   http://web.rete.toscana.it:80/sgrwms/com.rt.wms.RTmap/_rt_wms_topogr?
+#MainUrl:   http://web.rete.toscana.it:80/sgrwms/com.rt.wms.RTmap/_rt_wms?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:   3003
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:3003
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=idisoipse,idtoponctr10k,_idbati,idedifici10k,idedifici2k,idareabagnata,idcorsi,idinfrferrovia,_idreg,idstradeestesa,_idstradegallerie
+StylesUrlPart:   STYLES=Default,Default,Default,Default,Default,Default,Default,Default
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 44.500805 E 9.642548
+BoundingBoxButtomRightWGS84:   N 42.168745 E 12.462359
+MinScale:   0
+MaxScale:   14.14214
+#H?henlinien nur bei Scale unter 4.0
+RecommendedScale:   3.9
+ImageFileExtension: .png
\ No newline at end of file

Added: trunk/res_noewe/webmapservices/untested/it-52_tm.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/it-52_tm.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/it-52_tm.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,21 @@
+TakenFromUrl:   http://www.rete.toscana.it/sett/territorio/carto/repertorio/geoscopio_wms/
+GetCapabilitiesUrl:      http://web.rete.toscana.it/sgrwms/com.rt.wms.RTmap?ServiceName=_rt_wms_cartografia&service=WMS&request=GetCapabilities
+Name:   it.Toskana topo
+#-Monochrome AutoDetail
+MainUrl:   http://web.rete.toscana.it:80/sgrwms/com.rt.wms.RTmap/_rt_wms_cartografia?
+MapType: topo
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.0
+CoordinateReferenceSystemCacheWolf:   3003
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:3003
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=idrst10k,rst100k,rst25k_igm
+StylesUrlPart:   STYLES=Default,Default,Default,Default,Default,Default,Default,Default
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 44.500805 E 9.642548
+BoundingBoxButtomRightWGS84:   N 42.168745 E 12.462359
+MinScale:   0
+MaxScale:   71
+#Scale 2 and 3 are scaled versions of scale 1. Scale 5 and 6 are scaled versions of scale 4
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/it-88_m.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/it-88_m.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/it-88_m.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,30 @@
+TakenFromUrl:   http://wiki.gfoss.it/index.php/GIS_Open_Data#Italia
+GetCapabilitiesUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?request=getcapabilities&service=WMS&version=1.1.1
+Name:   it.Sardinien photo+topo10
+MapType:   topo
+MainUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   3003
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:3003
+RequestUrlPart:   REQUEST=GetMap
+# Topographisch schwarz/weiss
+#LayersUrlPart:   LAYERS=CTR10K%20raster
+# Luftbild farbig
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1,mosaico_2006IT_2,mosaico_2006IT_3,mosaico_2006IT_4,mosaico_2006IT_5,mosaico_2006IT_6,mosaico_2006IT_7,mosaico_2006IT_8,mosaico_2006IT_9,CTR10K%20raster
+# Luftbild schwarz/weiss
+#LayersUrlPart:   LAYERS=sardegna_2003gb_1,sardegna_2003gb_2,sardegna_2003gb_3,sardegna_2003gb_4,sardegna_2003gb_5,sardegna_2003gb_6,sardegna_2003gb_7,sardegna_2003gb_8,sardegna_2003gb_9,CTR10K%20raster
+# farbiges Luftbild mit Raterdaten ?berlagert 
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1,CTR10K%20raster
+# farbiges Luftbild anscheinend nur die layer entsprchend der Skalierung angeben ( es tun nur die Skalierungen 1 bis 4)
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1
+LayersUrlPart:   LAYERS=mosaico_2006IT_1,CTR10K%20raster
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 41.400307 E 7.964019
+BoundingBoxButtomRightWGS84:   N 38.792131 E 10.022418
+MinScale:   1
+MaxScale:   3
+#RecommendedScale:   1.000 sonst kann man die Topodaten nicht lesen bzw es werden keine Fotos geladen
+RecommendedScale:   1.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/it-88_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/it-88_p.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/it-88_p.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,30 @@
+TakenFromUrl:   http://wiki.gfoss.it/index.php/GIS_Open_Data#Italia
+GetCapabilitiesUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?request=getcapabilities&service=WMS&version=1.1.1
+Name:   it.Sardinien photo
+MapType:   photo
+MainUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   3003
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:3003
+RequestUrlPart:   REQUEST=GetMap
+# Topographisch schwarz/weiss
+#LayersUrlPart:   LAYERS=CTR10K%20raster
+# Luftbild farbig
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1,mosaico_2006IT_2,mosaico_2006IT_3,mosaico_2006IT_4,mosaico_2006IT_5,mosaico_2006IT_6,mosaico_2006IT_7,mosaico_2006IT_8,mosaico_2006IT_9,CTR10K%20raster
+# Luftbild schwarz/weiss
+#LayersUrlPart:   LAYERS=sardegna_2003gb_1,sardegna_2003gb_2,sardegna_2003gb_3,sardegna_2003gb_4,sardegna_2003gb_5,sardegna_2003gb_6,sardegna_2003gb_7,sardegna_2003gb_8,sardegna_2003gb_9,CTR10K%20raster
+# farbiges Luftbild mit Raterdaten ?berlagert 
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1,CTR10K%20raster
+# farbiges Luftbild anscheinend nur die layer entsprchend der Skalierung angeben ( es tun nur die Skalierungen 1 bis 4)
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1
+LayersUrlPart:   LAYERS=mosaico_2006IT_4
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 41.400307 E 7.964019
+BoundingBoxButtomRightWGS84:   N 38.792131 E 10.022418
+MinScale:   4
+MaxScale:   6
+# RecommendedScale:   1.000
+RecommendedScale:   4
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/it-88_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/it-88_t10.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/it-88_t10.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,30 @@
+TakenFromUrl:   http://wiki.gfoss.it/index.php/GIS_Open_Data#Italia
+GetCapabilitiesUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?request=getcapabilities&service=WMS&version=1.1.1
+Name:   it.Sardinien topo 10
+MapType:   topo
+MainUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   3003
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:3003
+RequestUrlPart:   REQUEST=GetMap
+# Topographisch schwarz/weiss
+#LayersUrlPart:   LAYERS=CTR10K%20raster
+# Luftbild farbig
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1,mosaico_2006IT_2,mosaico_2006IT_3,mosaico_2006IT_4,mosaico_2006IT_5,mosaico_2006IT_6,mosaico_2006IT_7,mosaico_2006IT_8,mosaico_2006IT_9,CTR10K%20raster
+# Luftbild schwarz/weiss
+#LayersUrlPart:   LAYERS=sardegna_2003gb_1,sardegna_2003gb_2,sardegna_2003gb_3,sardegna_2003gb_4,sardegna_2003gb_5,sardegna_2003gb_6,sardegna_2003gb_7,sardegna_2003gb_8,sardegna_2003gb_9,CTR10K%20raster
+# farbiges Luftbild mit Raterdaten ?berlagert 
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1,CTR10K%20raster
+# farbiges Luftbild anscheinend nur die layer entsprchend der Skalierung angeben ( es tun nur die Skalierungen 1 bis 4)
+#LayersUrlPart:   LAYERS=mosaico_2006IT_1
+LayersUrlPart:   LAYERS=CTR10K%20raster
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 41.400307 E 7.964019
+BoundingBoxButtomRightWGS84:   N 38.792131 E 10.022418
+MinScale:   1
+MaxScale:   3
+#RecommendedScale:   1 - 2.000 bei gr?sserer Skalierung wird es un?bersichtlich
+RecommendedScale:   1.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/it_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/it_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/it_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl: http://wiki.gfoss.it/index.php/GIS_Open_Data#Italia
+GetCapabilitiesUrl: http://151.13.182.121/geoserver/wms?service=WMS&request=GetCapabilities
+Name: it topo 25
+MapType: topo
+MainUrl: http://151.13.182.121/geoserver/wms?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart: VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf: 31466 31467 4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:4326
+RequestUrlPart: REQUEST=GetMap
+LayersUrlPart: LAYERS=cnr_imaa:igm25000
+StylesUrlPart: STYLES=raster
+ImageFormatUrlPart: FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 47.165454 E 6.581957
+BoundingBoxButtomRightWGS84: N 35.485254 E 18.548357
+MinScale: 0.0
+MaxScale: 23.335
+RecommendedScale: 5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/jp-t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/jp-t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/jp-t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,37 @@
+TakenFromUrl:       http://www.esri.com
+GetCapabilitiesUrl: http://www.geographynetwork.ne.jp/ogc/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               jp topo
+MapType:                        topo
+MainUrl:            http://www.geographynetwork.ne.jp/ogc/wms?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=1|Hill Shade||
+#LayersUrlPart:     LAYERS=0|Elevation||
+#LayersUrlPart:     LAYERS=2|Cities||
+#LayersUrlPart:     LAYERS=3|Cities(small scale)||
+#LayersUrlPart:     LAYERS=4|Prefectures||
+#LayersUrlPart:     LAYERS=5|Rivers||
+#LayersUrlPart:     LAYERS=6|Rivers(small scale)||
+#LayersUrlPart:     LAYERS=7|Water||
+#LayersUrlPart:     LAYERS=8|Water(small scale)||
+#LayersUrlPart:     LAYERS=9|Streets||
+#LayersUrlPart:     LAYERS=10|Railways||
+#LayersUrlPart:     LAYERS=11|Railways(small scale)||
+#LayersUrlPart:     LAYERS=12|Stations||
+#LayersUrlPart:     LAYERS=13|Major Roads||
+#LayersUrlPart:     LAYERS=14|Major Roads(small scale)||
+#LayersUrlPart:     LAYERS=15|Location Name||
+#LayersUrlPart:     LAYERS=16|Public Facilities||
+#LayersUrlPart:     LAYERS=17|Control Points||
+LayersUrlPart:     LAYERS=1,0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 45.576199 E 122.521907
+BoundingBoxButtomRightWGS84: N 20.424949 E 145.888782
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/pt_t500.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/pt_t500.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/pt_t500.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,21 @@
+TakenFromUrl:       http://mapas.igeo.pt
+GetCapabilitiesUrl: http://mapas.igeo.pt/wms/sc500k?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               pt topo 500
+MapType:                        topo
+MainUrl:            http://mapas.igeo.pt/wms/sc500k?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=500k|Servidor WMS Produtos IGP - Carta de Portugal 1:500 000 (Continente)|0.249451424214819|249451.424214819
+#LayersUrlPart:     LAYERS=sc500k|Carta de Portugal Continental 1:500.000|0.249451424214819|249451.424214819
+LayersUrlPart:     LAYERS=sc500k
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 42.2787 W 10.1943
+BoundingBoxButtomRightWGS84: N 36.7636 W 5.71067
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/untested/us_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/us_t.wms	2009-02-23 22:19:58 UTC (rev 1650)
+++ trunk/res_noewe/webmapservices/untested/us_t.wms	2009-02-23 23:37:31 UTC (rev 1651)
@@ -0,0 +1,19 @@
+TakenFromUrl:   http://www.perrygeo.net/wordpress/?p=35
+GetCapabilitiesUrl:      -
+Name:   us topo 24
+MainUrl:   http://terraservice.net/ogcmap.ashx?
+MapType: topo
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=DRG
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84:   N 75.0 W 179.9
+BoundingBoxButtomRightWGS84:   N 20.0 W 60.0
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .jpg



From engywuck at mail.berlios.de  Tue Feb 24 17:06:59 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Tue, 24 Feb 2009 17:06:59 +0100
Subject: [Cachewolf-svn] r1652 - trunk/docs
Message-ID: <200902241606.n1OG6x0S030396@sheep.berlios.de>

Author: engywuck
Date: 2009-02-24 17:06:57 +0100 (Tue, 24 Feb 2009)
New Revision: 1652

Added:
   trunk/docs/Konzept_Imperiales_System.txt
Log:
Adding concept (in german) for implementing the imperial system. 

Added: trunk/docs/Konzept_Imperiales_System.txt
===================================================================
--- trunk/docs/Konzept_Imperiales_System.txt	2009-02-23 23:37:31 UTC (rev 1651)
+++ trunk/docs/Konzept_Imperiales_System.txt	2009-02-24 16:06:57 UTC (rev 1652)
@@ -0,0 +1,47 @@
+Konzept zur Meilenunterst?tzung
+===============================
+
+1. Verankerung in Preferences
+CW bekommt eine zentrale Variable, die speichert, ob Entfernungen imperial
+oder metrisch angegeben sind. Diese wird ?ber die Preferences gesetzt und
+gespeichert. 
+
+2. Interne Rechnungen
+Alle internen Berechnungen verwenden das metrische System. D.h.: Funktionen,
+die Entferungen als Argumente entgegennehmen, tun dies in km bzw. m. 
+Funktionsergebnisse sind stets in km  bzw. m. Ausnahmen siehe 4.
+
+3. Darstellung
+Werden Entferungen auf der Oberfl?che ausgegeben, so werden sie ggf. 
+in Meilen/Feet umgerechnet(*). Werden Entferungsdaten in der Oberfl?che
+eingegeben, so erfolgt vor der Verwendung ggf. eine Umrechnung in km
+bzw. m.
+Werden in der Oberfl?che km verwendet, so werden im imperialen System
+Meilen verwendet, analog m <-> Fu?.
+(*) Dies erfordert die Identifikation aller Stellen, wo Entferungs-
+angaben auf der Oberfl?che aus- oder eingegeben werden.
+
+4. Solver-Funktionen
+L?uft CW im imperialen Modus, so erwartet der Anwender auch im Solver,
+dass er Argumente als Meilen bzw. Fu? angeben kann.
+Daher erwarten die vom Solver aufgerufenen Prim?rfunktionen (z.B. 
+Parser.funcProject() ) ggf. Entferungen in Meilen. Die dahinter 
+liegenden Arbeitsfunktionen verwenden Daten wie gehabt; die 
+Umrechnung findet in der Prim?rfunktion statt.
+
+5. Rechner
+Ist das imperiale System eingestellt, so ist "Fu?" der Vorgabewert
+f?r die Einheit.
+
+6. Moving Map
+Da ich die Map nicht nutze, habe ich keine Erfahrung, was dort an
+Entferungen aus- oder eingegeben wird und ob irgendwelche Spezialit?ten
+zu beachten sind.
+
+7. Anpassung der Oberfl?che
+Teilweise erscheinen auf der Oberfl?che Einheiten, z.b. beim
+Spiderradius. Diese Einheit muss entsprechend angepasst werden.
+Kann man das im laufenden Betrieb (d.h. nach Erzeugen der Form) 
+noch ?ndern? Sonst w?re 1. ein Fall f?r "?nderungen werden
+erst nach Neustart wirksam."
+  
\ No newline at end of file


Property changes on: trunk/docs/Konzept_Imperiales_System.txt
___________________________________________________________________
Name: svn:mergeinfo
   + 



From greiol at mail.berlios.de  Wed Feb 25 20:12:48 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 25 Feb 2009 20:12:48 +0100
Subject: [Cachewolf-svn] r1653 - trunk/src/exp
Message-ID: <200902251912.n1PJCmKV014668@sheep.berlios.de>

Author: greiol
Date: 2009-02-25 20:12:37 +0100 (Wed, 25 Feb 2009)
New Revision: 1653

Modified:
   trunk/src/exp/GPXExporter.java
Log:
The files genearted by the GPXExporter did not validate against the DTD and confused other software that expected the tags to be "in order"

Modified: trunk/src/exp/GPXExporter.java
===================================================================
--- trunk/src/exp/GPXExporter.java	2009-02-24 16:06:57 UTC (rev 1652)
+++ trunk/src/exp/GPXExporter.java	2009-02-25 19:12:37 UTC (rev 1653)
@@ -56,6 +56,9 @@
 			String tim = ch.DateHidden.length()>0 ? ch.DateHidden : DEFAULT_DATE;
 			strBuf.append("    <time>").append(tim.toString()).append("T00:00:00.0000000-07:00</time>\r\n");
 			strBuf.append("    <name>").append(ch.wayPoint).append("</name>\r\n");
+			if (ch.isAddiWpt()){
+				strBuf.append("    <cmt>").append(SafeXML.cleanGPX(ch.LongDescription)).append("</cmt>\r\n");
+			}
 			strBuf.append("    <desc>").append(SafeXML.cleanGPX(ch.CacheName)).append(" by ").append(SafeXML.cleanGPX(ch.CacheOwner)).append("</desc>\r\n");
 			strBuf.append("    <url>http://www.geocaching.com/seek/cache_details.aspx?wp=").append(ch.wayPoint).append("&amp;Submit6=Find</url>\r\n");
 			strBuf.append("    <urlname>").append(SafeXML.cleanGPX(ch.CacheName)).append(" by ").append(SafeXML.cleanGPX(ch.CacheOwner)).append("</urlname>\r\n");
@@ -83,7 +86,6 @@
 				strBuf.append("    </groundspeak:cache>\r\n");
 			}else {
 				// there is no HTML in the description of addi wpts
-				strBuf.append("    <cmt>").append(SafeXML.cleanGPX(ch.LongDescription)).append("</cmt>\r\n");
 				strBuf.append("    <sym>").append(CacheType.transType(ch.type)).append("</sym>\r\n");
 				strBuf.append("    <type>Waypoint|").append(CacheType.transType(ch.type)).append("</type>\r\n");
 			}
@@ -97,7 +99,7 @@
 	}
 	
 	public String trailer() {
-		return "</gpx>";
+		return "</gpx>\r\n";
 	}
 	
 }



From admin at berlios.de  Wed Feb 25 20:15:01 2009
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 25 Feb 2009 20:15:01 +0100 (CET)
Subject: [Bug #15299] GPX Exporter erzeugt ungültige Dateien
Message-ID: <200902251915.n1PJF1D6028010@unicorn.berlios.de>

Bug #15299, was updated on 2009-Feb-21 10:35
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Fixed, ready to test
Priority: 5
Submitted by: greiol
Assigned to : greiol
Summary: GPX Exporter erzeugt ung?ltige Dateien

Details: Details und Patch siehe http://www.geoclub.de/viewtopic.php?f=40&t=31562

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15299&group_id=2211


From admin at berlios.de  Wed Feb 25 20:27:00 2009
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 25 Feb 2009 20:27:00 +0100 (CET)
Subject: [Bug #15146] GPX Importer erkennt Funddatum nicht für Events und Webcams
Message-ID: <200902251927.n1PJR0d0026013@unicorn.berlios.de>

Bug #15146, was updated on 2009-Jan-28 20:34
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: Fixed
Bug Group: Fixed, ready to test
Priority: 5
Submitted by: greiol
Assigned to : greiol
Summary: GPX Importer erkennt Funddatum nicht f?r Events und Webcams

Details: Der GPX Importer erkennt das Funddatum bei Webcams und Events nicht, da nur auf icon_smile, nicht aber auf 11.png und icon_attended gepr?ft wird.

fix:
in GPXImporter.java die zeile
if(logIcon.equals("icon_smile.gif") &&
durch die zeile
if((logIcon.equals("icon_smile.gif") || logIcon.equals("11.png") || logIcon.equals("icon_attended.gif")) &&
ersetzen. 

leider kann ich kein patchfile anh?ngen

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15146&group_id=2211


From greiol at mail.berlios.de  Wed Feb 25 20:28:39 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 25 Feb 2009 20:28:39 +0100
Subject: [Cachewolf-svn] r1654 - trunk/src/CacheWolf
Message-ID: <200902251928.n1PJSdKD015847@sheep.berlios.de>

Author: greiol
Date: 2009-02-25 20:28:26 +0100 (Wed, 25 Feb 2009)
New Revision: 1654

Modified:
   trunk/src/CacheWolf/GPXImporter.java
Log:
bug#015146 - gpx importer does not rate "attended" and "webcam photo taken" as found logs

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2009-02-25 19:12:37 UTC (rev 1653)
+++ trunk/src/CacheWolf/GPXImporter.java	2009-02-25 19:28:26 UTC (rev 1654)
@@ -262,7 +262,7 @@
 			}
 			if (name.equals("groundspeak:log") || name.equals("log") || name.equals("terra:log") ) {
 				chD.CacheLogs.add(new Log(logIcon,logDate,logFinder,logData));
-				if(logIcon.equals("icon_smile.gif") && 
+				if((logIcon.equals("icon_smile.gif") || logIcon.equals("11.png") || logIcon.equals("icon_attended.gif")) && 
 						  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
 							chD.CacheStatus=logDate;
 							chD.is_found=true;



From engywuck at mail.berlios.de  Thu Feb 26 20:11:46 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Thu, 26 Feb 2009 20:11:46 +0100
Subject: [Cachewolf-svn] r1655 - in trunk: res_noewe/languages src/CacheWolf
	src/CacheWolf/navi src/exp
Message-ID: <200902261911.n1QJBkP8026425@sheep.berlios.de>

Author: engywuck
Date: 2009-02-26 20:11:37 +0100 (Thu, 26 Feb 2009)
New Revision: 1655

Added:
   trunk/src/CacheWolf/navi/Metrics.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/CalcPanel.java
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/FilterScreen.java
   trunk/src/CacheWolf/MyComparer.java
   trunk/src/CacheWolf/OCXMLImporterScreen.java
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/myTableModel.java
   trunk/src/CacheWolf/navi/GotoPanel.java
   trunk/src/exp/HTMLExporter.java
   trunk/src/exp/TPLExporter.java
Log:
Support for imperial units. (http://www.geoclub.de/viewtopic.php?f=40&t=31674)
Moving map is still missing, because I have no idea what is going on there...

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/res_noewe/languages/DE.cfg	2009-02-26 19:11:37 UTC (rev 1655)
@@ -148,6 +148,9 @@
 		351=Notizen hinzuf%fcgen/%e4ndern
 		400=Dekodieren
 		500=Umschalten
+		588=L%e4ngeneinheiten
+		589=Metrisch (km)
+		590=Imperial (Meilen)
 		591=Leer f%fcr Sprache des Betriebssystems%0aoder 2 Zeichen f%fcr andere Sprache , z.B. DE, EN
 		592=Sprache (braucht Neustart)
 		593=Password ist hier optional.%0aNur eingeben wenn es in pref.xml%0agespeichert werden soll.

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/res_noewe/languages/EN.cfg	2009-02-26 19:11:37 UTC (rev 1655)
@@ -149,6 +149,9 @@
 		351=Add/Edit notes
 		400=Dekode
 		500=Switch
+		588=Unit System
+		589=Metric (km)
+		590=Imperial (mi.)
 		591=Leave empty for default language or%0aadd 2 character language, e.g. DE, EN
 		592=Language (needs restart)
 		593=Password is optional here.%0aEnter only if you want to store it in pref.xml

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/res_noewe/languages/FR.cfg	2009-02-26 19:11:37 UTC (rev 1655)
@@ -148,6 +148,9 @@
 		351=Ajouter/changer notes
 		400=D%e9coder
 		500=Changer
+		588=Syst%e8me de mesure
+		589=M%e9trique (km)
+		590=Imp%e9rial (milles)
 		591=Vide pour langue de syst%e8me d'exploitation%0aou deux aract%e8res pour autre langure, p.ex. DE, EN
 		592=Langue (faut redemarrer)
 		593=Le mot de passe est optionel ici.%0aL'entrer seulement s'il doit enregistrer en fichier pref.xml

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/res_noewe/languages/NL.cfg	2009-02-26 19:11:37 UTC (rev 1655)
@@ -140,6 +140,9 @@
 		351=Toevoegen/wijzigingen notities.
 		400=Decoderen
 		500=Omdraaien
+		588=
+		589=
+		590=
 		591=Laat leeg voor standaard taal of%0avoeg 2 karakters toe voor taal, bv. DE,EN,NL
 		592=Taal(herstart noodzakelijk)
 		593=Password is optioneel.%0aAlleen gebruiken als je het wil opslaan in pref.xml.

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -1,9 +1,12 @@
 package CacheWolf;
 
+import CacheWolf.navi.Metrics;
+
 import com.stevesoft.ewe_pat.Regex;
 
 import ewe.io.IOException;
 import ewe.sys.Convert;
+import ewe.sys.Vm;
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
 import ewe.util.Vector;
@@ -14,8 +17,11 @@
  *	classes and methods to get more information.
  *	
  */
+/**
+ * @author torsti
+ *
+ */
 public class CacheHolder {
-	protected static final String NODISTANCE = "? km";
 	protected static final String NOBEARING = "?";
 	protected static final String EMPTY = "";
 
@@ -36,9 +42,10 @@
 	/** The size of the cache (as per GC cache sizes Micro, Small, ....) */
 	public String CacheSize = "None";
 	/** The distance from the centre in km */
-	public double kilom = 0;
-	/** The formatted distance such as "x.xx km" */
-	public String distance = NODISTANCE;
+	public double kilom = -1; int bla = 0;
+	public double lastKilom = -2; // Cache last value
+	public int lastMetric = -1; // Cache last metric
+	public String lastDistance = ""; // Cache last distance
 	/** The bearing N, NNE, NE, ENE ... from the current centre to this point */
 	public String bearing = NOBEARING;
 	/** The angle (0=North, 180=South) from the current centre to this point */
@@ -229,6 +236,45 @@
 		}
 	}
 
+	/**
+	 * Returns the distance in formatted output. Using kilometers when metric system is active,
+	 * using miles when imperial system is active.
+	 * 
+	 * @return The current distance.
+	 */
+	public String getDistance() {
+		String result = null;
+		String newUnit = null;
+
+		if (this.kilom == this.lastKilom && Global.getPref().metricSystem == this.lastMetric) {
+			result = this.lastDistance;
+		} else {
+			if (this.kilom >= 0) {
+				double newValue = 0;
+				switch (Global.getPref().metricSystem) {
+				case Metrics.METRIC:
+					newValue = this.kilom;
+					newUnit = Metrics.getUnit(Metrics.KILOMETER);
+					break;
+				case Metrics.IMPERIAL:
+					newValue = Metrics.convertUnit(this.kilom, Metrics.KILOMETER, Metrics.MILES);
+					newUnit = Metrics.getUnit(Metrics.MILES);
+					break;
+				}
+				result = MyLocale.formatDouble(newValue, "0.00") + " " + newUnit;
+			} else {
+				result = "? "
+				        + (Global.getPref().metricSystem == Metrics.METRIC ? Metrics
+				                .getUnit(Metrics.KILOMETER) : Metrics.getUnit(Metrics.MILES));
+			}
+			// Caching values, so reevaluation is only done when really needed
+			this.lastKilom = this.kilom;
+			this.lastMetric = Global.getPref().metricSystem;
+			this.lastDistance = result;
+		}
+		return result;
+	}
+	
 	public void update(CacheHolder ch) {
 		update(ch, false);
 	}
@@ -267,7 +313,6 @@
 		this.DateHidden = ch.DateHidden;
 		this.CacheSize = ch.CacheSize;
 		this.kilom = ch.kilom;
-		this.distance = ch.distance;
 		this.bearing = ch.bearing;
 		this.degrees = ch.degrees;
 		this.hard = ch.hard;
@@ -389,9 +434,8 @@
 			kilom = pos.getDistance(toPoint);
 			degrees = toPoint.getBearing(pos);
 			bearing = CWPoint.getDirection(degrees);
-			distance = MyLocale.formatDouble(kilom,"0.00")+" km";
 		} else {
-			distance = NODISTANCE;
+			kilom = -1;
 			bearing = NOBEARING;
 		}
 	}

Modified: trunk/src/CacheWolf/CalcPanel.java
===================================================================
--- trunk/src/CacheWolf/CalcPanel.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/CalcPanel.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.navi.Metrics;
 import ewe.ui.*;
 import ewe.ui.formatted.TextDisplay;
 import ewe.util.Vector;
@@ -90,7 +91,11 @@
 			inpDistance.setPreferredSize(fm.getTextWidth("99999999"),fm.getHeight()*4/3);
 		}
 		BottomP.addLast(chcDistUnit = new mChoice(new String[]{"m", "km", MyLocale.getMsg(1407,"steps"), MyLocale.getMsg(1408,"feet"), MyLocale.getMsg(1409,"yards"), MyLocale.getMsg(1410,"miles")},0),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST)).setTag(CellConstants.INSETS,new ewe.fx.Insets(0,2,0,0));
-		chcDistUnit.setInt(0);
+		if (Global.getPref().metricSystem == Metrics.METRIC) {
+			chcDistUnit.setInt(0); // Meter
+		} else {
+			chcDistUnit.setInt(3); // Feet
+		}
 		
 		// Buttons for calc and save
 		BottomP.addNext(btnCalc = new mButton("Calc"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/Filter.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -413,7 +413,7 @@
 			// Filter criterium 3: Distance
 			///////////////////////////////
 			if(fscDist>0.0){
-				dummyd1 = Common.parseDouble(ch.distance.substring(0,ch.distance.length()-3)); 
+				dummyd1 = ch.kilom; 
 				if(distdirec == SMALLER && dummyd1 > fscDist)  { ch.is_filtered=true; continue; }
 				if(distdirec == GREATER && dummyd1 < fscDist)  { ch.is_filtered=true; continue; }
 			}

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/FilterScreen.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -1,4 +1,5 @@
 package CacheWolf;
+import CacheWolf.navi.Metrics;
 import ewe.ui.*;
 import ewe.io.*;
 import ewe.fx.*;
@@ -322,7 +323,13 @@
 				chcDist.select(0);
 			else
 				chcDist.select(1);
-			inpDist.setText(prof.filterDist.substring(1));
+			String dist = prof.filterDist.substring(1);
+			if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
+				double distValue = java.lang.Double.valueOf(dist);
+				double newDistValue = Metrics.convertUnit(distValue, Metrics.KILOMETER, Metrics.MILES);
+				dist = String.valueOf(newDistValue);
+			}
+			inpDist.setText(dist);
 		} else {
 			chcDist.select(0);
 			inpDist.setText("");
@@ -626,10 +633,22 @@
 							(chkVeryLarge.state ? "1" : "0")+
 							(chkOther.state ? "1" : "0");
 				
+				// Distance: If Metric system is set to imperial units,
+				//           then the entered value is meant to be miles,
+				//           otherwise it's kilometer.
+				double distValue = java.lang.Double.NaN;
+				String rawDistance = inpDist.getText().replace(',', '.');
+				String newDistance = rawDistance; // initial Value;
+				if (! rawDistance.trim().equals("")) {
+					distValue = java.lang.Double.valueOf(rawDistance);
+					if (Global.getPref().metricSystem == Metrics.IMPERIAL){
+						newDistance = String.valueOf(Metrics.convertUnit(distValue, Metrics.MILES, Metrics.KILOMETER));
+					}
+				}
 				if(chcDist.selectedIndex == 0) { 
-					pfl.filterDist="L"+inpDist.getText();
+					pfl.filterDist="L"+newDistance;
 				} else { 
-					pfl.filterDist="G"+inpDist.getText();
+					pfl.filterDist="G"+newDistance;
 				}
 					
 				if(chcDiff.selectedIndex == 0) { 

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/MyComparer.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -65,12 +65,8 @@
 		} else if (colToCompare==10) {
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=(CacheHolder) cacheDB.get(i);
-				int p=ch.distance.indexOf(",");
-				if (p<0) p=ch.distance.indexOf(".");
-				if (p>=0 && p<=5)
-					ch.sort="00000".substring(0,5-p)+ch.distance;
-				else
-					ch.sort=ch.distance;
+				// CHECK Is the formatting correctly done?
+				ch.sort = MyLocale.formatDouble(ch.kilom*1000, "000000000000");
 			}
 		} else if (colToCompare==11) {
 			for (int i=0; i<visibleSize; i++) {

Modified: trunk/src/CacheWolf/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporterScreen.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/OCXMLImporterScreen.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -47,7 +47,7 @@
 			}
 			distanceInput.setText(dist1);
 			this.addNext(distanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-			this.addLast(distUnit = new mLabel(" km"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			this.addLast(distUnit = new mLabel(" km/mi."),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		}
 
 		if ((options & IMAGES) > 0) {

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/Parser.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -45,6 +45,7 @@
 package CacheWolf;
 
 import ewe.util.*;
+import CacheWolf.navi.Metrics;
 import CacheWolf.navi.Navigate;
 
 import com.stevesoft.ewe_pat.*;
@@ -478,11 +479,18 @@
     private double funcDistance() throws Exception {
     	String coordB=popCalcStackAsString();
     	String coordA=popCalcStackAsString();
+    	double result = 0;
 		// Attention: isValidCoord has sideeffect of setting cwPt
     	if (!isValidCoord(coordA)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordA);
 		if (!isValidCoord(coordB)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordB);
     	cwPt.set(coordA);
-    	return cwPt.getDistance(new CWPoint(coordB))*1000.0;
+    	double distKM = cwPt.getDistance(new CWPoint(coordB));
+    	result = distKM*1000.0;
+    	if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
+    		result = Metrics.convertUnit(distKM, Metrics.KILOMETER, Metrics.MILES);
+    		result = Metrics.convertUnit(result, Metrics.MILES, Metrics.YARDS);
+    	}
+    	return result;
     }
 
     /**
@@ -620,7 +628,13 @@
     	String coord=popCalcStackAsString();
 		if (!isValidCoord(coord)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coord);
     	cwPt.set(coord);
-    	return cwPt.project(degrees,distance/1000.0).toString();
+    	if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
+    		distance = Metrics.convertUnit(distance, Metrics.YARDS, Metrics.MILES);
+    		distance = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
+    	} else {
+    		distance = distance / 1000.0;
+    	}
+    	return cwPt.project(degrees,distance).toString();
     }
 
     /** Convert Radiants into degrees */

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/Preferences.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -1,4 +1,5 @@
 package CacheWolf;
+import CacheWolf.navi.Metrics;
 import utils.FileBugfix;
 import ewe.io.*;
 import ewe.sys.*;
@@ -193,6 +194,8 @@
 	public int deleteDetails=5;
 	/** The locale code (DE, EN, ...) */
 	public String language="";
+	/** The metric system to use */
+	public int metricSystem = Metrics.METRIC;
 
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
@@ -365,6 +368,13 @@
 			if (maxDetails<2) maxDetails=2;
 			if (deleteDetails<1) deleteDetails=1;
 		}
+		else if (name.equals("metric")) {
+			metricSystem=Common.parseInt(atts.getValue("type"));
+			if (metricSystem != Metrics.METRIC &&
+					metricSystem != Metrics.IMPERIAL) {
+				metricSystem = Metrics.METRIC;
+			}
+		}
 		else if (name.equals("locale")) {
 			language = atts.getValue("language");
 		}
@@ -425,6 +435,7 @@
 			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\"/>\n");
 			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
 			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
+			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\"/>\n");
 			if (customMapsPath!=null) outp.print("	<mapspath dir = \"" + SafeXML.strxmlencode(customMapsPath.replace('\\','/')) + "\"/>\n");
 			if (debug) outp.print("    <debug value=\"true\" />\n"); // Keep the debug switch if it is set
 			// save last path of different exporters

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.navi.Metrics;
 import utils.FileBugfix;
 import ewe.ui.*;
 import ewe.io.*;
@@ -15,7 +16,7 @@
 */
 public class PreferencesScreen extends Form {
 	mButton cancelB, applyB, brwBt, gpsB,btnCentre;
-	mChoice NS, EW, inpLanguage;
+	mChoice NS, EW, inpLanguage, inpMetric;
 	mInput NSDeg, NSm, EWDeg, EWm, DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, inpGPS, 
 	       inpLogsPerPage,inpMaxLogsToSpider,inpPassword;
 	mCheckBox dif, ter, loc, own, hid, stat, dist, bear, chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, 
@@ -208,7 +209,11 @@
 		pnlMore.addLast(inpLanguage=new mChoice(langs, curlang),DONTSTRETCH,DONTFILL|WEST);
 		//inpLanguage.setPreferredSize(20,-1);
 		inpLanguage.setToolTip(MyLocale.getMsg(591,"Select \"auto\" for system language or select your preferred language, e.g. DE or EN"));
-		
+		String [] metriken = {MyLocale.getMsg(589, "Metric (km)"), 
+				              MyLocale.getMsg(590, "Imperial (mi)")};
+		pnlMore.addNext(new mLabel(MyLocale.getMsg(588, "Length units")),DONTSTRETCH,DONTFILL|WEST);
+		int currMetrik = pref.metricSystem == Metrics.METRIC ? 0 : 1;
+		pnlMore.addLast(inpMetric=new mChoice(metriken, currMetrik),DONTSTRETCH,DONTFILL|WEST);
 		/////////////////////////////////////////////////////////
 		// Fourth/Fifth panel - Listview and Travelbugs
 		/////////////////////////////////////////////////////////
@@ -302,6 +307,7 @@
 				pref.listColMap=tccList.getSelectedCols();
 				pref.descShowImg=chkDescShowImg.getState();
 				Global.mainTab.tbP.myMod.setColumnNamesAndWidths();
+				pref.metricSystem = inpMetric.getInt() == 0 ? Metrics.METRIC : Metrics.IMPERIAL;
 				pref.savePreferences();
 				pref.dirty = true; // Need to update table in case columns were enabled/disabled
 				this.close(0);

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -78,7 +78,7 @@
 					tpl.setParam("DIFFICULTY", (String) diff.get(chD.hard.replace(',','.')));
 					if (chD.terrain.endsWith(".0")) chD.terrain=chD.terrain.substring(0,chD.terrain.length()-2);
 					tpl.setParam("TERRAIN", (String) terr.get(chD.terrain.replace(',','.')));
-					tpl.setParam("DISTANCE", chD.distance.replace(',','.'));
+					tpl.setParam("DISTANCE", chD.getDistance().replace(',','.'));
 					tpl.setParam("BEARING", chD.bearing);
 					if (chD.pos!=null && chD.pos.isValid()) {
 						tpl.setParam("LATLON", chD.LatLon);

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/myTableModel.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -255,7 +255,7 @@
 					case 9: // Status
 						return ch.CacheStatus;
 					case 10: // Distance
-						return ch.distance;
+						return ch.getDistance();
 					case 11: // Bearing
 						return ch.bearing;
 					case 12: // Size

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -545,19 +545,36 @@
 		
 		g.setColor(Color.Black);		
 		
+		int metricSystem = Global.getPref().metricSystem;
 		Double tmp = new Double();
 		strTemp = "";
-		if ( distance >= 0.0f ) {
-			tmp.set(distance);
-			if (tmp.value >= 1){
-				strTemp = MyLocale.formatDouble(tmp,"0.000")+ " km";
+		double newDistance = 0;
+		int bigUnit = -1; 
+		int smallUnit = -1;
+		double threshold = -1;
+		// Allow for different metric systems
+		if (metricSystem == Metrics.METRIC) {
+			bigUnit = Metrics.KILOMETER;
+			smallUnit = Metrics.METER;
+			threshold = 1.0;
+			newDistance = distance;
+		} else if (metricSystem == Metrics.IMPERIAL) {
+			// Why these values? See: http://tinyurl.com/b4nn9m
+			bigUnit = Metrics.MILES;
+			smallUnit = Metrics.FEET;
+			threshold = 0.1;
+			newDistance = Metrics.convertUnit(distance, Metrics.KILOMETER, Metrics.MILES);
+		}
+		if ( newDistance >= 0.0f ) {
+			tmp.set(newDistance);
+			if (tmp.value >= threshold){
+				strTemp = MyLocale.formatDouble(tmp,"0.000")+ " " + Metrics.getUnit(bigUnit);
+			} else {
+				tmp.set(Metrics.convertUnit(tmp.value, bigUnit, smallUnit));
+				strTemp = tmp.toString(3,0,0) + " " + Metrics.getUnit(smallUnit);
 			}
-			else {
-				tmp.set(tmp.value * 1000);
-				strTemp = tmp.toString(3,0,0) + " m";
-			}
 		}
-		else strTemp = "--- km";
+		else strTemp = "--- "+Metrics.getUnit(bigUnit);
 		g.drawText(strTemp, 2, lineHeight);
 		
 		tmp.set(gotoDir);
@@ -574,14 +591,25 @@
 		
 		Double tmp = new Double();
 
-		tmp.set(m_speed);
-		String strSpeed = "- km/h";
-		if (m_speed >= 0) {
-			if (m_speed >= 100) {
-				strSpeed = MyLocale.formatDouble(tmp,"0") + " km/h";				
+		String strSpeed = null;
+		String unit = null;
+
+		// Allow for different metric systems
+		if (Global.getPref().metricSystem == Metrics.METRIC) {
+			tmp.set(m_speed);
+			unit = " km";
+			strSpeed = "- km/k";
+		} else if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
+			tmp.set(Metrics.convertUnit(m_speed, Metrics.KILOMETER, Metrics.MILES));
+			unit = " mph";
+			strSpeed = "- mph";
+		}
+		if (tmp.value >= 0) {
+			if (tmp.value >= 100) {
+				strSpeed = MyLocale.formatDouble(tmp,"0") + unit;				
 			}
 			else {
-				strSpeed = MyLocale.formatDouble(tmp,"0.0") + " km/h";
+				strSpeed = MyLocale.formatDouble(tmp,"0.0") + unit;
 			}
 		}
 		

Added: trunk/src/CacheWolf/navi/Metrics.java
===================================================================
--- trunk/src/CacheWolf/navi/Metrics.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/CacheWolf/navi/Metrics.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -0,0 +1,106 @@
+/**
+ * 
+ */
+package CacheWolf.navi;
+
+/**
+ * @author Engywuck
+ *
+ */
+public final class Metrics {
+
+	/** Constant for use of metric units */
+	public static final int METRIC = 1;
+	/** Constant for use of imperial units */
+	public static final int IMPERIAL = 2;
+	
+	public static final int KILOMETER = 10;
+	public static final int METER  = 11;
+	
+	public static final int MILES = 20;
+	public static final int YARDS = 21;
+	public static final int FEET  = 22;
+	
+	private static final double FCT_MILE2KILOMETER = 1.609344;
+	private static final double FCT_MILE2YARD = 1760;
+	private static final double FCT_MILE2FOOT = 5280;
+	
+	public static final double convertUnit(double value, int sourceUnit, int targetUnit) {
+		double result = Double.NaN;
+		if (sourceUnit == targetUnit) {
+			result = value;
+		} else {
+			switch (sourceUnit) {
+			case KILOMETER:
+				switch (targetUnit) {
+				case MILES:
+					result = value / FCT_MILE2KILOMETER;
+					break;
+				}
+				break;
+			case MILES:
+				switch (targetUnit) {
+				case KILOMETER:
+					result = value * FCT_MILE2KILOMETER;
+					break;
+				case YARDS:
+					result = value * FCT_MILE2YARD;
+					break;
+				case FEET:
+					result = value * FCT_MILE2FOOT;
+					break;
+				}
+				break;
+			case YARDS:
+				switch (targetUnit) {
+				case MILES:
+					result = value / FCT_MILE2YARD;
+					break;
+				case FEET:
+					result = value / FCT_MILE2YARD * FCT_MILE2FOOT;
+					break;
+				}
+				break;
+			case FEET:
+				switch (targetUnit) {
+				case MILES:
+					result = value / FCT_MILE2FOOT;
+					break;
+				case YARDS:
+					result = value * FCT_MILE2YARD / FCT_MILE2FOOT;
+					break;
+				}
+				break;
+			}
+		}
+		if (result == Double.NaN) {
+			// TODO Meldung verbessern
+			throw new UnsupportedOperationException("Cannot convert");
+		}
+		return result;
+	}
+	
+	public static final String getUnit(int unit) {
+		String result=null;
+		switch (unit) {
+		case KILOMETER:
+			result = "km";
+			break;
+		case METER:
+			result = "m";
+			break;
+		case MILES:
+			result = "mi.";
+			break;
+		case YARDS:
+			result = "yd.";
+			break;
+		case FEET:
+			result = "ft.";
+			break;
+		default:
+			throw new UnsupportedOperationException("Unknown unit: "+String.valueOf(unit));			
+		}
+		return result;
+	}
+}

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/exp/HTMLExporter.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -92,7 +92,7 @@
 					varParams.put("OWNER", holder.CacheOwner);
 					varParams.put("DIFFICULTY", holder.hard);
 					varParams.put("TERRAIN", holder.terrain);
-					varParams.put("DISTANCE", holder.distance);
+					varParams.put("DISTANCE", holder.getDistance());
 					varParams.put("BEARING", holder.bearing);
 					varParams.put("LATLON", holder.LatLon);
 					varParams.put("STATUS", holder.CacheStatus);
@@ -108,7 +108,7 @@
 						page_tpl.setParam("OWNER", holder.CacheOwner);
 						page_tpl.setParam("DIFFICULTY", holder.hard);
 						page_tpl.setParam("TERRAIN", holder.terrain);
-						page_tpl.setParam("DISTANCE", holder.distance);
+						page_tpl.setParam("DISTANCE", holder.getDistance());
 						page_tpl.setParam("BEARING", holder.bearing);
 						page_tpl.setParam("LATLON", holder.LatLon);
 						page_tpl.setParam("STATUS", holder.CacheStatus);

Modified: trunk/src/exp/TPLExporter.java
===================================================================
--- trunk/src/exp/TPLExporter.java	2009-02-25 19:28:26 UTC (rev 1654)
+++ trunk/src/exp/TPLExporter.java	2009-02-26 19:11:37 UTC (rev 1655)
@@ -206,7 +206,7 @@
 						varParams.put("OWNER", holder.CacheOwner);
 						varParams.put("DIFFICULTY", dec.replaceAll(holder.hard));
 						varParams.put("TERRAIN", dec.replaceAll(holder.terrain));
-						varParams.put("DISTANCE", dec.replaceAll(holder.distance));
+						varParams.put("DISTANCE", dec.replaceAll(holder.getDistance()));
 						varParams.put("BEARING", holder.bearing);
 						varParams.put("LATLON", holder.LatLon);
 						varParams.put("LAT", dec.replaceAll(holder.pos.getLatDeg(CWPoint.DD)));



From engywuck at mail.berlios.de  Thu Feb 26 22:05:54 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Thu, 26 Feb 2009 22:05:54 +0100
Subject: [Cachewolf-svn] r1656 - trunk/res_noewe/languages
Message-ID: <200902262105.n1QL5s6E003322@sheep.berlios.de>

Author: engywuck
Date: 2009-02-26 22:05:53 +0100 (Thu, 26 Feb 2009)
New Revision: 1656

Modified:
   trunk/res_noewe/languages/NL.cfg
Log:
Remove empty entries to let it fall back to default.

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-02-26 19:11:37 UTC (rev 1655)
+++ trunk/res_noewe/languages/NL.cfg	2009-02-26 21:05:53 UTC (rev 1656)
@@ -140,9 +140,6 @@
 		351=Toevoegen/wijzigingen notities.
 		400=Decoderen
 		500=Omdraaien
-		588=
-		589=
-		590=
 		591=Laat leeg voor standaard taal of%0avoeg 2 karakters toe voor taal, bv. DE,EN,NL
 		592=Taal(herstart noodzakelijk)
 		593=Password is optioneel.%0aAlleen gebruiken als je het wil opslaan in pref.xml.



From engywuck at mail.berlios.de  Fri Feb 27 17:45:30 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 27 Feb 2009 17:45:30 +0100
Subject: [Cachewolf-svn] r1657 - in trunk: . src/CacheWolf
Message-ID: <200902271645.n1RGjUFB015536@sheep.berlios.de>

Author: engywuck
Date: 2009-02-27 17:45:28 +0100 (Fri, 27 Feb 2009)
New Revision: 1657

Modified:
   trunk/compile.bat
   trunk/src/CacheWolf/FilterScreen.java
Log:
Adapting to source 1.3 compliance.

Modified: trunk/compile.bat
===================================================================
--- trunk/compile.bat	2009-02-26 21:05:53 UTC (rev 1656)
+++ trunk/compile.bat	2009-02-27 16:45:28 UTC (rev 1657)
@@ -1,4 +1,4 @@
 if not exist bin\CacheWolf mkdir bin\CacheWolf
 if not exist bin\exp mkdir bin\exp
-javac -classpath ./lib/CompileEwe.zip;./lib/  -d ./bin/ -deprecation ./src/CacheWolf/*.java ./src/CacheWolf/imp/*.java ./src/CacheWolf/navi/*.java ./src/exp/*.java ./src/utils/*.java
+javac -source 1.3 -target 1.1 -classpath ./lib/CompileEwe.zip;./lib/  -d ./bin/ -deprecation ./src/CacheWolf/*.java ./src/CacheWolf/imp/*.java ./src/CacheWolf/navi/*.java ./src/exp/*.java ./src/utils/*.java
 pause
\ No newline at end of file

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2009-02-26 21:05:53 UTC (rev 1656)
+++ trunk/src/CacheWolf/FilterScreen.java	2009-02-27 16:45:28 UTC (rev 1657)
@@ -325,7 +325,7 @@
 				chcDist.select(1);
 			String dist = prof.filterDist.substring(1);
 			if (Global.getPref().metricSystem == Metrics.IMPERIAL) {
-				double distValue = java.lang.Double.valueOf(dist);
+				double distValue = java.lang.Double.valueOf(dist).doubleValue();
 				double newDistValue = Metrics.convertUnit(distValue, Metrics.KILOMETER, Metrics.MILES);
 				dist = String.valueOf(newDistValue);
 			}
@@ -640,7 +640,7 @@
 				String rawDistance = inpDist.getText().replace(',', '.');
 				String newDistance = rawDistance; // initial Value;
 				if (! rawDistance.trim().equals("")) {
-					distValue = java.lang.Double.valueOf(rawDistance);
+					distValue = java.lang.Double.valueOf(rawDistance).doubleValue();
 					if (Global.getPref().metricSystem == Metrics.IMPERIAL){
 						newDistance = String.valueOf(Metrics.convertUnit(distValue, Metrics.MILES, Metrics.KILOMETER));
 					}



From engywuck at mail.berlios.de  Fri Feb 27 18:32:06 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 27 Feb 2009 18:32:06 +0100
Subject: [Cachewolf-svn] r1658 - trunk/src/CacheWolf/navi
Message-ID: <200902271732.n1RHW6nu021684@sheep.berlios.de>

Author: engywuck
Date: 2009-02-27 18:32:00 +0100 (Fri, 27 Feb 2009)
New Revision: 1658

Modified:
   trunk/src/CacheWolf/navi/Metrics.java
Log:
Adding missing unit conversion km -> m.

Modified: trunk/src/CacheWolf/navi/Metrics.java
===================================================================
--- trunk/src/CacheWolf/navi/Metrics.java	2009-02-27 16:45:28 UTC (rev 1657)
+++ trunk/src/CacheWolf/navi/Metrics.java	2009-02-27 17:32:00 UTC (rev 1658)
@@ -36,6 +36,9 @@
 				case MILES:
 					result = value / FCT_MILE2KILOMETER;
 					break;
+				case METER:
+					result = value * 1000;
+					break;
 				}
 				break;
 			case MILES:



From mik77 at mail.berlios.de  Sat Feb 28 14:20:19 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 28 Feb 2009 14:20:19 +0100
Subject: [Cachewolf-svn] r1659 - trunk/src/CacheWolf/navi
Message-ID: <200902281320.n1SDKJi1032295@sheep.berlios.de>

Author: mik77
Date: 2009-02-28 14:20:16 +0100 (Sat, 28 Feb 2009)
New Revision: 1659

Modified:
   trunk/src/CacheWolf/navi/Metrics.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
 - introduced imperial system to moving map
 - metrics conversions completed

Modified: trunk/src/CacheWolf/navi/Metrics.java
===================================================================
--- trunk/src/CacheWolf/navi/Metrics.java	2009-02-27 17:32:00 UTC (rev 1658)
+++ trunk/src/CacheWolf/navi/Metrics.java	2009-02-28 13:20:16 UTC (rev 1659)
@@ -33,19 +33,44 @@
 			switch (sourceUnit) {
 			case KILOMETER:
 				switch (targetUnit) {
+				case METER:
+					result = value * 1000;
+					break;
 				case MILES:
 					result = value / FCT_MILE2KILOMETER;
 					break;
-				case METER:
-					result = value * 1000;
+				case YARDS:
+					result = (value / FCT_MILE2KILOMETER) * FCT_MILE2YARD;
 					break;
+				case FEET:
+					result = (value / FCT_MILE2KILOMETER) * FCT_MILE2FOOT;
+					break;
 				}
 				break;
+			case METER:
+				switch (targetUnit) {
+				case KILOMETER:
+					result = value / 1000;
+					break;
+				case MILES:
+					result = (value / 1000) / FCT_MILE2KILOMETER;
+					break;
+				case YARDS:
+					result = ((value / 1000) / FCT_MILE2KILOMETER) * FCT_MILE2YARD;
+					break;
+				case FEET:
+					result = ((value / 1000) / FCT_MILE2KILOMETER) * FCT_MILE2FOOT;
+					break;
+				}
+				break;
 			case MILES:
 				switch (targetUnit) {
 				case KILOMETER:
 					result = value * FCT_MILE2KILOMETER;
 					break;
+				case METER:
+					result = value * FCT_MILE2KILOMETER * 1000;
+					break;
 				case YARDS:
 					result = value * FCT_MILE2YARD;
 					break;
@@ -56,6 +81,12 @@
 				break;
 			case YARDS:
 				switch (targetUnit) {
+				case KILOMETER:
+					result = (value / FCT_MILE2YARD) * FCT_MILE2KILOMETER;
+					break;
+				case METER:
+					result = (value / FCT_MILE2YARD) * FCT_MILE2KILOMETER * 1000;
+					break;
 				case MILES:
 					result = value / FCT_MILE2YARD;
 					break;
@@ -66,6 +97,12 @@
 				break;
 			case FEET:
 				switch (targetUnit) {
+				case KILOMETER:
+					result = (value / FCT_MILE2FOOT) * FCT_MILE2KILOMETER;
+					break;
+				case METER:
+					result = (value / FCT_MILE2FOOT) * FCT_MILE2KILOMETER * 1000;
+					break;
 				case MILES:
 					result = value / FCT_MILE2FOOT;
 					break;

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-02-27 17:32:00 UTC (rev 1658)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-02-28 13:20:16 UTC (rev 1659)
@@ -12,6 +12,7 @@
 import ewe.graphics.*;
 import ewe.io.IOException;
 import ewe.sys.*;
+import ewe.sys.Double;
 import ewe.filechooser.FileChooser;
 import ewe.filechooser.FileChooserBase;
 import ewe.fx.*;
@@ -235,21 +236,57 @@
 		
 		if (currentMap != null)
 		{
-			float lineLengthMeters = 40 * currentMap.scale;
-			float digits = (float)java.lang.Math.floor( java.lang.Math.log(lineLengthMeters) / java.lang.Math.log(10.0) );
-			lineLengthMeters = (float)java.lang.Math.ceil( lineLengthMeters / (float)java.lang.Math.pow(10, digits) ) * (float)java.lang.Math.pow(10, digits);
-			int lineLengthPixels = java.lang.Math.round( lineLengthMeters / currentMap.scale );
+			double lineLengthMeters = 40 * currentMap.scale;
+			
+			int metricSystem = Global.getPref().metricSystem;
+			double localizedLineLength = 0;
+			int bigUnit = -1; 
+			int smallUnit = -1;
+			double threshold = -1;
+			// Allow for different metric systems
+			if (metricSystem == Metrics.IMPERIAL) {
+				bigUnit = Metrics.MILES;
+				smallUnit = Metrics.FEET;
+				threshold = 501;
+				
+				localizedLineLength = Metrics.convertUnit( lineLengthMeters, Metrics.METER, smallUnit);
+			} else {
+				bigUnit = Metrics.KILOMETER;
+				smallUnit = Metrics.METER;
+				threshold = 1000;
+				
+				localizedLineLength = lineLengthMeters;
+			}
+			
+			int currentUnit = smallUnit;
+						
+			float digits = (float)java.lang.Math.floor( java.lang.Math.log(localizedLineLength) / java.lang.Math.log(10.0) );
+			localizedLineLength = (float)java.lang.Math.ceil( localizedLineLength / (float)java.lang.Math.pow(10, digits) ) * (float)java.lang.Math.pow(10, digits);
 
-			String lineLengthString;
-			if (lineLengthMeters < 1000)
+			if (localizedLineLength >= threshold)
 			{
-				lineLengthString = Convert.toString((int) lineLengthMeters) + "m";
+				currentUnit = bigUnit;
+				localizedLineLength = Metrics.convertUnit( lineLengthMeters, Metrics.METER, currentUnit);
+				
+				digits = (float)java.lang.Math.floor( java.lang.Math.log(localizedLineLength) / java.lang.Math.log(10.0) );
+				localizedLineLength = (float)java.lang.Math.ceil( localizedLineLength / (float)java.lang.Math.pow(10, digits) ) * (float)java.lang.Math.pow(10, digits);
 			}
-			else
-			{
-				lineLengthString = Convert.toString((int) lineLengthMeters / 1000) + "km";
+			
+			String lineLengthString = Convert.toString((int) localizedLineLength) + Metrics.getUnit(currentUnit);
+			
+			if	(digits < 0){
+				Double tmp = new Double();
+				tmp.set(localizedLineLength);
+				
+				int decimals = (int)(-1 * digits);
+				
+				lineLengthString = tmp.toString(decimals+2,decimals,0) + Metrics.getUnit(currentUnit);
+//				lineLengthString = MyLocale.formatDouble(tmp,"0.000") + Metrics.getUnit(currentUnit);
 			}
+
+			lineLengthMeters = Metrics.convertUnit( localizedLineLength, currentUnit, Metrics.METER);
 			
+			int lineLengthPixels = (int)java.lang.Math.round( lineLengthMeters / currentMap.scale );			
 			int backgroundStartX = ScaleImage.location.width - (lineLengthPixels + fm.getTextWidth(lineLengthString) + 7);
 			
 			ScaleImageGraphics.setColor(new Color(250,250,250));
@@ -275,17 +312,33 @@
 			{
 				lastDistance = currentDistance;
 				ewe.sys.Double dd = new ewe.sys.Double();
-				dd.set(currentDistance);
 				String d;
-				if (dd.value < 1) {
-					dd.value = dd.value * 1000; 
-					dd.decimalPlaces = 0;
-					d = MyLocale.getMsg(4206, "Dist: ") + dd.toString() + "m";
-				} 
-				else {
-					dd.decimalPlaces = 2;
-					d = MyLocale.getMsg(4206, "Dist: ") + dd.toString() + "km";
+				
+				int metricSystem = Global.getPref().metricSystem;
+				double localizedDistance = 0;
+				int bigUnit = -1; 
+				int smallUnit = -1;
+				double threshold = -1;
+				// Allow for different metric systems
+				if (metricSystem == Metrics.METRIC) {
+					bigUnit = Metrics.KILOMETER;
+					smallUnit = Metrics.METER;
+					threshold = 1.0;
+					localizedDistance = currentDistance;
+				} else if (metricSystem == Metrics.IMPERIAL) {
+					// Why these values? See: http://tinyurl.com/b4nn9m
+					bigUnit = Metrics.MILES;
+					smallUnit = Metrics.FEET;
+					threshold = 0.1;
+					localizedDistance = Metrics.convertUnit(currentDistance, Metrics.KILOMETER, Metrics.MILES);
 				}
+				dd.set(localizedDistance);
+				if (dd.value >= threshold){
+					d = MyLocale.formatDouble(dd,"0.000") + Metrics.getUnit(bigUnit);
+				} else {
+					dd.set(Metrics.convertUnit(dd.value, bigUnit, smallUnit));
+					d = dd.toString(3,0,0) + Metrics.getUnit(smallUnit);
+				}
 				
 				int backgroundWidth = fm.getTextWidth(d) + 4;
 



From engywuck at mail.berlios.de  Sat Feb 28 21:23:44 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sat, 28 Feb 2009 21:23:44 +0100
Subject: [Cachewolf-svn] r1660 - trunk/src/CacheWolf
Message-ID: <200902282023.n1SKNidm016751@sheep.berlios.de>

Author: engywuck
Date: 2009-02-28 21:23:42 +0100 (Sat, 28 Feb 2009)
New Revision: 1660

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/MyLocale.java
Log:
Supressing SIP when switching to panels which don't need it. Also works for VGA PDAs.

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2009-02-28 13:20:16 UTC (rev 1659)
+++ trunk/src/CacheWolf/MainTab.java	2009-02-28 20:23:42 UTC (rev 1660)
@@ -189,6 +189,7 @@
 	private void onEnteringPanel(int panelNo) {//Vm.debug("Entering "+panelNo);
 		switch (panelNo) {// Switch by panel number
 		case 0:
+			MyLocale.setSIPOff();
 			// If Solver or Details has changed, save Cache
 			updatePendingChanges();
 			if (detP.hasBlackStatusChanged()) {
@@ -201,12 +202,12 @@
 			if (chD==null) { // Empty DB - show a dummy detail
 				newWaypoint(ch=new CacheHolder()); 
 			}
-			MyLocale.setSIPButton();
+			MyLocale.setSIPOff();
 			detP.setDetails(ch);
 			break;
 		case 2: // Description Panel
-				MyLocale.setSIPOff();
-				descP.setText(chD);
+			MyLocale.setSIPOff();
+			descP.setText(chD);
 			break;
 		case 3: // Picture Panel
 			if (chD!=null) {
@@ -229,7 +230,7 @@
 			}
 			break;
 		case 5:  // Solver Panel
-			MyLocale.setSIPButton();
+			MyLocale.setSIPOff();
 			if (chD!=null) {
 				if (chD.isAddiWpt()) { 
 					chMain=chD.mainCache.getCacheDetails(true);//new CacheHolderDetail(chD.mainCache);
@@ -245,7 +246,7 @@
 			break;
 		case 6:  // CalcPanel
 			if (chD!=null) {
-				MyLocale.setSIPButton();
+				MyLocale.setSIPOff();
 				calcP.setFields(chD);
 			}
 			break;

Modified: trunk/src/CacheWolf/MyLocale.java
===================================================================
--- trunk/src/CacheWolf/MyLocale.java	2009-02-28 13:20:16 UTC (rev 1659)
+++ trunk/src/CacheWolf/MyLocale.java	2009-02-28 20:23:42 UTC (rev 1660)
@@ -252,7 +252,7 @@
 	 *
 	 */
 	public static void setSIPOn() {
-		if (Gui.screenIs(Gui.PDA_SCREEN) && Vm.isMobile()) {
+		if (Vm.isMobile()) {
 			Vm.setSIP(Vm.SIP_ON);
 		}
 	}
@@ -264,7 +264,7 @@
 	 *
 	 */
 	public static void setSIPOff() {
-		if (Gui.screenIs(Gui.PDA_SCREEN) && Vm.isMobile()) {
+		if (Vm.isMobile()) {
 			Vm.setSIP(0);
 		}
 	}
@@ -276,7 +276,7 @@
 	 *
 	 */
 	public static void setSIPButton() {
-		if (Gui.screenIs(Gui.PDA_SCREEN) && Vm.isMobile()) {
+		if (Vm.isMobile()) {
 			Vm.setSIP(Vm.SIP_LEAVE_BUTTON);
 		}
 	}



