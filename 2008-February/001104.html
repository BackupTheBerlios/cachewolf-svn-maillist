<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r1210 - in trunk: res_noewe/languages	resources/attributes src/CacheWolf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2008-February/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r1210%20-%20in%20trunk%3A%20res_noewe/languages%0A%09resources/attributes%20src/CacheWolf&In-Reply-To=%3C200801312331.m0VNVErG024379%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r1210 - in trunk: res_noewe/languages	resources/attributes src/CacheWolf</H1>
    <B>salzkammergut at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r1210%20-%20in%20trunk%3A%20res_noewe/languages%0A%09resources/attributes%20src/CacheWolf&In-Reply-To=%3C200801312331.m0VNVErG024379%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r1210 - in trunk: res_noewe/languages	resources/attributes src/CacheWolf">salzkammergut at mail.berlios.de
       </A><BR>
    <I>Fri Feb  1 00:31:14 CET 2008</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001105.html">[Cachewolf-svn] r1211 - trunk/resources/attributes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1104">[ date ]</a>
              <a href="thread.html#1104">[ thread ]</a>
              <a href="subject.html#1104">[ subject ]</a>
              <a href="author.html#1104">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: salzkammergut
Date: 2008-02-01 00:29:22 +0100 (Fri, 01 Feb 2008)
New Revision: 1210

Added:
   trunk/resources/attributes/available-non.gif
   trunk/resources/attributes/bicycles-non.gif
   trunk/resources/attributes/boat-non.gif
   trunk/resources/attributes/cactus-non.gif
   trunk/resources/attributes/campfires-non.gif
   trunk/resources/attributes/camping-non.gif
   trunk/resources/attributes/cliff-non.gif
   trunk/resources/attributes/climbing-non.gif
   trunk/resources/attributes/compass-non.gif
   trunk/resources/attributes/cow-non.gif
   trunk/resources/attributes/danger-non.gif
   trunk/resources/attributes/dogs-non.gif
   trunk/resources/attributes/fee-non.gif
   trunk/resources/attributes/firstaid-non.gif
   trunk/resources/attributes/hiking-non.gif
   trunk/resources/attributes/horses-non.gif
   trunk/resources/attributes/hunting-non.gif
   trunk/resources/attributes/jeeps-non.gif
   trunk/resources/attributes/kids-non.gif
   trunk/resources/attributes/mine-non.gif
   trunk/resources/attributes/motorcycles-non.gif
   trunk/resources/attributes/night-non.gif
   trunk/resources/attributes/onehour-non.gif
   trunk/resources/attributes/parking-non.gif
   trunk/resources/attributes/phone-non.gif
   trunk/resources/attributes/picnic-non.gif
   trunk/resources/attributes/poisonoak-non.gif
   trunk/resources/attributes/public-non.gif
   trunk/resources/attributes/quads-non.gif
   trunk/resources/attributes/rappelling-non.gif
   trunk/resources/attributes/restrooms-non.gif
   trunk/resources/attributes/scenic-non.gif
   trunk/resources/attributes/scuba-non.gif
   trunk/resources/attributes/snakes-non.gif
   trunk/resources/attributes/snowmobiles-non.gif
   trunk/resources/attributes/stealth-non.gif
   trunk/resources/attributes/stroller-non.gif
   trunk/resources/attributes/swimming-non.gif
   trunk/resources/attributes/thorn-non.gif
   trunk/resources/attributes/ticks-non.gif
   trunk/resources/attributes/water-non.gif
   trunk/resources/attributes/wheelchair-non.gif
   trunk/resources/attributes/winter-non.gif
   trunk/src/CacheWolf/AttributesSelector.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/AttributesViewer.java
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/FilterScreen.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Feature: Filter by Attributes. Created by Wortfetzen. Thanks!
Filtering is now possible for caches that have one of several attributes, have all selected attributes or don't have an attribute. To enable the filter, all caches have to be re-loaded to generate the attribute information in the index.xml file.
This is a slightly modified version which works independently of the selected attribute size. If the large attributes (30x30) are used, they are re-scaled on the fly to 20x20. I have not tested this on the PDA to see whether it takes too long, but expect that this is no problem as the grey icons which are always displayed, are available in 20x20 resolution.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-31 23:29:22 UTC (rev 1210)
@@ -230,6 +230,12 @@
 		734=Kein Hauptwegpunkt gefunden zu
 		735=Addi Waypoints m%fcssen das Format xxYYYY haben, wobei xx beliebige Zeichen und YYYY die Zeichen des Hauptcaches nach dem GC sind
 		736=Zu viele Logs (Maximum in Pr%e4ferenzen einstellen)
+		737=Cache-Attribute
+		738=Attribute
+		739=Filter mit
+		740=Allen
+		741=Einem
+		742=Keinem
 		800=Erstelle Liste
 		801=suche...
 		802=Caches identifiziert. Suche weiter...
@@ -515,8 +521,8 @@
 		2584=Geeignet f%fc Rollst%fchle
 		2585=Im Winter nicht verf%fcgbar
 		2586=Auch im Winter verf%fcgbar
-		2587=Cache-wartung notwendig
-		2588=Keine Cachewartung notwendig
+		2587=Keine Cachewartung notwendig
+		2588=Cache-wartung notwendig
 		3000=Schlie%dfen
 		4000=Geladene Caches:
 		4100=Verzeichnis w%e4hlen:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-31 23:29:22 UTC (rev 1210)
@@ -231,6 +231,12 @@
 		734=No main waypoint found for
 		735=Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC
 		736=Too many logs (Limit can be adjusted in preferences)
+		737=Cache-attributes
+		738=Attributes
+		739=Filter on
+		740=all
+		741=one
+		742=none
 		800=Creating list
 		801=searching...
 		802=Caches identified. searching...
@@ -510,8 +516,8 @@
 		2584=wheelchair accessible
 		2585=not available in winter
 		2586=available in winter
-		2587=Needs maintenance
-		2588=No maintenance needed
+		2587=No maintenance needed
+		2588=Needs maintenance
 		3000=Close
 		4000=Loaded caches
 		4101=Maps

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/res_noewe/languages/NL.cfg	2008-01-31 23:29:22 UTC (rev 1210)
@@ -452,8 +452,8 @@
 		2584=Rolstoel vriendelijk
 		2585=Niet beschikbaar in de winter
 		2586=In de winter beschikbaar
-		2587=Onderhoud noodzakelijk
-		2588=Geen onderhoud nodig
+		2587=Geen onderhoud nodig
+		2588=Onderhoud noodzakelijk
 		3000=Sluiten
 		4000=Geladen caches
 		4101=Kaarten

Added: trunk/resources/attributes/available-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/available-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/bicycles-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/bicycles-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/boat-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/boat-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cactus-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cactus-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/campfires-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/campfires-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/camping-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/camping-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cliff-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cliff-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/climbing-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/climbing-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/compass-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/compass-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cow-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cow-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/danger-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/danger-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/dogs-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/dogs-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/fee-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/fee-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/firstaid-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/firstaid-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hiking-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hiking-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/horses-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/horses-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hunting-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hunting-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/jeeps-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/jeeps-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/kids-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/kids-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/mine-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/mine-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/motorcycles-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/motorcycles-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/night-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/night-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/onehour-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/onehour-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/parking-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/parking-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/phone-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/phone-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/picnic-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/picnic-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/poisonoak-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/poisonoak-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/public-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/public-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/quads-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/quads-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/rappelling-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/rappelling-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/restrooms-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/restrooms-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scenic-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scenic-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scuba-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scuba-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snakes-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snakes-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snowmobiles-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snowmobiles-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stealth-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stealth-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stroller-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stroller-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/swimming-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/swimming-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/thorn-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/thorn-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/ticks-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/ticks-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/water-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/water-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wheelchair-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wheelchair-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/winter-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/winter-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Attribute.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -15,11 +15,13 @@
 	
 	private int attNo;
 
+	public int getAttrNr () { return attNo; }
+
 	/**
 	 * The attribute names are identical to the image names.
 	 * Internally the first image name has number 0, the next number 1 and so on.
 	 */
-	private static String [] attributeNames= {
+	public static final String [] attributeNames= {
 			&quot;error.gif&quot;,			//00 Unknown attribute
 			&quot;available-no.gif&quot;, 	//01 not 24-7
 			&quot;available-yes.gif&quot;, 	//02 available 24-7
@@ -107,8 +109,9 @@
 			&quot;wheelchair-yes.gif&quot;, 	//84 wheelchair accessible
 			&quot;winter-no.gif&quot;, 		//85 not available for winter
 			&quot;winter-yes.gif&quot;, 		//86 available in winter
- 	        &quot;firstaid-yes.gif&quot;,     //87 needs maintenance
- 	        &quot;firstaid-no.gif&quot;};     //88 does not need maintenance
+			&quot;firstaid-no.gif&quot;,              //87 does not need maintenance
+			&quot;firstaid-yes.gif&quot;              //88 needs maintenance
+	};
 	private static mImage [] attributeImages=new mImage[89];
 	private static String IMAGEDIR=File.getProgramDirectory()+&quot;/attributes/&quot;;
 	

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Attributes.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -16,6 +16,9 @@
 	 */
 	private Attribute attribs[]=new Attribute[MAXATTRIBS];
 
+	public long attributesYes;
+	public long attributesNo;
+
 	public Attributes() { 
 	}
 
@@ -32,6 +35,8 @@
 	 */
 	 public void clear() {
 		count=0;
+		attributesYes=0;
+		attributesNo=0;
 	}
 	
     ////////////////////////////////////////////////
@@ -74,7 +79,14 @@
 	 * @param attributeName
 	 */
 	public void add(String attributeName){
-		if (count&lt;attribs.length) attribs[count++]=new Attribute(attributeName);
+		if (count&lt;attribs.length) {
+			Attribute attr = new Attribute(attributeName);
+			attribs[count++] = attr;
+			if (attributeName.endsWith(&quot;-yes.gif&quot;))
+				attributesYes |= (1l &lt;&lt; ( (long)(Math.ceil((long)attr.getAttrNr() / 2.0) - 1.0) ) );
+			else
+				attributesNo |= (1l &lt;&lt; ( (long)(Math.ceil((long)attr.getAttrNr() / 2.0) - 1.0) ) );
+		}
     }
 
 	/**

Added: trunk/src/CacheWolf/AttributesSelector.java
===================================================================
--- trunk/src/CacheWolf/AttributesSelector.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/AttributesSelector.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -0,0 +1,142 @@
+package CacheWolf;
+
+import ewe.fx.*;
+import ewe.graphics.*;
+import ewe.sys.*;
+import ewe.ui.*;
+
+public class AttributesSelector extends AttributesViewer {
+	protected static int TILESIZE=22; // Here we always use the small icons thus tilesize=22
+	public long selectionMaskYes = 0;
+	public long selectionMaskNo = 0;
+
+	public AttributesSelector() {
+		super( true /* senseless, but hey - its java :D */);
+		//Rect r = new Rect(0,0,TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS); // As on GC: 6 wide, 2 high
+		iap.virtualSize = new Rect(0,0,200,200);
+		iap.setPreferredSize(170, 155);
+		addLast(iap,CellConstants.STRETCH,FILL);
+		addLast(mInfo=new mLabel(&quot;&quot;),HSTRETCH,HFILL);
+	}
+
+	public void setSelectionMasks(long yes, long no) {
+		selectionMaskYes = yes;
+		selectionMaskNo = no;
+		showAttributePalette();
+	}
+
+	protected class attAniImage extends AttributesViewer.attAniImage {
+		public String info;
+		public String attrName;
+		public String value;
+		public int attrNr;
+		public long bitMask;
+		attAniImage (mImage img) {
+			super(img);
+		}
+		attAniImage (attAniImage cp, String val) {
+			super(null);
+			mImage rawImg=new mImage(Attribute.getImageDir() + cp.attrName + val );
+			setMImage (rawImg.getHeight()!=20 ? rawImg.scale(20,20,null,Image.FOR_DISPLAY) : rawImg  );
+			value = val;
+			info = MyLocale.getMsg( value.equals(&quot;-no.gif&quot;) ? (2500+cp.attrNr-1) : 2500+cp.attrNr,&quot;No attribute info found&quot;);
+			attrName = cp.attrName;
+			location = cp.location;
+			attrNr = cp.attrNr;
+			bitMask = cp.bitMask;
+		}
+	}
+	
+	protected class attInteractivePanel extends AttributesViewer.attInteractivePanel {
+				public boolean imageMovedOn(AniImage which) {
+			if (!((attAniImage)which).info.startsWith(&quot;*&quot;)) { // If text starts with * we have no explanation yet
+				mInfo.setText(((attAniImage)which).info);
+				mInfo.repaintNow();
+			}
+			return true;
+		}
+		public boolean imageMovedOff(AniImage which) {
+			mInfo.setText(&quot;&quot;);
+			mInfo.repaintNow();
+			return true;
+		}
+		public boolean imagePressed(AniImage which, Point pos) {
+			if (which != null) {
+				String value = ((attAniImage)which).value;
+				long bit = ((attAniImage)which).bitMask;
+				if (value.equals(&quot;-non.gif&quot;)) {
+					selectionMaskYes |= bit;
+					selectionMaskNo  &amp;= ~bit;
+					value=&quot;-yes.gif&quot;;
+				} else if (value.equals(&quot;-yes.gif&quot;)) {
+					selectionMaskYes &amp;= ~bit;
+					selectionMaskNo  |= bit;
+					value=&quot;-no.gif&quot;;
+				} else {
+					selectionMaskYes &amp;= ~bit;
+					selectionMaskNo  &amp;= ~bit;
+					value=&quot;-non.gif&quot;;
+				}
+				attAniImage tmpImg = new attAniImage( (attAniImage)which, value );
+				removeImage(which);
+				addImage(tmpImg);
+				//System.out.println (&quot;AniImage pressed: &quot; + ((attAniImage)which).info);
+				refresh();
+				notifyDataChange(new DataChangeEvent(DataChangeEvent.DATA_CHANGED,this));
+			}
+			return true;
+		}
+	}
+	protected InteractivePanel iap=new attInteractivePanel();
+
+	public void showAttributePalette() {
+		iap.images.clear();
+		int width = 170;
+		int height = 180;
+		if (getParent() != null) {
+			//iap.setFixedSize(getParent().getSize(null).width-10, getParent().getSize(null).height-20);
+			width = getParent().getSize(null).width-10;
+			height = getParent().getSize(null).height-40;
+			iap.virtualSize = new Rect(0,0,width,height);
+			iap.setPreferredSize(width,height);
+		}
+		int x = 2; int y = 2;
+		long bitMask = 0;
+		String attrName;
+		String value;
+		for (int i=0; i &lt; Attribute.attributeNames.length; ++i) {
+			if (Attribute.attributeNames[i].endsWith(&quot;-yes.gif&quot;)) {
+				attrName = Attribute.attributeNames[i].substring(0,Attribute.attributeNames[i].length()-8);
+				bitMask = ( 1l &lt;&lt; ( (long)(java.lang.Math.ceil((long)i / 2.0) - 1.0) ) );
+				if ( (selectionMaskYes &amp; bitMask) != 0 )
+					value = &quot;-yes.gif&quot;;
+				else if ( (selectionMaskNo &amp; bitMask) != 0 )
+					value = &quot;-no.gif&quot;;
+				else
+					value = &quot;-non.gif&quot;;
+				mImage rawImg=new mImage(Attribute.getImageDir()+attrName+value);	
+				attAniImage img=new attAniImage(rawImg.getHeight()!=20 ? rawImg.scale(20,20,null,Image.FOR_DISPLAY) : rawImg );
+				img.info=MyLocale.getMsg(2500+i,&quot;No attribute info found&quot;);
+				img.value=value;
+				img.attrName=attrName;
+				img.attrNr = i;
+				img.bitMask = bitMask;
+
+				if (x+TILESIZE &gt; width) {
+					x = 2;
+					y += TILESIZE;
+				}
+				img.location=new Rect(x,y,TILESIZE,TILESIZE);
+				//System.out.println(&quot;img.location=new Rect(&quot;+x+&quot;,&quot;+y+&quot;,&quot;+TILESIZE+&quot;,&quot;+TILESIZE+&quot;);&quot;);
+				iap.addImage(img);
+				x += TILESIZE;
+			}
+		}
+		iap.repaintNow();
+	}
+	
+/*	public void resizeTo(int width, int height) {
+		super.resizeTo(width,height);
+	}
+*/	
+}


Property changes on: trunk/src/CacheWolf/AttributesSelector.java
___________________________________________________________________
Name: svn:keywords
   + LastChangedRevision

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/AttributesViewer.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -6,12 +6,12 @@
 import ewe.ui.*;
 
 public class AttributesViewer extends CellPanel {
-	private static int TILESIZE=Attribute.getImageWidth()+2;
-	private final static int ICONS_PER_ROW=MyLocale.getScreenWidth()/TILESIZE&lt;Attributes.MAXATTRIBS ? MyLocale.getScreenWidth()/TILESIZE : Attributes.MAXATTRIBS;
-	private final static int ICONROWS=(Attributes.MAXATTRIBS+ICONS_PER_ROW-1)/ICONS_PER_ROW;
-	private mLabel mInfo;
+	protected static int TILESIZE=Attribute.getImageWidth()+2;
+	protected final static int ICONS_PER_ROW=MyLocale.getScreenWidth()/TILESIZE&lt;Attributes.MAXATTRIBS ? MyLocale.getScreenWidth()/TILESIZE : Attributes.MAXATTRIBS;
+	protected final static int ICONROWS=(Attributes.MAXATTRIBS+ICONS_PER_ROW-1)/ICONS_PER_ROW;
+	protected mLabel mInfo;
 
-	private class attInteractivePanel extends InteractivePanel {
+	protected class attInteractivePanel extends InteractivePanel {
 		public boolean imageMovedOn(AniImage which) {
 			if (!((attAniImage)which).info.startsWith(&quot;*&quot;)) { // If text starts with * we have no explanation yet
 				mInfo.setText(((attAniImage)which).info);
@@ -26,7 +26,7 @@
 		}
 	}
 	
-	private class attAniImage extends AniImage {
+	protected class attAniImage extends AniImage {
 		public String info;
 		attAniImage (mImage img) {
 			super(img);
@@ -40,7 +40,11 @@
 		addLast(iap,CellConstants.HSTRETCH,CellConstants.FILL);
 		addLast(mInfo=new mLabel(&quot;&quot;),HSTRETCH,HFILL);
 	}
-	private InteractivePanel iap=new attInteractivePanel();
+	public AttributesViewer ( boolean dontinitialize ){
+		// this is only to prevent automatic constructor calling [ AttributesViewer () ]
+		// from AttributesSelector
+	}
+	protected InteractivePanel iap=new attInteractivePanel();
 	
 	public void showImages(Attributes att) {
 		iap.images.clear();

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/CacheHolder.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -102,6 +102,9 @@
 	public String sort;
 	private static StringBuffer sb=new StringBuffer(530); // Used in toXML()
 
+	public long attributesYes = 0;
+	public long attributesNo  = 0;
+
 //	static int nObjects=0;
 	public CacheHolder() {//nObjects++;Vm.debug(&quot;CacheHolder() nO=&quot;+nObjects);
 	}
@@ -210,6 +213,15 @@
 			start=xmlString.indexOf('&quot;',end+1); end=xmlString.indexOf('&quot;',start+1);
 			numFoundsSinceRecommendation = Convert.toInt(xmlString.substring(start+1,end));
 			recommendationScore = LogList.getScore(numRecommended, numFoundsSinceRecommendation);
+
+			start=xmlString.indexOf('&quot;',end+1); end=xmlString.indexOf('&quot;',start+1);
+			if (start &gt; -1 &amp;&amp; end &gt; -1) {
+				attributesYes = Convert.parseLong(xmlString.substring(start+1,end));
+
+				start=xmlString.indexOf('&quot;',end+1); end=xmlString.indexOf('&quot;',start+1);
+				if (start &gt; -1 &amp;&amp; end &gt; -1)
+					attributesNo = Convert.parseLong(xmlString.substring(start+1,end));
+			}
 		} catch (Exception ex) {
 
 		}
@@ -279,6 +291,9 @@
 		this.is_HTML = ch.is_HTML;
 		this.sort=ch.sort;
 		this.lastSyncOC = ch.lastSyncOC;
+
+		this.attributesYes = ch.attributesYes;
+		this.attributesNo = ch.attributesNo;
 	}
 	/**
 	 * Call it only when necessary, it takes time, because all logs must be parsed
@@ -344,6 +359,8 @@
 		sb.append(&quot;\&quot; lastSyncOC = \&quot;&quot; );sb.append(lastSyncOC ); 
 		sb.append(&quot;\&quot; num_recommended = \&quot;&quot;);sb.append(Convert.formatInt(numRecommended)); 
 		sb.append(&quot;\&quot; num_found = \&quot;&quot; );sb.append(Convert.formatInt(numFoundsSinceRecommendation));
+		sb.append(&quot;\&quot; attributesYes = \&quot;&quot; ); sb.append(Convert.formatLong(attributesYes));
+		sb.append(&quot;\&quot; attributesNo = \&quot;&quot; ); sb.append(Convert.formatLong(attributesNo));
 		sb.append(&quot;\&quot; /&gt;\n&quot;);
 		return sb.toString();
 	}

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Filter.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -104,6 +104,10 @@
 	private boolean available=false;
 	private boolean notAvailable = false;
 	double pi180=java.lang.Math.PI / 180.0;
+
+	private long attributesYesPattern = 0;
+	private long attributesNoPattern = 0;
+	private int attributesChoice = 0;
 	
 	/**
 	*	Apply a route filter. Each waypoint is on a seperate line.
@@ -309,6 +313,9 @@
 		terrdirec = profile.filterTerr.charAt(0) == 'L' ? SMALLER : 
 				(profile.filterTerr.charAt(0) == '=' ? EQUAL : GREATER );
 		fscTerr = Common.parseDouble(profile.filterTerr.substring(1));  // Terrain
+		attributesYesPattern = profile.filterAttrYes;
+		attributesNoPattern = profile.filterAttrNo;
+		attributesChoice = profile.filterAttrChoice;
 	}
 	
 	/**
@@ -462,7 +469,39 @@
 				else cacheSizePattern = OTHER;
 				if ((cacheSizePattern &amp; sizeMatchPattern) == 0) { ch.is_filtered=true; continue; }
 			}
-			
+			///////////////////////////////
+			// Filter criterium 11: Attributes
+			///////////////////////////////
+			if ( (attributesYesPattern != 0 || attributesNoPattern != 0) &amp;&amp; ch.mainCache == null) {
+				if (attributesChoice == 0) {
+					// AND-condition:
+					if (
+						(ch.attributesYes &amp; attributesYesPattern) != attributesYesPattern
+						|| (ch.attributesNo &amp; attributesNoPattern) != attributesNoPattern )
+					{
+						ch.is_filtered=true;
+						continue;
+					}
+				} else if (attributesChoice == 1) {
+					// OR-condition:
+					if (
+						(ch.attributesYes &amp; attributesYesPattern) == 0
+						&amp;&amp; (ch.attributesNo &amp; attributesNoPattern) == 0 )
+					{
+						ch.is_filtered=true;
+						continue;
+					}
+				} else {
+					// NOT-condition:
+					if (
+						(ch.attributesYes &amp; attributesYesPattern) != 0
+						|| (ch.attributesNo &amp; attributesNoPattern) != 0 )
+					{
+						ch.is_filtered=true;
+						continue;
+					}
+				}
+			}
 		} // for
 		// Ensure that for all main caches that are filtered, the addis are also filtered independently of 
 		// the filter status of the addi
@@ -520,7 +559,9 @@
 		    prof.filterSize.equals(Profile.FILTERSIZE) &amp;&amp;
 		    prof.filterDist.equals(&quot;L&quot;) &amp;&amp;
 		    prof.filterDiff.equals(&quot;L&quot;) &amp;&amp;
-		    prof.filterTerr.equals(&quot;L&quot;));
+		    prof.filterTerr.equals(&quot;L&quot;) &amp;&amp;
+		    prof.filterAttrYes == 0l &amp;&amp;
+		    prof.filterAttrNo == 0l);
 	}
 
 }

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/FilterScreen.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -17,9 +17,9 @@
 	private static final Color COLOR_FILTERALL=new Color(255,0,0); // Red
     	
 	private mButton btnCancel, btnApply,btnRoute,
-					btnBearing,btnTypes,btnAttributes,btnRatings,btnContainer,btnSearch,btnAddi, btnSelect,btnDeselect;
+					btnBearing,btnTypes,btnAttributes,btnRatings,btnContainer,btnSearch,btnAddi, btnSelect,btnDeselect,btnCacheAttributes;
 	
-	private mChoice chcDist, chcDiff, chcTerr;
+	private mChoice chcDist, chcDiff, chcTerr, chcAttrib;
 	private mCheckBox chkFound, chkNotFound, chkTrad, chkVirtual, chkEvent, chkEarth, chkMega,
 					  chkOwned, chkNotOwned, chkMulti, chkLetter, chkWebcam, chkMystery, chkLocless,
 	                  chkCustom,chkParking,	chkStage, chkQuestion, chkFinal, chkTrailhead, chkReference,
@@ -29,6 +29,8 @@
 					  chkSSW, chkSW, chkWSW, chkW, chkWNW;
 	
 	private mInput inpDist, inpTerr, inpDiff;
+
+	AttributesSelector attV;
 	
 	private CellPanel pnlBearDist=new CellPanel();
 	private CellPanel pnlAttributes=new CellPanel();
@@ -39,6 +41,7 @@
 	private CellPanel pnlRose = new CellPanel();
 	private CellPanel pnlButtons=new CellPanel();
 	private CellPanel pnlAddi=new CellPanel();
+	private CellPanel pnlCacheAttributes=new CellPanel();
 	private CardPanel cp=new CardPanel();
 
 	// A subclassed checkbox with a &quot;third&quot; state (=grey background).
@@ -236,7 +239,20 @@
 		//////////////////////////
 		addTitle(pnlSearch,&quot;Search&quot;);
 		pnlSearch.addLast(new mLabel(&quot;To be implemented&quot;));
+
+
+		//////////////////////////
+		// Panel 8 - Cache attributes
+		//////////////////////////
 		
+		addTitle(pnlCacheAttributes,MyLocale.getMsg(737,&quot;Attributes&quot;));
+		pnlCacheAttributes.addNext(new mLabel(MyLocale.getMsg(739,&quot;Filter on&quot;)+&quot;:&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheAttributes.addLast(chcAttrib = new mChoice(new String[]{MyLocale.getMsg(740,&quot;all&quot;), MyLocale.getMsg(741,&quot;one&quot;), MyLocale.getMsg(742,&quot;none&quot;)},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+
+		attV=new AttributesSelector();
+		pnlCacheAttributes.addLast(attV, CellConstants.STRETCH|CellConstants.LEFT|CellConstants.BORDER, CellConstants.STRETCH);
+		attV.setSelectionMasks( 0l, 0l );
+		
 		Frame frmScreen=new Frame();
 		mLabel lblInfo; 
 		frmScreen.addLast(lblInfo=new mLabel(MyLocale.getMsg(725,&quot;Note: Filters are additive, active filter=green&quot;))).setTag(SPAN,new Dimension(2,1));
@@ -252,6 +268,7 @@
 		pnlButtons.addLast(btnTypes=new mButton(MyLocale.getMsg(723,&quot;Types&quot;))); 
 		pnlButtons.addLast(btnAddi=new mButton(MyLocale.getMsg(733,&quot;Add. Wpt&quot;))); 
 		pnlButtons.addLast(btnContainer=new mButton(MyLocale.getMsg(724,&quot;Container&quot;)));
+		pnlButtons.addLast(btnCacheAttributes=new mButton(MyLocale.getMsg(738,&quot;Attributes&quot;)));
 		// Search ist f&#252;r 0.9n noch deaktiviert
 		//pnlButtons.addLast(btnSearch=new mButton(&quot;Search&quot;)); btnSearch.modify(Disabled,0);
 		addNext(pnlButtons,HSTRETCH,FILL);
@@ -263,6 +280,7 @@
 		cp.addItem(pnlAddi,&quot;Addi&quot;,null);
 		cp.addItem(pnlContainer,&quot;Size&quot;,null);
 		cp.addItem(pnlSearch,&quot;Search&quot;,null);
+		cp.addItem(pnlCacheAttributes,&quot;Attr&quot;,null);
 		addLast(cp);
 
 		CellPanel btPanel = new CellPanel();
@@ -270,7 +288,7 @@
 		btPanel.addNext(btnApply = new mButton(MyLocale.getMsg(709,&quot;Apply&quot;)),CellConstants.STRETCH, CellConstants.FILL);
 		btPanel.addLast(btnRoute = new mButton(&quot;Route&quot;),CellConstants.STRETCH, CellConstants.FILL);
 		addLast(btPanel.setTag(Control.SPAN, new Dimension(3,1)), CellConstants.STRETCH, CellConstants.FILL);
-		setPreferredSize(240,240);
+		setPreferredSize(240,260);
 		cp.select(3);
 	}
 	
@@ -400,6 +418,12 @@
 		//////////////////////////
 		// Panel 7 - Search
 		//////////////////////////
+
+		//////////////////////////
+		// Panel 8 - Cache attributes
+		//////////////////////////
+		attV.setSelectionMasks( prof.filterAttrYes, prof.filterAttrNo );
+		chcAttrib.select(prof.filterAttrChoice);
 		
 		// Adjust colors of buttons depending on which filters are active
 		setColors();
@@ -492,6 +516,14 @@
 		btnContainer.repaint();
 			
 		// Panel 7 - Search
+
+		// Panel 8 - Cache attributes
+		if ( attV.selectionMaskYes == 0l &amp;&amp; attV.selectionMaskNo == 0l)
+			btnCacheAttributes.backGround=COLOR_FILTERINACTIVE;
+		else
+			btnCacheAttributes.backGround=COLOR_FILTERACTIVE;
+		btnCacheAttributes.repaint();
+
 		
 	}
 	
@@ -596,6 +628,9 @@
 				} else { 
 					pfl.filterTerr=&quot;G&quot;+inpTerr.getText();
 				}
+				pfl.filterAttrYes = attV.selectionMaskYes;
+				pfl.filterAttrNo = attV.selectionMaskNo;
+				pfl.filterAttrChoice = chcAttrib.selectedIndex;
 				Filter flt = new Filter();
 				flt.setFilter();
 				flt.doFilter();
@@ -619,6 +654,7 @@
 			else if (ev.target == btnAddi)cp.select(4);
 			else if (ev.target == btnContainer)cp.select(5);
 			else if (ev.target == btnSearch)cp.select(6);
+			else if (ev.target == btnCacheAttributes)cp.select(7);
 			else if (ev.target == btnDeselect) {
 				chkNW.state= chkNNW.state  = chkN.state    = chkNNE.state  = 
 				chkNE.state   = chkENE.state  = chkE.state    = chkESE.state  = 

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Profile.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -61,6 +61,10 @@
 	public int filterActive=Filter.FILTER_INACTIVE;
 	public boolean filterInverted=false;
 
+	public long filterAttrYes = 0l;
+	public long filterAttrNo = 0l;
+	public int filterAttrChoice = 0;
+
 	public boolean selectionChanged = true; // (&quot;H&#228;ckchen&quot;) used by movingMap to get to knao if it should update the caches in the map 
 	/** True if the profile has been modified and not saved
 	 * The following modifications set this flag: New profile centre, Change of waypoint data 
@@ -149,7 +153,7 @@
 			detfile.print(&quot;    &lt;FILTER status = \&quot;&quot;+filterActive+(filterInverted?&quot;T&quot;:&quot;F&quot;)+ 
 					&quot;\&quot; rose = \&quot;&quot;+filterRose+&quot;\&quot; type = \&quot;&quot;+filterType+
 					&quot;\&quot; var = \&quot;&quot;+filterVar+&quot;\&quot; dist = \&quot;&quot;+filterDist.replace('&quot;',' ')+&quot;\&quot; diff = \&quot;&quot;+
-					filterDiff+&quot;\&quot; terr = \&quot;&quot;+filterTerr+&quot;\&quot; size = \&quot;&quot;+filterSize+&quot;\&quot; /&gt;\n&quot;);
+					filterDiff+&quot;\&quot; terr = \&quot;&quot;+filterTerr+&quot;\&quot; size = \&quot;&quot;+filterSize+&quot;\&quot; attributesYes = \&quot;&quot;+filterAttrYes+&quot;\&quot; attributesNo = \&quot;&quot;+filterAttrNo+&quot;\&quot; attributesChoice = \&quot;&quot;+filterAttrChoice+&quot;\&quot; /&gt;\n&quot;);
 			detfile.print(&quot;    &lt;SYNCOC date = \&quot;&quot;+last_sync_opencaching+&quot;\&quot; dist = \&quot;&quot;+distOC+&quot;\&quot;/&gt;\n&quot;);
 			int size=cacheDB.size();
 			for(int i = 0; i&lt;size;i++){
@@ -246,6 +250,15 @@
 					filterDiff = ex.findNext();
 					filterTerr = ex.findNext();
 					filterSize = ex.findNext();
+					String attr = ex.findNext();
+					if (attr != null &amp;&amp; !attr.equals(&quot;&quot;))
+						filterAttrYes = Convert.parseLong(attr);
+					attr = ex.findNext();
+					if (attr != null &amp;&amp; !attr.equals(&quot;&quot;))
+						filterAttrNo = Convert.parseLong(attr);
+					attr = ex.findNext();
+					if (attr != null &amp;&amp; !attr.equals(&quot;&quot;))
+						filterAttrChoice = Convert.parseInt(attr);
 				}
 			}
 			in.close();

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -1107,8 +1107,8 @@
 			chD.attributes.add(attribute);
 			attribute=attEx.findNext();
 		}
-		//chD.attributesYes = chD.attributes.attributesYes;
-		//chD.attributesNo = chD.attributes.attributesNo;
+		chD.attributesYes = chD.attributes.attributesYes;
+		chD.attributesNo = chD.attributes.attributesNo;
 	}
 
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001105.html">[Cachewolf-svn] r1211 - trunk/resources/attributes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1104">[ date ]</a>
              <a href="thread.html#1104">[ thread ]</a>
              <a href="subject.html#1104">[ subject ]</a>
              <a href="author.html#1104">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
