<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2943 - in trunk: . res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/exp src/CacheWolf/imp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2011-March/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2943%20-%20in%20trunk%3A%20.%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/exp%20src/CacheWolf/imp&In-Reply-To=%3C20110304211752.14A81481285%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002933.html">
   <LINK REL="Next"  HREF="002935.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2943 - in trunk: . res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/exp src/CacheWolf/imp</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2943%20-%20in%20trunk%3A%20.%20res_noewe%20res_noewe/languages%0A%09src/CacheWolf%20src/CacheWolf/exp%20src/CacheWolf/imp&In-Reply-To=%3C20110304211752.14A81481285%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2943 - in trunk: . res_noewe res_noewe/languages	src/CacheWolf src/CacheWolf/exp src/CacheWolf/imp">araber95 at mail.berlios.de
       </A><BR>
    <I>Fri Mar  4 10:17:51 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002933.html">[Cachewolf-svn] r2942 - in trunk/src/CacheWolf: . imp
</A></li>
        <LI>Next message: <A HREF="002935.html">[Cachewolf-svn] r2944 - trunk/src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2934">[ date ]</a>
              <a href="thread.html#2934">[ thread ]</a>
              <a href="subject.html#2934">[ subject ]</a>
              <a href="author.html#2934">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2011-03-04 22:17:51 +0100 (Fri, 04 Mar 2011)
New Revision: 2943

Added:
   trunk/src/CacheWolf/imp/OCGPXfetch.java
Modified:
   trunk/currentversions.txt
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/languages/SV.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/Common.java
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/GeocoderOsm.java
   trunk/src/CacheWolf/HttpConnection.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/TravelbugJourneyScreen.java
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/Version.java
   trunk/src/CacheWolf/exp/GpxExportNg.java
   trunk/src/CacheWolf/imp/GCVoteImporter.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
doing the same

Modified: trunk/currentversions.txt
===================================================================
--- trunk/currentversions.txt	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/currentversions.txt	2011-03-04 21:17:51 UTC (rev 2943)
@@ -1,12 +1,12 @@
 # Release
 T0VersionMajor: 1
-T0VersionMinor: 0
-T0SvnRevision: 2716
+T0VersionMinor: 2
+T0SvnRevision: <A HREF="http://cachewolf.aldos.de/rc/mostrecentbuild.txt">http://cachewolf.aldos.de/rc/mostrecentbuild.txt</A> [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
 
 # ReleaseCandidate
 T1VersionMajor: 1
-T1VersionMinor: 2
-T1SvnRevision: <A HREF="http://cachewolf.aldos.de/rc/mostrecentbuild.txt">http://cachewolf.aldos.de/rc/mostrecentbuild.txt</A> [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
+T1VersionMinor: 3
+T1SvnRevision: <A HREF="http://cachewolf.aldos.de/mostrecentbuild.txt">http://cachewolf.aldos.de/mostrecentbuild.txt</A> [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
 
 # InDevelopmentStable
 T2VersionMajor: 1

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/DE.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Markierte ausfiltern
 161=Zeige Blacklist
 162=Kalibrierte herunterladen
+163=von OC Funde
+164=nur bei OC gelistet
 170=Datenverzeichnis w&#195;&#164;hlen
 171=Profil existiert nicht:+
 172=Kann das Kartenverzeichnis nicht erstellen:
@@ -786,7 +788,10 @@
 2678=Tankstelle nahebei
 2679=keine Verpflegungsm&#195;&#182;glichkeit
 2680=Verpflegungsm&#195;&#182;glichkeit nahebei
-2681=RFID / Funk Ausr&#195;&#188;stung
+2681=RFID, CHIRP / Funk Ausr&#195;&#188;stung nicht n&#195;&#182;tig
+2682=RFID, CHIRP / Funk Ausr&#195;&#188;stung
+2683=keine Erste Hilfe 
+2684=Erste Hilfe nahebei
 3000=Schlie&#195;&#159;en
 4000=Geladene Caches:+
 4001=GPX-Dateien von Opencaching enthalten keine Informationen zu Bildern, sie werden nicht heruntergeladen. Am besten Caches von Opencaching holen per Men&#195;&#188; /Anwendung/Import/von Opencaching

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/EN.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filter out ticked
 161=Show Blacklist
 162=Download calibrated
+163 = OC finds
+164 = only available at OC
 170=Select data directory
 171=Profile does not exist:+
 172=Error: cannot create maps directory:
@@ -786,7 +788,10 @@
 2678=Fuel nearby
 2679=no Food nearby
 2680=Food nearby
-2681=wireless beacon
+2681 = RFID, CHIRP / radio equipment is not necessary
+2682 = RFID, CHIRP / radio equipment
+2683 = No emergency
+2684 = First Aid nearby
 3000=Close
 4000=Loaded caches:+
 4001=GPX files from opencaching don't contain information of images, they cannot be loaded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/FR.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filtre les caches coch&#195;&#169;es
 161=Montre liste noire
 162=T&#195;&#169;l&#195;&#169;charger calibr&#195;&#169;e
+163 = OC trouve
+164 = uniquement disponible chez OC
 170=Choisir dossier de base pour les profiles
 171=Profile n'existe pas:+
 172=Ne peut pas cr&#195;&#169;er dossier pour des cartes:
@@ -786,7 +788,10 @@
 2678=carburant &#195;&#160; proximit&#195;&#169;
 2679=pas de nourriture &#195;&#160; proximit&#195;&#169;
 2680=la nourriture &#195;&#160; proximit&#195;&#169;
-2681=Chirp (Garmin)
+2681 = RFID, CHIRP / &#195;&#169;quipement radio n'est pas n&#195;&#169;cessaire
+2682 = RFID, CHIRP &#195;&#169;quipement radio /
+2683 = Pas d'urgence
+2684 = First Aid &#195;&#160; proximit&#195;&#169;
 3000=Fermer
 4000=Caches charg&#195;&#169;es:
 4001=GPX fichiers &#195;&#160; partir Opencaching ne contiennent pas d'informations d'images, ils ne peuvent pas &#195;&#170;tre charg&#195;&#169;. Pour le meilleur vous obtenez des caches de Opencaching par le menu /Application/importation/Download from Opencaching

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/NL.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Gemarkeerd filteren
 161=Toon Blacklist
 162=Gekalibreerde kaarten downloaden.
+163 = OC vindt
+164 = alleen verkrijgbaar bij OC
 170=Selecteer basis map voor cache data.
 171=Profiel bestaat niet:+
 172=Fout: kan kaarten map niet maken:\n.
@@ -786,7 +788,10 @@
 2678=brandstof in de omgeving
 2679=geen eten in de buurt
 2680=Voedsel in de buurt
-2681=Chirp (Garmin)
+2681 = RFID, CHIRP / radio-apparatuur is niet nodig
+2682 = RFID, CHIRP / radio-apparatuur
+2683 = Geen spoed
+2684 = Eerste Hulp in de buurt
 3000=Sluiten
 4000=Geladen caches
 4001=GPX bestanden uit opencaching bevatten geen informatie van beelden, kunnen zij niet worden downloaden. Beste je caches van opencaching menu /Application/Import/Download from Opencaching

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/PL.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filtruj zaznaczone
 161=Pokaz czarna liste
 162=Sciagnij skalibrowane
+163 = OC stwierdzi
+164 = dost&#196;&#153;pne tylko w OC
 170=Wybierz folder z danymi
 171=Profil nie istnieje:+
 172=Blad: nie mozna utworzyc katalogu map:
@@ -786,7 +788,10 @@
 2678=paliwa w poblizu
 2679=brak zywnosci w poblizu
 2680=Zywnosci w poblizu
-2681=Chirp (Garmin)
+2681 = RFID, CHIRP / radio sprz&#196;&#153;t nie jest konieczne
+2682 = RFID, CHIRP / urz&#196;&#133;dze&#197;&#132; radiowych
+2683 = Nie awaryjne
+2684 = Pierwsza pomoc w pobli&#197;&#188;u
 3000=Zamknij
 4000=Wczytaj skrzynki:+
 4001=Pliki GPX z opencaching nie zawieraja informacji o obrazach, nie moga byc one wczytane. Najlepiej pobierz skrzynki z opencaching przez menu /Aplikacja/Importuj/Sciagnij Z Opencaching

Modified: trunk/res_noewe/languages/SV.cfg
===================================================================
--- trunk/res_noewe/languages/SV.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/SV.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filter markeras ut
 161=Visa Blacklist
 162=Ladda kalibrerad
+163 = OC finner
+164 = endast tillg&#195;&#164;nglig p&#195;&#165; OC
 170=V&#195;&#164;lj databas
 171=profil finns inte:+
 172=Fel: kan inte skapa kartor katalog:
@@ -786,7 +788,10 @@
 2678=Br&#195;&#164;nsle i n&#195;&#164;rheten
 2679=ingen mat i n&#195;&#164;rheten
 2680=Food i n&#195;&#164;rheten
-2681=Chirp (Garmin)
+2681 = RFID,CHIRP / tr&#195;&#165;dl&#195;&#182;s utrustning &#195;&#164;r inte n&#195;&#182;dv&#195;&#164;ndig
+2682 = RFID,CHIRP / tr&#195;&#165;dl&#195;&#182;s utrustning
+2683 = Ingen akut
+2684 = F&#195;&#182;rsta hj&#195;&#164;lpen i n&#195;&#164;rheten
 3000=St&#195;&#164;ng
 4000=Loaded cachar:+
 4001=GPX filer fr&#195;&#165;n opencaching inte inneh&#195;&#165;ller n&#195;&#165;gon information av bilder, kan de inte laoded. B&#195;&#164;st du cachar fr&#195;&#165;n opencaching genom menyn / Application / Import / Download fr&#195;&#165;n Opencaching

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/spider.def	2011-03-04 21:17:51 UTC (rev 2943)
@@ -53,7 +53,7 @@
 # * When entering spaces into a string ensure to escape them or write them as \\u0020
 # * Be sure that you have no hidden spaces at the end of a line or the patterns will not match!
 #------------------------------------------------------------
-loginPage          = <A HREF="http://www.geocaching.com/login/Default.aspx">http://www.geocaching.com/login/Default.aspx</A>
+loginPage          = <A HREF="http://www.geocaching.com/login/default.aspx">http://www.geocaching.com/login/default.aspx</A>
 loginSuccess       = You\ are\ logged\ in\ as
 nextPage           = /login/default.aspx
 waypoint           = <A HREF="http://www.geocaching.com/seek/cache_details.aspx?wp=">http://www.geocaching.com/seek/cache_details.aspx?wp=</A>
@@ -73,7 +73,7 @@
 availableRex       = class=&quot;lnk\ \ Strike&quot;&gt;
 archivedRex        = class=&quot;lnk\ OldWarning\ Strike\ Strike&quot;&gt;
 PMRex              = small_profile.gif
-distCodeRex        = k=(.*?)&quot;\ style=
+distCodeRex        = k=(.*?)&quot;
 distCodeKey        = signalthefrog
 distRex            = (.*?)(?:km|mi|ft)
 DTSRex             = v=(.*?)&quot;\ style=

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Attribute.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -202,111 +202,101 @@
 	private final static int BIT_NR = 0; 
 	private final static int MSG_NR = 1;
 	private final static int PIC_NAME = 2;
-	private final static int OC_ID = 3;
-	private final static int GC_ID = 4;
+	private final static int OC_ID = 3; // OC - XML
+	private final static int GC_ID = 4; // auch OC neues gpx
 	private final static int GC_TEXT = 5; // for export , didn't extract by myself, copied from forum	
 	private static final String[][] attRef = {
-		// Empfehlungen / Personen - Conditions (Yes/No)
-		{&quot;30&quot;,&quot;2562&quot;,&quot;scenic&quot;,&quot;0&quot;,&quot;8&quot;,&quot;Scenic view&quot;},//62 scenic view
+		{&quot;00&quot;,&quot;2502&quot;,&quot;available&quot;,&quot;38&quot;,&quot;13&quot;,&quot;Available at all times&quot;},//02 available 24-7
+		{&quot;01&quot;,&quot;2504&quot;,&quot;bicycles&quot;,&quot;0&quot;,&quot;32&quot;,&quot;Bicycles&quot;},//04 bikes allowed
+		{&quot;02&quot;,&quot;2506&quot;,&quot;boat&quot;,&quot;52&quot;,&quot;4&quot;,&quot;Boat&quot;},//06 Wasserfahrzeug
+		// {&quot;03&quot;,&quot;2508&quot;,&quot;cactus&quot;,&quot;0&quot;,&quot;0&quot;,&quot;&quot;},//08 removed 14.08.10 araber95
+		{&quot;04&quot;,&quot;2510&quot;,&quot;campfires&quot;,&quot;0&quot;,&quot;38&quot;,&quot;Campfires&quot;},//10 campfires allowed
+		{&quot;05&quot;,&quot;2512&quot;,&quot;camping&quot;,&quot;0&quot;,&quot;31&quot;,&quot;Camping available&quot;},//12 Camping allowed
+		{&quot;06&quot;,&quot;2514&quot;,&quot;cliff&quot;,&quot;11&quot;,&quot;21&quot;,&quot;Cliff / falling rocks&quot;},//14 falling-rocks nearby
+		{&quot;07&quot;,&quot;2516&quot;,&quot;climbing&quot;,&quot;28&quot;,&quot;10&quot;,&quot;Difficult climbing&quot;},//16 easy climbing(OC-28), difficult climbing(GC-10) 
+		{&quot;08&quot;,&quot;2518&quot;,&quot;compass&quot;,&quot;47&quot;,&quot;147&quot;,&quot;Compass&quot;}, //OC special
+		{&quot;09&quot;,&quot;2520&quot;,&quot;cow&quot;,&quot;0&quot;,&quot;43&quot;,&quot;Watch for livestock&quot;},//20 watch for livestock
+		{&quot;10&quot;,&quot;2522&quot;,&quot;danger&quot;,&quot;9&quot;,&quot;23&quot;,&quot;Dangerous area&quot;},//22 dangerous area
+		{&quot;11&quot;,&quot;2524&quot;,&quot;dogs&quot;,&quot;0&quot;,&quot;1&quot;,&quot;Dogs&quot;},//24 dogs allowed
+		{&quot;12&quot;,&quot;2526&quot;,&quot;fee&quot;,&quot;36&quot;,&quot;2&quot;,&quot;Access or parking fee&quot;},//26 access/parking fees
+		// {&quot;13&quot;,&quot;2528&quot;,&quot;hiking&quot;,&quot;0&quot;,&quot;9&quot;,&quot;Significant hike&quot;},//28 significant hike : removed
+		{&quot;13&quot;,&quot;2528&quot;,&quot;hiking&quot;,&quot;25&quot;,&quot;125&quot;,&quot;Long walk&quot;}, //OC special
+		{&quot;14&quot;,&quot;2530&quot;,&quot;horses&quot;,&quot;0&quot;,&quot;37&quot;,&quot;Horses&quot;},//30 horses allowed
+		{&quot;15&quot;,&quot;2532&quot;,&quot;hunting&quot;,&quot;12&quot;,&quot;22&quot;,&quot;Hunting&quot;},//32 hunting area
+		{&quot;16&quot;,&quot;2534&quot;,&quot;jeeps&quot;,&quot;0&quot;,&quot;35&quot;,&quot;Off-road vehicles&quot;},//34 off-road vehicles allowed
 		{&quot;17&quot;,&quot;2536&quot;,&quot;kids&quot;,&quot;59&quot;,&quot;6&quot;,&quot;Recommended for kids&quot;},//36 kid friendly
-		{&quot;35&quot;,&quot;2572&quot;,&quot;stroller&quot;,&quot;0&quot;,&quot;41&quot;,&quot;Stroller accessible&quot;},//72 stroller accessible	
-		{&quot;41&quot;,&quot;2584&quot;,&quot;wheelchair&quot;,&quot;0&quot;,&quot;24&quot;,&quot;Wheelchair accessible&quot;},//84 wheelchair accessible
-		//  vorhanden / Eigenschaften / Infrastruktur - Facilities (Yes/No)
+		{&quot;18&quot;,&quot;2538&quot;,&quot;mine&quot;,&quot;15&quot;,&quot;20&quot;,&quot;Abandoned mines&quot;},//38
+		{&quot;19&quot;,&quot;2540&quot;,&quot;motorcycles&quot;,&quot;0&quot;,&quot;33&quot;,&quot;Motorcycles&quot;},//40 motorcycles allowed
+		{&quot;20&quot;,&quot;2542&quot;,&quot;night&quot;,&quot;1&quot;,&quot;14&quot;,&quot;Recommended at night&quot;},//42 recommended at night
+		{&quot;21&quot;,&quot;2544&quot;,&quot;onehour&quot;,&quot;0&quot;,&quot;7&quot;,&quot;Takes less than an hour&quot;},//44 takes less than one hour
 		{&quot;22&quot;,&quot;2546&quot;,&quot;parking&quot;,&quot;18&quot;,&quot;25&quot;,&quot;Parking available&quot;},//46 parking available
-		{&quot;26&quot;,&quot;2554&quot;,&quot;public&quot;,&quot;19&quot;,&quot;26&quot;,&quot;Public transportation&quot;},//54 public transit available
-		{&quot;40&quot;,&quot;2582&quot;,&quot;water&quot;,&quot;20&quot;,&quot;27&quot;,&quot;Drinking water nearby&quot;},//82 drinking water nearby
-		{&quot;29&quot;,&quot;2560&quot;,&quot;restrooms&quot;,&quot;21&quot;,&quot;28&quot;,&quot;Public restrooms nearby&quot;},//60 restrooms available
 		{&quot;23&quot;,&quot;2548&quot;,&quot;phone&quot;,&quot;22&quot;,&quot;29&quot;,&quot;Telephone nearby&quot;},//48 telephone nearby
 		{&quot;24&quot;,&quot;2550&quot;,&quot;picnic&quot;,&quot;0&quot;,&quot;30&quot;,&quot;Picnic tables nearby&quot;},//50 picnic tables available
-		{&quot;43&quot;,&quot;2588&quot;,&quot;firstaid&quot;,&quot;23&quot;,&quot;42&quot;,&quot;Firstaid&quot;}, // GC: Cachewartung notwendig (Auto Attribut) , OC: erste Hilfe 
-		{&quot;73&quot;,&quot;2654&quot;,&quot;rv&quot;,&quot;0&quot;,&quot;46&quot;,&quot;Truck Driver/RV&quot;},// changed by Moorteufel 12.07.10 
-		{&quot;85&quot;,&quot;2678&quot;,&quot;fuel&quot;,&quot;0&quot;,&quot;58&quot;,&quot;Fuel nearby&quot;}, // changed by araber95 14.08.10 
-		{&quot;86&quot;,&quot;2680&quot;,&quot;food&quot;,&quot;0&quot;,&quot;59&quot;,&quot;Food nearby&quot;}, // changed by araber95 14.08.10
-		// Erlaubt - Permissions (Allowed/Not Allowed)
-		{&quot;11&quot;,&quot;2524&quot;,&quot;dogs&quot;,&quot;0&quot;,&quot;1&quot;,&quot;Dogs&quot;},//24 dogs allowed
-		{&quot;05&quot;,&quot;2512&quot;,&quot;camping&quot;,&quot;0&quot;,&quot;31&quot;,&quot;Camping available&quot;},//12 Camping allowed
-		{&quot;01&quot;,&quot;2504&quot;,&quot;bicycles&quot;,&quot;0&quot;,&quot;32&quot;,&quot;Bicycles&quot;},//04 bikes allowed
-		{&quot;19&quot;,&quot;2540&quot;,&quot;motorcycles&quot;,&quot;0&quot;,&quot;33&quot;,&quot;Motorcycles&quot;},//40 motorcycles allowed
+		{&quot;25&quot;,&quot;2552&quot;,&quot;poisonoak&quot;,&quot;16&quot;,&quot;17&quot;,&quot;Poison plants&quot;},//52 Giftige Pflanzen
+		{&quot;26&quot;,&quot;2554&quot;,&quot;public&quot;,&quot;19&quot;,&quot;26&quot;,&quot;Public transportation&quot;},//54 public transit available
 		{&quot;27&quot;,&quot;2556&quot;,&quot;quads&quot;,&quot;0&quot;,&quot;34&quot;,&quot;Quads&quot;},//56 quads allowed
-		{&quot;16&quot;,&quot;2534&quot;,&quot;jeeps&quot;,&quot;0&quot;,&quot;35&quot;,&quot;Off-road vehicles&quot;},//34 off-road vehicles allowed
+		{&quot;28&quot;,&quot;2558&quot;,&quot;rappelling&quot;,&quot;49&quot;,&quot;3&quot;,&quot;Climbing gear&quot;},//58 climbing gear Kletterausr&#252;stung
+		{&quot;29&quot;,&quot;2560&quot;,&quot;restrooms&quot;,&quot;21&quot;,&quot;28&quot;,&quot;Public restrooms nearby&quot;},//60 restrooms available
+		{&quot;30&quot;,&quot;2562&quot;,&quot;scenic&quot;,&quot;0&quot;,&quot;8&quot;,&quot;Scenic view&quot;},//62 scenic view
+		{&quot;31&quot;,&quot;2564&quot;,&quot;scuba&quot;,&quot;51&quot;,&quot;5&quot;,&quot;Scuba gear&quot;},//64 Tauchausr&#252;stung
+		// {&quot;32&quot;,&quot;2566&quot;,&quot;snakes&quot;,&quot;0&quot;,&quot;18&quot;,&quot;Snakes&quot;},//66 araber95 replaced by Dangerous Animals 14.08.10
+		{&quot;32&quot;,&quot;2566&quot;,&quot;dangerousanimals&quot;,&quot;0&quot;,&quot;18&quot;,&quot;Dangerous Animals&quot;},//66
 		{&quot;33&quot;,&quot;2568&quot;,&quot;snowmobiles&quot;,&quot;0&quot;,&quot;36&quot;,&quot;Snowmobiles&quot;},//68
-		{&quot;14&quot;,&quot;2530&quot;,&quot;horses&quot;,&quot;0&quot;,&quot;37&quot;,&quot;Horses&quot;},//30 horses allowed
-		{&quot;04&quot;,&quot;2510&quot;,&quot;campfires&quot;,&quot;0&quot;,&quot;38&quot;,&quot;Campfires&quot;},//10 campfires allowed
-		// Eigenschaften / Gefahren - Hazards (Present/Not Present)
-		{&quot;10&quot;,&quot;2522&quot;,&quot;danger&quot;,&quot;9&quot;,&quot;23&quot;,&quot;Dangerous area&quot;},//22 dangerous area
-		{&quot;62&quot;,&quot;2644&quot;,&quot;train&quot;,&quot;10&quot;,&quot;0&quot;,&quot;&quot;},// 144 aktive Eisenbahnlinien in der N&#228;he
-		{&quot;06&quot;,&quot;2514&quot;,&quot;cliff&quot;,&quot;11&quot;,&quot;21&quot;,&quot;Cliff / falling rocks&quot;},//14 falling-rocks nearby
-		{&quot;15&quot;,&quot;2532&quot;,&quot;hunting&quot;,&quot;12&quot;,&quot;22&quot;,&quot;Hunting&quot;},//32 hunting area
+		{&quot;34&quot;,&quot;2570&quot;,&quot;stealth&quot;,&quot;0&quot;,&quot;40&quot;,&quot;Stealth required&quot;},//70 stealth required (Heimlich,List,Schl&#228;ue)
+		{&quot;35&quot;,&quot;2572&quot;,&quot;stroller&quot;,&quot;0&quot;,&quot;41&quot;,&quot;Stroller accessible&quot;},//72 stroller accessible	
+		{&quot;36&quot;,&quot;2574&quot;,&quot;swimming&quot;,&quot;29&quot;,&quot;12&quot;,&quot;May require swimming&quot;},//74
 		{&quot;37&quot;,&quot;2576&quot;,&quot;thorn&quot;,&quot;13&quot;,&quot;39&quot;,&quot;Thorns&quot;},//76 thorns!
 		{&quot;38&quot;,&quot;2578&quot;,&quot;ticks&quot;,&quot;14&quot;,&quot;19&quot;,&quot;Ticks&quot;},//78 ticks!
-		{&quot;18&quot;,&quot;2538&quot;,&quot;mine&quot;,&quot;15&quot;,&quot;20&quot;,&quot;Abandoned mines&quot;},//38
-		{&quot;25&quot;,&quot;2552&quot;,&quot;poisonoak&quot;,&quot;16&quot;,&quot;17&quot;,&quot;Poison plants&quot;},//52 Giftige Pflanzen
-		{&quot;46&quot;,&quot;2594&quot;,&quot;animals&quot;,&quot;17&quot;,&quot;0&quot;,&quot;&quot;},// 94 Giftige/gef%e4hrliche Tiere
-		// {&quot;03&quot;,&quot;2508&quot;,&quot;cactus&quot;,&quot;0&quot;,&quot;0&quot;,&quot;&quot;},//08 removed 14.08.10 araber95
-		{&quot;32&quot;,&quot;2566&quot;,&quot;dangerousanimals&quot;,&quot;0&quot;,&quot;18&quot;,&quot;Dangerous Animals&quot;},//66
-		// {&quot;32&quot;,&quot;2566&quot;,&quot;snakes&quot;,&quot;0&quot;,&quot;18&quot;,&quot;Snakes&quot;},//66 araber95 replaced by Dangerous Animals 14.08.10
-		{&quot;09&quot;,&quot;2520&quot;,&quot;cow&quot;,&quot;0&quot;,&quot;43&quot;,&quot;Watch for livestock&quot;},//20 watch for livestock
-		// Eigenschaften / Der Weg - Conditions (Yes/No)
-		{&quot;49&quot;,&quot;2600&quot;,&quot;car&quot;,&quot;24&quot;,&quot;0&quot;,&quot;&quot;},// 100 Nahe beim Auto
-		{&quot;21&quot;,&quot;2544&quot;,&quot;onehour&quot;,&quot;0&quot;,&quot;7&quot;,&quot;Takes less than an hour&quot;},//44 takes less than one hour
-		{&quot;82&quot;,&quot;2672&quot;,&quot;hike_short&quot;,&quot;0&quot;,&quot;55&quot;,&quot;Short hike&quot;}, // added by araber95 14.8.10
-		{&quot;83&quot;,&quot;2674&quot;,&quot;hike_med&quot;,&quot;0&quot;,&quot;56&quot;,&quot;Medium Hike&quot;}, // added by araber95 14.8.10
-		{&quot;84&quot;,&quot;2676&quot;,&quot;hike_long&quot;,&quot;0&quot;,&quot;57&quot;,&quot;Long Hike&quot;}, // added by araber95 14.8.10
-		{&quot;13&quot;,&quot;2528&quot;,&quot;hiking&quot;,&quot;25&quot;,&quot;9&quot;,&quot;Significant hike&quot;},//28 significant hike
 		{&quot;39&quot;,&quot;2580&quot;,&quot;wading&quot;,&quot;26&quot;,&quot;11&quot;,&quot;May require wading&quot;},//80 may require wading
-		{&quot;65&quot;,&quot;2634&quot;,&quot;steep&quot;,&quot;27&quot;,&quot;0&quot;,&quot;&quot;},// 134 H&#252;geliges Gel&#228;nde
-		{&quot;07&quot;,&quot;2516&quot;,&quot;climbing&quot;,&quot;28&quot;,&quot;10&quot;,&quot;Difficult climbing&quot;},//16 easy climbing(OC-28), difficult climbing(GC-10) 
-		{&quot;36&quot;,&quot;2574&quot;,&quot;swimming&quot;,&quot;29&quot;,&quot;12&quot;,&quot;May require swimming&quot;},//74
-		{&quot;79&quot;,&quot;2666&quot;,&quot;nightcache&quot;,&quot;0&quot;,&quot;52&quot;,&quot;Night Cache&quot;}, // added by araber95 14.8.10
-		{&quot;80&quot;,&quot;2668&quot;,&quot;parkngrab&quot;,&quot;0&quot;,&quot;53&quot;,&quot;Park and grab&quot;}, // added by araber95 14.8.10
-		{&quot;81&quot;,&quot;2670&quot;,&quot;abandonedbuilding&quot;,&quot;0&quot;,&quot;54&quot;,&quot;Abandoned structure&quot;}, // added by araber95 14.8.10
-		// Eigenschaften / Wegpunkte  - Conditions (Yes/No)
-		{&quot;55&quot;,&quot;2612&quot;,&quot;letter&quot;,&quot;8&quot;,&quot;0&quot;,&quot;&quot;},// 112 Letterbox (ben&#246;tigt Stempel)
-		{&quot;54&quot;,&quot;2610&quot;,&quot;interestsign&quot;,&quot;30&quot;,&quot;0&quot;,&quot;&quot;},// 110 Interessanter Ort ev mit scenic zusammenfassen?
-		{&quot;56&quot;,&quot;2614&quot;,&quot;moving&quot;,&quot;31&quot;,&quot;0&quot;,&quot;&quot;},// 114 Bewegliches Ziel
-		{&quot;64&quot;,&quot;2646&quot;,&quot;webcam&quot;,&quot;32&quot;,&quot;0&quot;,&quot;&quot;},// 146 Webcam am Ziel
-		{&quot;53&quot;,&quot;2608&quot;,&quot;indoor&quot;,&quot;33&quot;,&quot;0&quot;,&quot;&quot;},// 108 In geschlossenen R&#228;umen
-		{&quot;66&quot;,&quot;2636&quot;,&quot;submerged&quot;,&quot;34&quot;,&quot;0&quot;,&quot;&quot;},// 136 Im Wasser
-		{&quot;58&quot;,&quot;2618&quot;,&quot;nogps&quot;,&quot;35&quot;,&quot;0&quot;,&quot;&quot;},// 118 Ohne GPS
-		{&quot;34&quot;,&quot;2570&quot;,&quot;stealth&quot;,&quot;0&quot;,&quot;40&quot;,&quot;Stealth required&quot;},//70 stealth required (Heimlich,List,Schl&#228;ue)
-		// Einschr&#228;nkungen und Voraussetzungen / Allgemein
-		{&quot;12&quot;,&quot;2526&quot;,&quot;fee&quot;,&quot;36&quot;,&quot;2&quot;,&quot;Access or parking fee&quot;},//26 access/parking fees
-		{&quot;61&quot;,&quot;2624&quot;,&quot;overnight&quot;,&quot;37&quot;,&quot;0&quot;,&quot;&quot;},// 124 &#220;bernachtung erforderlich
-		// Einschr&#228;nkungen und Voraussetzungen / Zeitlich
-		{&quot;20&quot;,&quot;2542&quot;,&quot;night&quot;,&quot;1&quot;,&quot;14&quot;,&quot;Recommended at night&quot;},//42 recommended at night
-		{&quot;00&quot;,&quot;2502&quot;,&quot;available&quot;,&quot;38&quot;,&quot;13&quot;,&quot;Available at all times&quot;},//02 available 24-7
-		{&quot;68&quot;,&quot;2640&quot;,&quot;time&quot;,&quot;39&quot;,&quot;0&quot;,&quot;&quot;},// 140 An bestimmte Zeiten gebunden
-		{&quot;52&quot;,&quot;2606&quot;,&quot;day&quot;,&quot;40&quot;,&quot;0&quot;,&quot;&quot;},// 106 nur tags&#252;ber
-		{&quot;67&quot;,&quot;2638&quot;,&quot;tide&quot;,&quot;41&quot;,&quot;0&quot;,&quot;&quot;},// 138 Gezeiten
-		// Einschr&#228;nkungen und Voraussetzungen / Saisonbedingt
-		{&quot;51&quot;,&quot;2604&quot;,&quot;date&quot;,&quot;42&quot;,&quot;0&quot;,&quot;&quot;},// 104 w&#228;hrend des ganzen Jahres zug&#228;nglich
-		{&quot;57&quot;,&quot;2616&quot;,&quot;naturschutz&quot;,&quot;43&quot;,&quot;0&quot;,&quot;&quot;},// 116 Brutsaison/Naturschutz
+		{&quot;40&quot;,&quot;2582&quot;,&quot;water&quot;,&quot;20&quot;,&quot;27&quot;,&quot;Drinking water nearby&quot;},//82 drinking water nearby
+		{&quot;41&quot;,&quot;2584&quot;,&quot;wheelchair&quot;,&quot;0&quot;,&quot;24&quot;,&quot;Wheelchair accessible&quot;},//84 wheelchair accessible
 		{&quot;42&quot;,&quot;2586&quot;,&quot;winter&quot;,&quot;44&quot;,&quot;15&quot;,&quot;Available during winter&quot;},//86 available in winter 132 Schneesicheres Versteck
-		// Einschr&#228;nkungen und Voraussetzungen / Systembedingt
-		{&quot;59&quot;,&quot;2620&quot;,&quot;oconly&quot;,&quot;6&quot;,&quot;0&quot;,&quot;&quot;},// 120 Nur bei Opencaching logbar
-		{&quot;71&quot;,&quot;2650&quot;,&quot;wwwlink&quot;,&quot;7&quot;,&quot;0&quot;,&quot;&quot;},// 150 Nur Hyperlink zu OC-externen Portalen
-		// Einschr&#228;nkungen und Voraussetzungen / Werkzeug - Equipment (Required/Not Required)
-		{&quot;69&quot;,&quot;2642&quot;,&quot;tools&quot;,&quot;46&quot;,&quot;0&quot;,&quot;Special Tool required&quot;},// 142 Spezielle Ausr&#252;stung
-		{&quot;08&quot;,&quot;2518&quot;,&quot;compass&quot;,&quot;47&quot;,&quot;0&quot;,&quot;&quot;},//18 Kompass
+		{&quot;43&quot;,&quot;2588&quot;,&quot;firstaid&quot;,&quot;0&quot;,&quot;42&quot;,&quot;Firstaid&quot;}, // GC: Cachewartung notwendig (Auto Attribut) , OC: erste Hilfe 
 		{&quot;44&quot;,&quot;2590&quot;,&quot;flashlight&quot;,&quot;48&quot;,&quot;44&quot;,&quot;Flashlight required&quot;}, // 90 Flashlight required
-		{&quot;28&quot;,&quot;2558&quot;,&quot;rappelling&quot;,&quot;49&quot;,&quot;3&quot;,&quot;Climbing gear&quot;},//58 climbing gear Kletterausr&#252;stung
-		{&quot;50&quot;,&quot;2602&quot;,&quot;cave&quot;,&quot;50&quot;,&quot;0&quot;,&quot;&quot;},// 102 H&#246;hlenausr&#252;stung
-		{&quot;31&quot;,&quot;2564&quot;,&quot;scuba&quot;,&quot;51&quot;,&quot;5&quot;,&quot;Scuba gear&quot;},//64 Tauchausr&#252;stung
-		{&quot;02&quot;,&quot;2506&quot;,&quot;boat&quot;,&quot;52&quot;,&quot;4&quot;,&quot;Boat&quot;},//06 Wasserfahrzeug
-		{&quot;45&quot;,&quot;2592&quot;,&quot;aircraft&quot;,&quot;53&quot;,&quot;38&quot;,&quot;&quot;},// 92
+		{&quot;45&quot;,&quot;2592&quot;,&quot;aircraft&quot;,&quot;53&quot;,&quot;153&quot;,&quot;Aircraft&quot;}, //OC special //38 GC removed
+		{&quot;46&quot;,&quot;2594&quot;,&quot;animals&quot;,&quot;17&quot;,&quot;0&quot;,&quot;&quot;},// 94 Giftige/gef%e4hrliche Tiere
+		{&quot;47&quot;,&quot;2596&quot;,&quot;arith_prob&quot;,&quot;56&quot;,&quot;156&quot;,&quot;Arithmetical problem&quot;}, //OC special
+		{&quot;48&quot;,&quot;2598&quot;,&quot;ask&quot;,&quot;58&quot;,&quot;158&quot;,&quot;Ask owner for start conditions&quot;}, //OC special
+		{&quot;49&quot;,&quot;2600&quot;,&quot;car&quot;,&quot;24&quot;,&quot;0&quot;,&quot;&quot;},// 100 Nahe beim Auto
+		{&quot;50&quot;,&quot;2602&quot;,&quot;cave&quot;,&quot;50&quot;,&quot;150&quot;,&quot;Cave equipment&quot;}, //OC special
+		{&quot;51&quot;,&quot;2604&quot;,&quot;date&quot;,&quot;42&quot;,&quot;142&quot;,&quot;All seasons&quot;}, //OC special
+		{&quot;52&quot;,&quot;2606&quot;,&quot;day&quot;,&quot;40&quot;,&quot;140&quot;,&quot;by day only&quot;}, //OC special 
+		{&quot;53&quot;,&quot;2608&quot;,&quot;indoor&quot;,&quot;33&quot;,&quot;133&quot;,&quot;Within enclosed rooms (caves, buildings etc.)&quot;}, //OC special
+		{&quot;54&quot;,&quot;2610&quot;,&quot;interestsign&quot;,&quot;30&quot;,&quot;130&quot;,&quot;Point of interest&quot;}, //OC special
+		{&quot;55&quot;,&quot;2612&quot;,&quot;letter&quot;,&quot;8&quot;,&quot;108&quot;,&quot;Letterbox (needs stamp)&quot;}, //OC special
+		{&quot;56&quot;,&quot;2614&quot;,&quot;moving&quot;,&quot;31&quot;,&quot;131&quot;,&quot;Moving target&quot;}, //OC special
+		{&quot;57&quot;,&quot;2616&quot;,&quot;naturschutz&quot;,&quot;43&quot;,&quot;143&quot;,&quot;Breeding season / protected nature&quot;}, //OC special
+		{&quot;58&quot;,&quot;2618&quot;,&quot;nogps&quot;,&quot;35&quot;,&quot;135&quot;,&quot;Without GPS (letterboxes, cistes, compass juggling ...)&quot;}, //OC special
+		{&quot;59&quot;,&quot;2620&quot;,&quot;oconly&quot;,&quot;6&quot;,&quot;106&quot;,&quot;Only loggable at Opencaching&quot;},// 120 Nur bei Opencaching logbar
+		{&quot;60&quot;,&quot;2622&quot;,&quot;othercache&quot;,&quot;57&quot;,&quot;157&quot;,&quot;Other cache type&quot;}, //OC special
+		{&quot;61&quot;,&quot;2624&quot;,&quot;overnight&quot;,&quot;37&quot;,&quot;137&quot;,&quot;Overnight stay necessary&quot;}, //OC special
+		{&quot;62&quot;,&quot;2644&quot;,&quot;train&quot;,&quot;10&quot;,&quot;110&quot;,&quot;Active railway nearby&quot;}, //OC special
+		{&quot;63&quot;,&quot;2630&quot;,&quot;riddle&quot;,&quot;55&quot;,&quot;0&quot;,&quot;&quot;},// 130 R&#228;tsel
+		{&quot;64&quot;,&quot;2646&quot;,&quot;webcam&quot;,&quot;32&quot;,&quot;132&quot;,&quot;Webcam&quot;}, //OC special
+		{&quot;65&quot;,&quot;2634&quot;,&quot;steep&quot;,&quot;27&quot;,&quot;127&quot;,&quot;Hilly area&quot;}, //OC special
+		{&quot;66&quot;,&quot;2636&quot;,&quot;submerged&quot;,&quot;34&quot;,&quot;134&quot;,&quot;In the water&quot;}, //OC special
+		{&quot;67&quot;,&quot;2638&quot;,&quot;tide&quot;,&quot;41&quot;,&quot;141&quot;,&quot;Tide&quot;}, //OC special
+		{&quot;68&quot;,&quot;2640&quot;,&quot;time&quot;,&quot;39&quot;,&quot;139&quot;,&quot;Only available at specified times&quot;}, //OC special
+		{&quot;69&quot;,&quot;2642&quot;,&quot;tools&quot;,&quot;46&quot;,&quot;0&quot;,&quot;Special Tool required&quot;},// 142 Spezielle Ausr&#252;stung
+		{&quot;70&quot;,&quot;2648&quot;,&quot;wiki&quot;,&quot;54&quot;,&quot;154&quot;,&quot;Investigation&quot;}, //OC special
+		{&quot;71&quot;,&quot;2650&quot;,&quot;wwwlink&quot;,&quot;7&quot;,&quot;107&quot;,&quot;Hyperlink to another caching portal only&quot;}, //OC special
+		{&quot;72&quot;,&quot;2652&quot;,&quot;landf&quot;,&quot;0&quot;,&quot;45&quot;,&quot;Lost And Found Tour&quot;}, // thx to Kappler and MiK
+		{&quot;73&quot;,&quot;2654&quot;,&quot;rv&quot;,&quot;0&quot;,&quot;46&quot;,&quot;Truck Driver/RV&quot;},// changed by Moorteufel 12.07.10 
+		{&quot;74&quot;,&quot;2656&quot;,&quot;field_puzzle&quot;,&quot;0&quot;,&quot;47&quot;,&quot;Field Puzzle&quot;},// changed by Moorteufel 12.07.10
 		{&quot;75&quot;,&quot;2658&quot;,&quot;uv&quot;,&quot;0&quot;,&quot;48&quot;,&quot;UV Light required&quot;}, // added by araber95 14.8.10
 		{&quot;76&quot;,&quot;2660&quot;,&quot;snowshoes&quot;,&quot;0&quot;,&quot;49&quot;,&quot;Snowshoes&quot;}, // added by araber95 14.8.10&quot;
 		{&quot;77&quot;,&quot;2662&quot;,&quot;skiis&quot;,&quot;0&quot;,&quot;50&quot;,&quot;Cross Country Skis&quot;}, // added by araber95 14.8.10
 		{&quot;78&quot;,&quot;2664&quot;,&quot;s-tool&quot;,&quot;0&quot;,&quot;51&quot;,&quot;Special Tool required&quot;}, // added by araber95 14.8.10
-		{&quot;87&quot;,&quot;2681&quot;,&quot;wirelessbeacon&quot;,&quot;0&quot;,&quot;60&quot;,&quot;Wireless Beacon&quot;}, // added by araber95 27.10.10
-		// Einschr&#228;nkungen und Voraussetzungen / Ben&#246;tigt Vorarbeit
-		{&quot;70&quot;,&quot;2648&quot;,&quot;wiki&quot;,&quot;54&quot;,&quot;0&quot;,&quot;&quot;},// 148 Recherche
-		{&quot;63&quot;,&quot;2630&quot;,&quot;riddle&quot;,&quot;55&quot;,&quot;0&quot;,&quot;&quot;},// 130 R&#228;tsel
-		{&quot;74&quot;,&quot;2656&quot;,&quot;field_puzzle&quot;,&quot;0&quot;,&quot;47&quot;,&quot;Field Puzzle&quot;},// changed by Moorteufel 12.07.10
-		{&quot;47&quot;,&quot;2596&quot;,&quot;arith_prob&quot;,&quot;56&quot;,&quot;0&quot;,&quot;&quot;},// 96 Rechenaufgabe
-		{&quot;60&quot;,&quot;2622&quot;,&quot;othercache&quot;,&quot;57&quot;,&quot;0&quot;,&quot;&quot;},// 122 besondere Cacheart
-		{&quot;48&quot;,&quot;2598&quot;,&quot;ask&quot;,&quot;58&quot;,&quot;0&quot;,&quot;&quot;},// 98 Startbedingungen beim Owner erfragen
-		{&quot;72&quot;,&quot;2652&quot;,&quot;landf&quot;,&quot;0&quot;,&quot;45&quot;,&quot;Lost And Found Tour&quot;}, // thx to Kappler and MiK
+		{&quot;79&quot;,&quot;2666&quot;,&quot;nightcache&quot;,&quot;0&quot;,&quot;52&quot;,&quot;Night Cache&quot;}, // added by araber95 14.8.10
+		{&quot;80&quot;,&quot;2668&quot;,&quot;parkngrab&quot;,&quot;0&quot;,&quot;53&quot;,&quot;Park and grab&quot;}, // added by araber95 14.8.10
+		{&quot;81&quot;,&quot;2670&quot;,&quot;abandonedbuilding&quot;,&quot;0&quot;,&quot;54&quot;,&quot;Abandoned structure&quot;}, // added by araber95 14.8.10
+		{&quot;82&quot;,&quot;2672&quot;,&quot;hike_short&quot;,&quot;0&quot;,&quot;55&quot;,&quot;Short hike&quot;}, // added by araber95 14.8.10
+		{&quot;83&quot;,&quot;2674&quot;,&quot;hike_med&quot;,&quot;0&quot;,&quot;56&quot;,&quot;Medium Hike&quot;}, // added by araber95 14.8.10
+		{&quot;84&quot;,&quot;2676&quot;,&quot;hike_long&quot;,&quot;0&quot;,&quot;57&quot;,&quot;Long Hike&quot;}, // added by araber95 14.8.10
+		{&quot;85&quot;,&quot;2678&quot;,&quot;fuel&quot;,&quot;0&quot;,&quot;58&quot;,&quot;Fuel nearby&quot;}, // changed by araber95 14.08.10 
+		{&quot;86&quot;,&quot;2680&quot;,&quot;food&quot;,&quot;0&quot;,&quot;59&quot;,&quot;Food nearby&quot;}, // changed by araber95 14.08.10
+		{&quot;87&quot;,&quot;2681&quot;,&quot;wirelessbeacon&quot;,&quot;0&quot;,&quot;60&quot;,&quot;Wireless Beacon&quot;}, // added by araber95 27.10.10		
+		{&quot;88&quot;,&quot;2588&quot;,&quot;firstaid&quot;,&quot;23&quot;,&quot;123&quot;,&quot;First aid available&quot;}, //OC special
 		// {&quot;-1&quot;,&quot;2500&quot;,&quot;error&quot;,&quot;0&quot;,&quot;0&quot;,&quot;&quot;}, //
 
 	};

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -412,7 +412,7 @@
 			
 				  detfile.print(&quot;&lt;NOTES&gt;&lt;![CDATA[&quot;+CacheNotes+&quot;]]&gt;&lt;/NOTES&gt;\n&quot;);
 				  detfile.print(&quot;&lt;IMAGES&gt;\n&quot;);
-				  String stbuf = new String();
+				  String stbuf;
 				  for(int i = 0;i&lt;images.size();i++){
 						stbuf = images.get(i).getFilename();
 						String urlBuf = images.get(i).getURL();

Modified: trunk/src/CacheWolf/Common.java
===================================================================
--- trunk/src/CacheWolf/Common.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Common.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -185,7 +185,7 @@
 	}
 	
 	public static String fixSerialPortName(String name) {
-		if (name.startsWith(&quot;/&quot;)) return new String(&quot;..&quot;+name); // on linux (*nix) machines it is quite usual to give the complete file path to the serial port, but ewe expects only &quot;ttyS0&quot; or similar
+		if (name.startsWith(&quot;/&quot;)) return &quot;..&quot;+name; // on linux (*nix) machines it is quite usual to give the complete file path to the serial port, but ewe expects only &quot;ttyS0&quot; or similar
 		else                      return name;
 	}
 	

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/CoordsScreen.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -331,7 +331,7 @@
 				CWPoint coord;
 				String inp=inpText.getText().trim().toUpperCase();
 				if (inp.startsWith(&quot;GC&quot;)) {
-					SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile(), false);
+					SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
 					coord = new CWPoint(spider.getCacheCoordinates(inp));
 				} else {	
 					coord = new CWPoint(inp);

Modified: trunk/src/CacheWolf/GeocoderOsm.java
===================================================================
--- trunk/src/CacheWolf/GeocoderOsm.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/GeocoderOsm.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -43,7 +43,7 @@
 
 	public static Vector geocode(String address, Handle[] h) 
 	throws SAXException, IOException, HandleStoppedException, InterruptedException {
-		ByteArray answ = UrlFetcher.fetchByteArray((geocoderUrl+UrlFetcher.toUtf8Url(address)), null, h);
+		ByteArray answ = UrlFetcher.fetchByteArray((geocoderUrl+UrlFetcher.toUtf8Url(address)), h);
 		XMLDecoder xmldec = new XMLDecoder();
 		xmldec.parse(new InputStreamReader(new ByteArrayInputStream(answ), IO.JAVA_UTF8_CODEC));
 		Vector erg = new Vector();

Modified: trunk/src/CacheWolf/HttpConnection.java
===================================================================
--- trunk/src/CacheWolf/HttpConnection.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/HttpConnection.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -257,6 +257,11 @@
 {
 	getRequestorProperties().set(name,property);
 }
+public void setRequestorProperty(PropertyList pl)
+//===================================================================
+{
+	getRequestorProperties().set(pl);
+}
 /**
  * Add a non-exclusive requestor property. These are sent to the web server after the initial request line.
  * @param name The name of the property.
@@ -347,6 +352,7 @@
 			}
 		}
 	}
+	getRequestorProperties().clear();
 }
 
 //FIXME: never referenced

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/MainMenu.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -41,6 +41,7 @@
 import CacheWolf.imp.GCVoteImporter;
 import CacheWolf.imp.GPXImporter;
 import CacheWolf.imp.LOCXMLImporter;
+import CacheWolf.imp.OCGPXfetch;
 import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.imp.OCXMLImporterScreen;
 import CacheWolf.imp.SpiderGC;
@@ -78,7 +79,7 @@
  *     20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
  */
 public class MainMenu extends MenuBar {
-	private MenuItem preferences, mnuContext,loadcaches,loadOC, /* savenexit, */ savenoxit,exit,search,searchAll,searchClr;
+	private MenuItem preferences, mnuContext,loadcaches,loadOC, loadOCFinds, /* savenexit, */ savenoxit,exit,search,searchAll,searchClr;
 	private MenuItem downloadmap, kalibmap, importmap, selectMapPath;
 	private MenuItem spider, spiderRoute, spiderQuick, spiderAllFinds, loadGCVotes, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
@@ -120,7 +121,10 @@
 		else spiderRoute = mnuSeparator;
 		MenuItem[] mnuImport = {				
 				loadcaches     = new MenuItem(MyLocale.getMsg(129,&quot;Import GPX&quot;)),
+				mnuSeparator,
 				loadOC         = new MenuItem(MyLocale.getMsg(130,&quot;Download from opencaching&quot;)),
+				loadOCFinds    = new MenuItem(MyLocale.getMsg(163,&quot;Finds from opencaching&quot;)),
+				mnuSeparator,
 				spider         = new MenuItem(MyLocale.getMsg(131,&quot;Download from geocaching.com&quot;)),
 				spiderRoute,
 				spiderAllFinds = new MenuItem(MyLocale.getMsg(217,&quot;Spider all finds from geocaching.com&quot;)),
@@ -361,7 +365,7 @@
 			// subMenu for import, part of &quot;Application&quot; menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == spider){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doIt();
 				cacheDB.clear();
@@ -369,7 +373,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == spiderRoute){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doItAlongARoute();
 				cacheDB.clear();
@@ -377,7 +381,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == spiderQuick){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doItQuickFillFromMapList();
 				cacheDB.clear();
@@ -385,7 +389,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == spiderAllFinds){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doIt(true);
 				cacheDB.clear();
@@ -393,7 +397,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == loadGCVotes){
-                GCVoteImporter sGCV = new GCVoteImporter(pref, profile, true);
+                GCVoteImporter sGCV = new GCVoteImporter(pref, profile);
                 sGCV.doIt();
                 tbp.resetModel();
 			}
@@ -435,6 +439,12 @@
                 filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
 				tbp.resetModel();
 			}
+			if(mev.selectedItem == loadOCFinds){
+				OCGPXfetch.doIt();
+                Global.getProfile().setShowBlacklisted(false);
+                filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&amp;~MenuItem.Checked;
+				tbp.resetModel();
+			}
 			if (mev.selectedItem == update)
 				updateSelectedCaches(tbp);
 			if(mev.selectedItem == mnuForceLogin) {
@@ -839,7 +849,7 @@
 		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(1014,&quot;updateSelectedCaches&quot;), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.ALL);
 		if (options.execute() == FormBase.IDCANCEL) {	return; }
 
-		SpiderGC spider = new SpiderGC(pref, profile, false);
+		SpiderGC spider = new SpiderGC(pref, profile);
 		OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
 		Vm.showWait(true);
 		boolean alreadySaid = false;

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Preferences.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -251,7 +251,8 @@
 	public String garminGPSBabelOptions=&quot;&quot;;
 	/** Max. length for Garmin waypoint names (for etrex which can only accept 6 chars) */
 	public int garminMaxLen=0;
-	public boolean downloadMissingOC = false;
+	/** OC true = alle neu Laden false = wenn &#196;nderungsdatum neuer */
+	public boolean downloadAllOC = false;
 	public String lastOCSite=OC.OCSites[0][OC.OC_HOSTNAME];
 	/** The currently used centre point, can be different from the profile's centrepoint. This is used
 	 *  for spidering */
@@ -292,7 +293,7 @@
 	public boolean checkLog=false;
 	/** Check if presence of TBs changed*/
 	public boolean checkTBs=true;
-	/** Check if difficulty, terrain or size changed*/
+	/** Check if presence of DTS changed*/
 	public boolean checkDTS=true;
 	/** menu of spider along a route exists*/
 	public boolean spiderRoute=false;
@@ -495,7 +496,7 @@
 			tmp=atts.getValue(&quot;lastSite&quot;);
 			if (!(tmp == null) &amp;&amp; OC.getSiteIndex(tmp)&gt;=0 ) lastOCSite=tmp;
 			tmp=atts.getValue(&quot;downloadMissing&quot;);
-			if (!(tmp == null)) downloadMissingOC = Boolean.valueOf(tmp).booleanValue();
+			if (!(tmp == null)) downloadAllOC = Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals(&quot;listview&quot;)) {
 			listColMap=atts.getValue(&quot;colmap&quot;);
@@ -569,11 +570,11 @@
 		}
 		else if (name.equals(&quot;spider&quot;)) {
 			forceLogin = Boolean.valueOf(atts.getValue(&quot;forcelogin&quot;)).booleanValue();
-			checkLog = Boolean.valueOf(atts.getValue(&quot;checkLog&quot;)).booleanValue();
-      tmp = atts.getValue(&quot;checkTBs&quot;);
-			if (tmp != null) checkTBs = Boolean.valueOf(atts.getValue(&quot;checkTBs&quot;)).booleanValue();
-      tmp = atts.getValue(&quot;checkDTS&quot;);
-			if (tmp != null) checkDTS = Boolean.valueOf(atts.getValue(&quot;checkDTS&quot;)).booleanValue();
+			checkLog = Boolean.valueOf(atts.getValue(&quot;checkLog&quot;)).booleanValue();      
+			tmp = atts.getValue(&quot;checkTBs&quot;);
+			if (tmp != null) checkTBs=Boolean.valueOf(atts.getValue(&quot;checkTBs&quot;)).booleanValue();
+			tmp = atts.getValue(&quot;checkDTS&quot;);
+			if (tmp != null) checkDTS=Boolean.valueOf(atts.getValue(&quot;checkDTS&quot;)).booleanValue();
 			spiderRoute = Boolean.valueOf(atts.getValue(&quot;spiderRoute&quot;)).booleanValue();
 			tmp = atts.getValue(&quot;spiderUpdates&quot;);
 			if (tmp != null) spiderUpdates=Convert.parseInt(tmp);
@@ -736,9 +737,19 @@
 			outp.print(&quot;    &lt;solver ignorevariablecase=\&quot;&quot; + SafeXML.strxmlencode(solverIgnoreCase) + &quot;\&quot; degMode=\&quot;&quot; + SafeXML.strxmlencode(solverDegMode) + &quot;\&quot; /&gt;\n&quot;);
 			outp.print(&quot;    &lt;garmin connection = \&quot;&quot; + SafeXML.clean(garminConn) + &quot;\&quot; GPSBabelOptions = \&quot;&quot; + SafeXML.clean(garminGPSBabelOptions) + &quot;\&quot; MaxWaypointLength = \&quot;&quot; + SafeXML.strxmlencode(garminMaxLen) +
 					        &quot;\&quot; addDetailsToWaypoint = \&quot;&quot; + SafeXML.strxmlencode(addDetailsToWaypoint) + &quot;\&quot; addDetailsToName = \&quot;&quot; + SafeXML.strxmlencode(addDetailsToName) + &quot;\&quot; /&gt;\n&quot;);
-			outp.print(&quot;    &lt;opencaching lastSite=\&quot;&quot;+lastOCSite+&quot;\&quot; downloadMissing=\&quot;&quot; + SafeXML.strxmlencode(downloadMissingOC) + &quot;\&quot;/&gt;\n&quot;);
+			outp.print(&quot;    &lt;opencaching lastSite=\&quot;&quot;+lastOCSite+&quot;\&quot; downloadMissing=\&quot;&quot; + SafeXML.strxmlencode(downloadAllOC) + &quot;\&quot;/&gt;\n&quot;);
 			outp.print(&quot;    &lt;location lat = \&quot;&quot; + SafeXML.clean(curCentrePt.getLatDeg(TransformCoordinates.DD)) + &quot;\&quot; long = \&quot;&quot; + SafeXML.clean(curCentrePt.getLonDeg(TransformCoordinates.DD)) + &quot;\&quot;/&gt;\n&quot;);
-			outp.print(&quot;    &lt;spider forcelogin=\&quot;&quot; + SafeXML.strxmlencode(forceLogin) + &quot;\&quot; spiderUpdates=\&quot;&quot; + SafeXML.strxmlencode(spiderUpdates) + &quot;\&quot; checkLog=\&quot;&quot; + SafeXML.strxmlencode(checkLog) + &quot;\&quot; checkTBs=\&quot;&quot; + SafeXML.strxmlencode(checkTBs) + &quot;\&quot; checkDTS=\&quot;&quot; + SafeXML.strxmlencode(checkDTS) + &quot;\&quot; spiderRoute=\&quot;&quot; + SafeXML.strxmlencode(spiderRoute) + &quot;\&quot; maxSpiderNumber=\&quot;&quot; + SafeXML.strxmlencode(maxSpiderNumber) + &quot;\&quot; downloadPics=\&quot;&quot; + SafeXML.strxmlencode(downloadPics) + &quot;\&quot; downloadTBs=\&quot;&quot; + SafeXML.strxmlencode(downloadTBs) +&quot;\&quot;/&gt;\n&quot;);
+			outp.print(&quot;    &lt;spider&quot;+
+					&quot; forcelogin=\&quot;&quot; + SafeXML.strxmlencode(forceLogin) + &quot;\&quot;&quot;+
+					&quot; spiderUpdates=\&quot;&quot; + SafeXML.strxmlencode(spiderUpdates) + &quot;\&quot;&quot;+
+					&quot; checkLog=\&quot;&quot; + SafeXML.strxmlencode(checkLog) + &quot;\&quot;&quot;+
+					&quot; checkTBs=\&quot;&quot; + SafeXML.strxmlencode(checkTBs) + &quot;\&quot;&quot;+
+					&quot; checkDTS=\&quot;&quot; + SafeXML.strxmlencode(checkDTS) +&quot;\&quot;&quot;+
+					&quot; spiderRoute=\&quot;&quot; + SafeXML.strxmlencode(spiderRoute) + &quot;\&quot;&quot;+
+					&quot; maxSpiderNumber=\&quot;&quot; + SafeXML.strxmlencode(maxSpiderNumber) + &quot;\&quot;&quot;+
+					&quot; downloadPics=\&quot;&quot; + SafeXML.strxmlencode(downloadPics) + &quot;\&quot;&quot;+
+					&quot; downloadTBs=\&quot;&quot; + SafeXML.strxmlencode(downloadTBs) +&quot;\&quot;&quot;+
+					&quot;/&gt;\n&quot;);
 			outp.print(&quot;    &lt;gotopanel northcentered=\&quot;&quot; + SafeXML.strxmlencode(northCenteredGoto) + &quot;\&quot; /&gt;\n&quot;);
 			outp.print(&quot;    &lt;details cacheSize=\&quot;&quot; + SafeXML.strxmlencode(maxDetails) + &quot;\&quot; delete=\&quot;&quot; + SafeXML.strxmlencode(deleteDetails) + &quot;\&quot;/&gt;\n&quot;);
 			outp.print(&quot;    &lt;metric type=\&quot;&quot; + SafeXML.strxmlencode(metricSystem) + &quot;\&quot;/&gt;\n&quot;);

Modified: trunk/src/CacheWolf/TravelbugJourneyScreen.java
===================================================================
--- trunk/src/CacheWolf/TravelbugJourneyScreen.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/TravelbugJourneyScreen.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -589,7 +589,7 @@
 		}
 		if (selectedItem==mnuGetMission &amp;&amp; selectedRow&gt;-1) {
 			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
-			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile(),false);
+			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile());
 			Vm.showWait(true);
 			
 			//if we have an ID, get mission by ID
@@ -620,7 +620,7 @@
 		}
 		if (selectedItem==mnuOpenOnline &amp;&amp; selectedRow&gt;=0) {
 			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
-			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile(),false);
+			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile());
 			Vm.showWait(true);
 			// First check whether ID is set, if not get it
 			if (tbj.getTb().getGuid().length()==0) tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName()));

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -25,8 +25,10 @@
     */
 package CacheWolf;
 
+import ewe.data.PropertyList;
 import ewe.io.AsciiCodec;
-import ewe.io.ByteArrayInputStream;
+import ewe.io.File;
+import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
 import ewe.net.Socket;
@@ -35,33 +37,64 @@
 import ewe.sys.HandleStoppedException;
 import ewe.util.ByteArray;
 import ewe.util.CharArray;
-import ewe.util.Properties;
 
 public class UrlFetcher {
-	public static String fetchString(String address) throws IOException
-	{
-		ByteArray daten = fetchByteArray(address, null);
+	static HttpConnection conn;
+	static int maxRedirections = 5;
+	static PropertyList requestorProperties = null;
+	static PropertyList permanentRequestorProperties = null;
+	static String postData=null;
+	static String urltmp=null;
+	
+	public static PropertyList getDocumentProperties() {
+		if (conn != null) 
+			return conn.documentProperties;
+		else return null;
+	}
+	public static String getRealUrl() { return urltmp; };
+	public static void setMaxRedirections(int value) { maxRedirections=value; };
+	public static void setRequestorProperties(PropertyList value) { requestorProperties=value; };
+	public static void setRequestorProperty(String name, String property) {
+		if (requestorProperties == null) requestorProperties = new PropertyList();
+		requestorProperties.set(name,property);
+	}
+	private static void initPermanentRequestorProperty() {
+		permanentRequestorProperties = new PropertyList();
+		permanentRequestorProperties.add(&quot;USER_AGENT&quot;, &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0&quot;);
+		// permanentRequestorProperties.add(&quot;Connection&quot;, &quot;close&quot;);		
+	}
+	public static void setPermanentRequestorProperty(String name, String property) {
+		if (permanentRequestorProperties == null) initPermanentRequestorProperty();
+		if (property != null) 
+			permanentRequestorProperties.set(name,property);
+		else {
+			int index = permanentRequestorProperties.find(name);
+			if ( index &gt;= 0 ) permanentRequestorProperties.del(index);			
+		}
+	}
+	public static void setpostData(String value) { postData=value;};
+	public static String fetch(String address) throws IOException {
+		ByteArray daten = fetchByteArray(address);
 		JavaUtf8Codec codec = new JavaUtf8Codec();
 		CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
 		return c_data.toString();
+	}	
+	public static ByteArray fetchData(String address) throws IOException
+	{ return fetchByteArray(address); }
+	public static void fetchDataFile(String address, String target) throws IOException {
+		FileOutputStream outp =  new FileOutputStream(new File(target));
+		outp.write(fetchByteArray(address).toBytes());
+		outp.close();
 	}
-
-	public static Properties fetchPropertyList(String url) throws IOException {
-		CharArray t = new CharArray();
-		ByteArray doc = fetchByteArray(url, t);
-		Properties props = new Properties();
-		props.load(new ByteArrayInputStream(doc));
-		return props; 
-	}
-
-	public static ByteArray fetchByteArray(String url, CharArray realurl) throws IOException {
+	// all errors as IOException
+	private static ByteArray fetchByteArray(String url) throws IOException {
 		Handle[] hndl = new Handle[1];
 		try {
-		return fetchByteArray(url, realurl, hndl);
+		return fetchByteArray(url, hndl);
 		} catch ( InterruptedException e) {
-			throw new IOException(&quot;Error reading data. i :&quot;+url);
+			throw new IOException(&quot;Error reading data. Interrupted :&quot;+url);
 		} catch ( HandleStoppedException e) {
-			throw new IOException(&quot;Error reading data. s :&quot;+url);
+			throw new IOException(&quot;Error reading data. HandleStopped :&quot;+url);
 		}
 	}
 
@@ -73,20 +106,23 @@
 	 * @throws InterruptedException 
 	 * @throws HandleStoppedException 
 	 */
-	public static ByteArray fetchByteArray(String url, CharArray realurl, Handle[] hndl) 
+	public static ByteArray fetchByteArray(String url, Handle[] hndl) 
 	throws IOException, HandleStoppedException, InterruptedException {	
-		final int maxRedirections = 5;
-		HttpConnection conn = null;
 		Socket sock = null;
 		int i=0;
-		String urltmp = new String(url);
+		urltmp = url;
+		conn = new HttpConnection(urltmp);
 		do  { // allow max 5 redirections (http 302 location)
-			if (realurl != null) realurl.copyFrom(new String(urltmp));
 			i++;
-			conn = new HttpConnection(urltmp);
-			conn.setRequestorProperty(&quot;USER_AGENT&quot;, &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0&quot;);
-			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
+			conn.setUrl(urltmp);
 			conn.documentIsEncoded = isUrlEncoded(urltmp);
+			if (permanentRequestorProperties == null) initPermanentRequestorProperty();
+			if (postData != null) {
+				conn.setPostData(postData);
+				setRequestorProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
+			}
+			conn.setRequestorProperty(permanentRequestorProperties);
+			if (requestorProperties != null) conn.setRequestorProperty(requestorProperties);
 			hndl[0] = conn.connectAsync();
 			hndl[0].waitOn(Handle.Success);
 			sock = (Socket)hndl[0].returnValue; //&quot;Could not connect.&quot;);
@@ -108,8 +144,10 @@
 		}finally {
 			sock.close();
 		}
-		daten = (ByteArray)hndl[0].returnValue;
-		// ByteArray daten = conn.readData(sock);
+		maxRedirections = 5;
+		requestorProperties = null;
+		postData=null;
+		daten = (ByteArray)hndl[0].returnValue; // ByteArray daten = conn.readData(sock);
 		return daten;
 	}
 
@@ -117,7 +155,7 @@
 	 * @param url
 	 * @return true, if the string seems to be already URL encoded (that is, it contains only url-allowd chars), false otherwise
 	 */
-	public static boolean isUrlEncoded(String url) {
+	private static boolean isUrlEncoded(String url) {
 		final String allowed = new String (&quot;-_.~!*'();:@&amp;=+$,/?%#[]&quot;);
 		char [] src = ewe.sys.Vm.getStringChars(url);
 		char c;
@@ -163,7 +201,7 @@
 	 * @return The encoded URL.
 	 */
 	//===================================================================
-	public static String encodeURL(String url, boolean spaceToPlus)
+	private static String encodeURL(String url, boolean spaceToPlus)
 	//===================================================================
 	{
 		char [] what = ewe.sys.Vm.getStringChars(url);

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Version.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -27,6 +27,7 @@
 
 import com.stevesoft.ewe_pat.Regex;
 
+import ewe.io.ByteArrayInputStream;
 import ewe.io.IOException;
 import ewe.sys.Convert;
 import ewe.sys.Vm;
@@ -71,7 +72,9 @@
 	 * @throws IOException
 	 */
 	public static void checkForUpdates() throws IOException {
-		Properties curvers = UrlFetcher.fetchPropertyList(&quot;<A HREF="http://svn.berlios.de/svnroot/repos/cachewolf/trunk/currentversions.txt">http://svn.berlios.de/svnroot/repos/cachewolf/trunk/currentversions.txt</A>&quot;);
+		String currentVersionsUrl=&quot;<A HREF="http://svn.berlios.de/svnroot/repos/cachewolf/trunk/currentversions.txt">http://svn.berlios.de/svnroot/repos/cachewolf/trunk/currentversions.txt</A>&quot;;
+		Properties curvers = new Properties();
+		curvers.load(new ByteArrayInputStream(UrlFetcher.fetchData(currentVersionsUrl)));
 		versionnumbers = new String[updateavailabe.length];
 		for (int i = updateavailabe.length-1; i &gt;=1; i--) {
 			updateavailabe[i] = checkVersion(curvers, &quot;T&quot;+(i-1), i); // this also sets versionnumber[i]
@@ -132,7 +135,7 @@
 				Regex s;
 				int i = svnRString.indexOf(' ');
 				if (i &gt; 0) {
-					tmp = UrlFetcher.fetchString(svnRString.substring(0, i));
+					tmp = UrlFetcher.fetch(svnRString.substring(0, i));
 					s = new Regex (svnRString.substring(i+1, svnRString.length())); // flyingfish works 3/2008 with (&quot;(?i)Revision[\\s]*[:=][\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)&quot;);
 				} else { versionnumbers[t] = &quot;error: no RegEx&quot;; return 3; }
 				s.search(tmp);

Modified: trunk/src/CacheWolf/exp/GpxExportNg.java
===================================================================
--- trunk/src/CacheWolf/exp/GpxExportNg.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/exp/GpxExportNg.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -128,7 +128,20 @@
 
 	// we need to fake desc to make clients like GSAK accept additional waypoints together with caches
 	final static String GPXHEADER = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;+(newLine)
-			+(&quot;&lt;gpx xmlns:xsi=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance\">http://www.w3.org/2001/XMLSchema-instance\</A>&quot; xmlns:xsd=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema\">http://www.w3.org/2001/XMLSchema\</A>&quot; version=\&quot;1.0\&quot; creator=\&quot;CacheWolf\&quot; xsi:schemaLocation=\&quot;<A HREF="http://www.topografix.com/GPX/1/0">http://www.topografix.com/GPX/1/0</A> <A HREF="http://www.topografix.com/GPX/1/0/gpx.xsd">http://www.topografix.com/GPX/1/0/gpx.xsd</A> <A HREF="http://www.groundspeak.com/cache/1/0">http://www.groundspeak.com/cache/1/0</A> <A HREF="http://www.groundspeak.com/cache/1/0/cache.xsd\">http://www.groundspeak.com/cache/1/0/cache.xsd\</A>&quot; xmlns=\&quot;<A HREF="http://www.topografix.com/GPX/1/0\">http://www.topografix.com/GPX/1/0\</A>&quot;&gt;&quot;)+(newLine)
+			+(&quot;&lt;gpx&quot;)
+			+(&quot; xmlns:xsi=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance\">http://www.w3.org/2001/XMLSchema-instance\</A>&quot;&quot;)
+			+(&quot; xmlns:xsd=\&quot;<A HREF="http://www.w3.org/2001/XMLSchema\">http://www.w3.org/2001/XMLSchema\</A>&quot;&quot;)
+			+(&quot; version=\&quot;1.0\&quot;&quot;)
+			+(&quot; creator=\&quot;CacheWolf\&quot;&quot;)
+			+(&quot; xsi:schemaLocation=\&quot;&quot;)
+				+(&quot;<A HREF="http://www.topografix.com/GPX/1/0">http://www.topografix.com/GPX/1/0</A> &quot;)
+				+(&quot;<A HREF="http://www.topografix.com/GPX/1/0/gpx.xsd">http://www.topografix.com/GPX/1/0/gpx.xsd</A> &quot;)
+				+(&quot;<A HREF="http://www.groundspeak.com/cache/1/0/1">http://www.groundspeak.com/cache/1/0/1</A> &quot;)
+				+(&quot;<A HREF="http://www.groundspeak.com/cache/1/0/1/cache.xsd">http://www.groundspeak.com/cache/1/0/1/cache.xsd</A>&quot;)
+			+(&quot;\&quot;&quot;)
+			+(&quot; xmlns=\&quot;<A HREF="http://www.topografix.com/GPX/1/0\">http://www.topografix.com/GPX/1/0\</A>&quot;&quot;)
+			+(&quot;&gt;&quot;)
+			+(newLine)
 			+(&quot;&lt;name&gt;@@NAME@@&lt;/name&gt;&quot;)+(newLine)
 			+(&quot;&lt;desc&gt;This is an individual cache generated from Geocaching.com&lt;/desc&gt;&quot;)+(newLine)
 			+(&quot;&lt;author&gt;Various users from geocaching.com and/or opencaching.de&lt;/author&gt;&quot;)+(newLine)

Modified: trunk/src/CacheWolf/imp/GCVoteImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -32,6 +32,7 @@
 import CacheWolf.MyLocale;
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
+import CacheWolf.UrlFetcher;
 import CacheWolf.imp.SpiderGC.SpiderProperties;
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
@@ -58,19 +59,15 @@
 	private String GCVWaypoints;
 	private String GCVResults;
 	private static Preferences pref;
-	private static SpiderProperties p=null;
 
 	/**
 	*	Constructor initalizing profile and cacheDB
 	*/
-	public GCVoteImporter(Preferences prf, Profile _profile, boolean bypass){
+	public GCVoteImporter(Preferences prf, Profile _profile){
 		this.profile=_profile;
 		this.cacheDB = profile.cacheDB;
 		pref = prf;
-		if (p == null) {
-			pref.logInit();
-		}
-		// initialiseProperties();
+		// pref.logInit();
 	}
 
 	/**
@@ -110,7 +107,8 @@
 				pref.log(&quot;[GCVote]:Requesting ratings&quot;);
 
 				// request web page <A HREF="http://gcvote.de/getVotes.php">http://gcvote.de/getVotes.php</A>
-				GCVResults = getResponse(GCVURL);
+				// UrlFetcher.setRequestorProperty(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (compatible; Cachewolf; GCVoteImporter)&quot;);
+				GCVResults = UrlFetcher.fetch(GCVURL);
 				if (GCVResults.equals(&quot;&quot;)) {
 					(new MessageBox(MyLocale.getMsg(0,&quot;Error&quot;), MyLocale.getMsg(0,&quot;Error loading GCVote page.%0aPlease check your internet connection.&quot;), FormBase.OKB)).execute();
 					pref.log(&quot;[GCVote]:Could not fetch: getVotes.php page&quot;,null);
@@ -143,34 +141,4 @@
 			cb.setNumRecommended( 100*voteCnt + (int)(voteAvg + 0.5));
 		}
 	}
-
-	/**
-	*	Perform an request to fetch the GCVote results
-	*/
-	public static String getResponse(String address) {
-		CharArray c_data;
-		try{
-			HttpConnection conn;
-			if(pref.myproxy.length() &gt; 0 &amp;&amp; pref.proxyActive){
-				pref.log(&quot;[GCVote]:Using proxy: &quot; + pref.myproxy + &quot; / &quot; +pref.myproxyport);
-			}
-			conn = new HttpConnection(address);
-			conn.setRequestorProperty(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (compatible; Cachewolf; GCVoteImporter)&quot;);
-			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-			conn.documentIsEncoded = true;
-			pref.log(&quot;[GCVote]:Connecting &quot;+address);
-			Socket sock = conn.connect();
-			pref.log(&quot;[GCVote]:Connect ok! &quot;+address);
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			c_data = conn.readText(sock, codec);
-			sock.close();
-			pref.log(&quot;[GCVote]:Read data ok &quot;+address);
-			return c_data.toString();
-		}catch(IOException ioex){
-			pref.log(&quot;IOException in fetch&quot;, ioex);
-		}finally{
-			//continue
-		}
-		return &quot;&quot;;
-	}
 }

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -30,22 +30,32 @@
 import CacheWolf.Attribute;
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
+import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
 import CacheWolf.Common;
 import CacheWolf.Extractor;
 import CacheWolf.Filter;
+import CacheWolf.ImageInfo;
 import CacheWolf.InfoBox;
 import CacheWolf.Log;
 import CacheWolf.MyLocale;
+import CacheWolf.OC;
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
 import CacheWolf.STRreplace;
 import CacheWolf.SafeXML;
 import CacheWolf.Travelbug;
+import CacheWolf.UrlFetcher;
 import CacheWolf.imp.SpiderGC.SpiderProperties;
+import CacheWolf.utils.FileBugfix;
+import ewe.io.File;
 import ewe.io.FileInputStream;
+import ewe.io.IOException;
+import ewe.net.MalformedURLException;
+import ewe.net.URL;
+import ewe.sys.Convert;
 import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.FormBase;
@@ -127,7 +137,7 @@
 				doSpider = true;
 			}
 			if (doSpider) {
-				imgSpider = new SpiderGC(pref, profile, false);
+				imgSpider = new SpiderGC(pref, profile);
 				doitHow = DOIT_WITHSPOILER;
 			} else {
 				doitHow = DOIT_NOSPOILER;
@@ -157,6 +167,7 @@
 							infB.close(0);
 						}
 					}
+					zif.close();
 				}
 				else {
 					FileInputStream rFIS = new ewe.io.FileInputStream(file);
@@ -198,7 +209,7 @@
 			if (atts.getValue(&quot;creator&quot;).startsWith(&quot;TerraCaching&quot;)) fromTC = true;
 			else fromTC = false;
 
-			if (fromOC &amp;&amp; doSpider) (new MessageBox(&quot;Warnung&quot;, MyLocale.getMsg(4001, &quot;GPX files from opencaching don't contain information of images, they cannot be laoded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching&quot;), FormBase.OKB)).execute();
+			// if (fromOC &amp;&amp; doSpider) (new MessageBox(&quot;Warnung&quot;, MyLocale.getMsg(4001, &quot;GPX files from opencaching don't contain information of images, they cannot be laoded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching&quot;), FormBase.OKB)).execute();
 			zaehlerGel = 0;
 		}
 		if (name.equals(&quot;wpt&quot;)) {
@@ -223,6 +234,13 @@
 			inCache = true;
 			holder.setAvailable(atts.getValue(&quot;available&quot;).equals(&quot;True&quot;));
 			holder.setArchived(atts.getValue(&quot;archived&quot;).equals(&quot;True&quot;));
+			// OC now has GC - Format,  get CacheID -- missing p.ex. on GcTour gpx
+			for (int i = 0; i &lt; atts.getLength(); i++) {
+				if (atts.getName(i).equals(&quot;id&quot;)) {
+					holder.setOcCacheID(atts.getValue(&quot;id&quot;));
+					break;
+				}
+			}
 			return;
 		}
 		// OC
@@ -233,13 +251,12 @@
 			// get CacheID -- missing p.ex. on GcTour gpx
 			for (int i = 0; i &lt; atts.getLength(); i++) {
 				if (atts.getName(i).equals(&quot;id&quot;)) {
-					String ocCacheID = atts.getValue(&quot;id&quot;);
-					holder.setOcCacheID(ocCacheID);
+					holder.setOcCacheID(atts.getValue(&quot;id&quot;));
 					break;
 				}
 			}
 			// get status
-			String status = new String(atts.getValue(&quot;status&quot;));
+			String status = atts.getValue(&quot;status&quot;);
 			if (status.equals(&quot;Available&quot;)) available = true;
 			else if (status.equals(&quot;Unavailable&quot;)) available = false;
 			else if (status.equals(&quot;Draft&quot;)) available = false;
@@ -333,26 +350,23 @@
 				// if waypoint starts with &quot;GC&quot;
 				if(doSpider) {
 					if(spiderOK &amp;&amp; holder.is_archived() == false){
-							if(holder.getLatLon().length() &gt; 1){
-						}
-						if(holder.getWayPoint().startsWith(&quot;GC&quot;)|| fromTC) {
-							//spiderImages();
-							spiderImagesUsingSpider();
-							//Rename image sources
-							String text;
-							String orig;
-							String imgName;
-							orig = holder.getCacheDetails(false).LongDescription;
-							Extractor ex = new Extractor(orig, &quot;&lt;img src=\&quot;&quot;, &quot;&gt;&quot;, 0, false);
+						if(holder.getLatLon().length() &gt; 1){ }
+						//spiderImages();
+						spiderImagesUsingSpider();
+						//Rename image sources
+						String text;
+						String orig;
+						String imgName;
+						orig = holder.getCacheDetails(false).LongDescription;
+						Extractor ex = new Extractor(orig, &quot;&lt;img src=\&quot;&quot;, &quot;&gt;&quot;, 0, false);
+						text = ex.findNext();
+						int num = 0;
+						while(ex.endOfSearch() == false &amp;&amp; spiderOK){
+							if (num &gt;= holder.getCacheDetails(false).images.size())break;
+							imgName = holder.getCacheDetails(false).images.get(num).getTitle();
+							holder.getCacheDetails(false).LongDescription = STRreplace.replace(holder.getCacheDetails(false).LongDescription, text, &quot;[[Image: &quot; + imgName + &quot;]]&quot;);
+							num++;
 							text = ex.findNext();
-							int num = 0;
-							while(ex.endOfSearch() == false &amp;&amp; spiderOK){
-								if (num &gt;= holder.getCacheDetails(false).images.size())break;
-								imgName = holder.getCacheDetails(false).images.get(num).getTitle();
-								holder.getCacheDetails(false).LongDescription = STRreplace.replace(holder.getCacheDetails(false).LongDescription, text, &quot;[[Image: &quot; + imgName + &quot;]]&quot;);
-								num++;
-								text = ex.findNext();
-							}
 						}
 					}
 				}
@@ -364,7 +378,12 @@
 				CacheHolder oldCh= cacheDB.get(index);
 				// Preserve images: Copy images from old cache version because here we didn't add
 				// any image information to the holder object.
-				holder.getCacheDetails(false).images = oldCh.getCacheDetails(true).images;
+				if (pref.downloadPics &amp;&amp; holder.isOC()) {
+					spiderImagesUsingSpider(); 
+				}
+				else {
+					holder.getCacheDetails(false).images = oldCh.getCacheDetails(true).images;
+				}
 				oldCh.initStates(false);
 				oldCh.update(holder);
 				oldCh.save();
@@ -551,11 +570,11 @@
 	}
 	
 	private void spiderImagesUsingSpider(){
-		String addr;
+		String addresse;
 		String cacheText;
 		
 		// just to be sure to have a spider object
-		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile, false);
+		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile);
 		if (propsSpider == null) {propsSpider = imgSpider.new SpiderProperties();	}
 		
 		try {
@@ -563,26 +582,154 @@
 						imgSpider.getImages(holder.getCacheDetails(false).LongDescription, holder.getCacheDetails(false),false);
 				}
 				else {
-					addr = &quot;<A HREF="http://www.geocaching.com/seek/cache_details.aspx?wp=">http://www.geocaching.com/seek/cache_details.aspx?wp=</A>&quot; + holder.getWayPoint() ;
-					cacheText = SpiderGC.fetchText(addr,false);
-					if (cacheText.indexOf(propsSpider.getProp(&quot;premiumCachepage&quot;)) &gt; 0) {
-						// Premium cache spidered by non premium member
-						imgSpider.getImages(holder.getCacheDetails(false).LongDescription, holder.getCacheDetails(false),false);
+					if (fromOC) {
+						holder.getCacheDetails(false).images.clear();
+						addresse=holder.getCacheDetails(false).URL;
+						cacheText = UrlFetcher.fetch(addresse);
+						Extractor exBeschreibung = new Extractor(cacheText, &quot;&lt;!-- Beschreibung --&gt;&quot;, &quot;&lt;!-- End Beschreibung --&gt;&quot;, 0, false);
+						String beschreibung = exBeschreibung.findNext();
+						getOCPictures(beschreibung);
+						Extractor exBilder = new Extractor(cacheText, &quot;&lt;!-- Bilder --&gt;&quot;, &quot;&lt;!-- End Bilder --&gt;&quot;, 0, false);
+						String bilder = exBilder.findNext();
+						getOCPictures(bilder);
 					}
 					else {
-						imgSpider.getImages(cacheText, holder.getCacheDetails(false),true);
+						addresse = &quot;<A HREF="http://www.geocaching.com/seek/cache_details.aspx?wp=">http://www.geocaching.com/seek/cache_details.aspx?wp=</A>&quot; + holder.getWayPoint() ;
+						cacheText = UrlFetcher.fetch(addresse);
+						if (cacheText.indexOf(propsSpider.getProp(&quot;premiumCachepage&quot;)) &gt; 0) {
+							// Premium cache spidered by non premium member
+							imgSpider.getImages(holder.getCacheDetails(false).LongDescription, holder.getCacheDetails(false),false);
+						}
+						else {
+							imgSpider.getImages(cacheText, holder.getCacheDetails(false),true);
+						}
+						try {
+							imgSpider.getAttributes(cacheText, holder.getCacheDetails(false));
+						} catch (Exception e) {
+							pref.log(&quot;unable to fetch attributes for&quot;+holder.getWayPoint(), e);
+						}
 					}
-					try {
-						imgSpider.getAttributes(cacheText, holder.getCacheDetails(false));
-					} catch (Exception e) {
-						pref.log(&quot;unable to fetch attrivbutes for&quot;+holder.getWayPoint(), e);
-					}
 				}
 		} catch (Exception e1) {
 			// e1.printStackTrace();
 		}
 	}
+	private void getOCPictures(String html) {
+		Regex imgRegexUrl = new Regex(&quot;(&lt;img[^&gt;]*src=[\&quot;\']([^&gt;^\&quot;^\']*)[^&gt;]*&gt;|&lt;img[^&gt;]*src=([^&gt;^\&quot;^\'^ ]*)[^&gt;]*&gt;)&quot;);
+		imgRegexUrl.setIgnoreCase(true);
+		int descIndex=0;
+		while (imgRegexUrl.searchFrom(html, descIndex)) {			
+			descIndex = imgRegexUrl.matchedTo();
+			String fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anf&#252;hrungszeichen in (2)		
+			if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); } // falls ohne in (3)			
+			if (fetchUrl==null) {continue;} // schlechtes html
+			//  fetchUrl ist auf jeden Fall ohne Anf&#252;hrungszeichen
+			if (fetchUrl.startsWith(&quot;resource&quot;)) continue; // 
+			if (fetchUrl.startsWith(&quot;images&quot;)) // z.B. Flaggen
+				if (!fetchUrl.startsWith(&quot;images/uploads&quot;)) continue;
+			if (fetchUrl.startsWith(&quot;thumbs&quot;)) continue; // z.B. Flaggen
+			try {
+				//TODO this is not quite correct: actually the &quot;base&quot; URL must be known...
+				// but anyway a different baseURL should not happen very often  - it doesn't in my area
+				String hostname = OC.getOCHostName(holder.getWayPoint());
+				if (!fetchUrl.startsWith(&quot;<A HREF="http://">http://</A>&quot;)) {
+					fetchUrl = new URL(new URL(&quot;<A HREF="http://">http://</A>&quot; + hostname+&quot;/&quot;), fetchUrl).toString();
+				}
+			} catch (MalformedURLException e) {	continue; } // auch egal
+			ImageInfo imageInfo = new ImageInfo();
+			imageInfo.setURL(fetchUrl);
+			imageInfo.setTitle(makeTitle(imgRegexUrl.stringMatched(1), fetchUrl));
+			getPic(imageInfo);
+		}
+		
+		
+		Extractor exHref = new Extractor(html, &quot;&lt;a href=&quot;, &quot;&lt;/a&gt;&quot;, 0, true);
+		while (!exHref.endOfSearch()) {
+			String href = exHref.findNext();
+			if (href.length() &gt; 0) {
+				Extractor exHttp = new Extractor(href, &quot;<A HREF="http://">http://</A>&quot;, &quot;\&quot;&quot;, 0, true);
+				String fetchUrl = exHttp.findNext();
+				try {
+					String imgType = (fetchUrl.substring(fetchUrl.lastIndexOf('.')).toLowerCase() + &quot;    &quot;).substring(0, 4).trim();
+					fetchUrl = &quot;<A HREF="http://">http://</A>&quot; + fetchUrl.substring(0, fetchUrl.lastIndexOf('.') + imgType.length());
+					if (imgType.startsWith(&quot;.jpg&quot;) ||
+						imgType.startsWith(&quot;.bmp&quot;) ||
+						imgType.startsWith(&quot;.png&quot;) ||
+						imgType.startsWith(&quot;.gif&quot;)) {
+						ImageInfo imageInfo = new ImageInfo();
+						imageInfo.setURL(fetchUrl);
+						imageInfo.setTitle(makeTitle(href, fetchUrl));
+						getPic(imageInfo);
+					}
+				} catch (IndexOutOfBoundsException e) {
+				}
+			}
+		}
+	}
+
+	private String makeTitle(String imgTag, String fetchUrl) {
+		Regex imgRegexAlt = new Regex(&quot;(?:alt=[\&quot;\']([^&gt;^\&quot;^\']*)|alt=([^&gt;^\&quot;^\'^ ]*))&quot;);
+		imgRegexAlt.setIgnoreCase(true);
+		String imgAltText;
+		if (imgRegexAlt.search(imgTag)) {
+			imgAltText=imgRegexAlt.stringMatched(1);
+			if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);			
+		} else { // no alternative text as image title -&gt; use --- or filename
+			//wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
+			if (fetchUrl.toLowerCase().indexOf(&quot;opencaching.&quot;) &gt; 0 || fetchUrl.toLowerCase().indexOf(&quot;geocaching.com&quot;) &gt; 0) 
+				imgAltText = &quot;---&quot;; // no image title
+			else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf('/')+1);
+		}
+		return imgAltText;
+	}
 	
+	private void getPic(ImageInfo imageInfo) {
+		String fileName = holder.getWayPoint() + &quot;_&quot; + imageInfo.getURL().substring(imageInfo.getURL().lastIndexOf('/')+1);
+		fileName = Common.ClearForFileName(fileName).toLowerCase();
+		String target = profile.dataDir + fileName;
+		imageInfo.setFilename(fileName);
+		try {
+			File ftest = new FileBugfix(target);
+			if (ftest.exists()){
+				if (ftest.length() == 0) { ftest.delete(); }
+				else { holder.getCacheDetails(false).images.add(imageInfo);	}
+			}
+			else {
+				if (pref.downloadPics) {
+					UrlFetcher.fetchDataFile(imageInfo.getURL(), target);
+					ftest = new FileBugfix(target);
+					if (ftest.exists()){
+						if ( ftest.length() &gt; 0 ) {
+							holder.getCacheDetails(false).images.add(imageInfo);
+						}
+						else {
+							ftest.delete();
+						}
+					}
+				}
+			}
+		} catch (IOException e) {
+			String ErrMessage;
+			String wp, n;
+			if (holder != null &amp;&amp; holder.getWayPoint() != null) wp = holder.getWayPoint();
+			else 												wp = &quot;WP???&quot;;
+			if (holder != null &amp;&amp; holder.getCacheName() != null) n = holder.getCacheName();
+			else 												 n = &quot;name???&quot;;
+
+			if (e == null) ErrMessage = &quot;Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: &quot;+fileName+&quot; from URL:&quot;+imageInfo.getURL();
+			else {
+				if (e.getMessage().equalsIgnoreCase(&quot;could not connect&quot;) ||
+						e.getMessage().equalsIgnoreCase(&quot;unkown host&quot;)) {
+					// is there a better way to find out what happened?
+					ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;)&quot;+MyLocale.getMsg(1619,&quot;: could not download image from URL: &quot;)+imageInfo.getURL();
+				} else
+					ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;): ignoring IOException: &quot;+e.getMessage()+ &quot; while downloading picture:&quot;+fileName+&quot; from URL:&quot;+imageInfo.getURL();
+			}
+			pref.log(ErrMessage,e,true);
+		}
+
+	}
+
 	public int getHow() {
 		return doitHow;
 	}

Added: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	                        (rev 0)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -0,0 +1,93 @@
+package CacheWolf.imp;
+
+import ewe.io.File;
+import ewe.io.IOException;
+import ewe.ui.FormBase;
+import CacheWolf.Global;
+import CacheWolf.MyLocale;
+import CacheWolf.Preferences;
+import CacheWolf.Profile;
+import CacheWolf.UrlFetcher;
+import CacheWolf.utils.FileBugfix;
+
+public class OCGPXfetch {
+	static Preferences pref = Global.getPref();
+	static Profile prof = Global.getProfile();;
+	
+	public static void doIt() {
+		String hostname = pref.lastOCSite;
+		Boolean oldDownloadAllOC=pref.downloadAllOC;
+		Boolean onlyListedAtOC = false;
+		OCXMLImporterScreen importOpt = new OCXMLImporterScreen(
+				MyLocale.getMsg(130,&quot;Download from opencaching&quot;),
+				OCXMLImporterScreen.IMAGES|
+				OCXMLImporterScreen.ALL|
+				OCXMLImporterScreen.HOST);
+		importOpt.missingCheckBox.setText(MyLocale.getMsg(164,&quot;only listed at OC&quot;));
+		importOpt.missingCheckBox.setState(onlyListedAtOC);
+		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
+		onlyListedAtOC=pref.downloadAllOC;
+		pref.downloadAllOC=oldDownloadAllOC;
+		if (importOpt.domains.getSelectedItem()!=null) {
+			hostname = (String)importOpt.domains.getSelectedItem();
+			pref.lastOCSite=hostname;
+		}
+
+		try {
+			String address=&quot;<A HREF="http://">http://</A>&quot;+hostname+&quot;/search.php?&quot;;
+			address+=&quot;searchto=searchbyfinder&quot;; // searchbydistance
+			address+=&quot;&amp;showresult=1&amp;expert=0&amp;sort=bydistance&amp;orderRatingFirst=0&quot;;
+			address+=&quot;&amp;f_userowner=0&amp;f_userfound=0&amp;f_inactive=0&amp;f_ignored=0&quot;;
+			address+=&quot;&amp;f_otherPlatforms=&quot;; // 0 = all 1 = nur OC
+			if (onlyListedAtOC)
+				address+=&quot;1&quot;;
+			else 
+				address+=&quot;0&quot;; 
+			address+=&quot;&amp;country=&amp;difficultymin=0&amp;difficultymax=0&amp;terrainmin=0&amp;terrainmax=0&amp;cachetype=1;2;3;4;5;6;7;8;9;10&amp;cachesize=1;2;3;4;5;6;7&amp;cache_attribs=&amp;cache_attribs_not=&quot;;
+			address+=&quot;&amp;logtype=1,7&quot;;
+			address+=&quot;&amp;utf8=1&amp;output=gpx&amp;zip=1&quot;;
+			address+=&quot;&amp;count=max&quot;;
+			address+=&quot;&amp;finder=&quot;+pref.myAlias;
+			String tmpFile=prof.dataDir + &quot;dummy.zip&quot;;
+			UrlFetcher.fetchDataFile(address, tmpFile);
+			File ftmp = new FileBugfix(tmpFile);
+			if (ftmp.exists() &amp;&amp; ftmp.length()&gt;0) {
+				GPXImporter gpx = new GPXImporter(pref, prof, tmpFile);
+				int withPics = GPXImporter.DOIT_NOSPOILER;
+				if (pref.downloadPics) {
+					withPics=GPXImporter.DOIT_WITHSPOILER;
+				}			
+				gpx.doIt(withPics);
+			}
+			ftmp.delete();
+		} catch (IOException e) {
+		}
+	}
+	
+	private static boolean login() {
+		boolean loggedIn = false;
+		String page;
+		try {
+			String loginDaten=&quot;target=myhome.php&amp;action=login&amp;email=&quot;+pref.myAlias+&quot;&amp;password=&quot;+pref.password;
+			try {
+				UrlFetcher.setpostData(loginDaten);
+				UrlFetcher.setMaxRedirections(1);
+				UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/login.php">http://www.opencaching.de/login.php</A>&quot;);
+			} catch (IOException e) {
+				if (e.getMessage().startsWith(&quot;too many http redirections&quot;)) {
+					String cookie = (String) UrlFetcher.getDocumentProperties().getValue(&quot;Set-Cookie&quot;,&quot;&quot;);
+					UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;,cookie);
+					page=UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/login.php?action=cookieverify&amp;target=myhome.php">http://www.opencaching.de/login.php?action=cookieverify&amp;target=myhome.php</A>&quot;);
+					page=UrlFetcher.fetch(&quot;<A HREF="http://www.opencaching.de/myhome.php">http://www.opencaching.de/myhome.php</A>&quot;);
+					// control , that I am logged in
+					// (by ?) get finderid ?
+					// todo set language ?
+					loggedIn = page.indexOf(&quot;Eingeloggt als&quot;) &gt; -1;
+				}
+			}			
+		} catch (IOException e) {
+			pref.log(&quot;Fehler&quot;, e);
+		}
+		return loggedIn;
+	}
+}

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -48,7 +48,6 @@
 
 import ewe.io.BufferedReader;
 import ewe.io.File;
-import ewe.io.FileOutputStream;
 import ewe.io.IO;
 import ewe.io.IOException;
 import ewe.io.InputStreamReader;
@@ -60,8 +59,6 @@
 import ewe.sys.Vm;
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
-import ewe.util.ByteArray;
-import ewe.util.CharArray;
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.zip.ZipEntry;
@@ -126,6 +123,7 @@
 		pref = p;
 		profile=prof;
 		cacheDB = profile.cacheDB;
+		incUpdate=true;
 		if(profile.getLast_sync_opencaching() == null ||
 				profile.getLast_sync_opencaching().length() &lt; 12){
 			profile.setLast_sync_opencaching(&quot;20050801000000&quot;);
@@ -136,7 +134,6 @@
 		for(int i = 0; i&lt;cacheDB.size();i++){
 			ch = cacheDB.get(i);
 			if (!ch.getOcCacheID().equals(&quot;&quot;))
-				//DBindexID.put(ch.getOcCacheID(), (Integer)i);
 				DBindexID.put(ch.getOcCacheID(), ch.getWayPoint());
 		}//for
 
@@ -149,6 +146,7 @@
 	 * @return true, if some change was made to the cacheDB
 	 */
 	public boolean syncSingle(int number, InfoBox infB) {
+
 		CacheHolder ch;
 		ch = cacheDB.get(number);
 		hostname=OC.getOCHostName(ch.getWayPoint());
@@ -168,10 +166,11 @@
 		/** pref.downloadmissingOC = true, if not the last syncdate shall be used,
 		 *  but the caches shall be reloaded
 		 *  only used in syncSingle  */
-		if (pref.downloadMissingOC)  lastS = &quot;20050801000000&quot;;
+		incUpdate = false;
+		if (pref.downloadAllOC)  lastS = &quot;20050801000000&quot;;
 		else {
 			if (ch.getLastSync().length() &lt; 14) lastS = &quot;20050801000000&quot;;
-			else lastS = ch.getLastSync();
+			else { lastS = ch.getLastSync(); incUpdate=true; }
 		}
 		dateOfthisSync = new Time();
 		dateOfthisSync.parse(lastS, &quot;yyyyMMddHHmmss&quot;);
@@ -231,8 +230,8 @@
 		distDouble.value = Common.parseDouble(dist);
 		dist = distDouble.toString(0, 1, 0).replace(',', '.');
 		//check, if distance is greater than before
-		if (Convert.toInt(dist) &gt; Convert.toInt(profile.getDistOC()) ||
-				pref.downloadMissingOC  ){
+		incUpdate = true;
+		if (Convert.toInt(dist) &gt; Convert.toInt(profile.getDistOC()) ||	pref.downloadAllOC  ){
 			// resysnc
 			lastS = &quot;20050801000000&quot;;
 			incUpdate = false;
@@ -284,7 +283,7 @@
 		inf.addOkButton();
 	}
 
-	private boolean syncOC(String url) {
+	private boolean syncOC(String address) {
 		boolean success=true;
 		File tmpFile = null;
 		BufferedReader r;
@@ -295,16 +294,16 @@
 		String finalMessage = &quot;&quot;;
 		try{
 			holder = null;
-			pref.log(url+&quot;fetching&quot;);
-			String file = fetch(url, &quot;dummy&quot;);
+			String target = profile.dataDir + &quot;dummy.zip&quot;;
+			UrlFetcher.fetchDataFile(address, target);
 
 			//parse
-			tmpFile = new FileBugfix(profile.dataDir + file);
+			tmpFile = new FileBugfix(target);
 			if (tmpFile.getLength() == 0 ) {
 				throw new IOException(&quot;no updates available&quot;);
 			}
 
-			ZipFile zif = new ZipFile (profile.dataDir + file);
+			ZipFile zif = new ZipFile (target);
 			ZipEntry zipEnt;
 			Enumeration zipEnum = zif.entries();
 			inf.setInfo(&quot;...unzipping update file&quot;);
@@ -418,6 +417,7 @@
 	private void startCache(String name, AttributeList atts){
 		if(name.equals(&quot;id&quot;)){
 			cacheID = atts.getValue(&quot;id&quot;);
+			return;
 		}
 		if (holder==null) return;
 		inf.setInfo(MyLocale.getMsg(1609,&quot;Importing Cache:&quot;)+&quot; &quot; + numCacheImported + &quot; / &quot; + numCacheUpdated + &quot;\n&quot;);
@@ -480,8 +480,10 @@
 
 	private void startCacheDesc(String name, AttributeList atts){
 		inf.setInfo(MyLocale.getMsg(1611,&quot;Importing cache description:&quot;)+&quot; &quot; + numDescImported);
+
 		if (name.equals(&quot;cacheid&quot;)){
 			cacheID = atts.getValue(&quot;id&quot;);
+			holder = getHolder(cacheID, false);
 			return;
 		}
 
@@ -496,15 +498,18 @@
 		}
 	}
 
-	private void startPicture(String name, AttributeList atts){
-	}
-
 	private void startCacheLog(String name, AttributeList atts){
 		if (name.equals(&quot;id&quot;)){
 			logId = atts.getValue(&quot;id&quot;);
 			return;
 		}
+
+		if (name.equals(&quot;cacheid&quot;)){
+			holder = getHolder(atts.getValue(&quot;id&quot;), false);
+			return;
+		}
 		if (holder==null) return;
+
 		inf.setInfo(MyLocale.getMsg(1612,&quot;Importing Cachlog:&quot;)+&quot; &quot; + numLogImported);
 		
 		if (name.equals(&quot;logtype&quot;)){
@@ -525,10 +530,19 @@
 		}
 	}
 
+	private void startPicture(String name, AttributeList atts){
+		if (name.equals(&quot;object&quot;)){
+			cacheID = atts.getValue(&quot;id&quot;); // are there picture without cacheID?
+			holder = getHolder(cacheID, false);
+			return;
+		}
+	}
+
 	private void endCache(String name){
 		if(name.equals(&quot;id&quot;)){ // &lt;/id&gt;
-			holder = getHolder(strData, true); // Allocate a new CacheHolder object
-			holder.setOcCacheID(strData);
+			// the guid (=strData) is not part of gpx , so we use id of cacheID
+			holder = getHolder(cacheID, true); // Allocate a new CacheHolder object
+			holder.setOcCacheID(cacheID); 
 			holder.getCacheDetails(false).URL = &quot;<A HREF="http://">http://</A>&quot; + hostname + &quot;/viewcache.php?cacheid=&quot; + cacheID;
 			return;
 		}
@@ -541,7 +555,6 @@
 				numCacheImported++;
 				holder.setNew(true);
 				cacheDB.add(holder);
-				//DBindexID.put(holder.getOcCacheID(), (Integer)cacheDB.size()-1);
 				DBindexID.put(holder.getOcCacheID(), holder.getWayPoint());
 			}
 			// update (overwrite) data
@@ -550,12 +563,10 @@
 				holder.setNew(false);
 				holder.setIncomplete(false);
 				cacheDB.get(index).update(holder);
-				// save ocCacheID, in case, the previous data is from GPX
-				// DBindexID.put(holder.getOcCacheID(), (Integer)index);
 				DBindexID.put(holder.getOcCacheID(), holder.getWayPoint());
 			}
 			// clear data (picture, logs) if we do a complete Update
-			if (incUpdate == false){
+			if (! incUpdate){
 				holder.getCacheDetails(false).CacheLogs.clear();
 				holder.getCacheDetails(false).images.clear();
 			}
@@ -607,43 +618,12 @@
 	}
 
 	private void endCacheDesc(String name){
-		if (name.equals(&quot;cacheid&quot;)){
-			holder = getHolder(strData, false);
-			return;
-		}
 		if (holder == null) return;
 		if (name.equals(&quot;cachedesc&quot;)){
 			 numDescImported++;
 			 holder.setHTML(isHTML);
 			if (pref.downloadPics &amp;&amp; isHTML) {
-				String fetchUrl, imgTag, imgAltText;
-				Regex imgRegexUrl = new Regex(&quot;(&lt;img[^&gt;]*src=[\&quot;\']([^&gt;^\&quot;^\']*)[^&gt;]*&gt;|&lt;img[^&gt;]*src=([^&gt;^\&quot;^\'^ ]*)[^&gt;]*&gt;)&quot;); //  Ergebnis enthlt keine Anfhrungszeichen
-				Regex imgRegexAlt = new Regex(&quot;(?:alt=[\&quot;\']([^&gt;^\&quot;^\']*)|alt=([^&gt;^\&quot;^\'^ ]*))&quot;); // get alternative text for Pic
-				imgRegexAlt.setIgnoreCase(true);
-				imgRegexUrl.setIgnoreCase(true);
-				int descIndex=0;
-				int numDownloaded=1;
-				while (imgRegexUrl.searchFrom(holder.getCacheDetails(false).LongDescription, descIndex)) { // &quot;img&quot; found
-					imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte &lt;img ...&gt;-tag
-					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen
-					if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
-					if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
-						inf.addWarning(MyLocale.getMsg(1617, &quot;Ignoriere Fehler in html-Cache-Description: \&quot;&lt;img\&quot; without \&quot;src=\&quot; in cache &quot;+holder.getWayPoint()));
-						continue;
-					}
-					inf.setInfo(MyLocale.getMsg(1611,&quot;Importing cache description:&quot;)+&quot; &quot; + numDescImported + &quot;\n&quot;+MyLocale.getMsg(1620, &quot;downloading embedded images: &quot;) + numDownloaded++);
-					if (imgRegexAlt.search(imgTag)) {
-						imgAltText=imgRegexAlt.stringMatched(1);
-						if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
-						// no alternative text as image title -&gt; use filename
-					} else {
-						if (fetchUrl.toLowerCase().indexOf(&quot;opencaching.&quot;) &gt; 0 || fetchUrl.toLowerCase().indexOf(&quot;geocaching.com&quot;) &gt; 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
-							imgAltText = &quot;No image title&quot;;
-						else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf('/')+1);
-					}
-					descIndex = imgRegexUrl.matchedTo();
-					getPic(fetchUrl, imgAltText);
-				}
+				getImageNamesFromDescription();
 			}
 			holder.getCacheDetails(false).hasUnsavedChanges = true;
 			return;
@@ -677,97 +657,7 @@
 		}
 	}
 
-	private String createPicFilename(String fetchURL) {
-		String fileName = holder.getWayPoint() + &quot;_&quot; + fetchURL.substring(fetchURL.lastIndexOf('/')+1);
-		return Common.ClearForFileName(fileName).toLowerCase();
-	}
-
-	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs
-		try {
-			//TODO this is not quite correct: actually the &quot;base&quot; URL must be known...
-			// but anyway a different baseURL should not happen very often  - it doesn't in my area
-			if (!fetchURL.startsWith(&quot;<A HREF="http://">http://</A>&quot;)) {
-				fetchURL = new URL(new URL(&quot;<A HREF="http://">http://</A>&quot; + hostname+&quot;/&quot;), fetchURL).toString();
-			}
-			String fileName = createPicFilename(fetchURL);
-			ImageInfo imageInfo = new ImageInfo();
-			imageInfo.setURL(fetchURL);
-			// add title
-			imageInfo.setTitle(picDesc);
-			holder.getCacheDetails(false).images.add(imageInfo);
-			try {
-				File ftest = new FileBugfix(profile.dataDir + fileName);
-				if (ftest.exists()){
-					imageInfo.setFilename(fileName);
-				}
-				else {
-					if (pref.downloadPics) {
-						imageInfo.setFilename(fetch(fetchURL, fileName));
-					}
-				}
-			} catch (IOException e) {
-				String ErrMessage;
-				String wp, n;
-				if (holder != null &amp;&amp; holder.getWayPoint() != null) wp = holder.getWayPoint();
-				else 												wp = &quot;WP???&quot;;
-				if (holder != null &amp;&amp; holder.getCacheName() != null) n = holder.getCacheName();
-				else 												 n = &quot;name???&quot;;
-
-				if (e == null) ErrMessage = &quot;Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: &quot;+fileName+&quot; from URL:&quot;+fetchURL;
-				else {
-					if (e.getMessage().equalsIgnoreCase(&quot;could not connect&quot;) ||
-							e.getMessage().equalsIgnoreCase(&quot;unkown host&quot;)) {
-						// is there a better way to find out what happened?
-						ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;)&quot;+MyLocale.getMsg(1619,&quot;: could not download image from URL: &quot;)+fetchURL;
-					} else
-						ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;): ignoring IOException: &quot;+e.getMessage()+ &quot; while downloading picture:&quot;+fileName+&quot; from URL:&quot;+fetchURL;
-				}
-				inf.addWarning(&quot;\n&quot;+ErrMessage);
-				pref.log(ErrMessage,e,true);
-			}
-		} catch (MalformedURLException e) {
-			String ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;) + holder.getWayPoint() + &quot;: ignoring MalformedUrlException: &quot; + e.getMessage()+ &quot; while downloading from URL:&quot; + fetchURL;
-			inf.addWarning(&quot;\n&quot;+ErrMessage);
-			pref.log(ErrMessage,e);
-		}
-
-	}
-
-
-	private void endPicture(String name){
-		if(name.equals(&quot;object&quot;)){
-			holder = getHolder(strData, false);
-			return;
-		}
-		if (holder == null) return;
-
-		if(name.equals(&quot;id&quot;)){
-			picID = strData;
-			return;
-		}
-
-		if (name.equals(&quot;url&quot;)){
-			picUrl = strData;
-			return;
-		}
-		if (name.equals(&quot;title&quot;)){
-			picTitle = strData;
-			return;
-		}
-		if(name.equals(&quot;picture&quot;)){
-			inf.setInfo(MyLocale.getMsg(1613,&quot;Pictures:&quot;)+&quot; &quot; + ++picCnt);
-			//String fileName = holder.wayPoint + &quot;_&quot; + picUrl.substring(picUrl.lastIndexOf(&quot;/&quot;)+1);
-			getPic(picUrl,picTitle);
-			holder.getCacheDetails(false).hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
-			return;
-		}
-	}
-
 	private void endCacheLog(String name){
-		if (name.equals(&quot;cacheid&quot;)){
-			holder = getHolder(strData, false);
-			return;
-		}
 		if (holder == null) return;
 		if (name.equals(&quot;cachelog&quot;)){ // &lt;/cachelog&gt;
 			if (holder.getCacheDetails(false).CacheLogs.merge(new Log(logIcon, logDate, logFinder, logData, loggerRecommended))&gt; -1) {
@@ -811,14 +701,32 @@
 
 	}
 
-	private String fetch(String addr, String fileName ) throws IOException
-	{
-		CharArray realurl = new CharArray();
-		ByteArray daten = UrlFetcher.fetchByteArray(addr, realurl);
-		FileOutputStream outp =  new FileOutputStream(profile.dataDir + fileName);
-		outp.write(daten.toBytes());
-		outp.close();
-		return fileName;
+	private void endPicture(String name){
+		if (holder == null) return;
+
+		if(name.equals(&quot;id&quot;)){
+			picID = strData;
+			return;
+		}
+
+		if (name.equals(&quot;url&quot;)){
+			picUrl = strData;
+			return;
+		}
+		if (name.equals(&quot;title&quot;)){
+			picTitle = strData;
+			return;
+		}
+		if(name.equals(&quot;picture&quot;)){
+			inf.setInfo(MyLocale.getMsg(1613,&quot;Pictures:&quot;)+&quot; &quot; + ++picCnt);
+			//String fileName = holder.wayPoint + &quot;_&quot; + picUrl.substring(picUrl.lastIndexOf(&quot;/&quot;)+1);
+			ImageInfo ii = new ImageInfo();
+			ii.setTitle(picTitle);
+			ii.setURL(picUrl);
+			getPic(ii);
+			holder.getCacheDetails(false).hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
+			return;
+		}
 	}
 
 	private CacheHolder getHolder(String guid, boolean create){// See also LOCXMLImporter
@@ -835,4 +743,101 @@
 		return ch;
 	}
 
+	
+	private void getImageNamesFromDescription() {
+		String fetchUrl;
+		String imgTag;
+		String imgAltText;
+		Regex imgRegexUrl = new Regex(&quot;(&lt;img[^&gt;]*src=[\&quot;\']([^&gt;^\&quot;^\']*)[^&gt;]*&gt;|&lt;img[^&gt;]*src=([^&gt;^\&quot;^\'^ ]*)[^&gt;]*&gt;)&quot;); //  Ergebnis enthlt keine Anfhrungszeichen
+		Regex imgRegexAlt = new Regex(&quot;(?:alt=[\&quot;\']([^&gt;^\&quot;^\']*)|alt=([^&gt;^\&quot;^\'^ ]*))&quot;); // get alternative text for Pic
+		imgRegexAlt.setIgnoreCase(true);
+		imgRegexUrl.setIgnoreCase(true);
+		int descIndex=0;
+		int numDownloaded=1;
+		while (imgRegexUrl.searchFrom(holder.getCacheDetails(false).LongDescription, descIndex)) { // &quot;img&quot; found
+			imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte &lt;img ...&gt;-tag
+			fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen
+			if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
+			if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
+				inf.addWarning(MyLocale.getMsg(1617, &quot;Ignoriere Fehler in html-Cache-Description: \&quot;&lt;img\&quot; without \&quot;src=\&quot; in cache &quot;+holder.getWayPoint()));
+				continue;
+			}
+			inf.setInfo(MyLocale.getMsg(1611,&quot;Importing cache description:&quot;)+&quot; &quot; + numDescImported + &quot;\n&quot;+MyLocale.getMsg(1620, &quot;downloading embedded images: &quot;) + numDownloaded++);
+			if (imgRegexAlt.search(imgTag)) {
+				imgAltText=imgRegexAlt.stringMatched(1);
+				if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
+				// no alternative text as image title -&gt; use filename
+			} else {
+				if (fetchUrl.toLowerCase().indexOf(&quot;opencaching.&quot;) &gt; 0 || fetchUrl.toLowerCase().indexOf(&quot;geocaching.com&quot;) &gt; 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
+					imgAltText = &quot;No image title&quot;;
+				else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf('/')+1);
+			}
+			descIndex = imgRegexUrl.matchedTo();
+			try {
+				//TODO this is not quite correct: actually the &quot;base&quot; URL must be known...
+				// but anyway a different baseURL should not happen very often  - it doesn't in my area
+				if (!fetchUrl.startsWith(&quot;<A HREF="http://">http://</A>&quot;)) {
+					fetchUrl = new URL(new URL(&quot;<A HREF="http://">http://</A>&quot; + hostname+&quot;/&quot;), fetchUrl).toString();
+				}
+			} catch (MalformedURLException e) {			
+				String ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;) + holder.getWayPoint() + &quot;: ignoring MalformedUrlException: &quot; + e.getMessage()+ &quot; while downloading from URL:&quot; + fetchUrl;
+				inf.addWarning(&quot;\n&quot;+ErrMessage);
+				pref.log(ErrMessage,e);
+			}
+			ImageInfo imageInfo = new ImageInfo();
+			imageInfo.setURL(fetchUrl);
+			imageInfo.setTitle(imgAltText);
+			getPic(imageInfo);
+		}
+	}
+
+	
+	private void getPic(ImageInfo imageInfo) { // TODO handling of relativ URLs		
+		String fileName = holder.getWayPoint() + &quot;_&quot; + imageInfo.getURL().substring(imageInfo.getURL().lastIndexOf('/')+1);
+		fileName = Common.ClearForFileName(fileName).toLowerCase();
+		String target = profile.dataDir + fileName;
+		imageInfo.setFilename(fileName);
+		try {
+			File ftest = new FileBugfix(target);
+			if (ftest.exists()){
+				if (ftest.length() == 0) { ftest.delete(); }
+				else { holder.getCacheDetails(false).images.add(imageInfo);	}
+			}
+			else {
+				if (pref.downloadPics) {
+					UrlFetcher.fetchDataFile(imageInfo.getURL(), target);
+					ftest = new FileBugfix(target);
+					if (ftest.exists()){
+						if ( ftest.length() &gt; 0 ) {
+							holder.getCacheDetails(false).images.add(imageInfo);
+						}
+						else {
+							ftest.delete();
+						}
+					}
+				}
+			}
+		} catch (IOException e) {
+			String ErrMessage;
+			String wp, n;
+			if (holder != null &amp;&amp; holder.getWayPoint() != null) wp = holder.getWayPoint();
+			else 												wp = &quot;WP???&quot;;
+			if (holder != null &amp;&amp; holder.getCacheName() != null) n = holder.getCacheName();
+			else 												 n = &quot;name???&quot;;
+
+			if (e == null) ErrMessage = &quot;Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: &quot;+fileName+&quot; from URL:&quot;+imageInfo.getURL();
+			else {
+				if (e.getMessage().equalsIgnoreCase(&quot;could not connect&quot;) ||
+						e.getMessage().equalsIgnoreCase(&quot;unkown host&quot;)) {
+					// is there a better way to find out what happened?
+					ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;)&quot;+MyLocale.getMsg(1619,&quot;: could not download image from URL: &quot;)+imageInfo.getURL();
+				} else
+					ErrMessage = MyLocale.getMsg(1618,&quot;Ignoring error in cache: &quot;)+ n + &quot; (&quot;+wp+&quot;): ignoring IOException: &quot;+e.getMessage()+ &quot; while downloading picture:&quot;+fileName+&quot; from URL:&quot;+imageInfo.getURL();
+			}
+			inf.addWarning(&quot;\n&quot;+ErrMessage);
+			pref.log(ErrMessage,e,true);
+		}
+
+	}
+	
 }

Modified: trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -205,7 +205,7 @@
 		if((options &amp; ALL) &gt; 0){
 			missingCheckBox = new mCheckBox();
 			missingCheckBox.setText(MyLocale.getMsg(1606,&quot;Alle erneut downloaden&quot;));
-			missingCheckBox.setState(pref.downloadMissingOC);
+			missingCheckBox.setState(pref.downloadAllOC);
 			this.addLast(missingCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
 		}
 
@@ -240,7 +240,7 @@
 			}
 			if (ev.target == okB){
 				    // distOC wird hier noch nicht in Pref eingetragen, damit noch gepr&#252;ft werden kann, ob es gr&#246;&#223;er oder kleiner ist als vorher
-					if (missingCheckBox!=null) pref.downloadMissingOC = missingCheckBox.state;
+					if (missingCheckBox!=null) pref.downloadAllOC = missingCheckBox.state;
 					if (imagesCheckBox!=null) pref.downloadPics = imagesCheckBox.state;
 					if (travelbugsCheckBox!=null) pref.downloadTBs = travelbugsCheckBox.state;
 					if (maxLogsInput!=null) pref.maxLogsToSpider=Common.parseInt(maxLogsInput.getText());

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -48,6 +48,7 @@
 import CacheWolf.STRreplace;
 import CacheWolf.SafeXML;
 import CacheWolf.Travelbug;
+import CacheWolf.UrlFetcher;
 import CacheWolf.navi.Area;
 import CacheWolf.navi.Metrics;
 import CacheWolf.navi.MovingMap;
@@ -67,7 +68,6 @@
 import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.InputStreamReader;
-import ewe.io.JavaUtf8Codec;
 import ewe.net.Socket;
 import ewe.net.URL;
 import ewe.net.UnknownHostException;
@@ -77,7 +77,6 @@
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
 import ewe.util.ByteArray;
-import ewe.util.CharArray;
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.Properties;
@@ -115,8 +114,7 @@
 	private static Preferences pref;
 	private Profile profile;
 
-	private static String cookieID = &quot;&quot;;
-	private static String cookieSession = &quot;&quot;;
+	private static String cookie = &quot;&quot;;
 	private static double minDistance = 0;
 	private static double maxDistance = 0;
 	private static String direction = &quot;&quot;;
@@ -182,10 +180,8 @@
 	private int numPrivate = 0;
 	private int page_number = 1;
 	private int num_added = 0;
-	
-	private static HttpConnection conn;
 
-	public SpiderGC(Preferences prf, Profile profile, boolean bypass) {
+	public SpiderGC(Preferences prf, Profile profile) {
 		this.profile = profile;
 		this.cacheDB = profile.cacheDB;
 		pref = prf;
@@ -233,9 +229,7 @@
 					+ &quot;with Founds       : &quot; + (doNotgetFound ? &quot;no&quot; : &quot;yes&quot;)
 					+ Preferences.NEWLINE + &quot;alias is premium m: &quot;
 					+ (!pref.isPremium ? &quot;no&quot; : &quot;yes&quot;) + Preferences.NEWLINE
-					+ &quot;Update if new Logs: &quot; + (!pref.checkLog ? &quot;no&quot; : &quot;yes&quot;) + Preferences.NEWLINE
-					+ &quot;Update if TB change: &quot; + (!pref.checkTBs ? &quot;no&quot; : &quot;yes&quot;) + Preferences.NEWLINE
-					+ &quot;Update if DTS change: &quot; + (!pref.checkDTS ? &quot;no&quot; : &quot;yes&quot;)
+					+ &quot;Update if new Logs: &quot; + (!pref.checkLog ? &quot;no&quot; : &quot;yes&quot;)
 					+ Preferences.NEWLINE, null);
 
 			Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
@@ -1182,7 +1176,7 @@
 		localInfB.exec();
 		try {
 			String doc = p.getProp(&quot;waypoint&quot;) + wayPoint;
-			completeWebPage = fetchText(doc, false);
+			completeWebPage = UrlFetcher.fetch(doc);
 			pref.log(&quot;Fetched &quot; + wayPoint);
 		} catch (Exception ex) {
 			localInfB.close(0);
@@ -1204,19 +1198,22 @@
 	 * displayed.
 	 */
 	private int login() {
-		String passwort = pref.password;
+		if (cookie.length() &gt; 0) 
+			UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;, cookie);
+		else
+			UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;, null);
 		loggedIn = false;
-		String loginPage, loginPageUrl, loginSuccess, nextPage;
+		String loginPage, loginPageUrl, loginSuccess;
 		try {
 			loginPageUrl = p.getProp(&quot;loginPage&quot;);
 			loginSuccess = p.getProp(&quot;loginSuccess&quot;);
-			nextPage = p.getProp(&quot;nextPage&quot;);
 		} catch (Exception ex) { // Tag not found in spider.def
 			return ERR_LOGIN;
 		}
-		// Get password
-		InfoBox localInfB = new InfoBox(MyLocale.getMsg(5506, &quot;Password&quot;),
-				MyLocale.getMsg(5505, &quot;Enter Password&quot;), InfoBox.INPUT);
+
+		// **0 Get password
+		String passwort = pref.password;
+		InfoBox localInfB = new InfoBox(MyLocale.getMsg(5506, &quot;Password&quot;),MyLocale.getMsg(5505, &quot;Enter Password&quot;), InfoBox.INPUT);
 		localInfB.feedback.setText(passwort);
 		localInfB.feedback.isPassword = true;
 		int code = FormBase.IDOK;
@@ -1225,15 +1222,14 @@
 			passwort = localInfB.getInput();
 		}
 		localInfB.close(0);
-		if (code != FormBase.IDOK)
-			return code;
-		// Now start the login proper
+		if (code != FormBase.IDOK) return code;
+		
+		// **1 now we have user and password for login
 		localInfB = new InfoBox(MyLocale.getMsg(5507, &quot;Status&quot;), MyLocale.getMsg(5508, &quot;Logging in...&quot;));
 		localInfB.exec();
 		try {
-			// Access the page once to get a viewstate
-			loginPage = fetchText(loginPageUrl, false); // <A HREF="http://www.geocaching.com/login/Default.aspx">http://www.geocaching.com/login/Default.aspx</A>
-			pref.log(&quot;[login]:Fetched login page &quot; + loginPageUrl);
+			// &quot;<A HREF="http://www.geocaching.com/login/default.aspx?RESETCOMPLETE=Y">http://www.geocaching.com/login/default.aspx?RESETCOMPLETE=Y</A>&quot; | loginPageUrl
+			loginPage = UrlFetcher.fetch(loginPageUrl); // <A HREF="http://www.geocaching.com/login/Default.aspx">http://www.geocaching.com/login/Default.aspx</A>
 			if (loginPage.equals(&quot;&quot;)) {
 				localInfB.close(0);
 				(new MessageBox(MyLocale.getMsg(5500, &quot;Error&quot;),
@@ -1250,64 +1246,105 @@
 			pref.log(&quot;[login]:Could not fetch: gc.com login page&quot;, ex);
 			return ERR_LOGIN;
 		}
-		if (!localInfB.isClosed) { // If user has not aborted, we continue
-			Regex rexCookieID = new Regex(&quot;(?i)Set-Cookie: userid=(.*?);.*&quot;);
-			Regex rexViewstate = new Regex(
-					&quot;id=\&quot;__VIEWSTATE\&quot; value=\&quot;(.*?)\&quot; /&gt;&quot;);
-			// Regex rexViewstate1 = new
-			// Regex(&quot;id=\&quot;__VIEWSTATE1\&quot; value=\&quot;(.*?)\&quot; /&gt;&quot;);
-			// Regex rexEventvalidation = new
-			// Regex(&quot;id=\&quot;__EVENTVALIDATION\&quot; value=\&quot;(.*?)\&quot; /&gt;&quot;);
-			Regex rexCookieSession = new Regex(
-					&quot;(?i)Set-Cookie: ASP.NET_SessionId=(.*?);.*&quot;);
-			String viewstate = &quot;&quot;;
-			rexViewstate.search(loginPage);
-			if (rexViewstate.didMatch()) {
-				viewstate = rexViewstate.stringMatched(1);
-			} else {
-				pref.log(&quot;[login]:rexViewstate not found before login&quot;, null);
+		
+		// **2 now we can check the loginpage if logged in else log in
+		if (!localInfB.isClosed) {
+			if (loginPage.indexOf(loginSuccess) &gt; 0)  {
+				if (loginPage.indexOf(pref.myAlias) &gt; 0) {
+					loggedIn = true;
+					// assume language is already set to EN
+					pref.log(&quot;[login]:Already logged in as &quot; + pref.myAlias);
+				}
+				else {
+					// it is another user, whom we should logout
+					try {
+						loginPage = UrlFetcher.fetch(&quot;<A HREF="http://www.geocaching.com/login/default.aspx?RESETCOMPLETE=Y">http://www.geocaching.com/login/default.aspx?RESETCOMPLETE=Y</A>&quot;);						
+					} catch (Exception ex) {
+						localInfB.close(0);
+						(new MessageBox(MyLocale.getMsg(5500, &quot;Error&quot;),
+								MyLocale.getMsg(5499, &quot;Error loading login page.%0aPlease check your internet connection.&quot;),
+								FormBase.OKB)).execute();
+						pref.log(&quot;[login]:Could not fetch: gc.com login page&quot;, ex);
+						return ERR_LOGIN;
+					}
+					
+				}
 			}
-
-			if (loginPage.indexOf(loginSuccess) &gt; 0)
-				pref.log(&quot;[login]:Already logged in&quot; + pref.myAlias);
-			else {
-				/*
-				 * rexEventvalidation.search(loginPage);
-				 * if(rexEventvalidation.didMatch()){ // eventvalidation =
-				 * rexEventvalidation.stringMatched(1); } else
-				 * pref.log(&quot;[login]:rexEventvalidation not found before login&quot;
-				 * ,null); //Ok now login!
-				 */
+			if (!loggedIn)
+				{
 				try {
+					Regex rexViewstate = new Regex(&quot;id=\&quot;__VIEWSTATE\&quot; value=\&quot;(.*?)\&quot; /&gt;&quot;);
+					String viewstate = &quot;&quot;;
+					rexViewstate.search(loginPage);
+					if (rexViewstate.didMatch()) {
+						viewstate = rexViewstate.stringMatched(1);
+					} else {
+						pref.log(&quot;[login]:__VIEWSTATE not found (before login): no login possible.&quot;, null);
+						// we need the __VIEWSTATE for sending loginData, so we should abort here
+						return ERR_LOGIN;
+					}
 					StringBuffer sb = new StringBuffer(1000);
-					sb.append(URL.encodeURL(&quot;__VIEWSTATE&quot;, false));
-					sb.append(&quot;=&quot;);
-					sb.append(URL.encodeURL(viewstate, false));
+					sb.append(&quot;__VIEWSTATE=&quot;+URL.encodeURL(viewstate, false));
 					sb.append(&quot;&amp;ctl00%24ContentBody%24&quot;);
-					sb.append(URL.encodeURL(&quot;myUsername&quot;, false));
-					sb.append(&quot;=&quot;);
-					sb.append(encodeUTF8URL(Utils
-							.encodeJavaUtf8String(pref.myAlias)));
+					sb.append(&quot;myUsername=&quot;+encodeUTF8URL(Utils.encodeJavaUtf8String(pref.myAlias)));
 					sb.append(&quot;&amp;ctl00%24ContentBody%24&quot;);
-					sb.append(URL.encodeURL(&quot;myPassword&quot;, false));
-					sb.append(&quot;=&quot;);
-					sb.append(encodeUTF8URL(Utils
-							.encodeJavaUtf8String(passwort)));
+					sb.append(&quot;myPassword=&quot;+encodeUTF8URL(Utils.encodeJavaUtf8String(passwort)));
 					sb.append(&quot;&amp;ctl00%24ContentBody%24&quot;);
-					sb.append(URL.encodeURL(&quot;cookie&quot;, false));
-					sb.append(&quot;=&quot;);
-					sb.append(URL.encodeURL(&quot;on&quot;, false));
+					sb.append(&quot;cookie=on&quot;);
 					sb.append(&quot;&amp;ctl00%24ContentBody%24&quot;);
-					sb.append(URL.encodeURL(&quot;Button1&quot;, false));
-					sb.append(&quot;=&quot;);
-					sb.append(URL.encodeURL(&quot;Login&quot;, false));
-					// sb.append(&quot;&amp;&quot;);
-					// sb.append(URL.encodeURL(&quot;__EVENTVALIDATION&quot;,false));
-					// sb.append(&quot;=&quot;);
-					// sb.append(URL.encodeURL(eventvalidation,false));
-					loginPage = fetch_post(loginPageUrl, sb.toString(), true);
-					if (loginPage.indexOf(loginSuccess) &gt; 0)
+					sb.append(&quot;Button1=Login&quot;);
+					UrlFetcher.setpostData(sb.toString());
+					loginPage = UrlFetcher.fetch(loginPageUrl);
+					if (loginPage.indexOf(loginSuccess) &gt; 0) {
 						pref.log(&quot;Login successful: &quot; + pref.myAlias);
+						// **3 now we are logged in and get the Cookie (there are two)
+						PropertyList pl = UrlFetcher.getDocumentProperties();
+						cookie = &quot;&quot;;
+						for (int i = 0; i &lt; pl.size(); i++) {
+							Property p = (Property) pl.get(i);
+							if (p.name.equalsIgnoreCase(&quot;Set-Cookie&quot;)) {
+								cookie+=p.value;
+							}
+						}
+						/* */
+						String cookieID=&quot;&quot;;
+						Regex rexCookieID = new Regex(&quot;(?i)userid=(.*?);.*&quot;);
+						rexCookieID.search(cookie);
+						if (!rexCookieID.didMatch()) {
+							pref.log(&quot;[login]:check rexCookieID in SpiderGC.java --&gt; CookieID not found. Using old one.&quot;);
+						} else
+							cookieID = rexCookieID.stringMatched(1);
+						String cookieSession=&quot;&quot;;
+						Regex rexCookieSession = new Regex(&quot;(?i)ASP.NET_SessionId=(.*?);.*&quot;);
+						rexCookieSession.search(cookie);
+						if (!rexCookieSession.didMatch()) {
+							pref.log(&quot;[login]:check rexCookieSession in SpiderGC.java --&gt; CookieSession not found. Using old one.&quot;);
+						} else
+							cookieSession = rexCookieSession.stringMatched(1);
+						cookie=&quot;ASP.NET_SessionId=&quot; + cookieSession + &quot;; userid=&quot; + cookieID;
+						/* */
+						UrlFetcher.setPermanentRequestorProperty(&quot;Cookie&quot;, cookie);
+
+						// **4 change language to EN 
+						rexViewstate.search(loginPage);
+						if (!rexViewstate.didMatch()) {
+							pref.log(&quot;[login]:check rexViewstate in SpiderGC.java --&gt; not found after login&quot;
+									+ Preferences.NEWLINE + loginPage, null);
+						}
+						viewstate = rexViewstate.stringMatched(1);
+						String strEnglishPage = &quot;ctl00$uxLocaleList$uxLocaleList$ctl01$uxLocaleItem&quot;;
+						String postStr = &quot;__EVENTTARGET=&quot;+ URL.encodeURL(strEnglishPage, false)
+										+ &quot;&amp;__EVENTARGUMENT=&quot;
+										+ &quot;&amp;__VIEWSTATE=&quot; + URL.encodeURL(viewstate, false);
+						try {
+							UrlFetcher.setpostData(postStr);
+							loginPage = UrlFetcher.fetch(loginPageUrl);
+							// there is no real check if switched
+							pref.log(&quot;Switched to English&quot;+loginPage);
+						} catch (Exception ex) {
+							pref.log(&quot;Error switching to English: check/n&quot; + loginPageUrl + &quot;/n&quot; + postStr, ex);
+						}
+					}
 					else {
 						pref.log(&quot;Login failed. Wrong Account or Password? &quot; + pref.myAlias, null);
 						pref.log(&quot;[login.LoginUrl]:&quot; + sb.toString(), null);
@@ -1327,63 +1364,8 @@
 					return ERR_LOGIN;
 				}
 			}
-
-			rexViewstate.search(loginPage);
-			if (!rexViewstate.didMatch()) {
-				pref.log(&quot;[login]:check rexViewstate in SpiderGC.java --&gt; not found after login&quot;
-						+ Preferences.NEWLINE + loginPage, null);
-			}
-			viewstate = rexViewstate.stringMatched(1);
-
-			rexCookieID.search(loginPage);
-			if (!rexCookieID.didMatch()) {
-				pref.log(&quot;[login]:check rexCookieID in SpiderGC.java --&gt; CookieID not found. Using old one.&quot;, null);
-			} else
-				cookieID = rexCookieID.stringMatched(1);
-			rexCookieSession.search(loginPage);
-			if (!rexCookieSession.didMatch()) {
-				pref.log(&quot;[login]:check rexCookieSession in SpiderGC.java --&gt; CookieSession not found. Using old one.&quot;
-						+ Preferences.NEWLINE + loginPage);
-			} else
-				cookieSession = rexCookieSession.stringMatched(1);
-
-			/*
-			 * String viewstate1; rexViewstate1.search(loginPage);
-			 * if(rexViewstate1.didMatch()){ viewstate1 =
-			 * rexViewstate1.stringMatched(1); } else { viewstate1 = &quot;&quot;;
-			 * pref.log(
-			 * &quot;[login]:check rexViewstate1 in SpiderGC.java --&gt; not found after login&quot;
-			 * +Preferences.NEWLINE+loginPage); }
-			 */
-
-			/*
-			 * rexEventvalidation.search(htmlPage);
-			 * if(rexEventvalidation.didMatch()){ eventvalidation =
-			 * rexEventvalidation.stringMatched(1); } else { eventvalidation =
-			 * &quot;&quot;; }
-			 */
-
-			String strEnglishPage = &quot;ctl00$uxLocaleList$uxLocaleList$ctl01$uxLocaleItem&quot;;
-			String postStr = URL.encodeURL(&quot;__EVENTTARGET&quot;, false) + &quot;=&quot;
-					+ URL.encodeURL(strEnglishPage, false) + &quot;&amp;&quot;
-					+ URL.encodeURL(&quot;__EVENTARGUMENT&quot;, false) + &quot;=&quot;
-					+ URL.encodeURL(&quot;&quot;, false)
-					// + &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATEFIELDCOUNT&quot;,false)
-					// +&quot;=2&quot;
-					+ &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATE&quot;, false) + &quot;=&quot;
-					+ URL.encodeURL(viewstate, false);
-			// + &quot;&amp;&quot; + URL.encodeURL(&quot;__VIEWSTATE1&quot;,false) +&quot;=&quot;+
-			// URL.encodeURL(viewstate1,false);
-			// + &quot;&amp;&quot; + URL.encodeURL(&quot;__EVENTVALIDATION&quot;,false) +&quot;=&quot;+
-			// URL.encodeURL(eventvalidation,false);
-			try {
-				loginPage = fetch_post(loginPageUrl, postStr, true);
-				pref.log(&quot;Switched to English&quot;);
-			} catch (Exception ex) {
-				pref.log(&quot;Error switching to English: check/n&quot; + loginPageUrl
-						+ &quot;/n&quot; + postStr + &quot;/n&quot; + nextPage + &quot;/n&quot;, ex);
-			}
 		}
+		
 		boolean loginAborted = localInfB.isClosed;
 		localInfB.close(0);
 		if (loginAborted)
@@ -1393,7 +1375,6 @@
 			return FormBase.IDOK;
 		}
 	}
-
 	/*
 	 *
 	 */
@@ -1457,7 +1438,7 @@
 		url = url + cacheTypeRestriction;
 		
 		try {
-			htmlListPage = fetchText(url, false);
+			htmlListPage = UrlFetcher.fetch(url);
 			pref.log(&quot;[getFirstListPage] Got first page &quot; + url);
 		} catch (Exception ex) {
 			pref.log(&quot;[getFirstListPage] Error fetching first list page &quot; + url, ex, true);
@@ -1521,7 +1502,8 @@
 						  &quot;__VIEWSTATE1=&quot; + URL.encodeURL(viewstate1, false); // + &quot;&amp;&quot; +
 						  //&quot;__EVENTVALIDATION=&quot; + URL.encodeURL(eventvalidation,false);
 		try {
-			htmlListPage = fetch_post(url, postData, true);
+			UrlFetcher.setpostData(postData);
+			htmlListPage = UrlFetcher.fetch(url);
 			pref.log(&quot;[getAListPage] Got list page: &quot; + URL.encodeURL(whatPage, false));
 		} catch (Exception ex) {
 			pref.log(&quot;[getAListPage] Error getting a list page&quot; + url, ex);
@@ -1537,7 +1519,11 @@
 		&quot;&amp;lng=&quot;	+ middle.getLonDeg(TransformCoordinates.DD);
 
 		if (userToken.equals(&quot;&quot;)) {
-			ret = fetchText(referer, false);
+			try {
+				ret = UrlFetcher.fetch(referer);
+			} catch (IOException e) {
+				ret=&quot;&quot;;
+			}
 			int i = ret.indexOf(&quot;userToken = '&quot;);
 			i=i+13;
 			int j = ret.indexOf(&quot;'&quot;, i);
@@ -1557,7 +1543,19 @@
 		String postData = param1+param2+param3+userToken+param4;
 
 		try {
-		ret = post(url, postData, referer, false);
+			UrlFetcher.setpostData(postData);
+			// UrlFetcher.setRequestorProperty(&quot;Accept&quot;,&quot;application/json, text/javascript, */*; q=0.01&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Accept-Language&quot;,&quot;de-de,de;q=0.8,en-us;q=0.5,en;q=0.3&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Accept-Encoding&quot;,&quot;gzip,deflate&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Accept-Charset&quot;,&quot;ISO-8859-1,utf-8;q=0.7,*;q=0.7&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Keep-Alive&quot;,&quot;115&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Proxy-Connection&quot;,&quot;keep-alive&quot;);
+			UrlFetcher.setRequestorProperty(&quot;Content-Type&quot;, &quot;application/json; charset=UTF-8&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;X-Requested-With&quot;,&quot;XMLHttpRequest&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Referer&quot;,referer);
+			// UrlFetcher.setRequestorProperty(&quot;Pragma&quot;,&quot;no-cache&quot;);
+			// UrlFetcher.setRequestorProperty(&quot;Cache-Control&quot;,&quot;no-cache&quot;);
+			ret=UrlFetcher.fetch(url);
 		} catch (Exception ex) {
 			ret = &quot;&quot;;
 			pref.log(&quot;[SpiderGC:getMapListPage] Error getting map Cachepage&quot; + url + postData, ex);
@@ -1565,45 +1563,6 @@
 		return ret;
  	}
 
-	private static String post(String url, String postData, String referer, boolean withResponseHeaders) {
-		HttpConnection conn;
-		try {
-			conn = new HttpConnection(url);
-			JavaUtf8Codec codec = new ewe.io.JavaUtf8Codec();
-			conn.documentIsEncoded = true;
-			conn.setRequestorProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12&quot;);
-			conn.setRequestorProperty(&quot;Accept&quot;,&quot;application/json, text/javascript, */*; q=0.01&quot;);
-			conn.setRequestorProperty(&quot;Accept-Language&quot;,&quot;de-de,de;q=0.8,en-us;q=0.5,en;q=0.3&quot;);
-			conn.setRequestorProperty(&quot;Accept-Encoding&quot;,&quot;gzip,deflate&quot;);
-			conn.setRequestorProperty(&quot;Accept-Charset&quot;,&quot;ISO-8859-1,utf-8;q=0.7,*;q=0.7&quot;);
-			conn.setRequestorProperty(&quot;Keep-Alive&quot;,&quot;115&quot;);
-			conn.setRequestorProperty(&quot;Proxy-Connection&quot;,&quot;keep-alive&quot;);
-			conn.setRequestorProperty(&quot;Content-Type&quot;, &quot;application/json; charset=UTF-8&quot;);
-			conn.setRequestorProperty(&quot;X-Requested-With&quot;,&quot;XMLHttpRequest&quot;);
-			conn.setRequestorProperty(&quot;Referer&quot;,referer);
-			conn.setRequestorProperty(&quot;Pragma&quot;,&quot;no-cache&quot;);
-			conn.setRequestorProperty(&quot;Cache-Control&quot;,&quot;no-cache&quot;);
-			// if (cookieSession.length() &gt; 0) { conn.setRequestorProperty(&quot;Cookie&quot;, &quot;ASP.NET_SessionId=&quot; + cookieSession + &quot;; userid=&quot; + cookieID); }
-			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-			//conn.setPostData(codec.encodeText(postData.toCharArray(), 0, postData.length(), true, null));
-			conn.setPostData(postData);
-			Socket sock = conn.connect();
-			// CharArray c_data = conn.readText(sock, codec);
-			ByteArray daten = conn.readData(sock);
-			CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			
-			sock.close();
-			
-			if (withResponseHeaders)
-				return getResponseHeaders(conn) + c_data.toString();
-			else
-				return c_data.toString();
-		} catch (Exception e) {
-			pref.log(&quot;[fetch_post] Ignored Exception&quot;, e, true);
-		}
-		return &quot;&quot;;
-	}
-
 	/**
 	 * check if new Update exists
 	 * 
@@ -1656,31 +1615,29 @@
 			save = true;
 			ret = true;
 		}
-		
 		if (pref.checkDTS) {
-  		String dts[]=mString.split(getDTS(CacheDescription),'/');
-  		if (dts.length == 3) {
-  			if (difficultyChanged(ch,  CacheTerrDiff.v1Converter(dts[0]))) {
-  				save = true;
-  				ret = true;
-  				pref.log(&quot;difficultyChanged&quot;);
-  			}
-  			if (terrainChanged(ch, CacheTerrDiff.v1Converter(dts[1]))) {
-  				save = true;
-  				ret = true;
-  				pref.log(&quot;terrainChanged&quot;);
-  			}
-  			if (sizeChanged(ch, (byte) Common.parseInt(dts[2]))) {
-  				save = true;
-  				ret = true;
-  				pref.log(&quot;sizeChanged&quot;);
-  			}
-  		}
-  		else {
-  			pref.log(&quot;check DTS calculation&quot;, null);
-  		}
+			String dts[]=mString.split(getDTS(CacheDescription),'/');
+			if (dts.length == 3) {
+				if (difficultyChanged(ch,  CacheTerrDiff.v1Converter(dts[0]))) {
+					save = true;
+					ret = true;
+					pref.log(&quot;difficultyChanged&quot;);
+				}
+				if (terrainChanged(ch, CacheTerrDiff.v1Converter(dts[1]))) {
+					save = true;
+					ret = true;
+					pref.log(&quot;terrainChanged&quot;);
+				}
+				if (sizeChanged(ch, (byte) Common.parseInt(dts[2]))) {
+					save = true;
+					ret = true;
+					pref.log(&quot;sizeChanged&quot;);
+				}
+			}
+			else {
+				pref.log(&quot;check DTS calculation&quot;, null);
+			}
 		}
-		
 		if (newFoundExists(ch,  CacheDescription)) {
 			numLogUpdates++;
 			ret = true;
@@ -1755,7 +1712,12 @@
 			// String thereitis=&quot;|0.34 km|102.698&quot;;
 			// String page = fetchText(&quot;<A HREF="http://www.geocaching.com/seek/nearest.aspx?lat=48.48973&amp;lng=009.26313&amp;dist=2&amp;f=1">http://www.geocaching.com/seek/nearest.aspx?lat=48.48973&amp;lng=009.26313&amp;dist=2&amp;f=1</A>&quot;,false);
 			String thereitis=&quot;|0.08 km|223.968&quot;;
-			String page = fetchText(&quot;<A HREF="http://www.geocaching.com/seek/nearest.aspx?lat=45.29152&amp;lng=-122.41262&amp;dist=1">http://www.geocaching.com/seek/nearest.aspx?lat=45.29152&amp;lng=-122.41262&amp;dist=1</A>&quot;,false);
+			String page;
+			try {
+				page = UrlFetcher.fetch(&quot;<A HREF="http://www.geocaching.com/seek/nearest.aspx?lat=45.29152&amp;lng=-122.41262&amp;dist=1">http://www.geocaching.com/seek/nearest.aspx?lat=45.29152&amp;lng=-122.41262&amp;dist=1</A>&quot;);
+			} catch (IOException e) {
+				page=&quot;&quot;;
+			}
 			//  
 			RexPropListBlock.search(page);
 			String table=&quot;&quot;;
@@ -1779,7 +1741,6 @@
 			int keylength=13; // wenn nicht 13 dann newkey auf wiederholung pr&#252;fen
 			DistanceCodeKey=newkey.substring(0, keylength);
 			ret = decodeXor( stmp, DistanceCodeKey).replace('|', ' ');
-			pref.log(&quot;Automatic key: &quot; + DistanceCodeKey + &quot; result: &quot; + ret + Preferences.NEWLINE);
 			RexPropDistance.search(ret); // km oder mi
 		}
 
@@ -1866,8 +1827,13 @@
 		if (RexPropDTS.didMatch()) {
 			String code=RexPropDTS.stringMatched(1);
 			/* */
-			String url = &quot;<A HREF="http://www.geocaching.com/ImgGen/seek/CacheInfo.ashx?v=">http://www.geocaching.com/ImgGen/seek/CacheInfo.ashx?v=</A>&quot;+code;
-			ByteArray doc=fetch(url);
+			String address = &quot;<A HREF="http://www.geocaching.com/ImgGen/seek/CacheInfo.ashx?v=">http://www.geocaching.com/ImgGen/seek/CacheInfo.ashx?v=</A>&quot;+code;
+			ByteArray doc;
+			try {
+				doc = UrlFetcher.fetchData(address);
+			} catch (IOException e) {
+				return &quot;&quot;;
+			}
 			Image idoc = new Image(doc,0,null,0,0);
 			/*
 			FileOutputStream fos;
@@ -2207,7 +2173,7 @@
 							+ ch.getWayPoint()
 							+ ((fetchAllLogs || ch.is_found()) ? p
 									.getProp(&quot;fetchAllLogs&quot;) : &quot;&quot;);
-					completeWebPage = fetchText(doc, false);
+					completeWebPage = UrlFetcher.fetch(doc);
 					pref.log(&quot;Fetched: &quot; + ch.getWayPoint());
 					if (completeWebPage.equals(&quot;&quot;)) {
 						pref.log(&quot;Could not fetch &quot; + ch.getWayPoint(), null);
@@ -2749,7 +2715,7 @@
 					infB.setInfo(oldInfoBox
 							+ MyLocale.getMsg(5514, &quot;\nGetting bug: &quot;)
 							+ SafeXML.cleanback(bug));
-					bugDetails = fetchText(link, false);
+					bugDetails = UrlFetcher.fetch(link);
 					pref.log(&quot;[getBugs] Fetched TB details: &quot; + bug);
 					Extractor exDetails = new Extractor(bugDetails, p
 							.getProp(&quot;bugDetailsStart&quot;), p
@@ -2795,23 +2761,17 @@
 		if (oldCh != null) {
 			lastImages = oldCh.getCacheDetails(false).images;
 		}
-
 		// ========
-		// In the long description
+		// In the long Description
 		// ========
-		String longDesc = &quot;&quot;;
+		String longDesc = doc;
 		try {
-			if (chD.getParent().getWayPoint().startsWith(&quot;TC&quot;) || !extractLongDesc)
-				longDesc = doc;
-			else
+			if (chD.getParent().getWayPoint().startsWith(&quot;GC&quot;) || extractLongDesc)
 				longDesc = getLongDesc(doc);
 			longDesc = STRreplace.replace(longDesc, &quot;&lt;img&quot;, &quot;&lt;IMG&quot;);
 			longDesc = STRreplace.replace(longDesc, &quot;src=&quot;, &quot;SRC=&quot;);
 			longDesc = STRreplace.replace(longDesc, &quot;'&quot;, &quot;\&quot;&quot;);
-			exImgBlock = new Extractor(longDesc, 
-					p.getProp(&quot;imgBlockExStart&quot;),
-					p.getProp(&quot;imgBlockExEnd&quot;), 
-					0, false);
+			exImgBlock = new Extractor(longDesc, p.getProp(&quot;imgBlockExStart&quot;), p.getProp(&quot;imgBlockExEnd&quot;), 0, false);
 		} catch (Exception ex) {// Missing property in spider.def
 			return;
 		}
@@ -2821,12 +2781,10 @@
 		while (exImgBlock.endOfSearch() == false) {
 			imgUrl = exImgSrc.findNext();
 			if (imgUrl.length() &gt; 0) {
-				// Optimize: img.groundspeak.com -&gt; img.geocaching.com (for
-				// better caching purposes)
+				// Optimize: img.groundspeak.com -&gt; img.geocaching.com (for better caching purposes)
 				imgUrl = CacheImages.optimizeLink(&quot;<A HREF="http://">http://</A>&quot; + imgUrl);
 				try {
-					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.'))
-							.toLowerCase() + &quot;    &quot;).substring(0, 4).trim();
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase() + &quot;    &quot;).substring(0, 4).trim();
 					// imgType is now max 4 chars, starting with .
 					if (imgType.startsWith(&quot;.png&quot;)
 							|| imgType.startsWith(&quot;.jpg&quot;)
@@ -2881,15 +2839,11 @@
 		// ========
 		Extractor spanBlock, exImgName;
 		try {
-			spanBlock = new Extractor(doc, p.getProp(&quot;imgSpanExStart&quot;), 
-					p.getProp(&quot;imgSpanExEnd&quot;), 0, true);
+			spanBlock = new Extractor(doc, p.getProp(&quot;imgSpanExStart&quot;), p.getProp(&quot;imgSpanExEnd&quot;), 0, true);
 			tst = spanBlock.findNext();
-			exImgName = new Extractor(tst, p.getProp(&quot;imgNameExStart&quot;), 
-					p.getProp(&quot;imgNameExEnd&quot;), 0, true);
-			exImgSrc = new Extractor(tst, p.getProp(&quot;imgSrcExStart&quot;), 
-					p.getProp(&quot;imgSrcExEnd&quot;), 0, true);
-			exImgComment = new Extractor(tst, p.getProp(&quot;imgCommentExStart&quot;), 
-					p.getProp(&quot;imgCommentExEnd&quot;), 0, true);
+			exImgName = new Extractor(tst, p.getProp(&quot;imgNameExStart&quot;), p.getProp(&quot;imgNameExEnd&quot;), 0, true);
+			exImgSrc = new Extractor(tst, p.getProp(&quot;imgSrcExStart&quot;), p.getProp(&quot;imgSrcExEnd&quot;), 0, true);
+			exImgComment = new Extractor(tst, p.getProp(&quot;imgCommentExStart&quot;), p.getProp(&quot;imgCommentExEnd&quot;), 0, true);
 		} catch (Exception ex) {
 			return;
 		}
@@ -2908,16 +2862,12 @@
 						// Check whether image was already spidered for this
 						// cache
 						idxUrl = spideredUrls.find(imgUrl);
-						imgName = chD.getParent().getWayPoint() + &quot;_&quot;
-								+ Convert.toString(imgCounter);
+						imgName = chD.getParent().getWayPoint() + &quot;_&quot; + Convert.toString(imgCounter);
 						imageInfo = null;
 						if (idxUrl &lt; 0) { // New image
-							fileName = chD.getParent().getWayPoint()
-									.toLowerCase()
-									+ &quot;_&quot; + Convert.toString(spiderCounter);
+							fileName = chD.getParent().getWayPoint().toLowerCase() + &quot;_&quot; + Convert.toString(spiderCounter);
 							if (lastImages != null) {
-								imageInfo = lastImages.needsSpidering(imgUrl,
-										fileName + imgType);
+								imageInfo = lastImages.needsSpidering(imgUrl, fileName + imgType);
 							}
 							if (imageInfo == null) {
 								imageInfo = new ImageInfo();
@@ -2957,12 +2907,10 @@
 		while (!exFinal.endOfSearch()) {
 			imgUrl = exFinal.findNext();
 			if (imgUrl.length() &gt; 0) {
-				// Optimize: img.groundspeak.com -&gt; img.geocaching.com (for
-				// better caching purposes)
+				// Optimize: img.groundspeak.com -&gt; img.geocaching.com (for better caching purposes)
 				imgUrl = CacheImages.optimizeLink(&quot;<A HREF="http://">http://</A>&quot; + imgUrl);
 				try {
-					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.'))
-							.toLowerCase() + &quot;    &quot;).substring(0, 4).trim();
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase() + &quot;    &quot;).substring(0, 4).trim();
 					// imgType is now max 4 chars, starting with . Delete
 					// characters in URL after the image extension
 					imgUrl = imgUrl.substring(0, imgUrl.lastIndexOf('.')
@@ -2971,8 +2919,7 @@
 							|| imgType.startsWith(&quot;.bmp&quot;)
 							|| imgType.startsWith(&quot;.png&quot;)
 							|| imgType.startsWith(&quot;.gif&quot;)) {
-						// Check whether image was already spidered for this
-						// cache
+						// Check whether image was already spidered for this cache
 						idxUrl = spideredUrls.find(imgUrl);
 						if (idxUrl &lt; 0) { // New image
 							imgName = chD.getParent().getWayPoint() + &quot;_&quot; + Convert.toString(imgCounter);
@@ -3201,104 +3148,6 @@
 		chD.getParent().setAttribsAsBits(chD.attributes.getAttribsAsBits());
 	}
 
-	public static String fetchText(String address, boolean withResponseHeaders) {
-		ByteArray daten = fetch(address);
-		if (daten == null) return &quot;&quot;;
-		try {
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			CharArray c_data;
-			c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			if (withResponseHeaders)
-				return getResponseHeaders(conn) + c_data.toString();
-			else
-				return c_data.toString();
-		} catch (IOException e) {
-			pref.log(&quot;IOException in fetch&quot;, e);
-			return null;
-		}
-	}
-
-	/**
-	 * Performs an initial fetch to a given address. 
-	 */
-	private static ByteArray fetch(String address) {
-		try {
-			if (pref.myproxy.length() &gt; 0 &amp;&amp; pref.proxyActive) {
-				pref.log(&quot;[fetch]:Using proxy: &quot; + pref.myproxy + &quot; / &quot; + pref.myproxyport);
-			}
-			if (conn == null) { conn = new HttpConnection(address); }
-			else { conn.setUrl(address); }
-			conn.setRequestorProperty(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0&quot;);
-			if (cookieSession.length() &gt; 0) {conn.setRequestorProperty(&quot;Cookie&quot;, &quot;ASP.NET_SessionId=&quot; + cookieSession + &quot;; userid=&quot; + cookieID);};
-			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-			conn.documentIsEncoded = true;
-			conn.connect();
-			if (conn.isOpen()) {
-				pref.log(&quot;[fetch]:Connect ok! &quot; + address);
-				ByteArray daten = conn.readData();
-				conn.disconnect();
-				return daten;
-			}
-			pref.log(&quot;[fetch]:Connect not opened! &quot; + address, null);
-			return null;
-		} catch (IOException ioex) {
-			pref.log(&quot;IOException in fetch&quot;, ioex);
-			return null;
-		}
-	}
-
-	/**
-	 * After a fetch to gc.com the next fetches have to use the post method.
-	 * This method does exactly that. Actually this method is generic in the
-	 * sense that it can be used to post to a URL using http post.
-	 */
-	private static String fetch_post(String address, String postData, boolean withResponseHeaders) {
-		try {
-			HttpConnection conn = new HttpConnection(address);
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			conn.documentIsEncoded = true;
-			conn.setRequestorProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0&quot;);
-			conn.setPostData(codec.encodeText(postData.toCharArray(), 0, postData.length(), true, null));
-			conn.setRequestorProperty(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
-			if (cookieSession.length() &gt; 0) { conn.setRequestorProperty(&quot;Cookie&quot;, &quot;ASP.NET_SessionId=&quot; + cookieSession + &quot;; userid=&quot; + cookieID);};
-			conn.setRequestorProperty(&quot;Connection&quot;, &quot;close&quot;);
-			Socket sock = conn.connect();
-			pref.log(&quot;[fetch_post]:Connect ok! &quot; + address);
-			// ByteArray daten = conn.readData(sock);
-			CharArray c_data = conn.readText(sock, codec);
-			pref.log(&quot;[fetch_post]:Read data ok &quot; + address);
-			// CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			sock.close();
-			if (withResponseHeaders)
-				return getResponseHeaders(conn) + c_data.toString();
-			else
-				return c_data.toString();
-		} catch (Exception e) {
-			pref.log(&quot;[fetch_post] Ignored Exception&quot;, e, true);
-		}
-		return &quot;&quot;;
-	}
-
-	private static String getResponseHeaders(HttpConnection conn) {
-		PropertyList pl = conn.documentProperties;
-		if (pl != null) {
-			StringBuffer sb = new StringBuffer(1000);
-			boolean gotany = false;
-
-			for (int i = 0; i &lt; pl.size(); i++) {
-				Property currProp = (Property) pl.get(i);
-				if (currProp.value != null) {
-					sb.append(currProp.name).append(&quot;: &quot;)
-							.append(currProp.value).append(&quot;\r\n&quot;);
-					gotany = true;
-				}
-			}
-			if (gotany)
-				return sb.toString() + &quot;\r\n&quot;;
-		}
-		return &quot;&quot;;
-	}
-
 	final static String hex = ewe.util.TextEncoder.hex;
 
 	public String encodeUTF8URL(byte[] what) {
@@ -3333,7 +3182,7 @@
 		String bugList;
 		try {
 			// infB.setInfo(oldInfoBox+&quot;\nGetting bug: &quot;+bug);
-			bugList = fetchText(p.getProp(&quot;getBugByName&quot;) + STRreplace.replace(SafeXML.clean(name), &quot; &quot;, &quot;+&quot;), false);
+			bugList = UrlFetcher.fetch(p.getProp(&quot;getBugByName&quot;) + STRreplace.replace(SafeXML.clean(name), &quot; &quot;, &quot;+&quot;));
 			pref.log(&quot;[getBugId] Fetched bugId: &quot; + name);
 		} catch (Exception ex) {
 			pref.log(&quot;[getBugId] Could not fetch bug list&quot; + name, ex);
@@ -3379,9 +3228,9 @@
 		try {
 			// infB.setInfo(oldInfoBox+&quot;\nGetting bug: &quot;+bug);
 			if (guid.length() &gt; 10)
-				bugDetails = fetchText(p.getProp(&quot;getBugByGuid&quot;) + guid, false);
+				bugDetails = UrlFetcher.fetch(p.getProp(&quot;getBugByGuid&quot;) + guid);
 			else
-				bugDetails = fetchText(p.getProp(&quot;getBugById&quot;) + guid, false);
+				bugDetails = UrlFetcher.fetch(p.getProp(&quot;getBugById&quot;) + guid);
 			pref.log(&quot;[getBugMissionByGuid] Fetched TB detailsById: &quot; + guid);
 		} catch (Exception ex) {
 			pref.log(&quot;[getBugMissionByGuid] Could not fetch TB details &quot; + guid, ex);
@@ -3415,7 +3264,7 @@
 	public String getBugMissionByTrackNr(String trackNr) {
 		String bugDetails;
 		try {
-			bugDetails = fetchText(p.getProp(&quot;getBugByTrackNr&quot;) + trackNr, false);
+			bugDetails = UrlFetcher.fetch(p.getProp(&quot;getBugByTrackNr&quot;) + trackNr);
 			pref.log(&quot;[getBugMissionByTrackNr] Fetched bug detailsByTrackNr: &quot; + trackNr);
 		} catch (Exception ex) {
 			pref.log(&quot;[getBugMissionByTrackNr] getBugByTrackNr &quot; + trackNr, ex);
@@ -3451,7 +3300,7 @@
 		String bugDetails;
 		String trackNr = TB.getTrackingNo();
 		try {
-			bugDetails = fetchText(p.getProp(&quot;getBugByTrackNr&quot;) + trackNr, false);
+			bugDetails = UrlFetcher.fetch(p.getProp(&quot;getBugByTrackNr&quot;) + trackNr);
 			pref.log(&quot;[getBugMissionAndNameByTrackNr] Fetched TB getBugByTrackNr: &quot; + trackNr);
 		} catch (Exception ex) {
 			pref.log(&quot;[getBugMissionAndNameByTrackNr] Could not fetch bug details: &quot; + trackNr, ex);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002933.html">[Cachewolf-svn] r2942 - in trunk/src/CacheWolf: . imp
</A></li>
	<LI>Next message: <A HREF="002935.html">[Cachewolf-svn] r2944 - trunk/src/CacheWolf/imp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2934">[ date ]</a>
              <a href="thread.html#2934">[ thread ]</a>
              <a href="subject.html#2934">[ subject ]</a>
              <a href="author.html#2934">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
