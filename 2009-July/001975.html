<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2053 - experiments/greiol/src/CacheWolf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2053%20-%20experiments/greiol/src/CacheWolf&In-Reply-To=%3C200907242026.n6OKQjxF008539%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001974.html">
   <LINK REL="Next"  HREF="001976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2053 - experiments/greiol/src/CacheWolf</H1>
    <B>greiol at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2053%20-%20experiments/greiol/src/CacheWolf&In-Reply-To=%3C200907242026.n6OKQjxF008539%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2053 - experiments/greiol/src/CacheWolf">greiol at mail.berlios.de
       </A><BR>
    <I>Fri Jul 24 22:26:45 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001974.html">[Cachewolf-svn] r2052 - experiments/greiol/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="001976.html">[Cachewolf-svn] r2054 - trunk/res_noewe
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1975">[ date ]</a>
              <a href="thread.html#1975">[ thread ]</a>
              <a href="subject.html#1975">[ subject ]</a>
              <a href="author.html#1975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: greiol
Date: 2009-07-24 22:26:43 +0200 (Fri, 24 Jul 2009)
New Revision: 2053

Modified:
   experiments/greiol/src/CacheWolf/DetailsPanel.java
Log:
part 3

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-23 21:41:57 UTC (rev 2052)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-24 20:26:43 UTC (rev 2053)
@@ -36,7 +36,7 @@
  * Also allows for creation of a custom waypoint.&lt;br&gt;
  */
 public class DetailsPanel extends CellPanel {
-	
+
 	// ===== GUI elements =====
 	/** waypoint id */
 	private static mInput inpWaypoint;
@@ -46,15 +46,15 @@
 	private static mInput inpHidden;
 	/** waypoint owner */
 	private static mInput inpOwner;
+	/** waypoint coordinates, open change coordinates dialog */
+	private static mButton btnCoordinates;
 	/** FIXME */
-	private static mButton btnWayLoc;
-	/** FIXME */
 	private static mButton btnCenter;
 	/** add time stamp to notes */
 	private static mButton btnAddDateTime;
 	/** FIXME */
 	private static mButton btnNewWpt;
-	/** FIXME */
+	/** show details for travelbus in waypoint */
 	private static mButton btnShowBug;
 	/** FIXME */
 	private static mButton btnShowMap;
@@ -83,19 +83,19 @@
 	/** FIXME */
 	private static CellPanel pnlTools;
 	/** FIXME */
-	private static mTextPad mNotes;
+	private static mTextPad cacheNotes;
 	/** FIXME */
 	private static mLabel lblAddiCount;
 	/** FIXME move to image broker?*/
 	private static mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgNotes;
 	/** FIXME: what are they for? */
 	private static mImage imgShowMaps, imgAddImages;
-	
+
 	// ===== data handles =====
 	/** FIXME: never used? */
 	private static CacheDB cacheDB;
 	/** waypoint to be displayed */
-	private static CacheHolder thisCache;
+	private static CacheHolder ch;
 	/** FIXME: never used? */
 	private static int dbIndex = -1;
 	/** panel to display waypoint attributes */
@@ -104,12 +104,12 @@
 	private static Preferences pref;
 	/** waypoint profile */
 	private static Profile profile;
-	
+
 	// ===== flags =====
 	/** notes have changes */
 	private boolean dirty_notes;
 	/** details have changed FIXME: make this obsolete */
-	private boolean dirty_details;
+//	private boolean dirty_details;
 	/** cache is blacklisted FIXME: make this obsolete*/
 	private boolean blackStatus;
 	/** blacklist status was changed by user FIXME: make this obsolete */
@@ -125,19 +125,19 @@
 	//mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgShowMaps, imgAddImages, imgNotes;
 
 	public DetailsPanel() {
-		
+
 		// ===== local objects =====
 		/** helper panels to organize layout */
 		CellPanel helperPanel1, helperPanel2, helperPanel3, helperPanel4, helperPanel5; 
-		
+
 		// ===== initialize data handles =====
 		pref = Global.getPref();
 		profile = Global.getProfile();
 		cacheDB = profile.cacheDB;
-		
+
 		// ===== initialize flags =====
 		dirty_notes = false;
-		dirty_details = false;
+//		dirty_details = false;
 		blackStatus = false;
 		blackStatusChanged = false;
 		needsTableUpdate = false;
@@ -145,51 +145,50 @@
 		useBigIcons = pref.useBigIcons;
 
 		// ===== initialize GUI objects =====
-		
+
 		// ----- tools panel ------
 		pnlTools = new CellPanel();
 		btnNewWpt = new mButton(imgNewWpt = new mImage(useBigIcons?&quot;newwpt_vga.png&quot;:&quot;newwpt.png&quot;));
 		//FIXME: get an image with proper transparency
 		imgNewWpt.transparentColor = new Color(255, 0, 0);
 		btnNewWpt.setToolTip(MyLocale.getMsg(311, &quot;Create Waypoint&quot;));
-		
+
 		btnGoto = new mButton(imgGoto = new mImage(useBigIcons?&quot;goto_vga.png&quot;:&quot;goto.png&quot;));
 		//FIXME: get an image with proper transparency
 		imgGoto.transparentColor = Color.White;
 		btnGoto.setToolTip(MyLocale.getMsg(345, &quot;Goto these coordinates&quot;));
-		
+
 		btnShowBug = new mButton(new mImage(useBigIcons?&quot;bug_no_vga.gif&quot;:&quot;bug_no.gif&quot;));
 		btnShowBug.setToolTip(MyLocale.getMsg(346, &quot;Show travelbugs&quot;));
-		deactivateControl(btnShowBug);
-		
+
 		btnShowMap = new mButton(new mImage(useBigIcons?&quot;globe_small_vga.gif&quot;:&quot;globe_small.gif&quot;));
 		btnShowMap.setToolTip(MyLocale.getMsg(347, &quot;Show map&quot;));
-		
+
 		btnAddPicture = new mButton(imgAddImages = new mImage(useBigIcons?&quot;images_vga.gif&quot;:&quot;images.gif&quot;));
 		btnAddPicture.setToolTip(MyLocale.getMsg(348, &quot;Add user pictures&quot;));
-		
+
 		btnBlack = new mButton(imgBlack = new mImage(useBigIcons?&quot;no_black_vga.png&quot;:&quot;no_black.png&quot;));
 		//FIXME: get an image with proper transparency
 		imgBlack.transparentColor = Color.Black;
 		btnBlack.setToolTip(MyLocale.getMsg(349, &quot;Toggle Blacklist status&quot;));
-		
+
 		btnNotes = new mButton(imgNotes = new mImage(useBigIcons?&quot;notes_vga.gif&quot;:&quot;notes.gif&quot;));
 		//FIXME: get an image with proper transparency
 		imgNotes.transparentColor = Color.DarkBlue;
 		btnNotes.setToolTip(MyLocale.getMsg(351, &quot;Add/Edit notes&quot;));
-		
+
 		btnAddDateTime = new mButton(new mImage(useBigIcons?&quot;date_time_vga.gif&quot;:&quot;date_time.gif&quot;));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, &quot;Add timestamp to notes&quot;));
-		
+
 		// ----- main body -----
-		
+
 		helperPanel1 = new CellPanel();
 		helperPanel2 = new CellPanel();
 		helperPanel3 = new CellPanel();
 		helperPanel4 = new CellPanel();
 		helperPanel5 = new CellPanel();
 		attViewer = new AttributesViewer();
-		
+
 		chcType = new mChoice(CacheType.guiTypeStrings(), 0);
 		chcType.alwaysDrop = true;
 		chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
@@ -202,11 +201,14 @@
 				0);
 		inpWaypoint = new mInput();
 		inpName = new mInput();
-		btnWayLoc = new mButton();
+		
+		btnCoordinates = new mButton();
+		btnCoordinates.setToolTip(MyLocale.getMsg(31415, &quot;Edit coordinates&quot;));
+		
 		inpOwner = new mInput();
 		inpHidden = new mInput();
 		inpHidden.modifyAll(DisplayOnly, 0);
-		
+
 		// ===== put the controls onto the GUI =====
 		// ----- tools panel ------
 		pnlTools.addNext(btnNewWpt);
@@ -217,26 +219,30 @@
 		pnlTools.addNext(btnBlack);
 		pnlTools.addNext(btnNotes);
 		pnlTools.addLast(btnAddDateTime);
-		
+
 		pnlTools.stretchFirstRow = true;
-		
+
 		// ----- helper panels -----
-		
+
 		btnDiff = new mButton(MyLocale.getMsg(1000, &quot;D&quot;)	+ &quot;: 5.5&quot;);
 		btnDiff.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
-		
+		btnDiff.setToolTip(MyLocale.getMsg(31415, &quot;Edit difficulty&quot;));
+
 		btnTerr = new mButton(MyLocale.getMsg(1001, &quot;T&quot;)	+ &quot;: 5.5&quot;);
 		btnTerr.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
-		
+		btnTerr.setToolTip(MyLocale.getMsg(31415, &quot;Edit terrain&quot;));
+
 		lblAddiCount = new mLabel(MyLocale.getMsg(1044, &quot;Addis&quot;) + &quot;: 888&quot;);
-		
+
 		btnFoundDate = new mButton(new mImage(useBigIcons?&quot;calendar_vga.png&quot;:&quot;calendar.png&quot;));
-		
+		btnFoundDate.setToolTip(MyLocale.getMsg(31415, &quot;Set found date / time&quot;));
+
 		btnHiddenDate = new mButton(new mImage(useBigIcons?&quot;calendar_vga.png&quot;:&quot;calendar.png&quot;));
+		btnHiddenDate.setToolTip(MyLocale.getMsg(31415, &quot;Set hidden date&quot;));
 
 		helperPanel1.addNext(chcType, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 		helperPanel1.addLast(btnDiff, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));		
-		
+
 		helperPanel2.addNext(chcSize, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 		helperPanel2.addLast(btnTerr, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
 
@@ -248,107 +254,114 @@
 
 		helperPanel5.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 		helperPanel5.addLast(btnHiddenDate, DONTSTRETCH, DONTFILL);
-		
+
 		// ----- main body -----
 		addLast(pnlTools, CellConstants.DONTSTRETCH, CellConstants.WEST).setTag(SPAN, new Dimension(3, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(300, &quot;Type:&quot;)),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
 		addLast(helperPanel1, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(301, &quot;Size:&quot;)),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
 		addLast(helperPanel2, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(302, &quot;Waypoint:&quot;)),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(helperPanel3, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(303, &quot;Name:&quot;)),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		
-		addNext(new mLabel(MyLocale.getMsg(304, &quot;Location:&quot;)),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		addLast(btnWayLoc.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		
+
+		addNext(new mLabel(MyLocale.getMsg(304, &quot;Coordinates:&quot;)),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(btnCoordinates.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+
 		addNext(new mLabel(MyLocale.getMsg(307, &quot;Status:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(helperPanel4, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
 		addNext(new mLabel(MyLocale.getMsg(306, &quot;Owner:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(inpOwner.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(305, &quot;Hidden on:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(helperPanel5, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
-		
+
 		addLast(attViewer);
-		
+
 		if (isBigScreen) {
 			this.addLast(new mLabel(MyLocale.getMsg(308, &quot;Notes:&quot;)), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-			mNotes = new mTextPad();
-			mNotes.modify(ControlConstants.NotEditable, 0);
-			addLast(new MyScrollBarPanel(mNotes));
+			cacheNotes = new mTextPad();
+			cacheNotes.modify(ControlConstants.NotEditable, 0);
+			addLast(new MyScrollBarPanel(cacheNotes));
 		}
 	}
 
 	// ------------- present data
-	
-	/*****************************************************\
-	 
-	                      CLEAN UP BELOW
-	                      
-	\*****************************************************/
 
-	public void setDetails(CacheHolder ch) {
-		thisCache = ch;
+	public void setDetails(CacheHolder nch) {
+		ch = nch;
+
+		int addiCount;
+
 		dirty_notes = false;
-		dirty_details = false;
+
 		inpWaypoint.setText(ch.getWayPoint());
 		inpName.setText(ch.getCacheName());
-		btnWayLoc.setText(ch.pos.toString());
 		inpHidden.setText(ch.getDateHidden());
 		inpOwner.setText(ch.getCacheOwner());
+		
+		btnCoordinates.setText(ch.pos.toString());
+		// If the cache status contains a date, do not overwrite it with 'found' message		
 		if (ch.getCacheStatus().length() &gt;= 10 &amp;&amp; ch.getCacheStatus().charAt(4) == '-') {
 			chcStatus.setText(MyLocale.getMsg(318, &quot;Found&quot;) + &quot; &quot; + ch.getCacheStatus());
 		} else {
 			chcStatus.setText(ch.getCacheStatus());
-			// If the cache status contains a date, do not overwrite it with
-			// 'found' message
+
 			if (ch.is_found() == true)
 				chcStatus.setText(MyLocale.getMsg(318, &quot;Found&quot;));
 		}
+		
 		chcType.setInt(CacheType.cw2GuiSelect(ch.getType()));
-		if (ch.is_black()) {
-			btnBlack.image = imgBlack;
-		} else {
-			btnBlack.image = imgBlackNo;
-		}
-		blackStatus = ch.is_black();
+		
+		blackStatus = !ch.is_black();
+		toggleBlackStatus();
 		blackStatusChanged = false;
-		btnBlack.repaintNow();
+		
 		if (inpWaypoint.getText().length() == 0)
 			createWptName();
-		if (ch.has_bugs() == true) {
-			// btnShowBug.modify(Control.Disabled,1);
-			btnShowBug.image = imgShowBug;
+		
+		//TODO: update after TB dialog?
+		if (ch.has_bugs()) {
+			btnShowBug.image = new mImage(useBigIcons?&quot;bug_vga.gif&quot;:&quot;bug.gif&quot;);	
 		} else {
-			// btnShowBug.modify(Control.Disabled,0);
-			btnShowBug.image = imgShowBugNo;
+			btnShowBug.image = new mImage(useBigIcons?&quot;bug_no_vga.gif&quot;:&quot;bug_no.gif&quot;);
 		}
-		btnShowBug.repaintNow();
+		btnShowBug.repaint();
+		
 		chcSize.setInt(ch.getCacheSize());
 
 		attViewer.showImages(ch.getCacheDetails(true).attributes);
+		
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
 			btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;)+&quot;: -.-&quot;);
 			btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;)+&quot;: -.-&quot;);
 			deactivateControl(btnTerr);
 			deactivateControl(btnDiff);
 			deactivateControl(chcSize);
+			deactivateControl(inpOwner);
+			deactivateControl(inpHidden);
+			deactivateControl(btnShowBug);
+			deactivateControl(btnBlack);
 			chcSize.select(0);
 		} else {
 			activateControl(btnTerr);
 			activateControl(btnDiff);
 			activateControl(chcSize);
+			activateControl(inpOwner);
+			activateControl(inpHidden);
+			activateControl(btnShowBug);
+			activateControl(btnBlack);
 			if (CacheTerrDiff.isValidTD(ch.getTerrain())) {
 				btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + &quot;: &quot; + CacheTerrDiff.longDT(ch.getTerrain()));
 			} else {
 				btnTerr.setText(&quot;T: -.-&quot;);
+				//FIXME: put incomplete to save method?
 				ch.setIncomplete(true);
 				if (Global.getPref().debug)
 					Global.getPref().log(ch.getWayPoint() + &quot; has wrong terrain &quot; + ch.getTerrain());
@@ -357,41 +370,130 @@
 				btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: &quot; + CacheTerrDiff.longDT(ch.getHard()));
 			} else {
 				btnDiff.setText(&quot;D: -.-&quot;);
+				//FIXME: put incomplete to save method?
 				ch.setIncomplete(true);
 				if (Global.getPref().debug)
-					Global.getPref().log(ch.getWayPoint() + &quot; has wrong difficulty &quot; + ch.getHard());
+					Global.getPref().log(nch.getWayPoint() + &quot; has wrong difficulty &quot; + ch.getHard());
 			}
 		}
-		int addiCount = 0;
+
 		if (ch.mainCache == null) {
-			addiCount = ch.addiWpts.size();
+			addiCount = nch.addiWpts.size();
 		} else {
-			addiCount = ch.mainCache.addiWpts.size();
+			addiCount = nch.mainCache.addiWpts.size();
 		}
+		
 		lblAddiCount.setText(MyLocale.getMsg(1044, &quot;Addis&quot;) + &quot;: &quot; + String.valueOf(addiCount));
 
 		if (isBigScreen)
-			mNotes.setText(ch.getExistingDetails().getCacheNotes());
+			cacheNotes.setText(nch.getExistingDetails().getCacheNotes());
 	}
 
-	// ------------- save data
 	// ------------- user interaction
 	// ------------- auxiliary methods
 
+	/*****************************************************\
 
-	
-	public void toggleBugImage() {
+	                      CLEAN UP BELOW
+
+	\*****************************************************/
+
+	// ------------- save data
+	/**
+	 * save waypoint if there have been any changes
+	 * @return true if changes were saved, false if there were no changes to save
+	 */
+	protected boolean saveIfNeeded() {
+		// waypoint
+		// userimages ???
+		// coordinates
+		// status
+		// terrain
+		// difficulty
+		boolean needsSaving = false;
+		int newDifficulty, newTerrain;
 		
+		if (!inpHidden.getText().equals(ch.getDateHidden())) {
+			ch.setDateHidden(inpHidden.getText());
+			needsSaving = true;
+		}
+		
+		if (!inpOwner.getText().equals(ch.getCacheOwner())) {
+			ch.setCacheOwner(inpOwner.getText());
+			needsSaving = true;
+		}
+		
+		if (!inpName.getText().equals(ch.getCacheName())) {
+			ch.setCacheName(inpName.getText());
+			needsSaving = true;
+		}
+		
+		if (CacheSize.guiSizeStrings2CwSize(chcSize.getText()) != ch.getCacheSize()) {
+			ch.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize.getText()));
+			needsSaving = true;
+		}
+		
+		if (ch.getType() != CacheType.guiSelect2Cw(chcType.getInt())) {
+			ch.setType(CacheType.guiSelect2Cw(chcType.getInt()));
+			needsSaving = true;
+		}
+		
+		if (blackStatus != ch.is_black()) {
+			ch.setBlack(blackStatus);
+			needsSaving = true;
+			//TODO: propagate to addis. how?
+		}
+		
+		if (!ch.pos.toString().equals(btnCoordinates.getText())) {
+			ch.LatLon = btnCoordinates.getText();
+			/// PUH!
+		}
+		
+		if (isBigScreen) {
+			if (!cacheNotes.getText().equals(ch.getFreshDetails().getCacheNotes())) {
+				ch.getFreshDetails().setCacheNotes(cacheNotes.getText());
+				needsSaving = true;
+			}
+		}
+		
+		// ch.setAttributesToAddiWpts();
+		//		boolean saveWpt = false;
+		//		boolean renameWpt = false;
+		//		int newdiff;
+		//		int newTerr;
+		//	
+		//		Objects to check:
+
+
+		//		if (!this.inpWaypoint.equals(thisCache.getWayPoint())) {
+		//			saveWpt = true;
+		//			renameWpt = true;
+		//		}
+		//		if (!this.chcSize)
+		//		if (!this.chcStatus)
+		//		if (!this.chcType)
+		//		if (newdiff)
+		//		if (newterr)
+		//		if (btnBlack.getImage()
+		needsTableUpdate = needsTableUpdate || needsSaving;
+		return true;
 	}
-	
+
+
+	public void toggleBugImage() {
+
+	}
+
 	/** toggle blackStatus and update image accordingly */
 	public void toggleBlackStatus() {
 		blackStatus = ! blackStatus;
 		if (blackStatus) {
-			imgBlack = new mImage(useBigIcons?&quot;is_black_vga.png&quot;:&quot;is_black.png&quot;);
+			btnBlack.image = (imgBlack = new mImage(useBigIcons?&quot;is_black_vga.png&quot;:&quot;is_black.png&quot;));
+			//FIXME: get image with proper transparency
 			imgBlack.transparentColor = Color.White;
 		} else {
-			imgBlack = new mImage(useBigIcons?&quot;no_black_vga.png&quot;:&quot;no_black.png&quot;);
+			btnBlack.image = (imgBlack = new mImage(useBigIcons?&quot;no_black_vga.png&quot;:&quot;no_black.png&quot;));
+			//FIXME: get image with proper transparency
 			imgBlack.transparentColor = Color.Black;
 		}
 		btnBlack.repaint();
@@ -411,7 +513,8 @@
 	}
 
 	public boolean isDirty() {
-		return dirty_notes || dirty_details || needsTableUpdate;
+		return dirty_notes || needsTableUpdate;
+		//return dirty_notes || dirty_details || needsTableUpdate;
 	}
 
 	public boolean hasBlackStatusChanged() {
@@ -434,9 +537,9 @@
 		String wpt = inpWaypoint.getText().toUpperCase();
 		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) &amp;&amp; 
 				(Global.mainTab.mainCache.startsWith(&quot;GC&quot;) || 
-					Global.mainTab.mainCache.startsWith(&quot;OC&quot;) || 
-					Global.mainTab.mainCache.startsWith(&quot;CW&quot;)) 
-				&amp;&amp; wpt.startsWith(&quot;CW&quot;)) {
+						Global.mainTab.mainCache.startsWith(&quot;OC&quot;) || 
+						Global.mainTab.mainCache.startsWith(&quot;CW&quot;)) 
+						&amp;&amp; wpt.startsWith(&quot;CW&quot;)) {
 			// for what was this?:
 			Global.mainTab.lastselected = Global.mainTab.mainCache; // I don't know exactly, but it's needed for creating a series of Addis
 
@@ -475,25 +578,28 @@
 				}
 			}
 			//FIXME: check if something was actually changed, since datachange events also occur if you just hop through the fileds with the tab key (Why? don't know!)
-			dirty_details = true;
+//			dirty_details = true;
 			needsTableUpdate = true;
 		}
 		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED) {
 			if (ev.target == btnNotes) {
 				dirty_notes = true; // TODO I think this is redundant, because
-									// the notes are saved separately by the notes screen itself
-				NotesScreen nsc = new NotesScreen(thisCache
+				// the notes are saved separately by the notes screen itself
+				NotesScreen nsc = new NotesScreen(ch
 						.getCacheDetails(true));
 				nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
 				if (isBigScreen)
-					mNotes.setText(thisCache.getCacheDetails(true).getCacheNotes());
+					cacheNotes.setText(ch.getCacheDetails(true).getCacheNotes());
+				
 			} else if (ev.target == btnShowMap) {
-				Global.mainTab.SwitchToMovingMap(thisCache.pos, true);
+				Global.mainTab.SwitchToMovingMap(ch.pos, true);
+				
 			} else if (ev.target == btnShowBug) {
-				TravelbugInCacheScreen ts = new TravelbugInCacheScreen(thisCache.getCacheDetails(true).Travelbugs.toHtml(),	&quot;Travelbugs&quot;);
+				TravelbugInCacheScreen ts = new TravelbugInCacheScreen(ch.getCacheDetails(true).Travelbugs.toHtml(),	&quot;Travelbugs&quot;);
 				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
+				
 			} else if (ev.target == btnCenter) {
-				CWPoint cp = new CWPoint(thisCache.LatLon);
+				CWPoint cp = new CWPoint(ch.LatLon);
 				if (!cp.isValid()) {
 					MessageBox tmpMB = new MessageBox(
 							MyLocale.getMsg(312, &quot;Error&quot;),
@@ -504,9 +610,10 @@
 					pref.curCentrePt.set(cp);
 					Global.mainTab.updateBearDist();
 				}
+				
 			} else if (ev.target == btnAddDateTime) {
 				dirty_notes = true;
-				String note = thisCache.getCacheDetails(true).getCacheNotes();
+				String note = ch.getCacheDetails(true).getCacheNotes();
 				Time dtm = new Time();
 				dtm.getTime();
 				dtm.setFormat(&quot;E dd.MM.yyyy '/' HH:mm&quot;);
@@ -515,55 +622,62 @@
 				else
 					note = note + dtm.toString();
 				note = note + &quot;\n&quot;;
-				thisCache.getCacheDetails(true).setCacheNotes(note);
+				ch.getCacheDetails(true).setCacheNotes(note);
 				//FIXME: better use saveDirtyWaypoint()?
-				thisCache.save();
+				ch.save();
+				
 			} else if (ev.target == btnAddPicture) {
-				thisCache.getCacheDetails(true).addUserImage(profile);
+				ch.getCacheDetails(true).addUserImage(profile);
+				
 			} else if (ev.target == btnBlack) {
-				if (thisCache.is_black()) {
-					//FIXME: only change thisCache in save routine
-					thisCache.setBlack(false);
-					btnBlack.image = imgBlackNo;
-				} else {
-					//FIXME: only change thisCache in save routine
-					thisCache.setBlack(true);
-					btnBlack.image = imgBlack;
-				}
-				//FIXME: during display of details only the GUI should be relevant
-				// and we collect results at the end
-				blackStatus = thisCache.is_black();
-				thisCache.setAttributesToAddiWpts();
-				btnBlack.repaintNow();
-				dirty_details = true;
-				blackStatusChanged = true;
+				toggleBlackStatus();
+//				if (ch.is_black()) {
+//					//FIXME: only change thisCache in save routine
+//					ch.setBlack(false);
+//					btnBlack.image = imgBlackNo;
+//				} else {
+//					//FIXME: only change thisCache in save routine
+//					ch.setBlack(true);
+//					btnBlack.image = imgBlack;
+//				}
+//				//FIXME: during display of details only the GUI should be relevant
+//				// and we collect results at the end
+//				blackStatus = ch.is_black();
+//				
+//				btnBlack.repaintNow();
+////				dirty_details = true;
+//				blackStatusChanged = true;
+				
 			} else if (ev.target == btnNewWpt) {
-				CacheHolder ch = new CacheHolder();
-				ch.LatLon = thisCache.LatLon;
-				ch.pos = new CWPoint(thisCache.pos);
-				ch.setType(CacheType.CW_TYPE_STAGE);
-				ch.setHard(CacheTerrDiff.CW_DT_UNSET);
-				ch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
-				ch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
-				Global.mainTab.newWaypoint(ch);
+				CacheHolder newch = new CacheHolder();
+				newch.LatLon = ch.LatLon;
+				newch.pos = new CWPoint(ch.pos);
+				newch.setType(CacheType.CW_TYPE_STAGE);
+				newch.setHard(CacheTerrDiff.CW_DT_UNSET);
+				newch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
+				newch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
+				Global.mainTab.newWaypoint(newch);
+				
 			} else if (ev.target == btnGoto) {
 				// FIXME: if something changed saveDirtyWaypoint();
-				Global.mainTab.gotoP.setDestinationAndSwitch(thisCache);
-			} else if (ev.target == btnWayLoc) {
-				CWPoint coords = new CWPoint(btnWayLoc.getText(), CWPoint.CW);
+				Global.mainTab.gotoP.setDestinationAndSwitch(ch);
+				
+			} else if (ev.target == btnCoordinates) {
+				CWPoint coords = new CWPoint(btnCoordinates.getText(), CWPoint.CW);
 				CoordsScreen cs = new CoordsScreen(true);
 				cs.setFields(coords, CWPoint.CW);
 				if (cs.execute() == FormBase.IDOK) {
-					dirty_details = true;
+//					dirty_details = true;
+					//FIXME: don't do this, use save funktion instead!!
 					coords = cs.getCoords();
-					Global.getProfile().notifyUnsavedChanges(!thisCache.pos.toString().equals(coords.toString()));
-					thisCache.pos.set(coords);
-					btnWayLoc.setText(coords.toString());
-					thisCache.LatLon = coords.toString();
+					Global.getProfile().notifyUnsavedChanges(!ch.pos.toString().equals(coords.toString()));
+					ch.pos.set(coords);
+					btnCoordinates.setText(coords.toString());
+					ch.LatLon = coords.toString();
 					// If the current centre is valid, calculate the distance and bearing to it
 					CWPoint centre = Global.getPref().curCentrePt;
 					if (centre.isValid())
-						thisCache.calcDistance(centre);
+						ch.calcDistance(centre);
 				}
 			} else if (ev.target == btnFoundDate) {
 				// DateChooser.dayFirst=true;
@@ -587,11 +701,11 @@
 				dc.reset(t);
 				if (dc.execute() == ewe.ui.FormBase.IDOK) {
 					chcStatus.setText(MyLocale.getMsg(318, &quot;Found&quot;) + &quot; &quot;
-									+ Convert.toString(dc.year) + &quot;-&quot;
-									+ MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-									+ MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
-									+ dc.time);
-					dirty_details = true;
+							+ Convert.toString(dc.year) + &quot;-&quot;
+							+ MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
+							+ MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
+							+ dc.time);
+//					dirty_details = true;
 					// profile.hasUnsavedChanges=true;
 				}
 			} else if (ev.target == btnHiddenDate) {
@@ -609,41 +723,41 @@
 					} catch (NumberFormatException e) {
 						dc.reset(new Time());
 					}
-				if (dc.execute() == ewe.ui.FormBase.IDOK) {
-					inpHidden.setText(Convert.toString(dc.year) + &quot;-&quot;
-							+ MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-							+ MyLocale.formatLong(dc.day, &quot;00&quot;));
-					dirty_details = true;
-					// profile.hasUnsavedChanges=true;
-				}
+					if (dc.execute() == ewe.ui.FormBase.IDOK) {
+						inpHidden.setText(Convert.toString(dc.year) + &quot;-&quot;
+								+ MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
+								+ MyLocale.formatLong(dc.day, &quot;00&quot;));
+//						dirty_details = true;
+						// profile.hasUnsavedChanges=true;
+					}
 			} else if (ev.target == btnTerr) {
 				int returnValue;
-				TerrDiffForm tdf = new TerrDiffForm(true, thisCache
+				TerrDiffForm tdf = new TerrDiffForm(true, ch
 						.getTerrain());
 				returnValue = tdf.execute();
-				if (returnValue == 1 &amp;&amp; tdf.getDT() != thisCache.getTerrain()) {
+				if (returnValue == 1 &amp;&amp; tdf.getDT() != ch.getTerrain()) {
 					//FIXME: do this when waypoint is checked for saving
-					thisCache.setTerrain(tdf.getDT());
+					ch.setTerrain(tdf.getDT());
 					btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + &quot;: &quot;
-							+ CacheTerrDiff.longDT(thisCache.getTerrain()));
-					dirty_details = true;
+							+ CacheTerrDiff.longDT(ch.getTerrain()));
+//					dirty_details = true;
 				}
 			} else if (ev.target == btnDiff) {
 				int returnValue;
-				TerrDiffForm tdf = new TerrDiffForm(false, thisCache.getHard());
+				TerrDiffForm tdf = new TerrDiffForm(false, ch.getHard());
 				returnValue = tdf.execute();
-				if (returnValue == 1 &amp;&amp; tdf.getDT() != thisCache.getHard()) {
+				if (returnValue == 1 &amp;&amp; tdf.getDT() != ch.getHard()) {
 					//FIXME: do this when waypoint is checked for saving
-					thisCache.setHard(tdf.getDT());
+					ch.setHard(tdf.getDT());
 					btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: &quot;
-							+ CacheTerrDiff.longDT(thisCache.getHard()));
-					dirty_details = true;
+							+ CacheTerrDiff.longDT(ch.getHard()));
+//					dirty_details = true;
 				}
 			}
 			ev.consumed = true;
 		}
 	}
-	
+
 	/** allow user input on control item */
 	private void activateControl(Control ctrl) {
 		if (ctrl.change(0, ControlConstants.Disabled))
@@ -655,38 +769,16 @@
 		if (ctrl.change(ControlConstants.Disabled, 0))
 			ctrl.repaint();
 	}
-	
-	private void saveIfNeeded() {
-//		boolean saveWpt = false;
-//		boolean renameWpt = false;
-//		int newdiff;
-//		int newTerr;
-//	
-//		Objects to check:
-//		if (!this.inpName.equals(thisCache.getCacheName()))
-//			saveWpt = true;
-//		if (!this.inpHidden.equals(thisCache.getDateHidden()))
-//			saveWpt = true;
-//		if (!this.inpOwner.equals(thisCache.getCacheOwner()))
-//			saveWpt = true;
-//		if (!this.inpWaypoint.equals(thisCache.getWayPoint())) {
-//			saveWpt = true;
-//			renameWpt = true;
-//		}
-//		if (!this.chcSize)
-//		if (!this.chcStatus)
-//		if (!this.chcType)
-//		if (newdiff)
-//		if (newterr)
-//		if (btnBlack.getImage()
-	}
 
+
+
+
 	public void saveDirtyWaypoint() {
 		//FIXME: here we should check if the data is now different from what it used to be when calling the details panel instead of relying on dirty flags
 		//FIXME: take care of renaming waypoints
 		//FIXME: add method to convert back text of difficulty &amp; terrain buttons
 		//FIXME: check if manual changes have converted a cache from incomplete to complete
-		
+
 		// We have to update two objects: thisCache (a CacheHolderDetail) which
 		// contains
 		// the full cache which will be written to the cache.xml file AND
@@ -694,57 +786,70 @@
 		// Strip the found message if the status contains a date
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, &quot;Found&quot;))
 				&amp;&amp; chcStatus.getText().length() &gt;= MyLocale
-						.getMsg(318, &quot;Found&quot;).length() + 11) {
-			thisCache.setCacheStatus(chcStatus.getText().substring(
+				.getMsg(318, &quot;Found&quot;).length() + 11) {
+			ch.setCacheStatus(chcStatus.getText().substring(
 					MyLocale.getMsg(318, &quot;Found&quot;).length() + 1));
 		} else {
-			thisCache.setCacheStatus(chcStatus.getText());
+			ch.setCacheStatus(chcStatus.getText());
 		}
-		if (!thisCache.is_found() &amp;&amp; thisCache.getCacheStatus().length() &gt;= 10
-				&amp;&amp; thisCache.getCacheStatus().charAt(4) == '-') {
+		
+		if (!ch.is_found() &amp;&amp; ch.getCacheStatus().length() &gt;= 10
+				&amp;&amp; ch.getCacheStatus().charAt(4) == '-') {
 			// Use same heuristic condition as in setDetails(CacheHolder) to
 			// determine, if this
 			// cache
 			// has to considered as found.
-			thisCache.setFound(true);
+			ch.setFound(true);
 		} else {
-			thisCache.setFound(chcStatus.getText().startsWith(
+			ch.setFound(chcStatus.getText().startsWith(
 					MyLocale.getMsg(318, &quot;Found&quot;)));
 		}
-		thisCache.setCacheOwner(inpOwner.getText().trim());
-		thisCache.setOwned(thisCache.getCacheStatus().equals(
+		
+		ch.setCacheOwner(inpOwner.getText().trim());
+		
+		ch.setOwned(ch.getCacheStatus().equals(
 				MyLocale.getMsg(320, &quot;Owner&quot;)));
 		// Avoid setting is_owned if alias is empty and username is empty
-		if (thisCache.is_owned() == false) {
-			thisCache.setOwned((!pref.myAlias.equals(&quot;&quot;) &amp;&amp; pref.myAlias
-					.equals(thisCache.getCacheOwner()))
+		if (ch.is_owned() == false) {
+			ch.setOwned((!pref.myAlias.equals(&quot;&quot;) &amp;&amp; pref.myAlias
+					.equals(ch.getCacheOwner()))
 					|| (!pref.myAlias2.equals(&quot;&quot;) &amp;&amp; pref.myAlias2
-							.equals(thisCache.getCacheOwner())));
+							.equals(ch.getCacheOwner())));
 		}
-		thisCache.setBlack(blackStatus);
-		String oldWaypoint = thisCache.getWayPoint();
-		thisCache.setWayPoint(inpWaypoint.getText().toUpperCase().trim());
-		thisCache.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize
+		
+		ch.setBlack(blackStatus);
+		
+		String oldWaypoint = ch.getWayPoint();
+		ch.setWayPoint(inpWaypoint.getText().toUpperCase().trim());
+		
+		ch.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize
 				.getText()));
+		
 		// If the waypoint does not have a name, give it one
-		if (thisCache.getWayPoint().equals(&quot;&quot;)) {
-			thisCache.setWayPoint(profile.getNewWayPointName());
+		if (ch.getWayPoint().equals(&quot;&quot;)) {
+			ch.setWayPoint(profile.getNewWayPointName());
 		}
+		
 		// Don't allow single letter names=&gt; Problems in updateBearingDistance
 		// This is a hack but faster than slowing down the loop in
 		// updateBearingDistance
-		if (thisCache.getWayPoint().length() &lt; 2)
-			thisCache.setWayPoint(thisCache.getWayPoint() + &quot; &quot;);
-		thisCache.setCacheName(inpName.getText().trim());
-		thisCache.LatLon = thisCache.pos.toString();
-		thisCache.setDateHidden(inpHidden.getText().trim());
-		byte oldType = thisCache.getType();
-		thisCache.setType(CacheType.guiSelect2Cw(chcType.getInt()));
+		if (ch.getWayPoint().length() &lt; 2)
+			ch.setWayPoint(ch.getWayPoint() + &quot; &quot;);
+		
+		ch.setCacheName(inpName.getText().trim());
+		
+		ch.LatLon = ch.pos.toString();
+		
+		ch.setDateHidden(inpHidden.getText().trim());
+		
+		byte oldType = ch.getType();
+		ch.setType(CacheType.guiSelect2Cw(chcType.getInt()));
+		
 		// thisCache.saveCacheDetails(profile.dataDir); // this is redundant,
 		// because all changes
 		// affecting the details are immediately saved
 		// Now update the table
-		CacheHolder ch = thisCache; // TODO variable ch is redundant
+		
 
 		/*
 		 * The references have to be rebuilt if: - the cachetype changed from
@@ -753,7 +858,7 @@
 		 */
 		if (CacheType.isAddiWpt(ch.getType()) != CacheType.isAddiWpt(oldType)
 				|| ((CacheType.isAddiWpt(ch.getType()) || CacheType
-						.isAddiWpt(oldType)) &amp;&amp; !thisCache.getWayPoint()
+						.isAddiWpt(oldType)) &amp;&amp; !ch.getWayPoint()
 						.equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
 			if (CacheType.isAddiWpt(ch.getType())) {
@@ -770,16 +875,16 @@
 						(new MessageBox(
 								MyLocale.getMsg(144, &quot;Warning&quot;),
 								MyLocale.getMsg(734,&quot;No main cache found for addi waypoint &quot;)
-										+ &quot; &quot;+ ch.getWayPoint()+ &quot;\n&quot;
-										+ MyLocale.getMsg(735,&quot;Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC&quot;),
+								+ &quot; &quot;+ ch.getWayPoint()+ &quot;\n&quot;
+								+ MyLocale.getMsg(735,&quot;Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC&quot;),
 								FormBase.OKB)).execute();
 				}
 				profile.buildReferences(); // TODO this takes quite long -&gt; use
-											// profile.setAddiRef
+				// profile.setAddiRef
 				// instead
 			} else {
 				profile.buildReferences(); // we have to do this to release the
-											// link between the
+				// link between the
 				// two caches
 			}
 		}
@@ -787,13 +892,13 @@
 		ch.setAttributesToAddiWpts();
 		ch.checkIncomplete();
 		dirty_notes = false;
-		dirty_details = false;
+//		dirty_details = false;
 		setNeedsTableUpdate(false);
-		thisCache.getFreshDetails().hasUnsavedChanges = true;
+		ch.getFreshDetails().hasUnsavedChanges = true;
 	}
-	
+
 	public String getDisplayedWaypoint() {
-		return thisCache.getWayPoint();
+		return ch.getWayPoint();
 	}
 
 	private class TravelbugInCacheScreen extends Form {
@@ -832,14 +937,14 @@
 				TBMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(
 						6016, &quot;Pick up Travelbug&quot;));
 				TBMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6017,
-						&quot;Drop Travelbug&quot;));
+				&quot;Drop Travelbug&quot;));
 				mnuPopup = new Menu(TBMenuItems, &quot;&quot;);
 			}
 
 			public void penRightReleased(Point p) {
 				setMenu(mnuPopup);
 				doShowMenu(p); // direct call (not through doMenu) is neccesary
-								// because it will
+				// because it will
 				// exclude the whole table
 			}
 
@@ -850,20 +955,20 @@
 
 			public void popupMenuEvent(Object selectedItem) {
 				if (selectedItem == mnuPickupTB) {
-					Travelbug tb = TravelbugPickup.pickupTravelbug(thisCache.getCacheDetails(true).Travelbugs);
+					Travelbug tb = TravelbugPickup.pickupTravelbug(ch.getCacheDetails(true).Travelbugs);
 					if (tb != null) {
-						dirty_details = true;
+//						dirty_details = true;
 						// Get the list of my travelbugs
 						tbjList = new TravelbugJourneyList();
 						tbjList.readTravelbugsFile();
 						// Add the tb to this list
 						tbjList.addTbPickup(tb, Global.getProfile().name,
-								thisCache.getWayPoint());
+								ch.getWayPoint());
 						tbjList.saveTravelbugsFile();
 						tbjList = null;
-						setHtml(thisCache.getCacheDetails(true).Travelbugs.toHtml());
+						setHtml(ch.getCacheDetails(true).Travelbugs.toHtml());
 						repaint();
-						thisCache.setHas_bugs(thisCache.getCacheDetails(true).Travelbugs.size() &gt; 0);
+						ch.setHas_bugs(ch.getCacheDetails(true).Travelbugs.size() &gt; 0);
 					}
 				} else if (selectedItem == mnuDropTB) {
 					tbjList = new TravelbugJourneyList();
@@ -874,16 +979,16 @@
 					tbs.execute();
 					if (tbs.selectedItem &gt;= 0) {
 						Travelbug tb = tbl.getTB(tbs.selectedItem);
-						thisCache.getCacheDetails(true).Travelbugs.add(tb);
+						ch.getCacheDetails(true).Travelbugs.add(tb);
 						tbjList.addTbDrop(tb, Global.getProfile().name,
-								thisCache.getWayPoint());
+								ch.getWayPoint());
 					}
 					tbjList.saveTravelbugsFile();
 					tbjList = null;
-					thisCache.setHas_bugs(thisCache.getCacheDetails(true).Travelbugs.size() &gt; 0);
-					setHtml(thisCache.getCacheDetails(true).Travelbugs.toHtml());
+					ch.setHas_bugs(ch.getCacheDetails(true).Travelbugs.size() &gt; 0);
+					setHtml(ch.getCacheDetails(true).Travelbugs.toHtml());
 					repaint();
-					dirty_details = true;
+//					dirty_details = true;
 				} else
 					super.popupMenuEvent(selectedItem);
 			}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001974.html">[Cachewolf-svn] r2052 - experiments/greiol/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="001976.html">[Cachewolf-svn] r2054 - trunk/res_noewe
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1975">[ date ]</a>
              <a href="thread.html#1975">[ thread ]</a>
              <a href="subject.html#1975">[ subject ]</a>
              <a href="author.html#1975">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
