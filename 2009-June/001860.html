<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r1941 - in trunk: res_noewe/languages src/CacheWolf	src/exp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-June/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r1941%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/exp&In-Reply-To=%3C200906241727.n5OHRpXU006814%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001859.html">
   <LINK REL="Next"  HREF="001861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r1941 - in trunk: res_noewe/languages src/CacheWolf	src/exp</H1>
    <B>greiol at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r1941%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf%0A%09src/exp&In-Reply-To=%3C200906241727.n5OHRpXU006814%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r1941 - in trunk: res_noewe/languages src/CacheWolf	src/exp">greiol at mail.berlios.de
       </A><BR>
    <I>Wed Jun 24 19:27:51 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001859.html">[Cachewolf-svn] r1940 - trunk/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="001861.html">[Cachewolf-svn] r1942 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1860">[ date ]</a>
              <a href="thread.html#1860">[ thread ]</a>
              <a href="subject.html#1860">[ subject ]</a>
              <a href="author.html#1860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: greiol
Date: 2009-06-24 19:27:40 +0200 (Wed, 24 Jun 2009)
New Revision: 1941

Removed:
   trunk/src/exp/PCX5Exporter.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/exp/GpxExportNg.java
Log:
removed obsolete pcx5 exporter
added experimental more mapsource oriented gpx exporter for general testing

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-06-24 13:46:27 UTC (rev 1940)
+++ trunk/res_noewe/languages/DE.cfg	2009-06-24 17:27:40 UTC (rev 1941)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{de}
 		100=nach HTML
-		101=nach PCX5 Mapsource
+		101=nach GPX Mapsource
 		102=nach TOP50 ASCII
 		103=nach GPX
 		104=nach CSV

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-06-24 13:46:27 UTC (rev 1940)
+++ trunk/res_noewe/languages/EN.cfg	2009-06-24 17:27:40 UTC (rev 1941)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{en}
 		100=to HTML
-		101=to PCX5 Mapsource
+		101=to GPX Mapsource
 		102=to TOP50 ASCII
 		103=to GPX
 		104=to ASC

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-06-24 13:46:27 UTC (rev 1940)
+++ trunk/res_noewe/languages/FR.cfg	2009-06-24 17:27:40 UTC (rev 1941)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{fr}
 		100=vers HTML
-		101=vers PCX5 Mapsource
+		101=vers GPX Mapsource
 		102=vers TOP50 ASCII
 		103=vers GPX
 		104=vers CSV

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-06-24 13:46:27 UTC (rev 1940)
+++ trunk/res_noewe/languages/NL.cfg	2009-06-24 17:27:40 UTC (rev 1941)
@@ -2,7 +2,7 @@
 	{LocalResources}
 		{nl}
 		100=naar HTML
-		101=naar PCX5 MapSource
+		101=naar GPX MapSource
 		102=naar TOP50 ASCII
 		103=naar GPX
 		104=naar CSV

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-06-24 13:46:27 UTC (rev 1940)
+++ trunk/src/CacheWolf/MainMenu.java	2009-06-24 17:27:40 UTC (rev 1941)
@@ -28,7 +28,7 @@
 	private MenuItem downloadmap, kalibmap, importmap;
 	private MenuItem spider, spiderAllFinds, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
-	private MenuItem exportpcx5, exporthtml, exporttop50, exportGPX, exportASC, exportTomTom, exportMSARCSV;
+	private MenuItem exportGpxNg, exporthtml, exporttop50, exportGPX, exportASC, exportTomTom, exportMSARCSV;
 	private MenuItem exportOZI, exportKML, exportTPL, exportExplorist;
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
 	private MenuItem exportLOC, exportGPS, mnuSeparator;
@@ -73,7 +73,7 @@
 		MenuItem[] exitems = new MenuItem[13];
 		//Vm.debug(&quot;Hi in MainMenu &quot;+lr);
 		exitems[0] = exporthtml = new MenuItem(MyLocale.getMsg(100,&quot;to HTML&quot;));
-		exitems[1] = exportpcx5 = new MenuItem(MyLocale.getMsg(101,&quot;to PCX5 Mapsource&quot;));
+		exitems[1] = exportGpxNg = new MenuItem(MyLocale.getMsg(101,&quot;to GPX Test&quot;));
 		exitems[2] = exporttop50 = new MenuItem(MyLocale.getMsg(102,&quot;to TOP50 ASCII&quot;));
 		exitems[3] = exportGPX = new MenuItem(MyLocale.getMsg(103,&quot;to GPX&quot;));
 		exitems[4] = exportASC = new MenuItem(MyLocale.getMsg(104,&quot;to CSV&quot;));
@@ -379,16 +379,15 @@
 				HTMLExporter htm = new HTMLExporter(pref, profile);
 				htm.doIt();
 			}
-			if(mev.selectedItem == exportpcx5){
-				PCX5Exporter pcx = new PCX5Exporter( pref, profile);
-				pcx.doIt(PCX5Exporter.MODE_ASK);
+			if(mev.selectedItem == exportGpxNg){
+				GpxExportNg gpx = new GpxExportNg();
+				gpx.doit();
 			} 
 			if(mev.selectedItem == exporttop50){
 				OVLExporter ovl = new OVLExporter(pref, profile);
 				ovl.doIt();
 			}
 			if(mev.selectedItem == exportGPX){
-//				GpxExportNg gpx = new GpxExportNg();
 				GPXExporter gpx = new GPXExporter(pref,profile);
 				gpx.doIt(1);
 			}

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-06-24 13:46:27 UTC (rev 1940)
+++ trunk/src/exp/GpxExportNg.java	2009-06-24 17:27:40 UTC (rev 1941)
@@ -6,6 +6,7 @@
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
+import CacheWolf.Common;
 import CacheWolf.Global;
 import CacheWolf.Log;
 import CacheWolf.LogList;
@@ -38,7 +39,6 @@
 import ewe.util.Iterator;
 import ewe.util.Random;
 
-//TODO: use safexml a lot more (at least start using it ;) )
 
 /**
  * experimental GPX exporter that should better handle the various tasks that
@@ -173,7 +173,7 @@
 			}
 			
 			if (sendToGarmin) {
-				tempDir = baseDir+File.separator+this.getClass().toString(); //FIXME: get from dialog
+				tempDir = baseDir+File.separator+this.getClass().toString();
 				new File(tempDir).mkdir();
 			} else {
 				tempDir = outDir;
@@ -253,7 +253,6 @@
 				
 				pbf.exit(0);
 				
-				//TODO: connect with image and build garmin poi file
 			} catch (Exception e) {
 				e.printStackTrace();
 				pbf.exit(0);
@@ -368,25 +367,39 @@
 
 		if (smartIds &amp;&amp; ch.getType() != CacheType.CW_TYPE_CUSTOM) {
 			if (ch.isAddiWpt()) {
-				trans.add(new Regex(&quot;@@WPNAME@@&quot;, ch.mainCache.getWayPoint()
-						.concat(&quot; &quot;).concat(ch.getWayPoint().substring(0, 2))));
+				trans.add(new Regex(&quot;@@WPNAME@@&quot;, SafeXML.cleanGPX(ch.mainCache.getWayPoint()
+						.concat(&quot; &quot;)
+						.concat(ch.getWayPoint().substring(0, 2))
+						)));
 			} else {
-				trans.add(new Regex(&quot;@@WPNAME@@&quot;, ch.getWayPoint()
+				trans.add(new Regex(&quot;@@WPNAME@@&quot;, SafeXML.cleanGPX(ch.getWayPoint()
 						.concat(&quot; &quot;)
 						.concat(CacheType.getExportShortId(ch.getType()))
 						.concat(String.valueOf(ch.getTerrain()))
 						.concat(String.valueOf(ch.getHard()))
-						.concat(CacheSize.getExportShortId(ch.getCacheSize()))));
+						.concat(CacheSize.getExportShortId(ch.getCacheSize()))
+						)));
 			}
 		} else {
 			trans.add(new Regex(&quot;@@WPNAME@@&quot;, ch.getWayPoint()));
 		}
-
-		if (ch.isAddiWpt() || ch.getType() == CacheType.CW_TYPE_CUSTOM) {
-			trans.add(new Regex(&quot;@@WPCMT@@&quot;,
-					SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)));
+		
+		if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+			trans.add(new Regex(&quot;@@WPCMT@@&quot;, SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)));
 		} else {
-			trans.add(new Regex(&quot;@@WPCMT@@&quot;, &quot;&quot;));
+			if (smartIds &amp;&amp; outType == GPX_COMPACT) {
+				if (ch.isAddiWpt()) {
+					trans.add(new Regex(&quot;@@WPCMT@@&quot;, SafeXML.cleanGPX(ch.getCacheName()+&quot; &quot;+ch.getFreshDetails().LongDescription)));
+				} else {
+					trans.add(new Regex(&quot;@@WPCMT@@&quot;, SafeXML.cleanGPX(ch.getCacheName()+&quot; &quot;+Common.rot13(ch.getFreshDetails().Hints))));
+				}
+			} else {
+				if (ch.isAddiWpt()) {
+					trans.add(new Regex(&quot;@@WPCMT@@&quot;, SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)));
+				} else {
+					trans.add(new Regex(&quot;@@WPCMT@@&quot;, &quot;&quot;));
+				}
+			}
 		}
 
 		if (ch.isAddiWpt()) {

Deleted: trunk/src/exp/PCX5Exporter.java
===================================================================
--- trunk/src/exp/PCX5Exporter.java	2009-06-24 13:46:27 UTC (rev 1940)
+++ trunk/src/exp/PCX5Exporter.java	2009-06-24 17:27:40 UTC (rev 1941)
@@ -1,65 +0,0 @@
-package exp;
-import CacheWolf.*;
-import ewe.io.FileBase;
-
-/**
-*	Class to export the cache database into an ascii file that may be imported
-*	ba Mapsource (c) by Garmin.
-*/
-public class PCX5Exporter extends Exporter{
-	public static int MODE_AUTO = TMP_FILE;
-	public static int MODE_ASK = ASK_FILE;
-	
-	public PCX5Exporter(Preferences p, Profile prof){
-		super();
-		this.setMask(&quot;*.wpt&quot;);
-		this.setTmpFileName(FileBase.getProgramDirectory() + &quot;/temp.pcx&quot;);
-		this.setHowManyParams(NO_PARAMS);
-	}
-	
-	public String header () {
-		StringBuffer strBuf = new StringBuffer(200);
-
-		strBuf.append(&quot;H  SOFTWARE NAME &amp; VERSION\n&quot;);
-		strBuf.append(&quot;I  PCX5 2.09\n&quot;);
-		strBuf.append(&quot;\n&quot;);
-		strBuf.append(&quot;H  R DATUM                IDX DA            DF            DX            DY            DZ\n&quot;);
-		strBuf.append(&quot;M  G WGS 84               121 +0.000000e+00 +0.000000e+00 +0.000000e+00 +0.000000e+00 +0.000000e+00\n&quot;);
-		strBuf.append(&quot;\n&quot;);
-		strBuf.append(&quot;H  COORDINATE SYSTEM\n&quot;);
-		strBuf.append(&quot;U  LAT LON DM\n&quot;);
-		strBuf.append(&quot;\n&quot;);
-		strBuf.append(&quot;H  IDNT   LATITUDE  LONGITUDE      DATE      TIME     ALT   DESCRIPTION                              PROXIMITY     SYMBOL ;waypts\r\n&quot;);
-		
-		return strBuf.toString();
-	}
-	
-	public String record(CacheHolder ch){
-		StringBuffer strBuf = new StringBuffer(200);
-		String latlonstr, dummy;
-
-		  strBuf.append(&quot;W  &quot; + ch.getWayPoint() + &quot; &quot;);
-		  latlonstr = STRreplace.replace(ch.LatLon, &quot;&#176;&quot;, &quot; &quot;);
-		  latlonstr = STRreplace.replace(latlonstr, &quot; &quot;, &quot;&quot;);
-		  latlonstr = STRreplace.replace(latlonstr, &quot;E&quot;, &quot; E&quot;);
-		  latlonstr = STRreplace.replace(latlonstr, &quot;W&quot;, &quot; W&quot;);
-		  strBuf.append(latlonstr + &quot;     &quot;);
-		  strBuf.append(&quot;01-JAN-04 01:00:00 -0000 &quot;);
-		  // has 42 characters
-		  dummy = ch.getCacheName();
-		  if (dummy.length() &lt; 40){
-			  strBuf.append(dummy);
-			  int i = 40 - dummy.length();
-			  for (; i &gt; 0; i--){
-				  strBuf.append(' ');
-			  }
-		  } else {
-			  strBuf.append(dummy.substring(0,40));
-		  }
-		  strBuf.append(&quot; 0.000000e+000 &quot;);
-		  if(ch.is_found()) strBuf.append(&quot;  8256\r\n&quot;);
-		  else  		  strBuf.append(&quot;  8255\r\n&quot;);
-		return strBuf.toString();
-	}
-	
-}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001859.html">[Cachewolf-svn] r1940 - trunk/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="001861.html">[Cachewolf-svn] r1942 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1860">[ date ]</a>
              <a href="thread.html#1860">[ thread ]</a>
              <a href="subject.html#1860">[ subject ]</a>
              <a href="author.html#1860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
