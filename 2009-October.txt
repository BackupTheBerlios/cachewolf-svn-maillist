From pfeffer at mail.berlios.de  Thu Oct  1 00:12:11 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 1 Oct 2009 00:12:11 +0200
Subject: [Cachewolf-svn] r2227 - trunk/res_noewe/webmapservices
Message-ID: <200909302212.n8UMCBi8024614@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-01 00:12:09 +0200 (Thu, 01 Oct 2009)
New Revision: 2227

Modified:
   trunk/res_noewe/webmapservices/it_t25.wms
Log:
WMS: Make the wms for Italy tk 25 better (scale range tested, image format tested)

Modified: trunk/res_noewe/webmapservices/it_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/it_t25.wms	2009-09-30 20:04:02 UTC (rev 2226)
+++ trunk/res_noewe/webmapservices/it_t25.wms	2009-09-30 22:12:09 UTC (rev 2227)
@@ -15,10 +15,13 @@
 #LayersUrlPart:     LAYERS=igm25,igm25_f32,igm25_f33
 LayersUrlPart:     LAYERS=igm25
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/jpeg
+# .jpg : 200 KB, .gif: 300 KB, .png: 1800 KB
+# .jpg appears white in sun-vm --> use .gif, that works on both VMs 
+ImageFormatUrlPart:FORMAT=image/gif
 BoundingBoxTopLeftWGS84: N 48.0000 E 6.0000
 BoundingBoxButtomRightWGS84: N 36.0000 E 19.0000
+# min and maxScale found by testing the server (pfeffer 1-10-2009)
 MinScale:   0
-MaxScale:   45
-RecommendedScale:   2,5
-ImageFileExtension: .jpg
+MaxScale:   6.6
+RecommendedScale:   2.5
+ImageFileExtension: .gif



From araber95 at mail.berlios.de  Thu Oct  1 12:15:43 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 1 Oct 2009 12:15:43 +0200
Subject: [Cachewolf-svn] r2228 - trunk/src/CacheWolf
Message-ID: <200910011015.n91AFh1k006015@sheep.berlios.de>

Author: araber95
Date: 2009-10-01 12:15:42 +0200 (Thu, 01 Oct 2009)
New Revision: 2228

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
Log:
hopefully final correction for new feature "MapsPath for each Profile" : Handling special UTF-8/Unicode characters : writing profile index.xml with SafeXML.clean; : reading pref.xml with SafeXML.cleanback, though parse already does a part reconverting.

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-09-30 22:12:09 UTC (rev 2227)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-01 10:15:42 UTC (rev 2228)
@@ -453,7 +453,7 @@
 			if (tmp != null) solverDegMode=Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("mapspath")) {
-			customMapsPath=atts.getValue("dir").replace('\\', '/');
+			customMapsPath=SafeXML.cleanback(atts.getValue("dir")).replace('\\', '/');
 		}
 		else if (name.equals("debug")) debug=Boolean.valueOf(atts.getValue("value")).booleanValue();
 

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-09-30 22:12:09 UTC (rev 2227)
+++ trunk/src/CacheWolf/Profile.java	2009-10-01 10:15:42 UTC (rev 2228)
@@ -199,7 +199,7 @@
 			detfile.print(this.getCurrentFilter().toXML(""));
 			detfile.print("    <SYNCOC date = \""+getLast_sync_opencaching()+"\" dist = \""+getDistOC()+"\"/>\n");
 			detfile.print("    <SPIDERGC dist = \"" + getDistGC() + "\"/>\n");
-			detfile.print("    <mapspath relativeDir = \"" + relativeCustomMapsPath + "\"/>\n");
+			detfile.print("    <mapspath relativeDir = \"" + SafeXML.clean(relativeCustomMapsPath) + "\"/>\n");
 			int size = cacheDB.size();
 			for (int i = 0; i < size; i++) {
 				if (showprogress) {



From araber95 at mail.berlios.de  Thu Oct  1 22:19:22 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 1 Oct 2009 22:19:22 +0200
Subject: [Cachewolf-svn] r2229 - trunk/res_noewe/webmapservices
Message-ID: <200910012019.n91KJM2Q020996@sheep.berlios.de>

Author: araber95
Date: 2009-10-01 22:19:20 +0200 (Thu, 01 Oct 2009)
New Revision: 2229

Added:
   trunk/res_noewe/webmapservices/fr_t25.wms
   trunk/res_noewe/webmapservices/fr_t5.wms
   trunk/res_noewe/webmapservices/fr_t50.wms
Removed:
   trunk/res_noewe/webmapservices/fr_t.wms
Log:
WMS France updated for http://www.geosignal.org/cgi-bin/wmsmap?

Deleted: trunk/res_noewe/webmapservices/fr_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t.wms	2009-10-01 10:15:42 UTC (rev 2228)
+++ trunk/res_noewe/webmapservices/fr_t.wms	2009-10-01 20:19:20 UTC (rev 2229)
@@ -1,41 +0,0 @@
-TakenFromUrl:       http://www.geosignal.org/cgi-bin/wmsmap?version=1.1.1&service=WMS&request=GetLegendGraphic&layer=Voirie&format=image/png
-GetCapabilitiesUrl: http://www.geosignal.org/cgi-bin/wmsmap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               fr topo 4000
-MapType:                        topo
-MainUrl:            http://www.geosignal.org/cgi-bin/wmsmap?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=Serveur Geosignal|Serveur Geosignal||
-#LayersUrlPart:     LAYERS=Monde|Pays du monde||
-#LayersUrlPart:     LAYERS=RASTER4000k|Raster France 1/4 000 000|935.443|0
-#LayersUrlPart:     LAYERS=RASTER1000k|Raster France 1/1 000 000|280.633|935.443
-#LayersUrlPart:     LAYERS=RASTER500k|Raster France 1/500 000|140.316|280.633
-#LayersUrlPart:     LAYERS=RASTER250k|Raster France 1/250 000|65.481|140.316
-#LayersUrlPart:     LAYERS=RASTER100k|Raster France 1/100 000|28.0633|65.481
-#LayersUrlPart:     LAYERS=RASTER50k|Raster France 1/50 000|14.0316|28.0633
-#LayersUrlPart:     LAYERS=RASTER25k|Raster France 1/25 000|5.61266|14.0316
-#LayersUrlPart:     LAYERS=RASTER5k|Raster France 1/5 000|0.374177|5.61266
-#LayersUrlPart:     LAYERS=Communes|Communes||
-#LayersUrlPart:     LAYERS=Cantons|Cantons||
-#LayersUrlPart:     LAYERS=Arrondissements|Arrondissements||
-#LayersUrlPart:     LAYERS=Departements|Departements||
-#LayersUrlPart:     LAYERS=Regions|Regions||
-#LayersUrlPart:     LAYERS=Voirie|Voirie urbaine||
-#LayersUrlPart:     LAYERS=Autres|Autres equipements routiers||
-#LayersUrlPart:     LAYERS=Secondaires|Routes Secondaires||
-#LayersUrlPart:     LAYERS=Departementales|Routes Departementales||
-#LayersUrlPart:     LAYERS=Nationales|Routes Nationales||
-#LayersUrlPart:     LAYERS=Autoroutes|Autoroutes||
-#LayersUrlPart:     LAYERS=CommunesXY|Ponctuels des communes||
-LayersUrlPart:     LAYERS=RASTER4000k,Communes,Cantons,Arrondissements,Departements,Regions,Voirie,Autres,Secondaires,Departementales,Nationales,Autoroutes,CommunesXY
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
-BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/fr_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t25.wms	2009-10-01 10:15:42 UTC (rev 2228)
+++ trunk/res_noewe/webmapservices/fr_t25.wms	2009-10-01 20:19:20 UTC (rev 2229)
@@ -0,0 +1,55 @@
+TakenFromUrl:       http://www.geosignal.org/cgi-bin/wmsmap?version=1.1.1&service=WMS&request=GetLegendGraphic&layer=Voirie&format=image/png
+GetCapabilitiesUrl: http://www.geosignal.org/cgi-bin/wmsmap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               fr t25 SF=3..7
+MapType:                        topo
+MainUrl:            http://www.geosignal.org/cgi-bin/wmsmap?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+#CoordinateReferenceSystemCacheWolf:  27582
+#CoordinateReferenceSystemUrlPart: SRS=EPSG:27582 
+#      <SRS>EPSG:27582</SRS>
+#      <SRS>EPSG:27572</SRS>
+#      <SRS>EPSG:27563</SRS>
+#      <SRS>EPSG:27561</SRS>
+#      <SRS>EPSG:4269</SRS>
+#      <SRS>EPSG:4326</SRS>
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Serveur Geosignal|Serveur Geosignal||
+#LayersUrlPart:     LAYERS=Monde|Pays du monde||
+#LayersUrlPart:     LAYERS=RASTER4000k|Raster France 1/4 000 000|935.443|0
+#LayersUrlPart:     LAYERS=RASTER1000k|Raster France 1/1 000 000|280.633|935.443
+#LayersUrlPart:     LAYERS=RASTER500k|Raster France 1/500 000|140.316|280.633
+#LayersUrlPart:     LAYERS=RASTER250k|Raster France 1/250 000|65.481|140.316
+#LayersUrlPart:     LAYERS=RASTER100k|Raster France 1/100 000|28.0633|65.481
+#LayersUrlPart:     LAYERS=RASTER50k|Raster France 1/50 000|14.0316|28.0633
+#LayersUrlPart:     LAYERS=RASTER25k|Raster France 1/25 000|5.61266|14.0316
+#LayersUrlPart:     LAYERS=RASTER5k|Raster France 1/5 000|0.374177|5.61266
+#LayersUrlPart:     LAYERS=Communes|Communes||
+#LayersUrlPart:     LAYERS=Cantons|Cantons||
+#LayersUrlPart:     LAYERS=Arrondissements|Arrondissements||
+#LayersUrlPart:     LAYERS=Departements|Departements||
+#LayersUrlPart:     LAYERS=Regions|Regions||
+#LayersUrlPart:     LAYERS=Voirie|Voirie urbaine|1|5|Highways
+#LayersUrlPart:     LAYERS=Autres|Autres equipements routiers||
+#LayersUrlPart:     LAYERS=Secondaires|Routes Secondaires||
+#LayersUrlPart:     LAYERS=Departementales|Routes Departementales||
+#LayersUrlPart:     LAYERS=Nationales|Routes Nationales||
+#LayersUrlPart:     LAYERS=Autoroutes|Autoroutes||
+#LayersUrlPart:     LAYERS=CommunesXY|Ponctuels des communes||
+#LayersUrlPart:     LAYERS=Communes,Cantons,Arrondissements,Departements,Regions,Autres,Secondaires,Departementales,Nationales,Autoroutes,CommunesXY
+# working
+#LayersUrlPart:     LAYERS=RASTER5k SF=1(..2,5)
+#LayersUrlPart:     LAYERS=RASTER25k SF=3..7 ausgew?hlte St?dte?
+#LayersUrlPart:     LAYERS=RASTER50k SF=8..14
+#LayersUrlPart:     LAYERS=Voirie SF 1..10..
+LayersUrlPart:     LAYERS=RASTER25k
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
+BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/fr_t5.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t5.wms	2009-10-01 10:15:42 UTC (rev 2228)
+++ trunk/res_noewe/webmapservices/fr_t5.wms	2009-10-01 20:19:20 UTC (rev 2229)
@@ -0,0 +1,55 @@
+TakenFromUrl:       http://www.geosignal.org/cgi-bin/wmsmap?version=1.1.1&service=WMS&request=GetLegendGraphic&layer=Voirie&format=image/png
+GetCapabilitiesUrl: http://www.geosignal.org/cgi-bin/wmsmap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               fr t5 SF=1
+MapType:                        topo
+MainUrl:            http://www.geosignal.org/cgi-bin/wmsmap?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+#CoordinateReferenceSystemCacheWolf:  27582
+#CoordinateReferenceSystemUrlPart: SRS=EPSG:27582 
+#      <SRS>EPSG:27582</SRS>
+#      <SRS>EPSG:27572</SRS>
+#      <SRS>EPSG:27563</SRS>
+#      <SRS>EPSG:27561</SRS>
+#      <SRS>EPSG:4269</SRS>
+#      <SRS>EPSG:4326</SRS>
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Serveur Geosignal|Serveur Geosignal||
+#LayersUrlPart:     LAYERS=Monde|Pays du monde||
+#LayersUrlPart:     LAYERS=RASTER4000k|Raster France 1/4 000 000|935.443|0
+#LayersUrlPart:     LAYERS=RASTER1000k|Raster France 1/1 000 000|280.633|935.443
+#LayersUrlPart:     LAYERS=RASTER500k|Raster France 1/500 000|140.316|280.633
+#LayersUrlPart:     LAYERS=RASTER250k|Raster France 1/250 000|65.481|140.316
+#LayersUrlPart:     LAYERS=RASTER100k|Raster France 1/100 000|28.0633|65.481
+#LayersUrlPart:     LAYERS=RASTER50k|Raster France 1/50 000|14.0316|28.0633
+#LayersUrlPart:     LAYERS=RASTER25k|Raster France 1/25 000|5.61266|14.0316
+#LayersUrlPart:     LAYERS=RASTER5k|Raster France 1/5 000|0.374177|5.61266
+#LayersUrlPart:     LAYERS=Communes|Communes||
+#LayersUrlPart:     LAYERS=Cantons|Cantons||
+#LayersUrlPart:     LAYERS=Arrondissements|Arrondissements||
+#LayersUrlPart:     LAYERS=Departements|Departements||
+#LayersUrlPart:     LAYERS=Regions|Regions||
+#LayersUrlPart:     LAYERS=Voirie|Voirie urbaine|1|5|Highways
+#LayersUrlPart:     LAYERS=Autres|Autres equipements routiers||
+#LayersUrlPart:     LAYERS=Secondaires|Routes Secondaires||
+#LayersUrlPart:     LAYERS=Departementales|Routes Departementales||
+#LayersUrlPart:     LAYERS=Nationales|Routes Nationales||
+#LayersUrlPart:     LAYERS=Autoroutes|Autoroutes||
+#LayersUrlPart:     LAYERS=CommunesXY|Ponctuels des communes||
+#LayersUrlPart:     LAYERS=Communes,Cantons,Arrondissements,Departements,Regions,Autres,Secondaires,Departementales,Nationales,Autoroutes,CommunesXY
+# working
+#LayersUrlPart:     LAYERS=RASTER5k SF=1(..2,5)
+#LayersUrlPart:     LAYERS=RASTER25k SF=3..7
+#LayersUrlPart:     LAYERS=RASTER50k SF=8..14
+#LayersUrlPart:     LAYERS=Voirie SF 1..10..
+LayersUrlPart:     LAYERS=RASTER5k
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
+BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/fr_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t50.wms	2009-10-01 10:15:42 UTC (rev 2228)
+++ trunk/res_noewe/webmapservices/fr_t50.wms	2009-10-01 20:19:20 UTC (rev 2229)
@@ -0,0 +1,55 @@
+TakenFromUrl:       http://www.geosignal.org/cgi-bin/wmsmap?version=1.1.1&service=WMS&request=GetLegendGraphic&layer=Voirie&format=image/png
+GetCapabilitiesUrl: http://www.geosignal.org/cgi-bin/wmsmap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               fr t50 SF=8..14
+MapType:                        topo
+MainUrl:            http://www.geosignal.org/cgi-bin/wmsmap?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+#CoordinateReferenceSystemCacheWolf:  27582
+#CoordinateReferenceSystemUrlPart: SRS=EPSG:27582 
+#      <SRS>EPSG:27582</SRS>
+#      <SRS>EPSG:27572</SRS>
+#      <SRS>EPSG:27563</SRS>
+#      <SRS>EPSG:27561</SRS>
+#      <SRS>EPSG:4269</SRS>
+#      <SRS>EPSG:4326</SRS>
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Serveur Geosignal|Serveur Geosignal||
+#LayersUrlPart:     LAYERS=Monde|Pays du monde||
+#LayersUrlPart:     LAYERS=RASTER4000k|Raster France 1/4 000 000|935.443|0
+#LayersUrlPart:     LAYERS=RASTER1000k|Raster France 1/1 000 000|280.633|935.443
+#LayersUrlPart:     LAYERS=RASTER500k|Raster France 1/500 000|140.316|280.633
+#LayersUrlPart:     LAYERS=RASTER250k|Raster France 1/250 000|65.481|140.316
+#LayersUrlPart:     LAYERS=RASTER100k|Raster France 1/100 000|28.0633|65.481
+#LayersUrlPart:     LAYERS=RASTER50k|Raster France 1/50 000|14.0316|28.0633
+#LayersUrlPart:     LAYERS=RASTER25k|Raster France 1/25 000|5.61266|14.0316
+#LayersUrlPart:     LAYERS=RASTER5k|Raster France 1/5 000|0.374177|5.61266
+#LayersUrlPart:     LAYERS=Communes|Communes||
+#LayersUrlPart:     LAYERS=Cantons|Cantons||
+#LayersUrlPart:     LAYERS=Arrondissements|Arrondissements||
+#LayersUrlPart:     LAYERS=Departements|Departements||
+#LayersUrlPart:     LAYERS=Regions|Regions||
+#LayersUrlPart:     LAYERS=Voirie|Voirie urbaine|1|5|Highways
+#LayersUrlPart:     LAYERS=Autres|Autres equipements routiers||
+#LayersUrlPart:     LAYERS=Secondaires|Routes Secondaires||
+#LayersUrlPart:     LAYERS=Departementales|Routes Departementales||
+#LayersUrlPart:     LAYERS=Nationales|Routes Nationales||
+#LayersUrlPart:     LAYERS=Autoroutes|Autoroutes||
+#LayersUrlPart:     LAYERS=CommunesXY|Ponctuels des communes||
+#LayersUrlPart:     LAYERS=Communes,Cantons,Arrondissements,Departements,Regions,Autres,Secondaires,Departementales,Nationales,Autoroutes,CommunesXY
+# working
+#LayersUrlPart:     LAYERS=RASTER5k SF=1(..2,5)
+#LayersUrlPart:     LAYERS=RASTER25k SF=3..7 ausgew?hlte St?dte?
+#LayersUrlPart:     LAYERS=RASTER50k SF=8..14
+#LayersUrlPart:     LAYERS=Voirie SF 1..10..
+LayersUrlPart:     LAYERS=RASTER50k
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
+BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+#MinScale:   0
+#MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png



From pfeffer at mail.berlios.de  Thu Oct  1 23:12:42 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 1 Oct 2009 23:12:42 +0200
Subject: [Cachewolf-svn] r2230 - trunk/src/CacheWolf/navi
Message-ID: <200910012112.n91LCgkV029082@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-01 23:12:41 +0200 (Thu, 01 Oct 2009)
New Revision: 2230

Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
MapLoader: Bug fixed: minscale and maxscale was regularly rounded, causing them sometimes to be out of range

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-01 20:19:20 UTC (rev 2229)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-01 21:12:41 UTC (rev 2230)
@@ -350,9 +350,9 @@
 				if (scale < mapLoader.currentOnlineMapService.minscale || scale > mapLoader.currentOnlineMapService.maxscale) {
 					if (scale < mapLoader.currentOnlineMapService.minscale) {
 						scaleInput.setText(Convert.toString(mapLoader.currentOnlineMapService.minscale));
-						scaleInputPerCache.setText(Convert.toString(mapLoader.currentOnlineMapService.minscale));
+						scaleInputPerCache.setText(Convert.toString(java.lang.Math.ceil(mapLoader.currentOnlineMapService.minscale*100)/100));
 					} else {
-						scaleInput.setText(Convert.toString(mapLoader.currentOnlineMapService.maxscale));
+						scaleInput.setText(Convert.toString(java.lang.Math.floor(mapLoader.currentOnlineMapService.maxscale*100)/100));
 						scaleInputPerCache.setText(Convert.toString(mapLoader.currentOnlineMapService.maxscale));
 					}
 					(new MessageBox(MyLocale.getMsg(321, "Error"), "! " + scale + "\n" + MyLocale.getMsg(1830, "The selected online map service provides map in the scale from") + " " + mapLoader.currentOnlineMapService.minscale + MyLocale.getMsg(1831, " to") + " " + mapLoader.currentOnlineMapService.maxscale + MyLocale.getMsg(1832, "\n please adjust 'Approx. meter pro pixel' accordingly"), FormBase.OKB)).execute();



From pfeffer at mail.berlios.de  Thu Oct  1 23:15:39 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 1 Oct 2009 23:15:39 +0200
Subject: [Cachewolf-svn] r2231 - trunk/res_noewe/webmapservices
Message-ID: <200910012115.n91LFdxX029520@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-01 23:15:37 +0200 (Thu, 01 Oct 2009)
New Revision: 2231

Modified:
   trunk/res_noewe/webmapservices/de-nrw_topo_10.wms
Log:
OGC-WMS: de.nrw: topo 1:10,000 bug fixed:  some tests revealed that the scale range is a bit smaller than said by the server himself

Modified: trunk/res_noewe/webmapservices/de-nrw_topo_10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-nrw_topo_10.wms	2009-10-01 21:12:41 UTC (rev 2230)
+++ trunk/res_noewe/webmapservices/de-nrw_topo_10.wms	2009-10-01 21:15:37 UTC (rev 2231)
@@ -19,10 +19,12 @@
 RequestUrlPart:	REQUEST=GetMap
 LayersUrlPart:	LAYERS=Raster%3ADTK10%3ADtk10G
 StylesUrlPart:	STYLES=
+# jpeg: ca. 40 KB, png: 20 KB for 500x500 pixels 
 ImageFormatUrlPart:	FORMAT=image/png
 BoundingBoxTopLeftWGS84:	N 52.7729742 E 5.672412
 BoundingBoxButtomRightWGS84:	N 49.998341 E 10.1417782
 MinScale:   0.0
-MaxScale:   14.001
+# above 13 we get only white (empty) maps, despite of 14.001 is provided in the GetCapabilities-Answer
+MaxScale:   13.0
 RecommendedScale:	1
 ImageFileExtension:	.png



From araber95 at mail.berlios.de  Thu Oct  1 23:57:47 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 1 Oct 2009 23:57:47 +0200
Subject: [Cachewolf-svn] r2232 - in trunk: . tools tools/MakeWMSFile
	tools/MakeWMSFile/capxml2wms tools/MakeWMSFile/capxml2wms/My
	Project tools/MakeWMSFile/capxml2wms/bin
	tools/MakeWMSFile/capxml2wms/bin/Debug
	tools/MakeWMSFile/capxml2wms/bin/Release
Message-ID: <200910012157.n91Lvl0v003069@sheep.berlios.de>

Author: araber95
Date: 2009-10-01 23:57:36 +0200 (Thu, 01 Oct 2009)
New Revision: 2232

Added:
   trunk/tools/
   trunk/tools/MakeWMSFile/
   trunk/tools/MakeWMSFile/capxml2wms.sln
   trunk/tools/MakeWMSFile/capxml2wms/
   trunk/tools/MakeWMSFile/capxml2wms/ClassDiagram1.cd
   trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/Map.resx
   trunk/tools/MakeWMSFile/capxml2wms/Map.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.myapp
   trunk/tools/MakeWMSFile/capxml2wms/My Project/AssemblyInfo.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.resx
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.settings
   trunk/tools/MakeWMSFile/capxml2wms/bin/
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.pdb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml
   trunk/tools/MakeWMSFile/capxml2wms/bin/Release/
   trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.pdb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user
   trunk/tools/MakeWMSFile/capxml2wms/gc.ico
Log:
Tool for generating wms-Files out of a given wms-server-adress

Added: trunk/tools/MakeWMSFile/capxml2wms/ClassDiagram1.cd
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/ClassDiagram1.cd	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/ClassDiagram1.cd	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1 @@
+ 
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,53 @@
+<Global.Microsoft.VisualBasic.CompilerServices.DesignerGenerated()> _
+Partial Class Map
+    Inherits System.Windows.Forms.Form
+
+    'Das Formular ??berschreibt den L??schvorgang, um die Komponentenliste zu bereinigen.
+    <System.Diagnostics.DebuggerNonUserCode()> _
+    Protected Overrides Sub Dispose(ByVal disposing As Boolean)
+        Try
+            If disposing AndAlso components IsNot Nothing Then
+                components.Dispose()
+            End If
+        Finally
+            MyBase.Dispose(disposing)
+        End Try
+    End Sub
+
+    'Wird vom Windows Form-Designer ben??tigt.
+    Private components As System.ComponentModel.IContainer
+
+    'Hinweis: Die folgende Prozedur ist f??r den Windows Form-Designer erforderlich.
+    'Das Bearbeiten ist mit dem Windows Form-Designer m??glich.  
+    'Das Bearbeiten mit dem Code-Editor ist nicht m??glich.
+    <System.Diagnostics.DebuggerStepThrough()> _
+    Private Sub InitializeComponent()
+        Me.PictureBox = New System.Windows.Forms.PictureBox
+        CType(Me.PictureBox, System.ComponentModel.ISupportInitialize).BeginInit()
+        Me.SuspendLayout()
+        '
+        'PictureBox
+        '
+        Me.PictureBox.Dock = System.Windows.Forms.DockStyle.Fill
+        Me.PictureBox.Location = New System.Drawing.Point(0, 0)
+        Me.PictureBox.Name = "PictureBox"
+        Me.PictureBox.Size = New System.Drawing.Size(451, 361)
+        Me.PictureBox.SizeMode = System.Windows.Forms.PictureBoxSizeMode.Zoom
+        Me.PictureBox.TabIndex = 0
+        Me.PictureBox.TabStop = False
+        '
+        'Map
+        '
+        Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
+        Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
+        Me.ClientSize = New System.Drawing.Size(451, 361)
+        Me.Controls.Add(Me.PictureBox)
+        Me.Name = "Map"
+        Me.ShowIcon = False
+        Me.Text = "Map"
+        CType(Me.PictureBox, System.ComponentModel.ISupportInitialize).EndInit()
+        Me.ResumeLayout(False)
+
+    End Sub
+    Private WithEvents PictureBox As System.Windows.Forms.PictureBox
+End Class

Added: trunk/tools/MakeWMSFile/capxml2wms/Map.resx
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.resx	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.resx	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,120 @@
+<?xml version="1.0" encoding="utf-8"?>
+<root>
+  <!-- 
+    Microsoft ResX Schema 
+    
+    Version 2.0
+    
+    The primary goals of this format is to allow a simple XML format 
+    that is mostly human readable. The generation and parsing of the 
+    various data types are done through the TypeConverter classes 
+    associated with the data types.
+    
+    Example:
+    
+    ... ado.net/XML headers & schema ...
+    <resheader name="resmimetype">text/microsoft-resx</resheader>
+    <resheader name="version">2.0</resheader>
+    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
+    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
+    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
+    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
+    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
+        <value>[base64 mime encoded serialized .NET Framework object]</value>
+    </data>
+    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
+        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
+        <comment>This is a comment</comment>
+    </data>
+                
+    There are any number of "resheader" rows that contain simple 
+    name/value pairs.
+    
+    Each data row contains a name, and value. The row also contains a 
+    type or mimetype. Type corresponds to a .NET class that support 
+    text/value conversion through the TypeConverter architecture. 
+    Classes that don't support this are serialized and stored with the 
+    mimetype set.
+    
+    The mimetype is used for serialized objects, and tells the 
+    ResXResourceReader how to depersist the object. This is currently not 
+    extensible. For a given mimetype the value must be set accordingly:
+    
+    Note - application/x-microsoft.net.object.binary.base64 is the format 
+    that the ResXResourceWriter will generate, however the reader can 
+    read any of the formats listed below.
+    
+    mimetype: application/x-microsoft.net.object.binary.base64
+    value   : The object must be serialized with 
+            : System.Runtime.Serialization.Formatters.Binary.BinaryFormatter
+            : and then encoded with base64 encoding.
+    
+    mimetype: application/x-microsoft.net.object.soap.base64
+    value   : The object must be serialized with 
+            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
+            : and then encoded with base64 encoding.
+
+    mimetype: application/x-microsoft.net.object.bytearray.base64
+    value   : The object must be serialized into a byte array 
+            : using a System.ComponentModel.TypeConverter
+            : and then encoded with base64 encoding.
+    -->
+  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
+    <xsd:import namespace="http://www.w3.org/XML/1998/namespace" />
+    <xsd:element name="root" msdata:IsDataSet="true">
+      <xsd:complexType>
+        <xsd:choice maxOccurs="unbounded">
+          <xsd:element name="metadata">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" />
+              </xsd:sequence>
+              <xsd:attribute name="name" use="required" type="xsd:string" />
+              <xsd:attribute name="type" type="xsd:string" />
+              <xsd:attribute name="mimetype" type="xsd:string" />
+              <xsd:attribute ref="xml:space" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="assembly">
+            <xsd:complexType>
+              <xsd:attribute name="alias" type="xsd:string" />
+              <xsd:attribute name="name" type="xsd:string" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="data">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
+                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
+              </xsd:sequence>
+              <xsd:attribute name="name" type="xsd:string" use="required" msdata:Ordinal="1" />
+              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
+              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
+              <xsd:attribute ref="xml:space" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="resheader">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
+              </xsd:sequence>
+              <xsd:attribute name="name" type="xsd:string" use="required" />
+            </xsd:complexType>
+          </xsd:element>
+        </xsd:choice>
+      </xsd:complexType>
+    </xsd:element>
+  </xsd:schema>
+  <resheader name="resmimetype">
+    <value>text/microsoft-resx</value>
+  </resheader>
+  <resheader name="version">
+    <value>2.0</value>
+  </resheader>
+  <resheader name="reader">
+    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+  </resheader>
+  <resheader name="writer">
+    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+  </resheader>
+</root>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/Map.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,43 @@
+Imports System.Net
+Public Class Map
+    Dim GetMapUrl As String
+    Dim pngFileName As String
+    Dim i As Image
+
+    Private Sub Map_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
+        Try
+            i.Dispose()
+            IO.File.Delete(pngFileName)
+        Catch ex As Exception
+
+        End Try
+    End Sub
+
+    Private Sub Map_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
+        Me.Text = GetMapUrl
+        Try
+            Dim wc As New WebClient()
+            pngFileName = IO.Path.GetTempFileName
+            IO.File.Delete(pngFileName)
+            wc.DownloadFile(GetMapUrl, pngFileName)
+            i = Image.FromFile(pngFileName)
+            PictureBox.Image = i
+        Catch ex As Exception
+            If IO.File.Exists(pngFileName) Then
+                Process.Start("notepad.exe", pngFileName)
+            End If
+            MsgBox("Tut mir leid, das mag der wms-Server wohl so nicht", MsgBoxStyle.Exclamation)
+            Close()
+        End Try
+    End Sub
+
+    Public Sub New(ByVal _GetMapUrl As String)
+
+        ' Dieser Aufruf ist f?r den Windows Form-Designer erforderlich.
+        InitializeComponent()
+
+        ' F?gen Sie Initialisierungen nach dem InitializeComponent()-Aufruf hinzu.
+        GetMapUrl = _GetMapUrl
+
+    End Sub
+End Class
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,38 @@
+???'------------------------------------------------------------------------------
+' <auto-generated>
+'     This code was generated by a tool.
+'     Runtime Version:2.0.50727.1433
+'
+'     Changes to this file may cause incorrect behavior and will be lost if
+'     the code is regenerated.
+' </auto-generated>
+'------------------------------------------------------------------------------
+
+Option Strict On
+Option Explicit On
+
+
+Namespace My
+    
+    'NOTE: This file is auto-generated; do not modify it directly.  To make changes,
+    ' or if you encounter build errors in this file, go to the Project Designer
+    ' (go to Project Properties or double-click the My Project node in
+    ' Solution Explorer), and make changes on the Application tab.
+    '
+    Partial Friend Class MyApplication
+        
+        <Global.System.Diagnostics.DebuggerStepThroughAttribute()>  _
+        Public Sub New()
+            MyBase.New(Global.Microsoft.VisualBasic.ApplicationServices.AuthenticationMode.Windows)
+            Me.IsSingleInstance = false
+            Me.EnableVisualStyles = true
+            Me.SaveMySettingsOnExit = true
+            Me.ShutDownStyle = Global.Microsoft.VisualBasic.ApplicationServices.ShutdownMode.AfterMainFormCloses
+        End Sub
+        
+        <Global.System.Diagnostics.DebuggerStepThroughAttribute()>  _
+        Protected Overrides Sub OnCreateMainForm()
+            Me.MainForm = Global.capxml2wms.capxml2wms
+        End Sub
+    End Class
+End Namespace

Added: trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.myapp
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.myapp	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.myapp	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,10 @@
+???<?xml version="1.0" encoding="utf-16"?>
+<MyApplicationData xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
+  <MySubMain>true</MySubMain>
+  <MainForm>capxml2wms</MainForm>
+  <SingleInstance>false</SingleInstance>
+  <ShutdownMode>0</ShutdownMode>
+  <EnableVisualStyles>true</EnableVisualStyles>
+  <AuthenticationMode>0</AuthenticationMode>
+  <SaveMySettingsOnExit>true</SaveMySettingsOnExit>
+</MyApplicationData>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/My Project/AssemblyInfo.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/AssemblyInfo.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/AssemblyInfo.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,39 @@
+???Imports System.Resources
+
+Imports System
+Imports System.Reflection
+Imports System.Runtime.InteropServices
+
+' Allgemeine Informationen ??ber eine Assembly werden ??ber die folgenden 
+' Attribute gesteuert. ??ndern Sie diese Attributwerte, um die Informationen zu ??ndern,
+' die mit einer Assembly verkn??pft sind.
+
+' Die Werte der Assemblyattribute ??berpr??fen
+
+<Assembly: AssemblyTitle("capxml2wms")> 
+<Assembly: AssemblyDescription("wms - Datei aus WMS-Server Adresse erstellen")> 
+<Assembly: AssemblyCompany("araber95")> 
+<Assembly: AssemblyProduct("capxml2wms")> 
+<Assembly: AssemblyCopyright("free to use, no warranty")> 
+<Assembly: AssemblyTrademark("")> 
+
+<Assembly: ComVisible(False)> 
+
+'Die folgende GUID bestimmt die ID der Typbibliothek, wenn dieses Projekt f??r COM verf??gbar gemacht wird
+<Assembly: Guid("fd8a3c0f-a2f3-4877-aeee-54ad10a45052")> 
+
+' Versionsinformationen f??r eine Assembly bestehen aus den folgenden vier Werten:
+'
+'      Hauptversion
+'      Nebenversion 
+'      Buildnummer
+'      Revision
+'
+' Sie k??nnen alle Werte angeben oder die standardm????igen Build- und Revisionsnummern 
+' ??bernehmen, indem Sie "*" eingeben:
+' <Assembly: AssemblyVersion("1.0.*")> 
+
+<Assembly: AssemblyVersion("1.0.0.3")> 
+<Assembly: AssemblyFileVersion("1.0.0.3")> 
+
+<Assembly: NeutralResourcesLanguageAttribute("de-DE")> 
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,62 @@
+???'------------------------------------------------------------------------------
+' <auto-generated>
+'     This code was generated by a tool.
+'     Runtime Version:2.0.50727.1433
+'
+'     Changes to this file may cause incorrect behavior and will be lost if
+'     the code is regenerated.
+' </auto-generated>
+'------------------------------------------------------------------------------
+
+Option Strict On
+Option Explicit On
+
+
+Namespace My.Resources
+    
+    'This class was auto-generated by the StronglyTypedResourceBuilder
+    'class via a tool like ResGen or Visual Studio.
+    'To add or remove a member, edit your .ResX file then rerun ResGen
+    'with the /str option, or rebuild your VS project.
+    '<summary>
+    '  A strongly-typed resource class, for looking up localized strings, etc.
+    '</summary>
+    <Global.System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "2.0.0.0"),  _
+     Global.System.Diagnostics.DebuggerNonUserCodeAttribute(),  _
+     Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(),  _
+     Global.Microsoft.VisualBasic.HideModuleNameAttribute()>  _
+    Friend Module Resources
+        
+        Private resourceMan As Global.System.Resources.ResourceManager
+        
+        Private resourceCulture As Global.System.Globalization.CultureInfo
+        
+        '<summary>
+        '  Returns the cached ResourceManager instance used by this class.
+        '</summary>
+        <Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _
+        Friend ReadOnly Property ResourceManager() As Global.System.Resources.ResourceManager
+            Get
+                If Object.ReferenceEquals(resourceMan, Nothing) Then
+                    Dim temp As Global.System.Resources.ResourceManager = New Global.System.Resources.ResourceManager("capxml2wms.Resources", GetType(Resources).Assembly)
+                    resourceMan = temp
+                End If
+                Return resourceMan
+            End Get
+        End Property
+        
+        '<summary>
+        '  Overrides the current thread's CurrentUICulture property for all
+        '  resource lookups using this strongly typed resource class.
+        '</summary>
+        <Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _
+        Friend Property Culture() As Global.System.Globalization.CultureInfo
+            Get
+                Return resourceCulture
+            End Get
+            Set(ByVal value As Global.System.Globalization.CultureInfo)
+                resourceCulture = value
+            End Set
+        End Property
+    End Module
+End Namespace

Added: trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.resx
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.resx	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.resx	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,117 @@
+???<?xml version="1.0" encoding="utf-8"?>
+<root>
+  <!-- 
+    Microsoft ResX Schema 
+    
+    Version 2.0
+    
+    The primary goals of this format is to allow a simple XML format 
+    that is mostly human readable. The generation and parsing of the 
+    various data types are done through the TypeConverter classes 
+    associated with the data types.
+    
+    Example:
+    
+    ... ado.net/XML headers & schema ...
+    <resheader name="resmimetype">text/microsoft-resx</resheader>
+    <resheader name="version">2.0</resheader>
+    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
+    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
+    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
+    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
+    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
+        <value>[base64 mime encoded serialized .NET Framework object]</value>
+    </data>
+    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
+        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
+        <comment>This is a comment</comment>
+    </data>
+                
+    There are any number of "resheader" rows that contain simple 
+    name/value pairs.
+    
+    Each data row contains a name, and value. The row also contains a 
+    type or mimetype. Type corresponds to a .NET class that support 
+    text/value conversion through the TypeConverter architecture. 
+    Classes that don't support this are serialized and stored with the 
+    mimetype set.
+    
+    The mimetype is used for serialized objects, and tells the 
+    ResXResourceReader how to depersist the object. This is currently not 
+    extensible. For a given mimetype the value must be set accordingly:
+    
+    Note - application/x-microsoft.net.object.binary.base64 is the format 
+    that the ResXResourceWriter will generate, however the reader can 
+    read any of the formats listed below.
+    
+    mimetype: application/x-microsoft.net.object.binary.base64
+    value   : The object must be serialized with 
+            : System.Serialization.Formatters.Binary.BinaryFormatter
+            : and then encoded with base64 encoding.
+    
+    mimetype: application/x-microsoft.net.object.soap.base64
+    value   : The object must be serialized with 
+            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
+            : and then encoded with base64 encoding.
+
+    mimetype: application/x-microsoft.net.object.bytearray.base64
+    value   : The object must be serialized into a byte array 
+            : using a System.ComponentModel.TypeConverter
+            : and then encoded with base64 encoding.
+    -->
+  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
+    <xsd:element name="root" msdata:IsDataSet="true">
+      <xsd:complexType>
+        <xsd:choice maxOccurs="unbounded">
+          <xsd:element name="metadata">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" />
+              </xsd:sequence>
+              <xsd:attribute name="name" type="xsd:string" />
+              <xsd:attribute name="type" type="xsd:string" />
+              <xsd:attribute name="mimetype" type="xsd:string" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="assembly">
+            <xsd:complexType>
+              <xsd:attribute name="alias" type="xsd:string" />
+              <xsd:attribute name="name" type="xsd:string" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="data">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
+                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
+              </xsd:sequence>
+              <xsd:attribute name="name" type="xsd:string" msdata:Ordinal="1" />
+              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
+              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="resheader">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
+              </xsd:sequence>
+              <xsd:attribute name="name" type="xsd:string" use="required" />
+            </xsd:complexType>
+          </xsd:element>
+        </xsd:choice>
+      </xsd:complexType>
+    </xsd:element>
+  </xsd:schema>
+  <resheader name="resmimetype">
+    <value>text/microsoft-resx</value>
+  </resheader>
+  <resheader name="version">
+    <value>2.0</value>
+  </resheader>
+  <resheader name="reader">
+    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+  </resheader>
+  <resheader name="writer">
+    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+  </resheader>
+</root>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,73 @@
+???'------------------------------------------------------------------------------
+' <auto-generated>
+'     This code was generated by a tool.
+'     Runtime Version:2.0.50727.1433
+'
+'     Changes to this file may cause incorrect behavior and will be lost if
+'     the code is regenerated.
+' </auto-generated>
+'------------------------------------------------------------------------------
+
+Option Strict On
+Option Explicit On
+
+
+Namespace My
+
+    <Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(),  _
+     Global.System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "8.0.0.0"),  _
+     Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _
+    Partial Friend NotInheritable Class MySettings
+        Inherits Global.System.Configuration.ApplicationSettingsBase
+        
+        Private Shared defaultInstance As MySettings = CType(Global.System.Configuration.ApplicationSettingsBase.Synchronized(New MySettings), MySettings)
+        
+#Region "My.Settings Auto-Save Functionality"
+#If _MyType = "WindowsForms" Then
+        Private Shared addedHandler As Boolean
+
+        Private Shared addedHandlerLockObject As New Object
+
+        <Global.System.Diagnostics.DebuggerNonUserCodeAttribute(), Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)> _
+        Private Shared Sub AutoSaveSettings(ByVal sender As Global.System.Object, ByVal e As Global.System.EventArgs)
+            If My.Application.SaveMySettingsOnExit Then
+                My.Settings.Save()
+            End If
+        End Sub
+#End If
+#End Region
+        
+        Public Shared ReadOnly Property [Default]() As MySettings
+            Get
+                
+#If _MyType = "WindowsForms" Then
+                   If Not addedHandler Then
+                        SyncLock addedHandlerLockObject
+                            If Not addedHandler Then
+                                AddHandler My.Application.Shutdown, AddressOf AutoSaveSettings
+                                addedHandler = True
+                            End If
+                        End SyncLock
+                    End If
+#End If
+                Return defaultInstance
+            End Get
+        End Property
+    End Class
+End Namespace
+
+Namespace My
+    
+    <Global.Microsoft.VisualBasic.HideModuleNameAttribute(),  _
+     Global.System.Diagnostics.DebuggerNonUserCodeAttribute(),  _
+     Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute()>  _
+    Friend Module MySettingsProperty
+        
+        <Global.System.ComponentModel.Design.HelpKeywordAttribute("My.Settings")>  _
+        Friend ReadOnly Property Settings() As Global.capxml2wms.My.MySettings
+            Get
+                Return Global.capxml2wms.My.MySettings.Default
+            End Get
+        End Property
+    End Module
+End Namespace

Added: trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.settings
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.settings	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.settings	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,7 @@
+???<?xml version='1.0' encoding='utf-8'?>
+<SettingsFile xmlns="http://schemas.microsoft.com/VisualStudio/2004/01/settings" CurrentProfile="(Default)" UseMySettingsClassName="true">
+  <Profiles>
+    <Profile Name="(Default)" />
+  </Profiles>
+  <Settings />
+</SettingsFile>

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.pdb
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.pdb
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,11 @@
+???<?xml version="1.0"?>
+<doc>
+<assembly>
+<name>
+capxml2wms
+</name>
+</assembly>
+<members>
+
+</members>
+</doc>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.exe
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.pdb
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.pdb
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,11 @@
+???<?xml version="1.0"?>
+<doc>
+<assembly>
+<name>
+capxml2wms
+</name>
+</assembly>
+<members>
+
+</members>
+</doc>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,307 @@
+<Global.Microsoft.VisualBasic.CompilerServices.DesignerGenerated()> _
+Partial Class capxml2wms
+    Inherits System.Windows.Forms.Form
+
+    'Das Formular ??berschreibt den L??schvorgang, um die Komponentenliste zu bereinigen.
+    <System.Diagnostics.DebuggerNonUserCode()> _
+    Protected Overrides Sub Dispose(ByVal disposing As Boolean)
+        Try
+            If disposing AndAlso components IsNot Nothing Then
+                components.Dispose()
+            End If
+        Finally
+            MyBase.Dispose(disposing)
+        End Try
+    End Sub
+
+    'Wird vom Windows Form-Designer ben??tigt.
+    Private components As System.ComponentModel.IContainer
+
+    'Hinweis: Die folgende Prozedur ist f??r den Windows Form-Designer erforderlich.
+    'Das Bearbeiten ist mit dem Windows Form-Designer m??glich.  
+    'Das Bearbeiten mit dem Code-Editor ist nicht m??glich.
+    <System.Diagnostics.DebuggerStepThrough()> _
+    Private Sub InitializeComponent()
+        Dim resources As System.ComponentModel.ComponentResourceManager = New System.ComponentModel.ComponentResourceManager(GetType(capxml2wms))
+        Me.ButtonErstellen = New System.Windows.Forms.Button
+        Me.TextBoxUrl = New System.Windows.Forms.TextBox
+        Me.Label1 = New System.Windows.Forms.Label
+        Me.TextBoxXML = New System.Windows.Forms.TextBox
+        Me.Label2 = New System.Windows.Forms.Label
+        Me.ComboBoxVersion = New System.Windows.Forms.ComboBox
+        Me.ButtonGetCapabilities = New System.Windows.Forms.Button
+        Me.ButtonShowMap = New System.Windows.Forms.Button
+        Me.CheckedListBoxLayers = New System.Windows.Forms.CheckedListBox
+        Me.Label3 = New System.Windows.Forms.Label
+        Me.ButtonCheckNone = New System.Windows.Forms.Button
+        Me.ButtonCheckAll = New System.Windows.Forms.Button
+        Me.ComboBoxEPSG = New System.Windows.Forms.ComboBox
+        Me.Label4 = New System.Windows.Forms.Label
+        Me.HScrollBar1 = New System.Windows.Forms.HScrollBar
+        Me.Label5 = New System.Windows.Forms.Label
+        Me.ComboBoxFormat = New System.Windows.Forms.ComboBox
+        Me.ComboBoxBBox = New System.Windows.Forms.ComboBox
+        Me.Label6 = New System.Windows.Forms.Label
+        Me.ComboBoxBBoxI = New System.Windows.Forms.ComboBox
+        Me.SuspendLayout()
+        '
+        'ButtonErstellen
+        '
+        Me.ButtonErstellen.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ButtonErstellen.Location = New System.Drawing.Point(540, 552)
+        Me.ButtonErstellen.Name = "ButtonErstellen"
+        Me.ButtonErstellen.Size = New System.Drawing.Size(123, 36)
+        Me.ButtonErstellen.TabIndex = 1
+        Me.ButtonErstellen.Text = "WMS-Datei erstellen"
+        Me.ButtonErstellen.UseVisualStyleBackColor = True
+        '
+        'TextBoxUrl
+        '
+        Me.TextBoxUrl.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.TextBoxUrl.Location = New System.Drawing.Point(20, 57)
+        Me.TextBoxUrl.Name = "TextBoxUrl"
+        Me.TextBoxUrl.Size = New System.Drawing.Size(496, 20)
+        Me.TextBoxUrl.TabIndex = 0
+        '
+        'Label1
+        '
+        Me.Label1.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.Label1.AutoSize = True
+        Me.Label1.Location = New System.Drawing.Point(21, 27)
+        Me.Label1.Name = "Label1"
+        Me.Label1.Size = New System.Drawing.Size(205, 13)
+        Me.Label1.TabIndex = 2
+        Me.Label1.Text = "http Adresse des WMS-Servers eingeben:"
+        '
+        'TextBoxXML
+        '
+        Me.TextBoxXML.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
+                    Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.TextBoxXML.Location = New System.Drawing.Point(20, 83)
+        Me.TextBoxXML.Multiline = True
+        Me.TextBoxXML.Name = "TextBoxXML"
+        Me.TextBoxXML.ReadOnly = True
+        Me.TextBoxXML.ScrollBars = System.Windows.Forms.ScrollBars.Both
+        Me.TextBoxXML.Size = New System.Drawing.Size(643, 288)
+        Me.TextBoxXML.TabIndex = 4
+        Me.TextBoxXML.WordWrap = False
+        '
+        'Label2
+        '
+        Me.Label2.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.Label2.AutoSize = True
+        Me.Label2.Location = New System.Drawing.Point(511, 27)
+        Me.Label2.Name = "Label2"
+        Me.Label2.Size = New System.Drawing.Size(75, 13)
+        Me.Label2.TabIndex = 5
+        Me.Label2.Text = "WMS-Version:"
+        Me.Label2.Visible = False
+        '
+        'ComboBoxVersion
+        '
+        Me.ComboBoxVersion.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxVersion.FormattingEnabled = True
+        Me.ComboBoxVersion.Items.AddRange(New Object() {"1.0.0", "1.1.0", "1.1.1"})
+        Me.ComboBoxVersion.Location = New System.Drawing.Point(588, 24)
+        Me.ComboBoxVersion.MaxDropDownItems = 3
+        Me.ComboBoxVersion.Name = "ComboBoxVersion"
+        Me.ComboBoxVersion.Size = New System.Drawing.Size(75, 21)
+        Me.ComboBoxVersion.TabIndex = 6
+        '
+        'ButtonGetCapabilities
+        '
+        Me.ButtonGetCapabilities.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ButtonGetCapabilities.Location = New System.Drawing.Point(540, 43)
+        Me.ButtonGetCapabilities.Name = "ButtonGetCapabilities"
+        Me.ButtonGetCapabilities.Size = New System.Drawing.Size(123, 36)
+        Me.ButtonGetCapabilities.TabIndex = 7
+        Me.ButtonGetCapabilities.Text = "M??glichkeiten abfragen"
+        Me.ButtonGetCapabilities.UseVisualStyleBackColor = True
+        '
+        'ButtonShowMap
+        '
+        Me.ButtonShowMap.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ButtonShowMap.Location = New System.Drawing.Point(540, 397)
+        Me.ButtonShowMap.Name = "ButtonShowMap"
+        Me.ButtonShowMap.Size = New System.Drawing.Size(123, 36)
+        Me.ButtonShowMap.TabIndex = 8
+        Me.ButtonShowMap.Text = "Test Karte anzeigen"
+        Me.ButtonShowMap.UseVisualStyleBackColor = True
+        '
+        'CheckedListBoxLayers
+        '
+        Me.CheckedListBoxLayers.Anchor = CType(((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.CheckedListBoxLayers.CheckOnClick = True
+        Me.CheckedListBoxLayers.FormattingEnabled = True
+        Me.CheckedListBoxLayers.HorizontalScrollbar = True
+        Me.CheckedListBoxLayers.Location = New System.Drawing.Point(20, 397)
+        Me.CheckedListBoxLayers.Name = "CheckedListBoxLayers"
+        Me.CheckedListBoxLayers.Size = New System.Drawing.Size(496, 109)
+        Me.CheckedListBoxLayers.TabIndex = 9
+        '
+        'Label3
+        '
+        Me.Label3.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.Label3.AutoSize = True
+        Me.Label3.Location = New System.Drawing.Point(21, 381)
+        Me.Label3.Name = "Label3"
+        Me.Label3.Size = New System.Drawing.Size(36, 13)
+        Me.Label3.TabIndex = 10
+        Me.Label3.Text = "Layer:"
+        '
+        'ButtonCheckNone
+        '
+        Me.ButtonCheckNone.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.ButtonCheckNone.Location = New System.Drawing.Point(212, 377)
+        Me.ButtonCheckNone.Name = "ButtonCheckNone"
+        Me.ButtonCheckNone.Size = New System.Drawing.Size(60, 20)
+        Me.ButtonCheckNone.TabIndex = 13
+        Me.ButtonCheckNone.Text = "kein x"
+        Me.ButtonCheckNone.UseVisualStyleBackColor = True
+        '
+        'ButtonCheckAll
+        '
+        Me.ButtonCheckAll.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.ButtonCheckAll.Location = New System.Drawing.Point(149, 377)
+        Me.ButtonCheckAll.Name = "ButtonCheckAll"
+        Me.ButtonCheckAll.Size = New System.Drawing.Size(60, 20)
+        Me.ButtonCheckAll.TabIndex = 14
+        Me.ButtonCheckAll.Text = "alle  x"
+        Me.ButtonCheckAll.UseVisualStyleBackColor = True
+        '
+        'ComboBoxEPSG
+        '
+        Me.ComboBoxEPSG.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxEPSG.FormattingEnabled = True
+        Me.ComboBoxEPSG.Location = New System.Drawing.Point(20, 526)
+        Me.ComboBoxEPSG.Name = "ComboBoxEPSG"
+        Me.ComboBoxEPSG.Size = New System.Drawing.Size(121, 21)
+        Me.ComboBoxEPSG.TabIndex = 15
+        '
+        'Label4
+        '
+        Me.Label4.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.Label4.AutoSize = True
+        Me.Label4.Location = New System.Drawing.Point(22, 509)
+        Me.Label4.Name = "Label4"
+        Me.Label4.Size = New System.Drawing.Size(39, 13)
+        Me.Label4.TabIndex = 16
+        Me.Label4.Text = "EPSG:"
+        '
+        'HScrollBar1
+        '
+        Me.HScrollBar1.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.HScrollBar1.Location = New System.Drawing.Point(540, 377)
+        Me.HScrollBar1.Minimum = 1
+        Me.HScrollBar1.Name = "HScrollBar1"
+        Me.HScrollBar1.Size = New System.Drawing.Size(123, 17)
+        Me.HScrollBar1.TabIndex = 17
+        Me.HScrollBar1.Value = 1
+        '
+        'Label5
+        '
+        Me.Label5.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.Label5.AutoSize = True
+        Me.Label5.Location = New System.Drawing.Point(148, 509)
+        Me.Label5.Name = "Label5"
+        Me.Label5.Size = New System.Drawing.Size(42, 13)
+        Me.Label5.TabIndex = 18
+        Me.Label5.Text = "Format:"
+        '
+        'ComboBoxFormat
+        '
+        Me.ComboBoxFormat.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxFormat.FormattingEnabled = True
+        Me.ComboBoxFormat.Location = New System.Drawing.Point(151, 526)
+        Me.ComboBoxFormat.Name = "ComboBoxFormat"
+        Me.ComboBoxFormat.Size = New System.Drawing.Size(121, 21)
+        Me.ComboBoxFormat.TabIndex = 19
+        '
+        'ComboBoxBBox
+        '
+        Me.ComboBoxBBox.Anchor = CType(((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxBBox.FormattingEnabled = True
+        Me.ComboBoxBBox.Location = New System.Drawing.Point(20, 567)
+        Me.ComboBoxBBox.Name = "ComboBoxBBox"
+        Me.ComboBoxBBox.Size = New System.Drawing.Size(496, 21)
+        Me.ComboBoxBBox.TabIndex = 20
+        '
+        'Label6
+        '
+        Me.Label6.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.Label6.AutoSize = True
+        Me.Label6.Location = New System.Drawing.Point(22, 550)
+        Me.Label6.Name = "Label6"
+        Me.Label6.Size = New System.Drawing.Size(35, 13)
+        Me.Label6.TabIndex = 21
+        Me.Label6.Text = "BBox:"
+        '
+        'ComboBoxBBoxI
+        '
+        Me.ComboBoxBBoxI.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxBBoxI.FormattingEnabled = True
+        Me.ComboBoxBBoxI.Location = New System.Drawing.Point(20, 580)
+        Me.ComboBoxBBoxI.Name = "ComboBoxBBoxI"
+        Me.ComboBoxBBoxI.Size = New System.Drawing.Size(252, 21)
+        Me.ComboBoxBBoxI.TabIndex = 22
+        Me.ComboBoxBBoxI.Visible = False
+        '
+        'capxml2wms
+        '
+        Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
+        Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
+        Me.ClientSize = New System.Drawing.Size(675, 601)
+        Me.Controls.Add(Me.ComboBoxBBoxI)
+        Me.Controls.Add(Me.Label6)
+        Me.Controls.Add(Me.ComboBoxBBox)
+        Me.Controls.Add(Me.ComboBoxFormat)
+        Me.Controls.Add(Me.Label5)
+        Me.Controls.Add(Me.HScrollBar1)
+        Me.Controls.Add(Me.Label4)
+        Me.Controls.Add(Me.ComboBoxEPSG)
+        Me.Controls.Add(Me.ButtonCheckAll)
+        Me.Controls.Add(Me.ButtonCheckNone)
+        Me.Controls.Add(Me.Label3)
+        Me.Controls.Add(Me.CheckedListBoxLayers)
+        Me.Controls.Add(Me.ButtonShowMap)
+        Me.Controls.Add(Me.ButtonGetCapabilities)
+        Me.Controls.Add(Me.ComboBoxVersion)
+        Me.Controls.Add(Me.Label2)
+        Me.Controls.Add(Me.TextBoxXML)
+        Me.Controls.Add(Me.Label1)
+        Me.Controls.Add(Me.TextBoxUrl)
+        Me.Controls.Add(Me.ButtonErstellen)
+        Me.Icon = CType(resources.GetObject("$this.Icon"), System.Drawing.Icon)
+        Me.Name = "capxml2wms"
+        Me.Text = "capxml2wms"
+        Me.ResumeLayout(False)
+        Me.PerformLayout()
+
+    End Sub
+    Private WithEvents ButtonErstellen As System.Windows.Forms.Button
+    Private WithEvents TextBoxUrl As System.Windows.Forms.TextBox
+    Private WithEvents Label1 As System.Windows.Forms.Label
+    Private WithEvents TextBoxXML As System.Windows.Forms.TextBox
+    Private WithEvents ComboBoxVersion As System.Windows.Forms.ComboBox
+    Private WithEvents Label2 As System.Windows.Forms.Label
+    Private WithEvents ButtonGetCapabilities As System.Windows.Forms.Button
+    Private WithEvents ButtonShowMap As System.Windows.Forms.Button
+    Private WithEvents CheckedListBoxLayers As System.Windows.Forms.CheckedListBox
+    Private WithEvents Label3 As System.Windows.Forms.Label
+    Private WithEvents ButtonCheckNone As System.Windows.Forms.Button
+    Private WithEvents ButtonCheckAll As System.Windows.Forms.Button
+    Private WithEvents Label4 As System.Windows.Forms.Label
+    Private WithEvents ComboBoxEPSG As System.Windows.Forms.ComboBox
+    Private WithEvents HScrollBar1 As System.Windows.Forms.HScrollBar
+    Private WithEvents Label5 As System.Windows.Forms.Label
+    Private WithEvents ComboBoxFormat As System.Windows.Forms.ComboBox
+    Private WithEvents ComboBoxBBox As System.Windows.Forms.ComboBox
+    Private WithEvents Label6 As System.Windows.Forms.Label
+    Private WithEvents ComboBoxBBoxI As System.Windows.Forms.ComboBox
+
+End Class

Added: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,246 @@
+<?xml version="1.0" encoding="utf-8"?>
+<root>
+  <!-- 
+    Microsoft ResX Schema 
+    
+    Version 2.0
+    
+    The primary goals of this format is to allow a simple XML format 
+    that is mostly human readable. The generation and parsing of the 
+    various data types are done through the TypeConverter classes 
+    associated with the data types.
+    
+    Example:
+    
+    ... ado.net/XML headers & schema ...
+    <resheader name="resmimetype">text/microsoft-resx</resheader>
+    <resheader name="version">2.0</resheader>
+    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
+    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
+    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
+    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
+    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
+        <value>[base64 mime encoded serialized .NET Framework object]</value>
+    </data>
+    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
+        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
+        <comment>This is a comment</comment>
+    </data>
+                
+    There are any number of "resheader" rows that contain simple 
+    name/value pairs.
+    
+    Each data row contains a name, and value. The row also contains a 
+    type or mimetype. Type corresponds to a .NET class that support 
+    text/value conversion through the TypeConverter architecture. 
+    Classes that don't support this are serialized and stored with the 
+    mimetype set.
+    
+    The mimetype is used for serialized objects, and tells the 
+    ResXResourceReader how to depersist the object. This is currently not 
+    extensible. For a given mimetype the value must be set accordingly:
+    
+    Note - application/x-microsoft.net.object.binary.base64 is the format 
+    that the ResXResourceWriter will generate, however the reader can 
+    read any of the formats listed below.
+    
+    mimetype: application/x-microsoft.net.object.binary.base64
+    value   : The object must be serialized with 
+            : System.Runtime.Serialization.Formatters.Binary.BinaryFormatter
+            : and then encoded with base64 encoding.
+    
+    mimetype: application/x-microsoft.net.object.soap.base64
+    value   : The object must be serialized with 
+            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
+            : and then encoded with base64 encoding.
+
+    mimetype: application/x-microsoft.net.object.bytearray.base64
+    value   : The object must be serialized into a byte array 
+            : using a System.ComponentModel.TypeConverter
+            : and then encoded with base64 encoding.
+    -->
+  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
+    <xsd:import namespace="http://www.w3.org/XML/1998/namespace" />
+    <xsd:element name="root" msdata:IsDataSet="true">
+      <xsd:complexType>
+        <xsd:choice maxOccurs="unbounded">
+          <xsd:element name="metadata">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" />
+              </xsd:sequence>
+              <xsd:attribute name="name" use="required" type="xsd:string" />
+              <xsd:attribute name="type" type="xsd:string" />
+              <xsd:attribute name="mimetype" type="xsd:string" />
+              <xsd:attribute ref="xml:space" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="assembly">
+            <xsd:complexType>
+              <xsd:attribute name="alias" type="xsd:string" />
+              <xsd:attribute name="name" type="xsd:string" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="data">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
+                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
+              </xsd:sequence>
+              <xsd:attribute name="name" type="xsd:string" use="required" msdata:Ordinal="1" />
+              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
+              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
+              <xsd:attribute ref="xml:space" />
+            </xsd:complexType>
+          </xsd:element>
+          <xsd:element name="resheader">
+            <xsd:complexType>
+              <xsd:sequence>
+                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
+              </xsd:sequence>
+              <xsd:attribute name="name" type="xsd:string" use="required" />
+            </xsd:complexType>
+          </xsd:element>
+        </xsd:choice>
+      </xsd:complexType>
+    </xsd:element>
+  </xsd:schema>
+  <resheader name="resmimetype">
+    <value>text/microsoft-resx</value>
+  </resheader>
+  <resheader name="version">
+    <value>2.0</value>
+  </resheader>
+  <resheader name="reader">
+    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+  </resheader>
+  <resheader name="writer">
+    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+  </resheader>
+  <assembly alias="System.Drawing" name="System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
+  <data name="$this.Icon" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
+    <value>
+        AAABAAEAMC8AAAEAGAAQHAAAFgAAACgAAAAwAAAAXgAAAAEAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
+        AAD2/f/t/P////b//Pz9/P/5//Lz+f/9/v/9///9///9//7///z///z///7////9//v7/////v///fz5
+        //7///7//f//+//9//z4//v///P2+P/9/P/5/fv9//v////7//75/f/3///z+f////X+/f///f/5///5
+        ///8/fj//vz9/f/z//3///Tq9P////P//////f/+/+yimgSmnQClkQK3nwKtnACqmgGpmQCpmQCpmQCs
+        mQGrlwGrlwGsmAKsmAermQCqlwCmlAiplgiqlgDAtzn1//7//f/9/P/t+P9xt/g9m+0zmvQxmPktlf82
+        mvgslfhBpvMqm/ssovQyn/U6kvgqkfs1l/Y0m/04mvs0lfsunf81mu9Dmfvt9v///////f////ulnQCo
+        mACwmASrjQKunAGonQCnnAComQCpmQCqmgGpmQCpmQCpmQCrlwCsmAGwmAGqmQGmmwCtnwDEtkr/+///
+        /vX///z3//5nvfUsmu0wm/w0lfc3mPsfkP8+o/JZU15YkMsglvwskvsrmfk2ofAxnPkqk/0xlv0vlPQs
+        mP8lmPw0le////P////7/v///P+lmAGplAWrnQCrmgCjnACrmwGqmQGqmAKqlwOrmASqlwOqmAKqmQGy
+        mAGnnQCjmQCllQWimACnnQDDuVP7//v5/v//+////v9zu/0ymvksmP8tlfQ1nfQUjP9Xmd8mDABfir0h
+        mP8sm/wynPwsmu8smvgxjvs5nP0wm+8ulPgul/8wmf/2//f////8/f///f+lmQCtnACslgCznQOjlwCp
+        mAGpmAGolwCpmAGomAComAComgCpmwColgWnmACwnAC3qQa7rQDCpAHUvVz0///0//7///7///59uPk4
+        lPcslf8zmf47n/cJjvdYiL80MiJRn+AelP8ume03lPUtk/8snPQ3mPsunPIlnuoxmvUzlfc0lff//v//
+        ///+/v7//f+lmwClnACmlwWfkwCfmgeylwKxlgGxlwCumACumQCtmACwmgCynACqlwPAsALDtACalBBs
+        cFNLS1uFgIL+/v74/v3////9//55u/4xmPkllv8smf4umfQLlv5YbohVRj1HmOculP87mPk1mfcylfwq
+        l/Q2lv8tk/cumfY6m/4ym/Y1mPT//f/////+//v/+/+jkwCsmQGzmgS0mwCulwKpmQCpmgConQConQCn
+        nAClmwConAKsnwe4pgeCeE8+NlYFABMIBxQLDBhaWV3//f/7//b///b7/vRxv/Y0nfIylvs4k/kylPYi
+        nvteWVhIWGQvmP4sm/4ql/Q2l/IjmfstmPc1lf85l/87lv40kPstl/swmvn4/v3////7//z/+P+kowCi
+        mgCklgCtmgCmmACplgKpmAGomwComwCnmAGmlwWqlw6wmhUxO0wAAg8SEBohFhsXGBsLERdiY2f////2
+        /f//+P//+/9ru/0sme43mPs2l/kimfYzpf85PStecY0clv8glvM4mP45m/MumfgunO0ul/gumfYunu4v
+        mvcxmf4xlvfz//z////9//79//+tmQComAKrmQCmmQCsmgCrmACsmAGlmwC1mQCqnQCppACklgQAATkP
+        CREUGhoTFBQSCxwPERojIEFtbHb3//7//f////78//1zu/0wmfQzmf43lv4gjvw2nv02LyJdhqUhmf8s
+        m/k1lvwvlPs3m/U8l/gsmfIsn/csle86mfsuk/kzmf75//j////9//79//+tmQComAKrmQCmmQCrmQCu
+        nAWblwCmnAGplgCqmwC+oQGwpQB7amQBBhQKDxIPFBowLUx/aGqikwDezU35/////f////78//11u/0w
+        mfQymP00l/4akflPp/g8KxtkjagXmv4nnPkrlf03nfQkmPUsm/w5l/0skfksm/8vl/Utl/Yulvv///n/
+        ///8//39//+tmQComAKrmQCmmQCqmAChkwCrmwSymQCnlgCilgSjkwC6rADBrQBHO2YVFj57eFuwpgTQ
+        tADGrQfMxUn/+f///v////7///54uv4ymPYwmP0vl/wXk/tXlt4rIBwnEQ50k70tmf0emf8smPw8lvYu
+        lP84lf0umfQvnfwzkvk8nfkwl/D1/v/////8//39//+tmQComAKrmQClmACqmAC1lwSxlwCupAGxpQCw
+        lwWjkQanmQC5pAClmgGZiQDAvQC3rgOfoQCUlQDCv1H/+//9///9//7///95uf40mPYvmPksmPgUl/ti
+        jbMvKSYPDxQAAAFwbW9KovcclfckmP81mfA0lvUsl/sumf80lvYpl/AynPz//P7////8//39//+tmQCo
+        mAKrmQCmmQCrmQCymQCepQCjlgGzqAC2qgCrlwGdnQCllwK1qgC2rASylwGtkACwmASpmAHDukv//v39
+        ///9//7///95uf40mPYvmPkrl/cWmvtrf5UTEgoVFxcUGRsEAQBbQDdxn9kbnvkWlv82m/U4nPgjlfc0
+        nfI2nfgwk////f3////9//79//+tmQComAKrmQCnmgCsmgC2ogSklwAgF19kYV3Bogi6qgGmmQKhlACx
+        lgGolACtlgCxlwCulQanmgDHwVP8//n///////7///94uf8ymPYvmPktl/Ydnf1hanMUCg8jFxgZGRkc
+        GBkPBwkfEAZqh6cznvwolv4slPk4nv0qmvQml/U1lfv//v/////9//79//+tmQCnlwKrmQComwCunAHL
+        sgBiXG0DBA8AAgpJPWeTigC2pQC3nQCplQGilgSonQCzmwCtnACemADHwUv//vn////+//39//91uf8x
+        mfcymfsxl/Ujnv9cVFsHDQcTGhoUFyMJFx8gHxYXEQ8JAgBvZ2BQoekdnv8ikfU3mP8tlfs4m/f9//b/
+        ///9//79//+tmQCnlwKrmQComwCwnQKrnwQHBiITFBsSFxsAAhqNfkW5sACllgSymQCmlwClmAKjlgGl
+        mACxnAXFtVX//P///v/+//39//9zuv8xmfgymfs0lvUrn/9IODwPCwUUExIYEhgbFBYSEhwNDhoXFRQD
+        AQA6Kh5pl7Yrl/cslf8ymfssmPz5//7/////+P////yrmACulwKxmACmmAO6qgBzdVgNAhoVGhoLCxJU
+        V1zAuAC2nAOskgOolwCzmAOsmgCnnQCxnAGtmQDFv1H7+//8//Ly///9/v96u/c7lv0yl/4alvdfiMc4
+        MCokHRcoIRoqIhwpIhssJR8oIRosJB4tJRwQCQsYAABicnkynfItmP4vmvv//v/////9/f/0//ejmgac
+        kQKwmwGplgK/tQBEP04UCxgTExggGy6MjS22tACnlAGnmAGllAKtlgKtnACklgKpkgSxmwLDwkv3//P/
+        ////+//5/v92vfczlPkrlfsblf85mOdjiK5bgKZjiK5kibBih61kibBhhqxjiK5riqljiq5liKFOboJC
+        kuQrmvgxmvX//fv////9/v////yplQGxmgK/nAC6oQCsnAEPEC4YGBgMDBY3LEy/sAOwpgCnlwKkmgCp
+        mQOtmQCunQCmlgCulQKxmgLDuVP//P////7/+////v92wPctm/k4m/wrlP4rmvIVlf8Vlf8Zmf8YmP8W
+        lv8Xl/8Xl/8YmP8Hm/0hlv8JjvgZo/Mskfk+lv8tlf77+//////z/f//+P+snAKolwCwlQGupgCWkDAA
+        BhoSFhkHEBJeVlfSugCpmAGnmACqnACnmgCrmgCrlwCwmAS3nQSllgC2sDz//fL+//n///z/9/9ttvUd
+        lfM8mvc3lfg2mfU1mfU2mvY0mPQylvIylvIzl/M1mfU0mPQ0lv81lv03mP4sn/Qvlv81kf8omPT1//j/
+        //////z//u+pnAeqpQ2yoxW/uhqNjVAiGCgxJzYoNSuIg1XHthy0pB+wpRSypRisoxezqhitphOxpRax
+        og+mnQnJwl7///f//v/9///5+f+DwP43n/ZIo/ZInvhAo/5EovtGpP1DoflEovtGpP1Fo/xFo/xEovtJ
+        pP9EofVEovtAovJQofVLpP8xoen4/vz////3///3+f/87+D/9+///vT/9ufz9f/z8O/w9v/S7vP2/fD7
+        /uL//e34+PL++/L++fT3+O7w9Or9+Pf/+PP29+Hy//Lq+//7+/////v5//jv+f7h9P7t/fz79/nl///y
+        +P7z+f/y+P70+//0+//y+P7z+f/0+//+/fj1+/zz9//z+f/v//7q9P7n9P/8//3/////+//9//z//f/7
+        //72//X/+P///////vf/+/3//P///P//+P//+P/29////f///P///f/9////////+P///f///v/5/P37
+        //z///f1//b///z//v////7/+f7t/v////7///7///7///7//fz//v3///7///7w/f/9//7//Pv////+
+        //37/f33//////7///////f///X//P/5/f/z//z///78/v75/v/3/fz///73//f///7///jz//j//vv/
+        //b5//33///7//////7//f/++/3///j4/v3//f///P///f/8/f/+/v7///z7//j7///5/v/7///5/v/4
+        /f77///7///5/v///v/3//v//Pn7/v/5/f///f7///v//P7////7/vz///Lr/f/r//zs+P3y/v/19e7t
+        9fLr8O7+9uHt///s/f/y/P/1/f/1/v3n/P3p///w/f/2///1/P/k+f/++f/+//39//z//P//8//y/+vj
+        /+L5/vL2+e//+en/+e/u/e3z/vDu/+b89vPv/+T2+/X37PP28vf17/D/7Pb0+/Xp/unz/+br9uf/9///
+        ///9/P/4/P8D9f8C8vcd/f8I+PR8am4nHCIkIiplUk8s9PQT/f4V9P4P8v0P9f0a+Pwe7PsM9P8a7/8T
+        7/4B8/hk+f31/f////b///v9/faT0XtWrUFhsUdbtEdiuENhtUZWtE1jtUZjs0lluVJauhV4rnw3N0gp
+        Ji4iISBuc3ZcvUdfsT1isUVUsDf1+/z////9/f3/+/8B8P8C5f8C8/8H/v1pVFIVCgsKDhBULjAZ//8C
+        9fwD7f8A7f8E6/8C7fwB8/8A7/8B8P0D9v0A+Pwz9fD1/////P/5/f/7//WByWBDqSRLripAqydGrSRK
+        tSJCqyJSqSRRrClKqTY+tQBrg34gGhsYFB8LCQtkeGgzsgFRrSJRtCI+sSD1//7////5//n5//kA9vkA
+        8/8A7v8J//hqU0sOBwcXDxRVMzAT//4A8/MD9f8A8/4A7/gA8P8A8/8C7v8C8/8B7v0A6vtW9P//9//7
+        /v/3/fz9//eHzGNQrihUqyZNpydWqipHqSJRsSZUqCxLtCFQrCw1wQJeXmoJCBUdFh8JBAlxmXM8qgFa
+        rTpRpyJVpjH/+/z//////P///v0A8vYC9/8A8v8B//1jV1UHCAsRCxRaNz0S/P0E8/sA8/0A8v0C9f8A
+        9f0G8PMA9f0A7PwA7/wE+f9G+P///fj9///7///9//yFyWdJrChLrSJIsSRMsCJNrCpJqSdIriJQsz05
+        pQFkumkyKzUNFhQbEhkfEx1mt2k+sBNBrChMrCZVrCf//f3/////+//1//8C8vwD7/0C7v8E//tub20S
+        CAcCDAtUOzsO//8K9f8A7v4A7f8A7v8A7P8B/v8L//8C//8B//4f2uxI9/////7//fz//f/9+/+HxW9O
+        rC9MrCZHsShJrSFWsx9CpiVMsyVQqCBGuQdvcnYaCxMhFBoTCRheUFtCrRlGtR1MsyBKqihCrh/9////
+        /////////f8A8vsA8PcA+P8B/vt2io0aAwANDgtCLSgL//kA+PwE7f0E7v4A8v0A//90y854c3lxcXFo
+        Oj10nadQ/Pn///j///f///7///uOy2xPqidPqB5JqiJVrSROqio/rSdNsjlDpQZZq28XCiQQChIcFCID
+        AA97nW9IrQJIsiNcqyZPpilIsCz2/P3////y/v//+f8E8v8A8vwA8/8F9P9wvdAPAAEVDxU2GR1B9f8G
+        9/8B8P8A8v4B/P9G9vdXKS4EAgAAAgFFHCIt+PBR/P/5//7//v/9/P/+/f+Iy2tJqyRPsyRErSVMridU
+        qilMsyBNrStKpA9Nsjd1gnUlHSYAAQgyMUBWw0NTrCA2rChPrClNrCJRrCL9//j/////+P/7//4F9P8A
+        7v8E8P8A9vwz/P8vCAYiEBIaFBCBnawB/fwA7vgE+/8A/vuCZGABAQAZEBApBAiEv8YA/vtO/P/5/v/+
+        /v7///79/v+HzGNIrSRJrS1HqSJLqylIsDBLqyBLqSxSrCxFsA8/sgx1om9JPk5ck2pFrRNNsRdOrStK
+        qyNNrStOsCf8/f/////9///9//gA7vwA8P8D6vkB9f8A//h6YWMOCQoIDQRmRlcB//8C/f8I+f+OfXMU
+        BAEQEQ8QAQKLo6gA//gE9P9K9P3+//v3///9/f3///+WxmtVqitMridTtC5XrCxCrAczswBUshtTsClC
+        ri05rQdDuwNip1xYpzlIrRpPqCtNrCpLrCRMrCtLriL9//7//////f7///sA7vkF8P4C9PUH8PkD/vxz
+        1eUAAQAPFBAmFxp2sbpm0ut0V04YCQ8MCQUeAAiLnKkA//IA9v8E7v9Y7v3///v4/v////vv+f6Jz3NQ
+        rDVLoy89pws0uAJ1oXpihHVVris+rQtOsDZOsCtOqiNFpwxRsxhLriJQpTJKrCRMrSVLqixIrRv9////
+        /////f/z+P8A9f8A8/8A9/8A/P8A9f8C/P2IbnkNBQ8aFA0eGhc/JCcFAAYBAABGHymHxtcD//8B+f4A
+        8v8A7f9Q9////////v/49P/1//d+yks9tABDxQJpultdfH0tIEMeDh59n3lHtgFJrhpIrSpKqiZQsypP
+        rB1MriZPrClKsR5MrCZLqylJrhz//P/////5/f//+P8C+/sA8vxA2OqMU14D//QA//Bu7fkAAgAaFhcW
+        FRcTBwkyMzF5eIE5//4D//8B8v8A8/sA9v8A7flN///w/Pz/+f////v7/v+dyplwjXliW3A5LTkVGhYR
+        DBALDhEpIjBxmHZBqh1IsBpKsTA8rhpPpyxLrSZPriZLsSJLqyVLrChOriL//P///////f/5//8A9e4B
+        /v8v8PVEDARYGxp40utPOzMWBxUbGBwQEBAaFQ+Am5UD//cA+f4A8P8L9P8M7vcC8v4A7v9T8/n//vz7
+        //v/////+f9vaG8hHCoODg4VDBofERoVGhkPEhMABABpiINJrRdPsCNQpyhYsyVPrCpJqypMqixMridL
+        rSJLrSZQrij//////////P///P0A9/811u9htMka//JvlKI1ISUCAAUMChEeBBA9MDIDAQA4IiKCwNUE
+        /v8A9P8A6fsE8/4A7/wA8/9T9fv5//v7//j///v/+f9faV0TFBcgFSAWEBsGEhQFAAs9M0J7qYJWsCRN
+        rRFIrSpMqyJTpydOriJJrClLqSlKsCZMrSVKrCVOqyj///7//////P/1//gA//6SiIVGBwBWcXxWhoQX
+        FA8eFxFaWk5Y9f5D9f9pm44AAQFNKCZI9/QA/P8A7f8D7f8A8/8H7fxP+P39/v///v///v///f1YXFYN
+        ChQJAQgbCx5PQ09yk3Zgu0k8rQNDqRhOsS5KrCRFriZJrC5MrCFIridLsB9KsyBNrSlJqyRNqyX//v//
+        ///////7+P8A9f0A8v8L//9tp6wXCwxFODJuk6FVu8ZbcnRhgYJNyc6BvsAAAwCJWEwC//8A7/8C7vYA
+        9f8A7v9S9/v///b4/f///P//+/+SkJBjZW1xhH1us2RHuyVErg9HsBRLsR5NriZMqylMqylMrCZMrSVH
+        riBIqSVQsilGrR9PqCNMtShBqyP/+P/////+/fj//f8A/PwH9/8v/+0jAAAtBQJF//gA+P9sWlkCAAJF
+        NDtWLCsB//+ZmKkAAwCFsboA//8H8v8A7/kA7v9Q8P/4+//9//T5///r//iI2XBIuRA5pwBIsg5IrhlK
+        sB9LsCJMridLqypKqStJqShKqihLrChRsClNqCVNqiFQsilRpSlKqyNNsyL///v///////b4+fcA9fsE
+        +/tyLS4OAQRt8vYH//8A+P+NhIAAAgAABABwPT0A+/8F//9raGQ5BAQk/fcA8v8A8vsA9f5c8//3//z/
+        //v/+//8+/2NxWxSsR9MqyJTsypNqi1PriZPriZPrSdOrCZNrCROrSNOriJPsCNKpyVTsS1MqiRKqyxS
+        qi5NriZJqyH///v/////+//z/v8D9f856vltNTh9wM8A+/8B7/cA+P8N/PWOh456eoBP5e0A/P8E+P4+
+        7fx7Y3Ftqr8A+P8C/PkB7u9M9v///P7//P3/+//9/v+ExGtCrCRDsDRBqyNEqCdMqSdNqidNqyVOrSVO
+        rSNPriRPriZPriZLsCJGqyJKrSJDrChDqR1MsyBNqyz3///////z/f///v8A8vIA8/8A//UD+/8D7/8A
+        9f0A7/8E9/8A/vwA//4E9f8A6v0G9v4A+P8D//8A9f4A8/8B6f0A8/8+9////f/9/////v/2/fx/w2RD
+        rhtKsihPrB1ZqixLrSVLrSVLriNMsSNMsCRLrSVLrSZKqydQqyhKqChPqShLrTJNsChNqSJSqDLw//L/
+        ////+f////T7////+/////j2+/z9//f4/v///P/+/Pz5/f/9/P///f75////+//1/////P/2/vv///z2
+        //3//f/y///1//Tz//3/+/z/9/////f///v99v/9/f37//z////////////////+/f/+/f/+/P/++///
+        /f39//////j7/v/1/Pb///7+//X/8P/////7/f/4/v/3+////f/////8+f///P///v/3//v7//nz/Pv/
+        /v/3//z7//v1///5//f//Pj5/////f/z///3///5/P3///v3//7///j//fn//v3/+///9////v7+//T/
+        //7///7//////////v7////////////7/v/5/v////n5/f/5//7/+//5//v///f///8AAAAAAAAAAAAA
+        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
+        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
+        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
+        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
+        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
+        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
+        AAAAAAAA
+</value>
+  </data>
+</root>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,644 @@
+Imports System.Xml
+Imports System.Net
+Public Class capxml2wms
+
+    Dim DPunkt As New Globalization.CultureInfo("") 'en-US 
+
+    Dim SRSCWAll() As String = {"31466", "31467", "31468", "31469", "3003", "3004", "4326"}
+
+    Dim xmlFileName As String
+
+    Dim GotCapabilities As Boolean = False
+
+    Dim wmsUrl As String = "" ' Input
+    Dim capsUrl As String = "" ' direkt aus Input herstellen
+    Dim mapUrl As String = "" ' Output
+
+    Dim Version As String = "" '1.
+    Dim OnlineResource As String = "" '2.nicht wichtig
+    Dim land As String = "" '3.
+    Dim area As String = "" '4.
+    Dim SRSCW As String = "" '5. so wie es CW in der wms haben will
+    Dim SRS As String = "" '6. Auflistung der EPSG-Codes des wms-Servers
+    Dim minx As String = "" '7. Die BoundingBox Werte 
+    Dim miny As String = "" '8.
+    Dim maxx As String = "" '9.
+    Dim maxy As String = "" '10.
+
+    Dim mittex As String = ""
+    Dim mittey As String = ""
+
+    Dim rminx As Double
+    Dim rminy As Double
+    Dim rmaxx As Double
+    Dim rmaxy As Double
+
+    Dim rxmitte As Double
+    Dim rymitte As Double
+
+    '11. ComboBoxFormat Bild Speicherformat (png,jpg ...)
+    '12. CheckedListBoxLayers Layers mit Name, Title und Scalehint 
+    '13. ComboBoxBBox LatlonBoundingBox
+
+
+    Dim MeineSkalierung As Integer
+
+    Dim OBBoxes As Dictionary(Of String, XmlElement)
+
+    Private Sub capxml2wms_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
+        Try
+            IO.File.Delete(xmlFileName)
+        Catch ex As Exception
+        End Try
+    End Sub
+
+    Private Sub capxml2wms_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
+        xmlFileName = IO.Path.GetTempFileName
+        IO.File.Delete(xmlFileName)
+
+        xmlFileName = IO.Path.ChangeExtension(xmlFileName, ".xml")
+
+        Me.TextBoxUrl.Text = "http://"
+
+        Me.ComboBoxVersion.SelectedIndex = 2
+
+    End Sub
+
+    Private Sub GetLayers(ByVal n As XmlNode)
+        Dim Layername As String = ""
+        If n.Name = "Layer" Then
+            For Each sn As XmlNode In n.ChildNodes
+                If sn.Name = "Name" Then
+                    Layername = sn.ChildNodes.ItemOf(0).Value
+                End If
+                If sn.Name = "Title" Then
+                End If
+                If sn.Name = "ScaleHint" Then
+                End If
+            Next
+
+        End If
+        CheckedListBoxLayers.Items.Add(Layername, False)
+    End Sub
+
+    Private Sub ButtonGetCapabilities_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonGetCapabilities.Click
+        GotCapabilities = GetCapabilities()
+    End Sub
+
+    Private Sub ButtonShowMap_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonShowMap.Click
+
+        'http:// www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous
+        '&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap
+        '&SRS=EPSG:31467
+        '&BBOX=3500394.51 , 5371405.09 , 3520394.51 , 5391405.09 
+        '&WIDTH=1000
+        '&HEIGHT=1000
+        '&LAYERS=DVTK50K
+        '&STYLES=
+        '&FORMAT=image/png
+
+        MeineSkalierung = 2.0 * Me.HScrollBar1.Value
+
+        mapUrl = wmsUrl & "SERVICE=WMS&VERSION=" & Version & "&REQUEST=GetMap"
+
+        mapUrl += "&SRS=EPSG:" & Me.ComboBoxEPSG.SelectedItem
+
+        Dim rxmin As Double
+        Dim rxmax As Double
+        Dim rymin As Double
+        Dim rymax As Double
+
+        If Me.ComboBoxEPSG.SelectedItem = "4326" Then
+            Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
+            GetBBoxValues(Me.ComboBoxBBoxI.SelectedItem)
+        Else
+            Try
+                GetBBoxValues(Me.OBBoxes.Item("EPSG:" & Me.ComboBoxEPSG.SelectedItem))
+            Catch ex As Exception
+                'todo: und jetzt umrechnen !
+                'das spar ich mir wohl, oder !
+                Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
+                GetBBoxValues(Me.ComboBoxBBoxI.SelectedItem)
+                ' jetzt haben wir die BBox zum WGS84
+                MsgBox("Kartenansicht f?r diese Auswahl nicht implementiert", MsgBoxStyle.Exclamation)
+                Exit Sub
+            End Try
+        End If
+
+        Dim HalbeKantenlaengex As Double = (rmaxx - rminx) / MeineSkalierung
+        Dim HalbeKantenlaengey As Double = (rmaxy - rminy) / MeineSkalierung
+        Dim HalbeKantenlaenge As Double = HalbeKantenlaengex
+        If HalbeKantenlaengex > HalbeKantenlaengey Then
+            HalbeKantenlaenge = HalbeKantenlaengey
+        End If
+        ' is in x und y die gleiche Einheit?
+        rxmin = rxmitte - HalbeKantenlaenge
+        rxmax = rxmitte + HalbeKantenlaenge
+        rymin = rymitte - HalbeKantenlaenge
+        rymax = rymitte + HalbeKantenlaenge
+
+        Dim BBox As String = "&BBox=" & rxmin.ToString(DPunkt) & "," & rymin.ToString(DPunkt) & ","
+        BBox += rxmax.ToString(DPunkt) & "," & rymax.ToString(DPunkt)
+
+        mapUrl += BBox
+        mapUrl += "&WIDTH=1000"
+        mapUrl += "&HEIGHT=1000"
+        ' und die gew?hlten Layer durch Komma getrennt
+        Dim SelectedLayers As String = ""
+        For Each s As String In CheckedListBoxLayers.CheckedItems
+            SelectedLayers += "," & s.Split("|")(0)
+        Next
+        If SelectedLayers <> "" Then
+            mapUrl += "&LAYERS=" & SelectedLayers.Substring(1).Replace(" ", "%20")
+        End If
+        mapUrl += "&STYLES="
+        mapUrl += "&FORMAT=" & Me.ComboBoxFormat.SelectedItem.ToString
+
+        Dim SM As New Map(mapUrl)
+        'MsgBox("Noch nicht vorhanden!", MsgBoxStyle.Information, "Hinweis!")
+        SM.ShowDialog()
+    End Sub
+
+    Private Sub ButtonErstellen_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonErstellen.Click
+
+        Dim wmsFileName As String = IO.Path.ChangeExtension(xmlFileName, ".wms")
+        IO.File.Delete(wmsFileName) 'vorsichtshalber
+        Dim encoding As System.Text.Encoding = New System.Text.UTF8Encoding(False)
+        Dim F As New System.IO.StreamWriter(wmsFileName, False, encoding)
+
+        If Not GotCapabilities Then
+            GotCapabilities = GetCapabilities()
+        End If
+
+        Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
+        GetBBoxValues(Me.ComboBoxBBoxI.SelectedItem)
+
+
+        F.WriteLine("TakenFromUrl:       " & OnlineResource)
+        F.WriteLine("GetCapabilitiesUrl: " & capsUrl)
+        F.WriteLine("Name:               " & land & "." & area & " topo")
+        F.WriteLine("MapType:                        topo")
+        F.WriteLine("MainUrl:            " & wmsUrl)
+        F.WriteLine("ServiceTypeUrlPart: SERVICE=WMS")
+        F.WriteLine("VersionUrlPart:     VERSION=" & Version)
+        F.WriteLine("CoordinateReferenceSystemCacheWolf: " & SRSCW)
+        F.WriteLine("CoordinateReferenceSystemUrlPart: " & SRS)
+        F.WriteLine("RequestUrlPart:     REQUEST=GetMap")
+        ' und noch die m?glichen Layer , Title, ScaleHint
+        For Each s As String In CheckedListBoxLayers.Items
+            F.WriteLine("#LayersUrlPart:     LAYERS=" & s)
+        Next
+        ' und die gew?hlten Layer durch Komma getrennt
+        Dim SelectedLayers As String = ""
+        For Each s As String In CheckedListBoxLayers.CheckedItems
+            SelectedLayers += "," & s.Split("|")(0)
+        Next
+        If SelectedLayers <> "" Then
+            F.WriteLine("LayersUrlPart:     LAYERS=" & SelectedLayers.Substring(1).Replace(" ", "%20"))
+        Else
+            F.WriteLine("LayersUrlPart:     LAYERS=")
+        End If
+        F.WriteLine("StylesUrlPart:     STYLES=")
+        F.WriteLine("ImageFormatUrlPart:FORMAT=" & Me.ComboBoxFormat.SelectedItem.ToString)
+        F.WriteLine("BoundingBoxTopLeftWGS84: " & maxy & " " & minx)
+        F.WriteLine("BoundingBoxButtomRightWGS84: " & miny & " " & maxx)
+        F.WriteLine("#BBox_Mitte: " & mittey & " " & mittex)
+        F.WriteLine("MinScale:   0")
+        F.WriteLine("MaxScale:   45")
+        F.WriteLine("RecommendedScale:   5")
+        'Me.ComboBoxFormat.SelectedItem.ToString.Split("/")(1)
+        Dim rk As Microsoft.Win32.RegistryKey = My.Computer.Registry.ClassesRoot.OpenSubKey("Mime\Database\Content Type\" & Me.ComboBoxFormat.SelectedItem.ToString)
+        Dim stmp As String = rk.GetValue("Extension")
+        F.WriteLine("ImageFileExtension: " & stmp)
+
+        F.Close()
+        ' noch ne gpx mit waypoints der BBox
+
+        Dim gpxFileName As String = IO.Path.ChangeExtension(xmlFileName, ".gpx")
+        IO.File.Delete(gpxFileName) 'vorsichtshalber
+        'Dim encoding As System.Text.Encoding = New System.Text.UTF8Encoding(False)
+        Dim G As New System.IO.StreamWriter(gpxFileName, False, encoding)
+        G.WriteLine("<?xml version=""1.0"" encoding=""ISO-8859-1"" standalone=""yes""?>")
+        G.WriteLine("<gpx xmlns=""http://www.topografix.com/GPX/1/0"" ")
+        G.WriteLine("xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" ")
+        G.WriteLine("xsi:schemaLocation=""http://www.topografix.com/GPX/1/0 http://www.topografix.com/GPX/1/0/gpx.xsd"" ")
+        G.WriteLine("version=""1.0"" creator=""ich"" > ")
+        Dim dx As Double = (rmaxx - rminx) / 10.0
+        Dim dy As Double = (rmaxy - rminy) / 10.0
+        Dim rx As Double = rminx
+        Dim ry As Double = rminy
+        Dim k As Integer = 0
+        For i As Integer = 1 To 9
+            rx += dx
+            ry = rminy
+            For j As Integer = 1 To 9
+                k += 1
+                ry += dy
+                G.Write("<wpt lat=""" & ry.ToString(DPunkt) & """ lon=""" & rx.ToString(DPunkt) & """> ")
+                G.Write("<name>CW" & k.ToString("0000") & "</name> ")
+                G.Write("<desc>" & i.ToString & ":" & j.ToString & "</desc> ")
+                G.Write("<sym>Circle, Red</sym> ")
+                G.WriteLine("</wpt>")
+            Next
+        Next
+        k += 1
+        G.Write("<wpt lat=""" & rminy.ToString(DPunkt) & """ lon=""" & rminx.ToString(DPunkt) & """> ")
+        G.Write("<name>CW" & k.ToString("0000") & "</name> ")
+        G.Write("<desc>" & "Unten Links" & "</desc> ")
+        G.Write("<sym>Circle, Green</sym> ")
+        G.WriteLine("</wpt>")
+        k += 1
+        G.Write("<wpt lat=""" & rmaxy.ToString(DPunkt) & """ lon=""" & rminx.ToString(DPunkt) & """> ")
+        G.Write("<name>CW" & k.ToString("0000") & "</name> ")
+        G.Write("<desc>" & "Oben Links" & "</desc> ")
+        G.Write("<sym>Circle, Green</sym> ")
+        G.WriteLine("</wpt>")
+        k += 1
+        G.Write("<wpt lat=""" & rmaxy.ToString(DPunkt) & """ lon=""" & rmaxx.ToString(DPunkt) & """> ")
+        G.Write("<name>CW" & k.ToString("0000") & "</name> ")
+        G.Write("<desc>" & "Oben Rechts" & "</desc> ")
+        G.Write("<sym>Circle, Green</sym> ")
+        G.WriteLine("</wpt>")
+        k += 1
+        G.Write("<wpt lat=""" & rminy.ToString(DPunkt) & """ lon=""" & rmaxx.ToString(DPunkt) & """> ")
+        G.Write("<name>CW" & k.ToString("0000") & "</name> ")
+        G.Write("<desc>" & "Unten Rechts" & "</desc> ")
+        G.Write("<sym>Circle, Green</sym> ")
+        G.WriteLine("</wpt>")
+        G.WriteLine("</gpx>")
+        G.Close()
+
+        Process.Start("notepad.exe", wmsFileName)
+        Process.Start("notepad.exe", gpxFileName)
+
+        MsgBox("Bitte die Datei im Verzeichnis webmapservices des Cachewolf speichern", MsgBoxStyle.Information, "WMS-Datei")
+
+        IO.File.Delete(wmsFileName)
+        IO.File.Delete(gpxFileName)
+
+    End Sub
+
+    Private Sub TextBoxUrl_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TextBoxUrl.TextChanged
+        GotCapabilities = False
+        Me.ButtonShowMap.Enabled = False
+        wmsUrl = Me.TextBoxUrl.Text
+        capsUrl = Me.TextBoxUrl.Text
+    End Sub
+
+    Private Sub ButtonCheckAll_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonCheckAll.Click
+        For i As Integer = 0 To Me.CheckedListBoxLayers.Items.Count - 1
+            If Not Me.CheckedListBoxLayers.GetItemCheckState(i) = CheckState.Checked Then
+                Me.CheckedListBoxLayers.SetItemCheckState(i, CheckState.Checked)
+            End If
+        Next
+    End Sub
+
+    Private Sub ButtonCheckNone_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonCheckNone.Click
+        For i As Integer = 0 To Me.CheckedListBoxLayers.Items.Count - 1
+            If Not Me.CheckedListBoxLayers.GetItemCheckState(i) = CheckState.Unchecked Then
+                Me.CheckedListBoxLayers.SetItemCheckState(i, CheckState.Unchecked)
+            End If
+        Next
+    End Sub
+
+    Private Function GetCapabilities() As Boolean
+
+        If wmsUrl.IndexOf("?") = -1 Then
+            wmsUrl += "?"
+        Else
+            If Not wmsUrl.EndsWith("?") Then
+                If Not wmsUrl.EndsWith("&") Then
+                    wmsUrl += "&"
+                End If
+            End If
+        End If
+
+        ' Version kann vermutlich entfallen, denn wer weiss das schon vorher
+        capsUrl = wmsUrl & "SERVICE=WMS&VERSION=" & Me.ComboBoxVersion.SelectedItem & "&REQUEST=GetCapabilities"
+
+        Dim wc As New WebClient()
+        Try
+            IO.File.Delete(xmlFileName)
+        Catch ex As Exception
+        End Try
+        Try
+            wc.DownloadFile(capsUrl, xmlFileName)
+        Catch ex As Exception
+            MsgBox(ex.Message, MsgBoxStyle.Critical)
+            If IO.File.Exists(xmlFileName) Then
+                IO.File.Delete(xmlFileName)
+            End If
+            Exit Function
+        End Try
+
+        Dim xd As New XmlDocument
+        xd.PreserveWhitespace = False
+        Dim xtr As New XmlTextReader(xmlFileName)
+        Try
+            xd.Load(xtr)
+        Catch ex As Exception
+            Process.Start("notepad.exe", xmlFileName)
+            MsgBox("Oh, ein nicht Standard wms-Server! Da geb ich auf!!!", MsgBoxStyle.Exclamation)
+            Try
+                IO.File.Delete(xmlFileName)
+            Catch e As Exception
+            End Try
+            Exit Function
+        End Try
+        xtr.Close()
+        IO.File.Delete(xmlFileName)
+
+        Me.TextBoxXML.Clear()
+        Dim ms As New IO.MemoryStream
+        xd.Save(ms)
+        Dim encoding As System.Text.Encoding = New System.Text.UTF8Encoding '.ASCIIEncoding
+        Me.TextBoxXML.Text = encoding.UTF8.GetString(ms.GetBuffer())
+        ms.Close()
+
+        Me.ButtonShowMap.Enabled = True
+
+        '1. Version aus WMT_MS_Capabilities
+        For Each nl As XmlNode In xd.GetElementsByTagName("WMT_MS_Capabilities")
+            If nl.NodeType = XmlNodeType.Element Then
+                Dim ne As XmlElement = nl
+                Version = ne.GetAttribute("version")
+                Exit For
+            End If
+        Next
+
+        Dim Caps As XmlNodeList = Nothing
+        Dim Service As XmlNodeList = Nothing
+        For Each N As XmlNode In xd.DocumentElement.ChildNodes
+            If N.Name = "Capability" Then
+                Caps = N.ChildNodes
+            End If
+            If N.Name = "Service" Then
+                Service = N.ChildNodes
+            End If
+        Next
+
+        '2. OnlineResource  aus Service
+        For Each nl As XmlNode In Service
+            If nl.NodeType = XmlNodeType.Element Then
+                If nl.Name = "OnlineResource" Then
+                    Dim ne As XmlElement = nl
+                    OnlineResource = ne.GetAttribute("xlink:href")
+                    Exit For
+                End If
+            End If
+        Next
+
+        Dim Request As XmlElement = Nothing
+        Dim Exception As XmlElement = Nothing
+        Dim VendorSpecificCapabilities As XmlElement = Nothing
+        Dim UserDefinedSymbolization As XmlElement = Nothing
+        Dim Layer As XmlElement = Nothing
+        For Each N As XmlNode In Caps
+            If N.NodeType = XmlNodeType.Element Then
+                If N.Name = "Request" Then
+                    Request = N
+                End If
+                If N.Name = "Exception" Then
+                    Exception = N
+                End If
+                If N.Name = "VendorSpecificCapabilities" Then
+                    VendorSpecificCapabilities = N
+                End If
+                If N.Name = "UserDefinedSymbolization" Then
+                    UserDefinedSymbolization = N
+                End If
+                If N.Name = "Layer" Then
+                    Layer = N
+                End If
+            End If
+        Next
+        If Layer Is Nothing Then
+            Exit Function
+        End If
+
+        Dim ltmp() As String
+        ltmp = wmsUrl.Split("/")(2).Split(".")
+        '3.
+        land = ltmp(ltmp.Length - 1)
+        '4.
+        area = ltmp(ltmp.Length - 2)
+
+        '5. EPSG und 6. EPSG
+        ' SRS = Spatial referencing systems  
+        ' EPSG = European Petroleum Survey Group
+        ComboBoxEPSG.Items.Clear()
+        SRS = ""
+        SRSCW = ""
+        Dim SRSNodes As XmlNodeList = Layer.GetElementsByTagName("SRS")
+        Dim SRSD As New Dictionary(Of String, String)
+        For Each N As XmlNode In SRSNodes
+            Dim SRStmp As String = N.ChildNodes.ItemOf(0).Value
+            For Each s As String In SRSCWAll
+                If SRStmp.IndexOf(s) > 0 Then
+                    If Not SRSD.ContainsKey("SRS=EPSG:" & s) Then
+                        SRSD.Add("SRS=EPSG:" & s, " ")
+                        SRS = SRS & "SRS=EPSG:" & s & " "
+                        SRSCW = SRSCW & " " & s
+                        ComboBoxEPSG.Items.Add(s)
+                    End If
+                End If
+            Next
+        Next
+        Me.ComboBoxEPSG.SelectedIndex = -1
+        For i As Integer = 0 To Me.ComboBoxEPSG.Items.Count - 1
+            If Me.ComboBoxEPSG.Items.Item(i) = "4326" Then
+                Me.ComboBoxEPSG.SelectedIndex = i
+                Exit For
+            Else
+                'falls ?berhaupt was drin steht
+                Me.ComboBoxEPSG.SelectedIndex = 0
+            End If
+        Next
+
+        '11.
+        Me.ComboBoxFormat.Items.Clear()
+        For Each n As XmlNode In Request.GetElementsByTagName("GetMap")
+            ' gibt eigentlich nur einen
+            For Each fn As XmlNode In n.ChildNodes
+                If fn.NodeType = XmlNodeType.Element Then
+                    If fn.Name = "Format" Then
+                        Me.ComboBoxFormat.Items.Add(fn.ChildNodes.ItemOf(0).Value)
+                    End If
+                End If
+            Next
+        Next
+        Me.ComboBoxFormat.SelectedIndex = 0
+        For i As Integer = 0 To Me.ComboBoxFormat.Items.Count - 1
+            If Me.ComboBoxFormat.Items.Item(i).ToString.EndsWith("png") Then
+                Me.ComboBoxFormat.SelectedIndex = i
+                Exit For
+            End If
+        Next
+
+        '12. CheckedListBoxLayers
+        CheckedListBoxLayers.Items.Clear()
+        ' nur die Nodes mit "Name" , zu "Layer" geh?ren
+        Dim NodesToDo As New Dictionary(Of XmlNode, String)
+        For Each n As XmlNode In Layer.GetElementsByTagName("Name")
+            If n.ParentNode.Name = "Layer" Then
+                If Not NodesToDo.ContainsKey(n.ParentNode) Then
+                    NodesToDo.Add(n.ParentNode, "")
+                    Dim tmp_name As String = ""
+                    Dim tmp_titel As String = ""
+                    Dim tmp_skalierung_min As String = ""
+                    Dim tmp_skalierung_max As String = ""
+                    If n.ParentNode.Name = "Layer" Then
+                        For Each sn As XmlNode In n.ParentNode.ChildNodes
+                            If sn.Name = "Name" Then
+                                tmp_name = sn.ChildNodes.ItemOf(0).Value
+                            End If
+                            If sn.Name = "Title" Then
+                                tmp_titel = sn.ChildNodes.ItemOf(0).Value
+                            End If
+                            If sn.Name = "ScaleHint" Then
+                                tmp_skalierung_min = sn.Attributes.ItemOf(0).Value
+                                tmp_skalierung_max = sn.Attributes.ItemOf(1).Value
+                            End If
+                        Next
+                    End If
+                    CheckedListBoxLayers.Items.Add(tmp_name & "|" & tmp_titel & "|" & tmp_skalierung_min & "|" & tmp_skalierung_max, False)
+                End If
+            End If
+        Next
+
+        '13. ComboBoxBBox LatlonBoundingBox
+        Me.ComboBoxBBox.Items.Clear()
+        Me.ComboBoxBBoxI.Items.Clear()
+        Dim BBoxes As New Dictionary(Of String, String)
+        For Each n As XmlNode In Layer.GetElementsByTagName("LatLonBoundingBox")
+            If n.NodeType = XmlNodeType.Element Then
+                GetBBoxValues(n)
+                Dim stmp As String = "ol=" & maxy & " " & minx & " , ur=" & miny & " " & maxx
+                If Not BBoxes.ContainsKey(stmp) Then
+                    Me.ComboBoxBBox.Items.Add(stmp)
+                    Me.ComboBoxBBoxI.Items.Add(n)
+                    BBoxes.Add(stmp, "")
+                End If
+            End If
+        Next
+        Me.ComboBoxBBox.SelectedIndex = 0
+        'Me.ComboBoxBBoxI.SelectedIndex = 0
+
+        '.z.B.
+        '<BoundingBox SRS="EPSG:31467" minx="3340000" miny="5230000" maxx="3615000" maxy="5550000" />
+        OBBoxes = New Dictionary(Of String, XmlElement)
+        For Each n As XmlNode In Layer.GetElementsByTagName("BoundingBox")
+            If n.NodeType = XmlNodeType.Element Then
+                Dim e As XmlElement = n
+                Dim stmp As String = e.GetAttribute("SRS")
+                If Not OBBoxes.ContainsKey(stmp) Then
+                    OBBoxes.Add(stmp, e)
+                End If
+            End If
+        Next
+
+        Return True
+
+    End Function
+
+    Private Sub GetBBoxValues(ByVal e As XmlElement)
+        'in die folgenden globalen Variablen
+        'Dim minx As String = "" '7. Die BoundingBox Werte 
+        'Dim miny As String = "" '8.
+        'Dim maxx As String = "" '9.
+        'Dim maxy As String = "" '10.
+
+        'Dim rminx As Double
+        'Dim rminy As Double
+        'Dim rmaxx As Double
+        'Dim rmaxy As Double
+        minx = e.GetAttribute("minx")
+        rminx = Double.Parse(minx, DPunkt.NumberFormat)
+        minx = Format(rminx, "0.0000").Replace(",", ".")
+        If minx.StartsWith("-") Then
+            minx = minx.Substring(1)
+            minx = "W " & minx
+        Else
+            minx = "E " & minx
+        End If
+
+        miny = e.GetAttribute("miny")
+        rminy = Double.Parse(miny, DPunkt.NumberFormat)
+        miny = Format(rminy, "0.0000").Replace(",", ".")
+        If miny.StartsWith("-") Then
+            miny = miny.Substring(1)
+            miny = "S " & miny
+        Else
+            miny = "N " & miny
+        End If
+
+        maxx = e.GetAttribute("maxx")
+        rmaxx = Double.Parse(maxx, DPunkt.NumberFormat)
+        maxx = Format(rmaxx, "0.0000").Replace(",", ".")
+        If maxx.StartsWith("-") Then
+            maxx = maxx.Substring(1)
+            maxx = "W " & maxx
+        Else
+            maxx = "E " & maxx
+        End If
+
+        maxy = e.GetAttribute("maxy")
+        rmaxy = Double.Parse(maxy, DPunkt.NumberFormat)
+        maxy = Format(rmaxy, "0.0000").Replace(",", ".")
+        If maxy.StartsWith("-") Then
+            maxy = maxy.Substring(1)
+            maxy = "S " & maxy
+        Else
+            maxy = "N " & maxy
+        End If
+
+        rxmitte = (rminx + rmaxx) / 2
+        If rxmitte < 0 Then
+            mittex = "W " & Math.Abs(rxmitte).ToString(DPunkt.NumberFormat)
+        Else
+            mittex = "E " & rxmitte.ToString(DPunkt.NumberFormat)
+        End If
+        rymitte = (rminy + rmaxy) / 2
+        If rymitte < 0 Then
+            mittey = "S " & Math.Abs(rymitte).ToString(DPunkt.NumberFormat)
+        Else
+            mittey = "N " & rymitte.ToString(DPunkt.NumberFormat)
+        End If
+
+    End Sub
+
+    Private Structure point
+        Dim x As Double
+        Dim y As Double
+    End Structure
+    Private Structure xyzKoordinate
+        Dim x, y, z As Double
+    End Structure
+    Private Structure Ellipsoid
+        Dim a As Double ' Semi-Major Axis
+        Dim b As Double ' Inverse Flattening
+    End Structure
+
+    Private Function fromEPSG4326(ByVal pt As point, ByVal EPSGxxxx As String) As point
+        ' "31466", "31467", "31468", "31469", "3003", "3004", "4326"}
+        Dim WGS84 As Ellipsoid
+        WGS84.a = 6378137
+        WGS84.b = 298.257223563
+
+        Select Case EPSGxxxx
+            Case "31466"
+            Case "31467"
+            Case "31468"
+            Case "31469"
+            Case "3003"
+            Case "3004"
+            Case Else
+        End Select
+    End Function
+
+    Private Function EPSG4326toxyz(ByVal pt As point) As xyzKoordinate
+
+
+    End Function
+
+End Class

Added: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,120 @@
+???<?xml version="1.0" encoding="utf-8"?>
+<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
+  <PropertyGroup>
+    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
+    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
+    <ProductVersion>8.0.50727</ProductVersion>
+    <SchemaVersion>2.0</SchemaVersion>
+    <ProjectGuid>{623B1E12-B5BF-4835-A982-AE5500BFADC8}</ProjectGuid>
+    <OutputType>WinExe</OutputType>
+    <StartupObject>capxml2wms.My.MyApplication</StartupObject>
+    <RootNamespace>capxml2wms</RootNamespace>
+    <AssemblyName>capxml2wms</AssemblyName>
+    <MyType>WindowsForms</MyType>
+    <ApplicationIcon>gc.ico</ApplicationIcon>
+  </PropertyGroup>
+  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
+    <DebugSymbols>true</DebugSymbols>
+    <DebugType>full</DebugType>
+    <DefineDebug>true</DefineDebug>
+    <DefineTrace>true</DefineTrace>
+    <OutputPath>bin\Debug\</OutputPath>
+    <DocumentationFile>capxml2wms.xml</DocumentationFile>
+    <NoWarn>42016,41999,42017,42018,42019,42032,42036,42020,42021,42022</NoWarn>
+  </PropertyGroup>
+  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
+    <DebugType>pdbonly</DebugType>
+    <DefineDebug>false</DefineDebug>
+    <DefineTrace>true</DefineTrace>
+    <Optimize>true</Optimize>
+    <OutputPath>bin\Release\</OutputPath>
+    <DocumentationFile>capxml2wms.xml</DocumentationFile>
+    <NoWarn>42016,41999,42017,42018,42019,42032,42036,42020,42021,42022</NoWarn>
+  </PropertyGroup>
+  <ItemGroup>
+    <Reference Include="System" />
+    <Reference Include="System.Data" />
+    <Reference Include="System.Deployment" />
+    <Reference Include="System.Drawing" />
+    <Reference Include="System.Windows.Forms" />
+    <Reference Include="System.Xml" />
+  </ItemGroup>
+  <ItemGroup>
+    <Import Include="Microsoft.VisualBasic" />
+    <Import Include="System" />
+    <Import Include="System.Collections" />
+    <Import Include="System.Collections.Generic" />
+    <Import Include="System.Data" />
+    <Import Include="System.Drawing" />
+    <Import Include="System.Diagnostics" />
+    <Import Include="System.Windows.Forms" />
+  </ItemGroup>
+  <ItemGroup>
+    <Compile Include="capxml2wms.vb">
+      <SubType>Form</SubType>
+    </Compile>
+    <Compile Include="capxml2wms.Designer.vb">
+      <DependentUpon>capxml2wms.vb</DependentUpon>
+      <SubType>Form</SubType>
+    </Compile>
+    <Compile Include="Map.Designer.vb">
+      <DependentUpon>Map.vb</DependentUpon>
+    </Compile>
+    <Compile Include="Map.vb">
+      <SubType>Form</SubType>
+    </Compile>
+    <Compile Include="My Project\AssemblyInfo.vb" />
+    <Compile Include="My Project\Application.Designer.vb">
+      <AutoGen>True</AutoGen>
+      <DependentUpon>Application.myapp</DependentUpon>
+    </Compile>
+    <Compile Include="My Project\Resources.Designer.vb">
+      <AutoGen>True</AutoGen>
+      <DesignTime>True</DesignTime>
+      <DependentUpon>Resources.resx</DependentUpon>
+    </Compile>
+    <Compile Include="My Project\Settings.Designer.vb">
+      <AutoGen>True</AutoGen>
+      <DependentUpon>Settings.settings</DependentUpon>
+      <DesignTimeSharedInput>True</DesignTimeSharedInput>
+    </Compile>
+  </ItemGroup>
+  <ItemGroup>
+    <EmbeddedResource Include="capxml2wms.resx">
+      <SubType>Designer</SubType>
+      <DependentUpon>capxml2wms.vb</DependentUpon>
+    </EmbeddedResource>
+    <EmbeddedResource Include="Map.resx">
+      <SubType>Designer</SubType>
+      <DependentUpon>Map.vb</DependentUpon>
+    </EmbeddedResource>
+    <EmbeddedResource Include="My Project\Resources.resx">
+      <Generator>VbMyResourcesResXFileCodeGenerator</Generator>
+      <LastGenOutput>Resources.Designer.vb</LastGenOutput>
+      <CustomToolNamespace>My.Resources</CustomToolNamespace>
+      <SubType>Designer</SubType>
+    </EmbeddedResource>
+  </ItemGroup>
+  <ItemGroup>
+    <None Include="My Project\Application.myapp">
+      <Generator>MyApplicationCodeGenerator</Generator>
+      <LastGenOutput>Application.Designer.vb</LastGenOutput>
+    </None>
+    <None Include="My Project\Settings.settings">
+      <Generator>SettingsSingleFileGenerator</Generator>
+      <CustomToolNamespace>My</CustomToolNamespace>
+      <LastGenOutput>Settings.Designer.vb</LastGenOutput>
+    </None>
+  </ItemGroup>
+  <ItemGroup>
+    <Content Include="gc.ico" />
+  </ItemGroup>
+  <Import Project="$(MSBuildBinPath)\Microsoft.VisualBasic.targets" />
+  <!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
+       Other similar extension points exist, see Microsoft.Common.targets.
+  <Target Name="BeforeBuild">
+  </Target>
+  <Target Name="AfterBuild">
+  </Target>
+  -->
+</Project>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,16 @@
+???<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
+  <PropertyGroup>
+    <PublishUrlHistory>http://localhost/capxml2wms/</PublishUrlHistory>
+    <InstallUrlHistory>
+    </InstallUrlHistory>
+    <SupportUrlHistory>
+    </SupportUrlHistory>
+    <UpdateUrlHistory>
+    </UpdateUrlHistory>
+    <BootstrapperUrlHistory>
+    </BootstrapperUrlHistory>
+    <ApplicationRevision>0</ApplicationRevision>
+    <FallbackCulture>de-DE</FallbackCulture>
+    <VerifyUploadedFiles>true</VerifyUploadedFiles>
+  </PropertyGroup>
+</Project>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/gc.ico
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/gc.ico
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms.sln
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms.sln	2009-10-01 21:15:37 UTC (rev 2231)
+++ trunk/tools/MakeWMSFile/capxml2wms.sln	2009-10-01 21:57:36 UTC (rev 2232)
@@ -0,0 +1,20 @@
+???
+Microsoft Visual Studio Solution File, Format Version 9.00
+# Visual Studio 2005
+Project("{F184B08F-C81C-45F6-A57F-5ABD9991F28F}") = "capxml2wms", "capxml2wms\capxml2wms.vbproj", "{623B1E12-B5BF-4835-A982-AE5500BFADC8}"
+EndProject
+Global
+	GlobalSection(SolutionConfigurationPlatforms) = preSolution
+		Debug|Any CPU = Debug|Any CPU
+		Release|Any CPU = Release|Any CPU
+	EndGlobalSection
+	GlobalSection(ProjectConfigurationPlatforms) = postSolution
+		{623B1E12-B5BF-4835-A982-AE5500BFADC8}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
+		{623B1E12-B5BF-4835-A982-AE5500BFADC8}.Debug|Any CPU.Build.0 = Debug|Any CPU
+		{623B1E12-B5BF-4835-A982-AE5500BFADC8}.Release|Any CPU.ActiveCfg = Release|Any CPU
+		{623B1E12-B5BF-4835-A982-AE5500BFADC8}.Release|Any CPU.Build.0 = Release|Any CPU
+	EndGlobalSection
+	GlobalSection(SolutionProperties) = preSolution
+		HideSolutionNode = FALSE
+	EndGlobalSection
+EndGlobal



From pfeffer at mail.berlios.de  Fri Oct  2 12:33:42 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 2 Oct 2009 12:33:42 +0200
Subject: [Cachewolf-svn] r2233 - in trunk: res_noewe/webmapservices
	src/CacheWolf/navi
Message-ID: <200910021033.n92AXg1L023295@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-02 12:33:37 +0200 (Fri, 02 Oct 2009)
New Revision: 2233

Modified:
   trunk/res_noewe/webmapservices/readme_wms.txt
   trunk/src/CacheWolf/navi/MapLoader.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
MapLoader / WMS: new feature: several scales can be recommended

Modified: trunk/res_noewe/webmapservices/readme_wms.txt
===================================================================
--- trunk/res_noewe/webmapservices/readme_wms.txt	2009-10-01 21:57:36 UTC (rev 2232)
+++ trunk/res_noewe/webmapservices/readme_wms.txt	2009-10-02 10:33:37 UTC (rev 2233)
@@ -104,7 +104,10 @@
 # map download dialog as default. Scale is measured in meters per pixel
 # vertical, so, multiply it by 1.41 (=sqrt(2)) to get the scale as measured
 # above in MinScale and MaxScale
-RecommendedScale:	0.5
+# You can recommend several scales, separate them by one space. The first 
+# one will be pre-selected the others will appear in the drop-down box.
+# Anyway the user can still enter any scale he wishes 
+RecommendedScale:	1 2.5 5 25
 # set this according to ImageFormatUrlPart (must start with ".")
 ImageFileExtension: .png
 

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-01 21:57:36 UTC (rev 2232)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-02 10:33:37 UTC (rev 2233)
@@ -303,7 +303,7 @@
 	String MainUrl; //http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS
 	/** including "." */
 	String imageFileExt; // ".gif", ".jpg"...
-	float recommendedScale;
+	float recommendedScales[];
 	double minscale;
 	double maxscale;
 	Area boundingBox;
@@ -475,7 +475,12 @@
 		maxscale = maxscaleWMS / Math.sqrt(2);
 		imageFileExt = wms.getProperty("ImageFileExtension", "").trim();
 		if (imageFileExt == "") throw new IllegalArgumentException(MyLocale.getMsg(4821, "WebMapService: property >ImageFileExtension:< missing in file:\n") + filename);
-		recommendedScale = (float) Common.parseDouble(wms.getProperty("RecommendedScale", "5").trim());
+		String [] recommendedScalesStr = mString.split(wms.getProperty("RecommendedScale", "5").trim(), ' ');
+		recommendedScales = new float[recommendedScalesStr.length];
+		for (int i=0; i < recommendedScales.length; i++) {
+			recommendedScales[i] = Convert.toFloat(recommendedScalesStr[i].replace(',', '.'));
+		}
+		
 	}
 
 	private static final int TOPLEFT_INDEX = 0;
@@ -671,7 +676,7 @@
 		MainUrl = "Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&ID=3kQaz."; //"Rhttp://" forces doenloadUrl to retry the URL until it gets an http-redirect and then downloads from there 
 		imageFileExt = ".gif";
 		mapType = "expedia";
-		recommendedScale = 5;
+		recommendedScales = new float[]{5};
 		minscale = getMetersPerPixel(0.00000000000000000000001f);
 		maxscale = getMetersPerPixel((float)new CWPoint(0,0).getDistance(new CWPoint(0,180)) * 2 * 1000 / 1000); // whole world * 1000 because of km -> m. /1000 because we have 1000x1000 Pixel usually
 		boundingBox = new Area(new CWPoint(90,-180), new CWPoint(-90,180));

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-01 21:57:36 UTC (rev 2232)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-02 10:33:37 UTC (rev 2233)
@@ -7,6 +7,7 @@
 import CacheWolf.Global;
 import CacheWolf.InfoBox;
 import CacheWolf.MyLocale;
+import CacheWolf.NewProfileForm;
 import CacheWolf.Preferences;
 import ewe.io.FileBase;
 import ewe.sys.Convert;
@@ -39,8 +40,8 @@
 	mLabel coosLbl;
 	mButton coosBtn;
 	mLabel scaleLbl = new mLabel(MyLocale.getMsg(1807,"Approx. m per pixel:"));
-	mInput scaleInput = new mInput ("3");
-	mInput scaleInputPerCache = new mInput ("1");
+	mComboBox scaleInput = new mComboBox();
+	mComboBox scaleInputPerCache = new mComboBox();
 	mLabel overlappingLbl = new mLabel(MyLocale.getMsg(1808,"overlapping in pixel:"));
         mInput overlappingInput = new mInput(""+pref.mapOverlapping);
 	mCheckBox overviewChkBox = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
@@ -95,8 +96,6 @@
 		pnlTiles.addLast(coosBtn = new mButton(center.toString()));
 		pnlTiles.addNext(scaleLbl);
 		mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
-		scaleInput.setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScale));
-		scaleInputPerCache.setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScale));
 		this.focusFirst();
 		pnlTiles.addLast(scaleInput);
 		//	pnlTiles.addLast(resolutionLbl);
@@ -135,8 +134,20 @@
 		pnlPerCache.addLast(okBPerCache, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
 
 		mTab.addCard(pnlPerCache, MyLocale.getMsg(1814, "Per cache"), MyLocale.getMsg(1813, "Per Cache"));
+		setRecommScaleInput();
 		this.addLast(mTab);
 	}
+	
+	private void setRecommScaleInput(){
+		String[] recScales = new String[mapLoader.currentOnlineMapService.recommendedScales.length];
+		for (int i=0; i<recScales.length; i++) {
+			recScales[i] = Convert.toString(mapLoader.currentOnlineMapService.recommendedScales[i]);
+		}
+		scaleInput.choice.set(recScales, 0); // setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScales));
+		scaleInputPerCache.choice.set(recScales, 0);
+		scaleInput.setText(recScales[0]);
+		scaleInputPerCache.setText(recScales[0]);
+	}
 
 	/**
 	 * sort the map services in order to have the services, which cover
@@ -392,8 +403,7 @@
 		if (ev instanceof DataChangeEvent){
 		    if (ev.target == mapServiceChoice) {
 			mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
-			scaleInput.setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScale));
-			scaleInputPerCache.setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScale));
+			setRecommScaleInput();
 		    }
 		    else if (ev.target == overlappingInput){
 			pref.mapOverlapping = Convert.toInt(overlappingInput.getText ());



From araber95 at mail.berlios.de  Fri Oct  2 16:37:39 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 2 Oct 2009 16:37:39 +0200
Subject: [Cachewolf-svn] r2234 - trunk/src/CacheWolf/navi
Message-ID: <200910021437.n92EbdDm025822@sheep.berlios.de>

Author: araber95
Date: 2009-10-02 16:37:34 +0200 (Fri, 02 Oct 2009)
New Revision: 2234

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Filling white areas also on manual selected map.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-02 10:33:37 UTC (rev 2233)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-02 14:37:34 UTC (rev 2234)
@@ -993,7 +993,6 @@
 		}
 		updateOnlyPosition(where, true);
 
-		if (!autoSelectMap) return;
 		Point mapPos = getMapPositionOnScreen();
 		boolean screenNotCompletlyCovered = (mmp.mapImage == null)
 				|| (mmp.mapImage != null && (
@@ -1007,7 +1006,12 @@
 					|| (java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
 				// more then 1/10 of screen moved since last time we tried to
 				// find a better map
-						
+
+				if (!autoSelectMap) {
+					setBestMap(where, screenNotCompletlyCovered);
+					forceMapLoad = false;
+				}
+				
 				if (isFillWhiteArea()) {
 					// Clean up any additional images, tiles will removed and any
 					// other item be added again later
@@ -1066,8 +1070,6 @@
 				}
 				lastCompareX = mapPos.x;
 				lastCompareY = mapPos.y;
-				setBestMap(where, screenNotCompletlyCovered);
-				forceMapLoad = false;
 			}
 			else{
 				int deltaX = mapPos.x - lastXPos;



From araber95 at mail.berlios.de  Fri Oct  2 17:20:46 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 2 Oct 2009 17:20:46 +0200
Subject: [Cachewolf-svn] r2235 - trunk/src/CacheWolf/navi
Message-ID: <200910021520.n92FKk7d030632@sheep.berlios.de>

Author: araber95
Date: 2009-10-02 17:20:45 +0200 (Fri, 02 Oct 2009)
New Revision: 2235

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
oh not no not no not no !!!

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-02 14:37:34 UTC (rev 2234)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-02 15:20:45 UTC (rev 2235)
@@ -1007,7 +1007,7 @@
 				// more then 1/10 of screen moved since last time we tried to
 				// find a better map
 
-				if (!autoSelectMap) {
+				if (autoSelectMap) {
 					setBestMap(where, screenNotCompletlyCovered);
 					forceMapLoad = false;
 				}



From araber95 at mail.berlios.de  Fri Oct  2 21:11:23 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 2 Oct 2009 21:11:23 +0200
Subject: [Cachewolf-svn] r2237 - trunk/tools/MakeWMSFile/capxml2wms
Message-ID: <200910021911.n92JBNSZ019857@sheep.berlios.de>

Author: araber95
Date: 2009-10-02 21:11:16 +0200 (Fri, 02 Oct 2009)
New Revision: 2237

Modified:
   trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
Log:
Startposition des Skalierungsfensters festgelegt
Windowposition fixed

Modified: trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-02 18:35:18 UTC (rev 2236)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-02 19:11:16 UTC (rev 2237)
@@ -77,6 +77,7 @@
         Me.Controls.Add(Me.PictureBox)
         Me.Name = "Map"
         Me.ShowIcon = False
+        Me.StartPosition = System.Windows.Forms.FormStartPosition.Manual
         Me.Text = "Map"
         CType(Me.PictureBox, System.ComponentModel.ISupportInitialize).EndInit()
         Me.ResumeLayout(False)



From araber95 at mail.berlios.de  Mon Oct  5 09:45:54 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 5 Oct 2009 09:45:54 +0200
Subject: [Cachewolf-svn] r2240 - trunk/res_noewe/webmapservices
Message-ID: <200910050745.n957jssV023465@sheep.berlios.de>

Author: araber95
Date: 2009-10-05 09:44:49 +0200 (Mon, 05 Oct 2009)
New Revision: 2240

Modified:
   trunk/res_noewe/webmapservices/es-cn_p.wms
Log:
correction

Modified: trunk/res_noewe/webmapservices/es-cn_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-cn_p.wms	2009-10-05 07:41:12 UTC (rev 2239)
+++ trunk/res_noewe/webmapservices/es-cn_p.wms	2009-10-05 07:44:49 UTC (rev 2240)
@@ -1,12 +1,12 @@
 TakenFromUrl:       http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?
-GetCapabilitiesUrl: http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+GetCapabilitiesUrl: http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
 Name:               es.Canarias photo
 MapType:                        photo
-MainUrl:            http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&
+MainUrl:            http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?
 ServiceTypeUrlPart: SERVICE=WMS
 VersionUrlPart:     VERSION=1.1.1
 CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
 RequestUrlPart:     REQUEST=GetMap
 #LayersUrlPart:     LAYERS=WMS_OrtoExpress|IDECanarias OrtoExpress||
 #LayersUrlPart:     LAYERS=ortoexpress|OrtoExpress||



From araber95 at mail.berlios.de  Fri Oct  2 21:15:22 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 2 Oct 2009 21:15:22 +0200
Subject: [Cachewolf-svn] r2238 - in trunk/tools/MakeWMSFile: . capxml2wms
Message-ID: <200910021915.n92JFMDr020195@sheep.berlios.de>

Author: araber95
Date: 2009-10-02 21:15:02 +0200 (Fri, 02 Oct 2009)
New Revision: 2238

Removed:
   trunk/tools/MakeWMSFile/UpgradeLog.XML
   trunk/tools/MakeWMSFile/_UpgradeReport_Files/
   trunk/tools/MakeWMSFile/capxml2wms.suo
   trunk/tools/MakeWMSFile/capxml2wms/bin/
   trunk/tools/MakeWMSFile/capxml2wms/obj/
Log:
f?r svn nicht bzw VS nicht ben?tigte Dateien entfernt.
removing unnecessary files. Doing the project will work anyhow.

Deleted: trunk/tools/MakeWMSFile/UpgradeLog.XML
===================================================================
--- trunk/tools/MakeWMSFile/UpgradeLog.XML	2009-10-02 19:11:16 UTC (rev 2237)
+++ trunk/tools/MakeWMSFile/UpgradeLog.XML	2009-10-02 19:15:02 UTC (rev 2238)
@@ -1,11 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?><?xml-stylesheet type='text/xsl' href='_UpgradeReport_Files/UpgradeReport.xslt'?><UpgradeLog>
-<Properties><Property Name="Solution" Value="capxml2wms">
-</Property><Property Name="Projektmappendatei" Value="C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms.sln">
-</Property><Property Name="Date" Value="Freitag, 2. Oktober 2009">
-</Property><Property Name="Time" Value="00:23">
-</Property></Properties><Event ErrorLevel="0" Project="capxml2wms" Source="capxml2wms\capxml2wms.vbproj" Description="Projekt erfolgreich konvertiert">
-</Event><Event ErrorLevel="3" Project="capxml2wms" Source="capxml2wms\capxml2wms.vbproj" Description="Converted">
-</Event><Event ErrorLevel="0" Project="" Source="capxml2wms.sln" Description="Die Projektmappe wurde erfolgreich konvertiert.">
-</Event><Event ErrorLevel="3" Project="" Source="capxml2wms.sln" Description="Converted">
-</Event><Event ErrorLevel="0" Project="capxml2wms" Source="capxml2wms\capxml2wms.vbproj" Description="?berpr?fung abgeschlossen: Aktualisierung von Projektdateien nicht erforderlich.">
-</Event></UpgradeLog>
\ No newline at end of file

Deleted: trunk/tools/MakeWMSFile/capxml2wms.suo
===================================================================
(Binary files differ)



From araber95 at mail.berlios.de  Mon Oct  5 09:42:03 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 5 Oct 2009 09:42:03 +0200
Subject: [Cachewolf-svn] r2239 - trunk/res_noewe/languages
Message-ID: <200910050742.n957g3eJ021553@sheep.berlios.de>

Author: araber95
Date: 2009-10-05 09:41:12 +0200 (Mon, 05 Oct 2009)
New Revision: 2239

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
Log:
texts for "centre from GPS" and "caches on map"

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-02 19:15:02 UTC (rev 2238)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-05 07:41:12 UTC (rev 2239)
@@ -242,6 +242,7 @@
 		643=Cachedetails in:
 		644=Wegpunkt
 		645=Name
+		646=akt. Zentrum aus GPS
 		700=Filter setzen
 		701=Entfernung
 		702=Schwierigkeit
@@ -701,6 +702,8 @@
 		4265=Karte zum Zentrum verschieben
 		4266=Weisse Fl%e4chen f%fcllen
 		4267=Weisse Fl%e4chen anzeigen
+		4268=Alle Cache anzeigen
+		4269=Keine Cache anzeigen
 		4270=%d6ffne
 		4271=Karten
 		4272=--- Karten von akt. Position und Ziel ---

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-02 19:15:02 UTC (rev 2238)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-05 07:41:12 UTC (rev 2239)
@@ -242,6 +242,7 @@
 		643=Cache details in:
 		644=waypoint
 		645=name
+		646=cur.centre from GPS
 		700=Set filter
 		701=Distance
 		702=Difficulty
@@ -690,6 +691,8 @@
 		4265=Move map to centre
 		4266=Fill white areas
 		4267=Show white areas
+		4268=Show all caches
+		4269=Don't show caches
 		4270=Open
 		4271=--- Maps containing GPS and goto pos. ---
 		4273=--- Maps containing curr. position ---

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-02 19:15:02 UTC (rev 2238)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-05 07:41:12 UTC (rev 2239)
@@ -232,6 +232,14 @@
 		636=OC recommandation
 		637=OC Index
 		638=Afficher des images dans les descriptions
+		639=Update when spidering?
+		640=Oui
+		641=Non
+		642=Question
+		643=Cache details in:
+		644=waypoint
+		645=nom
+		646=Centre actuel du GPS
 		700=Cr%e9er filtre
 		701=Distance
 		702=Dificult%e9
@@ -681,6 +689,8 @@
 		4265=D%e9placer carte vers centre
 		4266=[Fill white areas]
 		4267=[Show white areas]
+		4268=voir toutes les caches
+		4269=ne pas voir des caches
 		4270=Ouvre
 		4271=Cartes
 		4272=--- Cartes de la pos. actuelle et de la dest. ---

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-02 19:15:02 UTC (rev 2238)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-05 07:41:12 UTC (rev 2239)
@@ -216,6 +216,18 @@
 		632=Meer
 		633=Maximale logs naar werkgeheugen
 		634=use Proxy
+		635=Size
+		636=OC Recs
+		637=OC Index
+		638=Show pictures in description
+		639=Update when spidering?
+		640=Yes
+		641=No
+		642=Ask
+		643=Cache details in:
+		644=waypoint
+		645=name
+		646=cur.centre from GPS
 		700=Selecteer filter
 		701=Afstand
 		702=Moeilijkheidsgraad
@@ -545,6 +557,8 @@
 		4200=Kies kaarten map
 		4266=[Fill white areas]
 		4267=[Show white areas]
+		4268=Bekijk alle cache
+		4269=Geen Cache bekijke
 		4280=[Small Tiles]
 		4281=[Medium Tiles]
 		4282=[Big Tiles]

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-02 19:15:02 UTC (rev 2238)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-05 07:41:12 UTC (rev 2239)
@@ -42,7 +42,7 @@
                 142=Przenies
                 143=Usun
                 144=Uwaga
-                145=Dane WSZYSTKICH POKAZANYCH waypointow beda usuniete! Kontynuowac? 
+                145=Dane WSZYSTKICH POKAZANYCH waypointow beda usuniete! Kontynuowac?
                 146=Dane WSZYSTKICH POKAZANYCH waypointow beda skopiowane! Kontynuowac?
                 147=Dane WSZYSTKICH POKAZANYCH waypointow beda przeniesione! Kontynuowac?
                 148=Wybierz folder docelowy
@@ -242,6 +242,7 @@
                 643=Szczegoly skrzynki:
                 644=waypoint
                 645=nazwa
+		646=cur.centre from GPS
                 700=Ustaw filtr
                 701=Odleglosc
                 702=Trudnosc
@@ -483,7 +484,7 @@
                 1736=Wczytaj
                 1737=Zapisz
                 1738=Zapisz jako
-                1739=Azymut musi byc w przedziale [0;2*PI] stopni 
+                1739=Azymut musi byc w przedziale [0;2*PI] stopni
                 1740=Crossazymut musi byc w przedziale [0;360]
                 1741=Crossazymut musi byc w przedziale [0;2*PI]
                 1742=Crossazymut: Odleglosc miedzy punktami za mala
@@ -675,7 +676,7 @@
                 4250=Reczna zmiana rozdzielczosci
                 4252=Wczytaj mape z wszystkimi zazn. skrzynki
                 4253=Wczytaj mape z wszystkimi zazn. skrzynki
-                4254=Wczytaj mape szczegolowa 
+                4254=Wczytaj mape szczegolowa
                 4255=Wczytaj mape szczegolowa
                 4256=Wczytaj mape przegladowa
                 4257=Wczytaj mape przegladowa
@@ -688,6 +689,8 @@
                 4265=Srodek mapy
                 4266=Wypelnij biale obszary
                 4267=Pokaz biale obszary
+		4268=Zobacz wszystkie pamieci podrecznej
+		4269=Nie pokazuj buforuje
                 4270=Otworz
                 4271=--- Mapy zawierajace GPS i pozycje IdzDo. ---
                 4273=--- Mapy zawierajace akt. pozycje ---
@@ -731,7 +734,7 @@
                 4800=Wczytuje serwisy map online
                 4801=Ignoruje blad podczas %0a wczytywania pliku definicji serwera mapy%0a
                 4802=Sciagam skalibrowany (z georeferencjami) %0a obraz mapy %0a '
-                4803=' %0a Sciagam rzad %0a 
+                4803=' %0a Sciagam rzad %0a
                 4804= kolumna
                 4805=Pole
                 4806=: Ignoruje blad:



From araber95 at mail.berlios.de  Mon Oct  5 10:03:05 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 5 Oct 2009 10:03:05 +0200
Subject: [Cachewolf-svn] r2241 - in trunk/src/CacheWolf: . navi
Message-ID: <200910050803.n958350O009908@sheep.berlios.de>

Author: araber95
Date: 2009-10-05 10:02:04 +0200 (Mon, 05 Oct 2009)
New Revision: 2241

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/navi/MovingMap.java
   trunk/src/CacheWolf/navi/Navigate.java
Log:
+ show caches on Map
+ set current centre point from GPS

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-10-05 07:44:49 UTC (rev 2240)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-10-05 08:02:04 UTC (rev 2241)
@@ -28,7 +28,7 @@
 	/** The name of the waypoint, typically GC.... or OC.... or CW...... (can be any characters) */
 	private String wayPoint = EMPTY;
 	/** The name of the cache (short description) */
-	private String cacheName = EMPTY;
+	public String cacheName = EMPTY;
 	/** The alias of the owner */
 	private String cacheOwner = EMPTY;
 	/** The coordinates of the cache */

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2009-10-05 07:44:49 UTC (rev 2240)
+++ trunk/src/CacheWolf/MainTab.java	2009-10-05 08:02:04 UTC (rev 2241)
@@ -31,7 +31,7 @@
 	CalcPanel calcP;
 	Preferences pref;
 	Profile profile;
-	GotoPanel gotoP; 
+	GotoPanel gotoP;
 	RadarPanel radarP = new RadarPanel();
 	ImagePanel imageP;
 	SolverPanel solverP;
@@ -45,7 +45,7 @@
 	public String mainCache="";
 	int oldCard=0;
 	boolean cacheDirty=false;
-	
+
 	public MainTab(MainMenu mainMenu,StatusBar statBar){
 		Global.mainTab=this;
 		mnuMain=mainMenu;
@@ -59,11 +59,11 @@
 		int sw = MyLocale.getScreenWidth();
 		if ( sw <= 240) this.dontExpandTabs=true;
 		String imagesize="";
-		if (pref.useBigIcons) imagesize="_vga";  
+		if (pref.useBigIcons) imagesize="_vga";
 		calcP = new CalcPanel(); // Init here so that Global.MainT is already set
 		tbP = new TablePanel(pref, profile, statBar);
 		Card c = this.addCard(new TableForm(tbP), MyLocale.getMsg(1200,"List"), null);
-		
+
 		c = this.addCard(detP, MyLocale.getMsg(1201,"Details"), null);
 		c.iconize(new Image("details"+imagesize+".gif"),true);
 
@@ -110,8 +110,8 @@
 		detP.clear(); // Clear only the attributes
 		hintLP.clear(); // Remove the logs
 		solverP.setInstructions("loading ...");
-	}	
-	
+	}
+
 	public void onEvent(Event ev) {
 		// This section clears old data when a new line is selected in the table
 		if (ev instanceof TableEvent) {
@@ -144,7 +144,7 @@
 			cacheDirty=false;
 			if (tbP.getSelectedCache()>=Global.mainTab.tbP.myMod.numRows || tbP.getSelectedCache()<0) {
 				ch=null;
-				chD=null; 
+				chD=null;
 				lastselected="";
 			} else {
 				ch = cacheDB.get(tbP.getSelectedCache());
@@ -193,13 +193,14 @@
 	 */
 	private void onEnteringPanel(int panelNo) {//Vm.debug("Entering "+panelNo);
 		switch (panelNo) {// Switch by panel number
-		case 0:
+		case 0:  //MainPanel
 			MyLocale.setSIPOff();
 			// If Solver or Details has changed, save Cache
 			updatePendingChanges();
 			if (detP.hasBlackStatusChanged()) {
 				tbP.refreshTable();
 			}
+			updateCurCentrePtFromGPS();
 			break;
 		case 1:  // DetailsPanel
 			boolean newCache = false;
@@ -216,7 +217,7 @@
 			break;
 		case 3: // Picture Panel
 			MyLocale.setSIPOff();
-			if (ch.isAddiWpt()) { 
+			if (ch.isAddiWpt()) {
 				imageP.setImages(ch.mainCache.getCacheDetails(true));
 			} else {
 				imageP.setImages(chD);
@@ -224,7 +225,7 @@
 			break;
 		case 4:  // Log Hint Panel
 			MyLocale.setSIPOff();
-			if (ch.isAddiWpt()) { 
+			if (ch.isAddiWpt()) {
 				hintLP.setText(ch.mainCache.getCacheDetails(true));
 			} else {
 				hintLP.setText(chD);
@@ -232,7 +233,7 @@
 			break;
 		case 5:  // Solver Panel
 			MyLocale.setSIPOff();
-			if (ch.isAddiWpt()) { 
+			if (ch.isAddiWpt()) {
 				chMain=ch.mainCache;
 				solverP.setInstructions(ch.mainCache);
 			} else {
@@ -250,20 +251,25 @@
 			MyLocale.setSIPOff();
 			radarP.setParam(pref, cacheDB, ch);
 			radarP.drawThePanel();
+			updateCurCentrePtFromGPS();
 			break;
 		}
 	}
-	
-	/** Update the distances of all caches to the centre and display a message 
+
+	/** Update the distances of all caches to the centre and display a message
 	 */
 	public void updateBearDist(){// Called from DetailsPanel, GotoPanel and myTableControl
+/*
 		MessageBox info = new MessageBox(MyLocale.getMsg(327,"Information"), MyLocale.getMsg(1024,"Entfernungen in der Listenansicht \n werden neu berechnet...").replace('~','\n'), 0);
 		info.exec();
 		info.waitUntilPainted(200);
+*/
 		tbP.pref = pref;
 		profile.updateBearingDistance();
+/*
 		//tbP.refreshTable();
 		info.close(0);
+*/
 		tbP.tc.repaint();
 	}
 
@@ -282,11 +288,11 @@
 
 
 	/**
-	 * this is called from goto / MovingMap / CalcPanel / DetailsPanel and so on to 
+	 * this is called from goto / MovingMap / CalcPanel / DetailsPanel and so on to
 	 * offer the user the possibility of entering an new waypoint
 	 * at a given position. pCh must already been preset with a valid
 	 * CacheHolder object
-	 * 
+	 *
 	 * @param pCh
 	 */
 	public void newWaypoint(CacheHolder pCh){
@@ -297,7 +303,7 @@
 			onLeavingPanel(oldCard);
 		}
 		updatePendingChanges(); // was: onEnteringPanel(0); oldCard=0;
-		
+
 		mainCache=lastselected;
 		int selectedIndex = profile.getCacheIndex( lastselected );
 		if (selectedIndex >= 0) {
@@ -308,12 +314,12 @@
 				} else {
 					mainCache = null;
 				}
-			}			
+			}
 		}
 		if (CacheType.isAddiWpt(pCh.getType()) && mainCache!=null && mainCache.length()>2) {
 			pCh.setWayPoint(profile.getNewAddiWayPointName(mainCache));
 			profile.setAddiRef(pCh);
-		} else { 
+		} else {
 			pCh.setWayPoint(profile.getNewWayPointName());
 			lastselected=pCh.getWayPoint();
 		}
@@ -321,7 +327,7 @@
 		chD = pCh.getCacheDetails(true);
 		this.ch = pCh;
 		cacheDB.add(pCh);
-		Global.getProfile().notifyUnsavedChanges(true); // Just to be sure 
+		Global.getProfile().notifyUnsavedChanges(true); // Just to be sure
 		tbP.myMod.numRows++;
 		detP.setDetails(pCh, true);
 		oldCard=1;
@@ -331,10 +337,10 @@
 
 	}
 
-	
+
 	/**
 	 * sets posCircle Lat/Lon to centerTo
-	 * 
+	 *
 	 * @param centerTo true: centers centerTo on the screen and disconnects MovingMap from GPS if Gps-pos is not on the loaded map
 	 * @param forceCenter
 	 */
@@ -347,7 +353,7 @@
 			if (mm == null) {
 				mm = new MovingMap(nav, profile.cacheDB);
 				nav.setMovingMap(mm);
-			} 
+			}
 			if (forceCenter) mm.setGpsStatus(MovingMap.noGPS); // disconnect movingMap from GPS TODO only if GPS-pos is not on the screen
 			mm.updatePosition(centerTo);
 			mm.myExec();
@@ -364,14 +370,16 @@
 				mm.setGpsStatus(MovingMap.noGPS); // disconnect movingMap from GPS if GPS-pos is not on the screen
 				mm.setResModus(MovingMap.HIGHEST_RESOLUTION);
 				mm.updatePosition(centerTo.latDec, centerTo.lonDec);
-				mm.setCenterOfScreen(centerTo, true); 
+				mm.setCenterOfScreen(centerTo, true);
 			}
-					 */			//TODO what to do, if there is a map at centerTo, but it is not loaded because of mapSwitchMode == dest & cuurpos und daf?r gibt es keine Karte 
+					 */			//TODO what to do, if there is a map at centerTo, but it is not loaded because of mapSwitchMode == dest & cuurpos und daf?r gibt es keine Karte
 				}catch (InterruptedException e) {
+					e.printStackTrace();
 					Global.getPref().log("Error starting mavoing map (1): " + e.getMessage(), e, true);
-					(new MessageBox("Error", "This must not happen please report to pfeffer how to produce this error message", FormBase.OKB)).execute(); } 
+					(new MessageBox("Error", "This must not happen please report to pfeffer how to produce this error message", FormBase.OKB)).execute(); }
 			}
 		} catch (Exception e) { // TODO swith waiting indication clock off
+			e.printStackTrace();
 			Global.getPref().log("Error starting moving map (2): " + e.getMessage(), e, true);
 			(new MessageBox("Error", "Error starting moving map: " + e.getMessage(), FormBase.OKB)).execute(); }
 	}
@@ -383,9 +391,9 @@
 			cacheDirty = false;
 		}
 	}
-	
+
 	/** Save the index file
-	 * 
+	 *
 	 * @param askForConfirmation is ignored, old: If true, the save can be cancelled by user
 	 */
 	public void saveUnsavedChanges(boolean askForConfirmation) {
@@ -399,18 +407,32 @@
 	    this.tbP.saveColWidth(pref);
 		Global.getPref().savePreferences();
 	}
-	
+
 	private void checkProfileChange() {
 		// A panel is selected. Could be the same panel twice
-		mnuMain.allowProfileChange(false);	  
+		mnuMain.allowProfileChange(false);
 		if(this.getSelectedItem() == 0){// List view selected
-			mnuMain.allowProfileChange(true);	  
+			mnuMain.allowProfileChange(true);
 			MyLocale.setSIPOff();
 		}
 	}
+
+	private void  updateCurCentrePtFromGPS() {
+		if (pref.setCurrentCentreFromGPSPosition){
+			boolean gpsPosIsValid=nav.gpsPos.isValid();
+			if (gpsPosIsValid) {
+				CWPoint whereAmI = nav.gpsPos;
+				if (whereAmI != pref.curCentrePt) {
+					pref.curCentrePt.set(whereAmI);
+					this.updateBearDist();
+				}
+			}
+		}
+	}
 }
-// 
+//
 
 
 
 
+

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-05 07:44:49 UTC (rev 2240)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-05 08:02:04 UTC (rev 2241)
@@ -121,6 +121,8 @@
 	public String lastProfile="";
 	/** If true, the last profile is reloaded automatically without a dialogue */
 	public boolean autoReloadLastProfile=false;
+	/** If true current cetre will be set from gps position	 */
+	public boolean setCurrentCentreFromGPSPosition=true;
 	/** This is the login alias for geocaching.com and opencaching.de */
 	public String myAlias = "";
 	/** Optional password */
@@ -246,11 +248,14 @@
 	/** Determines whether to fill the white areas on the map */
 	public boolean fillWhiteArea=false;
 
-        /** Selected Size of map tiles */
-        public int mapTileSize=1;
-        /** How many should maptiles overlap */
-        public int mapOverlapping=100;
+    /** Selected Size of map tiles */
+    public int mapTileSize=1;
+    /** How many should maptiles overlap */
+    public int mapOverlapping=100;
 
+    /** ShowCachesOnMap */
+    public boolean showCachesOnMap=true;
+
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
 	 * the line: <pre><debug value="true" /></pre>
@@ -393,7 +398,9 @@
 			collectElement=new StringBuffer(50);
 			if (atts.getValue("autoreload").equals("true")) autoReloadLastProfile=true;
 		}
-
+		else if (name.equals("CurrentCentre")) {
+			if (atts.getValue("FromGPSPosition").toLowerCase().equals("true")) setCurrentCentreFromGPSPosition=true;
+		}
 		else if(name.equals("basedir")) {
 			setBaseDir(atts.getValue("dir"));
 		}
@@ -562,6 +569,10 @@
 			     if (tmp == null || tmp.length() == 0) tmp = "100";
 			     mapOverlapping = Convert.parseInt(tmp);
 		}
+		else if (name.equals("showCachesOnMap")){
+			tmp = atts.getValue("on");
+			showCachesOnMap = tmp != null && tmp.equalsIgnoreCase("true");
+		}
 	}
 
 	public void characters( char ch[], int start, int length ) {
@@ -596,6 +607,7 @@
 			outp.print("    <locale language=\"" + SafeXML.clean(language) + "\"/>\n");
 			outp.print("    <basedir dir = \"" + SafeXML.clean(getBaseDir()) + "\"/>\n");
 			outp.print("    <lastprofile autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\">" + SafeXML.clean(lastProfile) + "</lastprofile>\n"); //RB
+			outp.print("    <CurrentCentre FromGPSPosition= \"" + SafeXML.clean(Convert.toString(setCurrentCentreFromGPSPosition)) + "\"/>\n");
 			outp.print("    <alias name =\""+ SafeXML.clean(myAlias) +"\" password=\""+SafeXML.clean(password)+"\" />\n");
 			outp.print("    <alias2 name =\""+ SafeXML.clean(myAlias2) +"\"/>\n");
 			outp.print("    <gcmemberid name =\""+ SafeXML.clean(gcMemberId) +"\"/>\n");
@@ -648,6 +660,7 @@
 			outp.print("    <logkeeping maximum=\""+SafeXML.strxmlencode(maxLogsToKeep)+"\" keepown=\""+SafeXML.strxmlencode(alwaysKeepOwnLogs)+"\" />\n");
 			outp.print("    <fillWhiteArea on=\""+SafeXML.strxmlencode(fillWhiteArea)+"\"/>\n");
 			outp.print("    <mapLoader tileSize=\""+SafeXML.strxmlencode(mapTileSize)+"\" overlapping=\""+SafeXML.strxmlencode(mapOverlapping)+"\"/>\n");
+			outp.print("    <showCachesOnMap on=\""+SafeXML.strxmlencode(showCachesOnMap)+"\"/>\n");
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2009-10-05 07:44:49 UTC (rev 2240)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2009-10-05 08:02:04 UTC (rev 2241)
@@ -21,7 +21,7 @@
 	mInput DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, 
 	       inpLogsPerPage,inpMaxLogsToSpider,inpPassword;
 	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus,chkHasCloseButton,
-	          chkSynthShort,chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName;
+	          chkSynthShort,chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName, chkSetCurrentCentreFromGPSPosition;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
 	mLabel lblGarmin;
@@ -83,9 +83,11 @@
 		DataDir = new mInput();
 		DataDir.setText(pref.getBaseDir());
 		frmDataDir.addLast(DataDir.setTag(CellConstants.SPAN, new Dimension(3,1)),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
-		frmDataDir.addLast(chkAutoLoad = new mCheckBox(MyLocale.getMsg(629,"Autoload last profile")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		frmDataDir.addNext(chkAutoLoad = new mCheckBox(MyLocale.getMsg(629,"Autoload last profile")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		if (pref.autoReloadLastProfile) chkAutoLoad.setState(true);
 		chkAutoLoad.setTag(INSETS,new Insets(0,0,2,0));
+		frmDataDir.addLast(chkSetCurrentCentreFromGPSPosition = new mCheckBox(MyLocale.getMsg(646,"centre from GPS")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.EAST));
+		if (pref.setCurrentCentreFromGPSPosition) chkSetCurrentCentreFromGPSPosition.setState(true);
 		pnlGeneral.addLast(frmDataDir,HSTRETCH,HFILL);
 		
 		CellPanel pnlBrowser=new CellPanel();
@@ -311,6 +313,7 @@
 				HttpConnection.setProxy(pref.myproxy, Common.parseInt(pref.myproxyport), pref.proxyActive); // TODO generate an error message if proxy port is not a number
 				//myPreferences.nLogs = Convert.parseInt(nLogs.getText());
 				pref.autoReloadLastProfile=chkAutoLoad.getState();
+				pref.setCurrentCentreFromGPSPosition=chkSetCurrentCentreFromGPSPosition.getState();
 				pref.showDeletedImages=chkShowDeletedImg.getState();
 				pref.garminConn=chcGarminPort.getSelectedItem().toString();
 				pref.garminGPSBabelOptions=chkSynthShort.state?"-s":"";

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-05 07:44:49 UTC (rev 2240)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-05 08:02:04 UTC (rev 2241)
@@ -72,10 +72,10 @@
 	boolean ignoreGps = false; // ignores updateGps-calls if true
 	boolean autoSelectMap = true;
 	boolean forceMapLoad = true; // only needed to force updateposition to try to load the best map again after OutOfMemoryError after an repeated click on snap-to-gps
-	boolean mapHidden = false;
+	public boolean mapHidden = false;
 	boolean noMapsAvailable;
 	boolean zoomingMode = false;
-	boolean mapsloaded = false;
+	public boolean mapsloaded = false;
 	boolean additionalOverlaysDeleted=true;
 	Point lastRepaintMapPos = null;
 	double lastDistance = -1;
@@ -104,11 +104,23 @@
 						&& (!((im instanceof MapSymbol)
 								|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
 					mmp.images.remove(im);
-				} 
+				}
 			}
 		}
 	}
 
+	public boolean getShowCachesOnMap() {return pref.showCachesOnMap; }
+	public void setShowCachesOnMap(boolean value) {
+		if (value != pref.showCachesOnMap) {
+			pref.showCachesOnMap=value;
+		}
+		if (!value) {
+			// todo: add : goto Cache Symbol, Selected Symbol , Selected Cache Symbol
+			this.removeAllMapSymbolsButGoto();
+			}
+
+	}
+
 	public MovingMap(Navigate nav, CacheDB cacheDB){
 		this.cacheDB = cacheDB;
 		this.myNavigation = nav;
@@ -122,7 +134,6 @@
 		this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
 		this.title = "Moving Map";
 		this.backGround = new Color(254,254,254); // background must not be black because black is interpreted as transparent and transparent images above (eg trackoverlay) want be drawn in windows-VM, so be care, don|t use white either
-		//this.mapPath = Global.getPref().getMapLoadPath();
 
 		mmp = new MovingMapPanel(this);
 		this.addLast(mmp);
@@ -243,8 +254,7 @@
 		Vm.showWait(this, true);
 		inf.exec();
 		inf.waitUntilPainted(100);
-		if (Global.getPref().debug)
-			Global.getPref().log(MyLocale.getMsg(4203, "Loading list of maps..."));
+		if (pref.debug) pref.log(MyLocale.getMsg(4203, "Loading list of maps..."));
 		resetCenterOfMap();
 		boolean saveGpsIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;
@@ -270,7 +280,7 @@
 		{
 			double lineLengthMeters = 40 * currentMap.scale;
 
-			int metricSystem = Global.getPref().metricSystem;
+			int metricSystem = pref.metricSystem;
 			double localizedLineLength = 0;
 			int bigUnit = -1;
 			int smallUnit = -1;
@@ -346,7 +356,7 @@
 				ewe.sys.Double dd = new ewe.sys.Double();
 				String d;
 
-				int metricSystem = Global.getPref().metricSystem;
+				int metricSystem = pref.metricSystem;
 				double localizedDistance = 0;
 				int bigUnit = -1;
 				int smallUnit = -1;
@@ -911,7 +921,10 @@
 			mmp.removeImage((MapSymbol)symbols.get(i));
 		}
 		symbols.removeAllElements();
-		if (gotoPos != null) symbols.add(gotoPos);
+		if (gotoPos != null) {
+			symbols.add(gotoPos);
+			mmp.addImage(gotoPos);
+		}
 	}
 
 	public void removeMapSymbol(String pName) {
@@ -982,8 +995,8 @@
 	public void updatePosition(CWPoint where){
 		if (dontUpdatePos || loadingMapList) return; // avoid multi-threading problems
 		//Vm.debug("updatepos, lat: "+where.latDec+" lon: "+where.lonDec);
-		if (!mapsloaded || !this.maps.getMapsPath().equals(Global.getPref().getCustomMapsPath())) {
-			loadMaps(Global.getPref().getCustomMapsPath(), where.latDec);
+		if (!mapsloaded || !this.maps.getMapsPath().equals(pref.getCustomMapsPath())) {
+			loadMaps(pref.getCustomMapsPath(), where.latDec);
 			lastCompareX = Integer.MAX_VALUE;
 			lastCompareY = Integer.MAX_VALUE;
 			autoSelectMap = true;
@@ -1004,14 +1017,28 @@
 			// Vm.debug("Screen not completly covered by map");
 			if (forceMapLoad
 					|| (java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
-				// more then 1/10 of screen moved since last time we tried to
-				// find a better map
-
+				// more then 1/10 of screen moved since last time we tried to find a better map
 				if (autoSelectMap) {
 					setBestMap(where, screenNotCompletlyCovered);
 					forceMapLoad = false;
 				}
-				
+				if (getShowCachesOnMap()) {
+					CacheHolder ch;
+					int twidth = width/10;
+					int theight = height/10;
+					Area screenArea = new Area(ScreenXY2LatLon(-twidth,-theight), ScreenXY2LatLon(width+twidth,height+theight));
+					for (int i = cacheDB.size() - 1; i >= 0; i--) {
+						ch = cacheDB.get(i);
+						if (screenArea.isInBound(ch.pos)) {
+							// because visible and valid don't change while showing map -->need no remove
+							if (ch.isVisible() && ch.pos.isValid()) {
+								addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
+							}
+						}else{
+							removeMapSymbol(ch.cacheName);
+						}
+					}
+				}
 				if (isFillWhiteArea()) {
 					// Clean up any additional images, tiles will removed and any
 					// other item be added again later
@@ -1268,7 +1295,7 @@
 			r.width = blackArea.x + offsetX;
 			r.height = whiteArea.height;
 			rectangles.add(r);
-			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
+			if (pref.debug) {pref.log("add whitearea : "+SRect(r));}
 		}
 		if (blackArea.y > whiteArea.y) {
 			Rect r= new Rect ();
@@ -1277,7 +1304,7 @@
 			r.width = whiteArea.width;
 			r.height = blackArea.y + offsetY;
 			rectangles.add(r);
-			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
+			if (pref.debug) {pref.log("add whitearea : "+SRect(r));}
 		}
 		if ((blackArea.y + blackArea.height) <  whiteArea.y + whiteArea.height) {
 			Rect r= new Rect ();
@@ -1286,7 +1313,7 @@
 			r.width = whiteArea.width;
 			r.height = (whiteArea.y + whiteArea.height) - r.y;
 			rectangles.add(r);
-			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
+			if (pref.debug) {pref.log("add whitearea : "+SRect(r));}
 		}
 		if ((blackArea.x + blackArea.width)<  whiteArea.x + whiteArea.width) {
 			Rect r= new Rect ();
@@ -1295,7 +1322,7 @@
 			r.width = (whiteArea.x + whiteArea.width) - r.x;
 			r.height = whiteArea.height;
 			rectangles.add(r);
-			if (Global.getPref().debug) {Global.getPref().log("add whitearea : "+SRect(r));}
+			if (pref.debug) {pref.log("add whitearea : "+SRect(r));}
 		}
 	}
 
@@ -1562,10 +1589,10 @@
 		dontUpdatePos = true;  // make updatePosition ignore calls during loading new map
 		InfoBox inf;
 		inf = new InfoBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4216, "Loading map..."));
-		if (Global.getPref().debug) {
+		if (pref.debug) {
 			inf.show();
 			inf.waitUntilPainted(100);
-			Global.getPref().log(MyLocale.getMsg(4216, "Loading map..."));
+			pref.log(MyLocale.getMsg(4216, "Loading map...")+newmap.mapName);
 		}
 		try {
 			this.currentMap = newmap;
@@ -1749,6 +1776,28 @@
 		zoomFromUnscaled(zoomFactor * currentMap.zoomFactor, newImageRect, center);
 	}
 
+	public void zoomin() {
+		zoomScreenRect(new Point(this.width / 4, this.height / 4),
+				this.width / 2, this.height / 2);
+	}
+
+	public void zoomout() {
+		CWPoint center = currentMap.center;
+		float zoomfactor = currentMap.zoomFactor / 2;
+		if (zoomfactor < 1) {
+			zoomfactor = 1;
+		}
+		if (mapImage1to1 != null)
+			zoomFromUnscaled(zoomfactor, new Rect(0, 0,
+					mapImage1to1.getWidth(), mapImage1to1.getHeight()), center);
+		else
+			zoomFromUnscaled(zoomfactor, new Rect(0, 0, 1, 1), center);
+	}
+
+	public void setZoomingMode(boolean mode) {
+		zoomingMode = mode;
+	}
+
 	public void zoom1to1() {
 		CWPoint center = ScreenXY2LatLon(this.width /2 , this.height/2);
 		if (mapImage1to1 != null) zoomFromUnscaled(1, new Rect(0,0,mapImage1to1.getWidth(), mapImage1to1.getHeight()), center);
@@ -1849,6 +1898,8 @@
 	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4241, "Hide map"), null, CellConstants.RIGHT));
 	MenuItem fillMapMI = new MenuItem(MyLocale.getMsg(4267, "Show white areas"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4267, "Show white areas"), null, CellConstants.RIGHT));
 	MenuItem noFillMapMI = new MenuItem(MyLocale.getMsg(4266, "Fill white areas"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4266, "Fill white areas"), null, CellConstants.RIGHT));
+	MenuItem showCachesOnMapMI = new MenuItem(MyLocale.getMsg(4268, "Alle Cache anzeigen"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4268, "Alle Cache anzeigen"), null, CellConstants.RIGHT));
+	MenuItem noShowCachesOnMapMI = new MenuItem(MyLocale.getMsg(4269, "Keine Cache anzeigen"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4269, "Keine Cache anzeigen"), null, CellConstants.RIGHT));
 	// automatic
 	MenuItem mapChangeModusMI = new MenuItem(MyLocale.getMsg(4242, "Modus for automatic map change"), MenuItem.Separator, null);;
 	MenuItem highestResGpsDestMI = new MenuItem(MyLocale.getMsg(4244, "Highest res. containing dest. & cur. position"), new IconAndText(new mImage("res_gps_goto.png"), MyLocale.getMsg(4245, "Highest res. containing dest. & cur. position"), null, CellConstants.RIGHT)); //immer h???chste Aufl???sung w???hlen, die akt. Pos. und Ziel enthalten
@@ -2060,6 +2111,12 @@
 			else{
 				mapsMenu.addItem(noFillMapMI);
 			}
+			if (mm.getShowCachesOnMap()){
+				mapsMenu.addItem(noShowCachesOnMapMI);
+			}
+			else{
+				mapsMenu.addItem(showCachesOnMapMI);
+			}
 			// automatic
 			highestResGpsDestMI.modifiers &= ~MenuItem.Checked;
 			highestResolutionMI.modifiers &= ~MenuItem.Checked;
@@ -2150,12 +2207,15 @@
 	}
 
 	public void onEvent(Event ev){
-		if (mapsMenu != null && ev instanceof PenEvent && ev.type == PenEvent.PEN_DOWN && ev.target == this) {mapsMenu.close(); mapsMenu = null;}
-		if (kontextMenu != null && ev instanceof PenEvent && ev.type == PenEvent.PEN_DOWN && ev.target == this) {kontextMenu.close(); kontextMenu = null; }
+		if (mapsMenu != null && ev instanceof PenEvent && ev.type == PenEvent.PEN_DOWN && ev.target == this)
+			{mapsMenu.close(); mapsMenu = null;}
+		if (kontextMenu != null && ev instanceof PenEvent && ev.type == PenEvent.PEN_DOWN && ev.target == this)
+			{kontextMenu.close(); kontextMenu = null; }
 
 		if (ev instanceof MenuEvent) {
 			if (ev.target == mapsMenu) {
-				if (ev.type == MenuEvent.ABORTED || ev.type == ControlEvent.CANCELLED || ev.type == ControlEvent.FOCUS_OUT) mapsMenu.close(); // TODO menuIsActive() benutzen?
+				if (ev.type == MenuEvent.ABORTED || ev.type == ControlEvent.CANCELLED || ev.type == ControlEvent.FOCUS_OUT)
+						mapsMenu.close(); // TODO menuIsActive() benutzen?
 				if (ev.type == MenuEvent.SELECTED ) {
 					MenuItem action = (MenuItem) mapsMenu.getSelectedItem();
 					if (mapsMenu.getSelectedItem() != null) {
@@ -2166,7 +2226,7 @@
 						}
 						else if (action == changeMapDirMI)	{
 							mapsMenu.close();
-							FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().absoluteBaseDir+"maps");
+							FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().getCustomMapsPath());
 							fc.addMask("*.wfl");
 							fc.setTitle(MyLocale.getMsg(4200,"Select map directory:"));
 							if(fc.execute() != FormBase.IDCANCEL){
@@ -2187,6 +2247,20 @@
 							mm.updatePosition (mm.posCircle.where);
 							repaintNow();
 						}
+						else if (action == showCachesOnMapMI){
+							mapsMenu.close ();
+							mm.setShowCachesOnMap(true);
+							mm.forceMapLoad=true;
+							mm.updatePosition (mm.posCircle.where);
+							repaintNow();
+						}
+						else if (action == noShowCachesOnMapMI){
+							mapsMenu.close ();
+							mm.setShowCachesOnMap(false);
+							mm.forceMapLoad=true;
+							mm.updatePosition (mm.posCircle.where);
+							repaintNow();
+						}
 						//dont show map
 						else if (action == hideMapMI) {
 							mapsMenu.close();
@@ -2240,6 +2314,7 @@
 					}
 				}
 			} // if (ev.target == mapsMenu)
+
 			if (ev.target == kontextMenu) {
 				if ((((MenuEvent)ev).type==MenuEvent.SELECTED)) {
 					MenuItem action = (MenuItem) kontextMenu.getSelectedItem();

Modified: trunk/src/CacheWolf/navi/Navigate.java
===================================================================
--- trunk/src/CacheWolf/navi/Navigate.java	2009-10-05 07:44:49 UTC (rev 2240)
+++ trunk/src/CacheWolf/navi/Navigate.java	2009-10-05 08:02:04 UTC (rev 2241)
@@ -14,12 +14,13 @@
 import ewe.ui.MessageBox;
 import ewe.util.mString;
 import CacheWolf.CacheHolder;
+import CacheWolf.navi.MovingMap;
 
 
 /**
  * Non-Gui Class to handle all things regarding navigation
  * (GPS, Sun direction etc.)
- * start offset in localisation file: 4400 
+ * start offset in localisation file: 4400
  * @author Pfeffer
  *
  */
@@ -68,18 +69,18 @@
 				if (gotoPanel != null) gotoPanel.gpsStarted();
 				if (movingMap != null) movingMap.gpsStarted();
 			} catch (IOException e) {
-				(new MessageBox(MyLocale.getMsg(4403, "Error"), 
-					MyLocale.getMsg(4408, "Could not connect to GPSD:") 
+				(new MessageBox(MyLocale.getMsg(4403, "Error"),
+					MyLocale.getMsg(4408, "Could not connect to GPSD:")
 					+ e.getMessage()
-					+ MyLocale.getMsg(4409, "\npossible reasons:\nGPSD is not running or GPSD host is not reachable"), 
-					FormBase.OKB)).execute(); 
+					+ MyLocale.getMsg(4409, "\npossible reasons:\nGPSD is not running or GPSD host is not reachable"),
+					FormBase.OKB)).execute();
 			}
 		}else{
 			if (serThread != null) if (serThread.isAlive()) return; // TODO use gpsRunning
 			try {
 				serThread = new SerialThread(pref.mySPO, gpsPos, (pref.forwardGPS ? pref.forwardGpsHost : ""));
 				if (pref.forwardGPS && !serThread.tcpForward) {
-					(new MessageBox(MyLocale.getMsg(4400, "Warning"), 
+					(new MessageBox(MyLocale.getMsg(4400, "Warning"),
 							MyLocale.getMsg(4401, "Ignoring error:\n could not forward GPS data to host:\n")
 							+ pref.forwardGpsHost+"\n" + serThread.lastError
 							+ MyLocale.getMsg(4402, "\nstop and start GPS to retry"), FormBase.OKB)).exec();
@@ -96,16 +97,16 @@
 				if (gotoPanel != null) gotoPanel.gpsStarted();
 				if (movingMap != null) movingMap.gpsStarted();
 			} catch (IOException e) {
-				(new MessageBox(MyLocale.getMsg(4403, "Error"), 
-						MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ") 
+				(new MessageBox(MyLocale.getMsg(4403, "Error"),
+						MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ")
 						+ e.getMessage()
-						+ MyLocale.getMsg(4405, "\npossible reasons:\n Another (GPS-)program is blocking the port\nwrong port\nOn Loox: active infra-red port is blocking GPS"), 
-						FormBase.OKB)).execute(); 
+						+ MyLocale.getMsg(4405, "\npossible reasons:\n Another (GPS-)program is blocking the port\nwrong port\nOn Loox: active infra-red port is blocking GPS"),
+						FormBase.OKB)).execute();
 			} catch (UnsatisfiedLinkError e) {
-				(new MessageBox(MyLocale.getMsg(4403, "Error"), 
-						MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ") 
-						+ MyLocale.getMsg(4406, "Please copy jave_ewe.dll into the directory of the cachewolf program"), 
-						FormBase.OKB)).execute(); 
+				(new MessageBox(MyLocale.getMsg(4403, "Error"),
+						MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ")
+						+ MyLocale.getMsg(4406, "Please copy jave_ewe.dll into the directory of the cachewolf program"),
+						FormBase.OKB)).execute();
 			}
 		}
 	}
@@ -140,7 +141,7 @@
 	}
 
 
-	public void setDestination(String LatLon) { 
+	public void setDestination(String LatLon) {
 		setDestination(new CWPoint(LatLon));
 	}
 
@@ -151,7 +152,7 @@
 		if (gotoPanel != null) gotoPanel.destChanged(destination);
 		if (movingMap != null) movingMap.destChanged(destination);
 	}
-	
+
 	public void setDestination(CacheHolder ch) {
 		destinationIsCache = true;
 		destinationCache=ch;
@@ -176,7 +177,7 @@
 			try {
 				curTrack.add(gpsPos);
 			} catch (IndexOutOfBoundsException e) { // track full -> create a new one
-				curTrack = new Track(trackColor); 
+				curTrack = new Track(trackColor);
 				curTrack.add(gpsPos);
 				if (movingMap != null) movingMap.addTrack(curTrack);
 			}
@@ -186,11 +187,11 @@
 				skyOrientationDir = SkyOrientation.getLuminaryDir(luminary, jd, gpsPos);
 				// ewe.sys.Vm.debug("neu: "+ skyOrientationDir.lonDec+ "jd: " + jd);
 			} catch (NumberFormatException e) { // irgendeine Info zu Berechnung des Sonnenaziumt fehlt (insbesondere Datum und Uhrzeit sind nicht unbedingt gleichzeitig verf?gbar wenn es einen Fix gibt)
-				skyOrientationDir.set(-361, -361); // any value out of range (bigger than 360) will prevent drawArrows from drawing it 
+				skyOrientationDir.set(-361, -361); // any value out of range (bigger than 360) will prevent drawArrows from drawing it
 			}
 
 		} else {
-			skyOrientationDir.set(-361, -361); // any value out of range (bigger than 360) will prevent drawArrows from drawing it		
+			skyOrientationDir.set(-361, -361); // any value out of range (bigger than 360) will prevent drawArrows from drawing it
 		}
 		gotoPanel.updateGps(fix);
 		if (movingMap != null) movingMap.updateGps(fix);
@@ -204,16 +205,16 @@
 	boolean run, tcpForward;
 	Socket tcpConn;
 	String lastError = new String();
-	
+
 	public GpsdThread(CWGPSPoint GPSPoint) throws IOException {
 		try{
 			gpsdSocket = new Socket(Global.getPref().gpsdHost, Global.getPref().gpsdPort);
 		} catch (IOException e) {
 			throw new IOException(Global.getPref().gpsdHost);
-		} // catch (UnsatisfiedLinkError e) {} // TODO in original java-vm 
+		} // catch (UnsatisfiedLinkError e) {} // TODO in original java-vm
 		myGPS = GPSPoint;
 	}
-	
+
 	public void run() {
 		String gpsResult;
 		int noData = 0;
@@ -233,8 +234,8 @@
 					//Vm.debug("P -> " + gpsResult);
 					noData = 0;
 					if (myGPS.examineGpsd(gpsResult))
-						notinterpreted = 0; 
-					else 
+						notinterpreted = 0;
+					else
 						notinterpreted++;
 					if (notinterpreted > 22) myGPS.noInterpretableData();
 				}
@@ -263,7 +264,7 @@
 		}
 		String str = null;
 		if (rcvLength > 0)	{
-			str = mString.fromAscii(rcvBuff, 0, rcvLength); 
+			str = mString.fromAscii(rcvBuff, 0, rcvLength);
 		}
 		return str;
 	}
@@ -279,7 +280,7 @@
  *
  */
 class SerialThread extends mThread{
-	SerialPort comSp;   
+	SerialPort comSp;
 	byte[] comBuff = new byte[1024*10]; // when some action takes a long time (eg. loading or zooming a map), a lot of data can be in the buffer, read that at once
 	int comLength = 0;
 	CWGPSPoint myGPS;
@@ -293,13 +294,13 @@
 			comSp = new SerialPort(spo);
 		} catch (IOException e) {
 			throw new IOException(spo.portName);
-		} // catch (UnsatisfiedLinkError e) {} // TODO in original java-vm 
-		if (forwardIP.length()>0) { 
+		} // catch (UnsatisfiedLinkError e) {} // TODO in original java-vm
+		if (forwardIP.length()>0) {
 			try {
 				tcpConn = new Socket(forwardIP, 23);
 				tcpForward = true;
 			} catch (ewe.net.UnknownHostException e) { tcpForward = false; lastError = e.getMessage();
-			} catch (IOException e) { tcpForward = false; lastError = e.getMessage(); 
+			} catch (IOException e) { tcpForward = false; lastError = e.getMessage();
 			}
 		}
 		myGPS = GPSPoint;
@@ -323,7 +324,7 @@
 				//Vm.debug("Length: " + comBuff.length);
 				if (comLength > 0)	{
 					noData = 0;
-					String str = mString.fromAscii(comBuff, 0, comLength); 
+					String str = mString.fromAscii(comBuff, 0, comLength);
 					if (tcpForward) {
 						try {
 							tcpConn.write(comBuff, 0, comLength);
@@ -345,10 +346,10 @@
 	}
 }
 
-/** 
- * Class for creating a new mThread to create timer ticks to be able to do form.close in the ticked-thread. 
- * Using the Vm.requestTimer-Method causes "ewe.sys.EventDirectionException: This task cannot be done within 
- * a Timer Tick." in the ewe-vm when form.close is called.  
+/**
+ * Class for creating a new mThread to create timer ticks to be able to do form.close in the ticked-thread.
+ * Using the Vm.requestTimer-Method causes "ewe.sys.EventDirectionException: This task cannot be done within
+ * a Timer Tick." in the ewe-vm when form.close is called.
  */
 
 class UpdateThread extends mThread {
@@ -377,3 +378,4 @@
 }
 
 
+



From pfeffer at mail.berlios.de  Fri Oct  2 20:35:45 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 2 Oct 2009 20:35:45 +0200
Subject: [Cachewolf-svn] r2236 - in trunk/tools/MakeWMSFile: .
	_UpgradeReport_Files capxml2wms capxml2wms/My Project
	capxml2wms/bin/Debug capxml2wms/bin/Release capxml2wms/obj
	capxml2wms/obj/Debug capxml2wms/obj/Debug/TempPE
	capxml2wms/obj/Release capxml2wms/obj/Release/TempPE
Message-ID: <200910021835.n92IZjk3016849@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-02 20:35:18 +0200 (Fri, 02 Oct 2009)
New Revision: 2236

Added:
   trunk/tools/MakeWMSFile/UpgradeLog.XML
   trunk/tools/MakeWMSFile/_UpgradeReport_Files/
   trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.css
   trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.xslt
   trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport_Minus.gif
   trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport_Plus.gif
   trunk/tools/MakeWMSFile/capxml2wms.suo
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe.manifest
   trunk/tools/MakeWMSFile/capxml2wms/obj/
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/TempPE/
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/TempPE/My Project.Resources.Designer.vb.dll
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.Map.resources
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.Resources.resources
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.capxml2wms.resources
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.pdb
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.vbproj.FileListAbsolute.txt
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.vbproj.GenerateResource.Cache
   trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.xml
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/TempPE/
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/TempPE/My Project.Resources.Designer.vb.dll
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.Map.resources
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.Resources.resources
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.capxml2wms.resources
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.pdb
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.vbproj.FileListAbsolute.txt
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.vbproj.GenerateResource.Cache
   trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.xml
Modified:
   trunk/tools/MakeWMSFile/capxml2wms.sln
   trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/Map.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.pdb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml
   trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.pdb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user
Log:
MakeWmsTool: added feature to finde optimal scale

Added: trunk/tools/MakeWMSFile/UpgradeLog.XML
===================================================================
--- trunk/tools/MakeWMSFile/UpgradeLog.XML	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/UpgradeLog.XML	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,11 @@
+<?xml version="1.0" encoding="UTF-8"?><?xml-stylesheet type='text/xsl' href='_UpgradeReport_Files/UpgradeReport.xslt'?><UpgradeLog>
+<Properties><Property Name="Solution" Value="capxml2wms">
+</Property><Property Name="Projektmappendatei" Value="C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms.sln">
+</Property><Property Name="Date" Value="Freitag, 2. Oktober 2009">
+</Property><Property Name="Time" Value="00:23">
+</Property></Properties><Event ErrorLevel="0" Project="capxml2wms" Source="capxml2wms\capxml2wms.vbproj" Description="Projekt erfolgreich konvertiert">
+</Event><Event ErrorLevel="3" Project="capxml2wms" Source="capxml2wms\capxml2wms.vbproj" Description="Converted">
+</Event><Event ErrorLevel="0" Project="" Source="capxml2wms.sln" Description="Die Projektmappe wurde erfolgreich konvertiert.">
+</Event><Event ErrorLevel="3" Project="" Source="capxml2wms.sln" Description="Converted">
+</Event><Event ErrorLevel="0" Project="capxml2wms" Source="capxml2wms\capxml2wms.vbproj" Description="??berpr??fung abgeschlossen: Aktualisierung von Projektdateien nicht erforderlich.">
+</Event></UpgradeLog>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.css
===================================================================
--- trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.css	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.css	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,207 @@
+???BODY
+{
+	BACKGROUND-COLOR: white;
+	FONT-FAMILY: "Verdana", sans-serif;
+	FONT-SIZE: 100%;
+	MARGIN-LEFT: 0px;
+	MARGIN-TOP: 0px
+}
+P
+{
+	FONT-FAMILY: "Verdana", sans-serif;
+	FONT-SIZE: 70%;
+	LINE-HEIGHT: 12pt;
+	MARGIN-BOTTOM: 0px;
+	MARGIN-LEFT: 10px;
+	MARGIN-TOP: 10px
+}
+.note
+{
+	BACKGROUND-COLOR:  #ffffff;
+	COLOR: #336699;
+	FONT-FAMILY: "Verdana", sans-serif;
+	FONT-SIZE: 100%;
+	MARGIN-BOTTOM: 0px;
+	MARGIN-LEFT: 0px;
+	MARGIN-TOP: 0px;
+	PADDING-RIGHT: 10px
+}
+.infotable
+{
+	BACKGROUND-COLOR: #f0f0e0;
+	BORDER-BOTTOM: #ffffff 0px solid;
+	BORDER-COLLAPSE: collapse;
+	BORDER-LEFT: #ffffff 0px solid;
+	BORDER-RIGHT: #ffffff 0px solid;
+	BORDER-TOP: #ffffff 0px solid;
+	FONT-SIZE: 70%;
+	MARGIN-LEFT: 10px
+}
+.issuetable
+{
+	BACKGROUND-COLOR: #ffffe8;
+	BORDER-COLLAPSE: collapse;
+	COLOR: #000000;
+	FONT-SIZE: 100%;
+	MARGIN-BOTTOM: 10px;
+	MARGIN-LEFT: 13px;
+	MARGIN-TOP: 0px
+}
+.issuetitle
+{
+	BACKGROUND-COLOR: #ffffff;
+	BORDER-BOTTOM: #dcdcdc 1px solid;
+	BORDER-TOP: #dcdcdc 1px;
+	COLOR: #003366;
+	FONT-WEIGHT: normal
+}
+.header
+{
+	BACKGROUND-COLOR: #cecf9c;
+	BORDER-BOTTOM: #ffffff 1px solid;
+	BORDER-LEFT: #ffffff 1px solid;
+	BORDER-RIGHT: #ffffff 1px solid;
+	BORDER-TOP: #ffffff 1px solid;
+	COLOR: #000000;
+	FONT-WEIGHT: bold
+}
+.issuehdr
+{
+	BACKGROUND-COLOR: #E0EBF5;
+	BORDER-BOTTOM: #dcdcdc 1px solid;
+	BORDER-TOP: #dcdcdc 1px solid;
+	COLOR: #000000;
+	FONT-WEIGHT: normal
+}
+.issuenone
+{
+	BACKGROUND-COLOR: #ffffff;
+	BORDER-BOTTOM: 0px;
+	BORDER-LEFT: 0px;
+	BORDER-RIGHT: 0px;
+	BORDER-TOP: 0px;
+	COLOR: #000000;
+	FONT-WEIGHT: normal
+}
+.content
+{
+	BACKGROUND-COLOR: #e7e7ce;
+	BORDER-BOTTOM: #ffffff 1px solid;
+	BORDER-LEFT: #ffffff 1px solid;
+	BORDER-RIGHT: #ffffff 1px solid;
+	BORDER-TOP: #ffffff 1px solid;
+	PADDING-LEFT: 3px
+}
+.issuecontent
+{
+	BACKGROUND-COLOR: #ffffff;
+	BORDER-BOTTOM: #dcdcdc 1px solid;
+	BORDER-TOP: #dcdcdc 1px solid;
+	PADDING-LEFT: 3px
+}
+A:link
+{
+	COLOR: #cc6633;
+	TEXT-DECORATION: underline
+}
+A:visited
+{
+	COLOR: #cc6633;
+}
+A:active
+{
+	COLOR: #cc6633;
+}
+A:hover
+{
+	COLOR: #cc3300;
+	TEXT-DECORATION: underline
+}
+H1
+{
+	BACKGROUND-COLOR: #003366;
+	BORDER-BOTTOM: #336699 6px solid;
+	COLOR: #ffffff;
+	FONT-SIZE: 130%;
+	FONT-WEIGHT: normal;
+	MARGIN: 0em 0em 0em -20px;
+	PADDING-BOTTOM: 8px;
+	PADDING-LEFT: 30px;
+	PADDING-TOP: 16px
+}
+H2
+{
+	COLOR: #000000;
+	FONT-SIZE: 80%;
+	FONT-WEIGHT: bold;
+	MARGIN-BOTTOM: 3px;
+	MARGIN-LEFT: 10px;
+	MARGIN-TOP: 20px;
+	PADDING-LEFT: 0px
+}
+H3
+{
+	COLOR: #000000;
+	FONT-SIZE: 80%;
+	FONT-WEIGHT: bold;
+	MARGIN-BOTTOM: -5px;
+	MARGIN-LEFT: 10px;
+	MARGIN-TOP: 20px
+}
+H4
+{
+	COLOR: #000000;
+	FONT-SIZE: 70%;
+	FONT-WEIGHT: bold;
+	MARGIN-BOTTOM: 0px;
+	MARGIN-TOP: 15px;
+	PADDING-BOTTOM: 0px
+}
+UL
+{
+	COLOR: #000000;
+	FONT-SIZE: 70%;
+	LIST-STYLE: square;
+	MARGIN-BOTTOM: 0pt;
+	MARGIN-TOP: 0pt
+}
+OL
+{
+	COLOR: #000000;
+	FONT-SIZE: 70%;
+	LIST-STYLE: square;
+	MARGIN-BOTTOM: 0pt;
+	MARGIN-TOP: 0pt
+}
+LI
+{
+	LIST-STYLE: square;
+	MARGIN-LEFT: 0px
+}
+.expandable
+{
+	CURSOR: hand
+}
+.expanded
+{
+	color: black
+}
+.collapsed
+{
+	DISPLAY: none
+}
+.foot
+{
+BACKGROUND-COLOR: #ffffff;
+BORDER-BOTTOM: #cecf9c 1px solid;
+BORDER-TOP: #cecf9c 2px solid
+}
+.settings
+{
+MARGIN-LEFT: 25PX;
+}
+.help
+{
+TEXT-ALIGN: right;
+margin-right: 10px;
+}

Added: trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.xslt
===================================================================
--- trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.xslt	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport.xslt	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,232 @@
+<?xml version="1.0" encoding="utf-8"?>
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
+
+    <xsl:key name="ProjectKey" match="Event" use="@Project"/>
+
+    <xsl:template match="Events" mode="createProjects">
+        <projects>
+            <xsl:for-each select="Event">
+                <!--xsl:sort select="@Project" order="descending"/-->
+                <xsl:if test="(1=position()) or (preceding-sibling::*[1]/@Project != @Project)">
+
+                    <xsl:variable name="ProjectName" select="@Project"/>
+
+                    <project>
+                        <xsl:attribute name="name">
+                            <xsl:value-of select="@Project"/>
+                        </xsl:attribute> 
+
+                        <xsl:if test="@Project=''">
+                        <xsl:attribute name="solution">
+                            <xsl:value-of select="@Solution"/>
+                        </xsl:attribute> 
+                        </xsl:if>
+
+                        <xsl:for-each select="key('ProjectKey', $ProjectName)">
+                            <!--xsl:sort select="@Source" /-->
+                            <xsl:if test="(1=position()) or (preceding-sibling::*[1]/@Source != @Source)">
+
+                                <source>
+                                    <xsl:attribute name="name">
+                                        <xsl:value-of select="@Source"/>
+                                    </xsl:attribute>
+
+                                    <xsl:variable name="Source">
+                                        <xsl:value-of select="@Source"/>
+                                    </xsl:variable>
+
+                                    <xsl:for-each select="key('ProjectKey', $ProjectName)[ @Source = $Source ]">
+
+                                        <event>
+                                            <xsl:attribute name="error-level">
+                                                <xsl:value-of select="@ErrorLevel"/>
+                                            </xsl:attribute> 
+                                            <xsl:attribute name="description">
+                                                <xsl:value-of select="@Description"/>
+                                            </xsl:attribute> 
+                                        </event>
+                                    </xsl:for-each>
+                                </source>
+                            </xsl:if>
+                        </xsl:for-each>
+
+                    </project>
+                </xsl:if>
+            </xsl:for-each>
+        </projects>
+    </xsl:template>
+
+    <xsl:template match="projects">
+    <xsl:for-each select="project">
+    <xsl:sort select="@Name" order="ascending"/>
+        <h2>
+        <xsl:if test="@solution"><a _locID="Solution">Projektmappe</a>: <xsl:value-of select="@solution"/></xsl:if>
+        <xsl:if test="not(@solution)"><a _locID="Project">Projekt</a>: <xsl:value-of select="@name"/>
+            <xsl:for-each select="source">
+                <xsl:variable name="Hyperlink" select="@name"/>
+            <xsl:for-each select="event[@error-level='4']">
+             <A class="note"><xsl:attribute name="HREF"><xsl:value-of select="$Hyperlink"/></xsl:attribute><xsl:value-of select="@description"/></A>
+                </xsl:for-each>
+            </xsl:for-each>
+        </xsl:if>
+        </h2>
+
+        <table cellpadding="2" cellspacing="0" width="98%" border="1" bordercolor="white" class="infotable">
+            <tr>
+                <td nowrap="1" class="header" _locID="Filename">Dateiname</td>
+                <td nowrap="1" class="header" _locID="Status">Status</td>
+                <td nowrap="1" class="header" _locID="Errors">Fehler</td>
+                <td nowrap="1" class="header" _locID="Warnings">Warnungen</td>
+            </tr>
+
+            <xsl:for-each select="source">
+                <xsl:sort select="@name" order="ascending"/>
+                <xsl:variable name="source-id" select="generate-id(.)"/>
+
+                <xsl:if test="count(event)!=count(event[@error-level='4'])">
+
+                <tr class="row">
+                    <td class="content">
+                        <A HREF="javascript:"><xsl:attribute name="onClick">javascript:document.images['<xsl:value-of select="$source-id"/>'].click()</xsl:attribute><IMG border="0" _locID="IMG.alt" _locAttrData="alt" alt="Bereich erweitern/reduzieren" class="expandable" height="11" onclick="changepic()" src="_UpgradeReport_Files/UpgradeReport_Plus.gif" width="9"><xsl:attribute name="name"><xsl:value-of select="$source-id"/></xsl:attribute><xsl:attribute name="child">src<xsl:value-of select="$source-id"/></xsl:attribute></IMG></A> <xsl:value-of select="@name"/> 
+                    </td>
+                    <td class="content">
+                        <xsl:if test="count(event[@error-level='3'])=1">
+                            <xsl:for-each select="event[@error-level='3']">
+                            <xsl:if test="@description='Converted'"><a _locID="Converted1">Konvertiert</a></xsl:if>
+                            <xsl:if test="@description!='Converted'"><xsl:value-of select="@description"/></xsl:if>
+                            </xsl:for-each>
+                        </xsl:if>
+                        <xsl:if test="count(event[@error-level='3'])!=1 and count(event[@error-level='3' and @description='Converted'])!=0"><a _locID="Converted2">Konvertiert</a>
+                        </xsl:if>
+                    </td>
+                    <td class="content"><xsl:value-of select="count(event[@error-level='2'])"/></td>
+                    <td class="content"><xsl:value-of select="count(event[@error-level='1'])"/></td>
+                </tr>
+
+                <tr class="collapsed" bgcolor="#ffffff">
+                    <xsl:attribute name="id">src<xsl:value-of select="$source-id"/></xsl:attribute>
+
+                    <td colspan="7">
+                        <table width="97%" border="1" bordercolor="#dcdcdc" rules="cols" class="issuetable">
+                            <tr>
+                                <td colspan="7" class="issuetitle" _locID="ConversionIssues">Konvertierungsprobleme - <xsl:value-of select="@name"/>:</td>
+                            </tr>
+
+                            <xsl:for-each select="event[@error-level!='3']">
+                                <xsl:if test="@error-level!='4'">
+                                <tr>
+                                    <td class="issuenone" style="border-bottom:solid 1 lightgray">
+                                        <xsl:value-of select="@description"/>
+                                    </td>
+                                </tr>
+                                </xsl:if>
+                            </xsl:for-each>
+                        </table>
+                    </td>
+                </tr>
+                </xsl:if>
+            </xsl:for-each>
+
+            <tr valign="top">
+                <td class="foot">
+                    <xsl:if test="count(source)!=1">
+                        <xsl:value-of select="count(source)"/><a _locID="file1"> Dateien</a>
+                    </xsl:if>
+                    <xsl:if test="count(source)=1">
+                        <a _locID="file2">1 Datei</a>
+                    </xsl:if>
+                </td>
+                <td class="foot">
+					<a _locID="Converted3">Konvertiert</a>: <xsl:value-of select="count(source/event[@error-level='3' and @description='Converted'])"/><BR/>
+					<a _locID="NotConverted">Nicht konvertiert</a>: <xsl:value-of select="count(source) - count(source/event[@error-level='3' and @description='Converted'])"/>
+                </td>
+                <td class="foot"><xsl:value-of select="count(source/event[@error-level='2'])"/></td>
+                <td class="foot"><xsl:value-of select="count(source/event[@error-level='1'])"/></td>
+            </tr>
+        </table>
+    </xsl:for-each>
+    </xsl:template>
+
+    <xsl:template match="Property">
+        <xsl:if test="@Name!='Date' and @Name!='Time' and @Name!='LogNumber' and @Name!='Solution'">
+        <tr><td nowrap="1"><b><xsl:value-of select="@Name"/>: </b><xsl:value-of select="@Value"/></td></tr>
+        </xsl:if>
+    </xsl:template>
+
+    <xsl:template match="UpgradeLog">
+        <html>
+            <head>
+                <META HTTP-EQUIV="Content-Type" content="text/html; charset=utf-8"/>
+                <link rel="stylesheet" href="_UpgradeReport_Files\UpgradeReport.css"/>
+                <title _locID="ConversionReport0">Konvertierungsbericht 
+                    <xsl:if test="Properties/Property[@Name='LogNumber']">
+                        <xsl:value-of select="Properties/Property[@Name='LogNumber']/@Value"/>
+                    </xsl:if>
+                </title>
+                <script language="javascript">
+                    function outliner () {
+                        oMe = window.event.srcElement
+                        //get child element
+                        var child = document.all[event.srcElement.getAttribute("child",false)];
+                        //if child element exists, expand or collapse it.
+                        if (null != child)
+                            child.className = child.className == "collapsed" ? "expanded" : "collapsed";
+                    }
+
+                    function changepic() {
+                        uMe = window.event.srcElement;
+                        var check = uMe.src.toLowerCase();
+                        if (check.lastIndexOf("upgradereport_plus.gif") != -1)
+                        {
+                            uMe.src = "_UpgradeReport_Files/UpgradeReport_Minus.gif"
+                        }
+                        else
+                        {
+                            uMe.src = "_UpgradeReport_Files/UpgradeReport_Plus.gif"
+                        }
+                    }
+                </script>
+            </head>
+            <body topmargin="0" leftmargin="0" rightmargin="0" onclick="outliner();">
+                <h1 _locID="ConversionReport">Konvertierungsbericht - <xsl:value-of select="Properties/Property[@Name='Solution']/@Value"/></h1>
+
+                <p><span class="note">
+                <b _locID="TimeOfConversion">Konvertierungsdauer:</b>  <xsl:value-of select="Properties/Property[@Name='Date']/@Value"/>  <xsl:value-of select="Properties/Property[@Name='Time']/@Value"/><br/>
+                </span></p>
+
+                <xsl:variable name="SortedEvents">
+                    <Events>
+                        <xsl:for-each select="Event">
+                            <xsl:sort select="@Project" order="ascending"/>
+                            <xsl:sort select="@Source" order="ascending"/>
+                            <xsl:sort select="@ErrorLevel" order="ascending"/>
+                            <Event>
+                                <xsl:attribute name="Project"><xsl:value-of select="@Project"/> </xsl:attribute> 
+                                <xsl:attribute name="Solution"><xsl:value-of select="/UpgradeLog/Properties/Property[@Name='Solution']/@Value"/> </xsl:attribute> 
+                                <xsl:attribute name="Source"><xsl:value-of select="@Source"/> </xsl:attribute> 
+                                <xsl:attribute name="ErrorLevel"><xsl:value-of select="@ErrorLevel"/> </xsl:attribute> 
+                                <xsl:attribute name="Description"><xsl:value-of select="@Description"/> </xsl:attribute> 
+                            </Event>
+                        </xsl:for-each>     
+                    </Events>
+                </xsl:variable>
+                
+                <xsl:variable name="Projects">
+                    <xsl:apply-templates select="msxsl:node-set($SortedEvents)/*" mode="createProjects"/>
+                </xsl:variable>
+
+                <xsl:apply-templates select="msxsl:node-set($Projects)/*"/>
+
+                <p></p><p>
+                <table class="note">
+                    <tr>
+                        <td nowrap="1">
+                            <b _locID="ConversionSettings">Konvertierungseinstellungen</b>
+                        </td>
+                    </tr>
+                    <xsl:apply-templates select="Properties"/>
+                </table></p>
+            </body>
+        </html>
+    </xsl:template>
+</xsl:stylesheet>

Added: trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport_Minus.gif
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport_Minus.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport_Plus.gif
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/_UpgradeReport_Files/UpgradeReport_Plus.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-02 18:35:18 UTC (rev 2236)
@@ -23,6 +23,9 @@
     <System.Diagnostics.DebuggerStepThrough()> _
     Private Sub InitializeComponent()
         Me.PictureBox = New System.Windows.Forms.PictureBox
+        Me.LabelScaleVertical = New System.Windows.Forms.Label
+        Me.ButtonScaleDown = New System.Windows.Forms.Button
+        Me.ButtonScaleUp = New System.Windows.Forms.Button
         CType(Me.PictureBox, System.ComponentModel.ISupportInitialize).BeginInit()
         Me.SuspendLayout()
         '
@@ -31,23 +34,57 @@
         Me.PictureBox.Dock = System.Windows.Forms.DockStyle.Fill
         Me.PictureBox.Location = New System.Drawing.Point(0, 0)
         Me.PictureBox.Name = "PictureBox"
-        Me.PictureBox.Size = New System.Drawing.Size(451, 361)
+        Me.PictureBox.Size = New System.Drawing.Size(548, 505)
         Me.PictureBox.SizeMode = System.Windows.Forms.PictureBoxSizeMode.Zoom
         Me.PictureBox.TabIndex = 0
         Me.PictureBox.TabStop = False
         '
+        'LabelScaleVertical
+        '
+        Me.LabelScaleVertical.AutoSize = True
+        Me.LabelScaleVertical.Location = New System.Drawing.Point(224, 470)
+        Me.LabelScaleVertical.Name = "LabelScaleVertical"
+        Me.LabelScaleVertical.Size = New System.Drawing.Size(39, 13)
+        Me.LabelScaleVertical.TabIndex = 1
+        Me.LabelScaleVertical.Text = "Label1"
+        '
+        'ButtonScaleDown
+        '
+        Me.ButtonScaleDown.Location = New System.Drawing.Point(361, 470)
+        Me.ButtonScaleDown.Name = "ButtonScaleDown"
+        Me.ButtonScaleDown.Size = New System.Drawing.Size(85, 23)
+        Me.ButtonScaleDown.TabIndex = 2
+        Me.ButtonScaleDown.Text = "Scale down"
+        Me.ButtonScaleDown.UseVisualStyleBackColor = True
+        '
+        'ButtonScaleUp
+        '
+        Me.ButtonScaleUp.Location = New System.Drawing.Point(73, 470)
+        Me.ButtonScaleUp.Name = "ButtonScaleUp"
+        Me.ButtonScaleUp.Size = New System.Drawing.Size(85, 23)
+        Me.ButtonScaleUp.TabIndex = 3
+        Me.ButtonScaleUp.Text = "Scale up"
+        Me.ButtonScaleUp.UseVisualStyleBackColor = True
+        '
         'Map
         '
         Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
         Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
-        Me.ClientSize = New System.Drawing.Size(451, 361)
+        Me.ClientSize = New System.Drawing.Size(548, 505)
+        Me.Controls.Add(Me.ButtonScaleUp)
+        Me.Controls.Add(Me.ButtonScaleDown)
+        Me.Controls.Add(Me.LabelScaleVertical)
         Me.Controls.Add(Me.PictureBox)
         Me.Name = "Map"
         Me.ShowIcon = False
         Me.Text = "Map"
         CType(Me.PictureBox, System.ComponentModel.ISupportInitialize).EndInit()
         Me.ResumeLayout(False)
+        Me.PerformLayout()
 
     End Sub
     Private WithEvents PictureBox As System.Windows.Forms.PictureBox
+    Friend WithEvents LabelScaleVertical As System.Windows.Forms.Label
+    Friend WithEvents ButtonScaleDown As System.Windows.Forms.Button
+    Friend WithEvents ButtonScaleUp As System.Windows.Forms.Button
 End Class

Modified: trunk/tools/MakeWMSFile/capxml2wms/Map.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-02 18:35:18 UTC (rev 2236)
@@ -3,7 +3,11 @@
     Dim GetMapUrl As String
     Dim pngFileName As String
     Dim i As Image
+    Dim scale_ As Double
+    Public exitcode As Integer
+    Public clickedAt As Point
 
+
     Private Sub Map_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
         Try
             i.Dispose()
@@ -31,13 +35,36 @@
         End Try
     End Sub
 
-    Public Sub New(ByVal _GetMapUrl As String)
+    Public Sub New(ByVal _GetMapUrl As String, ByVal scale As Double)
 
         ' Dieser Aufruf ist f?r den Windows Form-Designer erforderlich.
         InitializeComponent()
 
         ' F?gen Sie Initialisierungen nach dem InitializeComponent()-Aufruf hinzu.
         GetMapUrl = _GetMapUrl
+        scale_ = scale
+        LabelScaleVertical.Text = "Vertical scale m/pixel: " & scale
+    End Sub
 
+    Private Sub ButtonScaleUp_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonScaleUp.Click
+        exitcode = +1
+        Close()
     End Sub
+
+    Private Sub ButtonScaleDown_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonScaleDown.Click
+        exitcode = -1
+        Close()
+    End Sub
+
+    Private Sub PictureBox_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PictureBox.Click
+        Dim mev As Windows.Forms.MouseEventArgs
+        mev = e
+        Dim im As RectangleF
+        im = PictureBox.Image.GetBounds(System.Drawing.GraphicsUnit.Pixel)
+        clickedAt = New Point
+        clickedAt.X = mev.X - (Width - im.Width) / 2 - im.Width / 2
+        clickedAt.Y = mev.Y - (Height - im.Height) / 2 - im.Height / 2
+        exitcode = 5
+        Close()
+    End Sub
 End Class
\ No newline at end of file

Modified: trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb	2009-10-02 18:35:18 UTC (rev 2236)
@@ -1,10 +1,10 @@
 ???'------------------------------------------------------------------------------
 ' <auto-generated>
-'     This code was generated by a tool.
-'     Runtime Version:2.0.50727.1433
+'     Dieser Code wurde von einem Tool generiert.
+'     Laufzeitversion:2.0.50727.3082
 '
-'     Changes to this file may cause incorrect behavior and will be lost if
-'     the code is regenerated.
+'     ??nderungen an dieser Datei k??nnen falsches Verhalten verursachen und gehen verloren, wenn
+'     der Code erneut generiert wird.
 ' </auto-generated>
 '------------------------------------------------------------------------------
 
@@ -14,10 +14,10 @@
 
 Namespace My
     
-    'NOTE: This file is auto-generated; do not modify it directly.  To make changes,
-    ' or if you encounter build errors in this file, go to the Project Designer
-    ' (go to Project Properties or double-click the My Project node in
-    ' Solution Explorer), and make changes on the Application tab.
+    'HINWEIS: Diese Datei wird automatisch generiert. ??ndern Sie sie nicht direkt. Zum ??ndern
+    ' oder bei in dieser Datei auftretenden Buildfehlern wechseln Sie zum Projekt-Designer.
+    ' (Wechseln Sie dazu zu den Projekteigenschaften, oder doppelklicken Sie auf den Knoten "Eigenes Projekt" im
+    ' Projektmappen-Explorer). Nehmen Sie auf der Registerkarte "Anwendung" entsprechende ??nderungen vor.
     '
     Partial Friend Class MyApplication
         

Modified: trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb	2009-10-02 18:35:18 UTC (rev 2236)
@@ -1,26 +1,27 @@
 ???'------------------------------------------------------------------------------
 ' <auto-generated>
-'     This code was generated by a tool.
-'     Runtime Version:2.0.50727.1433
+'     Dieser Code wurde von einem Tool generiert.
+'     Laufzeitversion:2.0.50727.3082
 '
-'     Changes to this file may cause incorrect behavior and will be lost if
-'     the code is regenerated.
+'     ??nderungen an dieser Datei k??nnen falsches Verhalten verursachen und gehen verloren, wenn
+'     der Code erneut generiert wird.
 ' </auto-generated>
 '------------------------------------------------------------------------------
 
 Option Strict On
 Option Explicit On
 
+Imports System
 
 Namespace My.Resources
     
-    'This class was auto-generated by the StronglyTypedResourceBuilder
-    'class via a tool like ResGen or Visual Studio.
-    'To add or remove a member, edit your .ResX file then rerun ResGen
-    'with the /str option, or rebuild your VS project.
-    '<summary>
-    '  A strongly-typed resource class, for looking up localized strings, etc.
-    '</summary>
+    'Diese Klasse wurde von der StronglyTypedResourceBuilder automatisch generiert
+    '-Klasse ??ber ein Tool wie ResGen oder Visual Studio automatisch generiert.
+    'Um einen Member hinzuzuf??gen oder zu entfernen, bearbeiten Sie die .ResX-Datei und f??hren dann ResGen
+    'mit der /str-Option erneut aus, oder Sie erstellen Ihr VS-Projekt neu.
+    '''<summary>
+    '''  Eine stark typisierte Ressourcenklasse zum Suchen von lokalisierten Zeichenfolgen usw.
+    '''</summary>
     <Global.System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "2.0.0.0"),  _
      Global.System.Diagnostics.DebuggerNonUserCodeAttribute(),  _
      Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(),  _
@@ -31,9 +32,9 @@
         
         Private resourceCulture As Global.System.Globalization.CultureInfo
         
-        '<summary>
-        '  Returns the cached ResourceManager instance used by this class.
-        '</summary>
+        '''<summary>
+        '''  Gibt die zwischengespeicherte ResourceManager-Instanz zur??ck, die von dieser Klasse verwendet wird.
+        '''</summary>
         <Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _
         Friend ReadOnly Property ResourceManager() As Global.System.Resources.ResourceManager
             Get
@@ -45,16 +46,16 @@
             End Get
         End Property
         
-        '<summary>
-        '  Overrides the current thread's CurrentUICulture property for all
-        '  resource lookups using this strongly typed resource class.
-        '</summary>
+        '''<summary>
+        '''  ??berschreibt die CurrentUICulture-Eigenschaft des aktuellen Threads f??r alle
+        '''  Ressourcenzuordnungen, die diese stark typisierte Ressourcenklasse verwenden.
+        '''</summary>
         <Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _
         Friend Property Culture() As Global.System.Globalization.CultureInfo
             Get
                 Return resourceCulture
             End Get
-            Set(ByVal value As Global.System.Globalization.CultureInfo)
+            Set
                 resourceCulture = value
             End Set
         End Property

Modified: trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb	2009-10-02 18:35:18 UTC (rev 2236)
@@ -1,10 +1,10 @@
 ???'------------------------------------------------------------------------------
 ' <auto-generated>
-'     This code was generated by a tool.
-'     Runtime Version:2.0.50727.1433
+'     Dieser Code wurde von einem Tool generiert.
+'     Laufzeitversion:2.0.50727.3082
 '
-'     Changes to this file may cause incorrect behavior and will be lost if
-'     the code is regenerated.
+'     ??nderungen an dieser Datei k??nnen falsches Verhalten verursachen und gehen verloren, wenn
+'     der Code erneut generiert wird.
 ' </auto-generated>
 '------------------------------------------------------------------------------
 
@@ -13,27 +13,27 @@
 
 
 Namespace My
-
+    
     <Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(),  _
-     Global.System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "8.0.0.0"),  _
+     Global.System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "9.0.0.0"),  _
      Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _
     Partial Friend NotInheritable Class MySettings
         Inherits Global.System.Configuration.ApplicationSettingsBase
         
-        Private Shared defaultInstance As MySettings = CType(Global.System.Configuration.ApplicationSettingsBase.Synchronized(New MySettings), MySettings)
+        Private Shared defaultInstance As MySettings = CType(Global.System.Configuration.ApplicationSettingsBase.Synchronized(New MySettings),MySettings)
         
-#Region "My.Settings Auto-Save Functionality"
+#Region "Funktion zum automatischen Speichern von My.Settings"
 #If _MyType = "WindowsForms" Then
-        Private Shared addedHandler As Boolean
+    Private Shared addedHandler As Boolean
 
-        Private Shared addedHandlerLockObject As New Object
+    Private Shared addedHandlerLockObject As New Object
 
-        <Global.System.Diagnostics.DebuggerNonUserCodeAttribute(), Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)> _
-        Private Shared Sub AutoSaveSettings(ByVal sender As Global.System.Object, ByVal e As Global.System.EventArgs)
-            If My.Application.SaveMySettingsOnExit Then
-                My.Settings.Save()
-            End If
-        End Sub
+    <Global.System.Diagnostics.DebuggerNonUserCodeAttribute(), Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)> _
+    Private Shared Sub AutoSaveSettings(ByVal sender As Global.System.Object, ByVal e As Global.System.EventArgs)
+        If My.Application.SaveMySettingsOnExit Then
+            My.Settings.Save()
+        End If
+    End Sub
 #End If
 #End Region
         
@@ -41,14 +41,14 @@
             Get
                 
 #If _MyType = "WindowsForms" Then
-                   If Not addedHandler Then
-                        SyncLock addedHandlerLockObject
-                            If Not addedHandler Then
-                                AddHandler My.Application.Shutdown, AddressOf AutoSaveSettings
-                                addedHandler = True
-                            End If
-                        End SyncLock
-                    End If
+               If Not addedHandler Then
+                    SyncLock addedHandlerLockObject
+                        If Not addedHandler Then
+                            AddHandler My.Application.Shutdown, AddressOf AutoSaveSettings
+                            addedHandler = True
+                        End If
+                    End SyncLock
+                End If
 #End If
                 Return defaultInstance
             End Get

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
===================================================================
(Binary files differ)

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.pdb
===================================================================
(Binary files differ)

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe
===================================================================
(Binary files differ)

Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe.manifest
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe.manifest	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.vshost.exe.manifest	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,11 @@
+???<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
+<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
+  <assemblyIdentity version="1.0.0.0" name="MyApplication.app"/>
+  <trustInfo xmlns="urn:schemas-microsoft-com:asm.v2">
+    <security>
+      <requestedPrivileges xmlns="urn:schemas-microsoft-com:asm.v3">
+        <requestedExecutionLevel level="asInvoker" uiAccess="false"/>
+      </requestedPrivileges>
+    </security>
+  </trustInfo>
+</assembly>

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.xml	2009-10-02 18:35:18 UTC (rev 2236)
@@ -6,6 +6,19 @@
 </name>
 </assembly>
 <members>
-
+<member name="P:capxml2wms.My.Resources.Resources.ResourceManager">
+	<summary>
+  Gibt die zwischengespeicherte ResourceManager-Instanz zur??ck, die von dieser Klasse verwendet wird.
+</summary>
+</member><member name="P:capxml2wms.My.Resources.Resources.Culture">
+	<summary>
+  ??berschreibt die CurrentUICulture-Eigenschaft des aktuellen Threads f??r alle
+  Ressourcenzuordnungen, die diese stark typisierte Ressourcenklasse verwenden.
+</summary>
+</member><member name="T:capxml2wms.My.Resources.Resources">
+	<summary>
+  Eine stark typisierte Ressourcenklasse zum Suchen von lokalisierten Zeichenfolgen usw.
+</summary>
+</member>
 </members>
 </doc>
\ No newline at end of file

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.exe
===================================================================
(Binary files differ)

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.pdb
===================================================================
(Binary files differ)

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/bin/Release/capxml2wms.xml	2009-10-02 18:35:18 UTC (rev 2236)
@@ -6,6 +6,19 @@
 </name>
 </assembly>
 <members>
-
+<member name="P:capxml2wms.My.Resources.Resources.ResourceManager">
+	<summary>
+  Gibt die zwischengespeicherte ResourceManager-Instanz zur??ck, die von dieser Klasse verwendet wird.
+</summary>
+</member><member name="P:capxml2wms.My.Resources.Resources.Culture">
+	<summary>
+  ??berschreibt die CurrentUICulture-Eigenschaft des aktuellen Threads f??r alle
+  Ressourcenzuordnungen, die diese stark typisierte Ressourcenklasse verwenden.
+</summary>
+</member><member name="T:capxml2wms.My.Resources.Resources">
+	<summary>
+  Eine stark typisierte Ressourcenklasse zum Suchen von lokalisierten Zeichenfolgen usw.
+</summary>
+</member>
 </members>
 </doc>
\ No newline at end of file

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb	2009-10-02 18:35:18 UTC (rev 2236)
@@ -43,6 +43,7 @@
         Me.ComboBoxBBox = New System.Windows.Forms.ComboBox
         Me.Label6 = New System.Windows.Forms.Label
         Me.ComboBoxBBoxI = New System.Windows.Forms.ComboBox
+        Me.ButtonFindScale = New System.Windows.Forms.Button
         Me.SuspendLayout()
         '
         'ButtonErstellen
@@ -251,11 +252,22 @@
         Me.ComboBoxBBoxI.TabIndex = 22
         Me.ComboBoxBBoxI.Visible = False
         '
+        'ButtonFindScale
+        '
+        Me.ButtonFindScale.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ButtonFindScale.Location = New System.Drawing.Point(540, 439)
+        Me.ButtonFindScale.Name = "ButtonFindScale"
+        Me.ButtonFindScale.Size = New System.Drawing.Size(123, 36)
+        Me.ButtonFindScale.TabIndex = 23
+        Me.ButtonFindScale.Text = "Optimale Scale finden"
+        Me.ButtonFindScale.UseVisualStyleBackColor = True
+        '
         'capxml2wms
         '
         Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
         Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
         Me.ClientSize = New System.Drawing.Size(675, 601)
+        Me.Controls.Add(Me.ButtonFindScale)
         Me.Controls.Add(Me.ComboBoxBBoxI)
         Me.Controls.Add(Me.Label6)
         Me.Controls.Add(Me.ComboBoxBBox)
@@ -303,5 +315,6 @@
     Private WithEvents ComboBoxBBox As System.Windows.Forms.ComboBox
     Private WithEvents Label6 As System.Windows.Forms.Label
     Private WithEvents ComboBoxBBoxI As System.Windows.Forms.ComboBox
+    Private WithEvents ButtonFindScale As System.Windows.Forms.Button
 
 End Class

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-02 18:35:18 UTC (rev 2236)
@@ -40,9 +40,7 @@
     '12. CheckedListBoxLayers Layers mit Name, Title und Scalehint 
     '13. ComboBoxBBox LatlonBoundingBox
 
-
-    Dim MeineSkalierung As Integer
-
+    Dim WGS84 As Ellipsoid
     Dim OBBoxes As Dictionary(Of String, XmlElement)
 
     Private Sub capxml2wms_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
@@ -53,6 +51,9 @@
     End Sub
 
     Private Sub capxml2wms_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
+        WGS84.a = 6378137
+        WGS84.b = 298.257223563
+
         xmlFileName = IO.Path.GetTempFileName
         IO.File.Delete(xmlFileName)
 
@@ -86,7 +87,70 @@
     End Sub
 
     Private Sub ButtonShowMap_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonShowMap.Click
+        Dim MeineSkalierung As Double
+        MeineSkalierung = 2.0 * Me.HScrollBar1.Value
+        mapUrl = makeGetMapUrl(MeineSkalierung)
+        Dim SM As New Map(mapUrl, 0)
+        'MsgBox("Noch nicht vorhanden!", MsgBoxStyle.Information, "Hinweis!")
+        SM.ShowDialog()
+    End Sub
+    Private Sub ButtonFindScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonFindScale.Click
+        Dim BBoxString As String
 
+        Dim center As point
+        ' find center
+        Dim bb As XmlElement
+        Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
+        bb = Me.ComboBoxBBoxI.SelectedItem
+        minx = bb.GetAttribute("minx")
+        rminx = Double.Parse(minx, DPunkt.NumberFormat)
+        miny = bb.GetAttribute("miny")
+        rminy = Double.Parse(miny, DPunkt.NumberFormat)
+        maxx = bb.GetAttribute("maxx")
+        rmaxx = Double.Parse(maxx, DPunkt.NumberFormat)
+        maxy = bb.GetAttribute("maxy")
+        rmaxy = Double.Parse(maxy, DPunkt.NumberFormat)
+ 
+        rxmitte = (rminx + rmaxx) / 2
+        rymitte = (rminy + rmaxy) / 2
+        center.x = rxmitte
+        center.y = rymitte
+
+        Dim scale_ll, scale_ul, scale_m As Double
+        Dim pixelwidth As Integer
+        pixelwidth = 500
+
+        scale_ll = 0.1
+        scale_ul = 1000
+
+        Dim SM As Map
+        Dim mapUrl As String
+        Do
+            scale_m = (scale_ll + scale_ul) / 2
+            BBoxString = ToBBox(center, metersToBBoxVertical(4326) * pixelwidth * scale_m)
+            mapUrl = makeGetMapUrlFromBBox(BBoxString)
+            SM = New Map(mapUrl, scale_m)
+            SM.ShowDialog()
+            Select Case SM.exitcode
+                Case -1
+                    scale_ul = scale_m
+                Case 1
+                    scale_ll = scale_m
+                Case 5
+                    ' shift center to the clicked pos
+                    center.x = center.x + SM.clickedAt.X * scale_m * metersToBBoxVertical(4326)
+                    center.y = center.y - SM.clickedAt.Y * scale_m * metersToBBoxVertical(4326)
+            End Select
+
+        Loop Until SM.exitcode = 0
+    End Sub
+    Private Function metersToBBoxVertical(ByVal epsg) As Double
+        If epsg = 4326 Then
+            metersToBBoxVertical = 360 / (WGS84.a * Math.PI * 2)
+        Else : metersToBBoxVertical = 1
+        End If
+    End Function
+    Private Function makeGetMapUrlFromBBox(ByVal bb As String) As String
         'http:// www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous
         '&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap
         '&SRS=EPSG:31467
@@ -97,12 +161,44 @@
         '&STYLES=
         '&FORMAT=image/png
 
-        MeineSkalierung = 2.0 * Me.HScrollBar1.Value
 
         mapUrl = wmsUrl & "SERVICE=WMS&VERSION=" & Version & "&REQUEST=GetMap"
 
         mapUrl += "&SRS=EPSG:" & Me.ComboBoxEPSG.SelectedItem
 
+        Dim BBox As String = "&BBox=" & bb
+
+        mapUrl += BBox
+        mapUrl += "&WIDTH=500"
+        mapUrl += "&HEIGHT=500"
+        ' und die gew?hlten Layer durch Komma getrennt
+        Dim SelectedLayers As String = ""
+        For Each s As String In CheckedListBoxLayers.CheckedItems
+            SelectedLayers += "," & s.Split("|")(0)
+        Next
+        If SelectedLayers <> "" Then
+            mapUrl += "&LAYERS=" & SelectedLayers.Substring(1).Replace(" ", "%20")
+        End If
+        mapUrl += "&STYLES="
+        mapUrl += "&FORMAT=" & Me.ComboBoxFormat.SelectedItem.ToString
+        makeGetMapUrlFromBBox = mapUrl
+    End Function
+    Private Function makeGetMapUrl(ByVal scale As Double) As String
+        'http:// www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous
+        '&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap
+        '&SRS=EPSG:31467
+        '&BBOX=3500394.51 , 5371405.09 , 3520394.51 , 5391405.09 
+        '&WIDTH=1000
+        '&HEIGHT=1000
+        '&LAYERS=DVTK50K
+        '&STYLES=
+        '&FORMAT=image/png
+
+
+        mapUrl = wmsUrl & "SERVICE=WMS&VERSION=" & Version & "&REQUEST=GetMap"
+
+        mapUrl += "&SRS=EPSG:" & Me.ComboBoxEPSG.SelectedItem
+
         Dim rxmin As Double
         Dim rxmax As Double
         Dim rymin As Double
@@ -121,12 +217,12 @@
                 GetBBoxValues(Me.ComboBoxBBoxI.SelectedItem)
                 ' jetzt haben wir die BBox zum WGS84
                 MsgBox("Kartenansicht f?r diese Auswahl nicht implementiert", MsgBoxStyle.Exclamation)
-                Exit Sub
+                Exit Function
             End Try
         End If
 
-        Dim HalbeKantenlaengex As Double = (rmaxx - rminx) / MeineSkalierung
-        Dim HalbeKantenlaengey As Double = (rmaxy - rminy) / MeineSkalierung
+        Dim HalbeKantenlaengex As Double = (rmaxx - rminx) / scale
+        Dim HalbeKantenlaengey As Double = (rmaxy - rminy) / scale
         Dim HalbeKantenlaenge As Double = HalbeKantenlaengex
         If HalbeKantenlaengex > HalbeKantenlaengey Then
             HalbeKantenlaenge = HalbeKantenlaengey
@@ -141,8 +237,8 @@
         BBox += rxmax.ToString(DPunkt) & "," & rymax.ToString(DPunkt)
 
         mapUrl += BBox
-        mapUrl += "&WIDTH=1000"
-        mapUrl += "&HEIGHT=1000"
+        mapUrl += "&WIDTH=500"
+        mapUrl += "&HEIGHT=500"
         ' und die gew?hlten Layer durch Komma getrennt
         Dim SelectedLayers As String = ""
         For Each s As String In CheckedListBoxLayers.CheckedItems
@@ -153,12 +249,20 @@
         End If
         mapUrl += "&STYLES="
         mapUrl += "&FORMAT=" & Me.ComboBoxFormat.SelectedItem.ToString
+        makeGetMapUrl = mapUrl
+    End Function
 
-        Dim SM As New Map(mapUrl)
-        'MsgBox("Noch nicht vorhanden!", MsgBoxStyle.Information, "Hinweis!")
-        SM.ShowDialog()
-    End Sub
-
+    Private Function ToBBox(ByRef center As point, ByVal sizeBboxVertically As Double) As String
+        Dim tl As point
+        Dim br As point
+        tl.x = center.x - sizeBboxVertically / 2
+        tl.y = center.y + sizeBboxVertically / 2
+        br.x = center.x + sizeBboxVertically / 2
+        br.y = center.y - sizeBboxVertically / 2
+        Dim BBox As String
+        BBox = tl.x.ToString(DPunkt) + "," + br.y.ToString(DPunkt) + "," + br.x.ToString(DPunkt) + "," + tl.y.ToString(DPunkt)
+        ToBBox = BBox
+    End Function
     Private Sub ButtonErstellen_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonErstellen.Click
 
         Dim wmsFileName As String = IO.Path.ChangeExtension(xmlFileName, ".wms")
@@ -352,7 +456,7 @@
         Dim ms As New IO.MemoryStream
         xd.Save(ms)
         Dim encoding As System.Text.Encoding = New System.Text.UTF8Encoding '.ASCIIEncoding
-        Me.TextBoxXML.Text = encoding.UTF8.GetString(ms.GetBuffer())
+        Me.TextBoxXML.Text = System.Text.Encoding.UTF8.GetString(ms.GetBuffer())
         ms.Close()
 
         Me.ButtonShowMap.Enabled = True

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj	2009-10-02 18:35:18 UTC (rev 2236)
@@ -1,9 +1,9 @@
 ???<?xml version="1.0" encoding="utf-8"?>
-<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
+<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
   <PropertyGroup>
     <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
     <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
-    <ProductVersion>8.0.50727</ProductVersion>
+    <ProductVersion>9.0.30729</ProductVersion>
     <SchemaVersion>2.0</SchemaVersion>
     <ProjectGuid>{623B1E12-B5BF-4835-A982-AE5500BFADC8}</ProjectGuid>
     <OutputType>WinExe</OutputType>
@@ -12,6 +12,27 @@
     <AssemblyName>capxml2wms</AssemblyName>
     <MyType>WindowsForms</MyType>
     <ApplicationIcon>gc.ico</ApplicationIcon>
+    <FileUpgradeFlags>
+    </FileUpgradeFlags>
+    <OldToolsVersion>2.0</OldToolsVersion>
+    <TargetFrameworkVersion>v3.5</TargetFrameworkVersion>
+    <UpgradeBackupLocation>
+    </UpgradeBackupLocation>
+    <PublishUrl>publish\</PublishUrl>
+    <Install>true</Install>
+    <InstallFrom>Disk</InstallFrom>
+    <UpdateEnabled>false</UpdateEnabled>
+    <UpdateMode>Foreground</UpdateMode>
+    <UpdateInterval>7</UpdateInterval>
+    <UpdateIntervalUnits>Days</UpdateIntervalUnits>
+    <UpdatePeriodically>false</UpdatePeriodically>
+    <UpdateRequired>false</UpdateRequired>
+    <MapFileExtensions>true</MapFileExtensions>
+    <ApplicationRevision>0</ApplicationRevision>
+    <ApplicationVersion>1.0.0.%2a</ApplicationVersion>
+    <IsWebBootstrapper>false</IsWebBootstrapper>
+    <UseApplicationTrust>false</UseApplicationTrust>
+    <BootstrapperEnabled>true</BootstrapperEnabled>
   </PropertyGroup>
   <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
     <DebugSymbols>true</DebugSymbols>
@@ -109,6 +130,38 @@
   <ItemGroup>
     <Content Include="gc.ico" />
   </ItemGroup>
+  <ItemGroup>
+    <BootstrapperPackage Include="Microsoft.Net.Client.3.5">
+      <Visible>False</Visible>
+      <ProductName>.NET Framework Client Profile</ProductName>
+      <Install>false</Install>
+    </BootstrapperPackage>
+    <BootstrapperPackage Include="Microsoft.Net.Framework.2.0">
+      <Visible>False</Visible>
+      <ProductName>.NET Framework 2.0 %28x86%29</ProductName>
+      <Install>false</Install>
+    </BootstrapperPackage>
+    <BootstrapperPackage Include="Microsoft.Net.Framework.3.0">
+      <Visible>False</Visible>
+      <ProductName>.NET Framework 3.0 %28x86%29</ProductName>
+      <Install>false</Install>
+    </BootstrapperPackage>
+    <BootstrapperPackage Include="Microsoft.Net.Framework.3.5">
+      <Visible>False</Visible>
+      <ProductName>.NET Framework 3.5</ProductName>
+      <Install>false</Install>
+    </BootstrapperPackage>
+    <BootstrapperPackage Include="Microsoft.Net.Framework.3.5.SP1">
+      <Visible>False</Visible>
+      <ProductName>.NET Framework 3.5 SP1</ProductName>
+      <Install>true</Install>
+    </BootstrapperPackage>
+    <BootstrapperPackage Include="Microsoft.Windows.Installer.3.1">
+      <Visible>False</Visible>
+      <ProductName>Windows Installer 3.1</ProductName>
+      <Install>true</Install>
+    </BootstrapperPackage>
+  </ItemGroup>
   <Import Project="$(MSBuildBinPath)\Microsoft.VisualBasic.targets" />
   <!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
        Other similar extension points exist, see Microsoft.Common.targets.

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user	2009-10-02 18:35:18 UTC (rev 2236)
@@ -9,8 +9,9 @@
     </UpdateUrlHistory>
     <BootstrapperUrlHistory>
     </BootstrapperUrlHistory>
-    <ApplicationRevision>0</ApplicationRevision>
     <FallbackCulture>de-DE</FallbackCulture>
     <VerifyUploadedFiles>true</VerifyUploadedFiles>
+    <ErrorReportUrlHistory>
+    </ErrorReportUrlHistory>
   </PropertyGroup>
 </Project>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/TempPE/My Project.Resources.Designer.vb.dll
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/TempPE/My Project.Resources.Designer.vb.dll
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.Map.resources
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.Map.resources
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.Resources.resources
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.Resources.resources
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.capxml2wms.resources
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.capxml2wms.resources
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.exe
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.pdb
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.pdb
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.vbproj.FileListAbsolute.txt
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.vbproj.FileListAbsolute.txt	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.vbproj.FileListAbsolute.txt	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,11 @@
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\bin\Debug\capxml2wms.exe
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\ResolveAssemblyReference.cache
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\capxml2wms.capxml2wms.resources
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\capxml2wms.Map.resources
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\capxml2wms.Resources.resources
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\capxml2wms.vbproj.GenerateResource.Cache
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\capxml2wms.exe
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\capxml2wms.xml
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Debug\capxml2wms.pdb
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\bin\Debug\capxml2wms.pdb
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\bin\Debug\capxml2wms.xml

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.vbproj.GenerateResource.Cache
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.vbproj.GenerateResource.Cache
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.xml
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.xml	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/obj/Debug/capxml2wms.xml	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,24 @@
+???<?xml version="1.0"?>
+<doc>
+<assembly>
+<name>
+capxml2wms
+</name>
+</assembly>
+<members>
+<member name="P:capxml2wms.My.Resources.Resources.ResourceManager">
+	<summary>
+  Gibt die zwischengespeicherte ResourceManager-Instanz zur??ck, die von dieser Klasse verwendet wird.
+</summary>
+</member><member name="P:capxml2wms.My.Resources.Resources.Culture">
+	<summary>
+  ??berschreibt die CurrentUICulture-Eigenschaft des aktuellen Threads f??r alle
+  Ressourcenzuordnungen, die diese stark typisierte Ressourcenklasse verwenden.
+</summary>
+</member><member name="T:capxml2wms.My.Resources.Resources">
+	<summary>
+  Eine stark typisierte Ressourcenklasse zum Suchen von lokalisierten Zeichenfolgen usw.
+</summary>
+</member>
+</members>
+</doc>
\ No newline at end of file

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/TempPE/My Project.Resources.Designer.vb.dll
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/TempPE/My Project.Resources.Designer.vb.dll
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.Map.resources
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.Map.resources
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.Resources.resources
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.Resources.resources
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.capxml2wms.resources
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.capxml2wms.resources
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.exe
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.pdb
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.pdb
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.vbproj.FileListAbsolute.txt
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.vbproj.FileListAbsolute.txt	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.vbproj.FileListAbsolute.txt	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,11 @@
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\bin\Release\capxml2wms.exe
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\bin\Release\capxml2wms.pdb
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\bin\Release\capxml2wms.xml
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\ResolveAssemblyReference.cache
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\capxml2wms.capxml2wms.resources
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\capxml2wms.Map.resources
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\capxml2wms.Resources.resources
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\capxml2wms.vbproj.GenerateResource.Cache
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\capxml2wms.exe
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\capxml2wms.xml
+C:\Dokumente und Einstellungen\r\Eigene Dateien\programmieren\elcipse\workspace\cachewolf\tools\MakeWMSFile\capxml2wms\obj\Release\capxml2wms.pdb

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.vbproj.GenerateResource.Cache
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.vbproj.GenerateResource.Cache
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.xml
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.xml	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms/obj/Release/capxml2wms.xml	2009-10-02 18:35:18 UTC (rev 2236)
@@ -0,0 +1,24 @@
+???<?xml version="1.0"?>
+<doc>
+<assembly>
+<name>
+capxml2wms
+</name>
+</assembly>
+<members>
+<member name="P:capxml2wms.My.Resources.Resources.ResourceManager">
+	<summary>
+  Gibt die zwischengespeicherte ResourceManager-Instanz zur??ck, die von dieser Klasse verwendet wird.
+</summary>
+</member><member name="P:capxml2wms.My.Resources.Resources.Culture">
+	<summary>
+  ??berschreibt die CurrentUICulture-Eigenschaft des aktuellen Threads f??r alle
+  Ressourcenzuordnungen, die diese stark typisierte Ressourcenklasse verwenden.
+</summary>
+</member><member name="T:capxml2wms.My.Resources.Resources">
+	<summary>
+  Eine stark typisierte Ressourcenklasse zum Suchen von lokalisierten Zeichenfolgen usw.
+</summary>
+</member>
+</members>
+</doc>
\ No newline at end of file

Modified: trunk/tools/MakeWMSFile/capxml2wms.sln
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms.sln	2009-10-02 15:20:45 UTC (rev 2235)
+++ trunk/tools/MakeWMSFile/capxml2wms.sln	2009-10-02 18:35:18 UTC (rev 2236)
@@ -1,6 +1,6 @@
 ???
-Microsoft Visual Studio Solution File, Format Version 9.00
-# Visual Studio 2005
+Microsoft Visual Studio Solution File, Format Version 10.00
+# Visual Basic Express 2008
 Project("{F184B08F-C81C-45F6-A57F-5ABD9991F28F}") = "capxml2wms", "capxml2wms\capxml2wms.vbproj", "{623B1E12-B5BF-4835-A982-AE5500BFADC8}"
 EndProject
 Global

Added: trunk/tools/MakeWMSFile/capxml2wms.suo
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms.suo
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From pfeffer at mail.berlios.de  Mon Oct  5 14:04:27 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 5 Oct 2009 14:04:27 +0200
Subject: [Cachewolf-svn] r2242 - in trunk/tools/MakeWMSFile/capxml2wms: .
	bin bin/Debug
Message-ID: <200910051204.n95C4RQc002099@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-05 14:04:15 +0200 (Mon, 05 Oct 2009)
New Revision: 2242

Added:
   trunk/tools/MakeWMSFile/capxml2wms/bin/
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
Modified:
   trunk/tools/MakeWMSFile/capxml2wms/
   trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/Map.vb
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
Log:
wms creating tool: can cope with epsg other than 4326 (WGS84)
wms creating tool: finding maximal / recommended / minimal scales integrated


Property changes on: trunk/tools/MakeWMSFile/capxml2wms
___________________________________________________________________
Name: svn:ignore
   + obj


Modified: trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-05 08:02:04 UTC (rev 2241)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-05 12:04:15 UTC (rev 2242)
@@ -26,6 +26,11 @@
         Me.LabelScaleVertical = New System.Windows.Forms.Label
         Me.ButtonScaleDown = New System.Windows.Forms.Button
         Me.ButtonScaleUp = New System.Windows.Forms.Button
+        Me.LabelScaleDiagonal = New System.Windows.Forms.Label
+        Me.ButtonUseAsMaxScale = New System.Windows.Forms.Button
+        Me.ButtonAddToRecommendedScale = New System.Windows.Forms.Button
+        Me.ButtonUseAsMinScale = New System.Windows.Forms.Button
+        Me.ButtonHelp = New System.Windows.Forms.Button
         CType(Me.PictureBox, System.ComponentModel.ISupportInitialize).BeginInit()
         Me.SuspendLayout()
         '
@@ -34,7 +39,7 @@
         Me.PictureBox.Dock = System.Windows.Forms.DockStyle.Fill
         Me.PictureBox.Location = New System.Drawing.Point(0, 0)
         Me.PictureBox.Name = "PictureBox"
-        Me.PictureBox.Size = New System.Drawing.Size(548, 505)
+        Me.PictureBox.Size = New System.Drawing.Size(674, 521)
         Me.PictureBox.SizeMode = System.Windows.Forms.PictureBoxSizeMode.Zoom
         Me.PictureBox.TabIndex = 0
         Me.PictureBox.TabStop = False
@@ -42,11 +47,11 @@
         'LabelScaleVertical
         '
         Me.LabelScaleVertical.AutoSize = True
-        Me.LabelScaleVertical.Location = New System.Drawing.Point(224, 470)
+        Me.LabelScaleVertical.Location = New System.Drawing.Point(179, 470)
         Me.LabelScaleVertical.Name = "LabelScaleVertical"
-        Me.LabelScaleVertical.Size = New System.Drawing.Size(39, 13)
+        Me.LabelScaleVertical.Size = New System.Drawing.Size(98, 13)
         Me.LabelScaleVertical.TabIndex = 1
-        Me.LabelScaleVertical.Text = "Label1"
+        Me.LabelScaleVertical.Text = "LabelScale Vertikal"
         '
         'ButtonScaleDown
         '
@@ -66,11 +71,61 @@
         Me.ButtonScaleUp.Text = "Scale up"
         Me.ButtonScaleUp.UseVisualStyleBackColor = True
         '
+        'LabelScaleDiagonal
+        '
+        Me.LabelScaleDiagonal.AutoSize = True
+        Me.LabelScaleDiagonal.Location = New System.Drawing.Point(179, 444)
+        Me.LabelScaleDiagonal.Name = "LabelScaleDiagonal"
+        Me.LabelScaleDiagonal.Size = New System.Drawing.Size(102, 13)
+        Me.LabelScaleDiagonal.TabIndex = 4
+        Me.LabelScaleDiagonal.Text = "LabelScaleDiagonal"
+        '
+        'ButtonUseAsMaxScale
+        '
+        Me.ButtonUseAsMaxScale.Location = New System.Drawing.Point(452, 385)
+        Me.ButtonUseAsMaxScale.Name = "ButtonUseAsMaxScale"
+        Me.ButtonUseAsMaxScale.Size = New System.Drawing.Size(195, 33)
+        Me.ButtonUseAsMaxScale.TabIndex = 5
+        Me.ButtonUseAsMaxScale.Text = "Use as MaxScale"
+        Me.ButtonUseAsMaxScale.UseVisualStyleBackColor = True
+        '
+        'ButtonAddToRecommendedScale
+        '
+        Me.ButtonAddToRecommendedScale.Location = New System.Drawing.Point(452, 427)
+        Me.ButtonAddToRecommendedScale.Name = "ButtonAddToRecommendedScale"
+        Me.ButtonAddToRecommendedScale.Size = New System.Drawing.Size(194, 30)
+        Me.ButtonAddToRecommendedScale.TabIndex = 6
+        Me.ButtonAddToRecommendedScale.Text = "Add to recommended scale"
+        Me.ButtonAddToRecommendedScale.UseVisualStyleBackColor = True
+        '
+        'ButtonUseAsMinScale
+        '
+        Me.ButtonUseAsMinScale.Location = New System.Drawing.Point(452, 463)
+        Me.ButtonUseAsMinScale.Name = "ButtonUseAsMinScale"
+        Me.ButtonUseAsMinScale.Size = New System.Drawing.Size(195, 30)
+        Me.ButtonUseAsMinScale.TabIndex = 7
+        Me.ButtonUseAsMinScale.Text = "Use as MinScale"
+        Me.ButtonUseAsMinScale.UseVisualStyleBackColor = True
+        '
+        'ButtonHelp
+        '
+        Me.ButtonHelp.Location = New System.Drawing.Point(529, 346)
+        Me.ButtonHelp.Name = "ButtonHelp"
+        Me.ButtonHelp.Size = New System.Drawing.Size(41, 22)
+        Me.ButtonHelp.TabIndex = 8
+        Me.ButtonHelp.Text = "Help"
+        Me.ButtonHelp.UseVisualStyleBackColor = True
+        '
         'Map
         '
         Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
         Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
-        Me.ClientSize = New System.Drawing.Size(548, 505)
+        Me.ClientSize = New System.Drawing.Size(674, 521)
+        Me.Controls.Add(Me.ButtonHelp)
+        Me.Controls.Add(Me.ButtonUseAsMinScale)
+        Me.Controls.Add(Me.ButtonAddToRecommendedScale)
+        Me.Controls.Add(Me.ButtonUseAsMaxScale)
+        Me.Controls.Add(Me.LabelScaleDiagonal)
         Me.Controls.Add(Me.ButtonScaleUp)
         Me.Controls.Add(Me.ButtonScaleDown)
         Me.Controls.Add(Me.LabelScaleVertical)
@@ -88,4 +143,9 @@
     Friend WithEvents LabelScaleVertical As System.Windows.Forms.Label
     Friend WithEvents ButtonScaleDown As System.Windows.Forms.Button
     Friend WithEvents ButtonScaleUp As System.Windows.Forms.Button
+    Friend WithEvents LabelScaleDiagonal As System.Windows.Forms.Label
+    Friend WithEvents ButtonUseAsMaxScale As System.Windows.Forms.Button
+    Friend WithEvents ButtonAddToRecommendedScale As System.Windows.Forms.Button
+    Friend WithEvents ButtonUseAsMinScale As System.Windows.Forms.Button
+    Friend WithEvents ButtonHelp As System.Windows.Forms.Button
 End Class

Modified: trunk/tools/MakeWMSFile/capxml2wms/Map.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-05 08:02:04 UTC (rev 2241)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-05 12:04:15 UTC (rev 2242)
@@ -44,6 +44,7 @@
         GetMapUrl = _GetMapUrl
         scale_ = scale
         LabelScaleVertical.Text = "Vertical scale m/pixel: " & scale
+        LabelScaleDiagonal.Text = "Diagonal scale m/pixel: " & scale * Math.Sqrt(2)
     End Sub
 
     Private Sub ButtonScaleUp_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonScaleUp.Click
@@ -67,4 +68,59 @@
         exitcode = 5
         Close()
     End Sub
-End Class
\ No newline at end of file
+
+    Private Sub ButtonUseAsMaxScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonUseAsMaxScale.Click
+        exitcode = 101
+        Close()
+    End Sub
+
+    Private Sub ButtonAddToRecommendedScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonAddToRecommendedScale.Click
+        exitcode = 100
+        Close()
+    End Sub
+
+    Private Sub ButtonUseAsMinScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonUseAsMinScale.Click
+        exitcode = 99
+        Close()
+    End Sub
+
+    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonHelp.Click
+        MsgBox("Diese Funktion dient dazu, eine Aufl?sung zu finden, die bestimmten Kriterien entspricht. Welche Kriterien dies sind " & _
+        "legen sie selbst fest, in dem Sie die angezeigt Karte beurteilen und dem Progamm durch klich auf 'scale up' oder " & _
+        "'scale down' mitteilen, ob die gesuchte Karte weniger Meter pro Pixel (scale down) oder mehr Meter pro " & _
+        "Pixel hat als die angezeigt Karte. " & _
+        Chr(13) & _
+        "Nach der Aufl?sung wird in der Spanne zwischen 0 und 1000m/Pixel nach der gew?nschten Aufl?sung gesucht. " & _
+        "Dazu wird die Spanne jeweils in 2 gleich gro?e Teile geteilt und Sie beurteilen anhand der gezeigten Karte" & _
+        ", ob die gesuchte Aufl?sung " & _
+        "in der unteren oder der oberen H?lfte zu finden ist. Damit Sie diese Aussage machen k?nnen, wird Ihnen die " & _
+        "Karte in der Aufl?ung genau in der Mitte der jeweiligen Spanne gezeigt (zu Beginn also mit 500m/Pixel) " & _
+        "und Sie teilen den Computer mit, ob die gesuchte Karte eine gr??ere oder eine kleinere Aufl?sung hat. " & _
+        "Danach wird die verbliebene Spanne wieder in der Mitte geteilt und die entsprechende Karte pr?sentiert. " & _
+        " Auf diese Weise kann die gew?nschte Aufl?sung mit nur wenigen Klicks sehr genau bestimmt werden. " & Chr(13) & _
+        "Begonnen wird mit der Spanne 0 bis 1000m/Pixel. Die erste Abfrage lautet daher, ob die gesuchte Karte " & _
+        "eine Aufl?sung gr??er oder kleiner 500m/Pixel hat. Wenn sie beispielseweise kleiner ist, dann dr?cken Sie " & _
+        "auf 'scale down'. Damit liegt die gesuchte Aufl?sung zwischen 0 und 500m/Pixel. Das Programm wird Ihnen " & _
+        "daher eine Karte mit 250m/Pixel zeigen und fragen, ob die gesuchte Aufl?sung kleiner oder gr??er ist." & _
+        " Wenn sie gr??er ist, dann ist liegt die gesuchte Aufl?sung zwischen 250 und 500 m/Pixel. Der Computer " & _
+        "wird Ihnen daher eine Karte mit (250+500)/2 = 375m/Pixel pr?sentieren." & _
+        "Konkret ist diese Methode dazu gedacht, a) die Maximale b) die minimale und c) evtl. mehrere empfohlene " & _
+        "Aufl?sungen zu ermitteln. Es wird empfohlen, zuerst die maximal, dann die minimale und schlie?lich ggf. " & _
+        "mehrere Aufl?sungen zu empfehlen. " & Chr(13) & _
+        "Nehmen wir dann, dass bei 1000m/Pixel die maximale Aufl?sung ?berschritten ist. Vermutlich erhalten Sie " & _
+        "dann eine wei?e, also leere Karte. Dr?cken Sie nun so oft auf 'scale down' bis eine Karte angezeigt wird. " & _
+        " Wenn eine Karte angezeigt wird, dr?cken sie so oft auf 'scale up' bis wieder eine leere Karte erscheint. " & _
+        "Nun dr?cken Sie wieder auf 'scale down' bis wieder eine Karte erscheint. Beenden Sie die Suche nach der " & _
+        " maximalen Aufl?sung, wenn sich die Aufl?sung um weniger als 0.5 m/Pixel ?ndert. Dr?cken Sie zum Abschluss " & _
+        "auf 'Use as MaxScale'. Dadurch wird die aktuelle Aufl?sung als MaxScale in die .wms ?bernommen." & _
+        "Au?erdem wird eine neue Karte geladen und als Startspanne zur Suche der Minscale 0 bis MaxScale verwendet." & _
+        Chr(13) & _
+        "MinScale, MaxScale und RecommendeScales werden zur?ckgesetzt, wenn man im Hauptfenster auf 'M?glichkeiten abfragen' " & _
+        " dr?ckt" & _
+        Chr(13) & _
+        "Damit Sie die Karte besser beurteilen k?nnen, k?nnen Sie sie verschieben. Klicken Sie dazu an die Stelle " & _
+        "in der Karte, die in die Mitte des Bildes verschoben werden soll. Ein Klick in die Karte bewirkt, dass " & _
+        "die Karte so verschoben wird, dass die Stelle, an die man geklickt hat, " & _
+        "in der Mitte des Bildes erscheint.")
+    End Sub
+End Class


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug
___________________________________________________________________
Name: svn:ignore
   + capxml2wms.pdb


Added: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
===================================================================
(Binary files differ)


Property changes on: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-05 08:02:04 UTC (rev 2241)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-05 12:04:15 UTC (rev 2242)
@@ -42,7 +42,11 @@
 
     Dim WGS84 As Ellipsoid
     Dim OBBoxes As Dictionary(Of String, XmlElement)
+    Dim minScale As Double = 0
+    Dim maxScale As Double = 1000
+    Dim recScale As ArrayList
 
+
     Private Sub capxml2wms_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
         Try
             IO.File.Delete(xmlFileName)
@@ -84,6 +88,11 @@
 
     Private Sub ButtonGetCapabilities_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonGetCapabilities.Click
         GotCapabilities = GetCapabilities()
+        maxScale = 1000
+        minScale = 0
+        If Not recScale Is Nothing Then
+            recScale.Clear()
+        End If
     End Sub
 
     Private Sub ButtonShowMap_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonShowMap.Click
@@ -97,20 +106,28 @@
     Private Sub ButtonFindScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonFindScale.Click
         Dim BBoxString As String
 
+        Dim srs As Integer
+        srs = Me.ComboBoxEPSG.SelectedItem
+
         Dim center As point
         ' find center
         Dim bb As XmlElement
-        Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
-        bb = Me.ComboBoxBBoxI.SelectedItem
-        minx = bb.GetAttribute("minx")
-        rminx = Double.Parse(minx, DPunkt.NumberFormat)
-        miny = bb.GetAttribute("miny")
-        rminy = Double.Parse(miny, DPunkt.NumberFormat)
-        maxx = bb.GetAttribute("maxx")
-        rmaxx = Double.Parse(maxx, DPunkt.NumberFormat)
-        maxy = bb.GetAttribute("maxy")
-        rmaxy = Double.Parse(maxy, DPunkt.NumberFormat)
- 
+        If (Me.OBBoxes.ContainsKey("EPSG:" & Me.ComboBoxEPSG.SelectedItem)) Then
+            bb = Me.OBBoxes.Item("EPSG:" & Me.ComboBoxEPSG.SelectedItem)
+            minx = bb.GetAttribute("minx")
+            rminx = Double.Parse(minx, DPunkt.NumberFormat)
+            miny = bb.GetAttribute("miny")
+            rminy = Double.Parse(miny, DPunkt.NumberFormat)
+            maxx = bb.GetAttribute("maxx")
+            rmaxx = Double.Parse(maxx, DPunkt.NumberFormat)
+            maxy = bb.GetAttribute("maxy")
+            rmaxy = Double.Parse(maxy, DPunkt.NumberFormat)
+        Else
+            MsgBox("In dem ausgew?hltem Raumbezugssystem (EPSG-code) ist die BoundingBox leider nicht angegeben." & _
+                   "Daher kann kein Zentrum automatisch bestimmt werden.")
+            Return
+        End If
+
         rxmitte = (rminx + rmaxx) / 2
         rymitte = (rminy + rmaxy) / 2
         center.x = rxmitte
@@ -120,14 +137,14 @@
         Dim pixelwidth As Integer
         pixelwidth = 500
 
-        scale_ll = 0.1
-        scale_ul = 1000
+        scale_ll = minScale
+        scale_ul = maxScale
 
         Dim SM As Map
         Dim mapUrl As String
         Do
             scale_m = (scale_ll + scale_ul) / 2
-            BBoxString = ToBBox(center, metersToBBoxVertical(4326) * pixelwidth * scale_m)
+            BBoxString = ToBBox(center, srs, pixelwidth * scale_m)
             mapUrl = makeGetMapUrlFromBBox(BBoxString)
             SM = New Map(mapUrl, scale_m)
             SM.ShowDialog()
@@ -138,18 +155,39 @@
                     scale_ll = scale_m
                 Case 5
                     ' shift center to the clicked pos
-                    center.x = center.x + SM.clickedAt.X * scale_m * metersToBBoxVertical(4326)
-                    center.y = center.y - SM.clickedAt.Y * scale_m * metersToBBoxVertical(4326)
+                    center.x = center.x + SM.clickedAt.X * scale_m * metersToBBoxHorizontal(srs, center)
+                    center.y = center.y - SM.clickedAt.Y * scale_m * metersToBBoxVertical(srs)
+                Case 99
+                    Me.minScale = scale_m * Math.Sqrt(2)
+                    scale_ll = scale_m
+                    scale_ul = Me.maxScale / Math.Sqrt(2)
+                Case 100
+                    If recScale Is Nothing Then
+                        recScale = New ArrayList
+                    End If
+                    recScale.Add(scale_m)
+                    scale_ll = Me.minScale / Math.Sqrt(2)
+                    scale_ul = Me.maxScale / Math.Sqrt(2)
+                Case 101
+                    Me.maxScale = scale_m * Math.Sqrt(2)
+                    scale_ul = scale_m
+                    scale_ll = Me.minScale / Math.Sqrt(2)
             End Select
 
         Loop Until SM.exitcode = 0
     End Sub
-    Private Function metersToBBoxVertical(ByVal epsg) As Double
+    Private Function metersToBBoxVertical(ByVal epsg As Integer) As Double
         If epsg = 4326 Then
             metersToBBoxVertical = 360 / (WGS84.a * Math.PI * 2)
         Else : metersToBBoxVertical = 1
         End If
     End Function
+    Private Function metersToBBoxHorizontal(ByVal epsg As Integer, ByRef center As point) As Double
+        If epsg = 4326 Then
+            metersToBBoxHorizontal = (360 / (WGS84.a * Math.PI * 2)) / Math.Cos(center.y / 180 * Math.PI)
+        Else : metersToBBoxHorizontal = 1
+        End If
+    End Function
     Private Function makeGetMapUrlFromBBox(ByVal bb As String) As String
         'http:// www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous
         '&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap
@@ -176,6 +214,11 @@
         For Each s As String In CheckedListBoxLayers.CheckedItems
             SelectedLayers += "," & s.Split("|")(0)
         Next
+        If SelectedLayers.Length = 0 Then
+            MsgBox("Mindestens 1 Layer muss ausgew?hlt werden")
+            Return ""
+        End If
+
         If SelectedLayers <> "" Then
             mapUrl += "&LAYERS=" & SelectedLayers.Substring(1).Replace(" ", "%20")
         End If
@@ -252,13 +295,16 @@
         makeGetMapUrl = mapUrl
     End Function
 
-    Private Function ToBBox(ByRef center As point, ByVal sizeBboxVertically As Double) As String
+    Private Function ToBBox(ByRef center As point, ByVal srs As Integer, ByVal meter As Double) As String
         Dim tl As point
         Dim br As point
-        tl.x = center.x - sizeBboxVertically / 2
-        tl.y = center.y + sizeBboxVertically / 2
-        br.x = center.x + sizeBboxVertically / 2
-        br.y = center.y - sizeBboxVertically / 2
+        Dim diff_v, diff_h As Double
+        diff_h = metersToBBoxHorizontal(srs, center) * meter
+        diff_v = metersToBBoxVertical(srs) * meter
+        tl.x = center.x - diff_h / 2
+        tl.y = center.y + diff_v / 2
+        br.x = center.x + diff_h / 2
+        br.y = center.y - diff_v / 2
         Dim BBox As String
         BBox = tl.x.ToString(DPunkt) + "," + br.y.ToString(DPunkt) + "," + br.x.ToString(DPunkt) + "," + tl.y.ToString(DPunkt)
         ToBBox = BBox
@@ -307,9 +353,18 @@
         F.WriteLine("BoundingBoxTopLeftWGS84: " & maxy & " " & minx)
         F.WriteLine("BoundingBoxButtomRightWGS84: " & miny & " " & maxx)
         F.WriteLine("#BBox_Mitte: " & mittey & " " & mittex)
-        F.WriteLine("MinScale:   0")
-        F.WriteLine("MaxScale:   45")
-        F.WriteLine("RecommendedScale:   5")
+        F.WriteLine("MinScale:   " & (Math.Ceiling(minScale * 10000) / 10000).ToString(DPunkt))
+        F.WriteLine("MaxScale:   " & (Math.Floor(maxScale * 10000) / 10000).ToString(DPunkt))
+        Dim recsscales As String = ""
+        If Not recScale Is Nothing Then
+            For Each d As Double In recScale
+                recsscales = recsscales & " " & (Math.Floor(d * 10000) / 10000).ToString(DPunkt)
+            Next
+            recsscales.Trim()
+        Else
+            recsscales = "5"
+        End If
+        F.WriteLine("RecommendedScale:   " & recsscales)
         'Me.ComboBoxFormat.SelectedItem.ToString.Split("/")(1)
         Dim rk As Microsoft.Win32.RegistryKey = My.Computer.Registry.ClassesRoot.OpenSubKey("Mime\Database\Content Type\" & Me.ComboBoxFormat.SelectedItem.ToString)
         Dim stmp As String = rk.GetValue("Extension")
@@ -640,7 +695,19 @@
                 End If
             End If
         Next
+        If Not OBBoxes.ContainsKey("EPSG:4326") Then
+            For Each n As XmlNode In Layer.GetElementsByTagName("LatLonBoundingBox")
+                If n.NodeType = XmlNodeType.Element Then
+                    Dim e As XmlElement = n
+                    Dim stmp As String = e.GetAttribute("SRS")
+                    If Not OBBoxes.ContainsKey(stmp) Then
+                        OBBoxes.Add("EPSG:4326", e)
+                    End If
+                End If
+            Next
+        End If
 
+        ButtonCheckAll_Click(Nothing, Nothing)
         Return True
 
     End Function



From araber95 at mail.berlios.de  Mon Oct  5 15:22:08 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 5 Oct 2009 15:22:08 +0200
Subject: [Cachewolf-svn] r2243 - trunk/src/CacheWolf
Message-ID: <200910051322.n95DM8cM011692@sheep.berlios.de>

Author: araber95
Date: 2009-10-05 15:22:07 +0200 (Mon, 05 Oct 2009)
New Revision: 2243

Modified:
   trunk/src/CacheWolf/ProfileDataForm.java
Log:
Preferences Setup for "get current centre from GPS" added.

Modified: trunk/src/CacheWolf/ProfileDataForm.java
===================================================================
--- trunk/src/CacheWolf/ProfileDataForm.java	2009-10-05 12:04:15 UTC (rev 2242)
+++ trunk/src/CacheWolf/ProfileDataForm.java	2009-10-05 13:22:07 UTC (rev 2243)
@@ -1,6 +1,8 @@
 package CacheWolf;
 
 import CacheWolf.navi.TransformCoordinates;
+import ewe.fx.Insets;
+import ewe.ui.CellConstants;
 import ewe.ui.CellPanel;
 import ewe.ui.ControlEvent;
 import ewe.ui.Event;
@@ -8,6 +10,7 @@
 import ewe.ui.FormBase;
 import ewe.ui.UIConstants;
 import ewe.ui.mButton;
+import ewe.ui.mCheckBox;
 import ewe.ui.mLabel;
 
 /**
@@ -16,7 +19,8 @@
 */
 public class ProfileDataForm extends Form {
 
-	private mButton btnOK, btnCurrentCentre, btnProfileCentre, btnCur2Prof, btnProf2Cur;
+	private mButton btnOK, btnCurrentCentre, btnProfileCentre, btnCur2Prof, btnProf2Cur;//, btnGPS2Cur;
+	mCheckBox chkSetCurrentCentreFromGPSPosition;
 	private Preferences pref;
 	private Profile profile;
 	private CellPanel content = new CellPanel();
@@ -31,6 +35,10 @@
 		content.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_RECT;
 	    //defaultTags.set(this.INSETS,new Insets(2,2,2,2));		
 		title = MyLocale.getMsg(1118,"Profile")+": "+profile.name;
+		content.addNext(new mLabel(MyLocale.getMsg(600,"Preferences")));		
+		content.addLast(chkSetCurrentCentreFromGPSPosition = new mCheckBox(MyLocale.getMsg(646,"centre from GPS")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		// content.addLast(btnGPS2Cur=new mButton("   v   "),DONTSTRETCH,DONTFILL|LEFT);
+		if (pref.setCurrentCentreFromGPSPosition) chkSetCurrentCentreFromGPSPosition.setState(true);		
 		content.addNext(new mLabel(MyLocale.getMsg(1116,"Current")));
 		content.addLast(btnCurrentCentre=new mButton(pref.curCentrePt.toString()),HSTRETCH,HFILL|LEFT);
 		content.addNext(new mLabel("      "),HSTRETCH,HFILL);
@@ -40,7 +48,7 @@
 		content.addNext(new mLabel(MyLocale.getMsg(1118,"Profile")));
 		content.addLast(btnProfileCentre=new mButton(profile.centre.toString()),HSTRETCH,HFILL|LEFT);
 		addLast(content,HSTRETCH,HFILL);
-		addLast(new mLabel(""),VSTRETCH,FILL);
+		//addLast(new mLabel(""),VSTRETCH,FILL);
 		//addNext(btnCancel = new mButton(MyLocale.getMsg(1604,"Cancel")),DONTSTRETCH,DONTFILL|LEFT);
 		addLast(btnOK = new mButton("OK"),DONTSTRETCH,HFILL|RIGHT);
 	}
@@ -56,6 +64,7 @@
 				close(-1);
 			}*/
 			if (ev.target == btnOK){
+				pref.setCurrentCentreFromGPSPosition=chkSetCurrentCentreFromGPSPosition.getState();
 				close(1);
 			}
 			if (ev.target == btnCurrentCentre){



From pfeffer at mail.berlios.de  Mon Oct  5 19:39:26 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 5 Oct 2009 19:39:26 +0200
Subject: [Cachewolf-svn] r2244 - trunk/src/CacheWolf/navi
Message-ID: <200910051739.n95HdQfo006929@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-05 19:39:23 +0200 (Mon, 05 Oct 2009)
New Revision: 2244

Modified:
   trunk/src/CacheWolf/navi/ProjectedPoint.java
Log:
ParjectedPoint: made considerably faster: profiling (using jip)  showed that a routine I considered to be static was not static

Modified: trunk/src/CacheWolf/navi/ProjectedPoint.java
===================================================================
--- trunk/src/CacheWolf/navi/ProjectedPoint.java	2009-10-05 13:22:07 UTC (rev 2243)
+++ trunk/src/CacheWolf/navi/ProjectedPoint.java	2009-10-05 17:39:23 UTC (rev 2244)
@@ -8,7 +8,7 @@
 	public static final LambertProjection PJ_AUSTRIAN_LAMBERT_NEW 	= new LambertProjection(TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_NEW,  TransformCoordinates.WGS84);
 	public static final LambertProjection PJ_FRENCH_LAMBERT_NTF_II 	= new LambertProjection(TransformCoordinates.EPSG_FRENCH_LAMBERT_NTF_II, TransformCoordinates.CLARKE1880IGN);
 	public static final LambertProjection PJ_TEST 	                = new LambertProjection(TransformCoordinates.EPSG_TEST, TransformCoordinates.CLARKE1866); 
-	{ 
+	static { 
 		PJ_AUSTRIAN_LAMBERT_OLD.setup ( 400000, 400000, 49.0, 46.0, 1         , 47.5, 13.333333); // actually this should be done inside the constructor. But Ewe doesn't support more than 8 parameters (at least for constructors)
 		PJ_AUSTRIAN_LAMBERT_NEW.setup ( 400000, 400000, 49.0, 46.0, 1         , 47.5, 13.333333);
 		PJ_FRENCH_LAMBERT_NTF_II.setup(2200000, 600000, 46.8, 46.8, 0.99987742, 46.8, 2.337229172 /*(2+20/60+14.025/3600) */); 



From araber95 at mail.berlios.de  Tue Oct  6 14:53:50 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 6 Oct 2009 14:53:50 +0200
Subject: [Cachewolf-svn] r2245 - in trunk: res_noewe/languages src/CacheWolf
	src/CacheWolf/navi
Message-ID: <200910061253.n96Crowo004103@sheep.berlios.de>

Author: araber95
Date: 2009-10-06 14:53:45 +0200 (Tue, 06 Oct 2009)
New Revision: 2245

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
changed switch from "showing no caches" to "showing marked caches". (someone should check NL PL and FR translation)

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-05 17:39:23 UTC (rev 2244)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-06 12:53:45 UTC (rev 2245)
@@ -703,7 +703,7 @@
 		4266=Weisse Fl%e4chen f%fcllen
 		4267=Weisse Fl%e4chen anzeigen
 		4268=Alle Cache anzeigen
-		4269=Keine Cache anzeigen
+		4269=markierte Cache anzeigen
 		4270=%d6ffne
 		4271=Karten
 		4272=--- Karten von akt. Position und Ziel ---

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-05 17:39:23 UTC (rev 2244)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-06 12:53:45 UTC (rev 2245)
@@ -692,7 +692,7 @@
 		4266=Fill white areas
 		4267=Show white areas
 		4268=Show all caches
-		4269=Don't show caches
+		4269=Show marked caches
 		4270=Open
 		4271=--- Maps containing GPS and goto pos. ---
 		4273=--- Maps containing curr. position ---

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-05 17:39:23 UTC (rev 2244)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-06 12:53:45 UTC (rev 2245)
@@ -690,7 +690,7 @@
 		4266=[Fill white areas]
 		4267=[Show white areas]
 		4268=voir toutes les caches
-		4269=ne pas voir des caches
+		4269=voir marqu?s caches
 		4270=Ouvre
 		4271=Cartes
 		4272=--- Cartes de la pos. actuelle et de la dest. ---

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-05 17:39:23 UTC (rev 2244)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-06 12:53:45 UTC (rev 2245)
@@ -558,7 +558,7 @@
 		4266=[Fill white areas]
 		4267=[Show white areas]
 		4268=Bekijk alle cache
-		4269=Geen Cache bekijke
+		4269=Bekijk gemarkeerd cache
 		4280=[Small Tiles]
 		4281=[Medium Tiles]
 		4282=[Big Tiles]

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-05 17:39:23 UTC (rev 2244)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-06 12:53:45 UTC (rev 2245)
@@ -689,8 +689,8 @@
                 4265=Srodek mapy
                 4266=Wypelnij biale obszary
                 4267=Pokaz biale obszary
-		4268=Zobacz wszystkie pamieci podrecznej
-		4269=Nie pokazuj buforuje
+		4268=[Alle Cache anzeigen]
+		4269=[markierte Cache anzeigen]
                 4270=Otworz
                 4271=--- Mapy zawierajace GPS i pozycje IdzDo. ---
                 4273=--- Mapy zawierajace akt. pozycje ---

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2009-10-05 17:39:23 UTC (rev 2244)
+++ trunk/src/CacheWolf/MainTab.java	2009-10-06 12:53:45 UTC (rev 2245)
@@ -355,8 +355,7 @@
 				nav.setMovingMap(mm);
 			}
 			if (forceCenter) mm.setGpsStatus(MovingMap.noGPS); // disconnect movingMap from GPS TODO only if GPS-pos is not on the screen
-			mm.updatePosition(centerTo);
-			mm.myExec();
+			mm.myExec(centerTo);
 			if (forceCenter) {
 				try {
 					int i = 0;

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-05 17:39:23 UTC (rev 2244)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-06 12:53:45 UTC (rev 2245)
@@ -31,6 +31,7 @@
 	public final static int ignoreGPS = -1; // ignore even changes in GPS-signal (eg. from lost fix to gotFix) this is wanted when the map is moved manually
 
 	public MapSymbol gotoPos = null;
+	CacheHolder markedCache = null;
 	public int GpsStatus;
 	Preferences pref;
 	MovingMapPanel mmp;
@@ -115,9 +116,8 @@
 			pref.showCachesOnMap=value;
 		}
 		if (!value) {
-			// todo: add : goto Cache Symbol, Selected Symbol , Selected Cache Symbol
-			this.removeAllMapSymbolsButGoto();
-			}
+			removeAllMapSymbols();
+		}
 
 	}
 
@@ -410,37 +410,37 @@
 		updatePosition(posCircle.where); // this sets forceMapLoad to false after loading a map
 	}
 
-	public final FormFrame myExec() {
+	public final FormFrame myExec(CWPoint centerTo) {
+		FormFrame ret = exec();
+		running = true;
+
+		// to load maplist + place a map on screen otherwise no symbol can be placed
+		updatePosition(centerTo); 
+		
 		// update cache symbols in map
-		running = true;
-		MainTab mainT = Global.mainTab;
 		if (Global.getProfile().selectionChanged) {
+			// this means marking has changed
 			Global.getProfile().selectionChanged = false;
-			removeAllMapSymbolsButGoto();
-			CacheHolder ch;
-			for (int i=cacheDB.size()-1; i>=0; i--) {
-				ch = cacheDB.get(i);
-				if (ch.is_Checked && ch.isVisible() && ch != mainT.ch) {
-					if (ch.pos.isValid()) addSymbol(ch.getCacheName(), ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
-				}
-			}
+			if (getShowCachesOnMap()) removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap			
 		}
-		setMarkedCache(mainT.ch);
+		setMarkedCache(Global.mainTab.ch); // this is the selected one (not necessary marked)
+		showCachesOnMap();
+		
 		addTrack(myNavigation.curTrack);
 		if (tracks != null && tracks.size() > 0 && ((Track)tracks.get(0)).num > 0)
 			rebuildOverlaySet(); // show points which where added when MavingMap was not running
+
 		if (myNavigation.destinationIsCache) {
 			destChanged(myNavigation.destinationCache);
 		}
 		else {
 			destChanged(myNavigation.destination);
 		}
-
-		FormFrame ret = exec();
+		
+		repaint();
 		return ret;
 	}
 
-	CacheHolder markedCache = null;
 	public void setMarkedCache(CacheHolder ch) {
 		if (ch == markedCache) return;
 		if (markedCache != null) {
@@ -871,7 +871,11 @@
 	public void addSymbolIfNecessary(String pName, Object mapObject, Image imSymb, CWPoint where) {
 		if (findMapSymbol(pName) >= 0) return;
 		else addSymbol(pName, mapObject, imSymb, where);
+	}
 
+	public void addSymbolOnTop(String pName, Object mapObject, String filename, CWPoint where) {
+		removeMapSymbol(pName); // Object possibly removes another picture from screen
+		addSymbol(pName,mapObject,filename, where);
 	}
 
 	public void addSymbol(String pName, Object mapObject, Image imSymb, CWPoint ll) {
@@ -887,7 +891,7 @@
 	public void destChanged(CWPoint d) {
 		if(!running || (d == null && gotoPos == null) ||
 				(d != null && gotoPos != null && gotoPos.where.equals(d))) return;
-		removeGotoPosition();
+		removeMapSymbol("goto");
 		if (d == null || !d.isValid() ) return;
 		gotoPos = addSymbol("goto", "goto_map.png", d);
 		//updateDistance(); - this is called from updatePosition
@@ -898,7 +902,7 @@
 	public void destChanged(CacheHolder ch) {
 		CWPoint d = new CWPoint (ch.pos);
 		if(!running || (gotoPos != null && gotoPos.where.equals(d))) return;
-		removeGotoPosition();
+		removeMapSymbol("goto");
 		if (!d.isValid() ) return;
 		gotoPos = addSymbol("goto", ch, "goto_map.png", d);
 		//updateDistance(); - this is called from updatePosition
@@ -906,25 +910,17 @@
 		if (this.width != 0) updatePosition(posCircle.where); // dirty hack: if this.width == 0, then the symbols are not on the screen and get hidden by updateSymbolPositions
 	}
 
-	public void removeGotoPosition() {
-		removeMapSymbol("goto");
-	}
-
 	public CWPoint getGotoPos(){
 		if (gotoPos == null) return null;
 		return new CWPoint(gotoPos.where);
 	}
 
-	public void removeAllMapSymbolsButGoto(){
+	public void removeAllMapSymbols(){
 		if (symbols == null) return;
 		for (int i = symbols.size()-1; i >= 0; i--) {
 			mmp.removeImage((MapSymbol)symbols.get(i));
 		}
 		symbols.removeAllElements();
-		if (gotoPos != null) {
-			symbols.add(gotoPos);
-			mmp.addImage(gotoPos);
-		}
 	}
 
 	public void removeMapSymbol(String pName) {
@@ -1004,6 +1000,7 @@
 			forceMapLoad = false;
 			return;
 		}
+		if (width==0 || height==0) { Vm.debug("no window shown"); return; } // why is this called with these values
 		updateOnlyPosition(where, true);
 
 		Point mapPos = getMapPositionOnScreen();
@@ -1022,23 +1019,7 @@
 					setBestMap(where, screenNotCompletlyCovered);
 					forceMapLoad = false;
 				}
-				if (getShowCachesOnMap()) {
-					CacheHolder ch;
-					int twidth = width/10;
-					int theight = height/10;
-					Area screenArea = new Area(ScreenXY2LatLon(-twidth,-theight), ScreenXY2LatLon(width+twidth,height+theight));
-					for (int i = cacheDB.size() - 1; i >= 0; i--) {
-						ch = cacheDB.get(i);
-						if (screenArea.isInBound(ch.pos)) {
-							// because visible and valid don't change while showing map -->need no remove
-							if (ch.isVisible() && ch.pos.isValid()) {
-								addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
-							}
-						}else{
-							removeMapSymbol(ch.cacheName);
-						}
-					}
-				}
+				showCachesOnMap();
 				if (isFillWhiteArea()) {
 					// Clean up any additional images, tiles will removed and any
 					// other item be added again later
@@ -1121,8 +1102,64 @@
 		lastYPos = mapPos.y;
 		lastWidth = width;
 		lastHeight = height;
+		repaint();
 	}
 
+	private void showCachesOnMap() {
+		// if (width == 0 || height == 0) return;
+		CacheHolder ch;
+		int twidth = width/10;
+		int theight = height/10;
+		Area screenArea = new Area(ScreenXY2LatLon(-twidth,-theight), ScreenXY2LatLon(width+twidth,height+theight));
+		for (int i = cacheDB.size() - 1; i >= 0; i--) {
+			ch = cacheDB.get(i);
+			if (screenArea.isInBound(ch.pos)) {
+				// because visible and valid don't change while showing map -->need no remove
+				if (ch.isVisible() && ch.pos.isValid()) {
+					if (getShowCachesOnMap()) {
+						addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
+					}
+					else {
+						if (ch.is_Checked) {
+							addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
+						}
+						else {
+							removeMapSymbol(ch);
+						}
+					}
+				}
+			}else{
+				if (ch.cacheName.equals("")) {
+					removeMapSymbol(ch);
+				}
+				else {
+					// remove the right one , as
+					// possibly more than one picture associated with ch (target,selected ..)
+					removeMapSymbol(ch.cacheName); 
+				}
+			}
+		}
+		// adding target and selected 
+		// show target
+		if (gotoPos != null) {
+			// the CacheHolder Symbol must be inserted too, even if not marked (if it is Cache)
+			// anywhere there if all Caches shown on map 
+			CacheHolder gotoPosCH = null;
+			if (gotoPos.mapObject instanceof CacheHolder) {
+				gotoPosCH = (CacheHolder) gotoPos.mapObject;				
+			}
+			if (!getShowCachesOnMap() && (gotoPosCH != null)) {
+				addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType()), gotoPosCH.pos);
+			}
+			addSymbolOnTop("goto", gotoPosCH, "goto_map.png", gotoPos.where);
+		}
+		// show Selected
+		if (markedCache != null) {
+			addSymbolIfNecessary(markedCache.cacheName, markedCache, GuiImageBroker.getTypeImage(markedCache.getType()), markedCache.pos);
+			addSymbolOnTop("selectedCache", markedCache, MARK_CACHE_IMAGE, markedCache.pos);
+		}
+	}
+
 	private void updateTileForWhiteArea(Vector rectangles) {
 		Rect blackArea;
 		Rect r = (Rect) rectangles.get(0);
@@ -2182,15 +2219,17 @@
 				kontextMenu.addItem(newWayPointMenuItem);
 				AniImage clickedOnImage = images.findHotImage(p);
 				if (clickedOnImage != null && clickedOnImage instanceof MapSymbol) {
-					clickedCache = ((CacheHolder)((MapSymbol)clickedOnImage).mapObject);
-					if (clickedCache != null) {
-						openCacheDescMenuItem = new MenuItem(MyLocale.getMsg(4270, "Open")+" '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
-						kontextMenu.addItem(openCacheDescMenuItem);
-						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto")+ " '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$g"); // clickedCache == null can happen if clicked on the goto-symbol
-						kontextMenu.addItem(gotoCacheMenuItem);
-						if (Global.mainForm.cacheListVisible) {
-							addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
-							kontextMenu.addItem(addCachetoListMenuItem);
+					if ( ((MapSymbol)clickedOnImage).mapObject instanceof CacheHolder) {
+						clickedCache = (CacheHolder)( ((MapSymbol)clickedOnImage).mapObject);
+						if (clickedCache != null) {
+							openCacheDescMenuItem = new MenuItem(MyLocale.getMsg(4270, "Open")+" '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
+							kontextMenu.addItem(openCacheDescMenuItem);
+							gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto")+ " '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$g"); // clickedCache == null can happen if clicked on the goto-symbol
+							kontextMenu.addItem(gotoCacheMenuItem);
+							if (Global.mainForm.cacheListVisible) {
+								addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
+								kontextMenu.addItem(addCachetoListMenuItem);
+							}
 						}
 					}
 				}



From araber95 at mail.berlios.de  Tue Oct  6 21:01:47 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 6 Oct 2009 21:01:47 +0200
Subject: [Cachewolf-svn] r2246 - trunk/src/CacheWolf/navi
Message-ID: <200910061901.n96J1l7U025363@sheep.berlios.de>

Author: araber95
Date: 2009-10-06 21:01:45 +0200 (Tue, 06 Oct 2009)
New Revision: 2246

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Fill white areas when changing to more detailed or more overview

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-06 12:53:45 UTC (rev 2245)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-06 19:01:45 UTC (rev 2246)
@@ -1021,60 +1021,7 @@
 				}
 				showCachesOnMap();
 				if (isFillWhiteArea()) {
-					// Clean up any additional images, tiles will removed and any
-					// other item be added again later
-					Vector icons = new Vector();
-					for (Iterator i = mmp.images.iterator(); i.hasNext();) {
-						AniImage im = (AniImage) i.next();
-						if ((im instanceof MapImage)
-								&& (!((im instanceof MapSymbol)
-										|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
-							i.remove();
-						} else {
-							icons.add(im);
-							i.remove();
-						}
-					}
-					// Mark all tiles as dirty
-					MovingMapCache.getCache().clearUsedFlags();
-
-					// Holds areas not filled by currentmap and/or used tiles
-					Vector rectangles = new Vector();
-					// calculate areas which will not drawn
-					Point mapPosx = getMapPositionOnScreen();
-					if ( screenNotCompletlyCovered && ( // screen not completely covered is only used, because it is already calculated
-							mapPosx.x > this.width || mapPosx.y > this.height // map doesn't overlap with the screen
-							|| mapPosx.x + mmp.mapImage.getWidth() < 0 || mapPosx.y + mmp.mapImage.getHeight() < 0) ) {
-						rectangles.add(new Rect(0,0, this.width, this.height)); // if the map is completely outside the screen, just fill the screen, nit all the space beteween the map and the screen
-					} else {
-						Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
-						Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
-						calculateRectangles(blackArea, whiteArea, rectangles);
-					}
-					// I've sometimes experienced an endless loop which might be
-					// caused by a bug in getBestMap. Therefore i will stop the loop
-					// after 30 runs
-					int count = 0;
-					while (isFillWhiteArea() && currentMap.zoomFactor == 1.0
-							&& !mapHidden && !rectangles.isEmpty() && count < 30) {
-						count++;
-						try {
-							updateTileForWhiteArea(rectangles);
-						} catch (ewe.sys.SystemResourceException sre) {
-							setFillWhiteArea(false);
-							(new MessageBox(
-									"Error",
-									"Not enough ressources to fill white ares, disabling this",
-									MessageBox.OKB)).execute();
-						}
-					}
-					// Remove all tiles not needed from the cache to reduce memory
-					MovingMapCache.getCache().cleanCache();
-					// At Last redraw all icons on the map
-					for (Iterator i = icons.iterator(); i.hasNext();) {
-						AniImage im = (AniImage) i.next();
-						mmp.addImage(im);
-					}
+					fillWhiteArea(screenNotCompletlyCovered);
 				}
 				lastCompareX = mapPos.x;
 				lastCompareY = mapPos.y;
@@ -1096,13 +1043,13 @@
 						im.setLocation(p.x, p.y);
 					}
 				}
+				repaint();
 			}
 		}
 		lastXPos = mapPos.x;
 		lastYPos = mapPos.y;
 		lastWidth = width;
 		lastHeight = height;
-		repaint();
 	}
 
 	private void showCachesOnMap() {
@@ -1160,6 +1107,63 @@
 		}
 	}
 
+	private void fillWhiteArea(boolean screenNotCompletlyCovered) {
+		// Clean up any additional images, tiles will removed and any
+		// other item be added again later
+		Vector icons = new Vector();
+		for (Iterator i = mmp.images.iterator(); i.hasNext();) {
+			AniImage im = (AniImage) i.next();
+			if ((im instanceof MapImage)
+					&& (!((im instanceof MapSymbol)
+							|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
+				i.remove();
+			} else {
+				icons.add(im);
+				i.remove();
+			}
+		}
+		// Mark all tiles as dirty
+		MovingMapCache.getCache().clearUsedFlags();
+
+		// Holds areas not filled by currentmap and/or used tiles
+		Vector rectangles = new Vector();
+		// calculate areas which will not drawn
+		Point mapPosx = getMapPositionOnScreen();
+		if ( screenNotCompletlyCovered && ( // screen not completely covered is only used, because it is already calculated
+				mapPosx.x > this.width || mapPosx.y > this.height // map doesn't overlap with the screen
+				|| mapPosx.x + mmp.mapImage.getWidth() < 0 || mapPosx.y + mmp.mapImage.getHeight() < 0) ) {
+			rectangles.add(new Rect(0,0, this.width, this.height)); // if the map is completely outside the screen, just fill the screen, nit all the space beteween the map and the screen
+		} else {
+			Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
+			Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
+			calculateRectangles(blackArea, whiteArea, rectangles);
+		}
+		// I've sometimes experienced an endless loop which might be
+		// caused by a bug in getBestMap. Therefore i will stop the loop
+		// after 30 runs
+		int count = 0;
+		while (isFillWhiteArea() && currentMap.zoomFactor == 1.0
+				&& !mapHidden && !rectangles.isEmpty() && count < 30) {
+			count++;
+			try {
+				updateTileForWhiteArea(rectangles);
+			} catch (ewe.sys.SystemResourceException sre) {
+				setFillWhiteArea(false);
+				(new MessageBox(
+						"Error",
+						"Not enough ressources to fill white ares, disabling this",
+						MessageBox.OKB)).execute();
+			}
+		}
+		// Remove all tiles not needed from the cache to reduce memory
+		MovingMapCache.getCache().cleanCache();
+		// At Last redraw all icons on the map
+		for (Iterator i = icons.iterator(); i.hasNext();) {
+			AniImage im = (AniImage) i.next();
+			mmp.addImage(im);
+		}
+		repaint();
+	}
 	private void updateTileForWhiteArea(Vector rectangles) {
 		Rect blackArea;
 		Rect r = (Rect) rectangles.get(0);
@@ -1483,7 +1487,9 @@
 		if (mapChangeModus == modus) return;
 		mapChangeModus = modus;
 		lastHighestResolutionGPSDestScale = -1;
-		if (modus != NORMAL_KEEP_RESOLUTION) setBestMap(posCircle.where, true);
+		if (modus != NORMAL_KEEP_RESOLUTION) {
+			setBestMap(posCircle.where, true);
+		}
 	}
 	/**
 	 * method to get a point on the screen which must be included in the map
@@ -1541,6 +1547,9 @@
 			dontUpdatePos = true;
 			setMap(m, cll);
 			setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
+			if (isFillWhiteArea()) {
+				fillWhiteArea(true);
+			}
 			dontUpdatePos = saveGpsIgnStatus;
 		}
 		else (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4211, "No ") +



From pfeffer at mail.berlios.de  Tue Oct  6 22:21:28 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 6 Oct 2009 22:21:28 +0200
Subject: [Cachewolf-svn] r2247 - trunk/src/CacheWolf/navi
Message-ID: <200910062021.n96KLSZo000378@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-06 22:21:27 +0200 (Tue, 06 Oct 2009)
New Revision: 2247

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: small optimisations for better performance (don't use Iterator, because it means an unnecessary object creation)

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-06 19:01:45 UTC (rev 2246)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-06 20:21:27 UTC (rev 2247)
@@ -17,7 +17,6 @@
 import ewe.filechooser.FileChooser;
 import ewe.filechooser.FileChooserBase;
 import ewe.fx.*;
-import ewe.util.Iterator;
 import ewe.util.Vector;
 
 /**
@@ -237,7 +236,7 @@
 			for (int i = symbols.size() -1; i >= 0; i-- ) {
 				((MapSymbol)symbols.get(i)).screenDimChanged();
 			}
-}
+		}
 	}
 
 	boolean loadingMapList = false;
@@ -1029,8 +1028,8 @@
 			else{
 				int deltaX = mapPos.x - lastXPos;
 				int deltaY = mapPos.y - lastYPos;
-				for(Iterator i =mmp.images.iterator(); i.hasNext ();){
-					AniImage im = (AniImage) i.next();
+				for(int i = mmp.images.size() -1; i >= 0; i--){
+					AniImage im = (AniImage) mmp.images.get(i);
 					if ((im instanceof MapImage)
 						&& (!((im instanceof MapSymbol)
 							|| (im instanceof TrackOverlay)
@@ -1110,18 +1109,18 @@
 	private void fillWhiteArea(boolean screenNotCompletlyCovered) {
 		// Clean up any additional images, tiles will removed and any
 		// other item be added again later
-		Vector icons = new Vector();
-		for (Iterator i = mmp.images.iterator(); i.hasNext();) {
-			AniImage im = (AniImage) i.next();
-			if ((im instanceof MapImage)
-					&& (!((im instanceof MapSymbol)
-							|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
-				i.remove();
-			} else {
+		Vector icons = new Vector(mmp.images.size());
+		int s = mmp.images.size(); // avoid calling size() in each iteration
+		for (int i = 0; i < s ;  i++) {
+			AniImage im = (AniImage) mmp.images.get(i);
+			if (!(im instanceof MapImage) ||
+				(im instanceof MapSymbol) ||
+				(im instanceof TrackOverlay) || 
+				mmp.mapImage == im) {
 				icons.add(im);
-				i.remove();
 			}
 		}
+		mmp.images.clear();
 		// Mark all tiles as dirty
 		MovingMapCache.getCache().clearUsedFlags();
 
@@ -1158,10 +1157,7 @@
 		// Remove all tiles not needed from the cache to reduce memory
 		MovingMapCache.getCache().cleanCache();
 		// At Last redraw all icons on the map
-		for (Iterator i = icons.iterator(); i.hasNext();) {
-			AniImage im = (AniImage) i.next();
-			mmp.addImage(im);
-		}
+		mmp.images.addAll(icons);
 		repaint();
 	}
 	private void updateTileForWhiteArea(Vector rectangles) {
@@ -1244,8 +1240,8 @@
 				if (im != null) {
 					//Check if not already added. this might happen if the map for horizontal and vertical stripe is the same
 					boolean added=false;
-					for(Iterator i=mmp.images.iterator(); i.hasNext();){
-						MapImage m=(MapImage) i.next();
+					for(int i=mmp.images.size()-1; i >= 0; i--) {
+						MapImage m=(MapImage) mmp.images.get(i);
 						if (m == im){
 							added=true;
 							break;



From pfeffer at mail.berlios.de  Wed Oct  7 14:43:24 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 7 Oct 2009 14:43:24 +0200
Subject: [Cachewolf-svn] r2248 - trunk/src/CacheWolf
Message-ID: <200910071243.n97ChOIw020107@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-07 14:43:22 +0200 (Wed, 07 Oct 2009)
New Revision: 2248

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
Log:
CacheHolderDetail: making reading the <cache>.xml more robust against data inconsitencies

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-10-06 20:21:27 UTC (rev 2247)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-10-07 12:43:22 UTC (rev 2248)
@@ -260,6 +260,10 @@
 			dummy = ex.findNext();
 			int imgNr = 0;
 			while(ex.endOfSearch() == false){
+				if (imgNr >= this.images.size()) {
+					images.add(new ImageInfo()); // this (more IMGTEXT than IMG in the <cache>.xml, but it happens. So avoid an ArrayIndexOutOfBoundException and add an ImageInfo gracefully
+					Global.getPref().log("Error reading " + this.getParent().getWayPoint() + "More IMGTEXT tags than IMG tags");
+				}
 				imageInfo = this.images.get(imgNr);
 				int pos=dummy.indexOf("<DESC>");
 				if (pos>0) {



From araber95 at mail.berlios.de  Wed Oct  7 20:43:35 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 7 Oct 2009 20:43:35 +0200
Subject: [Cachewolf-svn] r2249 - trunk/src/CacheWolf
Message-ID: <200910071843.n97IhZdS031145@sheep.berlios.de>

Author: araber95
Date: 2009-10-07 20:43:30 +0200 (Wed, 07 Oct 2009)
New Revision: 2249

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
correction for found handling on mainCache, Final and otherAddis

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-10-07 12:43:22 UTC (rev 2248)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-10-07 18:43:30 UTC (rev 2249)
@@ -615,13 +615,25 @@
 	public void setAttributesFromMainCache(){
 		CacheHolder mainCh = this.mainCache;
 		this.setCacheOwner(mainCh.getCacheOwner());
-		this.setCacheStatus(mainCh.getCacheStatus());
+		if (mainCh.is_found()) {
+			if (!this.found) {
+				this.setCacheStatus(mainCh.getCacheStatus());
+				this.setFound(true);
+			}
+			// else addi is already found (perhaps at other time) 
+		}
+		else {
+			// there may be a found addi , so don't overwrite
+			if ((this.getType() == CacheType.CW_TYPE_FINAL)) {
+				this.setCacheStatus(mainCh.getCacheStatus());
+				this.setFound(false);
+			}
+		}
 		this.setArchived(mainCh.is_archived());
 		this.setAvailable(mainCh.is_available());
 		this.setBlack(mainCh.is_black());
 		this.setOwned(mainCh.is_owned());
 		this.setNew(mainCh.is_new());
-		this.setFound(mainCh.is_found());
 	}
 
 	public void setAttributesToAddiWpts(){
@@ -1093,9 +1105,16 @@
     }
 
 	public void setCacheStatus(String cacheStatus) {
-		Global.getProfile().notifyUnsavedChanges(!cacheStatus.equals(this.cacheStatus));		
-    	this.cacheStatus = cacheStatus;
-    }
+        if (!cacheStatus.equals(this.cacheStatus)) {
+        	this.cacheStatus = cacheStatus;
+            Global.getProfile().notifyUnsavedChanges(true);		
+            this.cacheStatus = cacheStatus;
+            if ((this.getType() == CacheType.CW_TYPE_FINAL) && (this.mainCache != null) ) {
+              this.mainCache.setCacheStatus(this.getCacheStatus());
+              // change the addi's in setFound
+            }
+        }
+	}
 
 	public String getWayPoint() {
     	return wayPoint;
@@ -1214,9 +1233,11 @@
     if (is_found != this.found) {
       Global.getProfile().notifyUnsavedChanges(true);		
       this.found = is_found;
-      if (is_found && (this.getType() == CacheType.CW_TYPE_FINAL) && (this.mainCache != null) ) {
-        this.mainCache.setFound(true);
-        this.mainCache.setAttributesToAddiWpts();
+      if ((this.getType() == CacheType.CW_TYPE_FINAL) && (this.mainCache != null) ) {
+        this.mainCache.setFound(is_found);
+		// done in setCacheStatus this.mainCache.setCacheStatus(this.getCacheStatus());
+        // so setFound should be called after setCacheStatus 
+        if (is_found) this.mainCache.setAttributesToAddiWpts();
       }
     }
   }



From araber95 at mail.berlios.de  Thu Oct  8 00:54:42 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 8 Oct 2009 00:54:42 +0200
Subject: [Cachewolf-svn] r2250 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200910072254.n97MsgAV003327@sheep.berlios.de>

Author: araber95
Date: 2009-10-08 00:54:28 +0200 (Thu, 08 Oct 2009)
New Revision: 2250

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/myTableModel.java
Log:
preferences for "debug mode" and "Sorting grouped by main caches". (effects all sorting, not only distance)

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-07 22:54:28 UTC (rev 2250)
@@ -243,6 +243,8 @@
 		644=Wegpunkt
 		645=Name
 		646=akt. Zentrum aus GPS
+		647=Sortierung nach Cache gruppiert
+		648=Fehlersuch Modus (debug)
 		700=Filter setzen
 		701=Entfernung
 		702=Schwierigkeit

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-07 22:54:28 UTC (rev 2250)
@@ -243,6 +243,8 @@
 		644=waypoint
 		645=name
 		646=cur.centre from GPS
+		647=cachegrouped sorting
+		648=Debug Mode
 		700=Set filter
 		701=Distance
 		702=Difficulty

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-07 22:54:28 UTC (rev 2250)
@@ -240,6 +240,8 @@
 		644=waypoint
 		645=nom
 		646=Centre actuel du GPS
+		647=[cachegrouped sorting]
+		648=[Debug Mode]
 		700=Cr%e9er filtre
 		701=Distance
 		702=Dificult%e9

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-07 22:54:28 UTC (rev 2250)
@@ -227,7 +227,9 @@
 		643=Cache details in:
 		644=waypoint
 		645=name
-		646=cur.centre from GPS
+		646=[cur.centre from GPS]
+		647=[cachegrouped sorting]
+		648=[Debug Mode]
 		700=Selecteer filter
 		701=Afstand
 		702=Moeilijkheidsgraad

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-07 22:54:28 UTC (rev 2250)
@@ -242,7 +242,9 @@
                 643=Szczegoly skrzynki:
                 644=waypoint
                 645=nazwa
-		646=cur.centre from GPS
+		646=[cur.centre from GPS]
+		647=[cachegrouped sorting]
+		648=[Debug Mode]
                 700=Ustaw filtr
                 701=Odleglosc
                 702=Trudnosc

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-07 22:54:28 UTC (rev 2250)
@@ -256,6 +256,9 @@
     /** ShowCachesOnMap */
     public boolean showCachesOnMap=true;
 
+    /** SortingGroupedByCache */
+    public boolean SortingGroupedByCache=true;
+
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
 	 * the line: <pre><debug value="true" /></pre>
@@ -573,6 +576,10 @@
 			tmp = atts.getValue("on");
 			showCachesOnMap = tmp != null && tmp.equalsIgnoreCase("true");
 		}
+		else if (name.equals("SortingGroupedByCache")){
+			tmp = atts.getValue("on");
+			SortingGroupedByCache = tmp != null && tmp.equalsIgnoreCase("true");
+		}
 	}
 
 	public void characters( char ch[], int start, int length ) {
@@ -661,6 +668,7 @@
 			outp.print("    <fillWhiteArea on=\""+SafeXML.strxmlencode(fillWhiteArea)+"\"/>\n");
 			outp.print("    <mapLoader tileSize=\""+SafeXML.strxmlencode(mapTileSize)+"\" overlapping=\""+SafeXML.strxmlencode(mapOverlapping)+"\"/>\n");
 			outp.print("    <showCachesOnMap on=\""+SafeXML.strxmlencode(showCachesOnMap)+"\"/>\n");
+			outp.print("    <SortingGroupedByCache on=\""+SafeXML.strxmlencode(SortingGroupedByCache)+"\"/>\n");
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2009-10-07 22:54:28 UTC (rev 2250)
@@ -21,7 +21,8 @@
 	mInput DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, 
 	       inpLogsPerPage,inpMaxLogsToSpider,inpPassword;
 	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus,chkHasCloseButton,
-	          chkSynthShort,chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName, chkSetCurrentCentreFromGPSPosition;
+	          chkSynthShort,chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName, 
+	          chkSetCurrentCentreFromGPSPosition,chkSortingGroupedByCache,chkDebug;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
 	mLabel lblGarmin;
@@ -225,6 +226,11 @@
 		pnlMore.addNext(new mLabel(MyLocale.getMsg(588, "Length units")),DONTSTRETCH,DONTFILL|WEST);
 		int currMetrik = pref.metricSystem == Metrics.METRIC ? 0 : 1;
 		pnlMore.addLast(inpMetric=new mChoice(metriken, currMetrik),DONTSTRETCH,DONTFILL|WEST);
+		pnlMore.addLast(chkSortingGroupedByCache=new mCheckBox(MyLocale.getMsg(647,"Sorting grouped by Cache")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));	
+		chkSortingGroupedByCache.setState(pref.SortingGroupedByCache);
+		pnlMore.addLast(chkDebug=new mCheckBox(MyLocale.getMsg(648,"Debug Mode")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));	
+		chkDebug.setState(pref.debug);
+
 		/////////////////////////////////////////////////////////
 		// Fourth/Fifth panel - Listview and Travelbugs
 		/////////////////////////////////////////////////////////
@@ -329,6 +335,8 @@
 				pref.spiderUpdates = inpSpiderUpdates.getInt();
 				pref.addDetailsToWaypoint = chkAddDetailsToWaypoint.getState();
 				pref.addDetailsToName = chkAddDetailsToName.getState();
+				pref.SortingGroupedByCache=chkSortingGroupedByCache.getState();
+				pref.debug=chkDebug.getState();
 
 				pref.savePreferences();
 				pref.dirty = true; // Need to update table in case columns were enabled/disabled

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-10-07 18:43:30 UTC (rev 2249)
+++ trunk/src/CacheWolf/myTableModel.java	2009-10-07 22:54:28 UTC (rev 2250)
@@ -164,27 +164,32 @@
 			if (!ch.isVisible()) {
 				notVisibleDB.add(ch);
 			} else { // point is not filtered
-				if (ch.isAddiWpt()){ // unfiltered Addi Wpt
-					// check if main wpt is filtered
-					if(ch.mainCache != null) { // parent exists
-						if (! ch.mainCache.isVisible())
-							sortDB.add(ch); // Unfiltered Addi Wpt with filtered Main Wpt, show it on its own
-						// else 
-						// Main cache is not filtered, Addi will be added below main cache further down
-						// This case doesn't seem to be a problem. It occurs regularly, when
-						// filtered addis are unfiltered, so there is not need to log this case.
-					} else { //Addi without main Cache
+				if (Global.getPref().SortingGroupedByCache) {
+					if (ch.isAddiWpt()){ // unfiltered Addi Wpt
+						// check if main wpt is filtered
+						if(ch.mainCache != null) { // parent exists
+							if (! ch.mainCache.isVisible())
+								sortDB.add(ch); // Unfiltered Addi Wpt with filtered Main Wpt, show it on its own
+							// else 
+							// Main cache is not filtered, Addi will be added below main cache further down
+							// This case doesn't seem to be a problem. It occurs regularly, when
+							// filtered addis are unfiltered, so there is not need to log this case.
+						} else { //Addi without main Cache
+							sortDB.add(ch);
+						}
+					} else { // Main Wpt, not filtered. Check for Addis
 						sortDB.add(ch);
-					}
-				} else { // Main Wpt, not filtered. Check for Addis
+						if (ch.hasAddiWpt()){
+							for (int j=0; j<ch.addiWpts.getCount();j++){
+								addiWpt = (CacheHolder)ch.addiWpts.get(j);
+								if (addiWpt.isVisible()) sortDB.add(addiWpt);
+							}
+						}// if hasAddiWpt
+					} // if AddiWpt
+				}
+				else {
 					sortDB.add(ch);
-					if (ch.hasAddiWpt()){
-						for (int j=0; j<ch.addiWpts.getCount();j++){
-							addiWpt = (CacheHolder)ch.addiWpts.get(j);
-							if (addiWpt.isVisible()) sortDB.add(addiWpt);
-						}
-					}// if hasAddiWpt
-				} // if AddiWpt
+				}
 			} // if filtered
 		}
 		// rebuild database



From araber95 at mail.berlios.de  Fri Oct  9 00:15:00 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 9 Oct 2009 00:15:00 +0200
Subject: [Cachewolf-svn] r2251 - trunk
Message-ID: <200910082215.n98MF0OH005968@sheep.berlios.de>

Author: araber95
Date: 2009-10-09 00:14:58 +0200 (Fri, 09 Oct 2009)
New Revision: 2251

Modified:
   trunk/fwrtsnapshot.sh
Log:
delivering the ewe.dll in nightly build

Modified: trunk/fwrtsnapshot.sh
===================================================================
--- trunk/fwrtsnapshot.sh	2009-10-07 22:54:28 UTC (rev 2250)
+++ trunk/fwrtsnapshot.sh	2009-10-08 22:14:58 UTC (rev 2251)
@@ -19,7 +19,7 @@
 mkdir -p bin/CacheWolf
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
     -cp lib/CompileEwe.zip:lib -d bin -deprecation -nowarn \
-    src/CacheWolf/*.java src/CacheWolf/*/*.java 
+    src/CacheWolf/*.java src/CacheWolf/*/*.java
 $EWE programs/Jewel.ewe -c cw-pda.jnf
 $EWE programs/Jewel.ewe -c cw-pc.jnf
 # Don?t change the order of the above Jewel commands because
@@ -38,6 +38,8 @@
 (cd res_noewe && cp -R * ../published/dat/)
 cp resources/attributes-big/*.gif resources/attributes/*-non.gif \
     published/dat/attributes/
+cp platform-dep/PocketPC2003/ewe.dll published/dat/
+cp -R platform-dep/PNA-WinCE42/ewe.dll published/dat/PNA-WinCE42/
 chmod -R 0755 published
 find published -type f -print0 | xargs -0 chmod 0644
 (



From pfeffer at mail.berlios.de  Fri Oct  9 15:20:02 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 9 Oct 2009 15:20:02 +0200
Subject: [Cachewolf-svn] r2252 - trunk/src/CacheWolf/navi
Message-ID: <200910091320.n99DK2kX024039@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-09 15:20:00 +0200 (Fri, 09 Oct 2009)
New Revision: 2252

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
WMS-FileReader: fixed bug: decimal separator problems caused sometimes the recommended scale to be 10times higher than intended

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-08 22:14:58 UTC (rev 2251)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-09 13:20:00 UTC (rev 2252)
@@ -478,7 +478,7 @@
 		String [] recommendedScalesStr = mString.split(wms.getProperty("RecommendedScale", "5").trim(), ' ');
 		recommendedScales = new float[recommendedScalesStr.length];
 		for (int i=0; i < recommendedScales.length; i++) {
-			recommendedScales[i] = Convert.toFloat(recommendedScalesStr[i].replace(',', '.'));
+			recommendedScales[i] = (float)Common.parseDouble(recommendedScalesStr[i].replace(',', '.'));
 		}
 		
 	}



From araber95 at mail.berlios.de  Fri Oct  9 17:12:55 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 9 Oct 2009 17:12:55 +0200
Subject: [Cachewolf-svn] r2253 - trunk/res_noewe/webmapservices
Message-ID: <200910091512.n99FCtlQ000189@sheep.berlios.de>

Author: araber95
Date: 2009-10-09 17:12:53 +0200 (Fri, 09 Oct 2009)
New Revision: 2253

Added:
   trunk/res_noewe/webmapservices/eu_t_osm-uni-bonn.wms
Modified:
   trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
   trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms
Log:
new and updated wms-servers for OSM maps

Modified: trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2009-10-09 13:20:00 UTC (rev 2252)
+++ trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2009-10-09 15:12:53 UTC (rev 2253)
@@ -1,12 +1,12 @@
 TakenFromUrl:       http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&
 GetCapabilitiesUrl: http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               de t SF=0..88 OSM-itc-halle
+Name:               Deutschland t SF=0..88 OSM(Server itc-halle)
 MapType:                        topo
 MainUrl:            http://osmwms.itc-halle.de/maps/osmfree?
 ServiceTypeUrlPart: SERVICE=WMS
 VersionUrlPart:     VERSION=1.1.1
 CoordinateReferenceSystemCacheWolf:  31466 31467 31468
-CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468
 RequestUrlPart:     REQUEST=GetMap
 #LayersUrlPart:     LAYERS=osmwms|OpenStreetMap-WMS||
 #LayersUrlPart:     LAYERS=grenzen|Administrative Grenzen (M 1:100000000)||

Added: trunk/res_noewe/webmapservices/eu_t_osm-uni-bonn.wms
===================================================================
--- trunk/res_noewe/webmapservices/eu_t_osm-uni-bonn.wms	2009-10-09 13:20:00 UTC (rev 2252)
+++ trunk/res_noewe/webmapservices/eu_t_osm-uni-bonn.wms	2009-10-09 15:12:53 UTC (rev 2253)
@@ -0,0 +1,42 @@
+TakenFromUrl:       http://services.giub.uni-bonn.de:80/geoserver/wms
+GetCapabilitiesUrl: http://services.giub.uni-bonn.de/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               Europa t OSM(Server uni-bonn)
+MapType:                        topo
+MainUrl:            http://services.giub.uni-bonn.de/wms?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+#CoordinateReferenceSystemCacheWolf:  3003 3004 4326 31466 31467 31468 31469
+#CoordinateReferenceSystemUrlPart: SRS=EPSG:3003 SRS=EPSG:3004 SRS=EPSG:4326 SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=osm_auto:CountryAnnotation|CountryAnnotation_Type||
+#LayersUrlPart:     LAYERS=gdi3d:Europe_GK3|Europe_GK3_Type||
+#LayersUrlPart:     LAYERS=hd:Klimaoekoligische_Ausgleichsflaechen|Klimaoekoligische_Ausgleichsflaechen_Type||
+#LayersUrlPart:     LAYERS=hd:Luftbewegung_und_Belueftung|Luftbewegung_und_Belueftung_Type||
+#LayersUrlPart:     LAYERS=osm_auto:buildings|buildings_Type||
+#LayersUrlPart:     LAYERS=hd:hd_geb_dichte|hd_geb_dichte3_Type||
+#LayersUrlPart:     LAYERS=osm_auto:naturals|naturals_Type||
+#LayersUrlPart:     LAYERS=osm_auto:osm_coastlines|osm_coastlines_Type||
+#LayersUrlPart:     LAYERS=osm_auto:places|places_Type||
+#LayersUrlPart:     LAYERS=osm_auto:points|points_Type||
+#LayersUrlPart:     LAYERS=osm_auto:rails|rails_Type||
+#LayersUrlPart:     LAYERS=osm_auto:roads|roads_Type||
+#LayersUrlPart:     LAYERS=osm_auto:waterways|waterways_Type||
+#LayersUrlPart:     LAYERS=osm_auto:world|world_Type||
+#LayersUrlPart:     LAYERS=osm_auto:world_ocean|world_ocean_Type||
+#LayersUrlPart:     LAYERS=osm_auto:srtm_38_02|srtm_38_02 is a A raster file accompanied by a spatial data file||
+#LayersUrlPart:     LAYERS=osm_auto:all|osm_auto:all||
+#LayersUrlPart:     LAYERS=osm_auto:all_Europe_GK3|osm_auto:all_Europe_GK3||
+#LayersUrlPart:     LAYERS=osm_auto:all_new|osm_auto:all_new||
+LayersUrlPart:     LAYERS=osm_auto:all_Europe_GK3
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 90.0000 W 35.0109
+BoundingBoxButtomRightWGS84: N 16.6632 E 61.1836
+#BBox_Mitte: N 53.3316214825176 E 13.086335159862
+MinScale:   0
+MaxScale:   100
+RecommendedScale:   0,5 5 10
+ImageFileExtension: .png
+# Boundingbox, EPSG, Layerauswahl, Scale sind noch zu pr?fen
\ No newline at end of file

Modified: trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms
===================================================================
--- trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms	2009-10-09 13:20:00 UTC (rev 2252)
+++ trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms	2009-10-09 15:12:53 UTC (rev 2253)
@@ -1,12 +1,12 @@
 TakenFromUrl:       http://osm.wheregroup.com/cgi-bin/osm_basic.xml?SERVICE=WMS&
 GetCapabilitiesUrl: http://osm.wheregroup.com/cgi-bin/osm_basic.xml?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               eu t OSM_wheregroup
+Name:               Europa t OSM(Server wheregroup)
 MapType:                        topo
 MainUrl:            http://osm.wheregroup.com/cgi-bin/osm_basic.xml?
 ServiceTypeUrlPart: SERVICE=WMS
 VersionUrlPart:     VERSION=1.1.1
 CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
 RequestUrlPart:     REQUEST=GetMap
 #LayersUrlPart:     LAYERS=OSM_Basic|OSM_Basic||
 #LayersUrlPart:     LAYERS=Grenzen|Europa||



From araber95 at mail.berlios.de  Fri Oct  9 17:16:04 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 9 Oct 2009 17:16:04 +0200
Subject: [Cachewolf-svn] r2254 - in trunk/tools/MakeWMSFile/capxml2wms: .
	bin/Debug
Message-ID: <200910091516.n99FG4BL000484@sheep.berlios.de>

Author: araber95
Date: 2009-10-09 17:16:01 +0200 (Fri, 09 Oct 2009)
New Revision: 2254

Modified:
   trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
Log:
changes showing map

Modified: trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-09 15:12:53 UTC (rev 2253)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.Designer.vb	2009-10-09 15:16:01 UTC (rev 2254)
@@ -142,10 +142,10 @@
     Private WithEvents PictureBox As System.Windows.Forms.PictureBox
     Friend WithEvents LabelScaleVertical As System.Windows.Forms.Label
     Friend WithEvents ButtonScaleDown As System.Windows.Forms.Button
-    Friend WithEvents ButtonScaleUp As System.Windows.Forms.Button
     Friend WithEvents LabelScaleDiagonal As System.Windows.Forms.Label
     Friend WithEvents ButtonUseAsMaxScale As System.Windows.Forms.Button
     Friend WithEvents ButtonAddToRecommendedScale As System.Windows.Forms.Button
     Friend WithEvents ButtonUseAsMinScale As System.Windows.Forms.Button
     Friend WithEvents ButtonHelp As System.Windows.Forms.Button
+    Friend WithEvents ButtonScaleUp As System.Windows.Forms.Button
 End Class

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
===================================================================
(Binary files differ)

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-09 15:12:53 UTC (rev 2253)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-09 15:16:01 UTC (rev 2254)
@@ -101,6 +101,14 @@
         mapUrl = makeGetMapUrl(MeineSkalierung)
         Dim SM As New Map(mapUrl, 0)
         'MsgBox("Noch nicht vorhanden!", MsgBoxStyle.Information, "Hinweis!")
+        SM.ButtonAddToRecommendedScale.Visible = False
+        SM.ButtonHelp.Visible = False
+        SM.ButtonScaleDown.Visible = False
+        SM.ButtonScaleUp.Visible = False
+        SM.ButtonUseAsMaxScale.Visible = False
+        SM.ButtonUseAsMinScale.Visible = False
+        SM.LabelScaleDiagonal.Visible = False
+        SM.LabelScaleVertical.Visible = False
         SM.ShowDialog()
     End Sub
     Private Sub ButtonFindScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonFindScale.Click



From araber95 at mail.berlios.de  Fri Oct  9 19:16:03 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 9 Oct 2009 19:16:03 +0200
Subject: [Cachewolf-svn] r2255 - trunk/src/CacheWolf
Message-ID: <200910091716.n99HG31G022305@sheep.berlios.de>

Author: araber95
Date: 2009-10-09 19:16:00 +0200 (Fri, 09 Oct 2009)
New Revision: 2255

Modified:
   trunk/src/CacheWolf/MyComparer.java
Log:
sorting ?km at the end of listing

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2009-10-09 15:16:01 UTC (rev 2254)
+++ trunk/src/CacheWolf/MyComparer.java	2009-10-09 17:16:00 UTC (rev 2255)
@@ -67,6 +67,9 @@
 				CacheHolder ch=cacheDB.get(i);
 				// CHECK Is the formatting correctly done?
 				ch.sort = MyLocale.formatDouble(ch.kilom*1000, "000000000000");
+				if (ch.kilom==-1.0) {
+					ch.sort="\uFFFF";
+				}
 			}
 		} else if (colToCompare==11) {
 			for (int i=0; i<visibleSize; i++) {



From araber95 at mail.berlios.de  Sat Oct 10 11:36:50 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 10 Oct 2009 11:36:50 +0200
Subject: [Cachewolf-svn] r2256 - in trunk/res_noewe: . symbols symbols/oder1
	symbols/oder2
Message-ID: <200910100936.n9A9aoca004214@sheep.berlios.de>

Author: araber95
Date: 2009-10-10 11:36:39 +0200 (Sat, 10 Oct 2009)
New Revision: 2256

Added:
   trunk/res_noewe/symbols/
   trunk/res_noewe/symbols/11.png
   trunk/res_noewe/symbols/12.PNG
   trunk/res_noewe/symbols/13.PNG
   trunk/res_noewe/symbols/14.PNG
   trunk/res_noewe/symbols/15.PNG
   trunk/res_noewe/symbols/16.png
   trunk/res_noewe/symbols/17.PNG
   trunk/res_noewe/symbols/18.png
   trunk/res_noewe/symbols/6.PNG
   trunk/res_noewe/symbols/oder1/
   trunk/res_noewe/symbols/oder1/11.png
   trunk/res_noewe/symbols/oder1/16.png
   trunk/res_noewe/symbols/oder1/18.png
   trunk/res_noewe/symbols/oder1/Thumbs.db
   trunk/res_noewe/symbols/oder2/
   trunk/res_noewe/symbols/oder2/19.png
   trunk/res_noewe/symbols/oder2/20.png
   trunk/res_noewe/symbols/oder2/4.png
   trunk/res_noewe/symbols/oder2/5.png
   trunk/res_noewe/symbols/oder2/Thumbs.db
   trunk/res_noewe/symbols/readme.txt
Log:
take your own symbols : already coded for "long" time , but who knows

Added: trunk/res_noewe/symbols/11.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/11.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/12.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/12.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/13.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/13.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/14.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/14.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/15.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/15.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/16.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/16.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/17.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/17.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/18.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/18.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/6.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/6.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder1/11.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder1/11.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder1/16.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder1/16.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder1/18.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder1/18.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder1/Thumbs.db
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder1/Thumbs.db
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder2/19.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder2/19.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder2/20.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder2/20.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder2/4.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder2/4.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder2/5.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder2/5.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder2/Thumbs.db
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder2/Thumbs.db
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/readme.txt
===================================================================
--- trunk/res_noewe/symbols/readme.txt	2009-10-09 17:16:00 UTC (rev 2255)
+++ trunk/res_noewe/symbols/readme.txt	2009-10-10 09:36:39 UTC (rev 2256)
@@ -0,0 +1,33 @@
+In diesem Verzeichnis vorhandene .png-Dateien werden als alternative Symbole in den Cachewolf geladen. Dabei sollte es sich um PNGs der Gr??e 15x15 handeln. Wichtig ist die korrekte Benennung der Dateien. Falsch benannte Dateien werden ignoriert.
+Es m?ssen nur die Dateien erstellt werden, die ersetzt werden sollen. Ist keine entsprechende Datei vorhanden, wird das Cachewolf-interne Symbol beibehalten.
+
+.png-files in this directory will be loaded as customized symbols into Cachewolf. They're supposed to be 15x15 PNGs. It's important to name them correctly. Incorrectly named
+files will be ignored.
+You only have to create images for those symbols you want customized. For symbols without corresponding file the buildt-in symbol will be maintained.
+
+
+Zuordnung der Dateinamen/filename assignment:
+---------------------------------------------
+
+0.png - Custom
+1.png - APE ("Project APE Cache")
+2.png - CITO
+3.png - Drive_In
+4.png - Earthcache
+5.png - Event
+6.png - Final
+7.png - Letterbox
+8.png - Locationless
+9.png - Maze ("Adventure Maze Exhibit")
+10.png - Megaevent
+11.png - Multi
+12.png - Parking
+13.png - Question
+14.png - Reference
+15.png - Stage
+16.png - Traditional
+17.png - Trailhead
+18.png - Unknown
+19.png - Virtual
+20.png - Webcam
+21.png - Wherigo
\ No newline at end of file



From araber95 at mail.berlios.de  Sat Oct 10 11:49:20 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 10 Oct 2009 11:49:20 +0200
Subject: [Cachewolf-svn] r2257 - in trunk: . res_noewe/symbols/oder2
Message-ID: <200910100949.n9A9nKNp005177@sheep.berlios.de>

Author: araber95
Date: 2009-10-10 11:49:17 +0200 (Sat, 10 Oct 2009)
New Revision: 2257

Added:
   trunk/res_noewe/symbols/oder2/11.png
   trunk/res_noewe/symbols/oder2/18.png
Removed:
   trunk/res_noewe/symbols/oder2/Thumbs.db
Modified:
   trunk/fwrtsnapshot.sh
Log:
eww.dll for pna added to dat-files
some more own symbol examples


Modified: trunk/fwrtsnapshot.sh
===================================================================
--- trunk/fwrtsnapshot.sh	2009-10-10 09:36:39 UTC (rev 2256)
+++ trunk/fwrtsnapshot.sh	2009-10-10 09:49:17 UTC (rev 2257)
@@ -39,6 +39,7 @@
 cp resources/attributes-big/*.gif resources/attributes/*-non.gif \
     published/dat/attributes/
 cp platform-dep/PocketPC2003/ewe.dll published/dat/
+mkdir -p published/dat/PNA-WinCE42
 cp -R platform-dep/PNA-WinCE42/ewe.dll published/dat/PNA-WinCE42/
 chmod -R 0755 published
 find published -type f -print0 | xargs -0 chmod 0644

Added: trunk/res_noewe/symbols/oder2/11.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder2/11.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/oder2/18.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/oder2/18.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/res_noewe/symbols/oder2/Thumbs.db
===================================================================
(Binary files differ)



From araber95 at mail.berlios.de  Sat Oct 10 12:26:45 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 10 Oct 2009 12:26:45 +0200
Subject: [Cachewolf-svn] r2258 - trunk
Message-ID: <200910101026.n9AAQjWa007566@sheep.berlios.de>

Author: araber95
Date: 2009-10-10 12:26:43 +0200 (Sat, 10 Oct 2009)
New Revision: 2258

Modified:
   trunk/getRes.bat
   trunk/getRes.sh
Log:
reflecting subdir symbols

Modified: trunk/getRes.bat
===================================================================
--- trunk/getRes.bat	2009-10-10 09:49:17 UTC (rev 2257)
+++ trunk/getRes.bat	2009-10-10 10:26:43 UTC (rev 2258)
@@ -15,4 +15,6 @@
 copy .\res_noewe\webmapservices\*.* .\work\webmapservices\*.*
 mkdir .\work\languages
 copy .\res_noewe\languages\*.* .\work\languages\*.*
+mkdir .\work\symbols
+copy .\res_noewe\symbols\*.* .\work\symbols\*.*
 copy .\lib\*.dll .\work\

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2009-10-10 09:49:17 UTC (rev 2257)
+++ trunk/getRes.sh	2009-10-10 10:26:43 UTC (rev 2258)
@@ -2,7 +2,7 @@
 
 filestosave="pref.xml garminmap.xml"
 
-for savefile in $filestosave; do 
+for savefile in $filestosave; do
 	if [ -f "work/$savefile" ]; then
 		echo "backup of $savefile"
 		mv "work/$savefile" /tmp/
@@ -22,6 +22,7 @@
 mkdir -p work/languages
 mkdir -p work/templates
 mkdir -p work/exporticons
+mkdir -p work/symbols
 
 # get ressources
 cp -fa resources/*.* work
@@ -31,6 +32,7 @@
 cp -fa res_noewe/languages/* work/languages/
 cp -fa res_noewe/templates/* work/templates/
 cp -fa res_noewe/exporticons/* work/exporticons/
+cp -fa res_noewe/symbols/* work/symbols/
 
 # set sane permissions
 find work -type f -exec chmod 644 "{}" \;



From araber95 at mail.berlios.de  Sat Oct 10 18:29:06 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 10 Oct 2009 18:29:06 +0200
Subject: [Cachewolf-svn] r2259 - in trunk/tools/MakeWMSFile/capxml2wms: .
	bin/Debug
Message-ID: <200910101629.n9AGT6AG015827@sheep.berlios.de>

Author: araber95
Date: 2009-10-10 18:28:59 +0200 (Sat, 10 Oct 2009)
New Revision: 2259

Modified:
   trunk/tools/MakeWMSFile/capxml2wms/Map.vb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
Log:
does not close the map window anymore
disabling and enabling buttons when necessary

Modified: trunk/tools/MakeWMSFile/capxml2wms/Map.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-10 10:26:43 UTC (rev 2258)
+++ trunk/tools/MakeWMSFile/capxml2wms/Map.vb	2009-10-10 16:28:59 UTC (rev 2259)
@@ -3,9 +3,11 @@
     Dim GetMapUrl As String
     Dim pngFileName As String
     Dim i As Image
-    Dim scale_ As Double
+    Dim sf As Double
+    Dim center As capxml2wms.point
     Public exitcode As Integer
     Public clickedAt As Point
+    Dim scaleLowerLimit, scaleUpperLimit As Double
 
 
     Private Sub Map_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
@@ -18,7 +20,31 @@
     End Sub
 
     Private Sub Map_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
-        Me.Text = GetMapUrl
+        _MapLoad()
+    End Sub
+
+    Friend Sub New(ByVal _GetMapUrl As String, ByVal _scale As Double, ByVal _sfmin As Double, ByVal _sfmax As Double, ByVal _center As capxml2wms.point)
+
+        ' Dieser Aufruf ist f?r den Windows Form-Designer erforderlich.
+        InitializeComponent()
+
+        ' F?gen Sie Initialisierungen nach dem InitializeComponent()-Aufruf hinzu.
+        GetMapUrl = _GetMapUrl
+        sf = _scale
+        scaleLowerLimit = _sfmin
+        scaleUpperLimit = _sfmax
+        center = _center
+        LabelScaleVertical.Text = "Vertical scale m/pixel: " & sf
+        LabelScaleDiagonal.Text = "Diagonal scale m/pixel: " & sf * Math.Sqrt(2)
+        ButtonUseAsMaxScale.Enabled = True
+        ButtonUseAsMinScale.Enabled = False
+        ButtonAddToRecommendedScale.Enabled = False
+    End Sub
+
+    Private Sub _MapLoad()
+        sf = (scaleLowerLimit + scaleUpperLimit) / 2
+        Dim BBoxString As String = capxml2wms.ToBBox(center, capxml2wms._srs, capxml2wms._pixelwidth * sf)
+        GetMapUrl = capxml2wms.makeGetMapUrlFromBBox(BBoxString)
         Try
             Dim wc As New WebClient()
             pngFileName = IO.Path.GetTempFileName
@@ -33,28 +59,18 @@
             MsgBox("Tut mir leid, das mag der wms-Server wohl so nicht", MsgBoxStyle.Exclamation)
             Close()
         End Try
+        LabelScaleVertical.Text = "Vertical scale m/pixel: " & sf
+        LabelScaleDiagonal.Text = "Diagonal scale m/pixel: " & sf * Math.Sqrt(2)
     End Sub
 
-    Public Sub New(ByVal _GetMapUrl As String, ByVal scale As Double)
-
-        ' Dieser Aufruf ist f?r den Windows Form-Designer erforderlich.
-        InitializeComponent()
-
-        ' F?gen Sie Initialisierungen nach dem InitializeComponent()-Aufruf hinzu.
-        GetMapUrl = _GetMapUrl
-        scale_ = scale
-        LabelScaleVertical.Text = "Vertical scale m/pixel: " & scale
-        LabelScaleDiagonal.Text = "Diagonal scale m/pixel: " & scale * Math.Sqrt(2)
-    End Sub
-
     Private Sub ButtonScaleUp_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonScaleUp.Click
-        exitcode = +1
-        Close()
+        scaleLowerLimit = sf
+        _MapLoad()
     End Sub
 
     Private Sub ButtonScaleDown_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonScaleDown.Click
-        exitcode = -1
-        Close()
+        scaleUpperLimit = sf
+        _MapLoad()
     End Sub
 
     Private Sub PictureBox_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PictureBox.Click
@@ -65,23 +81,44 @@
         clickedAt = New Point
         clickedAt.X = mev.X - (Width - im.Width) / 2 - im.Width / 2
         clickedAt.Y = mev.Y - (Height - im.Height) / 2 - im.Height / 2
-        exitcode = 5
-        Close()
+        ' shift center to the clicked pos
+        center.x = center.x + clickedAt.X * sf * capxml2wms.metersToBBoxHorizontal(capxml2wms._srs, center)
+        center.y = center.y - clickedAt.Y * sf * capxml2wms.metersToBBoxVertical(capxml2wms._srs)
+        _MapLoad()
     End Sub
 
     Private Sub ButtonUseAsMaxScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonUseAsMaxScale.Click
-        exitcode = 101
-        Close()
+        capxml2wms.maxScale = sf * Math.Sqrt(2)
+        scaleUpperLimit = sf
+        scaleLowerLimit = capxml2wms.minScale / Math.Sqrt(2)
+        _MapLoad()
+        ButtonUseAsMaxScale.Enabled = False
+        ButtonUseAsMinScale.Enabled = True
+        AddToRecommendedScale()
     End Sub
 
     Private Sub ButtonAddToRecommendedScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonAddToRecommendedScale.Click
-        exitcode = 100
-        Close()
+        AddToRecommendedScale()
     End Sub
 
+    Private Sub AddToRecommendedScale()
+        If capxml2wms.recScale Is Nothing Then
+            capxml2wms.recScale = New ArrayList
+        End If
+        capxml2wms.recScale.Add(sf)
+        scaleLowerLimit = capxml2wms.minScale / Math.Sqrt(2)
+        scaleUpperLimit = capxml2wms.maxScale / Math.Sqrt(2)
+        _MapLoad()
+    End Sub
+
     Private Sub ButtonUseAsMinScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonUseAsMinScale.Click
-        exitcode = 99
-        Close()
+        capxml2wms.minScale = sf * Math.Sqrt(2)
+        scaleLowerLimit = sf
+        scaleUpperLimit = capxml2wms.maxScale / Math.Sqrt(2)
+        _MapLoad()
+        ButtonUseAsMinScale.Enabled = False
+        ButtonAddToRecommendedScale.Enabled = True
+        AddToRecommendedScale()
     End Sub
 
     Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonHelp.Click

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
===================================================================
(Binary files differ)

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-10 10:26:43 UTC (rev 2258)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2009-10-10 16:28:59 UTC (rev 2259)
@@ -42,9 +42,9 @@
 
     Dim WGS84 As Ellipsoid
     Dim OBBoxes As Dictionary(Of String, XmlElement)
-    Dim minScale As Double = 0
-    Dim maxScale As Double = 1000
-    Dim recScale As ArrayList
+    Friend minScale As Double = 0
+    Friend maxScale As Double = 1000
+    Friend recScale As ArrayList
 
 
     Private Sub capxml2wms_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
@@ -99,7 +99,10 @@
         Dim MeineSkalierung As Double
         MeineSkalierung = 2.0 * Me.HScrollBar1.Value
         mapUrl = makeGetMapUrl(MeineSkalierung)
-        Dim SM As New Map(mapUrl, 0)
+        Dim center As point
+        center.x = 0
+        center.y = 0
+        Dim SM As New Map(mapUrl, 0, 0, 0, center)
         'MsgBox("Noch nicht vorhanden!", MsgBoxStyle.Information, "Hinweis!")
         SM.ButtonAddToRecommendedScale.Visible = False
         SM.ButtonHelp.Visible = False
@@ -111,11 +114,12 @@
         SM.LabelScaleVertical.Visible = False
         SM.ShowDialog()
     End Sub
+    Friend _srs As Integer
+    Friend _pixelwidth As Integer
     Private Sub ButtonFindScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonFindScale.Click
         Dim BBoxString As String
 
-        Dim srs As Integer
-        srs = Me.ComboBoxEPSG.SelectedItem
+        _srs = Me.ComboBoxEPSG.SelectedItem
 
         Dim center As point
         ' find center
@@ -142,8 +146,7 @@
         center.y = rymitte
 
         Dim scale_ll, scale_ul, scale_m As Double
-        Dim pixelwidth As Integer
-        pixelwidth = 500
+        _pixelwidth = 500
 
         scale_ll = minScale
         scale_ul = maxScale
@@ -152,51 +155,13 @@
         Dim mapUrl As String
         Do
             scale_m = (scale_ll + scale_ul) / 2
-            BBoxString = ToBBox(center, srs, pixelwidth * scale_m)
+            BBoxString = ToBBox(center, _srs, _pixelwidth * scale_m)
             mapUrl = makeGetMapUrlFromBBox(BBoxString)
-            SM = New Map(mapUrl, scale_m)
+            SM = New Map(mapUrl, scale_m, minScale, maxScale, center)
             SM.ShowDialog()
-            Select Case SM.exitcode
-                Case -1
-                    scale_ul = scale_m
-                Case 1
-                    scale_ll = scale_m
-                Case 5
-                    ' shift center to the clicked pos
-                    center.x = center.x + SM.clickedAt.X * scale_m * metersToBBoxHorizontal(srs, center)
-                    center.y = center.y - SM.clickedAt.Y * scale_m * metersToBBoxVertical(srs)
-                Case 99
-                    Me.minScale = scale_m * Math.Sqrt(2)
-                    scale_ll = scale_m
-                    scale_ul = Me.maxScale / Math.Sqrt(2)
-                Case 100
-                    If recScale Is Nothing Then
-                        recScale = New ArrayList
-                    End If
-                    recScale.Add(scale_m)
-                    scale_ll = Me.minScale / Math.Sqrt(2)
-                    scale_ul = Me.maxScale / Math.Sqrt(2)
-                Case 101
-                    Me.maxScale = scale_m * Math.Sqrt(2)
-                    scale_ul = scale_m
-                    scale_ll = Me.minScale / Math.Sqrt(2)
-            End Select
-
         Loop Until SM.exitcode = 0
     End Sub
-    Private Function metersToBBoxVertical(ByVal epsg As Integer) As Double
-        If epsg = 4326 Then
-            metersToBBoxVertical = 360 / (WGS84.a * Math.PI * 2)
-        Else : metersToBBoxVertical = 1
-        End If
-    End Function
-    Private Function metersToBBoxHorizontal(ByVal epsg As Integer, ByRef center As point) As Double
-        If epsg = 4326 Then
-            metersToBBoxHorizontal = (360 / (WGS84.a * Math.PI * 2)) / Math.Cos(center.y / 180 * Math.PI)
-        Else : metersToBBoxHorizontal = 1
-        End If
-    End Function
-    Private Function makeGetMapUrlFromBBox(ByVal bb As String) As String
+    Friend Function makeGetMapUrlFromBBox(ByVal bb As String) As String
         'http:// www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous
         '&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap
         '&SRS=EPSG:31467
@@ -303,7 +268,20 @@
         makeGetMapUrl = mapUrl
     End Function
 
-    Private Function ToBBox(ByRef center As point, ByVal srs As Integer, ByVal meter As Double) As String
+    Friend Function metersToBBoxVertical(ByVal epsg As Integer) As Double
+        If epsg = 4326 Then
+            metersToBBoxVertical = 360 / (WGS84.a * Math.PI * 2)
+        Else : metersToBBoxVertical = 1
+        End If
+    End Function
+    Friend Function metersToBBoxHorizontal(ByVal epsg As Integer, ByRef center As capxml2wms.point) As Double
+        If epsg = 4326 Then
+            metersToBBoxHorizontal = (360 / (WGS84.a * Math.PI * 2)) / Math.Cos(center.Y / 180 * Math.PI)
+        Else : metersToBBoxHorizontal = 1
+        End If
+    End Function
+
+    Friend Function ToBBox(ByRef center As point, ByVal srs As Integer, ByVal meter As Double) As String
         Dim tl As point
         Dim br As point
         Dim diff_v, diff_h As Double
@@ -708,7 +686,7 @@
                 If n.NodeType = XmlNodeType.Element Then
                     Dim e As XmlElement = n
                     Dim stmp As String = e.GetAttribute("SRS")
-                    If Not OBBoxes.ContainsKey(stmp) Then
+                    If Not stmp = "" And Not OBBoxes.ContainsKey(stmp) Then
                         OBBoxes.Add("EPSG:4326", e)
                     End If
                 End If
@@ -786,7 +764,7 @@
 
     End Sub
 
-    Private Structure point
+    Friend Structure point
         Dim x As Double
         Dim y As Double
     End Structure



From araber95 at mail.berlios.de  Sun Oct 11 00:07:07 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 11 Oct 2009 00:07:07 +0200
Subject: [Cachewolf-svn] r2260 - trunk/src/CacheWolf
Message-ID: <200910102207.n9AM77NT021523@sheep.berlios.de>

Author: araber95
Date: 2009-10-11 00:07:05 +0200 (Sun, 11 Oct 2009)
New Revision: 2260

Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/ProfilesForm.java
Log:
Deleting Profile
Renaming Profile (in work)

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-10-10 16:28:59 UTC (rev 2259)
+++ trunk/src/CacheWolf/MainMenu.java	2009-10-10 22:07:05 UTC (rev 2260)
@@ -62,7 +62,7 @@
 	private MenuItem exportLOC, exportGPS, mnuSeparator;
 	private MenuItem orgNewWP, orgCopy, orgMove, orgDelete,orgRebuild,orgCheckNotesAndSolver, orgRater;
 	public MenuItem cacheTour,orgTravelbugs, mnuForceLogin;
-	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditCenter;
+	private MenuItem mnuNewProfile, mnuOpenProfile, mnuDeleteProfile, mnuRenameProfile, mnuEditCenter;
 	private Form father;
 	private TablePanel tbp;
 	private FilterScreen scnFilter=new FilterScreen();
@@ -78,9 +78,11 @@
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for profiles, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] mnuProfile = new MenuItem[2];
+		MenuItem[] mnuProfile = new MenuItem[4];
 		mnuProfile[0] = mnuNewProfile = new MenuItem(MyLocale.getMsg(1107,"New"));
 		mnuProfile[1] = mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109,"Open"));
+		mnuProfile[2] = mnuDeleteProfile = new MenuItem(MyLocale.getMsg(1125,"Delete"));
+		mnuProfile[3] = mnuRenameProfile = new MenuItem(MyLocale.getMsg(1126,"Rename"));
 		Menu profileMenu = new Menu(mnuProfile,MyLocale.getMsg(121,"Profiles"));
 
 		///////////////////////////////////////////////////////////////////////
@@ -304,6 +306,12 @@
 					tbp.resetModel();
 				}
 			}
+			if(mev.selectedItem == mnuDeleteProfile) {
+				pref.deleteProfile();
+			}
+			if(mev.selectedItem == mnuRenameProfile) {
+				pref.renameProfile(getFrame());
+			}
 			if(mev.selectedItem == mnuEditCenter){
 				ProfileDataForm f=new ProfileDataForm(pref,profile);
 				f.execute(getFrame(), Gui.CENTER_FRAME);

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-10 16:28:59 UTC (rev 2259)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-10 22:07:05 UTC (rev 2260)
@@ -277,7 +277,7 @@
 	public int myAppWidth = 800;
 	/** True if the preferences were changed and need to be saved */
 	public boolean dirty = false;
-	
+
 	private String pathToProfile;
 
     //////////////////////////////////////////////////////////////////////////////////////
@@ -340,8 +340,8 @@
 		}
 		if (testlist != null) {
 			for (int i=0; i < testlist.length; i++)
-				if ((new FileBugfix(testlist[i])).exists()) { 
-					return testlist[i]; 
+				if ((new FileBugfix(testlist[i])).exists()) {
+					return testlist[i];
 				}
 		}
 		return "";
@@ -354,7 +354,7 @@
 	/**
 	 * Method that gets called when a new element has been identified in pref.xml
 	 */
-	
+
 	public void startElement(String name, AttributeList atts){
 		//Vm.debug("name = "+name);
 		lastName=name;
@@ -552,13 +552,13 @@
 		}
 		else if (name.equals("logkeeping")) {
 			tmp = atts.getValue("maximum");
-			if (tmp != null) 
+			if (tmp != null)
 				maxLogsToKeep = Convert.parseInt(tmp);
 			if (maxLogsToKeep < 0) maxLogsToKeep = 0;
-			
+
 			tmp = atts.getValue("keepown");
 			if (tmp != null)
-				alwaysKeepOwnLogs = Boolean.valueOf(tmp).booleanValue();  
+				alwaysKeepOwnLogs = Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("fillWhiteArea")){
 			tmp = atts.getValue("on");
@@ -694,7 +694,7 @@
 			return absoluteBaseDir+"maps"+rCMP;
 		}
 	}
-	
+
 	public void saveCustomMapsPath(String mapspath_) {
 		if (customMapsPath == null || !customMapsPath.equals(mapspath_)) {
 			customMapsPath=new String(mapspath_).replace('\\', '/');
@@ -822,7 +822,7 @@
 
 	/**
 	 * tries to get the home data dir of the user
-	 * e.g. "c:\documents and...\<user>\my documents" or "/home/<user>" in linux 
+	 * e.g. "c:\documents and...\<user>\my documents" or "/home/<user>" in linux
 	 * if none could be identified, "/" is returned.
 	 * @return
 	 */
@@ -836,13 +836,8 @@
 		if (test.length() == 0)	test = "/";
 		return test;
 	}
-	/**
-	 * Open Profile selector screen
-	 * @param prof
-	 * @param showProfileSelector
-	 * @return True if a profile was selected
-	 */
-	public boolean selectProfile(Profile prof, int showProfileSelector, boolean hasNewButton) {
+
+	private void checkAbsoluteBaseDir() {
 		// If datadir is empty, ask for one
 		if (absoluteBaseDir.length()==0 || !(new FileBugfix(absoluteBaseDir)).exists()) {
 			do {
@@ -853,11 +848,21 @@
 				setBaseDir(fc.getChosenFile().toString());
 			}while (!(new FileBugfix(absoluteBaseDir)).exists());
 		}
+	}
+
+	/**
+	 * Open Profile selector screen
+	 * @param prof
+	 * @param showProfileSelector
+	 * @return True if a profile was selected
+	 */
+	public boolean selectProfile(Profile prof, int showProfileSelector, boolean hasNewButton) {
+		checkAbsoluteBaseDir();
 		boolean profileExists=true;  // Assume that the profile exists
 		do {
 			if(!profileExists || (showProfileSelector==PROFILE_SELECTOR_FORCED_ON) ||
 					(showProfileSelector==PROFILE_SELECTOR_ONOROFF && !autoReloadLastProfile)){ // Ask for the profile
-				ProfilesForm f = new ProfilesForm(absoluteBaseDir,lastProfile,!profileExists || hasNewButton);
+				ProfilesForm f = new ProfilesForm(absoluteBaseDir,lastProfile,!profileExists || hasNewButton ? 0 : 1);
 				int code = f.execute();
 				// If no profile chosen (includes a new one), terminate
 				if (code==-1) return false; // Cancel pressed
@@ -882,6 +887,47 @@
 		return true;
 	}
 
+	public void deleteProfile() {
+		checkAbsoluteBaseDir(); // perhaps not necessary
+		ProfilesForm f = new ProfilesForm(absoluteBaseDir,"",2);
+		int code = f.execute();
+		// If no profile chosen (includes a new one), terminate
+		if (code==-1) return; // Cancel pressed
+		if (lastProfile.equals(f.newSelectedProfile)) {
+			// aktives Profil kann nicht gel?scht / umbenannt werden;
+			new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(227,"[active profile cannot be deleted.]"),FormBase.MBOK).execute();
+		}
+		else {
+			if (!(new FileBugfix(absoluteBaseDir+f.newSelectedProfile).delete()) ) {
+				// Fehler beim l?schen des Profils;
+				new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(226,"[Profile cannot be deleted.]"),FormBase.MBOK).execute();
+			}
+		}
+	}
+
+	public void renameProfile(ewe.ui.Frame parent) {
+		// not yet implemented
+		/*
+		checkAbsoluteBaseDir(); // perhaps not necessary
+		ProfilesForm f = new ProfilesForm(absoluteBaseDir,"",3);
+		int code = f.execute();
+		// If no profile chosen (includes a new one), terminate
+		if (code==-1) return; // Cancel pressed
+		if (lastProfile.equals(f.newSelectedProfile)) {
+			// aktives Profil kann nicht gel?scht / umbenannt werden;
+			new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(228,"[active profile cannot be renamed.]"),FormBase.MBOK).execute();
+		}
+		else {
+			NewProfileForm x=new NewProfileForm(absoluteBaseDir);
+			x.execute(parent, Gui.CENTER_FRAME);
+			if (!(new FileBugfix(absoluteBaseDir+f.newSelectedProfile).rename(x.profileDir))) {
+				// Fehler beim l?schen des Profils;
+				new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(229,"[Profile cannot be renamed.]"),FormBase.MBOK).execute();
+			}
+		}
+		*/		
+		new MessageBox(MyLocale.getMsg(321,"Error"),"Noch nicht implementiert. Nutzen Sie solange das Betriebssystem um das Profilverzeichnis umzubenennen!",FormBase.MBOK).execute();
+	}
     //////////////////////////////////////////////////////////////////////////////////////
     // Log functions
 	//////////////////////////////////////////////////////////////////////////////////////
@@ -1063,9 +1109,9 @@
 		Utils.sort(result, comp, false);
 		return result;
 	}
-	
+
 	public String gpsbabel = null;
-	
+
 	public void setgpsbabel() {
 		try{
 			ewe.sys.Process p = Vm.exec("gpsbabel -V");
@@ -1084,17 +1130,17 @@
 			}
 		}
 	}
-	
+
 	/** get directory where pref.xml is stored<br>
 	 *  use this if you need a path where the user has sufficient rights to create a file */
 	public String getPathToConfigFile() {
 		return pathToConfigFile;
 	}
-	
+
 	public String getBaseDir() {
 		return baseDir;
 	}
-	
+
 	public void setBaseDir(String dir) {
 		baseDir = dir;
 		baseDir=baseDir.replace('\\','/');

Modified: trunk/src/CacheWolf/ProfilesForm.java
===================================================================
--- trunk/src/CacheWolf/ProfilesForm.java	2009-10-10 16:28:59 UTC (rev 2259)
+++ trunk/src/CacheWolf/ProfilesForm.java	2009-10-10 22:07:05 UTC (rev 2260)
@@ -17,21 +17,21 @@
 	private class MyList extends mList {
 		private int first=1;
 		private int select;
-	    
+
 		public MyList() {
 			super(1,1,false);
 		}
-		
+
 		public void selectLastProfile(String selectedItem) {
 			selectItem(selectedItem);
 			select=getSelectedIndex(0);
 		}
 
 		public void doPaint(Graphics gr,Rect area) {
-			if (first==1) { 
+			if (first==1) {
 				first=0;
 				selectAndView(select);
-				makeVisible(select); 
+				makeVisible(select);
 			}
 			super.doPaint(gr,area);
 		}
@@ -45,7 +45,7 @@
 			sp.modify(0,TakeControlEvents);
 			return sp;
 		}
-		
+
 	}
 
 	private MyList choice;
@@ -55,13 +55,13 @@
 	public String newSelectedProfile;	// This is only used if a new profile is being created
 
 	/**
-	*	Constructor to create a form to select profiles. It requires that the preferences 
+	*	Constructor to create a form to select profiles. It requires that the preferences
 	*	have been loaded so that the calling parameters can be set.
 	* @param baseDir The base directory which holds one subdirectory per profile
 	* @param oldProfiles List of names of old profiles
 	* @param selectedProfile Name of the last used profile
 	*/
-	public ProfilesForm(String baseDir, String selectedProfile, boolean hasNewButton){
+	public ProfilesForm(String baseDir, String selectedProfile, int outfit){
 		super();
     	resizable =  false;
 		int w=MyLocale.getScreenWidth();
@@ -69,22 +69,39 @@
 		if (w>240) w=240;
 		if (h>320) h=320;
 		setPreferredSize(w,h);
-	    defaultTags.set(CellConstants.INSETS,new Insets(2,2,2,2));		
+	    defaultTags.set(CellConstants.INSETS,new Insets(2,2,2,2));
 		title = MyLocale.getMsg(1301,"Select Profile:");
-		if (hasNewButton) {
+		if (outfit==0) {
 			addNext(new mLabel(MyLocale.getMsg(1106,"Choose profile or New")),DONTSTRETCH,DONTSTRETCH|LEFT);
 			addLast(btnNew=new mButton(MyLocale.getMsg(1107,"New")),HSTRETCH,HFILL|RIGHT);
-		} else {
-			addLast(new mLabel(MyLocale.getMsg(1108,"Choose profile")),DONTSTRETCH,DONTSTRETCH|LEFT);
 		}
-		
+		else {
+			if (outfit==1) {
+				addLast(new mLabel(MyLocale.getMsg(1108,"Choose profile")),DONTSTRETCH,DONTSTRETCH|LEFT);
+			}
+			else {
+				if (outfit==2) {
+					//delete
+					String msg = MyLocale.getMsg(1118,"profile") + " " + MyLocale.getMsg(1125,"delete") ; 
+					addLast(new mLabel(msg),DONTSTRETCH,DONTSTRETCH|LEFT);
+				}
+				else {
+					if (outfit==3) {
+						// rename
+						String msg = MyLocale.getMsg(1118,"profile") + " " + MyLocale.getMsg(1126,"rename") ; 
+						addLast(new mLabel(msg),DONTSTRETCH,DONTSTRETCH|LEFT);
+					}
+				}
+			}
+		}
+
 		choice=new MyList();
 		// Get all subdirectories in the base directory
 		File fileBaseDir=new FileBugfix(baseDir);
 		String[] existingProfiles=fileBaseDir.list("*.*",FileBase.LIST_DIRECTORIES_ONLY);
         // Now add these subdirectories to the list of profiles but
         // exclude the "maps" directory which will contain the moving maps
-        for (int i=0; i<existingProfiles.length; i++) 
+        for (int i=0; i<existingProfiles.length; i++)
 			if (!existingProfiles[i].equalsIgnoreCase("maps")) choice.addItem(existingProfiles[i]);
         // Highlight the profile that was used last
         choice.selectLastProfile(selectedProfile);
@@ -101,7 +118,7 @@
 		this.baseDir=baseDir;
 		choice.takeFocus(ControlConstants.ByKeyboard);
 	}
-	
+
 	/**
 	 * Ask for a new profile directory. If it exists, cancel. If it does not exist, create it
 	 * @return Name of directory (just the part below baseDir)
@@ -109,7 +126,7 @@
 	public String createNewProfile() {
 		NewProfileForm f=new NewProfileForm(baseDir);
 	    int code=f.execute(getFrame(), Gui.CENTER_FRAME);
-		if (code==0) { 
+		if (code==0) {
 			 return f.profileDir;
 		} else
 			 return "";



From araber95 at mail.berlios.de  Sun Oct 11 00:08:43 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 11 Oct 2009 00:08:43 +0200
Subject: [Cachewolf-svn] r2261 - trunk/res_noewe/languages
Message-ID: <200910102208.n9AM8hr8021592@sheep.berlios.de>

Author: araber95
Date: 2009-10-11 00:08:40 +0200 (Sun, 11 Oct 2009)
New Revision: 2261

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
Log:
update/delete Profile : Texts update

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-10 22:07:05 UTC (rev 2260)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-10 22:08:40 UTC (rev 2261)
@@ -115,6 +115,10 @@
 		223=Filter l%f6schen?
 		224=+- Den gespeicherten Filter l%f6schen?
 		225=Auch in Logs
+		226=Das Profil kann nicht gel%f6scht werden.
+		227=Das aktive Profil kann nicht gel%f6scht werden.
+		228=Das aktive Profil kann nicht umbenannt werden.
+		229=Das Profil kann nicht umbenannt werden.
 		250=ColleIsarcos Texte fuer den DataMover
 		251=Alle Wegpunkte werden gel%f6scht
 		252=Alle Wegpunkte werden verschoben
@@ -384,6 +388,8 @@
 		1122='maps' ist f%fcr das Kartenverzeichnis reserviert.
 		1123=Zur Festlegung der Zentrumskoordinaten dieses Profils, klicken Sie auf "Weiter".
 		1124=Weiter
+		1125=L%f6schen
+		1126=Umbenennen
 		1200=Liste
 		1201=Details
 		1202=Beschreibung

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-10 22:07:05 UTC (rev 2260)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-10 22:08:40 UTC (rev 2261)
@@ -115,6 +115,10 @@
 		223=Delete filter?
 		224=+- Delete the saved filter?
 		225=Also in logs
+		226=Profile cannot be deleted.
+		227=active profile cannot be deleted.
+		228=active profile cannot be renamed.
+		229=Profile cannot be renamed.
 		250=ColleIsarcos texte used in  DataMover
 		251=All waypoints will be deleted
 		252=All waypoints will be moved
@@ -384,6 +388,8 @@
 		1122='maps' is reserved for the maps directory.
 		1123=Click "Next" to define the center coordinates for this profile.
 		1124=Next
+		1125=Delete
+		1126=Rename
 		1200=List
 		1201=Details
 		1202=Description

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-10 22:07:05 UTC (rev 2260)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-10 22:08:40 UTC (rev 2261)
@@ -113,6 +113,10 @@
 		223=Effacer filtre?
 		224=+- Effacer ce filtre enregistr%e9?
 		225=Aussi dans logs
+		226=[Profile cannot be deleted.]
+		227=[active Profile cannot be deleted.]
+		228=[active Profile cannot be renamed.]
+		229=[Profile cannot be renamed.]
 		250=ColleIsarcos texte used in  DataMover
 		251=[All waypoints will be deleted]
 		252=[All waypoints will be moved]
@@ -379,6 +383,8 @@
 		1122='maps' est r%e9serv%e9 pour le dossier des cartes.
 		1123=Pour fixer le centre de ce profil, cliquer "Continuer"
 		1124=Continuer
+		1125=[Delete]
+		1126=[Rename]
 		1200=Liste
 		1201=D%e9tails
 		1202=Description

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-10 22:07:05 UTC (rev 2260)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-10 22:08:40 UTC (rev 2261)
@@ -104,6 +104,10 @@
 		223=Filter verwijderen?
 		224=+- Deze filter verwijderen?
 		225=Ook in logs
+		226=[Profile cannot be deleted.]
+		227=[active Profile cannot be deleted.]
+		228=[active Profile cannot be renamed.]
+		229=[Profile cannot be renamed.]
 		250=ColleIsarcos texte used in DataMover
 		251=[All waypoints will be deleted]
 		252=[All waypoints will be moved]
@@ -354,6 +358,11 @@
 		1119=Oude profielen
 		1120=Moeilijkheidsgraad
 		1121=Terrein
+		1122=['maps' is reserved for the maps directory.]
+		1123=[Click "Next" to define the center coordinates for this profile.]
+		1124=[Next]
+		1125=[Delete]
+		1126=[Rename]
 		1200=Lijst
 		1201=Details
 		1202=Beschrijving

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-10 22:07:05 UTC (rev 2260)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-10 22:08:40 UTC (rev 2261)
@@ -115,7 +115,11 @@
                 223=Usunac filtr?
                 224=+- Usunac zapisany filtr?
                 225=Takze w logach
-                250=ColleIsarcos tekst uzyty w DataMover
+		226=[Profile cannot be deleted.]
+		227=[active Profile cannot be deleted.]
+		228=[active Profile cannot be renamed.]
+		229=[Profile cannot be renamed.]
+		250=ColleIsarcos tekst uzyty w DataMover
                 251=Wszystkie waypointy zostana skasowane
                 252=Wszystkie waypointy zostana przeniesione
                 253=Wszystkie waypointy zostana skopiowanie
@@ -382,6 +386,8 @@
                 1122='maps' zarezerwowane dla katalogu map.
                 1123=Kliknij "nastepny" by zdefiniowac srodkowe wspolrzedne profilu.
                 1124=Nastepny
+		1125=[Delete]
+		1126=[Rename]
                 1200=Lista
                 1201=Szczegoly
                 1202=Opis



From araber95 at mail.berlios.de  Sun Oct 11 01:03:26 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 11 Oct 2009 01:03:26 +0200
Subject: [Cachewolf-svn] r2262 - trunk/src/CacheWolf
Message-ID: <200910102303.n9AN3QKP022526@sheep.berlios.de>

Author: araber95
Date: 2009-10-11 01:03:23 +0200 (Sun, 11 Oct 2009)
New Revision: 2262

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
showing cache in browser online : page without  all logs is called!

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2009-10-10 22:08:40 UTC (rev 2261)
+++ trunk/src/CacheWolf/myTableControl.java	2009-10-10 23:03:23 UTC (rev 2262)
@@ -256,9 +256,12 @@
 			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
 				CacheHolderDetail chD=ch.getCacheDetails(false, true);
+				String url =chD.URL;
+				int logpos = url.toLowerCase().indexOf("&log=y");
+				if (logpos > 0) url=url.substring(0,logpos) + url.substring(logpos+6,url.length());
 				try {
 					if (chD != null) {
-						CWWrapper.exec(pref.browser, chD.URL); // maybe this works on some PDAs?
+						CWWrapper.exec(pref.browser, url); // maybe this works on some PDAs?
 					}
 				} catch (IOException ex) {
 					(new MessageBox(MyLocale.getMsg(321,"Error"),



From pfeffer at mail.berlios.de  Sun Oct 11 13:18:40 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 11 Oct 2009 13:18:40 +0200
Subject: [Cachewolf-svn] r2263 - trunk/src/CacheWolf/navi
Message-ID: <200910111118.n9BBIe2W006370@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-11 13:18:37 +0200 (Sun, 11 Oct 2009)
New Revision: 2263

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
WMS: MapLoader: bug fixed: in Ewe: no decimal digits to the recommended scales are added anymore

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-10 23:03:23 UTC (rev 2262)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-11 11:18:37 UTC (rev 2263)
@@ -303,7 +303,7 @@
 	String MainUrl; //http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS
 	/** including "." */
 	String imageFileExt; // ".gif", ".jpg"...
-	float recommendedScales[];
+	double recommendedScales[];
 	double minscale;
 	double maxscale;
 	Area boundingBox;
@@ -476,9 +476,9 @@
 		imageFileExt = wms.getProperty("ImageFileExtension", "").trim();
 		if (imageFileExt == "") throw new IllegalArgumentException(MyLocale.getMsg(4821, "WebMapService: property >ImageFileExtension:< missing in file:\n") + filename);
 		String [] recommendedScalesStr = mString.split(wms.getProperty("RecommendedScale", "5").trim(), ' ');
-		recommendedScales = new float[recommendedScalesStr.length];
+		recommendedScales = new double[recommendedScalesStr.length];
 		for (int i=0; i < recommendedScales.length; i++) {
-			recommendedScales[i] = (float)Common.parseDouble(recommendedScalesStr[i].replace(',', '.'));
+			recommendedScales[i] = Common.parseDouble(recommendedScalesStr[i].replace(',', '.'));
 		}
 		
 	}
@@ -676,7 +676,7 @@
 		MainUrl = "Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&ID=3kQaz."; //"Rhttp://" forces doenloadUrl to retry the URL until it gets an http-redirect and then downloads from there 
 		imageFileExt = ".gif";
 		mapType = "expedia";
-		recommendedScales = new float[]{5};
+		recommendedScales = new double[]{5};
 		minscale = getMetersPerPixel(0.00000000000000000000001f);
 		maxscale = getMetersPerPixel((float)new CWPoint(0,0).getDistance(new CWPoint(0,180)) * 2 * 1000 / 1000); // whole world * 1000 because of km -> m. /1000 because we have 1000x1000 Pixel usually
 		boundingBox = new Area(new CWPoint(90,-180), new CWPoint(-90,180));



From pfeffer at mail.berlios.de  Sun Oct 11 13:58:56 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 11 Oct 2009 13:58:56 +0200
Subject: [Cachewolf-svn] r2264 - trunk/src/CacheWolf/navi
Message-ID: <200910111158.n9BBwuwT008037@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-11 13:58:53 +0200 (Sun, 11 Oct 2009)
New Revision: 2264

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
WMS: MapLoader: shows the recommended scales sorted and preselect the first in the list in the .wms file

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-11 11:18:37 UTC (rev 2263)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-11 11:58:53 UTC (rev 2264)
@@ -13,6 +13,7 @@
 import ewe.fx.*;
 import ewe.util.*;
 import ewe.sys.*;
+import ewe.sys.Double;
 import ewe.net.*;
 import java.lang.Math;
 
@@ -304,6 +305,7 @@
 	/** including "." */
 	String imageFileExt; // ".gif", ".jpg"...
 	double recommendedScales[];
+	int preselectedRecScaleIndex = 0;
 	double minscale;
 	double maxscale;
 	Area boundingBox;
@@ -476,11 +478,21 @@
 		imageFileExt = wms.getProperty("ImageFileExtension", "").trim();
 		if (imageFileExt == "") throw new IllegalArgumentException(MyLocale.getMsg(4821, "WebMapService: property >ImageFileExtension:< missing in file:\n") + filename);
 		String [] recommendedScalesStr = mString.split(wms.getProperty("RecommendedScale", "5").trim(), ' ');
-		recommendedScales = new double[recommendedScalesStr.length];
-		for (int i=0; i < recommendedScales.length; i++) {
-			recommendedScales[i] = Common.parseDouble(recommendedScalesStr[i].replace(',', '.'));
+		// convert recommended scales to doube[], sort them and set preselected recommended scale
+		if (recommendedScalesStr.length > 0) {
+			double preselected = Common.parseDouble(recommendedScalesStr[0]);
+			Double[] recommendedScalesObj = new Double[recommendedScalesStr.length];
+			for (int i=0; i < recommendedScalesObj.length; i++) {
+				recommendedScalesObj[i] = new Double();
+				recommendedScalesObj[i].set(Common.parseDouble(recommendedScalesStr[i].replace(',', '.')));
+			}
+			Utils.sort(recommendedScalesObj, new StandardComparer(), false);
+			recommendedScales = new double[recommendedScalesStr.length];
+			for (int i=0; i < recommendedScales.length; i++) {
+				recommendedScales[i] = recommendedScalesObj[i].value;
+				if (recommendedScales[i] == preselected) preselectedRecScaleIndex = i;
+			}
 		}
-		
 	}
 
 	private static final int TOPLEFT_INDEX = 0;

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-11 11:18:37 UTC (rev 2263)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-11 11:58:53 UTC (rev 2264)
@@ -143,10 +143,10 @@
 		for (int i=0; i<recScales.length; i++) {
 			recScales[i] = Convert.toString(mapLoader.currentOnlineMapService.recommendedScales[i]);
 		}
-		scaleInput.choice.set(recScales, 0); // setText(Convert.toString(mapLoader.currentOnlineMapService.recommendedScales));
-		scaleInputPerCache.choice.set(recScales, 0);
-		scaleInput.setText(recScales[0]);
-		scaleInputPerCache.setText(recScales[0]);
+		scaleInput.choice.set(recScales, mapLoader.currentOnlineMapService.preselectedRecScaleIndex);
+		scaleInputPerCache.choice.set(recScales, mapLoader.currentOnlineMapService.preselectedRecScaleIndex);
+		scaleInput.setText(recScales[mapLoader.currentOnlineMapService.preselectedRecScaleIndex]);
+		scaleInputPerCache.setText(recScales[mapLoader.currentOnlineMapService.preselectedRecScaleIndex]);
 	}
 
 	/**



From araber95 at mail.berlios.de  Sun Oct 11 13:59:01 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 11 Oct 2009 13:59:01 +0200
Subject: [Cachewolf-svn] r2265 - trunk/src/CacheWolf
Message-ID: <200910111159.n9BBx18Z008071@sheep.berlios.de>

Author: araber95
Date: 2009-10-11 13:58:59 +0200 (Sun, 11 Oct 2009)
New Revision: 2265

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Double entries on renaming Waypoint , see http://www.geoclub.de/viewtopic.php?f=40&t=38591. At least half of the problem should be solved. (next part following soon)

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-10-11 11:58:53 UTC (rev 2264)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-10-11 11:58:59 UTC (rev 2265)
@@ -754,22 +754,15 @@
 		cache.checkIncomplete();
 		
 		/*
-		 * The references have to be rebuilt if: - the cachetype changed from
-		 * addi->normal or normal->addi - the old cachetype or the new cachetype
-		 * were 'addi' and the waypointname has changed
+		 * The references have to be rebuilt if: 
+		 * - the cachetype changed from addi->normal or from normal->addi
+		 * - the old cachetype or the new cachetype were 'addi' and the waypointname has changed
 		 */
-		if (CacheType.isAddiWpt(cache.getType()) != CacheType.isAddiWpt(oldType)
-				|| ((CacheType.isAddiWpt(cache.getType()) || CacheType
-						.isAddiWpt(oldType)) && !cache.getWayPoint()
-						.equals(oldWaypoint))) {
+		if (CacheType.isAddiWpt(cache.getType()) != CacheType.isAddiWpt(oldType) ||
+			((CacheType.isAddiWpt(cache.getType()) || CacheType.isAddiWpt(oldType)) && !cache.getWayPoint().equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
 			//FIXME: if cache was renamed we need to rebuild CacheDB.hashDB first
-			if (CacheType.isAddiWpt(cache.getType())) {
-				profile.setAddiRef(cache);
-			} else {
-				// rebuild links between caches
-				profile.buildReferences();
-			}
+			profile.buildReferences();
 		} else {
 			// set status also on addi wpts
 			cache.setAttributesToAddiWpts();



From salzkammergut at mail.berlios.de  Sun Oct 11 17:50:53 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 11 Oct 2009 17:50:53 +0200
Subject: [Cachewolf-svn] r2266 - trunk/src/CacheWolf
Message-ID: <200910111550.n9BFor7j003433@sheep.berlios.de>

Author: salzkammergut
Date: 2009-10-11 17:50:51 +0200 (Sun, 11 Oct 2009)
New Revision: 2266

Modified:
   trunk/src/CacheWolf/Profile.java
Log:
Profile: Speed up reading and writing by reducing the update frequency of the progress bar

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-10-11 11:58:59 UTC (rev 2265)
+++ trunk/src/CacheWolf/Profile.java	2009-10-11 15:50:51 UTC (rev 2266)
@@ -20,14 +20,14 @@
 
 /**
  * This class holds a profile, i.e. a group of caches with a centre location
- * 
+ *
  * @author salzkammergut
  *
  */
 public class Profile {
 
 	/** The list of caches (CacheHolder objects). A pointer to this object exists in many classes in parallel to
-	 *  this object, i.e. the respective class contains both a {@link Profile} object and a cacheDB Vector. 
+	 *  this object, i.e. the respective class contains both a {@link Profile} object and a cacheDB Vector.
 	 */
 	public CacheDB cacheDB=new CacheDB();
 	/** The centre point of this group of caches. Read from ans stored to index.xml file */
@@ -59,9 +59,9 @@
 	private boolean showBlacklisted = false;
 	private boolean showSearchResult = false;
 
-	public boolean selectionChanged = true; // ("H?ckchen") used by movingMap to get to knao if it should update the caches in the map 
+	public boolean selectionChanged = true; // ("H?ckchen") used by movingMap to get to knao if it should update the caches in the map
 	/** True if the profile has been modified and not saved
-	 * The following modifications set this flag: New profile centre, Change of waypoint data 
+	 * The following modifications set this flag: New profile centre, Change of waypoint data
 	 */
 	private boolean hasUnsavedChanges = false;
 	public boolean byPassIndexActive = false;
@@ -83,7 +83,7 @@
 	/**
 	 * Returns <code>true</code> if profile needs to be changed when profile is left. Returns
 	 * <code>false</code> if no relevant changes have been made.
-	 * 
+	 *
 	 * @return hasUnsavedChanges
 	 */
 	public boolean hasUnsavedChanges() {
@@ -94,14 +94,14 @@
 	 * Remember that profile needs to be saved. Flag is set <code>true</code> when parameter is
 	 * true, but it's not set to <code>false</code> when parameter is <code>false</code>.<br>
 	 * This is only done internally on saving the cache.
-	 * 
+	 *
 	 * @param hasUnsavedChanges
 	 *            the hasUnsavedChanges to set
 	 */
 	public void notifyUnsavedChanges(boolean changes) {
 		hasUnsavedChanges = hasUnsavedChanges || changes;
 	}
-	
+
 	public void resetUnsavedChanges() {
 		hasUnsavedChanges = false;
 	}
@@ -123,25 +123,26 @@
 		this.notifyUnsavedChanges(coords.equals(this.centre));
 		this.centre.set(coords);
 	}
-	
+
 	/**
 	 *	Method to save the index.xml file that holds the total information
 	 *	on available caches in the database. The database is nothing else
 	 *	than the collection of caches in a directory.
-	 *   
-	 *   Not sure whether we need to keep 'pref' in method signature. May eventually remove it. 
-	 *   
+	 *
+	 *   Not sure whether we need to keep 'pref' in method signature. May eventually remove it.
+	 *
 	 *   Saves the index with the filter settings from Filter
 	 */
 //	public void saveIndex(Preferences pref, boolean showprogress){
 //		saveIndex(pref,showprogress, Filter.filterActive,Filter.filterInverted);
 //	}
 
-	
-	/** Save index with filter settings given */ 
-	public void saveIndex(Preferences pref, boolean showprogress) { 
+
+	/** Save index with filter settings given */
+	public void saveIndex(Preferences pref, boolean showprogress) {
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
+		int updFrequ=Vm.isMobile()?10:40; // Number of caches between screen updates
 		if(showprogress){
 			pbf.showMainTask = false;
 			pbf.setTask(h,"Saving Index");
@@ -204,11 +205,11 @@
 			for (int i = 0; i < size; i++) {
 				if (showprogress) {
 					h.progress = (float) i / (float) size;
-					h.changed();
+					if ((i%updFrequ)==0) h.changed();
 				}
 				ch = cacheDB.get(i);
 				// //Vm.debug("Saving: " + ch.CacheName);
-				if (ch.getWayPoint().length() > 0) { 
+				if (ch.getWayPoint().length() > 0) {
 					detfile.print(ch.toXML());
 				}
 			}
@@ -233,7 +234,7 @@
 	 *	than the collection of caches in a directory.
 	 */
 	public void readIndex(InfoBox infoBox) {
-
+		int updFrequ=Vm.isMobile()?10:40; // Number of caches between screen updates
 		try {
 			selectionChanged = true;
 			boolean fmtDec = false;
@@ -249,7 +250,7 @@
 			String text = in.readLine(); // <CACHELIST>
 			if (text!=null && text.indexOf("decimal")>0) fmtDec=true;
 			Extractor ex = new Extractor(null, " = \"", "\" ", 0, true);
-			
+
 			//ewe.sys.Time startT=new ewe.sys.Time();
 			boolean convertWarningDisplayed = false;
 			while ((text = in.readLine()) != null){
@@ -262,7 +263,7 @@
 						}
 					}
 					if (infoBox!=null) {
-						if (wptNo - 10 >= lastShownWpt) {
+						if (wptNo - updFrequ >= lastShownWpt) {
 							infoBox.setInfo(mainInfoText+"\n"+String.valueOf(wptNo));
 							lastShownWpt = wptNo;
 						}
@@ -277,13 +278,13 @@
 						start=text.indexOf("lon=\"")+5;
 						String lon=text.substring(start,text.indexOf("\"",start)).replace(notDecSep,decSep);
 						centre.set(Convert.parseDouble(lat),Convert.parseDouble(lon));
-					} else {	
+					} else {
 						int start=text.indexOf("lat=\"")+5;
 						String lat=SafeXML.cleanback(text.substring(start,text.indexOf("\"",start)));
 						start=text.indexOf("long=\"")+6;
 						String lon=SafeXML.cleanback(text.substring(start,text.indexOf("\"",start)));
 						centre.set(lat+" "+lon,TransformCoordinates.CW); // Fast parse
-					}	
+					}
 				} else if (text.indexOf("<VERSION")>=0) {
 					int start=text.indexOf("value = \"")+9;
 					indexXmlVersion  = Integer.valueOf(text.substring(start,text.indexOf("\"",start))).intValue();
@@ -309,13 +310,13 @@
 					String temp=ex.findNext(); // Filter status is now first, need to deal with old versions which don't have filter status
 					if (temp.length()==2) {
 						// Compatibility with previous versions
-						if (temp.charAt(0)=='T') 
+						if (temp.charAt(0)=='T')
 							setFilterActive(Filter.FILTER_ACTIVE);
 						else
 							setFilterActive(Common.parseInt(temp.substring(0,1)));
 						setFilterInverted(temp.charAt(1)=='T');
 						setFilterRose(ex.findNext());
-					} else 
+					} else
 						setFilterRose(temp);
 					setFilterType(ex.findNext());
 					//Need this to stay "downward" compatible. New type introduced
@@ -376,7 +377,7 @@
 			//ewe.sys.Time endT=new ewe.sys.Time();
 			//Vm.debug("Time="+((((endT.hour*60+endT.minute)*60+endT.second)*1000+endT.millis)-(((startT.hour*60+startT.minute)*60+startT.second)*1000+startT.millis)));
 			//Vm.debug("Start:"+startT.format("H:mm:ss.SSS"));
-			//Vm.debug("End  :"+endT.format("H:mm:ss.SSS"));	
+			//Vm.debug("End  :"+endT.format("H:mm:ss.SSS"));
 			// Build references between caches and addi wpts
 			if (infoBox!=null) {
 				infoBox.setInfo(MyLocale.getMsg(5004,"Building references..."));
@@ -389,21 +390,21 @@
 			Global.getPref().log("index.xml not found in directory "+dataDir); // Normal when profile is opened for first time
 			//e.printStackTrace();
 		} catch (IOException e){
-			Global.getPref().log("Problem reading index.xml in dir: "+dataDir,e,true); 
+			Global.getPref().log("Problem reading index.xml in dir: "+dataDir,e,true);
 		}
 		// TODO Brauchen wir das noch?
 		this.getCurrentFilter().normaliseFilters();
 		resetUnsavedChanges();
 	}
 
-	/** Restore the filter to the values stored in this profile 
-	 *  Called from Main Form and MainMenu 
-	 *  The values of Filter.isActive and Filter.isInactive are set by the filter 
+	/** Restore the filter to the values stored in this profile
+	 *  Called from Main Form and MainMenu
+	 *  The values of Filter.isActive and Filter.isInactive are set by the filter
 	 **/
 	public void restoreFilter() {
-		restoreFilter( true );		
+		restoreFilter( true );
 	}
-	
+
 	void restoreFilter(boolean clearIfInactive) {
 		boolean inverted=isFilterInverted(); // Save it as doFilter will clear filterInverted
 		Filter flt=new Filter();
@@ -423,7 +424,7 @@
 			}
 		}
 	}
-	
+
 	public int getCacheIndex(String wp) {
 		return cacheDB.getIndex(wp);
 	}
@@ -444,7 +445,7 @@
 	}
 
 	/**
-	 * 
+	 *
 	 * @param forcache maincache
 	 * @return
 	 */
@@ -459,7 +460,7 @@
 
 	/**
 	 * Call this after getNewAddiWayPointName to set the references between main and addi correctly
-	 * 
+	 *
 	 * @param ch
 	 */
 	public void setAddiRef(CacheHolder ch) {
@@ -575,12 +576,12 @@
 			ch.addiWpts.clear();
 			ch.mainCache = null;
 		}
-		
+
 		// Build references
 		int max = cacheDB.size();
 		for (int i = 0; i < max; i++) {
 			ch = cacheDB.get(i);
-			if (ch.isAddiWpt()) 
+			if (ch.isAddiWpt())
 				setAddiRef(ch);
 		}
 		// sort addi wpts
@@ -688,13 +689,13 @@
 
 	/**
 	 * If <code>true</code> then the cache list will only display the
-	 * caches that are result of a search.   
+	 * caches that are result of a search.
 	 * @return <code>True</code> if list should only display search results
 	 */
 	public boolean showSearchResult() {
 		return showSearchResult;
 	}
-	
+
 	/**
 	 * Sets parameter if cache list should only display the caches that are
 	 * results of a search.
@@ -758,7 +759,7 @@
 		this.notifyUnsavedChanges(filterNoCoord != this.getFilterNoCoord());
     	this.currentFilter.setFilterNoCoord(filterNoCoord);
     }
-	
+
 	public String getLast_sync_opencaching() {
 		return last_sync_opencaching;
 	}
@@ -789,7 +790,7 @@
 	public String getRelativeCustomMapsPath() {
 		return relativeCustomMapsPath;
 	}
-	
+
 	public void setRelativeCustomMapsPath(String rCMPath) {
 		this.notifyUnsavedChanges(!rCMPath.equals(this.relativeCustomMapsPath));
 		this.relativeCustomMapsPath = rCMPath;
@@ -805,13 +806,13 @@
 	public void setCurrentFilter(FilterData currentFilter) {
     	this.currentFilter = currentFilter;
     }
-	
+
 	private class MyComparer implements ewe.util.Comparer {
 
 		public int compare(Object o1, Object o2) {
 			return ((CacheHolder) o1).getWayPoint().compareTo(
 			        ((CacheHolder) o2).getWayPoint());
 		}
-		
+
 	}
 }



From araber95 at mail.berlios.de  Sun Oct 11 18:23:06 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 11 Oct 2009 18:23:06 +0200
Subject: [Cachewolf-svn] r2267 - trunk/src/CacheWolf
Message-ID: <200910111623.n9BGN6Ev010279@sheep.berlios.de>

Author: araber95
Date: 2009-10-11 18:23:05 +0200 (Sun, 11 Oct 2009)
New Revision: 2267

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/myTableControl.java
Log:
URL in CacheHolder will be got from file only with CacheName (til first &).
Calling in Browser online therefor calls default page with the 5 logs.

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-10-11 15:50:51 UTC (rev 2266)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-10-11 16:23:05 UTC (rev 2267)
@@ -326,6 +326,8 @@
 			dummy = ex.findNext();
 			if (dummy.length() > 10){
 				URL = dummy;
+				int logpos = URL.indexOf("&"); //&Submit &log=y
+				if (logpos > 0) URL=URL.substring(0,logpos);
 			}
 			else {
 				if (getParent().getWayPoint().startsWith("GC")) {

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2009-10-11 15:50:51 UTC (rev 2266)
+++ trunk/src/CacheWolf/myTableControl.java	2009-10-11 16:23:05 UTC (rev 2267)
@@ -256,12 +256,9 @@
 			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
 				CacheHolderDetail chD=ch.getCacheDetails(false, true);
-				String url =chD.URL;
-				int logpos = url.toLowerCase().indexOf("&log=y");
-				if (logpos > 0) url=url.substring(0,logpos) + url.substring(logpos+6,url.length());
 				try {
 					if (chD != null) {
-						CWWrapper.exec(pref.browser, url); // maybe this works on some PDAs?
+						CWWrapper.exec(pref.browser, chD.URL); // maybe this works on some PDAs?
 					}
 				} catch (IOException ex) {
 					(new MessageBox(MyLocale.getMsg(321,"Error"),



From araber95 at mail.berlios.de  Sun Oct 11 19:20:39 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 11 Oct 2009 19:20:39 +0200
Subject: [Cachewolf-svn] r2268 - trunk/src/CacheWolf
Message-ID: <200910111720.n9BHKdil003180@sheep.berlios.de>

Author: araber95
Date: 2009-10-11 19:20:36 +0200 (Sun, 11 Oct 2009)
New Revision: 2268

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Double entries on renaming Waypoint , see http://www.geoclub.de/viewtopic.php?f=40&t=38591. : part two deleting old xml-file

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-10-11 16:23:05 UTC (rev 2267)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-10-11 17:20:36 UTC (rev 2268)
@@ -337,26 +337,27 @@
 			ex = new Extractor(text, "<SOLVER><![CDATA[", "]]></SOLVER>", 0, true);
 			this.setSolver(ex.findNext());
 		}
-		
-		/**
-		*	Method to save a cache.xml file.
-		*/
-		public void saveCacheDetails(String dir){
-			PrintWriter detfile;
-			
+		public void deleteFile(String FileName) {	
 			//File exists?
-			boolean exists = (new File(dir + getParent().getWayPoint() + ".xml")).exists();
+			boolean exists = (new File(FileName)).exists();
 			//yes: then delete
 			if (exists) {
-				boolean ok = (new File(dir + getParent().getWayPoint() + ".xml")).delete();
+				boolean ok = (new File(FileName)).delete();
 				if(ok) ok = true;
 			}
-			boolean exists2 = (new File(dir + getParent().getWayPoint().toLowerCase() + ".xml")).exists();
+			boolean exists2 = (new File(FileName.toLowerCase())).exists();
 			//yes: delete
 			if (exists2) {
-				boolean ok2 = (new File(dir + getParent().getWayPoint().toLowerCase() + ".xml")).delete();
+				boolean ok2 = (new File(FileName.toLowerCase())).delete();
 				if(ok2) ok2=true;
 			}
+		}
+		/**
+		*	Method to save a cache.xml file.
+		*/
+		public void saveCacheDetails(String dir){
+			PrintWriter detfile;
+			deleteFile(dir + getParent().getWayPoint() + ".xml");
 			//Vm.debug("Writing to: " +dir + "for: " + wayPoint);
 			try{
 			  detfile = new PrintWriter(new BufferedWriter(new FileWriter(new FileBugfix(dir + getParent().getWayPoint().toLowerCase() + ".xml").getAbsolutePath())));

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-10-11 16:23:05 UTC (rev 2267)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-10-11 17:20:36 UTC (rev 2268)
@@ -775,6 +775,10 @@
 		dirtyDetails = false;
 		needsTableUpdate = false;
 		cache.getFreshDetails().hasUnsavedChanges = true;
+		if (!oldWaypoint.equals(cache.getWayPoint())){
+		 // Delete old XML - File
+			cache.getFreshDetails().deleteFile(Global.getProfile().dataDir+oldWaypoint+".xml");
+		}		
 	}
 	
 	/**



From salzkammergut at mail.berlios.de  Sun Oct 11 21:24:03 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 11 Oct 2009 21:24:03 +0200
Subject: [Cachewolf-svn] r2269 - trunk/lib
Message-ID: <200910111924.n9BJO3jF012567@sheep.berlios.de>

Author: salzkammergut
Date: 2009-10-11 21:22:30 +0200 (Sun, 11 Oct 2009)
New Revision: 2269

Modified:
   trunk/lib/JavaEwe.zip
   trunk/lib/ewe.jar
Log:
EWE Library: Fix for paste error.
(Could not overwrite a highlighted text with Strg-V)

Modified: trunk/lib/JavaEwe.zip
===================================================================
(Binary files differ)

Modified: trunk/lib/ewe.jar
===================================================================
(Binary files differ)



From araber95 at mail.berlios.de  Sun Oct 11 21:53:03 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 11 Oct 2009 21:53:03 +0200
Subject: [Cachewolf-svn] r2270 - trunk/src/CacheWolf
Message-ID: <200910111953.n9BJr3Sh015528@sheep.berlios.de>

Author: araber95
Date: 2009-10-11 21:53:01 +0200 (Sun, 11 Oct 2009)
New Revision: 2270

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Deleting directry :so we do it this way : Should have never started this

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-11 19:22:30 UTC (rev 2269)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-11 19:53:01 UTC (rev 2270)
@@ -886,6 +886,22 @@
 		savePreferences();
 		return true;
 	}
+	
+	  static public boolean deleteDirectory(File path) {
+		    if( path.exists() ) {
+		      String[] files = path.list();
+		      for(int i=0; i<files.length; i++) {
+		    	 File f = path.getNew(path + "/" + files[i]);
+		         if(f.isDirectory()) {
+		           deleteDirectory(f);
+		         }
+		         else {
+		        	 f.delete();
+		         }
+		      }
+		    }
+		    return( path.delete() );
+		  }
 
 	public void deleteProfile() {
 		checkAbsoluteBaseDir(); // perhaps not necessary
@@ -898,7 +914,7 @@
 			new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(227,"[active profile cannot be deleted.]"),FormBase.MBOK).execute();
 		}
 		else {
-			if (!(new FileBugfix(absoluteBaseDir+f.newSelectedProfile).delete()) ) {
+			if (!deleteDirectory(new File(absoluteBaseDir+f.newSelectedProfile)) ) {
 				// Fehler beim l?schen des Profils;
 				new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(226,"[Profile cannot be deleted.]"),FormBase.MBOK).execute();
 			}



From pfeffer at mail.berlios.de  Mon Oct 12 02:20:03 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 12 Oct 2009 02:20:03 +0200
Subject: [Cachewolf-svn] r2271 - trunk/src/CacheWolf
Message-ID: <200910120020.n9C0K3mp017558@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-12 02:19:59 +0200 (Mon, 12 Oct 2009)
New Revision: 2271

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/Profile.java
Log:
DetailsPanel: fixed NullPointerException, which happened if there is an Addi to a custom waypoint
setIncomplete: avoid marking custom waypoints without name as incomplete
DetailsPanel: avoid unnecessary object creation


Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-10-11 19:53:01 UTC (rev 2270)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-10-12 00:19:59 UTC (rev 2271)
@@ -1381,7 +1381,7 @@
 					|| getWayPoint().length() < 3
 //					|| getCacheOwner().length() > 0
 //					|| getDateHidden().length() > 0 
-					|| getCacheName().length() == 0
+//					|| getCacheName().length() == 0
 					)
 				ret = true;
 			else

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2009-10-11 19:53:01 UTC (rev 2270)
+++ trunk/src/CacheWolf/CacheType.java	2009-10-12 00:19:59 UTC (rev 2271)
@@ -314,29 +314,19 @@
 		case CW_TYPE_REFERENCE: return true;
 		default: return false;
 		}
-		
 	}
-	
+	/**
+	 * this is the same as !isAddiWpt except that CW_TYPE_CUSTUM and CW_TYPE_ERROR return false
+	 * I (pfeffer) don't know if this behaviour is intended, I guess it is.
+	 * @param type
+	 * @return
+	 */
 	public static boolean isCacheWpt(final byte type) {
 		switch (type) {
-		case CW_TYPE_TRADITIONAL: // fall through
-		case CW_TYPE_MULTI: // fall through
-		case CW_TYPE_VIRTUAL: // fall through
-		case CW_TYPE_LETTERBOX: // fall through
-		case CW_TYPE_EVENT: // fall through
-		case CW_TYPE_QUIZ: // fall through
-		case CW_TYPE_UNKNOWN: // fall through
-		case CW_TYPE_MOVING: // fall through
-		case CW_TYPE_DRIVE_IN: // fall through
-		case CW_TYPE_WEBCAM: // fall through
-		case CW_TYPE_LOCATIONLESS: // fall through
-		case CW_TYPE_CITO: // fall through
-		case CW_TYPE_MEGA_EVENT: // fall through
-		case CW_TYPE_WHEREIGO: // fall through
-		case CW_TYPE_EARTH: // fall through
-		case CW_TYPE_APE: // fall through
-		case CW_TYPE_MAZE: return true;
-		default: return false;
+		case CW_TYPE_CUSTOM:
+		case CW_TYPE_ERROR:
+			return false;
+		default: return !isAddiWpt(type);
 		}
 	}
 	

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-10-11 19:53:01 UTC (rev 2270)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-10-12 00:19:59 UTC (rev 2271)
@@ -790,8 +790,6 @@
 	 * @return 0 for additional or custum waypoints, -1 for caches if td is not valid, parsed byte otherwise
 	 */
 	private byte decodeTerrDiff(mButton button, String td, boolean isCache) {
-		final StringBuffer tdv = new StringBuffer(2);
-		
 		// terrain and difficulty are always unset for non cache waypoints
 		if (! isCache) return CacheTerrDiff.CW_DT_UNSET;
 		
@@ -800,6 +798,7 @@
 		// we now should have a string of length 3
 		if (buttonText.length() != 3) return -1;
 
+		final StringBuffer tdv = new StringBuffer(2);
 		buttonText=tdv.append(buttonText.charAt(0)).append(buttonText.charAt(2)).toString();
 
 		// unset value is invalid

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-10-11 19:53:01 UTC (rev 2270)
+++ trunk/src/CacheWolf/Profile.java	2009-10-12 00:19:59 UTC (rev 2271)
@@ -470,13 +470,13 @@
 			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_CZ_PATTERN + mainwpt);
 		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
 			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_DE_PATTERN + mainwpt);
-//		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
-//			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_PL_PATTERN + mainwpt);
 		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
+			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_PL_PATTERN + mainwpt);
+		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
 			mainindex = getCacheIndex(OCXMLImporter.OPENCACHING_UK_PATTERN + mainwpt);
 		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt())
 			mainindex = getCacheIndex("CW" + mainwpt);
-		if (mainindex < 0 || !cacheDB.get(mainindex).isCacheWpt()) {
+		if (mainindex < 0 /* || !cacheDB.get(mainindex)..isCacheWpt() */ )  {
 			ch.setIncomplete(true);
 		} else {
 			CacheHolder mainch = cacheDB.get(mainindex);



From pfeffer at mail.berlios.de  Mon Oct 12 14:33:08 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 12 Oct 2009 14:33:08 +0200
Subject: [Cachewolf-svn] r2272 - trunk/src/CacheWolf/navi
Message-ID: <200910121233.n9CCX8j6007051@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-12 14:33:06 +0200 (Mon, 12 Oct 2009)
New Revision: 2272

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
MovingMap: Bug fixed: if GPS is started before the MovingMap is started, GPS stopped providing updates. See http://www.geoclub.de/viewtopic.php?f=40&t=38813 It was caused by a NullpointerException.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-12 00:19:59 UTC (rev 2271)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-12 12:33:06 UTC (rev 2272)
@@ -2664,7 +2664,7 @@
 				if (sunDirArrow == null ) sunDirArrow = new Point[2];
 				makeArrow(sunDirArrow, sunDir, 0.75f);
 			} else sunDirArrow = null;
-			if (java.lang.Math.abs(map.rotationRad) > 1.5 / 180 * java.lang.Math.PI)	{ // show northth arrow only if it has more than 1.5 degree deviation from vertical direction
+			if (map != null && java.lang.Math.abs(map.rotationRad) > 1.5 / 180 * java.lang.Math.PI)	{ // show northth arrow only if it has more than 1.5 degree deviation from vertical direction
 				if (northDirArrow == null) northDirArrow = new Point[2];
 				makeArrow(northDirArrow, 0, 1.0f); // north direction
 			} else northDirArrow = null;



From araber95 at mail.berlios.de  Mon Oct 12 17:37:47 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 12 Oct 2009 17:37:47 +0200
Subject: [Cachewolf-svn] r2273 - trunk/src/CacheWolf
Message-ID: <200910121537.n9CFblv8023727@sheep.berlios.de>

Author: araber95
Date: 2009-10-12 17:37:43 +0200 (Mon, 12 Oct 2009)
New Revision: 2273

Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
Log:
Version 2 of deleting and renaming profile

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-10-12 12:33:06 UTC (rev 2272)
+++ trunk/src/CacheWolf/MainMenu.java	2009-10-12 15:37:43 UTC (rev 2273)
@@ -307,10 +307,10 @@
 				}
 			}
 			if(mev.selectedItem == mnuDeleteProfile) {
-				pref.deleteProfile();
+				pref.editProfile(2,227,226);
 			}
 			if(mev.selectedItem == mnuRenameProfile) {
-				pref.renameProfile(getFrame());
+				pref.editProfile(3,228,229);
 			}
 			if(mev.selectedItem == mnuEditCenter){
 				ProfileDataForm f=new ProfileDataForm(pref,profile);

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-12 12:33:06 UTC (rev 2272)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-12 15:37:43 UTC (rev 2273)
@@ -887,62 +887,54 @@
 		return true;
 	}
 	
-	  static public boolean deleteDirectory(File path) {
-		    if( path.exists() ) {
-		      String[] files = path.list();
-		      for(int i=0; i<files.length; i++) {
-		    	 File f = path.getNew(path + "/" + files[i]);
-		         if(f.isDirectory()) {
-		           deleteDirectory(f);
-		         }
-		         else {
-		        	 f.delete();
-		         }
-		      }
+	static public boolean deleteDirectory(FileBugfix path) {
+	    if( path.exists() ) {
+	    	String[] files = path.list();
+	    	for(int i=0; i<files.length; i++) {
+	    		FileBugfix f = new FileBugfix(path.getFullPath() + "/" + files[i]);
+		        if(f.isDirectory()) {
+		        	deleteDirectory(f);
+		        }
+		        else {
+		        	f.delete();
+		        }
+		     }
 		    }
-		    return( path.delete() );
-		  }
+	    return( path.delete() );
+	}
 
-	public void deleteProfile() {
-		checkAbsoluteBaseDir(); // perhaps not necessary
-		ProfilesForm f = new ProfilesForm(absoluteBaseDir,"",2);
-		int code = f.execute();
-		// If no profile chosen (includes a new one), terminate
-		if (code==-1) return; // Cancel pressed
-		if (lastProfile.equals(f.newSelectedProfile)) {
-			// aktives Profil kann nicht gel?scht / umbenannt werden;
-			new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(227,"[active profile cannot be deleted.]"),FormBase.MBOK).execute();
-		}
-		else {
-			if (!deleteDirectory(new File(absoluteBaseDir+f.newSelectedProfile)) ) {
-				// Fehler beim l?schen des Profils;
-				new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(226,"[Profile cannot be deleted.]"),FormBase.MBOK).execute();
-			}
-		}
+	static public boolean renameDirectory(FileBugfix OldPath, FileBugfix NewPath) {
+	    return OldPath.renameTo(NewPath);		
 	}
 
-	public void renameProfile(ewe.ui.Frame parent) {
-		// not yet implemented
-		/*
+	/* 
+	 * operation 2=delete 3=rename
+	 */
+	public void editProfile(int operation, int ErrorMsgActive, int ErrorMsg) {
 		checkAbsoluteBaseDir(); // perhaps not necessary
-		ProfilesForm f = new ProfilesForm(absoluteBaseDir,"",3);
-		int code = f.execute();
-		// If no profile chosen (includes a new one), terminate
-		if (code==-1) return; // Cancel pressed
+		// select profile
+		ProfilesForm f = new ProfilesForm(absoluteBaseDir,"",operation);
+		if (f.execute()==-1) return ; // no select
+		// check selection
 		if (lastProfile.equals(f.newSelectedProfile)) {
 			// aktives Profil kann nicht gel?scht / umbenannt werden;
-			new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(228,"[active profile cannot be renamed.]"),FormBase.MBOK).execute();
+			new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(ErrorMsgActive,"[Profile active...]"),FormBase.MBOK).execute();
 		}
 		else {
-			NewProfileForm x=new NewProfileForm(absoluteBaseDir);
-			x.execute(parent, Gui.CENTER_FRAME);
-			if (!(new FileBugfix(absoluteBaseDir+f.newSelectedProfile).rename(x.profileDir))) {
-				// Fehler beim l?schen des Profils;
-				new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(229,"[Profile cannot be renamed.]"),FormBase.MBOK).execute();
+			boolean err=true;
+			if (operation==3) {
+				String newName = new InputBox("Bitte neuen Verzeichnisnamen eingeben : ").input("",50);
+				if (!newName.equals(null)) {
+					err=!renameDirectory(new FileBugfix(absoluteBaseDir+f.newSelectedProfile),new FileBugfix(absoluteBaseDir+newName));
+				}
 			}
+			else 
+			if (operation==2){
+				err=!deleteDirectory(new FileBugfix(absoluteBaseDir+f.newSelectedProfile));
+				// ? wait until deleted ?
+			}
+			if (err) {new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(ErrorMsg,"[Profile Error...]"),FormBase.MBOK).execute();}
 		}
-		*/		
-		new MessageBox(MyLocale.getMsg(321,"Error"),"Noch nicht implementiert. Nutzen Sie solange das Betriebssystem um das Profilverzeichnis umzubenennen!",FormBase.MBOK).execute();
 	}
     //////////////////////////////////////////////////////////////////////////////////////
     // Log functions



From mik77 at mail.berlios.de  Mon Oct 12 19:19:17 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 12 Oct 2009 19:19:17 +0200
Subject: [Cachewolf-svn] r2274 - trunk/src/CacheWolf/navi
Message-ID: <200910121719.n9CHJHtq024529@sheep.berlios.de>

Author: mik77
Date: 2009-10-12 19:19:15 +0200 (Mon, 12 Oct 2009)
New Revision: 2274

Modified:
   trunk/src/CacheWolf/navi/Navigate.java
Log:
Try/catch to prevent stopping of UpdateThread.

Modified: trunk/src/CacheWolf/navi/Navigate.java
===================================================================
--- trunk/src/CacheWolf/navi/Navigate.java	2009-10-12 15:37:43 UTC (rev 2273)
+++ trunk/src/CacheWolf/navi/Navigate.java	2009-10-12 17:19:15 UTC (rev 2274)
@@ -368,7 +368,9 @@
 			try { sleep (calldelay);} catch (InterruptedException e) {
 				Global.getPref().log("Ignored Exception", e, true);
 			}
-			ticked.ticked();
+			try { ticked.ticked();} catch (Exception e) {
+				Global.getPref().log("Ignored Exception", e, true);
+			}
 		}
 	}
 



From pfeffer at mail.berlios.de  Mon Oct 12 21:52:23 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Mon, 12 Oct 2009 21:52:23 +0200
Subject: [Cachewolf-svn] r2275 - trunk/src/CacheWolf/navi
Message-ID: <200910121952.n9CJqNBd010078@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-12 21:52:21 +0200 (Mon, 12 Oct 2009)
New Revision: 2275

Modified:
   trunk/src/CacheWolf/navi/Navigate.java
Log:
Navigate provide a better bug-log message

Modified: trunk/src/CacheWolf/navi/Navigate.java
===================================================================
--- trunk/src/CacheWolf/navi/Navigate.java	2009-10-12 17:19:15 UTC (rev 2274)
+++ trunk/src/CacheWolf/navi/Navigate.java	2009-10-12 19:52:21 UTC (rev 2275)
@@ -365,11 +365,9 @@
 	public void run () {
 		run = true;
 		while (run) {
-			try { sleep (calldelay);} catch (InterruptedException e) {
-				Global.getPref().log("Ignored Exception", e, true);
-			}
+			try { sleep (calldelay);} catch (InterruptedException e) {	}
 			try { ticked.ticked();} catch (Exception e) {
-				Global.getPref().log("Ignored Exception", e, true);
+				Global.getPref().log("Navigate.UpdateThread.run(): Ignored Exception. There should not be an Exception, so please report it in the cachewolf forum at www.geoclub.de", e, true);
 			}
 		}
 	}



From araber95 at mail.berlios.de  Tue Oct 13 16:10:57 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 13 Oct 2009 16:10:57 +0200
Subject: [Cachewolf-svn] r2276 - trunk/src/CacheWolf/navi
Message-ID: <200910131410.n9DEAvsn013354@sheep.berlios.de>

Author: araber95
Date: 2009-10-13 16:10:56 +0200 (Tue, 13 Oct 2009)
New Revision: 2276

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Doing repaint instead of repaintnow gives quicker response.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-12 19:52:21 UTC (rev 2275)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-13 14:10:56 UTC (rev 2276)
@@ -976,7 +976,7 @@
 			updateSymbolPositions();
 			updateDistance(false);
 			if (updateOverlay ) updateOverlayPos(); // && TrackOverlays != null
-			mmp.repaintNow();
+			repaint(); // don't wait
 		}
 		else
 		{
@@ -1011,17 +1011,16 @@
 		forceMapLoad |= lastWidth != width || lastHeight != height;
 		if (forceMapLoad || wantMapTest || screenNotCompletlyCovered) { // if force || want || map doesn't cover the screen completly
 			// Vm.debug("Screen not completly covered by map");
-			if (forceMapLoad
-					|| (java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
+			if (forceMapLoad ||
+				(java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || 
+				 java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
 				// more then 1/10 of screen moved since last time we tried to find a better map
 				if (autoSelectMap) {
 					setBestMap(where, screenNotCompletlyCovered);
 					forceMapLoad = false;
 				}
 				showCachesOnMap();
-				if (isFillWhiteArea()) {
-					fillWhiteArea(screenNotCompletlyCovered);
-				}
+				if (isFillWhiteArea()) { fillWhiteArea(screenNotCompletlyCovered); }
 				lastCompareX = mapPos.x;
 				lastCompareY = mapPos.y;
 			}
@@ -2283,27 +2282,27 @@
 							mapsMenu.close ();
 							mm.setFillWhiteArea(false);
 							mm.updatePosition (mm.posCircle.where);
-							repaintNow();
+							repaint();
 						}
 						else if (action == noFillMapMI){
 							mapsMenu.close ();
 							mm.setFillWhiteArea(true);
 							mm.updatePosition (mm.posCircle.where);
-							repaintNow();
+							repaint();
 						}
 						else if (action == showCachesOnMapMI){
 							mapsMenu.close ();
 							mm.setShowCachesOnMap(true);
 							mm.forceMapLoad=true;
 							mm.updatePosition (mm.posCircle.where);
-							repaintNow();
+							repaint();
 						}
 						else if (action == noShowCachesOnMapMI){
 							mapsMenu.close ();
 							mm.setShowCachesOnMap(false);
 							mm.forceMapLoad=true;
 							mm.updatePosition (mm.posCircle.where);
-							repaintNow();
+							repaint();
 						}
 						//dont show map
 						else if (action == hideMapMI) {



From araber95 at mail.berlios.de  Tue Oct 13 16:15:33 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 13 Oct 2009 16:15:33 +0200
Subject: [Cachewolf-svn] r2277 - trunk/resources
Message-ID: <200910131415.n9DEFXU5014142@sheep.berlios.de>

Author: araber95
Date: 2009-10-13 16:15:31 +0200 (Tue, 13 Oct 2009)
New Revision: 2277

Added:
   trunk/resources/sortdown.png
   trunk/resources/sortup.png
Log:
Icons for showing sorting direction

Added: trunk/resources/sortdown.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/sortdown.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/sortup.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/sortup.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From araber95 at mail.berlios.de  Tue Oct 13 17:56:05 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 13 Oct 2009 17:56:05 +0200
Subject: [Cachewolf-svn] r2278 - trunk/src/CacheWolf
Message-ID: <200910131556.n9DFu5tD027519@sheep.berlios.de>

Author: araber95
Date: 2009-10-13 17:56:02 +0200 (Tue, 13 Oct 2009)
New Revision: 2278

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
now you can see icons in columnheading showing sortorder. correcting startorder for first click to ascending (has been descending)

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-10-13 14:15:31 UTC (rev 2277)
+++ trunk/src/CacheWolf/myTableModel.java	2009-10-13 15:56:02 UTC (rev 2278)
@@ -64,7 +64,8 @@
 	public static mImage red, blue, yellow; // skull, green
 	private Image checkboxTicked,checkboxUnticked;
 	private mImage bug;
-	private boolean sortAsc = false;
+    private static mImage imgSortUp, imgSortDown;
+	private boolean sortAscending = false;
 	private int sortedBy = -1;
 	private FontMetrics fm;
 //	private mImage picSizeMicro,picSizeSmall,picSizeReg,picSizeLarge,picSizeVLarge,picSizeNonPhysical;
@@ -99,6 +100,8 @@
 		bug = new mImage("bug_table.png");bug.transparentColor=Color.DarkBlue;
 		checkboxTicked = new Image("checkboxTicked.png");
 		checkboxUnticked= new Image("checkboxUnticked.png");
+		imgSortUp = new mImage( "sortup.png" ); imgSortUp.transparentColor = Color.White;
+		imgSortDown = new mImage( "sortdown.png" ); imgSortDown.transparentColor = Color.White;
 
 //		picSizeMicro=new mImage("sizeMicro.png"); picSizeMicro.transparentColor=Color.White;
 //		picSizeSmall=new mImage("sizeSmall.png"); picSizeSmall.transparentColor=Color.White;
@@ -170,7 +173,7 @@
 						if(ch.mainCache != null) { // parent exists
 							if (! ch.mainCache.isVisible())
 								sortDB.add(ch); // Unfiltered Addi Wpt with filtered Main Wpt, show it on its own
-							// else 
+							// else
 							// Main cache is not filtered, Addi will be added below main cache further down
 							// This case doesn't seem to be a problem. It occurs regularly, when
 							// filtered addis are unfiltered, so there is not need to log this case.
@@ -304,7 +307,27 @@
 	}
 
 	public Object getCellData(int row, int col){
-		if(row == -1) return colName[colMap[col]];
+		// if(row == -1) return colName[colMap[col]];
+		if(row == -1)
+        {
+            if( sortedBy > 0 && colMap[col] == sortedBy )
+            {
+                if( sortAscending )
+                {
+                    return new IconAndText( imgSortUp, colName[colMap[col]], fm);
+                    //return "^ "+colName[colMap[col]];
+                }
+                else
+                {
+                    return new IconAndText( imgSortDown, colName[colMap[col]], fm);
+                    //return "v "+colName[colMap[col]];
+                }
+            }
+            else
+            {
+                return colName[colMap[col]];
+            }
+        }
 		try { // Access to row can fail if many caches are deleted
 			CacheHolder ch = cacheDB.get(row);
 			if(ch!=null /*ch.isVisible()*/){ // Check of visibility needed here??
@@ -449,10 +472,10 @@
 				Vm.showWait(true);
 				Point a = tcControl.getSelectedCell(null);
 				if((a != null) && (a.y >= 0) && (a.y < cacheDB.size())) ch = cacheDB.get(a.y);
-				if (mappedCol == sortedBy) sortAsc=!sortAsc;
-				else sortAsc = false;
+				if (mappedCol == sortedBy) sortAscending=!sortAscending;
+				else sortAscending = true; // always start ascending 
 				sortedBy = mappedCol;
-				cacheDB.sort(new MyComparer(cacheDB, mappedCol,numRows), sortAsc);
+				cacheDB.sort(new MyComparer(cacheDB, mappedCol,numRows), !sortAscending);
 				updateRows();
 				if(a != null && ch!=null){
 					int rownum = Global.getProfile().getCacheIndex(ch.getWayPoint());



From araber95 at mail.berlios.de  Tue Oct 13 17:57:25 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 13 Oct 2009 17:57:25 +0200
Subject: [Cachewolf-svn] r2279 - trunk/src/CacheWolf
Message-ID: <200910131557.n9DFvP10027583@sheep.berlios.de>

Author: araber95
Date: 2009-10-13 17:57:23 +0200 (Tue, 13 Oct 2009)
New Revision: 2279

Modified:
   trunk/src/CacheWolf/MyComparer.java
Log:
changed sortorder for bearing : ? (none) at the end

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2009-10-13 15:56:02 UTC (rev 2278)
+++ trunk/src/CacheWolf/MyComparer.java	2009-10-13 15:57:23 UTC (rev 2279)
@@ -66,15 +66,22 @@
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=cacheDB.get(i);
 				// CHECK Is the formatting correctly done?
-				ch.sort = MyLocale.formatDouble(ch.kilom*1000, "000000000000");
 				if (ch.kilom==-1.0) {
 					ch.sort="\uFFFF";
 				}
+				else {
+					ch.sort = MyLocale.formatDouble(ch.kilom*1000, "000000000000");
+				}
 			}
 		} else if (colToCompare==11) {
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.bearing;
+				if (ch.bearing.equals("?")) {
+					ch.sort="\uFFFF";
+				}
+				else {
+					ch.sort=ch.bearing;
+				}			
 			}
 			
 		} else if (colToCompare==12) {



From salzkammergut at mail.berlios.de  Tue Oct 13 21:27:31 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 13 Oct 2009 21:27:31 +0200
Subject: [Cachewolf-svn] r2280 - trunk/programs
Message-ID: <200910131927.n9DJRV02025812@sheep.berlios.de>

Author: salzkammergut
Date: 2009-10-13 21:26:35 +0200 (Tue, 13 Oct 2009)
New Revision: 2280

Modified:
   trunk/programs/JewelData.jar
Log:
EWE Libary: Modified JewelData.jar for EWE Strg-V bug
Attention: Removed ewe/database (=database library) as this is not used in Cachewolf

Modified: trunk/programs/JewelData.jar
===================================================================
(Binary files differ)



From araber95 at mail.berlios.de  Tue Oct 13 21:48:38 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 13 Oct 2009 21:48:38 +0200
Subject: [Cachewolf-svn] r2281 - trunk/src/CacheWolf
Message-ID: <200910131948.n9DJmcUH027285@sheep.berlios.de>

Author: araber95
Date: 2009-10-13 21:48:37 +0200 (Tue, 13 Oct 2009)
New Revision: 2281

Modified:
   trunk/src/CacheWolf/MyComparer.java
Log:
leading spaces disturb my feeling of sortorder

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2009-10-13 19:26:35 UTC (rev 2280)
+++ trunk/src/CacheWolf/MyComparer.java	2009-10-13 19:48:37 UTC (rev 2281)
@@ -40,7 +40,7 @@
 		} else if (colToCompare==5) {
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=cacheDB.get(i);
-				ch.sort=ch.getCacheName().toLowerCase();
+				ch.sort=ch.getCacheName().trim().toLowerCase();
 			}
 		} else if (colToCompare==6) {
 			for (int i=0; i<visibleSize; i++) {



From salzkammergut at mail.berlios.de  Tue Oct 13 23:34:24 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 13 Oct 2009 23:34:24 +0200
Subject: [Cachewolf-svn] r2282 - trunk/src/CacheWolf
Message-ID: <200910132134.n9DLYOdh001606@sheep.berlios.de>

Author: salzkammergut
Date: 2009-10-13 23:34:22 +0200 (Tue, 13 Oct 2009)
New Revision: 2282

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Preferences: Bugfix. setCurrentCentreFromGPSPosition could not be saved as "false" - always reloaded as "true".

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-13 19:48:37 UTC (rev 2281)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-13 21:34:22 UTC (rev 2282)
@@ -122,7 +122,7 @@
 	/** If true, the last profile is reloaded automatically without a dialogue */
 	public boolean autoReloadLastProfile=false;
 	/** If true current cetre will be set from gps position	 */
-	public boolean setCurrentCentreFromGPSPosition=true;
+	public boolean setCurrentCentreFromGPSPosition=false;
 	/** This is the login alias for geocaching.com and opencaching.de */
 	public String myAlias = "";
 	/** Optional password */
@@ -886,7 +886,7 @@
 		savePreferences();
 		return true;
 	}
-	
+
 	static public boolean deleteDirectory(FileBugfix path) {
 	    if( path.exists() ) {
 	    	String[] files = path.list();
@@ -904,10 +904,10 @@
 	}
 
 	static public boolean renameDirectory(FileBugfix OldPath, FileBugfix NewPath) {
-	    return OldPath.renameTo(NewPath);		
+	    return OldPath.renameTo(NewPath);
 	}
 
-	/* 
+	/*
 	 * operation 2=delete 3=rename
 	 */
 	public void editProfile(int operation, int ErrorMsgActive, int ErrorMsg) {
@@ -928,7 +928,7 @@
 					err=!renameDirectory(new FileBugfix(absoluteBaseDir+f.newSelectedProfile),new FileBugfix(absoluteBaseDir+newName));
 				}
 			}
-			else 
+			else
 			if (operation==2){
 				err=!deleteDirectory(new FileBugfix(absoluteBaseDir+f.newSelectedProfile));
 				// ? wait until deleted ?



From araber95 at mail.berlios.de  Thu Oct 15 23:53:22 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 15 Oct 2009 23:53:22 +0200
Subject: [Cachewolf-svn] r2283 - in trunk: res_noewe/languages resources
	src/CacheWolf
Message-ID: <200910152153.n9FLrMJ5013690@sheep.berlios.de>

Author: araber95
Date: 2009-10-15 23:53:16 +0200 (Thu, 15 Oct 2009)
New Revision: 2283

Added:
   trunk/resources/nosort.png
   trunk/resources/nosort_vga.png
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/TablePanel.java
   trunk/src/CacheWolf/myTableModel.java
Log:
preparation for changing to possibility of autosort (http://www.geoclub.de/viewtopic.php?f=40&t=38566&start=50)

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-13 21:34:22 UTC (rev 2282)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-15 21:53:16 UTC (rev 2283)
@@ -742,9 +742,9 @@
 		4407=Die vorgefundenen Dateien entsprechen nicht dem aktuellen Format.%0aDaher werden sie nun in das aktuelle Format konvertiert. Abh%e4ngig von der Gr%f6%dfe des Profils und dem verwendeten Rechner kann das einige Minuten dauern. Wir bitten um Geduld.
 		4408=Konnte keine Verbindung zum GPSD herstellen:
 		4409=%0aM%f6gliche Gr%fcnde:%0a Adresse/Port falsch%0a GPSD l%e4uft dort nicht
-		4500=Ges:
-		4501=Gez:
-		4502=Gef:
+		4500=Alle:
+		4501=Sehe:
+		4502=Fund:
 		4600=Nicht alle Caches k%f6nnen angezeigt werden. Inkompatibler Blacklist-Status.
 		4700=Ignoriere Fehler beim%0aLaden der Kalibrierungsdatei%0a
 		4701=Suche nach bester Karte

Added: trunk/resources/nosort.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/nosort.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/nosort_vga.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/nosort_vga.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2009-10-13 21:34:22 UTC (rev 2282)
+++ trunk/src/CacheWolf/StatusBar.java	2009-10-15 21:53:16 UTC (rev 2283)
@@ -25,35 +25,45 @@
 	private mButton btnCacheTour;
 	private mImage imgCacheTour;
 	private boolean MobileVGA;
-	
+	private mImage imgNoSorting;
+	private mButton btnNoSorting;
+	private myTableModel table;
+
+	public void setMyTableModel(myTableModel myTableModel) {
+		table=myTableModel;
+	}
+
 	public StatusBar(Preferences p, CacheDB db){
 		pref=p;
 		MobileVGA = pref.useBigIcons;
 		String imagesize="";
-		if(MobileVGA) imagesize="_vga";  
+		if(MobileVGA) imagesize="_vga";
 		addNext(btnCacheTour=new mButton(imgCacheTour=new mImage("cachetour"+imagesize+".png")),CellConstants.DONTSTRETCH, CellConstants.DONTFILL);
 		imgCacheTour.transparentColor=Color.White;
 		if(MobileVGA)
 			btnCacheTour.setPreferredSize(28,20);
 		else
 			btnCacheTour.setPreferredSize(20,13);
-		btnCacheTour.borderWidth=0; 
+		btnCacheTour.borderWidth=0;
 		btnCacheTour.setToolTip(MyLocale.getMsg(197,"Show/Hide cachetour"));
-		addNext(btnFlt= new mButton(imgFlt=new mImage("filter" + imagesize + ".png")),CellConstants.DONTSTRETCH, CellConstants.DONTFILL); 
-		btnFlt.backGround=new ewe.fx.Color(0,255,0); 
-		if(MobileVGA)
-			btnFlt.setPreferredSize(28,20);
-		else
-			btnFlt.setPreferredSize(20,13);
+
+		addNext(btnFlt= new mButton(imgFlt=new mImage("filter" + imagesize + ".png")),CellConstants.DONTSTRETCH, CellConstants.DONTFILL);
+		btnFlt.backGround=new ewe.fx.Color(0,255,0);
 		btnFlt.borderWidth=0; imgFlt.transparentColor=Color.White;
-		btnFlt.setToolTip("Filter status");
+		btnFlt.setToolTip("Klick : Filter");
+
+		addNext(btnNoSorting=new mButton(imgNoSorting=new mImage("nosort" + imagesize + ".png")),CellConstants.DONTSTRETCH, CellConstants.FILL);
+		btnNoSorting.borderWidth=0; imgNoSorting.transparentColor=Color.White;
+		btnNoSorting.setToolTip("Klick : Keine Sortierung");
+
 		stats = new DBStats(db);
 		addNext(disp = new mLabel(""),CellConstants.DONTSTRETCH, CellConstants.FILL);
 		disp.setToolTip(MyLocale.getMsg(196,"Total # of caches (GC&OC)\nTotal # visible\nTotal # found"));
+
 		addLast(lblCenter=new mLabel(""),CellConstants.STRETCH, WEST|CellConstants.FILL);
 		lblCenter.setToolTip(MyLocale.getMsg(195,"Current centre"));
 	}
-	
+
 	public void updateDisplay(){
 		String strStatus, strCenter="";
 		strStatus = MyLocale.getMsg(4500,"Tot:") + " " + stats.total() + " " +
@@ -72,13 +82,13 @@
 		// Current centre can only be displayed if screen is big
 		// Otherwise it forces a scrollbar
 		// This can happen even on bigger screens with big fonts
-		if ((MyLocale.getScreenWidth()>=320) && !(MobileVGA && (pref.fontSize > 20))) 
+		if ((MyLocale.getScreenWidth()>=320) && !(MobileVGA && (pref.fontSize > 20)))
 			strCenter="  \u00a4 " + pref.curCentrePt.toString();
-		
+
 		lblCenter.setText(strCenter);
 		relayout(true); // in case the numbers increased and need more space
 	}
-	
+
 	public void onEvent(Event ev) {
 		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if (ev.target == btnFlt){
@@ -92,8 +102,11 @@
 				Global.mainTab.tbP.refreshTable();
 			}
 			if (ev.target == btnCacheTour){
-				Global.mainForm.toggleCacheListVisible();			
+				Global.mainForm.toggleCacheListVisible();
 			}
+			if (ev.target==btnNoSorting){
+				table.sortTable(-1,true);
+			}
 			Gui.takeFocus(Global.mainTab.tbP.tc, ControlConstants.ByKeyboard);
 		}
 		super.onEvent(ev);

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2009-10-13 21:34:22 UTC (rev 2282)
+++ trunk/src/CacheWolf/TablePanel.java	2009-10-15 21:53:16 UTC (rev 2283)
@@ -38,6 +38,7 @@
 		myMod.hasRowHeaders = false;
 		myMod.hasColumnHeaders  = true;
 		tc.setTableModel(myMod);
+		statBar.setMyTableModel(myMod);
 	}
 	
 	/** Mark the row as selected so that myTableModel can color it grey */

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-10-13 21:34:22 UTC (rev 2282)
+++ trunk/src/CacheWolf/myTableModel.java	2009-10-15 21:53:16 UTC (rev 2283)
@@ -66,7 +66,7 @@
 	private mImage bug;
     private static mImage imgSortUp, imgSortDown;
 	private boolean sortAscending = false;
-	private int sortedBy = -1;
+	private int sortedBy = -1; // -1 don't sort 
 	private FontMetrics fm;
 //	private mImage picSizeMicro,picSizeSmall,picSizeReg,picSizeLarge,picSizeVLarge,picSizeNonPhysical;
 	private mImage picHasSolver,picHasNotes;
@@ -76,7 +76,7 @@
 	public int penEventModifiers;
 
 //	private int lastRow=-1;
-	private myTableControl tcControl;
+	public myTableControl tcControl;
 	public boolean showExtraWptInfo=true;
 
 	public myTableModel(myTableControl tc, FontMetrics fm){
@@ -307,24 +307,18 @@
 	}
 
 	public Object getCellData(int row, int col){
-		// if(row == -1) return colName[colMap[col]];
-		if(row == -1)
-        {
-            if( sortedBy > 0 && colMap[col] == sortedBy )
-            {
-                if( sortAscending )
-                {
+		if(row == -1) {
+            if( sortedBy > 0 && colMap[col] == sortedBy ) {
+                if( sortAscending ) {
                     return new IconAndText( imgSortUp, colName[colMap[col]], fm);
                     //return "^ "+colName[colMap[col]];
                 }
-                else
-                {
+                else {
                     return new IconAndText( imgSortDown, colName[colMap[col]], fm);
                     //return "v "+colName[colMap[col]];
                 }
             }
-            else
-            {
+            else {
                 return colName[colMap[col]];
             }
         }
@@ -457,39 +451,13 @@
 				}
 			}
 			if(cell.y == -1){ // Hit a header => sort the table accordingly
-				CacheHolder ch=null;
-				// cell.x is the physical column but we have to sort by the
-				// column it is mapped into
+				// cell.x is the physical column 
+				// but we have to sort by the column it is mapped into
 				int mappedCol=colMap[cell.x];
-				if (mappedCol==0) { // Click on Tickbox header
-					// Hide/unhide the additional information about a waypoint such as
-					// travelbugs/number of notfound logs/yellow circle/red circle etc.
-					// This helps on small PDA screens
-					showExtraWptInfo=!showExtraWptInfo;
-					this.table.repaint();
-					return true;
-				}
-				Vm.showWait(true);
-				Point a = tcControl.getSelectedCell(null);
-				if((a != null) && (a.y >= 0) && (a.y < cacheDB.size())) ch = cacheDB.get(a.y);
-				if (mappedCol == sortedBy) sortAscending=!sortAscending;
-				else sortAscending = true; // always start ascending 
-				sortedBy = mappedCol;
-				cacheDB.sort(new MyComparer(cacheDB, mappedCol,numRows), !sortAscending);
-				updateRows();
-				if(a != null && ch!=null){
-					int rownum = Global.getProfile().getCacheIndex(ch.getWayPoint());
-					if(rownum >= 0){
-						tcControl.cursorTo(rownum, 0, true);
-	/*					tcControl.scrollToVisible(rownum, 0);
-						tcControl.clearSelectedCells(new Vector());
-						for(int i= 0; i < MAXCOLUMNS; i++){
-							tcControl.addToSelection(rownum,i);
-						}
-		*/			}
-				}
-				Vm.showWait(false);
-				tcControl.update(true);
+				boolean sortvalue = true;
+				if (mappedCol==0) sortvalue = !showExtraWptInfo;
+				else if (mappedCol == sortedBy) sortvalue=!sortAscending;
+				sortTable(mappedCol,sortvalue);
 				retval = true;
 			}
 		} catch(NullPointerException npex){
@@ -499,6 +467,34 @@
 		return retval;
 	}
 
+    public void sortTable(int mappedCol, boolean howToDo){
+        sortedBy = mappedCol;
+        if( mappedCol <= 0 ) {
+        	// 0 is Tickbox header
+			// Hide/unhide the additional information about a waypoint such as
+			// travelbugs/number of notfound logs/yellow circle/red circle etc.
+			// This helps on small PDA screens
+            if (mappedCol == 0) showExtraWptInfo=howToDo;
+        }
+        else {
+            sortAscending = howToDo;
+            Vm.showWait( true );
+            // get selected Cache
+            Point a = tcControl.getSelectedCell( null );
+            CacheHolder ch = null;
+            if ( ( a != null ) && ( a.y >= 0 ) && ( a.y < cacheDB.size() ) ) ch = cacheDB.get( a.y );
+            cacheDB.sort( new MyComparer( cacheDB, sortedBy, numRows ), !sortAscending );
+            updateRows(); // = cacheDB.rebuild(sortedVector of ch, invisibleVector of ch)
+            // select previously selected Cache again
+            if( ch != null ) {
+                int rownum = Global.getProfile().getCacheIndex( ch.getWayPoint() );
+                if( rownum >= 0 ) tcControl.cursorTo( rownum, 0, true );
+            }
+            Vm.showWait( false );
+        }
+        tcControl.update( true ); // repaint    	
+    }
+
 	/** Toggle the select status for a group of caches
 	 * If from==to, the addi Waypoints are also toggled if the cache is a main waypoint
 	 * If from!=to, each cache is toggled irrespective of its type (main or addi)



From araber95 at mail.berlios.de  Fri Oct 16 00:49:46 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 16 Oct 2009 00:49:46 +0200
Subject: [Cachewolf-svn] r2284 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200910152249.n9FMnkMN031279@sheep.berlios.de>

Author: araber95
Date: 2009-10-16 00:49:40 +0200 (Fri, 16 Oct 2009)
New Revision: 2284

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/myTableModel.java
Log:
additional Texts for previous commit.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-15 21:53:16 UTC (rev 2283)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-15 22:49:40 UTC (rev 2284)
@@ -142,6 +142,8 @@
 		270=Anzahl der Details im Speicher ist:
 		271=Maximal:
 		272=CacheWolf Version:
+		273=Filter ein/aus
+		274=AutoSort aus
 		299=Regul%e4rer Ausdruck
 		300=Type:
 		301=Gr%f6%dfe:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-15 21:53:16 UTC (rev 2283)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-15 22:49:40 UTC (rev 2284)
@@ -142,6 +142,8 @@
 		270=Number of details in RAM is:
 		271=Maximum:
 		272=CacheWolf version:
+		273=filter on/off
+		274=no autosort
 		299=Regular expression
 		300=Type:
 		301=Size:

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-15 21:53:16 UTC (rev 2283)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-15 22:49:40 UTC (rev 2284)
@@ -104,8 +104,9 @@
 		212=Effacer toutes les fichier .xml (et images) qui ne sont pas en index.xml
 		213=Effacer les fichier .xml orpheline
 		214=Nouveau waypoint
-        216=Toujours connecter
-        218=Aussi dans description/notes
+		216=Toujours connecter
+		217=[retrouver les ?found de geocaching.com]
+		218=Aussi dans description/notes
 		219=Cherchant...
 		220=V%e9rifier notes et resoudeur
 		221=%c9craser filtre?
@@ -140,6 +141,8 @@
 		270=[Number of details in RAM is:]
 		271=[Maximum:]
 		272=[CacheWolf version:]
+		273=[filter on/off]
+		274=[no autosort]
 		299=Expression rationnelle
 		300=Type:
 		301=Gabarit:

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-15 21:53:16 UTC (rev 2283)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-15 22:49:40 UTC (rev 2284)
@@ -95,6 +95,13 @@
 		204=Oplosser
 		205=Radar
 		206=Lijst
+		207=[** unused **]
+		208=[Rebuild index]
+		209=[Rebuilding index]
+		210=[Caches not in index.xml:+}
+		211=[%0aThereof added:+]
+		212=[Delete all .xml files not in index.xml and associated pictures]
+		213=[Deleting orphans]
 		214=Nieuwe Waypoint
 		218=Ook in opmerkingen/beschrijving
 		219=Zoeken...
@@ -131,6 +138,8 @@
 		270=[Number of details in RAM is:]
 		271=[Maximum:]
 		272=[CacheWolf version:]
+		273=[filter on/off]
+		274=[no autosort]
 		299=Reguliere expressie
 		300=Type:
 		301=Grote:

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-15 21:53:16 UTC (rev 2283)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-15 22:49:40 UTC (rev 2284)
@@ -142,6 +142,8 @@
                 270=Liczba szczegolow w RAM:
                 271=Maksymalnie:
                 272=Wersja CacheWolf-a:
+		273=[filter on/off]
+		274=[no autosort]
                 299=Wyrazenie regularne (zwykle)
                 300=Typ:
                 301=Rozmiar:

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2009-10-15 21:53:16 UTC (rev 2283)
+++ trunk/src/CacheWolf/StatusBar.java	2009-10-15 22:49:40 UTC (rev 2284)
@@ -50,11 +50,11 @@
 		addNext(btnFlt= new mButton(imgFlt=new mImage("filter" + imagesize + ".png")),CellConstants.DONTSTRETCH, CellConstants.DONTFILL);
 		btnFlt.backGround=new ewe.fx.Color(0,255,0);
 		btnFlt.borderWidth=0; imgFlt.transparentColor=Color.White;
-		btnFlt.setToolTip("Klick : Filter");
+		btnFlt.setToolTip(MyLocale.getMsg(273,"filter on/off"));
 
 		addNext(btnNoSorting=new mButton(imgNoSorting=new mImage("nosort" + imagesize + ".png")),CellConstants.DONTSTRETCH, CellConstants.FILL);
 		btnNoSorting.borderWidth=0; imgNoSorting.transparentColor=Color.White;
-		btnNoSorting.setToolTip("Klick : Keine Sortierung");
+		btnNoSorting.setToolTip(MyLocale.getMsg(274,"no autosort"));
 
 		stats = new DBStats(db);
 		addNext(disp = new mLabel(""),CellConstants.DONTSTRETCH, CellConstants.FILL);

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-10-15 21:53:16 UTC (rev 2283)
+++ trunk/src/CacheWolf/myTableModel.java	2009-10-15 22:49:40 UTC (rev 2284)
@@ -65,8 +65,8 @@
 	private Image checkboxTicked,checkboxUnticked;
 	private mImage bug;
     private static mImage imgSortUp, imgSortDown;
-	private boolean sortAscending = false;
-	private int sortedBy = -1; // -1 don't sort 
+	public boolean sortAscending = false;
+	public int sortedBy = -1; // -1 don't sort 
 	private FontMetrics fm;
 //	private mImage picSizeMicro,picSizeSmall,picSizeReg,picSizeLarge,picSizeVLarge,picSizeNonPhysical;
 	private mImage picHasSolver,picHasNotes;



From araber95 at mail.berlios.de  Fri Oct 16 17:43:32 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 16 Oct 2009 17:43:32 +0200
Subject: [Cachewolf-svn] r2285 - in trunk/src/CacheWolf: . exp imp navi
Message-ID: <200910161543.n9GFhWEw029980@sheep.berlios.de>

Author: araber95
Date: 2009-10-16 17:43:20 +0200 (Fri, 16 Oct 2009)
New Revision: 2285

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/ProfileDataForm.java
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/TablePanel.java
   trunk/src/CacheWolf/exp/OVLExporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/navi/GotoPanel.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
sorting table on new current centre

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -50,7 +50,7 @@
 	/** way point coordinates, open change coordinates dialog. */
 	private static mButton btnCoordinates;
 	/** set center to current way point. */
-	private static mButton btnCenter;
+	// private static mButton btnCenter;
 	/** add time stamp to notes. */
 	private static mButton btnAddDateTime;
 	/** create a new way point. */
@@ -251,10 +251,10 @@
 		imgShowBug = new mImage(useBigIcons ? "bug_vga.gif":"bug.gif");
 		imgShowBugNo = new mImage(useBigIcons ? "bug_no_vga.gif":"bug_no.gif");
 	}
-	
+
 	private CellPanel createToolsPanel() {
 		final CellPanel pnlTools = new CellPanel();
-		
+
 		btnNewWpt = new mButton(imgNewWpt = new mImage(useBigIcons ? "newwpt_vga.png" : "newwpt.png"));
 		// FIXME: get an image with proper transparency
 		imgNewWpt.transparentColor = new Color(255, 0, 0);
@@ -286,7 +286,7 @@
 
 		btnAddDateTime = new mButton(new mImage(useBigIcons ? "date_time_vga.gif" : "date_time.gif"));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
-		
+
 		pnlTools.addNext(btnNewWpt);
 		pnlTools.addNext(btnGoto);
 		pnlTools.addNext(btnShowBug);
@@ -297,7 +297,7 @@
 		pnlTools.addLast(btnAddDateTime);
 
 		pnlTools.stretchFirstRow = true;
-		
+
 		return pnlTools;
 	}
 
@@ -330,7 +330,7 @@
 		inpName.setText(ch.getCacheName());
 		btnCoordinates.setText(ch.pos.toString());
 		inpHidden.setText(mainCache.getDateHidden());
-		inpOwner.setText(mainCache.getCacheOwner());			
+		inpOwner.setText(mainCache.getCacheOwner());
 
 		if (ch.getCacheStatus().length() >= 10 && ch.getCacheStatus().charAt(4) == '-') {
 			chcStatus.setText(MyLocale.getMsg(318, "Found") + " " + ch.getCacheStatus());
@@ -382,7 +382,7 @@
 			activateControl(btnShowBug);
 			activateControl(btnBlack);
 		}
-		
+
 		if (ch.isCustomWpt()) {
 			btnTerr.setText(MyLocale.getMsg(1001, "T") + DTINVALID);
 			btnDiff.setText(MyLocale.getMsg(1000, "D") + DTINVALID);
@@ -407,7 +407,7 @@
 				}
 			}
 		}
-		
+
 		int addiCount = 0;
 		if (ch.mainCache == null) {
 			addiCount = ch.addiWpts.size();
@@ -427,10 +427,10 @@
 	 */
 	public void createWptName() {
 		final String wpt = inpWaypoint.getText().toUpperCase();
-		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) 
-				&& Global.mainTab.mainCache != null 
-				&& (Global.mainTab.mainCache.startsWith("GC") 
-					|| CacheHolder.isOCWaypoint(Global.mainTab.mainCache) || Global.mainTab.mainCache.startsWith("CW")) 
+		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
+				&& Global.mainTab.mainCache != null
+				&& (Global.mainTab.mainCache.startsWith("GC")
+					|| CacheHolder.isOCWaypoint(Global.mainTab.mainCache) || Global.mainTab.mainCache.startsWith("CW"))
 				&& wpt.startsWith("CW")) {
 			// for what was this?:
 			Global.mainTab.lastselected = Global.mainTab.mainCache; // I don't know exactly, but it's needed for creating a series of Addis
@@ -508,11 +508,11 @@
 				// is.execute();
 				final TravelbugInCacheScreen ts = new TravelbugInCacheScreen(cache.getCacheDetails(true).Travelbugs.toHtml(),	"Travelbugs");
 				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
+			/* not fully implemented
 			} else if (ev.target == btnCenter) {
 				final CWPoint cp = new CWPoint(cache.LatLon);
 				if (cp.isValid()) {
-					pref.curCentrePt.set(cp);
-					Global.mainTab.updateBearDist();
+					pref.setCurCentrePt(cp);
 				} else {
 					final MessageBox tmpMB = new MessageBox(
 							MyLocale.getMsg(312, "Error"),
@@ -520,22 +520,23 @@
 							FormBase.OKB);
 					tmpMB.exec();
 				}
+			*/
 
 			} else if (ev.target == btnAddDateTime) {
 				dirtyNotes = true;
-				
+
 				final StringBuffer newNote = new StringBuffer();
 				newNote.append(cache.getCacheDetails(true).getCacheNotes());
-				
+
 				final Time dtm = new Time();
 				dtm.getTime();
 				dtm.setFormat("E dd.MM.yyyy '/' HH:mm");
-				
+
 				if (newNote.length() > 0) {
 					newNote.append('\n');
 				}
 				newNote.append(dtm.toString()).append('\n');
-				
+
 				cache.getCacheDetails(true).setCacheNotes(newNote.toString());
 				//FIXME: better use saveDirtyWaypoint()?
 				cache.save();
@@ -578,9 +579,9 @@
 					btnCoordinates.setText(coords.toString());
 					cache.LatLon = coords.toString();
 					// If the current centre is valid, calculate the distance and bearing to it
-					final CWPoint centre = Global.getPref().curCentrePt;
+					final CWPoint centre = Global.getPref().getCurCentrePt();
 					if (centre.isValid()) {
-						cache.calcDistance(centre);
+						cache.calcDistance(centre); // todo perhaps sortTable
 					}
 				}
 			} else if (ev.target == btnFoundDate) {
@@ -637,9 +638,9 @@
 				}
 			} else if (ev.target == btnTerr) {
 				int returnValue;
-				final TerrDiffForm tdf = new TerrDiffForm(true, 
-						decodeTerrDiff(btnTerr, 
-								MyLocale.getMsg(1001, "T"), 
+				final TerrDiffForm tdf = new TerrDiffForm(true,
+						decodeTerrDiff(btnTerr,
+								MyLocale.getMsg(1001, "T"),
 								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
 							)
 						);
@@ -650,13 +651,13 @@
 				}
 			} else if (ev.target == btnDiff) {
 				int returnValue;
-				final TerrDiffForm tdf = new TerrDiffForm(false, 
-						decodeTerrDiff(btnDiff, 
-								MyLocale.getMsg(1001, "D"), 
+				final TerrDiffForm tdf = new TerrDiffForm(false,
+						decodeTerrDiff(btnDiff,
+								MyLocale.getMsg(1001, "D"),
 								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
 							)
 						);
-						
+
 				returnValue = tdf.execute();
 				if (returnValue == 1) {
 					btnDiff.setText(MyLocale.getMsg(1000, "D") + ": "
@@ -667,7 +668,7 @@
 			ev.consumed = true;
 		}
 	}
-	
+
 	/** allow user input on control item */
 	private void activateControl(final Control ctrl) {
 		if (ctrl.change(0, ControlConstants.Disabled))
@@ -685,13 +686,13 @@
 		//FIXME: take care of renaming waypoints
 		//FIXME: add method to convert back text of difficulty & terrain buttons
 		//FIXME: check if manual changes have converted a cache from incomplete to complete
-		
+
 		// We have to update two objects: thisCache (a CacheHolderDetail) which
 		// contains
 		// the full cache which will be written to the cache.xml file AND
 		// the CacheHolder object which sits in cacheDB
 		//FIXME: so how do we do this??
-		
+
 		// Strip the found message if the status contains a date
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, "Found"))
 				&& chcStatus.getText().length() >= MyLocale
@@ -750,11 +751,11 @@
 		// because all changes
 		// affecting the details are immediately saved
 		// Now update the table
-		
+
 		cache.checkIncomplete();
-		
+
 		/*
-		 * The references have to be rebuilt if: 
+		 * The references have to be rebuilt if:
 		 * - the cachetype changed from addi->normal or from normal->addi
 		 * - the old cachetype or the new cachetype were 'addi' and the waypointname has changed
 		 */
@@ -778,13 +779,13 @@
 		if (!oldWaypoint.equals(cache.getWayPoint())){
 		 // Delete old XML - File
 			cache.getFreshDetails().deleteFile(Global.getProfile().dataDir+oldWaypoint+".xml");
-		}		
+		}
 	}
-	
+
 	/**
 	 * convert the string displayed in the terrain in difficulty buttons to a byte for intrernal use<br>
 	 * assumes that the relevant information will at positions 3 and 5 in a 0 indexed string
-	 * @param button button control to get the text from 
+	 * @param button button control to get the text from
 	 * @param td localized string for abbreviation of terrain or difficulty
 	 * @param isCache true if waypoint is a cache, false for addis and custom
 	 * @return 0 for additional or custum waypoints, -1 for caches if td is not valid, parsed byte otherwise
@@ -792,7 +793,7 @@
 	private byte decodeTerrDiff(mButton button, String td, boolean isCache) {
 		// terrain and difficulty are always unset for non cache waypoints
 		if (! isCache) return CacheTerrDiff.CW_DT_UNSET;
-		
+
 		// cut off beginning of string
 		String buttonText = button.getText().substring(td.length()+2);
 		// we now should have a string of length 3
@@ -803,7 +804,7 @@
 
 		// unset value is invalid
 		if ("--".equals(buttonText)) return CacheTerrDiff.CW_DT_ERROR;
-		
+
 		return Byte.parseByte(buttonText);
 	}
 
@@ -811,8 +812,8 @@
 
 		private final DispPanel disp = new DispPanel();
 		private final mButton btCancel;
-		
 
+
 		TravelbugInCacheScreen(String text, String title) {
 			super();
 			this.setTitle(title);

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/MainForm.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -89,8 +89,7 @@
 			infB.exec();
 			infB.waitUntilPainted(100);
 			profile.readIndex(infB);
-			pref.curCentrePt.set(profile.centre);
-			profile.updateBearingDistance();
+			pref.setCurCentrePt(profile.centre);
 			setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 		} catch (Exception e){
 			if(pref.debug == true) Vm.debug("MainForm:: Exception:: " + e.toString());

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/MainMenu.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -70,11 +70,11 @@
 	private static boolean searchInLogs = false;
 
 	public MainMenu(Form f){
-		
+
 		Global.getPref().setgpsbabel();
-		
+
 		father = f;
-	
+
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for profiles, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
@@ -90,12 +90,12 @@
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] mnuImport = new MenuItem[7];
 		mnuImport[0] = loadcaches  = new MenuItem(MyLocale.getMsg(129,"Import GPX")); //TODO internationalization
-		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download from opencaching")); 
-		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider from geocaching.com")); 
-		mnuImport[3] = spiderAllFinds = new MenuItem(MyLocale.getMsg(217,"Spider all finds from geocaching.com")); 
+		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download from opencaching"));
+		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider from geocaching.com"));
+		mnuImport[3] = spiderAllFinds = new MenuItem(MyLocale.getMsg(217,"Spider all finds from geocaching.com"));
 		mnuImport[4] = update         = new MenuItem(MyLocale.getMsg(1014,"Update cache data"));
-		mnuImport[5] = mnuSeparator   = new MenuItem("-"); 
-		mnuImport[6] = mnuForceLogin  = new MenuItem(MyLocale.getMsg(216,"Always login to GC")); 
+		mnuImport[5] = mnuSeparator   = new MenuItem("-");
+		mnuImport[6] = mnuForceLogin  = new MenuItem(MyLocale.getMsg(216,"Always login to GC"));
 		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175,"Import"));
 		if (Global.getPref().forceLogin) mnuForceLogin.modifiers^=MenuItem.Checked;
 
@@ -114,7 +114,7 @@
 		exitems[7] = exportLOC = new MenuItem(MyLocale.getMsg(215,"to LOC"));
 		exitems[8] = exportGPS = new MenuItem(MyLocale.getMsg(122,"to GPS"));
 		if ( Global.getPref().gpsbabel == null ) {
-			exitems[8].modifiers = MenuItem.Disabled;	
+			exitems[8].modifiers = MenuItem.Disabled;
 		}
 		exitems[9] = exportOZI = new MenuItem(MyLocale.getMsg(124,"to OZI"));
 		exitems[10] = exportKML = new MenuItem(MyLocale.getMsg(125,"to Google Earth"));
@@ -137,8 +137,8 @@
 		// Create the "Application" pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem [] appMenuItems=new MenuItem[11];
-		appMenuItems[0] = new MenuItem(MyLocale.getMsg(121,"Profile"), 0, profileMenu); 
-		appMenuItems[1] = preferences = new MenuItem(MyLocale.getMsg(108,"Preferences")); 
+		appMenuItems[0] = new MenuItem(MyLocale.getMsg(121,"Profile"), 0, profileMenu);
+		appMenuItems[1] = preferences = new MenuItem(MyLocale.getMsg(108,"Preferences"));
 		appMenuItems[2] = mnuEditCenter = new MenuItem(MyLocale.getMsg(1110,"Centre"));
 		appMenuItems[3] = mnuContext = new MenuItem(MyLocale.getMsg(134,"Current Cache"));
 		appMenuItems[4] = mnuSeparator;
@@ -146,8 +146,8 @@
 		appMenuItems[6] = new MenuItem(MyLocale.getMsg(107,"Export"),0,exportMenu);
 		appMenuItems[7] = new MenuItem(MyLocale.getMsg(149,"Maps"),0,mapsMenu);
 		appMenuItems[8] = mnuSeparator;
-		appMenuItems[9] = savenoxit = new MenuItem(MyLocale.getMsg(127,"Save")); 
-		//appMenuItems[10] = savenexit = new MenuItem(MyLocale.getMsg(110,"Save & Exit")); 
+		appMenuItems[9] = savenoxit = new MenuItem(MyLocale.getMsg(127,"Save"));
+		//appMenuItems[10] = savenexit = new MenuItem(MyLocale.getMsg(110,"Save & Exit"));
 		appMenuItems[10] = exit = new MenuItem(MyLocale.getMsg(111,"Exit"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(120,"Application"),new Menu(appMenuItems,null)));
 
@@ -155,7 +155,7 @@
 		// Create the "Search" pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] searchMenuItems=new MenuItem[3];
-		searchMenuItems[0] = search = new MenuItem(MyLocale.getMsg(112,"Search$"+(char)6)); // char 6 = ctrl +f 
+		searchMenuItems[0] = search = new MenuItem(MyLocale.getMsg(112,"Search$"+(char)6)); // char 6 = ctrl +f
 		searchMenuItems[1] = searchAll = new MenuItem(MyLocale.getMsg(133,"Search All"));
 		searchMenuItems[2] = searchClr = new MenuItem(MyLocale.getMsg(113,"Clear search"));
 
@@ -163,9 +163,9 @@
 		// Create the "Filter" pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] filterMenuItems=new MenuItem[9];
-		filterMenuItems[0] = filtApply  = new MenuItem(MyLocale.getMsg(709,"Apply")); 
-		filterMenuItems[1] = filtCreate  = new MenuItem(MyLocale.getMsg(114,"Create")); 
-		filterMenuItems[2] = filtInvert  = new MenuItem(MyLocale.getMsg(115,"Invert")); 
+		filterMenuItems[0] = filtApply  = new MenuItem(MyLocale.getMsg(709,"Apply"));
+		filterMenuItems[1] = filtCreate  = new MenuItem(MyLocale.getMsg(114,"Create"));
+		filterMenuItems[2] = filtInvert  = new MenuItem(MyLocale.getMsg(115,"Invert"));
 		filterMenuItems[3] = filtClear   = new MenuItem(MyLocale.getMsg(116,"Clear"));
 		filterMenuItems[4] = mnuSeparator;
 		filterMenuItems[5] = filtSelected = new MenuItem(MyLocale.getMsg(160,"Filter selected"));
@@ -195,7 +195,7 @@
 		//filterAndSearchMenuItems[12] = mnuSeparator;
 		//filterAndSearchMenuItems[13] = cacheTour;
 
-		// Depending on screen width display either filter and search menus or the combined menu 
+		// Depending on screen width display either filter and search menus or the combined menu
 		if (MyLocale.getScreenWidth()>300) {
 			this.addMenu(new PullDownMenu(MyLocale.getMsg(112,"Search"),new Menu(searchMenuItems,null)));
 			this.addMenu(new PullDownMenu(MyLocale.getMsg(159,"Filter"),new Menu(filterMenuItems,null)));
@@ -209,8 +209,8 @@
 		MenuItem[] organiseMenuItems=new MenuItem[11];
 		organiseMenuItems[0] = orgNewWP = new MenuItem(MyLocale.getMsg(214,"New Waypoint"));
 		organiseMenuItems[1] = mnuSeparator;
-		organiseMenuItems[2] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy")); 
-		organiseMenuItems[3] = orgMove  = new MenuItem(MyLocale.getMsg(142,"Move")); 
+		organiseMenuItems[2] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy"));
+		organiseMenuItems[3] = orgMove  = new MenuItem(MyLocale.getMsg(142,"Move"));
 		organiseMenuItems[4] = orgDelete   = new MenuItem(MyLocale.getMsg(143,"Delete"));
 		organiseMenuItems[5] = orgRebuild   = new MenuItem(MyLocale.getMsg(208,"Rebuild Index"));
 		organiseMenuItems[6] = orgCheckNotesAndSolver = new MenuItem(MyLocale.getMsg(220,"Check Notes/Solver"));
@@ -226,10 +226,10 @@
 		// Create the "About" pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] aboutMenuItems=new MenuItem[5];
-		aboutMenuItems[0] = about = new MenuItem(MyLocale.getMsg(117,"About")); 
-		aboutMenuItems[1] = legend = new MenuItem(MyLocale.getMsg(155,"Legend")); 
-		aboutMenuItems[2] = wolflang = new MenuItem(MyLocale.getMsg(118,"WolfLanguage")); 
-		aboutMenuItems[3] = sysinfo = new MenuItem(MyLocale.getMsg(157,"System")); 
+		aboutMenuItems[0] = about = new MenuItem(MyLocale.getMsg(117,"About"));
+		aboutMenuItems[1] = legend = new MenuItem(MyLocale.getMsg(155,"Legend"));
+		aboutMenuItems[2] = wolflang = new MenuItem(MyLocale.getMsg(118,"WolfLanguage"));
+		aboutMenuItems[3] = sysinfo = new MenuItem(MyLocale.getMsg(157,"System"));
 		aboutMenuItems[4] = chkVersion = new MenuItem(MyLocale.getMsg(158,"Version Check"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(117,"About"),new Menu(aboutMenuItems,null)));
 	}
@@ -241,7 +241,7 @@
 				mnuContext.subMenu = tbp.tc.getMenuFull();
 			else
 				mnuContext.subMenu = tbp.tc.getMenuSmall();
-		}		
+		}
 	}
 
 	public void allowProfileChange(boolean profileChangeAllowed) {
@@ -278,11 +278,11 @@
 		if (ev instanceof MenuEvent){ //&& ev.type == MenuEvent.PRESSED
 			MenuEvent mev = (MenuEvent)ev;
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for profiles, part of "Application" menu 
+			// subMenu for profiles, part of "Application" menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == mnuNewProfile){
 				if (NewProfileWizard.startNewProfileWizard(getFrame()) ) {
-					pref.curCentrePt = new CWPoint(profile.centre);
+					pref.setCurCentrePt(profile.centre);
 		            filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&~MenuItem.Checked;
 					tbp.refreshTable();
 				}
@@ -299,7 +299,7 @@
 					Vm.showWait(infB, true);
 					profile.readIndex(infB);
 					Vm.showWait(infB, false);
-					pref.curCentrePt.set(profile.centre);
+					pref.setCurCentrePt(profile.centre);
                     filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&~MenuItem.Checked;
 					Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 					infB.close(0);
@@ -319,7 +319,7 @@
 				f.close(0);
 			}
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for import, part of "Application" menu 
+			// subMenu for import, part of "Application" menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == spider){
 				SpiderGC spGC = new SpiderGC(pref, profile, true);
@@ -356,9 +356,9 @@
 							else how = GPXImporter.DOIT_NOSPOILER;
 					}
 					 */
-					
+
 					int how = GPXImporter.DOIT_ASK;
-					for (int i = 0; i < files.length; i++){ 
+					for (int i = 0; i < files.length; i++){
 						String file = dir + "/" + files[i];
 						if (file.endsWith("loc")){
 							LOCXMLImporter loc = new LOCXMLImporter(pref, profile, file);
@@ -382,7 +382,7 @@
                 filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&~MenuItem.Checked;
 				tbp.resetModel();
 			}
-			if (mev.selectedItem == update) 
+			if (mev.selectedItem == update)
 				updateSelectedCaches(tbp);
 			if(mev.selectedItem == mnuForceLogin) {
 				mnuForceLogin.modifiers^=MenuItem.Checked;
@@ -390,7 +390,7 @@
 				Global.getPref().savePreferences();
 			}
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for export, part of "Application" menu 
+			// subMenu for export, part of "Application" menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == exporthtml){
 				HTMLExporter htm = new HTMLExporter(pref, profile);
@@ -399,7 +399,7 @@
 			if(mev.selectedItem == exportGpxNg){
 				GpxExportNg gpx = new GpxExportNg();
 				gpx.doit();
-			} 
+			}
 			if(mev.selectedItem == exporttop50){
 				OVLExporter ovl = new OVLExporter(pref, profile);
 				ovl.doIt();
@@ -471,7 +471,7 @@
 				mag.doIt();
 			}
 			///////////////////////////////////////////////////////////////////////
-			// subMenu for maps, part of "Application" menu 
+			// subMenu for maps, part of "Application" menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == downloadmap){
 				MapLoaderGui mLG = new MapLoaderGui(cacheDB);
@@ -529,13 +529,13 @@
 			if(mev.selectedItem == searchAll){
 				SearchCache ssc = new SearchCache(cacheDB);
 				ssc.clearSearch();
-				tbp.refreshTable();		
+				tbp.refreshTable();
                 search();
 			}
 			if(mev.selectedItem == searchClr){
 				SearchCache ssc = new SearchCache(cacheDB);
 				ssc.clearSearch();
-				tbp.refreshTable();		
+				tbp.refreshTable();
 			}
 			///////////////////////////////////////////////////////////////////////
 			// "Filter" pulldown menu
@@ -663,13 +663,13 @@
 			}
 			if(mev.selectedItem == cacheTour){
 				cacheTour.modifiers^=MenuItem.Checked;
-				Global.mainForm.toggleCacheListVisible();			
+				Global.mainForm.toggleCacheListVisible();
 			}
 			if(mev.selectedItem == orgRater) {
 				Rating rater = new Rating();
 				rater.run();
 			}
-			
+
 			///////////////////////////////////////////////////////////////////////
 			// "About" pulldown menu
 			///////////////////////////////////////////////////////////////////////
@@ -699,11 +699,11 @@
 				sb.append("<br>");
 				sb.append(MyLocale.getMsg(261, "Locale lang is:"));
 				sb.append(' ');
-				sb.append(MyLocale.getLocaleLanguage()); 
+				sb.append(MyLocale.getLocaleLanguage());
 				sb.append("<br>");
 				sb.append(MyLocale.getMsg(262, "Locale country is:"));
 				sb.append(' ');
-				sb.append(MyLocale.getLocaleCountry()); 
+				sb.append(MyLocale.getLocaleCountry());
 				sb.append("<br>");
 				sb.append(MyLocale.getMsg(263, "Decimal separator is:"));
 				sb.append(" \"");
@@ -715,8 +715,8 @@
 				sb.append("<br>");
 				sb.append(MyLocale.getMsg(265, "Screen:"));
 				sb.append(' ');
-				sb.append(MyLocale.getScreenWidth()); 
-				sb.append(" x ");	 sb.append(MyLocale.getScreenHeight()); 
+				sb.append(MyLocale.getScreenWidth());
+				sb.append(" x ");	 sb.append(MyLocale.getScreenHeight());
 				sb.append("<br>");
 				sb.append(MyLocale.getMsg(266, "Font size:"));
 				sb.append(' ');
@@ -752,11 +752,11 @@
 			if(mev.selectedItem == chkVersion){
 				(new MessageBox(MyLocale.getMsg(178, "Version Checking"), Version.getUpdateMessage(), FormBase.OKB)).execute();
 			}
-			
+
 			// In case that the triggered event was due to one of the context menu items, process
 			// the event by the context menu handler
 			tbp.tc.popupMenuEvent(mev.selectedItem);
-			
+
 		} else if (ev instanceof ControlEvent) {
 			if (ev.type == ControlEvent.MENU_SHOWN) {
 				Global.mainTab.tbP.tc.adjustAddiHideUnhideMenu();
@@ -769,10 +769,10 @@
 		Profile profile=Global.getProfile();
 		CacheDB cacheDB=profile.cacheDB;
 		CacheHolder ch;
-		
+
 		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(5003,"Options"), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.ALL);
 		if (options.execute() == FormBase.IDCANCEL) {	return; }
-				
+
 		SpiderGC spider = new SpiderGC(pref, profile, false);
 		OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
 		//Vm.debug("ByPass? " + profile.byPassIndexActive);
@@ -781,9 +781,9 @@
 		boolean alreadySaid2 = false;
 		InfoBox infB = new InfoBox("Info", "Loading", InfoBox.PROGRESS_WITH_WARNINGS);
 		infB.exec();
-		
+
 		boolean loadAllLogs = (pref.maxLogsToSpider > 5);
-		
+
 		Vector cachesToUpdate = new Vector();
 		for(int i = 0; i <	cacheDB.size(); i++){
 			ch = cacheDB.get(i);
@@ -828,7 +828,7 @@
 				} else if (test == SpiderGC.SPIDER_ERROR) {
 					spiderErrors++;
 				} else {
-					//profile.hasUnsavedChanges=true;	
+					//profile.hasUnsavedChanges=true;
 				}
 				forceLogin=false;
 			}
@@ -836,9 +836,9 @@
 				if (!ocSync.syncSingle(i, infB)) {
 					infB.close(0);
 					break;
-				} else { 
+				} else {
 					//profile.hasUnsavedChanges=true;
-				}	
+				}
 			}
 
 //			cacheDB.clear();
@@ -852,7 +852,7 @@
 		Vm.showWait(false);
 		if ( spiderErrors > 0) {
 			new MessageBox(MyLocale.getMsg(5500,"Error"),spiderErrors + MyLocale.getMsg(5516," cache descriptions%0acould not be loaded."),FormBase.DEFOKB).execute();
-		}		
+		}
 	}
-	
+
 }

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/MainTab.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -420,10 +420,14 @@
 		if (pref.setCurrentCentreFromGPSPosition){
 			boolean gpsPosIsValid=nav.gpsPos.isValid();
 			if (gpsPosIsValid) {
-				CWPoint whereAmI = nav.gpsPos;
-				if (whereAmI != pref.curCentrePt) {
-					pref.curCentrePt.set(whereAmI);
-					this.updateBearDist();
+				double latWhereAmI, lonWhereAmI, latCurCentr, lonCurCentr;
+				latWhereAmI = nav.gpsPos.latDec;
+				lonWhereAmI = nav.gpsPos.lonDec;
+				latCurCentr = pref.getCurCentrePt().latDec;
+				lonCurCentr = pref.getCurCentrePt().lonDec;
+				if (latWhereAmI != latCurCentr ||
+					lonWhereAmI != lonCurCentr ) {
+					pref.setCurCentrePt(nav.gpsPos);
 				}
 			}
 		}

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/Parser.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -402,12 +402,11 @@
     /** Get or set the current centre */
 	private void funcCenter(int nargs) throws Exception {
 		if (nargs==0) {
-			calcStack.add(Global.getPref().curCentrePt.toString());
+			calcStack.add(Global.getPref().getCurCentrePt().toString());
 		} else {
 	    	String coordA=popCalcStackAsString();
 			if (!isValidCoord(coordA)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordA);
-			Global.getPref().curCentrePt.set(coordA);
-			Global.getProfile().updateBearingDistance();
+			Global.getPref().setCurCentrePt(new CWPoint(coordA));
 		}
 	}
 
@@ -553,7 +552,7 @@
     		}
     		ch.LatLon=cwPt.toString(TransformCoordinates.CW);
     		ch.pos.set(cwPt);
-    		ch.calcDistance(Global.getPref().curCentrePt); // Update distance/bearing
+    		ch.calcDistance(Global.getPref().getCurCentrePt()); // Update distance/bearing
     		nav.setDestination(ch);
     	    Global.getProfile().selectionChanged=true; // Tell moving map to updated displayed waypoints
     	}
@@ -1003,7 +1002,7 @@
 				if (cwPt.isValid() || coord.equals("")) { // Can clear coord with empty string
 					ch.LatLon=cwPt.toString(TransformCoordinates.CW);
 					ch.pos.set(cwPt);
-					ch.calcDistance(Global.getPref().curCentrePt); // Update distance and bearing
+					ch.calcDistance(Global.getPref().getCurCentrePt()); // Update distance and bearing
 		    	    Global.getProfile().selectionChanged=true; // Tell moving map to updated displayed waypoints
 				    return;
 				} else

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -201,7 +201,7 @@
 	public boolean downloadmissingOC = false;
 	/** The currently used centre point, can be different from the profile's centrepoint. This is used
 	 *  for spidering */
-	public CWPoint curCentrePt=new CWPoint();
+	private CWPoint curCentrePt=new CWPoint();
 	/** True if a login screen is displayed on each spider operation */
 	public boolean forceLogin=true;
 	/** True if the goto panel is North centered */
@@ -709,6 +709,23 @@
 		}
 	}
 
+	private myTableModel table;
+	public void setMyTableModel(myTableModel myTableModel) {table=myTableModel;}
+	public CWPoint getCurCentrePt() {return curCentrePt;}
+	public void setCurCentrePt(CWPoint newCentre) {
+		curCentrePt.set(newCentre);
+		Global.getProfile().updateBearingDistance();
+		// if corresponding column ist sorted
+		if (table != null) {
+			if (table.sortedBy == 10) {
+				table.sortTable(10, table.sortAscending);
+				// oder ??? 
+				// TablePanel.refreshTable();
+			}
+			else table.tcControl.repaint();
+		}
+	}
+
 	/**
 	 * gets the path to the calibrated maps
 	 * it first tries if there are manually imported maps

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/Profile.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -168,7 +168,7 @@
 			return;
 		}
 		CWPoint savedCentre=centre;
-		if (centre==null || !centre.isValid() || (savedCentre.latDec==0.0 && savedCentre.lonDec==0.0)) savedCentre=pref.curCentrePt;
+		if (centre==null || !centre.isValid() || (savedCentre.latDec==0.0 && savedCentre.lonDec==0.0)) savedCentre=pref.getCurCentrePt();
 
 		try{
 			detfile.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n");
@@ -548,7 +548,7 @@
 	 *	@see	Extractor
 	 */
 	public void updateBearingDistance(){
-		CWPoint centerPoint = new CWPoint(Global.getPref().curCentrePt); // Clone current centre to be sure
+		CWPoint centerPoint = new CWPoint(Global.getPref().getCurCentrePt()); // Clone current centre to be sure
 		int anz = cacheDB.size();
 		CacheHolder ch;
 		// Jetzt durch die CacheDaten schleifen

Modified: trunk/src/CacheWolf/ProfileDataForm.java
===================================================================
--- trunk/src/CacheWolf/ProfileDataForm.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/ProfileDataForm.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -29,18 +29,18 @@
 		super();
 		pref=p;
 		profile=prof;
-		
+
     	resizable =  false;
 		content.setText(MyLocale.getMsg(1115,"Centre"));
 		content.borderStyle=UIConstants.BDR_RAISEDOUTER|UIConstants.BDR_SUNKENINNER|UIConstants.BF_RECT;
-	    //defaultTags.set(this.INSETS,new Insets(2,2,2,2));		
+	    //defaultTags.set(this.INSETS,new Insets(2,2,2,2));
 		title = MyLocale.getMsg(1118,"Profile")+": "+profile.name;
-		content.addNext(new mLabel(MyLocale.getMsg(600,"Preferences")));		
+		content.addNext(new mLabel(MyLocale.getMsg(600,"Preferences")));
 		content.addLast(chkSetCurrentCentreFromGPSPosition = new mCheckBox(MyLocale.getMsg(646,"centre from GPS")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		// content.addLast(btnGPS2Cur=new mButton("   v   "),DONTSTRETCH,DONTFILL|LEFT);
-		if (pref.setCurrentCentreFromGPSPosition) chkSetCurrentCentreFromGPSPosition.setState(true);		
+		if (pref.setCurrentCentreFromGPSPosition) chkSetCurrentCentreFromGPSPosition.setState(true);
 		content.addNext(new mLabel(MyLocale.getMsg(1116,"Current")));
-		content.addLast(btnCurrentCentre=new mButton(pref.curCentrePt.toString()),HSTRETCH,HFILL|LEFT);
+		content.addLast(btnCurrentCentre=new mButton(pref.getCurCentrePt().toString()),HSTRETCH,HFILL|LEFT);
 		content.addNext(new mLabel("      "),HSTRETCH,HFILL);
 		content.addNext(btnCur2Prof=new mButton("   v   "),DONTSTRETCH,DONTFILL|LEFT);
 		content.addNext(new mLabel(MyLocale.getMsg(1117,"copy")));
@@ -52,7 +52,7 @@
 		//addNext(btnCancel = new mButton(MyLocale.getMsg(1604,"Cancel")),DONTSTRETCH,DONTFILL|LEFT);
 		addLast(btnOK = new mButton("OK"),DONTSTRETCH,HFILL|RIGHT);
 	}
-	
+
 	/**
 	*	The event handler to react to a users selection.
 	*	A return value is created and passed back to the calling form
@@ -69,10 +69,10 @@
 			}
 			if (ev.target == btnCurrentCentre){
 				CoordsScreen cs = new CoordsScreen();
-				cs.setFields(pref.curCentrePt, TransformCoordinates.CW);
+				cs.setFields(pref.getCurCentrePt(), TransformCoordinates.CW);
 				if (cs.execute()== FormBase.IDOK){
-					pref.curCentrePt.set(cs.getCoords());
-					btnCurrentCentre.setText(pref.curCentrePt.toString());
+					pref.setCurCentrePt(cs.getCoords());
+					btnCurrentCentre.setText(pref.getCurCentrePt().toString());
 					Global.getProfile().updateBearingDistance();
 				}
 			}
@@ -86,13 +86,13 @@
 				}
 			}
 			if (ev.target == btnCur2Prof){
-				profile.notifyUnsavedChanges(pref.curCentrePt.equals(profile.centre));
-				profile.centre.set(pref.curCentrePt);
+				profile.notifyUnsavedChanges(pref.getCurCentrePt().equals(profile.centre));
+				profile.centre.set(pref.getCurCentrePt());
 				btnProfileCentre.setText(profile.centre.toString());
 			}
 			if (ev.target == btnProf2Cur){
-				pref.curCentrePt.set(profile.centre);
-				btnCurrentCentre.setText(pref.curCentrePt.toString());
+				pref.setCurCentrePt(profile.centre);
+				btnCurrentCentre.setText(pref.getCurCentrePt().toString());
 				Global.getProfile().updateBearingDistance();
 			}
 		}

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/StatusBar.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -83,7 +83,7 @@
 		// Otherwise it forces a scrollbar
 		// This can happen even on bigger screens with big fonts
 		if ((MyLocale.getScreenWidth()>=320) && !(MobileVGA && (pref.fontSize > 20)))
-			strCenter="  \u00a4 " + pref.curCentrePt.toString();
+			strCenter="  \u00a4 " + pref.getCurCentrePt().toString();
 
 		lblCenter.setText(strCenter);
 		relayout(true); // in case the numbers increased and need more space

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/TablePanel.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -39,6 +39,7 @@
 		myMod.hasColumnHeaders  = true;
 		tc.setTableModel(myMod);
 		statBar.setMyTableModel(myMod);
+		pref.setMyTableModel(myMod);
 	}
 	
 	/** Mark the row as selected so that myTableModel can color it grey */

Modified: trunk/src/CacheWolf/exp/OVLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/OVLExporter.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/exp/OVLExporter.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -8,13 +8,13 @@
 *	the TOP50 map products (mainly available in german speaking countries).
 */
 public class OVLExporter extends Exporter{
-	
+
 	public OVLExporter(Preferences p, Profile prof){
 		super();
 		this.setMask("*.ovl");
 		this.setHowManyParams(LAT_LON|COUNT);
 	}
-	
+
 	public String record(CacheHolder ch, String lat, String lon, int counter){
 		StringBuffer str = new StringBuffer(200);
 		double tmp;
@@ -47,7 +47,7 @@
 
 		return str.toString();
 	}
-	
+
 	public String trailer(int counter){
 		StringBuffer str = new StringBuffer(200);
 
@@ -58,8 +58,8 @@
 		str.append("MapName=Gesamtes Bundesgebiet (D1000)\r\n");
 		str.append("DimmFc=100\r\n");
 		str.append("ZoomFc=100\r\n");
-		str.append("CenterLat="+pref.curCentrePt.getLatDeg(TransformCoordinates.CW)+".00\r\n");
-		str.append("CenterLong="+pref.curCentrePt.getLonDeg(TransformCoordinates.CW)+".00\r\n");
+		str.append("CenterLat="+pref.getCurCentrePt().getLatDeg(TransformCoordinates.CW)+".00\r\n");
+		str.append("CenterLong="+pref.getCurCentrePt().getLonDeg(TransformCoordinates.CW)+".00\r\n");
 		str.append("RefColor=255\r\n");
 		str.append("RefRad=58\r\n");
 		str.append("RefLine=6\r\n");
@@ -68,7 +68,7 @@
 		return str.toString();
 	}
 
-	
+
 /*	public void doIt(){
 		CacheHolder holder;
 		ParseLatLon pll;
@@ -112,7 +112,7 @@
 						outp.print("Text="+holder.wayPoint+"\r\n");
 						symCounter++;
 					}//if holder...
-				}//for ... i < cacheDB ...			
+				}//for ... i < cacheDB ...
 				// overlay section
 				outp.print("[Overlay]\r\n");
 				outp.print("Symbols="+Convert.toString(symCounter-1)+"\r\n");
@@ -128,7 +128,7 @@
 				outp.print("RefLine=6\r\n");
 				outp.print("RefOn=0\r\n");
 				outp.print("\r\n");
-				
+
 				outp.close();
 			}catch(Exception e){
 				Vm.debug("Error writing to OVL file! "+e.toString());

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -34,7 +34,7 @@
 import ewe.sys.Double;
 
 /**
- *	Class to import Data from opencaching. 
+ *	Class to import Data from opencaching.
  *	It uses the lastmodified parameter to identify new or changed caches.
  *	See here: http://www.opencaching.com/phpBB2/viewtopic.php?t=281 (out-dated)
  *   See here: http://www.opencaching.de/doc/xml/xml11.htm and http://develforum.opencaching.de/viewtopic.php?t=135&postdays=0&postorder=asc&start=0
@@ -46,7 +46,7 @@
 	static protected final int STAT_CACHE_DESC = 2;
 	static protected final int STAT_CACHE_LOG = 3;
 	static protected final int STAT_PICTURE = 4;
-	
+
 	public final static String OPENCACHING_DE_HOST = "www.opencaching.de";
 	public final static String OPENCACHING_DE_PATTERN = "OC";
 	public final static String OPENCACHING_PL_HOST = "www.opencaching.pl";
@@ -55,9 +55,9 @@
 	public final static String OPENCACHING_CZ_PATTERN = "OZ";
 	public final static String OPENCACHING_UK_HOST = "www.opencaching.org.uk";
 	public final static String OPENCACHING_UK_PATTERN = "OK";
-	
+
 	String hostname;
-	
+
 	int state = STAT_INIT;
 	int numCacheImported, numDescImported, numLogImported= 0;
 
@@ -106,9 +106,9 @@
 			if (!ch.getOcCacheID().equals(""))
 				DBindexID.put(ch.getOcCacheID(), new Integer(i));
 		}//for
-		
+
 	}
-	
+
 	protected void setHostname(String wpName){
 		if(wpName.startsWith(OPENCACHING_DE_PATTERN))
 			hostname = OPENCACHING_DE_HOST;
@@ -121,7 +121,7 @@
 	}
 
 	/**
-	 * 
+	 *
 	 * @param number
 	 * @param infB
 	 * @return true, if some change was made to the cacheDB
@@ -131,7 +131,7 @@
 		ch = cacheDB.get(number);
 		setHostname(ch.getWayPoint());
 		holder= null;
-		
+
 		if (infB.isClosed) {
 			// there could have been an update before
 			return true;
@@ -141,7 +141,7 @@
 		inf.setPreferredSize(220, 300);
 		inf.relayout(false);
 		inf.exec();
-		String lastS; 
+		String lastS;
 		/** pref.downloadmissingOC = true, if not the last syncdate shall be used,
 		 *  but the caches shall be reloaded
 		 *  only used in syncSingle  */
@@ -152,8 +152,8 @@
 		}
 		dateOfthisSync = new Time();
 		dateOfthisSync.parse(lastS, "yyyyMMddHHmmss");
-	
 
+
 		String url = new String();
 		picCnt = 0;
 		//Build url
@@ -161,7 +161,7 @@
 			+ "modifiedsince=" + lastS
 			+ "&cache=1"
 			+ "&cachedesc=1";
-		
+
 		if (pref.downloadPics) url += "&picture=1";
 		else url += "&picture=0";
 		url += "&cachelog=1"
@@ -182,7 +182,7 @@
 		String url = new String();
 
 		String lastS =  profile.getLast_sync_opencaching();
-		CWPoint centre = pref.curCentrePt; // No need to clone curCentrePt as centre is only read
+		CWPoint centre = pref.getCurCentrePt(); // No need to clone curCentrePt as centre is only read
 		if (!centre.isValid()) {
 			(new MessageBox("Error", "Coordinates for centre must be set", FormBase.OKB)).execute();
 			return;
@@ -193,12 +193,12 @@
 		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
 		Vm.showWait(true);
 		String dist = importOpt.distanceInput.getText();
-		
+
 		if (importOpt.domains.getSelectedItem()!=null)
 			hostname = (String)importOpt.domains.getSelectedItem();
-		
+
 		if (dist.length()== 0) return;
-		
+
 		Double distDouble = new Double();
 		distDouble.value = Common.parseDouble(dist);
 		dist = distDouble.toString(0, 1, 0).replace(',', '.');
@@ -217,7 +217,7 @@
 			ch.setUpdated(false);
 			ch.setNew(false);
 			ch.setLog_updated(false);
-		}	
+		}
 		picCnt = 0;
 		//Build url
 		url = "http://" + hostname + "/xml/ocxml11.php?"
@@ -245,7 +245,7 @@
 		if (success) {
 			profile.setLast_sync_opencaching(dateOfthisSync.format("yyyyMMddHHmmss"));
 			//pref.savePreferences();
-			finalMessage = MyLocale.getMsg(1607,"Update from opencaching successful"); 
+			finalMessage = MyLocale.getMsg(1607,"Update from opencaching successful");
 			inf.addWarning("\nNumber of"+
 			"\n...caches new/updated: " + numCacheImported +
 			"\n...cache descriptions new/updated: " + numDescImported +
@@ -254,7 +254,7 @@
 		}
 		inf.addOkButton();
 	}
-	
+
 	private boolean syncOC(String url) {
 		String finalMessage = new String();
 		boolean success=true;
@@ -263,7 +263,7 @@
 		String file = new String();
 
 		//inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
-		
+
 		picCnt = 0;
 		try{
 			holder = null;
@@ -278,7 +278,7 @@
 			ZipFile zif = new ZipFile (profile.dataDir + file);
 			ZipEntry zipEnt;
 			Enumeration zipEnum = zif.entries();
-			inf.setInfo("...unzipping update file"); 
+			inf.setInfo("...unzipping update file");
 			while (zipEnum.hasMoreElements())
 			{
 				zipEnt = (ZipEntry) zipEnum.nextElement();
@@ -358,7 +358,7 @@
 		//examine data
 		switch (state) {
 		case STAT_CACHE: startCache(name, atts); break;
-		case STAT_CACHE_DESC: startCacheDesc(name, atts); break; 
+		case STAT_CACHE_DESC: startCacheDesc(name, atts); break;
 		case STAT_CACHE_LOG: startCacheLog(name, atts); break;
 		case STAT_PICTURE: startPicture(name,atts); break;
 		}
@@ -400,10 +400,10 @@
 		if(name.equals("status")){
             // meaning of OC status :
 			//  1=Kann gesucht werden ;
-			//  2=Momentan nicht verf?gbar ; 
-			//  3=Archiviert ; 
-			//  4= ; 
-			//  5= ; 
+			//  2=Momentan nicht verf?gbar ;
+			//  3=Archiviert ;
+			//  4= ;
+			//  5= ;
 			//  6=Gesperrt ;
 			//  are there more ? ;
 			if (atts.getValue("id").equals("1")) {
@@ -428,8 +428,8 @@
 		}
 
 	}
-	
 
+
 	private void startCacheDesc(String name, AttributeList atts){
 		inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported);
 		if (name.equals("cachedesc")){
@@ -438,7 +438,7 @@
 		if (name.equals("desc")){
 			holder.setHTML(atts.getValue("html").equals("1")?true:false);
 		}
-		
+
 		if (name.equals("language")) {
 			processingDescLang = atts.getValue("id");
 		}
@@ -455,10 +455,10 @@
 		if (name.equals("logtype")){
 			logtype = Convert.toInt(atts.getValue("id"));
 			switch (logtype) {
-			case 1: 
+			case 1:
 				logIcon = GPXImporter.typeText2Image("Found");
 				break;
-			case 2:	logIcon = GPXImporter.typeText2Image("Not Found"); 
+			case 2:	logIcon = GPXImporter.typeText2Image("Not Found");
 			holder.setNoFindLogs((byte)(holder.getNoFindLogs()+1));
 			break;
 			case 3: logIcon = GPXImporter.typeText2Image("Note");
@@ -466,7 +466,7 @@
 			loggerRecommended = atts.getValue("recommended").equals("1");
 			return;
 		}
-		
+
 		if (name.equals("id")){
 			logId = atts.getValue("id");
 		}
@@ -499,7 +499,7 @@
 
 			// save all
 			holder.getFreshDetails().hasUnsavedChanges = true; // this makes CachHolder save the details in case that they are unloaded from memory
-			// chD.saveCacheDetails(profile.dataDir); 
+			// chD.saveCacheDetails(profile.dataDir);
 			// profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR); // this is done after .xml is completly processed
 			return;
 		}
@@ -560,7 +560,7 @@
 				int numDownloaded=1;
 				while (imgRegexUrl.searchFrom(holder.getFreshDetails().LongDescription, descIndex)) { // "img" found
 					imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte <img ...>-tag
-					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen 
+					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen
 					if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
 					if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
 						inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+holder.getWayPoint()));
@@ -571,8 +571,8 @@
 						imgAltText=imgRegexAlt.stringMatched(1);
 						if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
 						// no alternative text as image title -> use filename
-					} else { 
-						if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend 
+					} else {
+						if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
 							imgAltText = new String("No image title");
 						else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf("/")+1);
 					}
@@ -592,13 +592,13 @@
 		}
 
 		if (name.equals("shortdesc")){
-			String linebraek; 
+			String linebraek;
 
 			if (holder.is_HTML())	linebraek = "<br>\n";
 			else 					linebraek = "\n";
 
 			if (holder.is_updated())	holder.getFreshDetails().LongDescription += linebraek + processingDescLang + ":" +  linebraek + strData; // if a long description is already updated, then this one is likely to be in another language
-			else 					 	holder.getFreshDetails().LongDescription =              processingDescLang + ":" +  linebraek + strData; 
+			else 					 	holder.getFreshDetails().LongDescription =              processingDescLang + ":" +  linebraek + strData;
 			return;
 		}
 
@@ -608,7 +608,7 @@
 			return;
 		}
 		if (name.equals("hint")){
-			if (holder.is_updated()) 	
+			if (holder.is_updated())
 				holder.getFreshDetails().Hints += "\n" +  processingDescLang + ": " + Common.rot13(strData);
 			else						holder.getFreshDetails().Hints = Common.rot13(strData);
 			holder.setUpdated(true); // remark: this is used in "shortdesc" to decide weather the description should be appended or replaced
@@ -620,13 +620,13 @@
 		String fileName = holder.getWayPoint() + "_" + fetchURL.substring(fetchURL.lastIndexOf("/")+1);
 		return Common.ClearForFileName(fileName).toLowerCase();
 	}
-	
+
 	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs
 		try {
-			//TODO this is not quite correct: actually the "base" URL must be known... 
+			//TODO this is not quite correct: actually the "base" URL must be known...
 			// but anyway a different baseURL should not happen very often  - it doesn't in my area
 			if (!fetchURL.startsWith("http://")) fetchURL = new URL(
-				new URL("http://" + hostname+"/"), fetchURL).toString(); 
+				new URL("http://" + hostname+"/"), fetchURL).toString();
 			String fileName = createPicFilename(fetchURL);
 			ImageInfo imageInfo = new ImageInfo();
 			// add title
@@ -653,11 +653,11 @@
 				if (e == null) ErrMessage = "Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: "+fileName+" from URL:"+fetchURL;
 				else {
 					if (e.getMessage().equalsIgnoreCase("could not connect") ||
-							e.getMessage().equalsIgnoreCase("unkown host")) { 
+							e.getMessage().equalsIgnoreCase("unkown host")) {
 						// is there a better way to find out what happened?
 						ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
 					} else
-						ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
+						ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL);
 				}
 				inf.addWarning("\n"+ErrMessage);
 				//(new MessageBox(MyLocale.getMsg(144, "Warning"), ErrMessage, MessageBox.OKB)).exec();
@@ -665,7 +665,7 @@
 				e.printStackTrace();
 			}
 		} catch (MalformedURLException e) {
-			String ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring MalformedUrlException: " + e.getMessage()+ " while downloading from URL:" + fetchURL); 
+			String ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring MalformedUrlException: " + e.getMessage()+ " while downloading from URL:" + fetchURL);
 			inf.addWarning("\n"+ErrMessage);
 			pref.log(ErrMessage);
 		}
@@ -693,7 +693,7 @@
 			holder = getHolder(strData);
 			return;
 		}
-		if(name.equals("picture")){ 
+		if(name.equals("picture")){
 			//String fileName = holder.wayPoint + "_" + picUrl.substring(picUrl.lastIndexOf("/")+1);
 			getPic(picUrl,picTitle);
 			holder.getFreshDetails().hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
@@ -728,7 +728,7 @@
 			logFinder = new String(strData);
 			return;
 		}
-		if (name.equals("text")){ 
+		if (name.equals("text")){
 			logData = new String(strData);
 			return;
 		}
@@ -769,7 +769,7 @@
 	private CacheHolder getHolder(String wpt){// See also LOCXMLImporter
 		CacheHolder chx;
 		int index;
-		
+
 		index = cacheDB.getIndex(wpt);
 		if (index == -1) index = searchID(wpt);
 		if (index == -1) {

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -80,7 +80,7 @@
 	public static int SPIDER_ERROR = 0;
 	/** Cache was spidered without problems */
 	public static int SPIDER_OK = 1;
-	
+
 	private static int ERR_LOGIN = -10;
 	private static Preferences pref;
 	private Profile profile;
@@ -338,7 +338,7 @@
 		String postStr, dummy, ln, wpt;
 		Regex lineRex;
 		CacheHolder holder;
-		CWPoint origin = pref.curCentrePt; // No need to copy curCentrePt as it is only read and not written
+		CWPoint origin = pref.getCurCentrePt(); // No need to copy curCentrePt as it is only read and not written
 		if ( !spiderAllFinds && !origin.isValid()) {
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5509,"Coordinates for centre must be set"), FormBase.OKB)).execute();
 			return;
@@ -413,7 +413,7 @@
 		saveDistanceInMiles = java.lang.Math.ceil(saveDistanceInMiles) + 1;
 
 		Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
-		
+
 		if (pref.spiderUpdates != Preferences.NO) {
   		double distanceInKm = distance;
   		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
@@ -529,7 +529,7 @@
 								cachesToUpdate.clear();
 							} else {
 								cachesToLoad.add(waypoint);
-								
+
 								//if we don't want to update caches, we can stop directly after adding the maximum of new caches.
 								if ( (pref.spiderUpdates == Preferences.NO) && (maxNumber > 0) && (cachesToLoad.size() >= maxNumber)) {
 								  maxNumberAbort = true;
@@ -1215,13 +1215,13 @@
 		Extractor exImgBlock,exImgComment;
 		int idxUrl; // Index of already spidered Url in list of spideredUrls
 		CacheImages lastImages=null;
-		
+
 		// First: Get current image object of waypoint before spidering images.
 		CacheHolder oldCh = Global.getProfile().cacheDB.get(chD.getParent().getWayPoint());
 		if (oldCh != null) {
 			lastImages = oldCh.getFreshDetails().images;
 		}
-		
+
 		//========
 		//In the long description
 		//========
@@ -1775,7 +1775,7 @@
 				(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5504,"Could not load 'spider.def'"), FormBase.OKB)).execute();
 			}
 		}
-		
+
 		/**
 		 * Gets an entry in spider.def by its key (tag)
 		 * @param key The key which is attributed to a specific entry

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/myTableControl.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -1,6 +1,5 @@
 package CacheWolf;
 
-import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.utils.CWWrapper;
 import ewe.sys.*;
 import ewe.ui.*;
@@ -17,7 +16,7 @@
 	public Profile profile;
 	public CacheDB cacheDB;
 	public TablePanel tbp;
-	
+
 	private MenuItem miOpen, miGoto, miCenter, miUnhideAddis;
 	private MenuItem miOpenOnline, miOpenOffline, miLogOnline;
 	private MenuItem miDelete, miUpdate;
@@ -33,7 +32,7 @@
 		pref = Global.getPref();
 		tbp =tablePanel;
 		allowDragSelection = false; // allow only one row to be selected at one time
-				
+
 		MenuItem[] mnuFull = new MenuItem[14];
   	mnuFull[0] = miOpen = new MenuItem(MyLocale.getMsg(1021,"Open description"));
   	mnuFull[1] = miGoto = new MenuItem(MyLocale.getMsg(1010,"Goto"));
@@ -48,7 +47,7 @@
   	mnuFull[10] = miUpdate = new MenuItem(MyLocale.getMsg(1014,"Update"));
   	mnuFull[11] = miSeparator;
   	mnuFull[12] = miTickAll = new MenuItem(MyLocale.getMsg(1015,"Select all"));
-  	mnuFull[13] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,"De-select all"));	
+  	mnuFull[13] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,"De-select all"));
   	mFull = new Menu(mnuFull, MyLocale.getMsg(1013,"With selection"));
 
   	MenuItem[] mnuSmall = new MenuItem[8];
@@ -60,7 +59,7 @@
   	mnuSmall[5] = miOpenOnline;
   	mnuSmall[6] = miOpenOffline;
   	mnuSmall[7] = miLogOnline;
-  	mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013,"With selection"));	
+  	mSmall = new Menu(mnuSmall, MyLocale.getMsg(1013,"With selection"));
 	}
 
 	/** Full menu when listview includes checkbox */
@@ -69,7 +68,7 @@
 //		if (!Vm.getPlatform().equals("Win32") && !Vm.getPlatform().equals("Java"))
 //		   ((MenuItem)mFull.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
-	
+
 	public Menu getMenuFull() {
 		return mFull;
 	}
@@ -80,19 +79,19 @@
 		//if (!Vm.getPlatform().equals("Win32") && !Vm.getPlatform().equals("Java"))
 		//	   ((MenuItem)mSmall.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
-	
+
 	public void penRightReleased(Point p){
 		if (cacheDB.size()>0) { // No context menu when DB is empty
 			adjustAddiHideUnhideMenu();
 			menuState.doShowMenu(p,true,null); // direct call (not through doMenu) is neccesary because it will exclude the whole table
-			
+
 		}
 	}
 
     public void penHeld(Point p){
 		if (cacheDB.size()>0) // No context menu when DB is empty
 			adjustAddiHideUnhideMenu();
-			menuState.doShowMenu(p,true,null); 
+			menuState.doShowMenu(p,true,null);
 	}
 
 	public void onKeyEvent(KeyEvent ev) {
@@ -109,15 +108,15 @@
 				else if (ev.key == IKeys.PAGE_DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ getOnScreen(null).height-1, model.numRows-1)); //cursorTo(java.lang.Math.min(cursor.y+ getOnScreen(null).height-1, model.numRows-1),cursor.x+listMode,true); // I don't know why this doesn't work: tbp.doScroll(IScroll.Vertical, IScroll.PageHigher, 1);
 				else if (ev.key == IKeys.PAGE_UP) Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y-getOnScreen(null).height+1, 0)); // cursorTo(java.lang.Math.max(cursor.y-getOnScreen(null).height+1, 0),cursor.x+listMode,true);
 				else if (ev.key == IKeys.ACTION || ev.key == IKeys.ENTER) Global.mainTab.select(Global.mainTab.descP);
-				else if (ev.key == IKeys.DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ 1, model.numRows-1)); 
+				else if (ev.key == IKeys.DOWN) Global.mainTab.tbP.selectRow(java.lang.Math.min(cursor.y+ 1, model.numRows-1));
 				else if (ev.key == IKeys.UP) Global.mainTab.tbP.selectRow(java.lang.Math.max(cursor.y-1, 0));
-				else if (ev.key == IKeys.LEFT && Global.mainForm.cacheListVisible && cursor.y>=0 && cursor.y<tbp.myMod.numRows) Global.mainForm.cacheList.addCache(cacheDB.get(cursor.y).getWayPoint()); 
+				else if (ev.key == IKeys.LEFT && Global.mainForm.cacheListVisible && cursor.y>=0 && cursor.y<tbp.myMod.numRows) Global.mainForm.cacheList.addCache(cacheDB.get(cursor.y).getWayPoint());
 				else if (ev.key == IKeys.RIGHT) {
 					CacheHolder ch;
 					ch = cacheDB.get(tbp.getSelectedCache());
-					Global.mainTab.gotoP.setDestinationAndSwitch(ch); 
+					Global.mainTab.gotoP.setDestinationAndSwitch(ch);
 				}
-				else if (ev.key == 6 ) MainMenu.search(); // (char)6 == ctrl + f 
+				else if (ev.key == 6 ) MainMenu.search(); // (char)6 == ctrl + f
 				else super.onKeyEvent(ev);
 			}
 		}
@@ -129,13 +128,13 @@
 		Global.getProfile().setSelectForAll(selectStatus);
 		tbp.refreshTable();
 	}
-	
-	 
+
+
 	/** always select a whole row */
 	public boolean isSelected(int pRow,int pCol) {
 		return pRow==selection.y;
 	}
-	
+
 	public void popupMenuEvent(Object selectedItem){
 		if (selectedItem == null) return;
 		CacheHolder ch;
@@ -173,9 +172,9 @@
 			shouldDeleteCount = allCount;
 			if (addiNonVisibleCount + mainNonVisibleCount > 0){
 				if ((new MessageBox(MyLocale.getMsg(144,"Warning"),
-						            MyLocale.getMsg(1029, "There are caches that are ticked but invisible.\n(Main caches: ") + 
-						            	mainNonVisibleCount + MyLocale.getMsg(1030, ", additional Waypoints: ") + 
-						            	addiNonVisibleCount+")\n" + MyLocale.getMsg(1031, "Delete them, too?"), 
+						            MyLocale.getMsg(1029, "There are caches that are ticked but invisible.\n(Main caches: ") +
+						            	mainNonVisibleCount + MyLocale.getMsg(1030, ", additional Waypoints: ") +
+						            	addiNonVisibleCount+")\n" + MyLocale.getMsg(1031, "Delete them, too?"),
 						            	FormBase.YESB | FormBase.NOB)).execute() == FormBase.IDYES) {
 					deleteFiltered = true;
 				} else {
@@ -206,13 +205,13 @@
 					}
 					pbf.exit(0);
 					tbp.myMod.numRows-=nDeleted;
-					profile.saveIndex(pref,true);	
+					profile.saveIndex(pref,true);
 					tbp.refreshTable();
 				}
 			}
 			Vm.showWait(false);
 		} else
-				
+
 		if (selectedItem == miUpdate){
 			MainMenu.updateSelectedCaches(tbp);
 		} else
@@ -227,13 +226,11 @@
 			if (!cp.isValid()){
 				MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4111,"Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM"), FormBase.OKB);
 				tmpMB.execute();
-			} else {				
-				pref.curCentrePt.set(cp);
-				Global.mainTab.updateBearDist(); // Update the distances with a warning message
-				//tbp.refreshTable();
+			} else {
+				pref.setCurCentrePt(cp);
 			}
 		} else
-		
+
 		if (selectedItem == miUnhideAddis) {
 			// This toggles the "showAddis" Flag
 			ch = cacheDB.get(tbp.getSelectedCache());
@@ -249,9 +246,9 @@
 
 		if (selectedItem == miGoto){
 			ch = cacheDB.get(tbp.getSelectedCache());
-			Global.mainTab.gotoP.setDestinationAndSwitch(ch); 
+			Global.mainTab.gotoP.setDestinationAndSwitch(ch);
 		} else
-		    
+
 		if (selectedItem == miOpenOnline){
 			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
@@ -269,14 +266,14 @@
 				}
 			}
 		} else
-		    
+
 		if (selectedItem == miOpenOffline) {
 			if(browserPathIsValid()){
 				ShowCacheInBrowser sc=new ShowCacheInBrowser();
 				sc.showCache(cacheDB.get(tbp.getSelectedCache()));
 			}
 		} else
-			
+
 		if (selectedItem == miLogOnline){
 			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
@@ -298,7 +295,7 @@
 									URL = "";
 								}
 							} else {
-								URL = "http://www.geocaching.com/seek/log.aspx?ID=" + mainCache.GetCacheID();								
+								URL = "http://www.geocaching.com/seek/log.aspx?ID=" + mainCache.GetCacheID();
 							}
 
 							if (URL.length() > 0) {
@@ -320,13 +317,13 @@
 			}
 		} else
 
-		    
+
 		if (selectedItem == miOpen){
 			penDoubleClicked(null);
 		}
 
 	}
-	
+
 	public boolean browserPathIsValid() {
 		if(!new File(pref.browser).exists()){
 			(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(1032,"Path to browser:")+"\n"+pref.browser+"\n"+MyLocale.getMsg(1033,"is incorrect!"),FormBase.OKB)).execute();
@@ -335,15 +332,15 @@
 		else
 			return true;
 	}
-	
+
 	public void penDoubleClicked(Point where) {
 		Global.mainTab.select(Global.mainTab.descP);
 	}
-	
+
 	public void onEvent(Event ev) {
 		if (ev instanceof PenEvent && (ev.type == PenEvent.PEN_DOWN) ){
 			Global.mainTab.tbP.myMod.penEventModifiers=((PenEvent)ev).modifiers;
-	    } 
+	    }
 
 		super.onEvent(ev);
 	}
@@ -352,7 +349,7 @@
 	 * Adjusting the menu item for hiding or unhiding additional waypoints. If the cache has no
 	 * addis, then the menu is deactivated. If it has addis, then the menu text is adapted according
 	 * to the current value of the property <code>showAddis()</code>.
-	 * 
+	 *
 	 */
 	public void adjustAddiHideUnhideMenu() {
 		if (tbp.getSelectedCache() < 0) {
@@ -375,19 +372,19 @@
 			}
 		}
 	}
-	
+
 	// /////////////////////////////////////////////////
 	// Allow the caches to be dragged into a cachelist
     ///////////////////////////////////////////////////
-	
+
 	IconAndText imgDrag;
 	String wayPoint;
 	int row;
-	
+
 	public void startDragging(DragContext dc) {
 		 Point p=cellAtPoint(dc.start.x,dc.start.y,null);
 		 wayPoint=null;
-		 if (p.y>=0) { 
+		 if (p.y>=0) {
 			if (!Global.mainForm.cacheListVisible) {
 				dc.cancelled=true;
 				return;
@@ -421,7 +418,7 @@
 			 //Vm.debug("Control "+c.toString()+"/"+c.text);
 		 }else super.stopDragging(dc);
 	 }
-	 
+
 	 public void dragged(DragContext dc) {
 	 	if (wayPoint!=null)
 		   dc.imageDrag();
@@ -453,24 +450,24 @@
 	 {
 		 Point p2 = cellAtPoint(p.x,p.y,null);
 		 super.penReleased(p, isDouble);
-		 Rect sel = getSelection(null); 
-		 if ((sel.height == 0 || sel.height == 0) && p2 != null) cursorTo(p2.y,p2.x, true); // if the selection is gone -> reselect it 
-			 
+		 Rect sel = getSelection(null);
+		 if ((sel.height == 0 || sel.height == 0) && p2 != null) cursorTo(p2.y,p2.x, true); // if the selection is gone -> reselect it
+
 	 }
 
 	 class myProgressBarForm extends ProgressBarForm {
 
 		 boolean isClosed=false;
-		 
+
 		 protected boolean canExit(int exitCode) {
 			isClosed=true;
 			return true;
 		 }
-		 
+
 	 }
-	 
-	 
 
+
+
 	public Menu getMenuSmall() {
 		return mSmall;
 	}

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -70,7 +70,7 @@
 	MenuItem miNorthCentered;
 
 	/**
-	 * Create GotoPanel 
+	 * Create GotoPanel
 	 * @param Preferences 	global preferences
 	 * @param MainTab		reference to MainTable
 	 * @param DetailsPanel 	reference to DetailsPanel
@@ -90,7 +90,7 @@
 		ButtonP.addNext(btnSave = new mButton(MyLocale.getMsg(311,"Create Waypoint")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		ButtonP.addLast(btnMap = new mButton(MyLocale.getMsg(1506,"Map")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 
-		//Format selection for coords		
+		//Format selection for coords
 		//context menu
 		mnuContextFormt = new Menu();
 		currFormatSel = 1; // default to d? m.m
@@ -174,7 +174,7 @@
 		//		// myGPS.noInterpretableData();
 
 
-		//		}	
+		//		}
 	}
 
 	public void resizeTo(int pWidth, int pHeight){
@@ -185,19 +185,19 @@
 			//some space for the SIP button
 			if ( (Vm.getParameter(VmConstants.VM_FLAGS) & (VmConstants.VM_FLAG_SIP_BUTTON_ON_SCREEN)) == (VmConstants.VM_FLAG_SIP_BUTTON_ON_SCREEN) ){
 				Rect screen = (Rect)Window.getGuiInfo(WindowConstants.INFO_SCREEN_RECT,null,new Rect(),0);
-				roseHeight -= screen.height / 14;				
+				roseHeight -= screen.height / 14;
 			}
 		}
-		roseP.resizeTo(pWidth, roseHeight); 
+		roseP.resizeTo(pWidth, roseHeight);
 		icRose.resizeTo(pWidth, roseHeight);
 		compassRose.resize(pWidth, roseHeight);
 	}
 
 
 	/**
-	 * set the coords of the destination  
+	 * set the coords of the destination
 	 * @param dest destination
-	 */ 
+	 */
 	public void setDestination(CWPoint dest){
 		myNavigation.setDestination(dest);
 		if (!myNavigation.destination.isValid()) (new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(1507,"Coordinates are out of range:") +"\n"+MyLocale.getMsg(1508,"latitude")+": "+myNavigation.destination.latDec+"\n "+MyLocale.getMsg(1509,"longditue")+": "+myNavigation.destination.lonDec, FormBase.OKB)).execute();
@@ -211,9 +211,9 @@
 
 
 	/**
-	 * set the coords of the destination and switch to gotoPanel  
+	 * set the coords of the destination and switch to gotoPanel
 	 * @param LatLon destination
-	 */ 
+	 */
 	public void setDestinationAndSwitch(CWPoint where) {
 		myNavigation.setDestination(where);
 		mainT.select(this);
@@ -238,8 +238,8 @@
 	}
 
 	/**
-	 * method which is called if a timer is set up  
-	 */ 
+	 * method which is called if a timer is set up
+	 */
 	public void updateGps(int fix) {
 		Double bearMov = new Double();
 		Double speed = new Double();
@@ -306,21 +306,21 @@
 			else {
 				if (mainT.ch != null && mainT.ch.pos.isValid()) centerTo = new CWPoint(mainT.ch.pos);
 				else {
-					if (pref.curCentrePt.isValid()) centerTo = new CWPoint(pref.curCentrePt);
+					if (pref.getCurCentrePt().isValid()) centerTo = new CWPoint(pref.getCurCentrePt());
 				}
 			}
 		}
 		if (centerTo != null && centerTo.isValid())
 			mainT.SwitchToMovingMap(centerTo, false);
 		else
-			(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1513, "Cannot start moving map without valid coordinates. Please enter coordinates as destination, as center, in selected cache or start GPS"), FormBase.OKB)).execute(); 
+			(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1513, "Cannot start moving map without valid coordinates. Please enter coordinates as destination, as center, in selected cache or start GPS"), FormBase.OKB)).execute();
 	}
 
 	/**
 	 * Eventhandler
 	 */
 	public void onEvent(Event ev){
-		if (ev instanceof MenuEvent) { 
+		if (ev instanceof MenuEvent) {
 			if (ev.type == MenuEvent.SELECTED) {
 				if (((MenuEvent)ev).menu == mnuContextFormt) {
 					mnuContextFormt.close();
@@ -343,7 +343,7 @@
 						if (action == miNorthCentered) {
 							if (compassRose.isNorthCentered()) {
 								compassRose.setNorthCentered(false);
-								miNorthCentered.modifiers &= ~MenuItem.Checked;							
+								miNorthCentered.modifiers &= ~MenuItem.Checked;
 							}
 							else
 							{
@@ -363,19 +363,16 @@
 				else myNavigation.stopGps();
 			}
 
-			// set current position as centre and recalculate distance of caches in MainTab 
+			// set current position as centre and recalculate distance of caches in MainTab
 			if (ev.target == btnCenter){
 				if (myNavigation.gpsPos.isValid()) {
-					Vm.showWait(true);
-					pref.curCentrePt.set(myNavigation.gpsPos);
-					mainT.updateBearDist();
-					Vm.showWait(false);
+					pref.setCurCentrePt(myNavigation.gpsPos);
 				} else (new MessageBox(MyLocale.getMsg(312, "Error"), MyLocale.getMsg(1514, "Cannot recalculate distances, because the GPS position is not set"), FormBase.OKB)).execute();
 			}
 			//Start moving map
 			if (ev.target == btnMap){
 				switchToMovingMap();
-			} 
+			}
 			// create new waypoint with current GPS-position
 			if (ev.target == btnSave){
 				CacheHolder ch = new CacheHolder();
@@ -511,16 +508,16 @@
 		String strTemp = MyLocale.getMsg(1512, "Waypoint");
 		g.setColor(Color.DarkBlue);
 		g.fillRect(0, 0, fm.getTextWidth(strTemp) + 4, lineHeight);
-		g.setColor(Color.White);		
+		g.setColor(Color.White);
 		g.drawText(strTemp, 2, 0);
 
-		g.setColor(Color.Black);		
+		g.setColor(Color.Black);
 
 		int metricSystem = Global.getPref().metricSystem;
 		Double tmp = new Double();
 		strTemp = "";
 		double newDistance = 0;
-		int bigUnit = -1; 
+		int bigUnit = -1;
 		int smallUnit = -1;
 		double threshold = -1;
 		// Allow for different metric systems
@@ -577,7 +574,7 @@
 		}
 		if (tmp.value >= 0) {
 			if (tmp.value >= 100) {
-				strSpeed = MyLocale.formatDouble(tmp,"0") + unit;				
+				strSpeed = MyLocale.formatDouble(tmp,"0") + unit;
 			}
 			else {
 				strSpeed = MyLocale.formatDouble(tmp,"0.0") + unit;
@@ -595,8 +592,8 @@
 		int startX = location.width - (textWidth + 4);
 		g.fillRect(startX, 0, location.width - startX, lineHeight);
 
-		g.setColor(Color.Black);		
-		g.drawText(strHeadline, startX + 2, 0);		
+		g.setColor(Color.Black);
+		g.drawText(strHeadline, startX + 2, 0);
 		g.drawText(strSpeed, startX + 2, lineHeight);
 		g.drawText(strMoveDir, startX + 2, 2*lineHeight);
 	}
@@ -615,7 +612,7 @@
 		int startY = location.height - 2*lineHeight;
 		g.fillRect(0, startY, textWidth + 4, location.height - startY);
 
-		g.setColor(Color.Black);		
+		g.setColor(Color.Black);
 		g.drawText(m_Luminary, 2, startY);
 		g.drawText(strSunDir, 2, startY + lineHeight);
 	}
@@ -705,8 +702,8 @@
 					g.drawLine(location.width/2, location.height/2 - radius, location.width/2, location.height/2 + radius);
 
 					if (gotoDir < 360 && gotoDir > -360) drawThinArrow(g, gotoDir - moveDir, Color.DarkBlue, moveDirColor, 1.0f);
-					if (sunDir < 360 && sunDir > -360) drawSunArrow(g, sunDir - moveDir, YELLOW, 0.75f);					
-				}				
+					if (sunDir < 360 && sunDir > -360) drawSunArrow(g, sunDir - moveDir, YELLOW, 0.75f);
+				}
 			}
 		}
 	}
@@ -767,7 +764,7 @@
 		g.fillPolygon(pointsX, pointsY, 4);
 		if (colPoint != null) {
 			g.setBrush(new Brush(colPoint, Brush.SOLID));
-			g.fillPolygon(pointsX, pointsY, 3);			
+			g.fillPolygon(pointsX, pointsY, 3);
 		}
 	}
 
@@ -781,7 +778,7 @@
 			drawRosePart(g,  45 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, "NE", bDrawText);
 			drawRosePart(g, 135 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, "SE", bDrawText);
 			drawRosePart(g, 225 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, "SW", bDrawText);
-			drawRosePart(g, 315 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, "NW", bDrawText);	
+			drawRosePart(g, 315 + angle, colLeft, colRight, colBorder, colText, scale * subScale2, innerScale, "NW", bDrawText);
 		}
 
 		drawRosePart(g,   0 + angle, colNorthLeft, colNorthRight, colBorder, colText, scale * subScale1, innerScale, "N", bDrawText);

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -17,7 +17,7 @@
 /**
  * @author pfeffer
  * This Class is the Dialog for Download calibrated from expedia.com
- * is called from 
+ * is called from
  *  * start offset for language file: 1800
  */
 
@@ -67,8 +67,8 @@
 
 	public MapLoaderGui(CacheDB cacheDBi) {
 		super();
-		this.title = MyLocale.getMsg(1800, "Download georeferenced maps"); 
-		center = new CWPoint(pref.curCentrePt);
+		this.title = MyLocale.getMsg(1800, "Download georeferenced maps");
+		center = new CWPoint(pref.getCurCentrePt());
 		cacheDB = cacheDBi;
 		mapLoader = new MapLoader(FileBase.getProgramDirectory()+"/"+"webmapservices");
 
@@ -76,7 +76,7 @@
 		unsortedMapServices = mapLoader.getAvailableOnlineMapServices();
 		sortMapServices();
 		mapServiceChoice = new mChoice(sortedmapServices, 0);
-		MessageArea desc = new MessageArea(descString); 
+		MessageArea desc = new MessageArea(descString);
 		desc.modifyAll(ControlConstants.NotEditable | ControlConstants.DisplayOnly | ControlConstants.NoFocus, ControlConstants.TakesKeyFocus);
 		desc.borderStyle = UIConstants.BDR_NOBORDER;
 		this.addLast(desc);
@@ -137,7 +137,7 @@
 		setRecommScaleInput();
 		this.addLast(mTab);
 	}
-	
+
 	private void setRecommScaleInput(){
 		String[] recScales = new String[mapLoader.currentOnlineMapService.recommendedScales.length];
 		for (int i=0; i<recScales.length; i++) {
@@ -151,10 +151,10 @@
 
 	/**
 	 * sort the map services in order to have the services, which cover
-	 * the current center first in the list 
+	 * the current center first in the list
 	 * this sets inbound[], sortedMapServices[] and sortingmapServices[]
 	 *
-	 */	
+	 */
 	private void sortMapServices() {
 		sortingMapServices = new int[unsortedMapServices.length+1];
 		inbound = new boolean[unsortedMapServices.length];
@@ -169,7 +169,7 @@
 		int k=j;
 		sortedmapServices = new String[unsortedMapServices.length+1];
 		for (int i=0; i < sortedmapServices.length-1; i++) {
-			if (!inbound[i]) { 
+			if (!inbound[i]) {
 				sortingMapServices[j] = i;
 				j++;
 			}
@@ -180,7 +180,7 @@
 		sortingMapServices[j]=sortingMapServices[k];
 		sortingMapServices[k]=-1;
 	}
-	
+
 	private int getSortedMapServiceIndex(int originalindex) {
 		for (int i = 0; i < sortingMapServices.length; i++) {
 			if (sortingMapServices[i] == originalindex) return i;
@@ -213,7 +213,7 @@
 		} while (StartPos<LastPos);
 		return LeadingPath;
 	}
-	
+
 	public void downloadTiles() {
 		String mapsDir = getMapsDir();
 		if (mapsDir == null) return;
@@ -245,12 +245,12 @@
 				return;
 			}
 			mapLoader.setTiles(surArea.topleft, surArea.buttomright, scale, size, overlapping );
-		} else 
+		} else
 		{ // calculate from centre point an radius
 			mapLoader.setTiles(center, radius * 1000, scale, size, overlapping);
 		}
 		if (overviewmap) {
-			progressBox.setInfo(MyLocale.getMsg(1824, "downloading overview map")); 
+			progressBox.setInfo(MyLocale.getMsg(1824, "downloading overview map"));
 			float overviewScale = MapLoader.getScale(center, radius * 1000, size);
 			try {
 				mapLoader.downloadMap(center, overviewScale, size, mapsDir);
@@ -262,7 +262,7 @@
 			mapLoader.setProgressInfoBox(progressBox);
 			mapLoader.downlaodTiles(mapsDir);
 		} else { // per cache
-			CacheHolder ch; 
+			CacheHolder ch;
 			CWPoint tmpca = new CWPoint();
 			int numdownloaded = 0;
 			Global.getProfile().getSourroundingArea(onlySelected); // calculate numCachesInArea
@@ -292,7 +292,7 @@
 		progressBox.waitUntilClosed();
 		mapLoader.setProgressInfoBox(null);
 		//progressBox.close(0);
-		if(Global.mainTab.mm != null) Global.mainTab.mm.mapsloaded = false; 
+		if(Global.mainTab.mm != null) Global.mainTab.mm.mapsloaded = false;
 		//	(new MessageBox("Download maps", "Downloaded and calibrated the maps successfully", MessageBox.OKB)).execute();
 	}
 
@@ -326,7 +326,7 @@
 			}
 			else if (ev.target == okBtiles || ev.target == okBPerCache){
 				if (sortingMapServices[mapServiceChoice.selectedIndex] == -1) {
-					(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1833, "Please don't select the separator line in the wms service option"), FormBase.OKB)).execute(); 
+					(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1833, "Please don't select the separator line in the wms service option"), FormBase.OKB)).execute();
 				}
 				mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
 				if (ev.target == okBtiles) { // get tiles
@@ -338,11 +338,11 @@
 					scale = (float)CacheWolf.Common.parseDouble(scaleInput.getText());
 					overlapping = Convert.toInt(overlappingInput.getText());
 					if (!forCachesChkBox.getState()) {
-						if (radius <= 0) { 
+						if (radius <= 0) {
 							(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1827, "'radius' must be greater than 0"), FormBase.OKB)).execute();
 							return;
 						}
-						if (overlapping < 0) { 
+						if (overlapping < 0) {
 							(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1828, "'overlapping' must be greater or equal 0"), FormBase.OKB)).execute();
 							return;
 						}
@@ -369,7 +369,7 @@
 					(new MessageBox(MyLocale.getMsg(321, "Error"), "! " + scale + "\n" + MyLocale.getMsg(1830, "The selected online map service provides map in the scale from") + " " + mapLoader.currentOnlineMapService.minscale + MyLocale.getMsg(1831, " to") + " " + mapLoader.currentOnlineMapService.maxscale + MyLocale.getMsg(1832, "\n please adjust 'Approx. meter pro pixel' accordingly"), FormBase.OKB)).execute();
 					return;
 				}
-				this.close(FormBase.IDOK); 
+				this.close(FormBase.IDOK);
 				this.downloadTiles();
 			}
 			else if (ev.target == coosBtn) {

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-15 22:49:40 UTC (rev 2284)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-16 15:43:20 UTC (rev 2285)
@@ -414,17 +414,17 @@
 		running = true;
 
 		// to load maplist + place a map on screen otherwise no symbol can be placed
-		updatePosition(centerTo); 
-		
+		updatePosition(centerTo);
+
 		// update cache symbols in map
 		if (Global.getProfile().selectionChanged) {
 			// this means marking has changed
 			Global.getProfile().selectionChanged = false;
-			if (getShowCachesOnMap()) removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap			
+			if (getShowCachesOnMap()) removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap
 		}
 		setMarkedCache(Global.mainTab.ch); // this is the selected one (not necessary marked)
 		showCachesOnMap();
-		
+
 		addTrack(myNavigation.curTrack);
 		if (tracks != null && tracks.size() > 0 && ((Track)tracks.get(0)).num > 0)
 			rebuildOverlaySet(); // show points which where added when MavingMap was not running
@@ -435,7 +435,7 @@
 		else {
 			destChanged(myNavigation.destination);
 		}
-		
+
 		repaint();
 		return ret;
 	}
@@ -1012,7 +1012,7 @@
 		if (forceMapLoad || wantMapTest || screenNotCompletlyCovered) { // if force || want || map doesn't cover the screen completly
 			// Vm.debug("Screen not completly covered by map");
 			if (forceMapLoad ||
-				(java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 || 
+				(java.lang.Math.abs(lastCompareX - mapPos.x) > this.width / 10 ||
 				 java.lang.Math.abs(lastCompareY - mapPos.y) > this.height / 10)) {
 				// more then 1/10 of screen moved since last time we tried to find a better map
 				if (autoSelectMap) {
@@ -1080,18 +1080,18 @@
 				else {
 					// remove the right one , as
 					// possibly more than one picture associated with ch (target,selected ..)
-					removeMapSymbol(ch.cacheName); 
+					removeMapSymbol(ch.cacheName);
 				}
 			}
 		}
-		// adding target and selected 
+		// adding target and selected
 		// show target
 		if (gotoPos != null) {
 			// the CacheHolder Symbol must be inserted too, even if not marked (if it is Cache)
-			// anywhere there if all Caches shown on map 
+			// anywhere there if all Caches shown on map
 			CacheHolder gotoPosCH = null;
 			if (gotoPos.mapObject instanceof CacheHolder) {
-				gotoPosCH = (CacheHolder) gotoPos.mapObject;				
+				gotoPosCH = (CacheHolder) gotoPos.mapObject;
 			}
 			if (!getShowCachesOnMap() && (gotoPosCH != null)) {
 				addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType()), gotoPosCH.pos);
@@ -1114,7 +1114,7 @@
 			AniImage im = (AniImage) mmp.images.get(i);
 			if (!(im instanceof MapImage) ||
 				(im instanceof MapSymbol) ||
-				(im instanceof TrackOverlay) || 
+				(im instanceof TrackOverlay) ||
 				mmp.mapImage == im) {
 				icons.add(im);
 			}
@@ -2181,7 +2181,7 @@
 			if (mm.gotoPos != null) moveToDestMI.modifiers &= ~MenuItem.Disabled;
 			else moveToDestMI.modifiers |= MenuItem.Disabled;
 			mapsMenu.addItem(moveToDestMI);
-			if (Global.getPref().curCentrePt.isValid()) moveToCenterMI.modifiers &= ~MenuItem.Disabled;
+			if (Global.getPref().getCurCentrePt().isValid()) moveToCenterMI.modifiers &= ~MenuItem.Disabled;
 			else moveToCenterMI.modifiers |= MenuItem.Disabled;
 			mapsMenu.addItem(moveToCenterMI);
 			mapsMenu.addItem(moveToGpsMI);
@@ -2343,7 +2343,7 @@
 						// moveto position
 						else if (action == moveToCenterMI) {
 							mapsMenu.close();
-							mm.setCenterOfScreen(Global.getPref().curCentrePt, true);
+							mm.setCenterOfScreen(Global.getPref().getCurCentrePt(), true);
 						}
 						else if (action == moveToDestMI) {
 							mapsMenu.close();



From pfeffer at mail.berlios.de  Fri Oct 16 21:31:57 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 16 Oct 2009 21:31:57 +0200
Subject: [Cachewolf-svn] r2286 - trunk/src/CacheWolf/navi
Message-ID: <200910161931.n9GJVv7l005645@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-16 21:31:55 +0200 (Fri, 16 Oct 2009)
New Revision: 2286

Modified:
   trunk/src/CacheWolf/navi/UTMProjection.java
Log:
UTM-Projection: bug fixed: in one half of the stripes it was not cerreectly calculated, see http://www.geoclub.de/viewtopic.php?f=40&t=38960 for the bug report

Modified: trunk/src/CacheWolf/navi/UTMProjection.java
===================================================================
--- trunk/src/CacheWolf/navi/UTMProjection.java	2009-10-16 15:43:20 UTC (rev 2285)
+++ trunk/src/CacheWolf/navi/UTMProjection.java	2009-10-16 19:31:55 UTC (rev 2286)
@@ -34,7 +34,7 @@
 	public ProjectedPoint project(CWPoint wgs84, ProjectedPoint pp) {
 		int stripe = (int) Math.floor((wgs84.lonDec - 180) / 6); // we start with stripe 0, but officially this is stripe 1
 		if (stripe < 0) stripe += 60;
-		GkProjection.project(wgs84, ellip, 6, stripe -30, 3, 0.9996, pp);
+		GkProjection.project(wgs84, ellip, 6, (stripe >= 30 ? stripe -30 : stripe +30), 3, 0.9996, pp);
 		pp.zone = stripe;
 		pp.zone += (int) (Math.floor((wgs84.latDec)/8)+13) * 200; // zone letter
 		return pp;



From araber95 at mail.berlios.de  Fri Oct 16 22:13:16 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 16 Oct 2009 22:13:16 +0200
Subject: [Cachewolf-svn] r2287 - trunk/src/CacheWolf
Message-ID: <200910162013.n9GKDGY1012260@sheep.berlios.de>

Author: araber95
Date: 2009-10-16 22:13:14 +0200 (Fri, 16 Oct 2009)
New Revision: 2287

Modified:
   trunk/src/CacheWolf/MainMenu.java
Log:
reset sorting on changing  profile. (simple bugfix)

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-10-16 19:31:55 UTC (rev 2286)
+++ trunk/src/CacheWolf/MainMenu.java	2009-10-16 20:13:14 UTC (rev 2287)
@@ -290,6 +290,7 @@
 			if(mev.selectedItem == mnuOpenProfile){
 				Global.mainTab.saveUnsavedChanges(true);
 				if (pref.selectProfile(profile,Preferences.PROFILE_SELECTOR_FORCED_ON,false)) {
+					tbp.myMod.sortedBy=-1;
 					tbp.myMod.numRows=0;
 					CacheHolder.removeAllDetails();
 					profile.cacheDB.clear();



From mik77 at mail.berlios.de  Fri Oct 16 23:02:37 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 16 Oct 2009 23:02:37 +0200
Subject: [Cachewolf-svn] r2288 - trunk/src/CacheWolf/imp
Message-ID: <200910162102.n9GL2bfS020655@sheep.berlios.de>

Author: mik77
Date: 2009-10-16 23:02:28 +0200 (Fri, 16 Oct 2009)
New Revision: 2288

Modified:
   trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Only check selected type for updates when spidering only one cache type.

Modified: trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-10-16 20:13:14 UTC (rev 2287)
+++ trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2009-10-16 21:02:28 UTC (rev 2288)
@@ -219,4 +219,55 @@
 		}
 		return cacheTypeRestriction;
 	}
+	
+	public byte getRestrictedCacheType(SpiderProperties p){
+		byte RestrictedType = CacheType.CW_TYPE_ERROR;
+
+		if (chcType!=null){
+			try {
+				switch (chcType.getInt()) {
+				case  0:
+					RestrictedType = CacheType.CW_TYPE_ERROR;
+					break;
+				case  1: 
+					RestrictedType = CacheType.CW_TYPE_TRADITIONAL;
+					break;
+				case  2:
+					RestrictedType = CacheType.CW_TYPE_MULTI;
+					break;
+				case  3:
+					RestrictedType = CacheType.CW_TYPE_VIRTUAL;
+					break;
+				case  4:
+					RestrictedType = CacheType.CW_TYPE_LETTERBOX;
+					break;
+				case  5:
+					RestrictedType = CacheType.CW_TYPE_EVENT;
+					break;
+				case  6:
+					RestrictedType = CacheType.CW_TYPE_MEGA_EVENT;
+					break;
+				case  7:
+					RestrictedType = CacheType.CW_TYPE_WEBCAM;
+					break;
+				case  8:
+					RestrictedType = CacheType.CW_TYPE_UNKNOWN;
+					break;
+				case 9:
+					RestrictedType = CacheType.CW_TYPE_CITO;
+					break;
+				case 10:
+					RestrictedType = CacheType.CW_TYPE_EARTH;
+					break;
+				case 11:
+					RestrictedType = CacheType.CW_TYPE_WHEREIGO;
+					break;
+				default:
+					RestrictedType = CacheType.CW_TYPE_ERROR;
+				}
+			}catch (Exception ex) { // Some tag missing from spider.def
+			}
+		}
+		return RestrictedType;
+	}
 }

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-16 20:13:14 UTC (rev 2287)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-16 21:02:28 UTC (rev 2288)
@@ -415,22 +415,28 @@
 		Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
 
 		if (pref.spiderUpdates != Preferences.NO) {
-  		double distanceInKm = distance;
-  		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
-  			distanceInKm = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
-  		}
-  		for(int i = 0; i<cacheDB.size();i++){
-  			ch = cacheDB.get(i);
-  			if (spiderAllFinds) {
-  				if ( (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) ) {
-  					cachesToUpdate.put(ch.getWayPoint(), ch);
-  				}
-  			} else {
-  				if ( (!ch.is_archived()) && (ch.kilom <= distanceInKm) && !(doNotgetFound && (ch.is_found() || ch.is_owned())) && (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) ) {
-  					cachesToUpdate.put(ch.getWayPoint(), ch);
-  				}
-  			}
-  		}
+			double distanceInKm = distance;
+			if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
+				distanceInKm = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
+			}
+			byte restrictedCacheType = options.getRestrictedCacheType(p);
+			for(int i = 0; i<cacheDB.size();i++){
+				ch = cacheDB.get(i);
+				if (spiderAllFinds) {
+					if ( (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC"))
+					     && ( (restrictedCacheType == CacheType.CW_TYPE_ERROR) || (ch.getType() == restrictedCacheType) ) ) {
+						cachesToUpdate.put(ch.getWayPoint(), ch);
+					}
+				} else {
+					if ( (!ch.is_archived())
+						 && (ch.kilom <= distanceInKm)
+						 && !(doNotgetFound && (ch.is_found() || ch.is_owned()))
+						 && (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC"))
+						 && ( (restrictedCacheType == CacheType.CW_TYPE_ERROR) || (ch.getType() == restrictedCacheType) ) ) {
+						cachesToUpdate.put(ch.getWayPoint(), ch);
+					}
+				}
+			}
 		}
 
 		//=======
@@ -474,8 +480,13 @@
 		try {
 			//Loop till maximum distance has been found or no more caches are in the list
 			while(distance > 0){
-				if (infB.isClosed) break;
+				if (infB.isClosed){
+					//don't update existing caches, because list is not correct when aborting
+					cachesToUpdate.clear();
 
+					break;
+				}
+
 				rexViewstate.search(start);
 				if(rexViewstate.didMatch()){
 					viewstate = rexViewstate.stringMatched(1);
@@ -532,14 +543,14 @@
 
 								//if we don't want to update caches, we can stop directly after adding the maximum of new caches.
 								if ( (pref.spiderUpdates == Preferences.NO) && (maxNumber > 0) && (cachesToLoad.size() >= maxNumber)) {
-								  maxNumberAbort = true;
+									maxNumberAbort = true;
 
-							   	//add no more caches
-								  distance = 0;
+									//add no more caches
+									distance = 0;
 
-								  //don't update existing caches, because list is not correct when aborting
-								  cachesToUpdate.clear();
-                }
+									//don't update existing caches, because list is not correct when aborting
+									cachesToUpdate.clear();
+								}
 							}
 						} else {
 							pref.log(waypoint+" already in DB");



From pfeffer at mail.berlios.de  Fri Oct 16 23:30:19 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 16 Oct 2009 23:30:19 +0200
Subject: [Cachewolf-svn] r2289 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200910162130.n9GLUJms025077@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-16 23:30:13 +0200 (Fri, 16 Oct 2009)
New Revision: 2289

Added:
   trunk/src/CacheWolf/GeoCodeGui.java
   trunk/src/CacheWolf/GeocoderOsm.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/HttpConnection.java
   trunk/src/CacheWolf/UrlFetcher.java
Log:
CoordsScreen: New feature: online search for place names (using the OpenStreetMap XML-interface)

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-16 21:30:13 UTC (rev 2289)
@@ -416,6 +416,7 @@
 		1411=Bitte g%fcltige Koordinaten eingeben.
 		1412=Koordinaten ung%fcltig. Trotzdem %fcbernehmen?
 		1413=L%f6schen
+		1414=Suchen
 		1500=Ziel:
 		1501=Aktuell
 		1502=Grad
@@ -916,6 +917,15 @@
 		7121=Daten per GPSD empfangen von
 		7122=Die GPS-Daten werden per GPSD von einem anderen Server oder localhost empfangen (statt per seriellem Port)
 		7200=Aufruf: CacheWolf [-c <Pfad zur Einstellungsdatei>] [-debug]
+        7300=Stra%dfe/POI
+        7301=Stadt
+        7302=Suchen
+        7303=Abbr.
+        7304=berlin, deutschland
+        7305=Hauptbahnhof
+        7306=suche...
+        7307=abgebrochen durch Nutzer
+        7308=Fehler bei der online Verbindung
 		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-16 21:30:13 UTC (rev 2289)
@@ -416,6 +416,7 @@
 		1411=Please enter valid coordinates
 		1412=Coordinates invalid. Apply anyway?
 		1413=Clear
+		1414=Search
 		1500=DST:
 		1501=Current
 		1502=deg
@@ -899,6 +900,15 @@
 		7121=Receive GPS from gpsd host
 		7122=GPS data will be received from a gpsd server, not from a serial port
 		7200=Usage: CacheWolf [-c <path to pref.xml>] [-debug]
+        7300=Street/POI
+        7301=City
+        7302=Search
+        7303=Cancel
+        7304=new york, usa
+        7305=wallstreet
+        7306=searching...
+        7307=Canceled by user
+        7308=Could not connect
 		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-16 21:30:13 UTC (rev 2289)
@@ -412,6 +412,7 @@
 		1411=Entrez coordonn%e9es valides, svp.
 		1412=Coordonn%e9es pas valides. Prendre-les quand-m?me ?
 		1413=Effacer
+		1414=Recherche
 		1500=Destination:
 		1501=Actuel
 		1502=Degr%e9
@@ -870,6 +871,14 @@
 		7021=Ce type de version
 		7022=Type de version
 		7023=Erreur en t%e9l%e9chargeant les informations de version
-		{..}
+        7300=Street / POI 
+        7301=Ville 
+        7302=Recherche 
+        7303=Annuler 
+        7304=paris
+        7305=avenue des champs-elysees 
+        7306=Recherche en cours... 
+        7307=Annul%e9 par l'utilisateur 
+        7308=Impossible de se connecter		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-16 21:30:13 UTC (rev 2289)
@@ -389,6 +389,7 @@
 		1404=Afstand
 		1405=Om co%f6rdinaten te laden van GC, geef onder in GCxxxx.
 		1406=Geef co%f6rdinaten in (alle formaten mogelijk) of GCxxxx.
+		1414=Zoeken
 		1500=Doel:
 		1501=Huidig
 		1502=Graden
@@ -657,6 +658,15 @@
 		6104=Cassiopeia
 		6105=Zwaan
 		6106=Zuiderkruis
-		{..}
+    7300=Straat / POI 
+    7301=Stad 
+    7302=Zoeken 
+    7303=Annuleren 
+    7304=Amsterdam 
+    7305=centraal station
+    7306=zoeken... 
+    7307=geannuleerd door gebruiker 
+    7308=Kan geen verbinding		
+    {..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-16 21:30:13 UTC (rev 2289)
@@ -414,6 +414,7 @@
                 1411=Wprowadz poprawne wspolrzedne
                 1412=Niepoprawne wspolrzedne. Uzyc tak czy tak?
                 1413=Czysto
+                1414=Szukaj
                 1500=DST:
                 1501=Aktualna
                 1502=deg
@@ -894,6 +895,15 @@
                 7121=Pobierz dane GPS z gpsd host
                 7122=Dane GPS beda pobrane z serwera gpsd, nie z portu szeregowego
                 7200=Uzytkowanie: CacheWolf [-c <path to pref.xml>] [-debug]
-                {..}
+                7300=Ulica/POI 
+                7301=Miasto 
+                7302=Szukaj 
+                7303=Anuluj 
+                7304=warszawa 
+                7305=stare Miasto
+                7306=Szukaj... 
+                7307=Anulowane przez uzytkownika 
+                7308=Nie mozna polaczyc
+             {..}
        {..}
 {..}

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/src/CacheWolf/CoordsScreen.java	2009-10-16 21:30:13 UTC (rev 2289)
@@ -23,7 +23,7 @@
 	mInput inpNSDeg, inpNSm, inpNSs, inpEWDeg, inpEWm, inpEWs;
 	mInput inpUTMZone, inpUTMNorthing, inpUTMEasting;
 	mInput inpText;
-	mButton btnCancel, btnApply, btnCopy, btnPaste, btnParse, btnGps, btnClear;
+	mButton btnCancel, btnApply, btnCopy, btnPaste, btnParse, btnGps, btnClear, btnSearch;
 	CWPoint coordInp = new CWPoint();
 	CellPanel topLinePanel = new CellPanel();
 	CellPanel mainPanel = new CellPanel();
@@ -60,8 +60,6 @@
 		chkDD.setGroup(chkFormat); chkDD.exitKeys=exitKeys;
 		chkDMM.setGroup(chkFormat);chkDMM.exitKeys=exitKeys;
 		chkDMS.setGroup(chkFormat);chkDMS.exitKeys=exitKeys;
-		//	chkUTM.setGroup(chkFormat);chkUTM.exitKeys=exitKeys;
-		//localCooSystem.setGroup(chkFormat);chkGK.exitKeys=exitKeys;
 		chkCustom.setGroup(chkFormat);chkCustom.exitKeys=exitKeys;
 		this.addLast(topLinePanel,CellConstants.DONTSTRETCH, CellConstants.WEST);
 
@@ -87,7 +85,8 @@
 		} else {
 			mainPanel.addNext(new mLabel(MyLocale.getMsg(1400,"Zone")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
 			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402,"Easting")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
-			mainPanel.addLast(new mLabel(MyLocale.getMsg(1401,"Northing")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+			mainPanel.addNext(new mLabel(MyLocale.getMsg(1401,"Northing")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
+			mainPanel.addLast(btnSearch = new mButton(MyLocale.getMsg(1414,"Search")),CellConstants.HSTRETCH, (CellConstants.HFILL));
 		}
 
 		mainPanel.addNext(inpUTMZone = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
@@ -303,6 +302,15 @@
 				currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
 				setFields(coord,currFormat);
 			}
+			
+			if (ev.target == btnSearch) {
+				GeoCodeGui s = new GeoCodeGui(); 
+				int ok = s.execute();
+				if (ok == FormBase.IDOK) {
+					currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
+					setFields(s.coordInp,currFormat);
+				}
+			}
 		}
 		super.onEvent(ev);
 	}

Added: trunk/src/CacheWolf/GeoCodeGui.java
===================================================================
--- trunk/src/CacheWolf/GeoCodeGui.java	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/src/CacheWolf/GeoCodeGui.java	2009-10-16 21:30:13 UTC (rev 2289)
@@ -0,0 +1,149 @@
+package CacheWolf;
+
+import ewe.io.IOException;
+import ewe.sys.Handle;
+import ewe.sys.HandleStoppedException;
+import ewe.sys.mThread;
+import ewe.ui.CellConstants;
+import ewe.ui.CellPanel;
+import ewe.ui.ControlEvent;
+import ewe.ui.Event;
+import ewe.ui.Form;
+import ewe.ui.HtmlDisplay;
+import ewe.ui.IKeys;
+import ewe.ui.ScrollBarPanel;
+import ewe.ui.mButton;
+import ewe.ui.mInput;
+import ewe.ui.mLabel;
+import ewe.util.ByteArray;
+import ewe.util.Vector;
+import ewesoft.xml.sax.SAXException;
+
+/**
+ * Class for entering an address and convert it to lat/lon
+ * starting index in language files: 7300 
+ */
+
+public class GeoCodeGui extends Form {
+
+	mInput streetInp, cityInp;
+	mButton searchBtn, searchCancelBtn, btnCancel, btnOk;
+	CWPoint coordInp = new CWPoint();
+	CellPanel topLinePanel = new CellPanel();
+	CellPanel mainPanel = new CellPanel();
+	HtmlDisplay foundTxt;
+	int exitKeys[]={75009};
+
+	Vector geoCodeAnsw;
+	String searchText;
+	Handle[] fetchHandle = new Handle[1];
+
+	public GeoCodeGui()
+	{
+		topLinePanel.addNext(new mLabel(MyLocale.getMsg(7300, "Street/POI")),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		topLinePanel.addLast(streetInp = new mInput(MyLocale.getMsg(7305, "Hauptbahnhof")),CellConstants.STRETCH, CellConstants.FILL | CellConstants.WEST);
+		//streetInp.setPreferredSize(500, 20);
+		topLinePanel.addNext(new mLabel(MyLocale.getMsg(7301, "City")),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		topLinePanel.addNext(cityInp   = new mInput(MyLocale.getMsg(7304, "M?nchen, Deutschland")),CellConstants.HSTRETCH, CellConstants.HFILL | CellConstants.WEST);
+		topLinePanel.addNext(searchBtn = new mButton(MyLocale.getMsg(7302, "Search")),CellConstants.DONTSTRETCH,CellConstants.WEST);
+		topLinePanel.addLast(searchCancelBtn = new mButton(MyLocale.getMsg(7303, "Cancel")),CellConstants.DONTSTRETCH,CellConstants.WEST);
+		// inpText.toolTip=MyLocale.getMsg(1406,"Enter coordinates in any format or GCxxxxx");
+
+		this.addLast(topLinePanel,CellConstants.STRETCH, CellConstants.FILL | CellConstants.WEST);
+
+		// Description of found sites
+		foundTxt     = new HtmlDisplay();
+		foundTxt.setPreferredSize(200, 200);
+		ScrollBarPanel sbp = new MyScrollBarPanel(foundTxt, 0);
+		sbp.setClientConstraints(ScrollBarPanel.HCONTRACT|ScrollBarPanel.HCONTRACT);
+		mainPanel.addLast(sbp, CellConstants.STRETCH, CellConstants.FILL | CellConstants.WEST);
+
+		// Buttons for cancel and apply
+		btnCancel = new mButton(MyLocale.getMsg(614,"Cancel"));
+		btnCancel.setHotKey(0, IKeys.ESCAPE);
+		mainPanel.addNext(btnCancel, CellConstants.HSTRETCH, (CellConstants.HFILL));
+		//btnCancel.setTag(SPAN,new Dimension(4,1));
+		mainPanel.addNext(btnOk = new mButton(MyLocale.getMsg(615,"Apply")),CellConstants.HSTRETCH, (CellConstants.HFILL));
+
+		//add Panels
+		this.addLast(mainPanel,CellConstants.STRETCH, CellConstants.FILL | CellConstants.WEST);
+	}
+
+	public void onEvent(Event ev){
+
+		//Vm.debug(ev.toString());
+		// Ensure that the Enter key moves to the appropriate field
+		// for Checkboxes and Choice controls this is done via the exitKeys
+		// For input fields we use the wantReturn field
+		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
+			if (ev.target == searchBtn ){
+				foundTxt.setHtml(MyLocale.getMsg(7306, "searching..."));
+				// only insert "," if city AND street is set
+				searchText = streetInp.text.trim();
+				if (searchText.length() > 0) {
+					if (cityInp.text.trim().length() > 0) searchText = searchText + ","+cityInp.text;
+				} else searchText = cityInp.text;
+
+				mThread thrdfetch = 
+					new mThread() {
+					public void run() {
+						try {
+							fetchHandle[0] = null;
+							geoCodeAnsw = GeocoderOsm.geocode(searchText, fetchHandle);
+						} catch (IOException e) {
+							geoCodeAnsw = new Vector();
+							geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), "IOExecption"));
+						} catch (SAXException e) {
+							geoCodeAnsw = new Vector();
+							geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), "SAXException"));
+						} catch (HandleStoppedException ie) {
+							geoCodeAnsw = new Vector();
+							if (fetchHandle[0].stopReason == 4321)
+								geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7307, "Canceled by user")));
+							else geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7308, "Could not connect")));
+						} catch (InterruptedException ie) {
+							geoCodeAnsw = new Vector();
+							if (fetchHandle[0].stopReason == 4321)
+								geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7307, "Canceled by user")));
+							else geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7308, "Could not connect")));
+
+						}
+						// foundTxt.startHtml();
+						if (geoCodeAnsw.size() == 0) foundTxt.setHtml("nothing found");
+						else {
+							GeocodeAnswer ga = (GeocodeAnswer)geoCodeAnsw.get(0);
+							foundTxt.setHtml(ga.where.toString() + "<br>" + ga.foundname);
+						}
+						fetchHandle[0] = null;
+					}
+				};
+				thrdfetch.start();
+			}
+
+			if (ev.target == searchCancelBtn){
+				if (fetchHandle != null && fetchHandle[0] != null)
+				{
+					fetchHandle[0].stop(4321);
+					fetchHandle[0].set(Handle.Stopped);
+				}
+			}
+
+			if (ev.target == btnCancel){
+				this.close(IDCANCEL);
+			}
+
+			if (ev.target == btnOk){
+				if (geoCodeAnsw != null && geoCodeAnsw.size() > 0)
+				coordInp = ((GeocodeAnswer)geoCodeAnsw.get(0)).where;
+				else coordInp.makeInvalid();
+				this.close(IDOK);
+			}
+
+		}
+		super.onEvent(ev);
+	}
+
+}
+
+
+

Added: trunk/src/CacheWolf/GeocoderOsm.java
===================================================================
--- trunk/src/CacheWolf/GeocoderOsm.java	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/src/CacheWolf/GeocoderOsm.java	2009-10-16 21:30:13 UTC (rev 2289)
@@ -0,0 +1,59 @@
+package CacheWolf;
+
+import ewe.io.ByteArrayInputStream;
+import ewe.io.IO;
+import ewe.io.IOException;
+import ewe.io.InputStreamReader;
+import ewe.sys.Handle;
+import ewe.sys.HandleStoppedException;
+import ewe.util.ByteArray;
+import ewe.util.Vector;
+import ewesoft.xml.XMLDecoder;
+import ewesoft.xml.XMLElement;
+import ewesoft.xml.sax.SAXException;
+
+public class GeocoderOsm {
+
+	private static final String geocoderUrl = "http://gazetteer.openstreetmap.org/namefinder/search.xml?max=1&find=";  
+
+	public static Vector geocode(String address, Handle[] h) 
+	throws SAXException, IOException, HandleStoppedException, InterruptedException {
+		ByteArray answ = UrlFetcher.fetchByteArray((geocoderUrl+UrlFetcher.toUtf8Url(address)), null, h);
+		XMLDecoder xmldec = new XMLDecoder();
+		xmldec.parse(new InputStreamReader(new ByteArrayInputStream(answ), IO.JAVA_UTF8_CODEC));
+		Vector erg = new Vector();
+		if ( "searchresults".equalsIgnoreCase((String)xmldec.document.tag) ) {
+			XMLElement xe, xe2;
+			String desc, lat, lon;
+			desc = null;
+			CWPoint where = new CWPoint();
+			if (xmldec.document != null && xmldec.document.subElements != null) {
+				for (int i=0;  i < xmldec.document.subElements.size(); i++) {
+					xe = (XMLElement) xmldec.document.subElements.elementAt(i);
+					if (xe.tag.equalsIgnoreCase("named")) {
+						lat = (String) xe.attributes.getPropertyValues("lat").get(0);
+						lon = (String) xe.attributes.getPropertyValues("lon").get(0);
+						where.set(Common.parseDouble(lat), Common.parseDouble(lon));
+						for (int j = 0; j < xe.subElements.size(); j++) {
+							xe2 = (XMLElement) xe.subElements.elementAt(j);
+							if ( xe2.tag.equalsIgnoreCase("description")) { desc = xe2.text; break; }  
+						}
+						erg.add(new GeocodeAnswer(where, desc));
+					}
+				}
+			}
+		}
+		return erg;
+	}
+
+}
+
+class GeocodeAnswer {
+	String foundname;
+	CWPoint where;
+	public GeocodeAnswer(CWPoint where_, String desc_) {
+		where = new CWPoint(where_);
+		foundname = desc_;
+	}
+}
+

Modified: trunk/src/CacheWolf/HttpConnection.java
===================================================================
--- trunk/src/CacheWolf/HttpConnection.java	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/src/CacheWolf/HttpConnection.java	2009-10-16 21:30:13 UTC (rev 2289)
@@ -618,12 +618,12 @@
 	
 	FIXME: never referenced
  */
-////===================================================================
-//public Handle readInData() 
-////===================================================================
-//{
-//	return readInData(connectedSocket);
-//}
+//===================================================================
+public Handle readInData() 
+//===================================================================
+{
+	return readInData(connectedSocket);
+}
 /**
 * Get an InputStream to read in the data. This is a very important method as it is used by
 * the readInData() method.
@@ -733,7 +733,7 @@
  * Success, then the returnValue of the IOHandle will hold the connected socket.
  */
 //===================================================================
-private Handle connectAsync()
+public Handle connectAsync()
 //===================================================================
 {
 	return connectAsync(new AsciiCodec());

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2009-10-16 21:02:28 UTC (rev 2288)
+++ trunk/src/CacheWolf/UrlFetcher.java	2009-10-16 21:30:13 UTC (rev 2289)
@@ -1,10 +1,13 @@
 package CacheWolf;
 
+import ewe.io.AsciiCodec;
 import ewe.io.ByteArrayInputStream;
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
 import ewe.net.Socket;
 import ewe.net.URL;
+import ewe.sys.Handle;
+import ewe.sys.HandleStoppedException;
 import ewe.util.ByteArray;
 import ewe.util.CharArray;
 import ewe.util.Properties;
@@ -25,15 +28,28 @@
 		props.load(new ByteArrayInputStream(doc));
 		return props; 
 	}
-	
-	
+
+	public static ByteArray fetchByteArray(String url, CharArray realurl) throws IOException {
+		Handle[] hndl = new Handle[1];
+		try {
+		return fetchByteArray(url, realurl, hndl);
+		} catch ( InterruptedException e) {
+			throw new IOException("Error reading data.");
+		} catch ( HandleStoppedException e) {
+			throw new IOException("Error reading data.");
+		}
+	}
+
 	/**
 	 * @param url - if url-not-allowed chars are contained, they will be automatically encoded
 	 * @param if non null, realurl will be filled with the real url, which can differ from the given url, in case url returns a http-redirect
 	 * @return
 	 * @throws IOException
+	 * @throws InterruptedException 
+	 * @throws HandleStoppedException 
 	 */
-	public static ByteArray fetchByteArray(String url, CharArray realurl) throws IOException {	
+	public static ByteArray fetchByteArray(String url, CharArray realurl, Handle[] hndl) 
+	throws IOException, HandleStoppedException, InterruptedException {	
 		final int maxRedirections = 5;
 		HttpConnection conn = null;
 		Socket sock = null;
@@ -46,7 +62,9 @@
 			conn.setRequestorProperty("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
 			conn.setRequestorProperty("Connection", "close");
 			conn.documentIsEncoded = isUrlEncoded(urltmp);
-			sock = conn.connect();
+			hndl[0] = conn.connectAsync();
+			hndl[0].waitOn(Handle.Success);
+			sock = (Socket)hndl[0].returnValue; //"Could not connect.");
 			if (conn.responseCode >= 400) throw new IOException("URL: "+ urltmp + "\nhttp response code: " + conn.responseCode);
 			urltmp = conn.getRedirectTo();
 			if(urltmp!=null){
@@ -58,11 +76,18 @@
 			}
 		} while (urltmp != null && i <= maxRedirections ); 
 		if (i > maxRedirections) throw new IOException("too many http redirections while trying to fetch: "+url + " only "+maxRedirections+" are allowed");
-		ByteArray daten = conn.readData(sock);
-		sock.close();
+		hndl[0] = conn.readInData();
+		ByteArray daten;
+		try{
+			hndl[0].waitOn(Handle.Success);
+		}finally {
+			sock.close();
+		}
+		daten = (ByteArray)hndl[0].returnValue;
+		// ByteArray daten = conn.readData(sock);
 		return daten;
 	}
-	
+
 	/**
 	 * @param url
 	 * @return true, if the string seems to be already URL encoded (that is, it contains only url-allowd chars), false otherwise
@@ -82,4 +107,61 @@
 		}
 		return true;
 	}
+	/**
+	 * This method encodes an URL containing special characters
+	 * using the UTF-8 codec in %nn%nn notation<br>
+	 * Note that the encoding for URLs is not generally defined. Usually
+	 * cp1252 or UTF-8 is used. It depends on what the server expects,
+	 * what encoding you must use.
+	 * @param cc
+	 * @return
+	 * @throws IOException
+	 */
+	public final static String toUtf8Url(String cc) throws IOException {
+		JavaUtf8Codec coder = new JavaUtf8Codec();
+		ByteArray utf8 = new ByteArray();
+		coder.encodeText(cc.toCharArray(), 0, cc.length(), true, utf8);
+		AsciiCodec asciicod = new AsciiCodec();
+		CharArray utf8bytes = new CharArray();
+		asciicod.decodeText(utf8.data, 0, utf8.length, true, utf8bytes);
+		return encodeURL(utf8bytes.toString(), false);
+	}
+	
+	final static String hex = ewe.util.TextEncoder.hex;
+	/**
+	 * Encode the URL using %## notation.
+	 * Note: this fixes a bug in ewe.net.URL.encodeURL(): that routine
+	 * assumes all chars to be < 127.
+	 * This method is mainly copied from there
+	 * @param url The unencoded URL.
+	 * @param spaceToPlus true if you wish a space to be encoded as a '+', false to encode it as %20
+	 * @return The encoded URL.
+	 */
+	//===================================================================
+	public static String encodeURL(String url, boolean spaceToPlus)
+	//===================================================================
+	{
+		char [] what = ewe.sys.Vm.getStringChars(url);
+		int max = what.length;
+		char [] dest = new char[max+max/2];
+		char d = 0;
+		for (int i = 0; i<max; i++){
+			if (d >= dest.length-2) {
+				char [] n = new char[dest.length+dest.length/2+3];
+				ewe.sys.Vm.copyArray(dest,0,n,0,d);
+				dest = n;
+			}
+			char c = what[i];
+			if (spaceToPlus && c == ' ') c = '+';
+			else if (c <= ' ' || c >= 127 || c == '+' || c == '&' || c == '%' || c == '=' || c == '|' || c == '{' || c == '}'){
+				dest[d++] = '%';
+				dest[d++] = hex.charAt((c >> 4) & 0xf);
+				dest[d++] = hex.charAt(c & 0xf);
+				continue;
+			}
+			dest[d++] = c;
+		}
+		return new String(dest,0,d);
+	}
+
 }
\ No newline at end of file



From araber95 at mail.berlios.de  Sat Oct 17 16:14:42 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 17 Oct 2009 16:14:42 +0200
Subject: [Cachewolf-svn] r2290 - trunk/src/CacheWolf
Message-ID: <200910171414.n9HEEgZ3004520@sheep.berlios.de>

Author: araber95
Date: 2009-10-17 16:14:39 +0200 (Sat, 17 Oct 2009)
New Revision: 2290

Modified:
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/TablePanel.java
   trunk/src/CacheWolf/myTableModel.java
Log:
Statbar Button autosort showing better

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2009-10-16 21:30:13 UTC (rev 2289)
+++ trunk/src/CacheWolf/StatusBar.java	2009-10-17 14:14:39 UTC (rev 2290)
@@ -84,6 +84,12 @@
 		// This can happen even on bigger screens with big fonts
 		if ((MyLocale.getScreenWidth()>=320) && !(MobileVGA && (pref.fontSize > 20)))
 			strCenter="  \u00a4 " + pref.getCurCentrePt().toString();
+		if (table.sortedBy>-1) {
+			this.btnNoSorting.backGround=new Color(0,255,255);
+		}
+		else {
+			this.btnNoSorting.backGround=null;			
+		}
 
 		lblCenter.setText(strCenter);
 		relayout(true); // in case the numbers increased and need more space

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2009-10-16 21:30:13 UTC (rev 2289)
+++ trunk/src/CacheWolf/TablePanel.java	2009-10-17 14:14:39 UTC (rev 2290)
@@ -13,6 +13,7 @@
 	myTableControl tc;
 	myTableModel myMod;
 	Preferences pref;
+	Profile profile;
 	CacheDB cacheDB;
 	MainTab myMaintab;
 	StatusBar statBar;
@@ -27,9 +28,9 @@
 	int selectedIdx=0;
 	CacheHolder selectedCh;
 	
-	public TablePanel(Preferences p, Profile profileXX, StatusBar statBar){
-		pref = Global.getPref();
-		Profile profile=Global.getProfile();
+	public TablePanel(Preferences p, Profile prof, StatusBar statBar){
+		pref = p; //Global.getPref();
+		profile=prof; //Global.getProfile();
 		this.statBar = statBar;
 		cacheDB = profile.cacheDB;
 		addLast(new MyScrollBarPanel(tc = new myTableControl(this)));
@@ -82,7 +83,7 @@
 	
 	public void resetModel() {
 		myMod.numRows = cacheDB.size();
-		Global.getProfile().updateBearingDistance();
+		profile.updateBearingDistance(); //Global.getProfile().updateBearingDistance();
 		tc.scrollToVisible(0,0);
 		refreshTable();
 	}
@@ -93,6 +94,7 @@
 	 */
 	public void refreshControl(){
 		tc.update(true);
+		if (statBar!=null) statBar.updateDisplay();
 	}
 	
 	/** Move all filtered caches to the end of the table and redisplay table */
@@ -118,7 +120,7 @@
 		// Check whether the currently selected cache is still visible
 		int rownum = 0;
 		if (wayPoint != null) {
-			rownum = Global.getProfile().cacheDB.getIndex(wayPoint);
+			rownum = profile.cacheDB.getIndex(wayPoint); //Global.getProfile().cacheDB.getIndex(wayPoint);
 			// If it is not visible: Go backward in the list of the 
 			// previously visible caches and look if you find
 			// any cache that is now still visible.
@@ -127,7 +129,7 @@
 	                int i;
 	                for (i = sel - 1; i >= 0; i--) {
 		                CacheHolder checkCache = (CacheHolder) oldVisibleCaches.get(i);
-		                rownum = Global.getProfile().cacheDB.getIndex(checkCache.getWayPoint());
+		                rownum = profile.cacheDB.getIndex(checkCache.getWayPoint()); //Global.getProfile().cacheDB.getIndex(checkCache.getWayPoint());
 		                if ((rownum >= 0) && (rownum < myMod.numRows))
 			                break;
 		                rownum = 0;

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-10-16 21:30:13 UTC (rev 2289)
+++ trunk/src/CacheWolf/myTableModel.java	2009-10-17 14:14:39 UTC (rev 2290)
@@ -66,7 +66,7 @@
 	private mImage bug;
     private static mImage imgSortUp, imgSortDown;
 	public boolean sortAscending = false;
-	public int sortedBy = -1; // -1 don't sort 
+	public int sortedBy = -1; // -1 don't sort
 	private FontMetrics fm;
 //	private mImage picSizeMicro,picSizeSmall,picSizeReg,picSizeLarge,picSizeVLarge,picSizeNonPhysical;
 	private mImage picHasSolver,picHasNotes;
@@ -74,18 +74,16 @@
 	/** This is the modifier (Shift & Control key status) for Pen Events
 	 * it is set in myTableControl.onEvent */
 	public int penEventModifiers;
-
-//	private int lastRow=-1;
 	public myTableControl tcControl;
 	public boolean showExtraWptInfo=true;
 
 	public myTableModel(myTableControl tc, FontMetrics fm){
 		super();
 		cacheDB = Global.getProfile().cacheDB;
-		fm = this.fm;
+		this.fm=fm;
 		tcControl = tc;
 		setColumnNamesAndWidths();
-		this.numRows = cacheDB.size();
+		numRows = cacheDB.size();
 		//Dimension selrow = new Dimension(-1,1);
 		//this.cursorSize = selrow;
 		noFindLogs[0] = new Image("no_1_log.png");
@@ -451,7 +449,7 @@
 				}
 			}
 			if(cell.y == -1){ // Hit a header => sort the table accordingly
-				// cell.x is the physical column 
+				// cell.x is the physical column
 				// but we have to sort by the column it is mapped into
 				int mappedCol=colMap[cell.x];
 				boolean sortvalue = true;
@@ -492,7 +490,7 @@
             }
             Vm.showWait( false );
         }
-        tcControl.update( true ); // repaint    	
+        tcControl.tbp.refreshControl(); // repaint with update Statusbar
     }
 
 	/** Toggle the select status for a group of caches



From mik77 at mail.berlios.de  Sat Oct 17 20:20:33 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 17 Oct 2009 20:20:33 +0200
Subject: [Cachewolf-svn] r2291 - trunk/src/CacheWolf/exp
Message-ID: <200910171820.n9HIKX8j015724@sheep.berlios.de>

Author: mik77
Date: 2009-10-17 20:20:30 +0200 (Sat, 17 Oct 2009)
New Revision: 2291

Modified:
   trunk/src/CacheWolf/exp/GPXExporter.java
Log:
quick fix in old GPX-Export. But id2GpxString should be made consistent.

Modified: trunk/src/CacheWolf/exp/GPXExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/GPXExporter.java	2009-10-17 14:14:39 UTC (rev 2290)
+++ trunk/src/CacheWolf/exp/GPXExporter.java	2009-10-17 18:20:30 UTC (rev 2291)
@@ -145,7 +145,7 @@
 			}else {
 				// there is no HTML in the description of addi wpts
 				strBuf.append("    <sym>").append(CacheType.id2GpxString(ch.getType())).append("</sym>\r\n");
-				strBuf.append("    <type>Waypoint|").append(CacheType.id2GpxString(ch.getType())).append("</type>\r\n");
+				strBuf.append("    <type>").append(CacheType.id2GpxString(ch.getType())).append("</type>\r\n");
 			}
 			strBuf.append("  </wpt>\r\n");
 		}catch(Exception e){



From araber95 at mail.berlios.de  Sun Oct 18 13:07:05 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 18 Oct 2009 13:07:05 +0200
Subject: [Cachewolf-svn] r2292 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200910181107.n9IB75Tt017799@sheep.berlios.de>

Author: araber95
Date: 2009-10-18 13:06:51 +0200 (Sun, 18 Oct 2009)
New Revision: 2292

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/myTableControl.java
Log:
Calling gmaps from cache context menu ( http://www.geoclub.de/viewtopic.php?f=40&t=38988 )

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-17 18:20:30 UTC (rev 2291)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-18 11:06:51 UTC (rev 2292)
@@ -369,6 +369,7 @@
 		1050=Aktualisiert
 		1051=Zuletzt aktualisiert
 		1052=Im Browser online loggen
+		1053=In Googlemaps %f6ffnen
 		1100=Profile
 		1105=Suchen
 		1106=Profil w%e4hlen oder Neu

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-17 18:20:30 UTC (rev 2291)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-18 11:06:51 UTC (rev 2292)
@@ -369,6 +369,7 @@
 		1050=Last synced
 		1051=Last sync date
 		1052=Log online in Browser
+		1053=Open in Google maps online
 		1100=Profiles
 		1105=Browse
 		1106=Choose profile or New

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-17 18:20:30 UTC (rev 2291)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-18 11:06:51 UTC (rev 2292)
@@ -365,6 +365,8 @@
 		1049=DNF
 		1050=Mis %e0 jour
 		1051=Date de mettre %e0 jour
+		1052=[Log online in Browser]
+		1053=[Open in Google maps online]
 		1100=Profils
 		1105=Chercher
 		1106=Choiser profil ou cr%e9er-un
@@ -871,14 +873,14 @@
 		7021=Ce type de version
 		7022=Type de version
 		7023=Erreur en t%e9l%e9chargeant les informations de version
-        7300=Street / POI 
-        7301=Ville 
-        7302=Recherche 
-        7303=Annuler 
+        7300=Street / POI
+        7301=Ville
+        7302=Recherche
+        7303=Annuler
         7304=paris
-        7305=avenue des champs-elysees 
-        7306=Recherche en cours... 
-        7307=Annul%e9 par l'utilisateur 
+        7305=avenue des champs-elysees
+        7306=Recherche en cours...
+        7307=Annul%e9 par l'utilisateur
         7308=Impossible de se connecter		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-17 18:20:30 UTC (rev 2291)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-18 11:06:51 UTC (rev 2292)
@@ -349,6 +349,8 @@
 		1049=DNF
 		1050=Ten laatste sync.
 		1051=Synchroniseert am
+		1052=[Log online in Browser]
+		1053=[Open in Google maps online]
 		1100=Profielen
 		1105=Bladeren
 		1106=Kies profiel of nieuw.
@@ -658,15 +660,15 @@
 		6104=Cassiopeia
 		6105=Zwaan
 		6106=Zuiderkruis
-    7300=Straat / POI 
-    7301=Stad 
-    7302=Zoeken 
-    7303=Annuleren 
-    7304=Amsterdam 
+    7300=Straat / POI
+    7301=Stad
+    7302=Zoeken
+    7303=Annuleren
+    7304=Amsterdam
     7305=centraal station
-    7306=zoeken... 
-    7307=geannuleerd door gebruiker 
-    7308=Kan geen verbinding		
+    7306=zoeken...
+    7307=geannuleerd door gebruiker
+    7308=Kan geen verbinding
     {..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-17 18:20:30 UTC (rev 2291)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-18 11:06:51 UTC (rev 2292)
@@ -367,6 +367,8 @@
                 1049=Nieznalezienie
                 1050=Ostatnio zsynchronizowane
                 1051=Data ostatniej synchronizacji
+		1052=[Log online in Browser]
+		1053=[Open in Google maps online]
                 1100=Profile
                 1105=Browse
                 1106=Wybierz Profil lub nowy
@@ -895,14 +897,14 @@
                 7121=Pobierz dane GPS z gpsd host
                 7122=Dane GPS beda pobrane z serwera gpsd, nie z portu szeregowego
                 7200=Uzytkowanie: CacheWolf [-c <path to pref.xml>] [-debug]
-                7300=Ulica/POI 
-                7301=Miasto 
-                7302=Szukaj 
-                7303=Anuluj 
-                7304=warszawa 
+                7300=Ulica/POI
+                7301=Miasto
+                7302=Szukaj
+                7303=Anuluj
+                7304=warszawa
                 7305=stare Miasto
-                7306=Szukaj... 
-                7307=Anulowane przez uzytkownika 
+                7306=Szukaj...
+                7307=Anulowane przez uzytkownika
                 7308=Nie mozna polaczyc
              {..}
        {..}

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2009-10-17 18:20:30 UTC (rev 2291)
+++ trunk/src/CacheWolf/myTableControl.java	2009-10-18 11:06:51 UTC (rev 2292)
@@ -18,7 +18,7 @@
 	public TablePanel tbp;
 
 	private MenuItem miOpen, miGoto, miCenter, miUnhideAddis;
-	private MenuItem miOpenOnline, miOpenOffline, miLogOnline;
+	private MenuItem miOpenOnline, miOpenOffline, miLogOnline, miOpenGmaps;
 	private MenuItem miDelete, miUpdate;
 	private MenuItem miTickAll, miUntickAll;
 	private MenuItem miSeparator;
@@ -33,7 +33,7 @@
 		tbp =tablePanel;
 		allowDragSelection = false; // allow only one row to be selected at one time
 
-		MenuItem[] mnuFull = new MenuItem[14];
+		MenuItem[] mnuFull = new MenuItem[15];
   	mnuFull[0] = miOpen = new MenuItem(MyLocale.getMsg(1021,"Open description"));
   	mnuFull[1] = miGoto = new MenuItem(MyLocale.getMsg(1010,"Goto"));
   	mnuFull[2] = miCenter = new MenuItem(MyLocale.getMsg(1019,"Center"));
@@ -42,12 +42,13 @@
   	mnuFull[5] = miOpenOnline = new MenuItem(MyLocale.getMsg(1020,"Open in $browser online"));
   	mnuFull[6] = miOpenOffline = new MenuItem(MyLocale.getMsg(1018,"Open in browser offline"));
   	mnuFull[7] = miLogOnline = new MenuItem(MyLocale.getMsg(1052,"Log online in Browser"));
-  	mnuFull[8] = miSeparator;
-  	mnuFull[9] = miDelete = new MenuItem(MyLocale.getMsg(1012,"Delete selected"));
-  	mnuFull[10] = miUpdate = new MenuItem(MyLocale.getMsg(1014,"Update"));
-  	mnuFull[11] = miSeparator;
-  	mnuFull[12] = miTickAll = new MenuItem(MyLocale.getMsg(1015,"Select all"));
-  	mnuFull[13] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,"De-select all"));
+  	mnuFull[8] = miOpenGmaps = new MenuItem(MyLocale.getMsg(1053,"Open in Google maps online"));
+  	mnuFull[9] = miSeparator;
+  	mnuFull[10] = miDelete = new MenuItem(MyLocale.getMsg(1012,"Delete selected"));
+  	mnuFull[11] = miUpdate = new MenuItem(MyLocale.getMsg(1014,"Update"));
+  	mnuFull[12] = miSeparator;
+  	mnuFull[13] = miTickAll = new MenuItem(MyLocale.getMsg(1015,"Select all"));
+  	mnuFull[14] = miUntickAll = new MenuItem(MyLocale.getMsg(1016,"De-select all"));
   	mFull = new Menu(mnuFull, MyLocale.getMsg(1013,"With selection"));
 
   	MenuItem[] mnuSmall = new MenuItem[8];
@@ -134,6 +135,18 @@
 	public boolean isSelected(int pRow,int pCol) {
 		return pRow==selection.y;
 	}
+	private void callExternalProgram(String program, String parameter) {
+		// invalid path will be handled by try
+		try {
+			CWWrapper.exec(program, parameter); // maybe this works on some PDAs?
+		} catch (IOException ex) {
+			(new MessageBox(MyLocale.getMsg(321,"Error"),
+					MyLocale.getMsg(1034,"Cannot start "+program+"!") + "\n" + ex.toString() + "\n" +
+					MyLocale.getMsg(1035,"Possible reason:") + "\n" +
+					MyLocale.getMsg(1036,"A bug in ewe VM, please be") + "\n" +
+					MyLocale.getMsg(1037,"patient for an update"),FormBase.OKB)).execute();
+		}
+	}
 
 	public void popupMenuEvent(Object selectedItem){
 		if (selectedItem == null) return;
@@ -167,8 +180,7 @@
 					}
 				}
 			}
-			// Warn if there are ticked but invisible caches - and ask if they should be deleted,
-			// too.
+			// Warn if there are ticked but invisible caches - and ask if they should be deleted too.
 			shouldDeleteCount = allCount;
 			if (addiNonVisibleCount + mainNonVisibleCount > 0){
 				if ((new MessageBox(MyLocale.getMsg(144,"Warning"),
@@ -250,32 +262,29 @@
 		} else
 
 		if (selectedItem == miOpenOnline){
-			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
 				CacheHolderDetail chD=ch.getCacheDetails(false, true);
-				try {
-					if (chD != null) {
-						CWWrapper.exec(pref.browser, chD.URL); // maybe this works on some PDAs?
-					}
-				} catch (IOException ex) {
-					(new MessageBox(MyLocale.getMsg(321,"Error"),
-							MyLocale.getMsg(1034,"Cannot start browser!") + "\n" + ex.toString() + "\n" +
-							MyLocale.getMsg(1035,"Possible reason:") + "\n" +
-							MyLocale.getMsg(1036,"A bug in ewe VM, please be") + "\n" +
-							MyLocale.getMsg(1037,"patient for an update"),FormBase.OKB)).execute();
-				}
+				if (chD != null) { callExternalProgram(pref.browser, chD.URL); }
+		} else
+
+		if (selectedItem == miOpenGmaps) {
+			ch = cacheDB.get(tbp.getSelectedCache());
+			if (ch.pos.isValid()) {
+				String latlon=""+ch.pos.latDec+","+ch.pos.lonDec;
+				String nameOfCache=ewe.net.URL.encodeURL(ch.cacheName,false).replace('#','N').replace('@','_');
+				String language=Vm.getLocale().getString(Locale.LANGUAGE_SHORT, 0, 0);
+				if (!pref.language.equalsIgnoreCase("auto")) {language=pref.language;}
+				String url="http://maps.google."+language+"/maps?q="+nameOfCache+"@"+latlon;
+				callExternalProgram(pref.browser, url);
 			}
 		} else
 
 		if (selectedItem == miOpenOffline) {
-			if(browserPathIsValid()){
-				ShowCacheInBrowser sc=new ShowCacheInBrowser();
-				sc.showCache(cacheDB.get(tbp.getSelectedCache()));
-			}
+			ShowCacheInBrowser sc=new ShowCacheInBrowser();
+			sc.showCache(cacheDB.get(tbp.getSelectedCache()));
 		} else
 
 		if (selectedItem == miLogOnline){
-			if(browserPathIsValid()){
 				ch = cacheDB.get(tbp.getSelectedCache());
 				CacheHolder mainCache = ch;
 				if (ch.isAddiWpt() && (ch.mainCache != null)) {
@@ -283,11 +292,9 @@
 				}
 				if (mainCache.isCacheWpt()) {
 					CacheHolderDetail chD=mainCache.getCacheDetails(false, true);
-					try {
 						if (chD != null) {
 							String URL = "";
-							if (ch.isOC())
-							{
+							if (ch.isOC()) {
 								URL = chD.URL;
 								if (URL.indexOf("viewcache") >= 0) {
 									URL = STRreplace.replace(URL, "viewcache", "log");
@@ -303,36 +310,18 @@
 								if (notes.length() > 0) {
 									Vm.setClipboardText(notes);
 								}
-								CWWrapper.exec(pref.browser, URL);
+								callExternalProgram(pref.browser, URL);
 							}
 						}
-					} catch (IOException ex) {
-						(new MessageBox(MyLocale.getMsg(321,"Error"),
-								MyLocale.getMsg(1034,"Cannot start browser!") + "\n" + ex.toString() + "\n" +
-								MyLocale.getMsg(1035,"Possible reason:") + "\n" +
-								MyLocale.getMsg(1036,"A bug in ewe VM, please be") + "\n" +
-								MyLocale.getMsg(1037,"patient for an update"),FormBase.OKB)).execute();
-					}
 				}
-			}
 		} else
 
-
 		if (selectedItem == miOpen){
 			penDoubleClicked(null);
 		}
 
 	}
 
-	public boolean browserPathIsValid() {
-		if(!new File(pref.browser).exists()){
-			(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(1032,"Path to browser:")+"\n"+pref.browser+"\n"+MyLocale.getMsg(1033,"is incorrect!"),FormBase.OKB)).execute();
-			return false;
-		}
-		else
-			return true;
-	}
-
 	public void penDoubleClicked(Point where) {
 		Global.mainTab.select(Global.mainTab.descP);
 	}



From mik77 at mail.berlios.de  Sun Oct 18 13:53:35 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 18 Oct 2009 13:53:35 +0200
Subject: [Cachewolf-svn] r2293 - trunk/res_noewe
Message-ID: <200910181153.n9IBrZBJ010095@sheep.berlios.de>

Author: mik77
Date: 2009-10-18 13:53:33 +0200 (Sun, 18 Oct 2009)
New Revision: 2293

Modified:
   trunk/res_noewe/spider.def
Log:
Should work now with proxies and cachetypes as background

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-10-18 11:06:51 UTC (rev 2292)
+++ trunk/res_noewe/spider.def	2009-10-18 11:53:33 UTC (rev 2293)
@@ -30,6 +30,7 @@
 # Version 4.6 - 20090406 Fix for country/state (did not work with US caches)
 # Version 4.7 - 20090521 Strings for single cache types added
 # Version 4.8 - 20090805 More specific unavailability detection
+# Version 4.9 - 20091018 Should work now with proxies and cachetypes as background
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -91,7 +92,7 @@
 sizeRex            = alt="Size:\ ((?s).*?)"\ title="Size:
 difficultyRex      = <span\ id="Difficulty">.*?alt="(.*?)\ out\ of
 terrainRex         = <span\ id="Terrain">.*?alt="(.*?)\ out\ of
-cacheTypeRex       = \\./images/WptTypes/(.*?)\\.gif
+cacheTypeRex       = /images/WptTypes/(.*?)\\.gif"\ ALT="
 cacheLocationRex   = <span\ id="Location">In\ ([^<]*?)<
 premiumCachepage   = Sorry, the owner of this listing has made it viewable to subscribers only.
 



From mik77 at mail.berlios.de  Sun Oct 18 21:13:14 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 18 Oct 2009 21:13:14 +0200
Subject: [Cachewolf-svn] r2294 - trunk/src/CacheWolf/exp
Message-ID: <200910181913.n9IJDESZ024188@sheep.berlios.de>

Author: mik77
Date: 2009-10-18 21:13:12 +0200 (Sun, 18 Oct 2009)
New Revision: 2294

Modified:
   trunk/src/CacheWolf/exp/GpxExportNg.java
Log:
dummy IDs in new GPX exporter

Modified: trunk/src/CacheWolf/exp/GpxExportNg.java
===================================================================
--- trunk/src/CacheWolf/exp/GpxExportNg.java	2009-10-18 11:53:33 UTC (rev 2293)
+++ trunk/src/CacheWolf/exp/GpxExportNg.java	2009-10-18 19:13:12 UTC (rev 2294)
@@ -697,7 +697,7 @@
 		}
 
 		for (int i = 0; i < exportlogs; i++) {
-			String logId = "";
+			String logId = Integer.toString(i);
 			Log log = logs.getLog(i);
 
 			if (exportStyle == STYLE_GPX_MYFINDS && !log.getLogger().equals(Global.getPref().myAlias))



From mik77 at mail.berlios.de  Mon Oct 19 00:24:32 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 19 Oct 2009 00:24:32 +0200
Subject: [Cachewolf-svn] r2295 - trunk/src/CacheWolf
Message-ID: <200910182224.n9IMOWSF012006@sheep.berlios.de>

Author: mik77
Date: 2009-10-19 00:24:30 +0200 (Mon, 19 Oct 2009)
New Revision: 2295

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
correct coordinate format for opening in google maps

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2009-10-18 19:13:12 UTC (rev 2294)
+++ trunk/src/CacheWolf/myTableControl.java	2009-10-18 22:24:30 UTC (rev 2295)
@@ -270,7 +270,7 @@
 		if (selectedItem == miOpenGmaps) {
 			ch = cacheDB.get(tbp.getSelectedCache());
 			if (ch.pos.isValid()) {
-				String latlon=""+ch.pos.latDec+","+ch.pos.lonDec;
+				String latlon=""+ch.pos.getLatDeg(CWPoint.DD)+","+ch.pos.getLonDeg(CWPoint.DD);
 				String nameOfCache=ewe.net.URL.encodeURL(ch.cacheName,false).replace('#','N').replace('@','_');
 				String language=Vm.getLocale().getString(Locale.LANGUAGE_SHORT, 0, 0);
 				if (!pref.language.equalsIgnoreCase("auto")) {language=pref.language;}



From araber95 at mail.berlios.de  Tue Oct 20 13:23:32 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 20 Oct 2009 13:23:32 +0200
Subject: [Cachewolf-svn] r2296 - in trunk: res_noewe/symbols
	res_noewe/symbols/oder1 src/CacheWolf src/CacheWolf/navi
Message-ID: <200910201123.n9KBNWiV017056@sheep.berlios.de>

Author: araber95
Date: 2009-10-20 13:23:22 +0200 (Tue, 20 Oct 2009)
New Revision: 2296

Added:
   trunk/res_noewe/symbols/11size.png
   trunk/res_noewe/symbols/16size.png
   trunk/res_noewe/symbols/18size.png
   trunk/res_noewe/symbols/19size.png
   trunk/res_noewe/symbols/20size.png
   trunk/res_noewe/symbols/4size.png
   trunk/res_noewe/symbols/5size.png
Removed:
   trunk/res_noewe/symbols/oder1/Thumbs.db
Modified:
   trunk/res_noewe/symbols/readme.txt
   trunk/src/CacheWolf/GuiImageBroker.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
get big symbols on the map

Added: trunk/res_noewe/symbols/11size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/11size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/16size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/16size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/18size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/18size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/19size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/19size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/20size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/20size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/4size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/4size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/5size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/5size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/res_noewe/symbols/oder1/Thumbs.db
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/readme.txt
===================================================================
--- trunk/res_noewe/symbols/readme.txt	2009-10-18 22:24:30 UTC (rev 2295)
+++ trunk/res_noewe/symbols/readme.txt	2009-10-20 11:23:22 UTC (rev 2296)
@@ -1,9 +1,15 @@
-In diesem Verzeichnis vorhandene .png-Dateien werden als alternative Symbole in den Cachewolf geladen. Dabei sollte es sich um PNGs der Gr??e 15x15 handeln. Wichtig ist die korrekte Benennung der Dateien. Falsch benannte Dateien werden ignoriert.
-Es m?ssen nur die Dateien erstellt werden, die ersetzt werden sollen. Ist keine entsprechende Datei vorhanden, wird das Cachewolf-interne Symbol beibehalten.
+In diesem Verzeichnis vorhandene .png-Dateien werden als alternative Symbole in den Cachewolf geladen.
+Dabei sollte es sich um PNGs der Gr??e 16x16 handeln oder kleiner.
+Auf der Karte werden auch gr?ssere Symbole angezeigt, falls sie existieren und der Dateiname auf size endet.
+Es m?ssen nur die Dateien erstellt werden, die ersetzt werden sollen.
+Ist keine entsprechende Datei vorhanden, wird das Cachewolf-interne Symbol beibehalten.
 
-.png-files in this directory will be loaded as customized symbols into Cachewolf. They're supposed to be 15x15 PNGs. It's important to name them correctly. Incorrectly named
-files will be ignored.
-You only have to create images for those symbols you want customized. For symbols without corresponding file the buildt-in symbol will be maintained.
+.png-files in this directory will be loaded as customized symbols into Cachewolf.
+They're supposed to be 16x16 PNGs or less.
+On the map larger symbols are shown, if they exist and the filename ends on size.
+Incorrectly named files will be ignored.
+You only have to create images for those symbols you want customized.
+For symbols without corresponding file the buildt-in symbol will be maintained.
 
 
 Zuordnung der Dateinamen/filename assignment:

Modified: trunk/src/CacheWolf/GuiImageBroker.java
===================================================================
--- trunk/src/CacheWolf/GuiImageBroker.java	2009-10-18 22:24:30 UTC (rev 2295)
+++ trunk/src/CacheWolf/GuiImageBroker.java	2009-10-20 11:23:22 UTC (rev 2296)
@@ -16,7 +16,7 @@
 
 	/** image to be displayed in case of error */
 	public static Image imageError = new Image("guiError.png");
-	
+
 	/**
 	 * images to be displayed for cache types in GUI
 	 * @see getTypeImage
@@ -47,21 +47,35 @@
 		new Image(CacheType.CW_GUIIMG_WHEREIGO)		// 21
 	};
 
-	// TODO: move size images here
-//	private static final Image[] sizeImages = {
-//		new Image(CacheSize.CW_GUIIMG_NONPHYSICAL),
-//		new Image(CacheSize.CW_GUIIMG_MICRO),
-//		new Image(CacheSize.CW_GUIIMG_SMALL),
-//		new Image(CacheSize.CW_GUIIMG_NORMAL),
-//		new Image(CacheSize.CW_GUIIMG_LARGE),
-//		new Image(CacheSize.CW_GUIIMG_VERYLARGE)
-//	};
+	private static final Image[] sizeImages = {
+		new Image(CacheType.CW_GUIIMG_CUSTOM),		// 0
+		new Image(CacheType.CW_GUIIMG_APE),			// 1
+		new Image(CacheType.CW_GUIIMG_CITO),		// 2
+		new Image(CacheType.CW_GUIIMG_DRIVE_IN),	// 3
+		new Image(CacheType.CW_GUIIMG_EARTH),		// 4
+		new Image(CacheType.CW_GUIIMG_EVENT),		// 5
+		new Image(CacheType.CW_GUIIMG_FINAL),		// 6
+		new Image(CacheType.CW_GUIIMG_LETTERBOX),	// 7
+		new Image(CacheType.CW_GUIIMG_LOCATIONLESS),// 8
+		new Image(CacheType.CW_GUIIMG_MAZE),		// 9
+		new Image(CacheType.CW_GUIIMG_MEGA_EVENT),	// 10
+		new Image(CacheType.CW_GUIIMG_MULTI),		// 11
+		new Image(CacheType.CW_GUIIMG_PARKING),		// 12
+		new Image(CacheType.CW_GUIIMG_QUESTION),	// 13
+		new Image(CacheType.CW_GUIIMG_REFERENCE),	// 14
+		new Image(CacheType.CW_GUIIMG_STAGE),		// 15
+		new Image(CacheType.CW_GUIIMG_TRADITIONAL),	// 16
+		new Image(CacheType.CW_GUIIMG_TRAILHEAD),	// 17
+		new Image(CacheType.CW_GUIIMG_UNKNOWN),		// 18
+		new Image(CacheType.CW_GUIIMG_VIRTUAL),		// 19
+		new Image(CacheType.CW_GUIIMG_WEBCAM),		// 20
+		new Image(CacheType.CW_GUIIMG_WHEREIGO)		// 21
+	};
 
 	/** thou shallst not instantiate this object */
-	private GuiImageBroker() { 
+	private GuiImageBroker() {
 		// Noting to do
 	}
-	
 
 	/**
 	 * select image to be displayed for a given cache type
@@ -95,7 +109,40 @@
 		default: return imageError;
 		}
 	}
+	public static Image getTypeImage(byte id,boolean map) {
+		if (!map) {
+			return getTypeImage(id);
+		}
+		else {
+			switch (id) {
+			case CacheType.CW_TYPE_CUSTOM: return sizeImages[0];
+			case CacheType.CW_TYPE_APE: return sizeImages[1];
+			case CacheType.CW_TYPE_CITO: return sizeImages[2];
+			case CacheType.CW_TYPE_DRIVE_IN: return sizeImages[3];
+			case CacheType.CW_TYPE_EARTH: return sizeImages[4];
+			case CacheType.CW_TYPE_EVENT: return sizeImages[5];
+			case CacheType.CW_TYPE_FINAL: return sizeImages[6];
+			case CacheType.CW_TYPE_LETTERBOX: return sizeImages[7];
+			case CacheType.CW_TYPE_LOCATIONLESS: return sizeImages[8];
+			case CacheType.CW_TYPE_MAZE: return sizeImages[9];
+			case CacheType.CW_TYPE_MEGA_EVENT: return sizeImages[10];
+			case CacheType.CW_TYPE_MULTI: return sizeImages[11];
+			case CacheType.CW_TYPE_PARKING: return sizeImages[12];
+			case CacheType.CW_TYPE_QUESTION: return sizeImages[13];
+			case CacheType.CW_TYPE_REFERENCE: return sizeImages[14];
+			case CacheType.CW_TYPE_STAGE: return sizeImages[15];
+			case CacheType.CW_TYPE_TRADITIONAL: return sizeImages[16];
+			case CacheType.CW_TYPE_TRAILHEAD: return sizeImages[17];
+			case CacheType.CW_TYPE_UNKNOWN: return sizeImages[18];
+			case CacheType.CW_TYPE_VIRTUAL: return sizeImages[19];
+			case CacheType.CW_TYPE_WEBCAM: return sizeImages[20];
+			case CacheType.CW_TYPE_WHEREIGO: return sizeImages[21];
+			default: return imageError;
+			}
+		}
+	}
 
+
 	/**
 	 * Replaces the build-in symbols by images stored in /symbols:
 	 * If the sub directory symbols exists in CW-directory *.png-files
@@ -106,22 +153,33 @@
 	 * Images are NOT checked for size etc.
 	 */
 	public static void customizedSymbols() {
-		final FileBugfix dir = new FileBugfix(FileBase.getProgramDirectory()+"/symbols");
+		final FileBugfix dir=new FileBugfix(FileBase.getProgramDirectory()+"/symbols");
 		if (dir.isDirectory()){
-			int type;
+			int id;
+			boolean size=false;
 			String name = "";
 			String [] pngFiles;
 			pngFiles=dir.list("*.png",0);
-			for (int i=0; i < pngFiles.length; i++) {
+			for (int i=0; i<pngFiles.length; i++) {
 				name = pngFiles[i].substring(0,pngFiles[i].length()-4);
+				if (name.endsWith("size")){
+					size=true;
+					name=name.substring(0,name.length()-4);
+				}
 				try {
-					type = Integer.parseInt(name);
+					id = Integer.parseInt (name);
 				}
 				catch (Exception E){
-					type = -1; //filename invalid for symbols
+					id = -1; //filename invalid for symbols
 				}
-				if (0<=type && type<=TYPEIMAGES.length){
-					TYPEIMAGES[type] = new Image(FileBase.getProgramDirectory()+"/symbols/"+pngFiles[i]);
+				if (0<=id && id<=TYPEIMAGES.length){
+					if (!size){
+						TYPEIMAGES[id]= new Image(FileBase.getProgramDirectory()+"/symbols/"+pngFiles[i]);
+					}
+					else{
+						sizeImages[id]= new Image(FileBase.getProgramDirectory()+"/symbols/"+pngFiles[i]);
+						size=false;
+					}
 				}
 			}
 		}

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-18 22:24:30 UTC (rev 2295)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-20 11:23:22 UTC (rev 2296)
@@ -449,7 +449,7 @@
 		if (ch != null) {
 			if ( ch.pos.isValid()) {
 				addSymbol("selectedCache", MARK_CACHE_IMAGE, ch.pos);
-				addSymbolIfNecessary(ch.getCacheName(), ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
+				addSymbolIfNecessary(ch.getCacheName(), ch, GuiImageBroker.getTypeImage(ch.getType(),true), ch.pos);
 				markedCache = ch;
 			}
 		}
@@ -1062,11 +1062,11 @@
 				// because visible and valid don't change while showing map -->need no remove
 				if (ch.isVisible() && ch.pos.isValid()) {
 					if (getShowCachesOnMap()) {
-						addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
+						addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType(),true), ch.pos);
 					}
 					else {
 						if (ch.is_Checked) {
-							addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType()), ch.pos);
+							addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType(),true), ch.pos);
 						}
 						else {
 							removeMapSymbol(ch);
@@ -1094,13 +1094,13 @@
 				gotoPosCH = (CacheHolder) gotoPos.mapObject;
 			}
 			if (!getShowCachesOnMap() && (gotoPosCH != null)) {
-				addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType()), gotoPosCH.pos);
+				addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType(),true), gotoPosCH.pos);
 			}
 			addSymbolOnTop("goto", gotoPosCH, "goto_map.png", gotoPos.where);
 		}
 		// show Selected
 		if (markedCache != null) {
-			addSymbolIfNecessary(markedCache.cacheName, markedCache, GuiImageBroker.getTypeImage(markedCache.getType()), markedCache.pos);
+			addSymbolIfNecessary(markedCache.cacheName, markedCache, GuiImageBroker.getTypeImage(markedCache.getType(),true), markedCache.pos);
 			addSymbolOnTop("selectedCache", markedCache, MARK_CACHE_IMAGE, markedCache.pos);
 		}
 	}



From araber95 at mail.berlios.de  Tue Oct 20 20:40:42 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 20 Oct 2009 20:40:42 +0200
Subject: [Cachewolf-svn] r2297 - in trunk: res_noewe/languages
	res_noewe/webmapservices resources src/CacheWolf/navi
Message-ID: <200910201840.n9KIegNH004596@sheep.berlios.de>

Author: araber95
Date: 2009-10-20 20:40:31 +0200 (Tue, 20 Oct 2009)
New Revision: 2297

Added:
   trunk/res_noewe/webmapservices/OSMCycleMap.wms
   trunk/res_noewe/webmapservices/OSMMapnik.wms
   trunk/res_noewe/webmapservices/OSMOsmarender.wms
   trunk/resources/OSMCycleMap.kpr
   trunk/resources/OSMMapnik.kpr
   trunk/resources/OSMOsmarender.kpr
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
Added possibility to download OSM maps with aids of Kosmos (http://wiki.openstreetmap.org/wiki/Kosmos).
Kosmos must be installed on your local computer and you must edit the path to Kosmos.Console.exe into the wms-file.
There is a lot of playground to change the outfit of the downloaded maps.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -538,6 +538,7 @@
 		1831= bis
 		1832=%0a Bitte 'Ca. m pro Pixel' entsprechend anpassen
 		1833=Bitte w?hlen Sie nicht die Trennlinie als WMS-Service
+		1834=Bitte den Pfad zur Kosmos.Console.exe in die wms-Datei richtig eintragen.
 		2000=GPX Export
 		2001=von
 		2100=Explorist Exporter

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -537,6 +537,7 @@
 		1831= to
 		1832=%0a please adjust 'Approx. meter pro pixel' accordingly
 		1833=Please don't select the separetor line in the wms service option
+		1834=Please enter the correct path to Kosmos.Console.exe into the wms-file.
 		2000=GPX Export
 		2001=of
 		2500=Error loading attributes or unknown attribute

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -528,6 +528,8 @@
 		1830=Le service de cartes choisi offre cartes en %e9chelle de
 		1831= %e0
 		1832=%0a Adaptez 'Ca. m par pixel' respectivement, svp.
+		1833=[Please don't select the separetor line in the wms service option]
+		1834=[Please enter the correct path to Kosmos.Console.exe into the wms-file.]
 		2000=GPX Export
 		2001=de
 		2100=Explorist Exporter

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -472,6 +472,8 @@
 		1743=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
 		1800=Downloaden GEO gerelateerde kaarten.
 		1801=Downloaden tegels
+		1833=[Please don't select the separetor line in the wms service option]
+		1834=[Please enter the correct path to Kosmos.Console.exe into the wms-file.]
 		2000=Exporten GPX
 		2001=Van
 		2500=Fout bij laden of onbekende pictogrammen.

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-20 18:40:31 UTC (rev 2297)
@@ -536,6 +536,7 @@
                 1831= do
                 1832=%0a Prosze dostosowac 'Approx. meter pro pixel' accordingly
                 1833=Prosze nie wybierac lini separatora w opcjach serwisu wms
+		1834=[Please enter the correct path to Kosmos.Console.exe into the wms-file.]
                 2000=GPX Export
                 2001=of
                 2500=Blad wczytywania albo bledne atrybuty

Added: trunk/res_noewe/webmapservices/OSMCycleMap.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMCycleMap.wms	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/webmapservices/OSMCycleMap.wms	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,19 @@
+TakenFromUrl:
+GetCapabilitiesUrl:
+Name:               OSMCycleMap World
+MapType:                        topo
+MainUrl:            C:\\Programme\\Kosmos-2.5.405.6\\Console\\Kosmos.Console.exe
+ServiceTypeUrlPart: OSMCycleMap.kpr
+VersionUrlPart:
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     Kosmos
+LayersUrlPart:
+StylesUrlPart:
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
+BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/OSMMapnik.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMMapnik.wms	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/webmapservices/OSMMapnik.wms	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,19 @@
+TakenFromUrl:
+GetCapabilitiesUrl:
+Name:               OSMMapnik World
+MapType:                        topo
+MainUrl:            C:\\Programme\\Kosmos-2.5.405.6\\Console\\Kosmos.Console.exe
+ServiceTypeUrlPart: OSMMapnik.kpr
+VersionUrlPart:
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     Kosmos
+LayersUrlPart:
+StylesUrlPart:
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
+BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/OSMOsmarender.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMOsmarender.wms	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/res_noewe/webmapservices/OSMOsmarender.wms	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,19 @@
+TakenFromUrl:
+GetCapabilitiesUrl:
+Name:               OSMOsmarender World
+MapType:                        topo
+MainUrl:            C:\\Programme\\Kosmos-2.5.405.6\\Console\\Kosmos.Console.exe
+ServiceTypeUrlPart: OSMOsmarender.kpr
+VersionUrlPart:
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     Kosmos
+LayersUrlPart:
+StylesUrlPart:
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
+BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/resources/OSMCycleMap.kpr
===================================================================
--- trunk/resources/OSMCycleMap.kpr	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/resources/OSMCycleMap.kpr	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,13 @@
+<KosmosProject Version="2.2">
+  <RulesSource>
+    <WikiPage>http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules</WikiPage>
+  </RulesSource>
+  <DataFiles>
+    <WebMap>
+      <Provider>OSM CycleMap</Provider>
+      <Transparency>100</Transparency>
+    </WebMap>
+  </DataFiles>
+  <PrintSettings>
+  </PrintSettings>
+</KosmosProject>
\ No newline at end of file

Added: trunk/resources/OSMMapnik.kpr
===================================================================
--- trunk/resources/OSMMapnik.kpr	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/resources/OSMMapnik.kpr	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,13 @@
+<KosmosProject Version="2.2">
+  <RulesSource>
+    <WikiPage>http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules</WikiPage>
+  </RulesSource>
+  <DataFiles>
+    <WebMap>
+      <Provider>OSM Mapnik</Provider>
+      <Transparency>100</Transparency>
+    </WebMap>
+  </DataFiles>
+  <PrintSettings>
+  </PrintSettings>
+</KosmosProject>
\ No newline at end of file

Added: trunk/resources/OSMOsmarender.kpr
===================================================================
--- trunk/resources/OSMOsmarender.kpr	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/resources/OSMOsmarender.kpr	2009-10-20 18:40:31 UTC (rev 2297)
@@ -0,0 +1,13 @@
+<KosmosProject Version="2.2">
+  <RulesSource>
+    <WikiPage>http://wiki.openstreetmap.org/index.php/Kosmos_General_Purpose_Rules</WikiPage>
+  </RulesSource>
+  <DataFiles>
+    <WebMap>
+      <Provider>OSM Osmarender</Provider>
+      <Transparency>100</Transparency>
+    </WebMap>
+  </DataFiles>
+  <PrintSettings>
+  </PrintSettings>
+</KosmosProject>
\ No newline at end of file

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-20 11:23:22 UTC (rev 2296)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-20 18:40:31 UTC (rev 2297)
@@ -44,7 +44,7 @@
 	float tileScale;
 
 	/**
-	 * 
+	 *
 	 * @param prxy
 	 * @param prt
 	 * @param wmspath without trailing "/"
@@ -59,21 +59,21 @@
 		FileBugfix files = new FileBugfix(wmspath);
 		String FileName;
 		OnlineMapService tempOMS;
-		MessageBox f = null; 
+		MessageBox f = null;
 		dateien = files.list("*.wms", FileBase.LIST_FILES_ONLY); //"*.xyz" doesn't work on some systems -> use FileBugFix
 		for(int i = 0; i < dateien.length;i++){
 			FileName = dateien[i];
 			try {
 				if (!showprogress && ((i & 0) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
-					showprogress = true;      
+					showprogress = true;
 					progressBox = new InfoBox(MyLocale.getMsg(327, "Info"), MyLocale.getMsg(4800, "Loading online map services"));
-					progressBox.exec(); 
+					progressBox.exec();
 					progressBox.waitUntilPainted(500);
 					ewe.sys.Vm.showWait(true);
 				}
 				tempOMS = new WebMapService(STRreplace.replace(wmspath + "/" + FileName, "//", "/"));
 				onlineMapServices.add(tempOMS);
-			}catch(Exception ex){ 
+			}catch(Exception ex){
 				if (f == null) (f=new MessageBox(MyLocale.getMsg(144, "Warning"), MyLocale.getMsg(4801, "Ignoring error while \n reading web map service definition file \n")+ex.toString(), FormBase.OKB)).exec();
 			}
 		}
@@ -115,7 +115,7 @@
 	}
 
 	/**
-	 * download maps from expedia at zoomlevel alti and save the maps and the .wfl 
+	 * download maps from expedia at zoomlevel alti and save the maps and the .wfl
 	 * in path
 	 * @param center centre of all tiles
 	 * @param radius in meters
@@ -123,7 +123,7 @@
 	 * @param size in pixels
 	 * @param overlapping in pixels
 	 * @param path without "/" at the end
-	 * 
+	 *
 	 */
 	public void setTiles (CWPoint center, float radius, float scale, Point size, int overlapping) {
 		double metersPerLat = (1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
@@ -145,8 +145,8 @@
 		double pixelsPerLon = metersPerLon / metersperpixel;
 
 		//over all pixelsize without borders
-		double pixelsY = (topleft.latDec - buttomright.latDec) * pixelsPerLat; 
-		double pixelsX = -(topleft.lonDec - buttomright.lonDec) * pixelsPerLon ; 
+		double pixelsY = (topleft.latDec - buttomright.latDec) * pixelsPerLat;
+		double pixelsX = -(topleft.lonDec - buttomright.lonDec) * pixelsPerLon ;
 
 		//border sizes around given area and overlapping between tiles
 		//int borderX = (int) java.lang.Math.round((float)size.x * (overlapping - 1.0));
@@ -205,7 +205,7 @@
 		progressInfobox = progrssInfoboxi;
 	}
 	/**
-	 * 
+	 *
 	 * @param center
 	 * @param scale
 	 * @param pixelsize
@@ -217,8 +217,25 @@
 		String filename = createFilename(mio.getCenter(), mio.scale);
 		String imagename = mio.setName(path, filename) + currentOnlineMapService.getImageFileExt();
 		String url = currentOnlineMapService.getUrlForCenterScale(center, scale, pixelsize);
-		downloadImage(url, path+imagename);
-		mio.saveWFL();
+		WebMapService wms = (WebMapService) currentOnlineMapService;
+		if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {
+			url="bitmapgen"+
+				" \""+FileBase.getProgramDirectory().replace('/','\\')+"\\"+wms.serviceTypeUrlPart+" \""+
+				" \""+path.replace('/','\\')+imagename+"\""+
+				" -mb "+url; // + minx miny maxx maxy + pixelsize.x
+			File f=new FileBugfix(wms.MainUrl);
+			if (!f.exists()) {
+				MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1834,"Please enter the correct path to Kosmos.Console.exe into the wms-file."),ewe.ui.MessageBox.OKB);
+				mb.execute();
+			} else {
+				Vm.exec(wms.MainUrl, url, 0, true);
+				mio.saveWFL();
+			}
+		}
+		else {
+			downloadImage(url, path+imagename);
+			mio.saveWFL();
+		}
 	}
 
 	public String createFilename(CWPoint center, float scale) {
@@ -228,10 +245,10 @@
 	}
 
 	/**
-	 * @param url usual URL. If a redirect is requiered (as in the case of 
+	 * @param url usual URL. If a redirect is requiered (as in the case of
 	 * Expedia, add an "R" before "http://" --> Don't download the url, retry until getting a http-redirect
 	 * this is necessary for expedia as it delivers the image only after a http-redirect
-	 * and sometimes doesn't send a redirect on the first try 
+	 * and sometimes doesn't send a redirect on the first try
 	 * @param datei path and name of file to save to
 	 */
 	public void downloadImage(String url, String datei) throws IOException {
@@ -277,7 +294,7 @@
 					String tmp = connImg.readText(sockImg, null).toString(); // TODO if the content is binary will will get an Exception in InfoBox, trying to display the content
 					tmp = tmp.substring(0, (tmp.length() < 1000 ? tmp.length() : 1000));
 					sockImg.close();
-					throw new IOException(MyLocale.getMsg(4808, "downloadImage: content-type:")+" " + ct + MyLocale.getMsg(4809, " is not an image, begin of content:")+" " + tmp); 
+					throw new IOException(MyLocale.getMsg(4808, "downloadImage: content-type:")+" " + ct + MyLocale.getMsg(4809, " is not an image, begin of content:")+" " + tmp);
 				}
 				daten = connImg.readData(sockImg);
 				fos = new FileOutputStream(datei); // note: using the constructor (File) instead of (String) will cause not to use the fake file system
@@ -299,7 +316,7 @@
 	String name;
 	/** Type of map (used as directory name when downloading maps. We currently have "topo" and "photo" defined as map types */
 	String mapType;
-	/** Esentially the same as name, but used for the file system. It will be part of the names of the downloaded images */ 
+	/** Esentially the same as name, but used for the file system. It will be part of the names of the downloaded images */
 	String filename;
 	String MainUrl; //http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS
 	/** including "." */
@@ -310,11 +327,11 @@
 	double maxscale;
 	Area boundingBox;
 
-	/** 
-	 * This method is used in case the online map service provides only certain steps of 
+	/**
+	 * This method is used in case the online map service provides only certain steps of
 	 * zoomlevels. In this case the scale in meters per pixel must be returned, which
-	 * will be used instead of the wished scale. 
-	 * 
+	 * will be used instead of the wished scale.
+	 *
 	 * @param scale
 	 * @return
 	 */
@@ -326,7 +343,7 @@
 		return imageFileExt;
 	}
 
-	/** 
+	/**
 	 * Overlaod this to integrate name of layers
 	 * @return friendly service name
 	 */
@@ -334,8 +351,8 @@
 		return name;
 	}
 
-	/** 
-	 * This method is called to get a name of the 
+	/**
+	 * This method is called to get a name of the
 	 * online map service which will be part of the filename
 	 * used for the downloaded image
 	 * @return friendly service name
@@ -390,11 +407,11 @@
 		return bbox;
 	}
 
-	
+
 	protected MapInfoObject getMapInfoObjectInternal(Area maparea, Point pixelsize) {
 		throw new IllegalArgumentException(MyLocale.getMsg(4811, "OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):\n This method must be overloaded in order to be able to use it"));
 	}
-	
+
 	/**
 	 * Overload this (don't call super()) or alternatively overload getMapInfoObjectInternal
 	 * @param center
@@ -414,17 +431,17 @@
 class WebMapService extends OnlineMapService {
 	String layersUrlPart; //
 	String versionUrlPart; // VERSION=1.1.0
-	String serviceTypeUrlPart; //"SERVICE=WMS" 
-	int coordinateReferenceSystem[]; // WGS84: 4326, German GK: 31466 / 
+	String serviceTypeUrlPart; //"SERVICE=WMS"
+	int coordinateReferenceSystem[]; // WGS84: 4326, German GK: 31466 /
 	String coordinateReferenceSystemUrlPart[]; //&SRS=EPSG:31466
-	String requestUrlPart;
+	public String requestUrlPart;
 	String imageFormatUrlPart; // FORMAT=image/png
 	String stylesUrlPart; // STYLES=
 	double minscaleWMS;
 	double maxscaleWMS;
 
 	/**
-	 * 
+	 *
 	 * @param filename without file extension
 	 * @throws IOException
 	 * @throws IllegalArgumentException
@@ -500,7 +517,7 @@
 	private static final int TOPRIGHT_INDEX = 2;
 	private static final int BUTTOMLEFT_INDEX = 3;
 	/**
-	 * 
+	 *
 	 * @param maparea
 	 * @return [0] = topleft, [1] = buttomright, [2] = topright, [3] = buttomleft
 	 */
@@ -515,13 +532,13 @@
 		ret[BUTTOMRIGHT_INDEX] = TransformCoordinates.wgs84ToEpsg(maparea.buttomright, coordinateReferenceSystem[crs]);
 		ret[TOPRIGHT_INDEX] =  ret[BUTTOMRIGHT_INDEX].cloneIt();
 		ret[TOPRIGHT_INDEX].shift(ret[TOPLEFT_INDEX].getNorthing() - ret[BUTTOMRIGHT_INDEX].getNorthing(), 0); // was: new GkPoint(ret[BUTTOMRIGHT_INDEX].getEasting(region), ret[TOPLEFT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
-		ret[BUTTOMLEFT_INDEX] = ret[BUTTOMRIGHT_INDEX].cloneIt(); 
+		ret[BUTTOMLEFT_INDEX] = ret[BUTTOMRIGHT_INDEX].cloneIt();
 		ret[BUTTOMLEFT_INDEX].shift(ret[TOPLEFT_INDEX].getEasting() - ret[BUTTOMRIGHT_INDEX].getEasting(), 1); // was: new GkPoint(ret[TOPLEFT_INDEX].getEasting(region), ret[BUTTOMRIGHT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
 		//Vm.debug("rot left direkt: " + TransformCoordinates.GkToWgs84(ret[TOPLEFT_INDEX], region).getBearing(TransformCoordinates.GkToWgs84(ret[BUTTOMLEFT_INDEX], region)));
 		//Vm.debug("rot right direkt: " + TransformCoordinates.GkToWgs84(ret[TOPRIGHT_INDEX], region).getBearing(TransformCoordinates.GkToWgs84(ret[BUTTOMRIGHT_INDEX], region)));
 		//ret[2] = TransformCoordinates.wgs84ToGermanGk(topright, coordinateReferenceSystem[crs]);
 		//ret[3] = TransformCoordinates.wgs84ToGermanGk(buttomleft, coordinateReferenceSystem[crs]);
-		return ret;	
+		return ret;
 	}
 	public Area CenterScaleToArea(CWPoint center, float scale, Point pixelsize) {
 		Area bbox = new Area();
@@ -559,13 +576,13 @@
 		// http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS&VERSION=1.1.0&REQUEST=GetMap&SRS=EPSG:31466&BBOX=2577567.0149,5607721.7566,2578567.0077,5608721.7602&WIDTH=500&HEIGHT=500&LAYERS=Raster:TK25_KMF:Farbkombination&STYLES=&FORMAT=image/png
 		CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
 		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
-		double scaleh = maparea.buttomright.getDistance(buttomleft) * 1000 / pixelsize.x; 
-		double scalev = maparea.topleft.getDistance(topright) * 1000 / pixelsize.y; 
+		double scaleh = maparea.buttomright.getDistance(buttomleft) * 1000 / pixelsize.x;
+		double scalev = maparea.topleft.getDistance(topright) * 1000 / pixelsize.y;
 		double scale = Math.sqrt(scaleh * scaleh + scalev * scalev); // meters per pixel measured diagonal
 		if ( scale < minscaleWMS || scale > maxscaleWMS ) throw new IllegalArgumentException(MyLocale.getMsg(4825, "scale")+" " + scale / Math.sqrt(2)+ MyLocale.getMsg(4826, " not supported by online map service, supported scale range:")+" " + minscale + " - " + maxscale + MyLocale.getMsg(4827, " (measured in meters per pixel vertically)"));
 		int crs = 0;
 		String bbox = "BBOX=";
-		int localsystem = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]); 
+		int localsystem = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]);
 		if (localsystem > 0) {
 			crs = getCrs(maparea.getCenter());
 			ProjectedPoint[] gk = getGkArea(maparea);
@@ -573,13 +590,19 @@
 			topright = TransformCoordinates.ProjectedEpsgToWgs84(gk[TOPRIGHT_INDEX], coordinateReferenceSystem[crs]);
 			bbox += TransformCoordinates.wgs84ToEpsg(buttomleft, coordinateReferenceSystem[crs]).toString(2, "", ",");
 			bbox += "," + TransformCoordinates.wgs84ToEpsg(topright, coordinateReferenceSystem[crs]).toString(2, "", ",");
-		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84) 
+		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84)
 			bbox += buttomleft.toString(TransformCoordinates.LON_LAT)  + "," + topright.toString(TransformCoordinates.LON_LAT);
 		else throw new IllegalArgumentException(MyLocale.getMsg(4828, "Coordinate system not supported by cachewolf:")+" " + coordinateReferenceSystem.toString());
-		String ret = MainUrl + "SERVICE=WMS" + "&"+ versionUrlPart + "&" + requestUrlPart + "&" + 
-		coordinateReferenceSystemUrlPart[crs] + "&" + bbox + 
-		"&WIDTH=" + pixelsize.x + "&HEIGHT=" + pixelsize.y + "&" + 
+		String ret = MainUrl + "SERVICE=WMS" + "&"+ versionUrlPart + "&" + requestUrlPart + "&" +
+		coordinateReferenceSystemUrlPart[crs] + "&" + bbox +
+		"&WIDTH=" + pixelsize.x + "&HEIGHT=" + pixelsize.y + "&" +
 		layersUrlPart + "&" + stylesUrlPart + "&" + imageFormatUrlPart;
+		if (requestUrlPart.equalsIgnoreCase("Kosmos")) {
+			// minlat minlng maxlat maxlng
+			ret=buttomleft.toString(TransformCoordinates.LAT_LON).replace(',',' ')+" "+
+				topright.toString(TransformCoordinates.LAT_LON).replace(',',' ')+
+				" -w "+pixelsize.x;
+		}
 		Global.getPref().log(ret + " WGS84: Buttom left: " + buttomleft.toString(TransformCoordinates.DD) + "top right: " + topright.toString(TransformCoordinates.DD));
 		return ret;
 	}
@@ -588,7 +611,7 @@
 	 * This method gives the number in the array of coordinateReferenceSystems, which should be used
 	 * a) if only one is in the array 0 is returned
 	 * b) if there are more, find out which one matches the correct zone (e.g. Gau?-K?ger stripe)
-	 * Call this routine with center of the area (use Area.getcenter()) 
+	 * Call this routine with center of the area (use Area.getcenter())
 	 * @param p Point for which the epsg code is searched for
 	 * @return
 	 */
@@ -599,14 +622,14 @@
 			ProjectedPoint gkbl = TransformCoordinates.wgs84ToLocalsystem(p, ls); // TODO: think / read about what to do if buttom left and top right are not in the same Gau?-Kr?ger stripe?
 			int wantepsg = gkbl.getEpsgCode();
 			for (crsindex = 0; crsindex < coordinateReferenceSystem.length; crsindex++) {
-				if (coordinateReferenceSystem[crsindex] == wantepsg) break; 
+				if (coordinateReferenceSystem[crsindex] == wantepsg) break;
 			}
 			if (crsindex >= coordinateReferenceSystem.length) { // not match
 				for (crsindex = 0; crsindex < coordinateReferenceSystem.length; crsindex++) {
-					if (Math.abs(coordinateReferenceSystem[crsindex] - wantepsg) == 1) break; // accept 1 zone deviation 
+					if (Math.abs(coordinateReferenceSystem[crsindex] - wantepsg) == 1) break; // accept 1 zone deviation
 				}
 				if (crsindex >= coordinateReferenceSystem.length) crsindex = -1;
-				
+
 			}
 			if (crsindex < 0) throw new IllegalArgumentException(MyLocale.getMsg(4829, "getUrlForBoundingBox: Point:")+" " + gkbl.toString() + MyLocale.getMsg(4830, "no matching Gau?-Kr?ger-Stripe in the EPSG-code list in the .wms"));
 		}
@@ -622,9 +645,9 @@
 		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
 		CWPoint topleft = new CWPoint(maparea.topleft);
 		CWPoint buttomright = new CWPoint(maparea.buttomright);
-		double metersperpixalhorizontal = ( buttomright.getDistance(buttomleft) + topleft.getDistance(topright))/2 * 1000 / pixelsize.x; 
+		double metersperpixalhorizontal = ( buttomright.getDistance(buttomleft) + topleft.getDistance(topright))/2 * 1000 / pixelsize.x;
 		double metersperpixalvertical = ( buttomright.getDistance(topright) + topleft.getDistance(buttomleft))/2 * 1000 / pixelsize.y;
-		int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]); 
+		int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]);
 		if ( region > 0) {
 			ProjectedPoint[] gk = getGkArea(maparea);
 			// bounding box in WMS is defined around the pixels, not exactly on the pixels --> the bounding box must be reduced on all edges by half a pixel
@@ -673,19 +696,19 @@
 
 class ExpediaMapService extends OnlineMapService {
 	/*
-	 * information from: DownloadMouseMode.properties in project GPSylon ( in directory gpsylon_src-0.5.2\plugins\downloadmousemode\auxiliary\org\dinopolis\gpstool\plugin\downloadmousemode and DownloadMapCalculator.java in Dir gpsylon_src-0.5.2\plugins\downloadmousemode\src\org\dinopolis\gpstool\plugin\downloadmousemode 
+	 * information from: DownloadMouseMode.properties in project GPSylon ( in directory gpsylon_src-0.5.2\plugins\downloadmousemode\auxiliary\org\dinopolis\gpstool\plugin\downloadmousemode and DownloadMapCalculator.java in Dir gpsylon_src-0.5.2\plugins\downloadmousemode\src\org\dinopolis\gpstool\plugin\downloadmousemode
 	 * download.map.url.expedia_east=http\://www.expedia.com/pub/agent.dll?qscr=mrdt&ID=3XNsF.&CenP={0,number,#.########},{1,number,#.########}&Lang=EUR0809&Alti={2,number,#}&Size={3,number,#},{4,number,#}&Offs=0.000000,0.000000\&BCheck=1
 	 * download.map.url.expedia_east.title=Url of Expedia Europe
 	 * download.map.scale_factor.expedia_east=3950
 	 */
 	final static float downloadMapScaleFactorExpedia_east = 3950;
 	final static float MAPBLAST_METERS_PER_PIXEL = 1.0f/2817.947378f;
-	final static float EXPEDIA_METERS_PER_PIXEL = downloadMapScaleFactorExpedia_east * MAPBLAST_METERS_PER_PIXEL; 
+	final static float EXPEDIA_METERS_PER_PIXEL = downloadMapScaleFactorExpedia_east * MAPBLAST_METERS_PER_PIXEL;
 
 	public ExpediaMapService() {
 		name = "Expedia";
 		filename = "expedia";
-		MainUrl = "Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&ID=3kQaz."; //"Rhttp://" forces doenloadUrl to retry the URL until it gets an http-redirect and then downloads from there 
+		MainUrl = "Rhttp://www.expedia.de/pub/agent.dll?qscr=mrdt&ID=3kQaz."; //"Rhttp://" forces doenloadUrl to retry the URL until it gets an http-redirect and then downloads from there
 		imageFileExt = ".gif";
 		mapType = "expedia";
 		recommendedScales = new double[]{5};
@@ -697,7 +720,7 @@
 	public float getMetersPerPixel(float scale) {
 		return EXPEDIA_METERS_PER_PIXEL * getZoomlevel(scale);
 	}
-	
+
 	private int getZoomlevel(float scale) {
 		return (int)(Math.ceil(scale / EXPEDIA_METERS_PER_PIXEL));
 	}
@@ -705,7 +728,7 @@
 	public String getUrlForCenterScale(CWPoint center, float scale, Point pixelsize) {
 		int zoomlevel = getZoomlevel(scale);
 		String zone;
-		if (     (center.lonDec <= -30   && center.lonDec >= -170) || 
+		if (     (center.lonDec <= -30   && center.lonDec >= -170) ||
 				( center.lonDec > 360-30 && center.lonDec <= 360-170) ) zone = "USA0409"; // TODO test which zone-code ist best for asia
 		else zone = "EUR0809";
 		String quelle = MainUrl + "&CenP=" + center.toString(TransformCoordinates.LAT_LON);



From araber95 at mail.berlios.de  Tue Oct 20 21:33:11 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 20 Oct 2009 21:33:11 +0200
Subject: [Cachewolf-svn] r2298 - trunk/res_noewe/symbols
Message-ID: <200910201933.n9KJXBVe014556@sheep.berlios.de>

Author: araber95
Date: 2009-10-20 21:32:55 +0200 (Tue, 20 Oct 2009)
New Revision: 2298

Added:
   trunk/res_noewe/symbols/10size.PNG
   trunk/res_noewe/symbols/12size.PNG
   trunk/res_noewe/symbols/13size.PNG
   trunk/res_noewe/symbols/14size.PNG
   trunk/res_noewe/symbols/15size.PNG
   trunk/res_noewe/symbols/17size.PNG
   trunk/res_noewe/symbols/21size.PNG
   trunk/res_noewe/symbols/2size.PNG
   trunk/res_noewe/symbols/6size.PNG
   trunk/res_noewe/symbols/7size.PNG
   trunk/res_noewe/symbols/8size.PNG
Modified:
   trunk/res_noewe/symbols/11size.png
   trunk/res_noewe/symbols/15.PNG
   trunk/res_noewe/symbols/16size.png
   trunk/res_noewe/symbols/18size.png
   trunk/res_noewe/symbols/4size.png
Log:
new big symbols, changed one small icon

Added: trunk/res_noewe/symbols/10size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/10size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/symbols/11size.png
===================================================================
(Binary files differ)

Added: trunk/res_noewe/symbols/12size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/12size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/13size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/13size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/14size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/14size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/symbols/15.PNG
===================================================================
(Binary files differ)

Added: trunk/res_noewe/symbols/15size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/15size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/symbols/16size.png
===================================================================
(Binary files differ)

Added: trunk/res_noewe/symbols/17size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/17size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/symbols/18size.png
===================================================================
(Binary files differ)

Added: trunk/res_noewe/symbols/21size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/21size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/2size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/2size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/symbols/4size.png
===================================================================
(Binary files differ)

Added: trunk/res_noewe/symbols/6size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/6size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/7size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/7size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/8size.PNG
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/8size.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From mik77 at mail.berlios.de  Wed Oct 21 10:16:43 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 21 Oct 2009 10:16:43 +0200
Subject: [Cachewolf-svn] r2299 - trunk/res_noewe
Message-ID: <200910210816.n9L8GhHL030191@sheep.berlios.de>

Author: mik77
Date: 2009-10-21 10:16:27 +0200 (Wed, 21 Oct 2009)
New Revision: 2299

Modified:
   trunk/res_noewe/spider.def
Log:
Tags in Description are now correctly closed.

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-10-20 19:32:55 UTC (rev 2298)
+++ trunk/res_noewe/spider.def	2009-10-21 08:16:27 UTC (rev 2299)
@@ -31,6 +31,7 @@
 # Version 4.7 - 20090521 Strings for single cache types added
 # Version 4.8 - 20090805 More specific unavailability detection
 # Version 4.9 - 20091018 Should work now with proxies and cachetypes as background
+# Version 4.10- 20091021 Tags in Description are now correctly closed
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -84,7 +85,7 @@
 cacheArchived      = This cache\ has\ been\ archived
 latLonRex          = <span\ id="LatLon"\ style="font-weight:bold;">((?s).*?)</span>
 shortDescRex       = <span\ id="ShortDescription">((?s).*?)</span>
-longDescRex        = <span\ id="LongDescription">((?s).*?)<strong>Additional\ Hints&nbsp;\\(</strong>
+longDescRex        = <span\ id="LongDescription">((?s).*?)</span>(?:\\s*)<br\ />(?:\\s*)</p>(?:\\s*)<p>(?:\\s*)<strong>Additional\ Hints&nbsp;\\(</strong>
 cacheNameRex       = <span\ id="CacheName">((?s).*?)</span>
 cacheOwnerRex      = <span\ id="CacheOwner">by\ <a\ href=(?:(?s).*?)>((?s).*?)</a></span>
 dateHiddenRex      = <span\ id="DateHidden">((?s).*?)</span>



From pfeffer at mail.berlios.de  Wed Oct 21 21:58:11 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 21 Oct 2009 21:58:11 +0200
Subject: [Cachewolf-svn] r2300 - trunk/src/CacheWolf/navi
Message-ID: <200910211958.n9LJwBd5023879@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-21 21:58:09 +0200 (Wed, 21 Oct 2009)
New Revision: 2300

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
MapLoader: use our bug fixed version of vm.exec()

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-21 08:16:27 UTC (rev 2299)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-21 19:58:09 UTC (rev 2300)
@@ -7,6 +7,7 @@
 import CacheWolf.InfoBox;
 import CacheWolf.MyLocale;
 import CacheWolf.STRreplace;
+import CacheWolf.utils.CWWrapper;
 import CacheWolf.utils.FileBugfix;
 import ewe.ui.*;
 import ewe.io.*;
@@ -228,7 +229,7 @@
 				MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1834,"Please enter the correct path to Kosmos.Console.exe into the wms-file."),ewe.ui.MessageBox.OKB);
 				mb.execute();
 			} else {
-				Vm.exec(wms.MainUrl, url, 0, true);
+				CWWrapper.exec(wms.MainUrl, url, true);
 				mio.saveWFL();
 			}
 		}



From pfeffer at mail.berlios.de  Thu Oct 22 01:05:01 2009
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Thu, 22 Oct 2009 01:05:01 +0200
Subject: [Cachewolf-svn] r2301 - trunk/src/CacheWolf/navi
Message-ID: <200910212305.n9LN51ks002786@sheep.berlios.de>

Author: pfeffer
Date: 2009-10-22 01:04:59 +0200 (Thu, 22 Oct 2009)
New Revision: 2301

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
OSM-KosmosMaploader: make it a bit more platform independent
OSM-KosmosMaploader: revert my last commit CWWrapper can only deal with 1 argument which must be a filename


Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-21 19:58:09 UTC (rev 2300)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-21 23:04:59 UTC (rev 2301)
@@ -221,15 +221,15 @@
 		WebMapService wms = (WebMapService) currentOnlineMapService;
 		if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {
 			url="bitmapgen"+
-				" \""+FileBase.getProgramDirectory().replace('/','\\')+"\\"+wms.serviceTypeUrlPart+" \""+
-				" \""+path.replace('/','\\')+imagename+"\""+
+				" \""+FileBase.getProgramDirectory().replace('/',File.separatorChar)+"\\"+wms.serviceTypeUrlPart+"\""+
+				" \""+path.replace('/', File.separatorChar)+imagename+"\""+
 				" -mb "+url; // + minx miny maxx maxy + pixelsize.x
 			File f=new FileBugfix(wms.MainUrl);
-			if (!f.exists()) {
+			if (!f.exists() || !f.canRead()) {
 				MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1834,"Please enter the correct path to Kosmos.Console.exe into the wms-file."),ewe.ui.MessageBox.OKB);
 				mb.execute();
 			} else {
-				CWWrapper.exec(wms.MainUrl, url, true);
+				Vm.exec(wms.MainUrl.replace('/', File.separatorChar), url, 0, true);
 				mio.saveWFL();
 			}
 		}



From mik77 at mail.berlios.de  Thu Oct 22 23:05:44 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 22 Oct 2009 23:05:44 +0200
Subject: [Cachewolf-svn] r2302 - trunk/src/CacheWolf
Message-ID: <200910222105.n9ML5iSI028667@sheep.berlios.de>

Author: mik77
Date: 2009-10-22 23:05:42 +0200 (Thu, 22 Oct 2009)
New Revision: 2302

Modified:
   trunk/src/CacheWolf/CacheType.java
Log:
Final Coordinates -> Final Location

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2009-10-21 23:04:59 UTC (rev 2301)
+++ trunk/src/CacheWolf/CacheType.java	2009-10-22 21:05:42 UTC (rev 2302)
@@ -183,7 +183,7 @@
 	/** GPX identifier for additional waypoint QTA */
 	public static final String GC_GPX_QUESTION = "Waypoint|Question to Answer";
 	/** GPX identifier for additional waypoint Final */
-	public static final String GC_GPX_FINAL = "Waypoint|Final Coordinates";
+	public static final String GC_GPX_FINAL = "Waypoint|Final Location";
 	/** GPX identifier for additional waypoint Trailhead */
 	public static final String GC_GPX_TRAILHEAD = "Waypoint|Trailhead";
 	/** GPX identifier for additional waypoint Reference Point */
@@ -455,7 +455,7 @@
 		if (gpxType.equals(GC_GPX_PARKING)) return CW_TYPE_PARKING;
 		if (gpxType.equals(GC_GPX_STAGE)) return CW_TYPE_STAGE;
 		if (gpxType.equals(GC_GPX_QUESTION)) return CW_TYPE_QUESTION;
-		if (gpxType.equals(GC_GPX_FINAL)||gpxType.equals("Waypoint|Final Location")) return CW_TYPE_FINAL;
+		if (gpxType.equals(GC_GPX_FINAL)||gpxType.equals("Waypoint|Final Coordinates")) return CW_TYPE_FINAL;
 		if (gpxType.equals(GC_GPX_TRAILHEAD)) return CW_TYPE_TRAILHEAD;
 		if (gpxType.equals(GC_GPX_REFERENCE)) return CW_TYPE_REFERENCE;
 		if (gpxType.equals(GC_GPX_MAZE)) return CW_TYPE_MAZE;



From mik77 at mail.berlios.de  Fri Oct 23 20:22:02 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 23 Oct 2009 20:22:02 +0200
Subject: [Cachewolf-svn] r2303 - in trunk: res_noewe src/CacheWolf/imp
Message-ID: <200910231822.n9NIM2e1027619@sheep.berlios.de>

Author: mik77
Date: 2009-10-23 20:22:00 +0200 (Fri, 23 Oct 2009)
New Revision: 2303

Modified:
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Reverted regex change for long description, because it doesn't work on EWE/EXE. I've done the trimming in SpiderGC.java

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-10-22 21:05:42 UTC (rev 2302)
+++ trunk/res_noewe/spider.def	2009-10-23 18:22:00 UTC (rev 2303)
@@ -32,6 +32,7 @@
 # Version 4.8 - 20090805 More specific unavailability detection
 # Version 4.9 - 20091018 Should work now with proxies and cachetypes as background
 # Version 4.10- 20091021 Tags in Description are now correctly closed
+# Version 4.11- 20091023 Reverted last change, because it doesn't work with EWE/EXE
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -85,7 +86,9 @@
 cacheArchived      = This cache\ has\ been\ archived
 latLonRex          = <span\ id="LatLon"\ style="font-weight:bold;">((?s).*?)</span>
 shortDescRex       = <span\ id="ShortDescription">((?s).*?)</span>
-longDescRex        = <span\ id="LongDescription">((?s).*?)</span>(?:\\s*)<br\ />(?:\\s*)</p>(?:\\s*)<p>(?:\\s*)<strong>Additional\ Hints&nbsp;\\(</strong>
+#This version doesn't work with EWE/EXE, so we trim the tags in code
+#longDescRex        = <span\ id="LongDescription">((?s).*?)</span>(?:\\s*)<br\ />(?:\\s*)</p>(?:\\s*)<p>(?:\\s*)<strong>Additional\ Hints&nbsp;\\(</strong>
+longDescRex        = <span\ id="LongDescription">((?s).*?)<strong>Additional\ Hints&nbsp;\\(</strong>
 cacheNameRex       = <span\ id="CacheName">((?s).*?)</span>
 cacheOwnerRex      = <span\ id="CacheOwner">by\ <a\ href=(?:(?s).*?)>((?s).*?)</a></span>
 dateHiddenRex      = <span\ id="DateHidden">((?s).*?)</span>

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-22 21:05:42 UTC (rev 2302)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-10-23 18:22:00 UTC (rev 2303)
@@ -985,6 +985,10 @@
 		rex2.search(doc);
 		res = ((inRex.stringMatched(1)==null)?"":inRex.stringMatched(1)) + "<br>";
 		res += rex2.stringMatched(1);
+		int spanEnd = res.lastIndexOf("</span>");
+		if (spanEnd >= 0) {
+			res = res.substring(0, spanEnd);
+		}
 		return res; // SafeXML.cleanback(res);
 	}
 



From araber95 at mail.berlios.de  Fri Oct 23 23:19:01 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 23 Oct 2009 23:19:01 +0200
Subject: [Cachewolf-svn] r2304 - trunk/res_noewe/symbols
Message-ID: <200910232119.n9NLJ19t015574@sheep.berlios.de>

Author: araber95
Date: 2009-10-23 23:18:54 +0200 (Fri, 23 Oct 2009)
New Revision: 2304

Added:
   trunk/res_noewe/symbols/readme.htm
Modified:
   trunk/res_noewe/symbols/readme.txt
Log:
First of all : I like the new symbols better than the old ones ; Second : a new feature should be shown; and third : its is more easy to delete a directory than extracting a zip-file.

Added: trunk/res_noewe/symbols/readme.htm
===================================================================
--- trunk/res_noewe/symbols/readme.htm	2009-10-23 18:22:00 UTC (rev 2303)
+++ trunk/res_noewe/symbols/readme.htm	2009-10-23 21:18:54 UTC (rev 2304)
@@ -0,0 +1,229 @@
+<html xmlns:v="urn:schemas-microsoft-com:vml"
+xmlns:o="urn:schemas-microsoft-com:office:office"
+xmlns:w="urn:schemas-microsoft-com:office:word"
+xmlns="http://www.w3.org/TR/REC-html40">
+
+<head>
+<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
+<meta name=ProgId content=Word.Document>
+<meta name=Generator content="Microsoft Word 10">
+<meta name=Originator content="Microsoft Word 10">
+<link rel=File-List href="readme-Dateien/filelist.xml">
+<title>In diesem Verzeichnis vorhandene </title>
+<!--[if gte mso 9]><xml>
+ <o:DocumentProperties>
+  <o:Author>.</o:Author>
+  <o:LastAuthor>.</o:LastAuthor>
+  <o:Revision>1</o:Revision>
+  <o:Created>2009-10-23T21:05:00Z</o:Created>
+  <o:LastSaved>2009-10-23T21:07:00Z</o:LastSaved>
+  <o:Pages>1</o:Pages>
+  <o:Words>184</o:Words>
+  <o:Characters>1163</o:Characters>
+  <o:Company>CF Computer</o:Company>
+  <o:Lines>9</o:Lines>
+  <o:Paragraphs>2</o:Paragraphs>
+  <o:CharactersWithSpaces>1345</o:CharactersWithSpaces>
+  <o:Version>10.6856</o:Version>
+ </o:DocumentProperties>
+</xml><![endif]--><!--[if gte mso 9]><xml>
+ <w:WordDocument>
+  <w:SpellingState>Clean</w:SpellingState>
+  <w:GrammarState>Clean</w:GrammarState>
+  <w:HyphenationZone>21</w:HyphenationZone>
+  <w:Compatibility>
+   <w:BreakWrappedTables/>
+   <w:SnapToGridInCell/>
+   <w:WrapTextWithPunct/>
+   <w:UseAsianBreakRules/>
+  </w:Compatibility>
+  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
+ </w:WordDocument>
+</xml><![endif]-->
+<style>
+<!--
+ /* Style Definitions */
+ p.MsoNormal, li.MsoNormal, div.MsoNormal
+	{mso-style-parent:"";
+	margin:0cm;
+	margin-bottom:.0001pt;
+	mso-pagination:widow-orphan;
+	font-size:12.0pt;
+	font-family:"Times New Roman";
+	mso-fareast-font-family:"Times New Roman";}
+span.SpellE
+	{mso-style-name:"";
+	mso-spl-e:yes;}
+span.GramE
+	{mso-style-name:"";
+	mso-gram-e:yes;}
+ at page Section1
+	{size:595.3pt 841.9pt;
+	margin:70.85pt 70.85pt 2.0cm 70.85pt;
+	mso-header-margin:35.4pt;
+	mso-footer-margin:35.4pt;
+	mso-paper-source:0;}
+div.Section1
+	{page:Section1;}
+-->
+</style>
+<!--[if gte mso 10]>
+<style>
+ /* Style Definitions */
+ table.MsoNormalTable
+	{mso-style-name:"Normale Tabelle";
+	mso-tstyle-rowband-size:0;
+	mso-tstyle-colband-size:0;
+	mso-style-noshow:yes;
+	mso-style-parent:"";
+	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
+	mso-para-margin:0cm;
+	mso-para-margin-bottom:.0001pt;
+	mso-pagination:widow-orphan;
+	font-size:10.0pt;
+	font-family:"Times New Roman";}
+</style>
+<![endif]--><!--[if gte mso 9]><xml>
+ <o:shapedefaults v:ext="edit" spidmax="2050"/>
+</xml><![endif]--><!--[if gte mso 9]><xml>
+ <o:shapelayout v:ext="edit">
+  <o:idmap v:ext="edit" data="1"/>
+ </o:shapelayout></xml><![endif]-->
+</head>
+
+<body lang=DE style='tab-interval:35.4pt'>
+
+<div class=Section1>
+
+<p class=MsoNormal>In diesem Verzeichnis vorhandene .<span class=SpellE>png-Dateien</span>
+werden als alternative Symbole in den Cachewolf geladen.<o:p></o:p></p>
+
+<p class=MsoNormal>Dabei sollte es sich um <span class=SpellE>PNGs</span> der
+Gr??e 16x16 handeln oder kleiner.<o:p></o:p></p>
+
+<p class=MsoNormal>Auf der Karte werden auch <span class=SpellE>gr?ssere</span>
+Symbole angezeigt, falls sie existieren und der Dateiname auf <span
+class=SpellE>size</span> endet.<o:p></o:p></p>
+
+<p class=MsoNormal>Es m?ssen nur die Dateien erstellt werden, die ersetzt
+werden sollen.<o:p></o:p></p>
+
+<p class=MsoNormal>Ist keine entsprechende Datei vorhanden, wird das
+Cachewolf-interne Symbol beibehalten.<o:p></o:p></p>
+
+<p class=MsoNormal><o:p>&nbsp;</o:p></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>.<span
+class=SpellE>png</span>-files in this directory will be loaded as customized
+symbols into <span class=SpellE>Cachewolf</span>.<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>They're
+supposed to be 16x16 <span class=SpellE>PNGs</span> or less.<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>On the map
+larger symbols are shown, if they exist and the filename ends on size.<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>Incorrectly
+named files will be ignored.<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>You only
+have to create images for those symbols you want customized.<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>For symbols
+without corresponding file the <span class=SpellE>buildt</span>-in symbol will
+be maintained.<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
+
+<p class=MsoNormal>Zuordnung der Dateinamen/<span class=SpellE>filename</span> <span
+class=SpellE>assignment</span>:<o:p></o:p></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>---------------------------------------------<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>0.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+Custom<o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>1.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+APE (&quot;Project APE Cache&quot;)<o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>2.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+CITO<o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>3.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> - <span
+class=SpellE>Drive_In</span><o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>4.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> - <span
+class=SpellE>Earthcache</span><o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>5.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+Event<o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>6.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+Final<o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>7.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+Letterbox<o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>8.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> - <span
+class=SpellE>Locationless</span><o:p></o:p></span></p>
+
+<p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
+EN-GB'>9.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+Maze (&quot;Adventure Maze Exhibit&quot;)<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>10<span
+class=GramE>.png</span> - <span class=SpellE>Megaevent</span><o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>11<span
+class=GramE>.png</span> - Multi<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>12<span
+class=GramE>.png</span> - Parking<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>13<span
+class=GramE>.png</span> - Question<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>14<span
+class=GramE>.png</span> - Reference<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>15<span
+class=GramE>.png</span> - Stage<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>16<span
+class=GramE>.png</span> - Traditional<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>17<span
+class=GramE>.png</span> - Trailhead<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>18<span
+class=GramE>.png</span> - Unknown<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>19<span
+class=GramE>.png</span> - Virtual<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>20<span
+class=GramE>.png</span> - Webcam<o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>21<span
+class=GramE>.png</span> - <span class=SpellE>Wherigo</span><o:p></o:p></span></p>
+
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
+
+</div>
+
+</body>
+
+</html>

Modified: trunk/res_noewe/symbols/readme.txt
===================================================================
--- trunk/res_noewe/symbols/readme.txt	2009-10-23 18:22:00 UTC (rev 2303)
+++ trunk/res_noewe/symbols/readme.txt	2009-10-23 21:18:54 UTC (rev 2304)
@@ -1,7 +1,7 @@
 In diesem Verzeichnis vorhandene .png-Dateien werden als alternative Symbole in den Cachewolf geladen.
-Dabei sollte es sich um PNGs der Gr??e 16x16 handeln oder kleiner.
-Auf der Karte werden auch gr?ssere Symbole angezeigt, falls sie existieren und der Dateiname auf size endet.
-Es m?ssen nur die Dateien erstellt werden, die ersetzt werden sollen.
+Dabei sollte es sich um PNGs der Groesse 16x16 handeln oder kleiner.
+Auf der Karte werden auch groessere Symbole angezeigt, falls sie existieren und der Dateiname auf size endet.
+Es muessen nur die Dateien erstellt werden, die ersetzt werden sollen.
 Ist keine entsprechende Datei vorhanden, wird das Cachewolf-interne Symbol beibehalten.
 
 .png-files in this directory will be loaded as customized symbols into Cachewolf.
@@ -36,4 +36,6 @@
 18.png - Unknown
 19.png - Virtual
 20.png - Webcam
-21.png - Wherigo
\ No newline at end of file
+21.png - Wherigo
+
+



From araber95 at mail.berlios.de  Sat Oct 24 12:42:43 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 24 Oct 2009 12:42:43 +0200
Subject: [Cachewolf-svn] r2305 - in trunk: res_noewe/languages
	res_noewe/symbols src/CacheWolf
Message-ID: <200910241042.n9OAghs2016748@sheep.berlios.de>

Author: araber95
Date: 2009-10-24 12:42:31 +0200 (Sat, 24 Oct 2009)
New Revision: 2305

Removed:
   trunk/res_noewe/symbols/readme.txt
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/symbols/readme.htm
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
Log:
use own symbols only if checked in preferences.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-24 10:42:31 UTC (rev 2305)
@@ -251,6 +251,7 @@
 		646=akt. Zentrum aus GPS
 		647=Sortierung nach Cache gruppiert
 		648=Fehlersuch Modus (debug)
+		649=Nutze eigene Symbole (nach Neustart)
 		700=Filter setzen
 		701=Entfernung
 		702=Schwierigkeit

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-24 10:42:31 UTC (rev 2305)
@@ -251,6 +251,7 @@
 		646=cur.centre from GPS
 		647=cachegrouped sorting
 		648=Debug Mode
+		649=use own symbols
 		700=Set filter
 		701=Distance
 		702=Difficulty

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-24 10:42:31 UTC (rev 2305)
@@ -249,6 +249,7 @@
 		646=Centre actuel du GPS
 		647=[cachegrouped sorting]
 		648=[Debug Mode]
+		649=[use own symbols]
 		700=Cr%e9er filtre
 		701=Distance
 		702=Dificult%e9

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-24 10:42:31 UTC (rev 2305)
@@ -243,6 +243,7 @@
 		646=[cur.centre from GPS]
 		647=[cachegrouped sorting]
 		648=[Debug Mode]
+		649=[use own symbols]
 		700=Selecteer filter
 		701=Afstand
 		702=Moeilijkheidsgraad

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-24 10:42:31 UTC (rev 2305)
@@ -251,6 +251,7 @@
 		646=[cur.centre from GPS]
 		647=[cachegrouped sorting]
 		648=[Debug Mode]
+		649=[use own symbols]
                 700=Ustaw filtr
                 701=Odleglosc
                 702=Trudnosc

Modified: trunk/res_noewe/symbols/readme.htm
===================================================================
--- trunk/res_noewe/symbols/readme.htm	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/res_noewe/symbols/readme.htm	2009-10-24 10:42:31 UTC (rev 2305)
@@ -14,16 +14,16 @@
  <o:DocumentProperties>
   <o:Author>.</o:Author>
   <o:LastAuthor>.</o:LastAuthor>
-  <o:Revision>1</o:Revision>
+  <o:Revision>2</o:Revision>
   <o:Created>2009-10-23T21:05:00Z</o:Created>
-  <o:LastSaved>2009-10-23T21:07:00Z</o:LastSaved>
+  <o:LastSaved>2009-10-24T10:40:00Z</o:LastSaved>
   <o:Pages>1</o:Pages>
-  <o:Words>184</o:Words>
-  <o:Characters>1163</o:Characters>
+  <o:Words>196</o:Words>
+  <o:Characters>1237</o:Characters>
   <o:Company>CF Computer</o:Company>
-  <o:Lines>9</o:Lines>
+  <o:Lines>10</o:Lines>
   <o:Paragraphs>2</o:Paragraphs>
-  <o:CharactersWithSpaces>1345</o:CharactersWithSpaces>
+  <o:CharactersWithSpaces>1431</o:CharactersWithSpaces>
   <o:Version>10.6856</o:Version>
  </o:DocumentProperties>
 </xml><![endif]--><!--[if gte mso 9]><xml>
@@ -84,7 +84,7 @@
 	font-family:"Times New Roman";}
 </style>
 <![endif]--><!--[if gte mso 9]><xml>
- <o:shapedefaults v:ext="edit" spidmax="2050"/>
+ <o:shapedefaults v:ext="edit" spidmax="3074"/>
 </xml><![endif]--><!--[if gte mso 9]><xml>
  <o:shapelayout v:ext="edit">
   <o:idmap v:ext="edit" data="1"/>
@@ -96,26 +96,28 @@
 <div class=Section1>
 
 <p class=MsoNormal>In diesem Verzeichnis vorhandene .<span class=SpellE>png-Dateien</span>
-werden als alternative Symbole in den Cachewolf geladen.<o:p></o:p></p>
+werden als alternative Symbole in den Cachewolf geladen, falls in den
+Einstellungen/Tab mehr eingeschaltet.</p>
 
 <p class=MsoNormal>Dabei sollte es sich um <span class=SpellE>PNGs</span> der
-Gr??e 16x16 handeln oder kleiner.<o:p></o:p></p>
+Gr??e 16x16 handeln oder kleiner.</p>
 
 <p class=MsoNormal>Auf der Karte werden auch <span class=SpellE>gr?ssere</span>
 Symbole angezeigt, falls sie existieren und der Dateiname auf <span
-class=SpellE>size</span> endet.<o:p></o:p></p>
+class=SpellE>size</span> endet.</p>
 
 <p class=MsoNormal>Es m?ssen nur die Dateien erstellt werden, die ersetzt
-werden sollen.<o:p></o:p></p>
+werden sollen.</p>
 
 <p class=MsoNormal>Ist keine entsprechende Datei vorhanden, wird das
-Cachewolf-interne Symbol beibehalten.<o:p></o:p></p>
+Cachewolf-interne Symbol beibehalten.</p>
 
 <p class=MsoNormal><o:p>&nbsp;</o:p></p>
 
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>.<span
 class=SpellE>png</span>-files in this directory will be loaded as customized
-symbols into <span class=SpellE>Cachewolf</span>.<o:p></o:p></span></p>
+symbols into <span class=SpellE>Cachewolf</span> if checked in preferences tab
+more.<o:p></o:p></span></p>
 
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>They're
 supposed to be 16x16 <span class=SpellE>PNGs</span> or less.<o:p></o:p></span></p>
@@ -138,7 +140,7 @@
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
 
 <p class=MsoNormal>Zuordnung der Dateinamen/<span class=SpellE>filename</span> <span
-class=SpellE>assignment</span>:<o:p></o:p></p>
+class=SpellE>assignment</span>:</p>
 
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>---------------------------------------------<o:p></o:p></span></p>
 
@@ -149,8 +151,8 @@
 Custom<o:p></o:p></span></p>
 
 <p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
-EN-GB'>1.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
-APE (&quot;Project APE Cache&quot;)<o:p></o:p></span></p>
+EN-GB'>1.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> - APE
+(&quot;Project APE Cache&quot;)<o:p></o:p></span></p>
 
 <p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
 EN-GB'>2.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -

Deleted: trunk/res_noewe/symbols/readme.txt
===================================================================
--- trunk/res_noewe/symbols/readme.txt	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/res_noewe/symbols/readme.txt	2009-10-24 10:42:31 UTC (rev 2305)
@@ -1,41 +0,0 @@
-In diesem Verzeichnis vorhandene .png-Dateien werden als alternative Symbole in den Cachewolf geladen.
-Dabei sollte es sich um PNGs der Groesse 16x16 handeln oder kleiner.
-Auf der Karte werden auch groessere Symbole angezeigt, falls sie existieren und der Dateiname auf size endet.
-Es muessen nur die Dateien erstellt werden, die ersetzt werden sollen.
-Ist keine entsprechende Datei vorhanden, wird das Cachewolf-interne Symbol beibehalten.
-
-.png-files in this directory will be loaded as customized symbols into Cachewolf.
-They're supposed to be 16x16 PNGs or less.
-On the map larger symbols are shown, if they exist and the filename ends on size.
-Incorrectly named files will be ignored.
-You only have to create images for those symbols you want customized.
-For symbols without corresponding file the buildt-in symbol will be maintained.
-
-
-Zuordnung der Dateinamen/filename assignment:
----------------------------------------------
-
-0.png - Custom
-1.png - APE ("Project APE Cache")
-2.png - CITO
-3.png - Drive_In
-4.png - Earthcache
-5.png - Event
-6.png - Final
-7.png - Letterbox
-8.png - Locationless
-9.png - Maze ("Adventure Maze Exhibit")
-10.png - Megaevent
-11.png - Multi
-12.png - Parking
-13.png - Question
-14.png - Reference
-15.png - Stage
-16.png - Traditional
-17.png - Trailhead
-18.png - Unknown
-19.png - Virtual
-20.png - Webcam
-21.png - Wherigo
-
-

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/src/CacheWolf/MainForm.java	2009-10-24 10:42:31 UTC (rev 2305)
@@ -82,7 +82,7 @@
 
 
 			// Replace buildt-in symbols with customized images
-			GuiImageBroker.customizedSymbols();
+			if (pref.useOwnSymbols) GuiImageBroker.customizedSymbols();
 
 			// Load CacheList
 			infB = new InfoBox("CacheWolf",MyLocale.getMsg(5000,"Loading Cache-List"));

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/src/CacheWolf/Preferences.java	2009-10-24 10:42:31 UTC (rev 2305)
@@ -122,7 +122,7 @@
 	/** If true, the last profile is reloaded automatically without a dialogue */
 	public boolean autoReloadLastProfile=false;
 	/** If true current cetre will be set from gps position	 */
-	public boolean setCurrentCentreFromGPSPosition=false;
+	public boolean setCurrentCentreFromGPSPosition=true;
 	/** This is the login alias for geocaching.com and opencaching.de */
 	public String myAlias = "";
 	/** Optional password */
@@ -258,6 +258,9 @@
 
     /** SortingGroupedByCache */
     public boolean SortingGroupedByCache=true;
+    
+    /** useOwnSymbols */
+    public boolean useOwnSymbols=true;
 
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
@@ -402,14 +405,13 @@
 			if (atts.getValue("autoreload").equals("true")) autoReloadLastProfile=true;
 		}
 		else if (name.equals("CurrentCentre")) {
-			if (atts.getValue("FromGPSPosition").toLowerCase().equals("true")) setCurrentCentreFromGPSPosition=true;
+			setCurrentCentreFromGPSPosition=Boolean.valueOf(atts.getValue("FromGPSPosition")).booleanValue();
 		}
 		else if(name.equals("basedir")) {
 			setBaseDir(atts.getValue("dir"));
 		}
 		else if (name.equals("opencaching")) {
 			downloadmissingOC = Boolean.valueOf(atts.getValue("downloadmissing")).booleanValue();
-
 		}
 		else if (name.equals("listview")) {
 			listColMap=atts.getValue("colmap");
@@ -580,6 +582,9 @@
 			tmp = atts.getValue("on");
 			SortingGroupedByCache = tmp != null && tmp.equalsIgnoreCase("true");
 		}
+		else if (name.equals("Symbols")) {
+			useOwnSymbols=Boolean.valueOf(atts.getValue("useOwnSymbols")).booleanValue();
+		}
 	}
 
 	public void characters( char ch[], int start, int length ) {
@@ -614,7 +619,7 @@
 			outp.print("    <locale language=\"" + SafeXML.clean(language) + "\"/>\n");
 			outp.print("    <basedir dir = \"" + SafeXML.clean(getBaseDir()) + "\"/>\n");
 			outp.print("    <lastprofile autoreload=\"" + SafeXML.strxmlencode(autoReloadLastProfile) + "\">" + SafeXML.clean(lastProfile) + "</lastprofile>\n"); //RB
-			outp.print("    <CurrentCentre FromGPSPosition= \"" + SafeXML.clean(Convert.toString(setCurrentCentreFromGPSPosition)) + "\"/>\n");
+			outp.print("    <CurrentCentre FromGPSPosition=\"" + SafeXML.clean(Convert.toString(setCurrentCentreFromGPSPosition)) + "\"/>\n");
 			outp.print("    <alias name =\""+ SafeXML.clean(myAlias) +"\" password=\""+SafeXML.clean(password)+"\" />\n");
 			outp.print("    <alias2 name =\""+ SafeXML.clean(myAlias2) +"\"/>\n");
 			outp.print("    <gcmemberid name =\""+ SafeXML.clean(gcMemberId) +"\"/>\n");
@@ -669,6 +674,7 @@
 			outp.print("    <mapLoader tileSize=\""+SafeXML.strxmlencode(mapTileSize)+"\" overlapping=\""+SafeXML.strxmlencode(mapOverlapping)+"\"/>\n");
 			outp.print("    <showCachesOnMap on=\""+SafeXML.strxmlencode(showCachesOnMap)+"\"/>\n");
 			outp.print("    <SortingGroupedByCache on=\""+SafeXML.strxmlencode(SortingGroupedByCache)+"\"/>\n");
+			outp.print("    <Symbols useOwnSymbols=\"" + SafeXML.strxmlencode(useOwnSymbols) + "\"/>\n");
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2009-10-23 21:18:54 UTC (rev 2304)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2009-10-24 10:42:31 UTC (rev 2305)
@@ -22,7 +22,7 @@
 	       inpLogsPerPage,inpMaxLogsToSpider,inpPassword;
 	mCheckBox chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, chkTabsAtTop, chkShowStatus,chkHasCloseButton,
 	          chkSynthShort,chkProxyActive, chkDescShowImg, chkAddDetailsToWaypoint, chkAddDetailsToName, 
-	          chkSetCurrentCentreFromGPSPosition,chkSortingGroupedByCache,chkDebug;
+	          chkSetCurrentCentreFromGPSPosition,chkSortingGroupedByCache,chkuseOwnSymbols,chkDebug;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
 	mLabel lblGarmin;
@@ -228,6 +228,8 @@
 		pnlMore.addLast(inpMetric=new mChoice(metriken, currMetrik),DONTSTRETCH,DONTFILL|WEST);
 		pnlMore.addLast(chkSortingGroupedByCache=new mCheckBox(MyLocale.getMsg(647,"Sorting grouped by Cache")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));	
 		chkSortingGroupedByCache.setState(pref.SortingGroupedByCache);
+		pnlMore.addLast(chkuseOwnSymbols=new mCheckBox(MyLocale.getMsg(649,"use own symbols")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));	
+		chkuseOwnSymbols.setState(pref.useOwnSymbols);
 		pnlMore.addLast(chkDebug=new mCheckBox(MyLocale.getMsg(648,"Debug Mode")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));	
 		chkDebug.setState(pref.debug);
 
@@ -336,6 +338,7 @@
 				pref.addDetailsToWaypoint = chkAddDetailsToWaypoint.getState();
 				pref.addDetailsToName = chkAddDetailsToName.getState();
 				pref.SortingGroupedByCache=chkSortingGroupedByCache.getState();
+				pref.useOwnSymbols=chkuseOwnSymbols.getState();
 				pref.debug=chkDebug.getState();
 
 				pref.savePreferences();



From araber95 at mail.berlios.de  Sat Oct 24 14:32:25 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 24 Oct 2009 14:32:25 +0200
Subject: [Cachewolf-svn] r2306 - in trunk/res_noewe/symbols: . z.B.big
	z.B.small
Message-ID: <200910241232.n9OCWP8V007098@sheep.berlios.de>

Author: araber95
Date: 2009-10-24 14:32:04 +0200 (Sat, 24 Oct 2009)
New Revision: 2306

Added:
   trunk/res_noewe/symbols/z.B.big/
   trunk/res_noewe/symbols/z.B.big/10size.png
   trunk/res_noewe/symbols/z.B.big/11size.png
   trunk/res_noewe/symbols/z.B.big/12size.png
   trunk/res_noewe/symbols/z.B.big/13size.png
   trunk/res_noewe/symbols/z.B.big/14size.png
   trunk/res_noewe/symbols/z.B.big/15size.png
   trunk/res_noewe/symbols/z.B.big/16size.png
   trunk/res_noewe/symbols/z.B.big/17size.png
   trunk/res_noewe/symbols/z.B.big/18size.png
   trunk/res_noewe/symbols/z.B.big/19size.png
   trunk/res_noewe/symbols/z.B.big/20size.png
   trunk/res_noewe/symbols/z.B.big/21size.png
   trunk/res_noewe/symbols/z.B.big/2size.png
   trunk/res_noewe/symbols/z.B.big/4size.png
   trunk/res_noewe/symbols/z.B.big/5size.png
   trunk/res_noewe/symbols/z.B.big/6size.png
   trunk/res_noewe/symbols/z.B.big/7size.png
   trunk/res_noewe/symbols/z.B.big/8size.png
   trunk/res_noewe/symbols/z.B.small/
   trunk/res_noewe/symbols/z.B.small/11.png
   trunk/res_noewe/symbols/z.B.small/12.png
   trunk/res_noewe/symbols/z.B.small/13.png
   trunk/res_noewe/symbols/z.B.small/14.png
   trunk/res_noewe/symbols/z.B.small/15.png
   trunk/res_noewe/symbols/z.B.small/16.png
   trunk/res_noewe/symbols/z.B.small/17.png
   trunk/res_noewe/symbols/z.B.small/18.png
   trunk/res_noewe/symbols/z.B.small/6.png
Removed:
   trunk/res_noewe/symbols/10size.PNG
   trunk/res_noewe/symbols/11.png
   trunk/res_noewe/symbols/11size.png
   trunk/res_noewe/symbols/12.PNG
   trunk/res_noewe/symbols/12size.PNG
   trunk/res_noewe/symbols/13.PNG
   trunk/res_noewe/symbols/13size.PNG
   trunk/res_noewe/symbols/14.PNG
   trunk/res_noewe/symbols/14size.PNG
   trunk/res_noewe/symbols/15.PNG
   trunk/res_noewe/symbols/15size.PNG
   trunk/res_noewe/symbols/16.png
   trunk/res_noewe/symbols/16size.png
   trunk/res_noewe/symbols/17.PNG
   trunk/res_noewe/symbols/17size.PNG
   trunk/res_noewe/symbols/18.png
   trunk/res_noewe/symbols/18size.png
   trunk/res_noewe/symbols/19size.png
   trunk/res_noewe/symbols/20size.png
   trunk/res_noewe/symbols/21size.PNG
   trunk/res_noewe/symbols/2size.PNG
   trunk/res_noewe/symbols/4size.png
   trunk/res_noewe/symbols/5size.png
   trunk/res_noewe/symbols/6.PNG
   trunk/res_noewe/symbols/6size.PNG
   trunk/res_noewe/symbols/7size.PNG
   trunk/res_noewe/symbols/8size.PNG
Log:
don't overwrite the real custom symbols with those in the datfile

Deleted: trunk/res_noewe/symbols/10size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/11.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/11size.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/12.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/12size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/13.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/13size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/14.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/14size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/15.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/15size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/16.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/16size.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/17.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/17size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/18.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/18size.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/19size.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/20size.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/21size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/2size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/4size.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/5size.png
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/6.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/6size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/7size.PNG
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/symbols/8size.PNG
===================================================================
(Binary files differ)

Added: trunk/res_noewe/symbols/z.B.big/10size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/10size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/11size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/11size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/12size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/12size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/13size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/13size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/14size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/14size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/15size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/15size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/16size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/16size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/17size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/17size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/18size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/18size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/19size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/19size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/20size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/20size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/21size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/21size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/2size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/2size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/4size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/4size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/5size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/5size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/6size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/6size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/7size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/7size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.big/8size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.big/8size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/11.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/11.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/12.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/12.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/13.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/13.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/14.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/14.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/15.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/15.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/16.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/16.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/17.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/17.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/18.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/18.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/z.B.small/6.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/z.B.small/6.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From araber95 at mail.berlios.de  Sun Oct 25 19:47:46 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 25 Oct 2009 19:47:46 +0100
Subject: [Cachewolf-svn] r2307 - in trunk: docs res_noewe/exporticons
	res_noewe/exporticons/exporticons
Message-ID: <200910251847.n9PIlkci028567@sheep.berlios.de>

Author: araber95
Date: 2009-10-25 19:47:33 +0100 (Sun, 25 Oct 2009)
New Revision: 2307

Added:
   trunk/res_noewe/exporticons/exporticons/
   trunk/res_noewe/exporticons/exporticons/Garmin.zip
   trunk/res_noewe/exporticons/exporticons/Glopus.zip
   trunk/res_noewe/exporticons/exporticons/GoogleEarth.zip
   trunk/res_noewe/exporticons/exporticons/TomTom.zip
Removed:
   trunk/docs/eigene Cachesymbole.txt
   trunk/res_noewe/exporticons/Garmin.zip
   trunk/res_noewe/exporticons/Glopus.zip
   trunk/res_noewe/exporticons/GoogleEarth.zip
   trunk/res_noewe/exporticons/TomTom.zip
Log:
tuneup structure

Deleted: trunk/docs/eigene Cachesymbole.txt
===================================================================
--- trunk/docs/eigene Cachesymbole.txt	2009-10-24 12:32:04 UTC (rev 2306)
+++ trunk/docs/eigene Cachesymbole.txt	2009-10-25 18:47:33 UTC (rev 2307)
@@ -1,42 +0,0 @@
-Seit Rev 1893 (und somit auch mit dem aktuelle Nightly Build) kann man in Cachewolf eigene Symbole f?r Caches, Wegpunkte usw. verwenden. 
-Das funktioniert wie folgt:
-1. Im Cachewolf-Programmverzeichnis ein Unterverzeichnis "symbols" anlegen (Achtung, Gro?-/Kleinschreibung beachten!!!).
-2. In diesem Verzeichnis 15x15 PNG-Dateien f?r die Symbole speichern. 
-Die Benennung der Dateien folgt dabei einem bestimmten Schema (s.u.). 
-Man kann alle Symbole ersetzen oder aber auch nur bestimmte, ganz wie man m?chte.
-3. Cachwolf starten und sich an den neuen Symbolen erfreuen.
-4. Sollten einem die buildt-in-Symbole dann doch besser gefallen, das "symbols"-Verzeichnis einfach wieder l?schen und fertig.
-
-Wer es mal schnell ausprobieren m?chte, ohne sich gleich eigene Bilder zu basteln, sollte mal hier schauen:
-http://www.geoclub.de/viewtopic.php?p=341097#p341097
-Da hat blackeye501 vor einiger Zeit schon mal alternative Symbole ver?ffentlicht, die man nun benutzen kann.
-Aber Vorsicht: Nicht die Dateinamen von blackeye501 ?bernehmen, die m?ssen gem?? der untenstehenden Liste angepasst werden!
-
-Feedback, Fragen, Probleme dazu gerne in diesem Thread:
-http://www.geoclub.de/viewtopic.php?f=40&t=35056
-Und wer einen sch?nen Satz Symbole kreiert hat und sie teilen m?chte, kann das auch gerne hier machen. 
-
-So jetzt aber noch das wichtigsten, die Namenskonventionen f?r die verschiedenen Cachetypen:
-
-0.png - Custom
-1.png - APE ("Project APE Cache")
-2.png - CITO
-3.png - Drive_In
-4.png - Earthcache
-5.png - Event
-6.png - Final
-7.png - Letterbox
-8.png - Locationless
-9.png - Maze ("Adventure Maze Exhibit")
-10.png - Megaevent
-11.png - Multi
-12.png - Parking
-13.png - Question
-14.png - Reference
-15.png - Stage
-16.png - Traditional
-17.png - Trailhead
-18.png - Unknown
-19.png - Virtual
-20.png - Webcam
-21.png - Wherigo

Deleted: trunk/res_noewe/exporticons/Garmin.zip
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/exporticons/Glopus.zip
===================================================================
--- trunk/res_noewe/exporticons/Glopus.zip	2009-10-24 12:32:04 UTC (rev 2306)
+++ trunk/res_noewe/exporticons/Glopus.zip	2009-10-25 18:47:33 UTC (rev 2307)
@@ -1,62 +0,0 @@
-PK
-8?}?????4?Q?#??
-??T?C?8D??H??0?6<C?'M?1N???<]!?q??g??|i ?$???b?~??.?"?D`j???,???u??2?\K???8])?S??8OTyu?)4?q?#???lj??#@LM?P?saLh??&?`?p???D??}??:M???/f??c??M??}a??#??!M????4?@??8??B????? ?c3%??Y/k-WR8?I?$,6?m???f?b??%?uz
-??:??
-?B??T_???E0??x,??;??(~[???5????Y?/_??ykP??G=F59??J6j?? ?T?h?"??????$X?6b??'??P???i?{U??]??????I!V]Eby?L??e?????V\X?wTG?4<O?@1uj?Wh?:t?h?k?K?O_?^?^oj??JB%?Fm?
-?)?_?????h??????C?k????????????O?_Le'??????m??Gl{4?-??????s/sokj(?]:????z?????G??mn<7??-??ia;??M?#_?o?7o????f?mgN}??5??????m???
->z*???????g?w??????<[*????|???7??p????[???5aY????7??n|??h?????????N??O?G??????n?~??WB?????z??Z??=?????l???<?DWW`O??????????;b?/t???z*??c??\?{????[?k?kh????D????L??????w???{"L??'?]?H??:?????????v??}?PK
-?R*?QY???[M???E?E{??^?^????e?EB????,???f1E?h?3?.c??y??|?s???.?????9???X??????V??S?0???hB??????U???ZT\T?????	`Fp?7??#??Dp?gK???c;?M????\,_K??
-??ik??n??~?h;wC???NcL?????n?ig?GG???z?bjk????A??{8??>?)????????=aI1??;??@?l???Q??D????L?,k?G?8IP?+qZ???P$R?X?~,Y?????n??V;?????c????q???4(?`?X????f??F???%?n=>%???????h"??8{??Z?G?*?)iX?X?t?j,c??S?????A?Q???0Y?????[???;?q at 8???x?|?j??a????-??W?Z????h?!?????r?O	t??????s??n)YD?
-???L?H??ZU/r??????}?+x?$???????H??/J??	t>!z??f??V??N?x]s=??d?S)?????".?#/?^?ijfKe#??????Q\\?J???????-Z?R?D&?a``@]????u???/??h???cdd???8%?#ol????H???????|??dl????f?MH????w1z/??4Qs?[?????*?????"w ???\G??????S???y????K?>f????a??_-???{??-???????+?EO??*++?v??vt?T????*??}???57N??^6"}l[?{??zg??????x|????5D?????]c????????I?6"??u?^S}}??????? ????~???+????WOn?J?a???iiA?????????w?o????"Opp<Z???_??T??9???7,?#v?????????zy?z?vM????"5????????}??}???E?m?:n??V?t?????oj?b???GJs?7???7??u??m=y?????PK
-MIX?FM-B+????jLIa??6??E?IHBBH????>@??a?}??y??s????6?p??Z{?B??????????\????Q?j^X??(??8???Px?x?sw ?C?a]?N?F?z???????y??@?7*9	???a??Z?4J$?u?`o?{?????z?=W?^'F:Y??H?"??n\R?*??????pO;?#|l????>?l?(?o?G??E?V?4??a?'?)?8?&??d@>???????????? ?OM??????t?'?F?,?B??AA?H?`???	??????
-?J5hh?GS?2???&tt?p??z{-???^o?N7???ev?fIN???????? ?X?V????l6cppF????8 at r????j5T??]]]????B?@[[?r9ZI?2*??f466B"?@,???UUU???DEE???QZZ???b???BH?#??Gff&?[:8RRR_????\]]???U???K?UW????;?o?]aY?gjv'?[?O?AO?;?iT?????3???4???,_???<i???????F{/????????????DG?e?{?DWP??g_Y#?R:????|>??\??`d?R:?K?????W??	"??J???|????{V??	_f.*?+?)???G?FZ2;?<???t&??)??n???{?E??Bh????m?????-A E[6???7???????zb????????????????|????=????????K?<??Mo?q?]w?_???Y9y????p?/PK
-?B|?jF?u?g?fz?3??;t(??o/,?dg???/????NV??b.?~
-p?+LF=p??i???(?A???C0	i??E??UB?y???????RAM???A%S0:?-4??0E.????E?0??iNV??9?E???E?t??G?|U????M8	?H?????
-??i??/.?,?1s?&?)al	e,Q~hP?M?E.?]&?S0?a????px	OXMo,?X???qF}pYB???=??OzOC?3K?3??z?????g?S=&h?_?}??k??W???Ps3????$m?f??4?$I!eEs4??(???2???Z??w??by??OU??oq???F??U???????????|??}?Y?*?3????????????=?????????Z??????k??????^?????|?3?2???T2?????????m??ag??N??;????h???????7?GX????j?__??????N?2v??]???t????????9?|??????~???<~t?????<?+?k/LNF????g?????k?_?+??w?PK
-?????????E,,,`~~sss?????????155???ILLL`||ccc??????144???A???}}}???EOO?????????Nttt???mmmhmmEKK?????????F444???uuu???EMM???QUU???JTTT???eee?X,(--EII	???QTT???B ??yyy???ENN?????????????l6?d2!99F??z?:?Z??			P??P?TP*?????B??\.?L&Cll,?R)$	?b1D"?B!bbb ????????r??p6?????(0?L0??t?h4???!$$????R??P(??;?3?]?5%+1??????#?Uzj?{?(??E;?H?K9?i?q????;>M?{?3ThT8?9?f?????? ??q?Ab?1b???2????I^????H?Y}/?????y?j
-?x;#???????/\?#???????????qRtt??KKR?\?????R?:#?????}t?????G???.?>?~+??Y?	??'??k?O???k?1%^?Mu?{???o?O?????_PK
-? 
-a*??????@+?3?Jh?I?E???-4z?d?e?e??*?Y?v?]??r??????K??|??????Q{????g?????x?y??xC?B??????K/HH????t?*5DAa??
-?P?pJ????!???&????$?<zT?d-?????
-9lrT??
-?????????????/W?????
-???KW??7n?O,???gfn]?0??o{A?\K??????|??8?
-NF??8d?4B???+?GE????y??E}??|?S??@??k?k?T?	I????BF?0M?sc???U???????M????&???2?L?PK??CG?h?:_?>M?`;6??''?????5???3'?I?r_NNY?????\? +*????w???0?e???3?????9?>??i%??ktid?a?+?g?!t?]?P?D?{?	XVJK8?9W8???[????~F?M????7?\???F??????1?GQ??Y?x?e_r2??C>?{q?xq&??Yal?Z4jV?(
-??y6ej?x???w??1?G?Q>6^?h??i?>Yo?????C??>????LL???;??w?|???????Y?h?????6??????y??'V??????????y[?G?:R'^????????W??????????~98|????^?????s?gon?9????#??Kf?Y3??O/M??U???[?????^????}?;??><??]#?<b_0o???t?'???5????????=??\y??????6?u?;:gnm?7???x??:~?:?l?T
-???h?????Ew????????uk?.+??^?w?]w,???w?}KV?|pY????R?V.V?,]?b?????-??g??7,???????{???q
-?PK
-a?B?M.??|\?Y??g??2????T??T?=2Lxf??S??T=^B??{Tn??H?
-<????I?pT^?~??O?74?{5???%h??>??5#????
-??*???????B^?~J$pu???=?;?<???hg???k??~?;????>Hl?????h?|?u?p??????Sa???u$&%?Z?????n????d??o"/?+U???Ry]??[?L?{????I	/????a????h.y7???3g?moWn???~???????7?8q4??&??????z?????H?????P??]???]???_PK
-v#? ?Y???}?x/????IlH,$????????????1?6??f?{-???x????^/????0g?`a????a?N?????!???{??nK??=??????a?I	?R???	l?H??T?A?74??*+???CWW??r:??D?H?@y'???X??xY??<+?R??G?J(?O?????D??>?X??=x???aB??]?? mY??R??V?[???d?#'?E0??VU?vQ&?]S>??h?????A[%G???:-??V????0?K]?k.??????n?i?d???8666????????5D?QD"???`yy?p?P?`?@
-Y'@V???:?????>??8?~Y7B????=?"??'y(N?>4???Z??\?3???? ?D??U???????u	???!c??B5???3???|???\?|??>u???a?_????PUv?/=??e???Y?Pk??JI^?-{Po?0???|??>-???[??S??f??X???'???a???????Kj?f[???}k?o?5tZ9?qh??????e?E??????wG;;O???????
-~?B?q?????????w5???tO?????G?lH7??|??w????????????,_??2><08?U???????J?X??}????????^?n??????ux>????C?3?tdd??`??y^p?PK
-k??IZ?c E]?P??T?????5??A?YL????!n?H0?8?Iz??)?1?3??????7?{~Z
-m????z{????d?&?OS_???`f?4A??xu:?R_???26????.x???f3]v.?{??-?QE_?sj??$?Lx3??p?;????????????????`e1~???????????;p_I???Ww??jm???-+;4r{????????-|n????j??!???~?i?u[???N????D??g??M%???z?u?Hy}$?l?W??:????C?X4:V???Qy?Q??<{??n?|3?h>}#??X?????	??R??Rw?????9yD??????g?_|;?>??khb?i???h>m???u-..>??T?W?O.,\????P?^Y????O????????=?%?mf???q7?PK
-?? q??J?0???Qy9?X{??:?E:n4?x?4?YP?@????#?V????4??)??@?M@?8??\0??!?O?	?2axi????rV$?9???u??c"??A?Y?pd????SP????J?	/nv?B?F??!`?-??C?Q?????	PJSP_-D?Z ?h??A88?h"?&""h???	?K??=????(????8RA<TrDW??Or?n?????7g?.??J?L?????pP?(@Yi?6
-NC?????
-i2j*??????? p???
-Y(??B&N?T??()?@?'???
-r???? 9QW??B^
-ri???PVr ??P???X?Da?"&T?\??I?@Xr???i?\?Ri**s?????k?P???m?????p?(tk?`w??3j????@ia???t;@?)?Mz??vXil4M?????R6XlV??NH??t?L?`r?`'?? ??\n?s??????????!?>7??%y???i,6?]N?????Iv??@o??`v?Fv?d????
-??A?
-A@?"????r?i?L?2m???+i-???\`??s?????o??????>????????ic?B???76???????,H>$k??N??+e?q_J???2D???y???
-?T??"?-$\.QJ?????iT? d?,#)??W??d?h6???n??-???HW?U???<GF???a?Y??CF5?J??<?|Dp?????b]Z)?q`:>??? ?Pm??:?b??$?4,?nH9??\d4???P???K?"???gS??t??%?&?5???8?d??????PI?09L????w
-'=????TOz(b?!yg?Jo????S???P??*???TA?!??@!?Z?|???X??S??yeu????N???????;?\n????::???m:?L?7?????]g?2?v?@?qe???yn??o?l??#[???%???????V7???-????????o6y????s??t?/?t6??}MM??k}0Q(N=?N???}???q????????O_?????????????R~Y+??????QZ??x?????#f?????o??o???????+?Clg?gscsux??o?PK
-??L?D"!::?H???+?'???Z?T??WP?o??G?1o?}??u????'???QWq??9O??+|?????5??S?7:}???V???hQpH??N??^)~\???V)RS???_?????6=????|??N?????k????H??L?8(??R????[n??0??????3(?W???k???? 1??????>???p???L?x?T??????\[???L*K????wl?u9~?????_<???+??+?o????
-??
-MTS?iS1d??-?L?????s?????s7?????X~?????yf}????h.?K?N7313?????n&?''???MV?_O?=1?????#?O??*,c?q?S??(T?y^??&K?J?L)!X1?_Q=?U??U?hF?`MF#V?fl?????z?????/?T???Vdv`???q?iL??1Km?"W?yf3????*??U???
-??&|?Tl??&????&t???_?L??2???_b???]R%9X?T?W?(>'/(&Dy?c???Hh?a?+???%'Ku??
-y????(?15X?4c'?`??Q???N?%=??^?C?J??A?D5???{?Y?+?KZ?ghq+???w?1r?45??d???j?[XGpq???D+?#?T?*-F?%?F??j??u???a-?!C?k^?E??48?/ckv+>?^???}K?DM???}??VO?X?F?????}?M????V?7m8e?????~??7?\????8i'g??F?b??)??????{	??????kB?9????Q?B??>$???????{6
-?b??n?u(GktH?n?-??-U???{<????L???R???O?>t??!?c5?~Mz?uJ??lI?E?W??O??7u??v!????)??u?so????/?n?????h???KL??_???5???y/-??{?U??V;???n1??%???[?f%?y??z?Nz?[m8W}2?h??3??;}?s??/\????k!2e???Us?~hie????}V??gT?pb???L9#/N?~???o?-z??o??yI???E:?:`]?????y}J?????G?N???1}_Xf.x7??y???nk?{?
-?????Ug??????PK
-
-B``  ??????????B(????
-???????$L<~?sz?eE?1??[??a-??????=$m^{?]?65?g?????????o????w?y?m???????W?_?c?MR.??_d???'????||ITx/?O??I ?OYY????w??)%9?o^?<?
-??C]tR? 8?-??-MfD??H`?@@??5\??%?Sp?0?/??|???9????,?!???A?B?c??pd?%???{?{cgg?6???6?-?o6???p514*?????[??????VT?FQ,f3?d?.&??JT??A?s~~??x?q?????}}????==???mH%\????E"?????;w?0????9???bzj
-????!%9?Z-L????????677??????u???a?x???`yyKKKX\\????????%?333??????{r?||ccc??????144???A????Kj?!?www?????????@{{;?????????477???	???hhh@}}=???P[[??auu5???`?ZQi??dY^^???R??????????(((??dl2?`4??????<???"''????????`@ff&222?????????
-?Z???$?T*$$$@?T">>
-?r?????!???d???DDD?R)$?7???C(?QPP?b1D?O???
-? }??????/?|>???>>>?p8`??`?X??????'?L&<<<@?????7r?\]]???
-?ggg899????w?????:Wk??????S?:!??W?7Y?????R/]?)????AN?,+??t???M?????k?/?f??9q?=z?@)8??8??????K???O??????????v???r?????h????s?G("?????,}?_????9i??Q?<???3w?g?^?H?-?????????W
-+*??+???!??cz?=?B??DM??c?|????=!?Q??h??S????7?:[x=?8?A?_??/?;?'Y?`?I0?=??'i???>?F???;?[?	_J?c.????($??~???PK
\ No newline at end of file

Deleted: trunk/res_noewe/exporticons/GoogleEarth.zip
===================================================================
--- trunk/res_noewe/exporticons/GoogleEarth.zip	2009-10-24 12:32:04 UTC (rev 2306)
+++ trunk/res_noewe/exporticons/GoogleEarth.zip	2009-10-25 18:47:33 UTC (rev 2307)
@@ -1,183 +0,0 @@
-PK
-
-
-
-???-?=Du???:??(&??:?I?U?r)?Yp????%!x9|? ?@*??????/?Z}????????eP(????br????z???!???}??m?u?}????F?1Ad?'?B??????????)"%%?????R??SD??`??hP/??Tr$??d???????y?????????\?F#?
-?Z????????????Vv???UE?K?X?|?l??	?????K?#?x)8??\??????X??(?9?Q?"???n?Hi?
-???G
-$?{c=?????a???A?]?A??5p?z(?4?@??"?_^????W????????x??b?|???a?j?????:?.f???S|??p?ZX>
-????????}????n'_k?[??+y41?
-?%?'???3??#?U??j?q"?????cWC?pe?d????@I??3-_?.??~?{?????~3?~?N?N?4??v
-A_?mM???g1r?E??28?d(??	????i?9?=C???#????????y???&???b,?G+t????e???8???p$?[H??IH??=>???????C???????q???-;????d?j?/?p??E?v??\z????	????"???=??n9?T????4?O??nPm??????hn?F??A???????vW?d??z????? Q??B?W8?8%8E?)?N5PR????#?z????????&?S????UZb?/?????oi?U??!????O*?I?APTD?9&/m??4?K??5j???M?>?????TQ?Hy?:HJLvE&???`??"????9P??T^?????1????I3;?h??Wg?7g?Pc?W????????H~@??~u]?:(6HCy5j?Q?????:?8affH;?I7??G?:W???S*(??5R%?????j9_-????"??"??4kP$?O????;?M??_H??J??Q?????Py?Y?W?Hu????????{+??;Af;=?k&??U0={?A??1??.???>s??a:??Z?C??,r??@b??J?Tw?Y??????G?J?O???l???a??0??Va?_??R;???????5?};'??o|???F?U????????O??D?CXWbz?^(/?yf#.^/G???3??U?c?????t?????????R E&??
-'o???OK?<O?v??????#?JK???T??9?????????h.?Z???????w?????7|????)?6???O\?-+?j????vjP?S??4?48???	?E??KcNm[?leLG??G7J?z???G????s'Ag?m?
-n?lJJB?x?_??j??gY
-?????????|??!Y???EI9f%???X???e`??
-??fqL
-DVD&E??b??PL???T???=Ol_?C%g????8RkH??a!?????,
-????CO?????????Kl?Y???sw?m@??K?$?????$I???&{fN)I?@?K??1?????.8??sq??aI????/???=?????9??Y?g??,1h?y??E??"}??@?????BA`???R??0-?Z??????W?A?p?;I?????`?t??X??????=????
-??dY^`VkN???]0???H???sM???5????L?<???+?P9y-,;|??N??|?0??^`??[??:?0??z???/????IW??8g)yQ+???O??k?4?8??_d?Y?bFW???g?yE???j??6[??i?L?O;	$??RWp????U??8"A'=?3Y??)??x?l????????r?}e??I1?
-??ya???]G7?b??sN???/?lEQ??>E??<W??9??S????!??G????8~???Ef?_M???s?????8d???lT???^??I?E\????-?9R????yn?)???B?h9??>X????%?to??V??|??O?O>????}6??.N???"g*x? ?P???P?~?9?}????\????6?a}??{z??L?b?[??)N?? kI
-??6?4????`0?v!	fsy???	???)..????4F;?k?1+X?x??????)?????????????v*?>??9g?"??d=c^4?Wu?????	L?>????ym{???|????XEx???wL&	???.???3?[C?V??3??s???@ujuH?P?`??_}???1???k??^\?C?"j??1g	??	?%:?-?"??#O)9??YCB,?!x?y?I^????C???e?o0R4?g??_?T??U+?%M!?o??_???co/??W?????_|?p?<rm{?J??H??ba??lv?$??%g!?C???>?d?-??9??w???W???'^??I???~*?O?K_???S???R??Q?q??ey??????Z?
-??P?g?Hm?J??Q???c????G??MRkf?`?!??1??d?????%?To????)???{?fz?YH?yP?z?Cc?(?????	k???a??5&|?=???????Fv??r??2^???los????@KLc??>?U?
-{?/c$??^E_??z?h??j??A??F)~?|??????Sh5????)??dCN	I?,???y??H?A1Gb??`???#Q at 5??2??t??8s??Y??9?I???;????4E??^I???Co+??4??:KJ?%?&P?z??-?zr?8???ci?=R;?xU?/?(>?4?!??/???4+?r??"LO?M'??8C??4??8J(8?o?m?:?5k9????~N]?La0???a??tts???k???k?+)%/Y?.(???????o???yM?+???????|=~????????S?\??f!??T?o???f?O??"2#??F??S4?/T?k?_U=q?2???"??7K????_=?#+????sw????q?.qo??z?6?q????}?2i??t8?|????????????gM0?????s??n???{?6S????wc?Cq????p(?W???Mx???s??????#Rm?4???\??~????????}?????e?i??T?"uA@M?????7?B?7??t?}??L??I3W@???E?????
-??5h?{?#????o???%zQ?75u????g??????e?T3Fi1;7????+????H???M??;??^I?R??!?????9?d??U?5??=
-?v?????J?Njd??Qd&???5???O?????????m<??=?L?{?:b???If$????{/?N????R?}E??O~????>?????Ty?????s1\}%
-????ev???5?}
-?
-??!l.??????7r???|?~??)c?H4y8?t??;??z]?K5? ??N9WB?
-?Icx???G????MO???q?l?A?5?'???xdE?
-???YlAcc?????B???o?I???(??5?P???[t??3Y[6?u???h?$l??????c??KW??:??f??T)?f5??=x??=?v?<4bp	xa?u^H?^u???n?M????i?9?-9
-Sb??2O??u'??bx?????O<?h??-k?fV??Y???[:?K-.?:?????(!??H?X??N?]???3RpT?7?C3\??????a??^?w??Q&???]$?Ve?#b7O?[?????Y?f???C????W?w?Op?L???_&%G?????????k!F???YCA???)?|????;?~?w`l?u]?>???_?}??:??Q???N?(???N?H?AK?K?i??1ijBH?????u????KaEe?Q?-7??7?]z1??>??
-???k?-em?[hu??4??6"!;?&S?84??{??o|???????kA??_???<??1??$??????_do>?_Y?lW,SpPN?g?$?@e???c????]???8?s???_?0?????l?+WU?O97I?q?????????x???4?]?!?]?v??N~??3x???????7?<??nmf(784?zu?7??????ne??	??u|%???LJ+???|??~?K-?????K???+a?P`??R?????Z??D?y???=??v???3_??????N<N<.? ??A?[o?_??Gz?B??W?0??8]????o?xW???+?}Cvl????????QS??R1?d?y?F
-
-
-
-
-
-
-??P??9????]?????{?<$?
-14?;??????q5~#??!|?U/??g!<????i;?Czh?e??pl?????|?n??/????hsQ?8?*??PH?"?G?suE
-
-?["??:Tt?N????I??$?r?S7)BA?V??>????7??w???w?G???#?jEDF???????gh0-uD?qiaF*b"."`?*j?.?`?T??\,??^Wqw?GC%L?%B?$P?	\???????a????*?6335W5?E??]=?AR????????
-S?" ejH??2i?
-?)?+?AA?3?,?@}?63w?0?&?,?[?R}??^??
-K(?P?P??'?ud?Z?NLL?j????F??j???v??YYYY]]????v?[[[?^ogggoo??????????%???????3?/?????????????D????g?c??r}??Bg???'?????j?;????????k???????v_8)?w?<????{??q?????7?V?[g????CGno?=??;}j\6?_?O.???????????PK
-
-
-
-
-
-
-??QJ)???m?RJL???????{$	?z?:??/?m??qhO????5_?u??????<???????w3??=?3????;???2*??????????	@????=?w&??%???????8  ???~?,6???#X??
-?}$?i\?!????f??d??1jk?XV?????????%:?OKK?jk???SO???G??'??it!5>[?????op?.?,
-$i??]???=Z??u?h?cD)
-?%???4?>?h??c'?ST?/??yI??U?<!??????[?+????????a???????T~?????w?a?^??OJ??Q<w
-
-
-
-,?B????
-^<_e???F?4??"????????"o?3??i?M?@P?$?`M?CC??DT?662??N\Y?y?KS?~?????N@??
-??^}??}Qd???bN&"??(?/u2?@0?Z[????w|?_?5?_??`??>_???cB????
-
-
-
-Q3???c?l~q??c??????l?STZ??i?Y?)y?@N???U?Y?b??0?O?p?w?uFi~???>7?Q"
-??OQ??wLv???,??g?'C_E~? ?7??L^??&%U?;
-,???W???YI????)U??F???|/-jHPh?@??W??'?D?)GiE?E?Oq8o`????e??'|O?hQ?????.
-???Rq#2?/%	?????D?SO-???Jm?????"?o????	?D???VUI??]a???i?|e???~???vZ?)???;`R???Vv????
-
-
-
-?????a4?+?EE ?????8f????~?b+?????????Ut#[?6
-/_??g???c?N???:Qp
-N?P?MA at 2?,?????;????<?y??;???e??!"-~??`:?JR?U.?[)O?yJ???05?	^?G??????:c?4?=???????oS?i?Zk&?? /?V?F??H?o?vuSE???ki?T3???
-
-
-
-??%??^<??r???????]\B)????}:????)?*??;{\??f???d?HO_?????o_?-??R,6?????2k?aW??~?????>???????U??-?O?B?X
-?y???jI??!???x???-V?ZPI]M]????vm}??3)????????f???5??	??'?PU@Pf4a??,?%?hQ????L0??U9?/???????6
-?s?n<h(?-p?p???)O?{_	;?Y?d?*????_^q???a?+???(??????s<????/!x?o????_???e?n???????OW??uN	M
-
-
-
-
-
-
-gO???Z,H??
-:??[?4Z?_?1U?d@?3?U4?6?0Z??_?bLW?????^?$?l??9<??????????^??u??t????39???1j21x?
-? ?????????4?p?h4???????X+>?B???&??Y\\??v?V???`p:???	?
-}fu5,V$???r??`??'???C???
-
-
-
-???*~g5e???=%.?\??j???#0
-??A?@?%C?9"??(-?4?H/???????
-??<>Cy?6Q?*?Hc?8l???@<????^?????S,vm???? ?#5?????J?f	)??????C??~C?W?S??bp?Q??;?(7????%M???????y?m?$?d????????????{???-|8rA?0[??t?&"?Pq????i?N?????Z?HZ?t?3??:??3?=9?)c=??/?w?????1?RwB?*???F??W?j??????3?>??o?????utyB?>&N<>(?????'???O?zK???T?'?U???6??*??Ds??tkSt??`????7x??B??	J?1
-
-
-
-??m??h3"(?~.J??J	II"?(??B
-
-?K4?fD*??zQ?????mVs??\??{?n????8p????p?s?
-8%??Or ???f\K????????9[6??/???|?G??W?]e?????8?S@?B???,?}?????W??A?
-??Q?)?x????T???V?Zy???~?l?X??u\?=??z????,??qka-y?b?g?T???H***???i???x????*
-
-
-
-?,	oO?<$7?"??x?YH? ?H???w??F???+??	7q???}G?wE???E8????&?U??/d#?$;!?????My????;^???K?-?:???a~???j
-?d8?B???d??jX=?50/?????DIj	????=q?pK#o,S?b??mb5?????Y{U9?q??bF???d??7?'/??.t???-U??l??h??7?????o???}??>?r??<$??&???MYSHg?7O?.?P???U?>??|???*r%db?/?i|??????%??Op1T?l??O4zM??z??To?~??6?l?y????????9{?Pfy4???f?g"?_9r,??S?vkq9??|?K??k)?9?,V?????c}???%???^{????d????T?hQ?u?l[????x05??'?<?7??5?AW#?+?*???<2C??????{w?????N??p?!\???????'???/??xrc????w??:?2???K?-^??[if???g?y??)}?b??s????.?B??????u???@?&???P?mf??~
-??J*;q(o?????YB?
-
-
-
-f@[???h??;]{z?^???je?@????
-m??????2A/?u1vs??????HF????"????P@???)?"? jL??1{????Q,@??eCc1N~??|??m?L?cM???;?W??pk?C?[??1?U?s??ly?3?(?,??%?0???W?w\??e?4<??5?a???|?r|??y?????Q
-0e?k-?t????w??`??_??+???-|'Jo8N9??O3?#??J4??;?cY??^????.??eO??????\?"Tt?X?N"?????g??u???0 ??$??gos???bb?`?Rg*?0?5??4sG??F+%?L??+?(0.N???I?TgU"??1?J????????pu?3|]?F??7*??
-
-
-
-????!?_???N??????'??Y????$??Ii?d?U82???1??2j?????p?l?I??hd?O????? ?`2kq???(a)????(e?4?
-?E(e}??"?pm???j?y(?+V%??F????Go0????S???BS	???9-???_sqF??/?????m?t2;N????F%?
-?nKM1?x????b????o????}???+:[?m?T?)?HBv??0/v|L???
-?mj???jm????)?i??j1???#{9?r??i?????=u5{???x: ???~5?17???%P.M4??FQ??l?M+?	J?v???????w?????x?O?\i?d???Y???????????;O?????,?>h`?v*???q?????%tny??D???UxA?~?R?l????qvf?????Z[O????a?d2 ?*??v>@?!;?%7| ??????h??Z?????????R??H
-
-
-
-??9hU??}$?b??????k???r?gN?<???	?A??R)??Y?
-3???o??U???=?v?S?p?X4u??5~z????O???????I?H?y>/??[?'O)????u*20J??-?i???lv?C???d[UJ?1]?:9$???_?8_?r?c?S???/P?}.
-l?.??????[?e?????(?Gd$????2>????7??AV?BA6?u_?\0?U?CD?X????LG??L%O{???Ng???e~??????U??????>L?E????????????V??LQ?e|??>??^?7??|q5m?S??v?f??oPgmB\s??????U????/BR??????\m??ka?????x??W?R???.?	?S?+?wU??n??G?D?????F?L?w?z;G_?????e??F?
-? ?????7l??W@?G?+?????????+?T??O?????b865?@D#b?/+uw$1d?r?:????m?S)???4u+j9??????J???????'?A?b.N???r???2?F?
-?+??D?n??qmr]???
-
-
-
-?}??i
-M?'?)???in%?????????????M???5%s??]?d{<?H?SX?Y??m??1???]{??3?{rb?Z??'mS+F%-N???n??2e??%?? M??y?????0?
-?"?r??s?$?p
-??????{??j?#
-
-
-
-8??1??s?>?m??????'???????!?2;??te??kn*rX>??C?;T?5Oq???"????L??N??????g?J!?????????/?7????)?n???f?RFq?2??S???B??G???W?zaS5O???????_?p??????????GJ??>M?WAw??;??e2X??`!??K???????q???????
-z?RQ??6???Y???#i?b:?l????2??Y$3u??_?ZO;??????j{??%u?m?????T?lB??????????+gP??_??v?????tmYD???????U??4??????????Y??????U??????_<r?????????my+m??I?I??X?,	?[~	???!5?????L??"???X??C?p?O!?'xwO-R?Q???3???9????*N???U??,=???o???*???k?!_???????\??r??;?+fv4????t?u??X!?>3s?y?w????~C:qM}P?p9?z???Q??yxKj???N??*gM?D?|?|?y??!I?e6?'[?Wo??I#dKp???hm???[?6?0[?)???V6?T^?{??????[??
-????[_?z?????37?:ZQA??nR?inOG?s????
-??r??\?M??6?>?~a???y?$"????????????ww?\M,?JP	=??nu??h?N??@(?$#?{}??u???cf
-
-
-
-???e??
-
-
-
-????Q?D",??/? "???a? "???|QU?Q???>#"FD??jupp?%???k??899?9<<dDtJD??)?Y$a???'"X?*wSQ?O
-????-??W??
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
\ No newline at end of file

Deleted: trunk/res_noewe/exporticons/TomTom.zip
===================================================================
--- trunk/res_noewe/exporticons/TomTom.zip	2009-10-24 12:32:04 UTC (rev 2306)
+++ trunk/res_noewe/exporticons/TomTom.zip	2009-10-25 18:47:33 UTC (rev 2307)
@@ -1,101 +0,0 @@
-PK
-??EP9JUx
-<~	d??&G"?G?(????6r?8???	??c>O???
-?*???$?<??<I&z `?<??!?$?~?i?@Q?U?L?t?T?@>
-?????~I$M?????"???I?D?B???*??K?#??Hv$?4??`?2I?L?'??*dh
-?`?
-E?4?a)$GRl?$qB!GW?1T?L???,?tG%?UI???b?F??a?F1S#???'?ab?<?Mu?\?<?? ?2???Az???m?????&q?L????-J??
-1?"??(??p&Jq'J?cS??M??MV?#;#'?????p(	??????K?&\???d\r!??c??????(?+?K{?%?/??L*I?t??l???M??(???&??L???,????3?2??b9F?,wj??????Isw&Y>?r9m;???7-?"UE??x?o???c????b?5C?R????+]u?????]O?1???U?_*??}?S,??;??6c?????f????`?/?y?u?????[z~rg??}?i at yyhpi???3o??1?p?g??x??i?CB????:/(_?|T??Db???r?h?C????]???/??_????_?Y6*\?`??>d???,iX?????-?<2\YYVYy??2?D????7??;?????l??k????gK??????e????|?????C[??.?????f???c}???]Q??mI????oEil???S??V??????w?{?????u??~IUSCu??O???=??H??qy?????k?oj??a????=???9??l??????l???gkZ??????/V?o;?Vc?W?Y????P#?\T?z??????uVXj??5??j??/?m?????[S?X??M??P?????3??????3fa?B!up??fC?{???>z????m?????/c_nh?3}????(?B?????PK
-???di??T??a?}?????s?9?w?]?i}&?G?
-i???$??
-?#IH{?P?R??}p?%am5B??????-3^?S
-t?%&%Rp??Bn????{2?{???1y???^hS0??H?E??[??A^(A??Bt?}5?
-?P?e??P?;x&O?
-?YT?q?????p?\(??o?C???<_??M???<????u9?8c?0?U?T?????~?Mf???#???U0W!??????????<?R????8???y??)??yN?!]?AG?I???D!??s?2d?1???{ 1?9???DU???????5?????????upp???B<??5?-???q?a-?K?????ZE????@?h??yH?f?V?p2~?r<?\??x???$??>(??!UT!???k??B??D?GB?U?!??PU??????	?F?xh/?{?? ?F????o?6[???????W(?%5U???gU?$J.JMB"?'??M???:2?br@*????d5?5?_z??/{Vt{Pp*	??$|A?????E???????!
-:?W@??:?I??v?
-
-?+d??H"?"I??'????~x?? O?"f~,1IQD$??N?R?b~b4K?CX?$???qx????IIZ??E
-
-??*X??N??4B?? 2+???`?m?M???v??Q???5	l?^@nI?????`1?,????l=??Sx??Y??4????DY??Aj??2?]??)??_????-?dmG??Y?!?
-??'c????a???#?p8~Nu?r???5:?^?+?N@"z???????W}????o???>???E???a?8A??e??g8??Uw??x?i??}E??f7?7E~[ ??@x??D?yBl???o?f?-)?\!?	m????????#3'???l?6nb??-?SRZB????ZK??L??\????*s?9?+???)eee(?J*????????U?F.?l??&?/j????m4?o??jM?v???O??Z.?????6?????|?????E???]??????(???z?.?????C@??@?F??????&?j5?n??????N???4???tuu??L??????nzzz?j???Oo,???????????^??N?\sW??9}?????S??{#?v<?j??[[?>????m5??a??????1??"?????_M.6?^??D?O?3???n"?u?k????{?k?}h??<'g???????q???kW??????^???????????3?????R7????=??@ee???[?O??????M???^z??`?K?`??z?????rS?s???wH?/?m????:pI???C{?T?1??9)?'?????3?}??N?Cao?f?H????????EG???T??U+k???S>>c&<???pu???w=*r??U??I:???V?N?? ??G???+??>2b???^??????=??-?|vp???????7i??j1?M?????F*U}???G?????$??'???yA?^?(????e??0*?RWw??PK
-(W?sI?w8a???L&Y?`:;??????????]?????M?~p???????????0??p??+7???n//x?????{??? 
-F0?NH8??G??hDq???? ~Et?????U???(!?????????O??w?Ug??;"??p??Q???lW??>??x?
-?"3???M??? F??Xm?:5b?Z??!B?HD?y???8J???3fB.qrt?c8m????????????>w5??8[W?Z?:r?J???z455???---hnkC[G???DGW:?.B??FU????CC????????v#T???@e???q4X-h&Z??I+?j544??j???A?Nmo/z???K?G????g0 at O???=??0p?1hs???!tw_D????Ng??f??0NOadd&?	??Q???`6[1>1??4F?	[,X?VLNNbjj
-??O??`??!fgg??W?????d?Q??????????&???ia?[?p???ko^?/
-~???0?=|??@??K??????N@?H$?vh???????!???y??/E???????o~3R??D?()Q?????????|?????????);?+???)???????R?'6}sB????5?]R????l?W??p???????????G??????]?K?sX?@}??#%?+?S???%???|????#?????????/x&??mrJ??g???R????7>????.?x_o??!ha?
-??r???2Y,???y|??????,?????????[???~?????r??R?????9^n??PK
-??EP9JUx
-U?"'G?.?w1(RZ:?4%9???3'YJ S!'8O@'SM??pMI???\??O?N9U??Ns??4TEF?B??ed??MU????\]A\Q??r?Z??A&??<???V?'C?PU??:?#???i:K?K??I{0?e?s b?3??H?&$?DB5??M???|?I?	?<??O??1!b?*fIr??jX??????`:?Xp=??m??6?%I????Q?q???t???l#???isN6????19????n??t??ALq?8??Fs???? i8??5?qx7?}m?=8?D?am?P?e????$????? ????????4Es.":?H#?t??l?????9'?qY?s???sO???=???I? kT?4?,??q??????y???B?FT%?@?G??????????yg????????y>?PH^?9($(?+2?C???n
-SX?!??J~?=
-?Y@@?S!, ?@ (????B?9????MA?=!??X`I??????|/X?1??(s8?5K??ln??Y????l?![????-vC{G??????????x ??G?+?????Wv??O^Vg???????y?W?eQ.K??a??/h?*m????;??~?,Q?Im??J???#???c???K??|?e??^?Psrd???:;E????+
-?????}?3??.??k_?
-???:??m??v?N=??g??Ox?r??#D{???????<o????[??.{zXgzS???o^v???M???????i[gw?<???K??9??a?M?f?????l????e???ZZ?=???[?7?5???3??o??x??.??#?????y??y?c????h??9??(????q-???????}????W???????C???????G??x????l????5??^?a??i??_:??e??M?????R?????\?~???????^?r??W?{??U6|?W??S??/????k???{???:v?_??+????P?^?Ln??o?????3??mg???(???p???>??4A??J-zcz?<sf??o?PK
-????
-???????????????lmm??????????????????????????KyU?b??K?????i????	????M????>???????????{????????c?/?:%&?????>g?c?????????~????T??)????:??t??????{W?G??)F?`????????????r?;5B|?Io?%?????x?So?&??D<?o~???? ????sw??o??)c??'?`?????w{?????%???W?c??sV??[???_??w?????`?????dz???f?????~????4??????y??PK
-??EP9JUx
-LbB????8?Cgw???/?????>????0~????8?'???9??sNv?/??Os?????`???????;?????%?\?H*?/f?.??]$)]$?|??
-?nR?$?H.????r? I?y?
-??EP??KT?%2L?Jj??-???Z?T]&??IQ
-???,`?va?"z?<?HEEA\!?
-??3?3?QxN?Sq8???N$????????6?i???D5{??+?8
-???????&??#~u????ZU???w=??????8f??????????W??|???x???u?????n???_?>?qz??S?k????W??^?v???g?????j5^e?7o~r??x(??k?U#?????y?y?NgS??v?????N???l*xq?8????????PK
-{1??Y?`L????Z?o!JGB???r??A
-hP&(J?u)?'6?&/zS??$??Vu5""Q?*BDN?Y)?^???K?R??F8S?rV?c? ?????42??("????R>GA???????2O??+?A>(???&U??
-&G
-??q6x_?E??#?>>}I?????F??{???]?!?VT+q??9?~?????z^????]??G?)9O?3?h????^{????t??Z?ks??	]5Mw?????Jr?J?L????h
-???a/[?9??YI??m?????&?x??`?(?BS???.B??3???7?:%3"C??`??l???X?b????
-??y????=??<y?|??7??U6q?
-??}p?B?p&???N???:?z???t^,?D?D,?b0"%`DK??????)L??X\??#??A2?B?$??????d??S`???{p?P?K%??)Q??J????4?????9|?]???|?H???"?ChX8????$??|?D"?H!?!?H???
-?L?8?r?
-?J?*?
-j?????0??/L?c0`????"????Qg?.+S????`&???b?b??/???c_??P??
-
-????V???bT???S?????`
-VWW??????ulll??[????U???)????E?D??~???:??!?????PZ?????[_]~?ZN@??????????AE??\?ps???|????????????a?*?J??k???~????????e??2??3??_k??????L??????k}G?E?,?????^^???t7?>??G?.???s???_M??&??&&?E?N???]b?/,.????{???}??&?d?????{???????=s??Y??g%[9:+K;??{?[?a;}i?)J9??"???*?=????^??????s??oPK
-'%.??d??E?Gf?R?6???1??????P?Ci?
-?????-?F????2?1?????H;O??ch5?RNr%I??N?????a????6?3:A??<IG??s.??Pa4PRP????????R.??c???l6SUY??????\?Z??l??vn9?8?v?Kp?><?/_??????o??????C?	?D??????C??????A????$!?'??<N?g?a?H?D?}a.w??rI1?.?$?l?X??R?????????)?;??8?N\.?"S?F}=????????F???hnn??????V???hoo??????N????????????^??????g``???A???fdd???Q???gbb???I??????fff???Y??????gaa???E???X^^fee???U??/??????rZ,w??u??C?????_???{y%????z??"O?5???????|??7kdO?R???
-osZ_<???9e%????e/????[.???/W?cL???o??????K}???V?? =%??s??'C?????r,Y2???=??R???k? I?????S???Twd?|J:}???)I???=???dI??x???F$?????i?????????i???I?|?LTB??w??9??????U????.o?#o8??PK
-??EP9JUx
-?P,0=D?C~?9?r????To"??I.?q]??Jp?$7s?+[,L
-????k?0???s???Z?b;?-R?j?\???f???c-????v?;uh??4??m{?n??Wh??~M?????P?????i{<zz?7{?EKn\????????nmX???dK6?????^???K6<?x??U???_?p ??o??gV\??????/=p??7m???7?+?:=?b?[??{??#??,????7o9?S?????_8??]?7?a??t.????WJ?v?_>?np?mW^?le?????7:?y?????:?dc?kk??q??V???G?g'???&????{?Q??:wHW????r???N?Z??????k??;?k5????q??q????300???S???T??*z???<q????m?d?6???=Q???U?j????????????HM??n`2?d?jx??????b?b/?%????n?F???JM??????p>??~????/?G????G?????:?z????L?PK
-??EP9JUx
-? q??<9?!S
-?|B??'??~??QC:???=??S??8?>O???
-z
-Jd?xp3?<??2?????H?%
-0??<?D>B?*?????$?$IFx???L!?A
-
-z ?A???????|???M{_???}?4????
-??0?5????+??PB??d?&r??;*????b9?J20P!??20??HvGH??v5?@??t?L?d` ?Q?l????cG?<"???:ftR@>??
-
-
-???|????q?h1R?.?_xw??i?df??v???QC<??s?1????g?RSS????r????.V???????))????a?E???nW???????kI?Cg?e???????w???1cm???IN???4??j?nWg?w~m-w??zk??????g???????????==?(?]rkZU?GE99%'rr??;K?r?]?bw?M?/PK
-W?/????9????7?!?????????!????? ??????I??($??H?"h?Wp??!P????I????)7?.?	?8?@??N\????dJ?$?z?xbjw?Q+h??GHf?y???ZI???<????N<??4?`?eA-???-M???B?????cI?&=]???Mo?n?>M7fkB?[?^??5?$????\Aiuv?\$?u=?????P?Y?EQ?9??GC?%?R?}??t#?????X?Tt???? ???z+?????_?c???5C???a??f??TL]U?B???????P??9*e?? A?P??k?
-9=Px-soRY??FG6:j?R????|[????????s?&?T? 	5E?|2?????t?;nK7U?kb6'??e??P&?????n?VG????s|??h?Q+8I!??P???1?mM?;?U??l4????<??Y??%@?I?|????M??)???????0p
-H?T???)HA?o??O?>v????=o??	?xY)????,K?D???2???y@????M????.dw??.hf"????\=}?Lr???s]{?C?]?<????l????n??&;???=???qG|O4??[mI3??????K??????????}???@?{?7?z*?I????|?0??^?????oF??ajf'?????.??;qp???k??u?>p???mM?=k)|j'??????{a
-??EP9JUx
-jhb????a?!T???^?????K??z]k??H?M>?>???<??.?d?x?r?G49??1??K?]c???)MS$d?"PGB(?%?f?(??z?b?,??????9D???)?8$?u??!c?9
-'8?&QC2?Q:?g??@Q?B1d???R<?????>*?????=??%??0K?,'??y??=E
-%?P?D?.R<S??"%!?	?????H??Hyx=QJ??I??8'Q???)H??(I??dJ?2	?L2??????4?(?3?g?? DF"?#&3?"
-C#Ue??@DQ!ARH??A??J?
-T??ZEZ?8A%???U???
-LA*h ?*??@???PCQ??(i?~??4??0C?3p??T?j??:???o??;???c?N??N?,?M??AE??{?fP??????l?`?E??`XH?I?b?<?L???o?<???4?c???,????"	? U?[??{???[?ga?fX?a??j???-?}??6??a?l?i??F???E?6l??????>?g???????'L5????|???ig???^h[?j????:?Z???????@???????o???zO??j?q?????????;???Z|?Zv*?^e?=??????????v???Ws??j???*M??_??u?r;???~?z??U?^??t?=V??V?-??a???={>=??~?8y???????#^??|???s???????'7??7??i?rn??????w-???y??????2??W????Mog????t?????V??n+{?O^?????k,???;m????io??v???{9??????3?w??w?????????/^<?k??~{??!|m???OK;?>?c??E?$??V?C(?n_w??=??v??evC??'*?h??I?n]?#kivu?:?aV??'?Kn????w??g??w|??5????????\?l?{???Q??????7?M?S??T?*????????_t??)z??8????(??vq????M?+????8X_{??:???fa??;??@??@??eww???72:??\n????Vn^??i??m???PK
-H?4??iA?????xD$C&?A??B?R	?V?Z?F?V?$?j?4w???tHII?^???`@??.??i??z
-*?B+}??#?&?}??I?&MH??g?l6????????]W?3s~???s??w???k?
-Z??
-?X[)?kE?\??a??f?????g?~?7????-g??t??C????[??Ot?WT??!??/?[???L??????+t??A?
-?43?+???Y>??:??yx??v????ml?^m??$st0???????#??=?C??S??dX??-B&??	=?5?6='Ir?Z_???)?????{_?h?x^????{???????a;?a?<?oJ?I?
-'???\?_???{?"Q>?R/??)????\*?R?????U?N?A????s'7g????@?H???(?A35	<??"??\???J??FM?{?1?SV?&?y????p5???:~???W???*?}??'?'?-???????3????????Bt????$??>??T??&De?$???.s??S?????kQbw%???T??2R??x??8?%?"???)}p??zM??<??N	[??{???????????????73??+%]?O??g>??i?????_?l?8????2VN???&????q???I??Sa???????%'???PK
-?H`?@@??w ???y??????;y??|?y?????|/??????hd5??????<??????`ll????F????tXYY???L0?L?????????ppp???\\\?b????
-777????????6??O.?<=???ooo?P?????~~~????G@@
-????k??HKK?H$?8=b????DVV$	???????T???\???A&?A.?#??P(P??J?EEEP?T(.,A(?u%%%(--E9IYY?)??QQQ???J?v?6??????;?????????Amm-???P__???466???	???hiiAkk+??????????EGG:;;????n??n?M????^???>??????~`ppCCC???FGG166?q??qLLL`?brSSS??????f)fg1G17???y,,,`qqKKKX?X^???
-VWW??????ulPll`ss[[[??????vww??????}???N?%?yR??)G???bI????uz????9z?D.
-px??5eh?Qt?????)??????<?Qg}???4?F???!???w?u?A???#?2???:?u??'?u?)~ ????|?o????P^u??O~M?^??5wV?????o???n??W??7??s>?_5??%?????k???9??r_?_??2^??\??x??tF?%.?mB at 8G?????Dg??\?????6O??=????A?{O?D?????d?w???4`??b?%w}???'?%??????Y^(P'????L???????Ti4?"?????h{?????xx/?????????PK
-??EUx
-
-??EUx
-??EUx
-+
-??EUx
-??EUx
-??EUx
\ No newline at end of file

Added: trunk/res_noewe/exporticons/exporticons/Garmin.zip
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/exporticons/exporticons/Garmin.zip
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/exporticons/exporticons/Glopus.zip
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/exporticons/exporticons/Glopus.zip
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/exporticons/exporticons/GoogleEarth.zip
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/exporticons/exporticons/GoogleEarth.zip
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/exporticons/exporticons/TomTom.zip
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/exporticons/exporticons/TomTom.zip
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From araber95 at mail.berlios.de  Mon Oct 26 14:19:16 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 26 Oct 2009 14:19:16 +0100
Subject: [Cachewolf-svn] r2308 - trunk/src/CacheWolf/navi
Message-ID: <200910261319.n9QDJGSj002701@sheep.berlios.de>

Author: araber95
Date: 2009-10-26 14:19:15 +0100 (Mon, 26 Oct 2009)
New Revision: 2308

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
bugfix : map menu does not show in certain cases

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-25 18:47:33 UTC (rev 2307)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-26 13:19:15 UTC (rev 2308)
@@ -154,7 +154,7 @@
 		buttonImageZoom1to1 = new AniImage("zoom1to1"+imagesize+".png");
 		posCircle = new MapSymbol("position_green"+imagesize+".png", "gps-position", new CWPoint());
 		MARK_CACHE_IMAGE = "mark_cache.png";
-
+		//Close
 		DrawnIcon closeX;
 		if(mobileVGA)
 			closeX = new DrawnIcon(DrawnIcon.CROSS,30,30,new Color(0,0,0));
@@ -167,19 +167,24 @@
 		closeX.doDraw(tmp, 0);
 		bottonImageClose.properties |= mImage.AlwaysOnTop;
 		mmp.addImage(bottonImageClose);
+		//CenterScreenToGPSPosition (also starts GPS)
 		buttonImageGpsOn.properties = mImage.AlwaysOnTop;
 		mmp.addImage(buttonImageGpsOn);
+		//ImageChooseMap
 		bottonImageChooseMap.properties = mImage.AlwaysOnTop;
 		mmp.addImage(bottonImageChooseMap);
+		//directionArrows
 		directionArrows.properties = mImage.AlwaysOnTop;
 		mmp.addImage(directionArrows);
+		//ImageLens
 		buttonImageLens.properties = mImage.AlwaysOnTop;
 		buttonImageLensActivated.properties = mImage.AlwaysOnTop;
 		buttonImageLensActivatedZoomIn.properties = mImage.AlwaysOnTop;
 		buttonImageLensActivatedZoomOut.properties = mImage.AlwaysOnTop;
 		mmp.addImage(buttonImageLens);
+		//Zoom1to1
 		buttonImageZoom1to1.properties = mImage.AlwaysOnTop;
-		mmp.addImage(buttonImageZoom1to1);
+		mmp.addImage(buttonImageZoom1to1);		
 		//target distance
 		int fontSize = ( 3 * pref.fontSize ) / 2;
 		Font imageFont = new Font("Helvetica", Font.PLAIN, fontSize );
@@ -197,13 +202,13 @@
 		ScaleImageGraphics.setFont(imageFont);
 		ScaleImage.properties = mImage.AlwaysOnTop;
 		mmp.addImage(ScaleImage);
-		//resizeTo(pref.myAppWidth, pref.myAppWidth); // is necessary to initialise mapImage.screenSize
+
 		setGpsStatus(noGPS);
 		posCircle.properties = mImage.AlwaysOnTop;
 		mmp.addImage(posCircle);
+		
 		mmp.startDragResolution = 5;
 		mapsloaded = false;
-		//updateDistance(); // fill Rect with transparent color
 		scaleWanted = 1;
 		mapChangeModus = HIGHEST_RESOLUTION_GPS_DEST;
 		lastHighestResolutionGPSDestScale = -1;
@@ -932,7 +937,6 @@
 		if (symbNr != -1) removeMapSymbol(symbNr);
 	}
 
-
 	public void removeMapSymbol(int SymNr) {
 		mmp.removeImage(((MapSymbol)symbols.get(SymNr)));
 		symbols.removeElementAt(SymNr);
@@ -1053,9 +1057,13 @@
 	private void showCachesOnMap() {
 		// if (width == 0 || height == 0) return;
 		CacheHolder ch;
+		/*
+		 * Symbols not on screen move invisible topleft but on top , so no menu for yellow triangle
 		int twidth = width/10;
 		int theight = height/10;
 		Area screenArea = new Area(ScreenXY2LatLon(-twidth,-theight), ScreenXY2LatLon(width+twidth,height+theight));
+		 */
+		Area screenArea = new Area(ScreenXY2LatLon(0,0), ScreenXY2LatLon(width,height));
 		for (int i = cacheDB.size() - 1; i >= 0; i--) {
 			ch = cacheDB.get(i);
 			if (screenArea.isInBound(ch.pos)) {



From araber95 at mail.berlios.de  Wed Oct 28 00:56:01 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 28 Oct 2009 00:56:01 +0100
Subject: [Cachewolf-svn] r2309 - trunk/src/CacheWolf
Message-ID: <200910272356.n9RNu1h3032079@sheep.berlios.de>

Author: araber95
Date: 2009-10-28 00:55:59 +0100 (Wed, 28 Oct 2009)
New Revision: 2309

Modified:
   trunk/src/CacheWolf/Rebuild.java
Log:
q+d : rebuild now does what is expected that it does.

Modified: trunk/src/CacheWolf/Rebuild.java
===================================================================
--- trunk/src/CacheWolf/Rebuild.java	2009-10-26 13:19:15 UTC (rev 2308)
+++ trunk/src/CacheWolf/Rebuild.java	2009-10-27 23:55:59 UTC (rev 2309)
@@ -31,12 +31,12 @@
 			int pos=xmlFiles[i].lastIndexOf('.');
 			if (pos<0) continue;
 			String wayPoint=xmlFiles[i].substring(0,pos).toUpperCase();
-			if (wayPoint.equalsIgnoreCase("index") || 			// Check for index.xml and index.bak
-				prof.getCacheIndex(wayPoint)>=0)		// Check for waypoints already in database
-				xmlFiles[i]=null;   				// Remove existing caches or index.xml
+			if (wayPoint.equalsIgnoreCase("index"))	// Check for index.xml and index.bak
+				xmlFiles[i]=null;   				// Remove (existing caches) or index.xml
 			else {
 				//ewe.sys.Vm.debug("Orphan: "+wayPoint);
 				orphans++;
+				prof.cacheDB.removeElementAt(prof.getCacheIndex(wayPoint));
 			}
 		}
 		if (orphans>0) { // At least one cache not in database



From araber95 at mail.berlios.de  Wed Oct 28 09:11:39 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 28 Oct 2009 09:11:39 +0100
Subject: [Cachewolf-svn] r2310 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200910280811.n9S8Bd3P020490@sheep.berlios.de>

Author: araber95
Date: 2009-10-28 09:11:35 +0100 (Wed, 28 Oct 2009)
New Revision: 2310

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Rebuild.java
Log:
doing rebuild index a little more correct.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-10-27 23:55:59 UTC (rev 2309)
+++ trunk/res_noewe/languages/DE.cfg	2009-10-28 08:11:35 UTC (rev 2310)
@@ -99,8 +99,8 @@
 		207=**frei/nicht benutzt / veraltet**
 		208=Index neu erstellen
 		209=Wiederaufbau Index
-		210=Caches nicht in index.xml:+
-		211=%0aDavon hinzugef%fcgt:+
+		210=Caches gel%f6scht:+
+		211=%0aCaches hinzugef%fcgt:+
 		212=Alle .xml Dateien (und Bilder) l%f6schen, die nicht in index.xml sind
 		213=Verwaiste .xml Dateien l%f6schen
 		214=Neuer Wegpunkt

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-10-27 23:55:59 UTC (rev 2309)
+++ trunk/res_noewe/languages/EN.cfg	2009-10-28 08:11:35 UTC (rev 2310)
@@ -99,8 +99,8 @@
 		207=** unused **
 		208=Rebuild index
 		209=Rebuilding index
-		210=Caches not in index.xml:+
-		211=%0aThereof added:+
+		210=Caches deleted:+
+		211=%0aCaches added:+
 		212=Delete all .xml files not in index.xml and associated pictures
 		213=Deleting orphans
 		214=New Waypoint

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-10-27 23:55:59 UTC (rev 2309)
+++ trunk/res_noewe/languages/FR.cfg	2009-10-28 08:11:35 UTC (rev 2310)
@@ -99,8 +99,8 @@
 		207=** liberte **
 		208=R%e9cr%e9er index
 		209=R%e9cr%e9er index
-		210=Caches pas en index.xml:+
-		211=%0aDont ajout%e9e:+
+		210=Caches supprim%e9s:+
+		211=%0aCaches ajout%e9:+
 		212=Effacer toutes les fichier .xml (et images) qui ne sont pas en index.xml
 		213=Effacer les fichier .xml orpheline
 		214=Nouveau waypoint

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-10-27 23:55:59 UTC (rev 2309)
+++ trunk/res_noewe/languages/NL.cfg	2009-10-28 08:11:35 UTC (rev 2310)
@@ -98,8 +98,8 @@
 		207=[** unused **]
 		208=[Rebuild index]
 		209=[Rebuilding index]
-		210=[Caches not in index.xml:+}
-		211=[%0aThereof added:+]
+		210=Caches geschrapt:+}
+		211=%0aCaches toegevoegd:+
 		212=[Delete all .xml files not in index.xml and associated pictures]
 		213=[Deleting orphans]
 		214=Nieuwe Waypoint

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2009-10-27 23:55:59 UTC (rev 2309)
+++ trunk/res_noewe/languages/PL.cfg	2009-10-28 08:11:35 UTC (rev 2310)
@@ -99,8 +99,8 @@
                 207=** free/unused/depreciated **
                 208=Przebuduj index
                 209=Trwa przebudowywanie index
-                210=Nie ma skrzynek w index.xml:+
-                211=%0aDodane:+
+                210=Skrzynki skresla sie:+
+                211=%0aSkrzynki brzmieniu:+
                 212=Usun wszystkie pliki .xml, ktore nie sa w index.xml i zalaczone obrazy
                 213=Usuwanie sierot
                 214=Nowy WaypointUsunacUsunac

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-10-27 23:55:59 UTC (rev 2309)
+++ trunk/src/CacheWolf/MainMenu.java	2009-10-28 08:11:35 UTC (rev 2310)
@@ -637,6 +637,7 @@
 			if(mev.selectedItem == orgRebuild){
 				Rebuild rb=new Rebuild();
 				rb.rebuild();
+				profile.updateBearingDistance();
 				tbp.refreshTable();
 			}
 			if(mev.selectedItem == orgCheckNotesAndSolver){

Modified: trunk/src/CacheWolf/Rebuild.java
===================================================================
--- trunk/src/CacheWolf/Rebuild.java	2009-10-27 23:55:59 UTC (rev 2309)
+++ trunk/src/CacheWolf/Rebuild.java	2009-10-28 08:11:35 UTC (rev 2310)
@@ -36,7 +36,8 @@
 			else {
 				//ewe.sys.Vm.debug("Orphan: "+wayPoint);
 				orphans++;
-				prof.cacheDB.removeElementAt(prof.getCacheIndex(wayPoint));
+				int cacheIndex=prof.getCacheIndex(wayPoint); 
+				if (cacheIndex > -1) prof.cacheDB.removeElementAt(cacheIndex);
 			}
 		}
 		if (orphans>0) { // At least one cache not in database
@@ -57,8 +58,8 @@
 				if (pbf.isClosed) break;
 			}
 			(new MessageBox(MyLocale.getMsg(327, "Information"),
-					  MyLocale.getMsg(210,"Caches nicht in index.xml: ")+orphans+
-					  MyLocale.getMsg(211,"\nDavon hinzugef?gt: ")+nAdded
+					  MyLocale.getMsg(210,"Caches deleted: ")+orphans+
+					  MyLocale.getMsg(211,"\nCaches added: ")+nAdded
 					, FormBase.OKB)).execute();
 			prof.buildReferences();
 			prof.saveIndex(Global.getPref(),true);



From araber95 at mail.berlios.de  Wed Oct 28 14:52:03 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 28 Oct 2009 14:52:03 +0100
Subject: [Cachewolf-svn] r2311 - trunk/src/CacheWolf/navi
Message-ID: <200910281352.n9SDq39b028126@sheep.berlios.de>

Author: araber95
Date: 2009-10-28 14:52:01 +0100 (Wed, 28 Oct 2009)
New Revision: 2311

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
helps with action on yellow triangle (bugfix)

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-10-28 08:11:35 UTC (rev 2310)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-10-28 13:52:01 UTC (rev 2311)
@@ -1101,15 +1101,19 @@
 			if (gotoPos.mapObject instanceof CacheHolder) {
 				gotoPosCH = (CacheHolder) gotoPos.mapObject;
 			}
-			if (!getShowCachesOnMap() && (gotoPosCH != null)) {
-				addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType(),true), gotoPosCH.pos);
-			}
-			addSymbolOnTop("goto", gotoPosCH, "goto_map.png", gotoPos.where);
+			if (screenArea.isInBound(gotoPosCH.pos)) {
+				if (!getShowCachesOnMap() && (gotoPosCH != null)) {
+					addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType(),true), gotoPosCH.pos);
+				}
+				addSymbolOnTop("goto", gotoPosCH, "goto_map.png", gotoPos.where);
+			}		
 		}
 		// show Selected
 		if (markedCache != null) {
-			addSymbolIfNecessary(markedCache.cacheName, markedCache, GuiImageBroker.getTypeImage(markedCache.getType(),true), markedCache.pos);
-			addSymbolOnTop("selectedCache", markedCache, MARK_CACHE_IMAGE, markedCache.pos);
+			if (screenArea.isInBound(markedCache.pos)) {
+				addSymbolIfNecessary(markedCache.cacheName, markedCache, GuiImageBroker.getTypeImage(markedCache.getType(),true), markedCache.pos);
+				addSymbolOnTop("selectedCache", markedCache, MARK_CACHE_IMAGE, markedCache.pos);
+			}			
 		}
 	}
 
@@ -1921,7 +1925,11 @@
 		if(ev instanceof FormEvent && (ev.type == FormEvent.CLOSED )){
 			running = false;
 		}
-		if( ev instanceof KeyEvent && ev.target == this && ( (((KeyEvent)ev).key == IKeys.ESCAPE) || (((KeyEvent)ev).key == IKeys.ENTER) || (((KeyEvent)ev).key == IKeys.ACTION) ) ) {
+		if( ev instanceof KeyEvent && 
+			ev.target == this && 
+			( (((KeyEvent)ev).key == IKeys.ESCAPE) ||
+			  (((KeyEvent)ev).key == IKeys.ENTER) || 
+			  (((KeyEvent)ev).key == IKeys.ACTION) ) ) {
 			this.close(0);
 			ev.consumed = true;
 		}



From araber95 at mail.berlios.de  Wed Oct 28 15:34:41 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 28 Oct 2009 15:34:41 +0100
Subject: [Cachewolf-svn] r2312 - trunk/src/CacheWolf/navi
Message-ID: <200910281434.n9SEYfeX002199@sheep.berlios.de>

Author: araber95
Date: 2009-10-28 15:34:40 +0100 (Wed, 28 Oct 2009)
New Revision: 2312

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
download of expedia maps will work again.

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-10-28 13:52:01 UTC (rev 2311)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-10-28 14:34:40 UTC (rev 2312)
@@ -218,25 +218,31 @@
 		String filename = createFilename(mio.getCenter(), mio.scale);
 		String imagename = mio.setName(path, filename) + currentOnlineMapService.getImageFileExt();
 		String url = currentOnlineMapService.getUrlForCenterScale(center, scale, pixelsize);
-		WebMapService wms = (WebMapService) currentOnlineMapService;
-		if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {
-			url="bitmapgen"+
-				" \""+FileBase.getProgramDirectory().replace('/',File.separatorChar)+"\\"+wms.serviceTypeUrlPart+"\""+
-				" \""+path.replace('/', File.separatorChar)+imagename+"\""+
-				" -mb "+url; // + minx miny maxx maxy + pixelsize.x
-			File f=new FileBugfix(wms.MainUrl);
-			if (!f.exists() || !f.canRead()) {
-				MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1834,"Please enter the correct path to Kosmos.Console.exe into the wms-file."),ewe.ui.MessageBox.OKB);
-				mb.execute();
-			} else {
-				Vm.exec(wms.MainUrl.replace('/', File.separatorChar), url, 0, true);
+		if (currentOnlineMapService instanceof ExpediaMapService) {
+			downloadImage(url, path+imagename);
+			mio.saveWFL();
+		}
+		else {
+			WebMapService wms = (WebMapService) currentOnlineMapService;
+			if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {
+				url="bitmapgen"+
+					" \""+FileBase.getProgramDirectory().replace('/',File.separatorChar)+"\\"+wms.serviceTypeUrlPart+"\""+
+					" \""+path.replace('/', File.separatorChar)+imagename+"\""+
+					" -mb "+url; // + minx miny maxx maxy + pixelsize.x
+				File f=new FileBugfix(wms.MainUrl);
+				if (!f.exists() || !f.canRead()) {
+					MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1834,"Please enter the correct path to Kosmos.Console.exe into the wms-file."),ewe.ui.MessageBox.OKB);
+					mb.execute();
+				} else {
+					Vm.exec(wms.MainUrl.replace('/', File.separatorChar), url, 0, true);
+					mio.saveWFL();
+				}
+			}
+			else {
+				downloadImage(url, path+imagename);
 				mio.saveWFL();
 			}
 		}
-		else {
-			downloadImage(url, path+imagename);
-			mio.saveWFL();
-		}
 	}
 
 	public String createFilename(CWPoint center, float scale) {



From araber95 at mail.berlios.de  Wed Oct 28 16:53:10 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 28 Oct 2009 16:53:10 +0100
Subject: [Cachewolf-svn] r2313 - in trunk/res_noewe/symbols: . Harry1999
	z.B.big z.B.small
Message-ID: <200910281553.n9SFrAcw011643@sheep.berlios.de>

Author: araber95
Date: 2009-10-28 16:52:55 +0100 (Wed, 28 Oct 2009)
New Revision: 2313

Added:
   trunk/res_noewe/symbols/Harry1999/
   trunk/res_noewe/symbols/Harry1999/10size.png
   trunk/res_noewe/symbols/Harry1999/11size.png
   trunk/res_noewe/symbols/Harry1999/16size.png
   trunk/res_noewe/symbols/Harry1999/18size.png
   trunk/res_noewe/symbols/Harry1999/20size.png
   trunk/res_noewe/symbols/Harry1999/21size.png
   trunk/res_noewe/symbols/Harry1999/2size.png
   trunk/res_noewe/symbols/Harry1999/4size.png
   trunk/res_noewe/symbols/Harry1999/5size.png
   trunk/res_noewe/symbols/Harry1999/7size.png
   trunk/res_noewe/symbols/Harry1999/Thumbs.db
Modified:
   trunk/res_noewe/symbols/readme.htm
   trunk/res_noewe/symbols/z.B.big/10size.png
   trunk/res_noewe/symbols/z.B.big/11size.png
   trunk/res_noewe/symbols/z.B.big/12size.png
   trunk/res_noewe/symbols/z.B.big/13size.png
   trunk/res_noewe/symbols/z.B.big/14size.png
   trunk/res_noewe/symbols/z.B.big/15size.png
   trunk/res_noewe/symbols/z.B.big/16size.png
   trunk/res_noewe/symbols/z.B.big/17size.png
   trunk/res_noewe/symbols/z.B.big/18size.png
   trunk/res_noewe/symbols/z.B.big/19size.png
   trunk/res_noewe/symbols/z.B.big/20size.png
   trunk/res_noewe/symbols/z.B.big/21size.png
   trunk/res_noewe/symbols/z.B.big/2size.png
   trunk/res_noewe/symbols/z.B.big/4size.png
   trunk/res_noewe/symbols/z.B.big/5size.png
   trunk/res_noewe/symbols/z.B.big/6size.png
   trunk/res_noewe/symbols/z.B.big/7size.png
   trunk/res_noewe/symbols/z.B.big/8size.png
   trunk/res_noewe/symbols/z.B.small/11.png
   trunk/res_noewe/symbols/z.B.small/12.png
   trunk/res_noewe/symbols/z.B.small/13.png
   trunk/res_noewe/symbols/z.B.small/14.png
   trunk/res_noewe/symbols/z.B.small/15.png
   trunk/res_noewe/symbols/z.B.small/16.png
   trunk/res_noewe/symbols/z.B.small/17.png
   trunk/res_noewe/symbols/z.B.small/18.png
   trunk/res_noewe/symbols/z.B.small/6.png
Log:
Modified examples for own symbols. Readme hint for transparency.

Added: trunk/res_noewe/symbols/Harry1999/10size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/10size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/11size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/11size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/16size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/16size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/18size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/18size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/20size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/20size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/21size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/21size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/2size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/2size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/4size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/4size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/5size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/5size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/7size.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/7size.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/symbols/Harry1999/Thumbs.db
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/Harry1999/Thumbs.db
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/symbols/readme.htm
===================================================================
--- trunk/res_noewe/symbols/readme.htm	2009-10-28 14:34:40 UTC (rev 2312)
+++ trunk/res_noewe/symbols/readme.htm	2009-10-28 15:52:55 UTC (rev 2313)
@@ -14,16 +14,16 @@
  <o:DocumentProperties>
   <o:Author>.</o:Author>
   <o:LastAuthor>.</o:LastAuthor>
-  <o:Revision>2</o:Revision>
+  <o:Revision>3</o:Revision>
   <o:Created>2009-10-23T21:05:00Z</o:Created>
-  <o:LastSaved>2009-10-24T10:40:00Z</o:LastSaved>
+  <o:LastSaved>2009-10-28T15:51:00Z</o:LastSaved>
   <o:Pages>1</o:Pages>
-  <o:Words>196</o:Words>
-  <o:Characters>1237</o:Characters>
+  <o:Words>218</o:Words>
+  <o:Characters>1380</o:Characters>
   <o:Company>CF Computer</o:Company>
-  <o:Lines>10</o:Lines>
-  <o:Paragraphs>2</o:Paragraphs>
-  <o:CharactersWithSpaces>1431</o:CharactersWithSpaces>
+  <o:Lines>11</o:Lines>
+  <o:Paragraphs>3</o:Paragraphs>
+  <o:CharactersWithSpaces>1595</o:CharactersWithSpaces>
   <o:Version>10.6856</o:Version>
  </o:DocumentProperties>
 </xml><![endif]--><!--[if gte mso 9]><xml>
@@ -84,7 +84,7 @@
 	font-family:"Times New Roman";}
 </style>
 <![endif]--><!--[if gte mso 9]><xml>
- <o:shapedefaults v:ext="edit" spidmax="3074"/>
+ <o:shapedefaults v:ext="edit" spidmax="4098"/>
 </xml><![endif]--><!--[if gte mso 9]><xml>
  <o:shapelayout v:ext="edit">
   <o:idmap v:ext="edit" data="1"/>
@@ -112,6 +112,9 @@
 <p class=MsoNormal>Ist keine entsprechende Datei vorhanden, wird das
 Cachewolf-interne Symbol beibehalten.</p>
 
+<p class=MsoNormal>F?r Transparenz (in Win32) muss die <span class=SpellE>png-Datei</span>
+mit 32 Bit pro Pixel gespeichert werden.</p>
+
 <p class=MsoNormal><o:p>&nbsp;</o:p></p>
 
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>.<span
@@ -135,6 +138,10 @@
 without corresponding file the <span class=SpellE>buildt</span>-in symbol will
 be maintained.<o:p></o:p></span></p>
 
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>For
+transparency (on win32) the <span class=SpellE>png</span>-file must be saved
+with 32 Bit per pixel.<o:p></o:p></span></p>
+
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
 
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>
@@ -151,8 +158,8 @@
 Custom<o:p></o:p></span></p>
 
 <p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
-EN-GB'>1.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> - APE
-(&quot;Project APE Cache&quot;)<o:p></o:p></span></p>
+EN-GB'>1.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -
+APE (&quot;Project APE Cache&quot;)<o:p></o:p></span></p>
 
 <p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
 EN-GB'>2.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> -

Modified: trunk/res_noewe/symbols/z.B.big/10size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/11size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/12size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/13size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/14size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/15size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/16size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/17size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/18size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/19size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/20size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/21size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/2size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/4size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/5size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/6size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/7size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.big/8size.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/11.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/12.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/13.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/14.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/15.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/16.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/17.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/18.png
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/symbols/z.B.small/6.png
===================================================================
(Binary files differ)



From araber95 at mail.berlios.de  Wed Oct 28 17:00:00 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 28 Oct 2009 17:00:00 +0100
Subject: [Cachewolf-svn] r2314 - in trunk: res_noewe/symbols/Harry1999
	src/CacheWolf/navi
Message-ID: <200910281600.n9SG00Tt012169@sheep.berlios.de>

Author: araber95
Date: 2009-10-28 16:59:58 +0100 (Wed, 28 Oct 2009)
New Revision: 2314

Removed:
   trunk/res_noewe/symbols/Harry1999/Thumbs.db
Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
changed default for download overview map to false.

Deleted: trunk/res_noewe/symbols/Harry1999/Thumbs.db
===================================================================
(Binary files differ)

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-28 15:52:55 UTC (rev 2313)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-10-28 15:59:58 UTC (rev 2314)
@@ -101,7 +101,7 @@
 		//	pnlTiles.addLast(resolutionLbl);
 		pnlTiles.addNext(overlappingLbl);
 		pnlTiles.addLast(overlappingInput);
-		overviewChkBox.setState(true);
+		overviewChkBox.setState(false);
 		pnlTiles.addLast(overviewChkBox);
 		pnlTiles.addNext(smallTiles);
 		pnlTiles.addLast(bigTiles);



From araber95 at mail.berlios.de  Thu Oct 29 00:38:09 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 29 Oct 2009 00:38:09 +0100
Subject: [Cachewolf-svn] r2315 - trunk/src/CacheWolf
Message-ID: <200910282338.n9SNc9xZ008606@sheep.berlios.de>

Author: araber95
Date: 2009-10-29 00:38:06 +0100 (Thu, 29 Oct 2009)
New Revision: 2315

Modified:
   trunk/src/CacheWolf/Rebuild.java
Log:
modification for older cache.xml that do not have the <CACHE  ... /> tag.

Modified: trunk/src/CacheWolf/Rebuild.java
===================================================================
--- trunk/src/CacheWolf/Rebuild.java	2009-10-28 15:59:58 UTC (rev 2314)
+++ trunk/src/CacheWolf/Rebuild.java	2009-10-28 23:38:06 UTC (rev 2315)
@@ -10,6 +10,7 @@
 public class Rebuild {
 	String [] xmlFiles;
 	private int cacheXmlVersion;
+	private int startOfCacheDetails;
 
 	public Rebuild() { // Public constructor
 	}
@@ -37,6 +38,11 @@
 				//ewe.sys.Vm.debug("Orphan: "+wayPoint);
 				orphans++;
 				int cacheIndex=prof.getCacheIndex(wayPoint); 
+				getCacheDetails(prof.dataDir+xmlFiles[i]);
+				if (startOfCacheDetails < 0) {
+					CacheHolder ch=prof.cacheDB.get(cacheIndex);
+					ch.save();
+				}
 				if (cacheIndex > -1) prof.cacheDB.removeElementAt(cacheIndex);
 			}
 		}
@@ -48,7 +54,8 @@
 					h.progress = ((float)nProcessed++)/(float)(orphans);
 					h.changed();
 					String details=getCacheDetails(prof.dataDir+xmlFiles[i]);
-					if (details!=null) { // In older Versions of CW the <CACHE... /> line was not stored in the cache.xml
+					if (details!=null) { 
+						// In older Versions of CW the <CACHE... /> line was not stored in the cache.xml
 						CacheHolder ch=new CacheHolder(details, cacheXmlVersion);
 						prof.cacheDB.add(ch);
 						nAdded++;
@@ -96,7 +103,9 @@
 			int vstart;
 			cacheXmlVersion = 1; // Initial guess
 			// Check that we have not accidentally listed another xml file in the directory
-			if (text.indexOf("<CACHEDETAILS>")<0 || (start=text.indexOf("<CACHE "))<0) return null;
+			startOfCacheDetails=text.indexOf("<CACHE ");
+			if ((start=startOfCacheDetails)<0) return null;
+			if (text.indexOf("<CACHEDETAILS>")<0) return null; // startOfCacheDetails must be set in advance
 			if ((vstart = text.indexOf("<VERSION value = \"")) >= 0) {
 				cacheXmlVersion = Integer.valueOf(text.substring(vstart+18, text.indexOf("\"", vstart+18))).intValue();
 			}



From mik77 at mail.berlios.de  Fri Oct 30 21:02:32 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 30 Oct 2009 21:02:32 +0100
Subject: [Cachewolf-svn] r2316 - trunk/src/CacheWolf/navi
Message-ID: <200910302002.n9UK2WJL015041@sheep.berlios.de>

Author: mik77
Date: 2009-10-30 21:02:29 +0100 (Fri, 30 Oct 2009)
New Revision: 2316

Modified:
   trunk/src/CacheWolf/navi/GotoPanel.java
Log:
 - font size correction from http://www.geoclub.de/viewtopic.php?f=40&t=25889&start=50 implemented in GotoPanel. If needed on other places, the method should be moved to a global place.

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-10-28 23:38:06 UTC (rev 2315)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-10-30 20:02:29 UTC (rev 2316)
@@ -58,8 +58,6 @@
 	final static Color GREEN = new Color(0,255,0);
 	final static Color BLUE = new Color(0,0,255);
 
-	final static Font BOLD = new Font("Arial", Font.BOLD, 14);
-
 	int ticker = 0;
 
 	Menu mnuContextFormt;
@@ -479,7 +477,7 @@
 		g.fillRect(0, 0, location.width, location.height);
 
 		int fontSize = location.width / 17;
-		mainFont = new Font("Verdana", Font.BOLD, fontSize);
+		mainFont = GetCorrectedFont(g, "Verdana", Font.BOLD, fontSize);
 		g.setFont(mainFont);
 		fm = g.getFontMetrics(mainFont);
 		lineHeight = fm.getHeight() + 1;
@@ -868,4 +866,21 @@
 	public boolean isNorthCentered() {
 		return northCentered;
 	}
+	
+	public static Font GetCorrectedFont(Graphics g, String name, int style, int size) {
+		Font newFont = new Font(name, style, size);
+		FontMetrics metrics = g.getFontMetrics(newFont);
+		int fontHeight = metrics.getHeight();
+		
+		float ratio = (float)fontHeight / (float)size;
+		if(ratio < 0.9 || ratio > 1.1){
+			size = (int) (size / ratio + 0.5);
+			if(size<5)
+				size=5;
+			newFont = new Font(name, style, size);
+		}
+		
+		return newFont;
+	}
 }
+



