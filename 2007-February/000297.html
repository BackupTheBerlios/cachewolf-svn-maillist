<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r505 - in trunk: resources src/CacheWolf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r505%20-%20in%20trunk%3A%20resources%20src/CacheWolf&In-Reply-To=%3C200702041523.l14FNsDr010188%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000296.html">
   <LINK REL="Next"  HREF="000298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r505 - in trunk: resources src/CacheWolf</H1>
    <B>salzkammergut at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r505%20-%20in%20trunk%3A%20resources%20src/CacheWolf&In-Reply-To=%3C200702041523.l14FNsDr010188%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r505 - in trunk: resources src/CacheWolf">salzkammergut at mail.berlios.de
       </A><BR>
    <I>Sun Feb  4 16:23:54 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000296.html">[Cachewolf-svn] r504 - trunk/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="000298.html">[Cachewolf-svn] r506 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#297">[ date ]</a>
              <a href="thread.html#297">[ thread ]</a>
              <a href="subject.html#297">[ subject ]</a>
              <a href="author.html#297">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: salzkammergut
Date: 2007-02-04 16:23:46 +0100 (Sun, 04 Feb 2007)
New Revision: 505

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/FilterScreen.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/TablePanel.java
Log:
Ueberarbeiteter Filter. Filtert jetzt nach Addi Wpt Type

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-02-04 13:23:47 UTC (rev 504)
+++ trunk/resources/cachewolf.Languages.cfg	2007-02-04 15:23:46 UTC (rev 505)
@@ -157,6 +157,9 @@
 		723=Typen
 		724=Beh%e4lter
 		725=Hinweis: Filter sind additiv, activ = gr%fcn
+		726=Zus%e4tzliche Wegpunkte
+		727=Beh%e4lter
+		728=Zus. WegPkt
 		800=Erstelle Liste
 		801=suche...
 		802=Caches identifiziert. Suche weiter...
@@ -197,6 +200,10 @@
 		1019=Diesen als Zentrum setzen
 		1020=Im Browser online %f6ffnen
 		1021=Beschreibung %f6ffnen
+		1022=Alle mit H&#228;kchen markierten Caches l%f6schen?
+		1023=Diese Funktion steht gegenw%e4rtig nur f&#252;r Geocaching.com zur Verf%fcgung
+		1024=Entfernungen in der Listenansicht~vom aktuellen Standpunkt aus~neu berechnet
+		1025=Kann Zentrum nicht setzen (GPS-Position unzul%e4ssig)
 		1100=Profile
 		1101=Profil 1
 		1102=Profil 2
@@ -470,6 +477,9 @@
 		723=Types
 		724=Container
 		725=Note: Filters are additive, active filter=green
+		726=Additional waypoints
+		727=Cache container
+		728=Add. Waypt
 		800=Creating list
 		801=searching...
 		802=Caches identified. searching...
@@ -510,6 +520,10 @@
 		1019=Set this as center
 		1020=Open online in Browser
 		1021=Open cache description
+		1022=Delete all caches that have a tick?
+		1023=This function is currently only available for geocaching.com
+		1024=Distances in list view recalculated~from current position
+		1025=Cannot set centre (Invalid GPS position)
 		1100=Profiles
 		1101=Profile 1
 		1102=Profile 2

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2007-02-04 13:23:47 UTC (rev 504)
+++ trunk/src/CacheWolf/Filter.java	2007-02-04 15:23:46 UTC (rev 505)
@@ -12,78 +12,86 @@
 */
 public class Filter{
 	
-	public static final int SMALLER = -1;
-	public static final int EQUAL = -1;
-	public static final int GREATER = 1;
-	public static final int FOUND = 2;
-	public static final int NOTFOUND = 3;
+	private static final int SMALLER = -1;
+	private static final int EQUAL = -1;
+	private static final int GREATER = 1;
 
-	public static final int TRADITIONAL = 1;
-	public static final int MULTI = 2;
-	public static final int VIRTUAL = 4;
-	public static final int LETTER = 8;
-	public static final int EVENT = 16;
-	public static final int WEBCAM = 32;
-	public static final int MYSTERY = 64;
-	public static final int LOCLESS = 128;
-	public static final int ADDIWPT = 256;
-	public static final int MEGA = 512;
-	public static final int EARTH = 1024;
+	private static final int TRADITIONAL = 1;
+	private static final int MULTI = 2;
+	private static final int VIRTUAL = 4;
+	private static final int LETTER = 8;
+	private static final int EVENT = 16;
+	private static final int WEBCAM = 32;
+	private static final int MYSTERY = 64;
+	private static final int LOCLESS = 128;
+	private static final int CUSTOM = 256;
+	private static final int MEGA = 512;
+	private static final int EARTH = 1024;
+	private static final int PARKING = 2048;
+	private static final int STAGE = 4096;
+	private static final int QUESTION = 8192;
+	private static final int FINAL = 16384;
+	private static final int TRAILHEAD = 32768;
+	private static final int REFERENCE = 65536;
+	private static final int TYPE_ALL=TRADITIONAL|MULTI|VIRTUAL|LETTER|EVENT|WEBCAM|MYSTERY|LOCLESS|CUSTOM
+	                                  |MEGA|EARTH|PARKING|STAGE|QUESTION|FINAL|TRAILHEAD|REFERENCE;
+
+	private static final int N = 1;
+	private static final int NNE = 2;
+	private static final int NE = 4;
+	private static final int ENE = 8;
+	private static final int E = 16;
+	private static final int ESE = 32;
+	private static final int SE = 64;
+	private static final int SSE = 128;
+	private static final int SSW = 256;
+	private static final int SW = 512;
+	private static final int WSW = 1024;
+	private static final int W = 2048;
+	private static final int WNW = 4096;
+	private static final int NW = 8192;
+	private static final int NNW = 16384;
+	private static final int S = 32768;
+	private static final int ROSE_ALL= N|NNE|NE|ENE|E|ESE|SE|SSE|SSW|SW|WSW|W|WNW|NW|NNW|S;
+
+	private static final int MICRO=1; 
+	private static final int SMALL=2;	
+	private static final int REGULAR=4;	
+	private static final int LARGE=8;	
+	private static final int VERYLARGE=16;	
+	private static final int OTHER=32;	
+	private static final int SIZE_ALL=MICRO|SMALL|REGULAR|LARGE|VERYLARGE|OTHER;
 	
-	// End of type declares
-	public static final int N = 1;
-	public static final int NNE = 2;
-	public static final int NE = 4;
-	public static final int ENE = 8;
-	public static final int E = 16;
-	public static final int ESE = 32;
-	public static final int SE = 64;
-	public static final int SSE = 128;
-	public static final int SSW = 256;
-	public static final int SW = 512;
-	public static final int WSW = 1024;
-	public static final int W = 2048;
-	public static final int WNW = 4096;
-	public static final int NW = 8192;
-	public static final int NNW = 16384;
-	public static final int S = 32768;
-	//end of direction declares
+	private int distdirec = 0;
+	private int diffdirec = 0;
+	private int terrdirec = 0;
 	
-	
-	
-	public String dist = new String();
-	public File routeFile;
-	public int distdirec = 0;
-	public String diff = new String();
-	public int diffdirec = 0;
-	public String terr = new String();
-	public int terrdirec = 0;
-	
-	public String days = new String();
-	public int daysdirec = 0;
-	public String by = new String();
 	String[] byVec;
 	
-	public String type = new String();
-	public String bearing = new String();
 	
-	public int roseMatchPattern = 0;
-	public int typeMatchPattern = 0;
+	private int roseMatchPattern;
+	private boolean hasRoseMatchPattern;
+	private int typeMatchPattern;
+	private boolean hasTypeMatchPattern;
+	private int sizeMatchPattern;
+	private boolean hasSizeMatchPattern;
 	
-	public boolean foundByMe;
-	public boolean notFoundByMe;
+	private boolean foundByMe;
+	private boolean notFoundByMe;
 	
-	public boolean ownedByMe;
-	public boolean notOwnedByMe;
+	private boolean ownedByMe;
+	private boolean notOwnedByMe;
+
+	double fscDist;
+	double fscTerr;
+	double fscDiff;
 	
-	//private boolean is_changed;
-	public int filterKriteria = 0;
 	
-	public boolean archived = false;
-	public boolean notArchived = false;
+	private boolean archived = false;
+	private boolean notArchived = false;
 	
-	public boolean available=false;
-	public boolean notAvailable = false;
+	private boolean available=false;
+	private boolean notAvailable = false;
 	double pi180=java.lang.Math.PI / 180.0;
 	
 	/**
@@ -91,7 +99,8 @@
 	*	We use a regex method to allow for different formats of waypoints:
 	*	possible is currently: DD MM.mmm
 	*/
-	public void doFilterRoute(Vector cacheDB, String dir, double distance){
+	public void doFilterRoute(File routeFile, double distance){
+		Vector cacheDB=Global.getProfile().cacheDB;
 		//load file into a vector:
 		Vector wayPoints = new Vector();
 		Regex rex = new Regex(&quot;(N|S).*?([0-9]{1,2}).*?([0-9]{1,3})(,|.)([0-9]{1,3}).*?(E|W).*?([0-9]{1,2}).*?([0-9]{1,3})(,|.)([0-9]{1,3})&quot;);
@@ -223,18 +232,89 @@
 	}
 	
 	/**
+	 * Set the filter from the filter data stored in the profile
+	 * (the filterscreen also updates the profile)
+	 */
+	public void setFilter() {
+		Profile profile=Global.getProfile();
+		archived     = profile.filterVar.charAt(0) == '1';
+		available    = profile.filterVar.charAt(1) == '1';
+		foundByMe    = profile.filterVar.charAt(2) == '1';
+		ownedByMe    = profile.filterVar.charAt(3) == '1';
+		notArchived  = profile.filterVar.charAt(4) == '1';
+		notAvailable = profile.filterVar.charAt(5) == '1';
+		notFoundByMe = profile.filterVar.charAt(6) == '1';
+		notOwnedByMe = profile.filterVar.charAt(7) == '1';
+		typeMatchPattern=0;
+		String filterType=profile.filterType;
+		if (filterType.charAt(0) == '1') typeMatchPattern|=TRADITIONAL;
+		if (filterType.charAt(1) == '1') typeMatchPattern|=MULTI;
+		if (filterType.charAt(2) == '1') typeMatchPattern|=VIRTUAL;
+		if (filterType.charAt(3) == '1') typeMatchPattern|=LETTER;
+		if (filterType.charAt(4) == '1') typeMatchPattern|=EVENT;
+		if (filterType.charAt(5) == '1') typeMatchPattern|=WEBCAM;
+		if (filterType.charAt(6) == '1') typeMatchPattern|=MYSTERY;
+		if (filterType.charAt(7) == '1') typeMatchPattern|=EARTH;
+		if (filterType.charAt(8) == '1') typeMatchPattern|=LOCLESS;
+		if (filterType.charAt(9) == '1') typeMatchPattern|=MEGA;
+		if (filterType.charAt(10) == '1') typeMatchPattern|=CUSTOM;
+		if (filterType.charAt(11) == '1') typeMatchPattern|=PARKING;
+		if (filterType.charAt(12) == '1') typeMatchPattern|=STAGE;
+		if (filterType.charAt(13) == '1') typeMatchPattern|=QUESTION;
+		if (filterType.charAt(14) == '1') typeMatchPattern|=FINAL;
+		if (filterType.charAt(15) == '1') typeMatchPattern|=TRAILHEAD;
+		if (filterType.charAt(16) == '1') typeMatchPattern|=REFERENCE;
+		hasTypeMatchPattern= typeMatchPattern!=TYPE_ALL;
+		roseMatchPattern=0;
+		String filterRose=profile.filterRose;
+		if (filterRose.charAt(0) == '1') roseMatchPattern|=NW;
+		if (filterRose.charAt(1) == '1') roseMatchPattern|=NNW;
+		if (filterRose.charAt(2) == '1') roseMatchPattern|=N;
+		if (filterRose.charAt(3) == '1') roseMatchPattern|=NNE;
+		if (filterRose.charAt(4) == '1') roseMatchPattern|=NE;
+		if (filterRose.charAt(5) == '1') roseMatchPattern|=ENE;
+		if (filterRose.charAt(6) == '1') roseMatchPattern|=E;
+		if (filterRose.charAt(7) == '1') roseMatchPattern|=ESE;
+		if (filterRose.charAt(8) == '1') roseMatchPattern|=SE;
+		if (filterRose.charAt(9) == '1') roseMatchPattern|=SSE;
+		if (filterRose.charAt(10) == '1') roseMatchPattern|=S;
+		if (filterRose.charAt(11) == '1') roseMatchPattern|=SSW;
+		if (filterRose.charAt(12) == '1') roseMatchPattern|=SW;
+		if (filterRose.charAt(13) == '1') roseMatchPattern|=WSW;
+		if (filterRose.charAt(14) == '1') roseMatchPattern|=W;
+		if (filterRose.charAt(15) == '1') roseMatchPattern|=WNW;
+		hasRoseMatchPattern=roseMatchPattern!=ROSE_ALL;
+		sizeMatchPattern=0;
+		String filterSize=profile.filterSize;
+		if (filterSize.charAt(0) == '1') sizeMatchPattern|=MICRO;
+		if (filterSize.charAt(1) == '1') sizeMatchPattern|=SMALL;
+		if (filterSize.charAt(2) == '1') sizeMatchPattern|=REGULAR;
+		if (filterSize.charAt(3) == '1') sizeMatchPattern|=LARGE;
+		if (filterSize.charAt(4) == '1') sizeMatchPattern|=VERYLARGE;
+		if (filterSize.charAt(5) == '1') sizeMatchPattern|=OTHER;
+		hasSizeMatchPattern=sizeMatchPattern!=SIZE_ALL;
+		distdirec = profile.filterDist.charAt(0) == 'L' ? SMALLER : GREATER; 
+		fscDist = Common.parseDouble(profile.filterDist.substring(1));  // Distance
+		diffdirec = profile.filterDiff.charAt(0) == 'L' ? SMALLER : 
+					(profile.filterDiff.charAt(0) == '=' ? EQUAL : GREATER );
+		fscDiff = Common.parseDouble(profile.filterDiff.substring(1));  // Difficulty
+		terrdirec = profile.filterTerr.charAt(0) == 'L' ? SMALLER : 
+				(profile.filterTerr.charAt(0) == '=' ? EQUAL : GREATER );
+		fscTerr = Common.parseDouble(profile.filterTerr.substring(1));  // Terrain
+	}
+	
+	/**
 	*	Apply the filter. Caches that match a criteria are flagged
 	*	is_filtered = true. The table model is responsible for displaying or
 	*	not displaying a cache that is filtered.
 	*/
-	public void doFilter(Vector cacheDB, String dir){
+	public void doFilter(){
+		Vector cacheDB=Global.getProfile().cacheDB;
 		CacheHolder ch;
 		int cacheTypePattern;
 		int cacheRosePattern;
+		int cacheSizePattern;
 		// Values from filterscreen are parsed outside the main filter loop (fsc=FilterSCreen)
-		double fscDist=Common.parseDouble(dist);  // Distance
-		double fscTerr=Common.parseDouble(terr);  // Terrain
-		double fscDiff=Common.parseDouble(diff);  // Difficulty
 		double dummyd1;
 		//Loop db and match once against type pattern and once against rose pattern
 		//Default is_filtered = false, means will be displayed!
@@ -249,21 +329,28 @@
 			///////////////////////////////
 			// Filter criterium 1: Cache type
 			///////////////////////////////
-			cacheTypePattern = 0;
-			// As each cache can only have one type, we can use else if and set the type
-			if(ch.type.equals(&quot;2&quot;)) cacheTypePattern = TRADITIONAL;
-			else if(ch.type.equals(&quot;3&quot;)) cacheTypePattern = MULTI;
-			else if(ch.type.equals(&quot;4&quot;)) cacheTypePattern = VIRTUAL;
-			else if(ch.type.equals(&quot;5&quot;)) cacheTypePattern = LETTER;
-			else if(ch.type.equals(&quot;6&quot;)|| ch.type.equals(&quot;453&quot;)) cacheTypePattern = EVENT;
-			else if(ch.type.equals(&quot;8&quot;)) cacheTypePattern = MYSTERY;
-			else if(ch.type.equals(&quot;11&quot;)) cacheTypePattern = WEBCAM;
-			else if(ch.type.equals(&quot;12&quot;)) cacheTypePattern = LOCLESS;
-			else if(ch.type.equals(&quot;137&quot;))cacheTypePattern = EARTH;
-			else if(ch.type.equals(&quot;453&quot;))cacheTypePattern = MEGA;
-			if (CacheType.isAddiWpt(ch.type)) cacheTypePattern |= ADDIWPT;
-			if ((cacheTypePattern &amp; typeMatchPattern) == 0) { ch.is_filtered=true; continue; }
-			
+			if (hasTypeMatchPattern) { // Only do the checks if we have a filter
+				cacheTypePattern = 0;
+				// As each cache can only have one type, we can use else if and set the type
+				if (ch.type.equals(&quot;0&quot;)) cacheTypePattern = CUSTOM;
+				else if(ch.type.equals(&quot;2&quot;)) cacheTypePattern = TRADITIONAL;
+				else if(ch.type.equals(&quot;3&quot;)) cacheTypePattern = MULTI;
+				else if(ch.type.equals(&quot;4&quot;)) cacheTypePattern = VIRTUAL;
+				else if(ch.type.equals(&quot;5&quot;)) cacheTypePattern = LETTER;
+				else if(ch.type.equals(&quot;6&quot;)) cacheTypePattern = EVENT;
+				else if(ch.type.equals(&quot;8&quot;)) cacheTypePattern = MYSTERY;
+				else if(ch.type.equals(&quot;11&quot;)) cacheTypePattern = WEBCAM;
+				else if(ch.type.equals(&quot;12&quot;)) cacheTypePattern = LOCLESS;
+				else if(ch.type.equals(&quot;137&quot;))cacheTypePattern = EARTH;
+				else if(ch.type.equals(&quot;453&quot;))cacheTypePattern = MEGA;
+				else if(ch.type.equals(&quot;50&quot;))cacheTypePattern = PARKING;
+				else if(ch.type.equals(&quot;51&quot;))cacheTypePattern = STAGE;
+				else if(ch.type.equals(&quot;52&quot;))cacheTypePattern = QUESTION;
+				else if(ch.type.equals(&quot;53&quot;))cacheTypePattern = FINAL;
+				else if(ch.type.equals(&quot;54&quot;))cacheTypePattern = TRAILHEAD;
+				else if(ch.type.equals(&quot;55&quot;))cacheTypePattern = REFERENCE;
+				if ((cacheTypePattern &amp; typeMatchPattern) == 0) { ch.is_filtered=true; continue; }
+			}			
 			///////////////////////////////
 			// Filter criterium 2: Bearing from centre
 			///////////////////////////////
@@ -271,29 +358,30 @@
 			// By using else if we can reduce the number of comparisons from 16 to just over 8
 			// By first checking the first letter, we can reduce the average number further to
 			// just under 5
-			if (ch.bearing.startsWith(&quot;N&quot;)) {
-				if(ch.bearing.equals(&quot;NW&quot;)) cacheRosePattern = NW;
-				else if(ch.bearing.equals(&quot;NNW&quot;)) cacheRosePattern = NNW;
-				else if(ch.bearing.equals(&quot;N&quot;)) cacheRosePattern = N;
-				else if(ch.bearing.equals(&quot;NNE&quot;)) cacheRosePattern = NNE;
-				else cacheRosePattern = NE;
-			} else if (ch.bearing.startsWith(&quot;E&quot;)) {
-				if(ch.bearing.equals(&quot;ENE&quot;)) cacheRosePattern = ENE;
-				else if(ch.bearing.equals(&quot;E&quot;)) cacheRosePattern = E;
-				else cacheRosePattern = ESE;
-			} else if (ch.bearing.startsWith(&quot;S&quot;)) {
-				if(ch.bearing.equals(&quot;SW&quot;)) cacheRosePattern = SW;
-				else if(ch.bearing.equals(&quot;SSW&quot;)) cacheRosePattern = SSW;
-				else if(ch.bearing.equals(&quot;S&quot;)) cacheRosePattern = S;
-				else if(ch.bearing.equals(&quot;SSE&quot;)) cacheRosePattern = SSE;
-				else cacheRosePattern = SE;
-			} else {
-				if(ch.bearing.equals(&quot;WNW&quot;)) cacheRosePattern = WNW;
-				else if(ch.bearing.equals(&quot;W&quot;)) cacheRosePattern = W;
-				else cacheRosePattern = WSW;
-			}
-			if ((cacheRosePattern &amp; roseMatchPattern) == 0) { ch.is_filtered=true; continue; }
-			
+			if (hasRoseMatchPattern) {
+				if (ch.bearing.startsWith(&quot;N&quot;)) {
+					if(ch.bearing.equals(&quot;NW&quot;)) cacheRosePattern = NW;
+					else if(ch.bearing.equals(&quot;NNW&quot;)) cacheRosePattern = NNW;
+					else if(ch.bearing.equals(&quot;N&quot;)) cacheRosePattern = N;
+					else if(ch.bearing.equals(&quot;NNE&quot;)) cacheRosePattern = NNE;
+					else cacheRosePattern = NE;
+				} else if (ch.bearing.startsWith(&quot;E&quot;)) {
+					if(ch.bearing.equals(&quot;ENE&quot;)) cacheRosePattern = ENE;
+					else if(ch.bearing.equals(&quot;E&quot;)) cacheRosePattern = E;
+					else cacheRosePattern = ESE;
+				} else if (ch.bearing.startsWith(&quot;S&quot;)) {
+					if(ch.bearing.equals(&quot;SW&quot;)) cacheRosePattern = SW;
+					else if(ch.bearing.equals(&quot;SSW&quot;)) cacheRosePattern = SSW;
+					else if(ch.bearing.equals(&quot;S&quot;)) cacheRosePattern = S;
+					else if(ch.bearing.equals(&quot;SSE&quot;)) cacheRosePattern = SSE;
+					else cacheRosePattern = SE;
+				} else {
+					if(ch.bearing.equals(&quot;WNW&quot;)) cacheRosePattern = WNW;
+					else if(ch.bearing.equals(&quot;W&quot;)) cacheRosePattern = W;
+					else cacheRosePattern = WSW;
+				}
+				if ((cacheRosePattern &amp; roseMatchPattern) == 0) { ch.is_filtered=true; continue; }
+			}			
 			///////////////////////////////
 			// Filter criterium 3: Distance
 			///////////////////////////////
@@ -320,12 +408,16 @@
 				if(terrdirec == EQUAL &amp;&amp; dummyd1 != fscTerr) { ch.is_filtered=true; continue; }
 				if(terrdirec == GREATER &amp;&amp;  dummyd1 &lt; fscTerr) { ch.is_filtered=true; continue; }
 			}
+//Vm.debug(ch.wayPoint+&quot; Found&quot;+ch.is_found+&quot;  FoundyMe=&quot;+foundByMe+&quot;   notFoundByMe=&quot;+notFoundByMe);
+//Vm.debug(ch.wayPoint+&quot; Owned&quot;+ch.is_owned+&quot;  OwnedByMe=&quot;+ownedByMe+&quot;   notOwnedByMe=&quot;+notOwnedByMe);
+//Vm.debug(ch.wayPoint+&quot; Archived&quot;+ch.is_archived+&quot;  Archived=&quot;+archived+&quot;   notArchived=&quot;+notArchived);
+//Vm.debug(ch.wayPoint+&quot; Available&quot;+ch.is_available+&quot;  Available=&quot;+available+&quot;   notAvailable=&quot;+notAvailable);
+//Vm.debug(&quot;Blacklisted: &quot;+ch.is_black);
 			///////////////////////////////
 			// Filter criterium 6: Found by me
 			///////////////////////////////
 			if((ch.is_found &amp;&amp; !foundByMe) ||
 			   (!ch.is_found &amp;&amp; !notFoundByMe)){ ch.is_filtered=true; continue; }
-
 			///////////////////////////////
 			// Filter criterium 7: Owned by me
 			///////////////////////////////
@@ -343,6 +435,19 @@
 			///////////////////////////////
 			if((ch.is_available &amp;&amp; !available) ||
 			   (!ch.is_available &amp;&amp; !notAvailable)) { ch.is_filtered=true; continue; }
+			///////////////////////////////
+			// Filter criterium 10: Size
+			///////////////////////////////
+			if (hasSizeMatchPattern) {
+				cacheSizePattern=0;
+				if (ch.CacheSize.startsWith(&quot;M&quot;)) cacheSizePattern = MICRO;
+				else if (ch.CacheSize.startsWith(&quot;S&quot;)) cacheSizePattern = SMALL;
+				else if (ch.CacheSize.startsWith(&quot;R&quot;)) cacheSizePattern = REGULAR;
+				else if (ch.CacheSize.startsWith(&quot;L&quot;)) cacheSizePattern = LARGE;
+				else if (ch.CacheSize.startsWith(&quot;V&quot;)) cacheSizePattern = VERYLARGE;
+				else cacheSizePattern = OTHER;
+				if ((cacheSizePattern &amp; sizeMatchPattern) == 0) { ch.is_filtered=true; continue; }
+			}
 			
 		} // for
 	}
@@ -365,7 +470,7 @@
 		CacheHolder ch;
 		for(int i = cacheDB.size()-1; i &gt;=0 ; i--){
 			ch = (CacheHolder)cacheDB.get(i);
-			ch.is_filtered=ch.is_black; // Always filter blacklisted caches
+			ch.is_filtered=ch.is_black || CacheType.isAddiWpt(ch.type); // Always filter blacklisted caches
 		}
 		Profile prof=Global.getProfile();
 		prof.filterType = new String(Profile.FILTERTYPE);

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2007-02-04 13:23:47 UTC (rev 504)
+++ trunk/src/CacheWolf/FilterScreen.java	2007-02-04 15:23:46 UTC (rev 505)
@@ -14,32 +14,67 @@
 public class FilterScreen extends Form{
 	private static final Color COLOR_FILTERINACTIVE=new Color(190,190,190);
 	private static final Color COLOR_FILTERACTIVE=new Color(0,255,0);
+	private static final Color COLOR_FILTERALL=new Color(255,0,0); // Red
     	
-	mButton btCancel, btApply,btRoute,btArea;
+	private mButton btnCancel, btnApply,btnRoute,
+					btnBearing,btnTypes,btnAttributes,btnRatings,btnContainer,btnSearch,btnAddi;
 	
-	mChoice distChc, difChc, terrChc, lastChc;
-	mCheckBox foundChk, notFoundChk, tradChk, virtualChk, eventChk, earthChk, megaChk;
-	mCheckBox ownedChk, notOwnedChk, multiChk, letterChk, webcamChk, mysteryChk,addiWptChk, loclessChk;
-	mInput distIn, lastIn, foundIn, terrIn, difIn;
-	Vector cacheDB;
-	mCheckBox archivedChk,notArchivedChk, availableChk,notAvailableChk;
-	mCheckBox NW, NNW , N , NNE, NE;
-	mCheckBox ENE, E, ESE, SE, SSE, S;
-	mCheckBox SSW, SW, WSW, W, WNW, chkDeselect,chkSelect;
-	String dir = new String();
+	private mChoice chcDist, chcDiff, chcTerr;
+	private mCheckBox chkFound, chkNotFound, chkTrad, chkVirtual, chkEvent, chkEarth, chkMega,
+					  chkOwned, chkNotOwned, chkMulti, chkLetter, chkWebcam, chkMystery, chkLocless,
+	                  chkCustom,chkParking,	chkStage, chkQuestion, chkFinal, chkTrailhead, chkReference,
+					  chkMicro,chkSmall,chkRegular,chkLarge,chkVeryLarge,chkOther,
+	                  chkArchived,chkNotArchived, chkAvailable,chkNotAvailable,
+					  chkNW, chkNNW , chkN , chkNNE, chkNE, chkENE, chkE, chkESE, chkSE, chkSSE, chkS,
+					  chkSSW, chkSW, chkWSW, chkW, chkWNW, chkDeselect,chkSelect;
 	
-	CellPanel content = new CellPanel();
-	CellPanel pnlBearDist=new CellPanel();
-	CellPanel pnlAttributes=new CellPanel();
-	CellPanel pnlRatings=new CellPanel();
-	CellPanel pnlCacheTypes=new CellPanel();
-	CellPanel pnlContainer=new CellPanel();
-	CellPanel pnlSearch=new CellPanel();
-	CellPanel roseP = new CellPanel();
-	CardPanel cp=new CardPanel();
-	CellPanel pnlButtons=new CellPanel();
-	mButton btnBearing,btnTypes,btnAttributes,btnRatings,btnContainer,btnSearch;
+	private mInput inpDist, inpTerr, inpDiff;
+	
+	private CellPanel pnlBearDist=new CellPanel();
+	private CellPanel pnlAttributes=new CellPanel();
+	private CellPanel pnlRatings=new CellPanel();
+	private CellPanel pnlCacheTypes=new CellPanel();
+	private CellPanel pnlContainer=new CellPanel();
+	private CellPanel pnlSearch=new CellPanel();
+	private CellPanel pnlRose = new CellPanel();
+	private CellPanel pnlButtons=new CellPanel();
+	private CellPanel pnlAddi=new CellPanel();
+	private CardPanel cp=new CardPanel();
 
+	// A subclassed checkbox with a &quot;third&quot; state (=grey background).
+	// If all addi wpts are false or all addi wpts are true, the background is white
+	// If the addi wpt filter is a mixture of true/false, the bg is grey
+	// Thus the addi filter can be set in one of two ways: Using the single checkbox with all the other
+	// attributes, or using the multiple checkboxes for each addi waypoint type
+	private class myChkBox extends mCheckBox {
+		Color bgColor=Color.White;
+		myChkBox(String s) {super(s); }
+		public void doPaintSquare(Graphics g) {
+			int h = height;
+			g.setColor(bgColor);
+			int bx = text.length() == 0 ? 0 : 2;
+			int by = text.length() == 0 ? 0 : (h-boxWidth)/2+1;
+			g.fillRect(bx+2,by+2,boxWidth-4,boxWidth-4);
+			if (state || pressState){
+				Color c = Color.LightGray;
+				if (!pressState){
+					if (!state) 
+						c=bgColor;
+					else 
+						c=Color.Black;
+				}
+				Pen oldpen = g.setPen(new Pen(c,Pen.SOLID,2));
+				g.drawLine(bx+4,by+boxWidth-5,bx+boxWidth-5,by+4);
+				g.drawLine(bx+4,by+boxWidth-5,bx+4,by+boxWidth-10);
+//				g.drawLine(bx+3,by+3,bx+boxWidth-5,by+boxWidth-5);
+//				g.drawLine(bx+3,by+boxWidth-5,bx+boxWidth-5,by+3);
+				g.setPen(oldpen);
+			}
+			g.draw3DRect(new Rect(bx,by,boxWidth,boxWidth),	ButtonObject.checkboxEdge,true,null,Color.DarkGray);
+		}		
+	}
+	private myChkBox addiWptChk;
+	
 	private mButton addImg(String imgName) {
 		mButton mb=new mButton(new mImage(imgName)); mb.borderWidth=0; mb.modify(NotEditable|PreferredSizeOnly,0);
 		return mb;
@@ -50,7 +85,6 @@
 		lblTitle.backGround=new Color(127,127,127); 
 		lblTitle.foreGround=Color.White; 
 		lblTitle.setTag(INSETS,new Insets(2,0,4,0));
-		
 	}
 	
 	public FilterScreen() {
@@ -61,32 +95,32 @@
 		//////////////////////////
 		addTitle(pnlBearDist,MyLocale.getMsg(714,&quot;Bearings &amp; Distance&quot;));
 		pnlBearDist.addNext(new mLabel(MyLocale.getMsg(701,&quot;Distance: &quot;)),CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlBearDist.addNext(distChc = new mChoice(new String[]{&quot;&lt;=&quot;, &quot;&gt;=&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		pnlBearDist.addLast(distIn = new mInput(),CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlBearDist.addNext(chcDist = new mChoice(new String[]{&quot;&lt;=&quot;, &quot;&gt;=&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		pnlBearDist.addLast(inpDist = new mInput(),CellConstants.DONTSTRETCH, CellConstants.FILL);
 		pnlBearDist.addLast(new mLabel(&quot;&quot;));
-		roseP.addNext(NW = new mCheckBox(&quot;NW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(NNW = new mCheckBox(&quot;NNW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(N = new mCheckBox(&quot;N&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addLast(NNE = new mCheckBox(&quot;NNE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkNW = new mCheckBox(&quot;NW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkNNW = new mCheckBox(&quot;NNW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkN = new mCheckBox(&quot;N&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addLast(chkNNE = new mCheckBox(&quot;NNE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
 		
-		roseP.addNext(NE = new mCheckBox(&quot;NE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(ENE = new mCheckBox(&quot;ENE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(E = new mCheckBox(&quot;E &quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addLast(ESE = new mCheckBox(&quot;ESE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkNE = new mCheckBox(&quot;NE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkENE = new mCheckBox(&quot;ENE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkE = new mCheckBox(&quot;E &quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addLast(chkESE = new mCheckBox(&quot;ESE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
 
-		roseP.addNext(SE = new mCheckBox(&quot;SE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(SSE = new mCheckBox(&quot;SSE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(S = new mCheckBox(&quot;S&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addLast(SSW = new mCheckBox(&quot;SSW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkSE = new mCheckBox(&quot;SE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkSSE = new mCheckBox(&quot;SSE&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkS = new mCheckBox(&quot;S&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addLast(chkSSW = new mCheckBox(&quot;SSW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
 
-		roseP.addNext(SW = new mCheckBox(&quot;SW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(WSW = new mCheckBox(&quot;WSW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(W = new mCheckBox(&quot;W &quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addLast(WNW = new mCheckBox(&quot;WNW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
-		roseP.addNext(chkDeselect=new mCheckBox(MyLocale.getMsg(716,&quot;Deselect all&quot;)));
+		pnlRose.addNext(chkSW = new mCheckBox(&quot;SW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkWSW = new mCheckBox(&quot;WSW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkW = new mCheckBox(&quot;W &quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addLast(chkWNW = new mCheckBox(&quot;WNW&quot;),CellConstants.HSTRETCH, CellConstants.FILL);
+		pnlRose.addNext(chkDeselect=new mCheckBox(MyLocale.getMsg(716,&quot;Deselect all&quot;)));
 		chkDeselect.setTag(SPAN,new Dimension(2,1));
-		roseP.addLast(chkSelect=new mCheckBox(MyLocale.getMsg(717,&quot;Select all&quot;)));
-		pnlBearDist.addLast(roseP, CellConstants.STRETCH,CellConstants.FILL);
+		pnlRose.addLast(chkSelect=new mCheckBox(MyLocale.getMsg(717,&quot;Select all&quot;)));
+		pnlBearDist.addLast(pnlRose, CellConstants.STRETCH,CellConstants.FILL);
 		
 		//////////////////////////
 		// Panel 2 - Cache attributes
@@ -95,31 +129,31 @@
 		mLabel lblTitleAtt; 
 		pnlAttributes.addLast(lblTitleAtt=new mLabel(MyLocale.getMsg(715,&quot;Show all caches with status:&quot;)),HSTRETCH,FILL);
 		lblTitleAtt.setTag(SPAN,new Dimension(2,1));
-		pnlAttributes.addNext(archivedChk = new mCheckBox(MyLocale.getMsg(710,&quot;Archived&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlAttributes.addLast(notArchivedChk = new mCheckBox(&quot;Nicht archiviert&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addNext(chkArchived = new mCheckBox(MyLocale.getMsg(710,&quot;Archived&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addLast(chkNotArchived = new mCheckBox(&quot;Nicht archiviert&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
-		pnlAttributes.addNext(availableChk = new mCheckBox(&quot;Suchbar&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlAttributes.addLast(notAvailableChk = new mCheckBox(MyLocale.getMsg(711,&quot;Not available&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addNext(chkAvailable = new mCheckBox(&quot;Suchbar&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addLast(chkNotAvailable = new mCheckBox(MyLocale.getMsg(711,&quot;Not available&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
-		pnlAttributes.addNext(foundChk = new mCheckBox(MyLocale.getMsg(703,&quot;Found&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlAttributes.addLast(notFoundChk = new mCheckBox(&quot;Noch nicht gefunden&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addNext(chkFound = new mCheckBox(MyLocale.getMsg(703,&quot;Found&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addLast(chkNotFound = new mCheckBox(&quot;Noch nicht gefunden&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
-		pnlAttributes.addNext(ownedChk = new mCheckBox(MyLocale.getMsg(707,&quot;Owned&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlAttributes.addLast(notOwnedChk = new mCheckBox(&quot;Anderer Besitzer&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addNext(chkOwned = new mCheckBox(MyLocale.getMsg(707,&quot;Owned&quot;)), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAttributes.addLast(chkNotOwned = new mCheckBox(&quot;Anderer Besitzer&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 
 		//////////////////////////
 		// Panel 3 - Cache ratings
 		//////////////////////////
 		addTitle(pnlRatings,MyLocale.getMsg(718,&quot;Cache ratings&quot;));
 		pnlRatings.addNext(new mLabel(MyLocale.getMsg(702,&quot;Difficulty: &quot;)),CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlRatings.addNext(difChc = new mChoice(new String[]{&quot;&lt;=&quot;,&quot;=&quot;, &quot;&gt;=&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		pnlRatings.addNext(chcDiff = new mChoice(new String[]{&quot;&lt;=&quot;,&quot;=&quot;, &quot;&gt;=&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		//pnlRatings.addLast(difIn = new mChoice(new String[]{&quot;1.0&quot;, &quot;1.5&quot;, &quot;2.0&quot;, &quot;2.5&quot;, &quot;3.0&quot;, &quot;3.5&quot;, &quot;4.0&quot;, &quot;4.5&quot;, &quot;5.0&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		pnlRatings.addLast(difIn = new mInput(),CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlRatings.addLast(inpDiff = new mInput(),CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlRatings.addNext(new mLabel(&quot;Terrain: &quot;),CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlRatings.addNext(terrChc = new mChoice(new String[]{&quot;&lt;=&quot;, &quot;=&quot;, &quot;&gt;=&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		pnlRatings.addNext(chcTerr = new mChoice(new String[]{&quot;&lt;=&quot;, &quot;=&quot;, &quot;&gt;=&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		//pnlRatings.addLast(terrIn = new mChoice(new String[]{&quot;1.0&quot;, &quot;1.5&quot;, &quot;2.0&quot;, &quot;2.5&quot;, &quot;3.0&quot;, &quot;3.5&quot;, &quot;4.0&quot;, &quot;4.5&quot;, &quot;5.0&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		pnlRatings.addLast(terrIn = new mInput(),CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlRatings.addLast(inpTerr = new mInput(),CellConstants.DONTSTRETCH, CellConstants.FILL);
 
 		//////////////////////////
 		// Panel 4 - Cache types
@@ -127,61 +161,79 @@
 		
 		addTitle(pnlCacheTypes,MyLocale.getMsg(719,&quot;Cache types&quot;));
 		pnlCacheTypes.addNext(addImg(&quot;2.png&quot;));
-		pnlCacheTypes.addNext(tradChk = new mCheckBox(&quot;Traditonal&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addNext(chkTrad = new mCheckBox(&quot;Traditonal&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;3.png&quot;));
-		pnlCacheTypes.addLast(multiChk = new mCheckBox(&quot;Multi&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addLast(chkMulti = new mCheckBox(&quot;Multi&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;4.png&quot;));
-		pnlCacheTypes.addNext(virtualChk = new mCheckBox(&quot;Virtual&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addNext(chkVirtual = new mCheckBox(&quot;Virtual&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;5.png&quot;));
-		pnlCacheTypes.addLast(letterChk = new mCheckBox(&quot;Letterbox&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addLast(chkLetter = new mCheckBox(&quot;Letterbox&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;6.png&quot;));
-		pnlCacheTypes.addNext(eventChk = new mCheckBox(&quot;Event&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addNext(chkEvent = new mCheckBox(&quot;Event&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;11.png&quot;));
-		pnlCacheTypes.addLast(webcamChk = new mCheckBox(&quot;Webcam&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addLast(chkWebcam = new mCheckBox(&quot;Webcam&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;8.png&quot;));
-		pnlCacheTypes.addNext(mysteryChk = new mCheckBox(&quot;Mystery&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addNext(chkMystery = new mCheckBox(&quot;Mystery&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;137.png&quot;));
-		pnlCacheTypes.addLast(earthChk = new mCheckBox(&quot;Earth&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addLast(chkEarth = new mCheckBox(&quot;Earth&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;12.png&quot;));
-		pnlCacheTypes.addNext(loclessChk = new mCheckBox(&quot;Locationless&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addNext(chkLocless = new mCheckBox(&quot;Locationless&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
 		pnlCacheTypes.addNext(addImg(&quot;453.png&quot;));
-		pnlCacheTypes.addLast(megaChk = new mCheckBox(&quot;Mega-Ev.&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheTypes.addLast(chkMega = new mCheckBox(&quot;Mega-Ev.&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		
+		//pnlCacheTypes.addLast(addiWptChk = new mCheckBox(&quot;Add. Wpt&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		//pnlCacheTypes.addLast(new mLabel(&quot;&quot;));
+		pnlCacheTypes.addNext(addImg(&quot;0.png&quot;));
+		pnlCacheTypes.addNext(chkCustom = new mCheckBox(&quot;Custom&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+
 		pnlCacheTypes.addNext(addImg(&quot;110.png&quot;));
-		pnlCacheTypes.addLast(addiWptChk = new mCheckBox(&quot;Add. Wpt&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
-		pnlCacheTypes.addLast(new mLabel(&quot;&quot;));
+		pnlCacheTypes.addLast(addiWptChk = new myChkBox(&quot;Add. Wpt&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
 
+		//addiWptChk.modify(0,NotAnEditor);
 		//////////////////////////
-		// Panel 5 - Cache container
+		// Panel 5 - Addi waypoints
 		//////////////////////////
-		addTitle(pnlContainer,MyLocale.getMsg(720,&quot;Cache container&quot;));
-		pnlContainer.addLast(new mLabel(&quot;To be implemented&quot;));
+		addTitle(pnlAddi,MyLocale.getMsg(726,&quot;Additional waypoints&quot;));
+		pnlAddi.addNext(addImg(&quot;pkg.png&quot;));
+		pnlAddi.addNext(chkParking = new mCheckBox(&quot;Parking&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAddi.addNext(addImg(&quot;stage.png&quot;));
+		pnlAddi.addLast(chkStage = new mCheckBox(&quot;Stage&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAddi.addNext(addImg(&quot;puzzle.png&quot;));
+		pnlAddi.addNext(chkQuestion = new mCheckBox(&quot;Question&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAddi.addNext(addImg(&quot;flag.png&quot;));
+		pnlAddi.addLast(chkFinal = new mCheckBox(&quot;Final&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAddi.addNext(addImg(&quot;trailhead.png&quot;));
+		pnlAddi.addNext(chkTrailhead = new mCheckBox(&quot;Trailhead&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlAddi.addNext(addImg(&quot;waypoint.png&quot;));
+		pnlAddi.addLast(chkReference = new mCheckBox(&quot;Reference&quot;), CellConstants.DONTSTRETCH, CellConstants.FILL);
+        pnlAddi.addLast(new mLabel(&quot;&quot;),VSTRETCH,FILL);		
+
+		//////////////////////////
+		// Panel 6 - Cache container
+		//////////////////////////
+		addTitle(pnlContainer,MyLocale.getMsg(727,&quot;Cache container&quot;));
+		pnlContainer.addLast(chkMicro=new mCheckBox(&quot;Micro&quot;));
+		pnlContainer.addLast(chkSmall=new mCheckBox(&quot;Small&quot;));
+		pnlContainer.addLast(chkRegular=new mCheckBox(&quot;Regular&quot;));
+		pnlContainer.addLast(chkLarge=new mCheckBox(&quot;Large&quot;));
+		pnlContainer.addLast(chkVeryLarge=new mCheckBox(&quot;Very Large&quot;));
+		pnlContainer.addLast(chkOther=new mCheckBox(&quot;Other&quot;));
 		
 		//////////////////////////
-		// Panel 6 - Search
+		// Panel 7 - Search
 		//////////////////////////
 		addTitle(pnlSearch,&quot;Search&quot;);
 		pnlSearch.addLast(new mLabel(&quot;To be implemented&quot;));
 		
-		lastChc = new mChoice(new String[]{MyLocale.getMsg(703,&quot;Found&quot;), MyLocale.getMsg(704,&quot;Not found&quot;)},0);
-		lastIn = new mInput();
-		foundIn = new mInput();
-/*		content.addNext(lastChc,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		content.addNext(new mLabel(MyLocale.getMsg(705,&quot; last &quot;)),CellConstants.DONTSTRETCH, CellConstants.FILL);
-		content.addLast(lastIn,CellConstants.DONTSTRETCH, CellConstants.FILL);
-		
-		content.addNext(new mLabel(MyLocale.getMsg(706,&quot;Found by: &quot;)),CellConstants.DONTSTRETCH, CellConstants.FILL);
-		content.addLast(foundIn,CellConstants.DONTSTRETCH, CellConstants.FILL);
-*/		
 		Frame frmScreen=new Frame();
 		mLabel lblInfo; 
 		frmScreen.addLast(lblInfo=new mLabel(MyLocale.getMsg(725,&quot;Note: Filters are additive, active filter=green&quot;))).setTag(SPAN,new Dimension(2,1));
@@ -195,7 +247,8 @@
 		pnlButtons.addLast(btnAttributes=new mButton(MyLocale.getMsg(720,&quot;Attributes&quot;)));
 		pnlButtons.addLast(btnRatings=new mButton(MyLocale.getMsg(722,&quot;Ratings&quot;)));
 		pnlButtons.addLast(btnTypes=new mButton(MyLocale.getMsg(723,&quot;Types&quot;))); 
-		pnlButtons.addLast(btnContainer=new mButton(MyLocale.getMsg(724,&quot;Container&quot;))); btnContainer.modify(Disabled,0);
+		pnlButtons.addLast(btnAddi=new mButton(&quot;Addi Wpt&quot;)); 
+		pnlButtons.addLast(btnContainer=new mButton(MyLocale.getMsg(724,&quot;Container&quot;)));
 		pnlButtons.addLast(btnSearch=new mButton(&quot;Search&quot;)); btnSearch.modify(Disabled,0);
 		addNext(pnlButtons,HSTRETCH,FILL);
 
@@ -203,108 +256,99 @@
 		cp.addItem(pnlAttributes,&quot;Att&quot;,null);
 		cp.addItem(pnlRatings,&quot;DT&quot;,null); 
 		cp.addItem(pnlCacheTypes,&quot;Type&quot;,null);
+		cp.addItem(pnlAddi,&quot;Addi&quot;,null);
 		cp.addItem(pnlContainer,&quot;Size&quot;,null);
 		cp.addItem(pnlSearch,&quot;Search&quot;,null);
 		addLast(cp);
 
 		CellPanel btPanel = new CellPanel();
-		btPanel.addNext(btCancel = new mButton(MyLocale.getMsg(708,&quot;Cancel&quot;)),CellConstants.STRETCH, CellConstants.FILL);
-		btPanel.addNext(btApply = new mButton(MyLocale.getMsg(709,&quot;Apply&quot;)),CellConstants.STRETCH, CellConstants.FILL);
-		btPanel.addLast(btRoute = new mButton(&quot;Route&quot;),CellConstants.STRETCH, CellConstants.FILL);
+		btPanel.addNext(btnCancel = new mButton(MyLocale.getMsg(708,&quot;Cancel&quot;)),CellConstants.STRETCH, CellConstants.FILL);
+		btPanel.addNext(btnApply = new mButton(MyLocale.getMsg(709,&quot;Apply&quot;)),CellConstants.STRETCH, CellConstants.FILL);
+		btPanel.addLast(btnRoute = new mButton(&quot;Route&quot;),CellConstants.STRETCH, CellConstants.FILL);
 		addLast(btPanel.setTag(Control.SPAN, new Dimension(3,1)), CellConstants.STRETCH, CellConstants.FILL);
 		setPreferredSize(240,240);
 		
 	}
 	
 	
-	public void setData(Vector DB, String d){
-		dir = d;
-		cacheDB = DB;
+	public void setData(){
 		Profile prof=Global.getProfile();
 
 		//////////////////////////
 		// Panel 1 - Bearing &amp; Distance
 		//////////////////////////
 		if (prof.filterDist.length()&gt;1) {
-			if (prof.filterDist.charAt(0)=='&lt;')
-				distChc.select(0);
+			if (prof.filterDist.charAt(0)=='L')
+				chcDist.select(0);
 			else
-				distChc.select(1);
-			distIn.setText(prof.filterDist.substring(1));
+				chcDist.select(1);
+			inpDist.setText(prof.filterDist.substring(1));
 		} else {
-			distChc.select(0);
-			distIn.setText(&quot;&quot;);
+			chcDist.select(0);
+			inpDist.setText(&quot;&quot;);
 		}
 		// If filter has been corrupted, pad it to 11 characters
 		String fltRose=prof.filterRose;
-		if (fltRose.length()&lt;16) { 
-			fltRose=(fltRose+&quot;1111111111111111&quot;).substring(0,16); 
-			prof.filterRose=fltRose; 
-		}  
-		NW.state   = fltRose.charAt(0) == '1';
-		NNW.state  = fltRose.charAt(1) == '1';
-		N.state    = fltRose.charAt(2) == '1';
-		NNE.state  = fltRose.charAt(3) == '1';
+		chkNW.state   = fltRose.charAt(0) == '1';
+		chkNNW.state  = fltRose.charAt(1) == '1';
+		chkN.state    = fltRose.charAt(2) == '1';
+		chkNNE.state  = fltRose.charAt(3) == '1';
 		
-		NE.state   = fltRose.charAt(4) == '1';
-		ENE.state  = fltRose.charAt(5) == '1';
-		E.state    = fltRose.charAt(6) == '1';
-		ESE.state  = fltRose.charAt(7) == '1';
+		chkNE.state   = fltRose.charAt(4) == '1';
+		chkENE.state  = fltRose.charAt(5) == '1';
+		chkE.state    = fltRose.charAt(6) == '1';
+		chkESE.state  = fltRose.charAt(7) == '1';
 
-		SE.state   = fltRose.charAt(8) == '1';
-		SSE.state  = fltRose.charAt(9) == '1';
-		S.state    = fltRose.charAt(10) == '1';
-		SSW.state  = fltRose.charAt(11) == '1';
+		chkSE.state   = fltRose.charAt(8) == '1';
+		chkSSE.state  = fltRose.charAt(9) == '1';
+		chkS.state    = fltRose.charAt(10) == '1';
+		chkSSW.state  = fltRose.charAt(11) == '1';
 
-		SW.state   = fltRose.charAt(12) == '1';
-		WSW.state  = fltRose.charAt(13) == '1';
-		W.state    = fltRose.charAt(14) == '1';
-		WNW.state  = fltRose.charAt(15) == '1';
+		chkSW.state   = fltRose.charAt(12) == '1';
+		chkWSW.state  = fltRose.charAt(13) == '1';
+		chkW.state    = fltRose.charAt(14) == '1';
+		chkWNW.state  = fltRose.charAt(15) == '1';
 		
 		//////////////////////////
 		// Panel 2 - Cache attributes
 		//////////////////////////
 		String fltVar=prof.filterVar;
-		if (fltVar.length()&lt;8) { 
-			fltVar=(fltVar+&quot;11111111&quot;).substring(0,8); 
-			prof.filterVar=fltVar; 
-		}  
-		archivedChk.state      = fltVar.charAt(0) == '1';
-		availableChk.state     = fltVar.charAt(1) == '1';
-		foundChk.state         = fltVar.charAt(2) == '1';
-		ownedChk.state         = fltVar.charAt(3) == '1';
-		notArchivedChk.state   = fltVar.charAt(4) == '1';
-		notAvailableChk.state  = fltVar.charAt(5) == '1';
-		notFoundChk.state      = fltVar.charAt(6) == '1';
-		notOwnedChk.state      = fltVar.charAt(7) == '1';
+		chkArchived.state      = fltVar.charAt(0) == '1';
+		chkAvailable.state     = fltVar.charAt(1) == '1';
+		chkFound.state         = fltVar.charAt(2) == '1';
+		chkOwned.state         = fltVar.charAt(3) == '1';
+		chkNotArchived.state   = fltVar.charAt(4) == '1';
+		chkNotAvailable.state  = fltVar.charAt(5) == '1';
+		chkNotFound.state      = fltVar.charAt(6) == '1';
+		chkNotOwned.state      = fltVar.charAt(7) == '1';
 
 		//////////////////////////
 		// Panel 3 - Cache ratings
 		//////////////////////////
 		if (prof.filterDiff.length()&gt;1) {
-			if (prof.filterDiff.charAt(0)=='&lt;')
-				difChc.select(0);
+			if (prof.filterDiff.charAt(0)=='L')
+				chcDiff.select(0);
 			else if (prof.filterDiff.charAt(0)=='=')
-				difChc.select(1);
+				chcDiff.select(1);
 			else
-				difChc.select(2);
-			difIn.setText(prof.filterDiff.substring(1));
+				chcDiff.select(2);
+			inpDiff.setText(prof.filterDiff.substring(1));
 		} else {
-			difChc.select(0);
-			difIn.setText(&quot;&quot;);
+			chcDiff.select(0);
+			inpDiff.setText(&quot;&quot;);
 		}
 
 		if (prof.filterTerr.length()&gt;1) {
-			if (prof.filterTerr.charAt(0)=='&lt;')
-				terrChc.select(0);
+			if (prof.filterTerr.charAt(0)=='L')
+				chcTerr.select(0);
 			else if (prof.filterTerr.charAt(0)=='=')
-				terrChc.select(1);
+				chcTerr.select(1);
 			else
-				terrChc.select(2);
-			terrIn.setText(prof.filterTerr.substring(1));
+				chcTerr.select(2);
+			inpTerr.setText(prof.filterTerr.substring(1));
 		} else {
-			terrChc.select(0);
-			terrIn.setText(&quot;&quot;);
+			chcTerr.select(0);
+			inpTerr.setText(&quot;&quot;);
 		}
 
 
@@ -312,30 +356,44 @@
 		// Panel 4 - Cache types
 		//////////////////////////
 		
-		// If filter has been corrupted, pad it to 11 characters
 		String fltType=prof.filterType;
-		if (fltType.length()&lt;11) { 
-			fltType=(fltType+&quot;11111111111&quot;).substring(0,11); 
-			prof.filterType=fltType; 
-		}  
-		tradChk.state    = fltType.charAt(0) == '1';
-		multiChk.state   = fltType.charAt(1) == '1';
-		virtualChk.state = fltType.charAt(2) == '1';
-		letterChk.state  = fltType.charAt(3) == '1';
-		eventChk.state   = fltType.charAt(4) == '1';
-		webcamChk.state  = fltType.charAt(5) == '1';
-		mysteryChk.state = fltType.charAt(6) == '1';
-		earthChk.state   = fltType.charAt(7) == '1';
-		loclessChk.state = fltType.charAt(8) == '1';
-		megaChk.state    = fltType.charAt(9) == '1';
-		addiWptChk.state = fltType.charAt(10) == '1';
+		chkTrad.state       = fltType.charAt(0) == '1';
+		chkMulti.state      = fltType.charAt(1) == '1';
+		chkVirtual.state    = fltType.charAt(2) == '1';
+		chkLetter.state     = fltType.charAt(3) == '1';
+		chkEvent.state      = fltType.charAt(4) == '1';
+		chkWebcam.state     = fltType.charAt(5) == '1';
+		chkMystery.state    = fltType.charAt(6) == '1';
+		chkEarth.state      = fltType.charAt(7) == '1';
+		chkLocless.state    = fltType.charAt(8) == '1';
+		chkMega.state       = fltType.charAt(9) == '1';
+		chkCustom.state     = fltType.charAt(10) == '1';
+		// Note addiWptState is set by setColors
+		
+		//////////////////////////
+		// Panel 5 - Additional waypoints
+		//////////////////////////
+		chkParking.state    = fltType.charAt(11) == '1';	
+		chkStage.state      = fltType.charAt(12) == '1'; 
+		chkQuestion.state   = fltType.charAt(13) == '1'; 
+		chkFinal.state      = fltType.charAt(14) == '1'; 
+		chkTrailhead.state  = fltType.charAt(15) == '1'; 
+		chkReference.state  = fltType.charAt(16) == '1';
+		addiWptChk.state= !fltType.substring(11,17).equals(&quot;000000&quot;);
 
 		//////////////////////////
-		// Panel 5 - Cache container
+		// Panel 6 - Cache container
 		//////////////////////////
+		String fltSize=prof.filterSize;
+		chkMicro.state      = fltSize.charAt(0) == '1';
+		chkSmall.state      = fltSize.charAt(1) == '1';
+		chkRegular.state    = fltSize.charAt(2) == '1';
+		chkLarge.state      = fltSize.charAt(3) == '1';
+		chkVeryLarge.state  = fltSize.charAt(4) == '1';
+		chkOther.state      = fltSize.charAt(5) == '1';
 		
 		//////////////////////////
-		// Panel 6 - Search
+		// Panel 7 - Search
 		//////////////////////////
 		
 		// Adjust colors of buttons depending on which filters are active
@@ -345,43 +403,94 @@
 	// Set the colors of the filter buttons according to which filters are active
 	private void setColors() {
 		// Panel 1 - Bearing &amp; Distance
-		if (distIn.getText().length()&gt;0 || 
-			  !(NW.getState() &amp;&amp; NNW.getState() &amp;&amp; N.getState() &amp;&amp; NNE.getState() &amp;&amp;
-				NE.getState() &amp;&amp; ENE.getState() &amp;&amp; E.getState() &amp;&amp; ESE.getState() &amp;&amp;
-				SE.getState() &amp;&amp; SSE.getState() &amp;&amp; S.getState() &amp;&amp; SSW.getState() &amp;&amp;
-				SW.getState() &amp;&amp; WSW.getState() &amp;&amp; W.getState() &amp;&amp; WNW.getState()))
+		if (inpDist.getText().length()&gt;0 || 
+			  !(chkNW.state &amp;&amp; chkNNW.state &amp;&amp; chkN.state &amp;&amp; chkNNE.state &amp;&amp;
+				chkNE.state &amp;&amp; chkENE.state &amp;&amp; chkE.state &amp;&amp; chkESE.state &amp;&amp;
+				chkSE.state &amp;&amp; chkSSE.state &amp;&amp; chkS.state &amp;&amp; chkSSW.state &amp;&amp;
+				chkSW.state &amp;&amp; chkWSW.state &amp;&amp; chkW.state &amp;&amp; chkWNW.state))
 			btnBearing.backGround=COLOR_FILTERACTIVE;
 		else
 			btnBearing.backGround=COLOR_FILTERINACTIVE;
+		if (  !(chkNW.state || chkNNW.state || chkN.state || chkNNE.state ||
+				chkNE.state || chkENE.state || chkE.state || chkESE.state ||
+				chkSE.state || chkSSE.state || chkS.state || chkSSW.state ||
+				chkSW.state || chkWSW.state || chkW.state || chkWNW.state))
+			btnBearing.backGround=COLOR_FILTERALL;
 		btnBearing.repaint();
 		
 		// Panel 2 - Cache attributes
-		if (!( archivedChk.getState()    &amp;&amp; availableChk.getState()    &amp;&amp; foundChk.getState()    &amp;&amp; ownedChk.getState() &amp;&amp;
-			   notArchivedChk.getState() &amp;&amp; notAvailableChk.getState() &amp;&amp; notFoundChk.getState() &amp;&amp; notOwnedChk.getState()))
+		if (!( chkArchived.state    &amp;&amp; chkAvailable.state    &amp;&amp; chkFound.state    &amp;&amp; chkOwned.state &amp;&amp;
+			   chkNotArchived.state &amp;&amp; chkNotAvailable.state &amp;&amp; chkNotFound.state &amp;&amp; chkNotOwned.state))
 			btnAttributes.backGround=COLOR_FILTERACTIVE;
 		else
 			btnAttributes.backGround=COLOR_FILTERINACTIVE;
+		if ((chkArchived.state==false &amp;&amp; chkNotArchived.state==false) || 
+			    (chkAvailable.state==false &amp;&amp; chkNotAvailable.state==false) ||
+			    (chkFound.state==false &amp;&amp; chkNotFound.state==false) ||
+			    (chkOwned.state==false &amp;&amp; chkNotOwned.state==false)) 
+			btnAttributes.backGround=COLOR_FILTERALL;
 		btnAttributes.repaint();
 		
 		// Panel 3 - Cache ratings
-		if (difIn.getText().length()&gt;0 || terrIn.getText().length()&gt;0)
+		if (inpDiff.getText().length()&gt;0 || inpTerr.getText().length()&gt;0)
 			btnRatings.backGround=COLOR_FILTERACTIVE;
 		else
 			btnRatings.backGround=COLOR_FILTERINACTIVE;
 		btnRatings.repaint();
 
+		// Panel 5 - Addi Waypoints
+		if (chkParking.state || chkStage.state || chkQuestion.state || 
+			chkFinal.state || chkTrailhead.state || chkReference.state )
+			btnAddi.backGround=COLOR_FILTERACTIVE;
+		else
+			btnAddi.backGround=COLOR_FILTERINACTIVE;
+		btnAddi.repaint();
+
 		// Panel 4 - Cache types
-		if (!(tradChk.getState() &amp;&amp; multiChk.getState() &amp;&amp; 	virtualChk.getState() &amp;&amp; letterChk.getState() &amp;&amp;
-		      eventChk.getState() &amp;&amp; webcamChk.getState() &amp;&amp; mysteryChk.getState() &amp;&amp; earthChk.getState() &amp;&amp;
-		      loclessChk.getState() &amp;&amp; megaChk.getState() &amp;&amp; !addiWptChk.getState())) 
+		if (!(chkTrad.state &amp;&amp; chkMulti.state &amp;&amp; 	chkVirtual.state &amp;&amp; chkLetter.state &amp;&amp;
+		      chkEvent.state &amp;&amp; chkWebcam.state &amp;&amp; chkMystery.state &amp;&amp; chkEarth.state &amp;&amp;
+		      chkLocless.state &amp;&amp; chkMega.state &amp;&amp; chkCustom.state) ) 
 			btnTypes.backGround=COLOR_FILTERACTIVE;
 		else
 			btnTypes.backGround=COLOR_FILTERINACTIVE;
+		if (!(chkTrad.state || chkMulti.state || 	chkVirtual.state || chkLetter.state ||
+			      chkEvent.state || chkWebcam.state || chkMystery.state || chkEarth.state ||
+			      chkLocless.state || chkMega.state || chkCustom.state || chkParking.state 
+			      || chkStage.state || chkQuestion.state || 
+					chkFinal.state || chkTrailhead.state || chkReference.state )) 
+			btnTypes.backGround=COLOR_FILTERALL;
 		btnTypes.repaint();
 
-		// Panel 5 - Cache container
-
-		// Panel 6 - Search
+		// Panel 5 - Addi Waypoints
+		if (chkParking.state || chkStage.state || chkQuestion.state || 
+			chkFinal.state || chkTrailhead.state || chkReference.state ) { // At least one tick
+			btnAddi.backGround=COLOR_FILTERACTIVE;
+			addiWptChk.state=true;
+			if (chkParking.state &amp;&amp; chkStage.state &amp;&amp;  chkQuestion.state &amp;&amp; 
+				chkFinal.state &amp;&amp; chkTrailhead.state &amp;&amp; chkReference.state ) { // All ticked?
+				addiWptChk.bgColor=Color.White;
+			} else {	
+				addiWptChk.bgColor=Color.LightGray;
+			}
+		} else { // All not ticked
+			btnAddi.backGround=COLOR_FILTERINACTIVE;
+			addiWptChk.bgColor=Color.White;
+			addiWptChk.state=false;
+		}
+		btnAddi.repaint();
+			
+		// Panel 6 - Cache container
+		if (!(chkMicro.state &amp;&amp; chkSmall.state &amp;&amp; chkRegular.state &amp;&amp; 
+			  chkLarge.state &amp;&amp; chkVeryLarge.state &amp;&amp; chkOther.state))
+			  btnContainer.backGround=COLOR_FILTERACTIVE;
+		else
+			  btnContainer.backGround=COLOR_FILTERINACTIVE;
+		if (!(chkMicro.state || chkSmall.state || chkRegular.state || 
+				  chkLarge.state || chkVeryLarge.state || chkOther.state))
+			  btnContainer.backGround=COLOR_FILTERALL;
+		btnContainer.repaint();
+			
+		// Panel 7 - Search
 		
 	}
 	
@@ -391,13 +500,13 @@
 	*/
 	public void onEvent(Event ev){
 		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED){
-			if (ev.target == btCancel){
+			if (ev.target == btnCancel){
 				this.close(0);
 			}
-			else if (ev.target == btRoute){
+			else if (ev.target == btnRoute){
 				
 				File datei;
-				FileChooser fc = new FileChooser(FileChooser.OPEN, dir);
+				FileChooser fc = new FileChooser(FileChooser.OPEN, Global.getProfile().dataDir);
 				fc.setTitle(MyLocale.getMsg(712,&quot;Select route file&quot;));
 				if(fc.execute() != FormBase.IDCANCEL) {
 					datei = fc.getChosenFile();
@@ -405,178 +514,141 @@
 					inf.execute();
 					Vm.showWait(true);
 					Filter flt = new Filter();
-					flt.routeFile = datei;
-					flt.doFilterRoute(cacheDB, dir, Convert.toDouble(inf.feedback.getText()));
+					flt.doFilterRoute(datei, Convert.toDouble(inf.feedback.getText()));
 				}
 				Vm.showWait(false);
 				this.close(0);
 				
 			}
-			else if (ev.target == btApply){
+			else if (ev.target == btnApply){
 				Vm.showWait(true);
 				//Save filter required
-				Filter flt = new Filter();
-				flt.foundByMe = foundChk.getState();
-				flt.notFoundByMe = notFoundChk.getState();
-				flt.ownedByMe = ownedChk.getState();
-				flt.notOwnedByMe = notOwnedChk.getState();
+				Profile pfl = Global.getProfile();
+				pfl.filterVar = (chkArchived.state    ? &quot;1&quot; : &quot;0&quot;) +
+							(chkAvailable.state   ? &quot;1&quot; : &quot;0&quot;) +
+							(chkFound.state       ? &quot;1&quot; : &quot;0&quot;) +
+							(chkOwned.state       ? &quot;1&quot; : &quot;0&quot;) +
+							(chkNotArchived.state ? &quot;1&quot; : &quot;0&quot;) +
+							(chkNotAvailable.state? &quot;1&quot; : &quot;0&quot;) +
+							(chkNotFound.state    ? &quot;1&quot; : &quot;0&quot;) +
+							(chkNotOwned.state    ? &quot;1&quot; : &quot;0&quot;);							
+				pfl.filterType =(chkTrad.state    ? &quot;1&quot; : &quot;0&quot;) +
+								(chkMulti.state   ? &quot;1&quot; : &quot;0&quot;) +
+								(chkVirtual.state ? &quot;1&quot; : &quot;0&quot;) +
+								(chkLetter.state  ? &quot;1&quot; : &quot;0&quot;) +
+								(chkEvent.state   ? &quot;1&quot; : &quot;0&quot;) + 
+								(chkWebcam.state  ? &quot;1&quot; : &quot;0&quot;) +
+								(chkMystery.state ? &quot;1&quot; : &quot;0&quot;) +
+								(chkEarth.state   ? &quot;1&quot; : &quot;0&quot;) +
+								(chkLocless.state ? &quot;1&quot; : &quot;0&quot;) +
+								(chkMega.state    ? &quot;1&quot; : &quot;0&quot;) +
+								(chkCustom.state  ? &quot;1&quot; : &quot;0&quot;) +
+								(chkParking.state ? &quot;1&quot; : &quot;0&quot;) +
+								(chkStage.state   ? &quot;1&quot; : &quot;0&quot;) +
+								(chkQuestion.state? &quot;1&quot; : &quot;0&quot;) +
+								(chkFinal.state   ? &quot;1&quot; : &quot;0&quot;) +
+								(chkTrailhead.state ? &quot;1&quot; : &quot;0&quot;) +
+								(chkReference.state ? &quot;1&quot; : &quot;0&quot;);
 				
-				flt.dist = distIn.getText();
-				flt.diff = difIn.getText();
-				flt.terr = terrIn.getText();
-				flt.days = lastIn.getText();
-				flt.by = foundIn.getText();
-				flt.available = availableChk.getState();
-				flt.notAvailable = notAvailableChk.getState();
-				flt.archived = archivedChk.getState();
-				flt.notArchived = notArchivedChk.getState();
-				String filterType;
-				String filterVar;
-				String filterRose;
-				filterVar = (archivedChk.getState()    ? &quot;1&quot; : &quot;0&quot;) +
-							(availableChk.getState()   ? &quot;1&quot; : &quot;0&quot;) +
-							(foundChk.getState()       ? &quot;1&quot; : &quot;0&quot;) +
-							(ownedChk.getState()       ? &quot;1&quot; : &quot;0&quot;) +
-							(notArchivedChk.getState() ? &quot;1&quot; : &quot;0&quot;) +
-							(notAvailableChk.getState()? &quot;1&quot; : &quot;0&quot;) +
-							(notFoundChk.getState()    ? &quot;1&quot; : &quot;0&quot;) +
-							(notOwnedChk.getState()    ? &quot;1&quot; : &quot;0&quot;);							
-							
-				int typeMatchPattern = 0;
-				if(tradChk.getState()) typeMatchPattern |= Filter.TRADITIONAL;
-				if(multiChk.getState()) typeMatchPattern |= Filter.MULTI;
-				if(virtualChk.getState()) typeMatchPattern |= Filter.VIRTUAL;
-				if(letterChk.getState()) typeMatchPattern |= Filter.LETTER;
-				if(eventChk.getState()) typeMatchPattern |= Filter.EVENT;
-				if(webcamChk.getState()) typeMatchPattern |= Filter.WEBCAM;
-				if(mysteryChk.getState()) typeMatchPattern |= Filter.MYSTERY;
-				if(loclessChk.getState()) typeMatchPattern |= Filter.LOCLESS;
-				if(addiWptChk.getState()) typeMatchPattern |= Filter.ADDIWPT;
-				if(earthChk.getState()) typeMatchPattern |= Filter.EARTH;
-				if(megaChk.getState()) typeMatchPattern |= Filter.MEGA;
-				flt.typeMatchPattern = typeMatchPattern;
-				filterType = 	(tradChk.getState()    ? &quot;1&quot; : &quot;0&quot;) +
-								(multiChk.getState()   ? &quot;1&quot; : &quot;0&quot;) +
-								(virtualChk.getState() ? &quot;1&quot; : &quot;0&quot;) +
-								(letterChk.getState()  ? &quot;1&quot; : &quot;0&quot;) +
-								(eventChk.getState()   ? &quot;1&quot; : &quot;0&quot;) + 
-								(webcamChk.getState()  ? &quot;1&quot; : &quot;0&quot;) +
-								(mysteryChk.getState() ? &quot;1&quot; : &quot;0&quot;) +
-								(earthChk.getState()   ? &quot;1&quot; : &quot;0&quot;) +
-								(loclessChk.getState() ? &quot;1&quot; : &quot;0&quot;) +
-								(megaChk.getState()    ? &quot;1&quot; : &quot;0&quot;) +
-								(addiWptChk.getState() ? &quot;1&quot; : &quot;0&quot;);
+				pfl.filterRose = (chkNW.state  ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkNNW.state ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkN.state   ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkNNE.state ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkNE.state  ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkENE.state ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkE.state   ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkESE.state ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkSE.state  ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkSSE.state ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkS.state   ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkSSW.state ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkSW.state  ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkWSW.state ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkW.state   ? &quot;1&quot;:&quot;0&quot;)+
+							 (chkWNW.state ? &quot;1&quot;:&quot;0&quot;);
+				pfl.filterSize =(chkMicro.state ? &quot;1&quot; : &quot;0&quot;)+
+							(chkSmall.state ? &quot;1&quot; : &quot;0&quot;)+
+							(chkRegular.state ? &quot;1&quot; : &quot;0&quot;)+
+							(chkLarge.state ? &quot;1&quot; : &quot;0&quot;)+
+							(chkVeryLarge.state ? &quot;1&quot; : &quot;0&quot;)+
+							(chkOther.state ? &quot;1&quot; : &quot;0&quot;);
 				
-				int roseMatchPattern = 0;
-				if(N.getState())   roseMatchPattern |= Filter.N;
-				if(NNE.getState()) roseMatchPattern |= Filter.NNE;
-				if(NE.getState())  roseMatchPattern |= Filter.NE;
-				if(ENE.getState()) roseMatchPattern |= Filter.ENE;
-				if(E.getState())   roseMatchPattern |= Filter.E;
-				if(ESE.getState()) roseMatchPattern |= Filter.ESE;
-				if(SE.getState())  roseMatchPattern |= Filter.SE;
-				if(SSE.getState()) roseMatchPattern |= Filter.SSE;
-				if(SSW.getState()) roseMatchPattern |= Filter.SSW;
-				if(SW.getState())  roseMatchPattern |= Filter.SW;
-				if(WSW.getState()) roseMatchPattern |= Filter.WSW;
-				if(W.getState())   roseMatchPattern |= Filter.W;
-				if(WNW.getState()) roseMatchPattern |= Filter.WNW;
-				if(NW.getState())  roseMatchPattern |= Filter.NW;
-				if(NNW.getState()) roseMatchPattern |= Filter.NNW;
-				if(S.getState())   roseMatchPattern |= Filter.S;
-				flt.roseMatchPattern = roseMatchPattern;
-				filterRose = (NW.getState()  ? &quot;1&quot;:&quot;0&quot;)+
-							 (NNW.getState() ? &quot;1&quot;:&quot;0&quot;)+
-							 (N.getState()   ? &quot;1&quot;:&quot;0&quot;)+
-							 (NNE.getState() ? &quot;1&quot;:&quot;0&quot;)+
-							 (NE.getState()  ? &quot;1&quot;:&quot;0&quot;)+
-							 (ENE.getState() ? &quot;1&quot;:&quot;0&quot;)+
-							 (E.getState()   ? &quot;1&quot;:&quot;0&quot;)+
-							 (ESE.getState() ? &quot;1&quot;:&quot;0&quot;)+
-							 (SE.getState()  ? &quot;1&quot;:&quot;0&quot;)+
-							 (SSE.getState() ? &quot;1&quot;:&quot;0&quot;)+
-							 (S.getState()   ? &quot;1&quot;:&quot;0&quot;)+
-							 (SSW.getState() ? &quot;1&quot;:&quot;0&quot;)+
-							 (SW.getState()  ? &quot;1&quot;:&quot;0&quot;)+
-							 (WSW.getState() ? &quot;1&quot;:&quot;0&quot;)+
-							 (W.getState()   ? &quot;1&quot;:&quot;0&quot;)+
-							 (WNW.getState() ? &quot;1&quot;:&quot;0&quot;);
-				
-				Profile pfl = Global.getProfile();
-				if(distChc.selectedIndex == 0) { 
-					flt.distdirec = Filter.SMALLER;
-					pfl.filterDist=&quot;&lt;&quot;+flt.dist;
+				if(chcDist.selectedIndex == 0) { 
+					pfl.filterDist=&quot;L&quot;+inpDist.getText();
 				} else { 
-					flt.distdirec = Filter.GREATER;
-					pfl.filterDist=&quot;&gt;&quot;+flt.dist;
+					pfl.filterDist=&quot;G&quot;+inpDist.getText();
 				}
 					
-				if(difChc.selectedIndex == 0) { 
-					flt.diffdirec = Filter.SMALLER;
-					pfl.filterDiff=&quot;&lt;&quot;+flt.diff;
-				} else if(difChc.selectedIndex == 1) { 
-					flt.diffdirec = Filter.EQUAL;
-					pfl.filterDiff=&quot;=&quot;+flt.diff;
+				if(chcDiff.selectedIndex == 0) { 
+					pfl.filterDiff=&quot;L&quot;+inpDiff.getText();
+				} else if(chcDiff.selectedIndex == 1) { 
+					pfl.filterDiff=&quot;=&quot;+inpDiff.getText();
 				} else {	
-					flt.diffdirec = Filter.GREATER;
-					pfl.filterDiff=&quot;&gt;&quot;+flt.diff;
+					pfl.filterDiff=&quot;G&quot;+inpDiff.getText();
 				}	
 					
-				if(terrChc.selectedIndex == 0) { 
-					flt.terrdirec = Filter.SMALLER;
-					pfl.filterTerr=&quot;&lt;&quot;+flt.terr;
-				} else if(terrChc.selectedIndex == 1){ 
-					flt.terrdirec = Filter.EQUAL;
-					pfl.filterTerr=&quot;=&quot;+flt.terr;
+				if(chcTerr.selectedIndex == 0) { 
+					pfl.filterTerr=&quot;L&quot;+inpTerr.getText();
+				} else if(chcTerr.selectedIndex == 1){ 
+					pfl.filterTerr=&quot;=&quot;+inpTerr.getText();
 				} else { 
-					flt.terrdirec = Filter.GREATER;
-					pfl.filterTerr=&quot;&gt;&quot;+flt.terr;
+					pfl.filterTerr=&quot;G&quot;+inpTerr.getText();
 				}
-				
-				if(lastChc.selectedIndex == 0) 
+/*				if(lastChc.selectedIndex == 0) 
 					flt.daysdirec = Filter.FOUND;
 				else 
 					flt.daysdirec = Filter.NOTFOUND;
-
+*/
 				// Need to think about saving it here. If yes, we also need to save filter when we clear it.
 				// Maybe better to auto-save index upon exit
 				//InfoBox infB = new InfoBox(&quot;Info&quot;,MyLocale.getMsg(713,&quot;Saving filter&quot;));
 				//infB.exec();
-				pfl.filterRose = filterRose;
-				pfl.filterType = filterType;
-				pfl.filterVar = filterVar;
 				//pfl.saveIndex(Global.getPref());
 				//infB.close(0);
-				flt.doFilter(cacheDB, dir);
+				Filter flt = new Filter();
+				flt.setFilter();
+				flt.doFilter();
 				Global.mainTab.tbP.tc.scrollToVisible(0,0);
 				Vm.showWait(false);
 				//Tabelle neu zeichnen lassen!
 				this.close(0);
-			}
-			else if (ev.target == btnBearing) cp.select(0);
+			} else if (ev.target == addiWptChk) { // Set all addi filters to value of main addi filter
+				chkParking.setState(addiWptChk.state);
+				chkStage.setState(addiWptChk.state);
+				chkQuestion.setState(addiWptChk.state);
+				chkFinal.setState(addiWptChk.state);
+				chkTrailhead.setState(addiWptChk.state);
+				chkReference.setState(addiWptChk.state);
+				addiWptChk.bgColor=Color.White;
+				addiWptChk.repaint();
+			} else if (ev.target == btnBearing) cp.select(0);
 			else if (ev.target == btnAttributes) cp.select(1);
 			else if (ev.target == btnRatings)cp.select(2);
 			else if (ev.target == btnTypes)cp.select(3);
-			else if (ev.target == btnContainer)cp.select(4);
-			else if (ev.target == btnSearch)cp.select(5);
+			else if (ev.target == btnAddi)cp.select(4);
+			else if (ev.target == btnContainer)cp.select(5);
+			else if (ev.target == btnSearch)cp.select(6);
 			else if (ev.target == chkDeselect) {
-				NW.state= NNW.state  = N.state    = NNE.state  = 
-				NE.state   = ENE.state  = E.state    = ESE.state  = 
-				SE.state   = SSE.state  = S.state    = SSW.state  = 
-				SW.state   = WSW.state  = W.state    = WNW.state = false; 
+				chkNW.state= chkNNW.state  = chkN.state    = chkNNE.state  = 
+				chkNE.state   = chkENE.state  = chkE.state    = chkESE.state  = 
+				chkSE.state   = chkSSE.state  = chkS.state    = chkSSW.state  = 
+				chkSW.state   = chkWSW.state  = chkW.state    = chkWNW.state = false; 
 				chkDeselect.state=false;
 				repaint();
 					
 			} else if (ev.target == chkSelect) {
-				NW.state= NNW.state  = N.state    = NNE.state  = 
-				NE.state   = ENE.state  = E.state    = ESE.state  = 
-				SE.state   = SSE.state  = S.state    = SSW.state  = 
-				SW.state   = WSW.state  = W.state    = WNW.state = true; 
+				chkNW.state= chkNNW.state  = chkN.state    = chkNNE.state  = 
+				chkNE.state   = chkENE.state  = chkE.state    = chkESE.state  = 
+				chkSE.state   = chkSSE.state  = chkS.state    = chkSSW.state  = 
+				chkSW.state   = chkWSW.state  = chkW.state    = chkWNW.state = true; 
 				chkSelect.state=false;
 				repaint();	
 			}
 		}
-		if (ev instanceof DataChangeEvent )	setColors();
+		if (ev instanceof DataChangeEvent )	{ 
+			setColors();
+		}
 
 	}
+
 }

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2007-02-04 13:23:47 UTC (rev 504)
+++ trunk/src/CacheWolf/MainMenu.java	2007-02-04 15:23:46 UTC (rev 505)
@@ -260,7 +260,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == filtCreate){
-				scnFilter.setData(cacheDB, pref.baseDir);
+				scnFilter.setData();
 				scnFilter.execute(father.getFrame(), Gui.CENTER_FRAME);
 				tbp.refreshTable();
 			}

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2007-02-04 13:23:47 UTC (rev 504)
+++ trunk/src/CacheWolf/TablePanel.java	2007-02-04 15:23:46 UTC (rev 505)
@@ -108,6 +108,9 @@
 	public void resetModel() {
 		myMod.numRows = cacheDB.size();
 		Global.getProfile().updateBearingDistance();
+		Filter flt = new Filter();
+		flt.setFilter();
+		flt.doFilter();
 		myMod.updateRows();
 		tc.update(true);
 		if (statBar!=null) statBar.updateDisplay();


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000296.html">[Cachewolf-svn] r504 - trunk/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="000298.html">[Cachewolf-svn] r506 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#297">[ date ]</a>
              <a href="thread.html#297">[ thread ]</a>
              <a href="subject.html#297">[ subject ]</a>
              <a href="author.html#297">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
