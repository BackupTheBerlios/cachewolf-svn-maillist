From mik77 at mail.berlios.de  Fri Mar  4 04:59:46 2011
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri,  4 Mar 2011 04:59:46 PM +0100
Subject: [Cachewolf-svn] r2942 - in trunk/src/CacheWolf: . imp
Message-ID: <20110304155946.AB462480FC5@sheep.berlios.de>

Author: mik77
Date: 2011-03-04 16:59:46 +0100 (Fri, 04 Mar 2011)
New Revision: 2942

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
 - hidden pref to disable DTS check when spidering

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-02-25 18:11:25 UTC (rev 2941)
+++ trunk/src/CacheWolf/Preferences.java	2011-03-04 15:59:46 UTC (rev 2942)
@@ -292,6 +292,8 @@
 	public boolean checkLog=false;
 	/** Check if presence of TBs changed*/
 	public boolean checkTBs=true;
+	/** Check if difficulty, terrain or size changed*/
+	public boolean checkDTS=true;
 	/** menu of spider along a route exists*/
 	public boolean spiderRoute=false;
 	/** Download images when loading cache data */
@@ -569,7 +571,9 @@
 			forceLogin = Boolean.valueOf(atts.getValue("forcelogin")).booleanValue();
 			checkLog = Boolean.valueOf(atts.getValue("checkLog")).booleanValue();
       tmp = atts.getValue("checkTBs");
-			if (tmp != null) Boolean.valueOf(atts.getValue("checkTBs")).booleanValue();
+			if (tmp != null) checkTBs = Boolean.valueOf(atts.getValue("checkTBs")).booleanValue();
+      tmp = atts.getValue("checkDTS");
+			if (tmp != null) checkDTS = Boolean.valueOf(atts.getValue("checkDTS")).booleanValue();
 			spiderRoute = Boolean.valueOf(atts.getValue("spiderRoute")).booleanValue();
 			tmp = atts.getValue("spiderUpdates");
 			if (tmp != null) spiderUpdates=Convert.parseInt(tmp);
@@ -734,7 +738,7 @@
 					        "\" addDetailsToWaypoint = \"" + SafeXML.strxmlencode(addDetailsToWaypoint) + "\" addDetailsToName = \"" + SafeXML.strxmlencode(addDetailsToName) + "\" />\n");
 			outp.print("    <opencaching lastSite=\""+lastOCSite+"\" downloadMissing=\"" + SafeXML.strxmlencode(downloadMissingOC) + "\"/>\n");
 			outp.print("    <location lat = \"" + SafeXML.clean(curCentrePt.getLatDeg(TransformCoordinates.DD)) + "\" long = \"" + SafeXML.clean(curCentrePt.getLonDeg(TransformCoordinates.DD)) + "\"/>\n");
-			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\" checkLog=\"" + SafeXML.strxmlencode(checkLog) + "\" checkTBs=\"" + SafeXML.strxmlencode(checkTBs) + "\" spiderRoute=\"" + SafeXML.strxmlencode(spiderRoute) + "\" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\" downloadPics=\"" + SafeXML.strxmlencode(downloadPics) + "\" downloadTBs=\"" + SafeXML.strxmlencode(downloadTBs) +"\"/>\n");
+			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\" checkLog=\"" + SafeXML.strxmlencode(checkLog) + "\" checkTBs=\"" + SafeXML.strxmlencode(checkTBs) + "\" checkDTS=\"" + SafeXML.strxmlencode(checkDTS) + "\" spiderRoute=\"" + SafeXML.strxmlencode(spiderRoute) + "\" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\" downloadPics=\"" + SafeXML.strxmlencode(downloadPics) + "\" downloadTBs=\"" + SafeXML.strxmlencode(downloadTBs) +"\"/>\n");
 			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
 			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
 			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\"/>\n");

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-02-25 18:11:25 UTC (rev 2941)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-04 15:59:46 UTC (rev 2942)
@@ -233,7 +233,9 @@
 					+ "with Founds       : " + (doNotgetFound ? "no" : "yes")
 					+ Preferences.NEWLINE + "alias is premium m: "
 					+ (!pref.isPremium ? "no" : "yes") + Preferences.NEWLINE
-					+ "Update if new Logs: " + (!pref.checkLog ? "no" : "yes")
+					+ "Update if new Logs: " + (!pref.checkLog ? "no" : "yes") + Preferences.NEWLINE
+					+ "Update if TB change: " + (!pref.checkTBs ? "no" : "yes") + Preferences.NEWLINE
+					+ "Update if DTS change: " + (!pref.checkDTS ? "no" : "yes")
 					+ Preferences.NEWLINE, null);
 
 			Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
@@ -1654,27 +1656,31 @@
 			save = true;
 			ret = true;
 		}
-		String dts[]=mString.split(getDTS(CacheDescription),'/');
-		if (dts.length == 3) {
-			if (difficultyChanged(ch,  CacheTerrDiff.v1Converter(dts[0]))) {
-				save = true;
-				ret = true;
-				pref.log("difficultyChanged");
-			}
-			if (terrainChanged(ch, CacheTerrDiff.v1Converter(dts[1]))) {
-				save = true;
-				ret = true;
-				pref.log("terrainChanged");
-			}
-			if (sizeChanged(ch, (byte) Common.parseInt(dts[2]))) {
-				save = true;
-				ret = true;
-				pref.log("sizeChanged");
-			}
+		
+		if (pref.checkDTS) {
+  		String dts[]=mString.split(getDTS(CacheDescription),'/');
+  		if (dts.length == 3) {
+  			if (difficultyChanged(ch,  CacheTerrDiff.v1Converter(dts[0]))) {
+  				save = true;
+  				ret = true;
+  				pref.log("difficultyChanged");
+  			}
+  			if (terrainChanged(ch, CacheTerrDiff.v1Converter(dts[1]))) {
+  				save = true;
+  				ret = true;
+  				pref.log("terrainChanged");
+  			}
+  			if (sizeChanged(ch, (byte) Common.parseInt(dts[2]))) {
+  				save = true;
+  				ret = true;
+  				pref.log("sizeChanged");
+  			}
+  		}
+  		else {
+  			pref.log("check DTS calculation", null);
+  		}
 		}
-		else {
-			pref.log("check DTS calculation", null);
-		}
+		
 		if (newFoundExists(ch,  CacheDescription)) {
 			numLogUpdates++;
 			ret = true;
@@ -1773,6 +1779,7 @@
 			int keylength=13; // wenn nicht 13 dann newkey auf wiederholung pr?fen
 			DistanceCodeKey=newkey.substring(0, keylength);
 			ret = decodeXor( stmp, DistanceCodeKey).replace('|', ' ');
+			pref.log("Automatic key: " + DistanceCodeKey + " result: " + ret + Preferences.NEWLINE);
 			RexPropDistance.search(ret); // km oder mi
 		}
 



From araber95 at mail.berlios.de  Fri Mar  4 10:17:51 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri,  4 Mar 2011 10:17:51 PM +0100
Subject: [Cachewolf-svn] r2943 - in trunk: . res_noewe res_noewe/languages
	src/CacheWolf src/CacheWolf/exp src/CacheWolf/imp
Message-ID: <20110304211752.14A81481285@sheep.berlios.de>

Author: araber95
Date: 2011-03-04 22:17:51 +0100 (Fri, 04 Mar 2011)
New Revision: 2943

Added:
   trunk/src/CacheWolf/imp/OCGPXfetch.java
Modified:
   trunk/currentversions.txt
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/languages/SV.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/Common.java
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/GeocoderOsm.java
   trunk/src/CacheWolf/HttpConnection.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/TravelbugJourneyScreen.java
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/Version.java
   trunk/src/CacheWolf/exp/GpxExportNg.java
   trunk/src/CacheWolf/imp/GCVoteImporter.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
doing the same

Modified: trunk/currentversions.txt
===================================================================
--- trunk/currentversions.txt	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/currentversions.txt	2011-03-04 21:17:51 UTC (rev 2943)
@@ -1,12 +1,12 @@
 # Release
 T0VersionMajor: 1
-T0VersionMinor: 0
-T0SvnRevision: 2716
+T0VersionMinor: 2
+T0SvnRevision: http://cachewolf.aldos.de/rc/mostrecentbuild.txt [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
 
 # ReleaseCandidate
 T1VersionMajor: 1
-T1VersionMinor: 2
-T1SvnRevision: http://cachewolf.aldos.de/rc/mostrecentbuild.txt [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
+T1VersionMinor: 3
+T1SvnRevision: http://cachewolf.aldos.de/mostrecentbuild.txt [\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)
 
 # InDevelopmentStable
 T2VersionMajor: 1

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/DE.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Markierte ausfiltern
 161=Zeige Blacklist
 162=Kalibrierte herunterladen
+163=von OC Funde
+164=nur bei OC gelistet
 170=Datenverzeichnis w??hlen
 171=Profil existiert nicht:+
 172=Kann das Kartenverzeichnis nicht erstellen:
@@ -786,7 +788,10 @@
 2678=Tankstelle nahebei
 2679=keine Verpflegungsm??glichkeit
 2680=Verpflegungsm??glichkeit nahebei
-2681=RFID / Funk Ausr??stung
+2681=RFID, CHIRP / Funk Ausr??stung nicht n??tig
+2682=RFID, CHIRP / Funk Ausr??stung
+2683=keine Erste Hilfe 
+2684=Erste Hilfe nahebei
 3000=Schlie??en
 4000=Geladene Caches:+
 4001=GPX-Dateien von Opencaching enthalten keine Informationen zu Bildern, sie werden nicht heruntergeladen. Am besten Caches von Opencaching holen per Men?? /Anwendung/Import/von Opencaching

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/EN.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filter out ticked
 161=Show Blacklist
 162=Download calibrated
+163 = OC finds
+164 = only available at OC
 170=Select data directory
 171=Profile does not exist:+
 172=Error: cannot create maps directory:
@@ -786,7 +788,10 @@
 2678=Fuel nearby
 2679=no Food nearby
 2680=Food nearby
-2681=wireless beacon
+2681 = RFID, CHIRP / radio equipment is not necessary
+2682 = RFID, CHIRP / radio equipment
+2683 = No emergency
+2684 = First Aid nearby
 3000=Close
 4000=Loaded caches:+
 4001=GPX files from opencaching don't contain information of images, they cannot be loaded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/FR.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filtre les caches coch??es
 161=Montre liste noire
 162=T??l??charger calibr??e
+163 = OC trouve
+164 = uniquement disponible chez OC
 170=Choisir dossier de base pour les profiles
 171=Profile n'existe pas:+
 172=Ne peut pas cr??er dossier pour des cartes:
@@ -786,7 +788,10 @@
 2678=carburant ?? proximit??
 2679=pas de nourriture ?? proximit??
 2680=la nourriture ?? proximit??
-2681=Chirp (Garmin)
+2681 = RFID, CHIRP / ??quipement radio n'est pas n??cessaire
+2682 = RFID, CHIRP ??quipement radio /
+2683 = Pas d'urgence
+2684 = First Aid ?? proximit??
 3000=Fermer
 4000=Caches charg??es:
 4001=GPX fichiers ?? partir Opencaching ne contiennent pas d'informations d'images, ils ne peuvent pas ??tre charg??. Pour le meilleur vous obtenez des caches de Opencaching par le menu /Application/importation/Download from Opencaching

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/NL.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Gemarkeerd filteren
 161=Toon Blacklist
 162=Gekalibreerde kaarten downloaden.
+163 = OC vindt
+164 = alleen verkrijgbaar bij OC
 170=Selecteer basis map voor cache data.
 171=Profiel bestaat niet:+
 172=Fout: kan kaarten map niet maken:\n.
@@ -786,7 +788,10 @@
 2678=brandstof in de omgeving
 2679=geen eten in de buurt
 2680=Voedsel in de buurt
-2681=Chirp (Garmin)
+2681 = RFID, CHIRP / radio-apparatuur is niet nodig
+2682 = RFID, CHIRP / radio-apparatuur
+2683 = Geen spoed
+2684 = Eerste Hulp in de buurt
 3000=Sluiten
 4000=Geladen caches
 4001=GPX bestanden uit opencaching bevatten geen informatie van beelden, kunnen zij niet worden downloaden. Beste je caches van opencaching menu /Application/Import/Download from Opencaching

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/PL.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filtruj zaznaczone
 161=Pokaz czarna liste
 162=Sciagnij skalibrowane
+163 = OC stwierdzi
+164 = dost??pne tylko w OC
 170=Wybierz folder z danymi
 171=Profil nie istnieje:+
 172=Blad: nie mozna utworzyc katalogu map:
@@ -786,7 +788,10 @@
 2678=paliwa w poblizu
 2679=brak zywnosci w poblizu
 2680=Zywnosci w poblizu
-2681=Chirp (Garmin)
+2681 = RFID, CHIRP / radio sprz??t nie jest konieczne
+2682 = RFID, CHIRP / urz??dze?? radiowych
+2683 = Nie awaryjne
+2684 = Pierwsza pomoc w pobli??u
 3000=Zamknij
 4000=Wczytaj skrzynki:+
 4001=Pliki GPX z opencaching nie zawieraja informacji o obrazach, nie moga byc one wczytane. Najlepiej pobierz skrzynki z opencaching przez menu /Aplikacja/Importuj/Sciagnij Z Opencaching

Modified: trunk/res_noewe/languages/SV.cfg
===================================================================
--- trunk/res_noewe/languages/SV.cfg	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/languages/SV.cfg	2011-03-04 21:17:51 UTC (rev 2943)
@@ -92,6 +92,8 @@
 160=Filter markeras ut
 161=Visa Blacklist
 162=Ladda kalibrerad
+163 = OC finner
+164 = endast tillg??nglig p?? OC
 170=V??lj databas
 171=profil finns inte:+
 172=Fel: kan inte skapa kartor katalog:
@@ -786,7 +788,10 @@
 2678=Br??nsle i n??rheten
 2679=ingen mat i n??rheten
 2680=Food i n??rheten
-2681=Chirp (Garmin)
+2681 = RFID,CHIRP / tr??dl??s utrustning ??r inte n??dv??ndig
+2682 = RFID,CHIRP / tr??dl??s utrustning
+2683 = Ingen akut
+2684 = F??rsta hj??lpen i n??rheten
 3000=St??ng
 4000=Loaded cachar:+
 4001=GPX filer fr??n opencaching inte inneh??ller n??gon information av bilder, kan de inte laoded. B??st du cachar fr??n opencaching genom menyn / Application / Import / Download fr??n Opencaching

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/res_noewe/spider.def	2011-03-04 21:17:51 UTC (rev 2943)
@@ -53,7 +53,7 @@
 # * When entering spaces into a string ensure to escape them or write them as \\u0020
 # * Be sure that you have no hidden spaces at the end of a line or the patterns will not match!
 #------------------------------------------------------------
-loginPage          = http://www.geocaching.com/login/Default.aspx
+loginPage          = http://www.geocaching.com/login/default.aspx
 loginSuccess       = You\ are\ logged\ in\ as
 nextPage           = /login/default.aspx
 waypoint           = http://www.geocaching.com/seek/cache_details.aspx?wp=
@@ -73,7 +73,7 @@
 availableRex       = class="lnk\ \ Strike">
 archivedRex        = class="lnk\ OldWarning\ Strike\ Strike">
 PMRex              = small_profile.gif
-distCodeRex        = k=(.*?)"\ style=
+distCodeRex        = k=(.*?)"
 distCodeKey        = signalthefrog
 distRex            = (.*?)(?:km|mi|ft)
 DTSRex             = v=(.*?)"\ style=

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Attribute.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -202,111 +202,101 @@
 	private final static int BIT_NR = 0; 
 	private final static int MSG_NR = 1;
 	private final static int PIC_NAME = 2;
-	private final static int OC_ID = 3;
-	private final static int GC_ID = 4;
+	private final static int OC_ID = 3; // OC - XML
+	private final static int GC_ID = 4; // auch OC neues gpx
 	private final static int GC_TEXT = 5; // for export , didn't extract by myself, copied from forum	
 	private static final String[][] attRef = {
-		// Empfehlungen / Personen - Conditions (Yes/No)
-		{"30","2562","scenic","0","8","Scenic view"},//62 scenic view
+		{"00","2502","available","38","13","Available at all times"},//02 available 24-7
+		{"01","2504","bicycles","0","32","Bicycles"},//04 bikes allowed
+		{"02","2506","boat","52","4","Boat"},//06 Wasserfahrzeug
+		// {"03","2508","cactus","0","0",""},//08 removed 14.08.10 araber95
+		{"04","2510","campfires","0","38","Campfires"},//10 campfires allowed
+		{"05","2512","camping","0","31","Camping available"},//12 Camping allowed
+		{"06","2514","cliff","11","21","Cliff / falling rocks"},//14 falling-rocks nearby
+		{"07","2516","climbing","28","10","Difficult climbing"},//16 easy climbing(OC-28), difficult climbing(GC-10) 
+		{"08","2518","compass","47","147","Compass"}, //OC special
+		{"09","2520","cow","0","43","Watch for livestock"},//20 watch for livestock
+		{"10","2522","danger","9","23","Dangerous area"},//22 dangerous area
+		{"11","2524","dogs","0","1","Dogs"},//24 dogs allowed
+		{"12","2526","fee","36","2","Access or parking fee"},//26 access/parking fees
+		// {"13","2528","hiking","0","9","Significant hike"},//28 significant hike : removed
+		{"13","2528","hiking","25","125","Long walk"}, //OC special
+		{"14","2530","horses","0","37","Horses"},//30 horses allowed
+		{"15","2532","hunting","12","22","Hunting"},//32 hunting area
+		{"16","2534","jeeps","0","35","Off-road vehicles"},//34 off-road vehicles allowed
 		{"17","2536","kids","59","6","Recommended for kids"},//36 kid friendly
-		{"35","2572","stroller","0","41","Stroller accessible"},//72 stroller accessible	
-		{"41","2584","wheelchair","0","24","Wheelchair accessible"},//84 wheelchair accessible
-		//  vorhanden / Eigenschaften / Infrastruktur - Facilities (Yes/No)
+		{"18","2538","mine","15","20","Abandoned mines"},//38
+		{"19","2540","motorcycles","0","33","Motorcycles"},//40 motorcycles allowed
+		{"20","2542","night","1","14","Recommended at night"},//42 recommended at night
+		{"21","2544","onehour","0","7","Takes less than an hour"},//44 takes less than one hour
 		{"22","2546","parking","18","25","Parking available"},//46 parking available
-		{"26","2554","public","19","26","Public transportation"},//54 public transit available
-		{"40","2582","water","20","27","Drinking water nearby"},//82 drinking water nearby
-		{"29","2560","restrooms","21","28","Public restrooms nearby"},//60 restrooms available
 		{"23","2548","phone","22","29","Telephone nearby"},//48 telephone nearby
 		{"24","2550","picnic","0","30","Picnic tables nearby"},//50 picnic tables available
-		{"43","2588","firstaid","23","42","Firstaid"}, // GC: Cachewartung notwendig (Auto Attribut) , OC: erste Hilfe 
-		{"73","2654","rv","0","46","Truck Driver/RV"},// changed by Moorteufel 12.07.10 
-		{"85","2678","fuel","0","58","Fuel nearby"}, // changed by araber95 14.08.10 
-		{"86","2680","food","0","59","Food nearby"}, // changed by araber95 14.08.10
-		// Erlaubt - Permissions (Allowed/Not Allowed)
-		{"11","2524","dogs","0","1","Dogs"},//24 dogs allowed
-		{"05","2512","camping","0","31","Camping available"},//12 Camping allowed
-		{"01","2504","bicycles","0","32","Bicycles"},//04 bikes allowed
-		{"19","2540","motorcycles","0","33","Motorcycles"},//40 motorcycles allowed
+		{"25","2552","poisonoak","16","17","Poison plants"},//52 Giftige Pflanzen
+		{"26","2554","public","19","26","Public transportation"},//54 public transit available
 		{"27","2556","quads","0","34","Quads"},//56 quads allowed
-		{"16","2534","jeeps","0","35","Off-road vehicles"},//34 off-road vehicles allowed
+		{"28","2558","rappelling","49","3","Climbing gear"},//58 climbing gear Kletterausr?stung
+		{"29","2560","restrooms","21","28","Public restrooms nearby"},//60 restrooms available
+		{"30","2562","scenic","0","8","Scenic view"},//62 scenic view
+		{"31","2564","scuba","51","5","Scuba gear"},//64 Tauchausr?stung
+		// {"32","2566","snakes","0","18","Snakes"},//66 araber95 replaced by Dangerous Animals 14.08.10
+		{"32","2566","dangerousanimals","0","18","Dangerous Animals"},//66
 		{"33","2568","snowmobiles","0","36","Snowmobiles"},//68
-		{"14","2530","horses","0","37","Horses"},//30 horses allowed
-		{"04","2510","campfires","0","38","Campfires"},//10 campfires allowed
-		// Eigenschaften / Gefahren - Hazards (Present/Not Present)
-		{"10","2522","danger","9","23","Dangerous area"},//22 dangerous area
-		{"62","2644","train","10","0",""},// 144 aktive Eisenbahnlinien in der N?he
-		{"06","2514","cliff","11","21","Cliff / falling rocks"},//14 falling-rocks nearby
-		{"15","2532","hunting","12","22","Hunting"},//32 hunting area
+		{"34","2570","stealth","0","40","Stealth required"},//70 stealth required (Heimlich,List,Schl?ue)
+		{"35","2572","stroller","0","41","Stroller accessible"},//72 stroller accessible	
+		{"36","2574","swimming","29","12","May require swimming"},//74
 		{"37","2576","thorn","13","39","Thorns"},//76 thorns!
 		{"38","2578","ticks","14","19","Ticks"},//78 ticks!
-		{"18","2538","mine","15","20","Abandoned mines"},//38
-		{"25","2552","poisonoak","16","17","Poison plants"},//52 Giftige Pflanzen
-		{"46","2594","animals","17","0",""},// 94 Giftige/gef%e4hrliche Tiere
-		// {"03","2508","cactus","0","0",""},//08 removed 14.08.10 araber95
-		{"32","2566","dangerousanimals","0","18","Dangerous Animals"},//66
-		// {"32","2566","snakes","0","18","Snakes"},//66 araber95 replaced by Dangerous Animals 14.08.10
-		{"09","2520","cow","0","43","Watch for livestock"},//20 watch for livestock
-		// Eigenschaften / Der Weg - Conditions (Yes/No)
-		{"49","2600","car","24","0",""},// 100 Nahe beim Auto
-		{"21","2544","onehour","0","7","Takes less than an hour"},//44 takes less than one hour
-		{"82","2672","hike_short","0","55","Short hike"}, // added by araber95 14.8.10
-		{"83","2674","hike_med","0","56","Medium Hike"}, // added by araber95 14.8.10
-		{"84","2676","hike_long","0","57","Long Hike"}, // added by araber95 14.8.10
-		{"13","2528","hiking","25","9","Significant hike"},//28 significant hike
 		{"39","2580","wading","26","11","May require wading"},//80 may require wading
-		{"65","2634","steep","27","0",""},// 134 H?geliges Gel?nde
-		{"07","2516","climbing","28","10","Difficult climbing"},//16 easy climbing(OC-28), difficult climbing(GC-10) 
-		{"36","2574","swimming","29","12","May require swimming"},//74
-		{"79","2666","nightcache","0","52","Night Cache"}, // added by araber95 14.8.10
-		{"80","2668","parkngrab","0","53","Park and grab"}, // added by araber95 14.8.10
-		{"81","2670","abandonedbuilding","0","54","Abandoned structure"}, // added by araber95 14.8.10
-		// Eigenschaften / Wegpunkte  - Conditions (Yes/No)
-		{"55","2612","letter","8","0",""},// 112 Letterbox (ben?tigt Stempel)
-		{"54","2610","interestsign","30","0",""},// 110 Interessanter Ort ev mit scenic zusammenfassen?
-		{"56","2614","moving","31","0",""},// 114 Bewegliches Ziel
-		{"64","2646","webcam","32","0",""},// 146 Webcam am Ziel
-		{"53","2608","indoor","33","0",""},// 108 In geschlossenen R?umen
-		{"66","2636","submerged","34","0",""},// 136 Im Wasser
-		{"58","2618","nogps","35","0",""},// 118 Ohne GPS
-		{"34","2570","stealth","0","40","Stealth required"},//70 stealth required (Heimlich,List,Schl?ue)
-		// Einschr?nkungen und Voraussetzungen / Allgemein
-		{"12","2526","fee","36","2","Access or parking fee"},//26 access/parking fees
-		{"61","2624","overnight","37","0",""},// 124 ?bernachtung erforderlich
-		// Einschr?nkungen und Voraussetzungen / Zeitlich
-		{"20","2542","night","1","14","Recommended at night"},//42 recommended at night
-		{"00","2502","available","38","13","Available at all times"},//02 available 24-7
-		{"68","2640","time","39","0",""},// 140 An bestimmte Zeiten gebunden
-		{"52","2606","day","40","0",""},// 106 nur tags?ber
-		{"67","2638","tide","41","0",""},// 138 Gezeiten
-		// Einschr?nkungen und Voraussetzungen / Saisonbedingt
-		{"51","2604","date","42","0",""},// 104 w?hrend des ganzen Jahres zug?nglich
-		{"57","2616","naturschutz","43","0",""},// 116 Brutsaison/Naturschutz
+		{"40","2582","water","20","27","Drinking water nearby"},//82 drinking water nearby
+		{"41","2584","wheelchair","0","24","Wheelchair accessible"},//84 wheelchair accessible
 		{"42","2586","winter","44","15","Available during winter"},//86 available in winter 132 Schneesicheres Versteck
-		// Einschr?nkungen und Voraussetzungen / Systembedingt
-		{"59","2620","oconly","6","0",""},// 120 Nur bei Opencaching logbar
-		{"71","2650","wwwlink","7","0",""},// 150 Nur Hyperlink zu OC-externen Portalen
-		// Einschr?nkungen und Voraussetzungen / Werkzeug - Equipment (Required/Not Required)
-		{"69","2642","tools","46","0","Special Tool required"},// 142 Spezielle Ausr?stung
-		{"08","2518","compass","47","0",""},//18 Kompass
+		{"43","2588","firstaid","0","42","Firstaid"}, // GC: Cachewartung notwendig (Auto Attribut) , OC: erste Hilfe 
 		{"44","2590","flashlight","48","44","Flashlight required"}, // 90 Flashlight required
-		{"28","2558","rappelling","49","3","Climbing gear"},//58 climbing gear Kletterausr?stung
-		{"50","2602","cave","50","0",""},// 102 H?hlenausr?stung
-		{"31","2564","scuba","51","5","Scuba gear"},//64 Tauchausr?stung
-		{"02","2506","boat","52","4","Boat"},//06 Wasserfahrzeug
-		{"45","2592","aircraft","53","38",""},// 92
+		{"45","2592","aircraft","53","153","Aircraft"}, //OC special //38 GC removed
+		{"46","2594","animals","17","0",""},// 94 Giftige/gef%e4hrliche Tiere
+		{"47","2596","arith_prob","56","156","Arithmetical problem"}, //OC special
+		{"48","2598","ask","58","158","Ask owner for start conditions"}, //OC special
+		{"49","2600","car","24","0",""},// 100 Nahe beim Auto
+		{"50","2602","cave","50","150","Cave equipment"}, //OC special
+		{"51","2604","date","42","142","All seasons"}, //OC special
+		{"52","2606","day","40","140","by day only"}, //OC special 
+		{"53","2608","indoor","33","133","Within enclosed rooms (caves, buildings etc.)"}, //OC special
+		{"54","2610","interestsign","30","130","Point of interest"}, //OC special
+		{"55","2612","letter","8","108","Letterbox (needs stamp)"}, //OC special
+		{"56","2614","moving","31","131","Moving target"}, //OC special
+		{"57","2616","naturschutz","43","143","Breeding season / protected nature"}, //OC special
+		{"58","2618","nogps","35","135","Without GPS (letterboxes, cistes, compass juggling ...)"}, //OC special
+		{"59","2620","oconly","6","106","Only loggable at Opencaching"},// 120 Nur bei Opencaching logbar
+		{"60","2622","othercache","57","157","Other cache type"}, //OC special
+		{"61","2624","overnight","37","137","Overnight stay necessary"}, //OC special
+		{"62","2644","train","10","110","Active railway nearby"}, //OC special
+		{"63","2630","riddle","55","0",""},// 130 R?tsel
+		{"64","2646","webcam","32","132","Webcam"}, //OC special
+		{"65","2634","steep","27","127","Hilly area"}, //OC special
+		{"66","2636","submerged","34","134","In the water"}, //OC special
+		{"67","2638","tide","41","141","Tide"}, //OC special
+		{"68","2640","time","39","139","Only available at specified times"}, //OC special
+		{"69","2642","tools","46","0","Special Tool required"},// 142 Spezielle Ausr?stung
+		{"70","2648","wiki","54","154","Investigation"}, //OC special
+		{"71","2650","wwwlink","7","107","Hyperlink to another caching portal only"}, //OC special
+		{"72","2652","landf","0","45","Lost And Found Tour"}, // thx to Kappler and MiK
+		{"73","2654","rv","0","46","Truck Driver/RV"},// changed by Moorteufel 12.07.10 
+		{"74","2656","field_puzzle","0","47","Field Puzzle"},// changed by Moorteufel 12.07.10
 		{"75","2658","uv","0","48","UV Light required"}, // added by araber95 14.8.10
 		{"76","2660","snowshoes","0","49","Snowshoes"}, // added by araber95 14.8.10"
 		{"77","2662","skiis","0","50","Cross Country Skis"}, // added by araber95 14.8.10
 		{"78","2664","s-tool","0","51","Special Tool required"}, // added by araber95 14.8.10
-		{"87","2681","wirelessbeacon","0","60","Wireless Beacon"}, // added by araber95 27.10.10
-		// Einschr?nkungen und Voraussetzungen / Ben?tigt Vorarbeit
-		{"70","2648","wiki","54","0",""},// 148 Recherche
-		{"63","2630","riddle","55","0",""},// 130 R?tsel
-		{"74","2656","field_puzzle","0","47","Field Puzzle"},// changed by Moorteufel 12.07.10
-		{"47","2596","arith_prob","56","0",""},// 96 Rechenaufgabe
-		{"60","2622","othercache","57","0",""},// 122 besondere Cacheart
-		{"48","2598","ask","58","0",""},// 98 Startbedingungen beim Owner erfragen
-		{"72","2652","landf","0","45","Lost And Found Tour"}, // thx to Kappler and MiK
+		{"79","2666","nightcache","0","52","Night Cache"}, // added by araber95 14.8.10
+		{"80","2668","parkngrab","0","53","Park and grab"}, // added by araber95 14.8.10
+		{"81","2670","abandonedbuilding","0","54","Abandoned structure"}, // added by araber95 14.8.10
+		{"82","2672","hike_short","0","55","Short hike"}, // added by araber95 14.8.10
+		{"83","2674","hike_med","0","56","Medium Hike"}, // added by araber95 14.8.10
+		{"84","2676","hike_long","0","57","Long Hike"}, // added by araber95 14.8.10
+		{"85","2678","fuel","0","58","Fuel nearby"}, // changed by araber95 14.08.10 
+		{"86","2680","food","0","59","Food nearby"}, // changed by araber95 14.08.10
+		{"87","2681","wirelessbeacon","0","60","Wireless Beacon"}, // added by araber95 27.10.10		
+		{"88","2588","firstaid","23","123","First aid available"}, //OC special
 		// {"-1","2500","error","0","0",""}, //
 
 	};

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -412,7 +412,7 @@
 			
 				  detfile.print("<NOTES><![CDATA["+CacheNotes+"]]></NOTES>\n");
 				  detfile.print("<IMAGES>\n");
-				  String stbuf = new String();
+				  String stbuf;
 				  for(int i = 0;i<images.size();i++){
 						stbuf = images.get(i).getFilename();
 						String urlBuf = images.get(i).getURL();

Modified: trunk/src/CacheWolf/Common.java
===================================================================
--- trunk/src/CacheWolf/Common.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Common.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -185,7 +185,7 @@
 	}
 	
 	public static String fixSerialPortName(String name) {
-		if (name.startsWith("/")) return new String(".."+name); // on linux (*nix) machines it is quite usual to give the complete file path to the serial port, but ewe expects only "ttyS0" or similar
+		if (name.startsWith("/")) return ".."+name; // on linux (*nix) machines it is quite usual to give the complete file path to the serial port, but ewe expects only "ttyS0" or similar
 		else                      return name;
 	}
 	

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/CoordsScreen.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -331,7 +331,7 @@
 				CWPoint coord;
 				String inp=inpText.getText().trim().toUpperCase();
 				if (inp.startsWith("GC")) {
-					SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile(), false);
+					SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
 					coord = new CWPoint(spider.getCacheCoordinates(inp));
 				} else {	
 					coord = new CWPoint(inp);

Modified: trunk/src/CacheWolf/GeocoderOsm.java
===================================================================
--- trunk/src/CacheWolf/GeocoderOsm.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/GeocoderOsm.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -43,7 +43,7 @@
 
 	public static Vector geocode(String address, Handle[] h) 
 	throws SAXException, IOException, HandleStoppedException, InterruptedException {
-		ByteArray answ = UrlFetcher.fetchByteArray((geocoderUrl+UrlFetcher.toUtf8Url(address)), null, h);
+		ByteArray answ = UrlFetcher.fetchByteArray((geocoderUrl+UrlFetcher.toUtf8Url(address)), h);
 		XMLDecoder xmldec = new XMLDecoder();
 		xmldec.parse(new InputStreamReader(new ByteArrayInputStream(answ), IO.JAVA_UTF8_CODEC));
 		Vector erg = new Vector();

Modified: trunk/src/CacheWolf/HttpConnection.java
===================================================================
--- trunk/src/CacheWolf/HttpConnection.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/HttpConnection.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -257,6 +257,11 @@
 {
 	getRequestorProperties().set(name,property);
 }
+public void setRequestorProperty(PropertyList pl)
+//===================================================================
+{
+	getRequestorProperties().set(pl);
+}
 /**
  * Add a non-exclusive requestor property. These are sent to the web server after the initial request line.
  * @param name The name of the property.
@@ -347,6 +352,7 @@
 			}
 		}
 	}
+	getRequestorProperties().clear();
 }
 
 //FIXME: never referenced

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/MainMenu.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -41,6 +41,7 @@
 import CacheWolf.imp.GCVoteImporter;
 import CacheWolf.imp.GPXImporter;
 import CacheWolf.imp.LOCXMLImporter;
+import CacheWolf.imp.OCGPXfetch;
 import CacheWolf.imp.OCXMLImporter;
 import CacheWolf.imp.OCXMLImporterScreen;
 import CacheWolf.imp.SpiderGC;
@@ -78,7 +79,7 @@
  *     20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
  */
 public class MainMenu extends MenuBar {
-	private MenuItem preferences, mnuContext,loadcaches,loadOC, /* savenexit, */ savenoxit,exit,search,searchAll,searchClr;
+	private MenuItem preferences, mnuContext,loadcaches,loadOC, loadOCFinds, /* savenexit, */ savenoxit,exit,search,searchAll,searchClr;
 	private MenuItem downloadmap, kalibmap, importmap, selectMapPath;
 	private MenuItem spider, spiderRoute, spiderQuick, spiderAllFinds, loadGCVotes, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
@@ -120,7 +121,10 @@
 		else spiderRoute = mnuSeparator;
 		MenuItem[] mnuImport = {				
 				loadcaches     = new MenuItem(MyLocale.getMsg(129,"Import GPX")),
+				mnuSeparator,
 				loadOC         = new MenuItem(MyLocale.getMsg(130,"Download from opencaching")),
+				loadOCFinds    = new MenuItem(MyLocale.getMsg(163,"Finds from opencaching")),
+				mnuSeparator,
 				spider         = new MenuItem(MyLocale.getMsg(131,"Download from geocaching.com")),
 				spiderRoute,
 				spiderAllFinds = new MenuItem(MyLocale.getMsg(217,"Spider all finds from geocaching.com")),
@@ -361,7 +365,7 @@
 			// subMenu for import, part of "Application" menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == spider){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doIt();
 				cacheDB.clear();
@@ -369,7 +373,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == spiderRoute){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doItAlongARoute();
 				cacheDB.clear();
@@ -377,7 +381,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == spiderQuick){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doItQuickFillFromMapList();
 				cacheDB.clear();
@@ -385,7 +389,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == spiderAllFinds){
-				SpiderGC spGC = new SpiderGC(pref, profile, true);
+				SpiderGC spGC = new SpiderGC(pref, profile);
 				Global.mainTab.saveUnsavedChanges(false);
 				spGC.doIt(true);
 				cacheDB.clear();
@@ -393,7 +397,7 @@
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == loadGCVotes){
-                GCVoteImporter sGCV = new GCVoteImporter(pref, profile, true);
+                GCVoteImporter sGCV = new GCVoteImporter(pref, profile);
                 sGCV.doIt();
                 tbp.resetModel();
 			}
@@ -435,6 +439,12 @@
                 filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&~MenuItem.Checked;
 				tbp.resetModel();
 			}
+			if(mev.selectedItem == loadOCFinds){
+				OCGPXfetch.doIt();
+                Global.getProfile().setShowBlacklisted(false);
+                filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&~MenuItem.Checked;
+				tbp.resetModel();
+			}
 			if (mev.selectedItem == update)
 				updateSelectedCaches(tbp);
 			if(mev.selectedItem == mnuForceLogin) {
@@ -839,7 +849,7 @@
 		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(1014,"updateSelectedCaches"), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS| OCXMLImporterScreen.ALL);
 		if (options.execute() == FormBase.IDCANCEL) {	return; }
 
-		SpiderGC spider = new SpiderGC(pref, profile, false);
+		SpiderGC spider = new SpiderGC(pref, profile);
 		OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
 		Vm.showWait(true);
 		boolean alreadySaid = false;

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Preferences.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -251,7 +251,8 @@
 	public String garminGPSBabelOptions="";
 	/** Max. length for Garmin waypoint names (for etrex which can only accept 6 chars) */
 	public int garminMaxLen=0;
-	public boolean downloadMissingOC = false;
+	/** OC true = alle neu Laden false = wenn ?nderungsdatum neuer */
+	public boolean downloadAllOC = false;
 	public String lastOCSite=OC.OCSites[0][OC.OC_HOSTNAME];
 	/** The currently used centre point, can be different from the profile's centrepoint. This is used
 	 *  for spidering */
@@ -292,7 +293,7 @@
 	public boolean checkLog=false;
 	/** Check if presence of TBs changed*/
 	public boolean checkTBs=true;
-	/** Check if difficulty, terrain or size changed*/
+	/** Check if presence of DTS changed*/
 	public boolean checkDTS=true;
 	/** menu of spider along a route exists*/
 	public boolean spiderRoute=false;
@@ -495,7 +496,7 @@
 			tmp=atts.getValue("lastSite");
 			if (!(tmp == null) && OC.getSiteIndex(tmp)>=0 ) lastOCSite=tmp;
 			tmp=atts.getValue("downloadMissing");
-			if (!(tmp == null)) downloadMissingOC = Boolean.valueOf(tmp).booleanValue();
+			if (!(tmp == null)) downloadAllOC = Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("listview")) {
 			listColMap=atts.getValue("colmap");
@@ -569,11 +570,11 @@
 		}
 		else if (name.equals("spider")) {
 			forceLogin = Boolean.valueOf(atts.getValue("forcelogin")).booleanValue();
-			checkLog = Boolean.valueOf(atts.getValue("checkLog")).booleanValue();
-      tmp = atts.getValue("checkTBs");
-			if (tmp != null) checkTBs = Boolean.valueOf(atts.getValue("checkTBs")).booleanValue();
-      tmp = atts.getValue("checkDTS");
-			if (tmp != null) checkDTS = Boolean.valueOf(atts.getValue("checkDTS")).booleanValue();
+			checkLog = Boolean.valueOf(atts.getValue("checkLog")).booleanValue();      
+			tmp = atts.getValue("checkTBs");
+			if (tmp != null) checkTBs=Boolean.valueOf(atts.getValue("checkTBs")).booleanValue();
+			tmp = atts.getValue("checkDTS");
+			if (tmp != null) checkDTS=Boolean.valueOf(atts.getValue("checkDTS")).booleanValue();
 			spiderRoute = Boolean.valueOf(atts.getValue("spiderRoute")).booleanValue();
 			tmp = atts.getValue("spiderUpdates");
 			if (tmp != null) spiderUpdates=Convert.parseInt(tmp);
@@ -736,9 +737,19 @@
 			outp.print("    <solver ignorevariablecase=\"" + SafeXML.strxmlencode(solverIgnoreCase) + "\" degMode=\"" + SafeXML.strxmlencode(solverDegMode) + "\" />\n");
 			outp.print("    <garmin connection = \"" + SafeXML.clean(garminConn) + "\" GPSBabelOptions = \"" + SafeXML.clean(garminGPSBabelOptions) + "\" MaxWaypointLength = \"" + SafeXML.strxmlencode(garminMaxLen) +
 					        "\" addDetailsToWaypoint = \"" + SafeXML.strxmlencode(addDetailsToWaypoint) + "\" addDetailsToName = \"" + SafeXML.strxmlencode(addDetailsToName) + "\" />\n");
-			outp.print("    <opencaching lastSite=\""+lastOCSite+"\" downloadMissing=\"" + SafeXML.strxmlencode(downloadMissingOC) + "\"/>\n");
+			outp.print("    <opencaching lastSite=\""+lastOCSite+"\" downloadMissing=\"" + SafeXML.strxmlencode(downloadAllOC) + "\"/>\n");
 			outp.print("    <location lat = \"" + SafeXML.clean(curCentrePt.getLatDeg(TransformCoordinates.DD)) + "\" long = \"" + SafeXML.clean(curCentrePt.getLonDeg(TransformCoordinates.DD)) + "\"/>\n");
-			outp.print("    <spider forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\" checkLog=\"" + SafeXML.strxmlencode(checkLog) + "\" checkTBs=\"" + SafeXML.strxmlencode(checkTBs) + "\" checkDTS=\"" + SafeXML.strxmlencode(checkDTS) + "\" spiderRoute=\"" + SafeXML.strxmlencode(spiderRoute) + "\" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\" downloadPics=\"" + SafeXML.strxmlencode(downloadPics) + "\" downloadTBs=\"" + SafeXML.strxmlencode(downloadTBs) +"\"/>\n");
+			outp.print("    <spider"+
+					" forcelogin=\"" + SafeXML.strxmlencode(forceLogin) + "\""+
+					" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\""+
+					" checkLog=\"" + SafeXML.strxmlencode(checkLog) + "\""+
+					" checkTBs=\"" + SafeXML.strxmlencode(checkTBs) + "\""+
+					" checkDTS=\"" + SafeXML.strxmlencode(checkDTS) +"\""+
+					" spiderRoute=\"" + SafeXML.strxmlencode(spiderRoute) + "\""+
+					" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\""+
+					" downloadPics=\"" + SafeXML.strxmlencode(downloadPics) + "\""+
+					" downloadTBs=\"" + SafeXML.strxmlencode(downloadTBs) +"\""+
+					"/>\n");
 			outp.print("    <gotopanel northcentered=\"" + SafeXML.strxmlencode(northCenteredGoto) + "\" />\n");
 			outp.print("    <details cacheSize=\"" + SafeXML.strxmlencode(maxDetails) + "\" delete=\"" + SafeXML.strxmlencode(deleteDetails) + "\"/>\n");
 			outp.print("    <metric type=\"" + SafeXML.strxmlencode(metricSystem) + "\"/>\n");

Modified: trunk/src/CacheWolf/TravelbugJourneyScreen.java
===================================================================
--- trunk/src/CacheWolf/TravelbugJourneyScreen.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/TravelbugJourneyScreen.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -589,7 +589,7 @@
 		}
 		if (selectedItem==mnuGetMission && selectedRow>-1) {
 			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
-			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile(),false);
+			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile());
 			Vm.showWait(true);
 			
 			//if we have an ID, get mission by ID
@@ -620,7 +620,7 @@
 		}
 		if (selectedItem==mnuOpenOnline && selectedRow>=0) {
 			TravelbugJourney tbj=tblMyTravelbugJourneys.getTBJourney(selectedRow);
-			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile(),false);
+			SpiderGC spider=new SpiderGC(Global.getPref(),Global.getProfile());
 			Vm.showWait(true);
 			// First check whether ID is set, if not get it
 			if (tbj.getTb().getGuid().length()==0) tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName()));

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -25,8 +25,10 @@
     */
 package CacheWolf;
 
+import ewe.data.PropertyList;
 import ewe.io.AsciiCodec;
-import ewe.io.ByteArrayInputStream;
+import ewe.io.File;
+import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
 import ewe.net.Socket;
@@ -35,33 +37,64 @@
 import ewe.sys.HandleStoppedException;
 import ewe.util.ByteArray;
 import ewe.util.CharArray;
-import ewe.util.Properties;
 
 public class UrlFetcher {
-	public static String fetchString(String address) throws IOException
-	{
-		ByteArray daten = fetchByteArray(address, null);
+	static HttpConnection conn;
+	static int maxRedirections = 5;
+	static PropertyList requestorProperties = null;
+	static PropertyList permanentRequestorProperties = null;
+	static String postData=null;
+	static String urltmp=null;
+	
+	public static PropertyList getDocumentProperties() {
+		if (conn != null) 
+			return conn.documentProperties;
+		else return null;
+	}
+	public static String getRealUrl() { return urltmp; };
+	public static void setMaxRedirections(int value) { maxRedirections=value; };
+	public static void setRequestorProperties(PropertyList value) { requestorProperties=value; };
+	public static void setRequestorProperty(String name, String property) {
+		if (requestorProperties == null) requestorProperties = new PropertyList();
+		requestorProperties.set(name,property);
+	}
+	private static void initPermanentRequestorProperty() {
+		permanentRequestorProperties = new PropertyList();
+		permanentRequestorProperties.add("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
+		// permanentRequestorProperties.add("Connection", "close");		
+	}
+	public static void setPermanentRequestorProperty(String name, String property) {
+		if (permanentRequestorProperties == null) initPermanentRequestorProperty();
+		if (property != null) 
+			permanentRequestorProperties.set(name,property);
+		else {
+			int index = permanentRequestorProperties.find(name);
+			if ( index >= 0 ) permanentRequestorProperties.del(index);			
+		}
+	}
+	public static void setpostData(String value) { postData=value;};
+	public static String fetch(String address) throws IOException {
+		ByteArray daten = fetchByteArray(address);
 		JavaUtf8Codec codec = new JavaUtf8Codec();
 		CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
 		return c_data.toString();
+	}	
+	public static ByteArray fetchData(String address) throws IOException
+	{ return fetchByteArray(address); }
+	public static void fetchDataFile(String address, String target) throws IOException {
+		FileOutputStream outp =  new FileOutputStream(new File(target));
+		outp.write(fetchByteArray(address).toBytes());
+		outp.close();
 	}
-
-	public static Properties fetchPropertyList(String url) throws IOException {
-		CharArray t = new CharArray();
-		ByteArray doc = fetchByteArray(url, t);
-		Properties props = new Properties();
-		props.load(new ByteArrayInputStream(doc));
-		return props; 
-	}
-
-	public static ByteArray fetchByteArray(String url, CharArray realurl) throws IOException {
+	// all errors as IOException
+	private static ByteArray fetchByteArray(String url) throws IOException {
 		Handle[] hndl = new Handle[1];
 		try {
-		return fetchByteArray(url, realurl, hndl);
+		return fetchByteArray(url, hndl);
 		} catch ( InterruptedException e) {
-			throw new IOException("Error reading data. i :"+url);
+			throw new IOException("Error reading data. Interrupted :"+url);
 		} catch ( HandleStoppedException e) {
-			throw new IOException("Error reading data. s :"+url);
+			throw new IOException("Error reading data. HandleStopped :"+url);
 		}
 	}
 
@@ -73,20 +106,23 @@
 	 * @throws InterruptedException 
 	 * @throws HandleStoppedException 
 	 */
-	public static ByteArray fetchByteArray(String url, CharArray realurl, Handle[] hndl) 
+	public static ByteArray fetchByteArray(String url, Handle[] hndl) 
 	throws IOException, HandleStoppedException, InterruptedException {	
-		final int maxRedirections = 5;
-		HttpConnection conn = null;
 		Socket sock = null;
 		int i=0;
-		String urltmp = new String(url);
+		urltmp = url;
+		conn = new HttpConnection(urltmp);
 		do  { // allow max 5 redirections (http 302 location)
-			if (realurl != null) realurl.copyFrom(new String(urltmp));
 			i++;
-			conn = new HttpConnection(urltmp);
-			conn.setRequestorProperty("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-			conn.setRequestorProperty("Connection", "close");
+			conn.setUrl(urltmp);
 			conn.documentIsEncoded = isUrlEncoded(urltmp);
+			if (permanentRequestorProperties == null) initPermanentRequestorProperty();
+			if (postData != null) {
+				conn.setPostData(postData);
+				setRequestorProperty("Content-Type","application/x-www-form-urlencoded");
+			}
+			conn.setRequestorProperty(permanentRequestorProperties);
+			if (requestorProperties != null) conn.setRequestorProperty(requestorProperties);
 			hndl[0] = conn.connectAsync();
 			hndl[0].waitOn(Handle.Success);
 			sock = (Socket)hndl[0].returnValue; //"Could not connect.");
@@ -108,8 +144,10 @@
 		}finally {
 			sock.close();
 		}
-		daten = (ByteArray)hndl[0].returnValue;
-		// ByteArray daten = conn.readData(sock);
+		maxRedirections = 5;
+		requestorProperties = null;
+		postData=null;
+		daten = (ByteArray)hndl[0].returnValue; // ByteArray daten = conn.readData(sock);
 		return daten;
 	}
 
@@ -117,7 +155,7 @@
 	 * @param url
 	 * @return true, if the string seems to be already URL encoded (that is, it contains only url-allowd chars), false otherwise
 	 */
-	public static boolean isUrlEncoded(String url) {
+	private static boolean isUrlEncoded(String url) {
 		final String allowed = new String ("-_.~!*'();:@&=+$,/?%#[]");
 		char [] src = ewe.sys.Vm.getStringChars(url);
 		char c;
@@ -163,7 +201,7 @@
 	 * @return The encoded URL.
 	 */
 	//===================================================================
-	public static String encodeURL(String url, boolean spaceToPlus)
+	private static String encodeURL(String url, boolean spaceToPlus)
 	//===================================================================
 	{
 		char [] what = ewe.sys.Vm.getStringChars(url);

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/Version.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -27,6 +27,7 @@
 
 import com.stevesoft.ewe_pat.Regex;
 
+import ewe.io.ByteArrayInputStream;
 import ewe.io.IOException;
 import ewe.sys.Convert;
 import ewe.sys.Vm;
@@ -71,7 +72,9 @@
 	 * @throws IOException
 	 */
 	public static void checkForUpdates() throws IOException {
-		Properties curvers = UrlFetcher.fetchPropertyList("http://svn.berlios.de/svnroot/repos/cachewolf/trunk/currentversions.txt");
+		String currentVersionsUrl="http://svn.berlios.de/svnroot/repos/cachewolf/trunk/currentversions.txt";
+		Properties curvers = new Properties();
+		curvers.load(new ByteArrayInputStream(UrlFetcher.fetchData(currentVersionsUrl)));
 		versionnumbers = new String[updateavailabe.length];
 		for (int i = updateavailabe.length-1; i >=1; i--) {
 			updateavailabe[i] = checkVersion(curvers, "T"+(i-1), i); // this also sets versionnumber[i]
@@ -132,7 +135,7 @@
 				Regex s;
 				int i = svnRString.indexOf(' ');
 				if (i > 0) {
-					tmp = UrlFetcher.fetchString(svnRString.substring(0, i));
+					tmp = UrlFetcher.fetch(svnRString.substring(0, i));
 					s = new Regex (svnRString.substring(i+1, svnRString.length())); // flyingfish works 3/2008 with ("(?i)Revision[\\s]*[:=][\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)");
 				} else { versionnumbers[t] = "error: no RegEx"; return 3; }
 				s.search(tmp);

Modified: trunk/src/CacheWolf/exp/GpxExportNg.java
===================================================================
--- trunk/src/CacheWolf/exp/GpxExportNg.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/exp/GpxExportNg.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -128,7 +128,20 @@
 
 	// we need to fake desc to make clients like GSAK accept additional waypoints together with caches
 	final static String GPXHEADER = "<?xml version=\"1.0\" encoding=\"utf-8\"?>"+(newLine)
-			+("<gpx xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" version=\"1.0\" creator=\"CacheWolf\" xsi:schemaLocation=\"http://www.topografix.com/GPX/1/0 http://www.topografix.com/GPX/1/0/gpx.xsd http://www.groundspeak.com/cache/1/0 http://www.groundspeak.com/cache/1/0/cache.xsd\" xmlns=\"http://www.topografix.com/GPX/1/0\">")+(newLine)
+			+("<gpx")
+			+(" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"")
+			+(" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"")
+			+(" version=\"1.0\"")
+			+(" creator=\"CacheWolf\"")
+			+(" xsi:schemaLocation=\"")
+				+("http://www.topografix.com/GPX/1/0 ")
+				+("http://www.topografix.com/GPX/1/0/gpx.xsd ")
+				+("http://www.groundspeak.com/cache/1/0/1 ")
+				+("http://www.groundspeak.com/cache/1/0/1/cache.xsd")
+			+("\"")
+			+(" xmlns=\"http://www.topografix.com/GPX/1/0\"")
+			+(">")
+			+(newLine)
 			+("<name>@@NAME@@</name>")+(newLine)
 			+("<desc>This is an individual cache generated from Geocaching.com</desc>")+(newLine)
 			+("<author>Various users from geocaching.com and/or opencaching.de</author>")+(newLine)

Modified: trunk/src/CacheWolf/imp/GCVoteImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -32,6 +32,7 @@
 import CacheWolf.MyLocale;
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
+import CacheWolf.UrlFetcher;
 import CacheWolf.imp.SpiderGC.SpiderProperties;
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
@@ -58,19 +59,15 @@
 	private String GCVWaypoints;
 	private String GCVResults;
 	private static Preferences pref;
-	private static SpiderProperties p=null;
 
 	/**
 	*	Constructor initalizing profile and cacheDB
 	*/
-	public GCVoteImporter(Preferences prf, Profile _profile, boolean bypass){
+	public GCVoteImporter(Preferences prf, Profile _profile){
 		this.profile=_profile;
 		this.cacheDB = profile.cacheDB;
 		pref = prf;
-		if (p == null) {
-			pref.logInit();
-		}
-		// initialiseProperties();
+		// pref.logInit();
 	}
 
 	/**
@@ -110,7 +107,8 @@
 				pref.log("[GCVote]:Requesting ratings");
 
 				// request web page http://gcvote.de/getVotes.php
-				GCVResults = getResponse(GCVURL);
+				// UrlFetcher.setRequestorProperty("User-Agent", "Mozilla/5.0 (compatible; Cachewolf; GCVoteImporter)");
+				GCVResults = UrlFetcher.fetch(GCVURL);
 				if (GCVResults.equals("")) {
 					(new MessageBox(MyLocale.getMsg(0,"Error"), MyLocale.getMsg(0,"Error loading GCVote page.%0aPlease check your internet connection."), FormBase.OKB)).execute();
 					pref.log("[GCVote]:Could not fetch: getVotes.php page",null);
@@ -143,34 +141,4 @@
 			cb.setNumRecommended( 100*voteCnt + (int)(voteAvg + 0.5));
 		}
 	}
-
-	/**
-	*	Perform an request to fetch the GCVote results
-	*/
-	public static String getResponse(String address) {
-		CharArray c_data;
-		try{
-			HttpConnection conn;
-			if(pref.myproxy.length() > 0 && pref.proxyActive){
-				pref.log("[GCVote]:Using proxy: " + pref.myproxy + " / " +pref.myproxyport);
-			}
-			conn = new HttpConnection(address);
-			conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (compatible; Cachewolf; GCVoteImporter)");
-			conn.setRequestorProperty("Connection", "close");
-			conn.documentIsEncoded = true;
-			pref.log("[GCVote]:Connecting "+address);
-			Socket sock = conn.connect();
-			pref.log("[GCVote]:Connect ok! "+address);
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			c_data = conn.readText(sock, codec);
-			sock.close();
-			pref.log("[GCVote]:Read data ok "+address);
-			return c_data.toString();
-		}catch(IOException ioex){
-			pref.log("IOException in fetch", ioex);
-		}finally{
-			//continue
-		}
-		return "";
-	}
 }

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -30,22 +30,32 @@
 import CacheWolf.Attribute;
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
+import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
 import CacheWolf.Common;
 import CacheWolf.Extractor;
 import CacheWolf.Filter;
+import CacheWolf.ImageInfo;
 import CacheWolf.InfoBox;
 import CacheWolf.Log;
 import CacheWolf.MyLocale;
+import CacheWolf.OC;
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
 import CacheWolf.STRreplace;
 import CacheWolf.SafeXML;
 import CacheWolf.Travelbug;
+import CacheWolf.UrlFetcher;
 import CacheWolf.imp.SpiderGC.SpiderProperties;
+import CacheWolf.utils.FileBugfix;
+import ewe.io.File;
 import ewe.io.FileInputStream;
+import ewe.io.IOException;
+import ewe.net.MalformedURLException;
+import ewe.net.URL;
+import ewe.sys.Convert;
 import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.FormBase;
@@ -127,7 +137,7 @@
 				doSpider = true;
 			}
 			if (doSpider) {
-				imgSpider = new SpiderGC(pref, profile, false);
+				imgSpider = new SpiderGC(pref, profile);
 				doitHow = DOIT_WITHSPOILER;
 			} else {
 				doitHow = DOIT_NOSPOILER;
@@ -157,6 +167,7 @@
 							infB.close(0);
 						}
 					}
+					zif.close();
 				}
 				else {
 					FileInputStream rFIS = new ewe.io.FileInputStream(file);
@@ -198,7 +209,7 @@
 			if (atts.getValue("creator").startsWith("TerraCaching")) fromTC = true;
 			else fromTC = false;
 
-			if (fromOC && doSpider) (new MessageBox("Warnung", MyLocale.getMsg(4001, "GPX files from opencaching don't contain information of images, they cannot be laoded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching"), FormBase.OKB)).execute();
+			// if (fromOC && doSpider) (new MessageBox("Warnung", MyLocale.getMsg(4001, "GPX files from opencaching don't contain information of images, they cannot be laoded. Best you get caches from opencaching by menu /Application/Import/Download from Opencaching"), FormBase.OKB)).execute();
 			zaehlerGel = 0;
 		}
 		if (name.equals("wpt")) {
@@ -223,6 +234,13 @@
 			inCache = true;
 			holder.setAvailable(atts.getValue("available").equals("True"));
 			holder.setArchived(atts.getValue("archived").equals("True"));
+			// OC now has GC - Format,  get CacheID -- missing p.ex. on GcTour gpx
+			for (int i = 0; i < atts.getLength(); i++) {
+				if (atts.getName(i).equals("id")) {
+					holder.setOcCacheID(atts.getValue("id"));
+					break;
+				}
+			}
 			return;
 		}
 		// OC
@@ -233,13 +251,12 @@
 			// get CacheID -- missing p.ex. on GcTour gpx
 			for (int i = 0; i < atts.getLength(); i++) {
 				if (atts.getName(i).equals("id")) {
-					String ocCacheID = atts.getValue("id");
-					holder.setOcCacheID(ocCacheID);
+					holder.setOcCacheID(atts.getValue("id"));
 					break;
 				}
 			}
 			// get status
-			String status = new String(atts.getValue("status"));
+			String status = atts.getValue("status");
 			if (status.equals("Available")) available = true;
 			else if (status.equals("Unavailable")) available = false;
 			else if (status.equals("Draft")) available = false;
@@ -333,26 +350,23 @@
 				// if waypoint starts with "GC"
 				if(doSpider) {
 					if(spiderOK && holder.is_archived() == false){
-							if(holder.getLatLon().length() > 1){
-						}
-						if(holder.getWayPoint().startsWith("GC")|| fromTC) {
-							//spiderImages();
-							spiderImagesUsingSpider();
-							//Rename image sources
-							String text;
-							String orig;
-							String imgName;
-							orig = holder.getCacheDetails(false).LongDescription;
-							Extractor ex = new Extractor(orig, "<img src=\"", ">", 0, false);
+						if(holder.getLatLon().length() > 1){ }
+						//spiderImages();
+						spiderImagesUsingSpider();
+						//Rename image sources
+						String text;
+						String orig;
+						String imgName;
+						orig = holder.getCacheDetails(false).LongDescription;
+						Extractor ex = new Extractor(orig, "<img src=\"", ">", 0, false);
+						text = ex.findNext();
+						int num = 0;
+						while(ex.endOfSearch() == false && spiderOK){
+							if (num >= holder.getCacheDetails(false).images.size())break;
+							imgName = holder.getCacheDetails(false).images.get(num).getTitle();
+							holder.getCacheDetails(false).LongDescription = STRreplace.replace(holder.getCacheDetails(false).LongDescription, text, "[[Image: " + imgName + "]]");
+							num++;
 							text = ex.findNext();
-							int num = 0;
-							while(ex.endOfSearch() == false && spiderOK){
-								if (num >= holder.getCacheDetails(false).images.size())break;
-								imgName = holder.getCacheDetails(false).images.get(num).getTitle();
-								holder.getCacheDetails(false).LongDescription = STRreplace.replace(holder.getCacheDetails(false).LongDescription, text, "[[Image: " + imgName + "]]");
-								num++;
-								text = ex.findNext();
-							}
 						}
 					}
 				}
@@ -364,7 +378,12 @@
 				CacheHolder oldCh= cacheDB.get(index);
 				// Preserve images: Copy images from old cache version because here we didn't add
 				// any image information to the holder object.
-				holder.getCacheDetails(false).images = oldCh.getCacheDetails(true).images;
+				if (pref.downloadPics && holder.isOC()) {
+					spiderImagesUsingSpider(); 
+				}
+				else {
+					holder.getCacheDetails(false).images = oldCh.getCacheDetails(true).images;
+				}
 				oldCh.initStates(false);
 				oldCh.update(holder);
 				oldCh.save();
@@ -551,11 +570,11 @@
 	}
 	
 	private void spiderImagesUsingSpider(){
-		String addr;
+		String addresse;
 		String cacheText;
 		
 		// just to be sure to have a spider object
-		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile, false);
+		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile);
 		if (propsSpider == null) {propsSpider = imgSpider.new SpiderProperties();	}
 		
 		try {
@@ -563,26 +582,154 @@
 						imgSpider.getImages(holder.getCacheDetails(false).LongDescription, holder.getCacheDetails(false),false);
 				}
 				else {
-					addr = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + holder.getWayPoint() ;
-					cacheText = SpiderGC.fetchText(addr,false);
-					if (cacheText.indexOf(propsSpider.getProp("premiumCachepage")) > 0) {
-						// Premium cache spidered by non premium member
-						imgSpider.getImages(holder.getCacheDetails(false).LongDescription, holder.getCacheDetails(false),false);
+					if (fromOC) {
+						holder.getCacheDetails(false).images.clear();
+						addresse=holder.getCacheDetails(false).URL;
+						cacheText = UrlFetcher.fetch(addresse);
+						Extractor exBeschreibung = new Extractor(cacheText, "<!-- Beschreibung -->", "<!-- End Beschreibung -->", 0, false);
+						String beschreibung = exBeschreibung.findNext();
+						getOCPictures(beschreibung);
+						Extractor exBilder = new Extractor(cacheText, "<!-- Bilder -->", "<!-- End Bilder -->", 0, false);
+						String bilder = exBilder.findNext();
+						getOCPictures(bilder);
 					}
 					else {
-						imgSpider.getImages(cacheText, holder.getCacheDetails(false),true);
+						addresse = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + holder.getWayPoint() ;
+						cacheText = UrlFetcher.fetch(addresse);
+						if (cacheText.indexOf(propsSpider.getProp("premiumCachepage")) > 0) {
+							// Premium cache spidered by non premium member
+							imgSpider.getImages(holder.getCacheDetails(false).LongDescription, holder.getCacheDetails(false),false);
+						}
+						else {
+							imgSpider.getImages(cacheText, holder.getCacheDetails(false),true);
+						}
+						try {
+							imgSpider.getAttributes(cacheText, holder.getCacheDetails(false));
+						} catch (Exception e) {
+							pref.log("unable to fetch attributes for"+holder.getWayPoint(), e);
+						}
 					}
-					try {
-						imgSpider.getAttributes(cacheText, holder.getCacheDetails(false));
-					} catch (Exception e) {
-						pref.log("unable to fetch attrivbutes for"+holder.getWayPoint(), e);
-					}
 				}
 		} catch (Exception e1) {
 			// e1.printStackTrace();
 		}
 	}
+	private void getOCPictures(String html) {
+		Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)");
+		imgRegexUrl.setIgnoreCase(true);
+		int descIndex=0;
+		while (imgRegexUrl.searchFrom(html, descIndex)) {			
+			descIndex = imgRegexUrl.matchedTo();
+			String fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anf?hrungszeichen in (2)		
+			if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); } // falls ohne in (3)			
+			if (fetchUrl==null) {continue;} // schlechtes html
+			//  fetchUrl ist auf jeden Fall ohne Anf?hrungszeichen
+			if (fetchUrl.startsWith("resource")) continue; // 
+			if (fetchUrl.startsWith("images")) // z.B. Flaggen
+				if (!fetchUrl.startsWith("images/uploads")) continue;
+			if (fetchUrl.startsWith("thumbs")) continue; // z.B. Flaggen
+			try {
+				//TODO this is not quite correct: actually the "base" URL must be known...
+				// but anyway a different baseURL should not happen very often  - it doesn't in my area
+				String hostname = OC.getOCHostName(holder.getWayPoint());
+				if (!fetchUrl.startsWith("http://")) {
+					fetchUrl = new URL(new URL("http://" + hostname+"/"), fetchUrl).toString();
+				}
+			} catch (MalformedURLException e) {	continue; } // auch egal
+			ImageInfo imageInfo = new ImageInfo();
+			imageInfo.setURL(fetchUrl);
+			imageInfo.setTitle(makeTitle(imgRegexUrl.stringMatched(1), fetchUrl));
+			getPic(imageInfo);
+		}
+		
+		
+		Extractor exHref = new Extractor(html, "<a href=", "</a>", 0, true);
+		while (!exHref.endOfSearch()) {
+			String href = exHref.findNext();
+			if (href.length() > 0) {
+				Extractor exHttp = new Extractor(href, "http://", "\"", 0, true);
+				String fetchUrl = exHttp.findNext();
+				try {
+					String imgType = (fetchUrl.substring(fetchUrl.lastIndexOf('.')).toLowerCase() + "    ").substring(0, 4).trim();
+					fetchUrl = "http://" + fetchUrl.substring(0, fetchUrl.lastIndexOf('.') + imgType.length());
+					if (imgType.startsWith(".jpg") ||
+						imgType.startsWith(".bmp") ||
+						imgType.startsWith(".png") ||
+						imgType.startsWith(".gif")) {
+						ImageInfo imageInfo = new ImageInfo();
+						imageInfo.setURL(fetchUrl);
+						imageInfo.setTitle(makeTitle(href, fetchUrl));
+						getPic(imageInfo);
+					}
+				} catch (IndexOutOfBoundsException e) {
+				}
+			}
+		}
+	}
+
+	private String makeTitle(String imgTag, String fetchUrl) {
+		Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))");
+		imgRegexAlt.setIgnoreCase(true);
+		String imgAltText;
+		if (imgRegexAlt.search(imgTag)) {
+			imgAltText=imgRegexAlt.stringMatched(1);
+			if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);			
+		} else { // no alternative text as image title -> use --- or filename
+			//wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
+			if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) 
+				imgAltText = "---"; // no image title
+			else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf('/')+1);
+		}
+		return imgAltText;
+	}
 	
+	private void getPic(ImageInfo imageInfo) {
+		String fileName = holder.getWayPoint() + "_" + imageInfo.getURL().substring(imageInfo.getURL().lastIndexOf('/')+1);
+		fileName = Common.ClearForFileName(fileName).toLowerCase();
+		String target = profile.dataDir + fileName;
+		imageInfo.setFilename(fileName);
+		try {
+			File ftest = new FileBugfix(target);
+			if (ftest.exists()){
+				if (ftest.length() == 0) { ftest.delete(); }
+				else { holder.getCacheDetails(false).images.add(imageInfo);	}
+			}
+			else {
+				if (pref.downloadPics) {
+					UrlFetcher.fetchDataFile(imageInfo.getURL(), target);
+					ftest = new FileBugfix(target);
+					if (ftest.exists()){
+						if ( ftest.length() > 0 ) {
+							holder.getCacheDetails(false).images.add(imageInfo);
+						}
+						else {
+							ftest.delete();
+						}
+					}
+				}
+			}
+		} catch (IOException e) {
+			String ErrMessage;
+			String wp, n;
+			if (holder != null && holder.getWayPoint() != null) wp = holder.getWayPoint();
+			else 												wp = "WP???";
+			if (holder != null && holder.getCacheName() != null) n = holder.getCacheName();
+			else 												 n = "name???";
+
+			if (e == null) ErrMessage = "Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: "+fileName+" from URL:"+imageInfo.getURL();
+			else {
+				if (e.getMessage().equalsIgnoreCase("could not connect") ||
+						e.getMessage().equalsIgnoreCase("unkown host")) {
+					// is there a better way to find out what happened?
+					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+imageInfo.getURL();
+				} else
+					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+imageInfo.getURL();
+			}
+			pref.log(ErrMessage,e,true);
+		}
+
+	}
+
 	public int getHow() {
 		return doitHow;
 	}

Added: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	                        (rev 0)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -0,0 +1,93 @@
+package CacheWolf.imp;
+
+import ewe.io.File;
+import ewe.io.IOException;
+import ewe.ui.FormBase;
+import CacheWolf.Global;
+import CacheWolf.MyLocale;
+import CacheWolf.Preferences;
+import CacheWolf.Profile;
+import CacheWolf.UrlFetcher;
+import CacheWolf.utils.FileBugfix;
+
+public class OCGPXfetch {
+	static Preferences pref = Global.getPref();
+	static Profile prof = Global.getProfile();;
+	
+	public static void doIt() {
+		String hostname = pref.lastOCSite;
+		Boolean oldDownloadAllOC=pref.downloadAllOC;
+		Boolean onlyListedAtOC = false;
+		OCXMLImporterScreen importOpt = new OCXMLImporterScreen(
+				MyLocale.getMsg(130,"Download from opencaching"),
+				OCXMLImporterScreen.IMAGES|
+				OCXMLImporterScreen.ALL|
+				OCXMLImporterScreen.HOST);
+		importOpt.missingCheckBox.setText(MyLocale.getMsg(164,"only listed at OC"));
+		importOpt.missingCheckBox.setState(onlyListedAtOC);
+		if (importOpt.execute() == FormBase.IDCANCEL) {	return; }
+		onlyListedAtOC=pref.downloadAllOC;
+		pref.downloadAllOC=oldDownloadAllOC;
+		if (importOpt.domains.getSelectedItem()!=null) {
+			hostname = (String)importOpt.domains.getSelectedItem();
+			pref.lastOCSite=hostname;
+		}
+
+		try {
+			String address="http://"+hostname+"/search.php?";
+			address+="searchto=searchbyfinder"; // searchbydistance
+			address+="&showresult=1&expert=0&sort=bydistance&orderRatingFirst=0";
+			address+="&f_userowner=0&f_userfound=0&f_inactive=0&f_ignored=0";
+			address+="&f_otherPlatforms="; // 0 = all 1 = nur OC
+			if (onlyListedAtOC)
+				address+="1";
+			else 
+				address+="0"; 
+			address+="&country=&difficultymin=0&difficultymax=0&terrainmin=0&terrainmax=0&cachetype=1;2;3;4;5;6;7;8;9;10&cachesize=1;2;3;4;5;6;7&cache_attribs=&cache_attribs_not=";
+			address+="&logtype=1,7";
+			address+="&utf8=1&output=gpx&zip=1";
+			address+="&count=max";
+			address+="&finder="+pref.myAlias;
+			String tmpFile=prof.dataDir + "dummy.zip";
+			UrlFetcher.fetchDataFile(address, tmpFile);
+			File ftmp = new FileBugfix(tmpFile);
+			if (ftmp.exists() && ftmp.length()>0) {
+				GPXImporter gpx = new GPXImporter(pref, prof, tmpFile);
+				int withPics = GPXImporter.DOIT_NOSPOILER;
+				if (pref.downloadPics) {
+					withPics=GPXImporter.DOIT_WITHSPOILER;
+				}			
+				gpx.doIt(withPics);
+			}
+			ftmp.delete();
+		} catch (IOException e) {
+		}
+	}
+	
+	private static boolean login() {
+		boolean loggedIn = false;
+		String page;
+		try {
+			String loginDaten="target=myhome.php&action=login&email="+pref.myAlias+"&password="+pref.password;
+			try {
+				UrlFetcher.setpostData(loginDaten);
+				UrlFetcher.setMaxRedirections(1);
+				UrlFetcher.fetch("http://www.opencaching.de/login.php");
+			} catch (IOException e) {
+				if (e.getMessage().startsWith("too many http redirections")) {
+					String cookie = (String) UrlFetcher.getDocumentProperties().getValue("Set-Cookie","");
+					UrlFetcher.setPermanentRequestorProperty("Cookie",cookie);
+					page=UrlFetcher.fetch("http://www.opencaching.de/login.php?action=cookieverify&target=myhome.php");
+					page=UrlFetcher.fetch("http://www.opencaching.de/myhome.php");
+					// control , that I am logged in
+					// (by ?) get finderid ?
+					// todo set language ?
+					loggedIn = page.indexOf("Eingeloggt als") > -1;
+				}
+			}			
+		} catch (IOException e) {
+			pref.log("Fehler", e);
+		}
+		return loggedIn;
+	}
+}

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -48,7 +48,6 @@
 
 import ewe.io.BufferedReader;
 import ewe.io.File;
-import ewe.io.FileOutputStream;
 import ewe.io.IO;
 import ewe.io.IOException;
 import ewe.io.InputStreamReader;
@@ -60,8 +59,6 @@
 import ewe.sys.Vm;
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
-import ewe.util.ByteArray;
-import ewe.util.CharArray;
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.zip.ZipEntry;
@@ -126,6 +123,7 @@
 		pref = p;
 		profile=prof;
 		cacheDB = profile.cacheDB;
+		incUpdate=true;
 		if(profile.getLast_sync_opencaching() == null ||
 				profile.getLast_sync_opencaching().length() < 12){
 			profile.setLast_sync_opencaching("20050801000000");
@@ -136,7 +134,6 @@
 		for(int i = 0; i<cacheDB.size();i++){
 			ch = cacheDB.get(i);
 			if (!ch.getOcCacheID().equals(""))
-				//DBindexID.put(ch.getOcCacheID(), (Integer)i);
 				DBindexID.put(ch.getOcCacheID(), ch.getWayPoint());
 		}//for
 
@@ -149,6 +146,7 @@
 	 * @return true, if some change was made to the cacheDB
 	 */
 	public boolean syncSingle(int number, InfoBox infB) {
+
 		CacheHolder ch;
 		ch = cacheDB.get(number);
 		hostname=OC.getOCHostName(ch.getWayPoint());
@@ -168,10 +166,11 @@
 		/** pref.downloadmissingOC = true, if not the last syncdate shall be used,
 		 *  but the caches shall be reloaded
 		 *  only used in syncSingle  */
-		if (pref.downloadMissingOC)  lastS = "20050801000000";
+		incUpdate = false;
+		if (pref.downloadAllOC)  lastS = "20050801000000";
 		else {
 			if (ch.getLastSync().length() < 14) lastS = "20050801000000";
-			else lastS = ch.getLastSync();
+			else { lastS = ch.getLastSync(); incUpdate=true; }
 		}
 		dateOfthisSync = new Time();
 		dateOfthisSync.parse(lastS, "yyyyMMddHHmmss");
@@ -231,8 +230,8 @@
 		distDouble.value = Common.parseDouble(dist);
 		dist = distDouble.toString(0, 1, 0).replace(',', '.');
 		//check, if distance is greater than before
-		if (Convert.toInt(dist) > Convert.toInt(profile.getDistOC()) ||
-				pref.downloadMissingOC  ){
+		incUpdate = true;
+		if (Convert.toInt(dist) > Convert.toInt(profile.getDistOC()) ||	pref.downloadAllOC  ){
 			// resysnc
 			lastS = "20050801000000";
 			incUpdate = false;
@@ -284,7 +283,7 @@
 		inf.addOkButton();
 	}
 
-	private boolean syncOC(String url) {
+	private boolean syncOC(String address) {
 		boolean success=true;
 		File tmpFile = null;
 		BufferedReader r;
@@ -295,16 +294,16 @@
 		String finalMessage = "";
 		try{
 			holder = null;
-			pref.log(url+"fetching");
-			String file = fetch(url, "dummy");
+			String target = profile.dataDir + "dummy.zip";
+			UrlFetcher.fetchDataFile(address, target);
 
 			//parse
-			tmpFile = new FileBugfix(profile.dataDir + file);
+			tmpFile = new FileBugfix(target);
 			if (tmpFile.getLength() == 0 ) {
 				throw new IOException("no updates available");
 			}
 
-			ZipFile zif = new ZipFile (profile.dataDir + file);
+			ZipFile zif = new ZipFile (target);
 			ZipEntry zipEnt;
 			Enumeration zipEnum = zif.entries();
 			inf.setInfo("...unzipping update file");
@@ -418,6 +417,7 @@
 	private void startCache(String name, AttributeList atts){
 		if(name.equals("id")){
 			cacheID = atts.getValue("id");
+			return;
 		}
 		if (holder==null) return;
 		inf.setInfo(MyLocale.getMsg(1609,"Importing Cache:")+" " + numCacheImported + " / " + numCacheUpdated + "\n");
@@ -480,8 +480,10 @@
 
 	private void startCacheDesc(String name, AttributeList atts){
 		inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported);
+
 		if (name.equals("cacheid")){
 			cacheID = atts.getValue("id");
+			holder = getHolder(cacheID, false);
 			return;
 		}
 
@@ -496,15 +498,18 @@
 		}
 	}
 
-	private void startPicture(String name, AttributeList atts){
-	}
-
 	private void startCacheLog(String name, AttributeList atts){
 		if (name.equals("id")){
 			logId = atts.getValue("id");
 			return;
 		}
+
+		if (name.equals("cacheid")){
+			holder = getHolder(atts.getValue("id"), false);
+			return;
+		}
 		if (holder==null) return;
+
 		inf.setInfo(MyLocale.getMsg(1612,"Importing Cachlog:")+" " + numLogImported);
 		
 		if (name.equals("logtype")){
@@ -525,10 +530,19 @@
 		}
 	}
 
+	private void startPicture(String name, AttributeList atts){
+		if (name.equals("object")){
+			cacheID = atts.getValue("id"); // are there picture without cacheID?
+			holder = getHolder(cacheID, false);
+			return;
+		}
+	}
+
 	private void endCache(String name){
 		if(name.equals("id")){ // </id>
-			holder = getHolder(strData, true); // Allocate a new CacheHolder object
-			holder.setOcCacheID(strData);
+			// the guid (=strData) is not part of gpx , so we use id of cacheID
+			holder = getHolder(cacheID, true); // Allocate a new CacheHolder object
+			holder.setOcCacheID(cacheID); 
 			holder.getCacheDetails(false).URL = "http://" + hostname + "/viewcache.php?cacheid=" + cacheID;
 			return;
 		}
@@ -541,7 +555,6 @@
 				numCacheImported++;
 				holder.setNew(true);
 				cacheDB.add(holder);
-				//DBindexID.put(holder.getOcCacheID(), (Integer)cacheDB.size()-1);
 				DBindexID.put(holder.getOcCacheID(), holder.getWayPoint());
 			}
 			// update (overwrite) data
@@ -550,12 +563,10 @@
 				holder.setNew(false);
 				holder.setIncomplete(false);
 				cacheDB.get(index).update(holder);
-				// save ocCacheID, in case, the previous data is from GPX
-				// DBindexID.put(holder.getOcCacheID(), (Integer)index);
 				DBindexID.put(holder.getOcCacheID(), holder.getWayPoint());
 			}
 			// clear data (picture, logs) if we do a complete Update
-			if (incUpdate == false){
+			if (! incUpdate){
 				holder.getCacheDetails(false).CacheLogs.clear();
 				holder.getCacheDetails(false).images.clear();
 			}
@@ -607,43 +618,12 @@
 	}
 
 	private void endCacheDesc(String name){
-		if (name.equals("cacheid")){
-			holder = getHolder(strData, false);
-			return;
-		}
 		if (holder == null) return;
 		if (name.equals("cachedesc")){
 			 numDescImported++;
 			 holder.setHTML(isHTML);
 			if (pref.downloadPics && isHTML) {
-				String fetchUrl, imgTag, imgAltText;
-				Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enthlt keine Anfhrungszeichen
-				Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
-				imgRegexAlt.setIgnoreCase(true);
-				imgRegexUrl.setIgnoreCase(true);
-				int descIndex=0;
-				int numDownloaded=1;
-				while (imgRegexUrl.searchFrom(holder.getCacheDetails(false).LongDescription, descIndex)) { // "img" found
-					imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte <img ...>-tag
-					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen
-					if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
-					if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
-						inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+holder.getWayPoint()));
-						continue;
-					}
-					inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported + "\n"+MyLocale.getMsg(1620, "downloading embedded images: ") + numDownloaded++);
-					if (imgRegexAlt.search(imgTag)) {
-						imgAltText=imgRegexAlt.stringMatched(1);
-						if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
-						// no alternative text as image title -> use filename
-					} else {
-						if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
-							imgAltText = "No image title";
-						else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf('/')+1);
-					}
-					descIndex = imgRegexUrl.matchedTo();
-					getPic(fetchUrl, imgAltText);
-				}
+				getImageNamesFromDescription();
 			}
 			holder.getCacheDetails(false).hasUnsavedChanges = true;
 			return;
@@ -677,97 +657,7 @@
 		}
 	}
 
-	private String createPicFilename(String fetchURL) {
-		String fileName = holder.getWayPoint() + "_" + fetchURL.substring(fetchURL.lastIndexOf('/')+1);
-		return Common.ClearForFileName(fileName).toLowerCase();
-	}
-
-	private void getPic(String fetchURL, String picDesc) { // TODO handling of relativ URLs
-		try {
-			//TODO this is not quite correct: actually the "base" URL must be known...
-			// but anyway a different baseURL should not happen very often  - it doesn't in my area
-			if (!fetchURL.startsWith("http://")) {
-				fetchURL = new URL(new URL("http://" + hostname+"/"), fetchURL).toString();
-			}
-			String fileName = createPicFilename(fetchURL);
-			ImageInfo imageInfo = new ImageInfo();
-			imageInfo.setURL(fetchURL);
-			// add title
-			imageInfo.setTitle(picDesc);
-			holder.getCacheDetails(false).images.add(imageInfo);
-			try {
-				File ftest = new FileBugfix(profile.dataDir + fileName);
-				if (ftest.exists()){
-					imageInfo.setFilename(fileName);
-				}
-				else {
-					if (pref.downloadPics) {
-						imageInfo.setFilename(fetch(fetchURL, fileName));
-					}
-				}
-			} catch (IOException e) {
-				String ErrMessage;
-				String wp, n;
-				if (holder != null && holder.getWayPoint() != null) wp = holder.getWayPoint();
-				else 												wp = "WP???";
-				if (holder != null && holder.getCacheName() != null) n = holder.getCacheName();
-				else 												 n = "name???";
-
-				if (e == null) ErrMessage = "Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: "+fileName+" from URL:"+fetchURL;
-				else {
-					if (e.getMessage().equalsIgnoreCase("could not connect") ||
-							e.getMessage().equalsIgnoreCase("unkown host")) {
-						// is there a better way to find out what happened?
-						ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
-					} else
-						ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL;
-				}
-				inf.addWarning("\n"+ErrMessage);
-				pref.log(ErrMessage,e,true);
-			}
-		} catch (MalformedURLException e) {
-			String ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring MalformedUrlException: " + e.getMessage()+ " while downloading from URL:" + fetchURL;
-			inf.addWarning("\n"+ErrMessage);
-			pref.log(ErrMessage,e);
-		}
-
-	}
-
-
-	private void endPicture(String name){
-		if(name.equals("object")){
-			holder = getHolder(strData, false);
-			return;
-		}
-		if (holder == null) return;
-
-		if(name.equals("id")){
-			picID = strData;
-			return;
-		}
-
-		if (name.equals("url")){
-			picUrl = strData;
-			return;
-		}
-		if (name.equals("title")){
-			picTitle = strData;
-			return;
-		}
-		if(name.equals("picture")){
-			inf.setInfo(MyLocale.getMsg(1613,"Pictures:")+" " + ++picCnt);
-			//String fileName = holder.wayPoint + "_" + picUrl.substring(picUrl.lastIndexOf("/")+1);
-			getPic(picUrl,picTitle);
-			holder.getCacheDetails(false).hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
-			return;
-		}
-	}
-
 	private void endCacheLog(String name){
-		if (name.equals("cacheid")){
-			holder = getHolder(strData, false);
-			return;
-		}
 		if (holder == null) return;
 		if (name.equals("cachelog")){ // </cachelog>
 			if (holder.getCacheDetails(false).CacheLogs.merge(new Log(logIcon, logDate, logFinder, logData, loggerRecommended))> -1) {
@@ -811,14 +701,32 @@
 
 	}
 
-	private String fetch(String addr, String fileName ) throws IOException
-	{
-		CharArray realurl = new CharArray();
-		ByteArray daten = UrlFetcher.fetchByteArray(addr, realurl);
-		FileOutputStream outp =  new FileOutputStream(profile.dataDir + fileName);
-		outp.write(daten.toBytes());
-		outp.close();
-		return fileName;
+	private void endPicture(String name){
+		if (holder == null) return;
+
+		if(name.equals("id")){
+			picID = strData;
+			return;
+		}
+
+		if (name.equals("url")){
+			picUrl = strData;
+			return;
+		}
+		if (name.equals("title")){
+			picTitle = strData;
+			return;
+		}
+		if(name.equals("picture")){
+			inf.setInfo(MyLocale.getMsg(1613,"Pictures:")+" " + ++picCnt);
+			//String fileName = holder.wayPoint + "_" + picUrl.substring(picUrl.lastIndexOf("/")+1);
+			ImageInfo ii = new ImageInfo();
+			ii.setTitle(picTitle);
+			ii.setURL(picUrl);
+			getPic(ii);
+			holder.getCacheDetails(false).hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
+			return;
+		}
 	}
 
 	private CacheHolder getHolder(String guid, boolean create){// See also LOCXMLImporter
@@ -835,4 +743,101 @@
 		return ch;
 	}
 
+	
+	private void getImageNamesFromDescription() {
+		String fetchUrl;
+		String imgTag;
+		String imgAltText;
+		Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enthlt keine Anfhrungszeichen
+		Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
+		imgRegexAlt.setIgnoreCase(true);
+		imgRegexUrl.setIgnoreCase(true);
+		int descIndex=0;
+		int numDownloaded=1;
+		while (imgRegexUrl.searchFrom(holder.getCacheDetails(false).LongDescription, descIndex)) { // "img" found
+			imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte <img ...>-tag
+			fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen
+			if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
+			if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
+				inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+holder.getWayPoint()));
+				continue;
+			}
+			inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported + "\n"+MyLocale.getMsg(1620, "downloading embedded images: ") + numDownloaded++);
+			if (imgRegexAlt.search(imgTag)) {
+				imgAltText=imgRegexAlt.stringMatched(1);
+				if (imgAltText==null)	imgAltText=imgRegexAlt.stringMatched(2);
+				// no alternative text as image title -> use filename
+			} else {
+				if (fetchUrl.toLowerCase().indexOf("opencaching.") > 0 || fetchUrl.toLowerCase().indexOf("geocaching.com") > 0) //wenn von Opencaching oder geocaching ist Dateiname doch nicht so toll, weil nur aus Nummer bestehend
+					imgAltText = "No image title";
+				else imgAltText = fetchUrl.substring(fetchUrl.lastIndexOf('/')+1);
+			}
+			descIndex = imgRegexUrl.matchedTo();
+			try {
+				//TODO this is not quite correct: actually the "base" URL must be known...
+				// but anyway a different baseURL should not happen very often  - it doesn't in my area
+				if (!fetchUrl.startsWith("http://")) {
+					fetchUrl = new URL(new URL("http://" + hostname+"/"), fetchUrl).toString();
+				}
+			} catch (MalformedURLException e) {			
+				String ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring MalformedUrlException: " + e.getMessage()+ " while downloading from URL:" + fetchUrl;
+				inf.addWarning("\n"+ErrMessage);
+				pref.log(ErrMessage,e);
+			}
+			ImageInfo imageInfo = new ImageInfo();
+			imageInfo.setURL(fetchUrl);
+			imageInfo.setTitle(imgAltText);
+			getPic(imageInfo);
+		}
+	}
+
+	
+	private void getPic(ImageInfo imageInfo) { // TODO handling of relativ URLs		
+		String fileName = holder.getWayPoint() + "_" + imageInfo.getURL().substring(imageInfo.getURL().lastIndexOf('/')+1);
+		fileName = Common.ClearForFileName(fileName).toLowerCase();
+		String target = profile.dataDir + fileName;
+		imageInfo.setFilename(fileName);
+		try {
+			File ftest = new FileBugfix(target);
+			if (ftest.exists()){
+				if (ftest.length() == 0) { ftest.delete(); }
+				else { holder.getCacheDetails(false).images.add(imageInfo);	}
+			}
+			else {
+				if (pref.downloadPics) {
+					UrlFetcher.fetchDataFile(imageInfo.getURL(), target);
+					ftest = new FileBugfix(target);
+					if (ftest.exists()){
+						if ( ftest.length() > 0 ) {
+							holder.getCacheDetails(false).images.add(imageInfo);
+						}
+						else {
+							ftest.delete();
+						}
+					}
+				}
+			}
+		} catch (IOException e) {
+			String ErrMessage;
+			String wp, n;
+			if (holder != null && holder.getWayPoint() != null) wp = holder.getWayPoint();
+			else 												wp = "WP???";
+			if (holder != null && holder.getCacheName() != null) n = holder.getCacheName();
+			else 												 n = "name???";
+
+			if (e == null) ErrMessage = "Ignoring error: OCXMLImporter.getPic: IOExeption == null, while downloading picture: "+fileName+" from URL:"+imageInfo.getURL();
+			else {
+				if (e.getMessage().equalsIgnoreCase("could not connect") ||
+						e.getMessage().equalsIgnoreCase("unkown host")) {
+					// is there a better way to find out what happened?
+					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+imageInfo.getURL();
+				} else
+					ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+ n + " ("+wp+"): ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+imageInfo.getURL();
+			}
+			inf.addWarning("\n"+ErrMessage);
+			pref.log(ErrMessage,e,true);
+		}
+
+	}
+	
 }

Modified: trunk/src/CacheWolf/imp/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/OCXMLImporterScreen.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -205,7 +205,7 @@
 		if((options & ALL) > 0){
 			missingCheckBox = new mCheckBox();
 			missingCheckBox.setText(MyLocale.getMsg(1606,"Alle erneut downloaden"));
-			missingCheckBox.setState(pref.downloadMissingOC);
+			missingCheckBox.setState(pref.downloadAllOC);
 			this.addLast(missingCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
 		}
 
@@ -240,7 +240,7 @@
 			}
 			if (ev.target == okB){
 				    // distOC wird hier noch nicht in Pref eingetragen, damit noch gepr?ft werden kann, ob es gr??er oder kleiner ist als vorher
-					if (missingCheckBox!=null) pref.downloadMissingOC = missingCheckBox.state;
+					if (missingCheckBox!=null) pref.downloadAllOC = missingCheckBox.state;
 					if (imagesCheckBox!=null) pref.downloadPics = imagesCheckBox.state;
 					if (travelbugsCheckBox!=null) pref.downloadTBs = travelbugsCheckBox.state;
 					if (maxLogsInput!=null) pref.maxLogsToSpider=Common.parseInt(maxLogsInput.getText());

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-04 15:59:46 UTC (rev 2942)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-04 21:17:51 UTC (rev 2943)
@@ -48,6 +48,7 @@
 import CacheWolf.STRreplace;
 import CacheWolf.SafeXML;
 import CacheWolf.Travelbug;
+import CacheWolf.UrlFetcher;
 import CacheWolf.navi.Area;
 import CacheWolf.navi.Metrics;
 import CacheWolf.navi.MovingMap;
@@ -67,7 +68,6 @@
 import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.InputStreamReader;
-import ewe.io.JavaUtf8Codec;
 import ewe.net.Socket;
 import ewe.net.URL;
 import ewe.net.UnknownHostException;
@@ -77,7 +77,6 @@
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
 import ewe.util.ByteArray;
-import ewe.util.CharArray;
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.Properties;
@@ -115,8 +114,7 @@
 	private static Preferences pref;
 	private Profile profile;
 
-	private static String cookieID = "";
-	private static String cookieSession = "";
+	private static String cookie = "";
 	private static double minDistance = 0;
 	private static double maxDistance = 0;
 	private static String direction = "";
@@ -182,10 +180,8 @@
 	private int numPrivate = 0;
 	private int page_number = 1;
 	private int num_added = 0;
-	
-	private static HttpConnection conn;
 
-	public SpiderGC(Preferences prf, Profile profile, boolean bypass) {
+	public SpiderGC(Preferences prf, Profile profile) {
 		this.profile = profile;
 		this.cacheDB = profile.cacheDB;
 		pref = prf;
@@ -233,9 +229,7 @@
 					+ "with Founds       : " + (doNotgetFound ? "no" : "yes")
 					+ Preferences.NEWLINE + "alias is premium m: "
 					+ (!pref.isPremium ? "no" : "yes") + Preferences.NEWLINE
-					+ "Update if new Logs: " + (!pref.checkLog ? "no" : "yes") + Preferences.NEWLINE
-					+ "Update if TB change: " + (!pref.checkTBs ? "no" : "yes") + Preferences.NEWLINE
-					+ "Update if DTS change: " + (!pref.checkDTS ? "no" : "yes")
+					+ "Update if new Logs: " + (!pref.checkLog ? "no" : "yes")
 					+ Preferences.NEWLINE, null);
 
 			Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
@@ -1182,7 +1176,7 @@
 		localInfB.exec();
 		try {
 			String doc = p.getProp("waypoint") + wayPoint;
-			completeWebPage = fetchText(doc, false);
+			completeWebPage = UrlFetcher.fetch(doc);
 			pref.log("Fetched " + wayPoint);
 		} catch (Exception ex) {
 			localInfB.close(0);
@@ -1204,19 +1198,22 @@
 	 * displayed.
 	 */
 	private int login() {
-		String passwort = pref.password;
+		if (cookie.length() > 0) 
+			UrlFetcher.setPermanentRequestorProperty("Cookie", cookie);
+		else
+			UrlFetcher.setPermanentRequestorProperty("Cookie", null);
 		loggedIn = false;
-		String loginPage, loginPageUrl, loginSuccess, nextPage;
+		String loginPage, loginPageUrl, loginSuccess;
 		try {
 			loginPageUrl = p.getProp("loginPage");
 			loginSuccess = p.getProp("loginSuccess");
-			nextPage = p.getProp("nextPage");
 		} catch (Exception ex) { // Tag not found in spider.def
 			return ERR_LOGIN;
 		}
-		// Get password
-		InfoBox localInfB = new InfoBox(MyLocale.getMsg(5506, "Password"),
-				MyLocale.getMsg(5505, "Enter Password"), InfoBox.INPUT);
+
+		// **0 Get password
+		String passwort = pref.password;
+		InfoBox localInfB = new InfoBox(MyLocale.getMsg(5506, "Password"),MyLocale.getMsg(5505, "Enter Password"), InfoBox.INPUT);
 		localInfB.feedback.setText(passwort);
 		localInfB.feedback.isPassword = true;
 		int code = FormBase.IDOK;
@@ -1225,15 +1222,14 @@
 			passwort = localInfB.getInput();
 		}
 		localInfB.close(0);
-		if (code != FormBase.IDOK)
-			return code;
-		// Now start the login proper
+		if (code != FormBase.IDOK) return code;
+		
+		// **1 now we have user and password for login
 		localInfB = new InfoBox(MyLocale.getMsg(5507, "Status"), MyLocale.getMsg(5508, "Logging in..."));
 		localInfB.exec();
 		try {
-			// Access the page once to get a viewstate
-			loginPage = fetchText(loginPageUrl, false); // http://www.geocaching.com/login/Default.aspx
-			pref.log("[login]:Fetched login page " + loginPageUrl);
+			// "http://www.geocaching.com/login/default.aspx?RESETCOMPLETE=Y" | loginPageUrl
+			loginPage = UrlFetcher.fetch(loginPageUrl); // http://www.geocaching.com/login/Default.aspx
 			if (loginPage.equals("")) {
 				localInfB.close(0);
 				(new MessageBox(MyLocale.getMsg(5500, "Error"),
@@ -1250,64 +1246,105 @@
 			pref.log("[login]:Could not fetch: gc.com login page", ex);
 			return ERR_LOGIN;
 		}
-		if (!localInfB.isClosed) { // If user has not aborted, we continue
-			Regex rexCookieID = new Regex("(?i)Set-Cookie: userid=(.*?);.*");
-			Regex rexViewstate = new Regex(
-					"id=\"__VIEWSTATE\" value=\"(.*?)\" />");
-			// Regex rexViewstate1 = new
-			// Regex("id=\"__VIEWSTATE1\" value=\"(.*?)\" />");
-			// Regex rexEventvalidation = new
-			// Regex("id=\"__EVENTVALIDATION\" value=\"(.*?)\" />");
-			Regex rexCookieSession = new Regex(
-					"(?i)Set-Cookie: ASP.NET_SessionId=(.*?);.*");
-			String viewstate = "";
-			rexViewstate.search(loginPage);
-			if (rexViewstate.didMatch()) {
-				viewstate = rexViewstate.stringMatched(1);
-			} else {
-				pref.log("[login]:rexViewstate not found before login", null);
+		
+		// **2 now we can check the loginpage if logged in else log in
+		if (!localInfB.isClosed) {
+			if (loginPage.indexOf(loginSuccess) > 0)  {
+				if (loginPage.indexOf(pref.myAlias) > 0) {
+					loggedIn = true;
+					// assume language is already set to EN
+					pref.log("[login]:Already logged in as " + pref.myAlias);
+				}
+				else {
+					// it is another user, whom we should logout
+					try {
+						loginPage = UrlFetcher.fetch("http://www.geocaching.com/login/default.aspx?RESETCOMPLETE=Y");						
+					} catch (Exception ex) {
+						localInfB.close(0);
+						(new MessageBox(MyLocale.getMsg(5500, "Error"),
+								MyLocale.getMsg(5499, "Error loading login page.%0aPlease check your internet connection."),
+								FormBase.OKB)).execute();
+						pref.log("[login]:Could not fetch: gc.com login page", ex);
+						return ERR_LOGIN;
+					}
+					
+				}
 			}
-
-			if (loginPage.indexOf(loginSuccess) > 0)
-				pref.log("[login]:Already logged in" + pref.myAlias);
-			else {
-				/*
-				 * rexEventvalidation.search(loginPage);
-				 * if(rexEventvalidation.didMatch()){ // eventvalidation =
-				 * rexEventvalidation.stringMatched(1); } else
-				 * pref.log("[login]:rexEventvalidation not found before login"
-				 * ,null); //Ok now login!
-				 */
+			if (!loggedIn)
+				{
 				try {
+					Regex rexViewstate = new Regex("id=\"__VIEWSTATE\" value=\"(.*?)\" />");
+					String viewstate = "";
+					rexViewstate.search(loginPage);
+					if (rexViewstate.didMatch()) {
+						viewstate = rexViewstate.stringMatched(1);
+					} else {
+						pref.log("[login]:__VIEWSTATE not found (before login): no login possible.", null);
+						// we need the __VIEWSTATE for sending loginData, so we should abort here
+						return ERR_LOGIN;
+					}
 					StringBuffer sb = new StringBuffer(1000);
-					sb.append(URL.encodeURL("__VIEWSTATE", false));
-					sb.append("=");
-					sb.append(URL.encodeURL(viewstate, false));
+					sb.append("__VIEWSTATE="+URL.encodeURL(viewstate, false));
 					sb.append("&ctl00%24ContentBody%24");
-					sb.append(URL.encodeURL("myUsername", false));
-					sb.append("=");
-					sb.append(encodeUTF8URL(Utils
-							.encodeJavaUtf8String(pref.myAlias)));
+					sb.append("myUsername="+encodeUTF8URL(Utils.encodeJavaUtf8String(pref.myAlias)));
 					sb.append("&ctl00%24ContentBody%24");
-					sb.append(URL.encodeURL("myPassword", false));
-					sb.append("=");
-					sb.append(encodeUTF8URL(Utils
-							.encodeJavaUtf8String(passwort)));
+					sb.append("myPassword="+encodeUTF8URL(Utils.encodeJavaUtf8String(passwort)));
 					sb.append("&ctl00%24ContentBody%24");
-					sb.append(URL.encodeURL("cookie", false));
-					sb.append("=");
-					sb.append(URL.encodeURL("on", false));
+					sb.append("cookie=on");
 					sb.append("&ctl00%24ContentBody%24");
-					sb.append(URL.encodeURL("Button1", false));
-					sb.append("=");
-					sb.append(URL.encodeURL("Login", false));
-					// sb.append("&");
-					// sb.append(URL.encodeURL("__EVENTVALIDATION",false));
-					// sb.append("=");
-					// sb.append(URL.encodeURL(eventvalidation,false));
-					loginPage = fetch_post(loginPageUrl, sb.toString(), true);
-					if (loginPage.indexOf(loginSuccess) > 0)
+					sb.append("Button1=Login");
+					UrlFetcher.setpostData(sb.toString());
+					loginPage = UrlFetcher.fetch(loginPageUrl);
+					if (loginPage.indexOf(loginSuccess) > 0) {
 						pref.log("Login successful: " + pref.myAlias);
+						// **3 now we are logged in and get the Cookie (there are two)
+						PropertyList pl = UrlFetcher.getDocumentProperties();
+						cookie = "";
+						for (int i = 0; i < pl.size(); i++) {
+							Property p = (Property) pl.get(i);
+							if (p.name.equalsIgnoreCase("Set-Cookie")) {
+								cookie+=p.value;
+							}
+						}
+						/* */
+						String cookieID="";
+						Regex rexCookieID = new Regex("(?i)userid=(.*?);.*");
+						rexCookieID.search(cookie);
+						if (!rexCookieID.didMatch()) {
+							pref.log("[login]:check rexCookieID in SpiderGC.java --> CookieID not found. Using old one.");
+						} else
+							cookieID = rexCookieID.stringMatched(1);
+						String cookieSession="";
+						Regex rexCookieSession = new Regex("(?i)ASP.NET_SessionId=(.*?);.*");
+						rexCookieSession.search(cookie);
+						if (!rexCookieSession.didMatch()) {
+							pref.log("[login]:check rexCookieSession in SpiderGC.java --> CookieSession not found. Using old one.");
+						} else
+							cookieSession = rexCookieSession.stringMatched(1);
+						cookie="ASP.NET_SessionId=" + cookieSession + "; userid=" + cookieID;
+						/* */
+						UrlFetcher.setPermanentRequestorProperty("Cookie", cookie);
+
+						// **4 change language to EN 
+						rexViewstate.search(loginPage);
+						if (!rexViewstate.didMatch()) {
+							pref.log("[login]:check rexViewstate in SpiderGC.java --> not found after login"
+									+ Preferences.NEWLINE + loginPage, null);
+						}
+						viewstate = rexViewstate.stringMatched(1);
+						String strEnglishPage = "ctl00$uxLocaleList$uxLocaleList$ctl01$uxLocaleItem";
+						String postStr = "__EVENTTARGET="+ URL.encodeURL(strEnglishPage, false)
+										+ "&__EVENTARGUMENT="
+										+ "&__VIEWSTATE=" + URL.encodeURL(viewstate, false);
+						try {
+							UrlFetcher.setpostData(postStr);
+							loginPage = UrlFetcher.fetch(loginPageUrl);
+							// there is no real check if switched
+							pref.log("Switched to English"+loginPage);
+						} catch (Exception ex) {
+							pref.log("Error switching to English: check/n" + loginPageUrl + "/n" + postStr, ex);
+						}
+					}
 					else {
 						pref.log("Login failed. Wrong Account or Password? " + pref.myAlias, null);
 						pref.log("[login.LoginUrl]:" + sb.toString(), null);
@@ -1327,63 +1364,8 @@
 					return ERR_LOGIN;
 				}
 			}
-
-			rexViewstate.search(loginPage);
-			if (!rexViewstate.didMatch()) {
-				pref.log("[login]:check rexViewstate in SpiderGC.java --> not found after login"
-						+ Preferences.NEWLINE + loginPage, null);
-			}
-			viewstate = rexViewstate.stringMatched(1);
-
-			rexCookieID.search(loginPage);
-			if (!rexCookieID.didMatch()) {
-				pref.log("[login]:check rexCookieID in SpiderGC.java --> CookieID not found. Using old one.", null);
-			} else
-				cookieID = rexCookieID.stringMatched(1);
-			rexCookieSession.search(loginPage);
-			if (!rexCookieSession.didMatch()) {
-				pref.log("[login]:check rexCookieSession in SpiderGC.java --> CookieSession not found. Using old one."
-						+ Preferences.NEWLINE + loginPage);
-			} else
-				cookieSession = rexCookieSession.stringMatched(1);
-
-			/*
-			 * String viewstate1; rexViewstate1.search(loginPage);
-			 * if(rexViewstate1.didMatch()){ viewstate1 =
-			 * rexViewstate1.stringMatched(1); } else { viewstate1 = "";
-			 * pref.log(
-			 * "[login]:check rexViewstate1 in SpiderGC.java --> not found after login"
-			 * +Preferences.NEWLINE+loginPage); }
-			 */
-
-			/*
-			 * rexEventvalidation.search(htmlPage);
-			 * if(rexEventvalidation.didMatch()){ eventvalidation =
-			 * rexEventvalidation.stringMatched(1); } else { eventvalidation =
-			 * ""; }
-			 */
-
-			String strEnglishPage = "ctl00$uxLocaleList$uxLocaleList$ctl01$uxLocaleItem";
-			String postStr = URL.encodeURL("__EVENTTARGET", false) + "="
-					+ URL.encodeURL(strEnglishPage, false) + "&"
-					+ URL.encodeURL("__EVENTARGUMENT", false) + "="
-					+ URL.encodeURL("", false)
-					// + "&" + URL.encodeURL("__VIEWSTATEFIELDCOUNT",false)
-					// +"=2"
-					+ "&" + URL.encodeURL("__VIEWSTATE", false) + "="
-					+ URL.encodeURL(viewstate, false);
-			// + "&" + URL.encodeURL("__VIEWSTATE1",false) +"="+
-			// URL.encodeURL(viewstate1,false);
-			// + "&" + URL.encodeURL("__EVENTVALIDATION",false) +"="+
-			// URL.encodeURL(eventvalidation,false);
-			try {
-				loginPage = fetch_post(loginPageUrl, postStr, true);
-				pref.log("Switched to English");
-			} catch (Exception ex) {
-				pref.log("Error switching to English: check/n" + loginPageUrl
-						+ "/n" + postStr + "/n" + nextPage + "/n", ex);
-			}
 		}
+		
 		boolean loginAborted = localInfB.isClosed;
 		localInfB.close(0);
 		if (loginAborted)
@@ -1393,7 +1375,6 @@
 			return FormBase.IDOK;
 		}
 	}
-
 	/*
 	 *
 	 */
@@ -1457,7 +1438,7 @@
 		url = url + cacheTypeRestriction;
 		
 		try {
-			htmlListPage = fetchText(url, false);
+			htmlListPage = UrlFetcher.fetch(url);
 			pref.log("[getFirstListPage] Got first page " + url);
 		} catch (Exception ex) {
 			pref.log("[getFirstListPage] Error fetching first list page " + url, ex, true);
@@ -1521,7 +1502,8 @@
 						  "__VIEWSTATE1=" + URL.encodeURL(viewstate1, false); // + "&" +
 						  //"__EVENTVALIDATION=" + URL.encodeURL(eventvalidation,false);
 		try {
-			htmlListPage = fetch_post(url, postData, true);
+			UrlFetcher.setpostData(postData);
+			htmlListPage = UrlFetcher.fetch(url);
 			pref.log("[getAListPage] Got list page: " + URL.encodeURL(whatPage, false));
 		} catch (Exception ex) {
 			pref.log("[getAListPage] Error getting a list page" + url, ex);
@@ -1537,7 +1519,11 @@
 		"&lng="	+ middle.getLonDeg(TransformCoordinates.DD);
 
 		if (userToken.equals("")) {
-			ret = fetchText(referer, false);
+			try {
+				ret = UrlFetcher.fetch(referer);
+			} catch (IOException e) {
+				ret="";
+			}
 			int i = ret.indexOf("userToken = '");
 			i=i+13;
 			int j = ret.indexOf("'", i);
@@ -1557,7 +1543,19 @@
 		String postData = param1+param2+param3+userToken+param4;
 
 		try {
-		ret = post(url, postData, referer, false);
+			UrlFetcher.setpostData(postData);
+			// UrlFetcher.setRequestorProperty("Accept","application/json, text/javascript, */*; q=0.01");
+			// UrlFetcher.setRequestorProperty("Accept-Language","de-de,de;q=0.8,en-us;q=0.5,en;q=0.3");
+			// UrlFetcher.setRequestorProperty("Accept-Encoding","gzip,deflate");
+			// UrlFetcher.setRequestorProperty("Accept-Charset","ISO-8859-1,utf-8;q=0.7,*;q=0.7");
+			// UrlFetcher.setRequestorProperty("Keep-Alive","115");
+			// UrlFetcher.setRequestorProperty("Proxy-Connection","keep-alive");
+			UrlFetcher.setRequestorProperty("Content-Type", "application/json; charset=UTF-8");
+			// UrlFetcher.setRequestorProperty("X-Requested-With","XMLHttpRequest");
+			// UrlFetcher.setRequestorProperty("Referer",referer);
+			// UrlFetcher.setRequestorProperty("Pragma","no-cache");
+			// UrlFetcher.setRequestorProperty("Cache-Control","no-cache");
+			ret=UrlFetcher.fetch(url);
 		} catch (Exception ex) {
 			ret = "";
 			pref.log("[SpiderGC:getMapListPage] Error getting map Cachepage" + url + postData, ex);
@@ -1565,45 +1563,6 @@
 		return ret;
  	}
 
-	private static String post(String url, String postData, String referer, boolean withResponseHeaders) {
-		HttpConnection conn;
-		try {
-			conn = new HttpConnection(url);
-			JavaUtf8Codec codec = new ewe.io.JavaUtf8Codec();
-			conn.documentIsEncoded = true;
-			conn.setRequestorProperty("User-Agent","Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12");
-			conn.setRequestorProperty("Accept","application/json, text/javascript, */*; q=0.01");
-			conn.setRequestorProperty("Accept-Language","de-de,de;q=0.8,en-us;q=0.5,en;q=0.3");
-			conn.setRequestorProperty("Accept-Encoding","gzip,deflate");
-			conn.setRequestorProperty("Accept-Charset","ISO-8859-1,utf-8;q=0.7,*;q=0.7");
-			conn.setRequestorProperty("Keep-Alive","115");
-			conn.setRequestorProperty("Proxy-Connection","keep-alive");
-			conn.setRequestorProperty("Content-Type", "application/json; charset=UTF-8");
-			conn.setRequestorProperty("X-Requested-With","XMLHttpRequest");
-			conn.setRequestorProperty("Referer",referer);
-			conn.setRequestorProperty("Pragma","no-cache");
-			conn.setRequestorProperty("Cache-Control","no-cache");
-			// if (cookieSession.length() > 0) { conn.setRequestorProperty("Cookie", "ASP.NET_SessionId=" + cookieSession + "; userid=" + cookieID); }
-			conn.setRequestorProperty("Connection", "close");
-			//conn.setPostData(codec.encodeText(postData.toCharArray(), 0, postData.length(), true, null));
-			conn.setPostData(postData);
-			Socket sock = conn.connect();
-			// CharArray c_data = conn.readText(sock, codec);
-			ByteArray daten = conn.readData(sock);
-			CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			
-			sock.close();
-			
-			if (withResponseHeaders)
-				return getResponseHeaders(conn) + c_data.toString();
-			else
-				return c_data.toString();
-		} catch (Exception e) {
-			pref.log("[fetch_post] Ignored Exception", e, true);
-		}
-		return "";
-	}
-
 	/**
 	 * check if new Update exists
 	 * 
@@ -1656,31 +1615,29 @@
 			save = true;
 			ret = true;
 		}
-		
 		if (pref.checkDTS) {
-  		String dts[]=mString.split(getDTS(CacheDescription),'/');
-  		if (dts.length == 3) {
-  			if (difficultyChanged(ch,  CacheTerrDiff.v1Converter(dts[0]))) {
-  				save = true;
-  				ret = true;
-  				pref.log("difficultyChanged");
-  			}
-  			if (terrainChanged(ch, CacheTerrDiff.v1Converter(dts[1]))) {
-  				save = true;
-  				ret = true;
-  				pref.log("terrainChanged");
-  			}
-  			if (sizeChanged(ch, (byte) Common.parseInt(dts[2]))) {
-  				save = true;
-  				ret = true;
-  				pref.log("sizeChanged");
-  			}
-  		}
-  		else {
-  			pref.log("check DTS calculation", null);
-  		}
+			String dts[]=mString.split(getDTS(CacheDescription),'/');
+			if (dts.length == 3) {
+				if (difficultyChanged(ch,  CacheTerrDiff.v1Converter(dts[0]))) {
+					save = true;
+					ret = true;
+					pref.log("difficultyChanged");
+				}
+				if (terrainChanged(ch, CacheTerrDiff.v1Converter(dts[1]))) {
+					save = true;
+					ret = true;
+					pref.log("terrainChanged");
+				}
+				if (sizeChanged(ch, (byte) Common.parseInt(dts[2]))) {
+					save = true;
+					ret = true;
+					pref.log("sizeChanged");
+				}
+			}
+			else {
+				pref.log("check DTS calculation", null);
+			}
 		}
-		
 		if (newFoundExists(ch,  CacheDescription)) {
 			numLogUpdates++;
 			ret = true;
@@ -1755,7 +1712,12 @@
 			// String thereitis="|0.34 km|102.698";
 			// String page = fetchText("http://www.geocaching.com/seek/nearest.aspx?lat=48.48973&lng=009.26313&dist=2&f=1",false);
 			String thereitis="|0.08 km|223.968";
-			String page = fetchText("http://www.geocaching.com/seek/nearest.aspx?lat=45.29152&lng=-122.41262&dist=1",false);
+			String page;
+			try {
+				page = UrlFetcher.fetch("http://www.geocaching.com/seek/nearest.aspx?lat=45.29152&lng=-122.41262&dist=1");
+			} catch (IOException e) {
+				page="";
+			}
 			//  
 			RexPropListBlock.search(page);
 			String table="";
@@ -1779,7 +1741,6 @@
 			int keylength=13; // wenn nicht 13 dann newkey auf wiederholung pr?fen
 			DistanceCodeKey=newkey.substring(0, keylength);
 			ret = decodeXor( stmp, DistanceCodeKey).replace('|', ' ');
-			pref.log("Automatic key: " + DistanceCodeKey + " result: " + ret + Preferences.NEWLINE);
 			RexPropDistance.search(ret); // km oder mi
 		}
 
@@ -1866,8 +1827,13 @@
 		if (RexPropDTS.didMatch()) {
 			String code=RexPropDTS.stringMatched(1);
 			/* */
-			String url = "http://www.geocaching.com/ImgGen/seek/CacheInfo.ashx?v="+code;
-			ByteArray doc=fetch(url);
+			String address = "http://www.geocaching.com/ImgGen/seek/CacheInfo.ashx?v="+code;
+			ByteArray doc;
+			try {
+				doc = UrlFetcher.fetchData(address);
+			} catch (IOException e) {
+				return "";
+			}
 			Image idoc = new Image(doc,0,null,0,0);
 			/*
 			FileOutputStream fos;
@@ -2207,7 +2173,7 @@
 							+ ch.getWayPoint()
 							+ ((fetchAllLogs || ch.is_found()) ? p
 									.getProp("fetchAllLogs") : "");
-					completeWebPage = fetchText(doc, false);
+					completeWebPage = UrlFetcher.fetch(doc);
 					pref.log("Fetched: " + ch.getWayPoint());
 					if (completeWebPage.equals("")) {
 						pref.log("Could not fetch " + ch.getWayPoint(), null);
@@ -2749,7 +2715,7 @@
 					infB.setInfo(oldInfoBox
 							+ MyLocale.getMsg(5514, "\nGetting bug: ")
 							+ SafeXML.cleanback(bug));
-					bugDetails = fetchText(link, false);
+					bugDetails = UrlFetcher.fetch(link);
 					pref.log("[getBugs] Fetched TB details: " + bug);
 					Extractor exDetails = new Extractor(bugDetails, p
 							.getProp("bugDetailsStart"), p
@@ -2795,23 +2761,17 @@
 		if (oldCh != null) {
 			lastImages = oldCh.getCacheDetails(false).images;
 		}
-
 		// ========
-		// In the long description
+		// In the long Description
 		// ========
-		String longDesc = "";
+		String longDesc = doc;
 		try {
-			if (chD.getParent().getWayPoint().startsWith("TC") || !extractLongDesc)
-				longDesc = doc;
-			else
+			if (chD.getParent().getWayPoint().startsWith("GC") || extractLongDesc)
 				longDesc = getLongDesc(doc);
 			longDesc = STRreplace.replace(longDesc, "<img", "<IMG");
 			longDesc = STRreplace.replace(longDesc, "src=", "SRC=");
 			longDesc = STRreplace.replace(longDesc, "'", "\"");
-			exImgBlock = new Extractor(longDesc, 
-					p.getProp("imgBlockExStart"),
-					p.getProp("imgBlockExEnd"), 
-					0, false);
+			exImgBlock = new Extractor(longDesc, p.getProp("imgBlockExStart"), p.getProp("imgBlockExEnd"), 0, false);
 		} catch (Exception ex) {// Missing property in spider.def
 			return;
 		}
@@ -2821,12 +2781,10 @@
 		while (exImgBlock.endOfSearch() == false) {
 			imgUrl = exImgSrc.findNext();
 			if (imgUrl.length() > 0) {
-				// Optimize: img.groundspeak.com -> img.geocaching.com (for
-				// better caching purposes)
+				// Optimize: img.groundspeak.com -> img.geocaching.com (for better caching purposes)
 				imgUrl = CacheImages.optimizeLink("http://" + imgUrl);
 				try {
-					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.'))
-							.toLowerCase() + "    ").substring(0, 4).trim();
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase() + "    ").substring(0, 4).trim();
 					// imgType is now max 4 chars, starting with .
 					if (imgType.startsWith(".png")
 							|| imgType.startsWith(".jpg")
@@ -2881,15 +2839,11 @@
 		// ========
 		Extractor spanBlock, exImgName;
 		try {
-			spanBlock = new Extractor(doc, p.getProp("imgSpanExStart"), 
-					p.getProp("imgSpanExEnd"), 0, true);
+			spanBlock = new Extractor(doc, p.getProp("imgSpanExStart"), p.getProp("imgSpanExEnd"), 0, true);
 			tst = spanBlock.findNext();
-			exImgName = new Extractor(tst, p.getProp("imgNameExStart"), 
-					p.getProp("imgNameExEnd"), 0, true);
-			exImgSrc = new Extractor(tst, p.getProp("imgSrcExStart"), 
-					p.getProp("imgSrcExEnd"), 0, true);
-			exImgComment = new Extractor(tst, p.getProp("imgCommentExStart"), 
-					p.getProp("imgCommentExEnd"), 0, true);
+			exImgName = new Extractor(tst, p.getProp("imgNameExStart"), p.getProp("imgNameExEnd"), 0, true);
+			exImgSrc = new Extractor(tst, p.getProp("imgSrcExStart"), p.getProp("imgSrcExEnd"), 0, true);
+			exImgComment = new Extractor(tst, p.getProp("imgCommentExStart"), p.getProp("imgCommentExEnd"), 0, true);
 		} catch (Exception ex) {
 			return;
 		}
@@ -2908,16 +2862,12 @@
 						// Check whether image was already spidered for this
 						// cache
 						idxUrl = spideredUrls.find(imgUrl);
-						imgName = chD.getParent().getWayPoint() + "_"
-								+ Convert.toString(imgCounter);
+						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 						imageInfo = null;
 						if (idxUrl < 0) { // New image
-							fileName = chD.getParent().getWayPoint()
-									.toLowerCase()
-									+ "_" + Convert.toString(spiderCounter);
+							fileName = chD.getParent().getWayPoint().toLowerCase() + "_" + Convert.toString(spiderCounter);
 							if (lastImages != null) {
-								imageInfo = lastImages.needsSpidering(imgUrl,
-										fileName + imgType);
+								imageInfo = lastImages.needsSpidering(imgUrl, fileName + imgType);
 							}
 							if (imageInfo == null) {
 								imageInfo = new ImageInfo();
@@ -2957,12 +2907,10 @@
 		while (!exFinal.endOfSearch()) {
 			imgUrl = exFinal.findNext();
 			if (imgUrl.length() > 0) {
-				// Optimize: img.groundspeak.com -> img.geocaching.com (for
-				// better caching purposes)
+				// Optimize: img.groundspeak.com -> img.geocaching.com (for better caching purposes)
 				imgUrl = CacheImages.optimizeLink("http://" + imgUrl);
 				try {
-					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.'))
-							.toLowerCase() + "    ").substring(0, 4).trim();
+					imgType = (imgUrl.substring(imgUrl.lastIndexOf('.')).toLowerCase() + "    ").substring(0, 4).trim();
 					// imgType is now max 4 chars, starting with . Delete
 					// characters in URL after the image extension
 					imgUrl = imgUrl.substring(0, imgUrl.lastIndexOf('.')
@@ -2971,8 +2919,7 @@
 							|| imgType.startsWith(".bmp")
 							|| imgType.startsWith(".png")
 							|| imgType.startsWith(".gif")) {
-						// Check whether image was already spidered for this
-						// cache
+						// Check whether image was already spidered for this cache
 						idxUrl = spideredUrls.find(imgUrl);
 						if (idxUrl < 0) { // New image
 							imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
@@ -3201,104 +3148,6 @@
 		chD.getParent().setAttribsAsBits(chD.attributes.getAttribsAsBits());
 	}
 
-	public static String fetchText(String address, boolean withResponseHeaders) {
-		ByteArray daten = fetch(address);
-		if (daten == null) return "";
-		try {
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			CharArray c_data;
-			c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			if (withResponseHeaders)
-				return getResponseHeaders(conn) + c_data.toString();
-			else
-				return c_data.toString();
-		} catch (IOException e) {
-			pref.log("IOException in fetch", e);
-			return null;
-		}
-	}
-
-	/**
-	 * Performs an initial fetch to a given address. 
-	 */
-	private static ByteArray fetch(String address) {
-		try {
-			if (pref.myproxy.length() > 0 && pref.proxyActive) {
-				pref.log("[fetch]:Using proxy: " + pref.myproxy + " / " + pref.myproxyport);
-			}
-			if (conn == null) { conn = new HttpConnection(address); }
-			else { conn.setUrl(address); }
-			conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-			if (cookieSession.length() > 0) {conn.setRequestorProperty("Cookie", "ASP.NET_SessionId=" + cookieSession + "; userid=" + cookieID);};
-			conn.setRequestorProperty("Connection", "close");
-			conn.documentIsEncoded = true;
-			conn.connect();
-			if (conn.isOpen()) {
-				pref.log("[fetch]:Connect ok! " + address);
-				ByteArray daten = conn.readData();
-				conn.disconnect();
-				return daten;
-			}
-			pref.log("[fetch]:Connect not opened! " + address, null);
-			return null;
-		} catch (IOException ioex) {
-			pref.log("IOException in fetch", ioex);
-			return null;
-		}
-	}
-
-	/**
-	 * After a fetch to gc.com the next fetches have to use the post method.
-	 * This method does exactly that. Actually this method is generic in the
-	 * sense that it can be used to post to a URL using http post.
-	 */
-	private static String fetch_post(String address, String postData, boolean withResponseHeaders) {
-		try {
-			HttpConnection conn = new HttpConnection(address);
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			conn.documentIsEncoded = true;
-			conn.setRequestorProperty("User-Agent","Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-			conn.setPostData(codec.encodeText(postData.toCharArray(), 0, postData.length(), true, null));
-			conn.setRequestorProperty("Content-Type", "application/x-www-form-urlencoded");
-			if (cookieSession.length() > 0) { conn.setRequestorProperty("Cookie", "ASP.NET_SessionId=" + cookieSession + "; userid=" + cookieID);};
-			conn.setRequestorProperty("Connection", "close");
-			Socket sock = conn.connect();
-			pref.log("[fetch_post]:Connect ok! " + address);
-			// ByteArray daten = conn.readData(sock);
-			CharArray c_data = conn.readText(sock, codec);
-			pref.log("[fetch_post]:Read data ok " + address);
-			// CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			sock.close();
-			if (withResponseHeaders)
-				return getResponseHeaders(conn) + c_data.toString();
-			else
-				return c_data.toString();
-		} catch (Exception e) {
-			pref.log("[fetch_post] Ignored Exception", e, true);
-		}
-		return "";
-	}
-
-	private static String getResponseHeaders(HttpConnection conn) {
-		PropertyList pl = conn.documentProperties;
-		if (pl != null) {
-			StringBuffer sb = new StringBuffer(1000);
-			boolean gotany = false;
-
-			for (int i = 0; i < pl.size(); i++) {
-				Property currProp = (Property) pl.get(i);
-				if (currProp.value != null) {
-					sb.append(currProp.name).append(": ")
-							.append(currProp.value).append("\r\n");
-					gotany = true;
-				}
-			}
-			if (gotany)
-				return sb.toString() + "\r\n";
-		}
-		return "";
-	}
-
 	final static String hex = ewe.util.TextEncoder.hex;
 
 	public String encodeUTF8URL(byte[] what) {
@@ -3333,7 +3182,7 @@
 		String bugList;
 		try {
 			// infB.setInfo(oldInfoBox+"\nGetting bug: "+bug);
-			bugList = fetchText(p.getProp("getBugByName") + STRreplace.replace(SafeXML.clean(name), " ", "+"), false);
+			bugList = UrlFetcher.fetch(p.getProp("getBugByName") + STRreplace.replace(SafeXML.clean(name), " ", "+"));
 			pref.log("[getBugId] Fetched bugId: " + name);
 		} catch (Exception ex) {
 			pref.log("[getBugId] Could not fetch bug list" + name, ex);
@@ -3379,9 +3228,9 @@
 		try {
 			// infB.setInfo(oldInfoBox+"\nGetting bug: "+bug);
 			if (guid.length() > 10)
-				bugDetails = fetchText(p.getProp("getBugByGuid") + guid, false);
+				bugDetails = UrlFetcher.fetch(p.getProp("getBugByGuid") + guid);
 			else
-				bugDetails = fetchText(p.getProp("getBugById") + guid, false);
+				bugDetails = UrlFetcher.fetch(p.getProp("getBugById") + guid);
 			pref.log("[getBugMissionByGuid] Fetched TB detailsById: " + guid);
 		} catch (Exception ex) {
 			pref.log("[getBugMissionByGuid] Could not fetch TB details " + guid, ex);
@@ -3415,7 +3264,7 @@
 	public String getBugMissionByTrackNr(String trackNr) {
 		String bugDetails;
 		try {
-			bugDetails = fetchText(p.getProp("getBugByTrackNr") + trackNr, false);
+			bugDetails = UrlFetcher.fetch(p.getProp("getBugByTrackNr") + trackNr);
 			pref.log("[getBugMissionByTrackNr] Fetched bug detailsByTrackNr: " + trackNr);
 		} catch (Exception ex) {
 			pref.log("[getBugMissionByTrackNr] getBugByTrackNr " + trackNr, ex);
@@ -3451,7 +3300,7 @@
 		String bugDetails;
 		String trackNr = TB.getTrackingNo();
 		try {
-			bugDetails = fetchText(p.getProp("getBugByTrackNr") + trackNr, false);
+			bugDetails = UrlFetcher.fetch(p.getProp("getBugByTrackNr") + trackNr);
 			pref.log("[getBugMissionAndNameByTrackNr] Fetched TB getBugByTrackNr: " + trackNr);
 		} catch (Exception ex) {
 			pref.log("[getBugMissionAndNameByTrackNr] Could not fetch bug details: " + trackNr, ex);



From araber95 at mail.berlios.de  Fri Mar  4 11:16:31 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri,  4 Mar 2011 11:16:31 PM +0100
Subject: [Cachewolf-svn] r2944 - trunk/src/CacheWolf/imp
Message-ID: <20110304221632.0991F481285@sheep.berlios.de>

Author: araber95
Date: 2011-03-04 23:16:31 +0100 (Fri, 04 Mar 2011)
New Revision: 2944

Modified:
   trunk/src/CacheWolf/imp/OCGPXfetch.java
Log:
just to compile a new one

Modified: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-04 21:17:51 UTC (rev 2943)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-04 22:16:31 UTC (rev 2944)
@@ -65,6 +65,7 @@
 	}
 	
 	private static boolean login() {
+		// just to compile a new one
 		boolean loggedIn = false;
 		String page;
 		try {



From araber95 at mail.berlios.de  Sat Mar  5 10:31:15 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat,  5 Mar 2011 10:31:15 AM +0100
Subject: [Cachewolf-svn] r2945 - trunk/src/CacheWolf/imp
Message-ID: <20110305093115.BB15E48124F@sheep.berlios.de>

Author: araber95
Date: 2011-03-05 10:31:15 +0100 (Sat, 05 Mar 2011)
New Revision: 2945

Modified:
   trunk/src/CacheWolf/imp/OCGPXfetch.java
Log:
now j1.3 compliant

Modified: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-04 22:16:31 UTC (rev 2944)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-05 09:31:15 UTC (rev 2945)
@@ -16,8 +16,8 @@
 	
 	public static void doIt() {
 		String hostname = pref.lastOCSite;
-		Boolean oldDownloadAllOC=pref.downloadAllOC;
-		Boolean onlyListedAtOC = false;
+		boolean oldDownloadAllOC=pref.downloadAllOC;
+		boolean onlyListedAtOC = false;
 		OCXMLImporterScreen importOpt = new OCXMLImporterScreen(
 				MyLocale.getMsg(130,"Download from opencaching"),
 				OCXMLImporterScreen.IMAGES|



From araber95 at mail.berlios.de  Sat Mar  5 12:36:51 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat,  5 Mar 2011 12:36:51 PM +0100
Subject: [Cachewolf-svn] r2946 - in trunk/src/CacheWolf: . imp navi
Message-ID: <20110305113651.B3A514812CC@sheep.berlios.de>

Author: araber95
Date: 2011-03-05 12:36:51 +0100 (Sat, 05 Mar 2011)
New Revision: 2946

Modified:
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/imp/GCVoteImporter.java
   trunk/src/CacheWolf/imp/OCGPXfetch.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
finished replacing with UrlFetcher

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-03-05 09:31:15 UTC (rev 2945)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-03-05 11:36:51 UTC (rev 2946)
@@ -45,6 +45,7 @@
 	static PropertyList permanentRequestorProperties = null;
 	static String postData=null;
 	static String urltmp=null;
+	static boolean forceRedirect=false;
 	
 	public static PropertyList getDocumentProperties() {
 		if (conn != null) 
@@ -53,6 +54,7 @@
 	}
 	public static String getRealUrl() { return urltmp; };
 	public static void setMaxRedirections(int value) { maxRedirections=value; };
+	public static void setForceRedirect() { forceRedirect=true; };
 	public static void setRequestorProperties(PropertyList value) { requestorProperties=value; };
 	public static void setRequestorProperty(String name, String property) {
 		if (requestorProperties == null) requestorProperties = new PropertyList();
@@ -135,7 +137,7 @@
 				}
 				urltmp = STRreplace.replace(urltmp, eweUrl.getHost() + "/\\.\\./", eweUrl.getHost() + "/");
 			}
-		} while (urltmp != null && i <= maxRedirections ); 
+		} while (((urltmp != null) || (urltmp == null) && forceRedirect) && i <= maxRedirections ); 
 		if (i > maxRedirections) throw new IOException("too many http redirections while trying to fetch: "+url + " only "+maxRedirections+" are allowed");
 		hndl[0] = conn.readInData();
 		ByteArray daten;
@@ -147,6 +149,7 @@
 		maxRedirections = 5;
 		requestorProperties = null;
 		postData=null;
+		forceRedirect=false;
 		daten = (ByteArray)hndl[0].returnValue; // ByteArray daten = conn.readData(sock);
 		return daten;
 	}

Modified: trunk/src/CacheWolf/imp/GCVoteImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-05 09:31:15 UTC (rev 2945)
+++ trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-05 11:36:51 UTC (rev 2946)
@@ -105,9 +105,6 @@
 
 			try {
 				pref.log("[GCVote]:Requesting ratings");
-
-				// request web page http://gcvote.de/getVotes.php
-				// UrlFetcher.setRequestorProperty("User-Agent", "Mozilla/5.0 (compatible; Cachewolf; GCVoteImporter)");
 				GCVResults = UrlFetcher.fetch(GCVURL);
 				if (GCVResults.equals("")) {
 					(new MessageBox(MyLocale.getMsg(0,"Error"), MyLocale.getMsg(0,"Error loading GCVote page.%0aPlease check your internet connection."), FormBase.OKB)).execute();

Modified: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-05 09:31:15 UTC (rev 2945)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-05 11:36:51 UTC (rev 2946)
@@ -53,11 +53,9 @@
 			File ftmp = new FileBugfix(tmpFile);
 			if (ftmp.exists() && ftmp.length()>0) {
 				GPXImporter gpx = new GPXImporter(pref, prof, tmpFile);
-				int withPics = GPXImporter.DOIT_NOSPOILER;
-				if (pref.downloadPics) {
-					withPics=GPXImporter.DOIT_WITHSPOILER;
-				}			
-				gpx.doIt(withPics);
+				if (pref.downloadPics) 
+					gpx.doIt(GPXImporter.DOIT_WITHSPOILER);				
+				else gpx.doIt(GPXImporter.DOIT_NOSPOILER);
 			}
 			ftmp.delete();
 		} catch (IOException e) {

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-05 09:31:15 UTC (rev 2945)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-05 11:36:51 UTC (rev 2946)
@@ -2958,40 +2958,9 @@
 	 * @param target
 	 *            The bytes of the image
 	 */
-	private void spiderImage(String imgUrl, String target) {
-		// TODO implement a fetch(URL, filename) in HttpConnection and use that one
-		HttpConnection connImg;
-		Socket sockImg;
-		// InputStream is;
-		FileOutputStream fos;
-		// int bytes_read;
-		// byte[] buffer = new byte[9000];
-		ByteArray daten;
-		String datei = "";
-		datei = profile.dataDir + target;
-		connImg = new HttpConnection(imgUrl);
-		if (imgUrl.indexOf('%') >= 0)
-			connImg.documentIsEncoded = true;
-		connImg.setRequestorProperty("Connection", "close");
-		// connImg.setRequestorProperty("User-Agent","Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.12) Gecko/20080201 Firefox/2.0.0.12");
-		// connImg.setRequestorProperty("Accept","text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5");
+	private void spiderImage(String address, String fn) {
 		try {
-			pref.log("[spiderImage] Trying to fetch image from: " + imgUrl);
-			String redirect = null;
-			do {
-				sockImg = connImg.connect();
-				redirect = connImg.getRedirectTo();
-				if (redirect != null) {
-					connImg = connImg.getRedirectedConnection(redirect);
-					pref.log("[spiderImage] Redirect to " + redirect);
-				}
-			} while (redirect != null); 
-			// TODO this can end up in an endless loop if trying to load from a malicous site
-			daten = connImg.readData(sockImg);
-			fos = new FileOutputStream(new File(datei));
-			fos.write(daten.toBytes());
-			fos.close();
-			sockImg.close();
+			UrlFetcher.fetchDataFile(address, profile.dataDir + fn);
 		} catch (UnknownHostException e) {
 			pref.log("[spiderImage] Host not there...", e);
 		} catch (IOException ioex) {

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2011-03-05 09:31:15 UTC (rev 2945)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2011-03-05 11:36:51 UTC (rev 2946)
@@ -32,6 +32,7 @@
 import CacheWolf.InfoBox;
 import CacheWolf.MyLocale;
 import CacheWolf.STRreplace;
+import CacheWolf.UrlFetcher;
 import CacheWolf.utils.FileBugfix;
 import ewe.fx.Point;
 import ewe.io.BufferedWriter;
@@ -479,10 +480,6 @@
 	 * @param datei path and name of file to save to
 	 */
 	public void downloadImage(String url, String datei) throws IOException {
-		HttpConnection connImg; // TODO implement this in UrlFetcher class
-		Socket sockImg;
-		FileOutputStream fos;
-		ByteArray daten;
 		String realurl;
 		boolean forceredirect;
 		if (url.startsWith("R")) {
@@ -492,44 +489,16 @@
 			forceredirect = false;
 			realurl = url;
 		}
-		connImg = new HttpConnection(realurl);
-		connImg.setRequestorProperty("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-		connImg.setRequestorProperty("Connection", "close");
-	//	this prevents gdz1.leipzig.ifag.de (dtk100) from answering and ist not necessary for expedia connImg.setRequestorProperty("Cookie", "jscript=1; path=/;");
-		connImg.documentIsEncoded = true;
-		try{
-			File dateiF = new FileBugfix(datei);
-			if(!dateiF.exists()){
-				int i=0;
-				sockImg = connImg.connect();
-				String quelle = connImg.getRedirectTo();
-				boolean redirrected = false;
-				while (i < 5 && (quelle != null || (forceredirect && !redirrected))) { // this is necessary because expedia sometimes doesn't directly anser with the redirect to the map-image, but give a page in between. Solved the problem by retrying see also: http://www.geoclub.de/viewtopic.php?p=305071#305071
-					if (quelle != null) {
-						redirrected = true;
-						sockImg.close();
-						connImg = connImg.getRedirectedConnection(quelle);
-						sockImg = connImg.connect();
-						quelle = connImg.getRedirectTo();
-					}
-					i++;
-				}
-				if (i > 4) throw new IOException(MyLocale.getMsg(4807, "loadTo: failed to download map: didn't get http-redirect"));
-				String ct = (String)connImg.documentProperties.getValue("content-type", "");
-				if (!ct.substring(0, 5).equalsIgnoreCase("image") )  {
-					String tmp = connImg.readText(sockImg, null).toString(); // TODO if the content is binary will will get an Exception in InfoBox, trying to display the content
-					tmp = tmp.substring(0, (tmp.length() < 1000 ? tmp.length() : 1000));
-					sockImg.close();
-					throw new IOException(MyLocale.getMsg(4808, "downloadImage: content-type:")+" " + ct + MyLocale.getMsg(4809, " is not an image, begin of content:")+" " + tmp);
-				}
-				daten = connImg.readData(sockImg);
-				fos = new FileOutputStream(datei); // note: using the constructor (File) instead of (String) will cause not to use the fake file system
-				fos.write(daten.toBytes());
-				fos.close();
-				sockImg.close();
+		File dateiF = new FileBugfix(datei);
+		if(!dateiF.exists()){
+			if (forceredirect) UrlFetcher.setForceRedirect();
+			UrlFetcher.fetchDataFile(realurl, datei);
+			String ct = (String) UrlFetcher.getDocumentProperties().getValue("content-type","");
+			if (!ct.substring(0, 5).equalsIgnoreCase("image") )  {
+				dateiF = new FileBugfix(datei); //??? muss das nochmal ???
+				dateiF.delete();
+				throw new IOException(MyLocale.getMsg(4808, "downloadImage: content-type:")+" " + ct + MyLocale.getMsg(4809, " is not an image, begin of content:")+" (deleted)");
 			}
-		}catch(IOException e){
-			throw new IOException(MyLocale.getMsg(4810, "Error while downloading or saving map:\n") + e.getMessage());
 		}
 	}
 }



From apreisser at mail.berlios.de  Sat Mar  5 02:35:47 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat,  5 Mar 2011 02:35:47 PM +0100
Subject: [Cachewolf-svn] r2947 - trunk/res_noewe
Message-ID: <20110305133547.EE5924813B8@sheep.berlios.de>

Author: apreisser
Date: 2011-03-05 14:35:47 +0100 (Sat, 05 Mar 2011)
New Revision: 2947

Modified:
   trunk/res_noewe/spider.def
Log:
Repaired RegEx for LatLon. Seems GS has changed the containing <span>-Element.

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-05 11:36:51 UTC (rev 2946)
+++ trunk/res_noewe/spider.def	2011-03-05 13:35:47 UTC (rev 2947)
@@ -108,7 +108,8 @@
 cacheUnavailable   = class="OldWarning"><li>This\ cache\ is\ temporarily\ unavailable
 cacheArchived      = class="OldWarning"><li>This\ cache\ has\ been\ archived
 premiumCachepage   = class="Warning">This\ is\ a\ Premium\ Member\ Only\ Cache
-latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
+#latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
+latLonRex          = tBody_LatLon"><b>((?s).*?)</b></span>
 shortDescRex       = tBody_ShortDescription">((?s).*?)</span>
 longDescRex        = tBody_LongDescription">((?s).*?)<td\ valign="top"\ width="10%">\\s*&nbsp;\\s*</td
 cacheNameRex       = tBody_CacheName">((?s).*?)</span>



From araber95 at mail.berlios.de  Sat Mar  5 03:01:31 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat,  5 Mar 2011 03:01:31 PM +0100
Subject: [Cachewolf-svn] r2948 - trunk/src/CacheWolf/imp
Message-ID: <20110305140131.9205F4813B8@sheep.berlios.de>

Author: araber95
Date: 2011-03-05 15:01:30 +0100 (Sat, 05 Mar 2011)
New Revision: 2948

Modified:
   trunk/src/CacheWolf/imp/OCGPXfetch.java
Log:
OC gpx with login

Modified: trunk/src/CacheWolf/imp/OCGPXfetch.java
===================================================================
--- trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-05 13:35:47 UTC (rev 2947)
+++ trunk/src/CacheWolf/imp/OCGPXfetch.java	2011-03-05 14:01:30 UTC (rev 2948)
@@ -49,6 +49,7 @@
 			address+="&count=max";
 			address+="&finder="+pref.myAlias;
 			String tmpFile=prof.dataDir + "dummy.zip";
+			login();
 			UrlFetcher.fetchDataFile(address, tmpFile);
 			File ftmp = new FileBugfix(tmpFile);
 			if (ftmp.exists() && ftmp.length()>0) {
@@ -63,7 +64,7 @@
 	}
 	
 	private static boolean login() {
-		// just to compile a new one
+		// TODO this is only a preliminary Version of login
 		boolean loggedIn = false;
 		String page;
 		try {



From araber95 at mail.berlios.de  Sun Mar  6 01:12:24 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun,  6 Mar 2011 01:12:24 AM +0100
Subject: [Cachewolf-svn] r2949 - in trunk: res_noewe src/CacheWolf
	src/CacheWolf/imp
Message-ID: <20110306001225.0CBE44813B8@sheep.berlios.de>

Author: araber95
Date: 2011-03-06 01:12:24 +0100 (Sun, 06 Mar 2011)
New Revision: 2949

Modified:
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
gc changed DTS presentation
change to EN language changed

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-05 14:01:30 UTC (rev 2948)
+++ trunk/res_noewe/spider.def	2011-03-06 00:12:24 UTC (rev 2949)
@@ -76,7 +76,7 @@
 distCodeRex        = k=(.*?)"
 distCodeKey        = signalthefrog
 distRex            = (.*?)(?:km|mi|ft)
-DTSRex             = v=(.*?)"\ style=
+DTSRex             = v=(.*?)"
 DTSCodeKey         = hbM9fjmrxy7z42LFD58BkKgPGdHscvCqNnw3ptO6lJ
 waypointRex        = \\(GC(.*?)\\)<br\ />
 TypeRex            = www.geocaching.com/images/wpttypes/sm/(.*?)\\.gif

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-03-05 14:01:30 UTC (rev 2948)
+++ trunk/src/CacheWolf/Preferences.java	2011-03-06 00:12:24 UTC (rev 2949)
@@ -744,7 +744,7 @@
 					" spiderUpdates=\"" + SafeXML.strxmlencode(spiderUpdates) + "\""+
 					" checkLog=\"" + SafeXML.strxmlencode(checkLog) + "\""+
 					" checkTBs=\"" + SafeXML.strxmlencode(checkTBs) + "\""+
-					" checkDTS=\"" + SafeXML.strxmlencode(checkDTS) +"\""+
+					" checkDTS=\"" + SafeXML.strxmlencode(checkDTS) + "\""+
 					" spiderRoute=\"" + SafeXML.strxmlencode(spiderRoute) + "\""+
 					" maxSpiderNumber=\"" + SafeXML.strxmlencode(maxSpiderNumber) + "\""+
 					" downloadPics=\"" + SafeXML.strxmlencode(downloadPics) + "\""+

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-05 14:01:30 UTC (rev 2948)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-06 00:12:24 UTC (rev 2949)
@@ -1326,12 +1326,14 @@
 						UrlFetcher.setPermanentRequestorProperty("Cookie", cookie);
 
 						// **4 change language to EN 
+						// viewstate=old one
 						rexViewstate.search(loginPage);
-						if (!rexViewstate.didMatch()) {
-							pref.log("[login]:check rexViewstate in SpiderGC.java --> not found after login"
-									+ Preferences.NEWLINE + loginPage, null);
+						if (rexViewstate.didMatch()) {
+							viewstate = rexViewstate.stringMatched(1);
+						} else {
+							pref.log("[login]:__VIEWSTATE not found (before Language=EN): can't change language.", null);
+							return ERR_LOGIN;
 						}
-						viewstate = rexViewstate.stringMatched(1);
 						String strEnglishPage = "ctl00$uxLocaleList$uxLocaleList$ctl01$uxLocaleItem";
 						String postStr = "__EVENTTARGET="+ URL.encodeURL(strEnglishPage, false)
 										+ "&__EVENTARGUMENT="
@@ -1340,7 +1342,7 @@
 							UrlFetcher.setpostData(postStr);
 							loginPage = UrlFetcher.fetch(loginPageUrl);
 							// there is no real check if switched
-							pref.log("Switched to English"+loginPage);
+							pref.log("Switched to English");
 						} catch (Exception ex) {
 							pref.log("Error switching to English: check/n" + loginPageUrl + "/n" + postStr, ex);
 						}
@@ -1741,6 +1743,7 @@
 			int keylength=13; // wenn nicht 13 dann newkey auf wiederholung pr?fen
 			DistanceCodeKey=newkey.substring(0, keylength);
 			ret = decodeXor( stmp, DistanceCodeKey).replace('|', ' ');
+			pref.log("Automatic key: " + DistanceCodeKey + " result: " + ret + Preferences.NEWLINE);
 			RexPropDistance.search(ret); // km oder mi
 		}
 



From araber95 at mail.berlios.de  Sun Mar  6 02:13:38 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun,  6 Mar 2011 02:13:38 PM +0100
Subject: [Cachewolf-svn] r2950 - in trunk: res_noewe src/CacheWolf
	src/CacheWolf/imp
Message-ID: <20110306131338.60CF64813CE@sheep.berlios.de>

Author: araber95
Date: 2011-03-06 14:13:38 +0100 (Sun, 06 Mar 2011)
New Revision: 2950

Modified:
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
1. recogntion of PM
2. quick import works again

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-06 00:12:24 UTC (rev 2949)
+++ trunk/res_noewe/spider.def	2011-03-06 13:13:38 UTC (rev 2950)
@@ -107,7 +107,7 @@
 fetchAllLogs       = &log=y
 cacheUnavailable   = class="OldWarning"><li>This\ cache\ is\ temporarily\ unavailable
 cacheArchived      = class="OldWarning"><li>This\ cache\ has\ been\ archived
-premiumCachepage   = class="Warning">This\ is\ a\ Premium\ Member\ Only\ Cache
+premiumCachepage   = class="Warning">listing\ visible\ to\ Premium
 #latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
 latLonRex          = tBody_LatLon"><b>((?s).*?)</b></span>
 shortDescRex       = tBody_ShortDescription">((?s).*?)</span>

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-03-06 00:12:24 UTC (rev 2949)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-03-06 13:13:38 UTC (rev 2950)
@@ -62,8 +62,8 @@
 	}
 	private static void initPermanentRequestorProperty() {
 		permanentRequestorProperties = new PropertyList();
-		permanentRequestorProperties.add("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-		// permanentRequestorProperties.add("Connection", "close");		
+		permanentRequestorProperties.add("User_Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
+		permanentRequestorProperties.add("Connection", "keep-alive");		
 	}
 	public static void setPermanentRequestorProperty(String name, String property) {
 		if (permanentRequestorProperties == null) initPermanentRequestorProperty();
@@ -121,7 +121,7 @@
 			if (permanentRequestorProperties == null) initPermanentRequestorProperty();
 			if (postData != null) {
 				conn.setPostData(postData);
-				setRequestorProperty("Content-Type","application/x-www-form-urlencoded");
+				conn.setRequestorProperty("Content-Type","application/x-www-form-urlencoded");
 			}
 			conn.setRequestorProperty(permanentRequestorProperties);
 			if (requestorProperties != null) conn.setRequestorProperty(requestorProperties);

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-06 00:12:24 UTC (rev 2949)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-06 13:13:38 UTC (rev 2950)
@@ -68,6 +68,7 @@
 import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.InputStreamReader;
+import ewe.io.JavaUtf8Codec;
 import ewe.net.Socket;
 import ewe.net.URL;
 import ewe.net.UnknownHostException;
@@ -77,6 +78,7 @@
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
 import ewe.util.ByteArray;
+import ewe.util.CharArray;
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.Properties;
@@ -220,17 +222,18 @@
 			infB = new InfoBox("Status", MyLocale.getMsg(5502, "Fetching first page..."));
 			infB.exec();
 
-			pref.log("ListPages Properties : " + Preferences.NEWLINE
-					+ "minDistance: " + minDistance + Preferences.NEWLINE
-					+ "maxDistance: " + maxDistance + Preferences.NEWLINE
-					+ "directions: " + direction + Preferences.NEWLINE
-					+ "maxNew: " + pref.maxSpiderNumber + Preferences.NEWLINE
-					+ "maxUpdate: " + maxUpdate + Preferences.NEWLINE
-					+ "with Founds       : " + (doNotgetFound ? "no" : "yes")
-					+ Preferences.NEWLINE + "alias is premium m: "
-					+ (!pref.isPremium ? "no" : "yes") + Preferences.NEWLINE
-					+ "Update if new Logs: " + (!pref.checkLog ? "no" : "yes")
-					+ Preferences.NEWLINE, null);
+			pref.log( "ListPages Properties : " + Preferences.NEWLINE
+					+ "minDistance          : " + minDistance + Preferences.NEWLINE
+					+ "maxDistance          : " + maxDistance + Preferences.NEWLINE
+					+ "directions           : " + direction + Preferences.NEWLINE
+					+ "maxNew               : " + pref.maxSpiderNumber + Preferences.NEWLINE
+					+ "maxUpdate            : " + maxUpdate + Preferences.NEWLINE
+					+ "with Founds          : " + (doNotgetFound ? "no" : "yes") + Preferences.NEWLINE 
+					+ "alias is premium memb: "	+ (!pref.isPremium ? "no" : "yes") + Preferences.NEWLINE
+					+ "Update if new Log    : " + (pref.checkLog ? "yes" : "no") + Preferences.NEWLINE
+					+ "Update if TB changed : " + (pref.checkTBs ? "yes" : "no") + Preferences.NEWLINE
+					+ "Update if DTS changed: " + (pref.checkDTS ? "yes" : "no") + Preferences.NEWLINE
+					, null);
 
 			Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
 
@@ -602,6 +605,10 @@
 		page_number++;
 		String listPage = getMapListPage(middle, north, west, south, east);
 		int i = listPage.indexOf("\"count\\\":"); // \"count\":
+		if (i==-1) {
+			pref.log("[getCaches:getMapListPage]got nothing!"+listPage,null);
+			return;
+		}
 		pref.log("" + north + " " + west + " " + south + " " + east + " " + listPage.substring(i) + "\n len=" + len);
 		if ((listPage.indexOf("\"count\\\":501") > -1)
 		||  (listPage.indexOf("\"count\\\":0") > -1 && len > 30)) {
@@ -1021,7 +1028,7 @@
 				"Found " + numAvailableUpdates + " caches with changed available status."+Preferences.NEWLINE+
 				"Found " + numLogUpdates + " caches with new found in log."+Preferences.NEWLINE+
 				"Found " + (cExpectedForUpdate.size()-numAvailableUpdates-numLogUpdates) + " caches possibly archived."+Preferences.NEWLINE+
-				"Found " + cFoundForUpdate.size() + "?=" + (numFoundUpdates+numArchivedUpdates+numAvailableUpdates+numArchivedUpdates) + " caches to update."+Preferences.NEWLINE+
+				"Found " + cFoundForUpdate.size() + " ?= " + (numFoundUpdates+numArchivedUpdates+numAvailableUpdates+numArchivedUpdates) + " caches to update."+Preferences.NEWLINE+
 				"Found " + numPrivate + " Premium Caches (for non Premium Member.)",null);
 		if(spiderAllFinds){
 			pref.log("Found " + numFoundUpdates + " caches with no found in profile."+Preferences.NEWLINE+
@@ -1228,8 +1235,7 @@
 		localInfB = new InfoBox(MyLocale.getMsg(5507, "Status"), MyLocale.getMsg(5508, "Logging in..."));
 		localInfB.exec();
 		try {
-			// "http://www.geocaching.com/login/default.aspx?RESETCOMPLETE=Y" | loginPageUrl
-			loginPage = UrlFetcher.fetch(loginPageUrl); // http://www.geocaching.com/login/Default.aspx
+			loginPage = UrlFetcher.fetch(loginPageUrl); // http://www.geocaching.com/login/default.aspx
 			if (loginPage.equals("")) {
 				localInfB.close(0);
 				(new MessageBox(MyLocale.getMsg(5500, "Error"),
@@ -1279,6 +1285,7 @@
 					if (rexViewstate.didMatch()) {
 						viewstate = rexViewstate.stringMatched(1);
 					} else {
+						localInfB.close(0);
 						pref.log("[login]:__VIEWSTATE not found (before login): no login possible.", null);
 						// we need the __VIEWSTATE for sending loginData, so we should abort here
 						return ERR_LOGIN;
@@ -1299,38 +1306,42 @@
 						pref.log("Login successful: " + pref.myAlias);
 						// **3 now we are logged in and get the Cookie (there are two)
 						PropertyList pl = UrlFetcher.getDocumentProperties();
-						cookie = "";
+						String docprops = "";
 						for (int i = 0; i < pl.size(); i++) {
 							Property p = (Property) pl.get(i);
 							if (p.name.equalsIgnoreCase("Set-Cookie")) {
-								cookie+=p.value;
+								docprops+=p.value;
 							}
 						}
-						/* */
-						String cookieID="";
-						Regex rexCookieID = new Regex("(?i)userid=(.*?);.*");
-						rexCookieID.search(cookie);
-						if (!rexCookieID.didMatch()) {
-							pref.log("[login]:check rexCookieID in SpiderGC.java --> CookieID not found. Using old one.");
-						} else
-							cookieID = rexCookieID.stringMatched(1);
-						String cookieSession="";
 						Regex rexCookieSession = new Regex("(?i)ASP.NET_SessionId=(.*?);.*");
-						rexCookieSession.search(cookie);
-						if (!rexCookieSession.didMatch()) {
-							pref.log("[login]:check rexCookieSession in SpiderGC.java --> CookieSession not found. Using old one.");
-						} else
-							cookieSession = rexCookieSession.stringMatched(1);
-						cookie="ASP.NET_SessionId=" + cookieSession + "; userid=" + cookieID;
-						/* */
+						rexCookieSession.search(docprops);
+						if (rexCookieSession.didMatch()) {
+							cookie = "ASP.NET_SessionId=" + rexCookieSession.stringMatched(1);
+						} 
+						else {
+							localInfB.close(0);
+							pref.log("[login]:SessionID not found.", null);
+							return ERR_LOGIN;
+						}
+						Regex rexCookieID = new Regex("(?i)userid=(.*?);.*");
+						rexCookieID.search(docprops);
+						if (rexCookieID.didMatch()) {
+							cookie += "; userid=" + rexCookieID.stringMatched(1);
+						} 
+						else {
+							localInfB.close(0);
+							pref.log("[login]:userID not found.", null);
+							return ERR_LOGIN;
+						}
 						UrlFetcher.setPermanentRequestorProperty("Cookie", cookie);
 
 						// **4 change language to EN 
-						// viewstate=old one
 						rexViewstate.search(loginPage);
 						if (rexViewstate.didMatch()) {
 							viewstate = rexViewstate.stringMatched(1);
-						} else {
+						} 
+						else {
+							localInfB.close(0);
 							pref.log("[login]:__VIEWSTATE not found (before Language=EN): can't change language.", null);
 							return ERR_LOGIN;
 						}
@@ -1349,7 +1360,8 @@
 					}
 					else {
 						pref.log("Login failed. Wrong Account or Password? " + pref.myAlias, null);
-						pref.log("[login.LoginUrl]:" + sb.toString(), null);
+						pref.log("[login.url]:" + loginPageUrl, null);
+						pref.log("[login.postData]:" + sb.toString(), null);
 						pref.log("[login.Answer]:" + loginPage, null);
 						localInfB.close(0);
 						(new MessageBox(MyLocale.getMsg(5500, "Error"),
@@ -1490,23 +1502,15 @@
 			pref.log("[getAListPage] check rexViewstate1 in SpiderGC.java" + Preferences.NEWLINE + htmlListPage);
 		}
 
-		/*
-		 * rexEventvalidation.search(htmlPage);
-		 * if(rexEventvalidation.didMatch()){ 
-		 * eventvalidation = rexEventvalidation.stringMatched(1); } 
-		 * else { eventvalidation = ""; }
-		 */
-
 		String postData = "__EVENTTARGET=" + URL.encodeURL(whatPage, false) + "&" +
 						  "__EVENTARGUMENT=" + "&" +
 						  "__VIEWSTATEFIELDCOUNT=2" + "&" +
 						  "__VIEWSTATE=" + URL.encodeURL(viewstate, false) + "&" +
-						  "__VIEWSTATE1=" + URL.encodeURL(viewstate1, false); // + "&" +
-						  //"__EVENTVALIDATION=" + URL.encodeURL(eventvalidation,false);
+						  "__VIEWSTATE1=" + URL.encodeURL(viewstate1, false);
 		try {
 			UrlFetcher.setpostData(postData);
 			htmlListPage = UrlFetcher.fetch(url);
-			pref.log("[getAListPage] Got list page: " + URL.encodeURL(whatPage, false));
+			pref.log("[getAListPage] Got list page: " + url);
 		} catch (Exception ex) {
 			pref.log("[getAListPage] Error getting a list page" + url, ex);
 		}
@@ -1546,18 +1550,9 @@
 
 		try {
 			UrlFetcher.setpostData(postData);
-			// UrlFetcher.setRequestorProperty("Accept","application/json, text/javascript, */*; q=0.01");
-			// UrlFetcher.setRequestorProperty("Accept-Language","de-de,de;q=0.8,en-us;q=0.5,en;q=0.3");
-			// UrlFetcher.setRequestorProperty("Accept-Encoding","gzip,deflate");
-			// UrlFetcher.setRequestorProperty("Accept-Charset","ISO-8859-1,utf-8;q=0.7,*;q=0.7");
-			// UrlFetcher.setRequestorProperty("Keep-Alive","115");
-			// UrlFetcher.setRequestorProperty("Proxy-Connection","keep-alive");
 			UrlFetcher.setRequestorProperty("Content-Type", "application/json; charset=UTF-8");
-			// UrlFetcher.setRequestorProperty("X-Requested-With","XMLHttpRequest");
-			// UrlFetcher.setRequestorProperty("Referer",referer);
-			// UrlFetcher.setRequestorProperty("Pragma","no-cache");
-			// UrlFetcher.setRequestorProperty("Cache-Control","no-cache");
-			ret=UrlFetcher.fetch(url);
+			ret=UrlFetcher.fetch(url);			
+
 		} catch (Exception ex) {
 			ret = "";
 			pref.log("[SpiderGC:getMapListPage] Error getting map Cachepage" + url + postData, ex);
@@ -2206,8 +2201,7 @@
 						// deleting existing coordinates
 						String latLon = getLatLon(completeWebPage);
 						if (latLon.equals("???")) {
-							if (completeWebPage.indexOf(p
-									.getProp("premiumCachepage")) > 0) {
+							if (completeWebPage.indexOf(p.getProp("premiumCachepage")) > 0) {
 								// Premium cache spidered by non premium member
 								pref.log("Ignoring premium member cache: " + ch.getWayPoint());
 								spiderTrys = MAX_SPIDER_TRYS;



From araber95 at mail.berlios.de  Tue Mar  8 09:57:34 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue,  8 Mar 2011 09:57:34 PM +0100
Subject: [Cachewolf-svn] r2951 - in trunk: res_noewe res_noewe/languages
	src/CacheWolf/exp src/CacheWolf/imp src/CacheWolf/navi
Message-ID: <20110308205734.95AE2481120@sheep.berlios.de>

Author: araber95
Date: 2011-03-08 21:57:34 +0100 (Tue, 08 Mar 2011)
New Revision: 2951

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/languages/SV.cfg
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/exp/LocExporter.java
   trunk/src/CacheWolf/exp/OziExporter.java
   trunk/src/CacheWolf/imp/GCVoteImporter.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/navi/Area.java
   trunk/src/CacheWolf/navi/MapLoader.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
1. choice : download maptile only if there is a cache
2. spider.def: update 1 (size) after gc update of today

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/res_noewe/languages/DE.cfg	2011-03-08 20:57:34 UTC (rev 2951)
@@ -94,6 +94,7 @@
 162=Kalibrierte herunterladen
 163=von OC Funde
 164=nur bei OC gelistet
+165=Lade nur, wenn mit Cache
 170=Datenverzeichnis w?hlen
 171=Profil existiert nicht:+
 172=Kann das Kartenverzeichnis nicht erstellen:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/res_noewe/languages/EN.cfg	2011-03-08 20:57:34 UTC (rev 2951)
@@ -94,6 +94,7 @@
 162=Download calibrated
 163 = OC finds
 164 = only available at OC
+165 = load only, if with cache
 170=Select data directory
 171=Profile does not exist:+
 172=Error: cannot create maps directory:

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/res_noewe/languages/FR.cfg	2011-03-08 20:57:34 UTC (rev 2951)
@@ -94,6 +94,7 @@
 162=T?l?charger calibr?e
 163 = OC trouve
 164 = uniquement disponible chez OC
+165 = seulement, si avec une cache
 170=Choisir dossier de base pour les profiles
 171=Profile n'existe pas:+
 172=Ne peut pas cr?er dossier pour des cartes:

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/res_noewe/languages/NL.cfg	2011-03-08 20:57:34 UTC (rev 2951)
@@ -94,6 +94,7 @@
 162=Gekalibreerde kaarten downloaden.
 163 = OC vindt
 164 = alleen verkrijgbaar bij OC
+165 = alleen downloaden, als met cache
 170=Selecteer basis map voor cache data.
 171=Profiel bestaat niet:+
 172=Fout: kan kaarten map niet maken:\n.

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/res_noewe/languages/PL.cfg	2011-03-08 20:57:34 UTC (rev 2951)
@@ -94,6 +94,7 @@
 162=Sciagnij skalibrowane
 163 = OC stwierdzi
 164 = dost?pne tylko w OC
+165 = tylko w?wczas, gdy z pami?ci podr?cznej
 170=Wybierz folder z danymi
 171=Profil nie istnieje:+
 172=Blad: nie mozna utworzyc katalogu map:

Modified: trunk/res_noewe/languages/SV.cfg
===================================================================
--- trunk/res_noewe/languages/SV.cfg	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/res_noewe/languages/SV.cfg	2011-03-08 20:57:34 UTC (rev 2951)
@@ -94,6 +94,7 @@
 162=Ladda kalibrerad
 163 = OC finner
 164 = endast tillg?nglig p? OC
+165 = endast h?mta om med cache
 170=V?lj databas
 171=profil finns inte:+
 172=Fel: kan inte skapa kartor katalog:

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/res_noewe/spider.def	2011-03-08 20:57:34 UTC (rev 2951)
@@ -116,7 +116,7 @@
 cacheOwnerRex      = &wid(?:(?s).*?)>((?s).*?)<
 dateHiddenRex      = (?:Hidden|Event\ Date)\\s*:\\s*((?s).*?)<
 hintsRex           = <div id="div_hint" class="HalfLeft">\\s*((?s).*?)\\s*</div>
-sizeRex            = alt="Size:\ ((?s).*?)"\ />&nbsp<small>
+sizeRex            = alt="Size:\ ((?s).*?)"
 difficultyRex      = difficulty\ of\ (.*?),
 terrainRex         = terrain\ of\ (.*?)\\.\\ 
 cacheTypeRex       = /images/WptTypes/(.*?)\\.gif"\ alt="

Modified: trunk/src/CacheWolf/exp/LocExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/LocExporter.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/exp/LocExporter.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -29,8 +29,6 @@
 import CacheWolf.CacheHolderDetail;
 import CacheWolf.Common;
 import CacheWolf.Global;
-import ewe.io.File;
-import ewe.io.FileBase;
 
 
 /**

Modified: trunk/src/CacheWolf/exp/OziExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/OziExporter.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/exp/OziExporter.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -29,9 +29,8 @@
 import CacheWolf.CacheType;
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
-import ewe.io.File;
-import ewe.io.FileBase;
 
+
 /**
 *	Class to export the cache database (index) to an OziExplorer File
 */

Modified: trunk/src/CacheWolf/imp/GCVoteImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/imp/GCVoteImporter.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -28,22 +28,16 @@
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
 import CacheWolf.Common;
-import CacheWolf.HttpConnection;
 import CacheWolf.MyLocale;
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
 import CacheWolf.UrlFetcher;
-import CacheWolf.imp.SpiderGC.SpiderProperties;
-import ewe.io.IOException;
-import ewe.io.JavaUtf8Codec;
 import ewe.io.Reader;
 import ewe.io.StringReader;
-import ewe.net.Socket;
 import ewe.sys.Handle;
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
 import ewe.ui.ProgressBarForm;
-import ewe.util.CharArray;
 import ewesoft.xml.MinML;
 import ewesoft.xml.sax.AttributeList;
 

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -30,7 +30,6 @@
 import CacheWolf.Attribute;
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
-import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
@@ -55,11 +54,9 @@
 import ewe.io.IOException;
 import ewe.net.MalformedURLException;
 import ewe.net.URL;
-import ewe.sys.Convert;
 import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.FormBase;
-import ewe.ui.MessageBox;
 import ewe.util.Enumeration;
 import ewe.util.Vector;
 import ewe.util.zip.ZipEntry;

Modified: trunk/src/CacheWolf/navi/Area.java
===================================================================
--- trunk/src/CacheWolf/navi/Area.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/navi/Area.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -47,6 +47,11 @@
 		 topleft = new CWPoint(tl);
 		 buttomright = new CWPoint(br);
 	 }
+	 
+	 public Area(CWPoint tl, CWPoint br) {
+		 topleft = tl;
+		 buttomright = br;
+	 }
 
 	 public final boolean isInBound(TrackPoint p) {
 		 if (topleft.latDec >= p.latDec && topleft.lonDec <= p.lonDec 

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -26,9 +26,10 @@
 package CacheWolf.navi;
 
 import CacheWolf.CWPoint;
+import CacheWolf.CacheDB;
+import CacheWolf.CacheHolder;
 import CacheWolf.Common;
 import CacheWolf.Global;
-import CacheWolf.HttpConnection;
 import CacheWolf.InfoBox;
 import CacheWolf.MyLocale;
 import CacheWolf.STRreplace;
@@ -39,19 +40,16 @@
 import ewe.io.File;
 import ewe.io.FileBase;
 import ewe.io.FileInputStream;
-import ewe.io.FileOutputStream;
 import ewe.io.FileReader;
 import ewe.io.FileWriter;
 import ewe.io.IOException;
 import ewe.io.PrintWriter;
-import ewe.net.Socket;
 import ewe.sys.Convert;
 import ewe.sys.Double;
 import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
-import ewe.util.ByteArray;
 import ewe.util.Properties;
 import ewe.util.StandardComparer;
 import ewe.util.Utils;
@@ -83,6 +81,7 @@
 	CWPoint buttomright;
 	Point tilesSize;
 	float tileScale;
+	boolean fetchOnlyMapWithCache=false;
 
 	/**
 	 *
@@ -126,6 +125,10 @@
 		}
 	}
 
+	public void setFetchOnlyMapWithCache(boolean value) {
+		fetchOnlyMapWithCache=value;
+	}
+	
 	public String[] getAvailableOnlineMapServices(){
 		int s = onlineMapServices.size();
 		String[] services = new String[s];
@@ -227,20 +230,39 @@
 		for (int row = 1; row <= numMapsY; row++) {
 			lon = topleft.lonDec;
 			for (int col = 1; col <= numMapsX; col++) {
-				if (progressInfobox != null)
-					progressInfobox.setInfo(MyLocale.getMsg(4802, "Downloading calibrated (georeferenced) \n map image \n '") + currentOnlineMapService.getName()+MyLocale.getMsg(4803, "' \n Downloading tile \n row")+" "+row+" / "+numMapsY+MyLocale.getMsg(4804, " column")+" "+ col + " / "+numMapsX);
 				center.set(lat, lon);
-				try {
-					downloadMap(center, tileScale, tilesSize, tilesPath);
-				} catch (Exception e) {
-					this.progressInfobox.addWarning(MyLocale.getMsg(4805, "Tile")+" " + row + "/" + col + MyLocale.getMsg(4806, ": Ignoring error:")+" " + e.getMessage()+"\n");
+				if (!fetchOnlyMapWithCache || hasCache(center,latinc,loninc)) {					
+					if (progressInfobox != null)
+						progressInfobox.setInfo(MyLocale.getMsg(4802, "Downloading calibrated (georeferenced) \n map image \n '") + currentOnlineMapService.getName()+MyLocale.getMsg(4803, "' \n Downloading tile \n row")+" "+row+" / "+numMapsY+MyLocale.getMsg(4804, " column")+" "+ col + " / "+numMapsX);
+					try {
+						downloadMap(center, tileScale, tilesSize, tilesPath);
+					} catch (Exception e) {
+						this.progressInfobox.addWarning(MyLocale.getMsg(4805, "Tile")+" " + row + "/" + col + MyLocale.getMsg(4806, ": Ignoring error:")+" " + e.getMessage()+"\n");
+					}
+					if (progressInfobox.isClosed) return;
 				}
-				if (progressInfobox.isClosed) return;
 				lon += loninc;
 			}
 			lat += latinc;
 		}
 	}
+	private boolean hasCache(CWPoint center, double latinc, double loninc) {
+		double lat = center.latDec - (latinc / 2.0);
+		double lon = center.lonDec - (loninc / 2.0);
+		CWPoint tl = new CWPoint(lat,lon);
+		lat = center.latDec + (latinc / 2.0);
+		lon = center.lonDec + (loninc / 2.0);
+		CWPoint br = new CWPoint(lat,lon);
+		Area maparea = new Area(tl,br);
+		CacheDB cacheDB = Global.getProfile().cacheDB;
+		for (int i = 0; i < cacheDB.size(); i++) {
+			CacheHolder ch = cacheDB.get(i);
+			if (maparea.isInBound(ch.pos)) {
+				return true;
+			}
+		}
+		return false;
+	}
 
 	public void setProgressInfoBox (InfoBox progrssInfoboxi) {
 		progressInfobox = progrssInfoboxi;
@@ -259,107 +281,111 @@
 		String imagename = mio.setName(path, filename);
 		String imagetype = currentOnlineMapService.getImageFileExt();
 		String url = currentOnlineMapService.getUrlForCenterScale(center, scale, pixelsize);
-		if (currentOnlineMapService instanceof ExpediaMapService) {
-			downloadImage(url, path+imagename+imagetype);
-		}
-		else {
-			WebMapService wms = (WebMapService) currentOnlineMapService;
-			
-			if (wms.requestUrlPart.startsWith("REQUEST")) {
+		String fName = path + imagename + imagetype;
+		FileBugfix fn = new FileBugfix(path + imagename + ".wfl");
+		FileBugfix fn1 = new FileBugfix(fName);						
+		if (!fn.exists() || fn.length()==0 || !fn1.exists() || fn1.length()==0) {
+			if (currentOnlineMapService instanceof ExpediaMapService) {
 				downloadImage(url, path+imagename+imagetype);
 			}
 			else {
-				Area maparea = wms.CenterScaleToArea(center, scale, pixelsize);
-				CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
-				CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
-
-				String mapProgramPath = wms.versionUrlPart+"/";
-				mapProgramPath = mapProgramPath.replace('/', FileBase.separatorChar);
-				String mapProgram = mapProgramPath+wms.MainUrl;
-				File f=new FileBugfix(mapProgram);
-				if (!f.exists() || !f.canRead()) {
-					MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1834,"Please enter the correct path to Kosmos.Console.exe into the wms-file."),ewe.ui.MessageBox.OKB);
-					mb.execute();
-					return;
+				WebMapService wms = (WebMapService) currentOnlineMapService;				
+				if (wms.requestUrlPart.startsWith("REQUEST")) {
+					downloadImage(url, path+imagename+imagetype);
 				}
-				
-				String mapProgramParams = "";
-				
-				if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {					
-					// minx miny maxx maxy + pixelsize.x
-					mapProgramParams="bitmapgen" +
-						" \""+FileBase.getProgramDirectory().replace('/',File.separatorChar)+"\\"+wms.serviceTypeUrlPart+"\""+
-						" \""+path.replace('/', File.separatorChar)+imagename+imagetype+"\""+
-						" -mb " +
-						buttomleft.toString(TransformCoordinates.LAT_LON).replace(',',' ') + " " +
-						topright.toString(TransformCoordinates.LAT_LON).replace(',',' ') +
-						" -w "+pixelsize.x;				
-					Vm.exec(mapProgram, mapProgramParams, 0, true);				
-				}
-				else { 
-					if (wms.requestUrlPart.equalsIgnoreCase("Maperitive")) {
-						// Maperitive runs on Windows and Linux
-						// generating scriptfile for Maperitive from wmsfile
-						String cwPath = FileBase.getProgramDirectory().replace('/',FileBase.separatorChar) + FileBase.separatorChar;
-						String scriptFileName = cwPath + "maperitive.script";
-						
-						PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(scriptFileName)));
-						outp.println("use-ruleset alias=default");
-						outp.println("clear-map");
+				else {
+					Area maparea = wms.CenterScaleToArea(center, scale, pixelsize);
+					CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
+					CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
 
-						if (wms.serviceTypeUrlPart.equals("")) {
-							outp.println("add-web-map");
-						}
-						else {
-							outp.println("add-web-map provider=" + wms.serviceTypeUrlPart);
-						}
-						
-						if (!wms.stylesUrlPart.equals("")) {
-							String myrules = mapProgramPath + wms.stylesUrlPart.replace('/',FileBase.separatorChar);
-							outp.println("use-ruleset location=" + myrules);
-							// outp.println("apply-ruleset");
-						}
-						if (!wms.layersUrlPart.equals("")) {
+					String mapProgramPath = wms.versionUrlPart+"/";
+					mapProgramPath = mapProgramPath.replace('/', FileBase.separatorChar);
+					String mapProgram = mapProgramPath+wms.MainUrl;
+					File f=new FileBugfix(mapProgram);
+					if (!f.exists() || !f.canRead()) {
+						MessageBox mb=new MessageBox(MyLocale.getMsg(321,"Error"),MyLocale.getMsg(1834,"Please enter the correct path to Kosmos.Console.exe into the wms-file."),ewe.ui.MessageBox.OKB);
+						mb.execute();
+						return;
+					}
+					
+					String mapProgramParams = "";
+					
+					if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {					
+						// minx miny maxx maxy + pixelsize.x
+						mapProgramParams="bitmapgen" +
+							" \""+FileBase.getProgramDirectory().replace('/',File.separatorChar)+"\\"+wms.serviceTypeUrlPart+"\""+
+							" \""+path.replace('/', File.separatorChar)+imagename+imagetype+"\""+
+							" -mb " +
+							buttomleft.toString(TransformCoordinates.LAT_LON).replace(',',' ') + " " +
+							topright.toString(TransformCoordinates.LAT_LON).replace(',',' ') +
+							" -w "+pixelsize.x;				
+						Vm.exec(mapProgram, mapProgramParams, 0, true);				
+					}
+					else {						
+						if (wms.requestUrlPart.equalsIgnoreCase("Maperitive")) {
+							// Maperitive runs on Windows and Linux
+							// generating scriptfile for Maperitive from wmsfile
+							String cwPath = FileBase.getProgramDirectory().replace('/',FileBase.separatorChar) + FileBase.separatorChar;
+							String scriptFileName = cwPath + "maperitive.script";
+							
+							PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(scriptFileName)));
+							outp.println("use-ruleset alias=default");
 							outp.println("clear-map");
-							outp.println("load-source " + mapProgramPath + wms.layersUrlPart.replace('/',FileBase.separatorChar));
-							// implicit does apply-ruleset
+
+							if (wms.serviceTypeUrlPart.equals("")) {
+								outp.println("add-web-map");
+							}
+							else {
+								outp.println("add-web-map provider=" + wms.serviceTypeUrlPart);
+							}
+							
+							if (!wms.stylesUrlPart.equals("")) {
+								String myrules = mapProgramPath + wms.stylesUrlPart.replace('/',FileBase.separatorChar);
+								outp.println("use-ruleset location=" + myrules);
+								// outp.println("apply-ruleset");
+							}
+							if (!wms.layersUrlPart.equals("")) {
+								outp.println("clear-map");
+								outp.println("load-source " + mapProgramPath + wms.layersUrlPart.replace('/',FileBase.separatorChar));
+								// implicit does apply-ruleset
+							}
+							
+							String koords = buttomleft.toString(TransformCoordinates.LON_LAT) + "," + topright.toString(TransformCoordinates.LON_LAT);
+							outp.println("bounds-set "+koords);
+							outp.println("zoom-bounds");
+							if ( path.indexOf(':') == 1) {
+								outp.print("export-bitmap file=" + "\"" + fName + "\"");
+							}
+							else {
+								outp.print("export-bitmap file=" + fName);
+							}
+							outp.print(" bounds="+ koords);
+							String pxSize = " width="+pixelsize.x + " height="+pixelsize.y;						
+							outp.print(pxSize);
+							outp.println(" kml=false");
+							outp.close();
+							// executing the generated script
+							if (mapProgram.indexOf(':') == 1) {
+								mapProgramParams = "-exitafter " + "\"" + scriptFileName + "\"";
+							}
+							else {
+								mapProgramParams = "-exitafter " + scriptFileName;								
+							}
+							Vm.exec(mapProgram, mapProgramParams, 0, true);
+							// preparation for generating wfl from the ozi map-file
+							Vector GCPs = map2wfl(path+imagename);
+							mio.evalGCP(GCPs, pixelsize.x, pixelsize.y);
+							// can not supress genaration of pgw,jgw-file
+							FileBugfix pgwFile = new FileBugfix(path + imagename + ".pgw"); // seems to bee for png
+							pgwFile.delete();
+							FileBugfix jgwFile = new FileBugfix(path + imagename + ".jgw"); // seems to bee for jpg
+							jgwFile.delete();
 						}
-						
-						String koords = buttomleft.toString(TransformCoordinates.LON_LAT) + "," + topright.toString(TransformCoordinates.LON_LAT);
-						outp.println("bounds-set "+koords);
-						outp.println("zoom-bounds");
-						if ( path.indexOf(':') == 1) {
-							outp.print("export-bitmap file=" + "\"" + path + imagename + imagetype + "\"");
-						}
-						else {
-							outp.print("export-bitmap file=" + path + imagename + imagetype);
-						}
-						outp.print(" bounds="+ koords);
-						String pxSize = " width="+pixelsize.x + " height="+pixelsize.y;						
-						outp.print(pxSize);
-						outp.println(" kml=false");
-						outp.close();
-						// executing the generated script
-						if (mapProgram.indexOf(':') == 1) {
-							mapProgramParams = "-exitafter " + "\"" + scriptFileName + "\"";
-						}
-						else {
-							mapProgramParams = "-exitafter " + scriptFileName;								
-						}
-						Vm.exec(mapProgram, mapProgramParams, 0, true);
-						// preparation for generating wfl from the ozi map-file
-						Vector GCPs = map2wfl(path+imagename);
-						mio.evalGCP(GCPs, pixelsize.x, pixelsize.y);
-						// can not supress genaration of pgw,jgw-file
-						File pgwFile = new File(path + imagename + ".pgw"); // seems to bee for png
-						pgwFile.delete();
-						File jgwFile = new File(path + imagename + ".jgw"); // seems to bee for jpg
-						jgwFile.delete();
 					}
-				}
-			}			
+				}			
+			}
+			mio.saveWFL();
 		}
-		mio.saveWFL();
 	}
 
 	private Vector map2wfl(String pathAndImageName) {

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -88,9 +88,9 @@
 	mComboBox scaleInputPerCache = new mComboBox();
 	mLabel overlappingLbl = new mLabel(MyLocale.getMsg(1808,"overlapping in pixel:"));
     mInput overlappingInput = new mInput(""+pref.mapOverlapping);
-	mCheckBox overviewChkBox = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
+	mCheckBox overviewChkBox = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));	
+	mCheckBox fetchOnlyMapWithCacheChkBox = new mCheckBox(MyLocale.getMsg(165,"only for caches"));	
 	mCheckBox overviewChkBoxPerCache = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
-
     mCheckBox smallTiles = new mCheckBox (MyLocale.getMsg (4280, "Small Tiles"));
     mCheckBox bigTiles = new mCheckBox (MyLocale.getMsg (4282, "BigTiles"));
     CheckBoxGroup tileSize = new CheckBoxGroup ();
@@ -168,7 +168,9 @@
 		pnlTiles.addNext(overlappingLbl);
 		pnlTiles.addLast(overlappingInput);
 		overviewChkBox.setState(false);
-		pnlTiles.addLast(overviewChkBox);
+		pnlTiles.addNext(overviewChkBox);
+		fetchOnlyMapWithCacheChkBox.setState(false);
+		pnlTiles.addLast(fetchOnlyMapWithCacheChkBox);
 		pnlTiles.addNext(smallTiles);
 		pnlTiles.addLast(bigTiles);
 		smallTiles.setGroup(tileSize);
@@ -342,6 +344,7 @@
 		}
 		if (!perCache){  // download tiles
 			mapLoader.setProgressInfoBox(progressBox);
+			mapLoader.setFetchOnlyMapWithCache(fetchOnlyMapWithCacheChkBox.getState());
 			mapLoader.downlaodTiles(mapsDir);
 		} else { // per cache
 			CacheHolder ch;

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2011-03-06 13:13:38 UTC (rev 2950)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2011-03-08 20:57:34 UTC (rev 2951)
@@ -168,7 +168,6 @@
 		}
 	}
 
-	public boolean getShowCachesOnMap() {return pref.showCachesOnMap; }
 	public void setShowCachesOnMap(boolean value) {
 		if (value != pref.showCachesOnMap) {
 			pref.showCachesOnMap=value;
@@ -432,7 +431,7 @@
 		if (Global.getProfile().selectionChanged) {
 			// this means marking has changed
 			Global.getProfile().selectionChanged = false;
-			if (getShowCachesOnMap()) removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap
+			if (pref.showCachesOnMap) removeAllMapSymbols(); // not really needed: hopefully removed by showCachesOnMap
 		}
 		setMarkedCache(Global.mainTab.ch); // this is the selected one (not necessary marked)
 		showCachesOnMap();
@@ -1062,7 +1061,7 @@
 			if (screenArea.isInBound(ch.pos)) {
 				// because visible and valid don't change while showing map -->need no remove
 				if (ch.isVisible() && ch.pos.isValid()) {
-					if (getShowCachesOnMap()) {
+					if (pref.showCachesOnMap) {
 						addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType(),true), ch.pos);
 					}
 					else {
@@ -1096,7 +1095,7 @@
 			}
 			if (gotoPosCH != null) {
 				if (screenArea.isInBound(gotoPosCH.pos)) {
-					if (!getShowCachesOnMap()) {
+					if (!pref.showCachesOnMap) {
 						addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType(),true), gotoPosCH.pos);
 					}
 					addSymbolOnTop("goto", gotoPosCH, "goto_map.png", gotoPos.where);



From araber95 at mail.berlios.de  Wed Mar  9 09:22:52 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed,  9 Mar 2011 09:22:52 AM +0100
Subject: [Cachewolf-svn] r2952 - in trunk: res_noewe/webmapservices
	src/CacheWolf/imp
Message-ID: <20110309082253.0B8F2481261@sheep.berlios.de>

Author: araber95
Date: 2011-03-09 09:22:52 +0100 (Wed, 09 Mar 2011)
New Revision: 2952

Added:
   trunk/res_noewe/webmapservices/no-no_t.wms
Modified:
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
1. new wms for norway
2. update 2 for yesterdays gc change

Added: trunk/res_noewe/webmapservices/no-no_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/no-no_t.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/no-no_t.wms	2011-03-09 08:22:52 UTC (rev 2952)
@@ -0,0 +1,173 @@
+TakenFromUrl:       http://www.geonorge.no/geonetwork/srv/no/main.home
+GetCapabilitiesUrl: http://wms.geonorge.no/skwms1/wms.kartdata2?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               no geonorge(kartdata2) topo
+MapType:                        topo
+MainUrl:            http://wms.geonorge.no/skwms1/wms.kartdata2?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Kartdata2_WMS|Kartdata2||
+#LayersUrlPart:     LAYERS=Hoydelag|H?ydelag||
+#LayersUrlPart:     LAYERS=N5000Hoydelag|N5000 H?ydelag|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Hoydelag|N2000 H?ydelag|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Hoydelag|N1000 H?ydelag|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Hoydelag|N500 H?ydelag|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Hoydelag|N250 H?ydelag|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=Arealdekkeflate|Arealdekkeflate||
+#LayersUrlPart:     LAYERS=N5000Arealdekkeflate|N5000 Arealdekkeflate|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Arealdekkeflate|N2000 Arealdekkeflate|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Arealdekkeflate|N1000 Arealdekkeflate|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Arealdekkeflate|N500 Arealdekkeflate|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Arealdekkeflate|N250 Arealdekkeflate|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Arealdekkeflate|N50 Arealdekkeflate|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Fjellskygge|Fjellskygge|4.49012563586673|748.354272644456
+#LayersUrlPart:     LAYERS=Vannflate|Vannflate||
+#LayersUrlPart:     LAYERS=N5000Vannflate|N5000 Vannflate|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Vannflate|N2000 Vannflate|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Vannflate|N1000 Vannflate|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Vannflate|N500 Vannflate|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Vannflate|N250 Vannflate|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Vannflate|N50 Vannflate|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Bygninger|Bygninger||
+#LayersUrlPart:     LAYERS=N50Bygningsflate|N50 Bygningsflate|0|18.7088568161114
+#LayersUrlPart:     LAYERS=N50Tankflate|N50 Tank|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Vannkontur|Vannkontur||
+#LayersUrlPart:     LAYERS=N5000Vannkontur|N5000 Vannkontur|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Vannkontur|N2000 Vannkontur|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Vannkontur|N1000 Vannkontur|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Vannkontur|N500 Vannkontur|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Vannkontur|N250 Vannkontur|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Vannkontur|N50 Vannkontur|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Elver|Elver||
+#LayersUrlPart:     LAYERS=N5000Elver|N2000 Elver|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Elver|N2000 Elver|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Elver|N1000 Elver|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Elver|N500 Elver|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Elver|N250 Elver|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Elver|N50 Elver|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Flomlop|Floml?p||
+#LayersUrlPart:     LAYERS=N50Flomlop|N50 Floml?p|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Hoydekurver|H?ydekurver||
+#LayersUrlPart:     LAYERS=N2000Hoydekurver|N2000 H?ydekurver|243.215138609448|748.354272644456
+#LayersUrlPart:     LAYERS=N1000Hoydekurver|N1000 H?ydekurver|123.478454986335|243.215138609448
+#LayersUrlPart:     LAYERS=N500Hoydekurver|N500 H?ydekurver|63.6101131747787|123.478454986335
+#LayersUrlPart:     LAYERS=N250Hoydekurver|N250 H?ydekurver|18.7088568161114|63.6101131747787
+#LayersUrlPart:     LAYERS=N50Hoydekurver|N50 H?ydekurver|0|18.7088568161114
+#LayersUrlPart:     LAYERS=AdministrativeGrenser|Administrative grenser||
+#LayersUrlPart:     LAYERS=N5000AdministrativeGrenser|N5000 Administrative grenser|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000AdministrativeGrenser|N2000 Administrative grenser|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000AdministrativeGrenser|N1000 Administrative grenser|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500AdministrativeGrenser|N500 Administrative grenser|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250AdministrativeGrenser|N250 Administrative grenser|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50AdministrativeGrenser|N50 Administrative grenser|4.49012563586673|18.7088568161114
+#LayersUrlPart:     LAYERS=Skytefeltgrense|Skytefeltgrense||
+#LayersUrlPart:     LAYERS=N50Skytefeltgrense|N50 Skytefeltgrense|4.49012563586673|18.7088568161114
+#LayersUrlPart:     LAYERS=Verneomradegrense|Verneomr?degrense||
+#LayersUrlPart:     LAYERS=N5000Verneomradegrense|N5000 Verneomr?degrense|486.430277218896|1870.88568161114
+#LayersUrlPart:     LAYERS=N2000Verneomradegrense|N2000 Verneomr?degrense|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Verneomradegrense|N1000 Verneomr?degrense|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Verneomradegrense|N500 Verneomr?degrense|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Verneomradegrense|N250 Verneomr?degrense|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Verneomradegrense|N50 Verneomr?degrense|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Veger|Veger||
+#LayersUrlPart:     LAYERS=N5000Bilveg|N5000 Bilveg|486.430277218896|2432.15138609448
+#LayersUrlPart:     LAYERS=N2000Bilveg|N2000 Bilveg|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Bilveg|N1000 Bilveg|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Bilveg|N500 Bilveg|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Bilveg|N250 Bilveg|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Bilveg|N50 Bilveg|0|18.7088568161114
+#LayersUrlPart:     LAYERS=N500Annenveg|N500 Annenveg|56.1265704483342|149.670854528891
+#LayersUrlPart:     LAYERS=N250Annenveg|N250 Annenveg|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Annenveg|N50 Annenveg|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Jernbane|Jernbane||
+#LayersUrlPart:     LAYERS=N5000Jernbane|N5000 Jernbane|486.430277218896|1496.70854528891
+#LayersUrlPart:     LAYERS=N2000Jernbane|N2000 Jernbane|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Jernbane|N1000 Jernbane|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Jernbane|N500 Jernbane|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Jernbane|N250 Jernbane|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Jernbane|N50 Jernbane|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Ferger|Ferger||
+#LayersUrlPart:     LAYERS=N5000Bilferge|N5000 Bilferge|486.430277218896|1496.70854528891
+#LayersUrlPart:     LAYERS=N2000Bilferge|N2000 Bilferge|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Bilferge|N1000 Bilferge|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Bilferge|N500 Bilferge|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Bilferge|N250 Bilferge|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Bilferge|N50 Bilferge|0|18.7088568161114
+#LayersUrlPart:     LAYERS=N5000AnnenBatrute|N5000 Annen b?trute|486.430277218896|1122.53140896668
+#LayersUrlPart:     LAYERS=N2000AnnenBatrute|N2000 Annen b?trute|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Passasjerferge|N1000 Passasjerferge|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Passasjerferge|N500 Passasjerferge|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Passasjerferge|N250 Passasjerferge|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Passasjerferge|N50 Passasjerferge|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Anleggslinjer|Anleggslinjer||
+#LayersUrlPart:     LAYERS=N1000Anleggslinje|N1000 Anleggslinje|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Anleggslinje|N500 Anleggslinje|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Anleggslinje|N250 Anleggslinje|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Anleggslinje|N50 Anleggslinje|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Hoydepunkt|H?ydepunkt||
+#LayersUrlPart:     LAYERS=N2000Hoydepunkt|N2000 H?ydepunkt|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Hoydepunkt|N1000 H?ydepunkt|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Hoydepunkt|N500 H?ydepunkt|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Hoydepunkt|N250 H?ydepunkt|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Hoydepunkt|N50 H?ydepunkt|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Jernbanestasjon|Jernbanestasjon||
+#LayersUrlPart:     LAYERS=N2000Jernbanestasjon|N2000 Jernbanestasjon|224.506281793337|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Jernbanestasjon|N1000 Jernbanestasjon|149.670854528891|224.506281793337
+#LayersUrlPart:     LAYERS=N500Jernbanestasjon|N500 Jernbanestasjon|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Jernbanestasjon|N250 Jernbanestasjon|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Jernbanestasjon|N50 Jernbanestasjon|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Vegbom|Vegbom||
+#LayersUrlPart:     LAYERS=N50Vegbom|N50 Vegbom|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Turisthytte|Turisthytter||
+#LayersUrlPart:     LAYERS=N500Turisthytte|N500 Turisthytte|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Turisthytte|N250 Turisthytte|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Turisthytte|N50 Turisthytte|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Anleggspunkter|Anleggspunkter||
+#LayersUrlPart:     LAYERS=N2000Anleggspunkt|N2000 Anleggspunkt|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Anleggspunkt|N1000 Anleggspunkt|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Anleggspunkt|N500 Anleggspunkt|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Anleggspunkt|N250 Anleggspunkt|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Anleggspunkt|N50 Anleggspunkt|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Bygningspunkter|Bygningspunkter||
+#LayersUrlPart:     LAYERS=N1000Bygningspunkt|N1000 Bygningspunkt|93.5442840805569|299.341709057782
+#LayersUrlPart:     LAYERS=N500Bygningspunkt|N500 Bygningspunkt|37.4177136322228|93.5442840805569
+#LayersUrlPart:     LAYERS=N250Bygningspunkt|N250 Bygningspunkt|11.2253140896668|37.4177136322228
+#LayersUrlPart:     LAYERS=N50Bygningspunkt|N50 Bygningspunkt|0|11.2253140896668
+#LayersUrlPart:     LAYERS=Arealdekkepunkter|Arealdekkepunkter||
+#LayersUrlPart:     LAYERS=N5000Arealdekkepunkt|N5000 Arealdekkepunkt|486.430277218896|1496.70854528891
+#LayersUrlPart:     LAYERS=N2000Arealdekkepunkt|N2000 Arealdekkepunkt|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Arealdekkepunkt|N1000 Arealdekkepunkt|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Arealdekkepunkt|N500 Arealdekkepunkt|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Arealdekkepunkt|N250 Arealdekkepunkt|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=Tettsted|Tettsted||
+#LayersUrlPart:     LAYERS=N5000Tettsted|N5000 Tettsted|486.430277218896|935.44284080557
+#LayersUrlPart:     LAYERS=N2000Tettsted|N2000 Tettsted|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Tettsted|N1000 Tettsted|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Tettsted|N500 Tettsted|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=Stedsnavn|Stedsnavn||
+#LayersUrlPart:     LAYERS=N5000Tettstedsnavn|N5000 Tettstedsnavn|374.177136322228|935.44284080557
+#LayersUrlPart:     LAYERS=N5000Fylkesnavn|N5000 Fylkesnavn|374.177136322228|0
+#LayersUrlPart:     LAYERS=N2000Stedsnavn|N2000 Stedsnavn|187.088568161114|374.177136322228
+#LayersUrlPart:     LAYERS=N1000Stedsnavn|N1000 Stedsnavn|93.5442840805569|187.088568161114
+#LayersUrlPart:     LAYERS=N500Stedsnavn|N500 Stedsnavn|48.6430277218896|93.5442840805569
+#LayersUrlPart:     LAYERS=N250Stedsnavn|N250 Stedsnavn|14.9670854528891|48.6430277218896
+#LayersUrlPart:     LAYERS=N50Stedsnavn|N50 Stedsnavn|0|14.9670854528891
+#LayersUrlPart:     LAYERS=Tekst|Tekst||
+#LayersUrlPart:     LAYERS=N5000Vegnavn|N5000 Vegnavn|486.430277218896|2432.15138609448
+#LayersUrlPart:     LAYERS=N2000Vegnavn|N2000 Vegnavn|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Vegnavn|N1000 Vegnavn|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Vegnavn|N500 Vegnavn|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Vegnavn|N250 Vegnavn|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Vegnavn|N50 Vegnavn|0|18.7088568161114
+LayersUrlPart:     LAYERS=Kartdata2_WMS
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 71.8912 W 2.5599
+BoundingBoxButtomRightWGS84: N 57.0881 E 33.0199
+#BBox_Mitte: N 64.48965 E 15.229995
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:    5 2 10 20
+ImageFileExtension: .jpg

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-08 20:57:34 UTC (rev 2951)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-09 08:22:52 UTC (rev 2952)
@@ -37,7 +37,6 @@
 import CacheWolf.DateFormat;
 import CacheWolf.Extractor;
 import CacheWolf.Global;
-import CacheWolf.HttpConnection;
 import CacheWolf.ImageInfo;
 import CacheWolf.InfoBox;
 import CacheWolf.Log;
@@ -2614,8 +2613,7 @@
 		LogList reslts = chD.CacheLogs;
 		RexLogBlock.search(completeWebPage);
 		if (!RexLogBlock.didMatch()) {
-			pref.log("check blockRex in spider.def" 
-					+ Preferences.NEWLINE + completeWebPage);
+			pref.log("check blockRex in spider.def" + Preferences.NEWLINE + completeWebPage);
 		}
 		String LogBlock = RexLogBlock.stringMatched(1);
 		exSingleLog.setSource(LogBlock);
@@ -2636,7 +2634,8 @@
 			name = exName.findNext();
 			logText = exLog.findNext();
 			logId = exLogId.findNext();
-			String d = DateFormat.logdate2YMD(exDate.findNext());
+			String ed=exDate.findNext();
+			String d = DateFormat.logdate2YMD(ed);
 			// pref.log("Lognr:"+nLogs+"|"+icon+"|"+name+"-|-"+SafeXML.clean(pref.myAlias)+"|"+logId,null);
 			// if this log says this Cache is found by me
 			if ((icon.equals(icon_smile) || icon.equals(icon_camera) || icon.equals(icon_attended))	&&



From araber95 at mail.berlios.de  Wed Mar  9 09:32:52 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed,  9 Mar 2011 09:32:52 AM +0100
Subject: [Cachewolf-svn] r2953 - in branches/r1.2/res_noewe: . webmapservices
Message-ID: <20110309083253.40510481261@sheep.berlios.de>

Author: araber95
Date: 2011-03-09 09:32:52 +0100 (Wed, 09 Mar 2011)
New Revision: 2953

Added:
   branches/r1.2/res_noewe/webmapservices/no-no_t.wms
Modified:
   branches/r1.2/res_noewe/spider.def
Log:
make working the release with gc-update of 8.M??rz 2011

Modified: branches/r1.2/res_noewe/spider.def
===================================================================
--- branches/r1.2/res_noewe/spider.def	2011-03-09 08:22:52 UTC (rev 2952)
+++ branches/r1.2/res_noewe/spider.def	2011-03-09 08:32:52 UTC (rev 2953)
@@ -53,7 +53,7 @@
 # * When entering spaces into a string ensure to escape them or write them as \\u0020
 # * Be sure that you have no hidden spaces at the end of a line or the patterns will not match!
 #------------------------------------------------------------
-loginPage          = http://www.geocaching.com/login/Default.aspx
+loginPage          = http://www.geocaching.com/login/default.aspx
 loginSuccess       = You\ are\ logged\ in\ as
 nextPage           = /login/default.aspx
 waypoint           = http://www.geocaching.com/seek/cache_details.aspx?wp=
@@ -73,10 +73,10 @@
 availableRex       = class="lnk\ \ Strike">
 archivedRex        = class="lnk\ OldWarning\ Strike\ Strike">
 PMRex              = small_profile.gif
-distCodeRex        = k=(.*?)"\ style=
+distCodeRex        = k=(.*?)"
 distCodeKey        = signalthefrog
 distRex            = (.*?)(?:km|mi|ft)
-DTSRex             = v=(.*?)"\ style=
+DTSRex             = v=(.*?)"
 DTSCodeKey         = hbM9fjmrxy7z42LFD58BkKgPGdHscvCqNnw3ptO6lJ
 waypointRex        = \\(GC(.*?)\\)<br\ />
 TypeRex            = www.geocaching.com/images/wpttypes/sm/(.*?)\\.gif
@@ -107,15 +107,16 @@
 fetchAllLogs       = &log=y
 cacheUnavailable   = class="OldWarning"><li>This\ cache\ is\ temporarily\ unavailable
 cacheArchived      = class="OldWarning"><li>This\ cache\ has\ been\ archived
-premiumCachepage   = class="Warning">This\ is\ a\ Premium\ Member\ Only\ Cache
-latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
+premiumCachepage   = class="Warning">listing\ visible\ to\ Premium
+#latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
+latLonRex          = tBody_LatLon"><b>((?s).*?)</b></span>
 shortDescRex       = tBody_ShortDescription">((?s).*?)</span>
 longDescRex        = tBody_LongDescription">((?s).*?)<td\ valign="top"\ width="10%">\\s*&nbsp;\\s*</td
 cacheNameRex       = tBody_CacheName">((?s).*?)</span>
 cacheOwnerRex      = &wid(?:(?s).*?)>((?s).*?)<
 dateHiddenRex      = (?:Hidden|Event\ Date)\\s*:\\s*((?s).*?)<
 hintsRex           = <div id="div_hint" class="HalfLeft">\\s*((?s).*?)\\s*</div>
-sizeRex            = alt="Size:\ ((?s).*?)"\ />&nbsp<small>
+sizeRex            = alt="Size:\ ((?s).*?)"
 difficultyRex      = difficulty\ of\ (.*?),
 terrainRex         = terrain\ of\ (.*?)\\.\\ 
 cacheTypeRex       = /images/WptTypes/(.*?)\\.gif"\ alt="

Added: branches/r1.2/res_noewe/webmapservices/no-no_t.wms
===================================================================
--- branches/r1.2/res_noewe/webmapservices/no-no_t.wms	                        (rev 0)
+++ branches/r1.2/res_noewe/webmapservices/no-no_t.wms	2011-03-09 08:32:52 UTC (rev 2953)
@@ -0,0 +1,173 @@
+TakenFromUrl:       http://www.geonorge.no/geonetwork/srv/no/main.home
+GetCapabilitiesUrl: http://wms.geonorge.no/skwms1/wms.kartdata2?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               no geonorge(kartdata2) topo
+MapType:                        topo
+MainUrl:            http://wms.geonorge.no/skwms1/wms.kartdata2?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Kartdata2_WMS|Kartdata2||
+#LayersUrlPart:     LAYERS=Hoydelag|H?ydelag||
+#LayersUrlPart:     LAYERS=N5000Hoydelag|N5000 H?ydelag|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Hoydelag|N2000 H?ydelag|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Hoydelag|N1000 H?ydelag|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Hoydelag|N500 H?ydelag|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Hoydelag|N250 H?ydelag|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=Arealdekkeflate|Arealdekkeflate||
+#LayersUrlPart:     LAYERS=N5000Arealdekkeflate|N5000 Arealdekkeflate|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Arealdekkeflate|N2000 Arealdekkeflate|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Arealdekkeflate|N1000 Arealdekkeflate|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Arealdekkeflate|N500 Arealdekkeflate|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Arealdekkeflate|N250 Arealdekkeflate|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Arealdekkeflate|N50 Arealdekkeflate|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Fjellskygge|Fjellskygge|4.49012563586673|748.354272644456
+#LayersUrlPart:     LAYERS=Vannflate|Vannflate||
+#LayersUrlPart:     LAYERS=N5000Vannflate|N5000 Vannflate|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Vannflate|N2000 Vannflate|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Vannflate|N1000 Vannflate|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Vannflate|N500 Vannflate|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Vannflate|N250 Vannflate|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Vannflate|N50 Vannflate|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Bygninger|Bygninger||
+#LayersUrlPart:     LAYERS=N50Bygningsflate|N50 Bygningsflate|0|18.7088568161114
+#LayersUrlPart:     LAYERS=N50Tankflate|N50 Tank|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Vannkontur|Vannkontur||
+#LayersUrlPart:     LAYERS=N5000Vannkontur|N5000 Vannkontur|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Vannkontur|N2000 Vannkontur|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Vannkontur|N1000 Vannkontur|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Vannkontur|N500 Vannkontur|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Vannkontur|N250 Vannkontur|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Vannkontur|N50 Vannkontur|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Elver|Elver||
+#LayersUrlPart:     LAYERS=N5000Elver|N2000 Elver|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000Elver|N2000 Elver|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Elver|N1000 Elver|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Elver|N500 Elver|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Elver|N250 Elver|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Elver|N50 Elver|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Flomlop|Floml?p||
+#LayersUrlPart:     LAYERS=N50Flomlop|N50 Floml?p|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Hoydekurver|H?ydekurver||
+#LayersUrlPart:     LAYERS=N2000Hoydekurver|N2000 H?ydekurver|243.215138609448|748.354272644456
+#LayersUrlPart:     LAYERS=N1000Hoydekurver|N1000 H?ydekurver|123.478454986335|243.215138609448
+#LayersUrlPart:     LAYERS=N500Hoydekurver|N500 H?ydekurver|63.6101131747787|123.478454986335
+#LayersUrlPart:     LAYERS=N250Hoydekurver|N250 H?ydekurver|18.7088568161114|63.6101131747787
+#LayersUrlPart:     LAYERS=N50Hoydekurver|N50 H?ydekurver|0|18.7088568161114
+#LayersUrlPart:     LAYERS=AdministrativeGrenser|Administrative grenser||
+#LayersUrlPart:     LAYERS=N5000AdministrativeGrenser|N5000 Administrative grenser|486.430277218896|0
+#LayersUrlPart:     LAYERS=N2000AdministrativeGrenser|N2000 Administrative grenser|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000AdministrativeGrenser|N1000 Administrative grenser|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500AdministrativeGrenser|N500 Administrative grenser|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250AdministrativeGrenser|N250 Administrative grenser|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50AdministrativeGrenser|N50 Administrative grenser|4.49012563586673|18.7088568161114
+#LayersUrlPart:     LAYERS=Skytefeltgrense|Skytefeltgrense||
+#LayersUrlPart:     LAYERS=N50Skytefeltgrense|N50 Skytefeltgrense|4.49012563586673|18.7088568161114
+#LayersUrlPart:     LAYERS=Verneomradegrense|Verneomr?degrense||
+#LayersUrlPart:     LAYERS=N5000Verneomradegrense|N5000 Verneomr?degrense|486.430277218896|1870.88568161114
+#LayersUrlPart:     LAYERS=N2000Verneomradegrense|N2000 Verneomr?degrense|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Verneomradegrense|N1000 Verneomr?degrense|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Verneomradegrense|N500 Verneomr?degrense|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Verneomradegrense|N250 Verneomr?degrense|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Verneomradegrense|N50 Verneomr?degrense|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Veger|Veger||
+#LayersUrlPart:     LAYERS=N5000Bilveg|N5000 Bilveg|486.430277218896|2432.15138609448
+#LayersUrlPart:     LAYERS=N2000Bilveg|N2000 Bilveg|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Bilveg|N1000 Bilveg|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Bilveg|N500 Bilveg|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Bilveg|N250 Bilveg|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Bilveg|N50 Bilveg|0|18.7088568161114
+#LayersUrlPart:     LAYERS=N500Annenveg|N500 Annenveg|56.1265704483342|149.670854528891
+#LayersUrlPart:     LAYERS=N250Annenveg|N250 Annenveg|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Annenveg|N50 Annenveg|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Jernbane|Jernbane||
+#LayersUrlPart:     LAYERS=N5000Jernbane|N5000 Jernbane|486.430277218896|1496.70854528891
+#LayersUrlPart:     LAYERS=N2000Jernbane|N2000 Jernbane|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Jernbane|N1000 Jernbane|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Jernbane|N500 Jernbane|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Jernbane|N250 Jernbane|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Jernbane|N50 Jernbane|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Ferger|Ferger||
+#LayersUrlPart:     LAYERS=N5000Bilferge|N5000 Bilferge|486.430277218896|1496.70854528891
+#LayersUrlPart:     LAYERS=N2000Bilferge|N2000 Bilferge|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Bilferge|N1000 Bilferge|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Bilferge|N500 Bilferge|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Bilferge|N250 Bilferge|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Bilferge|N50 Bilferge|0|18.7088568161114
+#LayersUrlPart:     LAYERS=N5000AnnenBatrute|N5000 Annen b?trute|486.430277218896|1122.53140896668
+#LayersUrlPart:     LAYERS=N2000AnnenBatrute|N2000 Annen b?trute|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Passasjerferge|N1000 Passasjerferge|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Passasjerferge|N500 Passasjerferge|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Passasjerferge|N250 Passasjerferge|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Passasjerferge|N50 Passasjerferge|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Anleggslinjer|Anleggslinjer||
+#LayersUrlPart:     LAYERS=N1000Anleggslinje|N1000 Anleggslinje|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Anleggslinje|N500 Anleggslinje|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Anleggslinje|N250 Anleggslinje|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Anleggslinje|N50 Anleggslinje|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Hoydepunkt|H?ydepunkt||
+#LayersUrlPart:     LAYERS=N2000Hoydepunkt|N2000 H?ydepunkt|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Hoydepunkt|N1000 H?ydepunkt|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Hoydepunkt|N500 H?ydepunkt|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Hoydepunkt|N250 H?ydepunkt|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Hoydepunkt|N50 H?ydepunkt|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Jernbanestasjon|Jernbanestasjon||
+#LayersUrlPart:     LAYERS=N2000Jernbanestasjon|N2000 Jernbanestasjon|224.506281793337|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Jernbanestasjon|N1000 Jernbanestasjon|149.670854528891|224.506281793337
+#LayersUrlPart:     LAYERS=N500Jernbanestasjon|N500 Jernbanestasjon|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Jernbanestasjon|N250 Jernbanestasjon|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Jernbanestasjon|N50 Jernbanestasjon|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Vegbom|Vegbom||
+#LayersUrlPart:     LAYERS=N50Vegbom|N50 Vegbom|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Turisthytte|Turisthytter||
+#LayersUrlPart:     LAYERS=N500Turisthytte|N500 Turisthytte|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Turisthytte|N250 Turisthytte|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Turisthytte|N50 Turisthytte|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Anleggspunkter|Anleggspunkter||
+#LayersUrlPart:     LAYERS=N2000Anleggspunkt|N2000 Anleggspunkt|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Anleggspunkt|N1000 Anleggspunkt|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Anleggspunkt|N500 Anleggspunkt|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Anleggspunkt|N250 Anleggspunkt|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Anleggspunkt|N50 Anleggspunkt|0|18.7088568161114
+#LayersUrlPart:     LAYERS=Bygningspunkter|Bygningspunkter||
+#LayersUrlPart:     LAYERS=N1000Bygningspunkt|N1000 Bygningspunkt|93.5442840805569|299.341709057782
+#LayersUrlPart:     LAYERS=N500Bygningspunkt|N500 Bygningspunkt|37.4177136322228|93.5442840805569
+#LayersUrlPart:     LAYERS=N250Bygningspunkt|N250 Bygningspunkt|11.2253140896668|37.4177136322228
+#LayersUrlPart:     LAYERS=N50Bygningspunkt|N50 Bygningspunkt|0|11.2253140896668
+#LayersUrlPart:     LAYERS=Arealdekkepunkter|Arealdekkepunkter||
+#LayersUrlPart:     LAYERS=N5000Arealdekkepunkt|N5000 Arealdekkepunkt|486.430277218896|1496.70854528891
+#LayersUrlPart:     LAYERS=N2000Arealdekkepunkt|N2000 Arealdekkepunkt|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Arealdekkepunkt|N1000 Arealdekkepunkt|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Arealdekkepunkt|N500 Arealdekkepunkt|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Arealdekkepunkt|N250 Arealdekkepunkt|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=Tettsted|Tettsted||
+#LayersUrlPart:     LAYERS=N5000Tettsted|N5000 Tettsted|486.430277218896|935.44284080557
+#LayersUrlPart:     LAYERS=N2000Tettsted|N2000 Tettsted|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Tettsted|N1000 Tettsted|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Tettsted|N500 Tettsted|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=Stedsnavn|Stedsnavn||
+#LayersUrlPart:     LAYERS=N5000Tettstedsnavn|N5000 Tettstedsnavn|374.177136322228|935.44284080557
+#LayersUrlPart:     LAYERS=N5000Fylkesnavn|N5000 Fylkesnavn|374.177136322228|0
+#LayersUrlPart:     LAYERS=N2000Stedsnavn|N2000 Stedsnavn|187.088568161114|374.177136322228
+#LayersUrlPart:     LAYERS=N1000Stedsnavn|N1000 Stedsnavn|93.5442840805569|187.088568161114
+#LayersUrlPart:     LAYERS=N500Stedsnavn|N500 Stedsnavn|48.6430277218896|93.5442840805569
+#LayersUrlPart:     LAYERS=N250Stedsnavn|N250 Stedsnavn|14.9670854528891|48.6430277218896
+#LayersUrlPart:     LAYERS=N50Stedsnavn|N50 Stedsnavn|0|14.9670854528891
+#LayersUrlPart:     LAYERS=Tekst|Tekst||
+#LayersUrlPart:     LAYERS=N5000Vegnavn|N5000 Vegnavn|486.430277218896|2432.15138609448
+#LayersUrlPart:     LAYERS=N2000Vegnavn|N2000 Vegnavn|299.341709057782|486.430277218896
+#LayersUrlPart:     LAYERS=N1000Vegnavn|N1000 Vegnavn|149.670854528891|299.341709057782
+#LayersUrlPart:     LAYERS=N500Vegnavn|N500 Vegnavn|93.5442840805569|149.670854528891
+#LayersUrlPart:     LAYERS=N250Vegnavn|N250 Vegnavn|18.7088568161114|93.5442840805569
+#LayersUrlPart:     LAYERS=N50Vegnavn|N50 Vegnavn|0|18.7088568161114
+LayersUrlPart:     LAYERS=Kartdata2_WMS
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 71.8912 W 2.5599
+BoundingBoxButtomRightWGS84: N 57.0881 E 33.0199
+#BBox_Mitte: N 64.48965 E 15.229995
+MinScale:   0
+MaxScale:   1000
+RecommendedScale:    5 2 10 20
+ImageFileExtension: .jpg



From mik77 at mail.berlios.de  Wed Mar  9 05:51:11 2011
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed,  9 Mar 2011 05:51:11 PM +0100
Subject: [Cachewolf-svn] r2954 - trunk/res_noewe
Message-ID: <20110309165111.E6BEC481479@sheep.berlios.de>

Author: mik77
Date: 2011-03-09 17:51:11 +0100 (Wed, 09 Mar 2011)
New Revision: 2954

Modified:
   trunk/res_noewe/spider.def
Log:
some corrections in log recognition

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-09 08:32:52 UTC (rev 2953)
+++ trunk/res_noewe/spider.def	2011-03-09 16:51:11 UTC (rev 2954)
@@ -132,13 +132,13 @@
 singleLogExEnd     = <small><a\ href="
 # iconEx, nameTempEx, dateEx, singleLogEx werden auf einen singleLog angewendet
 iconExStart        = www.geocaching.com/images/icons/
-iconExEnd          = \ title='
+iconExEnd          = \ alt="
 nameTempExStart    = <a\ href='
 nameTempExEnd      = /a>
 # Name extrahiert aus nameTemp
 nameExStart        = >
 nameExEnd          = <
-dateExStart        = '\ />&nbsp;
+dateExStart        = "\ />&nbsp;
 dateExEnd          = \ by\ <a\ href='/profile/?guid=
 logExStart         = found)<br\ /><br\ />
 logExEnd           = <br\ /><br\ /><small><a\ href="



From mik77 at mail.berlios.de  Thu Mar 10 01:24:25 2011
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Thu, 10 Mar 2011 01:24:25 PM +0100
Subject: [Cachewolf-svn] r2955 - trunk/res_noewe
Message-ID: <20110310122425.EAD534813F4@sheep.berlios.de>

Author: mik77
Date: 2011-03-10 13:24:25 +0100 (Thu, 10 Mar 2011)
New Revision: 2955

Modified:
   trunk/res_noewe/spider.def
Log:
 - update for additional waypoints

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-09 16:51:11 UTC (rev 2954)
+++ trunk/res_noewe/spider.def	2011-03-10 12:24:25 UTC (rev 2955)
@@ -194,7 +194,7 @@
 #--------------------------------------
 #Section2d: Additional waypoints
 #--------------------------------------
-wayBlockExStart    = <span\ id="ctl00_ContentBody_WaypointsInfo"\ style="font-weight:bold;">Additional\ Waypoints</span>
+wayBlockExStart    = <span\ id="ctl00_ContentBody_WaypointsInfo"
 wayBlockExEnd      = </table>
 nameRex            = &RefDS=1">(.*)</a>
 koordRex           = <td>\\s*([NSns]\ [0-9]{1,2}..[0-9]{1,2}.[0-9]{1,3}\ [EWew]\ [0-9]{1,3}..[0-9]{1,2}.[0-9]{1,3})&nbsp;\\s*</td>



From araber95 at mail.berlios.de  Fri Mar 11 02:57:11 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 11 Mar 2011 02:57:11 PM +0100
Subject: [Cachewolf-svn] r2956 - branches/r1.2/res_noewe
Message-ID: <20110311135711.EF900481391@sheep.berlios.de>

Author: araber95
Date: 2011-03-11 14:57:11 +0100 (Fri, 11 Mar 2011)
New Revision: 2956

Modified:
   branches/r1.2/res_noewe/spider.def
Log:
don't know why get a different page in NB

Modified: branches/r1.2/res_noewe/spider.def
===================================================================
--- branches/r1.2/res_noewe/spider.def	2011-03-10 12:24:25 UTC (rev 2955)
+++ branches/r1.2/res_noewe/spider.def	2011-03-11 13:57:11 UTC (rev 2956)
@@ -108,8 +108,8 @@
 cacheUnavailable   = class="OldWarning"><li>This\ cache\ is\ temporarily\ unavailable
 cacheArchived      = class="OldWarning"><li>This\ cache\ has\ been\ archived
 premiumCachepage   = class="Warning">listing\ visible\ to\ Premium
-#latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
-latLonRex          = tBody_LatLon"><b>((?s).*?)</b></span>
+latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
+#latLonRex          = tBody_LatLon"><b>((?s).*?)</b></span>
 shortDescRex       = tBody_ShortDescription">((?s).*?)</span>
 longDescRex        = tBody_LongDescription">((?s).*?)<td\ valign="top"\ width="10%">\\s*&nbsp;\\s*</td
 cacheNameRex       = tBody_CacheName">((?s).*?)</span>
@@ -132,13 +132,13 @@
 singleLogExEnd     = <small><a\ href="
 # iconEx, nameTempEx, dateEx, singleLogEx werden auf einen singleLog angewendet
 iconExStart        = www.geocaching.com/images/icons/
-iconExEnd          = \ title='
+iconExEnd          = \ alt="
 nameTempExStart    = <a\ href='
 nameTempExEnd      = /a>
 # Name extrahiert aus nameTemp
 nameExStart        = >
 nameExEnd          = <
-dateExStart        = '\ />&nbsp;
+dateExStart        = "\ />&nbsp;
 dateExEnd          = \ by\ <a\ href='/profile/?guid=
 logExStart         = found)<br\ /><br\ />
 logExEnd           = <br\ /><br\ /><small><a\ href="
@@ -194,7 +194,7 @@
 #--------------------------------------
 #Section2d: Additional waypoints
 #--------------------------------------
-wayBlockExStart    = <span\ id="ctl00_ContentBody_WaypointsInfo"\ style="font-weight:bold;">Additional\ Waypoints</span>
+wayBlockExStart    = <span\ id="ctl00_ContentBody_WaypointsInfo"
 wayBlockExEnd      = </table>
 nameRex            = &RefDS=1">(.*)</a>
 koordRex           = <td>\\s*([NSns]\ [0-9]{1,2}..[0-9]{1,2}.[0-9]{1,3}\ [EWew]\ [0-9]{1,3}..[0-9]{1,2}.[0-9]{1,3})&nbsp;\\s*</td>



From engywuck at mail.berlios.de  Sun Mar 13 05:18:31 2011
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 13 Mar 2011 05:18:31 PM +0100
Subject: [Cachewolf-svn] r2957 - trunk
Message-ID: <20110313161831.C9A8948140E@sheep.berlios.de>

Author: engywuck
Date: 2011-03-13 17:18:31 +0100 (Sun, 13 Mar 2011)
New Revision: 2957

Modified:
   trunk/CacheWolf.launch
Log:
Setting classpath in launch configuration to what it should be.

Modified: trunk/CacheWolf.launch
===================================================================
--- trunk/CacheWolf.launch	2011-03-11 13:57:11 UTC (rev 2956)
+++ trunk/CacheWolf.launch	2011-03-13 16:18:31 UTC (rev 2957)
@@ -7,9 +7,9 @@
 <listEntry value="4"/>
 </listAttribute>
 <listAttribute key="org.eclipse.jdt.launching.CLASSPATH">
-<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#13;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/CacheWolf/lib/ewe.jar&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#13;&#10;"/>
-<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#13;&#10;&lt;runtimeClasspathEntry id=&quot;org.eclipse.jdt.launching.classpathentry.defaultClasspath&quot;&gt;&#13;&#10;&lt;memento exportedEntriesOnly=&quot;false&quot; project=&quot;CacheWolf&quot;/&gt;&#13;&#10;&lt;/runtimeClasspathEntry&gt;&#13;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#13;&#10;&lt;runtimeClasspathEntry path=&quot;3&quot; projectName=&quot;CacheWolf&quot; type=&quot;1&quot;/&gt;&#13;&#10;"/>
 <listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#13;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/CacheWolf/lib/JavaEwe.zip&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#13;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#13;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/CacheWolf/lib&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#13;&#10;"/>
 </listAttribute>
 <booleanAttribute key="org.eclipse.jdt.launching.DEFAULT_CLASSPATH" value="false"/>
 <stringAttribute key="org.eclipse.jdt.launching.MAIN_TYPE" value="Ewe"/>



From mik77 at mail.berlios.de  Mon Mar 14 02:58:16 2011
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 14 Mar 2011 02:58:16 PM +0100
Subject: [Cachewolf-svn] r2958 - trunk/src/CacheWolf
Message-ID: <20110314135817.08D004814E5@sheep.berlios.de>

Author: mik77
Date: 2011-03-14 14:58:16 +0100 (Mon, 14 Mar 2011)
New Revision: 2958

Modified:
   trunk/src/CacheWolf/CacheType.java
Log:
Cache type recognition in GPX file is now case insensitive.

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2011-03-13 16:18:31 UTC (rev 2957)
+++ trunk/src/CacheWolf/CacheType.java	2011-03-14 13:58:16 UTC (rev 2958)
@@ -268,13 +268,14 @@
 	 */
 	public static byte gpxType2CwType(final String gpxType) throws IllegalArgumentException {
 		for (byte i=0; i<cTypRef.length; i++) {
-			if (cTypRef[i]._gpxWptTypeTag.equals(gpxType)) {return cTypRef[i]._cwMappedCType;};
+			if (cTypRef[i]._gpxWptTypeTag.equalsIgnoreCase(gpxType)) {return cTypRef[i]._cwMappedCType;};
 		}
 		for (byte i=0; i<cTypRef.length; i++) {
-			if (cTypRef[i]._gpxWptGCextensionTypTag.equals(gpxType)) {return cTypRef[i]._cwMappedCType;};
+			if (cTypRef[i]._gpxWptGCextensionTypTag.equalsIgnoreCase(gpxType)) {return cTypRef[i]._cwMappedCType;};
 		}
+		String lowerCaseGPXType = gpxType.toLowerCase();
 		for (byte i=0; i<cTypRef.length; i++) {
-			if (cTypRef[i]._gpxAlternativeWptTypTags.indexOf(gpxType) != -1) {
+			if (cTypRef[i]._gpxAlternativeWptTypTags.toLowerCase().indexOf(lowerCaseGPXType) != -1) {
 				return cTypRef[i]._cwMappedCType;
 			};
 		}



From mik77 at mail.berlios.de  Tue Mar 15 09:11:00 2011
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 15 Mar 2011 09:11:00 AM +0100
Subject: [Cachewolf-svn] r2959 - trunk/src/CacheWolf/exp
Message-ID: <20110315081100.7B3494814E5@sheep.berlios.de>

Author: mik77
Date: 2011-03-15 09:11:00 +0100 (Tue, 15 Mar 2011)
New Revision: 2959

Modified:
   trunk/src/CacheWolf/exp/GpxExportNg.java
Log:
Don't export attributes without ID.

Modified: trunk/src/CacheWolf/exp/GpxExportNg.java
===================================================================
--- trunk/src/CacheWolf/exp/GpxExportNg.java	2011-03-14 13:58:16 UTC (rev 2958)
+++ trunk/src/CacheWolf/exp/GpxExportNg.java	2011-03-15 08:11:00 UTC (rev 2959)
@@ -763,14 +763,16 @@
 		for (int i = 0; i < ch.getCacheDetails(true).attributes.count(); i++) {
 			// <groundspeak:attribute id="X" inc="Y">text f?r X</groundspeak:attribute>
 			attrib=ch.getCacheDetails(true).attributes.getAttribute(i);
-			ret.append("        <groundspeak:attribute id=\"").
-			append(attrib.getGCId()).
-			append("\" inc=\"").
-			append(attrib.getInc()).
-			append("\">").
-			append(attrib.getGCText()).
-			append("</groundspeak:attribute>").
-			append(newLine);
+			if (attrib.getGCId().length() > 0) {
+				ret.append("        <groundspeak:attribute id=\"").
+				append(attrib.getGCId()).
+				append("\" inc=\"").
+				append(attrib.getInc()).
+				append("\">").
+				append(attrib.getGCText()).
+				append("</groundspeak:attribute>").
+				append(newLine);
+			}
 		}
 		return ret.toString();
 	}



From apreisser at mail.berlios.de  Sat Mar 19 04:45:34 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 19 Mar 2011 04:45:34 PM +0100
Subject: [Cachewolf-svn] r2960 - in trunk/src/CacheWolf: imp navi
	navi/touchControls
Message-ID: <20110319154534.DE8444801E2@sheep.berlios.de>

Author: apreisser
Date: 2011-03-19 16:45:34 +0100 (Sat, 19 Mar 2011)
New Revision: 2960

Modified:
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/navi/Area.java
   trunk/src/CacheWolf/navi/AreaList.java
   trunk/src/CacheWolf/navi/MapInfoObject.java
   trunk/src/CacheWolf/navi/MapLoader.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
   trunk/src/CacheWolf/navi/MapsList.java
   trunk/src/CacheWolf/navi/MovingMap.java
   trunk/src/CacheWolf/navi/TransformCoordinates.java
   trunk/src/CacheWolf/navi/touchControls/MovingMapControlSettings.java
Log:
Typo in fieldname corrected

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -418,7 +418,7 @@
 			if (nextPos != null) {
 				sq = getSquare(startPos, lateralDistance);
 				getCaches(sq.topleft.latDec, sq.topleft.lonDec,
-						sq.buttomright.latDec, sq.buttomright.lonDec, complete);
+						sq.bottomright.latDec, sq.bottomright.lonDec, complete);
 				// pref.log("next WP = " + startPos.toString(), null);
 
 				double degrees = startPos.getBearing(nextPos);
@@ -431,7 +431,7 @@
 					origin = nextCheckPoint;
 					sq = getSquare(origin, lateralDistance);
 					getCaches(sq.topleft.latDec, sq.topleft.lonDec,
-							sq.buttomright.latDec, sq.buttomright.lonDec, complete);
+							sq.bottomright.latDec, sq.bottomright.lonDec, complete);
 					// pref.log("next CP = " + origin.toString(), null);
 					if (infB.isClosed) {
 						break;
@@ -444,8 +444,8 @@
 			}
 		}
 		sq = getSquare(startPos, lateralDistance);
-		getCaches(sq.topleft.latDec, sq.topleft.lonDec, sq.buttomright.latDec,
-				sq.buttomright.lonDec, complete);
+		getCaches(sq.topleft.latDec, sq.topleft.lonDec, sq.bottomright.latDec,
+				sq.bottomright.lonDec, complete);
 		// pref.log("last WP = " + startPos.toString(), null);
 		if (infB.isClosed) {
 			Vm.showWait(false);
@@ -534,10 +534,10 @@
 		ret.topleft.shift(halfSideLength, north);
 		ret.topleft.shift(halfSideLength, west);
 
-		ret.buttomright.latDec = centre.latDec;
-		ret.buttomright.lonDec = centre.lonDec;
-		ret.buttomright.shift(halfSideLength, south);
-		ret.buttomright.shift(halfSideLength, east);
+		ret.bottomright.latDec = centre.latDec;
+		ret.bottomright.lonDec = centre.lonDec;
+		ret.bottomright.shift(halfSideLength, south);
+		ret.bottomright.shift(halfSideLength, east);
 
 		return ret;
 	}
@@ -581,8 +581,8 @@
 		num_added = 0;
 
 		Area sq = getSquare(origin, halfSideLength);
-		getCaches(sq.topleft.latDec, sq.topleft.lonDec, sq.buttomright.latDec,
-				sq.buttomright.lonDec, false);
+		getCaches(sq.topleft.latDec, sq.topleft.lonDec, sq.bottomright.latDec,
+				sq.bottomright.lonDec, false);
 
 		if (!infB.isClosed)
 			infB.close(0);

Modified: trunk/src/CacheWolf/navi/Area.java
===================================================================
--- trunk/src/CacheWolf/navi/Area.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/Area.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -31,37 +31,37 @@
 	 public final static int NOT_ON_EDGE = -1;
 	 public final static int AT_TOP_EDGE = 1;
 	 public final static int AT_RIGHT_EDGE = 2;
-	 public final static int AT_BUTTOM_EDGE = 3;
+	 public final static int AT_BOTTOM_EDGE = 3;
 	 public final static int AT_LEFT_EDGE = 4;
 	 public static double edgeTolerance = 3 * 360/40000000; // approx 3m will be seen as the same
 */
 	 public CWPoint topleft;
-	 public CWPoint buttomright;
+	 public CWPoint bottomright;
 	 
 	 public Area() {
 		 topleft = new CWPoint();
-		 buttomright = new CWPoint();
+		 bottomright = new CWPoint();
 	 }
 
 	 public Area(TrackPoint tl, TrackPoint br){
 		 topleft = new CWPoint(tl);
-		 buttomright = new CWPoint(br);
+		 bottomright = new CWPoint(br);
 	 }
 	 
 	 public Area(CWPoint tl, CWPoint br) {
 		 topleft = tl;
-		 buttomright = br;
+		 bottomright = br;
 	 }
 
 	 public final boolean isInBound(TrackPoint p) {
 		 if (topleft.latDec >= p.latDec && topleft.lonDec <= p.lonDec 
-				 && buttomright.latDec <= p.latDec && buttomright.lonDec >= p.lonDec) return true;
+				 && bottomright.latDec <= p.latDec && bottomright.lonDec >= p.lonDec) return true;
 		 else return false;
 	 }
 		
 	 public final boolean isInBound(double lat, double lon) {
 		 if (topleft.latDec >= lat && topleft.lonDec <= lon
-				 && buttomright.latDec <= lat && buttomright.lonDec >= lon) return true;
+				 && bottomright.latDec <= lat && bottomright.lonDec >= lon) return true;
 		 else return false;
 	 }
 
@@ -71,24 +71,24 @@
 	 * @return
 	 */
 	 public final boolean isInBound(Area a) {
-		 return (isInBound(a.topleft) && isInBound(a.buttomright));
+		 return (isInBound(a.topleft) && isInBound(a.bottomright));
 	 }
 	 
 	 
 	 public final boolean isOverlapping(Area a) {
 		 return ! ( // test if not overlapping and invert the result, see http://www.geoclub.de/viewtopic.php?f=40&t=38364&p=607033#p607033
-				    this.buttomright.latDec > a.topleft.latDec
-				 || this.topleft.latDec     < a.buttomright.latDec
-				 || this.buttomright.lonDec < a.topleft.lonDec
-				 || this.topleft.lonDec     > a.buttomright.lonDec);
+				    this.bottomright.latDec > a.topleft.latDec
+				 || this.topleft.latDec     < a.bottomright.latDec
+				 || this.bottomright.lonDec < a.topleft.lonDec
+				 || this.topleft.lonDec     > a.bottomright.lonDec);
 	 }
 	 
 	 /* not used at the moment
 	  public boolean equals(Area a) {
 		 if(java.lang.Math.abs(topleft.latDec - a.topleft.latDec) < edgeTolerance 
 				 && java.lang.Math.abs(topleft.lonDec - a.topleft.lonDec) < edgeTolerance
-				 && java.lang.Math.abs(buttomright.latDec - a.buttomright.latDec) < edgeTolerance
-				 && java.lang.Math.abs(buttomright.lonDec - a.buttomright.lonDec) < edgeTolerance )
+				 && java.lang.Math.abs(bottomright.latDec - a.bottomright.latDec) < edgeTolerance
+				 && java.lang.Math.abs(bottomright.lonDec - a.bottomright.lonDec) < edgeTolerance )
 			 return true;
 		 else return false;
 	 }
@@ -98,19 +98,19 @@
 	 public int getEdge(CWPoint tl, CWPoint br) {
 		 if (java.lang.Math.abs(topleft.latDec - br.latDec) < edgeTolerance 
 				 && java.lang.Math.abs(topleft.lonDec - tl.lonDec) < edgeTolerance 
-				 && java.lang.Math.abs(buttomright.lonDec - br.lonDec) < edgeTolerance)
+				 && java.lang.Math.abs(bottomright.lonDec - br.lonDec) < edgeTolerance)
 			 return AT_TOP_EDGE;
 			 if (java.lang.Math.abs(topleft.latDec - tl.latDec) < edgeTolerance 
-					 && java.lang.Math.abs(buttomright.lonDec - tl.lonDec) < edgeTolerance 
-					 && java.lang.Math.abs(buttomright.latDec - br.latDec) < edgeTolerance)
+					 && java.lang.Math.abs(bottomright.lonDec - tl.lonDec) < edgeTolerance 
+					 && java.lang.Math.abs(bottomright.latDec - br.latDec) < edgeTolerance)
 				 return AT_RIGHT_EDGE;
 			 if (java.lang.Math.abs(topleft.lonDec - tl.lonDec) < edgeTolerance 
-					 && java.lang.Math.abs(buttomright.latDec - tl.latDec) < edgeTolerance 
-					 && java.lang.Math.abs(buttomright.lonDec - br.lonDec) < edgeTolerance)
-				 return AT_BUTTOM_EDGE;
+					 && java.lang.Math.abs(bottomright.latDec - tl.latDec) < edgeTolerance 
+					 && java.lang.Math.abs(bottomright.lonDec - br.lonDec) < edgeTolerance)
+				 return AT_BOTTOM_EDGE;
 			 if (java.lang.Math.abs(topleft.latDec - tl.latDec) < edgeTolerance 
 					 && java.lang.Math.abs(topleft.lonDec - br.lonDec) < edgeTolerance 
-					 && java.lang.Math.abs(buttomright.latDec - br.latDec) < edgeTolerance)
+					 && java.lang.Math.abs(bottomright.latDec - br.latDec) < edgeTolerance)
 				 return AT_LEFT_EDGE;
 			 return NOT_ON_EDGE;
 	 }
@@ -122,7 +122,7 @@
 	  */
 	 public final String getEasyFindString() {
 		 String ul = getEasyFindString(topleft, 30);
-		 String br = getEasyFindString(buttomright, 30);
+		 String br = getEasyFindString(bottomright, 30);
 		 int i;
 		 for (i=0; i<br.length(); i++ ) {
 			 if (ul.charAt(i) != br.charAt(i)) break;
@@ -158,10 +158,10 @@
 	 }
 	 
 	 public String toString() {
-		 return topleft.toString() + ", " + buttomright.toString();
+		 return topleft.toString() + ", " + bottomright.toString();
 	 }
 	 
 	 public final CWPoint getCenter() {
-		 return new CWPoint((topleft.latDec + buttomright.latDec)/2, (topleft.lonDec + buttomright.lonDec)/2);
+		 return new CWPoint((topleft.latDec + bottomright.latDec)/2, (topleft.lonDec + bottomright.lonDec)/2);
 	 }
 }

Modified: trunk/src/CacheWolf/navi/AreaList.java
===================================================================
--- trunk/src/CacheWolf/navi/AreaList.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/AreaList.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -38,28 +38,28 @@
 /*
 	 public AreaList(int s) {super(s);}
 
-	 public void addArea(CWPoint topleft, CWPoint buttomright) {
+	 public void addArea(CWPoint topleft, CWPoint bottomright) {
 		 Area tp = getArea(topleft);
-		 if (tp != null && tp.isInBound(buttomright)) return; // area already completly in list
-		 int edge = tp.getEdge(topleft, buttomright);
+		 if (tp != null && tp.isInBound(bottomright)) return; // area already completly in list
+		 int edge = tp.getEdge(topleft, bottomright);
 		 switch (edge) {
 		 case Area.AT_TOP_EDGE: tp.topleft.latDec = topleft.latDec; break;
-		 case Area.AT_RIGHT_EDGE: tp.buttomright.lonDec = buttomright.lonDec; break;
-		 case Area.AT_BUTTOM_EDGE: tp.buttomright.latDec = buttomright.latDec; break;
+		 case Area.AT_RIGHT_EDGE: tp.bottomright.lonDec = bottomright.lonDec; break;
+		 case Area.AT_BOTTOM_EDGE: tp.bottomright.latDec = bottomright.latDec; break;
 		 case Area.AT_LEFT_EDGE: tp.topleft.lonDec = topleft.lonDec; break;
-		 case Area.NOT_ON_EDGE: addAreaUnconditionally(new Area(topleft, buttomright));
+		 case Area.NOT_ON_EDGE: addAreaUnconditionally(new Area(topleft, bottomright));
 		 }
 	 }
 
-	 public boolean AreaIsCovered(CWPoint topleft, CWPoint buttomright) {
+	 public boolean AreaIsCovered(CWPoint topleft, CWPoint bottomright) {
 		 Area tp = getArea(topleft);
-		 if (tp != null && tp.isInBound(buttomright)) return true; // area already completly in list
+		 if (tp != null && tp.isInBound(bottomright)) return true; // area already completly in list
 		 else return false;
 
 	 }
 
 	 public void addArea(Area a) {
-		 addArea(a.topleft, a.buttomright);
+		 addArea(a.topleft, a.bottomright);
 	 }
 
 	 public static AreaList joinAreas(AreaList al){

Modified: trunk/src/CacheWolf/navi/MapInfoObject.java
===================================================================
--- trunk/src/CacheWolf/navi/MapInfoObject.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/MapInfoObject.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -83,7 +83,7 @@
 	}
 
 	public MapInfoObject(MapInfoObject map) {
-		super (map.topleft, map.buttomright);
+		super (map.topleft, map.bottomright);
 		mapName = map.mapName;
 		affine[0] = map.affine[0];
 		affine[1] = map.affine[1];
@@ -115,8 +115,8 @@
 		affine[3]=0; //y2lon
 		topleft.latDec=1; //top
 		topleft.lonDec=0; //left
-		buttomright.latDec = 0; //buttom
-		buttomright.lonDec = 1; //right
+		bottomright.latDec = 0; //bottom
+		bottomright.lonDec = 1; //right
 		affineTopleft.set(topleft);
 		doCalculations();
 		origAffineUpperLeft = new CWPoint(affineTopleft);
@@ -140,8 +140,8 @@
 		topleft.latDec=center.latDec + hight / 2 *pixel2deg; //top
 		topleft.lonDec=center.lonDec - width / 2 *pixel2deghorizontal; //left
 		affineTopleft.set(topleft);
-		buttomright.latDec = center.latDec - hight / 2 *pixel2deg; //buttom
-		buttomright.lonDec = center.lonDec + width / 2 *pixel2deghorizontal; //right
+		bottomright.latDec = center.latDec - hight / 2 *pixel2deg; //bottom
+		bottomright.lonDec = center.lonDec + width / 2 *pixel2deghorizontal; //right
 		fileNameWFL = name;
 		origAffineUpperLeft = new CWPoint(affineTopleft);
 		doCalculations();
@@ -198,9 +198,9 @@
 			line = in.readLine();
 			affineTopleft.lonDec = Common.parseDoubleException(line);
 			line = in.readLine();
-			buttomright.latDec = Common.parseDoubleException(line);
+			bottomright.latDec = Common.parseDoubleException(line);
 			line = in.readLine();
-			buttomright.lonDec = Common.parseDoubleException(line);
+			bottomright.lonDec = Common.parseDoubleException(line);
 			line = in.readLine(); // readLine returns null, if End of File reached
 			if (line != null) coordTrans = Common.parseInt(line);
 			else coordTrans = 0;
@@ -208,7 +208,7 @@
 //			fileName = ""; //mapsPath + thisMap + ".png";
 			mapName = thisMap;
 			in.close();
-			if( !buttomright.isValid() ) {
+			if( !bottomright.isValid() ) {
 				affine[0] = 0; affine[1] = 0; affine[2] = 0; affine[3] = 0; 
 				topleft.makeInvalid();
 				throw (new IOException(MyLocale.getMsg(4301, "Lat/Lon out of range while reading ")+mapsPath + thisMap + ".wfl"));
@@ -279,7 +279,7 @@
 		affine[3] = beta.matrix[2][0];
 		affineTopleft.lonDec = beta.matrix[0][0];
 		coordTrans = epsg_code;
-		buttomright = calcLatLon(imageWidth, imageHeight);
+		bottomright = calcLatLon(imageWidth, imageHeight);
 		doCalculations();
 	}
 
@@ -291,8 +291,8 @@
 	private void doCalculations() throws ArithmeticException {
 		try {
 			topleft.set(calcLatLon(0, 0));
-			center.set((buttomright.latDec + topleft.latDec)/2,(buttomright.lonDec + topleft.lonDec)/2);
-			sizeKm = java.lang.Math.abs((float)center.getDistance(buttomright)) *2;
+			center.set((bottomright.latDec + topleft.latDec)/2,(bottomright.lonDec + topleft.lonDec)/2);
+			sizeKm = java.lang.Math.abs((float)center.getDistance(bottomright)) *2;
 
 			//calculate reverse affine
 			double nenner=(-affine[1]*affine[2]+affine[0]*affine[3]);
@@ -338,8 +338,8 @@
 		towriteB.append(Convert.toString(affine[3])).append("\n");
 		towriteB.append(Convert.toString(affineTopleft.latDec)).append("\n");
 		towriteB.append(Convert.toString(affineTopleft.lonDec)).append("\n");
-		towriteB.append(Convert.toString(buttomright.latDec)).append("\n");
-		towriteB.append(Convert.toString(buttomright.lonDec)).append("\n");
+		towriteB.append(Convert.toString(bottomright.latDec)).append("\n");
+		towriteB.append(Convert.toString(bottomright.lonDec)).append("\n");
 		towriteB.append(((coordTrans == 0 || coordTrans == TransformCoordinates.EPSG_WGS84) ? "" : Convert.toString(coordTrans)+"\n"));
 		String towrite = towriteB.toString();
 		if (digSep.equals(",")) towrite=towrite.replace(',', '.');

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -78,7 +78,7 @@
 	double latinc;
 	double loninc;
 	CWPoint topleft;
-	CWPoint buttomright;
+	CWPoint bottomright;
 	Point tilesSize;
 	float tileScale;
 	boolean fetchOnlyMapWithCache=false;
@@ -173,24 +173,24 @@
 		double metersPerLat = (1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
 		double metersPerLon = metersPerLat * java.lang.Math.cos(center.latDec/180*java.lang.Math.PI);
 		topleft = new CWPoint(center.latDec + (radius / metersPerLat), center.lonDec - (radius / metersPerLon));
-		buttomright = new CWPoint(center.latDec - (radius / metersPerLat), center.lonDec + (radius / metersPerLon));
+		bottomright = new CWPoint(center.latDec - (radius / metersPerLat), center.lonDec + (radius / metersPerLon));
 
-		this.setTiles(topleft, buttomright, scale, size, overlapping);
+		this.setTiles(topleft, bottomright, scale, size, overlapping);
 	}
 
-	public void setTiles(CWPoint toplefti, CWPoint buttomrighti, float scale, Point size, int overlapping) {
-		//if (toplefti.latDec <= buttomrighti.latDec || toplefti.lonDec >= toplefti.lonDec) throw new IllegalArgumentException("topleft must be left and above buttom right");
+	public void setTiles(CWPoint toplefti, CWPoint bottomrighti, float scale, Point size, int overlapping) {
+		//if (toplefti.latDec <= bottomrighti.latDec || toplefti.lonDec >= toplefti.lonDec) throw new IllegalArgumentException("topleft must be left and above bottom right");
 		topleft = new CWPoint(toplefti);
-		buttomright = new CWPoint(buttomrighti);
+		bottomright = new CWPoint(bottomrighti);
 		double metersPerLat = (1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
-		double metersPerLon = metersPerLat * java.lang.Math.cos((toplefti.latDec + buttomright.latDec)/2/180*java.lang.Math.PI);
+		double metersPerLon = metersPerLat * java.lang.Math.cos((toplefti.latDec + bottomright.latDec)/2/180*java.lang.Math.PI);
 		double metersperpixel = currentOnlineMapService.getMetersPerPixel(scale);
 		double pixelsPerLat = metersPerLat / metersperpixel;
 		double pixelsPerLon = metersPerLon / metersperpixel;
 
 		//over all pixelsize without borders
-		double pixelsY = (topleft.latDec - buttomright.latDec) * pixelsPerLat;
-		double pixelsX = -(topleft.lonDec - buttomright.lonDec) * pixelsPerLon ;
+		double pixelsY = (topleft.latDec - bottomright.latDec) * pixelsPerLat;
+		double pixelsX = -(topleft.lonDec - bottomright.lonDec) * pixelsPerLon ;
 
 		//border sizes around given area and overlapping between tiles
 		//int borderX = (int) java.lang.Math.round((float)size.x * (overlapping - 1.0));
@@ -295,8 +295,8 @@
 				}
 				else {
 					Area maparea = wms.CenterScaleToArea(center, scale, pixelsize);
-					CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
-					CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
+					CWPoint bottomleft = new CWPoint (maparea.bottomright.latDec, maparea.topleft.lonDec);
+					CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.bottomright.lonDec);
 
 					String mapProgramPath = wms.versionUrlPart+"/";
 					mapProgramPath = mapProgramPath.replace('/', FileBase.separatorChar);
@@ -316,7 +316,7 @@
 							" \""+FileBase.getProgramDirectory().replace('/',File.separatorChar)+"\\"+wms.serviceTypeUrlPart+"\""+
 							" \""+path.replace('/', File.separatorChar)+imagename+imagetype+"\""+
 							" -mb " +
-							buttomleft.toString(TransformCoordinates.LAT_LON).replace(',',' ') + " " +
+							bottomleft.toString(TransformCoordinates.LAT_LON).replace(',',' ') + " " +
 							topright.toString(TransformCoordinates.LAT_LON).replace(',',' ') +
 							" -w "+pixelsize.x;				
 						Vm.exec(mapProgram, mapProgramParams, 0, true);				
@@ -350,7 +350,7 @@
 								// implicit does apply-ruleset
 							}
 							
-							String koords = buttomleft.toString(TransformCoordinates.LON_LAT) + "," + topright.toString(TransformCoordinates.LON_LAT);
+							String koords = bottomleft.toString(TransformCoordinates.LON_LAT) + "," + topright.toString(TransformCoordinates.LON_LAT);
 							outp.println("bounds-set "+koords);
 							outp.println("zoom-bounds");
 							if ( path.indexOf(':') == 1) {
@@ -621,7 +621,7 @@
 		Area bbox = new Area();
 		double halfdiagonal = Math.sqrt(pixelsize.x * pixelsize.x + pixelsize.y * pixelsize.y)/2 * scale / 1000;
 		bbox.topleft = center.project(-45, halfdiagonal);
-		bbox.buttomright = center.project(135, halfdiagonal);
+		bbox.bottomright = center.project(135, halfdiagonal);
 		return bbox;
 	}
 
@@ -700,12 +700,17 @@
 		imageFormatUrlPart = wms.getProperty("ImageFormatUrlPart", "").trim();
 		stylesUrlPart = wms.getProperty("StylesUrlPart", "").trim();
 		String topleftS = wms.getProperty("BoundingBoxTopLeftWGS84", "").trim();
-		String buttomrightS = wms.getProperty("BoundingBoxButtomRightWGS84", "").trim();
+		String bottomrightS = wms.getProperty("BoundingBoxBottomRightWGS84");
+		//To be backward-compatible with mispelled property-name: Don't remove these lines until all wms-Files has been changed
+		if (bottomrightS == null){
+		    bottomrightS = wms.getProperty("BoundingBoxButtomRightWGS84", "");
+		}
+		bottomrightS.trim();
 		CWPoint topleft = new CWPoint(topleftS);
-		CWPoint buttomright = new CWPoint(buttomrightS);
+		CWPoint bottomright = new CWPoint(bottomrightS);
 		if (!topleft.isValid()) topleft.set(90, -180);
-		if (!buttomright.isValid()) buttomright.set(-90, 180);
-		boundingBox = new Area (topleft, buttomright);
+		if (!bottomright.isValid()) bottomright.set(-90, 180);
+		boundingBox = new Area (topleft, bottomright);
 		minscaleWMS = Common.parseDouble(wms.getProperty("MinScale", "0").trim());
 		maxscaleWMS = Common.parseDouble(wms.getProperty("MaxScale", Convert.toString(java.lang.Double.MAX_VALUE)).trim());
 		minscale = minscaleWMS / Math.sqrt(2); // in WMS scale is measured diagonal while in CacheWolf it is measured vertical
@@ -731,29 +736,29 @@
 	}
 
 	private static final int TOPLEFT_INDEX = 0;
-	private static final int BUTTOMRIGHT_INDEX = 1;
+	private static final int BOTTOMRIGHT_INDEX = 1;
 	private static final int TOPRIGHT_INDEX = 2;
-	private static final int BUTTOMLEFT_INDEX = 3;
+	private static final int BOTTOMLEFT_INDEX = 3;
 	/**
 	 *
 	 * @param maparea
-	 * @return [0] = topleft, [1] = buttomright, [2] = topright, [3] = buttomleft
+	 * @return [0] = topleft, [1] = bottomright, [2] = topright, [3] = bottomleft
 	 */
 	private ProjectedPoint[] getGkArea(Area maparea) {
 		ProjectedPoint[] ret = new ProjectedPoint[4];
-	//	CWPoint topright = new CWPoint(maparea.topleft.latDec, maparea.buttomright.lonDec);
-	//	CWPoint buttomleft = new CWPoint(maparea.buttomright.latDec, maparea.topleft.lonDec);
+	//	CWPoint topright = new CWPoint(maparea.topleft.latDec, maparea.bottomright.lonDec);
+	//	CWPoint bottomleft = new CWPoint(maparea.bottomright.latDec, maparea.topleft.lonDec);
 		int crs = getCrs(maparea.getCenter());
 		// FIXME region is never read. Needed?
 		// int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[crs]);
 		ret[TOPLEFT_INDEX] = TransformCoordinates.wgs84ToEpsg(maparea.topleft, coordinateReferenceSystem[crs]);
-		ret[BUTTOMRIGHT_INDEX] = TransformCoordinates.wgs84ToEpsg(maparea.buttomright, coordinateReferenceSystem[crs]);
-		ret[TOPRIGHT_INDEX] =  ret[BUTTOMRIGHT_INDEX].cloneIt();
-		ret[TOPRIGHT_INDEX].shift(ret[TOPLEFT_INDEX].getNorthing() - ret[BUTTOMRIGHT_INDEX].getNorthing(), 0); // was: new GkPoint(ret[BUTTOMRIGHT_INDEX].getEasting(region), ret[TOPLEFT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
-		ret[BUTTOMLEFT_INDEX] = ret[BUTTOMRIGHT_INDEX].cloneIt();
-		ret[BUTTOMLEFT_INDEX].shift(ret[TOPLEFT_INDEX].getEasting() - ret[BUTTOMRIGHT_INDEX].getEasting(), 1); // was: new GkPoint(ret[TOPLEFT_INDEX].getEasting(region), ret[BUTTOMRIGHT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
+		ret[BOTTOMRIGHT_INDEX] = TransformCoordinates.wgs84ToEpsg(maparea.bottomright, coordinateReferenceSystem[crs]);
+		ret[TOPRIGHT_INDEX] =  ret[BOTTOMRIGHT_INDEX].cloneIt();
+		ret[TOPRIGHT_INDEX].shift(ret[TOPLEFT_INDEX].getNorthing() - ret[BOTTOMRIGHT_INDEX].getNorthing(), 0); // was: new GkPoint(ret[BUTTOMRIGHT_INDEX].getEasting(region), ret[TOPLEFT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
+		ret[BOTTOMLEFT_INDEX] = ret[BOTTOMRIGHT_INDEX].cloneIt();
+		ret[BOTTOMLEFT_INDEX].shift(ret[TOPLEFT_INDEX].getEasting() - ret[BOTTOMRIGHT_INDEX].getEasting(), 1); // was: new GkPoint(ret[TOPLEFT_INDEX].getEasting(region), ret[BUTTOMRIGHT_INDEX].northing, ret[TOPLEFT_INDEX].stripewidth, ret[TOPLEFT_INDEX].lengthOfStripe0);
 		//ret[2] = TransformCoordinates.wgs84ToGermanGk(topright, coordinateReferenceSystem[crs]);
-		//ret[3] = TransformCoordinates.wgs84ToGermanGk(buttomleft, coordinateReferenceSystem[crs]);
+		//ret[3] = TransformCoordinates.wgs84ToGermanGk(bottomleft, coordinateReferenceSystem[crs]);
 		return ret;
 	}
 	public Area CenterScaleToArea(CWPoint center, float scale, Point pixelsize) {
@@ -769,7 +774,7 @@
 			brgk.shift(pixelsize.x * scale / 2, 1);
 			brgk.shift(-pixelsize.y * scale / 2, 0);
 			bbox.topleft = TransformCoordinates.ProjectedEpsgToWgs84(tlgk, epsg); // old: (tlgk, region);
-			bbox.buttomright = TransformCoordinates.ProjectedEpsgToWgs84(brgk, epsg); // TransformCoordinates.GkToWgs84(brgk, region);
+			bbox.bottomright = TransformCoordinates.ProjectedEpsgToWgs84(brgk, epsg); // TransformCoordinates.GkToWgs84(brgk, region);
 		} else {
 			switch (coordinateReferenceSystem[0]) {
 			case TransformCoordinates.EPSG_ETRS89:
@@ -777,9 +782,9 @@
 				bbox.topleft.set(center);
 				bbox.topleft.shift(-pixelsize.x * scale / 2, 1);
 				bbox.topleft.shift(pixelsize.y * scale / 2, 0);
-				bbox.buttomright.set(center);
-				bbox.buttomright.shift(pixelsize.x * scale / 2, 1);
-				bbox.buttomright.shift(-pixelsize.y * scale / 2, 0);
+				bbox.bottomright.set(center);
+				bbox.bottomright.shift(pixelsize.x * scale / 2, 1);
+				bbox.bottomright.shift(-pixelsize.y * scale / 2, 0);
 				break;
 			default: throw new IllegalArgumentException("CenterScaleToArea: epsg: " + coordinateReferenceSystem[0] + " not supported");
 			}
@@ -790,9 +795,9 @@
 	protected String getUrlForBoundingBoxInternal(Area maparea, Point pixelsize) {
 		if (!boundingBox.isOverlapping(maparea)) throw new IllegalArgumentException(MyLocale.getMsg(4822, "area:")+" " + maparea.toString() + MyLocale.getMsg(4823, " not covered by service:")+" " + name + MyLocale.getMsg(4824, ", service area:")+" " + boundingBox.toString());
 		// http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS&VERSION=1.1.0&REQUEST=GetMap&SRS=EPSG:31466&BBOX=2577567.0149,5607721.7566,2578567.0077,5608721.7602&WIDTH=500&HEIGHT=500&LAYERS=Raster:TK25_KMF:Farbkombination&STYLES=&FORMAT=image/png
-		CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
-		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
-		double scaleh = maparea.buttomright.getDistance(buttomleft) * 1000 / pixelsize.x;
+		CWPoint bottomleft = new CWPoint (maparea.bottomright.latDec, maparea.topleft.lonDec);
+		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.bottomright.lonDec);
+		double scaleh = maparea.bottomright.getDistance(bottomleft) * 1000 / pixelsize.x;
 		double scalev = maparea.topleft.getDistance(topright) * 1000 / pixelsize.y;
 		double scale = Math.sqrt(scaleh * scaleh + scalev * scalev); // meters per pixel measured diagonal
 		if ( scale < minscaleWMS || scale > maxscaleWMS ) throw new IllegalArgumentException(MyLocale.getMsg(4825, "scale")+" " + scale / Math.sqrt(2)+ MyLocale.getMsg(4826, " not supported by online map service, supported scale range:")+" " + minscale + " - " + maxscale + MyLocale.getMsg(4827, " (measured in meters per pixel vertically)"));
@@ -802,18 +807,18 @@
 		if (localsystem > 0) {
 			crs = getCrs(maparea.getCenter());
 			ProjectedPoint[] gk = getGkArea(maparea);
-			buttomleft = TransformCoordinates.ProjectedEpsgToWgs84(gk[BUTTOMLEFT_INDEX], coordinateReferenceSystem[crs]);
+			bottomleft = TransformCoordinates.ProjectedEpsgToWgs84(gk[BOTTOMLEFT_INDEX], coordinateReferenceSystem[crs]);
 			topright = TransformCoordinates.ProjectedEpsgToWgs84(gk[TOPRIGHT_INDEX], coordinateReferenceSystem[crs]);
-			bbox += TransformCoordinates.wgs84ToEpsg(buttomleft, coordinateReferenceSystem[crs]).toString(2, "", ",");
+			bbox += TransformCoordinates.wgs84ToEpsg(bottomleft, coordinateReferenceSystem[crs]).toString(2, "", ",");
 			bbox += "," + TransformCoordinates.wgs84ToEpsg(topright, coordinateReferenceSystem[crs]).toString(2, "", ",");
 		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84)
-			bbox += buttomleft.toString(TransformCoordinates.LON_LAT)  + "," + topright.toString(TransformCoordinates.LON_LAT);
+			bbox += bottomleft.toString(TransformCoordinates.LON_LAT)  + "," + topright.toString(TransformCoordinates.LON_LAT);
 		else throw new IllegalArgumentException(MyLocale.getMsg(4828, "Coordinate system not supported by cachewolf:")+" " + coordinateReferenceSystem.toString());
 		String ret = MainUrl + "SERVICE=WMS" + "&"+ versionUrlPart + "&" + requestUrlPart + "&" +
 		coordinateReferenceSystemUrlPart[crs] + "&" + bbox +
 		"&WIDTH=" + pixelsize.x + "&HEIGHT=" + pixelsize.y + "&" +
 		layersUrlPart + "&" + stylesUrlPart + "&" + imageFormatUrlPart;
-		Global.getPref().log(ret + " WGS84: Buttom left: " + buttomleft.toString(TransformCoordinates.DD) + "top right: " + topright.toString(TransformCoordinates.DD));
+		Global.getPref().log(ret + " WGS84: Bottom left: " + bottomleft.toString(TransformCoordinates.DD) + "top right: " + topright.toString(TransformCoordinates.DD));
 		return ret;
 	}
 
@@ -829,7 +834,7 @@
 		int crsindex = 0;
 		if (coordinateReferenceSystem.length > 1) {
 			int ls = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]);
-			ProjectedPoint gkbl = TransformCoordinates.wgs84ToLocalsystem(p, ls); // TODO: think / read about what to do if buttom left and top right are not in the same Gau?-Kr?ger stripe?
+			ProjectedPoint gkbl = TransformCoordinates.wgs84ToLocalsystem(p, ls); // TODO: think / read about what to do if bottom left and top right are not in the same Gau?-Kr?ger stripe?
 			int wantepsg = gkbl.getEpsgCode();
 			for (crsindex = 0; crsindex < coordinateReferenceSystem.length; crsindex++) {
 				if (coordinateReferenceSystem[crsindex] == wantepsg) break;
@@ -851,42 +856,42 @@
 		Vector georef = new Vector(4);
 
 		// calculate a rectangle in the according coordinate reference system
-		CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
-		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
+		CWPoint bottomleft = new CWPoint (maparea.bottomright.latDec, maparea.topleft.lonDec);
+		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.bottomright.lonDec);
 		CWPoint topleft = new CWPoint(maparea.topleft);
-		CWPoint buttomright = new CWPoint(maparea.buttomright);
-		double metersperpixalhorizontal = ( buttomright.getDistance(buttomleft) + topleft.getDistance(topright))/2 * 1000 / pixelsize.x;
-		double metersperpixalvertical = ( buttomright.getDistance(topright) + topleft.getDistance(buttomleft))/2 * 1000 / pixelsize.y;
+		CWPoint bottomright = new CWPoint(maparea.bottomright);
+		double metersperpixalhorizontal = ( bottomright.getDistance(bottomleft) + topleft.getDistance(topright))/2 * 1000 / pixelsize.x;
+		double metersperpixalvertical = ( bottomright.getDistance(topright) + topleft.getDistance(bottomleft))/2 * 1000 / pixelsize.y;
 		int region = TransformCoordinates.getLocalProjectionSystem(coordinateReferenceSystem[0]);
 		if ( region > 0) {
 			ProjectedPoint[] gk = getGkArea(maparea);
 			// bounding box in WMS is defined around the pixels, not exactly on the pixels --> the bounding box must be reduced on all edges by half a pixel
 			gk[TOPLEFT_INDEX].shift(metersperpixalhorizontal / 2, 1);
 			gk[TOPLEFT_INDEX].shift(-metersperpixalvertical / 2, 0);
-			gk[BUTTOMRIGHT_INDEX].shift(-metersperpixalhorizontal / 2, 1);
-			gk[BUTTOMRIGHT_INDEX].shift(metersperpixalvertical / 2, 0);
+			gk[BOTTOMRIGHT_INDEX].shift(-metersperpixalhorizontal / 2, 1);
+			gk[BOTTOMRIGHT_INDEX].shift(metersperpixalvertical / 2, 0);
 			gk[TOPRIGHT_INDEX].shift(-metersperpixalhorizontal / 2, 1);
 			gk[TOPRIGHT_INDEX].shift(-metersperpixalvertical / 2, 0);
-			gk[BUTTOMLEFT_INDEX].shift(metersperpixalhorizontal / 2, 1);
-			gk[BUTTOMLEFT_INDEX].shift(metersperpixalvertical / 2, 0);
+			gk[BOTTOMLEFT_INDEX].shift(metersperpixalhorizontal / 2, 1);
+			gk[BOTTOMLEFT_INDEX].shift(metersperpixalvertical / 2, 0);
 
 			topleft.set(gk[TOPLEFT_INDEX].getNorthing(), gk[TOPLEFT_INDEX].getEasting());
-			buttomright.set(gk[BUTTOMRIGHT_INDEX].getNorthing(), gk[BUTTOMRIGHT_INDEX].getEasting());
+			bottomright.set(gk[BOTTOMRIGHT_INDEX].getNorthing(), gk[BOTTOMRIGHT_INDEX].getEasting());
 			topright.set(gk[TOPRIGHT_INDEX].getNorthing(), gk[TOPRIGHT_INDEX].getEasting());
-			buttomleft.set(gk[BUTTOMLEFT_INDEX].getNorthing(), gk[BUTTOMLEFT_INDEX].getEasting());
+			bottomleft.set(gk[BOTTOMLEFT_INDEX].getNorthing(), gk[BOTTOMLEFT_INDEX].getEasting());
 		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84) {
 			// bounding box in WMS is defined around the pixels, not exactly on the pixels --> the bounding box must be reduced on all edges by half a pixel
 			topleft.shift(metersperpixalhorizontal / 2, 1);
 			topleft.shift(-metersperpixalvertical / 2, 0);
-			buttomright.shift(-metersperpixalhorizontal, 1);
-			buttomright.shift(metersperpixalhorizontal, 0);
-			topright = new CWPoint (topleft.latDec, buttomright.lonDec);
-			buttomleft = new CWPoint (buttomright.latDec, topleft.lonDec);
+			bottomright.shift(-metersperpixalhorizontal, 1);
+			bottomright.shift(metersperpixalhorizontal, 0);
+			topright = new CWPoint (topleft.latDec, bottomright.lonDec);
+			bottomleft = new CWPoint (bottomright.latDec, topleft.lonDec);
 		} else throw new IllegalArgumentException(MyLocale.getMsg(4831, "getMapInfoObject: Coordinate system not supported by cachewolf:")+" " + coordinateReferenceSystem);
 		georef.add(new GCPoint(topleft, new Point(0, 0)));
-		georef.add(new GCPoint(buttomright, new Point(pixelsize.x, pixelsize.y)));
+		georef.add(new GCPoint(bottomright, new Point(pixelsize.x, pixelsize.y)));
 		georef.add(new GCPoint(topright, new Point(pixelsize.x, 0)));
-		georef.add(new GCPoint(buttomleft, new Point(0, pixelsize.y)));
+		georef.add(new GCPoint(bottomleft, new Point(0, pixelsize.y)));
 
 		MapInfoObject ret = new MapInfoObject();
 		ret.evalGCP(georef, pixelsize.x, pixelsize.y, coordinateReferenceSystem[getCrs(maparea.getCenter())]);

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -328,7 +328,7 @@
 				progressBox.close(0);
 				return;
 			}
-			mapLoader.setTiles(surArea.topleft, surArea.buttomright, scale, size, overlapping );
+			mapLoader.setTiles(surArea.topleft, surArea.bottomright, scale, size, overlapping );
 		} else
 		{ // calculate from centre point an radius
 			mapLoader.setTiles(center, radius * 1000, scale, size, overlapping);

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/MapsList.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -300,8 +300,8 @@
 	 * if no map includes both it returns null
 	 * @param if more than one map includes topleft and bottomright than the one will
 	 * be returned which has its center nearest to topleft. If you have gps-pos and goto-pos
-	 * as topleft and buttomright use gps as topleft.
-	 * if topleft is really topleft or if it is buttomright is not relevant.
+	 * as topleft and bottomright use gps as topleft.
+	 * if topleft is really topleft or if it is bottomright is not relevant.
 	 */
 
 	public final MapInfoObject getMapForArea(CWPoint topleft, CWPoint bottomright){
@@ -527,9 +527,9 @@
 	}
 */
 	/** for determining if a new map should be downloaded
-	public boolean isInAmap(CWPoint topleft, CWPoint buttomright) {
-		if (!latRangeList.isInRange(topleft.latDec) || !latRangeList.isInRange(buttomright.latDec)) ||
-			!lonRangeList.inInRange(topleft.lonDec) || !lonRangeList.isInRange(buttomright.lonDec)
+	public boolean isInAmap(CWPoint topleft, CWPoint bottomright) {
+		if (!latRangeList.isInRange(topleft.latDec) || !latRangeList.isInRange(bottomright.latDec)) ||
+			!lonRangeList.inInRange(topleft.lonDec) || !lonRangeList.isInRange(boxsttomright.lonDec)
 			return false;
 	}
 	 */

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -1201,10 +1201,10 @@
 			return;
 		}
 		//A map was found, but it does not contain the previously calculated center
-		if (!(bestMap.buttomright.latDec <= centerPoint.latDec && centerPoint.latDec <= bestMap.topleft.latDec)){
+		if (!(bestMap.bottomright.latDec <= centerPoint.latDec && centerPoint.latDec <= bestMap.topleft.latDec)){
 			return;
 		}
-		if (!(bestMap.topleft.lonDec <= centerPoint.lonDec && centerPoint.lonDec <= bestMap.buttomright.lonDec)){
+		if (!(bestMap.topleft.lonDec <= centerPoint.lonDec && centerPoint.lonDec <= bestMap.bottomright.lonDec)){
 			return;
 		}
 		//Pfeffer got an NPE in the following if-statement. I think the image-filename has got not the correct extension.
@@ -1223,7 +1223,7 @@
 				Point mapposint = bestMap.calcMapXY(posCircle.where);
 				mapPos.x = posCircleX - mapposint.x;
 				mapPos.y = posCircleY - mapposint.y;
-				Point mapDimension = bestMap.calcMapXY(bestMap.buttomright);
+				Point mapDimension = bestMap.calcMapXY(bestMap.bottomright);
 				blackArea = new Rect (mapPos.x, mapPos.y, mapDimension.x, mapDimension.y);
 				//Are there any white areas left?
 				calculateRectangles(blackArea, r, rectangles);
@@ -1582,7 +1582,7 @@
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4215, "Keine  Caches mit H???ckchen ausgew???hlt"), FormBase.OKB)).execute();
 			return;
 		}
-		MapInfoObject newmap = maps.getMapForArea(sur.topleft, sur.buttomright);
+		MapInfoObject newmap = maps.getMapForArea(sur.topleft, sur.bottomright);
 		if (newmap == null ) { // no map that includs all caches is available -> load map with lowest resolution
 			Object [] s = getRectForMapChange(posCircle.where);
 			CWPoint cll = (CWPoint) s[0];
@@ -1594,8 +1594,8 @@
 				Object [] s = getRectForMapChange(posCircle.where);
 			//	CWPoint cll = (CWPoint) s[0];
 				Rect screen = (Rect) s[1];
-				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.buttomright.lonDec) * 1000 / (screen.width-15)); // 15 for the size of the cache image
-				float neededscaley = (float) (sur.topleft.getDistance(sur.buttomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height-15)); // 15 for the size of the cache image
+				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.bottomright.lonDec) * 1000 / (screen.width-15)); // 15 for the size of the cache image
+				float neededscaley = (float) (sur.topleft.getDistance(sur.bottomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height-15)); // 15 for the size of the cache image
 				newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
 				newmap.zoom(newmap.scale * newmap.zoomFactor / (neededscalex > neededscaley ? neededscalex : neededscaley), 0, 0);
 				forceMapLoad = true;

Modified: trunk/src/CacheWolf/navi/TransformCoordinates.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinates.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/TransformCoordinates.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -162,12 +162,12 @@
 	private static final TransformParameters GB_ITALIAN_SARDINIA_TO_WGS84 =  new TransformParameters(-168.6, -34.0, 38.6, 0.374, 0.679, 1.379, 9.48, HAYFORD1909);
 	private static final Area ITALY_SARDINIA = new Area(new CWPoint(42, 6), new CWPoint(38, 11));
 	private static final Area ITALY_SARDINIA_GK = new Area(wgs84ToEpsg(ITALY_SARDINIA.topleft, EPSG_ITALIAN_GB_EW1).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB),
-			wgs84ToEpsg(ITALY_SARDINIA.buttomright, EPSG_ITALIAN_GB_EW1).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB));
+			wgs84ToEpsg(ITALY_SARDINIA.bottomright, EPSG_ITALIAN_GB_EW1).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB));
 
 	private static final TransformParameters GB_ITALIAN_SICILIA_TO_WGS84 =  new TransformParameters(-50.2, -50.4, 84.8, 0.690, 2.012, -0.459, 28.08, HAYFORD1909);
 	private static final Area ITALY_SICILIA = new Area(new CWPoint(39, 12), new CWPoint(36.3, 15.6));
 	private static final Area ITALY_SICILIA_GK = new Area(wgs84ToEpsg(ITALY_SICILIA.topleft, EPSG_ITALIAN_GB_EW2).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB),
-			wgs84ToEpsg(ITALY_SICILIA.buttomright, EPSG_ITALIAN_GB_EW2).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB));
+			wgs84ToEpsg(ITALY_SICILIA.bottomright, EPSG_ITALIAN_GB_EW2).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB));
 
 	// see also http://hal.gis.univie.ac.at/karto/lehr/fachbereiche/geoinfo/givi0304/tutorials/ersteschritte/projectionen.htm#ParMGIWGS84 
 	// taken from taken from http://www.crs-geo.eu/crseu/EN/Home/homepage__node.html?__nnn=true click on "national CRS" -> Austria -> AT (translation *-1 as of 11-8-2009)

Modified: trunk/src/CacheWolf/navi/touchControls/MovingMapControlSettings.java
===================================================================
--- trunk/src/CacheWolf/navi/touchControls/MovingMapControlSettings.java	2011-03-15 08:11:00 UTC (rev 2959)
+++ trunk/src/CacheWolf/navi/touchControls/MovingMapControlSettings.java	2011-03-19 15:45:34 UTC (rev 2960)
@@ -84,7 +84,7 @@
 	public static final String BUTTON_ATTR_FROM_BOTTOM = "fromBottom";
 	/**
 	 * define when this button is visible. Contains a list of rolenames. Delimiter is '+'. If the role name starts with
-	 * '!' the buttom is shown if this role is inactive [(!)String+(!)String...] Example visibleIf="menu+!zoom" button
+	 * '!' the button is shown if this role is inactive [(!)String+(!)String...] Example visibleIf="menu+!zoom" button
 	 * is visible if role "menu" is active and role "zoom" is inactive.
 	 */
 	public static final String BUTTON_ATTR_VISIBILITY = "visibleIf";



From apreisser at mail.berlios.de  Sat Mar 19 04:45:55 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 19 Mar 2011 04:45:55 PM +0100
Subject: [Cachewolf-svn] r2961 - trunk/res_noewe/webmapservices
Message-ID: <20110319154555.B24864801E2@sheep.berlios.de>

Author: apreisser
Date: 2011-03-19 16:45:55 +0100 (Sat, 19 Mar 2011)
New Revision: 2961

Modified:
   trunk/res_noewe/webmapservices/OSMCycleMap.wms
   trunk/res_noewe/webmapservices/OSMMapnik.wms
   trunk/res_noewe/webmapservices/OSMOsmarender.wms
   trunk/res_noewe/webmapservices/at-1_p.wms
   trunk/res_noewe/webmapservices/at-3_p.wms
   trunk/res_noewe/webmapservices/at-3_t50.wms
   trunk/res_noewe/webmapservices/at_p.wms
   trunk/res_noewe/webmapservices/at_t.wms
   trunk/res_noewe/webmapservices/cz-jc_t25.wms
   trunk/res_noewe/webmapservices/cz-jm_p.wms
   trunk/res_noewe/webmapservices/cz-jm_t25.wms
   trunk/res_noewe/webmapservices/cz-vy_p.wms
   trunk/res_noewe/webmapservices/cz-vy_t10.wms
   trunk/res_noewe/webmapservices/cz-vy_t25.wms
   trunk/res_noewe/webmapservices/cz-vy_t50.wms
   trunk/res_noewe/webmapservices/de-bb_t10.wms
   trunk/res_noewe/webmapservices/de-bb_t25.wms
   trunk/res_noewe/webmapservices/de-bw_p.wms
   trunk/res_noewe/webmapservices/de-bw_t50.wms
   trunk/res_noewe/webmapservices/de-by_p.wms
   trunk/res_noewe/webmapservices/de-by_t50.wms
   trunk/res_noewe/webmapservices/de-he_p.wms
   trunk/res_noewe/webmapservices/de-he_t25.wms
   trunk/res_noewe/webmapservices/de-mv_photo.wms
   trunk/res_noewe/webmapservices/de-mv_topo_10.wms
   trunk/res_noewe/webmapservices/de-mv_topo_25.wms
   trunk/res_noewe/webmapservices/de-mv_topo_50.wms
   trunk/res_noewe/webmapservices/de-ni_p.wms
   trunk/res_noewe/webmapservices/de-ni_t100.wms
   trunk/res_noewe/webmapservices/de-ni_t100_lv.wms
   trunk/res_noewe/webmapservices/de-ni_t25.wms
   trunk/res_noewe/webmapservices/de-nw_p.wms
   trunk/res_noewe/webmapservices/de-nw_t10.wms
   trunk/res_noewe/webmapservices/de-nw_t25.wms
   trunk/res_noewe/webmapservices/de-nw_t50.wms
   trunk/res_noewe/webmapservices/de-rp_p.wms
   trunk/res_noewe/webmapservices/de-rp_t25.wms
   trunk/res_noewe/webmapservices/de-rp_t50.wms
   trunk/res_noewe/webmapservices/de-sh_t.wms
   trunk/res_noewe/webmapservices/de-sn_p.wms
   trunk/res_noewe/webmapservices/de-sn_t.wms
   trunk/res_noewe/webmapservices/de-st_p.wms
   trunk/res_noewe/webmapservices/de-st_t10.wms
   trunk/res_noewe/webmapservices/de-st_t50.wms
   trunk/res_noewe/webmapservices/de-th_t25.wms
   trunk/res_noewe/webmapservices/de_t2500.wms
   trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
   trunk/res_noewe/webmapservices/es-an_p.wms
   trunk/res_noewe/webmapservices/es-an_t.wms
   trunk/res_noewe/webmapservices/es-an_t1.wms
   trunk/res_noewe/webmapservices/es-ar_p.wms
   trunk/res_noewe/webmapservices/es-ar_t.wms
   trunk/res_noewe/webmapservices/es-cn_p.wms
   trunk/res_noewe/webmapservices/es-cn_t.wms
   trunk/res_noewe/webmapservices/es-cn_ts.wms
   trunk/res_noewe/webmapservices/es_p.wms
   trunk/res_noewe/webmapservices/es_t25.wms
   trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms
   trunk/res_noewe/webmapservices/fr_t25.wms
   trunk/res_noewe/webmapservices/fr_t5.wms
   trunk/res_noewe/webmapservices/fr_t50.wms
   trunk/res_noewe/webmapservices/hu-gs_t25.wms
   trunk/res_noewe/webmapservices/hu-va_t25.wms
   trunk/res_noewe/webmapservices/it-52_t10.wms
   trunk/res_noewe/webmapservices/it-52_t10bw.wms
   trunk/res_noewe/webmapservices/it-88_m.wms
   trunk/res_noewe/webmapservices/it-88_p.wms
   trunk/res_noewe/webmapservices/it-88_t10.wms
   trunk/res_noewe/webmapservices/it_p.wms
   trunk/res_noewe/webmapservices/it_t100.wms
   trunk/res_noewe/webmapservices/it_t25.wms
   trunk/res_noewe/webmapservices/jp-t.wms
   trunk/res_noewe/webmapservices/no-no_t.wms
   trunk/res_noewe/webmapservices/pl_p.wms
   trunk/res_noewe/webmapservices/pl_t50.wms
   trunk/res_noewe/webmapservices/pt_t500.wms
   trunk/res_noewe/webmapservices/region_at_hu_cz.wms
   trunk/res_noewe/webmapservices/sk-bl_t25.wms
   trunk/res_noewe/webmapservices/sk-ta_t25.wms
   trunk/res_noewe/webmapservices/us_p.wms
   trunk/res_noewe/webmapservices/us_t.wms
Log:
Typo in fieldname corrected

Modified: trunk/res_noewe/webmapservices/OSMCycleMap.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMCycleMap.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/OSMCycleMap.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -19,7 +19,7 @@
 ImageFormatUrlPart:FORMAT=image/png
 # BBox the osm-file covers
 BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
-BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+BoundingBoxBottomRightWGS84: S 90.0000 E 180.0000
 MinScale:   0
 MaxScale:   1000
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/OSMMapnik.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMMapnik.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/OSMMapnik.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -19,7 +19,7 @@
 ImageFormatUrlPart:FORMAT=image/png
 # BBox the osm-file covers
 BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
-BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+BoundingBoxBottomRightWGS84: S 90.0000 E 180.0000
 MinScale:   0
 MaxScale:   1000
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/OSMOsmarender.wms
===================================================================
--- trunk/res_noewe/webmapservices/OSMOsmarender.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/OSMOsmarender.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -19,7 +19,7 @@
 ImageFormatUrlPart:FORMAT=image/png
 # BBox the osm-file covers
 BoundingBoxTopLeftWGS84: N 90.0000 W 180.0000
-BoundingBoxButtomRightWGS84: S 90.0000 E 180.0000
+BoundingBoxBottomRightWGS84: S 90.0000 E 180.0000
 MinScale:   0
 MaxScale:   1000
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/at-1_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/at-1_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/at-1_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -58,7 +58,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 48.1886 E 15.9545
-BoundingBoxButtomRightWGS84: N 46.7613 E 17.2342
+BoundingBoxBottomRightWGS84: N 46.7613 E 17.2342
 #BBox_Mitte: N 47.47496561765 E 16.5943567439
 #MinScale:   0
 #MaxScale:   45

Modified: trunk/res_noewe/webmapservices/at-3_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/at-3_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/at-3_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -41,7 +41,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
-BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
+BoundingBoxBottomRightWGS84:   N 47.297627 E 17.481360
 #BBox_Mitte: N 48.205281 E 15.862571
 MinScale:   0
 MaxScale:   45

Modified: trunk/res_noewe/webmapservices/at-3_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/at-3_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/at-3_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -39,7 +39,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
-BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
+BoundingBoxBottomRightWGS84:   N 47.297627 E 17.481360
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/at_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/at_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/at_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -32,7 +32,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
-BoundingBoxButtomRightWGS84:   N 46.357433 E 17.202733
+BoundingBoxBottomRightWGS84:   N 46.357433 E 17.202733
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/at_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/at_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/at_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
-BoundingBoxButtomRightWGS84:   N 46.357433 E 17.202733
+BoundingBoxBottomRightWGS84:   N 46.357433 E 17.202733
 MinScale:   1
 MaxScale:   20
 RecommendedScale:   1 2 5 10

Modified: trunk/res_noewe/webmapservices/cz-jc_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-jc_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/cz-jc_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -84,14 +84,14 @@
 ImageFormatUrlPart:FORMAT=image/png
 #Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
-#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BoundingBoxBottomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
 #real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
-#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#BoundingBoxBottomRightWGS84: N 46.72608 E 18.08012
 #S?db?hmen
 BoundingBoxTopLeftWGS84: N 49.62233 E 13.51730
-BoundingBoxButtomRightWGS84: N 48.54843 E 15.61450
+BoundingBoxBottomRightWGS84: N 48.54843 E 15.61450
 #MinScale:   1
 #MaxScale:   26
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/cz-jm_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-jm_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/cz-jm_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -91,7 +91,7 @@
 ImageFormatUrlPart:FORMAT=image/jpeg
 #manuell
 BoundingBoxTopLeftWGS84: N 49.634341 E 15.50975
-BoundingBoxButtomRightWGS84: N 48.614016 E 17.666016
+BoundingBoxBottomRightWGS84: N 48.614016 E 17.666016
 #MinScale:   0
 #MaxScale:   45
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/cz-jm_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-jm_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/cz-jm_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -84,14 +84,14 @@
 ImageFormatUrlPart:FORMAT=image/png
 #Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
-#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BoundingBoxBottomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
 #Real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
-#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#BoundingBoxBottomRightWGS84: N 46.72608 E 18.08012
 #S?dm?hren
 BoundingBoxTopLeftWGS84: N 49.634619 E 15.531836
-BoundingBoxButtomRightWGS84: N 48.609817 E 17.657948
+BoundingBoxBottomRightWGS84: N 48.609817 E 17.657948
 #MinScale:   1
 #MaxScale:   26
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/cz-vy_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/cz-vy_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -33,9 +33,9 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 #BoundingBoxTopLeftWGS84: N 49.9457 E 14.7989
-#BoundingBoxButtomRightWGS84: N 48.8765 E 16.5340
+#BoundingBoxBottomRightWGS84: N 48.8765 E 16.5340
 BoundingBoxTopLeftWGS84: N 49.9841 E 14.7605
-BoundingBoxButtomRightWGS84: N 48.7959 E 16.5811
+BoundingBoxBottomRightWGS84: N 48.7959 E 16.5811
 #BBox_Mitte: N 49.41110624465 E 15.6664623227
 #MinScale:   0
 #MaxScale:   45

Modified: trunk/res_noewe/webmapservices/cz-vy_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_t10.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/cz-vy_t10.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -33,9 +33,9 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 #BoundingBoxTopLeftWGS84: N 49.9457 E 14.7989
-#BoundingBoxButtomRightWGS84: N 48.8765 E 16.5340
+#BoundingBoxBottomRightWGS84: N 48.8765 E 16.5340
 BoundingBoxTopLeftWGS84: N 49.9841 E 14.7605
-BoundingBoxButtomRightWGS84: N 48.7959 E 16.5811
+BoundingBoxBottomRightWGS84: N 48.7959 E 16.5811
 #BBox_Mitte: N 49.41110624465 E 15.6664623227
 #MinScale:   0
 #MaxScale:   45

Modified: trunk/res_noewe/webmapservices/cz-vy_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/cz-vy_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -84,14 +84,14 @@
 ImageFormatUrlPart:FORMAT=image/png
 #Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
-#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BoundingBoxBottomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
 #real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
-#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#BoundingBoxBottomRightWGS84: N 46.72608 E 18.08012
 #Hochland
 BoundingBoxTopLeftWGS84: N 49.86521 E 14.886475
-BoundingBoxButtomRightWGS84: N 48.932583 E 16.42529
+BoundingBoxBottomRightWGS84: N 48.932583 E 16.42529
 #MinScale:   1
 #MaxScale:   26
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/cz-vy_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/cz-vy_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/cz-vy_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -33,9 +33,9 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 #BoundingBoxTopLeftWGS84: N 49.9457 E 14.7989
-#BoundingBoxButtomRightWGS84: N 48.8765 E 16.5340
+#BoundingBoxBottomRightWGS84: N 48.8765 E 16.5340
 BoundingBoxTopLeftWGS84: N 49.9841 E 14.7605
-BoundingBoxButtomRightWGS84: N 48.7959 E 16.5811
+BoundingBoxBottomRightWGS84: N 48.7959 E 16.5811
 #BBox_Mitte: N 49.41110624465 E 15.6664623227
 #MinScale:   0
 #MaxScale:   45

Modified: trunk/res_noewe/webmapservices/de-bb_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-bb_t10.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-bb_t10.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -21,7 +21,7 @@
 StylesUrlPart:   STYLES=2
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 53.5000 E 11.7000
-BoundingBoxButtomRightWGS84: N 51.3000 E 14.8000
+BoundingBoxBottomRightWGS84: N 51.3000 E 14.8000
 MinScale:   0.1
 MaxScale:   11
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/de-bb_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-bb_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-bb_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -20,7 +20,7 @@
 StylesUrlPart:     STYLES=2
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 53.5000 E 11.7000
-BoundingBoxButtomRightWGS84: N 51.3000 E 14.8000
+BoundingBoxBottomRightWGS84: N 51.3000 E 14.8000
 MinScale:   0.1
 MaxScale:   25
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/de-bw_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-bw_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-bw_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 50.0000 E 7.6000
-BoundingBoxButtomRightWGS84: N 47.4000 E 10.0000
+BoundingBoxBottomRightWGS84: N 47.4000 E 10.0000
 MinScale:   1
 MaxScale:   700
 RecommendedScale:    1 8

Modified: trunk/res_noewe/webmapservices/de-bw_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-bw_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-bw_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 50.0000 E 7.6000
-BoundingBoxButtomRightWGS84: N 47.4000 E 10.0000
+BoundingBoxBottomRightWGS84: N 47.4000 E 10.0000
 MinScale:   0.3
 MaxScale:   700
 RecommendedScale:    5 8 4 2 1

Modified: trunk/res_noewe/webmapservices/de-by_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-by_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-by_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -17,7 +17,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 50.6269 E 8.8929
-BoundingBoxButtomRightWGS84: N 47.0828 E 13.9782
+BoundingBoxBottomRightWGS84: N 47.0828 E 13.9782
 MinScale:   2.82
 MaxScale:   11
 RecommendedScale:    3 4 5

Modified: trunk/res_noewe/webmapservices/de-by_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-by_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-by_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -17,7 +17,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 50.6269 E 8.8929
-BoundingBoxButtomRightWGS84: N 47.0828 E 13.9782
+BoundingBoxBottomRightWGS84: N 47.0828 E 13.9782
 MinScale:   1
 MaxScale:   15
 RecommendedScale:    3 5 7

Modified: trunk/res_noewe/webmapservices/de-he_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-he_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-he_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.6697 E 7.6991
-BoundingBoxButtomRightWGS84: N 49.3455 E 11.3986
+BoundingBoxBottomRightWGS84: N 49.3455 E 11.3986
 MinScale:   0.4
 MaxScale:   3
 RecommendedScale:    1

Modified: trunk/res_noewe/webmapservices/de-he_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-he_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-he_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -16,7 +16,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.6697 E 7.6991
-BoundingBoxButtomRightWGS84: N 49.3455 E 11.3986
+BoundingBoxBottomRightWGS84: N 49.3455 E 11.3986
 MinScale:   2
 MaxScale:   16
 RecommendedScale:    3 7 10

Modified: trunk/res_noewe/webmapservices/de-mv_photo.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-mv_photo.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-mv_photo.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:	STYLES=
 ImageFormatUrlPart:	FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+BoundingBoxBottomRightWGS84:	N 53.0392 E 14.477
 MinScale:	0.000374177136322228
 MaxScale:	37.4180878093591
 RecommendedScale:	0.4

Modified: trunk/res_noewe/webmapservices/de-mv_topo_10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-mv_topo_10.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-mv_topo_10.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:	STYLES=
 ImageFormatUrlPart:	FORMAT=image/png
 BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+BoundingBoxBottomRightWGS84:	N 53.0392 E 14.477
 MinScale:	0.186714391024792
 MaxScale:	11.2256882668032
 RecommendedScale:	1.0

Modified: trunk/res_noewe/webmapservices/de-mv_topo_25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-mv_topo_25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-mv_topo_25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:	STYLES=
 ImageFormatUrlPart:	FORMAT=image/png
 BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+BoundingBoxBottomRightWGS84:	N 53.0392 E 14.477
 MinScale:	1.87051150447482
 MaxScale:	18.7092309932477
 RecommendedScale:	2.5

Modified: trunk/res_noewe/webmapservices/de-mv_topo_50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-mv_topo_50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-mv_topo_50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:	STYLES=
 ImageFormatUrlPart:	FORMAT=image/png
 BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
+BoundingBoxBottomRightWGS84:	N 53.0392 E 14.477
 MinScale:	5.6122828676971
 MaxScale:	28.0636594013034
 RecommendedScale:	5.0

Modified: trunk/res_noewe/webmapservices/de-ni_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-ni_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -33,7 +33,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 53.898485 E 6.600296
-BoundingBoxButtomRightWGS84: N 51.265165 E 11.665345
+BoundingBoxBottomRightWGS84: N 51.265165 E 11.665345
 MinScale:   0
 MaxScale:   2.772396
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/de-ni_t100.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t100.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-ni_t100.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -16,7 +16,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 54.9403 E 6.1804
-BoundingBoxButtomRightWGS84: N 50.5028 E 13.6833
+BoundingBoxBottomRightWGS84: N 50.5028 E 13.6833
 MinScale:   6.76160460880501
 MaxScale:   52.82503600628914
 RecommendedScale:   15 5 10 20

Modified: trunk/res_noewe/webmapservices/de-ni_t100_lv.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t100_lv.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-ni_t100_lv.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -28,7 +28,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 54.5549 E 5.8986
-BoundingBoxButtomRightWGS84: N 50.6539 E 12.6239
+BoundingBoxBottomRightWGS84: N 50.6539 E 12.6239
 #BBox_Mitte: N 52.6044 E 9.261245
 MinScale:   0.7
 MaxScale:   14000

Modified: trunk/res_noewe/webmapservices/de-ni_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-ni_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-ni_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -35,7 +35,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 54.001848 E 6.579380
-BoundingBoxButtomRightWGS84: N 51.372735 E 11.734608
+BoundingBoxBottomRightWGS84: N 51.372735 E 11.734608
 MinScale:   0
 MaxScale:   100
 RecommendedScale:   2,5

Modified: trunk/res_noewe/webmapservices/de-nw_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-nw_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-nw_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 52.5391 E 5.7591
-BoundingBoxButtomRightWGS84: N 50.3040 E 9.4718
+BoundingBoxBottomRightWGS84: N 50.3040 E 9.4718
 #BBox_Mitte: N 51.421555 E 7.6154425
 MinScale:   0
 MaxScale:   1000

Modified: trunk/res_noewe/webmapservices/de-nw_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-nw_t10.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-nw_t10.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 52.6020 E 5.7250
-BoundingBoxButtomRightWGS84: N 50.1506 E 9.5315
+BoundingBoxBottomRightWGS84: N 50.1506 E 9.5315
 #BBox_Mitte: N 51.3763 E 7.628265
 MinScale:   0
 MaxScale:   1000

Modified: trunk/res_noewe/webmapservices/de-nw_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-nw_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-nw_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 52.5850 E 5.7043
-BoundingBoxButtomRightWGS84: N 50.2178 E 9.5219
+BoundingBoxBottomRightWGS84: N 50.2178 E 9.5219
 #BBox_Mitte: N 51.4014 E 7.61312
 MinScale:   0.5
 MaxScale:   18

Modified: trunk/res_noewe/webmapservices/de-nw_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-nw_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-nw_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 52.5850 E 5.7043
-BoundingBoxButtomRightWGS84: N 50.2178 E 9.5219
+BoundingBoxBottomRightWGS84: N 50.2178 E 9.5219
 #BBox_Mitte: N 51.4014 E 7.61312
 MinScale:   2
 MaxScale:   36

Modified: trunk/res_noewe/webmapservices/de-rp_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-rp_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-rp_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -21,7 +21,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 51.0000 E 6.0000
-BoundingBoxButtomRightWGS84: N 48.8000 E 8.7000
+BoundingBoxBottomRightWGS84: N 48.8000 E 8.7000
 MinScale:   0.5
 MaxScale:   24.95
 RecommendedScale:	0.4

Modified: trunk/res_noewe/webmapservices/de-rp_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-rp_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-rp_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -21,7 +21,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.0000 E 6.0000
-BoundingBoxButtomRightWGS84: N 48.8000 E 8.7000
+BoundingBoxBottomRightWGS84: N 48.8000 E 8.7000
 MinScale:   1
 MaxScale:   50
 RecommendedScale:   2,5

Modified: trunk/res_noewe/webmapservices/de-rp_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-rp_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-rp_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -21,7 +21,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.0000 E 6.0000
-BoundingBoxButtomRightWGS84: N 48.8000 E 8.7000
+BoundingBoxBottomRightWGS84: N 48.8000 E 8.7000
 MinScale:   1
 MaxScale:   50
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/de-sh_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sh_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-sh_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -121,7 +121,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 55.08 E 8.156
-BoundingBoxButtomRightWGS84: N 53.34 E 11.33
+BoundingBoxBottomRightWGS84: N 53.34 E 11.33
 MinScale:   0
 MaxScale:   150
 RecommendedScale:    1 2.5 5 10 16

Modified: trunk/res_noewe/webmapservices/de-sn_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sn_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-sn_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -15,7 +15,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 51.8592 E 11.7651
-BoundingBoxButtomRightWGS84: N 50.0294 E 15.1358
+BoundingBoxBottomRightWGS84: N 50.0294 E 15.1358
 #BBox_Mitte: N 50.9443 E 13.45045
 MinScale:   0.2
 MaxScale:   10

Modified: trunk/res_noewe/webmapservices/de-sn_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-sn_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-sn_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.8592 E 11.7651
-BoundingBoxButtomRightWGS84: N 50.0294 E 15.1358
+BoundingBoxBottomRightWGS84: N 50.0294 E 15.1358
 #BBox_Mitte: N 50.9443 E 13.45045
 MinScale:   0.5
 MaxScale:   70

Modified: trunk/res_noewe/webmapservices/de-st_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-st_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-st_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -75,7 +75,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 53.2226 E 10.5012
-BoundingBoxButtomRightWGS84: N 50.5272 E 13.4957
+BoundingBoxBottomRightWGS84: N 50.5272 E 13.4957
 #BBox_Mitte: N 51.874924375 E 11.9984684985
 MinScale:   0
 MaxScale:   25

Modified: trunk/res_noewe/webmapservices/de-st_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-st_t10.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-st_t10.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -75,7 +75,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 53.2226 E 10.5012
-BoundingBoxButtomRightWGS84: N 50.5272 E 13.4957
+BoundingBoxBottomRightWGS84: N 50.5272 E 13.4957
 #BBox_Mitte: N 51.874924375 E 11.9984684985
 MinScale:   0
 MaxScale:   12

Modified: trunk/res_noewe/webmapservices/de-st_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-st_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-st_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -75,7 +75,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 53.2226 E 10.5012
-BoundingBoxButtomRightWGS84: N 50.5272 E 13.4957
+BoundingBoxBottomRightWGS84: N 50.5272 E 13.4957
 #BBox_Mitte: N 51.874924375 E 11.9984684985
 MinScale:   5
 MaxScale:   90

Modified: trunk/res_noewe/webmapservices/de-th_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-th_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de-th_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -349,7 +349,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.7 E 10.3
-BoundingBoxButtomRightWGS84: N 50.1 E 12.7
+BoundingBoxBottomRightWGS84: N 50.1 E 12.7
 MinScale:   1
 MaxScale:   12
 RecommendedScale:   2,5

Modified: trunk/res_noewe/webmapservices/de_t2500.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_t2500.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de_t2500.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 55.7319 E 4.6186
-BoundingBoxButtomRightWGS84: N 45.9690 E 16.7118
+BoundingBoxBottomRightWGS84: N 45.9690 E 16.7118
 MinScale:   50
 MaxScale:   350
 RecommendedScale:    150

Modified: trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -53,7 +53,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 55.1087 E 5.2905
-BoundingBoxButtomRightWGS84: N 47.1503 E 15.3245
+BoundingBoxBottomRightWGS84: N 47.1503 E 15.3245
 #BBox_Mitte: N 51.1295 E 10.30751
 #MinScale:   0
 #MaxScale:   45

Modified: trunk/res_noewe/webmapservices/es-an_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-an_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-an_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
-BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+BoundingBoxBottomRightWGS84:   N 35.947 W 1.602
 MinScale:   0
 MaxScale:   49.8902848429637
 RecommendedScale:   1.000

Modified: trunk/res_noewe/webmapservices/es-an_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-an_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-an_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
-BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+BoundingBoxBottomRightWGS84:   N 35.947 W 1.602
 MinScale:   0
 MaxScale:   49.8902848429637
 RecommendedScale:   5.000

Modified: trunk/res_noewe/webmapservices/es-an_t1.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-an_t1.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-an_t1.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
-BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+BoundingBoxBottomRightWGS84:   N 35.947 W 1.602
 MinScale:   0
 MaxScale:   49.8902848429637
 RecommendedScale:   5.000

Modified: trunk/res_noewe/webmapservices/es-ar_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-ar_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-ar_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -27,7 +27,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
-BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
+BoundingBoxBottomRightWGS84:   N 39.813 E 0.805
 MinScale:   0
 MaxScale:   72
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/es-ar_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-ar_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-ar_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -27,7 +27,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
-BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
+BoundingBoxBottomRightWGS84:   N 39.813 E 0.805
 MinScale:   0
 MaxScale:   72
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/es-cn_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-cn_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-cn_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 29.8305 W 18.3099
-BoundingBoxButtomRightWGS84: N 26.1839 W 13.1373
+BoundingBoxBottomRightWGS84: N 26.1839 W 13.1373
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/es-cn_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-cn_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-cn_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
-BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
+BoundingBoxBottomRightWGS84:   N 26.1839 W 13.137
 MinScale:   1.49671
 MaxScale:   174.0000
 RecommendedScale:   5.000

Modified: trunk/res_noewe/webmapservices/es-cn_ts.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-cn_ts.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es-cn_ts.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
-BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
+BoundingBoxBottomRightWGS84:   N 26.1839 W 13.137
 MinScale:   0
 MaxScale:   2500.0000
 RecommendedScale:   5.000

Modified: trunk/res_noewe/webmapservices/es_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -15,7 +15,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 45.2863 W 18.1621
-BoundingBoxButtomRightWGS84: N 21.8992 E 6.2893
+BoundingBoxBottomRightWGS84: N 21.8992 E 6.2893
 MinScale:   0
 MaxScale:   10
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/es_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/es_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/es_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -13,7 +13,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 44.3814 W 18.3276
-BoundingBoxButtomRightWGS84: N 27.0611 E 6.6826
+BoundingBoxBottomRightWGS84: N 27.0611 E 6.6826
 MinScale:   2
 MaxScale:   80
 RecommendedScale:    2.5 5 15 30 

Modified: trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms
===================================================================
--- trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/eu_t_osm_wheregroup.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -59,7 +59,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 74.1000 W 10.4000
-BoundingBoxButtomRightWGS84: N 35.7000 E 43.0000
+BoundingBoxBottomRightWGS84: N 35.7000 E 43.0000
 #BBox_Mitte: N 54.9 E 16.3
 MinScale: 0.6
 MaxScale: 99.99

Modified: trunk/res_noewe/webmapservices/fr_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/fr_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -48,7 +48,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
-BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+BoundingBoxBottomRightWGS84: N 41.1632 E 10.8783
 #MinScale:   0
 #MaxScale:   45
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/fr_t5.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t5.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/fr_t5.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -48,7 +48,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
-BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+BoundingBoxBottomRightWGS84: N 41.1632 E 10.8783
 #MinScale:   0
 #MaxScale:   45
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/fr_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/fr_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -48,7 +48,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
-BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+BoundingBoxBottomRightWGS84: N 41.1632 E 10.8783
 #MinScale:   0
 #MaxScale:   45
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/hu-gs_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/hu-gs_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/hu-gs_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -84,14 +84,14 @@
 ImageFormatUrlPart:FORMAT=image/png
 #Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
-#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BoundingBoxBottomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
 #real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
-#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#BoundingBoxBottomRightWGS84: N 46.72608 E 18.08012
 #HU Gyor-Moson-Sopron
 BoundingBoxTopLeftWGS84: N 48.027490 E 16.421143
-BoundingBoxButtomRightWGS84: N 47.392132 E 17.953978
+BoundingBoxBottomRightWGS84: N 47.392132 E 17.953978
 #MinScale:   1
 #MaxScale:   26
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/hu-va_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/hu-va_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/hu-va_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -84,14 +84,14 @@
 ImageFormatUrlPart:FORMAT=image/png
 #Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
-#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BoundingBoxBottomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
 #real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
-#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#BoundingBoxBottomRightWGS84: N 46.72608 E 18.08012
 #HU Vas
 BoundingBoxTopLeftWGS84: N 47.46660 E 16.11368
-BoundingBoxButtomRightWGS84: N 46.72205 E 17.33420
+BoundingBoxBottomRightWGS84: N 46.72205 E 17.33420
 #MinScale:   1
 #MaxScale:   26
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/it-52_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/it-52_t10.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it-52_t10.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -284,7 +284,7 @@
 StylesUrlPart:   STYLES=Default,Default,Default,Default,Default,Default,Default,Default
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 44.500805 E 9.642548
-BoundingBoxButtomRightWGS84:   N 42.168745 E 12.462359
+BoundingBoxBottomRightWGS84:   N 42.168745 E 12.462359
 MinScale:   0
 MaxScale:   70
 # maxscale 14.14214

Modified: trunk/res_noewe/webmapservices/it-52_t10bw.wms
===================================================================
--- trunk/res_noewe/webmapservices/it-52_t10bw.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it-52_t10bw.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -283,7 +283,7 @@
 StylesUrlPart:   STYLES=Default,Default,Default,Default,Default,Default,Default,Default
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 44.500805 E 9.642548
-BoundingBoxButtomRightWGS84:   N 42.168745 E 12.462359
+BoundingBoxBottomRightWGS84:   N 42.168745 E 12.462359
 MinScale:   0
 MaxScale:   71
 #Scale 2 and 3 are scaled versions of scale 1. Scale 5 and 6 are scaled versions of scale 4

Modified: trunk/res_noewe/webmapservices/it-88_m.wms
===================================================================
--- trunk/res_noewe/webmapservices/it-88_m.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it-88_m.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -12,7 +12,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 41.400307 E 7.964019
-BoundingBoxButtomRightWGS84:   N 38.792131 E 10.022418
+BoundingBoxBottomRightWGS84:   N 38.792131 E 10.022418
 MinScale:   1
 MaxScale:   3
 #RecommendedScale:   1.000 sonst kann man die Topodaten nicht lesen bzw es werden keine Fotos geladen

Modified: trunk/res_noewe/webmapservices/it-88_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/it-88_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it-88_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -12,7 +12,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 41.400307 E 7.964019
-BoundingBoxButtomRightWGS84:   N 38.792131 E 10.022418
+BoundingBoxBottomRightWGS84:   N 38.792131 E 10.022418
 MinScale:   4
 MaxScale:   6
 # RecommendedScale:   1.000

Modified: trunk/res_noewe/webmapservices/it-88_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/it-88_t10.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it-88_t10.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -22,7 +22,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 41.400307 E 7.964019
-BoundingBoxButtomRightWGS84:   N 38.792131 E 10.022418
+BoundingBoxBottomRightWGS84:   N 38.792131 E 10.022418
 MinScale:   1
 MaxScale:   3
 #RecommendedScale:   1 - 2.000 bei gr?sserer Skalierung wird es un?bersichtlich

Modified: trunk/res_noewe/webmapservices/it_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/it_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -16,7 +16,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 48.0000 E 6.0000
-BoundingBoxButtomRightWGS84: N 36.0000 E 19.0000
+BoundingBoxBottomRightWGS84: N 36.0000 E 19.0000
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/it_t100.wms
===================================================================
--- trunk/res_noewe/webmapservices/it_t100.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it_t100.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -16,7 +16,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 48.0000 E 6.0000
-BoundingBoxButtomRightWGS84: N 36.0000 E 19.0000
+BoundingBoxBottomRightWGS84: N 36.0000 E 19.0000
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   10

Modified: trunk/res_noewe/webmapservices/it_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/it_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/it_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -19,7 +19,7 @@
 # .jpg appears white in sun-vm --> use .gif, that works on both VMs 
 ImageFormatUrlPart:FORMAT=image/gif
 BoundingBoxTopLeftWGS84: N 48.0000 E 6.0000
-BoundingBoxButtomRightWGS84: N 36.0000 E 19.0000
+BoundingBoxBottomRightWGS84: N 36.0000 E 19.0000
 # min and maxScale found by testing the server (pfeffer 1-10-2009)
 MinScale:   0
 MaxScale:   6.6

Modified: trunk/res_noewe/webmapservices/jp-t.wms
===================================================================
--- trunk/res_noewe/webmapservices/jp-t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/jp-t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -30,7 +30,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 45.576199 E 122.521907
-BoundingBoxButtomRightWGS84: N 20.424949 E 145.888782
+BoundingBoxBottomRightWGS84: N 20.424949 E 145.888782
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/no-no_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/no-no_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/no-no_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -165,7 +165,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 71.8912 W 2.5599
-BoundingBoxButtomRightWGS84: N 57.0881 E 33.0199
+BoundingBoxBottomRightWGS84: N 57.0881 E 33.0199
 #BBox_Mitte: N 64.48965 E 15.229995
 MinScale:   0
 MaxScale:   1000

Modified: trunk/res_noewe/webmapservices/pl_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/pl_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/pl_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 54.8793 E 10.0579
-BoundingBoxButtomRightWGS84: N 48.3726 E 28.4862
+BoundingBoxBottomRightWGS84: N 48.3726 E 28.4862
 #BBox_Center: N 51.6259298143288 E 19.2720480387164
 MinScale:   0
 MaxScale:   24

Modified: trunk/res_noewe/webmapservices/pl_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/pl_t50.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/pl_t50.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -37,7 +37,7 @@
 
 # pfeffer entered here the bounding box of Poland
 BoundingBoxTopLeftWGS84: N 54.84 E 14.121686
-BoundingBoxButtomRightWGS84: N 48.9996 E 24.1488
+BoundingBoxBottomRightWGS84: N 48.9996 E 24.1488
 MinScale:   1
 MaxScale:   11
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/pt_t500.wms
===================================================================
--- trunk/res_noewe/webmapservices/pt_t500.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/pt_t500.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -14,7 +14,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
 BoundingBoxTopLeftWGS84: N 42.2787 W 10.1943
-BoundingBoxButtomRightWGS84: N 36.7636 W 5.71067
+BoundingBoxBottomRightWGS84: N 36.7636 W 5.71067
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/region_at_hu_cz.wms
===================================================================
--- trunk/res_noewe/webmapservices/region_at_hu_cz.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/region_at_hu_cz.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -32,7 +32,7 @@
 StylesUrlPart:   STYLES=
 ImageFormatUrlPart:   FORMAT=image/png
 BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
-BoundingBoxButtomRightWGS84:   N 46.357433 E 17.202733
+BoundingBoxBottomRightWGS84:   N 46.357433 E 17.202733
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   1

Modified: trunk/res_noewe/webmapservices/sk-bl_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/sk-bl_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/sk-bl_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -84,14 +84,14 @@
 ImageFormatUrlPart:FORMAT=image/png
 #Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
-#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BoundingBoxBottomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
 #real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
-#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#BoundingBoxBottomRightWGS84: N 46.72608 E 18.08012
 #SK Bratislava
 BoundingBoxTopLeftWGS84: N 48.659222 E 16.819382
-BoundingBoxButtomRightWGS84: N 48.009865 E 17.517636
+BoundingBoxBottomRightWGS84: N 48.009865 E 17.517636
 #MinScale:   1
 #MaxScale:   26
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/sk-ta_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/sk-ta_t25.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/sk-ta_t25.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -84,14 +84,14 @@
 ImageFormatUrlPart:FORMAT=image/png
 #Server
 #BoundingBoxTopLeftWGS84: N 51.2574 E 7.8974
-#BoundingBoxButtomRightWGS84: N 43.9529 E 24.7863
+#BoundingBoxBottomRightWGS84: N 43.9529 E 24.7863
 #BBox_Mitte: N 47.60515 E 16.341865
 #real
 #BoundingBoxTopLeftWGS84: N 49.85157 E 13.44451
-#BoundingBoxButtomRightWGS84: N 46.72608 E 18.08012
+#BoundingBoxBottomRightWGS84: N 46.72608 E 18.08012
 #SK Tyrnauer
 BoundingBoxTopLeftWGS84: N 48.882582 E 16.927528
-BoundingBoxButtomRightWGS84: N 47.75606 E 18.08583
+BoundingBoxBottomRightWGS84: N 47.75606 E 18.08583
 #MinScale:   1
 #MaxScale:   26
 RecommendedScale:   2.5

Modified: trunk/res_noewe/webmapservices/us_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/us_p.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/us_p.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -15,7 +15,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 71.5500 W 168.6700
-BoundingBoxButtomRightWGS84: N 17.8400 W 65.1500
+BoundingBoxBottomRightWGS84: N 17.8400 W 65.1500
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   5

Modified: trunk/res_noewe/webmapservices/us_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/us_t.wms	2011-03-19 15:45:34 UTC (rev 2960)
+++ trunk/res_noewe/webmapservices/us_t.wms	2011-03-19 15:45:55 UTC (rev 2961)
@@ -15,7 +15,7 @@
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 71.5500 W 168.6700
-BoundingBoxButtomRightWGS84: N 17.8400 W 65.1500
+BoundingBoxBottomRightWGS84: N 17.8400 W 65.1500
 MinScale:   0
 MaxScale:   45
 RecommendedScale:   5



From engywuck at mail.berlios.de  Sun Mar 20 11:24:48 2011
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 20 Mar 2011 11:24:48 AM +0100
Subject: [Cachewolf-svn] r2962 - trunk/src/CacheWolf
Message-ID: <20110320102448.37EDE4805B8@sheep.berlios.de>

Author: engywuck
Date: 2011-03-20 11:24:47 +0100 (Sun, 20 Mar 2011)
New Revision: 2962

Modified:
   trunk/src/CacheWolf/Filter.java
Log:
Fixing "filter for attribute" bug when looking for "at least" one attribute. (http://www.geoclub.de/viewtopic.php?f=40&t=52144)

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2011-03-19 15:45:55 UTC (rev 2961)
+++ trunk/src/CacheWolf/Filter.java	2011-03-20 10:24:47 UTC (rev 2962)
@@ -483,9 +483,9 @@
 			        }
 		        } else if (attributesChoice == 1) {
 			        // OR-condition:
-			        if ((chAtts[0] & attributesPattern[0]) == 0 ||
-				        	(chAtts[1] & attributesPattern[1]) == 0 ||
-				        	(chAtts[2] & attributesPattern[2]) == 0 ||
+			        if ((chAtts[0] & attributesPattern[0]) == 0 &&
+				        	(chAtts[1] & attributesPattern[1]) == 0 &&
+				        	(chAtts[2] & attributesPattern[2]) == 0 &&
 				        	(chAtts[3] & attributesPattern[3]) == 0 )
 				        {
 				        cacheFiltered = true;



From apreisser at mail.berlios.de  Mon Mar 21 07:43:59 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Mon, 21 Mar 2011 07:43:59 PM +0100
Subject: [Cachewolf-svn] r2963 - trunk/src/CacheWolf/navi
Message-ID: <20110321184359.4AA974801A1@sheep.berlios.de>

Author: apreisser
Date: 2011-03-21 19:43:58 +0100 (Mon, 21 Mar 2011)
New Revision: 2963

Modified:
   trunk/src/CacheWolf/navi/Track.java
   trunk/src/CacheWolf/navi/TrackOverlay.java
Log:
Track reimplemented as RingBuffer.
Track will not be cleared on overflow, instead first entry will be deleted.

Modified: trunk/src/CacheWolf/navi/Track.java
===================================================================
--- trunk/src/CacheWolf/navi/Track.java	2011-03-20 10:24:47 UTC (rev 2962)
+++ trunk/src/CacheWolf/navi/Track.java	2011-03-21 18:43:58 UTC (rev 2963)
@@ -1,81 +1,92 @@
-    /*
-    GNU General Public License
-    CacheWolf is a software for PocketPC, Win and Linux that
-    enables paperless caching.
-    It supports the sites geocaching.com and opencaching.de
-
-    Copyright (C) 2006  CacheWolf development team
-    See http://developer.berlios.de/projects/cachewolf/
-    for more information.
-    Contact: 	bilbowolf at users.berlios.de
-    			kalli at users.berlios.de
-
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; version 2 of the License.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-    */
 package CacheWolf.navi;
 
 import ewe.fx.Color;
+import ewe.io.BufferedWriter;
+import ewe.io.FileWriter;
+import ewe.io.IOException;
+import ewe.io.PrintWriter;
+import ewe.ui.MessageBox;
+import ewe.util.Utils;
 
 public class Track {
 	public Color trackColor;
-	public TrackPoint TrackPoints[];
-	public int num;
+	private TrackPoint trackPoints[];
+    private int index;
+	private int num;
 	
-	public Track(Color f) {
+	public Track(Color f, int trackSize) {
 		trackColor = f;
-		TrackPoints = new TrackPoint[5000];
+		trackPoints = new TrackPoint[trackSize];
 		num = 0;
+        index = 0;
 	}
-/*===== add is currently not used	
+
+        public Track (Color f){
+            this(f, 5000);
+        }
+
+        public Track (){
+            this (new Color (0xff,0,0));
+        }
+
 	public void add(double lat, double lon) {
-		TrackPoints[num] = new TrackPoint(lat, lon);
-		num++;
+		add(new TrackPoint(lat, lon));
 	}
-=====*/	
+
 	/**
-	 * throws IndexOutOfBoundsException when track is full
 	 */
 	public void add(TrackPoint t) { 
-		if (TrackPoints == null || t == null) return;
-		TrackPoints[num] = new TrackPoint(t);
+		if (t == null) return;
+		
+		trackPoints[index] = new TrackPoint(t);
+        index++;
+        if (index >= trackPoints.length) index = 0;
 		num++;
+        if (num >= trackPoints.length) num = trackPoints.length;
 	}
-/*===== loadTrack/saveTrack are currently not used
+        
+        /**
+         * returns number of Point in this track
+         */
+        public int size(){
+            return num;
+        }
+
+        /**
+          * returns the i.th point in this track
+          */
+        public TrackPoint get (int i){
+            //The array has never been filled, so first position is 0:
+            if (num < trackPoints.length) return trackPoints[i];
+            //Once filled, the least inserted position is marked by index
+            int tmpIndex = (index+i) % trackPoints.length;
+            return trackPoints[tmpIndex];
+        }
+
 	public void loadTrack(String filename){ // TODO untested!
 		byte [] all = ewe.sys.Vm.readResource(null,filename);
 		if (all == null) return; // TODO error handling
 		num = Utils.readInt(all, 0, 4);
 		for (int i=0; i<=num; i++){
-			TrackPoints[i].latDec = Double.longBitsToDouble(Utils.readLong(all, (i*2)*8 + 4));
-			TrackPoints[i].lonDec = Double.longBitsToDouble(Utils.readLong(all, (i*2+1)*8 + 4));
+			trackPoints[i].latDec = Double.longBitsToDouble(Utils.readLong(all, (i*2)*8 + 4));
+			trackPoints[i].lonDec = Double.longBitsToDouble(Utils.readLong(all, (i*2+1)*8 + 4));
 		}
 	}
 	
-	public void saveTrack(String filename){  // TODO untested!
-	//ByteArray ba=new ByteArray();
-	byte[] ba = new byte[8*2*num+4]; // 8 bytes is one double int has size 4
-	Utils.writeInt(num, ba, 0, 4);
-	for (int i=0; i<=num; i++){
-		Utils.writeLong(Double.doubleToLongBits(TrackPoints[i].latDec), ba, (i*2)*8 + 4);
-		Utils.writeLong(Double.doubleToLongBits(TrackPoints[i].lonDec), ba, (i*2+1)*8 + 4);
+	public void saveTrack(String filename) { // TODO untested!
+		// ByteArray ba=new ByteArray();
+		byte[] ba = new byte[8 * 2 * num + 4]; // 8 bytes is one double int has
+												// size 4
+		Utils.writeInt(num, ba, 0, 4);
+		for (int i = 0; i <= num; i++) {
+			Utils.writeLong(Double.doubleToLongBits(trackPoints[i].latDec), ba, (i * 2) * 8 + 4);
+			Utils.writeLong(Double.doubleToLongBits(trackPoints[i].lonDec), ba, (i * 2 + 1) * 8 + 4);
+		}
+		try {
+			PrintWriter outp = new PrintWriter(new BufferedWriter(new FileWriter(filename)));
+			outp.print(ba.toString());
+		} catch (IOException e) {
+			(new MessageBox("Error", "Error reading trackfile:\n" + e.toString(), MessageBox.OKB)).execute();
+		}
 	}
-	try{
-		PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(filename)));
-		outp.print(ba.toString());
-	}catch (IOException e) {
-		(new MessageBox("Error", "Error reading trackfile:\n"+e.toString(), MessageBox.OKB)).execute();}
-	}
-=====*/
-
 }

Modified: trunk/src/CacheWolf/navi/TrackOverlay.java
===================================================================
--- trunk/src/CacheWolf/navi/TrackOverlay.java	2011-03-20 10:24:47 UTC (rev 2962)
+++ trunk/src/CacheWolf/navi/TrackOverlay.java	2011-03-21 18:43:58 UTC (rev 2963)
@@ -107,9 +107,9 @@
 		int tri, i;
 		Track tr;
 		int numberOfTracks = tracks.size();
-		int numberOfPoints = ((Track)tracks.get(numberOfTracks - 1)).num;
+		int numberOfPoints = ((Track)tracks.get(numberOfTracks - 1)).size();
 		if (numberOfTracks > 1){
-			numberOfPoints += (numberOfTracks - 1) * ((Track)tracks.get(0)).num;
+			numberOfPoints += (numberOfTracks - 1) * ((Track)tracks.get(0)).size();
 		}
 		int n = 0;
 		
@@ -117,13 +117,13 @@
 			tr = (Track)tracks.get(tri);
 			//draw.setPen(new Pen((Color) tr.trackColor,Pen.SOLID,3));
 			draw.setColor(tr.trackColor);
-			if (tr.num > 0) {
-				for (i=0; i < tr.num; i++) {
+			if (tr.size() > 0) {
+				for (i=0; i < tr.size(); i++) {
 					n++;
 					if  ((numberOfPoints - n > 5*60) && ((n & 1) == 0)) continue;
 					if  ((numberOfPoints - n > 15*60) && ((n & 2) == 0)) continue;
 					if  ((numberOfPoints - n > 30*60) && ((n & 4) == 0)) continue;
-					paintPoint(tr.trackColor, tr.TrackPoints[i]);
+					paintPoint(tr.trackColor, tr.get(i));
 				}
 			}
 		}
@@ -195,7 +195,7 @@
 	public void paintLastAddedPoint(Track tr) { 
 		//draw.setPen(new Pen((Color) tr.trackColor,Pen.SOLID,3));
 		draw.setColor(tr.trackColor);
-		if (paintPoint(tr.trackColor, tr.TrackPoints[tr.num-1])) notOnThisOverlaySince = 0;
+		if (paintPoint(tr.trackColor, tr.get(tr.size()-1))) notOnThisOverlaySince = 0;
 		else notOnThisOverlaySince++;
 		if (notOnThisOverlaySince > FIXATE_IF_NO_PIXELS_NUM) { // zur Performanceverbesserung: wenn in den letzten 60 Updates keines mehr f?r dieses Overlay dabei war, Overlay Pixels fest schreiben, damit doDraw entlastet wird.
 			fixate();



From apreisser at mail.berlios.de  Sat Mar 26 01:24:26 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 26 Mar 2011 01:24:26 PM +0100
Subject: [Cachewolf-svn] r2964 - trunk/src/CacheWolf/navi
Message-ID: <20110326122426.9FFCB4807E1@sheep.berlios.de>

Author: apreisser
Date: 2011-03-26 13:24:26 +0100 (Sat, 26 Mar 2011)
New Revision: 2964

Modified:
   trunk/src/CacheWolf/navi/Track.java
Log:
Track: loadTrack and saveTrack didn't work after changing to ringbuffer, but these methods are still declared to be untestet!

Modified: trunk/src/CacheWolf/navi/Track.java
===================================================================
--- trunk/src/CacheWolf/navi/Track.java	2011-03-21 18:43:58 UTC (rev 2963)
+++ trunk/src/CacheWolf/navi/Track.java	2011-03-26 12:24:26 UTC (rev 2964)
@@ -5,6 +5,7 @@
 import ewe.io.FileWriter;
 import ewe.io.IOException;
 import ewe.io.PrintWriter;
+import ewe.sys.Vm;
 import ewe.ui.MessageBox;
 import ewe.util.Utils;
 
@@ -64,23 +65,23 @@
         }
 
 	public void loadTrack(String filename){ // TODO untested!
-		byte [] all = ewe.sys.Vm.readResource(null,filename);
+		byte [] all = Vm.readResource(null,filename);
 		if (all == null) return; // TODO error handling
-		num = Utils.readInt(all, 0, 4);
-		for (int i=0; i<=num; i++){
-			trackPoints[i].latDec = Double.longBitsToDouble(Utils.readLong(all, (i*2)*8 + 4));
-			trackPoints[i].lonDec = Double.longBitsToDouble(Utils.readLong(all, (i*2+1)*8 + 4));
+		int numOfPoints = Utils.readInt(all, 0, 4);
+		for (int i=0; i<=numOfPoints; i++){
+			TrackPoint point = new TrackPoint();
+			point.latDec = Double.longBitsToDouble(Utils.readLong(all, (i*2)*8 + 4));
+			point.lonDec = Double.longBitsToDouble(Utils.readLong(all, (i*2+1)*8 + 4));
+			add (point);
 		}
 	}
 	
 	public void saveTrack(String filename) { // TODO untested!
-		// ByteArray ba=new ByteArray();
-		byte[] ba = new byte[8 * 2 * num + 4]; // 8 bytes is one double int has
-												// size 4
-		Utils.writeInt(num, ba, 0, 4);
-		for (int i = 0; i <= num; i++) {
-			Utils.writeLong(Double.doubleToLongBits(trackPoints[i].latDec), ba, (i * 2) * 8 + 4);
-			Utils.writeLong(Double.doubleToLongBits(trackPoints[i].lonDec), ba, (i * 2 + 1) * 8 + 4);
+		byte[] ba = new byte[8 * 2 * size() + 4]; // 8 bytes is one double int has size 4
+		Utils.writeInt(size(), ba, 0, 4);
+		for (int i = 0; i <= size(); i++) {
+			Utils.writeLong(Double.doubleToLongBits(get(i).latDec), ba, (i * 2) * 8 + 4);
+			Utils.writeLong(Double.doubleToLongBits(get(i).lonDec), ba, (i * 2 + 1) * 8 + 4);
 		}
 		try {
 			PrintWriter outp = new PrintWriter(new BufferedWriter(new FileWriter(filename)));



From araber95 at mail.berlios.de  Tue Mar 29 10:31:06 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 29 Mar 2011 10:31:06 AM +0200
Subject: [Cachewolf-svn] r2965 - trunk/src/CacheWolf
Message-ID: <20110329083106.C2E45480AA1@sheep.berlios.de>

Author: araber95
Date: 2011-03-29 10:31:06 +0200 (Tue, 29 Mar 2011)
New Revision: 2965

Modified:
   trunk/src/CacheWolf/GeoCodeGui.java
   trunk/src/CacheWolf/GeocoderOsm.java
Log:
make coordinate search work again (with nominatim). see http://www.geoclub.de/viewtopic.php?f=40&t=53817&sid=0d4534a9ff10c743aee19e825812cb80

Modified: trunk/src/CacheWolf/GeoCodeGui.java
===================================================================
--- trunk/src/CacheWolf/GeoCodeGui.java	2011-03-26 12:24:26 UTC (rev 2964)
+++ trunk/src/CacheWolf/GeoCodeGui.java	2011-03-29 08:31:06 UTC (rev 2965)
@@ -25,10 +25,7 @@
     */
 package CacheWolf;
 
-import ewe.io.IOException;
-import ewe.sys.Handle;
-import ewe.sys.HandleStoppedException;
-import ewe.sys.mThread;
+import ewe.sys.Vm;
 import ewe.ui.CellConstants;
 import ewe.ui.CellPanel;
 import ewe.ui.ControlEvent;
@@ -40,8 +37,8 @@
 import ewe.ui.mButton;
 import ewe.ui.mInput;
 import ewe.ui.mLabel;
+import ewe.ui.mList;
 import ewe.util.Vector;
-import ewesoft.xml.sax.SAXException;
 
 /**
  * Class for entering an address and convert it to lat/lon
@@ -55,12 +52,12 @@
 	CWPoint coordInp = new CWPoint();
 	CellPanel topLinePanel = new CellPanel();
 	CellPanel mainPanel = new CellPanel();
-	HtmlDisplay foundTxt;
+	// HtmlDisplay foundTxt;
+	mList choice;
 	int exitKeys[]={75009};
 
 	Vector geoCodeAnsw;
 	String searchText;
-	Handle[] fetchHandle = new Handle[1];
 
 	public GeoCodeGui()
 	{
@@ -76,10 +73,9 @@
 		this.addLast(topLinePanel,CellConstants.STRETCH, CellConstants.FILL | CellConstants.WEST);
 
 		// Description of found sites
-		foundTxt     = new HtmlDisplay();
-		foundTxt.setPreferredSize(200, 200);
-		ScrollBarPanel sbp = new MyScrollBarPanel(foundTxt, 0);
-		sbp.setClientConstraints(ScrollBarPanel.HCONTRACT|ScrollBarPanel.HCONTRACT);
+		choice=new mList(8,50,false);
+		ScrollBarPanel sbp = new MyScrollBarPanel(choice, 0);
+		sbp.setOptions(MyScrollBarPanel.NeverShowVerticalScrollers);
 		mainPanel.addLast(sbp, CellConstants.STRETCH, CellConstants.FILL | CellConstants.WEST);
 
 		// Buttons for cancel and apply
@@ -95,60 +91,29 @@
 
 	public void onEvent(Event ev){
 
-		// Ensure that the Enter key moves to the appropriate field
-		// for Checkboxes and Choice controls this is done via the exitKeys
-		// For input fields we use the wantReturn field
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if (ev.target == searchBtn ){
-				foundTxt.setHtml(MyLocale.getMsg(7306, "searching..."));
-				// only insert "," if city AND street is set
-				searchText = streetInp.text.trim();
-				if (searchText.length() > 0) {
-					if (cityInp.text.trim().length() > 0) searchText = searchText + ","+cityInp.text;
-				} else searchText = cityInp.text;
-
-				mThread thrdfetch = 
-					new mThread() {
-					public void run() {
-						try {
-							fetchHandle[0] = null;
-							geoCodeAnsw = GeocoderOsm.geocode(searchText, fetchHandle);
-						} catch (IOException e) {
-							geoCodeAnsw = new Vector();
-							geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), "IOExecption"));
-						} catch (SAXException e) {
-							geoCodeAnsw = new Vector();
-							geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), "SAXException"));
-						} catch (HandleStoppedException ie) {
-							geoCodeAnsw = new Vector();
-							if (fetchHandle[0].stopReason == 4321)
-								geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7307, "Canceled by user")));
-							else geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7308, "Could not connect")));
-						} catch (InterruptedException ie) {
-							geoCodeAnsw = new Vector();
-							if (fetchHandle[0].stopReason == 4321)
-								geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7307, "Canceled by user")));
-							else geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), MyLocale.getMsg(7308, "Could not connect")));
-
-						}
-						// foundTxt.startHtml();
-						if (geoCodeAnsw.size() == 0) foundTxt.setHtml("nothing found");
-						else {
-							GeocodeAnswer ga = (GeocodeAnswer)geoCodeAnsw.get(0);
-							foundTxt.setHtml(ga.where.toString() + "<br>" + ga.foundname);
-						}
-						fetchHandle[0] = null;
-					}
-				};
-				thrdfetch.start();
+		        Vm.showWait(true);
+				try {
+					geoCodeAnsw = GeocoderOsm.geocode(cityInp.text.trim(), streetInp.text.trim());
+				} catch (Exception e) {
+					geoCodeAnsw = new Vector();
+					geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), e.getMessage()));
+				}
+		        Vm.showWait(false);
+				if (geoCodeAnsw.size() == 0) {
+					geoCodeAnsw = new Vector();
+					geoCodeAnsw.add(new GeocodeAnswer(new CWPoint(), "nothing found"));
+				}
+				choice.items.clear();
+				for (int i = 0; i < geoCodeAnsw.size(); i++) {
+					GeocodeAnswer ga = (GeocodeAnswer)geoCodeAnsw.get(i);
+					choice.addItem(ga.where.toString() + " | " + ga.foundname);
+				}
+				choice.updateItems();
 			}
 
 			if (ev.target == searchCancelBtn){
-				if (fetchHandle != null && fetchHandle[0] != null)
-				{
-					fetchHandle[0].stop(4321);
-					fetchHandle[0].set(Handle.Stopped);
-				}
 			}
 
 			if (ev.target == btnCancel){
@@ -156,8 +121,10 @@
 			}
 
 			if (ev.target == btnOk){
-				if (geoCodeAnsw != null && geoCodeAnsw.size() > 0)
-				coordInp = ((GeocodeAnswer)geoCodeAnsw.get(0)).where;
+				if (geoCodeAnsw != null && geoCodeAnsw.size() > 0) {
+					int i = choice.selectedIndex;
+					coordInp = ((GeocodeAnswer)geoCodeAnsw.get(i)).where;					
+				}
 				else coordInp.makeInvalid();
 				this.close(IDOK);
 			}

Modified: trunk/src/CacheWolf/GeocoderOsm.java
===================================================================
--- trunk/src/CacheWolf/GeocoderOsm.java	2011-03-26 12:24:26 UTC (rev 2964)
+++ trunk/src/CacheWolf/GeocoderOsm.java	2011-03-29 08:31:06 UTC (rev 2965)
@@ -25,10 +25,14 @@
     */
 package CacheWolf;
 
+import CacheWolf.utils.FileBugfix;
 import ewe.io.ByteArrayInputStream;
+import ewe.io.File;
+import ewe.io.FileInputStream;
 import ewe.io.IO;
 import ewe.io.IOException;
 import ewe.io.InputStreamReader;
+import ewe.io.StringStream;
 import ewe.sys.Handle;
 import ewe.sys.HandleStoppedException;
 import ewe.util.ByteArray;
@@ -39,35 +43,46 @@
 
 public class GeocoderOsm {
 
-	private static final String geocoderUrl = "http://gazetteer.openstreetmap.org/namefinder/search.xml?max=1&find=";  
+	//private static final String geocoderUrl = "http://gazetteer.openstreetmap.org/namefinder/search.xml?max=1&find=";
+	private static final String geocoderUrl = "http://nominatim.openstreetmap.org/search?"; //q=135+pilkington+avenue,+birmingham&format=xml&polygon=1&addressdetails=1
 
-	public static Vector geocode(String address, Handle[] h) 
-	throws SAXException, IOException, HandleStoppedException, InterruptedException {
-		ByteArray answ = UrlFetcher.fetchByteArray((geocoderUrl+UrlFetcher.toUtf8Url(address)), h);
+	public static Vector geocode(String city, String street) throws Exception 
+	{
+		String searchFor;
+		if (street.equals("")) {
+			searchFor=UrlFetcher.toUtf8Url(city);
+		}
+		else {
+			searchFor=UrlFetcher.toUtf8Url(street) + "+" + UrlFetcher.toUtf8Url(city);
+		}
+		String answer = UrlFetcher.fetch(geocoderUrl + "q=" + searchFor + "&format=xml");
+		answer=STRreplace.replace(answer,"\'","\' ");
+		answer=STRreplace.replace(answer,"  "," ");
 		XMLDecoder xmldec = new XMLDecoder();
-		xmldec.parse(new InputStreamReader(new ByteArrayInputStream(answ), IO.JAVA_UTF8_CODEC));
 		Vector erg = new Vector();
-		if ( "searchresults".equalsIgnoreCase((String)xmldec.document.tag) ) {
-			XMLElement xe, xe2;
-			String desc, lat, lon;
-			desc = null;
-			CWPoint where = new CWPoint();
-			if (xmldec.document != null && xmldec.document.subElements != null) {
-				for (int i=0;  i < xmldec.document.subElements.size(); i++) {
-					xe = (XMLElement) xmldec.document.subElements.elementAt(i);
-					if (xe.tag.equalsIgnoreCase("named")) {
-						lat = (String) xe.attributes.getPropertyValues("lat").get(0);
-						lon = (String) xe.attributes.getPropertyValues("lon").get(0);
-						where.set(Common.parseDouble(lat), Common.parseDouble(lon));
-						for (int j = 0; j < xe.subElements.size(); j++) {
-							xe2 = (XMLElement) xe.subElements.elementAt(j);
-							if ( xe2.tag.equalsIgnoreCase("description")) { desc = xe2.text; break; }  
+		try {
+			xmldec.parse(new InputStreamReader(new StringStream(answer)));
+			if ( "searchresults".equalsIgnoreCase((String)xmldec.document.tag) ) {
+				XMLElement xe;
+				String desc, lat, lon;
+				desc = null;
+				CWPoint where = new CWPoint();
+				if (xmldec.document != null && xmldec.document.subElements != null) {
+					for (int i=0;  i < xmldec.document.subElements.size(); i++) {
+						xe = (XMLElement) xmldec.document.subElements.elementAt(i);
+						if (xe.tag.equalsIgnoreCase("place")) {
+							lat = (String) xe.attributes.getPropertyValues("lat").get(0);
+							lon = (String) xe.attributes.getPropertyValues("lon").get(0);
+							where.set(Common.parseDouble(lat), Common.parseDouble(lon));
+							desc = (String) xe.attributes.getPropertyValues("display_name").get(0);
+							erg.add(new GeocodeAnswer(where, desc));
 						}
-						erg.add(new GeocodeAnswer(where, desc));
 					}
 				}
 			}
-		}
+		} catch (Exception e) {
+			throw new Exception(e.getMessage());
+		}	
 		return erg;
 	}
 



From apreisser at mail.berlios.de  Tue Mar 29 07:22:02 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Tue, 29 Mar 2011 07:22:02 PM +0200
Subject: [Cachewolf-svn] r2966 - trunk/src/CacheWolf
Message-ID: <20110329172203.1AF22480AA5@sheep.berlios.de>

Author: apreisser
Date: 2011-03-29 19:22:02 +0200 (Tue, 29 Mar 2011)
New Revision: 2966

Modified:
   trunk/src/CacheWolf/DataMover.java
Log:
Don't copy/move/delete waypoint description if its name is just a prefix of the wanted one

Modified: trunk/src/CacheWolf/DataMover.java
===================================================================
--- trunk/src/CacheWolf/DataMover.java	2011-03-29 08:31:06 UTC (rev 2965)
+++ trunk/src/CacheWolf/DataMover.java	2011-03-29 17:22:02 UTC (rev 2966)
@@ -281,10 +281,11 @@
 		if (wpt.length() == 0){
 			return;
 		}
+
 		// delete files in dstDir to clean up trash
-		// String tmp[] = new FileBugfix(dir).list(wpt + "*.*", ewe.io.FileBase.LIST_FILES_ONLY);
+		wpt=wpt.toLowerCase();
 		for (int i=0; i < tmp.length;i++){
-			if (tmp[i].substring(0, java.lang.Math.min(tmp[i].length(),wpt.length())).equalsIgnoreCase(wpt)) {
+			if (tmp[i].toLowerCase().startsWith(wpt+'.') || tmp[i].toLowerCase().startsWith(wpt+'_')){
 				File tmpFile = new File(dir + tmp[i]);
 				tmpFile.delete();
 			}
@@ -295,9 +296,9 @@
 		if (wpt.length() == 0){
 			return;
 		}
-		// String srcFiles[] = new FileBugfix(srcDir).list(wpt + "*.*", ewe.io.FileBase.LIST_FILES_ONLY);
+		wpt=wpt.toLowerCase();
 		for (int i=0; i < srcFiles.length;i++){
-			if (srcFiles[i].substring(0, java.lang.Math.min(srcFiles[i].length(),wpt.length())).equalsIgnoreCase(wpt)) {
+			if (srcFiles[i].toLowerCase().startsWith(wpt+'.') || srcFiles[i].toLowerCase().startsWith(wpt+'_')){
 				File srcFile = new File(srcDir + srcFiles[i]);
 				File dstFile = new File(dstDir + srcFiles[i]);
 				srcFile.move(dstFile);
@@ -309,9 +310,9 @@
 		if (wpt.length() == 0){
 			return;
 		}
-		// String srcFiles[] = new FileBugfix(srcDir).list(wpt + "*.*", ewe.io.FileBase.LIST_FILES_ONLY);
+		wpt=wpt.toLowerCase();
 		for (int i=0; i < srcFiles.length;i++){
-			if (srcFiles[i].substring(0, java.lang.Math.min(srcFiles[i].length(),wpt.length())).equalsIgnoreCase(wpt)) {
+			if (srcFiles[i].toLowerCase().startsWith(wpt+'.') || srcFiles[i].toLowerCase().startsWith(wpt+'_')){
 				copy(srcDir + srcFiles[i],dstDir + srcFiles[i]);
 			}
 		}
@@ -439,6 +440,7 @@
 			 destFileList= destPath.list(null,FileBase.LIST_FILES_ONLY|FileBase.LIST_DONT_SORT);
 			 pbf.exit(0);
 		 }
+		 
 		 public void doIt(int i,CacheHolder srcHolder) {
 			 srcDB.removeElementAt(i);
 			 deleteCacheFiles(srcHolder.getWayPoint(),dstProfile.dataDir, destFileList);



From araber95 at mail.berlios.de  Wed Mar 30 04:25:13 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 30 Mar 2011 04:25:13 PM +0200
Subject: [Cachewolf-svn] r2967 - trunk/res_noewe/webmapservices
Message-ID: <20110330142513.5EB01480AC4@sheep.berlios.de>

Author: araber95
Date: 2011-03-30 16:25:13 +0200 (Wed, 30 Mar 2011)
New Revision: 2967

Added:
   trunk/res_noewe/webmapservices/de_t25.wms
Modified:
   trunk/res_noewe/webmapservices/de_t2500.wms
Log:
new wms - service for whole germany and Parts of adjacent states from maps.adfc-tourenportal.de

Added: trunk/res_noewe/webmapservices/de_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_t25.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/de_t25.wms	2011-03-30 14:25:13 UTC (rev 2967)
@@ -0,0 +1,19 @@
+TakenFromUrl:       map.adfc-tourenportal.de = 195.66.99.21
+GetCapabilitiesUrl: doesn't work
+Name:               ADFC Tourenportal t25
+MapType:                        topo
+MainUrl:            http://195.66.99.21/mm-mapserver_v2/wms/wms.php?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+LayersUrlPart:     LAYERS=MM_TOPO
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/gif
+BoundingBoxTopLeftWGS84: N 55.7319 E 4.6186
+BoundingBoxBottomRightWGS84: N 45.9690 E 16.7118
+MinScale:   3.5
+MaxScale:   3.6
+RecommendedScale:    2.5
+ImageFileExtension: .gif

Modified: trunk/res_noewe/webmapservices/de_t2500.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_t2500.wms	2011-03-29 17:22:02 UTC (rev 2966)
+++ trunk/res_noewe/webmapservices/de_t2500.wms	2011-03-30 14:25:13 UTC (rev 2967)
@@ -15,6 +15,6 @@
 BoundingBoxTopLeftWGS84: N 55.7319 E 4.6186
 BoundingBoxBottomRightWGS84: N 45.9690 E 16.7118
 MinScale:   50
-MaxScale:   350
-RecommendedScale:    150
+MaxScale:   400
+RecommendedScale:    250 100 200 300
 ImageFileExtension: .png



From araber95 at mail.berlios.de  Thu Mar 31 11:48:15 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Thu, 31 Mar 2011 11:48:15 AM +0200
Subject: [Cachewolf-svn] r2968 - in trunk: res_noewe src/CacheWolf
	src/CacheWolf/imp
Message-ID: <20110331094815.BE40C480AF4@sheep.berlios.de>

Author: araber95
Date: 2011-03-31 11:48:15 +0200 (Thu, 31 Mar 2011)
New Revision: 2968

Modified:
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/HttpConnection.java
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
set correct property User-Agent. (no longer different spider.def in 1.2 and 1.3, perhaps solved http://www.geoclub.de/viewtopic.php?f=40&t=53772&start=30)


Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2011-03-30 14:25:13 UTC (rev 2967)
+++ trunk/res_noewe/spider.def	2011-03-31 09:48:15 UTC (rev 2968)
@@ -108,8 +108,8 @@
 cacheUnavailable   = class="OldWarning"><li>This\ cache\ is\ temporarily\ unavailable
 cacheArchived      = class="OldWarning"><li>This\ cache\ has\ been\ archived
 premiumCachepage   = class="Warning">listing\ visible\ to\ Premium
-#latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
-latLonRex          = tBody_LatLon"><b>((?s).*?)</b></span>
+latLonRex          = tBody_LatLon"\ style="font-weight:bold;">((?s).*?)</span>
+#latLonRex          = tBody_LatLon"><b>((?s).*?)</b></span>
 shortDescRex       = tBody_ShortDescription">((?s).*?)</span>
 longDescRex        = tBody_LongDescription">((?s).*?)<td\ valign="top"\ width="10%">\\s*&nbsp;\\s*</td
 cacheNameRex       = tBody_CacheName">((?s).*?)</span>

Modified: trunk/src/CacheWolf/HttpConnection.java
===================================================================
--- trunk/src/CacheWolf/HttpConnection.java	2011-03-30 14:25:13 UTC (rev 2967)
+++ trunk/src/CacheWolf/HttpConnection.java	2011-03-31 09:48:15 UTC (rev 2968)
@@ -353,6 +353,7 @@
 		}
 	}
 	getRequestorProperties().clear();
+	command = "GET";
 }
 
 //FIXME: never referenced

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-03-30 14:25:13 UTC (rev 2967)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-03-31 09:48:15 UTC (rev 2968)
@@ -31,10 +31,7 @@
 import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.JavaUtf8Codec;
-import ewe.net.Socket;
 import ewe.net.URL;
-import ewe.sys.Handle;
-import ewe.sys.HandleStoppedException;
 import ewe.util.ByteArray;
 import ewe.util.CharArray;
 
@@ -62,7 +59,7 @@
 	}
 	private static void initPermanentRequestorProperty() {
 		permanentRequestorProperties = new PropertyList();
-		permanentRequestorProperties.add("User_Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
+		permanentRequestorProperties.add("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
 		permanentRequestorProperties.add("Connection", "keep-alive");		
 	}
 	public static void setPermanentRequestorProperty(String name, String property) {
@@ -74,46 +71,32 @@
 			if ( index >= 0 ) permanentRequestorProperties.del(index);			
 		}
 	}
-	public static void setpostData(String value) { postData=value;};
+	public static void setpostData(String value) { 
+		postData=value;
+	};
 	public static String fetch(String address) throws IOException {
 		ByteArray daten = fetchByteArray(address);
 		JavaUtf8Codec codec = new JavaUtf8Codec();
 		CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
 		return c_data.toString();
 	}	
-	public static ByteArray fetchData(String address) throws IOException
-	{ return fetchByteArray(address); }
+	public static ByteArray fetchData(String address) throws IOException {
+		return fetchByteArray(address);
+	}
 	public static void fetchDataFile(String address, String target) throws IOException {
 		FileOutputStream outp =  new FileOutputStream(new File(target));
 		outp.write(fetchByteArray(address).toBytes());
 		outp.close();
 	}
-	// all errors as IOException
-	private static ByteArray fetchByteArray(String url) throws IOException {
-		Handle[] hndl = new Handle[1];
-		try {
-		return fetchByteArray(url, hndl);
-		} catch ( InterruptedException e) {
-			throw new IOException("Error reading data. Interrupted :"+url);
-		} catch ( HandleStoppedException e) {
-			throw new IOException("Error reading data. HandleStopped :"+url);
-		}
-	}
-
 	/**
-	 * @param url - if url-not-allowed chars are contained, they will be automatically encoded
-	 * @param if non null, realurl will be filled with the real url, which can differ from the given url, in case url returns a http-redirect
-	 * @return
+	 * @param url
+	 * @return ByteArray
 	 * @throws IOException
-	 * @throws InterruptedException 
-	 * @throws HandleStoppedException 
 	 */
-	public static ByteArray fetchByteArray(String url, Handle[] hndl) 
-	throws IOException, HandleStoppedException, InterruptedException {	
-		Socket sock = null;
+	public static ByteArray fetchByteArray(String url) throws IOException {	
 		int i=0;
+		conn = new HttpConnection(url);		
 		urltmp = url;
-		conn = new HttpConnection(urltmp);
 		do  { // allow max 5 redirections (http 302 location)
 			i++;
 			conn.setUrl(urltmp);
@@ -125,9 +108,7 @@
 			}
 			conn.setRequestorProperty(permanentRequestorProperties);
 			if (requestorProperties != null) conn.setRequestorProperty(requestorProperties);
-			hndl[0] = conn.connectAsync();
-			hndl[0].waitOn(Handle.Success);
-			sock = (Socket)hndl[0].returnValue; //"Could not connect.");
+			conn.connect();
 			if (conn.responseCode >= 400) throw new IOException("URL: "+ urltmp + "\nhttp response code: " + conn.responseCode);
 			urltmp = conn.getRedirectTo();
 			if(urltmp!=null){
@@ -139,18 +120,16 @@
 			}
 		} while (((urltmp != null) || (urltmp == null) && forceRedirect) && i <= maxRedirections ); 
 		if (i > maxRedirections) throw new IOException("too many http redirections while trying to fetch: "+url + " only "+maxRedirections+" are allowed");
-		hndl[0] = conn.readInData();
 		ByteArray daten;
-		try{
-			hndl[0].waitOn(Handle.Success);
-		}finally {
-			sock.close();
+		if (conn.isOpen()) {
+			daten = conn.readData();
+			conn.disconnect();
 		}
+		else daten=null;
 		maxRedirections = 5;
 		requestorProperties = null;
 		postData=null;
 		forceRedirect=false;
-		daten = (ByteArray)hndl[0].returnValue; // ByteArray daten = conn.readData(sock);
 		return daten;
 	}
 

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-30 14:25:13 UTC (rev 2967)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-03-31 09:48:15 UTC (rev 2968)
@@ -61,14 +61,10 @@
 import ewe.data.Property;
 import ewe.data.PropertyList;
 import ewe.fx.Image;
-import ewe.io.File;
 import ewe.io.FileBase;
 import ewe.io.FileInputStream;
-import ewe.io.FileOutputStream;
 import ewe.io.IOException;
 import ewe.io.InputStreamReader;
-import ewe.io.JavaUtf8Codec;
-import ewe.net.Socket;
 import ewe.net.URL;
 import ewe.net.UnknownHostException;
 import ewe.sys.Convert;
@@ -77,7 +73,6 @@
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;
 import ewe.util.ByteArray;
-import ewe.util.CharArray;
 import ewe.util.Enumeration;
 import ewe.util.Hashtable;
 import ewe.util.Properties;



