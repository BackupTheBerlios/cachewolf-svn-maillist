From engywuck at mail.berlios.de  Wed Jul  1 21:01:25 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Wed, 1 Jul 2009 21:01:25 +0200
Subject: [Cachewolf-svn] r1974 - trunk/src/CacheWolf
Message-ID: <200907011901.n61J1P3x012551@sheep.berlios.de>

Author: engywuck
Date: 2009-07-01 21:01:24 +0200 (Wed, 01 Jul 2009)
New Revision: 1974

Modified:
   trunk/src/CacheWolf/MyComparer.java
Log:
Enabling sorting for Column #Rec (Recommendations) even for GC caches.

Modified: trunk/src/CacheWolf/MyComparer.java
===================================================================
--- trunk/src/CacheWolf/MyComparer.java	2009-06-30 18:59:31 UTC (rev 1973)
+++ trunk/src/CacheWolf/MyComparer.java	2009-07-01 19:01:24 UTC (rev 1974)
@@ -82,10 +82,7 @@
 		} else if (colToCompare==13) {
 			for (int i=0; i<visibleSize; i++) {
 				CacheHolder ch=cacheDB.get(i);
-				if (ch.getWayPoint().startsWith("OC"))
-					ch.sort=MyLocale.formatLong(ch.getNumRecommended(),"00000");
-				else
-					ch.sort="\uFFFF";
+				ch.sort=MyLocale.formatLong(ch.getNumRecommended(),"00000");
 			}			
 		} else if (colToCompare==14) {
 			for (int i=0; i<visibleSize; i++) {



From greiol at mail.berlios.de  Thu Jul  2 00:04:35 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 2 Jul 2009 00:04:35 +0200
Subject: [Cachewolf-svn] r1975 - trunk/src/exp
Message-ID: <200907012204.n61M4Zpu028017@sheep.berlios.de>

Author: greiol
Date: 2009-07-02 00:04:32 +0200 (Thu, 02 Jul 2009)
New Revision: 1975

Modified:
   trunk/src/exp/GarminMap.java
   trunk/src/exp/OziExporter.java
Log:
remove , from cache names in ozi export
add color support via garminmap for ozi export

Modified: trunk/src/exp/GarminMap.java
===================================================================
--- trunk/src/exp/GarminMap.java	2009-07-01 19:01:24 UTC (rev 1974)
+++ trunk/src/exp/GarminMap.java	2009-07-01 22:04:32 UTC (rev 1975)
@@ -38,7 +38,7 @@
 		if (name.equals("icon")) {
 			symbols.add(new IconMap(atts.getValue("type"),atts.getValue("name"),atts.getValue("found"),
 					atts.getValue("size"),atts.getValue("terrain"),atts.getValue("difficulty"),
-					atts.getValue("status"),atts.getValue("poiid")));
+					atts.getValue("status"),atts.getValue("poiid"),atts.getValue("ozicolor")));
 		}
 	}
 
@@ -82,6 +82,24 @@
 		}
 		return null;
 	}
+	
+	public String ozicolor(CacheHolder ch) {
+		int mapSize=symbols.size();
+		// Try each icon in turn
+		for (int i=0; i<mapSize; i++) {
+			IconMap icon=(IconMap) symbols.get(i);
+			boolean match=true;
+			// If a certain attribute is not null it must match the current caches values
+			match=match && ((icon.type==null) || ch.getType()==0 || icon.type.equals(String.valueOf(ch.getType())));
+			match=match && ((icon.size==null) || ch.getCacheSize()==0 || icon.size.equalsIgnoreCase(CacheSize.getExportShortId(ch.getCacheSize())));
+			match=match && ((icon.terrain==null) || ch.getTerrain()==0 || icon.terrain.equals(CacheTerrDiff.shortDT(ch.getTerrain())));
+			match=match && ((icon.difficulty==null) ||  ch.getHard()==0 || icon.difficulty.equals(CacheTerrDiff.shortDT(ch.getHard())));
+			match=match && ((icon.status==null) ||  ch.getCacheStatus().startsWith(icon.status));
+			match=match && ((icon.found==null) || ch.is_found());
+			if (match) return icon.ozicolor;
+		}
+		return null;
+	}
 
 	private class IconMap {
 		public String type;
@@ -92,8 +110,9 @@
 		public String found;
 		public String status;
 		public String poiId;
+		public String ozicolor;
 
-		IconMap(String type, String name, String found, String size, String terrain, String difficulty, String status, String poiId) {
+		IconMap(String type, String name, String found, String size, String terrain, String difficulty, String status, String poiId, String ozicolor) {
 			this.type=type;
 			this.name=name;
 			this.found=found;
@@ -102,6 +121,7 @@
 			this.difficulty=difficulty;
 			this.status=status;
 			this.poiId = poiId;
+			this.ozicolor = ozicolor;
 		}
 	}
 

Modified: trunk/src/exp/OziExporter.java
===================================================================
--- trunk/src/exp/OziExporter.java	2009-07-01 19:01:24 UTC (rev 1974)
+++ trunk/src/exp/OziExporter.java	2009-07-01 22:04:32 UTC (rev 1975)
@@ -1,4 +1,6 @@
 package exp;
+import ewe.io.File;
+import ewe.io.FileBase;
 import CacheWolf.*;
 
 /**
@@ -6,10 +8,18 @@
 */
 public class OziExporter extends Exporter{
 	
+	GarminMap poiMapper;
+	
 	public OziExporter(Preferences p, Profile prof){
 		super();
 		this.setHowManyParams(LAT_LON);
 		this.setMask("*.wpt");
+		if ((new File(FileBase.getProgramDirectory()+"/garminmap.xml")).exists()) {
+			poiMapper=new GarminMap();
+			poiMapper.readGarminMap();
+		} else {
+			poiMapper = null;
+		}
 	}
 	
 	public String header () {
@@ -31,7 +41,18 @@
 		// usually start at 1 and increment. Can be set to -1 (minus 1) and the number will be auto generated.
 		strBuf.append("-1,");
 		// Field 2 : Name - the waypoint name, use the correct length name to suit the GPS type.
-		strBuf.append(ch.getWayPoint() + ",");
+		if (ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt()) {
+			strBuf.append(ch.getWayPoint() + ",");
+		} else {
+			strBuf.append(ch.getWayPoint()
+			.concat(" ")
+			.concat(CacheType.getExportShortId(ch.getType()))
+			.concat(String.valueOf(ch.getHard()))
+			.concat(String.valueOf(ch.getTerrain()))
+			.concat(CacheSize.getExportShortId(ch.getCacheSize()))
+			.concat(",")
+			);
+		}
 		// Field 3 : Latitude - decimal degrees.
 		strBuf.append(lat+",");
 		// Field 4 : Longitude - decimal degrees.
@@ -43,13 +64,19 @@
 		// Field 7 : Status - always set to 1
 		strBuf.append("1,");
 		// Field 8 : Map Display Format
-		strBuf.append("0,");
+		strBuf.append("3,");
 		// Field 9 : Foreground Color (RGB value)
 		strBuf.append("0,");
 		// Field 10 : Background Color (RGB value)
-		strBuf.append("16777215,");
+		String color="16777215";
+		if (poiMapper != null) {
+			String tmpcolor = poiMapper.ozicolor(ch);
+			if (tmpcolor != null)
+				color = tmpcolor;
+		}
+		strBuf.append(color+",");
 		// Field 11 : Description (max 40), no commas
-		tmpName = simplifyString(ch.getCacheName());
+		tmpName = simplifyString(ch.getCacheName()).replace(',', ' ');
 		if (tmpName.length() <= 40){
 			strBuf.append(tmpName + ",");
 		}
@@ -65,15 +92,15 @@
 		// Field 15 : Altitude - in feet (-777 if not valid)
 		strBuf.append("-777,");
 		// Field 16 : Font Size - in points
-		strBuf.append("8,");
+		strBuf.append("7,");
 		// Field 17 : Font Style - 0 is normal, 1 is bold.
-		strBuf.append("1,");
+		strBuf.append("0,");
 		// Field 18 : Symbol Size - 17 is normal size
 		strBuf.append("17,");
 		// Field 19 : Proximity Symbol Position
 		strBuf.append("0,");
 		// Field 20 : Proximity Time
-		strBuf.append("  10.0,");
+		strBuf.append("10.0,");
 	    // Field 21 : Proximity or Route or Both
 		strBuf.append("2,");
 		// Field 22 : File Attachment Name



From engywuck at mail.berlios.de  Fri Jul  3 18:38:09 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 3 Jul 2009 18:38:09 +0200
Subject: [Cachewolf-svn] r1976 - trunk/src/CacheWolf
Message-ID: <200907031638.n63Gc9I9013563@sheep.berlios.de>

Author: engywuck
Date: 2009-07-03 18:38:02 +0200 (Fri, 03 Jul 2009)
New Revision: 1976

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
Catching exception when LastSyncDate has a value of something which is not a date.

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2009-07-01 22:04:32 UTC (rev 1975)
+++ trunk/src/CacheWolf/myTableModel.java	2009-07-03 16:38:02 UTC (rev 1976)
@@ -378,7 +378,12 @@
 						}
 					case 19: // Last sync date
 						if (!ch.getLastSync().equals("")) {
-							lastSyncWorker.parse(ch.getLastSync(),"yyyyMMddHHmmss");
+							try {
+	                            lastSyncWorker.parse(ch.getLastSync(),"yyyyMMddHHmmss");
+                            } catch (IllegalArgumentException e) {
+                            	Global.getPref().log("Could not parse 'lastSyncDate': "+ch.getLastSync()+". Reset to empty.",e);
+                            	ch.setLastSync("");
+                            }
 							return lastSyncWorker.format("yyyy-MM-dd HH:mm");
 						} else {
 							return "";



From engywuck at mail.berlios.de  Fri Jul  3 19:10:22 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 3 Jul 2009 19:10:22 +0200
Subject: [Cachewolf-svn] r1977 - in trunk/src: CacheWolf CacheWolf/navi exp
Message-ID: <200907031710.n63HAMGC002289@sheep.berlios.de>

Author: engywuck
Date: 2009-07-03 19:10:15 +0200 (Fri, 03 Jul 2009)
New Revision: 1977

Modified:
   trunk/src/CacheWolf/DataMoverForm.java
   trunk/src/CacheWolf/navi/MovingMap.java
   trunk/src/CacheWolf/navi/Navigate.java
   trunk/src/exp/GpxExportNg.java
Log:
Tuning code to remove compiler warnings.

Modified: trunk/src/CacheWolf/DataMoverForm.java
===================================================================
--- trunk/src/CacheWolf/DataMoverForm.java	2009-07-03 16:38:02 UTC (rev 1976)
+++ trunk/src/CacheWolf/DataMoverForm.java	2009-07-03 17:10:15 UTC (rev 1977)
@@ -1,8 +1,10 @@
 package CacheWolf;
 
+import ewe.ui.CellConstants;
 import ewe.ui.CheckBoxGroup;
 import ewe.ui.Event;
 import ewe.ui.Form;
+import ewe.ui.FormBase;
 import ewe.ui.mButton;
 import ewe.ui.mCheckBox;
 import ewe.ui.mLabel;
@@ -24,15 +26,15 @@
 		tickedVisible = new mCheckBox (MyLocale.getMsg(256, "All visible and ticked"));
 		tickedVisible.setGroup(chkFormat);
 		firstLine = new mLabel ("");
-		firstLine.anchor = mLabel.CENTER;
+		firstLine.anchor = CellConstants.CENTER;
 		addLast (firstLine);
 		addLast (visible);
 		addLast (ticked);
 		addLast (tickedVisible);
 		mLabel continueQuestion =new mLabel (MyLocale.getMsg(259, "Do You really want to continue?"));
-		continueQuestion.anchor = mLabel.CENTER;
+		continueQuestion.anchor = CellConstants.CENTER;
 		addLast (continueQuestion);
-		doButtons(Form.YESB|Form.CANCELB);
+		doButtons(FormBase.YESB|FormBase.CANCELB);
 		setModefromPref();
 	}
 

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-07-03 16:38:02 UTC (rev 1976)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-07-03 17:10:15 UTC (rev 1977)
@@ -854,10 +854,10 @@
 
 	public void destChanged(CacheHolder ch) {
 		CWPoint d = new CWPoint (ch.pos);
-		if(!running || (d == null && gotoPos == null) || 
-				(d != null && gotoPos != null && gotoPos.where.equals(d))) return;
+		if(!running || (gotoPos == null) || 
+				(gotoPos != null && gotoPos.where.equals(d))) return;
 		removeGotoPosition();
-		if (d == null || !d.isValid() ) return;
+		if (!d.isValid() ) return;
 		gotoPos = addSymbol("goto", ch, "goto_map.png", d);
 		//updateDistance(); - this is called from updatePosition
 		forceMapLoad = true;

Modified: trunk/src/CacheWolf/navi/Navigate.java
===================================================================
--- trunk/src/CacheWolf/navi/Navigate.java	2009-07-03 16:38:02 UTC (rev 1976)
+++ trunk/src/CacheWolf/navi/Navigate.java	2009-07-03 17:10:15 UTC (rev 1977)
@@ -9,7 +9,6 @@
 import ewe.io.SerialPort;
 import ewe.io.SerialPortOptions;
 import ewe.net.Socket;
-import ewe.sys.Vm;
 import ewe.sys.mThread;
 import ewe.ui.FormBase;
 import ewe.ui.MessageBox;

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-03 16:38:02 UTC (rev 1976)
+++ trunk/src/exp/GpxExportNg.java	2009-07-03 17:10:15 UTC (rev 1977)
@@ -31,7 +31,7 @@
 import ewe.sys.Handle;
 import ewe.sys.Vm;
 import ewe.ui.CheckBoxGroup;
-import ewe.ui.Control;
+import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
 import ewe.ui.Event;
 import ewe.ui.Form;
@@ -189,18 +189,18 @@
 			}
 			
 			if (sendToGarmin) {
-				tempDir = baseDir+File.separator+this.getClass().toString();
+				tempDir = baseDir+FileBase.separator+this.getClass().toString();
 				new File(tempDir).mkdir();
 			} else {
 				tempDir = outDir;
 				String tmp[] = new FileBugfix(tempDir).list(prefix + "*.gpx", ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i=0; i < tmp.length;i++){
-					FileBugfix tmpFile = new FileBugfix(tempDir + File.separator + tmp[i]);
+					FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
 				tmp = new FileBugfix(tempDir).list(prefix + "*.bmp", ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i=0; i < tmp.length;i++){
-					FileBugfix tmpFile = new FileBugfix(tempDir + File.separator + tmp[i]);
+					FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
 			}
@@ -234,7 +234,7 @@
 							if (fileHandles.containsKey(poiId)) {
 								writer = (PrintWriter) fileHandles.get(poiId);
 							} else {
-								writer = new PrintWriter(new BufferedWriter(new FileWriter(new File(tempDir + File.separator + prefix+poiId+".gpx"))));
+								writer = new PrintWriter(new BufferedWriter(new FileWriter(new File(tempDir + FileBase.separator + prefix+poiId+".gpx"))));
 								fileHandles.put(poiId, writer);
 								writer.print(formatHeader());
 							}
@@ -248,7 +248,7 @@
 				}
 				
 				try {
-					poiZip = new ZipFile (FileBase.getProgramDirectory() + File.separator + "GarminPOI.zip");
+					poiZip = new ZipFile (FileBase.getProgramDirectory() + FileBase.separator + "GarminPOI.zip");
 				} catch (IOException e) {
 					Global.getPref().log("GPX Export: warning GarminPOI.zip not found", e, Global.getPref().debug);
 					exportErrors++;
@@ -268,7 +268,7 @@
 				if (sendToGarmin) {
 					String tmp[] = new FileBugfix(outDir).list(prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
 					for (int i=0; i < tmp.length;i++){
-						FileBugfix tmpFile = new FileBugfix(tempDir + File.separator + tmp[i]);
+						FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
 						tmpFile.delete();
 					}				
 
@@ -700,7 +700,7 @@
 			
 			buff = new byte[ icon.getSize() ];
 			InputStream  fis = poiZip.getInputStream(icon);
-			FileOutputStream fos = new FileOutputStream(outdir.concat(File.separator).concat(prefix).concat(type).concat(".bmp"));
+			FileOutputStream fos = new FileOutputStream(outdir.concat(FileBase.separator).concat(prefix).concat(type).concat(".bmp"));
 			while( 0 < (len = fis.read( buff )) ) fos.write( buff, 0, len );
 			fos.flush();
 			fos.close();
@@ -752,14 +752,14 @@
 
 			cbSendToGarmin = new mCheckBox("send to Garmin GPSr");
 			if (Global.getPref().gpsbabel == null)
-				cbSendToGarmin.modify(Control.Disabled, 0);
+				cbSendToGarmin.modify(ControlConstants.Disabled, 0);
 
 			cbSmartId = new mCheckBox("use smart IDs");
 			
 			ibPrefix = new mInput("GC-");
-			ibPrefix.modify(Control.Disabled, 0);
+			ibPrefix.modify(ControlConstants.Disabled, 0);
 			ibMaxLogs = new mInput(String.valueOf(Global.getPref().numberOfLogsToExport));
-			ibMaxLogs.modify(Control.Disabled, 0);
+			ibMaxLogs.modify(ControlConstants.Disabled, 0);
 
 			btnOk = new mButton("OK");
 			btnCancel = new mButton("Cancel");
@@ -790,60 +790,60 @@
 
 				if (ev.target == cbgExportType) {
 					if (cbgExportType.getSelected() == cbCompact) {
-						if (cbCustomIcons.change(0, Control.Disabled))
+						if (cbCustomIcons.change(0, ControlConstants.Disabled))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(0, Control.Disabled))
+						if (cbSeperateFiles.change(0, ControlConstants.Disabled))
 							cbSeperateFiles.repaint();
 						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0,Control.Disabled))
+							if (cbSendToGarmin.change(0,ControlConstants.Disabled))
 								cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, Control.Disabled))
+						if (cbSmartId.change(0, ControlConstants.Disabled))
 							cbSmartId.repaint();
-						if (ibMaxLogs.change(Control.Disabled, 0))
+						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
 							ibMaxLogs.repaint();
 					} else if (cbgExportType.getSelected() == cbPqLike) {
 						cbSeperateFiles.setState(false);
-						if (cbCustomIcons.change(0, Control.Disabled))
+						if (cbCustomIcons.change(0, ControlConstants.Disabled))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(Control.Disabled, 0))
+						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
 							cbSeperateFiles.repaint();
 						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0,Control.Disabled))
+							if (cbSendToGarmin.change(0,ControlConstants.Disabled))
 						 		cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, Control.Disabled))
+						if (cbSmartId.change(0, ControlConstants.Disabled))
 							cbSmartId.repaint();
-						if (ibPrefix.change(Control.Disabled, 0))
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
 							ibPrefix.repaint();
-						if (ibMaxLogs.change(Control.Disabled, 1))
+						if (ibMaxLogs.change(ControlConstants.Disabled, 1))
 							ibMaxLogs.repaint();
 					} else if (cbgExportType.getSelected() == cbMyFinds) {
 						cbCustomIcons.setState(false);
 						cbSeperateFiles.setState(false);
 						cbSendToGarmin.setState(false);
 						cbSmartId.setState(false);
-						if (cbCustomIcons.change(Control.Disabled, 0))
+						if (cbCustomIcons.change(ControlConstants.Disabled, 0))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(Control.Disabled, 0))
+						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
 							cbSeperateFiles.repaint();
-						if (cbSendToGarmin.change(Control.Disabled,0))
+						if (cbSendToGarmin.change(ControlConstants.Disabled,0))
 							cbSendToGarmin.repaint();
-						if (cbSmartId.change(Control.Disabled, 0))
+						if (cbSmartId.change(ControlConstants.Disabled, 0))
 							cbSmartId.repaint();
-						if (ibPrefix.change(Control.Disabled, 0))
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
 							ibPrefix.repaint();
-						if (ibMaxLogs.change(Control.Disabled, 0))
+						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
 							ibMaxLogs.repaint();
 					}
 				} else if (ev.target == cbSeperateFiles) {
 					if (cbSeperateFiles.state) {
-						if (ibPrefix.change(Control.Disabled, 1)) ibPrefix.repaint();
-						if (cbSendToGarmin.change(Control.Disabled, 0)) {
+						if (ibPrefix.change(ControlConstants.Disabled, 1)) ibPrefix.repaint();
+						if (cbSendToGarmin.change(ControlConstants.Disabled, 0)) {
 							cbSendToGarmin.setState(false);
 							cbSendToGarmin.repaint();
 						}
 					} else {
-						if (ibPrefix.change(Control.Disabled, 0)) ibPrefix.repaint();
-						if (cbSendToGarmin.change(0, Control.Disabled)) cbSendToGarmin.repaint();
+						if (ibPrefix.change(ControlConstants.Disabled, 0)) ibPrefix.repaint();
+						if (cbSendToGarmin.change(0, ControlConstants.Disabled)) cbSendToGarmin.repaint();
 					}
 				} else if (ev.target == btnOk) {
 					if (cbPqLike.state) {



From engywuck at mail.berlios.de  Fri Jul  3 19:23:41 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 3 Jul 2009 19:23:41 +0200
Subject: [Cachewolf-svn] r1978 - in trunk/src: CacheWolf CacheWolf/imp exp
Message-ID: <200907031723.n63HNfAS019153@sheep.berlios.de>

Author: engywuck
Date: 2009-07-03 19:23:32 +0200 (Fri, 03 Jul 2009)
New Revision: 1978

Added:
   trunk/src/CacheWolf/CacheImages.java
   trunk/src/CacheWolf/ImageInfo.java
Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/ImagePanel.java
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/exp/HTMLExporter.java
Log:
Creating two new classes (CacheImages and ImageInfo) to handle images in caches. Up to now it's just a kind of refactoring and should show exactly the same behaviour as before.

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -24,13 +24,9 @@
 	  public String Hints = CacheHolder.EMPTY;
 	  public LogList CacheLogs=new LogList();
 	  private String CacheNotes = CacheHolder.EMPTY;
-	  public Vector Images = new Vector();
-	  public Vector ImagesText = new Vector();
-	  public Vector ImagesInfo = new Vector();
-	  public Vector LogImages = new Vector();
-	  public Vector LogImagesText = new Vector();
-	  public Vector UserImages = new Vector();
-	  public Vector UserImagesText = new Vector();
+	  public CacheImages images = new CacheImages();
+	  public CacheImages logImages = new CacheImages();
+	  public CacheImages userImages = new CacheImages();
 	  public Attributes attributes=new Attributes();
 	  public Vector CacheIcons = new Vector();
 	  public TravelbugList Travelbugs=new TravelbugList();
@@ -131,9 +127,7 @@
 		  this.URL = newCh.URL;
 		  
 		  // Images
-		  this.Images = newCh.Images;
-		  this.ImagesInfo = newCh.ImagesInfo;
-		  this.ImagesText = newCh.ImagesText;
+		  this.images = newCh.images;
 		  
 		  setLongDescription(newCh.LongDescription);
 		  setHints(newCh.Hints);
@@ -165,10 +159,12 @@
 				imgDesc = new InputBox("Description").input("",10);
 				//Create Destination Filename
 				String ext = imgFile.getFileExt().substring(imgFile.getFileExt().lastIndexOf("."));
-				imgDestName = getParent().getWayPoint() + "_U_" + (this.UserImages.size()+1) + ext;
+				imgDestName = getParent().getWayPoint() + "_U_" + (this.userImages.size()+1) + ext;
 				
-				this.UserImages.add(imgDestName);
-				this.UserImagesText.add(imgDesc);
+				ImageInfo userImageInfo = new ImageInfo();
+				userImageInfo.setName(imgDestName);
+				userImageInfo.setText(imgDesc);
+				this.userImages.add(userImageInfo);
 				// Copy File
 				DataMover.copy(imgFile.getFullPath(),profile.dataDir + imgDestName);
 				// Save Data
@@ -185,6 +181,7 @@
 		void readCache(String dir) throws IOException{
 			String dummy;
 			FileReader in = null;
+			ImageInfo imageInfo;
 			// If parent cache has empty waypoint then don't do anything. This might happen
 			// when a cache object is freshly created to serve as container for imported data
 			if (this.getParent().getWayPoint().equals(CacheHolder.EMPTY)) return;
@@ -234,55 +231,64 @@
 			}
 			ex = new Extractor(text, "<NOTES><![CDATA[", "]]></NOTES>", 0, true);
 			CacheNotes = ex.findNext();
-			Images.clear();
+			images.clear();
 			ex = new Extractor(text, "<IMG>", "</IMG>", 0, true);
 			dummy = ex.findNext();
 			while(ex.endOfSearch() == false){
-				Images.add(SafeXML.strxmldecode(dummy));
+				imageInfo = new ImageInfo();
+				imageInfo.setName(SafeXML.strxmldecode(dummy));
+				this.images.add(imageInfo);
 				dummy = ex.findNext();
 			}
-			ImagesText.clear();
 			ex = new Extractor(text, "<IMGTEXT>", "</IMGTEXT>", 0, true);
 			dummy = ex.findNext();
+			int imgNr = 0;
 			while(ex.endOfSearch() == false){
+				imageInfo = this.images.get(imgNr);
 				int pos=dummy.indexOf("<DESC>");
 				if (pos>0) {
-					ImagesText.add(dummy.substring(0,pos));
-					ImagesInfo.add(dummy.substring(pos+6,dummy.indexOf("</DESC>")));
+					imageInfo.setText(dummy.substring(0,pos));
+					imageInfo.setComment(dummy.substring(pos+6,dummy.indexOf("</DESC>")));
 				} else {
-					ImagesText.add(dummy);
-					ImagesInfo.add(null);
+					imageInfo.setText(dummy);
 				}
 				dummy = ex.findNext();
+				imgNr = imgNr + 1;
 			}
 			// Logimages
-			LogImages.clear();
+			logImages.clear();
 			ex = new Extractor(text, "<LOGIMG>", "</LOGIMG>", 0, true);
 			dummy = ex.findNext();
 			while(ex.endOfSearch() == false){
-				LogImages.add(dummy);
+				imageInfo = new ImageInfo();
+				imageInfo.setName(dummy);
+				logImages.add(imageInfo);
 				dummy = ex.findNext();
 			}
-			LogImagesText.clear();
 			ex = new Extractor(text, "<LOGIMGTEXT>", "</LOGIMGTEXT>", 0, true);
 			dummy = ex.findNext();
+			imgNr = 0;
 			while(ex.endOfSearch() == false){
-				LogImagesText.add(dummy);
+				imageInfo = logImages.get(imgNr++);
+				imageInfo.setText(dummy);
 				dummy = ex.findNext();
 			}
 
-			UserImages.clear();
+			userImages.clear();
 			ex = new Extractor(text, "<USERIMG>", "</USERIMG>", 0, true);
 			dummy = ex.findNext();
 			while(ex.endOfSearch() == false){
-				UserImages.add(dummy);
+				imageInfo = new ImageInfo();
+				imageInfo.setName(dummy);
+				userImages.add(imageInfo);
 				dummy = ex.findNext();
 			}
-			UserImagesText.clear();
 			ex = new Extractor(text, "<USERIMGTEXT>", "</USERIMGTEXT>", 0, true);
 			dummy = ex.findNext();
+			imgNr = 0;
 			while(ex.endOfSearch() == false){
-				UserImagesText.add(dummy);
+				imageInfo = userImages.get(imgNr++);
+				imageInfo.setText(dummy);
 				dummy = ex.findNext();
 			}
 
@@ -361,33 +367,33 @@
 				  detfile.print("<NOTES><![CDATA["+CacheNotes+"]]></NOTES>\n");
 				  detfile.print("<IMAGES>\n");
 				  String stbuf = new String();
-				  for(int i = 0;i<Images.size();i++){
-						stbuf = (String)Images.get(i);
+				  for(int i = 0;i<images.size();i++){
+						stbuf = images.get(i).getName();
 						detfile.print("    <IMG>"+SafeXML.strxmlencode(stbuf)+"</IMG>\n");
 				  }
-				  int iis = ImagesInfo.size();
-				  for(int i = 0;i<ImagesText.size();i++){
-						stbuf = (String)ImagesText.get(i);
-						if (i< iis && ImagesInfo.get(i) != null)
-							detfile.print("    <IMGTEXT>"+stbuf+"<DESC>"+ImagesInfo.get(i)+"</DESC></IMGTEXT>\n");
+				  int iis = images.size();
+				  for(int i = 0;i<iis;i++){
+						stbuf = images.get(i).getText();
+						if (i< iis && images.get(i).getComment() != null)
+							detfile.print("    <IMGTEXT>"+stbuf+"<DESC>"+images.get(i).getComment()+"</DESC></IMGTEXT>\n");
 						else 
 							detfile.print("    <IMGTEXT>"+stbuf+"</IMGTEXT>\n");
 				  }
 
-				  for(int i = 0;i<LogImages.size();i++){
-						stbuf = (String)LogImages.get(i);
+				  for(int i = 0;i<logImages.size();i++){
+						stbuf = logImages.get(i).getName();
 						detfile.print("    <LOGIMG>"+stbuf+"</LOGIMG>\n");
 				  }
-				  for(int i = 0;i<LogImagesText.size();i++){
-						stbuf = (String)LogImagesText.get(i);
+				  for(int i = 0;i<logImages.size();i++){
+						stbuf = logImages.get(i).getText();
 						detfile.print("    <LOGIMGTEXT>"+stbuf+"</LOGIMGTEXT>\n");
 				  }
-				  for(int i = 0;i<UserImages.size();i++){
-						stbuf = (String)UserImages.get(i);
+				  for(int i = 0;i<userImages.size();i++){
+						stbuf = userImages.get(i).getName();
 						detfile.print("    <USERIMG>"+stbuf+"</USERIMG>\n");
 				  }
-				  for(int i = 0;i<UserImagesText.size();i++){
-						stbuf = (String)UserImagesText.get(i);
+				  for(int i = 0;i<userImages.size();i++){
+						stbuf = userImages.get(i).getText();
 						detfile.print("    <USERIMGTEXT>"+stbuf+"</USERIMGTEXT>\n");
 				  }
 
@@ -419,16 +425,10 @@
 		 * @return true if cache has additional info, false otherwise
 		 */
 		public boolean hasImageInfo() {
-			for (int i=ImagesInfo.size()-1; i>=0; i--)
-				if (ImagesInfo.get(i)!=null) return true;
+			for (int i=this.images.size()-1; i>=0; i--)
+				if (this.images.get(i).getComment() != null) return true;
 			return false;
 		}
-
-//	   public void finalize() {
-//		   super.finalize();
-//		   Vm.debug("Destroying CacheHolder "+wayPoint);
-//	   }
-
 }
 
 

Added: trunk/src/CacheWolf/CacheImages.java
===================================================================
--- trunk/src/CacheWolf/CacheImages.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/CacheImages.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -0,0 +1,41 @@
+/**
+ * 
+ */
+package CacheWolf;
+
+import ewe.util.Vector;
+
+public class CacheImages {
+	
+	public CacheImages(){ // Public Constructor
+	}
+	
+	private Vector vector=null;
+	private Vector getVector(){
+		if (this.vector==null) {
+			vector = new Vector(10);
+		}
+		return this.vector;
+	}
+	
+	public void add(ImageInfo img) {
+        getVector().add(img);
+    }
+	
+	public ImageInfo get(int idx) {
+		return (ImageInfo) getVector().get(idx);
+	}
+	
+	public void clear() {
+		if (this.vector!=null) {
+			this.vector.clear();
+		}
+	}
+	public int size() {
+		if (this.vector == null) {
+			return 0;
+		} else {
+			return this.vector.size();
+		}
+	}
+}
\ No newline at end of file

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -5,7 +5,6 @@
 import ewe.ui.*;
 import ewe.fx.*;
 import ewe.sys.*;
-import ewe.util.Vector;
 
 /**
 *	This class shows the long description on a cache.
@@ -68,19 +67,19 @@
         if (cache!=null && isHtml) {
             int imageNo = 0;
             if (Global.getPref().descShowImg) {
-                Vector Images;
+                CacheImages Images;
                 CacheHolder chImages; // cache which supplies the images (could be main cache)
                 if (cache.isAddiWpt()) {
                     chImages=cache.mainCache;
                 } else {
                     chImages=cache;
                 }
-            	Images = chImages.getExistingDetails().Images;
+            	Images = chImages.getExistingDetails().images;
                 StringBuffer s = new StringBuffer(desc.length() + Images.size() * 100);
                 int start = 0;
                 int pos;
                 Regex imgRex = new Regex("src=(?:\\s*[^\"|']*?)(?:\"|')(.*?)(?:\"|')");
-                if (Images.getCount() > 0) {
+                if (Images.size() > 0) {
                     while (start >= 0 && (pos = desc.indexOf("<img", start)) > 0) {
                         s.append(desc.substring(start, pos));
                         imgRex.searchFrom(desc, pos);
@@ -101,14 +100,14 @@
                         start = desc.indexOf(">", pos);
                         if (start >= 0)
                             start++;
-                        if (imageNo >= Images.getCount())
+                        if (imageNo >= Images.size())
                             break;
                     }
                 }
                 if (start >= 0)
                     s.append(desc.substring(start));
                 desc = s.toString();
-                if (imageNo<Images.getCount()) {
+                if (imageNo<Images.size()) {
                     desc += getPicDesc(imageNo, chImages.getExistingDetails());
                 }
             }
@@ -139,12 +138,12 @@
 		StringBuffer sb=new StringBuffer(1000);
 		sb.append("<hr><font size=\"+1\" color=\"red\">").append(MyLocale.getMsg(202,"IMAGES").toUpperCase()).append("</font>");
 		sb.append("<br><br>");
-		for (int i=imagesShown; i<chD.ImagesInfo.size(); i++) {
-			sb.append(chD.ImagesText.get(i)).append("<br>");
+		for (int i=imagesShown; i<chD.images.size(); i++) {
+			sb.append(chD.images.get(i).getText()).append("<br>");
 			// Show the additional text if there is one
-			if (chD.ImagesInfo.get(i)!=null) sb.append("<font color='blue'>").append(chD.ImagesInfo.get(i)).append("</font>");
+			if (chD.images.get(i).getComment()!=null) sb.append("<font color='blue'>").append(chD.images.get(i).getComment()).append("</font>");
 			// Only show the image if images are enabled
-			if (Global.getPref().descShowImg) sb.append("<img src=\""+chD.Images.get(i)+"\"><br>");
+			if (Global.getPref().descShowImg) sb.append("<img src=\""+chD.images.get(i).getName()+"\"><br>");
 			sb.append("<br><br><hr>");
 		}
 		return sb.toString();

Added: trunk/src/CacheWolf/ImageInfo.java
===================================================================
--- trunk/src/CacheWolf/ImageInfo.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/ImageInfo.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -0,0 +1,34 @@
+package CacheWolf;
+
+public class ImageInfo {
+	
+	private String name="";
+	private String text="";
+	private String comment=null;
+
+	public String getName() {
+    	return name;
+    }
+	public void setName(String name) {
+    	this.name = name;
+    }
+	public String getText() {
+    	return text;
+    }
+	public void setText(String text) {
+    	this.text = text;
+    }
+	public String getComment() {
+    	return comment;
+    }
+	public void setComment(String comment) {
+		if (comment != null && comment.equals("")) {
+			this.comment = null;
+		} else {
+			this.comment = comment;
+		}
+    }
+	
+	
+	
+}

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/ImagePanel.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -5,7 +5,6 @@
 import ewe.fx.*;
 import ewe.ui.*;
 import ewe.io.*;
-import ewe.util.*;
 
 
 /**
@@ -51,7 +50,7 @@
 			clearImages();
 			thumb_size = ((pref.myAppWidth-2*padding) / 3);
 			thumb_size = thumb_size - padding;
-			int rowCounter = cache.Images.size() + cache.UserImages.size();
+			int rowCounter = cache.images.size() + cache.userImages.size();
 			rowCounter = (rowCounter/3)+1;
 			Rect r = new Rect(0, 0, pref.myAppWidth, rowCounter*thumb_size+rowCounter*padding+padding);
 			this.virtualSize = r;
@@ -62,17 +61,17 @@
 			addTitle(MyLocale.getMsg(340,"Cache Images:"));
 			locY = 20;
 			locX = padding;
-			addImages(cache.Images,cache.ImagesText);
+			addImages(cache.images);
 			// load user images
 			if(locCounter==1 || locCounter ==2) locY = locY + thumb_size;
 			//Vm.debug("thumb_size: " + Convert.toString(thumb_size));
 			//Vm.debug("locy after: " + Convert.toString(locY));
-			if (cache.UserImages.getCount()> 0){
+			if (cache.userImages.size()> 0){
 				addTitle(MyLocale.getMsg(341,"User Images:"));
 				locY = locY + 20;
 				locX = padding;
 				locCounter = 0;
-				addImages(cache.UserImages,cache.UserImagesText);
+				addImages(cache.userImages);
 			}
 			oldCache=cache;
 		} // cache!=oldCache	
@@ -122,7 +121,7 @@
 	 * @param pImages Vector of images or userImages
 	 * @param imagesText Vector of image texts or user image texts
 	 */
-	private void addImages(Vector pImages, Vector imagesText) {
+	private void addImages(CacheImages pImages) {
 		String location, imgText;
 		mImage mI;
 		int scaleX, scaleY;
@@ -131,7 +130,7 @@
 		AniImage AimgText;
 		locCounter=0;
 		for(int i = 0; i<pImages.size(); i++){
-			location = profile.dataDir + (String)pImages.get(i);
+			location = profile.dataDir + pImages.get(i).getName();
 			if (!(new FileBugfix(location)).exists()) {
 				location=NO_IMAGE;
 				if (!pref.showDeletedImages) continue; // Don't show the deleted Image if user does not want it
@@ -169,11 +168,11 @@
 				ipi.setLocation(locX, locY);
 				addImage(ipi);
 				//Name of picture:
-				if(imagesText.size()>i){
+				if(pImages.size()>i){
 					if (location.equals(NO_IMAGE))
 						imgText=MyLocale.getMsg(342,"Deleted");
 					else
-						imgText = SafeXML.cleanback((String)imagesText.get(i));
+						imgText = SafeXML.cleanback(pImages.get(i).getText());
 					if(imgText.length()==0) imgText = "???";
 					AimgText = new AniImage();
 					AimgText = getImageText(imgText);
@@ -276,4 +275,4 @@
 		}
 		super.onPenEvent(ev);
 	}
-}
\ No newline at end of file
+}

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -119,7 +119,7 @@
 					int imageNo=0;
 					Regex imgRex = new Regex("src=(?:\\s*[^\"|']*?)(?:\"|')(.*?)(?:\"|')");
 					while (start>=0 && (pos=chD.getExistingDetails().LongDescription.indexOf("<img",start))>0) {
-						if (imageNo >= chD.getExistingDetails().Images.getCount())break;
+						if (imageNo >= chD.getExistingDetails().images.size())break;
 						s.append(chD.getExistingDetails().LongDescription.substring(start,pos));
 						imgRex.searchFrom(chD.getExistingDetails().LongDescription,pos);
 						String imgUrl=imgRex.stringMatched(1);
@@ -129,7 +129,7 @@
 							// If we have an image which we stored when spidering, we can display it
         					if(imgType.startsWith(".png") || imgType.startsWith(".jpg") || imgType.startsWith(".gif")){
 								s.append("<img src=\"file://"+
-								   Global.getProfile().dataDir+chD.getExistingDetails().Images.get(imageNo)+"\">");
+								   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getName()+"\">");
 								imageNo++;
 							}
 						}
@@ -141,15 +141,15 @@
 					
 					// Do the remaining pictures which are not included in main body of text
 					// They will be hidden initially and can be displayed by clicking on a link
-					if (imageNo<chD.getExistingDetails().Images.size()) {
-						Vector imageVect=new Vector(chD.getExistingDetails().Images.size()-imageNo);
-						for (; imageNo<chD.getExistingDetails().Images.size(); imageNo++) {
+					if (imageNo<chD.getExistingDetails().images.size()) {
+						Vector imageVect=new Vector(chD.getExistingDetails().images.size()-imageNo);
+						for (; imageNo<chD.getExistingDetails().images.size(); imageNo++) {
 							Hashtable imgs=new Hashtable();
 							imgs.put("IMAGE","<img src=\"file://"+
-									   Global.getProfile().dataDir+chD.getExistingDetails().Images.get(imageNo)+"\" border=0>");
-							imgs.put("IMAGETEXT",chD.getExistingDetails().ImagesText.get(imageNo));
-							if (imageNo<chD.getExistingDetails().ImagesInfo.size() && chD.getExistingDetails().ImagesInfo.get(imageNo)!=null)
-								imgs.put("IMAGECOMMENT",chD.getExistingDetails().ImagesInfo.get(imageNo));
+									   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getName()+"\" border=0>");
+							imgs.put("IMAGETEXT",chD.getExistingDetails().images.get(imageNo).getText());
+							if (imageNo<chD.getExistingDetails().images.size() && chD.getExistingDetails().images.get(imageNo).getComment()!=null)
+								imgs.put("IMAGECOMMENT",chD.getExistingDetails().images.get(imageNo).getComment());
 							else
 								imgs.put("IMAGECOMMENT","");
 							imgs.put("I","'img"+new Integer(imageNo).toString()+"'");

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -325,8 +325,8 @@
 						int num = 0;
 						while(ex.endOfSearch() == false && spiderOK == true){
 							//Vm.debug("Replacing: " + text);
-							if (num >= holder.getFreshDetails().ImagesText.getCount())break;
-							imgName = (String)holder.getFreshDetails().ImagesText.get(num);
+							if (num >= holder.getFreshDetails().images.size())break;
+							imgName = holder.getFreshDetails().images.get(num).getText();
 							holder.getFreshDetails().LongDescription = replace(holder.getFreshDetails().LongDescription, text, "[[Image: " + imgName + "]]");
 							num++;
 							text = ex.findNext();

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -9,6 +9,7 @@
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
 import CacheWolf.Common;
+import CacheWolf.ImageInfo;
 import CacheWolf.InfoBox;
 import CacheWolf.Log;
 import CacheWolf.MyLocale;
@@ -461,9 +462,7 @@
 			// clear data (picture, logs) if we do a complete Update
 			if (incUpdate == false){
 				holder.getFreshDetails().CacheLogs.clear();
-				holder.getFreshDetails().Images.clear();
-				holder.getFreshDetails().ImagesText.clear();
-				holder.getFreshDetails().ImagesInfo.clear();
+				holder.getFreshDetails().images.clear();
 			}
 
 			// save all
@@ -588,17 +587,18 @@
 		try {
 			if (!fetchURL.startsWith("http://")) fetchURL = new URL(new URL("http://" + OPENCACHING_HOST+"/"), fetchURL).toString(); // TODO this is not quite correct: actually the "base" URL must be known... but anyway a different baseURL should not happen very often  - it doesn't in my area
 			String fileName = createPicFilename(fetchURL);
+			ImageInfo imageInfo = new ImageInfo();
 			// add title
-			holder.getFreshDetails().ImagesText.add(picDesc);
-			holder.getFreshDetails().ImagesInfo.add(null); // need to stay in sync with ImagesText
+			imageInfo.setText(picDesc);
+			holder.getFreshDetails().images.add(imageInfo);
 			try {
 				File ftest = new File(profile.dataDir + fileName);
 				if (ftest.exists()){
-					holder.getFreshDetails().Images.add(fileName);
+					imageInfo.setName(fileName);
 				}
 				else {
 					if (pref.downloadPics) {
-						holder.getFreshDetails().Images.add(fetch(fetchURL, fileName));
+						imageInfo.setName(fetch(fetchURL, fileName));
 					}
 				}
 			} catch (IOException e) {

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -41,6 +41,7 @@
 import CacheWolf.Extractor;
 import CacheWolf.Global;
 import CacheWolf.HttpConnection;
+import CacheWolf.ImageInfo;
 import CacheWolf.InfoBox;
 import CacheWolf.Log;
 import CacheWolf.LogList;
@@ -727,9 +728,7 @@
 						//int logsz = chD.CacheLogs.size();
 						//chD.CacheLogs.clear();
 						ch.addiWpts.clear();
-						ch.getFreshDetails().Images.clear();
-						ch.getFreshDetails().ImagesText.clear();
-						ch.getFreshDetails().ImagesInfo.clear();
+						ch.getFreshDetails().images.clear();
 
 						if(completeWebPage.indexOf(p.getProp("cacheUnavailable")) >= 0) ch.setAvailable(false);
 						if(completeWebPage.indexOf(p.getProp("cacheArchived")) >= 0) ch.setArchived(true);
@@ -1171,6 +1170,7 @@
 		int imgCounter = 0;
 		String imgName, oldImgName, imgType, imgUrl, imgComment;
 		Vector spideredUrls=new Vector(15);
+		ImageInfo imageInfo;
 		Extractor exImgBlock,exImgComment;
 		int idxUrl; // Index of already spidered Url in list of spideredUrls
 		//========
@@ -1205,19 +1205,21 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
+						imageInfo = new ImageInfo();
 						if (idxUrl<0) { // New image
 							pref.log("Loading image: " + imgUrl+" as "+imgName);
 							spiderImage(imgUrl, imgName+imgType);
-							chD.Images.add(imgName+imgType);
+							imageInfo.setName(imgName+imgType);
 							spideredUrls.add(imgUrl);
 						} else { // Image already spidered as wayPoint_'idxUrl'
 							pref.log("Already loaded image: " + imgUrl);
 							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							chD.Images.add(oldImgName+imgType); // Store name of old image as image to load
+							imageInfo.setName(oldImgName+imgType);
 						}
-						chD.ImagesText.add(imgName); // Keep the image name
-						chD.ImagesInfo.add(null); // Need to stay in synch with ImagesText
+						imageInfo.setText(imgName);
+						imageInfo.setComment(null);
 						imgCounter++;
+						chD.images.add(imageInfo);
 					}
 				} catch (IndexOutOfBoundsException e) {
 					//Vm.debug("IndexOutOfBoundsException not in image span"+e.toString()+"imgURL:"+imgUrl);
@@ -1252,22 +1254,22 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
+						imageInfo = new ImageInfo();
 						if (idxUrl<0) { // New image
-							pref.log("Loading image: " + imgUrl);
+							pref.log("Loading image: " + imgUrl+" as "+imgName);
 							spiderImage(imgUrl, imgName+imgType);
-							chD.Images.add(imgName+imgType);
-						} else { // Image already spidered as wayPoint_ 'idxUrl'
+							imageInfo.setName(imgName+imgType);
+							spideredUrls.add(imgUrl);
+						} else { // Image already spidered as wayPoint_'idxUrl'
 							pref.log("Already loaded image: " + imgUrl);
 							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							chD.Images.add(oldImgName+imgType); // Store name of old image as image to load
+							imageInfo.setName(oldImgName+imgType);
 						}
-						chD.ImagesText.add(exImgName.findNext()); // Keep the image description
+						imageInfo.setText(exImgName.findNext());
 						while (imgComment.startsWith("<br />")) imgComment=imgComment.substring(6);
 						while (imgComment.endsWith("<br />")) imgComment=imgComment.substring(0,imgComment.length()-6);
-						if (imgComment.length()==0)
-							chD.ImagesInfo.add(null);
-						else
-							chD.ImagesInfo.add(imgComment);
+						imageInfo.setComment(imgComment);
+						chD.images.add(imageInfo);
 						imgCounter++;
 					}
 				} catch (IndexOutOfBoundsException e) {
@@ -1291,14 +1293,15 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						if (idxUrl<0) { // New image
+							imageInfo = new ImageInfo();
 							imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 							pref.log("Loading image: " + imgUrl+" as "+imgName);
 							spiderImage(imgUrl, imgName+imgType);
-							chD.Images.add(imgName+imgType);
+							imageInfo.setName(imgName+imgType);
 							spideredUrls.add(imgUrl);
-							chD.ImagesText.add(imgName); // Keep the image name
-							chD.ImagesInfo.add(null);
+							imageInfo.setText(imgName);
 							imgCounter++;
+							chD.images.add(imageInfo);
 						}
 					}
 				} catch (IndexOutOfBoundsException e) {

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2009-07-03 17:10:15 UTC (rev 1977)
+++ trunk/src/exp/HTMLExporter.java	2009-07-03 17:23:32 UTC (rev 1978)
@@ -145,14 +145,11 @@
 							page_tpl.setParam("NOTES", STRreplace.replace(det.getCacheNotes(), "\n","<br>"));
 							
 							cacheImg.clear();
-							for(int j = 0; j<det.Images.size(); j++){
+							for(int j = 0; j<det.images.size(); j++){
 								imgParams = new Hashtable();
-								String imgFile = new String((String)det.Images.get(j));
+								String imgFile = new String(det.images.get(j).getName());
 								imgParams.put("FILE", imgFile);
-								if (j < det.ImagesText.size())
-									imgParams.put("TEXT",det.ImagesText.get(j));
-								else
-									imgParams.put("TEXT",imgFile);
+								imgParams.put("TEXT",det.images.get(j).getText());
 								DataMover.copy(profile.dataDir + imgFile,targetDir + imgFile);
 								cacheImg.add(imgParams);
 							}
@@ -160,14 +157,11 @@
 							
 							// Log images
 							logImg.clear();
-							for(int j = 0; j<det.LogImages.size(); j++){
+							for(int j = 0; j<det.logImages.size(); j++){
 								logImgParams = new Hashtable();
-								String logImgFile = (String) det.LogImages.get(j);
+								String logImgFile = det.logImages.get(j).getName();
 								logImgParams.put("FILE", logImgFile);
-								if (j < det.LogImagesText.size())
-									logImgParams.put("TEXT",det.LogImagesText.get(j));
-								else
-									logImgParams.put("TEXT",logImgFile);
+								logImgParams.put("TEXT",det.logImages.get(j).getText());
 								DataMover.copy(profile.dataDir + logImgFile,targetDir + logImgFile);
 								logImg.add(logImgParams);
 							}
@@ -175,14 +169,11 @@
 							
 							// User images
 							usrImg.clear();
-							for(int j = 0; j<det.UserImages.size(); j++){
+							for(int j = 0; j<det.userImages.size(); j++){
 								usrImgParams = new Hashtable();
-								String usrImgFile = new String((String)det.UserImages.get(j));
+								String usrImgFile = new String(det.userImages.get(j).getName());
 								usrImgParams.put("FILE", usrImgFile);
-								if (j < det.UserImagesText.size())
-									usrImgParams.put("TEXT",det.UserImagesText.get(j));
-								else
-									usrImgParams.put("TEXT",usrImgFile);
+								usrImgParams.put("TEXT",det.userImages.get(j).getText());
 								DataMover.copy(profile.dataDir + usrImgFile,targetDir + usrImgFile);
 								usrImg.add(usrImgParams);
 							}
@@ -297,8 +288,8 @@
 					// image links in the description (eg. because of importing
 					// GPX files). We have to allow for this situation.
 					Object localImageSource = null;
-					if (imageNo < chD.Images.size()) {
-						localImageSource = chD.Images.get(imageNo);
+					if (imageNo < chD.images.size()) {
+						localImageSource = chD.images.get(imageNo).getName();
 					}
 					if (localImageSource == null) localImageSource = imgUrl;
 					s.append("<img src=\""+localImageSource+"\">");
@@ -309,7 +300,7 @@
 			}
 			start=chD.LongDescription.indexOf(">",pos);
 			if (start>=0) start++;
-			if (imageNo >= chD.Images.getCount())break;
+			if (imageNo >= chD.images.size()) break;
 		}
 		if (start>=0) s.append(chD.LongDescription.substring(start));
 		return s.toString();



From engywuck at mail.berlios.de  Fri Jul  3 19:39:00 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 3 Jul 2009 19:39:00 +0200
Subject: [Cachewolf-svn] r1979 - in trunk/src: CacheWolf CacheWolf/imp exp
Message-ID: <200907031739.n63Hd096009713@sheep.berlios.de>

Author: engywuck
Date: 2009-07-03 19:38:45 +0200 (Fri, 03 Jul 2009)
New Revision: 1979

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/CacheImages.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/ImageInfo.java
   trunk/src/CacheWolf/ImagePanel.java
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/exp/HTMLExporter.java
Log:
Adding JavaDoc for new classes and refactoring some method names to more sensible ones.

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -162,8 +162,8 @@
 				imgDestName = getParent().getWayPoint() + "_U_" + (this.userImages.size()+1) + ext;
 				
 				ImageInfo userImageInfo = new ImageInfo();
-				userImageInfo.setName(imgDestName);
-				userImageInfo.setText(imgDesc);
+				userImageInfo.setFilename(imgDestName);
+				userImageInfo.setTitle(imgDesc);
 				this.userImages.add(userImageInfo);
 				// Copy File
 				DataMover.copy(imgFile.getFullPath(),profile.dataDir + imgDestName);
@@ -236,7 +236,7 @@
 			dummy = ex.findNext();
 			while(ex.endOfSearch() == false){
 				imageInfo = new ImageInfo();
-				imageInfo.setName(SafeXML.strxmldecode(dummy));
+				imageInfo.setFilename(SafeXML.strxmldecode(dummy));
 				this.images.add(imageInfo);
 				dummy = ex.findNext();
 			}
@@ -247,10 +247,10 @@
 				imageInfo = this.images.get(imgNr);
 				int pos=dummy.indexOf("<DESC>");
 				if (pos>0) {
-					imageInfo.setText(dummy.substring(0,pos));
+					imageInfo.setTitle(dummy.substring(0,pos));
 					imageInfo.setComment(dummy.substring(pos+6,dummy.indexOf("</DESC>")));
 				} else {
-					imageInfo.setText(dummy);
+					imageInfo.setTitle(dummy);
 				}
 				dummy = ex.findNext();
 				imgNr = imgNr + 1;
@@ -261,7 +261,7 @@
 			dummy = ex.findNext();
 			while(ex.endOfSearch() == false){
 				imageInfo = new ImageInfo();
-				imageInfo.setName(dummy);
+				imageInfo.setFilename(dummy);
 				logImages.add(imageInfo);
 				dummy = ex.findNext();
 			}
@@ -270,7 +270,7 @@
 			imgNr = 0;
 			while(ex.endOfSearch() == false){
 				imageInfo = logImages.get(imgNr++);
-				imageInfo.setText(dummy);
+				imageInfo.setTitle(dummy);
 				dummy = ex.findNext();
 			}
 
@@ -279,7 +279,7 @@
 			dummy = ex.findNext();
 			while(ex.endOfSearch() == false){
 				imageInfo = new ImageInfo();
-				imageInfo.setName(dummy);
+				imageInfo.setFilename(dummy);
 				userImages.add(imageInfo);
 				dummy = ex.findNext();
 			}
@@ -288,7 +288,7 @@
 			imgNr = 0;
 			while(ex.endOfSearch() == false){
 				imageInfo = userImages.get(imgNr++);
-				imageInfo.setText(dummy);
+				imageInfo.setTitle(dummy);
 				dummy = ex.findNext();
 			}
 
@@ -368,12 +368,12 @@
 				  detfile.print("<IMAGES>\n");
 				  String stbuf = new String();
 				  for(int i = 0;i<images.size();i++){
-						stbuf = images.get(i).getName();
+						stbuf = images.get(i).getFilename();
 						detfile.print("    <IMG>"+SafeXML.strxmlencode(stbuf)+"</IMG>\n");
 				  }
 				  int iis = images.size();
 				  for(int i = 0;i<iis;i++){
-						stbuf = images.get(i).getText();
+						stbuf = images.get(i).getTitle();
 						if (i< iis && images.get(i).getComment() != null)
 							detfile.print("    <IMGTEXT>"+stbuf+"<DESC>"+images.get(i).getComment()+"</DESC></IMGTEXT>\n");
 						else 
@@ -381,19 +381,19 @@
 				  }
 
 				  for(int i = 0;i<logImages.size();i++){
-						stbuf = logImages.get(i).getName();
+						stbuf = logImages.get(i).getFilename();
 						detfile.print("    <LOGIMG>"+stbuf+"</LOGIMG>\n");
 				  }
 				  for(int i = 0;i<logImages.size();i++){
-						stbuf = logImages.get(i).getText();
+						stbuf = logImages.get(i).getTitle();
 						detfile.print("    <LOGIMGTEXT>"+stbuf+"</LOGIMGTEXT>\n");
 				  }
 				  for(int i = 0;i<userImages.size();i++){
-						stbuf = userImages.get(i).getName();
+						stbuf = userImages.get(i).getFilename();
 						detfile.print("    <USERIMG>"+stbuf+"</USERIMG>\n");
 				  }
 				  for(int i = 0;i<userImages.size();i++){
-						stbuf = userImages.get(i).getText();
+						stbuf = userImages.get(i).getTitle();
 						detfile.print("    <USERIMGTEXT>"+stbuf+"</USERIMGTEXT>\n");
 				  }
 

Modified: trunk/src/CacheWolf/CacheImages.java
===================================================================
--- trunk/src/CacheWolf/CacheImages.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/CacheImages.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -5,11 +5,18 @@
 
 import ewe.util.Vector;
 
+/**
+ * This class holds the image information of a cache. 
+ * @author torsti
+ *
+ */
 public class CacheImages {
 	
 	public CacheImages(){ // Public Constructor
 	}
 	
+	/** Lazy initialization of the vector: It is created only when needed. If it is not accessed,
+	 * it will stay <code>null</code>.*/
 	private Vector vector=null;
 	private Vector getVector(){
 		if (this.vector==null) {
@@ -18,19 +25,37 @@
 		return this.vector;
 	}
 	
+	/**
+	 * Adds an ImageInfo object to the list of images. The object is always appended in the 
+	 * last position.
+	 * @param img ImageInfo object to add.
+	 */
 	public void add(ImageInfo img) {
         getVector().add(img);
     }
 	
+	/**
+	 * Gets the ImageInfo object at the specified position.
+	 * @param idx Index of object to retrieve.
+	 * @return ImageInfo object
+	 */
 	public ImageInfo get(int idx) {
 		return (ImageInfo) getVector().get(idx);
 	}
 	
+	/**
+	 * Removes all image information.
+	 */
 	public void clear() {
 		if (this.vector!=null) {
 			this.vector.clear();
 		}
 	}
+	
+	/**
+	 * Returns the number of ImageInfo objects in the collection.
+	 * @return Number
+	 */
 	public int size() {
 		if (this.vector == null) {
 			return 0;

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -139,11 +139,11 @@
 		sb.append("<hr><font size=\"+1\" color=\"red\">").append(MyLocale.getMsg(202,"IMAGES").toUpperCase()).append("</font>");
 		sb.append("<br><br>");
 		for (int i=imagesShown; i<chD.images.size(); i++) {
-			sb.append(chD.images.get(i).getText()).append("<br>");
+			sb.append(chD.images.get(i).getTitle()).append("<br>");
 			// Show the additional text if there is one
 			if (chD.images.get(i).getComment()!=null) sb.append("<font color='blue'>").append(chD.images.get(i).getComment()).append("</font>");
 			// Only show the image if images are enabled
-			if (Global.getPref().descShowImg) sb.append("<img src=\""+chD.images.get(i).getName()+"\"><br>");
+			if (Global.getPref().descShowImg) sb.append("<img src=\""+chD.images.get(i).getFilename()+"\"><br>");
 			sb.append("<br><br><hr>");
 		}
 		return sb.toString();

Modified: trunk/src/CacheWolf/ImageInfo.java
===================================================================
--- trunk/src/CacheWolf/ImageInfo.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/ImageInfo.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -1,26 +1,58 @@
 package CacheWolf;
 
+/**
+ * This class is used to hold information about an image in a cache. It may be used for normal 
+ * images, log images and user added images.
+ * @author Engywuck
+ *
+ */
 public class ImageInfo {
 	
-	private String name="";
-	private String text="";
+	private String filename="";
+	private String title="";
 	private String comment=null;
 
-	public String getName() {
-    	return name;
+	/**
+	 * Gets the filename of the image (without path)
+	 * @return Filename
+	 */
+	public String getFilename() {
+    	return filename;
     }
-	public void setName(String name) {
-    	this.name = name;
+	/**
+	 * Sets the filename
+	 * @param filename Well...
+	 */
+	public void setFilename(String filename) {
+    	this.filename = filename;
     }
-	public String getText() {
-    	return text;
+	/**
+	 * Gets the title of the image. 
+	 * @return Title
+	 */
+	public String getTitle() {
+    	return title;
     }
-	public void setText(String text) {
-    	this.text = text;
+	/**
+	 * Sets the image title.
+	 * @param text Image title
+	 */
+	public void setTitle(String text) {
+    	this.title = text;
     }
+	/**
+	 * Gets an additional comment for the image, if there is any. If there is none, then <code>
+	 * null</code> will be returned.
+	 * @return Comment
+	 */
 	public String getComment() {
     	return comment;
     }
+	/**
+	 * Sets the comment of the image. If an empty string is passed, the comment will be set to <code>
+	 * null</code>.
+	 * @param comment Comment
+	 */
 	public void setComment(String comment) {
 		if (comment != null && comment.equals("")) {
 			this.comment = null;
@@ -29,6 +61,4 @@
 		}
     }
 	
-	
-	
 }

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/ImagePanel.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -130,7 +130,7 @@
 		AniImage AimgText;
 		locCounter=0;
 		for(int i = 0; i<pImages.size(); i++){
-			location = profile.dataDir + pImages.get(i).getName();
+			location = profile.dataDir + pImages.get(i).getFilename();
 			if (!(new FileBugfix(location)).exists()) {
 				location=NO_IMAGE;
 				if (!pref.showDeletedImages) continue; // Don't show the deleted Image if user does not want it
@@ -172,7 +172,7 @@
 					if (location.equals(NO_IMAGE))
 						imgText=MyLocale.getMsg(342,"Deleted");
 					else
-						imgText = SafeXML.cleanback(pImages.get(i).getText());
+						imgText = SafeXML.cleanback(pImages.get(i).getTitle());
 					if(imgText.length()==0) imgText = "???";
 					AimgText = new AniImage();
 					AimgText = getImageText(imgText);

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -129,7 +129,7 @@
 							// If we have an image which we stored when spidering, we can display it
         					if(imgType.startsWith(".png") || imgType.startsWith(".jpg") || imgType.startsWith(".gif")){
 								s.append("<img src=\"file://"+
-								   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getName()+"\">");
+								   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getFilename()+"\">");
 								imageNo++;
 							}
 						}
@@ -146,8 +146,8 @@
 						for (; imageNo<chD.getExistingDetails().images.size(); imageNo++) {
 							Hashtable imgs=new Hashtable();
 							imgs.put("IMAGE","<img src=\"file://"+
-									   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getName()+"\" border=0>");
-							imgs.put("IMAGETEXT",chD.getExistingDetails().images.get(imageNo).getText());
+									   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getFilename()+"\" border=0>");
+							imgs.put("IMAGETEXT",chD.getExistingDetails().images.get(imageNo).getTitle());
 							if (imageNo<chD.getExistingDetails().images.size() && chD.getExistingDetails().images.get(imageNo).getComment()!=null)
 								imgs.put("IMAGECOMMENT",chD.getExistingDetails().images.get(imageNo).getComment());
 							else

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -326,7 +326,7 @@
 						while(ex.endOfSearch() == false && spiderOK == true){
 							//Vm.debug("Replacing: " + text);
 							if (num >= holder.getFreshDetails().images.size())break;
-							imgName = holder.getFreshDetails().images.get(num).getText();
+							imgName = holder.getFreshDetails().images.get(num).getTitle();
 							holder.getFreshDetails().LongDescription = replace(holder.getFreshDetails().LongDescription, text, "[[Image: " + imgName + "]]");
 							num++;
 							text = ex.findNext();

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -589,16 +589,16 @@
 			String fileName = createPicFilename(fetchURL);
 			ImageInfo imageInfo = new ImageInfo();
 			// add title
-			imageInfo.setText(picDesc);
+			imageInfo.setTitle(picDesc);
 			holder.getFreshDetails().images.add(imageInfo);
 			try {
 				File ftest = new File(profile.dataDir + fileName);
 				if (ftest.exists()){
-					imageInfo.setName(fileName);
+					imageInfo.setFilename(fileName);
 				}
 				else {
 					if (pref.downloadPics) {
-						imageInfo.setName(fetch(fetchURL, fileName));
+						imageInfo.setFilename(fetch(fetchURL, fileName));
 					}
 				}
 			} catch (IOException e) {

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -1209,14 +1209,14 @@
 						if (idxUrl<0) { // New image
 							pref.log("Loading image: " + imgUrl+" as "+imgName);
 							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setName(imgName+imgType);
+							imageInfo.setFilename(imgName+imgType);
 							spideredUrls.add(imgUrl);
 						} else { // Image already spidered as wayPoint_'idxUrl'
 							pref.log("Already loaded image: " + imgUrl);
 							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							imageInfo.setName(oldImgName+imgType);
+							imageInfo.setFilename(oldImgName+imgType);
 						}
-						imageInfo.setText(imgName);
+						imageInfo.setTitle(imgName);
 						imageInfo.setComment(null);
 						imgCounter++;
 						chD.images.add(imageInfo);
@@ -1258,14 +1258,14 @@
 						if (idxUrl<0) { // New image
 							pref.log("Loading image: " + imgUrl+" as "+imgName);
 							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setName(imgName+imgType);
+							imageInfo.setFilename(imgName+imgType);
 							spideredUrls.add(imgUrl);
 						} else { // Image already spidered as wayPoint_'idxUrl'
 							pref.log("Already loaded image: " + imgUrl);
 							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							imageInfo.setName(oldImgName+imgType);
+							imageInfo.setFilename(oldImgName+imgType);
 						}
-						imageInfo.setText(exImgName.findNext());
+						imageInfo.setTitle(exImgName.findNext());
 						while (imgComment.startsWith("<br />")) imgComment=imgComment.substring(6);
 						while (imgComment.endsWith("<br />")) imgComment=imgComment.substring(0,imgComment.length()-6);
 						imageInfo.setComment(imgComment);
@@ -1297,9 +1297,9 @@
 							imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 							pref.log("Loading image: " + imgUrl+" as "+imgName);
 							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setName(imgName+imgType);
+							imageInfo.setFilename(imgName+imgType);
 							spideredUrls.add(imgUrl);
-							imageInfo.setText(imgName);
+							imageInfo.setTitle(imgName);
 							imgCounter++;
 							chD.images.add(imageInfo);
 						}

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2009-07-03 17:23:32 UTC (rev 1978)
+++ trunk/src/exp/HTMLExporter.java	2009-07-03 17:38:45 UTC (rev 1979)
@@ -147,9 +147,9 @@
 							cacheImg.clear();
 							for(int j = 0; j<det.images.size(); j++){
 								imgParams = new Hashtable();
-								String imgFile = new String(det.images.get(j).getName());
+								String imgFile = new String(det.images.get(j).getFilename());
 								imgParams.put("FILE", imgFile);
-								imgParams.put("TEXT",det.images.get(j).getText());
+								imgParams.put("TEXT",det.images.get(j).getTitle());
 								DataMover.copy(profile.dataDir + imgFile,targetDir + imgFile);
 								cacheImg.add(imgParams);
 							}
@@ -159,9 +159,9 @@
 							logImg.clear();
 							for(int j = 0; j<det.logImages.size(); j++){
 								logImgParams = new Hashtable();
-								String logImgFile = det.logImages.get(j).getName();
+								String logImgFile = det.logImages.get(j).getFilename();
 								logImgParams.put("FILE", logImgFile);
-								logImgParams.put("TEXT",det.logImages.get(j).getText());
+								logImgParams.put("TEXT",det.logImages.get(j).getTitle());
 								DataMover.copy(profile.dataDir + logImgFile,targetDir + logImgFile);
 								logImg.add(logImgParams);
 							}
@@ -171,9 +171,9 @@
 							usrImg.clear();
 							for(int j = 0; j<det.userImages.size(); j++){
 								usrImgParams = new Hashtable();
-								String usrImgFile = new String(det.userImages.get(j).getName());
+								String usrImgFile = new String(det.userImages.get(j).getFilename());
 								usrImgParams.put("FILE", usrImgFile);
-								usrImgParams.put("TEXT",det.userImages.get(j).getText());
+								usrImgParams.put("TEXT",det.userImages.get(j).getTitle());
 								DataMover.copy(profile.dataDir + usrImgFile,targetDir + usrImgFile);
 								usrImg.add(usrImgParams);
 							}
@@ -289,7 +289,7 @@
 					// GPX files). We have to allow for this situation.
 					Object localImageSource = null;
 					if (imageNo < chD.images.size()) {
-						localImageSource = chD.images.get(imageNo).getName();
+						localImageSource = chD.images.get(imageNo).getFilename();
 					}
 					if (localImageSource == null) localImageSource = imgUrl;
 					s.append("<img src=\""+localImageSource+"\">");



From greiol at mail.berlios.de  Fri Jul  3 19:42:29 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 3 Jul 2009 19:42:29 +0200
Subject: [Cachewolf-svn] r1980 - trunk/src/exp
Message-ID: <200907031742.n63HgTor023481@sheep.berlios.de>

Author: greiol
Date: 2009-07-03 19:42:27 +0200 (Fri, 03 Jul 2009)
New Revision: 1980

Modified:
   trunk/src/exp/GpxExportNg.java
Log:
now you can create goi (garmin poi) files as well... cosmetics will be restored later

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-03 17:38:45 UTC (rev 1979)
+++ trunk/src/exp/GpxExportNg.java	2009-07-03 17:42:27 UTC (rev 1980)
@@ -26,12 +26,14 @@
 import ewe.io.IOException;
 import ewe.io.InputStream;
 import ewe.io.PrintWriter;
+import ewe.io.StreamReader;
 import ewe.sys.Convert;
 import ewe.sys.Date;
 import ewe.sys.Handle;
+import ewe.sys.Process;
 import ewe.sys.Vm;
 import ewe.ui.CheckBoxGroup;
-import ewe.ui.ControlConstants;
+import ewe.ui.Control;
 import ewe.ui.ControlEvent;
 import ewe.ui.Event;
 import ewe.ui.Form;
@@ -83,7 +85,7 @@
 			.concat("<keywords>cache, geocache, waypoints</keywords>\n")
 	// TODO: is it worth a second loop?
 	// .concat("<bounds minlat=\"50.91695\" minlon=\"6.876383\" maxlat=\"50.935183\" maxlon=\"6.918817\" />")
-			;
+	;
 
 	final static String GPXCOMPACT = "\t<wpt lat=\"@@WPLAT@@\" lon=\"@@WPLON@@\">\n"
 			.concat("\t\t<time>@@CACHETIME@@T00:00:00</time>\n")
@@ -134,7 +136,7 @@
 	public GpxExportNg() {
 		// do nothing
 	}
-	
+
 	public void doit() {
 		GpxExportNgForm exportOptions;
 		int ret;
@@ -160,47 +162,55 @@
 			final String prefix = exportOptions.getPrefix();
 			final FileChooser fc;
 			ZipFile poiZip = null;
-			
-			if (sendToGarmin) { 
-				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT,Global.getPref().getExportPath(expName+"-GPI"));
+
+			if (sendToGarmin) {
+				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, 
+						Global.getPref().getExportPath(expName + "-GPI"));
 			} else {
-				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT,Global.getPref().getExportPath(expName+"-POI"));
+				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, 
+						Global.getPref().getExportPath(expName + "-POI"));
 			}
-			
+
 			fc.setTitle("Select target directory:");
-			
+
 			if (fc.execute() == FormBase.IDCANCEL)
 				return;
 
 			outDir = fc.getChosenFile().getFullPath();
 			if (sendToGarmin) {
-				Global.getPref().setExportPath(expName+"-GPI", outDir);
+				Global.getPref().setExportPath(expName + "-GPI", outDir);
 			} else {
-				Global.getPref().setExportPath(expName+"-POI", outDir);
+				Global.getPref().setExportPath(expName + "-POI", outDir);
 			}
-			
-			if ((new File(baseDir+"/garminmap.xml")).exists()) {
-				poiMapper=new GarminMap();
+
+			if ((new File(baseDir + "/garminmap.xml")).exists()) {
+				poiMapper = new GarminMap();
 				poiMapper.readGarminMap();
 			} else {
-				//TODO: display warning
-				Global.getPref().log("unable to load garminmap.xml");
+				Global.getPref().log("GPX Export: unable to load garminmap.xml");
+				new MessageBox("Export Error", "unable to load garminmap.xml",
+						FormBase.OKB).execute();
 				return;
 			}
-			
+
 			if (sendToGarmin) {
-				tempDir = baseDir+FileBase.separator+this.getClass().toString();
+				// FIXME: create proper tempdir
+				tempDir = baseDir + File.separator + "GPXExporterNG.tmp";
 				new File(tempDir).mkdir();
 			} else {
 				tempDir = outDir;
-				String tmp[] = new FileBugfix(tempDir).list(prefix + "*.gpx", ewe.io.FileBase.LIST_FILES_ONLY);
-				for (int i=0; i < tmp.length;i++){
-					FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
+				String tmp[] = new FileBugfix(tempDir).list(prefix + "*.gpx",
+						ewe.io.FileBase.LIST_FILES_ONLY);
+				for (int i = 0; i < tmp.length; i++) {
+					FileBugfix tmpFile = new FileBugfix(tempDir
+							+ File.separator + tmp[i]);
 					tmpFile.delete();
 				}
-				tmp = new FileBugfix(tempDir).list(prefix + "*.bmp", ewe.io.FileBase.LIST_FILES_ONLY);
-				for (int i=0; i < tmp.length;i++){
-					FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
+				tmp = new FileBugfix(tempDir).list(prefix + "*.bmp",
+						ewe.io.FileBase.LIST_FILES_ONLY);
+				for (int i = 0; i < tmp.length; i++) {
+					FileBugfix tmpFile = new FileBugfix(tempDir
+							+ File.separator + tmp[i]);
 					tmpFile.delete();
 				}
 			}
@@ -211,11 +221,11 @@
 
 				int expCount = 0;
 				int totalCount = Global.getProfile().cacheDB.countVisible();
-				
+
 				pbf.showMainTask = false;
 				pbf.setTask(h, "Exporting ...");
 				pbf.exec();
-				
+
 				for (int i = 0; i < Global.getProfile().cacheDB.size(); i++) {
 					CacheHolder ch = Global.getProfile().cacheDB.get(i);
 					if (!ch.isVisible()) {
@@ -227,58 +237,107 @@
 					} else {
 						String poiId = poiMapper.getPoiId(ch);
 						if (null == poiId) {
-							Global.getPref().log("unmatched POI ID for "+ch.getWayPoint());
+							Global.getPref().log(
+									"GPX Export: unmatched POI ID for "
+											+ ch.getWayPoint() + " of type "
+											+ ch.getType());
 							exportErrors++;
 						} else {
 							PrintWriter writer;
 							if (fileHandles.containsKey(poiId)) {
 								writer = (PrintWriter) fileHandles.get(poiId);
 							} else {
-								writer = new PrintWriter(new BufferedWriter(new FileWriter(new File(tempDir + FileBase.separator + prefix+poiId+".gpx"))));
+								writer = new PrintWriter(new BufferedWriter(
+										new FileWriter(new File(tempDir
+												+ File.separator + prefix
+												+ poiId + ".gpx"))));
 								fileHandles.put(poiId, writer);
 								writer.print(formatHeader());
 							}
 							writer.print(formatCache(ch));
 						}
-						
+
 					}
 					expCount++;
 					h.progress = (float) expCount / (float) totalCount;
 					h.changed();
 				}
-				
+
 				try {
-					poiZip = new ZipFile (FileBase.getProgramDirectory() + FileBase.separator + "GarminPOI.zip");
+					poiZip = new ZipFile(FileBase.getProgramDirectory()
+							+ File.separator + "GarminPOI.zip");
 				} catch (IOException e) {
-					Global.getPref().log("GPX Export: warning GarminPOI.zip not found", e, Global.getPref().debug);
+					Global.getPref().log(
+							"GPX Export: warning GarminPOI.zip not found", e,
+							Global.getPref().debug);
 					exportErrors++;
 				}
-				
+
+				if (sendToGarmin) {
+					String tmp[] = new FileBugfix(outDir).list(
+							prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
+					for (int i = 0; i < tmp.length; i++) {
+						FileBugfix tmpFile = new FileBugfix(outDir
+								+ File.separator + tmp[i]);
+						tmpFile.delete();
+					}
+				}
+
 				Enumeration keys = fileHandles.keys();
 				while (keys.hasMoreElements()) {
+
 					String key = (String) keys.nextElement();
 					PrintWriter writer = (PrintWriter) fileHandles.get(key);
+
 					writer.print("</gpx>\n");
 					writer.close();
 					if (poiZip != null)
-						if (!copyPoiIcon(outDir,key,prefix,poiZip)) 
+						if (!copyPoiIcon(tempDir, key, prefix, poiZip))
 							exportErrors++;
+
+					// TODO: check with blanks and on windows
+					String gpsBabelCommand = Global.getPref().gpsbabel
+							.concat(" -i gpx -f ")
+							.concat(tempDir + File.separator + prefix + key + ".gpx")
+							.concat(" -o garmin_gpi,sleep=1,category=\"")
+							.concat(prefix + key).concat("\",bitmap=")
+							.concat(tempDir + File.separator + prefix + key	+ ".bmp")
+							.concat(" -F ")
+							.concat(outDir + File.separator + prefix + key + ".gpi");
+
+					if (Global.getPref().debug)
+						Global.getPref().log(gpsBabelCommand);
+
+					Process babelProcess = Vm.exec(gpsBabelCommand);
+					StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
+					while (errorStream.isOpen()) {
+						String errorMsg = errorStream.readALine();
+						if (errorMsg != null) {
+							Global.getPref().log("GPX Export: " + errorMsg);
+							exportErrors++;
+						}
+						try {
+							babelProcess.exitValue();
+							errorStream.close();
+						} catch (IllegalThreadStateException e) {
+							// still running
+						}
+					}
 				}
-				
+
 				if (sendToGarmin) {
-					String tmp[] = new FileBugfix(outDir).list(prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
-					for (int i=0; i < tmp.length;i++){
-						FileBugfix tmpFile = new FileBugfix(tempDir + FileBase.separator + tmp[i]);
+					FileBugfix tmpdir = new FileBugfix(tempDir);
+					String tmp[] = new FileBugfix(tempDir).list(prefix + "*.*",
+							ewe.io.FileBase.LIST_FILES_ONLY);
+					for (int i = 0; i < tmp.length; i++) {
+						FileBugfix tmpFile = new FileBugfix(tempDir	+ File.separator + tmp[i]);
 						tmpFile.delete();
-					}				
-
-					// TODO: create GPI files
-					FileBugfix tmpdir = new FileBugfix(tempDir);
+					}
 					tmpdir.delete();
 				}
-				
+
 				pbf.exit(0);
-				
+
 			} catch (Exception e) {
 				Global.getPref().log("GPX Export: unknown cause for ", e, Global.getPref().debug);
 				exportErrors++;
@@ -286,15 +345,15 @@
 			}
 		} else {
 			if (customIcons) {
-				if ((new File(FileBase.getProgramDirectory()+"/garminmap.xml")).exists()) {
-					poiMapper=new GarminMap();
+				if ((new File(FileBase.getProgramDirectory() + "/garminmap.xml")).exists()) {
+					poiMapper = new GarminMap();
 					poiMapper.readGarminMap();
 				} else {
 					customIcons = false;
 					Global.getPref().log("unable to load garminmap.xml");
 				}
 			}
-			
+
 			if (outType == GPX_PQLIKE) {
 				maxLogs = exportOptions.getMaxLogs();
 				if (maxLogs != Global.getPref().numberOfLogsToExport) {
@@ -302,27 +361,27 @@
 					Global.getPref().dirty = true;
 				}
 			}
-			final File file;	
-			if (! sendToGarmin) {
-				final FileChooser fc = new FileChooser(FileChooserBase.SAVE, 
-					Global.getPref().getExportPath(expName+"-GPX"));
-			
+			final File file;
+			if (!sendToGarmin) {
+				final FileChooser fc = new FileChooser(FileChooserBase.SAVE,
+						Global.getPref().getExportPath(expName + "-GPX"));
+
 				fc.setTitle("Select target GPX file:");
 				fc.addMask("*.gpx");
-			
+
 				if (fc.execute() == FormBase.IDCANCEL)
 					return;
 
 				file = fc.getChosenFile();
-				Global.getPref().setExportPath(expName+"-GPX", file.getPath());
+				Global.getPref()
+						.setExportPath(expName + "-GPX", file.getPath());
 			} else {
 				file = new File("").createTempFile("gpxexport", null, null);
 			}
 			try {
 				ProgressBarForm pbf = new ProgressBarForm();
 				Handle h = new Handle();
-				PrintWriter outp = new PrintWriter(new BufferedWriter(
-						new FileWriter(file)));
+				PrintWriter outp = new PrintWriter(new BufferedWriter(new FileWriter(file)));
 				int expCount = 0;
 				int totalCount = Global.getProfile().cacheDB.countVisible();
 
@@ -338,9 +397,7 @@
 						continue;
 					} else if (ch.is_incomplete()) {
 						exportErrors++;
-						Global.getPref().log(
-								"GPX Export: skipping export of incomplete waypoint "
-										+ ch.getWayPoint());
+						Global.getPref().log("GPX Export: skipping export of incomplete waypoint " + ch.getWayPoint());
 					} else {
 						outp.print(formatCache(ch));
 					}
@@ -356,18 +413,43 @@
 			} catch (Exception ex) {
 				exportErrors++;
 				if (Global.getPref().debug)
-					Global.getPref().log("GPX Export: unable to write output to " + file.toString(),ex,Global.getPref().debug);
+					Global.getPref().log("GPX Export: unable to write output to " + file.toString(), ex, Global.getPref().debug);
 				else
 					Global.getPref().log("GPX Export: unable to write output to " + file.toString());
-				// TODO: give a message to the user
+
+				new MessageBox("Export Error", "unable to write output to "	+ file.toString(), FormBase.OKB).execute();
+				return;
 			}
+
 			if (sendToGarmin) {
 				try {
 					String gpsBabelCommand;
-					gpsBabelCommand = Global.getPref().gpsbabel+" "+Global.getPref().garminGPSBabelOptions+" -i gpx -f "+ file.getCreationName() +" -o garmin -F " + Global.getPref().garminConn +":";
-					if (Global.getPref().debug) Global.getPref().log("GPX Export: gpsbabelcommand is "+ gpsBabelCommand);
-					ewe.sys.Process p = Vm.exec( gpsBabelCommand );
-					p.waitFor();
+					gpsBabelCommand = Global.getPref().gpsbabel
+						.concat(" ")
+						.concat(Global.getPref().garminGPSBabelOptions)
+						.concat(" -i gpx -f ")
+						.concat(file.getCreationName())
+						.concat(" -o garmin -F ")
+						.concat(Global.getPref().garminConn)
+						.concat(":");
+					if (Global.getPref().debug)
+						Global.getPref().log("GPX Export: gpsbabelcommand is "+ gpsBabelCommand);
+					
+					Process babelProcess = Vm.exec(gpsBabelCommand);
+					StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
+					while (errorStream.isOpen()) {
+						String errorMsg = errorStream.readALine();
+						if (errorMsg != null) {
+							Global.getPref().log("GPX Export: " + errorMsg);
+							exportErrors++;
+						}
+						try {
+							babelProcess.exitValue();
+							errorStream.close();
+						} catch (IllegalThreadStateException e) {
+							// still running
+						}
+					}
 				} catch (Exception ex) {
 					Global.getPref().log("GPX Export error :", ex, Global.getPref().debug);
 				}
@@ -375,7 +457,8 @@
 			}
 		}
 		if (exportErrors > 0) {
-			new MessageBox("Export Error", exportErrors+" errors during export. Check log for details.", FormBase.OKB).execute();
+			new MessageBox("Export Error", exportErrors	+ " errors during export. Check log for details.",
+					FormBase.OKB).execute();
 		}
 	}
 
@@ -383,27 +466,28 @@
 		// no addis or custom in MyFindsPq - and of course only finds
 		if ((GPX_MYFINDSPQ == outType) && ((ch.getType() == CacheType.CW_TYPE_CUSTOM) || ch.isAddiWpt() || !ch.is_found()))
 			return "";
-		
-		if (!ch.pos.isValid()) return ""; 
 
+		if (!ch.pos.isValid())
+			return "";
+
 		StringBuffer ret = new StringBuffer();
 
 		try {
 			ret.append(formatCompact(ch));
-		
+
 			if (outType != GPX_COMPACT && !(ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt())) {
 				ret.append(formatPqExtensions(ch));
 			}
-		
+
 			ret.append("\t</wpt>\n");
 		} catch (IllegalArgumentException e) {
 			exportErrors++;
 			ch.setIncomplete(true);
-			Global.getPref().log("GPX Export: "+ch.getWayPoint()+" set to incomplete ", e, Global.getPref().debug);
+			Global.getPref().log("GPX Export: " + ch.getWayPoint() + " set to incomplete ",	e, Global.getPref().debug);
 			return "";
 		} catch (Exception e) {
 			exportErrors++;
-			Global.getPref().log("GPX Export: "+ch.getWayPoint()+" caused ", e, Global.getPref().debug);
+			Global.getPref().log("GPX Export: " + ch.getWayPoint() + " caused ", e,	Global.getPref().debug);
 			return "";
 		}
 
@@ -411,7 +495,7 @@
 	}
 
 	private String formatCompact(CacheHolder ch) {
-		
+
 		Transformer trans = new Transformer(true);
 
 		trans.add(new Regex("@@WPLAT@@", String.valueOf(ch.pos.latDec).replace(',', '.')));
@@ -422,7 +506,7 @@
 			try {
 				trans.add(new Regex("@@CACHETIME@@", ch.mainCache.getDateHidden()));
 			} catch (Exception e) {
-				Global.getPref().log(ch.getWayPoint()+" has no parent");
+				Global.getPref().log(ch.getWayPoint() + " has no parent");
 				trans.add(new Regex("@@CACHETIME@@", "1970-01-01"));
 			}
 		} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
@@ -433,31 +517,29 @@
 
 		if (smartIds && ch.getType() != CacheType.CW_TYPE_CUSTOM) {
 			if (ch.isAddiWpt()) {
-				trans.add(new Regex("@@WPNAME@@", SafeXML.cleanGPX(ch.mainCache.getWayPoint()
-						.concat(" ")
-						.concat(ch.getWayPoint().substring(0, 2))
-						)));
+				trans.add(new Regex("@@WPNAME@@", SafeXML.cleanGPX(
+						ch.mainCache.getWayPoint().concat(" ").concat(ch.getWayPoint().substring(0, 2)))));
 			} else {
-				trans.add(new Regex("@@WPNAME@@", SafeXML.cleanGPX(ch.getWayPoint()
+				trans.add(new Regex("@@WPNAME@@", SafeXML.cleanGPX(
+						ch.getWayPoint()
 						.concat(" ")
 						.concat(CacheType.getExportShortId(ch.getType()))
 						.concat(String.valueOf(ch.getHard()))
 						.concat(String.valueOf(ch.getTerrain()))
-						.concat(CacheSize.getExportShortId(ch.getCacheSize()))
-						)));
+						.concat(CacheSize.getExportShortId(ch.getCacheSize())))));
 			}
 		} else {
 			trans.add(new Regex("@@WPNAME@@", ch.getWayPoint()));
 		}
-		
+
 		if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
 			trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)));
 		} else {
 			if (smartIds && outType == GPX_COMPACT) {
 				if (ch.isAddiWpt()) {
-					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName()+" "+ch.getFreshDetails().LongDescription)));
+					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + ch.getFreshDetails().LongDescription)));
 				} else {
-					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName()+" "+Common.rot13(ch.getFreshDetails().Hints))));
+					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + Common.rot13(ch.getFreshDetails().Hints))));
 				}
 			} else {
 				if (ch.isAddiWpt()) {
@@ -471,13 +553,15 @@
 		if (ch.isAddiWpt()) {
 			trans.add(new Regex("@@WPDESC@@", SafeXML.cleanGPX(ch.getCacheName())));
 		} else {
-			trans.add(new Regex("@@WPDESC@@", SafeXML.cleanGPX(ch.getCacheName()
-					.concat(" by ")
+			trans.add(new Regex("@@WPDESC@@", SafeXML.cleanGPX(
+					ch.getCacheName().concat(" by ")
 					.concat(ch.getCacheOwner())
 					.concat(", ")
 					.concat(CacheType.cw2ExportString(ch.getType()))
-					.concat(" (").concat(CacheTerrDiff.shortDT(ch.getHard()))
-					.concat("/").concat(CacheTerrDiff.shortDT(ch.getTerrain()))
+					.concat(" (")
+					.concat(CacheTerrDiff.shortDT(ch.getHard()))
+					.concat("/")
+					.concat(CacheTerrDiff.shortDT(ch.getTerrain()))
 					.concat(")"))));
 		}
 
@@ -487,14 +571,10 @@
 			if (ch.isAddiWpt()) {
 				// TODO: find out URL schema for additional waypoints
 				// TODO: check for OC caches
-				trans.add(new Regex("@@WPURL@@",
-						"http://www.geocaching.com/seek/wpt.aspx?wp="
-						.concat(ch.getWayPoint())));
+				trans.add(new Regex("@@WPURL@@","http://www.geocaching.com/seek/wpt.aspx?wp=".concat(ch.getWayPoint())));
 			} else {
 				// TODO: check for OC caches
-				trans.add(new Regex("@@WPURL@@",
-						"http://www.geocaching.com/seek/cache_details.aspx?wp="
-						.concat(ch.getWayPoint())));
+				trans.add(new Regex("@@WPURL@@","http://www.geocaching.com/seek/cache_details.aspx?wp=".concat(ch.getWayPoint())));
 			}
 		}
 
@@ -508,9 +588,8 @@
 			trans.add(new Regex("@@WPSYMBOL@@", poiMapper.getIcon(ch)));
 		} else {
 			if (ch.isAddiWpt()) {
-				trans.add(new Regex("@@WPSYMBOL@@", CacheType.id2GpxString(
-					ch.getType()).substring(CacheType.id2GpxString(ch.getType()).indexOf("|") + 1)
-					));
+				trans.add(new Regex("@@WPSYMBOL@@", CacheType.id2GpxString(ch.getType())
+						.substring(CacheType.id2GpxString(ch.getType()).indexOf("|") + 1)));
 			} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
 				trans.add(new Regex("@@WPSYMBOL@@", "Custom"));
 			} else if (ch.is_found()) {
@@ -547,10 +626,8 @@
 		trans.add(new Regex("@@CACHECOUNTRY@@", SafeXML.cleanGPX(ch.details.Country)));
 		trans.add(new Regex("@@CACHESTATE@@", SafeXML.cleanGPX((ch.details.State))));
 		trans.add(new Regex("@@CACHEHTML@@", ch.is_HTML() ? TRUE : FALSE));
-		trans.add(new Regex("@@CACHESHORTDESCRIPTION@@",
-				"CacheWolf can not provide a short description"));
-		trans.add(new Regex("@@CACHELONGDESCRIPTION@@",
-				SafeXML.cleanGPX(formatLongDescription(ch))));
+		trans.add(new Regex("@@CACHESHORTDESCRIPTION@@","CacheWolf can not provide a short description"));
+		trans.add(new Regex("@@CACHELONGDESCRIPTION@@", SafeXML.cleanGPX(formatLongDescription(ch))));
 		trans.add(new Regex("@@CACHEHINT@@", SafeXML.cleanGPX(ch.details.Hints)));
 
 		ret.append(trans.replaceAll(GPXEXTENSION));
@@ -576,25 +653,25 @@
 	public String formatLogs(CacheHolder ch) {
 		LogList logs = ch.getFreshDetails().CacheLogs;
 		StringBuffer ret = new StringBuffer();
-		
+
 		if (0 == logs.size())
 			return "";
-		
+
 		int exportlogs;
-		
+
 		if (outType == GPX_PQLIKE && maxLogs < logs.size()) {
 			exportlogs = maxLogs;
 		} else {
 			exportlogs = logs.size();
 		}
-		
+
 		for (int i = 0; i < exportlogs; i++) {
 			Log log = logs.getLog(i);
-			
+
 			if (outType == GPX_MYFINDSPQ
 					&& !log.getLogger().equals(Global.getPref().myAlias))
 				continue;
-			
+
 			Transformer trans = new Transformer(true);
 			trans.add(new Regex("@@LOGID@@", ""));
 			trans.add(new Regex("@@LOGDATE@@", log.getDate()));
@@ -605,14 +682,13 @@
 			trans.add(new Regex("@@LOGTEXT@@", SafeXML.cleanGPX(log.getMessage())));
 			ret.append(trans.replaceAll(GPXLOG));
 		}
-		
+
 		return ret.toString();
 	}
 
 	public String formatHeader() {
 		Transformer trans = new Transformer(true);
-		trans.add(new Regex("@@CREATEDATE@@", new Date()
-				.setFormat("yyyy-MM-dd").toString()));
+		trans.add(new Regex("@@CREATEDATE@@", new Date().setFormat("yyyy-MM-dd").toString()));
 		return trans.replaceFirst(GPXHEADER);
 	}
 
@@ -644,9 +720,9 @@
 					trans.add(new Regex("@@ADDIID@@", addi.getWayPoint()));
 					trans.add(new Regex("@@ADDISHORT@@", addi.getCacheName()));
 					trans.add(new Regex("@@ADDIDELIM@@", delim));
-					trans.add(new Regex("@@ADDILAT@@", formatAddiLatLon(addi.pos)));
+					trans.add(new Regex("@@ADDILAT@@",formatAddiLatLon(addi.pos)));
 					trans.add(new Regex("@@ADDILON@@", ""));
-					trans.add(new Regex("@@ADDILONG@@", addi.getFreshDetails().LongDescription));
+					trans.add(new Regex("@@ADDILONG@@",addi.getFreshDetails().LongDescription));
 					ret.append(trans.replaceAll(GPXADDIINMAIN));
 				}
 				ret.append(delim).append("\n");
@@ -656,30 +732,48 @@
 	}
 
 	public String image2TypeText(String image) {
-		if (image.equals("icon_smile.gif")) return "Found it";
-		if (image.equals("icon_sad.gif")) return "Didn't find it";
-		if (image.equals("icon_note.gif")) return "Write note";
-		if (image.equals("icon_enabled.gif")) return "Enable Listing";
-		if (image.equals("icon_disabled.gif")) return "Temporarily Disable Listing";
-		if (image.equals("icon_camera.gif")) return "Webcam Photo Taken";
-		if (image.equals("icon_attended.gif")) return "Attended";
-		if (image.equals("icon_greenlight.gif")) return "Publish Listing";
-		if (image.equals("icon_rsvp.gif")) return "Will Attend";
-		if (image.equals("big_smile.gif")) return "Post Reviewer Note";
-		if (image.equals("traffic_cone.gif")) return "Archive";
-		if (image.equals("icon_maint.gif")) return "Owner Maintenance";
-		if (image.equals("icon_needsmaint.gif")) return "Needs Maintenance";
-		if (image.equals("coord_update.gif")) return "Update Coordinates";
-		if (image.equals("icon_remove.gif")) return "Needs Archived";
-		Global.getPref().log("GPX Export: warning - unknown logtype "+image+" was changed to 'Write note'");
+		if (image.equals("icon_smile.gif"))
+			return "Found it";
+		if (image.equals("icon_sad.gif"))
+			return "Didn't find it";
+		if (image.equals("icon_note.gif"))
+			return "Write note";
+		if (image.equals("icon_enabled.gif"))
+			return "Enable Listing";
+		if (image.equals("icon_disabled.gif"))
+			return "Temporarily Disable Listing";
+		if (image.equals("icon_camera.gif"))
+			return "Webcam Photo Taken";
+		if (image.equals("icon_attended.gif"))
+			return "Attended";
+		if (image.equals("icon_greenlight.gif"))
+			return "Publish Listing";
+		if (image.equals("icon_rsvp.gif"))
+			return "Will Attend";
+		if (image.equals("big_smile.gif"))
+			return "Post Reviewer Note";
+		if (image.equals("traffic_cone.gif"))
+			return "Archive";
+		if (image.equals("icon_maint.gif"))
+			return "Owner Maintenance";
+		if (image.equals("icon_needsmaint.gif"))
+			return "Needs Maintenance";
+		if (image.equals("coord_update.gif"))
+			return "Update Coordinates";
+		if (image.equals("icon_remove.gif"))
+			return "Needs Archived";
+		Global.getPref().log("GPX Export: warning - unknown logtype " + image + " was changed to 'Write note'");
 		exportErrors++;
 		return "Write note";
 	}
 
 	/**
 	 * create a position information suitable for a gc.com PQlike export
-	 * @param pos position
-	 * @return if position is valid return the cachewolf formatted position, otherwise return teh string used in PQs
+	 * 
+	 * @param pos
+	 *            position
+	 * @return if position is valid return the cachewolf formatted position,
+	 *         otherwise return teh string used in PQs
 	 */
 	private String formatAddiLatLon(CWPoint pos) {
 		if (pos.isValid()) {
@@ -688,28 +782,32 @@
 			return "N/S  __ ? __ . ___ W/E ___ ? __ . ___";
 		}
 	}
-	
-	boolean copyPoiIcon(String outdir, String type, String prefix, ZipFile poiZip) {
+
+	boolean copyPoiIcon(String outdir, String type, String prefix,
+			ZipFile poiZip) {
 		ZipEntry icon;
 		byte[] buff;
 		int len;
-		
-		try {	
-			icon = poiZip.getEntry(type+".bmp");
-			if (icon == null) return false; // icon not found in archive
-			
-			buff = new byte[ icon.getSize() ];
-			InputStream  fis = poiZip.getInputStream(icon);
-			FileOutputStream fos = new FileOutputStream(outdir.concat(FileBase.separator).concat(prefix).concat(type).concat(".bmp"));
-			while( 0 < (len = fis.read( buff )) ) fos.write( buff, 0, len );
+
+		try {
+			icon = poiZip.getEntry(type + ".bmp");
+			if (icon == null)
+				return false; // icon not found in archive
+
+			buff = new byte[icon.getSize()];
+			InputStream fis = poiZip.getInputStream(icon);
+			FileOutputStream fos = new FileOutputStream(outdir
+					.concat(File.separator).concat(prefix).concat(type).concat(".bmp"));
+			while (0 < (len = fis.read(buff)))
+				fos.write(buff, 0, len);
 			fos.flush();
 			fos.close();
 			fis.close();
 		} catch (ZipException e) {
-			Global.getPref().log("failed to copy icon "+type+".bmp", e, Global.getPref().debug);
+			Global.getPref().log("failed to copy icon " + type + ".bmp", e,Global.getPref().debug);
 			return false;
 		} catch (IOException e) {
-			Global.getPref().log("failed to copy icon "+type+".bmp", e, Global.getPref().debug);
+			Global.getPref().log("failed to copy icon " + type + ".bmp", e,Global.getPref().debug);
 			return false;
 		}
 		return true;
@@ -720,16 +818,15 @@
 	 */
 	private class GpxExportNgForm extends Form {
 		private CheckBoxGroup cbgExportType;
-		private mCheckBox cbCompact, cbPqLike, cbMyFinds, cbCustomIcons,
-				cbSeperateFiles, cbSendToGarmin, cbSmartId;
-		private mInput ibMaxLogs,ibPrefix;
+		private mCheckBox cbCompact, cbPqLike, cbMyFinds, cbCustomIcons,cbSeperateFiles, cbSendToGarmin, cbSmartId;
+		private mInput ibMaxLogs, ibPrefix;
 		private mButton btnOk, btnCancel;
 
 		/**
 		 * set up the form / dialog
 		 */
 		public GpxExportNgForm() {
-			// TODO: get defaults from profile
+			// TODO: get/set defaults from profile
 
 			this.setTitle("GPX Export");
 
@@ -752,14 +849,15 @@
 
 			cbSendToGarmin = new mCheckBox("send to Garmin GPSr");
 			if (Global.getPref().gpsbabel == null)
-				cbSendToGarmin.modify(ControlConstants.Disabled, 0);
+				cbSendToGarmin.modify(Control.Disabled, 0);
 
 			cbSmartId = new mCheckBox("use smart IDs");
-			
+
 			ibPrefix = new mInput("GC-");
-			ibPrefix.modify(ControlConstants.Disabled, 0);
-			ibMaxLogs = new mInput(String.valueOf(Global.getPref().numberOfLogsToExport));
-			ibMaxLogs.modify(ControlConstants.Disabled, 0);
+			ibPrefix.modify(Control.Disabled, 0);
+			ibMaxLogs = new mInput(String
+					.valueOf(Global.getPref().numberOfLogsToExport));
+			ibMaxLogs.modify(Control.Disabled, 0);
 
 			btnOk = new mButton("OK");
 			btnCancel = new mButton("Cancel");
@@ -773,7 +871,7 @@
 			addLast(cbSmartId);
 			addNext(new mLabel("Prefix"));
 			addLast(new mLabel("Max Logs"));
-			
+
 			addNext(ibPrefix);
 			addLast(ibMaxLogs);
 
@@ -790,60 +888,57 @@
 
 				if (ev.target == cbgExportType) {
 					if (cbgExportType.getSelected() == cbCompact) {
-						if (cbCustomIcons.change(0, ControlConstants.Disabled))
+						if (cbCustomIcons.change(0, Control.Disabled))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(0, ControlConstants.Disabled))
+						if (cbSeperateFiles.change(0, Control.Disabled))
 							cbSeperateFiles.repaint();
 						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0,ControlConstants.Disabled))
+							if (cbSendToGarmin.change(0, Control.Disabled))
 								cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, ControlConstants.Disabled))
+						if (cbSmartId.change(0, Control.Disabled))
 							cbSmartId.repaint();
-						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
+						if (ibMaxLogs.change(Control.Disabled, 0))
 							ibMaxLogs.repaint();
 					} else if (cbgExportType.getSelected() == cbPqLike) {
 						cbSeperateFiles.setState(false);
-						if (cbCustomIcons.change(0, ControlConstants.Disabled))
+						if (cbCustomIcons.change(0, Control.Disabled))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
+						if (cbSeperateFiles.change(Control.Disabled, 0))
 							cbSeperateFiles.repaint();
 						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0,ControlConstants.Disabled))
-						 		cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, ControlConstants.Disabled))
+							if (cbSendToGarmin.change(0, Control.Disabled))
+								cbSendToGarmin.repaint();
+						if (cbSmartId.change(0, Control.Disabled))
 							cbSmartId.repaint();
-						if (ibPrefix.change(ControlConstants.Disabled, 0))
+						if (ibPrefix.change(Control.Disabled, 0))
 							ibPrefix.repaint();
-						if (ibMaxLogs.change(ControlConstants.Disabled, 1))
+						if (ibMaxLogs.change(Control.Disabled, 1))
 							ibMaxLogs.repaint();
 					} else if (cbgExportType.getSelected() == cbMyFinds) {
 						cbCustomIcons.setState(false);
 						cbSeperateFiles.setState(false);
 						cbSendToGarmin.setState(false);
 						cbSmartId.setState(false);
-						if (cbCustomIcons.change(ControlConstants.Disabled, 0))
+						if (cbCustomIcons.change(Control.Disabled, 0))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
+						if (cbSeperateFiles.change(Control.Disabled, 0))
 							cbSeperateFiles.repaint();
-						if (cbSendToGarmin.change(ControlConstants.Disabled,0))
+						if (cbSendToGarmin.change(Control.Disabled, 0))
 							cbSendToGarmin.repaint();
-						if (cbSmartId.change(ControlConstants.Disabled, 0))
+						if (cbSmartId.change(Control.Disabled, 0))
 							cbSmartId.repaint();
-						if (ibPrefix.change(ControlConstants.Disabled, 0))
+						if (ibPrefix.change(Control.Disabled, 0))
 							ibPrefix.repaint();
-						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
+						if (ibMaxLogs.change(Control.Disabled, 0))
 							ibMaxLogs.repaint();
 					}
 				} else if (ev.target == cbSeperateFiles) {
 					if (cbSeperateFiles.state) {
-						if (ibPrefix.change(ControlConstants.Disabled, 1)) ibPrefix.repaint();
-						if (cbSendToGarmin.change(ControlConstants.Disabled, 0)) {
-							cbSendToGarmin.setState(false);
-							cbSendToGarmin.repaint();
-						}
+						if (ibPrefix.change(Control.Disabled, 1))
+							ibPrefix.repaint();
 					} else {
-						if (ibPrefix.change(ControlConstants.Disabled, 0)) ibPrefix.repaint();
-						if (cbSendToGarmin.change(0, ControlConstants.Disabled)) cbSendToGarmin.repaint();
+						if (ibPrefix.change(Control.Disabled, 0))
+							ibPrefix.repaint();
 					}
 				} else if (ev.target == btnOk) {
 					if (cbPqLike.state) {
@@ -864,7 +959,7 @@
 					} else {
 						close(1);
 					}
-					
+
 				} else if (ev.target == btnCancel) {
 					close(-1);
 				}
@@ -917,17 +1012,19 @@
 		public boolean getSeparateFiles() {
 			return cbSeperateFiles.state;
 		}
-		
+
 		/**
 		 * get the number of logs to export. used in PQlike export.
+		 * 
 		 * @return number of logs to export
 		 */
 		public int getMaxLogs() {
 			return Convert.parseInt(ibMaxLogs.getText());
 		}
-		
+
 		/**
 		 * get prefix for sepearte file export
+		 * 
 		 * @return prefix for separate file export
 		 */
 		public String getPrefix() {



From greiol at mail.berlios.de  Fri Jul  3 19:56:48 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 3 Jul 2009 19:56:48 +0200
Subject: [Cachewolf-svn] r1981 - trunk/src/exp
Message-ID: <200907031756.n63HumEJ025777@sheep.berlios.de>

Author: greiol
Date: 2009-07-03 19:56:47 +0200 (Fri, 03 Jul 2009)
New Revision: 1981

Modified:
   trunk/src/exp/GpxExportNg.java
Log:
reapplied different load of constants

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-03 17:42:27 UTC (rev 1980)
+++ trunk/src/exp/GpxExportNg.java	2009-07-03 17:56:47 UTC (rev 1981)
@@ -33,7 +33,7 @@
 import ewe.sys.Process;
 import ewe.sys.Vm;
 import ewe.ui.CheckBoxGroup;
-import ewe.ui.Control;
+import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
 import ewe.ui.Event;
 import ewe.ui.Form;
@@ -195,7 +195,7 @@
 
 			if (sendToGarmin) {
 				// FIXME: create proper tempdir
-				tempDir = baseDir + File.separator + "GPXExporterNG.tmp";
+				tempDir = baseDir + FileBase.separator + "GPXExporterNG.tmp";
 				new File(tempDir).mkdir();
 			} else {
 				tempDir = outDir;
@@ -203,14 +203,14 @@
 						ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i = 0; i < tmp.length; i++) {
 					FileBugfix tmpFile = new FileBugfix(tempDir
-							+ File.separator + tmp[i]);
+							+ FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
 				tmp = new FileBugfix(tempDir).list(prefix + "*.bmp",
 						ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i = 0; i < tmp.length; i++) {
 					FileBugfix tmpFile = new FileBugfix(tempDir
-							+ File.separator + tmp[i]);
+							+ FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
 			}
@@ -249,7 +249,7 @@
 							} else {
 								writer = new PrintWriter(new BufferedWriter(
 										new FileWriter(new File(tempDir
-												+ File.separator + prefix
+												+ FileBase.separator + prefix
 												+ poiId + ".gpx"))));
 								fileHandles.put(poiId, writer);
 								writer.print(formatHeader());
@@ -265,7 +265,7 @@
 
 				try {
 					poiZip = new ZipFile(FileBase.getProgramDirectory()
-							+ File.separator + "GarminPOI.zip");
+							+ FileBase.separator + "GarminPOI.zip");
 				} catch (IOException e) {
 					Global.getPref().log(
 							"GPX Export: warning GarminPOI.zip not found", e,
@@ -278,7 +278,7 @@
 							prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
 					for (int i = 0; i < tmp.length; i++) {
 						FileBugfix tmpFile = new FileBugfix(outDir
-								+ File.separator + tmp[i]);
+								+ FileBase.separator + tmp[i]);
 						tmpFile.delete();
 					}
 				}
@@ -298,12 +298,12 @@
 					// TODO: check with blanks and on windows
 					String gpsBabelCommand = Global.getPref().gpsbabel
 							.concat(" -i gpx -f ")
-							.concat(tempDir + File.separator + prefix + key + ".gpx")
+							.concat(tempDir + FileBase.separator + prefix + key + ".gpx")
 							.concat(" -o garmin_gpi,sleep=1,category=\"")
 							.concat(prefix + key).concat("\",bitmap=")
-							.concat(tempDir + File.separator + prefix + key	+ ".bmp")
+							.concat(tempDir + FileBase.separator + prefix + key	+ ".bmp")
 							.concat(" -F ")
-							.concat(outDir + File.separator + prefix + key + ".gpi");
+							.concat(outDir + FileBase.separator + prefix + key + ".gpi");
 
 					if (Global.getPref().debug)
 						Global.getPref().log(gpsBabelCommand);
@@ -330,7 +330,7 @@
 					String tmp[] = new FileBugfix(tempDir).list(prefix + "*.*",
 							ewe.io.FileBase.LIST_FILES_ONLY);
 					for (int i = 0; i < tmp.length; i++) {
-						FileBugfix tmpFile = new FileBugfix(tempDir	+ File.separator + tmp[i]);
+						FileBugfix tmpFile = new FileBugfix(tempDir	+ FileBase.separator + tmp[i]);
 						tmpFile.delete();
 					}
 					tmpdir.delete();
@@ -797,7 +797,7 @@
 			buff = new byte[icon.getSize()];
 			InputStream fis = poiZip.getInputStream(icon);
 			FileOutputStream fos = new FileOutputStream(outdir
-					.concat(File.separator).concat(prefix).concat(type).concat(".bmp"));
+					.concat(FileBase.separator).concat(prefix).concat(type).concat(".bmp"));
 			while (0 < (len = fis.read(buff)))
 				fos.write(buff, 0, len);
 			fos.flush();
@@ -849,15 +849,15 @@
 
 			cbSendToGarmin = new mCheckBox("send to Garmin GPSr");
 			if (Global.getPref().gpsbabel == null)
-				cbSendToGarmin.modify(Control.Disabled, 0);
+				cbSendToGarmin.modify(ControlConstants.Disabled, 0);
 
 			cbSmartId = new mCheckBox("use smart IDs");
 
 			ibPrefix = new mInput("GC-");
-			ibPrefix.modify(Control.Disabled, 0);
+			ibPrefix.modify(ControlConstants.Disabled, 0);
 			ibMaxLogs = new mInput(String
 					.valueOf(Global.getPref().numberOfLogsToExport));
-			ibMaxLogs.modify(Control.Disabled, 0);
+			ibMaxLogs.modify(ControlConstants.Disabled, 0);
 
 			btnOk = new mButton("OK");
 			btnCancel = new mButton("Cancel");
@@ -888,56 +888,56 @@
 
 				if (ev.target == cbgExportType) {
 					if (cbgExportType.getSelected() == cbCompact) {
-						if (cbCustomIcons.change(0, Control.Disabled))
+						if (cbCustomIcons.change(0, ControlConstants.Disabled))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(0, Control.Disabled))
+						if (cbSeperateFiles.change(0, ControlConstants.Disabled))
 							cbSeperateFiles.repaint();
 						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0, Control.Disabled))
+							if (cbSendToGarmin.change(0, ControlConstants.Disabled))
 								cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, Control.Disabled))
+						if (cbSmartId.change(0, ControlConstants.Disabled))
 							cbSmartId.repaint();
-						if (ibMaxLogs.change(Control.Disabled, 0))
+						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
 							ibMaxLogs.repaint();
 					} else if (cbgExportType.getSelected() == cbPqLike) {
 						cbSeperateFiles.setState(false);
-						if (cbCustomIcons.change(0, Control.Disabled))
+						if (cbCustomIcons.change(0, ControlConstants.Disabled))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(Control.Disabled, 0))
+						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
 							cbSeperateFiles.repaint();
 						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0, Control.Disabled))
+							if (cbSendToGarmin.change(0, ControlConstants.Disabled))
 								cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, Control.Disabled))
+						if (cbSmartId.change(0, ControlConstants.Disabled))
 							cbSmartId.repaint();
-						if (ibPrefix.change(Control.Disabled, 0))
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
 							ibPrefix.repaint();
-						if (ibMaxLogs.change(Control.Disabled, 1))
+						if (ibMaxLogs.change(ControlConstants.Disabled, 1))
 							ibMaxLogs.repaint();
 					} else if (cbgExportType.getSelected() == cbMyFinds) {
 						cbCustomIcons.setState(false);
 						cbSeperateFiles.setState(false);
 						cbSendToGarmin.setState(false);
 						cbSmartId.setState(false);
-						if (cbCustomIcons.change(Control.Disabled, 0))
+						if (cbCustomIcons.change(ControlConstants.Disabled, 0))
 							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(Control.Disabled, 0))
+						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
 							cbSeperateFiles.repaint();
-						if (cbSendToGarmin.change(Control.Disabled, 0))
+						if (cbSendToGarmin.change(ControlConstants.Disabled, 0))
 							cbSendToGarmin.repaint();
-						if (cbSmartId.change(Control.Disabled, 0))
+						if (cbSmartId.change(ControlConstants.Disabled, 0))
 							cbSmartId.repaint();
-						if (ibPrefix.change(Control.Disabled, 0))
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
 							ibPrefix.repaint();
-						if (ibMaxLogs.change(Control.Disabled, 0))
+						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
 							ibMaxLogs.repaint();
 					}
 				} else if (ev.target == cbSeperateFiles) {
 					if (cbSeperateFiles.state) {
-						if (ibPrefix.change(Control.Disabled, 1))
+						if (ibPrefix.change(ControlConstants.Disabled, 1))
 							ibPrefix.repaint();
 					} else {
-						if (ibPrefix.change(Control.Disabled, 0))
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
 							ibPrefix.repaint();
 					}
 				} else if (ev.target == btnOk) {



From engywuck at mail.berlios.de  Sat Jul  4 10:17:39 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sat, 4 Jul 2009 10:17:39 +0200
Subject: [Cachewolf-svn] r1982 - trunk/src/CacheWolf
Message-ID: <200907040817.n648HdSG023035@sheep.berlios.de>

Author: engywuck
Date: 2009-07-04 10:17:37 +0200 (Sat, 04 Jul 2009)
New Revision: 1982

Modified:
   trunk/src/CacheWolf/CacheImages.java
   trunk/src/CacheWolf/ImagePanel.java
Log:
Optimizing number of images displayed in the image panel. Images are not shown if there is a second image referring to the same file but with a "real" title. (Example: GC1HNNY)

Modified: trunk/src/CacheWolf/CacheImages.java
===================================================================
--- trunk/src/CacheWolf/CacheImages.java	2009-07-03 17:56:47 UTC (rev 1981)
+++ trunk/src/CacheWolf/CacheImages.java	2009-07-04 08:17:37 UTC (rev 1982)
@@ -12,12 +12,15 @@
  */
 public class CacheImages {
 	
-	public CacheImages(){ // Public Constructor
-	}
-	
 	/** Lazy initialization of the vector: It is created only when needed. If it is not accessed,
 	 * it will stay <code>null</code>.*/
 	private Vector vector=null;
+	/** Images that should display in the image panel */
+	private CacheImages display=null;
+	
+	public CacheImages(){ // Public Constructor
+	}
+		
 	private Vector getVector(){
 		if (this.vector==null) {
 			vector = new Vector(10);
@@ -31,6 +34,7 @@
 	 * @param img ImageInfo object to add.
 	 */
 	public void add(ImageInfo img) {
+		display = null;  // New Image? Force display to get reevaluated 
         getVector().add(img);
     }
 	
@@ -48,6 +52,7 @@
 	 */
 	public void clear() {
 		if (this.vector!=null) {
+			display = null; 
 			this.vector.clear();
 		}
 	}
@@ -63,4 +68,61 @@
 			return this.vector.size();
 		}
 	}
+	
+	/**
+	 * Fills the <code>display</code> collection with the images that really should display
+	 * in the image panel.
+	 */
+	private void checkForDisplayImages() {
+		if (this.size()>1) {
+			display = new CacheImages(/*this.size()*/);
+			for (int i=0; i<this.size(); i++) {
+				boolean shouldDisplay = true;
+				ImageInfo currImg = this.get(i);
+				for (int j=0; j<this.size(); j++) {
+					ImageInfo testImg = this.get(j);
+					if (i==j) continue;
+					if (currImg.getFilename().equals(testImg.getFilename())) {
+						if (currImg.getFilename().startsWith(currImg.getTitle()) &&
+							!testImg.getFilename().startsWith(testImg.getTitle())) {
+							shouldDisplay = false;
+						}
+					}
+				}
+				if (shouldDisplay) display.add(currImg);
+			}
+		}
+	}
+	
+	/**
+	 * Returns a CacheImage collection of the images that should be displayed in the 
+	 * image panel. An image should <b>not</b> be present in this collection if its title is 
+	 * equivalent to its filename and if there is another image referring to the same file but
+	 * with a different title.<br>
+	 * Normally, the results are cached and don't need to be evaluated again. If they should
+	 * be reevaluated for whatever reason, then pass <code>true</code> as parameter.  
+	 * @param forceEvaluation When <code>true</code> the images that should display are
+	 * reexamined.
+	 * @return The CacheImage collection of images. 
+	 */
+	public CacheImages getDisplayImages(boolean forceEvaluation) {
+		if (display == null || forceEvaluation) this.checkForDisplayImages();
+		if (display == null) {
+			return this;
+		} else {
+			return display;
+		}
+	}
+
+	/**
+	 * Returns a CacheImage collection of the images that should be displayed in the 
+	 * image panel. An image should <b>not</b> be present in this collection if its title is 
+	 * equivalent to its filename and if there is another image referring to the same file but
+	 * with a different title.
+	 * @return The CacheImage collection of images. 
+	 */
+	public CacheImages getDisplayImages() {
+		return this.getDisplayImages(false);
+	}
+	
 }
\ No newline at end of file

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2009-07-03 17:56:47 UTC (rev 1981)
+++ trunk/src/CacheWolf/ImagePanel.java	2009-07-04 08:17:37 UTC (rev 1982)
@@ -50,7 +50,7 @@
 			clearImages();
 			thumb_size = ((pref.myAppWidth-2*padding) / 3);
 			thumb_size = thumb_size - padding;
-			int rowCounter = cache.images.size() + cache.userImages.size();
+			int rowCounter = cache.images.getDisplayImages().size() + cache.userImages.size();
 			rowCounter = (rowCounter/3)+1;
 			Rect r = new Rect(0, 0, pref.myAppWidth, rowCounter*thumb_size+rowCounter*padding+padding);
 			this.virtualSize = r;
@@ -61,7 +61,7 @@
 			addTitle(MyLocale.getMsg(340,"Cache Images:"));
 			locY = 20;
 			locX = padding;
-			addImages(cache.images);
+			addImages(cache.images.getDisplayImages());
 			// load user images
 			if(locCounter==1 || locCounter ==2) locY = locY + thumb_size;
 			//Vm.debug("thumb_size: " + Convert.toString(thumb_size));



From engywuck at mail.berlios.de  Sat Jul  4 10:27:18 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sat, 4 Jul 2009 10:27:18 +0200
Subject: [Cachewolf-svn] r1983 - trunk/src/CacheWolf
Message-ID: <200907040827.n648RIS0023975@sheep.berlios.de>

Author: engywuck
Date: 2009-07-04 10:27:17 +0200 (Sat, 04 Jul 2009)
New Revision: 1983

Modified:
   trunk/src/CacheWolf/CacheImages.java
Log:
Commenting and little (!) improvement.

Modified: trunk/src/CacheWolf/CacheImages.java
===================================================================
--- trunk/src/CacheWolf/CacheImages.java	2009-07-04 08:17:37 UTC (rev 1982)
+++ trunk/src/CacheWolf/CacheImages.java	2009-07-04 08:27:17 UTC (rev 1983)
@@ -12,18 +12,25 @@
  */
 public class CacheImages {
 	
+	private int initialSize=10;
 	/** Lazy initialization of the vector: It is created only when needed. If it is not accessed,
 	 * it will stay <code>null</code>.*/
 	private Vector vector=null;
 	/** Images that should display in the image panel */
 	private CacheImages display=null;
 	
-	public CacheImages(){ // Public Constructor
+	public CacheImages(){ // Public constructor
 	}
-		
+
+	public CacheImages(int initialSize) {
+		if (initialSize<0) {
+			throw new IllegalArgumentException("Initial size for CacheImage must be > 0. Value: "+String.valueOf(initialSize));
+		}
+		this.initialSize = initialSize;
+	}
 	private Vector getVector(){
 		if (this.vector==null) {
-			vector = new Vector(10);
+			vector = new Vector(this.initialSize);
 		}
 		return this.vector;
 	}
@@ -75,16 +82,21 @@
 	 */
 	private void checkForDisplayImages() {
 		if (this.size()>1) {
-			display = new CacheImages(/*this.size()*/);
+			display = new CacheImages(this.size());
+			// Loop over every image
 			for (int i=0; i<this.size(); i++) {
 				boolean shouldDisplay = true;
 				ImageInfo currImg = this.get(i);
+				// Now check against every other image
 				for (int j=0; j<this.size(); j++) {
+					if (i==j) continue; // Except same image
 					ImageInfo testImg = this.get(j);
-					if (i==j) continue;
+					// Are the filenames the same?
 					if (currImg.getFilename().equals(testImg.getFilename())) {
+						// Check if other title is better than current one
 						if (currImg.getFilename().startsWith(currImg.getTitle()) &&
 							!testImg.getFilename().startsWith(testImg.getTitle())) {
+							// If yes: Don't show the image
 							shouldDisplay = false;
 						}
 					}



From apreisser at mail.berlios.de  Sat Jul  4 17:15:59 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 4 Jul 2009 17:15:59 +0200
Subject: [Cachewolf-svn] r1984 - trunk/res_noewe/languages
Message-ID: <200907041515.n64FFxxF000111@sheep.berlios.de>

Author: apreisser
Date: 2009-07-04 17:15:56 +0200 (Sat, 04 Jul 2009)
New Revision: 1984

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
Log:
New ErrorMessages for WolfLanguage function crossbearing added

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-07-04 08:27:17 UTC (rev 1983)
+++ trunk/res_noewe/languages/DE.cfg	2009-07-04 15:15:56 UTC (rev 1984)
@@ -471,6 +471,10 @@
 		1737=Speichern
 		1738=Speichern als
 		1739=Winkel muss im Bereich [0;2*PI] sein
+		1740=Kreuzpeilungswinkel m?ssen im Bereich [0;360] sein
+		1741=Kreuzpeilungswinkel m?ssen im Bereich [0;2*PI] sein
+		1742=Abstand der Punkte in der Kreuzpeilung ist zu klein
+		1753=Kreuzpeilung nicht m?glich. Bitte Entwickler auf geoclub.de informieren!
 		1800=Georeferenzierte Karten herunterladen
 		1801=Kacheln herunterladen
 		1802=Download georeferenzierter Karten%0a W%e4hle Onlinedienst:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-07-04 08:27:17 UTC (rev 1983)
+++ trunk/res_noewe/languages/EN.cfg	2009-07-04 15:15:56 UTC (rev 1984)
@@ -471,6 +471,10 @@
 		1737=Save
 		1738=SaveAs
 		1739=Projection degrees must be in interval [0;2*PI]
+		1740=Crossbearing degrees  must be in interval [0;360]
+		1741=Crossbearing degrees  must be in interval [0;2*PI]
+		1742=Crossbearing: distance between points to small
+		1753=Crossbearing calculation failed. Please inform the developers at geoclub.de		
 		1800=Download georeferenced maps
 		1801=Download tiles
 		1802=Download georeferenced maps%0a Select online service:

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-07-04 08:27:17 UTC (rev 1983)
+++ trunk/res_noewe/languages/FR.cfg	2009-07-04 15:15:56 UTC (rev 1984)
@@ -454,6 +454,11 @@
 		1737=Enregistrer
 		1738=Enregistrer sous	
 		1739=Angle doit ?tre dans la domaine [0;2*PI]
+		1739=[Projection degrees must be in interval [0;2*PI]]
+		1740=[Crossbearing degrees  must be in interval [0;360]]
+		1741=[Crossbearing degrees  must be in interval [0;2*PI]]
+		1742=[Crossbearing: distance between points to small]
+		1753=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
 		1800=T%e9l%e9charger des cartes g%e9o-r%e9f%e9renc%e9e
 		1801=T%e9l%e9charger pages
 		1802=T%e9l%e9chargement des cartes g%e9o-r%e9f%e9renc%e9e%0aChoissisez service en ligne:

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-07-04 08:27:17 UTC (rev 1983)
+++ trunk/res_noewe/languages/NL.cfg	2009-07-04 15:15:56 UTC (rev 1984)
@@ -417,6 +417,11 @@
 		1736=Laden
 		1737=Opslaan
 		1738=Opslaan als
+		1739=[Projection degrees must be in interval [0;2*PI]]
+		1740=[Crossbearing degrees  must be in interval [0;360]]
+		1741=[Crossbearing degrees  must be in interval [0;2*PI]]
+		1742=[Crossbearing: distance between points to small]
+		1753=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
 		1800=Downloaden GEO gerelateerde kaarten.
 		1801=Downloaden tegels
 		2000=Exporten GPX



From apreisser at mail.berlios.de  Sat Jul  4 17:17:24 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 4 Jul 2009 17:17:24 +0200
Subject: [Cachewolf-svn] r1985 - trunk/src/CacheWolf
Message-ID: <200907041517.n64FHOxX000175@sheep.berlios.de>

Author: apreisser
Date: 2009-07-04 17:17:23 +0200 (Sat, 04 Jul 2009)
New Revision: 1985

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Function crossbearing (point1, bearing1, point2, bearing2) added. (shortname cb)
Not very well tested. See it as experimental!

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-07-04 15:15:56 UTC (rev 1984)
+++ trunk/src/CacheWolf/Parser.java	2009-07-04 15:17:23 UTC (rev 1985)
@@ -44,15 +44,18 @@
 
 package CacheWolf;
 
-import ewe.util.*;
 import CacheWolf.navi.Metrics;
 import CacheWolf.navi.Navigate;
+import CacheWolf.navi.TransformCoordinates;
 
-import com.stevesoft.ewe_pat.*;
-import ewe.sys.*;
-import java.lang.Double;
+import com.stevesoft.ewe_pat.Regex;
 
+import ewe.sys.Convert;
+import ewe.util.Hashtable;
+import ewe.util.Iterator;
+import ewe.util.Vector;
 
+
 /**
 *	The wolf language parser. New version - January 2007
 *
@@ -144,7 +147,9 @@
     	new fnType("tan","tan",2),
     	new fnType("ucase","uc",2),
     	new fnType("val","val",2),
-     	new fnType("zentrum","center",3)
+     	new fnType("zentrum","center",3),
+    	new fnType("crossbearing","cb",16),
+    	new fnType("cb","cb",16)
      	    	};
 	private static int scanpos = 0;
 	CWPoint cwPt=new CWPoint();
@@ -615,6 +620,85 @@
 		}
 	}
 
+	/**
+	 * Calculates the crossbearing from point1 with bearing 1 and point2 with bearing2
+	 * point1 and point 2 must be different.
+	 * Not very well tested. No guarantee for correct result if any of the distance is greater than 300 kilometers and / or any of the angles in the spherical triangle id greater then 90degrees
+	 * @return
+	 * @throws Exception
+	 */
+	private String funcCrossBearing () throws Exception{
+		//parameters come in reversed order!
+		double degrees2 = popCalcStackAsNumber(-1);
+		String coordinates2 = popCalcStackAsString();
+		double degrees1 = popCalcStackAsNumber(-1);
+		String coordinates1 = popCalcStackAsString();
+
+		//Check parameters
+    	if (degrees1<0 || degrees1>360 || degrees2 < 0 || degrees2 > 360){
+    		if (Global.getPref().solverDegMode){
+    			err(MyLocale.getMsg(1740,"Crossbearing degrees must be in interval [0;360]"));
+    		}
+    		else{
+    			err(MyLocale.getMsg(1741,"Crossbearing degrees must be in interval [0;2*PI]"));
+    		}
+    	}
+    	
+    	double rAN = Global.getPref().solverDegMode ? degrees1 / 180.0
+				* java.lang.Math.PI : degrees1;
+		double rBN = Global.getPref().solverDegMode ? degrees2 / 180.0
+				* java.lang.Math.PI : degrees2;
+
+		CWPoint point1=new CWPoint(coordinates1);
+		CWPoint point2=new CWPoint(coordinates2);
+
+		//Zum besseren Testen ohne Rundungsfehler
+		CWPoint result2 = crossbearingCalculation(point1, point2, rAN, rBN);
+		return result2.toString();
+	}
+	
+	private CWPoint crossbearingCalculation(CWPoint point1, CWPoint point2, double rAN, double rBN) throws Exception {
+		//see german wikipedia keyword vorwaertsschnitt for the calculation.
+		//peilung von a->b
+		//Yes we will make an error, therefore we have to calculate the target-point iteratively.
+		final int maxRadius = 6378;
+    	double distance = point1.getDistance(point2);
+    	if (Math.abs (distance) <= 0.0000000001){
+    		err (MyLocale.getMsg(1742,"Crossbearing: distance between points to small"));
+    	}
+    	double distanceInRad = distance / maxRadius;
+	    double phiAB = point1.getBearing(point2);
+	    if (Global.getPref().solverDegMode) phiAB=phiAB / 180.0 * java.lang.Math.PI;
+	    double phiBA = point2.getBearing(point1);
+	    if (Global.getPref().solverDegMode) phiBA=phiBA / 180.0 * java.lang.Math.PI;
+	    
+	    double psi = phiAB - rAN;
+	    double phi = rBN - phiBA;
+
+	    //calculate projetiondistance
+	    double bInRad = distanceInRad * java.lang.Math.sin(phi) / java.lang.Math.sin(phi+psi);
+	    double b = bInRad * maxRadius ;//* (1-flattening);
+	    double aInRad = distanceInRad * java.lang.Math.sin(psi) / java.lang.Math.sin(phi+psi);
+	    double a = aInRad * maxRadius ;//* (1-flattening);
+	    double phiAN = phiAB - psi;
+	    double phiANDegrees = phiAN * 180.0 / java.lang.Math.PI;
+	    double phiBN = phiBA + phi;
+	    double phiBNDegrees = phiBN * 180.0 / java.lang.Math.PI;
+	    CWPoint result2 = point2.project(phiBNDegrees, a);
+	    CWPoint result = point1.project(phiANDegrees, b);
+	    double errorDistance = result.getDistance(result2);
+	    //if the distance between the points is to large, we will restart the calculation with the new points found.
+	    //since the error is mostly very small these iterations are seldom used and the needed depth is very low.
+	    //First we will make sure, that this calculation will terminate
+	    if (distance < errorDistance){
+    		err (MyLocale.getMsg(1743,"Crossbearing calculation failed. Please inform the developers at geoclub.de"));
+	    }
+	    if (errorDistance * 1000 > 1){
+	    	return crossbearingCalculation(result, result2, rAN, rBN);
+	    }
+		return result2;
+	}
+	
     /** Project a waypoint at some angle and some distance */
     private String funcProject() throws Exception {
     	double distance=popCalcStackAsNumber(0);
@@ -1080,6 +1164,7 @@
 	    else if (funcDef.alias.equals("tan")) calcStack.add(new java.lang.Double(java.lang.Math.tan(makeRadiant(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("uc")) calcStack.add(popCalcStackAsString().toUpperCase());
 	    else if (funcDef.alias.equals("val")) calcStack.add(new java.lang.Double(funcVal(popCalcStackAsString())));
+	    else if (funcDef.alias.equals("cb")) calcStack.add(funcCrossBearing ());
 	    else err(MyLocale.getMsg(1728,"Function not yet implemented: ")+funcName);
 	}
 



From apreisser at mail.berlios.de  Sat Jul  4 17:18:10 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 4 Jul 2009 17:18:10 +0200
Subject: [Cachewolf-svn] r1986 - trunk/src/CacheWolf
Message-ID: <200907041518.n64FIAjT000194@sheep.berlios.de>

Author: apreisser
Date: 2009-07-04 17:18:09 +0200 (Sat, 04 Jul 2009)
New Revision: 1986

Modified:
   trunk/src/CacheWolf/MyLocale.java
Log:
Function for localized texts of help screens in the About-Menue added

Modified: trunk/src/CacheWolf/MyLocale.java
===================================================================
--- trunk/src/CacheWolf/MyLocale.java	2009-07-04 15:17:23 UTC (rev 1985)
+++ trunk/src/CacheWolf/MyLocale.java	2009-07-04 15:18:09 UTC (rev 1986)
@@ -6,6 +6,7 @@
 
 import utils.FileBugfix;
 import ewe.fx.Rect;
+import ewe.io.File;
 import ewe.io.FileBase;
 import ewe.sys.*;
 import ewe.sys.Double;
@@ -307,5 +308,26 @@
 		}
 	}
 
+	/**
+	 * Returns the path to a localized version of a help file
+	 * @param basename
+	 * @return
+	 */
+	public static String getLocalizedFile (String basename){
+		String language = MyLocale.getLocaleLanguage();
+		String programmDirectory = FileBase.getProgramDirectory() + "/";
+		int index = basename.lastIndexOf('.');
+		String prefix = basename.substring(0,index);
+		String suffix = basename.substring(index);
+		File f = new File (programmDirectory, prefix+'_'+language+suffix);
+		if (f.exists()){
+			return f.toString();
+		}
+		else{
+			return new File (programmDirectory,basename).toString();
+		}
+	}
+
+
 }
 



From apreisser at mail.berlios.de  Sat Jul  4 17:18:56 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 4 Jul 2009 17:18:56 +0200
Subject: [Cachewolf-svn] r1987 - trunk/src/CacheWolf
Message-ID: <200907041518.n64FIuMk000219@sheep.berlios.de>

Author: apreisser
Date: 2009-07-04 17:18:55 +0200 (Sat, 04 Jul 2009)
New Revision: 1987

Modified:
   trunk/src/CacheWolf/SolverPanel.java
Log:
Will show localized version of WolfLanguage description in the future

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2009-07-04 15:18:09 UTC (rev 1986)
+++ trunk/src/CacheWolf/SolverPanel.java	2009-07-04 15:18:55 UTC (rev 1987)
@@ -169,7 +169,7 @@
 				processCommand(mText.getText());
 			}
 			if (ev.target==btnWolfLang) {
-				InfoScreen is = new InfoScreen(FileBase.getProgramDirectory() + "/" + "wolflang.html", MyLocale.getMsg(118,"WolfLanguage"), true, pref);
+				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile("wolflang.html"), MyLocale.getMsg(118,"WolfLanguage"), true, pref);
 				is.execute(parent.getFrame(), Gui.CENTER_FRAME);
 			}
 			if (ev.target==btnDegRad) {



From apreisser at mail.berlios.de  Sat Jul  4 17:19:35 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 4 Jul 2009 17:19:35 +0200
Subject: [Cachewolf-svn] r1988 - trunk/src/CacheWolf
Message-ID: <200907041519.n64FJZMZ000254@sheep.berlios.de>

Author: apreisser
Date: 2009-07-04 17:19:34 +0200 (Sat, 04 Jul 2009)
New Revision: 1988

Modified:
   trunk/src/CacheWolf/MainMenu.java
Log:
Will show localized version of WolfLanguage description and other helpscreens of the About-Menue
in the future.

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-07-04 15:18:55 UTC (rev 1987)
+++ trunk/src/CacheWolf/MainMenu.java	2009-07-04 15:19:34 UTC (rev 1988)
@@ -11,6 +11,7 @@
 import ewe.filechooser.FileChooser;
 import ewe.filechooser.FileChooserBase;
 import ewe.fx.Font;
+import ewe.io.File;
 import ewe.io.FileBase;
 import ewe.io.IOException;
 import ewe.sys.Vm;
@@ -662,15 +663,15 @@
 			// "About" pulldown menu
 			///////////////////////////////////////////////////////////////////////
 			if(mev.selectedItem == about){
-				InfoScreen is = new InfoScreen(FileBase.getProgramDirectory() + "/" + "info.html", MyLocale.getMsg(117,"About"),true, pref);
+				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile("info.html"), MyLocale.getMsg(117,"About"),true, pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
 			if(mev.selectedItem == legend){
-				InfoScreen is = new InfoScreen(FileBase.getProgramDirectory() + "/" + "legende.html", MyLocale.getMsg(155,"Legend"),true, pref);
+				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile("legende.html"), MyLocale.getMsg(155,"Legend"),true, pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
 			if(mev.selectedItem == wolflang){
-				InfoScreen is = new InfoScreen(FileBase.getProgramDirectory() + "/" + "wolflang.html", MyLocale.getMsg(118,"WolfLanguage"), true, pref);
+				InfoScreen is = new InfoScreen(MyLocale.getLocalizedFile("wolflang.html"), MyLocale.getMsg(118,"WolfLanguage"), true, pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
 			if(mev.selectedItem == sysinfo){



From salzkammergut at mail.berlios.de  Sat Jul  4 23:59:03 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 4 Jul 2009 23:59:03 +0200
Subject: [Cachewolf-svn] r1989 - trunk/src/CacheWolf
Message-ID: <200907042159.n64Lx3wL003276@sheep.berlios.de>

Author: salzkammergut
Date: 2009-07-04 23:59:00 +0200 (Sat, 04 Jul 2009)
New Revision: 1989

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Parser: Crossbearing: Added check for coordinates as arguments 1 & 3, added test code

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-07-04 15:19:34 UTC (rev 1988)
+++ trunk/src/CacheWolf/Parser.java	2009-07-04 21:59:00 UTC (rev 1989)
@@ -101,6 +101,7 @@
     	new fnType("asin","asin",2),
     	new fnType("atan","atan",2),
       	new fnType("bearing","bearing",4),
+    	new fnType("cb","cb",16),
      	new fnType("centre","center",3),
     	new fnType("center","center",3),
     	new fnType("cls","cls",1),
@@ -108,6 +109,7 @@
     	new fnType("cos","cos",2),
     	new fnType("count","count",4),
      	new fnType("cp","cp",1),
+    	new fnType("crossbearing","cb",16),
     	new fnType("crosstotal","ct",6),
     	new fnType("ct","ct",2),
      	new fnType("curpos","cp",1),
@@ -147,9 +149,7 @@
     	new fnType("tan","tan",2),
     	new fnType("ucase","uc",2),
     	new fnType("val","val",2),
-     	new fnType("zentrum","center",3),
-    	new fnType("crossbearing","cb",16),
-    	new fnType("cb","cb",16)
+     	new fnType("zentrum","center",3)
      	    	};
 	private static int scanpos = 0;
 	CWPoint cwPt=new CWPoint();
@@ -633,6 +633,8 @@
 		String coordinates2 = popCalcStackAsString();
 		double degrees1 = popCalcStackAsNumber(-1);
 		String coordinates1 = popCalcStackAsString();
+		if (!isValidCoord(coordinates1)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordinates1);
+ 		if (!isValidCoord(coordinates2)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordinates2);
 
 		//Check parameters
     	if (degrees1<0 || degrees1>360 || degrees2 < 0 || degrees2 > 360){
@@ -643,7 +645,7 @@
     			err(MyLocale.getMsg(1741,"Crossbearing degrees must be in interval [0;2*PI]"));
     		}
     	}
-    	
+
     	double rAN = Global.getPref().solverDegMode ? degrees1 / 180.0
 				* java.lang.Math.PI : degrees1;
 		double rBN = Global.getPref().solverDegMode ? degrees2 / 180.0
@@ -656,11 +658,16 @@
 		CWPoint result2 = crossbearingCalculation(point1, point2, rAN, rBN);
 		return result2.toString();
 	}
-	
+
 	private CWPoint crossbearingCalculation(CWPoint point1, CWPoint point2, double rAN, double rBN) throws Exception {
 		//see german wikipedia keyword vorwaertsschnitt for the calculation.
 		//peilung von a->b
 		//Yes we will make an error, therefore we have to calculate the target-point iteratively.
+		//Testcode for crossbearing:
+		// MP="S35 47.100 W089 43.200" # MP is centre of circle, could be any waypoint
+		// A=project(MP,0,1000); B=project(MP,120,1000) # Points of equilateral triangle on circle
+		// C1=project(MP,240,1000); C2=cb(A,210 ,B,270)
+		//	C1 "=" C2
 		final int maxRadius = 6378;
     	double distance = point1.getDistance(point2);
     	if (Math.abs (distance) <= 0.0000000001){
@@ -671,7 +678,7 @@
 	    if (Global.getPref().solverDegMode) phiAB=phiAB / 180.0 * java.lang.Math.PI;
 	    double phiBA = point2.getBearing(point1);
 	    if (Global.getPref().solverDegMode) phiBA=phiBA / 180.0 * java.lang.Math.PI;
-	    
+
 	    double psi = phiAB - rAN;
 	    double phi = rBN - phiBA;
 
@@ -698,7 +705,7 @@
 	    }
 		return result2;
 	}
-	
+
     /** Project a waypoint at some angle and some distance */
     private String funcProject() throws Exception {
     	double distance=popCalcStackAsNumber(0);



From araber95 at mail.berlios.de  Sun Jul  5 01:14:51 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun, 5 Jul 2009 01:14:51 +0200
Subject: [Cachewolf-svn] r1990 - trunk/res_noewe/webmapservices
Message-ID: <200907042314.n64NEpl1014290@sheep.berlios.de>

Author: araber95
Date: 2009-07-05 01:14:49 +0200 (Sun, 05 Jul 2009)
New Revision: 1990

Modified:
   trunk/res_noewe/webmapservices/de-th_t25.wms
Log:
changed BoundingBox , Scalefactors, description

Modified: trunk/res_noewe/webmapservices/de-th_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-th_t25.wms	2009-07-04 21:59:00 UTC (rev 1989)
+++ trunk/res_noewe/webmapservices/de-th_t25.wms	2009-07-04 23:14:49 UTC (rev 1990)
@@ -1,6 +1,6 @@
-TakenFromUrl:       http://www.geoproxy.geoportal-th.de
+TakenFromUrl:       http://www.geoproxy.de/?
 GetCapabilitiesUrl: http://www.geoproxy.geoportal-th.de/geoproxy/services?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               de.Th?ringen t25 SF=~1..8
+Name:               de.Thueringen t25 SF=~1..7,9
 MapType:                        topo
 MainUrl:            http://www.geoproxy.geoportal-th.de/geoproxy/services?
 ServiceTypeUrlPart: SERVICE=WMS
@@ -106,7 +106,7 @@
 #LayersUrlPart:     LAYERS=dtk25wies|Gruenland, Flugplatz|11.20028|1.39972
 #LayersUrlPart:     LAYERS=dtk25grbr|Grundriss|11.20028|1.39972
 #LayersUrlPart:     LAYERS=dtkv25babl|Gewaesser|11.20028|1.39972
-#LayersUrlPart:     LAYERS=dtkv25col|DTK25-V Kombination farbig|11.20028|1.39972
+#LayersUrlPart:     LAYERS=dtkv25col|DTK25-V Kombination farbig|11.20028|1,39972
 #LayersUrlPart:     LAYERS=dtkv25rebrv|Relief|11.20028|1.39972
 #LayersUrlPart:     LAYERS=dtkv25schw|Grundriss u. Schrift|11.20028|1.39972
 #LayersUrlPart:     LAYERS=dtkv25wald|Waldflaeche|11.20028|1.39972
@@ -348,11 +348,9 @@
 LayersUrlPart:     LAYERS=dtkv25col
 StylesUrlPart:     STYLES=
 ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 56.0000 E 5.0000
-BoundingBoxButtomRightWGS84: N 47.0000 E 15.0000
-# testen oder
-# ol=N 53.0000 E 9.0000 , ur=N 49.0000 E 13.0000
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
+BoundingBoxTopLeftWGS84: N 51.7 E 10.3
+BoundingBoxButtomRightWGS84: N 50.1 E 12.7
+MinScale:   1
+MaxScale:   12
+RecommendedScale:   2,5
 ImageFileExtension: .png



From engywuck at mail.berlios.de  Sun Jul  5 09:56:26 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 5 Jul 2009 09:56:26 +0200
Subject: [Cachewolf-svn] r1991 - in trunk/src/CacheWolf: . imp
Message-ID: <200907050756.n657uQGb000934@sheep.berlios.de>

Author: engywuck
Date: 2009-07-05 09:56:24 +0200 (Sun, 05 Jul 2009)
New Revision: 1991

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/CacheImages.java
   trunk/src/CacheWolf/ImageInfo.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Image URLs are now saved. Images from geocaching.com are not refetched when updating the cache, as the URLs are unique. Results in a nice improvement of update speed :-) (See http://www.geoclub.de/viewtopic.php?f=40&t=33353)

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-04 23:14:49 UTC (rev 1990)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-05 07:56:24 UTC (rev 1991)
@@ -236,7 +236,13 @@
 			dummy = ex.findNext();
 			while(ex.endOfSearch() == false){
 				imageInfo = new ImageInfo();
-				imageInfo.setFilename(SafeXML.strxmldecode(dummy));
+				int pos=dummy.indexOf("<URL>");
+				if (pos>0) {
+					imageInfo.setFilename(SafeXML.strxmldecode(dummy.substring(0,pos)));
+					imageInfo.setURL(SafeXML.strxmldecode((dummy.substring(pos+5,dummy.indexOf("</URL>")))));
+				} else {
+					imageInfo.setFilename(SafeXML.strxmldecode(dummy));
+				}
 				this.images.add(imageInfo);
 				dummy = ex.findNext();
 			}
@@ -369,7 +375,12 @@
 				  String stbuf = new String();
 				  for(int i = 0;i<images.size();i++){
 						stbuf = images.get(i).getFilename();
-						detfile.print("    <IMG>"+SafeXML.strxmlencode(stbuf)+"</IMG>\n");
+						String urlBuf = images.get(i).getURL();
+						if (urlBuf != null && !urlBuf.equals("")) {
+							detfile.print("    <IMG>"+SafeXML.strxmlencode(stbuf)+"<URL>"+SafeXML.strxmlencode(urlBuf)+"</URL></IMG>\n");
+						} else {
+							detfile.print("    <IMG>"+SafeXML.strxmlencode(stbuf)+"</IMG>\n");
+						}
 				  }
 				  int iis = images.size();
 				  for(int i = 0;i<iis;i++){

Modified: trunk/src/CacheWolf/CacheImages.java
===================================================================
--- trunk/src/CacheWolf/CacheImages.java	2009-07-04 23:14:49 UTC (rev 1990)
+++ trunk/src/CacheWolf/CacheImages.java	2009-07-05 07:56:24 UTC (rev 1991)
@@ -3,6 +3,7 @@
  */
 package CacheWolf;
 
+import utils.FileBugfix;
 import ewe.util.Vector;
 
 /**
@@ -137,4 +138,38 @@
 		return this.getDisplayImages(false);
 	}
 	
+	/**
+	 * Checks if a image of a given URL needs to be spidered. It does <b>not</b> need to be spidered
+	 * if the following conditions meet: <ul>
+	 * <li>The url is from <code>http://img.geocaching.com/cache/</code> or 
+	 * <code>http://img.groundspeak.com/cache/</code>. (Reason: Images at these places don't change - 
+	 * if images change, they get a new url.)</li>
+	 * <li>An image with the given URL is among the images of the caches image object.</li>
+	 * <li>The image is present in the file system.</li>
+	 * </ul> If no spidering is needed, then the <code>ImageInfo</code> object of the equivalent image is
+	 * returned, otherwise (when spidering is needed) <code>null</code> is returned.
+	 * @param pUrl URL to check
+	 * @return ImageInfo object
+	 */
+	public ImageInfo needsSpidering(String pUrl, String pFilename) {
+		String url = pUrl.toLowerCase();
+		ImageInfo result = null;
+		if (this.size() > 0 && 
+				(url.startsWith("http://img.geocaching.com/cache/")
+				 || url.startsWith("http://img.groundspeak.com/cache/"))) {
+			for (int i=0; i<this.size(); i++) {
+				ImageInfo img = this.get(i);
+				if (img.getURL().toLowerCase().equals(url) 
+						&& img.getFilename().equals(pFilename)) {
+					String location = Global.getProfile().dataDir + pFilename;
+					if ((new FileBugfix(location)).exists()) {
+						result = img;
+						break;
+					}
+				}
+			}
+		}
+		return result;
+	}
+	
 }
\ No newline at end of file

Modified: trunk/src/CacheWolf/ImageInfo.java
===================================================================
--- trunk/src/CacheWolf/ImageInfo.java	2009-07-04 23:14:49 UTC (rev 1990)
+++ trunk/src/CacheWolf/ImageInfo.java	2009-07-05 07:56:24 UTC (rev 1991)
@@ -8,15 +8,17 @@
  */
 public class ImageInfo {
 	
-	private String filename="";
-	private String title="";
+	private String filename=null;
+	private String title=null;
 	private String comment=null;
+	private String URL;
 
 	/**
 	 * Gets the filename of the image (without path)
 	 * @return Filename
 	 */
 	public String getFilename() {
+		if (filename == null) return "";
     	return filename;
     }
 	/**
@@ -31,6 +33,7 @@
 	 * @return Title
 	 */
 	public String getTitle() {
+		if (title == null) return "";
     	return title;
     }
 	/**
@@ -60,5 +63,13 @@
 			this.comment = comment;
 		}
     }
+	public String getURL() {
+		if (URL == null) return "";
+    	return URL;
+    }
 	
+	public void setURL(String url) {
+    	URL = url;
+    }
+	
 }

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-04 23:14:49 UTC (rev 1990)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-05 07:56:24 UTC (rev 1991)
@@ -33,6 +33,7 @@
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
 import CacheWolf.CacheHolderDetail;
+import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
@@ -1170,9 +1171,17 @@
 		int imgCounter = 0;
 		String imgName, oldImgName, imgType, imgUrl, imgComment;
 		Vector spideredUrls=new Vector(15);
-		ImageInfo imageInfo;
+		ImageInfo imageInfo=null;
 		Extractor exImgBlock,exImgComment;
 		int idxUrl; // Index of already spidered Url in list of spideredUrls
+		CacheImages lastImages=null;
+		
+		// First: Get current image object of waypoint before spidering images.
+		CacheHolder oldCh = Global.getProfile().cacheDB.get(chD.getParent().getWayPoint());
+		if (oldCh != null) {
+			lastImages = oldCh.getFreshDetails().images;
+		}
+		
 		//========
 		//In the long description
 		//========
@@ -1205,16 +1214,26 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-						imageInfo = new ImageInfo();
-						if (idxUrl<0) { // New image
-							pref.log("Loading image: " + imgUrl+" as "+imgName);
-							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setFilename(imgName+imgType);
+						if (lastImages != null) {
+							imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
+						}
+						if (imageInfo == null) {
+							imageInfo = new ImageInfo();
+							if (idxUrl<0) { // New image
+								pref.log("Loading image: " + imgUrl+" as "+imgName);
+								spiderImage(imgUrl, imgName+imgType);
+								imageInfo.setFilename(imgName+imgType);
+								imageInfo.setURL(imgUrl);
+								spideredUrls.add(imgUrl);
+							} else { // Image already spidered as wayPoint_'idxUrl'
+								pref.log("Already loaded image: " + imgUrl);
+								oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
+								imageInfo.setFilename(oldImgName+imgType);
+								imageInfo.setURL(imgUrl);
+							}
+						} else {
+							pref.log("Already exising image: " + imgUrl);
 							spideredUrls.add(imgUrl);
-						} else { // Image already spidered as wayPoint_'idxUrl'
-							pref.log("Already loaded image: " + imgUrl);
-							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							imageInfo.setFilename(oldImgName+imgType);
 						}
 						imageInfo.setTitle(imgName);
 						imageInfo.setComment(null);
@@ -1254,16 +1273,26 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-						imageInfo = new ImageInfo();
-						if (idxUrl<0) { // New image
-							pref.log("Loading image: " + imgUrl+" as "+imgName);
-							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setFilename(imgName+imgType);
+						if (lastImages != null) {
+							imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
+						}
+						if (imageInfo == null) {
+							imageInfo = new ImageInfo();
+							if (idxUrl<0) { // New image
+								pref.log("Loading image: " + imgUrl+" as "+imgName);
+								spiderImage(imgUrl, imgName+imgType);
+								imageInfo.setFilename(imgName+imgType);
+								imageInfo.setURL(imgUrl);
+								spideredUrls.add(imgUrl);
+							} else { // Image already spidered as wayPoint_'idxUrl'
+								pref.log("Already loaded image: " + imgUrl);
+								oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
+								imageInfo.setFilename(oldImgName+imgType);
+								imageInfo.setURL(imgUrl);
+							}
+						} else {
+							pref.log("Already exising image: " + imgUrl);
 							spideredUrls.add(imgUrl);
-						} else { // Image already spidered as wayPoint_'idxUrl'
-							pref.log("Already loaded image: " + imgUrl);
-							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							imageInfo.setFilename(oldImgName+imgType);
 						}
 						imageInfo.setTitle(exImgName.findNext());
 						while (imgComment.startsWith("<br />")) imgComment=imgComment.substring(6);
@@ -1293,12 +1322,21 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						if (idxUrl<0) { // New image
-							imageInfo = new ImageInfo();
 							imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-							pref.log("Loading image: " + imgUrl+" as "+imgName);
-							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setFilename(imgName+imgType);
-							spideredUrls.add(imgUrl);
+							if (lastImages != null) {
+								imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
+							}
+							if (imageInfo == null) {
+								imageInfo = new ImageInfo();
+								pref.log("Loading image: " + imgUrl+" as "+imgName);
+								spiderImage(imgUrl, imgName+imgType);
+								imageInfo.setFilename(imgName+imgType);
+								imageInfo.setURL(imgUrl);
+								spideredUrls.add(imgUrl);
+							} else {
+								pref.log("Already exising image: " + imgUrl);
+								spideredUrls.add(imgUrl);
+							}
 							imageInfo.setTitle(imgName);
 							imgCounter++;
 							chD.images.add(imageInfo);



From salzkammergut at mail.berlios.de  Sun Jul  5 13:06:53 2009
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 5 Jul 2009 13:06:53 +0200
Subject: [Cachewolf-svn] r1992 - in trunk/src/CacheWolf: . imp
Message-ID: <200907051106.n65B6rJv008868@sheep.berlios.de>

Author: salzkammergut
Date: 2009-07-05 13:06:48 +0200 (Sun, 05 Jul 2009)
New Revision: 1992

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Bugfix Rev 1991

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2009-07-05 07:56:24 UTC (rev 1991)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2009-07-05 11:06:48 UTC (rev 1992)
@@ -9,16 +9,16 @@
 /**
 *	This class shows the long description on a cache.
 *  Test with GC1CC5T - Final
-*            GC19DDX - 
+*            GC19DDX -
 */
 public class DescriptionPanel extends CellPanel{
 	HtmlDisplay disp = new HtmlDisplay();
 	mButton btnPlus, btnMinus;
 	CacheHolder currCache;
-	
+
 	CellPanel buttonP = new CellPanel();
 	CellPanel descP = new CellPanel();
-	
+
 	private String desc;
 
 	public DescriptionPanel(){
@@ -31,7 +31,7 @@
 		this.addLast(buttonP,CellConstants.HSTRETCH,CellConstants.HFILL);
 		clear();
 	}
-	
+
 	/**
          * Set the text to display. Text should be HTML formated.
          */
@@ -93,7 +93,7 @@
         					if(imgType.startsWith(".png") || imgType.startsWith(".jpg") || imgType.startsWith(".gif")){
                                 s.append("<img src=\"" +
                                 // Global.getProfile().dataDir+
-                                        Images.get(imageNo) + "\">");
+                                        Images.get(imageNo).getFilename() + "\">");
                                 imageNo++;
                             }
                         }
@@ -128,7 +128,7 @@
         //}
         currCache = cache;
     }
-	
+
 	/**
 	 * Get the descriptions for the pictures (if they exist)
 	 * @param imagesShown images already shown as part of long description (don't show again)
@@ -148,17 +148,17 @@
 		}
 		return sb.toString();
 	}
-	
+
 	public void clear() {
 		disp.setPlainText("loading ...");
 		currCache = null;
 	}
-	
+
 	/**
 	 * Eventhandler
 	 */
 	public void onEvent(Event ev){
-		
+
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if (ev.target == btnPlus){
 				Font currFont = disp.getFont();

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-05 07:56:24 UTC (rev 1991)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-05 11:06:48 UTC (rev 1992)
@@ -1175,13 +1175,13 @@
 		Extractor exImgBlock,exImgComment;
 		int idxUrl; // Index of already spidered Url in list of spideredUrls
 		CacheImages lastImages=null;
-		
+
 		// First: Get current image object of waypoint before spidering images.
 		CacheHolder oldCh = Global.getProfile().cacheDB.get(chD.getParent().getWayPoint());
 		if (oldCh != null) {
 			lastImages = oldCh.getFreshDetails().images;
 		}
-		
+
 		//========
 		//In the long description
 		//========
@@ -1216,7 +1216,8 @@
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 						if (lastImages != null) {
 							imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
-						}
+						} else
+							imageInfo=null;
 						if (imageInfo == null) {
 							imageInfo = new ImageInfo();
 							if (idxUrl<0) { // New image
@@ -1232,7 +1233,7 @@
 								imageInfo.setURL(imgUrl);
 							}
 						} else {
-							pref.log("Already exising image: " + imgUrl);
+							pref.log("Already existing image: " + imgUrl);
 							spideredUrls.add(imgUrl);
 						}
 						imageInfo.setTitle(imgName);
@@ -1275,7 +1276,8 @@
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 						if (lastImages != null) {
 							imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
-						}
+						} else
+							imageInfo=null;
 						if (imageInfo == null) {
 							imageInfo = new ImageInfo();
 							if (idxUrl<0) { // New image
@@ -1291,7 +1293,7 @@
 								imageInfo.setURL(imgUrl);
 							}
 						} else {
-							pref.log("Already exising image: " + imgUrl);
+							pref.log("Already existing image: " + imgUrl);
 							spideredUrls.add(imgUrl);
 						}
 						imageInfo.setTitle(exImgName.findNext());
@@ -1325,7 +1327,8 @@
 							imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
 							if (lastImages != null) {
 								imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
-							}
+							} else
+								imageInfo=null;
 							if (imageInfo == null) {
 								imageInfo = new ImageInfo();
 								pref.log("Loading image: " + imgUrl+" as "+imgName);
@@ -1334,7 +1337,7 @@
 								imageInfo.setURL(imgUrl);
 								spideredUrls.add(imgUrl);
 							} else {
-								pref.log("Already exising image: " + imgUrl);
+								pref.log("Already existing image: " + imgUrl);
 								spideredUrls.add(imgUrl);
 							}
 							imageInfo.setTitle(imgName);



From engywuck at mail.berlios.de  Sun Jul  5 19:59:24 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 5 Jul 2009 19:59:24 +0200
Subject: [Cachewolf-svn] r1993 - trunk/src/CacheWolf/imp
Message-ID: <200907051759.n65HxON9006747@sheep.berlios.de>

Author: engywuck
Date: 2009-07-05 19:59:23 +0200 (Sun, 05 Jul 2009)
New Revision: 1993

Modified:
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Reverting revisions 1991 and 1992 because of some problems which may appear. I better check it out before it enters the nightly build... 

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-05 11:06:48 UTC (rev 1992)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-05 17:59:23 UTC (rev 1993)
@@ -33,7 +33,6 @@
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
 import CacheWolf.CacheHolderDetail;
-import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
@@ -1171,17 +1170,9 @@
 		int imgCounter = 0;
 		String imgName, oldImgName, imgType, imgUrl, imgComment;
 		Vector spideredUrls=new Vector(15);
-		ImageInfo imageInfo=null;
+		ImageInfo imageInfo;
 		Extractor exImgBlock,exImgComment;
 		int idxUrl; // Index of already spidered Url in list of spideredUrls
-		CacheImages lastImages=null;
-
-		// First: Get current image object of waypoint before spidering images.
-		CacheHolder oldCh = Global.getProfile().cacheDB.get(chD.getParent().getWayPoint());
-		if (oldCh != null) {
-			lastImages = oldCh.getFreshDetails().images;
-		}
-
 		//========
 		//In the long description
 		//========
@@ -1214,27 +1205,16 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-						if (lastImages != null) {
-							imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
-						} else
-							imageInfo=null;
-						if (imageInfo == null) {
-							imageInfo = new ImageInfo();
-							if (idxUrl<0) { // New image
-								pref.log("Loading image: " + imgUrl+" as "+imgName);
-								spiderImage(imgUrl, imgName+imgType);
-								imageInfo.setFilename(imgName+imgType);
-								imageInfo.setURL(imgUrl);
-								spideredUrls.add(imgUrl);
-							} else { // Image already spidered as wayPoint_'idxUrl'
-								pref.log("Already loaded image: " + imgUrl);
-								oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-								imageInfo.setFilename(oldImgName+imgType);
-								imageInfo.setURL(imgUrl);
-							}
-						} else {
-							pref.log("Already existing image: " + imgUrl);
+						imageInfo = new ImageInfo();
+						if (idxUrl<0) { // New image
+							pref.log("Loading image: " + imgUrl+" as "+imgName);
+							spiderImage(imgUrl, imgName+imgType);
+							imageInfo.setFilename(imgName+imgType);
 							spideredUrls.add(imgUrl);
+						} else { // Image already spidered as wayPoint_'idxUrl'
+							pref.log("Already loaded image: " + imgUrl);
+							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
+							imageInfo.setFilename(oldImgName+imgType);
 						}
 						imageInfo.setTitle(imgName);
 						imageInfo.setComment(null);
@@ -1274,27 +1254,16 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-						if (lastImages != null) {
-							imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
-						} else
-							imageInfo=null;
-						if (imageInfo == null) {
-							imageInfo = new ImageInfo();
-							if (idxUrl<0) { // New image
-								pref.log("Loading image: " + imgUrl+" as "+imgName);
-								spiderImage(imgUrl, imgName+imgType);
-								imageInfo.setFilename(imgName+imgType);
-								imageInfo.setURL(imgUrl);
-								spideredUrls.add(imgUrl);
-							} else { // Image already spidered as wayPoint_'idxUrl'
-								pref.log("Already loaded image: " + imgUrl);
-								oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-								imageInfo.setFilename(oldImgName+imgType);
-								imageInfo.setURL(imgUrl);
-							}
-						} else {
-							pref.log("Already existing image: " + imgUrl);
+						imageInfo = new ImageInfo();
+						if (idxUrl<0) { // New image
+							pref.log("Loading image: " + imgUrl+" as "+imgName);
+							spiderImage(imgUrl, imgName+imgType);
+							imageInfo.setFilename(imgName+imgType);
 							spideredUrls.add(imgUrl);
+						} else { // Image already spidered as wayPoint_'idxUrl'
+							pref.log("Already loaded image: " + imgUrl);
+							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
+							imageInfo.setFilename(oldImgName+imgType);
 						}
 						imageInfo.setTitle(exImgName.findNext());
 						while (imgComment.startsWith("<br />")) imgComment=imgComment.substring(6);
@@ -1324,22 +1293,12 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						if (idxUrl<0) { // New image
+							imageInfo = new ImageInfo();
 							imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-							if (lastImages != null) {
-								imageInfo = lastImages.needsSpidering(imgUrl, imgName+imgType);
-							} else
-								imageInfo=null;
-							if (imageInfo == null) {
-								imageInfo = new ImageInfo();
-								pref.log("Loading image: " + imgUrl+" as "+imgName);
-								spiderImage(imgUrl, imgName+imgType);
-								imageInfo.setFilename(imgName+imgType);
-								imageInfo.setURL(imgUrl);
-								spideredUrls.add(imgUrl);
-							} else {
-								pref.log("Already existing image: " + imgUrl);
-								spideredUrls.add(imgUrl);
-							}
+							pref.log("Loading image: " + imgUrl+" as "+imgName);
+							spiderImage(imgUrl, imgName+imgType);
+							imageInfo.setFilename(imgName+imgType);
+							spideredUrls.add(imgUrl);
 							imageInfo.setTitle(imgName);
 							imgCounter++;
 							chD.images.add(imageInfo);


Property changes on: trunk/src/CacheWolf/imp/SpiderGC.java
___________________________________________________________________
Name: svn:mergeinfo
   - 



From greiol at mail.berlios.de  Mon Jul  6 21:25:16 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 6 Jul 2009 21:25:16 +0200
Subject: [Cachewolf-svn] r1994 - trunk/src/CacheWolf/imp
Message-ID: <200907061925.n66JPGBm015015@sheep.berlios.de>

Author: greiol
Date: 2009-07-06 21:25:15 +0200 (Mon, 06 Jul 2009)
New Revision: 1994

Modified:
   trunk/src/CacheWolf/imp/GPXImporter.java
Log:
fixed found date recognition for webcams

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-05 17:59:23 UTC (rev 1993)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-06 19:25:15 UTC (rev 1994)
@@ -278,7 +278,7 @@
 			}
 			if (name.equals("groundspeak:log") || name.equals("log") || name.equals("terra:log") ) {
 				holder.getFreshDetails().CacheLogs.add(new Log(logIcon,logDate,logFinder,logData));
-				if((logIcon.equals("icon_smile.gif") || logIcon.equals("11.png") || logIcon.equals("icon_attended.gif")) && 
+				if((logIcon.equals("icon_smile.gif") || logIcon.equals("icon_camera.gif") || logIcon.equals("icon_attended.gif")) && 
 						  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
 							holder.setCacheStatus(logDate);
 							holder.setFound(true);



From greiol at mail.berlios.de  Mon Jul  6 23:04:22 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 6 Jul 2009 23:04:22 +0200
Subject: [Cachewolf-svn] r1995 - trunk/src/exp
Message-ID: <200907062104.n66L4MLC028798@sheep.berlios.de>

Author: greiol
Date: 2009-07-06 23:04:19 +0200 (Mon, 06 Jul 2009)
New Revision: 1995

Modified:
   trunk/src/exp/GpxExportNg.java
Log:
now works with blanks in path names on windows - still no solution for java on linux and blanks

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-06 19:25:15 UTC (rev 1994)
+++ trunk/src/exp/GpxExportNg.java	2009-07-06 21:04:19 UTC (rev 1995)
@@ -63,14 +63,19 @@
 	final static int GPX_COMPACT = 0;
 	/** export is PQ like */
 	final static int GPX_PQLIKE = 1;
-	/** export follows gc.com myfinds format */
+	/** export follows gc.com MyFinds format */
 	final static int GPX_MYFINDSPQ = 2;
-
+	/** name used as key when storing preferences */
 	final static String expName = "GpxExportNG";
+	/** string representation of true */
 	final static String TRUE = "True";
+	/** string representation of false */
 	final static String FALSE = "False";
+	/** object used to determine custom symbols and POI categories */
 	private static GarminMap poiMapper;
+	/** maximum number of logs to export. can be overwritten with preferences, default unlimited*/
 	private int maxLogs = ewe.math.Number.INTEGER_MAX_VALUE;
+	/** number of errors / warnings during export */
 	private int exportErrors = 0;
 
 	final static String GPXHEADER = "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n"
@@ -295,20 +300,18 @@
 						if (!copyPoiIcon(tempDir, key, prefix, poiZip))
 							exportErrors++;
 
-					// TODO: check with blanks and on windows
-					String gpsBabelCommand = Global.getPref().gpsbabel
-							.concat(" -i gpx -f ")
-							.concat(tempDir + FileBase.separator + prefix + key + ".gpx")
-							.concat(" -o garmin_gpi,sleep=1,category=\"")
-							.concat(prefix + key).concat("\",bitmap=")
-							.concat(tempDir + FileBase.separator + prefix + key	+ ".bmp")
-							.concat(" -F ")
-							.concat(outDir + FileBase.separator + prefix + key + ".gpi");
+					String[] cmdStack = new String[9];
+					cmdStack[0]=Global.getPref().gpsbabel;
+					cmdStack[1]="-i";
+					cmdStack[2]="gpx";
+					cmdStack[3]="-f";
+					cmdStack[4]=tempDir + FileBase.separator + prefix + key + ".gpx";
+					cmdStack[5]="-o";
+					cmdStack[6]="garmin_gpi,sleep=1,category="+prefix + key+",bitmap="+tempDir + FileBase.separator + prefix + key	+ ".bmp";
+					cmdStack[7]="-F";
+					cmdStack[8]=outDir + FileBase.separator + prefix + key + ".gpi";
 
-					if (Global.getPref().debug)
-						Global.getPref().log(gpsBabelCommand);
-
-					Process babelProcess = Vm.exec(gpsBabelCommand);
+					Process babelProcess = startProcess(cmdStack);
 					StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
 					while (errorStream.isOpen()) {
 						String errorMsg = errorStream.readALine();
@@ -423,32 +426,33 @@
 
 			if (sendToGarmin) {
 				try {
-					String gpsBabelCommand;
-					gpsBabelCommand = Global.getPref().gpsbabel
-						.concat(" ")
-						.concat(Global.getPref().garminGPSBabelOptions)
-						.concat(" -i gpx -f ")
-						.concat(file.getCreationName())
-						.concat(" -o garmin -F ")
-						.concat(Global.getPref().garminConn)
-						.concat(":");
-					if (Global.getPref().debug)
-						Global.getPref().log("GPX Export: gpsbabelcommand is "+ gpsBabelCommand);
+					String[] cmdStack = new String[9];
+					cmdStack[0]=Global.getPref().gpsbabel;
+					cmdStack[1]="-i";
+					cmdStack[2]="gpx";
+					cmdStack[3]="-f";
+					cmdStack[4]=file.getCreationName();
+					cmdStack[5]="-o";
+					cmdStack[6]="garmin";
+					cmdStack[7]="-F";
+					cmdStack[8]=Global.getPref().garminConn.concat(":");
 					
-					Process babelProcess = Vm.exec(gpsBabelCommand);
-					StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
-					while (errorStream.isOpen()) {
-						String errorMsg = errorStream.readALine();
-						if (errorMsg != null) {
-							Global.getPref().log("GPX Export: " + errorMsg);
-							exportErrors++;
+					Process babelProcess = this.startProcess(cmdStack);
+					if (babelProcess != null) {
+						StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
+						while (errorStream.isOpen()) {
+							String errorMsg = errorStream.readALine();
+							if (errorMsg != null) {
+								Global.getPref().log("GPX Export: " + errorMsg);
+								exportErrors++;
+							}
+							try {
+								babelProcess.exitValue();
+								errorStream.close();
+							} catch (IllegalThreadStateException e) {
+								// still running
+							}
 						}
-						try {
-							babelProcess.exitValue();
-							errorStream.close();
-						} catch (IllegalThreadStateException e) {
-							// still running
-						}
 					}
 				} catch (Exception ex) {
 					Global.getPref().log("GPX Export error :", ex, Global.getPref().debug);
@@ -462,6 +466,11 @@
 		}
 	}
 
+	/**
+	 * wrapper for formatting a cache. will call some subroutines to do the actual work
+	 * @param ch
+	 * @return
+	 */
 	private String formatCache(CacheHolder ch) {
 		// no addis or custom in MyFindsPq - and of course only finds
 		if ((GPX_MYFINDSPQ == outType) && ((ch.getType() == CacheType.CW_TYPE_CUSTOM) || ch.isAddiWpt() || !ch.is_found()))
@@ -494,6 +503,11 @@
 		return ret.toString();
 	}
 
+	/**
+	 * generate minimal waypoint information according to GPX specification
+	 * @param ch
+	 * @return
+	 */
 	private String formatCompact(CacheHolder ch) {
 
 		Transformer trans = new Transformer(true);
@@ -604,6 +618,11 @@
 		return trans.replaceFirst(GPXCOMPACT);
 	}
 
+	/**
+	 * format gc.com extended cache information as found in a PQ
+	 * @param ch cacheholder
+	 * @return formatted cache information for cache waypoints or emty string for all other waypoints (additional / custom)
+	 */
 	private String formatPqExtensions(CacheHolder ch) {
 		// no details pq details for addis or custom waypoints
 		if (ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt())
@@ -644,12 +663,22 @@
 		return ret.toString();
 	}
 
+	/**
+	 * format TB information as found in a gc.com GPX file
+	 * @param ch cacheholder containing TB information
+	 * @return
+	 */
 	public String formatTbs(CacheHolder ch) {
 		Transformer trans = new Transformer(true);
 		return "";
 		// return trans.replaceFirst(GPXTB);
 	}
 
+	/**
+	 * format cache logs as found in a gc.com GPX file
+	 * @param ch cacheholder containing the logs
+	 * @return formatted logs or empty string if no logs are present
+	 */
 	public String formatLogs(CacheHolder ch) {
 		LogList logs = ch.getFreshDetails().CacheLogs;
 		StringBuffer ret = new StringBuffer();
@@ -686,12 +715,21 @@
 		return ret.toString();
 	}
 
+	/**
+	 * format the header of the GPX file
+	 * @return
+	 */
 	public String formatHeader() {
 		Transformer trans = new Transformer(true);
 		trans.add(new Regex("@@CREATEDATE@@", new Date().setFormat("yyyy-MM-dd").toString()));
 		return trans.replaceFirst(GPXHEADER);
 	}
 
+	/**
+	 * format a long description as found in the gc.com GPX files
+	 * @param ch cacheholder to format
+	 * @return formatted output
+	 */
 	public String formatLongDescription(CacheHolder ch) {
 		if (ch.isAddiWpt() || ch.getType() == CacheType.CW_TYPE_CUSTOM) {
 			return ch.details.LongDescription;
@@ -706,7 +744,7 @@
 			}
 			// FIXME: format is not quite right yet
 			// FIXME: cut Addis off in GPXimporter otherwise people who use GPX to feed CacheWolf have them doubled
-			if (ch.addiWpts.size() > 0) {
+			if (ch.addiWpts.size() > 0 && outType != GPX_MYFINDSPQ) {
 				if (ch.is_HTML()) {
 					ret.append("\n\n<p>Additional Waypoints</p>");
 				} else {
@@ -783,8 +821,15 @@
 		}
 	}
 
-	boolean copyPoiIcon(String outdir, String type, String prefix,
-			ZipFile poiZip) {
+	/**
+	 * copy the bitmap identified by <code>prefix</code> and <code>type</code> from <code>poiZip</code> to <code>outdir</code>
+	 * @param outdir
+	 * @param type
+	 * @param prefix
+	 * @param poiZip
+	 * @return true on success, false otherwise
+	 */
+	boolean copyPoiIcon(String outdir, String type, String prefix, ZipFile poiZip) {
 		ZipEntry icon;
 		byte[] buff;
 		int len;
@@ -812,6 +857,35 @@
 		}
 		return true;
 	}
+	
+	/**
+	 * Execute the command defined by cmd
+	 * @param cmd command and options to execute. if command or options include a space quatation marks are added. this will not wirk with the java version on unix systems
+	 * @return a handle to the process on success or null otherwise
+	 */
+	Process startProcess(String[] cmd) {
+		String command = "";
+		if (cmd.length == 0) {
+			exportErrors++;
+			Global.getPref().log("GPX Export: empty gpsbabel command");
+			return null;
+		}
+		
+		for (int i = 0; i < cmd.length; i++) {
+			if (cmd[i].indexOf(" ") > -1) {
+				cmd[i]="\""+cmd[i]+"\"";
+			}
+			command = command.concat(cmd[i]).concat(" ");
+		}
+		
+		try {
+			return Vm.exec(command);
+		} catch (IOException e) {
+			Global.getPref().log("error excuting "+command, e, Global.getPref().debug);
+			exportErrors++;
+			return null;
+		}
+	}
 
 	/**
 	 * dialog to set the GPX exporter options



From greiol at mail.berlios.de  Mon Jul  6 23:22:37 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 6 Jul 2009 23:22:37 +0200
Subject: [Cachewolf-svn] r1996 - trunk/res_noewe
Message-ID: <200907062122.n66LMbKZ031164@sheep.berlios.de>

Author: greiol
Date: 2009-07-06 23:22:36 +0200 (Mon, 06 Jul 2009)
New Revision: 1996

Added:
   trunk/res_noewe/CacheWolf.sh
Log:
added cachewolf startscript for java version on unix systems

Added: trunk/res_noewe/CacheWolf.sh
===================================================================
--- trunk/res_noewe/CacheWolf.sh	2009-07-06 21:04:19 UTC (rev 1995)
+++ trunk/res_noewe/CacheWolf.sh	2009-07-06 21:22:36 UTC (rev 1996)
@@ -0,0 +1,4 @@
+#!/bin/sh
+
+cd "$(dirname "$0")"
+java -jar CacheWolf.jar &



From engywuck at mail.berlios.de  Tue Jul  7 19:10:15 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Tue, 7 Jul 2009 19:10:15 +0200
Subject: [Cachewolf-svn] r1997 - in trunk/src/CacheWolf: . imp
Message-ID: <200907071710.n67HAFmS018861@sheep.berlios.de>

Author: engywuck
Date: 2009-07-07 19:10:05 +0200 (Tue, 07 Jul 2009)
New Revision: 1997

Modified:
   trunk/src/CacheWolf/CacheImages.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/ImagePanel.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
After some enhancements and bug fixes: Now images are reused if a cache is updated and the same image (from geocaching) is already known to the cache.
Also fixed a bug where image spidering didn't work corretly (GCQYV9), due to excessive use of same image links in multiple places in the cache description. Because of this bugfix image files for GC are now named continously, without gaps. 
Also new: When an image is no longer needed after a cache update, it is deleted. 
(http://www.geoclub.de/viewtopic.php?f=40&t=33353)

Modified: trunk/src/CacheWolf/CacheImages.java
===================================================================
--- trunk/src/CacheWolf/CacheImages.java	2009-07-06 21:22:36 UTC (rev 1996)
+++ trunk/src/CacheWolf/CacheImages.java	2009-07-07 17:10:05 UTC (rev 1997)
@@ -4,6 +4,7 @@
 package CacheWolf;
 
 import utils.FileBugfix;
+import ewe.io.File;
 import ewe.util.Vector;
 
 /**
@@ -80,8 +81,9 @@
 	/**
 	 * Fills the <code>display</code> collection with the images that really should display
 	 * in the image panel.
+	 * @param prefix The prefix which is used to name default image titles
 	 */
-	private void checkForDisplayImages() {
+	private void checkForDisplayImages(String prefix) {
 		if (this.size()>1) {
 			display = new CacheImages(this.size());
 			// Loop over every image
@@ -95,8 +97,8 @@
 					// Are the filenames the same?
 					if (currImg.getFilename().equals(testImg.getFilename())) {
 						// Check if other title is better than current one
-						if (currImg.getFilename().startsWith(currImg.getTitle()) &&
-							!testImg.getFilename().startsWith(testImg.getTitle())) {
+						if (currImg.getTitle().startsWith(prefix) &&
+							!testImg.getTitle().startsWith(prefix)) {
 							// If yes: Don't show the image
 							shouldDisplay = false;
 						}
@@ -110,16 +112,17 @@
 	/**
 	 * Returns a CacheImage collection of the images that should be displayed in the 
 	 * image panel. An image should <b>not</b> be present in this collection if its title is 
-	 * equivalent to its filename and if there is another image referring to the same file but
+	 * starting with the indicated prefix and if there is another image referring to the same file but
 	 * with a different title.<br>
 	 * Normally, the results are cached and don't need to be evaluated again. If they should
 	 * be reevaluated for whatever reason, then pass <code>true</code> as parameter.  
+	 * @param prefix The prefix which is used to name default image titles
 	 * @param forceEvaluation When <code>true</code> the images that should display are
 	 * reexamined.
 	 * @return The CacheImage collection of images. 
 	 */
-	public CacheImages getDisplayImages(boolean forceEvaluation) {
-		if (display == null || forceEvaluation) this.checkForDisplayImages();
+	public CacheImages getDisplayImages(String prefix, boolean forceEvaluation) {
+		if (display == null || forceEvaluation) this.checkForDisplayImages(prefix);
 		if (display == null) {
 			return this;
 		} else {
@@ -132,10 +135,11 @@
 	 * image panel. An image should <b>not</b> be present in this collection if its title is 
 	 * equivalent to its filename and if there is another image referring to the same file but
 	 * with a different title.
+	 * @param prefix The prefix which is used to name default image titles
 	 * @return The CacheImage collection of images. 
 	 */
-	public CacheImages getDisplayImages() {
-		return this.getDisplayImages(false);
+	public CacheImages getDisplayImages(String prefix) {
+		return this.getDisplayImages(prefix, false);
 	}
 	
 	/**
@@ -145,21 +149,21 @@
 	 * <code>http://img.groundspeak.com/cache/</code>. (Reason: Images at these places don't change - 
 	 * if images change, they get a new url.)</li>
 	 * <li>An image with the given URL is among the images of the caches image object.</li>
+	 * <li>The intended file name is the same.</li>
 	 * <li>The image is present in the file system.</li>
 	 * </ul> If no spidering is needed, then the <code>ImageInfo</code> object of the equivalent image is
 	 * returned, otherwise (when spidering is needed) <code>null</code> is returned.
-	 * @param pUrl URL to check
+	 * @param pNewUrl URL to check
 	 * @return ImageInfo object
 	 */
-	public ImageInfo needsSpidering(String pUrl, String pFilename) {
-		String url = pUrl.toLowerCase();
+	public ImageInfo needsSpidering(String pNewUrl, String pFilename) {
+		String newUrl = CacheImages.optimizeLink(pNewUrl);
 		ImageInfo result = null;
 		if (this.size() > 0 && 
-				(url.startsWith("http://img.geocaching.com/cache/")
-				 || url.startsWith("http://img.groundspeak.com/cache/"))) {
+				(newUrl.startsWith("http://img.geocaching.com/cache/"))) {
 			for (int i=0; i<this.size(); i++) {
 				ImageInfo img = this.get(i);
-				if (img.getURL().toLowerCase().equals(url) 
+				if (CacheImages.optimizeLink(img.getURL()).equals(newUrl) 
 						&& img.getFilename().equals(pFilename)) {
 					String location = Global.getProfile().dataDir + pFilename;
 					if ((new FileBugfix(location)).exists()) {
@@ -172,4 +176,63 @@
 		return result;
 	}
 	
-}
\ No newline at end of file
+	/**
+	 * Checks if an image with a certain filename is present in the collection of the caches 
+	 * images.
+	 * @param filename Filename to check
+	 * @return <code>true</code> if there is such a file, <code>false</code> if not.
+	 */
+	private boolean hasFile(String filename) {
+		boolean result = false;
+		for (int i=0; i<this.size(); i++) {
+			if (this.get(i).getFilename().toUpperCase().equals(filename.toUpperCase())) {
+				result = true;
+				break;
+			}
+		}
+		return result;
+	}
+	
+	/**
+	 * Deletes images that are no longer needed. It takes two CacheImage objects as arguments, one
+	 * as a collection of images before an update, the other after. Then every file in the old 
+	 * collection is checked if it is also present in the new collection. If not, the file is deleted.
+	 * Note that the <i>content</i> of the files is irrelevant. It is only important to remove files
+	 * - regardles of their contents - if they are no longer referenced after a cache update. 
+	 * @param oldImages Set of images before update
+	 * @param newImages Set of images after update
+	 */
+	public static void cleanupOldImages(CacheImages oldImages, CacheImages newImages) {
+		// Loop over every image in the old collection
+		for (int i=0; i<oldImages.size(); i++) {
+			// Check if image file is present in new collection
+			String obsoleteFilename = oldImages.get(i).getFilename();
+			if (!newImages.hasFile(obsoleteFilename)) {
+				String location = Global.getProfile().dataDir + obsoleteFilename;
+				File tmpFile = new File(location);
+				if (tmpFile.exists() && tmpFile.canWrite()) {
+					Global.getPref().log("Image not longer needed. Deleting: "+obsoleteFilename);
+					tmpFile.delete();
+				}
+			}
+		}
+	}
+	
+	/**
+	 * Takes an image url and does some optimization: As img.groundspeak.com is the same as
+	 * img.geocaching.com and the former is sometimes used by owners in the cache listing html, 
+	 * this method replaces img.groundspeak.com by img.geocaching.com, in order to be able to 
+	 * identify identical pictures as such.
+	 * @param pUrl URL to modify
+	 * @return Same URL, eventually modified
+	 */
+	public static String optimizeLink(String pUrl) {
+		String url = pUrl;
+		// img.groundspeak.com is same as img.geocaching.com, so replace it
+		if (url.toLowerCase().startsWith("http://img.groundspeak.com/")) {
+			url = "http://img.geocaching.com/" + url.substring(27);
+		}
+		return url;
+	}
+	
+}

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2009-07-06 21:22:36 UTC (rev 1996)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2009-07-07 17:10:05 UTC (rev 1997)
@@ -9,16 +9,16 @@
 /**
 *	This class shows the long description on a cache.
 *  Test with GC1CC5T - Final
-*            GC19DDX -
+*            GC19DDX - 
 */
 public class DescriptionPanel extends CellPanel{
 	HtmlDisplay disp = new HtmlDisplay();
 	mButton btnPlus, btnMinus;
 	CacheHolder currCache;
-
+	
 	CellPanel buttonP = new CellPanel();
 	CellPanel descP = new CellPanel();
-
+	
 	private String desc;
 
 	public DescriptionPanel(){
@@ -31,7 +31,7 @@
 		this.addLast(buttonP,CellConstants.HSTRETCH,CellConstants.HFILL);
 		clear();
 	}
-
+	
 	/**
          * Set the text to display. Text should be HTML formated.
          */
@@ -128,7 +128,7 @@
         //}
         currCache = cache;
     }
-
+	
 	/**
 	 * Get the descriptions for the pictures (if they exist)
 	 * @param imagesShown images already shown as part of long description (don't show again)
@@ -148,17 +148,17 @@
 		}
 		return sb.toString();
 	}
-
+	
 	public void clear() {
 		disp.setPlainText("loading ...");
 		currCache = null;
 	}
-
+	
 	/**
 	 * Eventhandler
 	 */
 	public void onEvent(Event ev){
-
+		
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if (ev.target == btnPlus){
 				Font currFont = disp.getFont();

Modified: trunk/src/CacheWolf/ImagePanel.java
===================================================================
--- trunk/src/CacheWolf/ImagePanel.java	2009-07-06 21:22:36 UTC (rev 1996)
+++ trunk/src/CacheWolf/ImagePanel.java	2009-07-07 17:10:05 UTC (rev 1997)
@@ -50,7 +50,7 @@
 			clearImages();
 			thumb_size = ((pref.myAppWidth-2*padding) / 3);
 			thumb_size = thumb_size - padding;
-			int rowCounter = cache.images.getDisplayImages().size() + cache.userImages.size();
+			int rowCounter = cache.images.getDisplayImages(cache.getParent().getWayPoint()).size() + cache.userImages.size();
 			rowCounter = (rowCounter/3)+1;
 			Rect r = new Rect(0, 0, pref.myAppWidth, rowCounter*thumb_size+rowCounter*padding+padding);
 			this.virtualSize = r;
@@ -61,7 +61,7 @@
 			addTitle(MyLocale.getMsg(340,"Cache Images:"));
 			locY = 20;
 			locX = padding;
-			addImages(cache.images.getDisplayImages());
+			addImages(cache.images.getDisplayImages(cache.getParent().getWayPoint()));
 			// load user images
 			if(locCounter==1 || locCounter ==2) locY = locY + thumb_size;
 			//Vm.debug("thumb_size: " + Convert.toString(thumb_size));

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-06 21:22:36 UTC (rev 1996)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-07 17:10:05 UTC (rev 1997)
@@ -2,6 +2,7 @@
 
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
+import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
@@ -312,28 +313,27 @@
 								//mpl.loadTo(profile.dataDir + "/" + holder.wayPoint + "_map_2.gif", "10");
 							}
 						}
-					if(holder.getWayPoint().startsWith("GC")|| fromTC) {
-						//spiderImages();
-						spiderImagesUsingSpider();
-						//Rename image sources
-						String text;
-						String orig;
-						String imgName;
-						orig = holder.getFreshDetails().LongDescription;
-						Extractor ex = new Extractor(orig, "<img src=\"", ">", 0, false);
-						text = ex.findNext();
-						int num = 0;
-						while(ex.endOfSearch() == false && spiderOK == true){
-							//Vm.debug("Replacing: " + text);
-							if (num >= holder.getFreshDetails().images.size())break;
-							imgName = holder.getFreshDetails().images.get(num).getTitle();
-							holder.getFreshDetails().LongDescription = replace(holder.getFreshDetails().LongDescription, text, "[[Image: " + imgName + "]]");
-							num++;
+						if(holder.getWayPoint().startsWith("GC")|| fromTC) {
+							//spiderImages();
+							spiderImagesUsingSpider();
+							//Rename image sources
+							String text;
+							String orig;
+							String imgName;
+							orig = holder.getFreshDetails().LongDescription;
+							Extractor ex = new Extractor(orig, "<img src=\"", ">", 0, false);
 							text = ex.findNext();
+							int num = 0;
+							while(ex.endOfSearch() == false && spiderOK == true){
+								//Vm.debug("Replacing: " + text);
+								if (num >= holder.getFreshDetails().images.size())break;
+								imgName = holder.getFreshDetails().images.get(num).getTitle();
+								holder.getFreshDetails().LongDescription = replace(holder.getFreshDetails().LongDescription, text, "[[Image: " + imgName + "]]");
+								num++;
+								text = ex.findNext();
+							}
 						}
 					}
-						
-					}
 				}
 				holder.save();
 				//crw.saveIndex(cacheDB,saveDir);
@@ -341,6 +341,9 @@
 			//Update cache data
 			else {
 				CacheHolder oldCh= cacheDB.get(index);
+				// Preserve images: Copy images from old cache version because here we didn't add
+				// any image information to the holder object.
+				holder.getFreshDetails().images = oldCh.getExistingDetails().images;
 				oldCh.update(holder);
 				oldCh.save();
 			}

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-06 21:22:36 UTC (rev 1996)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-07 17:10:05 UTC (rev 1997)
@@ -33,6 +33,7 @@
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
 import CacheWolf.CacheHolderDetail;
+import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
@@ -269,6 +270,13 @@
 				}
 				// preserve rating information
 				ch.setNumRecommended(cacheInDB.getNumRecommended());
+				if (pref.downloadPics) {
+					// delete obsolete images when we have current set
+					CacheImages.cleanupOldImages(cacheInDB.getExistingDetails().images, ch.getFreshDetails().images);
+				} else {
+					// preserve images if not downloaded
+					ch.getFreshDetails().images = cacheInDB.getExistingDetails().images;
+				}
 				cacheInDB.update(ch);
 				cacheInDB.save();
 			}
@@ -1168,11 +1176,20 @@
 	 */
 	public void getImages(String doc, CacheHolderDetail chD){
 		int imgCounter = 0;
-		String imgName, oldImgName, imgType, imgUrl, imgComment;
+		int spiderCounter = 0;
+		String fileName, imgName, imgType, imgUrl, imgComment;
 		Vector spideredUrls=new Vector(15);
-		ImageInfo imageInfo;
+		ImageInfo imageInfo=null;
 		Extractor exImgBlock,exImgComment;
 		int idxUrl; // Index of already spidered Url in list of spideredUrls
+		CacheImages lastImages=null;
+		
+		// First: Get current image object of waypoint before spidering images.
+		CacheHolder oldCh = Global.getProfile().cacheDB.get(chD.getParent().getWayPoint());
+		if (oldCh != null) {
+			lastImages = oldCh.getFreshDetails().images;
+		}
+		
 		//========
 		//In the long description
 		//========
@@ -1197,7 +1214,8 @@
 			imgUrl = exImgSrc.findNext();
 			//Vm.debug("Img Url: " +imgUrl);
 			if(imgUrl.length()>0){
-				imgUrl = "http://" + imgUrl;
+				// Optimize: img.groundspeak.com -> img.geocaching.com (for better caching purposes)
+				imgUrl = CacheImages.optimizeLink("http://" + imgUrl);
 				try{
 					imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
 					// imgType is now max 4 chars, starting with .
@@ -1205,16 +1223,29 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-						imageInfo = new ImageInfo();
+						imageInfo = null;
 						if (idxUrl<0) { // New image
-							pref.log("Loading image: " + imgUrl+" as "+imgName);
-							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setFilename(imgName+imgType);
+							fileName = chD.getParent().getWayPoint() + "_" + Convert.toString(spiderCounter);
+							if (lastImages != null) {
+								imageInfo = lastImages.needsSpidering(imgUrl, fileName+imgType);
+							}
+							if (imageInfo == null) {
+								imageInfo = new ImageInfo();
+								pref.log("Loading image: " + imgUrl+" as "+fileName+imgType);
+								spiderImage(imgUrl, fileName+imgType);
+								imageInfo.setFilename(fileName+imgType);
+								imageInfo.setURL(imgUrl);
+							} else {
+								pref.log("Already exising image: " + imgUrl+" as "+imageInfo.getFilename());
+							}
 							spideredUrls.add(imgUrl);
+							spiderCounter++;
 						} else { // Image already spidered as wayPoint_'idxUrl'
-							pref.log("Already loaded image: " + imgUrl);
-							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							imageInfo.setFilename(oldImgName+imgType);
+							fileName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
+							pref.log("Already loaded image: " + imgUrl+" as "+fileName+imgType);
+							imageInfo = new ImageInfo();
+							imageInfo.setFilename(fileName+imgType);
+							imageInfo.setURL(imgUrl);
 						}
 						imageInfo.setTitle(imgName);
 						imageInfo.setComment(null);
@@ -1254,23 +1285,35 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-						imageInfo = new ImageInfo();
+						imageInfo = null;
 						if (idxUrl<0) { // New image
-							pref.log("Loading image: " + imgUrl+" as "+imgName);
-							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setFilename(imgName+imgType);
+							fileName = chD.getParent().getWayPoint() + "_" + Convert.toString(spiderCounter);
+							if (lastImages != null) {
+								imageInfo = lastImages.needsSpidering(imgUrl, fileName+imgType);
+							}
+							if (imageInfo == null) {
+								imageInfo = new ImageInfo();
+								pref.log("Loading image: " + imgUrl+" as "+fileName+imgType);
+								spiderImage(imgUrl, fileName+imgType);
+								imageInfo.setFilename(fileName+imgType);
+								imageInfo.setURL(imgUrl);
+							} else {
+								pref.log("Already exising image: " + imgUrl+" as "+imageInfo.getFilename());
+							}
 							spideredUrls.add(imgUrl);
+							spiderCounter++;
 						} else { // Image already spidered as wayPoint_'idxUrl'
-							pref.log("Already loaded image: " + imgUrl);
-							oldImgName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
-							imageInfo.setFilename(oldImgName+imgType);
+							fileName = chD.getParent().getWayPoint() + "_" + Convert.toString(idxUrl);
+							pref.log("Already loaded image: " + imgUrl+" as "+fileName+imgType);
+							imageInfo = new ImageInfo();
+							imageInfo.setFilename(fileName+imgType);
+							imageInfo.setURL(imgUrl);
 						}
 						imageInfo.setTitle(exImgName.findNext());
 						while (imgComment.startsWith("<br />")) imgComment=imgComment.substring(6);
 						while (imgComment.endsWith("<br />")) imgComment=imgComment.substring(0,imgComment.length()-6);
 						imageInfo.setComment(imgComment);
 						chD.images.add(imageInfo);
-						imgCounter++;
 					}
 				} catch (IndexOutOfBoundsException e) {
 					pref.log("IndexOutOfBoundsException in image span. imgURL:"+imgUrl,e);
@@ -1284,7 +1327,8 @@
 		while(exFinal.endOfSearch() == false){
 			imgUrl = exFinal.findNext();
 			if(imgUrl.length()>0){
-				imgUrl = "http://" + imgUrl;
+				// Optimize: img.groundspeak.com -> img.geocaching.com (for better caching purposes)
+				imgUrl = CacheImages.optimizeLink("http://" + imgUrl);
 				try{
 					imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
 					// imgType is now max 4 chars, starting with . Delete characters in URL after the image extension
@@ -1293,12 +1337,22 @@
 						// Check whether image was already spidered for this cache
 						idxUrl=spideredUrls.find(imgUrl);
 						if (idxUrl<0) { // New image
-							imageInfo = new ImageInfo();
 							imgName = chD.getParent().getWayPoint() + "_" + Convert.toString(imgCounter);
-							pref.log("Loading image: " + imgUrl+" as "+imgName);
-							spiderImage(imgUrl, imgName+imgType);
-							imageInfo.setFilename(imgName+imgType);
+							fileName = chD.getParent().getWayPoint() + "_" + Convert.toString(spiderCounter);
+							if (lastImages != null) {
+								imageInfo = lastImages.needsSpidering(imgUrl, fileName+imgType);
+							}
+							if (imageInfo == null) {
+								imageInfo = new ImageInfo();
+								pref.log("Loading image: " + imgUrl+" as "+fileName+imgType);
+								spiderImage(imgUrl, fileName+imgType);
+								imageInfo.setFilename(fileName+imgType);
+								imageInfo.setURL(imgUrl);
+							} else {
+								pref.log("Already exising image: " + imgUrl+" as "+imageInfo.getFilename());
+							}
 							spideredUrls.add(imgUrl);
+							spiderCounter++;
 							imageInfo.setTitle(imgName);
 							imgCounter++;
 							chD.images.add(imageInfo);


Property changes on: trunk/src/CacheWolf/imp/SpiderGC.java
___________________________________________________________________
Name: svn:mergeinfo
   + 



From greiol at mail.berlios.de  Tue Jul  7 20:06:32 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 7 Jul 2009 20:06:32 +0200
Subject: [Cachewolf-svn] r1998 - trunk/src/CacheWolf/imp
Message-ID: <200907071806.n67I6Wsj008980@sheep.berlios.de>

Author: greiol
Date: 2009-07-07 20:06:31 +0200 (Tue, 07 Jul 2009)
New Revision: 1998

Modified:
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
add log message if spider fails

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-07 17:10:05 UTC (rev 1997)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-07 18:06:31 UTC (rev 1998)
@@ -651,6 +651,7 @@
 					break;
 				} else if (test == 0) {
 					spiderErrors++;
+					Global.getPref().log("SpiderGC: could not spider "+ch.getWayPoint());
 				} else {
 					//profile.hasUnsavedChanges=true;
 				}



From engywuck at mail.berlios.de  Tue Jul  7 21:44:32 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Tue, 7 Jul 2009 21:44:32 +0200
Subject: [Cachewolf-svn] r1999 - trunk/src/CacheWolf
Message-ID: <200907071944.n67JiW7Z028480@sheep.berlios.de>

Author: engywuck
Date: 2009-07-07 21:44:28 +0200 (Tue, 07 Jul 2009)
New Revision: 1999

Modified:
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Profile.java
Log:
Showing progress on loading index.xml.

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2009-07-07 18:06:31 UTC (rev 1998)
+++ trunk/src/CacheWolf/MainForm.java	2009-07-07 19:44:28 UTC (rev 1999)
@@ -88,7 +88,7 @@
 			infB = new InfoBox("CacheWolf",MyLocale.getMsg(5000,"Loading Cache-List"));
 			infB.exec();
 			infB.waitUntilPainted(100);
-			profile.readIndex();
+			profile.readIndex(infB);
 			pref.curCentrePt.set(profile.centre);
 			profile.updateBearingDistance();
 			setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-07-07 18:06:31 UTC (rev 1998)
+++ trunk/src/CacheWolf/MainMenu.java	2009-07-07 19:44:28 UTC (rev 1999)
@@ -295,7 +295,7 @@
 					infB.exec();
 					infB.waitUntilPainted(1000);
 					Vm.showWait(infB, true);
-					profile.readIndex();
+					profile.readIndex(infB);
 					Vm.showWait(infB, false);
 					pref.curCentrePt.set(profile.centre);
                     filtBlack.modifiers=Global.getProfile().showBlacklisted()?filtBlack.modifiers|MenuItem.Checked:filtBlack.modifiers&~MenuItem.Checked;

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-07-07 18:06:31 UTC (rev 1998)
+++ trunk/src/CacheWolf/Profile.java	2009-07-07 19:44:28 UTC (rev 1999)
@@ -214,16 +214,22 @@
 		resetUnsavedChanges();
 	}
 
+	public void readIndex() {
+		readIndex(null);
+	}
 	/**
 	 *	Method to read the index.xml file that holds the total information
 	 *	on available caches in the database. The database in nothing else
 	 *	than the collection of caches in a directory.
 	 */
-	public void readIndex() {
+	public void readIndex(InfoBox infoBox) {
 
 		try {
 			selectionChanged = true;
 			boolean fmtDec = false;
+			String mainInfoText = MyLocale.getMsg(5000,"Loading Cache-List");
+			int wptNo=1;
+			int lastShownWpt=0;
 			char decSep = MyLocale.getDigSeparator().charAt(0);
 			char notDecSep = decSep == '.' ? ',' : '.';
 			FileReader in = new FileReader(dataDir + "index.xml");
@@ -244,6 +250,13 @@
 							new MessageBox(MyLocale.getMsg(144, "Warning"), MyLocale.getMsg(4407, "The profile files are not in the current format.%0aTherefore they are now converted to the current format. Depending of the size of the profile and the computer involved this may take some minutes. Please bear with us until the conversion is done."), FormBase.OKB).execute();
 						}
 					}
+					if (infoBox!=null) {
+						if (wptNo - 10 >= lastShownWpt) {
+							infoBox.setInfo(mainInfoText+"\n"+String.valueOf(wptNo));
+							lastShownWpt = wptNo;
+						}
+						wptNo++;
+					}
 					CacheHolder ch=new CacheHolder(text,indexXmlVersion);
 					cacheDB.add(ch);
 				} else if (text.indexOf("<CENTRE")>=0) { // lat=  lon=



From mirabilos at mail.berlios.de  Tue Jul  7 21:53:54 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Tue, 7 Jul 2009 21:53:54 +0200
Subject: [Cachewolf-svn] r2000 - trunk/res_noewe
Message-ID: <200907071953.n67JrsbK030772@sheep.berlios.de>

Author: mirabilos
Date: 2009-07-07 21:53:54 +0200 (Tue, 07 Jul 2009)
New Revision: 2000

Modified:
   trunk/res_noewe/info.html
Log:
* add apreisser
* sort list of committers
* add RCS ID


Modified: trunk/res_noewe/info.html
===================================================================
--- trunk/res_noewe/info.html	2009-07-07 19:44:28 UTC (rev 1999)
+++ trunk/res_noewe/info.html	2009-07-07 19:53:54 UTC (rev 2000)
@@ -3,7 +3,7 @@
 <font face="Tahoma" size = "3">
 <strong>A geocaching programm</strong><br>
 <font face="Tahoma" size = "2"><em>
-from Bilbowolf, Kalli, Pfeffer, salzkammergut, MiK, Blackeye501, mirabilos, Kappler, Engywuck, greiol<br>
+from apreisser, Bilbowolf, Blackeye501, Engywuck, greiol, Kalli, Kappler, MiK, mirabilos, Pfeffer, salzkammergut<br>
 for Windows, Linux and Pocket PC</em><br>
 <br>
 CacheWolf was created sometime 2003 to enable paperless caching with a Sharp Zaurus.
@@ -17,3 +17,5 @@
 Discussions may be joined at: www.geoclub.de<br><br>
 <STRONG>Cache On 'n Cache hard!</STRONG>
 </font>
+<hr />
+<small><tt style="white-space:nowrap;">$Id$</tt></small>


Property changes on: trunk/res_noewe/info.html
___________________________________________________________________
Name: svn:keywords
   + Id



From mirabilos at mail.berlios.de  Tue Jul  7 21:56:58 2009
From: mirabilos at mail.berlios.de (mirabilos at BerliOS)
Date: Tue, 7 Jul 2009 21:56:58 +0200
Subject: [Cachewolf-svn] r2001 - in trunk: platform-dep/PNA-WinCE42 res_noewe
Message-ID: <200907071956.n67Juwrf031372@sheep.berlios.de>

Author: mirabilos
Date: 2009-07-07 21:56:57 +0200 (Tue, 07 Jul 2009)
New Revision: 2001

Modified:
   trunk/platform-dep/PNA-WinCE42/ewe.dll
   trunk/res_noewe/icon_remove.gif
Log:
while here, remove the executable bit from files
that don't need it (only affects Unix platforms)



Property changes on: trunk/platform-dep/PNA-WinCE42/ewe.dll
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/res_noewe/icon_remove.gif
___________________________________________________________________
Name: svn:executable
   - *



From mik77 at mail.berlios.de  Wed Jul  8 09:31:45 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 8 Jul 2009 09:31:45 +0200
Subject: [Cachewolf-svn] r2002 - trunk/src/CacheWolf/navi
Message-ID: <200907080731.n687VjfS028613@sheep.berlios.de>

Author: mik77
Date: 2009-07-08 09:31:39 +0200 (Wed, 08 Jul 2009)
New Revision: 2002

Modified:
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Small correction for r1977.

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2009-07-07 19:56:57 UTC (rev 2001)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2009-07-08 07:31:39 UTC (rev 2002)
@@ -854,8 +854,7 @@
 
 	public void destChanged(CacheHolder ch) {
 		CWPoint d = new CWPoint (ch.pos);
-		if(!running || (gotoPos == null) || 
-				(gotoPos != null && gotoPos.where.equals(d))) return;
+		if(!running || (gotoPos != null && gotoPos.where.equals(d))) return;
 		removeGotoPosition();
 		if (!d.isValid() ) return;
 		gotoPos = addSymbol("goto", ch, "goto_map.png", d);



From mik77 at mail.berlios.de  Wed Jul  8 14:58:55 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 8 Jul 2009 14:58:55 +0200
Subject: [Cachewolf-svn] r2003 - trunk/src/CacheWolf/imp
Message-ID: <200907081258.n68CwtFx005068@sheep.berlios.de>

Author: mik77
Date: 2009-07-08 14:58:49 +0200 (Wed, 08 Jul 2009)
New Revision: 2003

Modified:
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Stop immediately after max number of Caches, if we don't want to make updates.

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-08 07:31:39 UTC (rev 2002)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-08 12:58:49 UTC (rev 2003)
@@ -404,22 +404,25 @@
 		saveDistanceInMiles = java.lang.Math.ceil(saveDistanceInMiles) + 1;
 
 		Hashtable cachesToUpdate = new Hashtable(cacheDB.size());
-		double distanceInKm = distance;
-		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
-			distanceInKm = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
+		
+		if (pref.spiderUpdates != Preferences.NO) {
+  		double distanceInKm = distance;
+  		if ( Global.getPref().metricSystem == Metrics.IMPERIAL ) {
+  			distanceInKm = Metrics.convertUnit(distance, Metrics.MILES, Metrics.KILOMETER);
+  		}
+  		for(int i = 0; i<cacheDB.size();i++){
+  			ch = cacheDB.get(i);
+  			if (spiderAllFinds) {
+  				if ( (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) ) {
+  					cachesToUpdate.put(ch.getWayPoint(), ch);
+  				}
+  			} else {
+  				if ( (!ch.is_archived()) && (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found()) && (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) ) {
+  					cachesToUpdate.put(ch.getWayPoint(), ch);
+  				}
+  			}
+  		}
 		}
-		for(int i = 0; i<cacheDB.size();i++){
-			ch = cacheDB.get(i);
-			if (spiderAllFinds) {
-				if ( (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) ) {
-					cachesToUpdate.put(ch.getWayPoint(), ch);
-				}
-			} else {
-				if ( (!ch.is_archived()) && (ch.kilom <= distanceInKm) && !(doNotgetFound && ch.is_found()) && (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) ) {
-					cachesToUpdate.put(ch.getWayPoint(), ch);
-				}
-			}
-		}
 
 		//=======
 		// Prepare list of all caches that are to be spidered
@@ -517,6 +520,17 @@
 								cachesToUpdate.clear();
 							} else {
 								cachesToLoad.add(waypoint);
+								
+								//if we don't want to update caches, we can stop directly after adding the maximum of new caches.
+								if ( (pref.spiderUpdates == Preferences.NO) && (maxNumber > 0) && (cachesToLoad.size() >= maxNumber)) {
+								  maxNumberAbort = true;
+
+							   	//add no more caches
+								  distance = 0;
+
+								  //don't update existing caches, because list is not correct when aborting
+								  cachesToUpdate.clear();
+                }
 							}
 						} else {
 							pref.log(waypoint+" already in DB");



From mik77 at mail.berlios.de  Wed Jul  8 16:27:10 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Wed, 8 Jul 2009 16:27:10 +0200
Subject: [Cachewolf-svn] r2004 - trunk/src/CacheWolf/imp
Message-ID: <200907081427.n68ERA0F012676@sheep.berlios.de>

Author: mik77
Date: 2009-07-08 16:27:03 +0200 (Wed, 08 Jul 2009)
New Revision: 2004

Modified:
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Correct found detection for nicks with umlauts

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-08 12:58:49 UTC (rev 2003)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-08 14:27:03 UTC (rev 2004)
@@ -1112,7 +1112,7 @@
 			logId = exLogId.findNext();
 			String d=DateFormat.logdate2YMD(exDate.findNext());
 			if((icon.equals(p.getProp("icon_smile")) || icon.equals(p.getProp("icon_camera")) || icon.equals(p.getProp("icon_attended"))) &&
-				(name.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && name.equalsIgnoreCase(pref.myAlias2))) )  {
+				(name.equalsIgnoreCase(SafeXML.clean(pref.myAlias)) || (pref.myAlias2.length()>0 && name.equalsIgnoreCase(SafeXML.clean(pref.myAlias2)))) )  {
 				chD.getParent().setFound(true);
 				chD.getParent().setCacheStatus(d);
 				chD.OwnLogId = logId;



From greiol at mail.berlios.de  Thu Jul  9 07:51:11 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 9 Jul 2009 07:51:11 +0200
Subject: [Cachewolf-svn] r2005 - trunk/src/CacheWolf
Message-ID: <200907090551.n695pBtJ012509@sheep.berlios.de>

Author: greiol
Date: 2009-07-09 07:51:10 +0200 (Thu, 09 Jul 2009)
New Revision: 2005

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
added logkeeping section

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-07-08 14:27:03 UTC (rev 2004)
+++ trunk/src/CacheWolf/Preferences.java	2009-07-09 05:51:10 UTC (rev 2005)
@@ -230,9 +230,12 @@
 	public boolean downloadTBs = true;
 	/** Last mode select in the DataMover for processing cache*/
 	public int processorMode = 0;
-
 	/** external Cacherating software */
 	public String rater;
+	/** maximum number of logs to store in cache details */
+	public int maxLogsToKeep = DEFAULT_MAX_LOGS_TO_SPIDER;
+	/** keep own logs even when excessing <code>maxLogsToKeep</code> */
+	public boolean alwaysKeepOwnLogs = true;
 
 	//////////////////////////////////////////////
 	/** The debug switch (Can be used to activate dormant code) by adding
@@ -443,7 +446,7 @@
 			language = atts.getValue("language");
 		}
 		else if (name.equals("rater")) {
-			rater = atts.getValue("tool");
+			rater = SafeXML.strxmldecode(atts.getValue("tool"));
 		}
 		else if (name.equals("FILTERDATA")) {
 			// Creating a filter object and reading the saved data
@@ -471,7 +474,15 @@
 			}
 
 		}
-
+		else if (name.equals("logkeeping")) {
+			tmp = atts.getValue("maximum");
+			if (tmp != null) 
+				maxLogsToKeep = Convert.parseInt(tmp);
+			
+			tmp = atts.getValue("keepown");
+			if (tmp != null)
+				alwaysKeepOwnLogs = Boolean.valueOf(tmp).booleanValue();  
+		}
 	}
 
 	public void characters( char ch[], int start, int length ) {
@@ -554,7 +565,8 @@
 				entry = (MapEntry) itPath.next();
 				outp.print("    <impPath key = \"" + SafeXML.strxmlencode(entry.getKey().toString()) + "\" value = \"" + SafeXML.strxmlencode(entry.getValue().toString().replace('\\', '/')) + "\"/>\n");
 			}
-			if (rater != null) outp.print("    <rater tool=\"".concat(rater).concat("\"/>\n"));
+			if (rater != null) outp.print("    <rater tool=\"".concat(SafeXML.strxmlencode(rater)).concat("\"/>\n"));
+			outp.print("    <logkeeping maximum=\""+SafeXML.strxmlencode(maxLogsToKeep)+"\" keepown=\""+SafeXML.strxmlencode(alwaysKeepOwnLogs)+"\" />\n");
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {



From greiol at mail.berlios.de  Thu Jul  9 21:07:21 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 9 Jul 2009 21:07:21 +0200
Subject: [Cachewolf-svn] r2006 - trunk/src/exp
Message-ID: <200907091907.n69J7L97021802@sheep.berlios.de>

Author: greiol
Date: 2009-07-09 21:07:19 +0200 (Thu, 09 Jul 2009)
New Revision: 2006

Modified:
   trunk/src/exp/GpxExportNg.java
Log:
make export more robust, start work on better to understand config dialog

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-09 05:51:10 UTC (rev 2005)
+++ trunk/src/exp/GpxExportNg.java	2009-07-09 19:07:19 UTC (rev 2006)
@@ -42,6 +42,7 @@
 import ewe.ui.ProgressBarForm;
 import ewe.ui.mButton;
 import ewe.ui.mCheckBox;
+import ewe.ui.mChoice;
 import ewe.ui.mInput;
 import ewe.ui.mLabel;
 import ewe.util.Enumeration;
@@ -77,6 +78,8 @@
 	private int maxLogs = ewe.math.Number.INTEGER_MAX_VALUE;
 	/** number of errors / warnings during export */
 	private int exportErrors = 0;
+	/**  */
+	private String finderid;
 
 	final static String GPXHEADER = "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n"
 			.concat("<gpx xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" version=\"1.0\" creator=\"CacheWolf\" xsi:schemaLocation=\"http://www.topografix.com/GPX/1/0 http://www.topografix.com/GPX/1/0/gpx.xsd http://www.groundspeak.com/cache/1/0 http://www.groundspeak.com/cache/1/0/cache.xsd\" xmlns=\"http://www.topografix.com/GPX/1/0\">\n")
@@ -132,21 +135,34 @@
 			.concat("@@ADDILAT@@ @@ADDILON@@@@ADDIDELIM@@")
 			.concat("@@ADDILONG@@@@ADDIDELIM@@");
 
-	static boolean smartIds;
-	static boolean customIcons;
-	static boolean separateFiles;
-	static boolean sendToGarmin;
-	static int outType;
+	private static boolean smartIds;
+	private static boolean customIcons;
+	private static boolean separateFiles;
+	private static boolean sendToGarmin;
+	private static int outType;
+	private static boolean hasBitmaps;
+	private static boolean hasGarminMap;
+	private static boolean hasGpsbabel;
+	private static String bitmapFileName;
+	private static String garminMapFileName;
 
 	public GpxExportNg() {
-		// do nothing
+		garminMapFileName = FileBase.getProgramDirectory() + "/garminmap.xml";
+		bitmapFileName = FileBase.getProgramDirectory() + "/GarminPOI.zip";
+		
+		hasGarminMap = new File(garminMapFileName).exists();
+		hasBitmaps = new File(bitmapFileName).exists();
+		hasGpsbabel = Global.getPref().gpsbabel != null;
+		
+		finderid = Global.getPref().gcMemberId;
+		if (finderid.equals("")) Global.getPref().log("GPX Export: warning gcmemberid not set, check pref.xml");
 	}
 
 	public void doit() {
 		GpxExportNgForm exportOptions;
 		int ret;
 
-		exportOptions = new GpxExportNgForm();
+		exportOptions = new GpxExportNgForm(hasGarminMap, hasBitmaps, hasGpsbabel);
 		ret = exportOptions.execute();
 
 		if (FormBase.IDCANCEL == ret) {
@@ -204,23 +220,21 @@
 				new File(tempDir).mkdir();
 			} else {
 				tempDir = outDir;
-				String tmp[] = new FileBugfix(tempDir).list(prefix + "*.gpx",
-						ewe.io.FileBase.LIST_FILES_ONLY);
+				String tmp[] = new FileBugfix(tempDir).list(prefix + "*.gpx", ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i = 0; i < tmp.length; i++) {
-					FileBugfix tmpFile = new FileBugfix(tempDir
-							+ FileBase.separator + tmp[i]);
+					FileBugfix tmpFile = new FileBugfix(tempDir	+ FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
-				tmp = new FileBugfix(tempDir).list(prefix + "*.bmp",
-						ewe.io.FileBase.LIST_FILES_ONLY);
+				tmp = new FileBugfix(tempDir).list(prefix + "*.bmp", ewe.io.FileBase.LIST_FILES_ONLY);
 				for (int i = 0; i < tmp.length; i++) {
-					FileBugfix tmpFile = new FileBugfix(tempDir
-							+ FileBase.separator + tmp[i]);
+					FileBugfix tmpFile = new FileBugfix(tempDir	+ FileBase.separator + tmp[i]);
 					tmpFile.delete();
 				}
 			}
 
 			ProgressBarForm pbf = new ProgressBarForm();
+			int poiCounter = 0;
+			int poiCategories = 0;
 			try {
 				Handle h = new Handle();
 
@@ -286,6 +300,10 @@
 								+ FileBase.separator + tmp[i]);
 						tmpFile.delete();
 					}
+					pbf.exit(0);
+					poiCategories=fileHandles.size();
+					pbf.setTask(h, "Transfer");
+					pbf.exec();
 				}
 
 				Enumeration keys = fileHandles.keys();
@@ -296,35 +314,46 @@
 
 					writer.print("</gpx>\n");
 					writer.close();
-					if (poiZip != null)
-						if (!copyPoiIcon(tempDir, key, prefix, poiZip))
+					if (sendToGarmin) {
+						poiCounter++;
+						h.progress = (float) poiCounter / (float) poiCategories;
+						h.changed();
+					}
+					if (poiZip != null) {
+						if (!copyPoiIcon(tempDir, key, prefix, poiZip)) {
 							exportErrors++;
+							continue;
+						}
 
-					String[] cmdStack = new String[9];
-					cmdStack[0]=Global.getPref().gpsbabel;
-					cmdStack[1]="-i";
-					cmdStack[2]="gpx";
-					cmdStack[3]="-f";
-					cmdStack[4]=tempDir + FileBase.separator + prefix + key + ".gpx";
-					cmdStack[5]="-o";
-					cmdStack[6]="garmin_gpi,sleep=1,category="+prefix + key+",bitmap="+tempDir + FileBase.separator + prefix + key	+ ".bmp";
-					cmdStack[7]="-F";
-					cmdStack[8]=outDir + FileBase.separator + prefix + key + ".gpi";
+						if (sendToGarmin) {
+							String[] cmdStack = new String[9];
+							cmdStack[0]=Global.getPref().gpsbabel;
+							cmdStack[1]="-i";
+							cmdStack[2]="gpx";
+							cmdStack[3]="-f";
+							cmdStack[4]=tempDir + FileBase.separator + prefix + key + ".gpx";
+							cmdStack[5]="-o";
+							cmdStack[6]="garmin_gpi,sleep=1,category="+prefix + key+",bitmap="+tempDir + FileBase.separator + prefix + key	+ ".bmp";
+							cmdStack[7]="-F";
+							cmdStack[8]=outDir + FileBase.separator + prefix + key + ".gpi";
+		
+							Process babelProcess = startProcess(cmdStack);
+							StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
+							while (errorStream.isOpen()) {
+								String errorMsg = errorStream.readALine();
+								if (errorMsg != null) {
+									Global.getPref().log("GPX Export: " + errorMsg);
+									exportErrors++;
+								}
+								try {
+									babelProcess.exitValue();
+									errorStream.close();
+								} catch (IllegalThreadStateException e) {
+									// still running
+								}
+							}
+						}
 
-					Process babelProcess = startProcess(cmdStack);
-					StreamReader errorStream = new StreamReader(babelProcess.getErrorStream());
-					while (errorStream.isOpen()) {
-						String errorMsg = errorStream.readALine();
-						if (errorMsg != null) {
-							Global.getPref().log("GPX Export: " + errorMsg);
-							exportErrors++;
-						}
-						try {
-							babelProcess.exitValue();
-							errorStream.close();
-						} catch (IllegalThreadStateException e) {
-							// still running
-						}
 					}
 				}
 
@@ -553,7 +582,7 @@
 				if (ch.isAddiWpt()) {
 					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + ch.getFreshDetails().LongDescription)));
 				} else {
-					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + Common.rot13(ch.getFreshDetails().Hints))));
+					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + "("+ch.getNoFindLogs()+")" + " " + Common.rot13(ch.getFreshDetails().Hints))));
 				}
 			} else {
 				if (ch.isAddiWpt()) {
@@ -682,6 +711,10 @@
 	public String formatLogs(CacheHolder ch) {
 		LogList logs = ch.getFreshDetails().CacheLogs;
 		StringBuffer ret = new StringBuffer();
+		String fid = "";
+		
+		if (outType == GPX_MYFINDSPQ) 
+			fid = finderid; 
 
 		if (0 == logs.size())
 			return "";
@@ -695,17 +728,20 @@
 		}
 
 		for (int i = 0; i < exportlogs; i++) {
+			String logId = "";
 			Log log = logs.getLog(i);
 
-			if (outType == GPX_MYFINDSPQ
-					&& !log.getLogger().equals(Global.getPref().myAlias))
-				continue;
+			if (outType == GPX_MYFINDSPQ && !log.getLogger().equals(Global.getPref().myAlias))
+					continue;
 
+//			if (outType == GPX_MYFINDSPQ) 
+//				logId = log.getLogId();
+			
 			Transformer trans = new Transformer(true);
-			trans.add(new Regex("@@LOGID@@", ""));
+			trans.add(new Regex("@@LOGID@@", logId));
 			trans.add(new Regex("@@LOGDATE@@", log.getDate()));
 			trans.add(new Regex("@@LOGTYPE@@", image2TypeText(log.getIcon())));
-			trans.add(new Regex("@@LOGFINDERID@@", ""));
+			trans.add(new Regex("@@LOGFINDERID@@", fid));
 			trans.add(new Regex("@@LOGFINDER@@", SafeXML.cleanGPX(log.getLogger())));
 			trans.add(new Regex("@@LOGENCODE@@", ""));
 			trans.add(new Regex("@@LOGTEXT@@", SafeXML.cleanGPX(log.getMessage())));
@@ -891,66 +927,137 @@
 	 * dialog to set the GPX exporter options
 	 */
 	private class GpxExportNgForm extends Form {
-		private CheckBoxGroup cbgExportType;
+		private CheckBoxGroup cbgExportType, cbgWpName;
 		private mCheckBox cbCompact, cbPqLike, cbMyFinds, cbCustomIcons,cbSeperateFiles, cbSendToGarmin, cbSmartId;
+		private mCheckBox cbWpClassic, cbWpSmartId, cbWpSmartName, cbCreatePoi, cbSeperateHints;
 		private mInput ibMaxLogs, ibPrefix;
 		private mButton btnOk, btnCancel;
+		
+		private boolean hasBitmaps;
+		private boolean hasGarminMap;
+		private boolean hasGpsbabel;
+		
+		private int guiid;
+		
+		private mChoice chStyle, chTarget, chIds;
 
 		/**
 		 * set up the form / dialog
 		 */
-		public GpxExportNgForm() {
+		public GpxExportNgForm(boolean hasGarminMap, boolean hasBitmaps, boolean hasGpsbabel) {
+
+			guiid=0;
+
+			this.hasBitmaps = hasBitmaps;
+			this.hasGarminMap = hasGarminMap;
+			this.hasGpsbabel = hasGpsbabel;
+			
 			// TODO: get/set defaults from profile
 
 			this.setTitle("GPX Export");
+			this.resizable = false;
+			
+			btnOk = new mButton("OK");
+			btnCancel = new mButton("Cancel");
+			
+			if (guiid == 0) {
+                cbgExportType = new CheckBoxGroup();
 
-			cbgExportType = new CheckBoxGroup();
+                cbCompact = new mCheckBox("Compact");
+                cbCompact.setGroup(cbgExportType);
 
-			cbCompact = new mCheckBox("Compact");
-			cbCompact.setGroup(cbgExportType);
+                cbPqLike = new mCheckBox("PQ like");
+                cbPqLike.setGroup(cbgExportType);
 
-			cbPqLike = new mCheckBox("PQ like");
-			cbPqLike.setGroup(cbgExportType);
+                cbMyFinds = new mCheckBox("MyFinds");
+                cbMyFinds.setGroup(cbgExportType);
 
-			cbMyFinds = new mCheckBox("MyFinds");
-			cbMyFinds.setGroup(cbgExportType);
+                cbgExportType.setText("Compact");
 
-			cbgExportType.setText("Compact");
+                cbCustomIcons = new mCheckBox("custom icons");
 
-			cbCustomIcons = new mCheckBox("custom icons");
+                cbSeperateFiles = new mCheckBox("one file per type");
 
-			cbSeperateFiles = new mCheckBox("one file per type");
+                cbSendToGarmin = new mCheckBox("send to Garmin GPSr");
+                if (Global.getPref().gpsbabel == null)
+                        cbSendToGarmin.modify(ControlConstants.Disabled, 0);
 
-			cbSendToGarmin = new mCheckBox("send to Garmin GPSr");
-			if (Global.getPref().gpsbabel == null)
-				cbSendToGarmin.modify(ControlConstants.Disabled, 0);
+                cbSmartId = new mCheckBox("use smart IDs");
 
-			cbSmartId = new mCheckBox("use smart IDs");
+                ibPrefix = new mInput("GC-");
+                ibPrefix.modify(ControlConstants.Disabled, 0);
+                ibMaxLogs = new mInput(String
+                                .valueOf(Global.getPref().numberOfLogsToExport));
+                ibMaxLogs.modify(ControlConstants.Disabled, 0);
 
-			ibPrefix = new mInput("GC-");
-			ibPrefix.modify(ControlConstants.Disabled, 0);
-			ibMaxLogs = new mInput(String
-					.valueOf(Global.getPref().numberOfLogsToExport));
-			ibMaxLogs.modify(ControlConstants.Disabled, 0);
+                addNext(cbCustomIcons);
+                addLast(cbCompact);
+                addNext(cbSeperateFiles);
+                addLast(cbPqLike);
+                addNext(cbSendToGarmin);
+                addLast(cbMyFinds);
+                
+                addLast(cbSmartId);
+                addNext(new mLabel("Prefix"));
+                addLast(new mLabel("Max Logs"));
 
-			btnOk = new mButton("OK");
-			btnCancel = new mButton("Cancel");
+                addNext(ibPrefix);
+                addLast(ibMaxLogs);
 
-			addNext(cbCustomIcons);
-			addLast(cbCompact);
-			addNext(cbSeperateFiles);
-			addLast(cbPqLike);
-			addNext(cbSendToGarmin);
-			addLast(cbMyFinds);
-			addLast(cbSmartId);
-			addNext(new mLabel("Prefix"));
-			addLast(new mLabel("Max Logs"));
+                addButton(btnOk);
+                addButton(btnCancel);
 
-			addNext(ibPrefix);
-			addLast(ibMaxLogs);
+			} else if (guiid == 2) {
+				
+				chIds = new mChoice();
+				chIds.addItem("Classic IDs");
+				chIds.addItem("Smart IDs");
+				chIds.addItem("Smart Names");
+				chIds.select(0);
+				
+				chStyle = new mChoice();
+				chStyle.addItem("Compact");
+				chStyle.addItem("PQ like");
+				chStyle.addItem("MyFinds");
+				chStyle.select(0);
+				
+				chTarget = new mChoice();
+				chTarget.addItem("Single GPX");
+				chTarget.addItem("Separate GPX");
+				chTarget.addItem("POI");
+				chTarget.select(0);
+				
+				ibPrefix = new mInput("GC-");
+				ibPrefix.modify(ControlConstants.Disabled, 0);
+				ibMaxLogs = new mInput(String
+						.valueOf(Global.getPref().numberOfLogsToExport));
+				ibMaxLogs.modify(ControlConstants.Disabled, 0);
+				
+				cbSeperateHints = new mCheckBox("Separate Hints");
+				cbSendToGarmin = new mCheckBox("send to Garmin");
+				cbCustomIcons = new mCheckBox("Custom Icons");
 
+				
+				addNext(new mLabel("Style"));
+				addLast(chStyle);
+				addNext(new mLabel("Names"));
+				addLast(chIds);
+				addNext(new mLabel("Target"));
+				addLast(chTarget);
+				addNext(cbCustomIcons);
+				addLast(cbSendToGarmin);
+				addLast(cbSeperateHints);
+				
+                addNext(new mLabel("Prefix"));
+                addLast(ibPrefix);
+                addNext(new mLabel("Max Logs"));
+                addLast(ibMaxLogs);
+				
+			}
+			
 			addButton(btnOk);
 			addButton(btnCancel);
+
 		}
 
 		/**
@@ -958,85 +1065,89 @@
 		 * radio button settings pass everything else to <code>super()</code>
 		 */
 		public void onEvent(Event ev) {
-			if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
-
-				if (ev.target == cbgExportType) {
-					if (cbgExportType.getSelected() == cbCompact) {
-						if (cbCustomIcons.change(0, ControlConstants.Disabled))
-							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(0, ControlConstants.Disabled))
-							cbSeperateFiles.repaint();
-						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0, ControlConstants.Disabled))
+			if (guiid == 0) {
+				if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
+	
+					if (ev.target == cbgExportType) {
+						if (cbgExportType.getSelected() == cbCompact) {
+							if (cbCustomIcons.change(0, ControlConstants.Disabled))
+								cbCustomIcons.repaint();
+							if (cbSeperateFiles.change(0, ControlConstants.Disabled))
+								cbSeperateFiles.repaint();
+							if (Global.getPref().gpsbabel != null)
+								if (cbSendToGarmin.change(0, ControlConstants.Disabled))
+									cbSendToGarmin.repaint();
+							if (cbSmartId.change(0, ControlConstants.Disabled))
+								cbSmartId.repaint();
+							if (ibMaxLogs.change(ControlConstants.Disabled, 0))
+								ibMaxLogs.repaint();
+						} else if (cbgExportType.getSelected() == cbPqLike) {
+							cbSeperateFiles.setState(false);
+							if (cbCustomIcons.change(0, ControlConstants.Disabled))
+								cbCustomIcons.repaint();
+							if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
+								cbSeperateFiles.repaint();
+							if (Global.getPref().gpsbabel != null)
+								if (cbSendToGarmin.change(0, ControlConstants.Disabled))
+									cbSendToGarmin.repaint();
+							if (cbSmartId.change(0, ControlConstants.Disabled))
+								cbSmartId.repaint();
+							if (ibPrefix.change(ControlConstants.Disabled, 0))
+								ibPrefix.repaint();
+							if (ibMaxLogs.change(ControlConstants.Disabled, 1))
+								ibMaxLogs.repaint();
+						} else if (cbgExportType.getSelected() == cbMyFinds) {
+							cbCustomIcons.setState(false);
+							cbSeperateFiles.setState(false);
+							cbSendToGarmin.setState(false);
+							cbSmartId.setState(false);
+							if (cbCustomIcons.change(ControlConstants.Disabled, 0))
+								cbCustomIcons.repaint();
+							if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
+								cbSeperateFiles.repaint();
+							if (cbSendToGarmin.change(ControlConstants.Disabled, 0))
 								cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, ControlConstants.Disabled))
-							cbSmartId.repaint();
-						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
-							ibMaxLogs.repaint();
-					} else if (cbgExportType.getSelected() == cbPqLike) {
-						cbSeperateFiles.setState(false);
-						if (cbCustomIcons.change(0, ControlConstants.Disabled))
-							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
-							cbSeperateFiles.repaint();
-						if (Global.getPref().gpsbabel != null)
-							if (cbSendToGarmin.change(0, ControlConstants.Disabled))
-								cbSendToGarmin.repaint();
-						if (cbSmartId.change(0, ControlConstants.Disabled))
-							cbSmartId.repaint();
-						if (ibPrefix.change(ControlConstants.Disabled, 0))
-							ibPrefix.repaint();
-						if (ibMaxLogs.change(ControlConstants.Disabled, 1))
-							ibMaxLogs.repaint();
-					} else if (cbgExportType.getSelected() == cbMyFinds) {
-						cbCustomIcons.setState(false);
-						cbSeperateFiles.setState(false);
-						cbSendToGarmin.setState(false);
-						cbSmartId.setState(false);
-						if (cbCustomIcons.change(ControlConstants.Disabled, 0))
-							cbCustomIcons.repaint();
-						if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
-							cbSeperateFiles.repaint();
-						if (cbSendToGarmin.change(ControlConstants.Disabled, 0))
-							cbSendToGarmin.repaint();
-						if (cbSmartId.change(ControlConstants.Disabled, 0))
-							cbSmartId.repaint();
-						if (ibPrefix.change(ControlConstants.Disabled, 0))
-							ibPrefix.repaint();
-						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
-							ibMaxLogs.repaint();
-					}
-				} else if (ev.target == cbSeperateFiles) {
-					if (cbSeperateFiles.state) {
-						if (ibPrefix.change(ControlConstants.Disabled, 1))
-							ibPrefix.repaint();
-					} else {
-						if (ibPrefix.change(ControlConstants.Disabled, 0))
-							ibPrefix.repaint();
-					}
-				} else if (ev.target == btnOk) {
-					if (cbPqLike.state) {
-						try {
-							int logs = getMaxLogs();
-							if (logs > -1) {
-								close(1);
-							} else {
+							if (cbSmartId.change(ControlConstants.Disabled, 0))
+								cbSmartId.repaint();
+							if (ibPrefix.change(ControlConstants.Disabled, 0))
+								ibPrefix.repaint();
+							if (ibMaxLogs.change(ControlConstants.Disabled, 0))
+								ibMaxLogs.repaint();
+						}
+					} else if (ev.target == cbSeperateFiles) {
+						if (cbSeperateFiles.state) {
+							if (ibPrefix.change(ControlConstants.Disabled, 1))
+								ibPrefix.repaint();
+						} else {
+							if (ibPrefix.change(ControlConstants.Disabled, 0))
+								ibPrefix.repaint();
+						}
+					} else if (ev.target == btnOk) {
+						if (cbPqLike.state) {
+							try {
+								int logs = getMaxLogs();
+								if (logs > -1) {
+									close(1);
+								} else {
+									ibMaxLogs.selectAll();
+									ibMaxLogs.takeFocus(0);
+									Sound.beep();
+								}
+							} catch (NumberFormatException e) {
 								ibMaxLogs.selectAll();
 								ibMaxLogs.takeFocus(0);
 								Sound.beep();
 							}
-						} catch (NumberFormatException e) {
-							ibMaxLogs.selectAll();
-							ibMaxLogs.takeFocus(0);
-							Sound.beep();
+						} else {
+							close(1);
 						}
-					} else {
-						close(1);
+	
+					} else if (ev.target == btnCancel) {
+						close(-1);
 					}
-
-				} else if (ev.target == btnCancel) {
-					close(-1);
 				}
+			} else if (guiid == 2) {
+				
 			}
 			super.onEvent(ev);
 		}



From engywuck at mail.berlios.de  Fri Jul 10 08:38:07 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Fri, 10 Jul 2009 08:38:07 +0200
Subject: [Cachewolf-svn] r2007 - in trunk: res_noewe src/CacheWolf
	src/CacheWolf/imp
Message-ID: <200907100638.n6A6c7PM027281@sheep.berlios.de>

Author: engywuck
Date: 2009-07-10 08:38:05 +0200 (Fri, 10 Jul 2009)
New Revision: 2007

Modified:
   trunk/res_noewe/spider.def
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Ignoring error when encountering a premium member cache page as non premium member.

Modified: trunk/res_noewe/spider.def
===================================================================
--- trunk/res_noewe/spider.def	2009-07-09 19:07:19 UTC (rev 2006)
+++ trunk/res_noewe/spider.def	2009-07-10 06:38:05 UTC (rev 2007)
@@ -92,6 +92,7 @@
 terrainRex         = <span\ id="Terrain">.*?alt="(.*?)\ out\ of
 cacheTypeRex       = \\./images/WptTypes/(.*?)\\.gif
 cacheLocationRex   = <span\ id="Location">In\ ([^<]*?)<
+premiumCachepage   = Sorry, the owner of this listing has made it viewable to subscribers only.
 
 #--------------------------------------
 #Section2a: Logs

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-07-09 19:07:19 UTC (rev 2006)
+++ trunk/src/CacheWolf/MainMenu.java	2009-07-10 06:38:05 UTC (rev 2007)
@@ -768,10 +768,10 @@
 			infB.redisplay();
 			if (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) {
 				int test = spider.spiderSingle(i, infB,forceLogin);
-				if (test == -1) {
+				if (test == SpiderGC.SPIDER_CANCEL) {
 					infB.close(0);
 					break;
-				} else if (test == 0) {
+				} else if (test == SpiderGC.SPIDER_ERROR) {
 					spiderErrors++;
 				} else {
 					//profile.hasUnsavedChanges=true;	

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-09 19:07:19 UTC (rev 2006)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-10 06:38:05 UTC (rev 2007)
@@ -71,6 +71,16 @@
 	public static String passwort = ""; // Can be pre-set from preferences
 	public static boolean loggedIn = false;
 
+	// Return values for spider action
+	/** Ignoring a premium member cache when spidering from a non premium account */
+	public static int SPIDER_IGNORE_PREMIUM = -2;
+	/** Canceling spider process */
+	public static int SPIDER_CANCEL = -1;
+	/** Error occured while spidering */
+	public static int SPIDER_ERROR = 0;
+	/** Cache was spidered without problems */
+	public static int SPIDER_OK = 1;
+	
 	private static int ERR_LOGIN = -10;
 	private static Preferences pref;
 	private Profile profile;
@@ -259,7 +269,7 @@
 			boolean loadAllLogs = (MAXLOGS > 5);
 			ret=getCacheByWaypointName(ch,true,pref.downloadPics,pref.downloadTBs,false,loadAllLogs);
 			// Save the spidered data
-			if (ret == 1) {
+			if (ret == SPIDER_OK) {
 				CacheHolder cacheInDB = cacheDB.get(number);
 				cacheInDB.initStates(false);
 				if (cacheInDB.is_found() && !ch.is_found() && ! loadAllLogs) {
@@ -639,17 +649,17 @@
 				holder = new CacheHolder();
 				holder.setWayPoint(wpt);
 				int test = getCacheByWaypointName(holder,false,getImages,getTBs,doNotgetFound,loadAllLogs);
-				if (test == -1) {
+				if (test == SPIDER_CANCEL) {
 					infB.close(0);
 					break;
-				} else if (test == 0) {
+				} else if (test == SPIDER_ERROR) {
 					spiderErrors++;
-				} else {
+				} else if (test == SPIDER_OK){
 					if (!holder.is_found() || !doNotgetFound ) {
 						cacheDB.add(holder);
 						holder.save();
 					}
-				}
+				} // For test==SPIDER_IGNORE_PREMIUM: Nothing to do
 			}
 		}
 
@@ -661,9 +671,9 @@
 				infB.redisplay();
 
 				int test = spiderSingle(cacheDB.getIndex(ch), infB,false);
-				if (test == -1) {
+				if (test == SPIDER_CANCEL) {
 					break;
-				} else if (test == 0) {
+				} else if (test == SPIDER_ERROR) {
 					spiderErrors++;
 					Global.getPref().log("SpiderGC: could not spider "+ch.getWayPoint());
 				} else {
@@ -701,13 +711,13 @@
 	 * @return -1 if the infoBox was closed (cancel spidering), 0 if there was an error (continue with next cache), 1 if everything ok
 	 */
 	private int getCacheByWaypointName(CacheHolder ch, boolean isUpdate, boolean fetchImages, boolean fetchTBs, boolean doNotGetFound, boolean fetchAllLogs) {
-		int ret = 1;
+		int ret = SPIDER_OK; // initialize value;
 		while (true) {
 			String completeWebPage;
 			int spiderTrys=0;
 			int MAX_SPIDER_TRYS=3;
 			while (spiderTrys++<MAX_SPIDER_TRYS) {
-				ret = 1;
+				ret = SPIDER_OK; // initialize value;
 				try{
 					String doc = p.getProp("getPageByName") + ch.getWayPoint() +(fetchAllLogs?p.getProp("fetchAllLogs"):"");
 					pref.log("Fetching: " + ch.getWayPoint());
@@ -718,7 +728,7 @@
 							continue;
 						} else {
 							ch.setIncomplete(true);
-							return -1;
+							return SPIDER_CANCEL;
 						}
 					}
 				}catch(Exception ex){
@@ -727,7 +737,7 @@
 						continue;
 					} else {
 						ch.setIncomplete(true);
-						return -1;
+						return SPIDER_CANCEL;
 					}
 				}
 				// Only analyse the cache data and fetch pictures if user has not closed the progress window
@@ -738,9 +748,17 @@
 						//first check if coordinates are available to prevent deleting existing coorinates
 						String latLon = getLatLon(completeWebPage);
 						if (latLon.equals("???")) {
-							pref.log(">>>> Failed to spider Cache. Retry.");
-							ret = 0;
-							continue; // Restart the spider
+							if (completeWebPage.indexOf(p.getProp("premiumCachepage"))>0) {
+								// Premium cache spidered by non premium member
+								pref.log("Ignoring premium member cache: "+ch.getWayPoint());
+								spiderTrys = MAX_SPIDER_TRYS;
+								ret = SPIDER_IGNORE_PREMIUM;
+								continue;
+							} else {
+								pref.log(">>>> Failed to spider Cache. Retry.");
+								ret = SPIDER_ERROR;
+								continue; // Restart the spider
+							}
 						}
 
 						ch.setHTML(true);
@@ -835,9 +853,9 @@
 						// If the switch is set to not store found caches and we found the cache => return
 						if (ch.is_found() && doNotGetFound) {
 							if (infB.isClosed) {
-								return -1;
+								return SPIDER_CANCEL;
 							} else {
-								return 1;
+								return SPIDER_OK;
 							}
 						}
 
@@ -886,21 +904,21 @@
 					break;
 				}
 			} // spiderTrys
-			if ( ( spiderTrys >= MAX_SPIDER_TRYS ) && ( ret == 1 ) ) {
+			if ( ( spiderTrys >= MAX_SPIDER_TRYS ) && ( ret == SPIDER_OK ) ) {
 				pref.log(">>> Failed to spider cache. Number of retrys exhausted.");
 				int decision = (new MessageBox(MyLocale.getMsg(5500,"Error"),MyLocale.getMsg(5515,"Failed to load cache.%0aPleas check your internet connection.%0aRetry?"),FormBase.DEFOKB|FormBase.NOB|FormBase.CANCELB)).execute();
 				if ( decision == FormBase.IDOK ) {
 					continue;
 				} else if ( decision == FormBase.IDNO ){
-					ret = 0;
+					ret = SPIDER_ERROR;
 				} else {
-					ret = -1;
+					ret = SPIDER_CANCEL;
 				}
 			}
 			break;
 		}//while(true)
 		if (infB.isClosed) {// If the infoBox was closed before getting here, we return -1
-			return -1;
+			return SPIDER_CANCEL;
 		}
 		return ret;
 	} // getCacheByWaypointName
@@ -1758,6 +1776,13 @@
 				(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5504,"Could not load 'spider.def'"), FormBase.OKB)).execute();
 			}
 		}
+		
+		/**
+		 * Gets an entry in spider.def by its key (tag)
+		 * @param key The key which is attributed to a specific entry
+		 * @return The value for the key
+		 * @throws Exception When a key is requested which doesn't exist
+		 */
 		public String getProp(String key) throws Exception {
 			String s=super.getProperty(key);
 			if (s==null) {



From greiol at mail.berlios.de  Fri Jul 10 21:37:24 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 10 Jul 2009 21:37:24 +0200
Subject: [Cachewolf-svn] r2008 - trunk/src/exp
Message-ID: <200907101937.n6AJbOSD008432@sheep.berlios.de>

Author: greiol
Date: 2009-07-10 21:37:23 +0200 (Fri, 10 Jul 2009)
New Revision: 2008

Modified:
   trunk/src/exp/GpxExportNg.java
Log:
redesign of dialog
do not create GPI file if bitmap is missing
separate progress bar for GPI creation after export


Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-10 06:38:05 UTC (rev 2007)
+++ trunk/src/exp/GpxExportNg.java	2009-07-10 19:37:23 UTC (rev 2008)
@@ -10,6 +10,7 @@
 import CacheWolf.Global;
 import CacheWolf.Log;
 import CacheWolf.LogList;
+import CacheWolf.MyLocale;
 import CacheWolf.SafeXML;
 
 import com.stevesoft.ewe_pat.Regex;
@@ -32,9 +33,9 @@
 import ewe.sys.Handle;
 import ewe.sys.Process;
 import ewe.sys.Vm;
-import ewe.ui.CheckBoxGroup;
 import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
+import ewe.ui.DataChangeEvent;
 import ewe.ui.Event;
 import ewe.ui.Form;
 import ewe.ui.FormBase;
@@ -61,11 +62,23 @@
 public class GpxExportNg {
 
 	/** export is in compact format */
-	final static int GPX_COMPACT = 0;
+	final static int STYLE_GPX_COMPACT = 0;
 	/** export is PQ like */
-	final static int GPX_PQLIKE = 1;
+	final static int STYLE_GPX_PQLIKE = 1;
 	/** export follows gc.com MyFinds format */
-	final static int GPX_MYFINDSPQ = 2;
+	final static int STYLE_GPX_MYFINDS = 2;
+	/** export uses only waypoint id */
+	final static int WPNAME_ID_CLASSIC = 0;
+	/** export uses waypointid + type, terrain, difficulty, size */
+	final static int WPNAME_ID_SMART = 2;
+	/** export uses cache names (will be made unique by gpsbabel) */
+	final static int WPNAME_NAME_SMART = 3;
+	/** write single GPX file */
+	final static int OUTPUT_SINGLE = 0;
+	/** write one file per "type" as determined by garminmap.xml */
+	final static int OUTPUT_SEPARATE = 1;
+	/** generate GPI files with gpsbabel using garminmap.xml types */
+	final static int OUTPUT_POI = 2;
 	/** name used as key when storing preferences */
 	final static String expName = "GpxExportNG";
 	/** string representation of true */
@@ -135,14 +148,18 @@
 			.concat("@@ADDILAT@@ @@ADDILON@@@@ADDIDELIM@@")
 			.concat("@@ADDILONG@@@@ADDIDELIM@@");
 
-	private static boolean smartIds;
 	private static boolean customIcons;
-	private static boolean separateFiles;
 	private static boolean sendToGarmin;
-	private static int outType;
+	private static boolean separateHints;
+	
+	private static int exportIds;
+	private static int exportTarget;
+	private static int exportStyle;
+	
 	private static boolean hasBitmaps;
 	private static boolean hasGarminMap;
 	private static boolean hasGpsbabel;
+	
 	private static String bitmapFileName;
 	private static String garminMapFileName;
 
@@ -169,13 +186,13 @@
 			return;
 		}
 
-		outType = exportOptions.getExportType();
-		smartIds = exportOptions.getSmartIds();
-		separateFiles = exportOptions.getSeparateFiles();
+		exportStyle = exportOptions.getExportStyle();
+		exportIds = exportOptions.getWpNameStyle();
+		exportTarget = exportOptions.getOutputTarget();
 		sendToGarmin = exportOptions.getSendToGarmin();
 		customIcons = exportOptions.getCustomIcons();
 
-		if (separateFiles) {
+		if (exportTarget == OUTPUT_SEPARATE || exportTarget == OUTPUT_POI) {
 			final Hashtable fileHandles = new Hashtable();
 			final String outDir;
 			final String tempDir;
@@ -184,7 +201,7 @@
 			final FileChooser fc;
 			ZipFile poiZip = null;
 
-			if (sendToGarmin) {
+			if (exportTarget == OUTPUT_POI) {
 				fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, 
 						Global.getPref().getExportPath(expName + "-GPI"));
 			} else {
@@ -198,7 +215,7 @@
 				return;
 
 			outDir = fc.getChosenFile().getFullPath();
-			if (sendToGarmin) {
+			if (exportTarget == OUTPUT_POI) {
 				Global.getPref().setExportPath(expName + "-GPI", outDir);
 			} else {
 				Global.getPref().setExportPath(expName + "-POI", outDir);
@@ -214,7 +231,7 @@
 				return;
 			}
 
-			if (sendToGarmin) {
+			if (exportTarget == OUTPUT_POI) {
 				// FIXME: create proper tempdir
 				tempDir = baseDir + FileBase.separator + "GPXExporterNG.tmp";
 				new File(tempDir).mkdir();
@@ -252,14 +269,14 @@
 					} else if (ch.is_incomplete()) {
 						Global.getPref().log(
 								"skipping export of incomplete waypoint "
-										+ ch.getWayPoint());
+								+ ch.getWayPoint());
 					} else {
 						String poiId = poiMapper.getPoiId(ch);
 						if (null == poiId) {
 							Global.getPref().log(
 									"GPX Export: unmatched POI ID for "
-											+ ch.getWayPoint() + " of type "
-											+ ch.getType());
+									+ ch.getWayPoint() + " of type "
+									+ ch.getType());
 							exportErrors++;
 						} else {
 							PrintWriter writer;
@@ -267,8 +284,8 @@
 								writer = (PrintWriter) fileHandles.get(poiId);
 							} else {
 								writer = new PrintWriter(new BufferedWriter(
-										new FileWriter(new File(tempDir
-												+ FileBase.separator + prefix
+										new FileWriter(new File(tempDir	
+												+ FileBase.separator + prefix 
 												+ poiId + ".gpx"))));
 								fileHandles.put(poiId, writer);
 								writer.print(formatHeader());
@@ -283,21 +300,17 @@
 				}
 
 				try {
-					poiZip = new ZipFile(FileBase.getProgramDirectory()
-							+ FileBase.separator + "GarminPOI.zip");
+					poiZip = new ZipFile(FileBase.getProgramDirectory()	+ FileBase.separator + "GarminPOI.zip");
 				} catch (IOException e) {
-					Global.getPref().log(
-							"GPX Export: warning GarminPOI.zip not found", e,
-							Global.getPref().debug);
+					Global.getPref().log("GPX Export: warning GarminPOI.zip not found", e, Global.getPref().debug);
 					exportErrors++;
 				}
 
-				if (sendToGarmin) {
+				if (exportTarget == OUTPUT_POI) {
 					String tmp[] = new FileBugfix(outDir).list(
 							prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
 					for (int i = 0; i < tmp.length; i++) {
-						FileBugfix tmpFile = new FileBugfix(outDir
-								+ FileBase.separator + tmp[i]);
+						FileBugfix tmpFile = new FileBugfix(outDir + FileBase.separator + tmp[i]);
 						tmpFile.delete();
 					}
 					pbf.exit(0);
@@ -314,7 +327,7 @@
 
 					writer.print("</gpx>\n");
 					writer.close();
-					if (sendToGarmin) {
+					if (exportTarget == OUTPUT_POI) {
 						poiCounter++;
 						h.progress = (float) poiCounter / (float) poiCategories;
 						h.changed();
@@ -325,7 +338,7 @@
 							continue;
 						}
 
-						if (sendToGarmin) {
+						if (exportTarget == OUTPUT_POI) {
 							String[] cmdStack = new String[9];
 							cmdStack[0]=Global.getPref().gpsbabel;
 							cmdStack[1]="-i";
@@ -357,7 +370,7 @@
 					}
 				}
 
-				if (sendToGarmin) {
+				if (exportTarget == OUTPUT_POI) {
 					FileBugfix tmpdir = new FileBugfix(tempDir);
 					String tmp[] = new FileBugfix(tempDir).list(prefix + "*.*",
 							ewe.io.FileBase.LIST_FILES_ONLY);
@@ -386,7 +399,7 @@
 				}
 			}
 
-			if (outType == GPX_PQLIKE) {
+			if (exportStyle == STYLE_GPX_PQLIKE) {
 				maxLogs = exportOptions.getMaxLogs();
 				if (maxLogs != Global.getPref().numberOfLogsToExport) {
 					Global.getPref().numberOfLogsToExport = maxLogs;
@@ -502,7 +515,7 @@
 	 */
 	private String formatCache(CacheHolder ch) {
 		// no addis or custom in MyFindsPq - and of course only finds
-		if ((GPX_MYFINDSPQ == outType) && ((ch.getType() == CacheType.CW_TYPE_CUSTOM) || ch.isAddiWpt() || !ch.is_found()))
+		if ((STYLE_GPX_MYFINDS == exportStyle) && ((ch.getType() == CacheType.CW_TYPE_CUSTOM) || ch.isAddiWpt() || !ch.is_found()))
 			return "";
 
 		if (!ch.pos.isValid())
@@ -513,7 +526,7 @@
 		try {
 			ret.append(formatCompact(ch));
 
-			if (outType != GPX_COMPACT && !(ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt())) {
+			if (exportStyle != STYLE_GPX_COMPACT && !(ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt())) {
 				ret.append(formatPqExtensions(ch));
 			}
 
@@ -558,7 +571,7 @@
 			trans.add(new Regex("@@CACHETIME@@", ch.getDateHidden()));
 		}
 
-		if (smartIds && ch.getType() != CacheType.CW_TYPE_CUSTOM) {
+		if (exportIds == WPNAME_ID_SMART && ch.getType() != CacheType.CW_TYPE_CUSTOM) {
 			if (ch.isAddiWpt()) {
 				trans.add(new Regex("@@WPNAME@@", SafeXML.cleanGPX(
 						ch.mainCache.getWayPoint().concat(" ").concat(ch.getWayPoint().substring(0, 2)))));
@@ -578,7 +591,7 @@
 		if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
 			trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)));
 		} else {
-			if (smartIds && outType == GPX_COMPACT) {
+			if (exportIds == WPNAME_ID_SMART && exportStyle == STYLE_GPX_COMPACT) {
 				if (ch.isAddiWpt()) {
 					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + ch.getFreshDetails().LongDescription)));
 				} else {
@@ -705,7 +718,7 @@
 
 	/**
 	 * format cache logs as found in a gc.com GPX file
-	 * @param ch cacheholder containing the logs
+	 * @param ch CacheHolder containing the logs
 	 * @return formatted logs or empty string if no logs are present
 	 */
 	public String formatLogs(CacheHolder ch) {
@@ -713,7 +726,7 @@
 		StringBuffer ret = new StringBuffer();
 		String fid = "";
 		
-		if (outType == GPX_MYFINDSPQ) 
+		if (exportStyle == STYLE_GPX_MYFINDS) 
 			fid = finderid; 
 
 		if (0 == logs.size())
@@ -721,7 +734,7 @@
 
 		int exportlogs;
 
-		if (outType == GPX_PQLIKE && maxLogs < logs.size()) {
+		if (exportStyle == STYLE_GPX_PQLIKE && maxLogs < logs.size()) {
 			exportlogs = maxLogs;
 		} else {
 			exportlogs = logs.size();
@@ -731,10 +744,10 @@
 			String logId = "";
 			Log log = logs.getLog(i);
 
-			if (outType == GPX_MYFINDSPQ && !log.getLogger().equals(Global.getPref().myAlias))
+			if (exportStyle == STYLE_GPX_MYFINDS && !log.getLogger().equals(Global.getPref().myAlias))
 					continue;
 
-//			if (outType == GPX_MYFINDSPQ) 
+//			if (exportStyle == STYLE_GPX_MYFINDS) 
 //				logId = log.getLogId();
 			
 			Transformer trans = new Transformer(true);
@@ -763,7 +776,7 @@
 
 	/**
 	 * format a long description as found in the gc.com GPX files
-	 * @param ch cacheholder to format
+	 * @param ch CacheHolder to format
 	 * @return formatted output
 	 */
 	public String formatLongDescription(CacheHolder ch) {
@@ -780,7 +793,7 @@
 			}
 			// FIXME: format is not quite right yet
 			// FIXME: cut Addis off in GPXimporter otherwise people who use GPX to feed CacheWolf have them doubled
-			if (ch.addiWpts.size() > 0 && outType != GPX_MYFINDSPQ) {
+			if (ch.addiWpts.size() > 0 && exportStyle != STYLE_GPX_MYFINDS) {
 				if (ch.is_HTML()) {
 					ret.append("\n\n<p>Additional Waypoints</p>");
 				} else {
@@ -805,6 +818,11 @@
 		}
 	}
 
+	/**
+	 * generate a gc.com compatible string representation of log derived from the internally stored image 
+	 * @param image name of the image to display
+	 * @return log type. will default to "Write note" for unknown logtypes
+	 */
 	public String image2TypeText(String image) {
 		if (image.equals("icon_smile.gif"))
 			return "Found it";
@@ -927,9 +945,8 @@
 	 * dialog to set the GPX exporter options
 	 */
 	private class GpxExportNgForm extends Form {
-		private CheckBoxGroup cbgExportType, cbgWpName;
-		private mCheckBox cbCompact, cbPqLike, cbMyFinds, cbCustomIcons,cbSeperateFiles, cbSendToGarmin, cbSmartId;
-		private mCheckBox cbWpClassic, cbWpSmartId, cbWpSmartName, cbCreatePoi, cbSeperateHints;
+
+		private mCheckBox cbCustomIcons, cbSendToGarmin, cbSeperateHints;
 		private mInput ibMaxLogs, ibPrefix;
 		private mButton btnOk, btnCancel;
 		
@@ -937,127 +954,93 @@
 		private boolean hasGarminMap;
 		private boolean hasGpsbabel;
 		
-		private int guiid;
-		
 		private mChoice chStyle, chTarget, chIds;
+		private int chosenStyle, chosenTarget, chosenIds;
 
 		/**
 		 * set up the form / dialog
 		 */
 		public GpxExportNgForm(boolean hasGarminMap, boolean hasBitmaps, boolean hasGpsbabel) {
 
-			guiid=0;
-
 			this.hasBitmaps = hasBitmaps;
 			this.hasGarminMap = hasGarminMap;
 			this.hasGpsbabel = hasGpsbabel;
 			
 			// TODO: get/set defaults from profile
+			chosenStyle = 0;
+			chosenTarget = 0;
+			chosenIds = 0;
 
 			this.setTitle("GPX Export");
 			this.resizable = false;
 			
-			btnOk = new mButton("OK");
-			btnCancel = new mButton("Cancel");
+			btnOk = new mButton(MyLocale.getMsg(1605,"OK"));
+			btnCancel = new mButton(MyLocale.getMsg(1604,"Cancel"));
 			
-			if (guiid == 0) {
-                cbgExportType = new CheckBoxGroup();
-
-                cbCompact = new mCheckBox("Compact");
-                cbCompact.setGroup(cbgExportType);
-
-                cbPqLike = new mCheckBox("PQ like");
-                cbPqLike.setGroup(cbgExportType);
-
-                cbMyFinds = new mCheckBox("MyFinds");
-                cbMyFinds.setGroup(cbgExportType);
-
-                cbgExportType.setText("Compact");
-
-                cbCustomIcons = new mCheckBox("custom icons");
-
-                cbSeperateFiles = new mCheckBox("one file per type");
-
-                cbSendToGarmin = new mCheckBox("send to Garmin GPSr");
-                if (Global.getPref().gpsbabel == null)
-                        cbSendToGarmin.modify(ControlConstants.Disabled, 0);
-
-                cbSmartId = new mCheckBox("use smart IDs");
-
-                ibPrefix = new mInput("GC-");
-                ibPrefix.modify(ControlConstants.Disabled, 0);
-                ibMaxLogs = new mInput(String
-                                .valueOf(Global.getPref().numberOfLogsToExport));
-                ibMaxLogs.modify(ControlConstants.Disabled, 0);
-
-                addNext(cbCustomIcons);
-                addLast(cbCompact);
-                addNext(cbSeperateFiles);
-                addLast(cbPqLike);
-                addNext(cbSendToGarmin);
-                addLast(cbMyFinds);
-                
-                addLast(cbSmartId);
-                addNext(new mLabel("Prefix"));
-                addLast(new mLabel("Max Logs"));
-
-                addNext(ibPrefix);
-                addLast(ibMaxLogs);
-
-                addButton(btnOk);
-                addButton(btnCancel);
-
-			} else if (guiid == 2) {
-				
-				chIds = new mChoice();
-				chIds.addItem("Classic IDs");
-				chIds.addItem("Smart IDs");
-				chIds.addItem("Smart Names");
-				chIds.select(0);
-				
-				chStyle = new mChoice();
-				chStyle.addItem("Compact");
-				chStyle.addItem("PQ like");
-				chStyle.addItem("MyFinds");
-				chStyle.select(0);
-				
-				chTarget = new mChoice();
-				chTarget.addItem("Single GPX");
-				chTarget.addItem("Separate GPX");
-				chTarget.addItem("POI");
-				chTarget.select(0);
-				
-				ibPrefix = new mInput("GC-");
-				ibPrefix.modify(ControlConstants.Disabled, 0);
-				ibMaxLogs = new mInput(String
-						.valueOf(Global.getPref().numberOfLogsToExport));
-				ibMaxLogs.modify(ControlConstants.Disabled, 0);
-				
-				cbSeperateHints = new mCheckBox("Separate Hints");
-				cbSendToGarmin = new mCheckBox("send to Garmin");
-				cbCustomIcons = new mCheckBox("Custom Icons");
-
-				
-				addNext(new mLabel("Style"));
-				addLast(chStyle);
-				addNext(new mLabel("Names"));
-				addLast(chIds);
-				addNext(new mLabel("Target"));
-				addLast(chTarget);
-				addNext(cbCustomIcons);
-				addLast(cbSendToGarmin);
-				addLast(cbSeperateHints);
-				
-                addNext(new mLabel("Prefix"));
-                addLast(ibPrefix);
-                addNext(new mLabel("Max Logs"));
-                addLast(ibMaxLogs);
-				
+			chIds = new mChoice();
+			chIds.dontSearchForKeys = true;
+			// if you change the order of strings make sure to fix the event handler as well
+			chIds.addItem(MyLocale.getMsg(31415,"Classic IDs")); // index 0
+			chIds.addItem(MyLocale.getMsg(31415,"Smart IDs")); // index 1
+//			chIds.addItem(MyLocale.getMsg(31415,"Smart Names")); // index 2
+			chIds.select(chosenIds);
+			
+			chStyle = new mChoice();
+			chStyle.dontSearchForKeys = true;
+			// if you change the order of strings make sure to fix the event handler as well
+			chStyle.addItem(MyLocale.getMsg(31415,"Compact")); // index 0
+			chStyle.addItem(MyLocale.getMsg(31415,"PQ like")); // index 1
+			chStyle.addItem(MyLocale.getMsg(31415,"MyFinds")); // index 2
+			chStyle.select(chosenStyle);
+			
+			chTarget = new mChoice();
+			chTarget.dontSearchForKeys = true;
+			// if you change the order of strings make sure to fix the event handler as well
+			chTarget.addItem(MyLocale.getMsg(31415,"Single GPX")); // index 0
+			chTarget.addItem(MyLocale.getMsg(31415,"Separate GPX")); // index 1 
+			if (hasBitmaps && hasGarminMap && hasGpsbabel) {
+				chTarget.addItem(MyLocale.getMsg(31415,"POI")); // index 2
 			}
+			chTarget.select(chosenTarget);
 			
+			ibPrefix = new mInput("GC-");
+			ibPrefix.modify(ControlConstants.Disabled, 0);
+			
+			ibMaxLogs = new mInput(String.valueOf(Global.getPref().numberOfLogsToExport));
+			ibMaxLogs.modify(ControlConstants.Disabled, 0);
+			
+			cbSeperateHints = new mCheckBox(MyLocale.getMsg(31415,"Separate Hints"));
+			cbSeperateHints.modify(ControlConstants.Disabled, 0);
+			
+			cbSendToGarmin = new mCheckBox(MyLocale.getMsg(31415,"send to Garmin"));
+			if (!hasGpsbabel) cbSendToGarmin.modify(ControlConstants.Disabled, 0);
+			
+			cbCustomIcons = new mCheckBox(MyLocale.getMsg(31415,"Custom Icons"));
+			if (!hasGarminMap) cbCustomIcons.modify(ControlConstants.Disabled, 0);
+
+			
+			addNext(new mLabel(MyLocale.getMsg(31415,"GPX Style")));
+			addLast(chStyle);
+			
+			addNext(new mLabel(MyLocale.getMsg(31415,"WP Names")));
+			addLast(chIds);
+			
+			addNext(new mLabel(MyLocale.getMsg(31415,"Output")));
+			addLast(chTarget);
+			
+			addNext(cbCustomIcons);
+			addLast(cbSendToGarmin);
+			
+//			addLast(cbSeperateHints);
+			
+            addNext(new mLabel(MyLocale.getMsg(31415,"Prefix")));
+            addLast(ibPrefix);
+            
+            addNext(new mLabel(MyLocale.getMsg(31415,"Max Logs")));
+            addLast(ibMaxLogs);
+			
 			addButton(btnOk);
 			addButton(btnCancel);
-
 		}
 
 		/**
@@ -1065,113 +1048,184 @@
 		 * radio button settings pass everything else to <code>super()</code>
 		 */
 		public void onEvent(Event ev) {
-			if (guiid == 0) {
-				if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
-	
-					if (ev.target == cbgExportType) {
-						if (cbgExportType.getSelected() == cbCompact) {
-							if (cbCustomIcons.change(0, ControlConstants.Disabled))
-								cbCustomIcons.repaint();
-							if (cbSeperateFiles.change(0, ControlConstants.Disabled))
-								cbSeperateFiles.repaint();
-							if (Global.getPref().gpsbabel != null)
-								if (cbSendToGarmin.change(0, ControlConstants.Disabled))
-									cbSendToGarmin.repaint();
-							if (cbSmartId.change(0, ControlConstants.Disabled))
-								cbSmartId.repaint();
-							if (ibMaxLogs.change(ControlConstants.Disabled, 0))
-								ibMaxLogs.repaint();
-						} else if (cbgExportType.getSelected() == cbPqLike) {
-							cbSeperateFiles.setState(false);
-							if (cbCustomIcons.change(0, ControlConstants.Disabled))
-								cbCustomIcons.repaint();
-							if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
-								cbSeperateFiles.repaint();
-							if (Global.getPref().gpsbabel != null)
-								if (cbSendToGarmin.change(0, ControlConstants.Disabled))
-									cbSendToGarmin.repaint();
-							if (cbSmartId.change(0, ControlConstants.Disabled))
-								cbSmartId.repaint();
-							if (ibPrefix.change(ControlConstants.Disabled, 0))
-								ibPrefix.repaint();
-							if (ibMaxLogs.change(ControlConstants.Disabled, 1))
-								ibMaxLogs.repaint();
-						} else if (cbgExportType.getSelected() == cbMyFinds) {
-							cbCustomIcons.setState(false);
-							cbSeperateFiles.setState(false);
-							cbSendToGarmin.setState(false);
-							cbSmartId.setState(false);
-							if (cbCustomIcons.change(ControlConstants.Disabled, 0))
-								cbCustomIcons.repaint();
-							if (cbSeperateFiles.change(ControlConstants.Disabled, 0))
-								cbSeperateFiles.repaint();
-							if (cbSendToGarmin.change(ControlConstants.Disabled, 0))
-								cbSendToGarmin.repaint();
-							if (cbSmartId.change(ControlConstants.Disabled, 0))
-								cbSmartId.repaint();
-							if (ibPrefix.change(ControlConstants.Disabled, 0))
-								ibPrefix.repaint();
-							if (ibMaxLogs.change(ControlConstants.Disabled, 0))
-								ibMaxLogs.repaint();
-						}
-					} else if (ev.target == cbSeperateFiles) {
-						if (cbSeperateFiles.state) {
-							if (ibPrefix.change(ControlConstants.Disabled, 1))
-								ibPrefix.repaint();
-						} else {
-							if (ibPrefix.change(ControlConstants.Disabled, 0))
-								ibPrefix.repaint();
-						}
-					} else if (ev.target == btnOk) {
-						if (cbPqLike.state) {
-							try {
-								int logs = getMaxLogs();
-								if (logs > -1) {
-									close(1);
-								} else {
-									ibMaxLogs.selectAll();
-									ibMaxLogs.takeFocus(0);
-									Sound.beep();
-								}
-							} catch (NumberFormatException e) {
+			if (ev instanceof DataChangeEvent && ev.type == DataChangeEvent.DATA_CHANGED) {
+				if (ev.target == chStyle && chStyle.selectedIndex != chosenStyle) {
+					if (chStyle.selectedIndex == 2) { // my finds export
+						chIds.select(0);
+						if (chIds.change(ControlConstants.Disabled, 0))
+							chIds.repaint();
+						
+						chTarget.select(0);
+						if (chTarget.change(ControlConstants.Disabled, 0))
+							chTarget.repaint();
+						
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
+							ibPrefix.repaint();
+						
+						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
+							ibMaxLogs.repaint();							
+
+						cbSendToGarmin.state = false;
+						if (cbSendToGarmin.change(ControlConstants.Disabled, 0))
+							cbSendToGarmin.repaint();
+						
+						cbCustomIcons.state = false;
+						if (cbCustomIcons.change(ControlConstants.Disabled, 0))
+							cbCustomIcons.repaint();
+						
+						cbSeperateHints.state = false;
+						if (cbSeperateHints.change(ControlConstants.Disabled, 0))
+							cbSeperateHints.repaint();
+						
+						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
+							ibMaxLogs.repaint();
+						
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
+							ibPrefix.repaint();
+					} else if (chStyle.selectedIndex == 1) { // PQ like export
+						if (chIds.change(0, ControlConstants.Disabled))
+							chIds.repaint();
+						
+						chTarget.select(0);
+						if (chTarget.change(ControlConstants.Disabled, 0))
+							chTarget.repaint();
+						
+						if (hasGpsbabel && cbSendToGarmin.change(0, ControlConstants.Disabled))
+							cbSendToGarmin.repaint();
+						
+						if (hasGarminMap && cbCustomIcons.change(0, ControlConstants.Disabled))
+							cbCustomIcons.repaint();
+						
+						cbSeperateHints.state = false;
+						if (cbSeperateHints.change(ControlConstants.Disabled, 0))
+							cbSeperateHints.repaint();
+						
+						if (ibMaxLogs.change(0, ControlConstants.Disabled))
+							ibMaxLogs.repaint();
+
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
+							ibPrefix.repaint();
+					} else { // compact export
+						if (chIds.change(0, ControlConstants.Disabled))
+							chIds.repaint();
+						
+						if (chTarget.change(0, ControlConstants.Disabled))
+							chTarget.repaint();
+						
+						if (hasGpsbabel && cbSendToGarmin.change(0, ControlConstants.Disabled))
+							cbSendToGarmin.repaint();
+						
+						if (hasGarminMap && cbCustomIcons.change(0, ControlConstants.Disabled))
+							cbCustomIcons.repaint();
+						
+						cbSeperateHints.state = false;
+						if (cbSeperateHints.change(ControlConstants.Disabled, 0))
+							cbSeperateHints.repaint();
+						
+						if (ibMaxLogs.change(ControlConstants.Disabled, 0))
+							ibMaxLogs.repaint();
+					}
+					chosenStyle = chStyle.selectedIndex;
+				} else if (ev.target == chTarget && chTarget.selectedIndex != chosenTarget) {
+					if (chTarget.selectedIndex == 2) { // POI
+						cbSendToGarmin.state = false;
+						if (cbSendToGarmin.change(ControlConstants.Disabled, 0))
+							cbSendToGarmin.repaint();
+						
+						cbCustomIcons.state = false;
+						if (cbCustomIcons.change(ControlConstants.Disabled, 0))
+							cbCustomIcons.repaint();
+						
+						if (cbSeperateHints.change(0, ControlConstants.Disabled))
+							cbSeperateHints.repaint();
+						
+						if (ibPrefix.change(0, ControlConstants.Disabled))
+							ibPrefix.repaint();
+					} else if (chTarget.selectedIndex == 1) { // Separate File
+						cbSendToGarmin.state = false;
+						if (cbSendToGarmin.change(ControlConstants.Disabled, 0))
+							cbSendToGarmin.repaint();
+						
+						if (hasBitmaps && cbCustomIcons.change(0, ControlConstants.Disabled))
+							cbCustomIcons.repaint();
+						
+						if (cbSeperateHints.change(0, ControlConstants.Disabled))
+							cbSeperateHints.repaint();
+						
+						if (ibPrefix.change(0, ControlConstants.Disabled))
+							ibPrefix.repaint();
+					} else { // Single GPX
+						if (hasGpsbabel && cbSendToGarmin.change(0, ControlConstants.Disabled))
+							cbSendToGarmin.repaint();
+						
+						if (hasGarminMap && cbCustomIcons.change(0, ControlConstants.Disabled))
+							cbCustomIcons.repaint();
+						
+						cbSeperateHints.state=false;
+						if (cbSeperateHints.change(ControlConstants.Disabled, 0))
+							cbSeperateHints.repaint();
+						
+						if (ibPrefix.change(ControlConstants.Disabled, 0))
+							ibPrefix.repaint();
+					}
+
+					chosenTarget = chTarget.selectedIndex;
+				} else if (ev.target == chIds && chIds.selectedIndex != chosenIds) {
+					chosenIds = chIds.selectedIndex;
+				}
+			} else if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
+				if (ev.target == btnCancel) {
+					close(-1);
+				} else if (ev.target == btnOk) {
+					if (chosenStyle == GpxExportNg.STYLE_GPX_PQLIKE) {
+						try {
+							int logs = getMaxLogs();
+							if (logs > -1) {
+								close(1);
+							} else {
 								ibMaxLogs.selectAll();
 								ibMaxLogs.takeFocus(0);
 								Sound.beep();
 							}
-						} else {
-							close(1);
+						} catch (NumberFormatException e) {
+							ibMaxLogs.selectAll();
+							ibMaxLogs.takeFocus(0);
+							Sound.beep();
 						}
-	
-					} else if (ev.target == btnCancel) {
-						close(-1);
+					} else {
+						close(1);
 					}
 				}
-			} else if (guiid == 2) {
-				
 			}
+
 			super.onEvent(ev);
 		}
 
 		/**
-		 * get the export type the user selected
-		 * 
-		 * @return index of selected option in checkboxgroup
-		 * @see GpxExportNg
+		 * amount of data to be exported
+		 * @return 0 Compact, 1 PQ like, 2 MyFinds
 		 */
-		public int getExportType() {
-			return cbgExportType.getSelectedIndex();
+		public int getExportStyle () {
+			return chosenStyle;
 		}
-
+		
 		/**
-		 * check if the user wants smart IDs
-		 * 
-		 * @return true for smart IDs, false otherwise
+		 * style of waypoint identifiers
+		 * @return 0 Classic IDs, 1 Smart IDs, 3 Smart Names (should only be used with gpsbabel)
 		 */
-		public boolean getSmartIds() {
-			return cbSmartId.state;
+		public int getWpNameStyle() {
+			return chosenIds;
 		}
-
+		
 		/**
+		 * what kind of output should be generated
+		 * @return 0 single file, 1 separate files, 2 POI (GPI) files
+		 */
+		public int getOutputTarget() {
+			return chosenTarget;
+		}
+		
+		/**
 		 * check if user wants to send output straight to a Garmin GPSr
 		 * 
 		 * @return true for GPSr transfer, false otherwise
@@ -1190,15 +1244,6 @@
 		}
 
 		/**
-		 * check if user wants separate files (POI loader)
-		 * 
-		 * @return true for separate files, false for single file
-		 */
-		public boolean getSeparateFiles() {
-			return cbSeperateFiles.state;
-		}
-
-		/**
 		 * get the number of logs to export. used in PQlike export.
 		 * 
 		 * @return number of logs to export
@@ -1208,7 +1253,7 @@
 		}
 
 		/**
-		 * get prefix for sepearte file export
+		 * get prefix for separate file export
 		 * 
 		 * @return prefix for separate file export
 		 */



From greiol at mail.berlios.de  Sat Jul 11 08:45:46 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sat, 11 Jul 2009 08:45:46 +0200
Subject: [Cachewolf-svn] r2009 - trunk/docs/CacheWolf Doku
Message-ID: <200907110645.n6B6jkxM005479@sheep.berlios.de>

Author: greiol
Date: 2009-07-11 08:45:43 +0200 (Sat, 11 Jul 2009)
New Revision: 2009

Added:
   trunk/docs/CacheWolf Doku/CacheWolf_Dokumentation.xml
   trunk/docs/CacheWolf Doku/Der_erste_Start.xml
Removed:
   trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml
   trunk/docs/CacheWolf Doku/Der erste Start.xml
Log:
couldn't properly open the files due to the blanks in file and section names

Deleted: trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml
===================================================================
--- trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml	2009-07-10 19:37:23 UTC (rev 2008)
+++ trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml	2009-07-11 06:45:43 UTC (rev 2009)
@@ -1,33 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
-"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [
-<!ENTITY __Installation__f6afn1eo SYSTEM "Installation.xml">
-<!ENTITY __DerersteStart__f6anus0g SYSTEM "Der%20erste%20Start.xml">
-<!ENTITY __ansichten__f6anvxip SYSTEM "ansichten.xml">
-<!ENTITY __menu__fay2x5r3 SYSTEM "menu.xml">
-<!ENTITY __benutzte_dateien__fe71ytbk SYSTEM "benutzte_dateien.xml">
-]>
-<book>
-  <title>CacheWolf Dokumentation</title>
-
-  <bookinfo>
-    <edition>1.0</edition>
-
-    <productnumber>1.0</productnumber>
-
-    <pubdate>Noch nicht ver?ffentlicht!</pubdate>
-
-    <releaseinfo>Dieses Dokument in der Ausgabe 1.0 bezieht sich auf die
-    CacheWolf Version 1.0.</releaseinfo>
-  </bookinfo>
-
-  &__Installation__f6afn1eo;
-
-  &__DerersteStart__f6anus0g;
-
-  &__ansichten__f6anvxip;
-
-  &__menu__fay2x5r3;
-
-  &__benutzte_dateien__fe71ytbk;
-</book>
\ No newline at end of file

Copied: trunk/docs/CacheWolf Doku/CacheWolf_Dokumentation.xml (from rev 2008, trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml)
===================================================================
--- trunk/docs/CacheWolf Doku/CacheWolf Dokumentation.xml	2009-07-10 19:37:23 UTC (rev 2008)
+++ trunk/docs/CacheWolf Doku/CacheWolf_Dokumentation.xml	2009-07-11 06:45:43 UTC (rev 2009)
@@ -0,0 +1,33 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
+"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [
+<!ENTITY __Installation__f6afn1eo SYSTEM "Installation.xml">
+<!ENTITY __DerersteStart__f6anus0g SYSTEM "Der_erste_Start.xml">
+<!ENTITY __ansichten__f6anvxip SYSTEM "ansichten.xml">
+<!ENTITY __menu__fay2x5r3 SYSTEM "menu.xml">
+<!ENTITY __benutzte_dateien__fe71ytbk SYSTEM "benutzte_dateien.xml">
+]>
+<book>
+  <title>CacheWolf Dokumentation</title>
+
+  <bookinfo>
+    <edition>1.0</edition>
+
+    <productnumber>1.0</productnumber>
+
+    <pubdate>Noch nicht ver?ffentlicht!</pubdate>
+
+    <releaseinfo>Dieses Dokument in der Ausgabe 1.0 bezieht sich auf die
+    CacheWolf Version 1.0.</releaseinfo>
+  </bookinfo>
+
+  &__Installation__f6afn1eo;
+
+  &__DerersteStart__f6anus0g;
+
+  &__ansichten__f6anvxip;
+
+  &__menu__fay2x5r3;
+
+  &__benutzte_dateien__fe71ytbk;
+</book>
\ No newline at end of file


Property changes on: trunk/docs/CacheWolf Doku/CacheWolf_Dokumentation.xml
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/docs/CacheWolf Doku/Der erste Start.xml
===================================================================
--- trunk/docs/CacheWolf Doku/Der erste Start.xml	2009-07-10 19:37:23 UTC (rev 2008)
+++ trunk/docs/CacheWolf Doku/Der erste Start.xml	2009-07-11 06:45:43 UTC (rev 2009)
@@ -1,471 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<chapter>
-  <chapterinfo>
-    <title>Der erste Start</title>
-
-    <date>12.3.2008</date>
-
-    <releaseinfo>CacheWolf 1.0</releaseinfo>
-
-    <author>
-      <surname>Marc Schnitzler</surname>
-    </author>
-
-    <revhistory>
-      <revision>
-        <revnumber>0.1</revnumber>
-
-        <date>7. September 2007</date>
-
-        <author>
-          <surname>Marc Schnitzler</surname>
-        </author>
-
-        <revdescription>
-          <para>Erster Entwurf, kopiert www.cachewolf.de</para>
-        </revdescription>
-      </revision>
-
-      <revision>
-        <revnumber>0.2</revnumber>
-
-        <date>14. November 2007</date>
-
-        <author>
-          <surname>Marc Schnitzler</surname>
-        </author>
-
-        <revdescription>
-          <para>Alles Relevante f?r diesen Abschnitt von cachewolf.de
-          kopiert</para>
-        </revdescription>
-      </revision>
-
-      <revision>
-        <revnumber>0.99</revnumber>
-
-        <date>12. M?rz 2008</date>
-
-        <author>
-          <surname>Marc Schnitzler</surname>
-        </author>
-
-        <revdescription>
-          <para>Kapitel fertig.</para>
-        </revdescription>
-      </revision>
-    </revhistory>
-  </chapterinfo>
-
-  <title>Der erste Start</title>
-
-  <section>
-    <title id="start">Programmstart</title>
-
-    <para>Wenn man CacheWolf zum ersten Mal startet, erscheint erst folgendes
-    Bild:</para>
-
-    <para><inlinemediaobject>
-        <imageobject>
-          <imagedata fileref="pics/lade_liste.jpg" />
-        </imageobject>
-      </inlinemediaobject></para>
-
-    <para>kurz darauf der Dateidialog</para>
-
-    <para><inlinemediaobject>
-        <imageobject>
-          <imagedata fileref="pics/basisverzeichnis.gif" />
-        </imageobject>
-      </inlinemediaobject></para>
-
-    <para>Dieser fordert dich nun auf, das Datenverzeichnis f?r CacheWolf
-    auszuw?hlen f?r die noch kommenden Cache-Daten und die Karten. Die Idee
-    dahinter ist folgende: In diesem Verzeichnis kannst du beliebig viele
-    Unterordner anlegen; jeder dieser Ordner ist ein eigenes Profil (siehe:
-    <xref linkend="profil" />) innerhalb des Cachewolf.</para>
-
-    <tip>
-      <para>Auf einem PocketPC kannst du dieses Verzeichnis auf die
-      Speicherkarte legen (den CW am besten auf dem Ger?t oder der Flash-Disk
-      ablegen).</para>
-    </tip>
-
-    <para>W?hle nun ein Verzeichnis aus und best?tige mit <literal>Select
-    Folder</literal></para>
-
-    <para>Danach erscheint der Dialog zur Auswahl eines Profils. In einem
-    Profil werden in der Regel die Daten einer Cache-Gegend gespeichert. Lege
-    ein neues Profil durch klick auf "neu" an, gebe einen Namen ein,
-    beispielsweise den Namen der Stadt, in deren Gegend Du Caches suchen
-    willst. Danach erscheint ein Dialog, in dem die Koordinaten des
-    Mittelpunktes eingegeben werden sollen, um die herum die Caches dieses
-    Profils liegen (Zentrum).</para>
-  </section>
-
-  <section>
-    <title id="editPrefs">Konfigurieren der Einstellungen</title>
-
-    <para>Es erscheint nun ein bisher leeres Fenster, die
-    Listenansicht:</para>
-
-    <para><inlinemediaobject>
-        <imageobject>
-          <imagedata fileref="pics/cw_empty.jpg" width="600" />
-        </imageobject>
-      </inlinemediaobject></para>
-
-    <para>Keine Angst, wir f?llen dieses gleich...</para>
-
-    <para>Doch zuerst einmal w?hle den Men?punkt <literal>Anwendung -&gt;
-    Einstellungen</literal>. Hier kann man nun ein paar grunds?tzliche Dinge
-    einstellen:</para>
-
-    <para></para>
-
-    <section>
-      <title>Einstellungen Allgemein</title>
-
-      <para><inlinemediaobject>
-          <imageobject>
-            <imagedata fileref="pics/pref_1.jpg" />
-          </imageobject>
-        </inlinemediaobject></para>
-
-      <para>Dieser Tab enth?lt einige Einstellungen. Was die Einstellung
-      <literal>Verzeichnis</literal> f?r Profile bewirkt, ist hier <xref
-      linkend="start" /> schon beschrieben worden. Wenn der Haken bei
-      <literal>Profil auto. laden</literal> gesetzt wurde, erscheint beim
-      n?chsten und allen weiteren Starts von CacheWolf der
-      Profil-Abfrageschirm</para>
-
-      <para><inlinemediaobject>
-          <imageobject>
-            <imagedata fileref="pics/startup.jpg" />
-          </imageobject>
-        </inlinemediaobject></para>
-
-      <para>nicht mehr. Ist der Haken nicht gesetzt, musst Du jedes Mal nach
-      Programmstart das gew?nschte Profil ausw?hlen.</para>
-
-      <para>Bei <literal>Browser</literal> kannst Du einen Link zu dem
-      Browserprogramm Deiner Wahl einf?gen.</para>
-
-      <example>
-        <title>Link zum Browser</title>
-
-        <para>Der Internet Explorer unter Windows: <literal>C:\Documents and
-        Settings\USER\Application Data\Microsoft\Internet Explorer\Quick
-        Launch</literal></para>
-      </example>
-
-      <para>Unter <literal>Dein Alias</literal> und <literal>Passwt</literal>
-      kannst Du Deine Zugangsdaten zu <literal>geocaching.com</literal>
-      hinterlegen. <emphasis role="bold">Achtung!</emphasis> Dein Passwort
-      wird nicht verschl?sselt hinterlegt. Im Zweifel solltest Du Dein
-      Passwort hier nicht eingeben. CacheWolf wird beim n?chsten Einloggen
-      nach Deinem Passwort fragen.</para>
-
-      <para>Mit CacheWolf ist es m?glich Caches direkt an Deinen GPS Empf?nger
-      zu senden (siehe auch <xref linkend="zu_garmin" />). Unter
-      <literal>GPSBabel</literal> l??t sich der Port einstellen, der von
-      GPSBabel beim Export genutzt werden soll. Der gesetzte Hacken bei
-      Kurznamen sorgt daf?r, dass nicht die Waypointnamen an den Empf?nger
-      geschickt werden, sondern der etwas verk?rzte Cachename (Biespiel:
-      Grosse Dose wird zu Grsse Dse).</para>
-
-      <para>Durch einen Klick auf den <literal>GPS</literal> Button wird der
-      Schirm zur Einstellung des GPS Empf?ngers angezeigt:</para>
-
-      <section>
-        <title>GPS Empf?nger</title>
-
-        <para></para>
-
-        <para><inlinemediaobject>
-            <imageobject>
-              <imagedata fileref="pics/GPS.jpg" />
-            </imageobject>
-          </inlinemediaobject></para>
-
-        <para>Am besten jetzt auf <literal>Update Ports</literal> klicken.
-        Damit ermittelt CacheWolf, welche Ports auf dem PDA zur Verf?gung
-        stehen. Danach den Port des GPS Empf?ngers einstellen. Mit einem Klick
-        auf den Button <literal>Scan</literal> sucht Cachewolf auf allen
-        verf?gbaren Ports selbst?ndig nach einem vorhandenen GPS Empf?nger und
-        stellt Port und Baudrate automatisch ein. M?chtest Du den GPS
-        Empf?nger manuell einstellen, kannst du unter <literal>Baud</literal>
-        die Geschwindigkeit des Empf?ngers einstellen; 4800 passt in der
-        Regel.</para>
-
-        <para>Durch einen Klick auf <literal>Test</literal> kannst Du
-        ?berpr?fen, ob eine Verbindung zum Empf?nger besteht. Vorher bitte
-        sicherstellen, dass der Empf?nger angeschaltet ist. Mit
-        <literal>OK</literal> die Einstellungen best?tigen.</para>
-      </section>
-    </section>
-
-    <section>
-      <title>Einstellungen Ansicht</title>
-
-      <para><inlinemediaobject>
-          <imageobject>
-            <imagedata fileref="pics/pref_2.jpg" />
-          </imageobject>
-        </inlinemediaobject></para>
-
-      <para>In diesem Tab kannst Du weitere Look &amp; Feel Einstellungen in
-      CacheWolf vornehmen.</para>
-
-      <para>Bei <literal>Font</literal> stellst Du die allgemeine
-      Schriftgr?sse ein, die CacheWolf benutzt. Der Haken bei <literal>PDA hat
-      Schliessen Button</literal> hat zur Folge, dass auf dem PDA rechts oben
-      im CacheWolf Fenster ein "X" erscheint. Klickst Du auf dieses "X" wird
-      CacheWolf beendet, und aus dem Speicher entfernt.</para>
-
-      <para>Der Haken neben <literal>Men? oben</literal> setzt die
-      Men?eintr?ge im PDA oben, ansonsten erscheinen diese unten :-) Dasselbe
-      gilt f?r <literal>Tabs oben</literal>. Ein Haken hier setzt die Tabs in
-      den Ansichten oben. Der Haken bei <literal>Status</literal> bewirkt,
-      dass CacheWolf eine Statusleiste unten in der Listenansicht (siehe <xref
-      linkend="liste" />) anzeigt.</para>
-    </section>
-
-    <section>
-      <title>Einstellungen Mehr</title>
-
-      <para><inlinemediaobject>
-          <imageobject>
-            <imagedata fileref="pics/pref_3.jpg" />
-          </imageobject>
-        </inlinemediaobject></para>
-
-      <para>In diesem Tab k?nnen Proxydaten eingegeben werden. Durch setzen
-      des Hakens bei <literal>Proxy verwenden</literal> werden diese Daten
-      beim n?chsten Zugriff ins Internet genutzt.</para>
-
-      <para>CacheWolf kennt aktuell vier Sprachen:</para>
-
-      <itemizedlist>
-        <listitem>
-          <para>DE = Deutsch,</para>
-        </listitem>
-
-        <listitem>
-          <para>EN = Englisch,</para>
-        </listitem>
-
-        <listitem>
-          <para>NL = Niederl?ndisch,</para>
-        </listitem>
-
-        <listitem>
-          <para>FR = Franz?sisch.</para>
-        </listitem>
-      </itemizedlist>
-
-      <para>Um die Sprache zu ?ndern muss das entsprechende
-      Zweibuchstabenk?rzel <literal>bei Sprache</literal> eingegeben werden.
-      Die neu eingestellte Sprache wird im Fall einer ?nderung allerdings erst
-      nach einem Neustart benutzt.</para>
-    </section>
-
-    <section>
-      <title id="einstellungListe">Einstellungen Liste</title>
-
-      <para><inlinemediaobject>
-          <imageobject>
-            <imagedata fileref="pics/pref_4.jpg" />
-          </imageobject>
-        </inlinemediaobject></para>
-
-      <para>In diesem Tab kannst Du einstellen, welche Spalten in der
-      Listenansicht (siehe <xref linkend="liste" />) angezeigt werden sollen.
-      Angezeigte Spalten k?nnen ?ber den Pfeil nach rechts verborgen werden.
-      Verborgene Spalten k?nnen umgekehrt nat?rlich ?ber den Pfeil nach links
-      wieder angezeigt werden. Au?erdem kann ?ber die beiden Pfeile (nach oben
-      und nach unten) die gew?nschte Reihenfolge der Spalten eingestellt
-      werden.</para>
-
-      <tip>
-        <para>Weniger Spalten beschleunigen das Scrollen auf dem PDA.</para>
-      </tip>
-    </section>
-
-    <section>
-      <title>Einstellungen T-bugs</title>
-
-      <para>CacheWolf besitzt eine integrierte Travelbug - Verwaltung (siehe
-      <xref linkend="tbugs_verwalten" />).</para>
-
-      <para>In diesem Tab kannst Du, wie im vorigen Abschnitt beschrieben,
-      einstellen, welche Spalten in der Travelbugtabelle angezeigt werden
-      sollen und in welcher Reihenfolge diese angezeigt werden.</para>
-
-      <para><inlinemediaobject>
-          <imageobject>
-            <imagedata fileref="pics/pref_5.jpg" />
-          </imageobject>
-        </inlinemediaobject></para>
-
-      <para></para>
-    </section>
-  </section>
-
-  <section id="DatenImportieren">
-    <title>Cachedaten importieren</title>
-
-    <para>Programm l?uft, Einstellungen erledigt? Gut! Jetzt m?ssen wir noch
-    an Cache-Daten kommen. CacheWolf liest GPX-Dateien ein. Diese k?nnen
-    entweder von <ulink url="http://www.geocaching.com">Geocaching.com</ulink>
-    oder von <ulink url="http://www.opencaching.de">Opencaching.de</ulink>
-    kommen. Alternativ k?nnen die Daten auch direkt heruntergeladen
-    (gespidert) werden.</para>
-
-    <section>
-      <title>Geocaching.com</title>
-
-      <para>Es gibt verschiedene M?glichkeiten an die Daten bei <ulink
-      url="???">geocaching.com</ulink> zu kommen: Entweder durch den Import
-      einer GPX Datei, einer LOC Datei oder direkt durch Herunterladen von der
-      geocaching.com Webseite (spidern).</para>
-
-      <section id="DatenImportGPX">
-        <title>Import einer GPX Datei</title>
-
-        <para>Um an GPX-Dateien von geocaching.com zu kommen, muss man
-        Premium-Mitglied sein. Die GPX-Dateien werden nach einer Pocket Query
-        (h?ufig als zip-Archiv) per Mail verschickt. Alternativ k?nnen
-        GPX-Dateien f?r einzelne Caches direkt heruntergeladen werden. Die
-        heruntengeladenen Dateien k?nnen einfach in ein Verzeichnis abgelegt
-        und m?ssen nicht entpackt werden.</para>
-
-        <para>Den Import startest Du durch Anw?hlen von "<literal>Anwendung
-        -&gt; Import -&gt; Importiere GPX</literal>". Du kannst eine Datei
-        oder mit Hilfe der Umschalt - Taste mehrere Dateien ausw?hlen.</para>
-
-        <para>Nach der Wahl der Datei, die du importieren m?chtest, erscheint
-        ein Fenster mit der Frage, ob Du auch Bilder herunterladen
-        m?chtest:</para>
-
-        <para><inlinemediaobject>
-            <imageobject>
-              <imagedata fileref="pics/gpx_import_bilder.jpg" />
-            </imageobject>
-          </inlinemediaobject></para>
-
-        <para>Aktivierst du diese Option, solltest du eine bestehende
-        Verbindung ins Internet haben. Hast Du die Option <literal>Bilder
-        downloaden</literal> angekreuzt, wird CacheWolf beim Einlesen der
-        GPX-Datei auf der Cacheseite nachschauen, ob Bilder in der
-        Beschreibung bzw. ob Spoilerbilder vorhanden sind. Diese werden dann
-        heruntergeladen. Das Herunterladen von Bildern ben?tigt etwas
-        Zeit.</para>
-
-        <para><note>
-            <para>Leider werden von geocaching.com in der GPX-Datei nur die
-            "Additional Waypoints" mitgeschickt, die auch eine g?ltige
-            Koordinate haben. Das Dilemma ist aber, dass diese Koordinaten bei
-            den meisten Multis erst ermittelt werden m?ssen. Normalerweise
-            stellt dies noch immer kein Problem dar; aber einige Owner
-            beschreiben die einzelnen Stationen innerhalb der "Additional
-            Waypoints". Da diese aber keine Koordinaten haben und nicht in der
-            GPX-Datei mitgeschickt werden, fehlen notwendige Informationen.
-            Dem kann aber abgeholfen werden: CacheWolf bietet die M?glichkeit,
-            einzelne Caches zu aktualisieren und hier werden auch die
-            "Additional Waypoints" direkt von der Cacheseite geladen, die
-            keine Koordinaten haben (siehe <xref
-            linkend="list_popup" />).</para>
-          </note></para>
-      </section>
-
-      <section>
-        <title>Import einer LOC Datei</title>
-
-        <para>F?r Mitglieder, die keine Premium-Mitgliedschaft besitzen,
-        besteht noch die M?glichkeit, LOC-Dateien herunterzuladen. Der Import
-        von LOC-Dateien geschieht auch ?ber den Men?punkt <literal>Importiere
-        GPX</literal>. In den LOC-Dateien sind allerdings sehr wenig
-        Informationen enthalten, insbesondere fehlt die Beschreibung des
-        Caches.</para>
-      </section>
-
-      <section id="DatenImportSpider">
-        <title>Direktes herunterladen (spidern)</title>
-
-        <para>Durch Anw?hlen von <literal>Anwendung -&gt; Import -&gt; Spider
-        von geocaching.com</literal> wirst Du zuerst aufgefordert Dein
-        Passwort einzugeben. Dies ist das Passwort, das Du f?r Deinen Account
-        bei geocaching.com nutzt. Deinen Alias hast Du ja bereits in den
-        Einstellungen eingetragen. Nach der Eingabe Deines Passwortes loggt
-        sich CacheWolf auf der geocaching.com Homepage ein und pr?sentiert
-        dann die Spideroptionen ein einem neuen Fenster:</para>
-
-        <para><inlinemediaobject>
-            <imageobject>
-              <imagedata fileref="pics/spider_gc.jpg" />
-            </imageobject>
-          </inlinemediaobject></para>
-
-        <para>Unter <literal>max. Abstand</literal> wird die Entfernung zum
-        aktuellem Zentrum eingestellt (siehe <xref linkend="zentrum" />).
-        Cachewolf wird alle Caches im angegebenen Umkreis vom Zentrum
-        herunterladen. Wird der Haken bei <literal>Bilder downloaden</literal>
-        gesetzt, wird Cachewolf sowohl die Bilder in der Cachebeschreibung als
-        auch die Spoilerbilder herunterladen. Der Download von bereits
-        gefundenen Caches kann durch Ausw?hlen der Option <literal>Gefundene
-        Caches nicht laden verhindert</literal> werden.</para>
-
-        <para>Mit <literal>OK</literal> wird der Spider gestartet. Je nach
-        Entfernung und Cache-Dichte wird das Spidern nun einige Zeit in
-        Anspruch nehmen.</para>
-      </section>
-    </section>
-
-    <section>
-      <title>Opencaching.de</title>
-
-      <para>Alternativ zu geocaching.com k?nnen Caches auch von <ulink
-      url="http://opencaching.de">opencaching.de</ulink> importiert werden.
-      Wie bereits im vorangegangen Abschnitt beschrieben, k?nnen die
-      ben?tigten Daten entweder ?ber GPX-Dateien oder durch direktes
-      Herunterladen bezogen werden.</para>
-
-      <section id="DatenImportGPX2">
-        <title id="OpenGPX">Importieren einer bereits heruntergeladenen
-        GPX-Datei</title>
-
-        <para>Auf der Seite von Opencaching.de hat man die Option eine
-        GPX-Datei herunterzuladen. Diese Option befindet sich am Ende der
-        Suchergebnisseite. Die ZIP-Datei einfach in irgendein Verzeichnis
-        kopieren. Der GPX-Import erkennt automatisch dieses Format. Es ist
-        nicht notwendig die Datei zu entpacken! Bei opencaching.de werden in
-        der aktuellen Version alle Bilder geladen.</para>
-      </section>
-
-      <section id="DatenImportDownload">
-        <title id="OpenSpider">Direkter Download von opencaching.de</title>
-
-        <para>Mit der Funktion <literal>Anwendung -&gt; Import -&gt; Download
-        von opencaching.de</literal> ?ffnet sich ein Dialog, der die Eingabe
-        des Abstands um das im Profil eingestellte Zentrum erm?glicht:</para>
-
-        <para><inlinemediaobject>
-            <imageobject>
-              <imagedata fileref="pics/spider_options.jpg" />
-            </imageobject>
-          </inlinemediaobject></para>
-
-        <para>Innerhalb eines Kreises in diesem Abstand werden alle Caches (je
-        nach Option mit allen in der Cachbeschreibung angezeigten Bildern
-        heruntergeladen und automatisch importiert. Dabei merkt sich CacheWolf
-        automatisch das Datum, an dem zuletzt heruntergeladen wurde. Bei einem
-        erneuten Aufruf mit dem gleichen Zentrum (siehe <xref
-        linkend="zentrum" />) und dem gleichen Abstand werden dann nur die
-        ?nderungen heruntergeladen und eingelesen. Diese Funktion ist bei
-        Opencaching kostenlos, selbst eine Anmeldung ist dort nicht
-        erforderlich.</para>
-      </section>
-    </section>
-  </section>
-</chapter>
\ No newline at end of file

Copied: trunk/docs/CacheWolf Doku/Der_erste_Start.xml (from rev 2008, trunk/docs/CacheWolf Doku/Der erste Start.xml)


Property changes on: trunk/docs/CacheWolf Doku/Der_erste_Start.xml
___________________________________________________________________
Name: svn:mergeinfo
   + 



From araber95 at mail.berlios.de  Sat Jul 11 12:54:42 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 11 Jul 2009 12:54:42 +0200
Subject: [Cachewolf-svn] r2010 - in trunk/res_noewe/webmapservices: .
	untested
Message-ID: <200907111054.n6BAsgo0024792@sheep.berlios.de>

Author: araber95
Date: 2009-07-11 12:54:37 +0200 (Sat, 11 Jul 2009)
New Revision: 2010

Added:
   trunk/res_noewe/webmapservices/de-bb_t10.wms
   trunk/res_noewe/webmapservices/de-bb_t25.wms
Removed:
   trunk/res_noewe/webmapservices/untested/de-bb_t10.wms
   trunk/res_noewe/webmapservices/untested/de-bb_t25.wms
Log:
wms for Berlin/Brandenburg checked ok

Added: trunk/res_noewe/webmapservices/de-bb_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-bb_t10.wms	2009-07-11 06:45:43 UTC (rev 2009)
+++ trunk/res_noewe/webmapservices/de-bb_t10.wms	2009-07-11 10:54:37 UTC (rev 2010)
@@ -0,0 +1,30 @@
+TakenFromUrl:       http://isk.geobasis-bb.de/index.php?cms=1101
+GetCapabilitiesUrl: http://isk.geobasis-bb.de/ows/dnm010.php?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               de.Berlin/Brandenburg t10 SF=0,1..7
+MapType:                        topo
+MainUrl:            http://isk.geobasis-bb.de/ows/dnm010.php?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31468 31469
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31468 SRS=EPSG:31469 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=bg|Hintergrundfl?che|0.498903|1746.16 # ist leer
+#LayersUrlPart:     LAYERS=siedlung|Siedlungsfl?chen|0.05|5.0
+#LayersUrlPart:     LAYERS=vegetation|Vegetationsfl?chen|0.05|5.0
+#LayersUrlPart:     LAYERS=gewaesser|Gew?sser (See, Fluss, Kanal)|0.05|5.0
+#LayersUrlPart:     LAYERS=transport|Transportwege|0.05|5.0
+#LayersUrlPart:     LAYERS=strassennamen|Stra?enklassifizierungen und Strassennamen|0.05|5.0 # Symbole ?berdecken Details
+#LayersUrlPart:     LAYERS=ortsnamen|Namen der Ortschaften|0.05|5.0 # ist leer
+#LayersUrlPart:     LAYERS=gewaessernamen|Gewaessernamen|0.05|5.0 # zum Cachen nicht wichtig ?
+#LayersUrlPart:   LAYERS=siedlung,transport,vegetation,gewaesser,gewaessernamen,ortsnamen,strassennamen
+LayersUrlPart:   LAYERS=siedlung,transport,vegetation,gewaesser
+StylesUrlPart:   STYLES=2
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 53.5000 E 11.7000
+BoundingBoxButtomRightWGS84: N 51.3000 E 14.8000
+MinScale:   0.1
+MaxScale:   11
+RecommendedScale:   1
+ImageFileExtension: .png
+#SF bis 7 teilweise getestet (Capabilities stimmen nicht)
+#BBox aus Capabilities (ev zu klein)

Added: trunk/res_noewe/webmapservices/de-bb_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/de-bb_t25.wms	2009-07-11 06:45:43 UTC (rev 2009)
+++ trunk/res_noewe/webmapservices/de-bb_t25.wms	2009-07-11 10:54:37 UTC (rev 2010)
@@ -0,0 +1,30 @@
+TakenFromUrl:       http://isk.geobasis-bb.de
+GetCapabilitiesUrl: http://isk.geobasis-bb.de/ows/dnm025.php?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:   de.Berlin/Brandenburg t25 SF=1..17
+MapType:                        topo
+MainUrl:            http://isk.geobasis-bb.de/ows/dnm025.php?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31468 31469
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31468 SRS=EPSG:31469 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=bg|Hintergrundfl?che|0.498903|1746.16
+#LayersUrlPart:     LAYERS=siedlung|Siedlungsfl?chen, Orte|0.05|25.0
+#LayersUrlPart:     LAYERS=vegetation|Vegetationsfl?chen|0.05|25.0
+#LayersUrlPart:     LAYERS=gewaesser|Gew?sser (See, Flu?, Kanal)|0.05|25.0
+#LayersUrlPart:     LAYERS=transport|Transportwege|0.05|25.0
+#LayersUrlPart:     LAYERS=strassennamen|Stra?enklassifizierungen und Strassennamen|0.05|5.0
+#LayersUrlPart:     LAYERS=ortsnamen|Namen der Ortschaften|0.05|5.0
+#LayersUrlPart:     LAYERS=gewaessernamen|Gewaessernamen|0.05|5.0
+LayersUrlPart:     LAYERS=siedlung,vegetation,gewaesser,transport
+StylesUrlPart:     STYLES=2
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 53.5000 E 11.7000
+BoundingBoxButtomRightWGS84: N 51.3000 E 14.8000
+MinScale:   0.1
+MaxScale:   25
+RecommendedScale:   2.5
+ImageFileExtension: .png
+# layer Kommentare siehe  t10
+#SF bis 17 teilweise getestet (Capabilities stimmen nicht)
+#BBox aus Capabilities (ev zu klein)

Deleted: trunk/res_noewe/webmapservices/untested/de-bb_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bb_t10.wms	2009-07-11 06:45:43 UTC (rev 2009)
+++ trunk/res_noewe/webmapservices/untested/de-bb_t10.wms	2009-07-11 10:54:37 UTC (rev 2010)
@@ -1,19 +0,0 @@
-TakenFromUrl:   http://isk.geobasis-bb.de/index.php?cms=1101
-GetCapabilitiesUrl:   http://isk.geobasis-bb.de/ows/dnm010.php?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1
-Name:   de.Berlin/Brandenburg topo 10
-MapType:   topo
-MainUrl:   http://isk.geobasis-bb.de/ows/dnm010.php?
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=bg,siedlung,transport,vegetation,gewaesser,gewaessernamen,ortsnamen,strassennamen
-StylesUrlPart:   STYLES=2
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 53.5 E 11.2
-BoundingBoxButtomRightWGS84:   N 51.3 E 14.8
-MinScale:   0.0
-MaxScale:   14.001
-RecommendedScale:   1
-ImageFileExtension:   .png

Deleted: trunk/res_noewe/webmapservices/untested/de-bb_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bb_t25.wms	2009-07-11 06:45:43 UTC (rev 2009)
+++ trunk/res_noewe/webmapservices/untested/de-bb_t25.wms	2009-07-11 10:54:37 UTC (rev 2010)
@@ -1,19 +0,0 @@
-TakenFromUrl:   http://isk.geobasis-bb.de/index.php?cms=1101
-GetCapabilitiesUrl:   http://isk.geobasis-bb.de/ows/dnm025.php?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1%2
-Name:   de.Berlin/Brandenburg topo 25
-MapType:   topo
-MainUrl:   http://isk.geobasis-bb.de/ows/dnm025.php?
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=bg,siedlung,transport,vegetation,gewaesser,gewaessernamen,ortsnamen,strassennamen
-StylesUrlPart:   STYLES=2
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 53.5 E 11.2
-BoundingBoxButtomRightWGS84:   N 51.3 E 14.8
-MinScale:   0.0
-MaxScale:   11.0485
-RecommendedScale:   2.5
-ImageFileExtension:   .png



From araber95 at mail.berlios.de  Sat Jul 11 13:03:30 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 11 Jul 2009 13:03:30 +0200
Subject: [Cachewolf-svn] r2011 - trunk/res_noewe/webmapservices/untested
Message-ID: <200907111103.n6BB3U44004645@sheep.berlios.de>

Author: araber95
Date: 2009-07-11 13:03:13 +0200 (Sat, 11 Jul 2009)
New Revision: 2011

Removed:
   trunk/res_noewe/webmapservices/untested/de-bw_p.wms
   trunk/res_noewe/webmapservices/untested/de-bw_t50.wms
   trunk/res_noewe/webmapservices/untested/de-by_p.wms
   trunk/res_noewe/webmapservices/untested/de-by_t50.wms
   trunk/res_noewe/webmapservices/untested/de-he_p.wms
   trunk/res_noewe/webmapservices/untested/de-he_t100.wms
   trunk/res_noewe/webmapservices/untested/de-he_t50.wms
   trunk/res_noewe/webmapservices/untested/de-mv_p.wms
   trunk/res_noewe/webmapservices/untested/de-mv_t10.wms
   trunk/res_noewe/webmapservices/untested/de-mv_t25.wms
   trunk/res_noewe/webmapservices/untested/de-mv_t50.wms
   trunk/res_noewe/webmapservices/untested/de-nw_p.wms
   trunk/res_noewe/webmapservices/untested/de-nw_t10.wms
   trunk/res_noewe/webmapservices/untested/de-nw_t25.wms
   trunk/res_noewe/webmapservices/untested/de-nw_t50.wms
   trunk/res_noewe/webmapservices/untested/de_t.wms
   trunk/res_noewe/webmapservices/untested/de_t1000.wms
   trunk/res_noewe/webmapservices/untested/de_t200.wms
   trunk/res_noewe/webmapservices/untested/de_t500.wms
Log:
removed wms with same content as in tested

Deleted: trunk/res_noewe/webmapservices/untested/de-bw_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bw_p.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-bw_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:   http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:   http://www.lv-bw.de/dv/capabilities.xml?login=dv&pw=anonymous&REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:   de.Baden-Wuerttemberg photo
-MapType:   photo
-MainUrl:   http://www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous&
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   31467
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:31467
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=DVDOP2
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 50.00 E 7.60
-BoundingBoxButtomRightWGS84:   N 47.40 E 10.00
-MinScale:   0.01
-MaxScale:   43
-RecommendedScale:   2.5
-ImageFileExtension: .png 
\ No newline at end of file

Deleted: trunk/res_noewe/webmapservices/untested/de-bw_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-bw_t50.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-bw_t50.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Internetadressen
-GetCapabilitiesUrl:	http://www.lv-bw.de/dv/capabilities.xml?login=dv&pw=anonymous&REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.Baden-Wuerttemberg topo 50
-MapType:	topo
-MainUrl:	http://www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous&
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf:	31467 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DVTK50K
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 50.00 E 7.60
-BoundingBoxButtomRightWGS84:	N 47.40 E 10.00
-MinScale:	0.01
-MaxScale:	40
-RecommendedScale:	5.0
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de-by_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-by_p.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-by_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.Bayern photo
-MapType:	photo
-MainUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf: 31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DOP
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 50.6269 E 8.89292
-BoundingBoxButtomRightWGS84:	N 47.0828 E 13.9782
-MinScale:	2.82
-MaxScale:	200
-RecommendedScale:	2.0
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de-by_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-by_t50.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-by_t50.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.Bayern topo 50
-MapType:	topo
-MainUrl:	http://www.geodaten.bayern.de/ogc/getogc.cgi?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf: 31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=TK50
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 50.6269 E 8.89292
-BoundingBoxButtomRightWGS84:	N 47.0828 E 13.9782
-MinScale:	0.997806
-MaxScale:	24.9451
-RecommendedScale:	5.0
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de-he_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-he_p.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-he_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,20 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-images.plx?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.Hessen photo
-MapType:	photo
-MainUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-images.plx?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:	31467
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DOP04F1
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/jpeg
-BoundingBoxTopLeftWGS84:	N 51.6697 E 7.69911
-BoundingBoxButtomRightWGS84:	N 49.3455 E 11.3986
-MinScale:   0.399122
-MaxScale:   9.97806
-RecommendedScale:   0.4
-ImageFileExtension: .jpg
-

Deleted: trunk/res_noewe/webmapservices/untested/de-he_t100.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-he_t100.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-he_t100.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,21 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.Hessen topo 100
-MapType:	topo
-MainUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?
-LayersName: 
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:	31467
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=ATKPG50-N1
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 51.6697 E 7.69911
-BoundingBoxButtomRightWGS84:	N 49.3455 E 11.3986
-MinScale:	1.49671
-MaxScale:	99.7806
-RecommendedScale:	10.0
-ImageFileExtension: .png
-

Deleted: trunk/res_noewe/webmapservices/untested/de-he_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-he_t50.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-he_t50.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,20 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:	de.Hessen topo 50
-MapType:	topo
-MainUrl:	http://lika.hessen.de/cgi-bin/lika-services/de-viewer/access/ogc-free-maps.plx?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:	31467
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31467
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=ATKPG25-N1
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 51.6697 E 7.69911
-BoundingBoxButtomRightWGS84:	N 49.3455 E 11.3986
-MinScale:	1.49671
-MaxScale:	49.8903
-RecommendedScale:	5.0
-ImageFileExtension: .png
-

Deleted: trunk/res_noewe/webmapservices/untested/de-mv_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_p.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-mv_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DOP?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.Mecklenburg-Vorpommern photo
-MapType:	photo
-MainUrl:	http://www.gaia-mv.de/dienste/DOP?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf: 31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DOP
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/jpeg
-BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
-MinScale:	0.000374177136322228
-MaxScale:	37.4180878093591
-RecommendedScale:	0.4
-ImageFileExtension: .jpg

Deleted: trunk/res_noewe/webmapservices/untested/de-mv_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_t10.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-mv_t10.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DTK10f?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.Mecklenburg-Vorpommern topo 10
-MapType:	topo
-MainUrl:	http://www.gaia-mv.de/dienste/DTK10f?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf: 31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DTK10f
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
-MinScale:	0.186714391024792
-MaxScale:	11.2256882668032
-RecommendedScale:	1.0
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de-mv_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_t25.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-mv_t25.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DTK25Vf?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.Mecklenburg-Vorpommern topo 25
-MapType:	topo
-MainUrl:	http://www.gaia-mv.de/dienste/DTK25Vf?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf: 31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DTK25Vf
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
-MinScale:	1.87051150447482
-MaxScale:	18.7092309932477
-RecommendedScale:	2.5
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de-mv_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-mv_t50.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-mv_t50.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.gaia-mv.de/dienste/DTK50Vf?REQUEST=GetCapabilities&VERSION=1.1.1&SERVICE=WMS
-Name:	de.Mecklenburg-Vorpommern topo 50
-MapType:	topo
-MainUrl:	http://www.gaia-mv.de/dienste/DTK50Vf?
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf: 31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DTK50Vf
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 54.8209 E 10.3394
-BoundingBoxButtomRightWGS84:	N 53.0392 E 14.477
-MinScale:	5.6122828676971
-MaxScale:	28.0636594013034
-RecommendedScale:	5.0
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de-nw_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_p.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-nw_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,20 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.gis2.nrw.de/wmsconnector/wms/luftbild?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS	
-Name:	de.Nordrhein-Westfalen photo
-MainUrl:	http://www.gis2.nrw.de/wmsconnector/wms/luftbild? 
-MapType: photo
-ServiceTypeUrlPart:	SERVICE=WMS 
-VersionUrlPart:	VERSION=1.1.0 
-CoordinateReferenceSystemCacheWolf:	31466 31467
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=Orthophoto%20Str.%202,Orthophoto%20Str.%203
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 52.7691 E 5.673
-BoundingBoxButtomRightWGS84:	N 49.9944 E 10.142
-MinScale:	0.1795783591567183
-MaxScale:	5.611823723647454
-RecommendedScale:	0.5
-ImageFileExtension: .png
-

Deleted: trunk/res_noewe/webmapservices/untested/de-nw_t10.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_t10.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-nw_t10.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/DTK10?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.0
-Name:   de.Nordrhein-Westfalen topo 10
-MapType:	topo
-MainUrl:   http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/DTK10?
-ServiceTypeUrlPart:	SERVICE=WMS
-VersionUrlPart:	VERSION=1.1.0
-CoordinateReferenceSystemCacheWolf:	31466 31467
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=Raster%3ADTK10%3ADtk10G
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 52.7729742 E 5.672412
-BoundingBoxButtomRightWGS84:	N 49.998341 E 10.1417782
-MinScale:   0.0
-MaxScale:   14.001
-RecommendedScale:	1
-ImageFileExtension:	.png

Deleted: trunk/res_noewe/webmapservices/untested/de-nw_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_t25.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-nw_t25.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,21 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?REQUEST=GetCapabilities&VERSION=1.1.0&SERVICE=WMS
-Name:   de.Nordrhein-Westfalen topo 25
-MapType:	topo
-MainUrl:	http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/TK25?
-ServiceTypeUrlPart:	SERVICE=WMS
-VersionUrlPart:	VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:	31466 31467
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31466 SRS=EPSG:31467
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=Raster%3ATK25%5FKMF%3AFarbkombination
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 52.7691 E 05.673
-BoundingBoxButtomRightWGS84:	N 49.9944 E 010.142
-MinScale:   0.0
-# the hintscale delivered from the getCapilibitiesUrl is a little bit higher (11.667) but this leads sometimes to empty maps
-# I tested that 11.0485 is probably the real MaxScale
-MaxScale:   11.0485
-RecommendedScale:	2.5
-ImageFileExtension:	.png

Deleted: trunk/res_noewe/webmapservices/untested/de-nw_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de-nw_t50.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de-nw_t50.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:   http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Dialogbox
-GetCapabilitiesUrl:   http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK50?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.0
-Name: de.Nordrhein-Westfalen topo 50
-MapType:   topo
-MainUrl:   http://www.geoserver.nrw.de:80/GeoOgcWms1.3/servlet/TK50?
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.0
-CoordinateReferenceSystemCacheWolf:   31466 31467
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:31466 SRS=EPSG:31467
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=Raster%3ATK50%5FKMF%3AFarbkombination
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 52.7691 E 5.673
-BoundingBoxButtomRightWGS84:   N 49.9944 E 10.142
-MinScale:   0.0
-MaxScale:   23.335
-RecommendedScale:   5
-ImageFileExtension: .png
\ No newline at end of file

Deleted: trunk/res_noewe/webmapservices/untested/de_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de_t.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,19 +0,0 @@
-TakenFromUrl:   http://www.wheregroup.com/de/freier_wms_mit_openstreetmap_daten
-GetCapabilitiesUrl:   http://osm.wheregroup.com/cgi-bin/mapserv?map=/data/umn/osm/osm_basic.map&REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.1.1   
-Name:   de OSM
-MainUrl:   http://osm.wheregroup.com/cgi-bin/osm_basic.xml?
-MapType: topo
-ServiceTypeUrlPart:   SERVICE=WMS 
-VersionUrlPart:   VERSION=1.1.1 
-CoordinateReferenceSystemCacheWolf:   31467 4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:31467 SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=Landwirtschaft,Industriegebiet,Bauland,Gruenflaeche,unkultiviertes_Land,Park,Naherholungsgebiet,Wald,Wiese,Wasser,Fluesse,Baeche,Kanal,Insel,Kueste,Strand,Fussgaengerzone,Fussgaengerweg,Radweg,Wege,Wohnstrasse,Zufahrtswege,einfache_Strasse,Landstrasse,Bundesstrasse,Kraftfahrstrasse,Autobahn,Ortschaft,Weiler,Dorf,Stadt,Grossstadt,Bahn,Bahnhof,Gebaeude
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 55.0960681 E 6.07358734
-BoundingBoxButtomRightWGS84:   N 47.161701 E 16.05521058
-MinScale:   0.6
-MaxScale:   99.99
-RecommendedScale:   1
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de_t1000.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t1000.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de_t1000.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,20 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&service=WMS&version=1.1.1&request=GetCapabilities
-Name:	de topo 1000
-MainUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&
-MapType:	topo
-ServiceTypeUrlPart:	SERVICE=WMS
-VersionUrlPart:	VERSION=1.1.0
-CoordinateReferenceSystemCacheWolf:	31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DTK1000
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 54.937 E 6.00242837
-BoundingBoxButtomRightWGS84:	N 46.95 E 16.12332498
-# there is no scale hint in the getCapabilities answer :-( --> allow all
-#MinScale:	0.01
-#MaxScale:	40
-RecommendedScale:	100
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/de_t200.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t200.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de_t200.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,20 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&service=WMS&version=1.1.1&request=GetCapabilities
-Name:	de topo 200
-MainUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&
-MapType:	topo
-ServiceTypeUrlPart:	SERVICE=WMS
-VersionUrlPart:	VERSION=1.1.0
-CoordinateReferenceSystemCacheWolf:	31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DTK200-V
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 55.0960681 E 6.07358734
-BoundingBoxButtomRightWGS84:	N 47.161701 E 16.05521058
-# there is no scale hint in the getCapabilities answer :-( --> allow all
-#MinScale:	0.01
-#MaxScale:	40
-RecommendedScale:	20
-ImageFileExtension: .png
\ No newline at end of file

Deleted: trunk/res_noewe/webmapservices/untested/de_t500.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/de_t500.wms	2009-07-11 10:54:37 UTC (rev 2010)
+++ trunk/res_noewe/webmapservices/untested/de_t500.wms	2009-07-11 11:03:13 UTC (rev 2011)
@@ -1,20 +0,0 @@
-TakenFromUrl:	http://deutschlandviewer.bayern.de/deutschlandviewer/D_Viewer_Hilfe/Hilfe_D_Viewer.htm#Geodaten
-GetCapabilitiesUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&service=WMS&version=1.1.1&request=GetCapabilities
-Name:	de topo 500
-MainUrl:	http://gdz1.leipzig.ifag.de/servlet/com.esri.wms.Esrimap?servicename=dtk200_500_1000_a10_gk4_wms&
-MapType:	topo
-ServiceTypeUrlPart:	SERVICE=WMS
-VersionUrlPart:	VERSION=1.1.0
-CoordinateReferenceSystemCacheWolf:	31468 
-CoordinateReferenceSystemUrlPart:	SRS=EPSG:31468
-RequestUrlPart:	REQUEST=GetMap
-LayersUrlPart:	LAYERS=DTK500-V
-StylesUrlPart:	STYLES=
-ImageFormatUrlPart:	FORMAT=image/png
-BoundingBoxTopLeftWGS84:	N 54.9369973 E 6.00184962
-BoundingBoxButtomRightWGS84:	N 46.959702 E 16.12339886
-# there is no scale hint in the getCapabilities answer :-( --> allow all
-#MinScale:	0.01
-#MaxScale:	40
-RecommendedScale:	50
-ImageFileExtension: .png



From araber95 at mail.berlios.de  Sat Jul 11 13:06:40 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 11 Jul 2009 13:06:40 +0200
Subject: [Cachewolf-svn] r2012 - trunk/res_noewe/webmapservices/untested
Message-ID: <200907111106.n6BB6exU007918@sheep.berlios.de>

Author: araber95
Date: 2009-07-11 13:06:35 +0200 (Sat, 11 Jul 2009)
New Revision: 2012

Removed:
   trunk/res_noewe/webmapservices/untested/at-3_p.wms
   trunk/res_noewe/webmapservices/untested/at-3_t50.wms
   trunk/res_noewe/webmapservices/untested/at_p.wms
   trunk/res_noewe/webmapservices/untested/es-an_p.wms
   trunk/res_noewe/webmapservices/untested/es-an_t.wms
   trunk/res_noewe/webmapservices/untested/es-an_t1.wms
   trunk/res_noewe/webmapservices/untested/es-ar_p.wms
   trunk/res_noewe/webmapservices/untested/es-ar_t.wms
   trunk/res_noewe/webmapservices/untested/es-cn_p.wms
   trunk/res_noewe/webmapservices/untested/es-cn_t.wms
   trunk/res_noewe/webmapservices/untested/es-cn_ts.wms
   trunk/res_noewe/webmapservices/untested/fr_t.wms
   trunk/res_noewe/webmapservices/untested/jp-t.wms
   trunk/res_noewe/webmapservices/untested/pt_t500.wms
Log:
Moving one level up. Testing on the fly (some already tested)

Deleted: trunk/res_noewe/webmapservices/untested/at-3_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/at-3_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/at-3_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,50 +0,0 @@
-TakenFromUrl:       http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
-GetCapabilitiesUrl: http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               at.Niederoesterreich photo
-MapType:                        photo
-MainUrl:            http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf: 4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
-# 31466 31467 4326
-# SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:4326
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=oek200|OEK200||
-#LayersUrlPart:     LAYERS=oek50|OEK50||
-#LayersUrlPart:     LAYERS=ortho1m_sw|Orthofoto SW||
-#LayersUrlPart:     LAYERS=isolinien|Isolinien|NaN|NaN
-#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
-#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Uebergangsgebiet|Uebergangsgebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
-#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
-#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
-#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
-#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
-#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
-#LayersUrlPart:     LAYERS=Luftfahrthindernis|Luftfahrthindernis||
-#LayersUrlPart:     LAYERS=Grundwasserrahmenverfuegung|Grundwasser Rahmenverf??gung|NaN|99999999
-#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasser Schongebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Grundwasserschutzgebiet|Grundwasser Schutzgebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=hq100|Hochwasseranschlaglinie HQ100|NaN|99999999
-#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
-#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
-#LayersUrlPart:     LAYERS=see|Stehende Gew??sser||
-#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
-#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
-#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
-#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
-#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
-LayersUrlPart:     LAYERS=ortho1m_sw,flu_50t,see
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
-BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
-#BBox_Mitte: N 48.205281 E 15.862571
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   1
-ImageFileExtension: .png
-# Kalibrierung ?

Deleted: trunk/res_noewe/webmapservices/untested/at-3_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/at-3_t50.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/at-3_t50.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,50 +0,0 @@
-TakenFromUrl:       http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
-GetCapabilitiesUrl: http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               at.Niederoesterreich topo 50
-MapType:                        topo
-MainUrl:            http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf: 4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=oek200|OEK200||
-#LayersUrlPart:     LAYERS=oek50|OEK50||
-#LayersUrlPart:     LAYERS=ortho1m_sw|Orthofoto SW||
-#LayersUrlPart:     LAYERS=isolinien|Isolinien|NaN|NaN
-#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
-#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Uebergangsgebiet|Uebergangsgebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
-#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
-#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
-#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
-#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
-#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
-#LayersUrlPart:     LAYERS=Luftfahrthindernis|Luftfahrthindernis||
-#LayersUrlPart:     LAYERS=Grundwasserrahmenverfuegung|Grundwasser Rahmenverf??gung|NaN|99999999
-#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasser Schongebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Grundwasserschutzgebiet|Grundwasser Schutzgebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=hq100|Hochwasseranschlaglinie HQ100|NaN|99999999
-#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
-#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
-#LayersUrlPart:     LAYERS=see|Stehende Gew??sser||
-#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
-#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
-#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
-#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
-#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
-LayersUrlPart:     LAYERS=oek50,flu_50t,see
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
-BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .png
-# BBox ev. etwas zu weit s?dlich
-# keine Fehlermeldung bei Koordinaten ausserhalb
-# Skalierung ab 1 bis 15 (teils 17,5) (daruberhinaus nur die Wasserlayer)
-# Kalibrierung passt nicht zu Google

Deleted: trunk/res_noewe/webmapservices/untested/at_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/at_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/at_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,42 +0,0 @@
-TakenFromUrl:   http://www.geoland.at
-GetCapabilitiesUrl:   http://www.geoland.at/geolandWMS/service.aspx?Name=geoland_at_wms&Service=WMS&Version=1.1.1&Request=GetCapabilities
-Name:   at photo
-MapType:   photo
-MainUrl:   http://www.geoland.at/geolandWMS/service.aspx?
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-#LayersUrlPart:   LAYERS=Bezirke		<ScaleHint min="0.935071009578714" max="187.08941170883" /> 
-#LayersUrlPart:   LAYERS=Gemeinden		<ScaleHint min="0.935071009578714" max="187.08866335268" /> 
-#LayersUrlPart:   LAYERS=Landesgrenzen		<ScaleHint min="0.935071009578714" max="9354.45187653775" />
-#LayersUrlPart:   LAYERS=Natura2000_SPA		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Natura 2000 Vogelschutzrichtlinie (SPA)
-#LayersUrlPart:   LAYERS=Natura2000_pSCI	<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Natura 2000 Habitatrichtlinie (SCI)
-#LayersUrlPart:   LAYERS=Naturpark		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
-#LayersUrlPart:   LAYERS=Landschaftsschutzgebiet<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
-#LayersUrlPart:   LAYERS=Nationalpark		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
-#LayersUrlPart:   LAYERS=Naturschutzgebiet	<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
-#LayersUrlPart:   LAYERS=Autobahn		<ScaleHint min="0.935071009578714" max="748.356524301095" />
-#LayersUrlPart:   LAYERS=Landesstr_B		<ScaleHint min="0.935071009578714" max="748.356524301095" /> 
-#LayersUrlPart:   LAYERS=Landesstr_L		<ScaleHint min="0.935071009578714" max="187.08941170883" />
-#LayersUrlPart:   LAYERS=Orientierungskarte	<ScaleHint min="0" max="9.35482605461281" />
-#LayersUrlPart:   LAYERS=S/W-Orthofoto		<ScaleHint min="0.935071009578714" max="9.35482605461281" />
-#LayersUrlPart:   LAYERS=Radwanderrouten	<ScaleHint min="3.74140657254004" max="187.08941170883" /> 
-#LayersUrlPart:   LAYERS=Startbild		<ScaleHint min="74.8363633684521" max="3741.78112479318" /> Hintergrund
-#LayersUrlPart:   LAYERS=Geonamen		<ScaleHint min="0.935071009578714" max="5.61229694784759" /> Orts- und Flurnamen
-#LayersUrlPart:   LAYERS=Flug_Orthofoto		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Flugjahr Orthofoto
-#LayersUrlPart:   LAYERS=Flug_ALS		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Flugjahr Laserscanning
-#LayersUrlPart:   LAYERS=S/W-Orthofoto,Bezirke,Gemeinden,Landesgrenzen,Autobahn,Landesstr_B,Landesstr_L,Radwanderrouten
-LayersUrlPart:   LAYERS=S/W-Orthofoto,Orientierungskarte,Geonamen,Autobahn,Landesstr_B,Landesstr_L
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
-BoundingBoxButtomRightWGS84:   N 46.357433 E 17.202733
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   1
-ImageFileExtension: .png
-# nicht ?berall Luftbilder
-# nicht ?berall gut kalibriert
-# bis Skalierung 4,3 gibts noch Fotos, ab 4,5 nur noch Strassen (schlecht kalibriert)

Deleted: trunk/res_noewe/webmapservices/untested/es-an_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-an_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-an_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,20 +0,0 @@
-TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
-GetCapabilitiesUrl:   http://www.juntadeandalucia.es/medioambiente/servmap/wms/LANDSAT2004?REQUEST=GetCapabilities&SERVICE=WMS
-Name:   es.andalucia photo
-MapType:   photo
-MainUrl:   http://www.juntadeandalucia.es/medioambiente/servmap/wms/LANDSAT2004?
-LayersName:
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=0
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
-BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
-MinScale:   0
-MaxScale:   49.8902848429637
-RecommendedScale:   1.000
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/es-an_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-an_t.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-an_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,20 +0,0 @@
-TakenFromUrl:   http://www.andaluciajunta.es/IDEAndalucia/OGC.shtml#ogc18
-GetCapabilitiesUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r_95?REQUEST=GetCapabilities&SERVICE=WMS
-Name:   es.andalucia topo 10_95
-MapType:   topo
-MainUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r_95?
-LayersName:
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=mta10r
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
-BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
-MinScale:   0
-MaxScale:   49.8902848429637
-RecommendedScale:   5.000
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/es-an_t1.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-an_t1.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-an_t1.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,20 +0,0 @@
-TakenFromUrl:   http://www.andaluciajunta.es/IDEAndalucia/OGC.shtml#ogc2
-GetCapabilitiesUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r?REQUEST=GetCapabilities&SERVICE=WMS
-Name:   es.andalucia topo 10
-MapType:   topo
-MainUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r?
-LayersName:
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=mta10r
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
-BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
-MinScale:   0
-MaxScale:   49.8902848429637
-RecommendedScale:   5.000
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/es-ar_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-ar_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-ar_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,34 +0,0 @@
-TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
-GetCapabilitiesUrl:   http://sitar.aragon.es/AragonWMS?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:   es.aragon photo
-MapType:   photo
-MainUrl:   http://sitar.aragon.es/AragonWMS?
-LayersName: Carretera
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-#
-#LayersUrlPart:   LAYERS=ComunidadAutonoma,Provincia # Skal 260-2080
-#LayersUrlPart:   LAYERS=Comarca,ToponimoComarca # Skal 91-260
-#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio # skal 3,9-91
-#LayersUrlPart:   LAYERS=Planimetria5000,CurvaDirectora5000,CurvaNivel5000 # skal 0-1,3
-#LayersUrlPart:   LAYERS=Alti1000Ter,Alti1000Hue,Alti1000Zar,Plani1000Ter,Plani1000Hue,Plani1000Zar # skal 0-0,9
-#LayersUrlPart:   LAYERS=ComarcaLocalidad,ToponimoProvincia,ToponimoRio
-#LayersUrlPart:   LAYERS=Ortofoto,FechaOrtofoto,PNOA_2006_30,PNOA_2006_31
-#
-#LayersUrlPart:   LAYERS=Ortofoto #Skal=0,6..3,9; 4 geht auch
-#LayersUrlPart:   LAYERS=Carretera #Skal ab 5 geht
-#LayersUrlPart:   LAYERS=Municipio # Kommunalgrenzen
-#
-#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio
-LayersUrlPart:   LAYERS=Ortofoto,Planimetria5000,CurvaDirectora5000,CurvaNivel5000
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
-BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
-MinScale:   0
-MaxScale:   72
-RecommendedScale:   1
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/es-ar_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-ar_t.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-ar_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,34 +0,0 @@
-TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
-GetCapabilitiesUrl:   http://sitar.aragon.es/AragonWMS?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:   es.aragon topo
-MapType:   topo
-MainUrl:   http://sitar.aragon.es/AragonWMS?
-LayersName: Carretera
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-#
-#LayersUrlPart:   LAYERS=ComunidadAutonoma,Provincia # Skal 260-2080
-#LayersUrlPart:   LAYERS=Comarca,ToponimoComarca # Skal 91-260
-#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio # skal 3,9-91
-#LayersUrlPart:   LAYERS=Planimetria5000,CurvaDirectora5000,CurvaNivel5000 # skal 0-1,3
-#LayersUrlPart:   LAYERS=Alti1000Ter,Alti1000Hue,Alti1000Zar,Plani1000Ter,Plani1000Hue,Plani1000Zar # skal 0-0,9
-#LayersUrlPart:   LAYERS=ComarcaLocalidad,ToponimoProvincia,ToponimoRio
-#LayersUrlPart:   LAYERS=Ortofoto,FechaOrtofoto,PNOA_2006_30,PNOA_2006_31
-#
-#LayersUrlPart:   LAYERS=Ortofoto #Skal=0,6..3,9; 4 geht auch
-#LayersUrlPart:   LAYERS=Carretera #Skal ab 5 geht
-#LayersUrlPart:   LAYERS=Municipio # Kommunalgrenzen
-#
-LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio
-#LayersUrlPart:   LAYERS=Ortofoto,Planimetria5000,CurvaDirectora5000,CurvaNivel5000
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
-BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
-MinScale:   0
-MaxScale:   72
-RecommendedScale:   5
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/es-cn_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-cn_p.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-cn_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,21 +0,0 @@
-TakenFromUrl:       http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?
-GetCapabilitiesUrl: http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               es.Canarias photo
-MapType:                        photo
-MainUrl:            http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=WMS_OrtoExpress|IDECanarias OrtoExpress||
-#LayersUrlPart:     LAYERS=ortoexpress|OrtoExpress||
-LayersUrlPart:     LAYERS=WMS_OrtoExpress
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/jpeg
-BoundingBoxTopLeftWGS84: N 29.8305 W 18.3099
-BoundingBoxButtomRightWGS84: N 26.1839 W 13.1373
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .jpg

Deleted: trunk/res_noewe/webmapservices/untested/es-cn_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-cn_t.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-cn_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,20 +0,0 @@
-TakenFromUrl:   http://www.idecan.grafcan.es/idecan/content/view/24/36/#servicio2
-GetCapabilitiesUrl:   http://idecan2.grafcan.es/ServicioWMS/carto5?REQUEST=GetCapabilities&SERVICE=WMS
-Name:   es.Canarias topo
-MapType:   topo
-MainUrl:   http://idecan2.grafcan.es/ServicioWMS/carto5?
-LayersName:
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=WMS_CARTO5
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
-BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
-MinScale:   1.49671
-MaxScale:   174.0000
-RecommendedScale:   5.000
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/es-cn_ts.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/es-cn_ts.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/es-cn_ts.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,22 +0,0 @@
-TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
-GetCapabilitiesUrl:   http://idecan2.grafcan.es/ServicioWMS/Callejero?REQUEST=GetCapabilities&SERVICE=WMS
-Name:   es.Canarias streets
-MapType:   topo
-MainUrl:   http://idecan2.grafcan.es/ServicioWMS/Callejero?
-LayersName:
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-#LayersUrlPart:   LAYERS=TOPO,CONS,VIAS,MUN,FONDO,NUMP,POI
-LayersUrlPart:   LAYERS=WMS_CA
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
-BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
-MinScale:   0
-MaxScale:   2500.0000
-RecommendedScale:   5.000
-#RecommendedScale:   1.000 da stehen dann auch Strassennamen mit drin
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/fr_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/fr_t.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/fr_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,41 +0,0 @@
-TakenFromUrl:       http://www.geosignal.org/cgi-bin/wmsmap?version=1.1.1&service=WMS&request=GetLegendGraphic&layer=Voirie&format=image/png
-GetCapabilitiesUrl: http://www.geosignal.org/cgi-bin/wmsmap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               fr topo 4000
-MapType:                        topo
-MainUrl:            http://www.geosignal.org/cgi-bin/wmsmap?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=Serveur Geosignal|Serveur Geosignal||
-#LayersUrlPart:     LAYERS=Monde|Pays du monde||
-#LayersUrlPart:     LAYERS=RASTER4000k|Raster France 1/4 000 000|935.443|0
-#LayersUrlPart:     LAYERS=RASTER1000k|Raster France 1/1 000 000|280.633|935.443
-#LayersUrlPart:     LAYERS=RASTER500k|Raster France 1/500 000|140.316|280.633
-#LayersUrlPart:     LAYERS=RASTER250k|Raster France 1/250 000|65.481|140.316
-#LayersUrlPart:     LAYERS=RASTER100k|Raster France 1/100 000|28.0633|65.481
-#LayersUrlPart:     LAYERS=RASTER50k|Raster France 1/50 000|14.0316|28.0633
-#LayersUrlPart:     LAYERS=RASTER25k|Raster France 1/25 000|5.61266|14.0316
-#LayersUrlPart:     LAYERS=RASTER5k|Raster France 1/5 000|0.374177|5.61266
-#LayersUrlPart:     LAYERS=Communes|Communes||
-#LayersUrlPart:     LAYERS=Cantons|Cantons||
-#LayersUrlPart:     LAYERS=Arrondissements|Arrondissements||
-#LayersUrlPart:     LAYERS=Departements|Departements||
-#LayersUrlPart:     LAYERS=Regions|Regions||
-#LayersUrlPart:     LAYERS=Voirie|Voirie urbaine||
-#LayersUrlPart:     LAYERS=Autres|Autres equipements routiers||
-#LayersUrlPart:     LAYERS=Secondaires|Routes Secondaires||
-#LayersUrlPart:     LAYERS=Departementales|Routes Departementales||
-#LayersUrlPart:     LAYERS=Nationales|Routes Nationales||
-#LayersUrlPart:     LAYERS=Autoroutes|Autoroutes||
-#LayersUrlPart:     LAYERS=CommunesXY|Ponctuels des communes||
-LayersUrlPart:     LAYERS=RASTER4000k,Communes,Cantons,Arrondissements,Departements,Regions,Voirie,Autres,Secondaires,Departementales,Nationales,Autoroutes,CommunesXY
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
-BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/jp-t.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/jp-t.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/jp-t.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,37 +0,0 @@
-TakenFromUrl:       http://www.esri.com
-GetCapabilitiesUrl: http://www.geographynetwork.ne.jp/ogc/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               jp topo
-MapType:                        topo
-MainUrl:            http://www.geographynetwork.ne.jp/ogc/wms?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=1|Hill Shade||
-#LayersUrlPart:     LAYERS=0|Elevation||
-#LayersUrlPart:     LAYERS=2|Cities||
-#LayersUrlPart:     LAYERS=3|Cities(small scale)||
-#LayersUrlPart:     LAYERS=4|Prefectures||
-#LayersUrlPart:     LAYERS=5|Rivers||
-#LayersUrlPart:     LAYERS=6|Rivers(small scale)||
-#LayersUrlPart:     LAYERS=7|Water||
-#LayersUrlPart:     LAYERS=8|Water(small scale)||
-#LayersUrlPart:     LAYERS=9|Streets||
-#LayersUrlPart:     LAYERS=10|Railways||
-#LayersUrlPart:     LAYERS=11|Railways(small scale)||
-#LayersUrlPart:     LAYERS=12|Stations||
-#LayersUrlPart:     LAYERS=13|Major Roads||
-#LayersUrlPart:     LAYERS=14|Major Roads(small scale)||
-#LayersUrlPart:     LAYERS=15|Location Name||
-#LayersUrlPart:     LAYERS=16|Public Facilities||
-#LayersUrlPart:     LAYERS=17|Control Points||
-LayersUrlPart:     LAYERS=1,0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 45.576199 E 122.521907
-BoundingBoxButtomRightWGS84: N 20.424949 E 145.888782
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/untested/pt_t500.wms
===================================================================
--- trunk/res_noewe/webmapservices/untested/pt_t500.wms	2009-07-11 11:03:13 UTC (rev 2011)
+++ trunk/res_noewe/webmapservices/untested/pt_t500.wms	2009-07-11 11:06:35 UTC (rev 2012)
@@ -1,21 +0,0 @@
-TakenFromUrl:       http://mapas.igeo.pt
-GetCapabilitiesUrl: http://mapas.igeo.pt/wms/sc500k?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               pt topo 500
-MapType:                        topo
-MainUrl:            http://mapas.igeo.pt/wms/sc500k?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  4326
-CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=500k|Servidor WMS Produtos IGP - Carta de Portugal 1:500 000 (Continente)|0.249451424214819|249451.424214819
-#LayersUrlPart:     LAYERS=sc500k|Carta de Portugal Continental 1:500.000|0.249451424214819|249451.424214819
-LayersUrlPart:     LAYERS=sc500k
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 42.2787 W 10.1943
-BoundingBoxButtomRightWGS84: N 36.7636 W 5.71067
-MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .png



From araber95 at mail.berlios.de  Sat Jul 11 13:13:08 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 11 Jul 2009 13:13:08 +0200
Subject: [Cachewolf-svn] r2013 - trunk/res_noewe/webmapservices
Message-ID: <200907111113.n6BBD8F6016774@sheep.berlios.de>

Author: araber95
Date: 2009-07-11 13:12:59 +0200 (Sat, 11 Jul 2009)
New Revision: 2013

Added:
   trunk/res_noewe/webmapservices/at-3_p.wms
   trunk/res_noewe/webmapservices/at-3_t50.wms
   trunk/res_noewe/webmapservices/at_p.wms
   trunk/res_noewe/webmapservices/es-an_p.wms
   trunk/res_noewe/webmapservices/es-an_t.wms
   trunk/res_noewe/webmapservices/es-an_t1.wms
   trunk/res_noewe/webmapservices/es-ar_p.wms
   trunk/res_noewe/webmapservices/es-ar_t.wms
   trunk/res_noewe/webmapservices/es-cn_p.wms
   trunk/res_noewe/webmapservices/es-cn_t.wms
   trunk/res_noewe/webmapservices/es-cn_ts.wms
   trunk/res_noewe/webmapservices/fr_t.wms
   trunk/res_noewe/webmapservices/jp-t.wms
   trunk/res_noewe/webmapservices/pt_t500.wms
Removed:
   trunk/res_noewe/webmapservices/untested/
Log:
all wms on one level (testing on demand)

Added: trunk/res_noewe/webmapservices/at-3_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/at-3_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/at-3_p.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,50 @@
+TakenFromUrl:       http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+GetCapabilitiesUrl: http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               at.Niederoesterreich photo
+MapType:                        photo
+MainUrl:            http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf: 4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+# 31466 31467 4326
+# SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=oek200|OEK200||
+#LayersUrlPart:     LAYERS=oek50|OEK50||
+#LayersUrlPart:     LAYERS=ortho1m_sw|Orthofoto SW||
+#LayersUrlPart:     LAYERS=isolinien|Isolinien|NaN|NaN
+#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
+#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Uebergangsgebiet|Uebergangsgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
+#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
+#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
+#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
+#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
+#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
+#LayersUrlPart:     LAYERS=Luftfahrthindernis|Luftfahrthindernis||
+#LayersUrlPart:     LAYERS=Grundwasserrahmenverfuegung|Grundwasser Rahmenverf??gung|NaN|99999999
+#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasser Schongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschutzgebiet|Grundwasser Schutzgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=hq100|Hochwasseranschlaglinie HQ100|NaN|99999999
+#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
+#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
+#LayersUrlPart:     LAYERS=see|Stehende Gew??sser||
+#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
+#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
+#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
+#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
+#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
+LayersUrlPart:     LAYERS=ortho1m_sw,flu_50t,see
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
+BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
+#BBox_Mitte: N 48.205281 E 15.862571
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png
+# Kalibrierung ?

Added: trunk/res_noewe/webmapservices/at-3_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/at-3_t50.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/at-3_t50.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,50 @@
+TakenFromUrl:       http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+GetCapabilitiesUrl: http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               at.Niederoesterreich topo 50
+MapType:                        topo
+MainUrl:            http://www.intermap1.noel.gv.at:80/wmsconnector/com.esri.wms.Esrimap/pgo?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf: 4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=oek200|OEK200||
+#LayersUrlPart:     LAYERS=oek50|OEK50||
+#LayersUrlPart:     LAYERS=ortho1m_sw|Orthofoto SW||
+#LayersUrlPart:     LAYERS=isolinien|Isolinien|NaN|NaN
+#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
+#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Uebergangsgebiet|Uebergangsgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
+#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
+#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
+#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
+#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
+#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
+#LayersUrlPart:     LAYERS=Luftfahrthindernis|Luftfahrthindernis||
+#LayersUrlPart:     LAYERS=Grundwasserrahmenverfuegung|Grundwasser Rahmenverf??gung|NaN|99999999
+#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasser Schongebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=Grundwasserschutzgebiet|Grundwasser Schutzgebiet|NaN|99999999
+#LayersUrlPart:     LAYERS=hq100|Hochwasseranschlaglinie HQ100|NaN|99999999
+#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
+#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
+#LayersUrlPart:     LAYERS=see|Stehende Gew??sser||
+#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
+#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
+#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
+#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
+#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
+LayersUrlPart:     LAYERS=oek50,flu_50t,see
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 49.112935  E 14.243781
+BoundingBoxButtomRightWGS84:   N 47.297627 E 17.481360
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png
+# BBox ev. etwas zu weit s?dlich
+# keine Fehlermeldung bei Koordinaten ausserhalb
+# Skalierung ab 1 bis 15 (teils 17,5) (daruberhinaus nur die Wasserlayer)
+# Kalibrierung passt nicht zu Google

Added: trunk/res_noewe/webmapservices/at_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/at_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/at_p.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,42 @@
+TakenFromUrl:   http://www.geoland.at
+GetCapabilitiesUrl:   http://www.geoland.at/geolandWMS/service.aspx?Name=geoland_at_wms&Service=WMS&Version=1.1.1&Request=GetCapabilities
+Name:   at photo
+MapType:   photo
+MainUrl:   http://www.geoland.at/geolandWMS/service.aspx?
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#LayersUrlPart:   LAYERS=Bezirke		<ScaleHint min="0.935071009578714" max="187.08941170883" /> 
+#LayersUrlPart:   LAYERS=Gemeinden		<ScaleHint min="0.935071009578714" max="187.08866335268" /> 
+#LayersUrlPart:   LAYERS=Landesgrenzen		<ScaleHint min="0.935071009578714" max="9354.45187653775" />
+#LayersUrlPart:   LAYERS=Natura2000_SPA		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Natura 2000 Vogelschutzrichtlinie (SPA)
+#LayersUrlPart:   LAYERS=Natura2000_pSCI	<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Natura 2000 Habitatrichtlinie (SCI)
+#LayersUrlPart:   LAYERS=Naturpark		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Landschaftsschutzgebiet<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Nationalpark		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Naturschutzgebiet	<ScaleHint min="0.935071009578714" max="1870.89074948563" /> 
+#LayersUrlPart:   LAYERS=Autobahn		<ScaleHint min="0.935071009578714" max="748.356524301095" />
+#LayersUrlPart:   LAYERS=Landesstr_B		<ScaleHint min="0.935071009578714" max="748.356524301095" /> 
+#LayersUrlPart:   LAYERS=Landesstr_L		<ScaleHint min="0.935071009578714" max="187.08941170883" />
+#LayersUrlPart:   LAYERS=Orientierungskarte	<ScaleHint min="0" max="9.35482605461281" />
+#LayersUrlPart:   LAYERS=S/W-Orthofoto		<ScaleHint min="0.935071009578714" max="9.35482605461281" />
+#LayersUrlPart:   LAYERS=Radwanderrouten	<ScaleHint min="3.74140657254004" max="187.08941170883" /> 
+#LayersUrlPart:   LAYERS=Startbild		<ScaleHint min="74.8363633684521" max="3741.78112479318" /> Hintergrund
+#LayersUrlPart:   LAYERS=Geonamen		<ScaleHint min="0.935071009578714" max="5.61229694784759" /> Orts- und Flurnamen
+#LayersUrlPart:   LAYERS=Flug_Orthofoto		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Flugjahr Orthofoto
+#LayersUrlPart:   LAYERS=Flug_ALS		<ScaleHint min="0.935071009578714" max="1870.89074948563" /> Flugjahr Laserscanning
+#LayersUrlPart:   LAYERS=S/W-Orthofoto,Bezirke,Gemeinden,Landesgrenzen,Autobahn,Landesstr_B,Landesstr_L,Radwanderrouten
+LayersUrlPart:   LAYERS=S/W-Orthofoto,Orientierungskarte,Geonamen,Autobahn,Landesstr_B,Landesstr_L
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
+BoundingBoxButtomRightWGS84:   N 46.357433 E 17.202733
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png
+# nicht ?berall Luftbilder
+# nicht ?berall gut kalibriert
+# bis Skalierung 4,3 gibts noch Fotos, ab 4,5 nur noch Strassen (schlecht kalibriert)

Added: trunk/res_noewe/webmapservices/es-an_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-an_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-an_p.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://www.juntadeandalucia.es/medioambiente/servmap/wms/LANDSAT2004?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.andalucia photo
+MapType:   photo
+MainUrl:   http://www.juntadeandalucia.es/medioambiente/servmap/wms/LANDSAT2004?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=0
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
+BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+MinScale:   0
+MaxScale:   49.8902848429637
+RecommendedScale:   1.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/es-an_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-an_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-an_t.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.andaluciajunta.es/IDEAndalucia/OGC.shtml#ogc18
+GetCapabilitiesUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r_95?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.andalucia topo 10_95
+MapType:   topo
+MainUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r_95?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=mta10r
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
+BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+MinScale:   0
+MaxScale:   49.8902848429637
+RecommendedScale:   5.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/es-an_t1.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-an_t1.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-an_t1.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.andaluciajunta.es/IDEAndalucia/OGC.shtml#ogc2
+GetCapabilitiesUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.andalucia topo 10
+MapType:   topo
+MainUrl:   http://andaluciajunta.es/IDEAndalucia/IDEAwms/wms/mta10r?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=mta10r
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 38.748  W 7.587
+BoundingBoxButtomRightWGS84:   N 35.947 W 1.602
+MinScale:   0
+MaxScale:   49.8902848429637
+RecommendedScale:   5.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/es-ar_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-ar_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-ar_p.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,34 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://sitar.aragon.es/AragonWMS?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:   es.aragon photo
+MapType:   photo
+MainUrl:   http://sitar.aragon.es/AragonWMS?
+LayersName: Carretera
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#
+#LayersUrlPart:   LAYERS=ComunidadAutonoma,Provincia # Skal 260-2080
+#LayersUrlPart:   LAYERS=Comarca,ToponimoComarca # Skal 91-260
+#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio # skal 3,9-91
+#LayersUrlPart:   LAYERS=Planimetria5000,CurvaDirectora5000,CurvaNivel5000 # skal 0-1,3
+#LayersUrlPart:   LAYERS=Alti1000Ter,Alti1000Hue,Alti1000Zar,Plani1000Ter,Plani1000Hue,Plani1000Zar # skal 0-0,9
+#LayersUrlPart:   LAYERS=ComarcaLocalidad,ToponimoProvincia,ToponimoRio
+#LayersUrlPart:   LAYERS=Ortofoto,FechaOrtofoto,PNOA_2006_30,PNOA_2006_31
+#
+#LayersUrlPart:   LAYERS=Ortofoto #Skal=0,6..3,9; 4 geht auch
+#LayersUrlPart:   LAYERS=Carretera #Skal ab 5 geht
+#LayersUrlPart:   LAYERS=Municipio # Kommunalgrenzen
+#
+#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio
+LayersUrlPart:   LAYERS=Ortofoto,Planimetria5000,CurvaDirectora5000,CurvaNivel5000
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
+BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
+MinScale:   0
+MaxScale:   72
+RecommendedScale:   1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/es-ar_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-ar_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-ar_t.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,34 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://sitar.aragon.es/AragonWMS?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:   es.aragon topo
+MapType:   topo
+MainUrl:   http://sitar.aragon.es/AragonWMS?
+LayersName: Carretera
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#
+#LayersUrlPart:   LAYERS=ComunidadAutonoma,Provincia # Skal 260-2080
+#LayersUrlPart:   LAYERS=Comarca,ToponimoComarca # Skal 91-260
+#LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio # skal 3,9-91
+#LayersUrlPart:   LAYERS=Planimetria5000,CurvaDirectora5000,CurvaNivel5000 # skal 0-1,3
+#LayersUrlPart:   LAYERS=Alti1000Ter,Alti1000Hue,Alti1000Zar,Plani1000Ter,Plani1000Hue,Plani1000Zar # skal 0-0,9
+#LayersUrlPart:   LAYERS=ComarcaLocalidad,ToponimoProvincia,ToponimoRio
+#LayersUrlPart:   LAYERS=Ortofoto,FechaOrtofoto,PNOA_2006_30,PNOA_2006_31
+#
+#LayersUrlPart:   LAYERS=Ortofoto #Skal=0,6..3,9; 4 geht auch
+#LayersUrlPart:   LAYERS=Carretera #Skal ab 5 geht
+#LayersUrlPart:   LAYERS=Municipio # Kommunalgrenzen
+#
+LayersUrlPart:   LAYERS=Municipio,Ferrocarril,Localidad,Altimetria,Carretera,Rio,ToponimoLocalidad,ToponimoMunicipio
+#LayersUrlPart:   LAYERS=Ortofoto,Planimetria5000,CurvaDirectora5000,CurvaNivel5000
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 42.945  W 2.19
+BoundingBoxButtomRightWGS84:   N 39.813 E 0.805
+MinScale:   0
+MaxScale:   72
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/es-cn_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-cn_p.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-cn_p.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,21 @@
+TakenFromUrl:       http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?
+GetCapabilitiesUrl: http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               es.Canarias photo
+MapType:                        photo
+MainUrl:            http://idecan1.grafcan.es/ServicioWMS/OrtoExpress?REQUEST=GetCapabilities&SERVICE=WMS&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=WMS_OrtoExpress|IDECanarias OrtoExpress||
+#LayersUrlPart:     LAYERS=ortoexpress|OrtoExpress||
+LayersUrlPart:     LAYERS=WMS_OrtoExpress
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 29.8305 W 18.3099
+BoundingBoxButtomRightWGS84: N 26.1839 W 13.1373
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .jpg

Added: trunk/res_noewe/webmapservices/es-cn_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-cn_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-cn_t.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,20 @@
+TakenFromUrl:   http://www.idecan.grafcan.es/idecan/content/view/24/36/#servicio2
+GetCapabilitiesUrl:   http://idecan2.grafcan.es/ServicioWMS/carto5?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.Canarias topo
+MapType:   topo
+MainUrl:   http://idecan2.grafcan.es/ServicioWMS/carto5?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+LayersUrlPart:   LAYERS=WMS_CARTO5
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
+BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
+MinScale:   1.49671
+MaxScale:   174.0000
+RecommendedScale:   5.000
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/es-cn_ts.wms
===================================================================
--- trunk/res_noewe/webmapservices/es-cn_ts.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/es-cn_ts.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,22 @@
+TakenFromUrl:   http://www.idee.es/CatalogoServicios/cat2/indexWMS.html
+GetCapabilitiesUrl:   http://idecan2.grafcan.es/ServicioWMS/Callejero?REQUEST=GetCapabilities&SERVICE=WMS
+Name:   es.Canarias streets
+MapType:   topo
+MainUrl:   http://idecan2.grafcan.es/ServicioWMS/Callejero?
+LayersName:
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   4326
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
+RequestUrlPart:   REQUEST=GetMap
+#LayersUrlPart:   LAYERS=TOPO,CONS,VIAS,MUN,FONDO,NUMP,POI
+LayersUrlPart:   LAYERS=WMS_CA
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 29.8305 W 18.3099
+BoundingBoxButtomRightWGS84:   N 26.1839 W 13.137
+MinScale:   0
+MaxScale:   2500.0000
+RecommendedScale:   5.000
+#RecommendedScale:   1.000 da stehen dann auch Strassennamen mit drin
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/fr_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/fr_t.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/fr_t.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,41 @@
+TakenFromUrl:       http://www.geosignal.org/cgi-bin/wmsmap?version=1.1.1&service=WMS&request=GetLegendGraphic&layer=Voirie&format=image/png
+GetCapabilitiesUrl: http://www.geosignal.org/cgi-bin/wmsmap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               fr topo 4000
+MapType:                        topo
+MainUrl:            http://www.geosignal.org/cgi-bin/wmsmap?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=Serveur Geosignal|Serveur Geosignal||
+#LayersUrlPart:     LAYERS=Monde|Pays du monde||
+#LayersUrlPart:     LAYERS=RASTER4000k|Raster France 1/4 000 000|935.443|0
+#LayersUrlPart:     LAYERS=RASTER1000k|Raster France 1/1 000 000|280.633|935.443
+#LayersUrlPart:     LAYERS=RASTER500k|Raster France 1/500 000|140.316|280.633
+#LayersUrlPart:     LAYERS=RASTER250k|Raster France 1/250 000|65.481|140.316
+#LayersUrlPart:     LAYERS=RASTER100k|Raster France 1/100 000|28.0633|65.481
+#LayersUrlPart:     LAYERS=RASTER50k|Raster France 1/50 000|14.0316|28.0633
+#LayersUrlPart:     LAYERS=RASTER25k|Raster France 1/25 000|5.61266|14.0316
+#LayersUrlPart:     LAYERS=RASTER5k|Raster France 1/5 000|0.374177|5.61266
+#LayersUrlPart:     LAYERS=Communes|Communes||
+#LayersUrlPart:     LAYERS=Cantons|Cantons||
+#LayersUrlPart:     LAYERS=Arrondissements|Arrondissements||
+#LayersUrlPart:     LAYERS=Departements|Departements||
+#LayersUrlPart:     LAYERS=Regions|Regions||
+#LayersUrlPart:     LAYERS=Voirie|Voirie urbaine||
+#LayersUrlPart:     LAYERS=Autres|Autres equipements routiers||
+#LayersUrlPart:     LAYERS=Secondaires|Routes Secondaires||
+#LayersUrlPart:     LAYERS=Departementales|Routes Departementales||
+#LayersUrlPart:     LAYERS=Nationales|Routes Nationales||
+#LayersUrlPart:     LAYERS=Autoroutes|Autoroutes||
+#LayersUrlPart:     LAYERS=CommunesXY|Ponctuels des communes||
+LayersUrlPart:     LAYERS=RASTER4000k,Communes,Cantons,Arrondissements,Departements,Regions,Voirie,Autres,Secondaires,Departementales,Nationales,Autoroutes,CommunesXY
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 51.2918 W 6.06258
+BoundingBoxButtomRightWGS84: N 41.1632 E 10.8783
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/jp-t.wms
===================================================================
--- trunk/res_noewe/webmapservices/jp-t.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/jp-t.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,37 @@
+TakenFromUrl:       http://www.esri.com
+GetCapabilitiesUrl: http://www.geographynetwork.ne.jp/ogc/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               jp topo
+MapType:                        topo
+MainUrl:            http://www.geographynetwork.ne.jp/ogc/wms?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=1|Hill Shade||
+#LayersUrlPart:     LAYERS=0|Elevation||
+#LayersUrlPart:     LAYERS=2|Cities||
+#LayersUrlPart:     LAYERS=3|Cities(small scale)||
+#LayersUrlPart:     LAYERS=4|Prefectures||
+#LayersUrlPart:     LAYERS=5|Rivers||
+#LayersUrlPart:     LAYERS=6|Rivers(small scale)||
+#LayersUrlPart:     LAYERS=7|Water||
+#LayersUrlPart:     LAYERS=8|Water(small scale)||
+#LayersUrlPart:     LAYERS=9|Streets||
+#LayersUrlPart:     LAYERS=10|Railways||
+#LayersUrlPart:     LAYERS=11|Railways(small scale)||
+#LayersUrlPart:     LAYERS=12|Stations||
+#LayersUrlPart:     LAYERS=13|Major Roads||
+#LayersUrlPart:     LAYERS=14|Major Roads(small scale)||
+#LayersUrlPart:     LAYERS=15|Location Name||
+#LayersUrlPart:     LAYERS=16|Public Facilities||
+#LayersUrlPart:     LAYERS=17|Control Points||
+LayersUrlPart:     LAYERS=1,0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 45.576199 E 122.521907
+BoundingBoxButtomRightWGS84: N 20.424949 E 145.888782
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/pt_t500.wms
===================================================================
--- trunk/res_noewe/webmapservices/pt_t500.wms	2009-07-11 11:06:35 UTC (rev 2012)
+++ trunk/res_noewe/webmapservices/pt_t500.wms	2009-07-11 11:12:59 UTC (rev 2013)
@@ -0,0 +1,21 @@
+TakenFromUrl:       http://mapas.igeo.pt
+GetCapabilitiesUrl: http://mapas.igeo.pt/wms/sc500k?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               pt topo 500
+MapType:                        topo
+MainUrl:            http://mapas.igeo.pt/wms/sc500k?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=500k|Servidor WMS Produtos IGP - Carta de Portugal 1:500 000 (Continente)|0.249451424214819|249451.424214819
+#LayersUrlPart:     LAYERS=sc500k|Carta de Portugal Continental 1:500.000|0.249451424214819|249451.424214819
+LayersUrlPart:     LAYERS=sc500k
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 42.2787 W 10.1943
+BoundingBoxButtomRightWGS84: N 36.7636 W 5.71067
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   5
+ImageFileExtension: .png



From apreisser at mail.berlios.de  Sat Jul 11 14:14:16 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 11 Jul 2009 14:14:16 +0200
Subject: [Cachewolf-svn] r2014 - trunk/res_noewe
Message-ID: <200907111214.n6BCEGh2004111@sheep.berlios.de>

Author: apreisser
Date: 2009-07-11 14:14:11 +0200 (Sat, 11 Jul 2009)
New Revision: 2014

Added:
   trunk/res_noewe/info_de.html
   trunk/res_noewe/legende_de.html
   trunk/res_noewe/wolflang_de.html
Modified:
   trunk/res_noewe/info.html
   trunk/res_noewe/legende.html
Log:
Help-Files localized.

Modified: trunk/res_noewe/info.html
===================================================================
--- trunk/res_noewe/info.html	2009-07-11 11:12:59 UTC (rev 2013)
+++ trunk/res_noewe/info.html	2009-07-11 12:14:11 UTC (rev 2014)
@@ -3,7 +3,7 @@
 <font face="Tahoma" size = "3">
 <strong>A geocaching programm</strong><br>
 <font face="Tahoma" size = "2"><em>
-from apreisser, Bilbowolf, Blackeye501, Engywuck, greiol, Kalli, Kappler, MiK, mirabilos, Pfeffer, salzkammergut<br>
+from Bilbowolf, Blackeye501, ColleIsarco, Engywuck, greiol, Kalli, Kappler, MiK, mirabilos, Pfeffer, salzkammergut<br>
 for Windows, Linux and Pocket PC</em><br>
 <br>
 CacheWolf was created sometime 2003 to enable paperless caching with a Sharp Zaurus.

Added: trunk/res_noewe/info_de.html
===================================================================
--- trunk/res_noewe/info_de.html	2009-07-11 11:12:59 UTC (rev 2013)
+++ trunk/res_noewe/info_de.html	2009-07-11 12:14:11 UTC (rev 2014)
@@ -0,0 +1,19 @@
+<font face="Tahoma">
+<h1>CacheWolf</h1></font>
+<font face="Tahoma" size = "3">
+<strong>Ein Programm zum papierlosen Geocachen</strong><br>
+<font face="Tahoma" size = "2"><em>
+von Bilbowolf, Blackeye501, ColleIsarco, Engywuck, greiol, Kalli, Kappler, MiK, mirabilos, Pfeffer, salzkammergut<br>
+F?r Windows, Linux and Pocket PC</em><br>
+<br>
+CacheWolf wurde im Jahre 2003 erschaffen, um papierloses Cachen mit dem Sharp Zaurus zu erm?glichen.
+Da das Programm in Java geschrieben wurde, kam es nach einer Weile zu Anfragen, dieses Tools
+auch auf Pocket PCs laufen zu lassen.<BR>Da die existierenden Java-Laufzeit-Umgebungen der Pocket-PCs
+nicht die notwendige leistungsf?hig aufweisen, wurde CacheWolf f?r EWE neu implementiert.<BR><BR>
+Du bist an der Weiterentwicklung von CacheWolf herzlich eingeladen.<BR><BR>
+CacheWolf Homepage: www.cachewolf.de<br>
+Diskussionsforum zu CacheWolf: www.geoclub.de<br><br>
+<STRONG>Cache On 'n Cache hard!</STRONG>
+</font>
+<hr />
+<small><tt style="white-space:nowrap;"><!--$Id: info.html 2000 2009-07-07 19:53:54Z mirabilos $--></tt></small>


Property changes on: trunk/res_noewe/info_de.html
___________________________________________________________________
Name: svn:mime-type
   + text/plain

Modified: trunk/res_noewe/legende.html
===================================================================
--- trunk/res_noewe/legende.html	2009-07-11 11:12:59 UTC (rev 2013)
+++ trunk/res_noewe/legende.html	2009-07-11 12:14:11 UTC (rev 2014)
@@ -1,22 +1,22 @@
 <font face="Tahoma" size="2">
-<b>Farben und Punkte</b>
+<b>Colours and dots</b>
 <br><br>
 
-<b><i>Listenansicht (farbige Zeilen)</i></b>
+<b><i>Listview (coloured lines)</i></b>
 <table>
-<tr><td><font color="#FF8000"=>Cache ist nicht suchbar</font></td></tr>
-<tr><td><font color="#C80000"=>Cache wurde archiviert</font></td></tr>
-<tr><td><font color="#1D4AEE"=>Eigene Caches</font></td></tr>
-<tr><td><font color="#0BB206"=>Gefundene Caches</font></td></tr>
+<tr><td><font color="#FF8000"=>Cache is searchable</font></td></tr>
+<tr><td><font color="#C80000"=>Cache has been archived</font></td></tr>
+<tr><td><font color="#1D4AEE"=>Caches owned by Yourself</font></td></tr>
+<tr><td><font color="#0BB206"=>Caches found by Yourself</font></td></tr>
 </table>
 <br>
 
-<b><i>Punkte vor Wegpunktnamen</i></b><br>
-<img src='yellow.png'>Cache ist "neu" durch GPX-Import<br>
-<img src='red.png'>Update in Cachebeschreibung<br>
-<img src='blue.png'>Neue Logeintraege<br>
+<b><i>Dots in front of waypointnames</i></b><br>
+<img src='yellow.png'>Cache is new due to GPX-import<br>
+<img src='red.png'>Update in description of the cache<br>
+<img src='blue.png'>New logentries<br>
 <br>
 
-<b><i>Sonstige Symbole</i></b><br>
+<b><i>Other Symbols</i></b><br>
 <img src='bug.gif'>TravelBug<br>
-<img src='dnf.gif'>DNF-Indikator (je mehr Farben zu sehen, desto mehr DNF's)
+<img src='dnf.gif'>DNF-Indicator (as You can see more colours, the more DNF's are logged)

Added: trunk/res_noewe/legende_de.html
===================================================================
--- trunk/res_noewe/legende_de.html	2009-07-11 11:12:59 UTC (rev 2013)
+++ trunk/res_noewe/legende_de.html	2009-07-11 12:14:11 UTC (rev 2014)
@@ -0,0 +1,22 @@
+<font face="Tahoma" size="2">
+<b>Farben und Punkte</b>
+<br><br>
+
+<b><i>Listenansicht (farbige Zeilen)</i></b>
+<table>
+<tr><td><font color="#FF8000"=>Cache ist nicht suchbar</font></td></tr>
+<tr><td><font color="#C80000"=>Cache wurde archiviert</font></td></tr>
+<tr><td><font color="#1D4AEE"=>Eigene Caches</font></td></tr>
+<tr><td><font color="#0BB206"=>Gefundene Caches</font></td></tr>
+</table>
+<br>
+
+<b><i>Punkte vor Wegpunktnamen</i></b><br>
+<img src='yellow.png'>Cache ist "neu" durch GPX-Import<br>
+<img src='red.png'>Update in Cachebeschreibung<br>
+<img src='blue.png'>Neue Logeintr?ge<br>
+<br>
+
+<b><i>Sonstige Symbole</i></b><br>
+<img src='bug.gif'>TravelBug<br>
+<img src='dnf.gif'>DNF-Indikator (je mehr Farben zu sehen, desto mehr DNF's)


Property changes on: trunk/res_noewe/legende_de.html
___________________________________________________________________
Name: svn:mime-type
   + text/plain

Added: trunk/res_noewe/wolflang_de.html
===================================================================
--- trunk/res_noewe/wolflang_de.html	2009-07-11 11:12:59 UTC (rev 2013)
+++ trunk/res_noewe/wolflang_de.html	2009-07-11 12:14:11 UTC (rev 2014)
@@ -0,0 +1,73 @@
+<font face="Tahoma" size = "2"><b>WolfLanguage Befehle:</b><br>
+Zeichen hinter dem # bis zum Zeilenende werden ignoriert<br>
+Mehrere Befehle in einer Zeile werden durch einem Semikolon (;) getrennt<br>
+<i>Beispiel: stop</i>   # Stoppt Skript<br>
+<i>Beispiel: cls()</i>   # Ausgabefenster l?schen<br>
+<br>
+<b><u>Grundlegende Operationen</u></b><br>
+ Zuweisung:<br>
+ variable = wert<br>
+<i> Beispiel: a = 2</i><br>
+<i> Beispiel: $a = 2; b="abc"</i><br>
+$a ist eine globale Variable.<br>
+Numerische Ausdr?cke formatieren:<br>
+Beispiel: 3.14159:000.00:<br>
+<i>Formatierungszeichen:</i> 0 . # wobei # f?r beliebige Ziffern steht<br> 
+<br>
+<u><b> Anzeige von Werten</b></u><br>
+ "beliebiger Text" " weitere Text":<br>
+<i> Beispiel: "N 34 12." a " :das " rot13("Mvry")</i>
+ +, -, *, /, (, ):<br>
+<i> Beispiel: a = 1 / 2 + 34 - 8 * 12<br>
+ oder a = (1 / b + 34 - b) * 12</i><br>
+<br>
+<b><u>Wurzel, Potenz</u></b><br>
+ sqrt(), ^:<br>
+<i> Beispiel: a = sqrt(2) ^ 5</i><br>
+<br>
+<b><u>Trigonometrische Funktionen</u></b><br>
+ cos(), sin(), tan(),<br>
+ atan(), asin(), acos():<br>
+<i> Beispiel: a = cos(90);<br>
+ oder a = atan(b);</i><br>
+<u>Modus f?r trigonometrische Funktionen ?ndern</u><br>
+ deg()<br>
+ rad()<br>
+<u>Trigonometrische Konvertierungen</u><br>
+ deg2rad()  <i>alias</i> d2r()<br>
+ rad2deg()  <i>alias</i> r2d()<br>   
+<br>
+<b><u>Numerische Functionen</u></b><br>
+ct(number) # Quersumme (engl.: crosstotal)<br>
+q(number) # Quersumme<br><br>
+<b><u>Text Funktionen</u></b>[s is eine Zeichenkette]<br>
+length(s)<br>
+mid(s,startpos,length)<br> 
+instr(s,searchStr)<br>
+instr(startpos,s,searchstr)<br>
+ucase(s)<br>
+lcase(s)<br>
+replace(s,searchStr,ReplaceStr)<br>
+reverse(s)<br>
+encode(s,s1,s2)<br>
+count(s,whatStr)<br>
+val(s)<i> # A=1, B=2, ... Z=26;  Alle addieren</i><br>
+sval(s)<i> # A=1, B=2, ... Z=26</i><br>
+rot13(s)<br><br>
+<b><u>Koordinaten</u></b><br>
+bearing(coordinate1,coordinate2) # Peilung<br>
+center() # get current center<br>
+center(coordinate)<br>
+cp() # get current GPS position<br>
+distance(coordinate1,coordinate2) # Abstand zwischen zwei Punkten<br>  
+format(coordinate,fmt) <br>
+  <i>wobei fmt="CW" or "UTM" or "DMS" or "DD" or "DMM" or "GK"</i><br>
+goto(coordinate)<br>
+goto(coordinate,waypointname)<br>
+project(coordinate,angle,distance) # Projektion<br><br>
+<b><u>Programme f?r Multicaches generieren (mit/ohne zus?tzlichen Wegpunkten)</u></b><br>
+skeleton() # Skript-Ger?st f?r aktuellen Cache generieren<br>
+skeleton(AnzahlderStationen) # Ger?st mit Stationen generieren<br><br>
+<b><u>IF THEN ENDIF</u></b><br>
+IF bedingung THEN Anweisung ; Anweisung .... ENDIF<br><br>
+</font>


Property changes on: trunk/res_noewe/wolflang_de.html
___________________________________________________________________
Name: svn:mime-type
   + text/plain



From apreisser at mail.berlios.de  Sat Jul 11 14:14:54 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 11 Jul 2009 14:14:54 +0200
Subject: [Cachewolf-svn] r2015 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200907111214.n6BCEsrO004234@sheep.berlios.de>

Author: apreisser
Date: 2009-07-11 14:14:49 +0200 (Sat, 11 Jul 2009)
New Revision: 2015

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/MainMenu.java
Log:
System-Screen localized

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-07-11 12:14:11 UTC (rev 2014)
+++ trunk/res_noewe/languages/DE.cfg	2009-07-11 12:14:49 UTC (rev 2015)
@@ -125,6 +125,19 @@
 		257=Haupt
 		258=Addis
 		259=Wollen Sie fortfahren?
+		260=Plattform:
+		261=Lokale Sprache ist:
+		262=L%e4ndereinstellung ist:
+		263=Dezimaltrennzeichen ist:
+		264=Ger%e4t ist PDA:
+		265=Bildschirm:
+		266=Schriftgr%f6%dfe:
+		267=Eintr%e4ge in der der DB:
+		268=Dateitrennzeichen:
+		269=Programm-Verzeichnis ist:
+		270=Anzahl der Details im Speicher ist:
+		271=Maximal:
+		272=CacheWolf Version:
 		299=Regul%e4rer Ausdruck
 		300=Type:
 		301=Gr%f6%dfe:
@@ -474,7 +487,8 @@
 		1740=Kreuzpeilungswinkel m?ssen im Bereich [0;360] sein
 		1741=Kreuzpeilungswinkel m?ssen im Bereich [0;2*PI] sein
 		1742=Abstand der Punkte in der Kreuzpeilung ist zu klein
-		1753=Kreuzpeilung nicht m?glich. Bitte Entwickler auf geoclub.de informieren!
+		1743=Kreuzpeilung nicht m?glich. Bitte Entwickler auf geoclub.de informieren!
+		1744=Kreuzpeilung mit identischen Peilungswinkeln nicht m?glich
 		1800=Georeferenzierte Karten herunterladen
 		1801=Kacheln herunterladen
 		1802=Download georeferenzierter Karten%0a W%e4hle Onlinedienst:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-07-11 12:14:11 UTC (rev 2014)
+++ trunk/res_noewe/languages/EN.cfg	2009-07-11 12:14:49 UTC (rev 2015)
@@ -125,6 +125,19 @@
 		257=Main
 		258=Addis
 		259=Do you really want to continue?
+		260=Platform:
+		261=Locale lang is:
+		262=Locale country is:
+		263=Decimal separator is:
+		264=Device is PDA:
+		265=Screen:
+		266=Font size:
+		267=Entries in DB:
+		268=File separator is:
+		269=Programme directory is:
+		270=Number of details in RAM is:
+		271=Maximum:
+		272=CacheWolf version:
 		299=Regular expression
 		300=Type:
 		301=Size:
@@ -474,7 +487,7 @@
 		1740=Crossbearing degrees  must be in interval [0;360]
 		1741=Crossbearing degrees  must be in interval [0;2*PI]
 		1742=Crossbearing: distance between points to small
-		1753=Crossbearing calculation failed. Please inform the developers at geoclub.de		
+		1743=Crossbearing calculation failed. Please inform the developers at geoclub.de		
 		1800=Download georeferenced maps
 		1801=Download tiles
 		1802=Download georeferenced maps%0a Select online service:

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-07-11 12:14:11 UTC (rev 2014)
+++ trunk/res_noewe/languages/FR.cfg	2009-07-11 12:14:49 UTC (rev 2015)
@@ -122,6 +122,19 @@
 		257=[Main]
 		258=[Addis]
 		259=[Do you really want to continue?]
+		260=[Platform:]
+		261=[Locale lang is:]
+		262=[Locale country is:]
+		263=[Decimal separator is:]
+		264=[Device is PDA:]
+		265=[Screen:]
+		266=[Font size:]
+		267=[Entries in DB:]
+		268=[File separator is:]
+		269=[Programme directory is:]
+		270=[Number of details in RAM is:]
+		271=[Maximum:]
+		272=[CacheWolf version:]
 		299=Expression rationnelle
 		300=Type:
 		301=Gabarit:
@@ -458,7 +471,7 @@
 		1740=[Crossbearing degrees  must be in interval [0;360]]
 		1741=[Crossbearing degrees  must be in interval [0;2*PI]]
 		1742=[Crossbearing: distance between points to small]
-		1753=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
+		1743=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
 		1800=T%e9l%e9charger des cartes g%e9o-r%e9f%e9renc%e9e
 		1801=T%e9l%e9charger pages
 		1802=T%e9l%e9chargement des cartes g%e9o-r%e9f%e9renc%e9e%0aChoissisez service en ligne:

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-07-11 12:14:11 UTC (rev 2014)
+++ trunk/res_noewe/languages/NL.cfg	2009-07-11 12:14:49 UTC (rev 2015)
@@ -114,6 +114,19 @@
 		257=[Main]
 		258=[Addis]
 		259=[Do you really want to continue?]
+		260=[Platform:]
+		261=[Locale lang is:]
+		262=[Locale country is:]
+		263=[Decimal separator is:]
+		264=[Device is PDA:]
+		265=[Screen:]
+		266=[Font size:]
+		267=[Entries in DB:]
+		268=[File separator is:]
+		269=[Programme directory is:]
+		270=[Number of details in RAM is:]
+		271=[Maximum:]
+		272=[CacheWolf version:]
 		299=Reguliere expressie
 		300=Type:
 		301=Grote:
@@ -421,7 +434,7 @@
 		1740=[Crossbearing degrees  must be in interval [0;360]]
 		1741=[Crossbearing degrees  must be in interval [0;2*PI]]
 		1742=[Crossbearing: distance between points to small]
-		1753=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
+		1743=[Crossbearing calculation failed. Please inform the developers at geoclub.de		]
 		1800=Downloaden GEO gerelateerde kaarten.
 		1801=Downloaden tegels
 		2000=Exporten GPX

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-07-11 12:14:11 UTC (rev 2014)
+++ trunk/src/CacheWolf/MainMenu.java	2009-07-11 12:14:49 UTC (rev 2015)
@@ -678,22 +678,63 @@
 				//Vm.debug("Checking system...");
 				StringBuffer sb=new StringBuffer(400);
 				Font f = mApp.guiFont;
-				sb.append("Profile: "); 				sb.append(profile.dataDir);
-				sb.append("<br>Platform: "); 			sb.append(Vm.getPlatform());
-				sb.append("<br>Locale lang is: ");		sb.append(MyLocale.getLocaleLanguage()); 
-				sb.append("<br>Locale country is: "); 	sb.append(MyLocale.getLocaleCountry()); 
-				sb.append("<br>Decimal separator is: \""); sb.append(MyLocale.getDigSeparator());
-				sb.append("\"<br>Device is PDA: ");		sb.append(Vm.isMobile());
-				sb.append("<br>Screen: ");				sb.append(MyLocale.getScreenWidth()); 
+				sb.append(MyLocale.getMsg(121,"Profile"));
+				sb.append(": ");
+				sb.append(profile.dataDir);
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(260, "Platform:"));
+				sb.append(' ');
+				sb.append(Vm.getPlatform());
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(261, "Locale lang is:"));
+				sb.append(' ');
+				sb.append(MyLocale.getLocaleLanguage()); 
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(262, "Locale country is:"));
+				sb.append(' ');
+				sb.append(MyLocale.getLocaleCountry()); 
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(263, "Decimal separator is:"));
+				sb.append(" \"");
+				sb.append(MyLocale.getDigSeparator());
+				sb.append("\"<br>");
+				sb.append(MyLocale.getMsg(264, "Device is PDA:"));
+				sb.append(' ');
+				sb.append(Vm.isMobile());
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(265, "Screen:"));
+				sb.append(' ');
+				sb.append(MyLocale.getScreenWidth()); 
 				sb.append(" x ");	 sb.append(MyLocale.getScreenHeight()); 
-				sb.append("<br>Font size: ");			sb.append(f.getSize());
-				sb.append("<br>Entries in DB: ");		sb.append(cacheDB.size());
-				sb.append("<br>File separator is: \""); sb.append(Vm.getProperty("file.separator","def")); 
-				sb.append("\"<br>Programme directory is "); sb.append(FileBase.getProgramDirectory());
-				sb.append("<br>Number of details in RAM is "); sb.append(CacheHolder.cachesWithLoadedDetails.size());
-				sb.append(" Max.: ");					sb.append(Global.getPref().maxDetails);
-				sb.append("<br>CacheWolf version: ");		sb.append(Version.getReleaseDetailed());
 				sb.append("<br>");
+				sb.append(MyLocale.getMsg(266, "Font size:"));
+				sb.append(' ');
+				sb.append(f.getSize());
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(267, "Entries in DB:"));
+				sb.append (' ');
+				sb.append(cacheDB.size());
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg (268, "File separator is:"));
+				sb.append (" \"");
+				sb.append(Vm.getProperty("file.separator","def"));
+				sb.append("\"<br>");
+				sb.append(MyLocale.getMsg (269, "Programme directory is:"));
+				sb.append(' ');
+				sb.append(FileBase.getProgramDirectory());
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(270, "Number of details in RAM is"));
+				sb.append(' ');
+				sb.append(CacheHolder.cachesWithLoadedDetails.size());
+				sb.append(' ');
+				sb.append(MyLocale.getMsg(271, "Max.:"));
+				sb.append(' ');
+				sb.append(Global.getPref().maxDetails);
+				sb.append("<br>");
+				sb.append(MyLocale.getMsg(272, "CacheWolf version:"));
+				sb.append(' ');
+				sb.append(Version.getReleaseDetailed());
+				sb.append("<br>");
 				InfoScreen is = new InfoScreen(sb.toString(), "System", false,pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}



From apreisser at mail.berlios.de  Sat Jul 11 14:16:08 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 11 Jul 2009 14:16:08 +0200
Subject: [Cachewolf-svn] r2016 - trunk/src/CacheWolf
Message-ID: <200907111216.n6BCG8Oj004477@sheep.berlios.de>

Author: apreisser
Date: 2009-07-11 14:16:06 +0200 (Sat, 11 Jul 2009)
New Revision: 2016

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Crossbearing: added another parameter-check

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-07-11 12:14:49 UTC (rev 2015)
+++ trunk/src/CacheWolf/Parser.java	2009-07-11 12:16:06 UTC (rev 2016)
@@ -636,7 +636,7 @@
 		if (!isValidCoord(coordinates1)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordinates1);
  		if (!isValidCoord(coordinates2)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordinates2);
 
-		//Check parameters
+		//Check parameters: Range
     	if (degrees1<0 || degrees1>360 || degrees2 < 0 || degrees2 > 360){
     		if (Global.getPref().solverDegMode){
     			err(MyLocale.getMsg(1740,"Crossbearing degrees must be in interval [0;360]"));
@@ -645,7 +645,6 @@
     			err(MyLocale.getMsg(1741,"Crossbearing degrees must be in interval [0;2*PI]"));
     		}
     	}
-
     	double rAN = Global.getPref().solverDegMode ? degrees1 / 180.0
 				* java.lang.Math.PI : degrees1;
 		double rBN = Global.getPref().solverDegMode ? degrees2 / 180.0
@@ -654,7 +653,15 @@
 		CWPoint point1=new CWPoint(coordinates1);
 		CWPoint point2=new CWPoint(coordinates2);
 
-		//Zum besseren Testen ohne Rundungsfehler
+    	//check Parameters: bearings to project must be different from the bearing between point1 and point2
+    	if (degrees1 == degrees2){
+    		double bearing1 = point1.getBearing(point2);
+    		double bearing2 = point1.getBearing(point1);
+    		if (bearing1 == degrees1 || bearing2 == degrees2){
+    			err(MyLocale.getMsg(1740,"Invalid crossbearing angles"));    			
+    		}
+    	}
+
 		CWPoint result2 = crossbearingCalculation(point1, point2, rAN, rBN);
 		return result2.toString();
 	}



From apreisser at mail.berlios.de  Sat Jul 11 14:16:34 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 11 Jul 2009 14:16:34 +0200
Subject: [Cachewolf-svn] r2017 - trunk
Message-ID: <200907111216.n6BCGYrk004526@sheep.berlios.de>

Author: apreisser
Date: 2009-07-11 14:16:33 +0200 (Sat, 11 Jul 2009)
New Revision: 2017

Modified:
   trunk/getRes.sh
Log:
Whitespace in filename prevented xargs to work correctly

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2009-07-11 12:16:06 UTC (rev 2016)
+++ trunk/getRes.sh	2009-07-11 12:16:33 UTC (rev 2017)
@@ -15,6 +15,6 @@
 cp -fa res_noewe/webmapservices/* work/webmapservices/
 cp -fa res_noewe/languages/* work/languages/
 
-find work -type f | xargs chmod 644
-find work -type d | xargs chmod 755
+find work -type f -exec chmod 644 \{\} \;
+find work -type d -exec chmod 755 \{\} \;
 #



From greiol at mail.berlios.de  Sat Jul 11 16:56:29 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sat, 11 Jul 2009 16:56:29 +0200
Subject: [Cachewolf-svn] r2018 - trunk/docs
Message-ID: <200907111456.n6BEuT6B027647@sheep.berlios.de>

Author: greiol
Date: 2009-07-11 16:56:28 +0200 (Sat, 11 Jul 2009)
New Revision: 2018

Added:
   trunk/docs/readme_garminmap.xml
Log:
trying to get familiar with docbook by writing something useful

Added: trunk/docs/readme_garminmap.xml
===================================================================
--- trunk/docs/readme_garminmap.xml	2009-07-11 12:16:33 UTC (rev 2017)
+++ trunk/docs/readme_garminmap.xml	2009-07-11 14:56:28 UTC (rev 2018)
@@ -0,0 +1,106 @@
+<?xml version='1.0' encoding='UTF-8'?>
+<!-- This document was created with Syntext Serna Free. -->
+<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" []>
+<article>
+  <title>Readme: garminmap.xml</title>
+  <abstract>
+    <para>Mit Hilfe der Datei <filename>garminmap.xml</filename> wird f?r den Export von GPX- und OZI-Wegpunktdateien festgelegt wie die Wegpunkte im jeweiligen Programm dargestellt werden. Dar?ber hinaus kann festgelegt werden welche Kategorien und Symbole beim Erzeugen von Custom POI f?r Garmin Handheld Ger?te verwendet werden. Die Datei muss im selben Verzeichnis liegen wie die Date prefs.xml. </para>
+    <para>Dieses Dokument beschreibt nicht die eigentliche Installation der Custom Symbols auf dem Handheld oder in Mapsource.</para>
+  </abstract>
+  <para>In der Datei <filename>Garmin User Symbols.zip</filename> findest du einige Beispiele, die im Folgenden kurz erkl?rt werden sollen.</para>
+  <section>
+    <title>Beispiel: pro Cachetyp ein Symbol</title>
+    <para>Im diesem Beispiel wird einfach jedem Cachetyp ein eigenes Symbol zugeordnet</para>
+    <para><programlisting>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
+&lt;iconmap&gt;
+&lt;icon type=&quot;0&quot; name=&quot;Custom 18&quot; /&gt;
+&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;
+&lt;icon type=&quot;3&quot; name=&quot;Custom 1&quot; /&gt;
+&lt;icon type=&quot;4&quot; name=&quot;Custom 6&quot; /&gt;
+&lt;icon type=&quot;5&quot; name=&quot;Custom 3&quot; /&gt;
+&lt;icon type=&quot;6&quot; name=&quot;Custom 4&quot; /&gt;
+&lt;icon type=&quot;8&quot; name=&quot;Custom 2&quot; /&gt;
+&lt;icon type=&quot;11&quot; name=&quot;Custom 7&quot; /&gt;
+&lt;icon type=&quot;12&quot; name=&quot;Custom 10&quot; /&gt;
+&lt;icon type=&quot;13&quot; name=&quot;Custom 5&quot; /&gt;
+&lt;icon type=&quot;50&quot; name=&quot;Parking Area&quot; /&gt;
+&lt;icon type=&quot;51&quot; name=&quot;Custom 11&quot; /&gt;
+&lt;icon type=&quot;52&quot; name=&quot;Custom 12&quot; /&gt;
+&lt;icon type=&quot;53&quot; name=&quot;Custom 16&quot; /&gt;
+&lt;icon type=&quot;54&quot; name=&quot;Trail Head&quot; /&gt;
+&lt;icon type=&quot;55&quot; name=&quot;Custom 14&quot; /&gt;
+&lt;icon type=&quot;100&quot; name=&quot;Custom 4&quot; /&gt;
+&lt;icon type=&quot;101&quot; name=&quot;Custom 17&quot; /&gt;
+&lt;icon type=&quot;102&quot; name=&quot;Custom 18&quot; /&gt;
+&lt;icon type=&quot;103&quot; name=&quot;Custom 20&quot; /&gt;
+&lt;icon type=&quot;104&quot; name=&quot;Custom 8&quot; /&gt;
+&lt;/iconmap&gt;</programlisting></para>
+    <para>Die Datei <filename>garminmap.xml</filename> beginnt immer mit<programlisting>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
+&lt;iconmap&gt;</programlisting>und endet mit<programlisting>&lt;/iconmap&gt;</programlisting></para>
+    <para>Jede einzelne Zeile beginnt mit <code>&lt;icon</code> und endet mit <code> /&gt;</code>. Bitte das Leerzeichen nicht vergessen, </para>
+    <para>Innerhalb der Zeile finden sich dann Bedingungen und Anweisungen. </para>
+    <para>In unserem Beispiel ist <code>type=&quot;2&quot;</code> eine Bedingung, die auf alle Traditional Caches zutrifft und  <code>name=&quot;Custom 0&quot;</code> die Anweisung die ausgef?hrt wird, wenn die Bedingung erf?llt ist. In diesem Fall wird auf einem Garmin Handheld oder in Mapsource das Benutzerdefinierte Symbol 0 angezeigt. Eine Liste aller Cachetypen findest du im <link linkend="cachetypen">Anhang</link>. </para>
+    <para>Wie die Zeile <programlisting>&lt;icon type=&quot;50&quot; name=&quot;Parking Area&quot; /&gt;</programlisting>zeiget muss man sich bei den anzuzeigenden Symbolen nicht auf die Benutzerdefinierten beschr?nken, sondern kann auch die in jedem Garmin Handheld fest eingebauten Symbole benutzen. Auf diese Weise k?nnen auch Benutzer von Ger?ten die das Anlegen von Benutzerdefinierten Symbolen nicht unterst?tzen von der Garminmap profitieren und zumindest unterschiedliche Symbole darstellen lassen. </para>
+  </section>
+  <section>
+    <title>Beispiel: verkn?pfte Bedingungen</title>
+    <para>Neben der einfach Zuweisung aus dem ersten Beispiel lassen sich mit der <filename>garminmap.xml</filename> auch komplexere Bedingungen f?r die Zuweisung eines Symbols erstellen. Dabei sind folgende Bedingungen m?glich und beliebig kombinierbar:<itemizedlist>
+        <listitem>
+          <para>type= Typ des Caches. F?r m?gliche Werte siehe <link linkend="cachetypen">Liste</link>.</para>
+        </listitem>
+        <listitem>
+          <para>size= Gr??e des Cachebeh?lters. F?r m?gliche Werte siehe <link linkend="cachegroesse">Liste</link></para>
+        </listitem>
+        <listitem>
+          <para>terrain= 10, 15, 20, 25, 30, 35, 40, 45 oder 50. Custom und Additional Waypoints haben keine Gel?ndebewertung</para>
+        </listitem>
+        <listitem>
+          <para>difficulty= 10, 15, 20, 25, 30, 35, 40, 45 oder 50. Custom und Additional Waypoints haben keine Schwierugkeit</para>
+        </listitem>
+        <listitem>
+          <para>found= 1 (gefunden) oder 0 (nicht gefunden). Nicht verwechseln mit status</para>
+        </listitem>
+        <listitem>
+          <para>status= Inhalt des Statusfeldes im Detailspanel. Es wird nur gegen den Anfang des Feldes gepr?ft. status=&quot;Nachr&quot; findet als Nachtcache und Nachtisch!</para>
+        </listitem>
+      </itemizedlist>Wichtig dabei ist, dass die Werte der Bedingungen immer mit doppelten Anf?rungszeichen (&quot;) umschlossen werden.</para>
+  </section>
+  <section>
+    <title>Anhang</title>
+    <section id="cachetypen">
+      <title>Cachetypen</title>
+      <para>Cachtypen werden innerhalb der Bedingungen durch einen Zahlenwert aus der folgenden Tabelle repr?sentiert</para>
+      <programlisting>0 Custom
+2 Traditional
+3 Multicache
+4 Virtual Cache
+5 Letterbox
+6 Event Cache
+8 Unknown / Mystery Cache
+11 Webcam Cache
+12 Locationless (Reverse) Cache
+13 CITO Event
+100 Mega Event
+101 WhereIGo cache
+102 Project Ape Cache
+103 Adventure Maze Exhibit
+104 Earthcache
+50 Additional Waypoint Parking
+51 Additional Waypoint Stage of a Multicache
+52 Additional Waypoint Question to Answer
+53 Additional Waypoint Final
+54 Additional Waypoint Trailhead
+55 Additional Waypoint Reference</programlisting>
+    </section>
+    <section id="cachegroesse">
+      <title>Cachegr??en</title>
+      <para>Cachegr??en werden innerhalb der Bedingungen durch einen Buchstaben aus der folgenden Tabelle repr?sentiert. Ob gro? oder klein geschreiben spielt dabei keine Rolle.</para>
+      <programlisting>m Micro
+s Small
+r Regular
+l Large
+v Very Large
+n Not Chosen / Other / Virtual / None</programlisting>
+    </section>
+  </section>
+</article>



From engywuck at mail.berlios.de  Sun Jul 12 10:13:49 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 12 Jul 2009 10:13:49 +0200
Subject: [Cachewolf-svn] r2019 - trunk/src/CacheWolf
Message-ID: <200907120813.n6C8DnrT000089@sheep.berlios.de>

Author: engywuck
Date: 2009-07-12 10:13:48 +0200 (Sun, 12 Jul 2009)
New Revision: 2019

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Now list of saved filter setting (in filter screen) is (alphabetically) sorted.

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-07-11 14:56:28 UTC (rev 2018)
+++ trunk/src/CacheWolf/Preferences.java	2009-07-12 08:13:48 UTC (rev 2019)
@@ -912,7 +912,7 @@
 	}
 
 	/**
-	 * Returns an array of ID of saved FilterData objects.
+	 * Returns a alphabetically sorted array of ID of saved FilterData objects.
 	 * @return Array of IDs
 	 */
 	public String[] getFilterIDs() {
@@ -923,6 +923,13 @@
 		while (en.hasMoreElements()) {
 			result[i++] = (String) en.nextElement();
 		}
+		// Now sorting the array of filter IDs
+		Comparer comp = new ewe.util.Comparer() {
+			public int compare(Object o1, Object o2) {
+				return ((String) o1).compareTo((String) o2);
+			}
+		};
+		Utils.sort(result, comp, false);
 		return result;
 	}
 	



From greiol at mail.berlios.de  Sun Jul 12 21:52:26 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 12 Jul 2009 21:52:26 +0200
Subject: [Cachewolf-svn] r2020 - trunk/docs
Message-ID: <200907121952.n6CJqQ7G018071@sheep.berlios.de>

Author: greiol
Date: 2009-07-12 21:52:24 +0200 (Sun, 12 Jul 2009)
New Revision: 2020

Added:
   trunk/docs/docbookeditor.html
Removed:
   trunk/docs/XMLmind_XML_Editor.zip
Log:
removed legacy version of XML editor
added information for download of current version and alternatives

Deleted: trunk/docs/XMLmind_XML_Editor.zip
===================================================================
(Binary files differ)

Added: trunk/docs/docbookeditor.html
===================================================================
--- trunk/docs/docbookeditor.html	2009-07-12 08:13:48 UTC (rev 2019)
+++ trunk/docs/docbookeditor.html	2009-07-12 19:52:24 UTC (rev 2020)
@@ -0,0 +1,13 @@
+<?xml version="1.0"  encoding="utf-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title>DocBook Editoren</title>
+<meta http-equiv="content-type" content="text/xhtml; charset=UTF-8" />
+</head>
+<body>
+<p>Die CacheWolf Dokumentation wird im <a href="http://www.docbook.de/whatis.html">DocBook</a> Format geschrieben. Wer schon einmal selber eine HTML Seite erstellt hat, wird bei der Arbeit mit DocBook gewisse Parallelen erkennen. Trotzdem kann man sich mit speziellen Editoren, die DocBook direkt unterst?tzen, das Leben deutlich leichter machen.</p>
+<p>Urspr?nglich wurde im CacheWolf SVN Repository auch ein DocBook Editor f?r Windows mitgef?hrt. Solche Drittsoftware veraltet jedoch recht schnell. Wer weiterhin eine Version von XMLMind benutzen m?chte, kann sich eine aktuelle Version f?r Windows oder Java beim Anbieter <a href="http://www.xmlmind.com/xmleditor/download.shtml">herunterladen</a>. Die Software ist free for non comercial use. Als Alternative bietet sich eventuell auch <a href="http://www.syntext.com/downloads/serna-free/">Serna Free</a> an, der unter GPL steht und neben dem Quelltextdownload auch als fertiges Paket f?r Windows, Mac OS X und Linux zur Verf?gung steht.</p>
+</body>
+</html>
+



From greiol at mail.berlios.de  Sun Jul 12 23:56:44 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 12 Jul 2009 23:56:44 +0200
Subject: [Cachewolf-svn] r2021 - trunk/docs
Message-ID: <200907122156.n6CLuiaS031542@sheep.berlios.de>

Author: greiol
Date: 2009-07-12 23:56:42 +0200 (Sun, 12 Jul 2009)
New Revision: 2021

Modified:
   trunk/docs/readme_garminmap.xml
Log:
added section for ozicolor and poiid

Modified: trunk/docs/readme_garminmap.xml
===================================================================
--- trunk/docs/readme_garminmap.xml	2009-07-12 19:52:24 UTC (rev 2020)
+++ trunk/docs/readme_garminmap.xml	2009-07-12 21:56:42 UTC (rev 2021)
@@ -1,7 +1,6 @@
 <?xml version='1.0' encoding='UTF-8'?>
-<!-- This document was created with Syntext Serna Free. -->
-<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" []>
-<article>
+<!-- This document was created with Syntext Serna Free. --><!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" []>
+<article lang="de">
   <title>Readme: garminmap.xml</title>
   <abstract>
     <para>Mit Hilfe der Datei <filename>garminmap.xml</filename> wird f?r den Export von GPX- und OZI-Wegpunktdateien festgelegt wie die Wegpunkte im jeweiligen Programm dargestellt werden. Dar?ber hinaus kann festgelegt werden welche Kategorien und Symbole beim Erzeugen von Custom POI f?r Garmin Handheld Ger?te verwendet werden. Die Datei muss im selben Verzeichnis liegen wie die Date prefs.xml. </para>
@@ -64,8 +63,42 @@
           <para>status= Inhalt des Statusfeldes im Detailspanel. Es wird nur gegen den Anfang des Feldes gepr?ft. status=&quot;Nachr&quot; findet als Nachtcache und Nachtisch!</para>
         </listitem>
       </itemizedlist>Wichtig dabei ist, dass die Werte der Bedingungen immer mit doppelten Anf?rungszeichen (&quot;) umschlossen werden.</para>
+    <para><programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;</programlisting>weist allen caches vom Typ 2 (Traditional) und der Gel?ndewertung 50 (5) das Symbol mit dem Namen zu.</para>
+    <para>Weil man h?ufig auch f?r Gel?nde 4.5 eine erweitere Ausr?stung braucht, k?nnte man das auch wie folgt erg?mzen <programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;</programlisting></para>
+    <para>Damit alle anderen Tradis auch ein Symbol bekommen, k?nnte die komplette Sequenz f?r Tradis dann so aussehen:<programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;</programlisting>Alle Traids mit Gel?nde 5 oder 4.5 bekommen das Symbol XXXX alle ?brigen Tradis das Symbol Custom 0. Du kannst in einer Reihe beliebig viele Bedingungen benutzen. Die Reihen werden dabei in der Reihenfolge abgearbeitet in der sie in der datei stehen. Die Reihen mit komplexeren Bedingungen sollten also immer vor den einfachen Regeln stehen. Bei einem Eintrag von <programlisting>&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;</programlisting>w?rden die speziellen Regeln f?r das Gel?nde nie benutzt werden, da alle Tradis bereits von der ersten Regel erfasst w?rden.</para>
   </section>
   <section>
+    <title>Beispiel: OZI Export</title>
+    <para>Die Datei <filename>garminmap.xml</filename> kann auch zusammen mit dem OZI Export benutzt werden. In dem Fall heisst die Anweisung aber nicht <code>name=&quot;&quot;</code> sondern <code>ozicolor=&quot;&quot;</code>. Dabei steht ozicolor f?r die verwendete Hintergrundfarbe bei der Darstellung. Die Vordergrundfarbe ist immer Schwarz.</para>
+    <para>Ein Traditional Cache k?nnte durch folgende Regel dargestellt werden: <programlisting>&lt;icon type=&quot;2&quot; ozicolor=&quot;65280&quot; /&gt;</programlisting></para>
+    <para>Ein Traditional w?rde also in Gr?n dargestellt, denn alle Farbangaben sind die Dezimalschreibweisen der eigentlich hexadezimalen RGB Farben. 65280 entspricht dabei dem Farbcode 00FF00.</para>
+    <para>Im Internet findest du zahlreiche RGB Farbtabellen aus denen du dir die Farben mit denen deine Wegpunkte dargestellt werden sollen aussuchen kannst. Mit dem Taschenrechner, den dein Betriebssystem mitliefert, k?nnen die dort angegeben Hexadezimalwerte meist bequem in das dezimale Format umgerechnet werden. Versuche Farben zu verwenden, die sich gut unterscheiden lassen.</para>
+    <para>Genauso wie Bedingungen verkn?pft werden k?nnen, k?nnen auch Anweisungen verkn?pft werden. Solltest du also eine angepasste Darstellung f?r Garmin und Ozi haben wollen, ben?tigst du nicht zwei verschiedene Dateien, sondern kannst beides in einer einzigen Datei festlegen. F?r den Traditional Cache aus unserem Beispiel k?nnte das dann so aussehen: <programlisting>&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; ozicolor=&quot;65280&quot; /&gt;</programlisting></para>
+  </section>
+  <section>
+    <title>Beispiel: Garmin POI (GPI)</title>
+    <para>Zuammen mit dem experimentellen GPX Exporter kann die <filename>garminmap.xml</filename> auch verwendet werden um Einzeldateien f?r den Gramin POI Loader oder diekt GPI dateien f?r die Verwendung auf dem Garmin Handheld zu erzeugen. Dazu wurde die Anweisung <code>poiid=&quot;&quot;</code> eingef?hrt.</para>
+    <important>
+      <para>Nicht alle Garmin Handhelds unterst?tzen die Verwendung von Custom Points of Interest. Bitte schau im Handbuch deines Ger?tes nach, ob die Funktion unterst?tzt wird bevor du sie benutzt.</para>
+    </important>
+    <para>Bei der <code>poiid</code> handelt es sich um einen Freitext der von dir individuell festgelegt werden kann. Da einige Garmin Handhelds jedoch Schwierigkeiten bei der Darstellung von Sonderzeichen haben, solltest du dich bei der Vergabe der ID auf die Zeichen A-z, a-z, 0-9, sowie - und _ beschr?nken.</para>
+    <para><programlisting>&lt;icon type=&quot;2&quot; poiid=&quot;Traditional&quot; /&gt;</programlisting>k?nnte also eine Regel sein, die festlegt wie w?hrend eines POI Exports Traditional Caches behandelt werden. Nat?rlich lassen sich auch hier wieder die verschiednen Anweisungen kombinieren, so da? eine solche Regle auch so aussehen k?nnte: <programlisting>&lt;icon type=&quot;2&quot; poiid=&quot;Traditional&quot; ozicolor=&quot;65280&quot; name=&quot;Custom 0&quot; /&gt;</programlisting></para>
+    <para>Beim Export wird der vergebenen ID noch ein Prefix vorangestellt, welche du im Exportdialog vergibst. Prefix und <code>piid</code> sollten gemeinsam auf das Display deines Handhelds passen. </para>
+    <section>
+      <title>Garmin POI Loader</title>
+      <para>Sofern du den Garmin POI Loader benutzen m?chtest um deine Wegpunkte sp?ter auf den Handheld zu laden, musst du nichts weiter tun. Der Exporter wird im angegebenen Verzeichnis Dateien mit dem Namen <code>Prefix-PoiId.gpx</code> erzuegen, die du weiterverarbeiten kannst.</para>
+    </section>
+    <section>
+      <title>GPI Dateien erzeugen</title>
+      <para>Garmin GPI Dateien enthalten neben den Wegpunktinformationen immer auch eine Grafik mit der der Wegpunkt auf dem Bildschirm dargestellt wird.  Damit eine korrekte GPI Datei erzeugt werden kann, muss in dem Verzeichnis in dem die <filename>garminmap.xml</filename> liegt auch noch eine Datei mit dem Namen <filename>GarminPOI.zip</filename> existieren. In dieser Datei muss sich zu jeder von dir vergebenen <code>poiid</code> eine Datei mit dem Namen <filename>poiid.bmp</filename> befinden. Lautet eine deiner Anweisungen  <code>poiid=&quot;Traditional&quot;</code> muss sich in der <filename>GarminPOI.zip</filename>   eine <filename>Traditional.bmp</filename> befinden.</para>
+    </section>
+  </section>
+  <section>
     <title>Anhang</title>
     <section id="cachetypen">
       <title>Cachetypen</title>



From greiol at mail.berlios.de  Mon Jul 13 08:19:19 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 13 Jul 2009 08:19:19 +0200
Subject: [Cachewolf-svn] r2022 - trunk/src/exp
Message-ID: <200907130619.n6D6JJJM026049@sheep.berlios.de>

Author: greiol
Date: 2009-07-13 08:19:16 +0200 (Mon, 13 Jul 2009)
New Revision: 2022

Modified:
   trunk/src/exp/GpxExportNg.java
   trunk/src/exp/LocExporter.java
Log:
one GarminMap class is just enough

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-12 21:56:42 UTC (rev 2021)
+++ trunk/src/exp/GpxExportNg.java	2009-07-13 06:19:16 UTC (rev 2022)
@@ -55,9 +55,7 @@
 
 /**
  * experimental GPX exporter that should better handle the various tasks that
- * can be accomplished with GPX it is not yet linked to any menu, so if you want
- * to play around with it, first you have to create a menu item
- * 
+ * can be accomplished with GPX
  */
 public class GpxExportNg {
 

Modified: trunk/src/exp/LocExporter.java
===================================================================
--- trunk/src/exp/LocExporter.java	2009-07-12 21:56:42 UTC (rev 2021)
+++ trunk/src/exp/LocExporter.java	2009-07-13 06:19:16 UTC (rev 2022)
@@ -85,83 +85,4 @@
 	public String trailer(){
 		return "</loc>\r\n";
 	}
-
-	/**
-	 * This class implements user defined icons which depend on the cache type and the found status.
-	 * See also http://www.geoclub.de/ftopic10413.html
-	 * @author salzkammergut
-	 *
-	 */
-	private class GarminMap extends MinML {
-
-		private Vector symbols=new Vector(24);
-
-		String lastName;
-		public void readGarminMap(){
-			try{
-				String datei = FileBase.getProgramDirectory() + "/garminmap.xml";
-				ewe.io.Reader r = new ewe.io.InputStreamReader(new ewe.io.FileInputStream(datei));
-				parse(r);
-				r.close();
-			}catch(Exception e){
-				if (e instanceof NullPointerException)
-					Global.getPref().log("Error reading garminmap.xml: NullPointerException in Element "+lastName +". Wrong attribute?",e,true);
-				else
-					Global.getPref().log("Error reading garminmap.xml: ", e);
-			}
-		}
-		public void startElement(String name, AttributeList atts){
-			lastName=name;
-			if (name.equals("icon")) {
-				symbols.add(new IconMap(atts.getValue("type"),atts.getValue("name"),atts.getValue("found"),
-						atts.getValue("size"),atts.getValue("terrain"),atts.getValue("difficulty"),
-						atts.getValue("status")));
-			}
-		}
-
-		public String getIcon(CacheHolder ch) {
-			int mapSize=symbols.size();
-			// Try each icon in turn
-			for (int i=0; i<mapSize; i++) {
-				IconMap icon=(IconMap) symbols.get(i);
-				boolean match=true;
-				// If a certainattribute is not null it must match the current caches values
-				match=match && ((icon.type==null) || ch.getType()==0 || icon.type.equals(String.valueOf(ch.getType())));
-				match=match && ((icon.size==null) || ch.getCacheSize()==0 || icon.size.equalsIgnoreCase(CacheSize.getExportShortId(ch.getCacheSize())));
-				match=match && ((icon.terrain==null) || ch.getTerrain()==0 || icon.terrain.equals(CacheTerrDiff.shortDT(ch.getTerrain())));
-				match=match && ((icon.difficulty==null) ||  ch.getHard()==0 || icon.difficulty.equals(CacheTerrDiff.shortDT(ch.getHard())));
-				match=match && ((icon.status==null) ||  ch.getCacheStatus().startsWith(icon.status));
-				match=match && ((icon.found==null) || ch.is_found());
-				if (match) return icon.name;
-			}
-
-			// If it is not a mapped type, just use the standard mapping
-			if (ch.is_found())
-				return "Geocache Found";
-			else
-				return "Geocache";
-		}
-
-		private class IconMap {
-			public String type;
-			public String name;
-			public String size;
-			public String terrain;
-			public String difficulty;
-			public String found;
-			public String status;
-
-			IconMap(String type, String name, String found, String size, String terrain, String difficulty, String status) {
-				this.type=type;
-				this.name=name;
-				this.found=found;
-				this.size=size;
-				this.terrain=terrain;
-				this.difficulty=difficulty;
-				this.status=status;
-			}
-		}
-
-	}
-
 }



From mik77 at mail.berlios.de  Mon Jul 13 11:51:33 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 13 Jul 2009 11:51:33 +0200
Subject: [Cachewolf-svn] r2023 - trunk/docs
Message-ID: <200907130951.n6D9pXiv012161@sheep.berlios.de>

Author: mik77
Date: 2009-07-13 11:51:27 +0200 (Mon, 13 Jul 2009)
New Revision: 2023

Modified:
   trunk/docs/readme_garminmap.xml
Log:
 some typos fixed

Modified: trunk/docs/readme_garminmap.xml
===================================================================
--- trunk/docs/readme_garminmap.xml	2009-07-13 06:19:16 UTC (rev 2022)
+++ trunk/docs/readme_garminmap.xml	2009-07-13 09:51:27 UTC (rev 2023)
@@ -1,139 +1,139 @@
-<?xml version='1.0' encoding='UTF-8'?>
-<!-- This document was created with Syntext Serna Free. --><!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" []>
-<article lang="de">
-  <title>Readme: garminmap.xml</title>
-  <abstract>
-    <para>Mit Hilfe der Datei <filename>garminmap.xml</filename> wird f?r den Export von GPX- und OZI-Wegpunktdateien festgelegt wie die Wegpunkte im jeweiligen Programm dargestellt werden. Dar?ber hinaus kann festgelegt werden welche Kategorien und Symbole beim Erzeugen von Custom POI f?r Garmin Handheld Ger?te verwendet werden. Die Datei muss im selben Verzeichnis liegen wie die Date prefs.xml. </para>
-    <para>Dieses Dokument beschreibt nicht die eigentliche Installation der Custom Symbols auf dem Handheld oder in Mapsource.</para>
-  </abstract>
-  <para>In der Datei <filename>Garmin User Symbols.zip</filename> findest du einige Beispiele, die im Folgenden kurz erkl?rt werden sollen.</para>
-  <section>
-    <title>Beispiel: pro Cachetyp ein Symbol</title>
-    <para>Im diesem Beispiel wird einfach jedem Cachetyp ein eigenes Symbol zugeordnet</para>
-    <para><programlisting>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
-&lt;iconmap&gt;
-&lt;icon type=&quot;0&quot; name=&quot;Custom 18&quot; /&gt;
-&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;
-&lt;icon type=&quot;3&quot; name=&quot;Custom 1&quot; /&gt;
-&lt;icon type=&quot;4&quot; name=&quot;Custom 6&quot; /&gt;
-&lt;icon type=&quot;5&quot; name=&quot;Custom 3&quot; /&gt;
-&lt;icon type=&quot;6&quot; name=&quot;Custom 4&quot; /&gt;
-&lt;icon type=&quot;8&quot; name=&quot;Custom 2&quot; /&gt;
-&lt;icon type=&quot;11&quot; name=&quot;Custom 7&quot; /&gt;
-&lt;icon type=&quot;12&quot; name=&quot;Custom 10&quot; /&gt;
-&lt;icon type=&quot;13&quot; name=&quot;Custom 5&quot; /&gt;
-&lt;icon type=&quot;50&quot; name=&quot;Parking Area&quot; /&gt;
-&lt;icon type=&quot;51&quot; name=&quot;Custom 11&quot; /&gt;
-&lt;icon type=&quot;52&quot; name=&quot;Custom 12&quot; /&gt;
-&lt;icon type=&quot;53&quot; name=&quot;Custom 16&quot; /&gt;
-&lt;icon type=&quot;54&quot; name=&quot;Trail Head&quot; /&gt;
-&lt;icon type=&quot;55&quot; name=&quot;Custom 14&quot; /&gt;
-&lt;icon type=&quot;100&quot; name=&quot;Custom 4&quot; /&gt;
-&lt;icon type=&quot;101&quot; name=&quot;Custom 17&quot; /&gt;
-&lt;icon type=&quot;102&quot; name=&quot;Custom 18&quot; /&gt;
-&lt;icon type=&quot;103&quot; name=&quot;Custom 20&quot; /&gt;
-&lt;icon type=&quot;104&quot; name=&quot;Custom 8&quot; /&gt;
-&lt;/iconmap&gt;</programlisting></para>
-    <para>Die Datei <filename>garminmap.xml</filename> beginnt immer mit<programlisting>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
-&lt;iconmap&gt;</programlisting>und endet mit<programlisting>&lt;/iconmap&gt;</programlisting></para>
-    <para>Jede einzelne Zeile beginnt mit <code>&lt;icon</code> und endet mit <code> /&gt;</code>. Bitte das Leerzeichen nicht vergessen, </para>
-    <para>Innerhalb der Zeile finden sich dann Bedingungen und Anweisungen. </para>
-    <para>In unserem Beispiel ist <code>type=&quot;2&quot;</code> eine Bedingung, die auf alle Traditional Caches zutrifft und  <code>name=&quot;Custom 0&quot;</code> die Anweisung die ausgef?hrt wird, wenn die Bedingung erf?llt ist. In diesem Fall wird auf einem Garmin Handheld oder in Mapsource das Benutzerdefinierte Symbol 0 angezeigt. Eine Liste aller Cachetypen findest du im <link linkend="cachetypen">Anhang</link>. </para>
-    <para>Wie die Zeile <programlisting>&lt;icon type=&quot;50&quot; name=&quot;Parking Area&quot; /&gt;</programlisting>zeiget muss man sich bei den anzuzeigenden Symbolen nicht auf die Benutzerdefinierten beschr?nken, sondern kann auch die in jedem Garmin Handheld fest eingebauten Symbole benutzen. Auf diese Weise k?nnen auch Benutzer von Ger?ten die das Anlegen von Benutzerdefinierten Symbolen nicht unterst?tzen von der Garminmap profitieren und zumindest unterschiedliche Symbole darstellen lassen. </para>
-  </section>
-  <section>
-    <title>Beispiel: verkn?pfte Bedingungen</title>
-    <para>Neben der einfach Zuweisung aus dem ersten Beispiel lassen sich mit der <filename>garminmap.xml</filename> auch komplexere Bedingungen f?r die Zuweisung eines Symbols erstellen. Dabei sind folgende Bedingungen m?glich und beliebig kombinierbar:<itemizedlist>
-        <listitem>
-          <para>type= Typ des Caches. F?r m?gliche Werte siehe <link linkend="cachetypen">Liste</link>.</para>
-        </listitem>
-        <listitem>
-          <para>size= Gr??e des Cachebeh?lters. F?r m?gliche Werte siehe <link linkend="cachegroesse">Liste</link></para>
-        </listitem>
-        <listitem>
-          <para>terrain= 10, 15, 20, 25, 30, 35, 40, 45 oder 50. Custom und Additional Waypoints haben keine Gel?ndebewertung</para>
-        </listitem>
-        <listitem>
-          <para>difficulty= 10, 15, 20, 25, 30, 35, 40, 45 oder 50. Custom und Additional Waypoints haben keine Schwierugkeit</para>
-        </listitem>
-        <listitem>
-          <para>found= 1 (gefunden) oder 0 (nicht gefunden). Nicht verwechseln mit status</para>
-        </listitem>
-        <listitem>
-          <para>status= Inhalt des Statusfeldes im Detailspanel. Es wird nur gegen den Anfang des Feldes gepr?ft. status=&quot;Nachr&quot; findet als Nachtcache und Nachtisch!</para>
-        </listitem>
-      </itemizedlist>Wichtig dabei ist, dass die Werte der Bedingungen immer mit doppelten Anf?rungszeichen (&quot;) umschlossen werden.</para>
-    <para><programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;</programlisting>weist allen caches vom Typ 2 (Traditional) und der Gel?ndewertung 50 (5) das Symbol mit dem Namen zu.</para>
-    <para>Weil man h?ufig auch f?r Gel?nde 4.5 eine erweitere Ausr?stung braucht, k?nnte man das auch wie folgt erg?mzen <programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
-&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;</programlisting></para>
-    <para>Damit alle anderen Tradis auch ein Symbol bekommen, k?nnte die komplette Sequenz f?r Tradis dann so aussehen:<programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
-&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;
-&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;</programlisting>Alle Traids mit Gel?nde 5 oder 4.5 bekommen das Symbol XXXX alle ?brigen Tradis das Symbol Custom 0. Du kannst in einer Reihe beliebig viele Bedingungen benutzen. Die Reihen werden dabei in der Reihenfolge abgearbeitet in der sie in der datei stehen. Die Reihen mit komplexeren Bedingungen sollten also immer vor den einfachen Regeln stehen. Bei einem Eintrag von <programlisting>&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;
-&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
-&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;</programlisting>w?rden die speziellen Regeln f?r das Gel?nde nie benutzt werden, da alle Tradis bereits von der ersten Regel erfasst w?rden.</para>
-  </section>
-  <section>
-    <title>Beispiel: OZI Export</title>
-    <para>Die Datei <filename>garminmap.xml</filename> kann auch zusammen mit dem OZI Export benutzt werden. In dem Fall heisst die Anweisung aber nicht <code>name=&quot;&quot;</code> sondern <code>ozicolor=&quot;&quot;</code>. Dabei steht ozicolor f?r die verwendete Hintergrundfarbe bei der Darstellung. Die Vordergrundfarbe ist immer Schwarz.</para>
-    <para>Ein Traditional Cache k?nnte durch folgende Regel dargestellt werden: <programlisting>&lt;icon type=&quot;2&quot; ozicolor=&quot;65280&quot; /&gt;</programlisting></para>
-    <para>Ein Traditional w?rde also in Gr?n dargestellt, denn alle Farbangaben sind die Dezimalschreibweisen der eigentlich hexadezimalen RGB Farben. 65280 entspricht dabei dem Farbcode 00FF00.</para>
-    <para>Im Internet findest du zahlreiche RGB Farbtabellen aus denen du dir die Farben mit denen deine Wegpunkte dargestellt werden sollen aussuchen kannst. Mit dem Taschenrechner, den dein Betriebssystem mitliefert, k?nnen die dort angegeben Hexadezimalwerte meist bequem in das dezimale Format umgerechnet werden. Versuche Farben zu verwenden, die sich gut unterscheiden lassen.</para>
-    <para>Genauso wie Bedingungen verkn?pft werden k?nnen, k?nnen auch Anweisungen verkn?pft werden. Solltest du also eine angepasste Darstellung f?r Garmin und Ozi haben wollen, ben?tigst du nicht zwei verschiedene Dateien, sondern kannst beides in einer einzigen Datei festlegen. F?r den Traditional Cache aus unserem Beispiel k?nnte das dann so aussehen: <programlisting>&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; ozicolor=&quot;65280&quot; /&gt;</programlisting></para>
-  </section>
-  <section>
-    <title>Beispiel: Garmin POI (GPI)</title>
-    <para>Zuammen mit dem experimentellen GPX Exporter kann die <filename>garminmap.xml</filename> auch verwendet werden um Einzeldateien f?r den Gramin POI Loader oder diekt GPI dateien f?r die Verwendung auf dem Garmin Handheld zu erzeugen. Dazu wurde die Anweisung <code>poiid=&quot;&quot;</code> eingef?hrt.</para>
-    <important>
-      <para>Nicht alle Garmin Handhelds unterst?tzen die Verwendung von Custom Points of Interest. Bitte schau im Handbuch deines Ger?tes nach, ob die Funktion unterst?tzt wird bevor du sie benutzt.</para>
-    </important>
-    <para>Bei der <code>poiid</code> handelt es sich um einen Freitext der von dir individuell festgelegt werden kann. Da einige Garmin Handhelds jedoch Schwierigkeiten bei der Darstellung von Sonderzeichen haben, solltest du dich bei der Vergabe der ID auf die Zeichen A-z, a-z, 0-9, sowie - und _ beschr?nken.</para>
-    <para><programlisting>&lt;icon type=&quot;2&quot; poiid=&quot;Traditional&quot; /&gt;</programlisting>k?nnte also eine Regel sein, die festlegt wie w?hrend eines POI Exports Traditional Caches behandelt werden. Nat?rlich lassen sich auch hier wieder die verschiednen Anweisungen kombinieren, so da? eine solche Regle auch so aussehen k?nnte: <programlisting>&lt;icon type=&quot;2&quot; poiid=&quot;Traditional&quot; ozicolor=&quot;65280&quot; name=&quot;Custom 0&quot; /&gt;</programlisting></para>
-    <para>Beim Export wird der vergebenen ID noch ein Prefix vorangestellt, welche du im Exportdialog vergibst. Prefix und <code>piid</code> sollten gemeinsam auf das Display deines Handhelds passen. </para>
-    <section>
-      <title>Garmin POI Loader</title>
-      <para>Sofern du den Garmin POI Loader benutzen m?chtest um deine Wegpunkte sp?ter auf den Handheld zu laden, musst du nichts weiter tun. Der Exporter wird im angegebenen Verzeichnis Dateien mit dem Namen <code>Prefix-PoiId.gpx</code> erzuegen, die du weiterverarbeiten kannst.</para>
-    </section>
-    <section>
-      <title>GPI Dateien erzeugen</title>
-      <para>Garmin GPI Dateien enthalten neben den Wegpunktinformationen immer auch eine Grafik mit der der Wegpunkt auf dem Bildschirm dargestellt wird.  Damit eine korrekte GPI Datei erzeugt werden kann, muss in dem Verzeichnis in dem die <filename>garminmap.xml</filename> liegt auch noch eine Datei mit dem Namen <filename>GarminPOI.zip</filename> existieren. In dieser Datei muss sich zu jeder von dir vergebenen <code>poiid</code> eine Datei mit dem Namen <filename>poiid.bmp</filename> befinden. Lautet eine deiner Anweisungen  <code>poiid=&quot;Traditional&quot;</code> muss sich in der <filename>GarminPOI.zip</filename>   eine <filename>Traditional.bmp</filename> befinden.</para>
-    </section>
-  </section>
-  <section>
-    <title>Anhang</title>
-    <section id="cachetypen">
-      <title>Cachetypen</title>
-      <para>Cachtypen werden innerhalb der Bedingungen durch einen Zahlenwert aus der folgenden Tabelle repr?sentiert</para>
-      <programlisting>0 Custom
-2 Traditional
-3 Multicache
-4 Virtual Cache
-5 Letterbox
-6 Event Cache
-8 Unknown / Mystery Cache
-11 Webcam Cache
-12 Locationless (Reverse) Cache
-13 CITO Event
-100 Mega Event
-101 WhereIGo cache
-102 Project Ape Cache
-103 Adventure Maze Exhibit
-104 Earthcache
-50 Additional Waypoint Parking
-51 Additional Waypoint Stage of a Multicache
-52 Additional Waypoint Question to Answer
-53 Additional Waypoint Final
-54 Additional Waypoint Trailhead
-55 Additional Waypoint Reference</programlisting>
-    </section>
-    <section id="cachegroesse">
-      <title>Cachegr??en</title>
-      <para>Cachegr??en werden innerhalb der Bedingungen durch einen Buchstaben aus der folgenden Tabelle repr?sentiert. Ob gro? oder klein geschreiben spielt dabei keine Rolle.</para>
-      <programlisting>m Micro
-s Small
-r Regular
-l Large
-v Very Large
-n Not Chosen / Other / Virtual / None</programlisting>
-    </section>
-  </section>
-</article>
+<?xml version='1.0' encoding='UTF-8'?>
+<!-- This document was created with Syntext Serna Free. --><!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" []>
+<article lang="de">
+  <title>Readme: garminmap.xml</title>
+  <abstract>
+    <para>Mit Hilfe der Datei <filename>garminmap.xml</filename> wird f?r den Export von GPX- und OZI-Wegpunktdateien festgelegt wie die Wegpunkte im jeweiligen Programm dargestellt werden. Dar?ber hinaus kann festgelegt werden welche Kategorien und Symbole beim Erzeugen von Custom POI f?r Garmin Handheld Ger?te verwendet werden. Die Datei muss im selben Verzeichnis liegen wie die Datei prefs.xml. </para>
+    <para>Dieses Dokument beschreibt nicht die eigentliche Installation der Custom Symbols auf dem Handheld oder in Mapsource.</para>
+  </abstract>
+  <para>In der Datei <filename>Garmin User Symbols.zip</filename> findest du einige Beispiele, die im Folgenden kurz erkl?rt werden sollen.</para>
+  <section>
+    <title>Beispiel: pro Cachetyp ein Symbol</title>
+    <para>Im diesem Beispiel wird einfach jedem Cachetyp ein eigenes Symbol zugeordnet</para>
+    <para><programlisting>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
+&lt;iconmap&gt;
+&lt;icon type=&quot;0&quot; name=&quot;Custom 18&quot; /&gt;
+&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;
+&lt;icon type=&quot;3&quot; name=&quot;Custom 1&quot; /&gt;
+&lt;icon type=&quot;4&quot; name=&quot;Custom 6&quot; /&gt;
+&lt;icon type=&quot;5&quot; name=&quot;Custom 3&quot; /&gt;
+&lt;icon type=&quot;6&quot; name=&quot;Custom 4&quot; /&gt;
+&lt;icon type=&quot;8&quot; name=&quot;Custom 2&quot; /&gt;
+&lt;icon type=&quot;11&quot; name=&quot;Custom 7&quot; /&gt;
+&lt;icon type=&quot;12&quot; name=&quot;Custom 10&quot; /&gt;
+&lt;icon type=&quot;13&quot; name=&quot;Custom 5&quot; /&gt;
+&lt;icon type=&quot;50&quot; name=&quot;Parking Area&quot; /&gt;
+&lt;icon type=&quot;51&quot; name=&quot;Custom 11&quot; /&gt;
+&lt;icon type=&quot;52&quot; name=&quot;Custom 12&quot; /&gt;
+&lt;icon type=&quot;53&quot; name=&quot;Custom 16&quot; /&gt;
+&lt;icon type=&quot;54&quot; name=&quot;Trail Head&quot; /&gt;
+&lt;icon type=&quot;55&quot; name=&quot;Custom 14&quot; /&gt;
+&lt;icon type=&quot;100&quot; name=&quot;Custom 4&quot; /&gt;
+&lt;icon type=&quot;101&quot; name=&quot;Custom 17&quot; /&gt;
+&lt;icon type=&quot;102&quot; name=&quot;Custom 18&quot; /&gt;
+&lt;icon type=&quot;103&quot; name=&quot;Custom 20&quot; /&gt;
+&lt;icon type=&quot;104&quot; name=&quot;Custom 8&quot; /&gt;
+&lt;/iconmap&gt;</programlisting></para>
+    <para>Die Datei <filename>garminmap.xml</filename> beginnt immer mit<programlisting>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
+&lt;iconmap&gt;</programlisting>und endet mit<programlisting>&lt;/iconmap&gt;</programlisting></para>
+    <para>Jede einzelne Zeile beginnt mit <code>&lt;icon</code> und endet mit <code> /&gt;</code>. Bitte das Leerzeichen nicht vergessen, </para>
+    <para>Innerhalb der Zeile finden sich dann Bedingungen und Anweisungen. </para>
+    <para>In unserem Beispiel ist <code>type=&quot;2&quot;</code> eine Bedingung, die auf alle Traditional Caches zutrifft und  <code>name=&quot;Custom 0&quot;</code> die Anweisung die ausgef?hrt wird, wenn die Bedingung erf?llt ist. In diesem Fall wird auf einem Garmin Handheld oder in Mapsource das Benutzerdefinierte Symbol 0 angezeigt. Eine Liste aller Cachetypen findest du im <link linkend="cachetypen">Anhang</link>. </para>
+    <para>Wie die Zeile <programlisting>&lt;icon type=&quot;50&quot; name=&quot;Parking Area&quot; /&gt;</programlisting>zeiget muss man sich bei den anzuzeigenden Symbolen nicht auf die Benutzerdefinierten beschr?nken, sondern kann auch die in jedem Garmin Handheld fest eingebauten Symbole benutzen. Auf diese Weise k?nnen auch Benutzer von Ger?ten die das Anlegen von Benutzerdefinierten Symbolen nicht unterst?tzen von der Garminmap profitieren und zumindest unterschiedliche Symbole darstellen lassen. </para>
+  </section>
+  <section>
+    <title>Beispiel: verkn?pfte Bedingungen</title>
+    <para>Neben der einfach Zuweisung aus dem ersten Beispiel lassen sich mit der <filename>garminmap.xml</filename> auch komplexere Bedingungen f?r die Zuweisung eines Symbols erstellen. Dabei sind folgende Bedingungen m?glich und beliebig kombinierbar:<itemizedlist>
+        <listitem>
+          <para>type= Typ des Caches. F?r m?gliche Werte siehe <link linkend="cachetypen">Liste</link>.</para>
+        </listitem>
+        <listitem>
+          <para>size= Gr??e des Cachebeh?lters. F?r m?gliche Werte siehe <link linkend="cachegroesse">Liste</link></para>
+        </listitem>
+        <listitem>
+          <para>terrain= 10, 15, 20, 25, 30, 35, 40, 45 oder 50. Custom und Additional Waypoints haben keine Gel?ndebewertung</para>
+        </listitem>
+        <listitem>
+          <para>difficulty= 10, 15, 20, 25, 30, 35, 40, 45 oder 50. Custom und Additional Waypoints haben keine Schwierugkeit</para>
+        </listitem>
+        <listitem>
+          <para>found= 1 (gefunden) oder 0 (nicht gefunden). Nicht verwechseln mit status</para>
+        </listitem>
+        <listitem>
+          <para>status= Inhalt des Statusfeldes im Detailspanel. Es wird nur gegen den Anfang des Feldes gepr?ft. status=&quot;Nacht&quot; findet als Nachtcache und Nachtisch!</para>
+        </listitem>
+      </itemizedlist>Wichtig dabei ist, dass die Werte der Bedingungen immer mit doppelten Anf?rungszeichen (&quot;) umschlossen werden.</para>
+    <para><programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;</programlisting>weist allen caches vom Typ 2 (Traditional) und der Gel?ndewertung 50 (5) das Symbol mit dem Namen zu.</para>
+    <para>Weil man h?ufig auch f?r Gel?nde 4.5 eine erweitere Ausr?stung braucht, k?nnte man das auch wie folgt erg?mzen <programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;</programlisting></para>
+    <para>Damit alle anderen Tradis auch ein Symbol bekommen, k?nnte die komplette Sequenz f?r Tradis dann so aussehen:<programlisting>&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;</programlisting>Alle Traids mit Gel?nde 5 oder 4.5 bekommen das Symbol XXXX alle ?brigen Tradis das Symbol Custom 0. Du kannst in einer Reihe beliebig viele Bedingungen benutzen. Die Reihen werden dabei in der Reihenfolge abgearbeitet in der sie in der datei stehen. Die Reihen mit komplexeren Bedingungen sollten also immer vor den einfachen Regeln stehen. Bei einem Eintrag von <programlisting>&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;50&quot; name=&quot;XXXX&quot; /&gt;
+&lt;icon type=&quot;2&quot; terrain=&quot;45&quot; name=&quot;XXXX&quot; /&gt;</programlisting>w?rden die speziellen Regeln f?r das Gel?nde nie benutzt werden, da alle Tradis bereits von der ersten Regel erfasst w?rden.</para>
+  </section>
+  <section>
+    <title>Beispiel: OZI Export</title>
+    <para>Die Datei <filename>garminmap.xml</filename> kann auch zusammen mit dem OZI Export benutzt werden. In dem Fall heisst die Anweisung aber nicht <code>name=&quot;&quot;</code> sondern <code>ozicolor=&quot;&quot;</code>. Dabei steht ozicolor f?r die verwendete Hintergrundfarbe bei der Darstellung. Die Vordergrundfarbe ist immer Schwarz.</para>
+    <para>Ein Traditional Cache k?nnte durch folgende Regel dargestellt werden: <programlisting>&lt;icon type=&quot;2&quot; ozicolor=&quot;65280&quot; /&gt;</programlisting></para>
+    <para>Ein Traditional w?rde also in Gr?n dargestellt, denn alle Farbangaben sind die Dezimalschreibweisen der eigentlich hexadezimalen RGB Farben. 65280 entspricht dabei dem Farbcode 00FF00.</para>
+    <para>Im Internet findest du zahlreiche RGB Farbtabellen aus denen du dir die Farben mit denen deine Wegpunkte dargestellt werden sollen aussuchen kannst. Mit dem Taschenrechner, den dein Betriebssystem mitliefert, k?nnen die dort angegeben Hexadezimalwerte meist bequem in das dezimale Format umgerechnet werden. Versuche Farben zu verwenden, die sich gut unterscheiden lassen.</para>
+    <para>Genauso wie Bedingungen verkn?pft werden k?nnen, k?nnen auch Anweisungen verkn?pft werden. Solltest du also eine angepasste Darstellung f?r Garmin und Ozi haben wollen, ben?tigst du nicht zwei verschiedene Dateien, sondern kannst beides in einer einzigen Datei festlegen. F?r den Traditional Cache aus unserem Beispiel k?nnte das dann so aussehen: <programlisting>&lt;icon type=&quot;2&quot; name=&quot;Custom 0&quot; ozicolor=&quot;65280&quot; /&gt;</programlisting></para>
+  </section>
+  <section>
+    <title>Beispiel: Garmin POI (GPI)</title>
+    <para>Zuammen mit dem experimentellen GPX Exporter kann die <filename>garminmap.xml</filename> auch verwendet werden um Einzeldateien f?r den Gramin POI Loader oder diekt GPI dateien f?r die Verwendung auf dem Garmin Handheld zu erzeugen. Dazu wurde die Anweisung <code>poiid=&quot;&quot;</code> eingef?hrt.</para>
+    <important>
+      <para>Nicht alle Garmin Handhelds unterst?tzen die Verwendung von Custom Points of Interest. Bitte schau im Handbuch deines Ger?tes nach, ob die Funktion unterst?tzt wird bevor du sie benutzt.</para>
+    </important>
+    <para>Bei der <code>poiid</code> handelt es sich um einen Freitext der von dir individuell festgelegt werden kann. Da einige Garmin Handhelds jedoch Schwierigkeiten bei der Darstellung von Sonderzeichen haben, solltest du dich bei der Vergabe der ID auf die Zeichen A-z, a-z, 0-9, sowie - und _ beschr?nken.</para>
+    <para><programlisting>&lt;icon type=&quot;2&quot; poiid=&quot;Traditional&quot; /&gt;</programlisting>k?nnte also eine Regel sein, die festlegt wie w?hrend eines POI Exports Traditional Caches behandelt werden. Nat?rlich lassen sich auch hier wieder die verschiednen Anweisungen kombinieren, so da? eine solche Regel auch so aussehen k?nnte: <programlisting>&lt;icon type=&quot;2&quot; poiid=&quot;Traditional&quot; ozicolor=&quot;65280&quot; name=&quot;Custom 0&quot; /&gt;</programlisting></para>
+    <para>Beim Export wird der vergebenen ID noch ein Prefix vorangestellt, welche du im Exportdialog vergibst. Prefix und <code>piid</code> sollten gemeinsam auf das Display deines Handhelds passen. </para>
+    <section>
+      <title>Garmin POI Loader</title>
+      <para>Sofern du den Garmin POI Loader benutzen m?chtest um deine Wegpunkte sp?ter auf den Handheld zu laden, musst du nichts weiter tun. Der Exporter wird im angegebenen Verzeichnis Dateien mit dem Namen <code>Prefix-PoiId.gpx</code> erzuegen, die du weiterverarbeiten kannst.</para>
+    </section>
+    <section>
+      <title>GPI Dateien erzeugen</title>
+      <para>Garmin GPI Dateien enthalten neben den Wegpunktinformationen immer auch eine Grafik mit der der Wegpunkt auf dem Bildschirm dargestellt wird.  Damit eine korrekte GPI Datei erzeugt werden kann, muss in dem Verzeichnis in dem die <filename>garminmap.xml</filename> liegt auch noch eine Datei mit dem Namen <filename>GarminPOI.zip</filename> existieren. In dieser Datei muss sich zu jeder von dir vergebenen <code>poiid</code> eine Datei mit dem Namen <filename>poiid.bmp</filename> befinden. Lautet eine deiner Anweisungen  <code>poiid=&quot;Traditional&quot;</code> muss sich in der <filename>GarminPOI.zip</filename>   eine <filename>Traditional.bmp</filename> befinden.</para>
+    </section>
+  </section>
+  <section>
+    <title>Anhang</title>
+    <section id="cachetypen">
+      <title>Cachetypen</title>
+      <para>Cachtypen werden innerhalb der Bedingungen durch einen Zahlenwert aus der folgenden Tabelle repr?sentiert</para>
+      <programlisting>0 Custom
+2 Traditional
+3 Multicache
+4 Virtual Cache
+5 Letterbox
+6 Event Cache
+8 Unknown / Mystery Cache
+11 Webcam Cache
+12 Locationless (Reverse) Cache
+13 CITO Event
+100 Mega Event
+101 WhereIGo cache
+102 Project Ape Cache
+103 Adventure Maze Exhibit
+104 Earthcache
+50 Additional Waypoint Parking
+51 Additional Waypoint Stage of a Multicache
+52 Additional Waypoint Question to Answer
+53 Additional Waypoint Final
+54 Additional Waypoint Trailhead
+55 Additional Waypoint Reference</programlisting>
+    </section>
+    <section id="cachegroesse">
+      <title>Cachegr??en</title>
+      <para>Cachegr??en werden innerhalb der Bedingungen durch einen Buchstaben aus der folgenden Tabelle repr?sentiert. Ob gro? oder klein geschreiben spielt dabei keine Rolle.</para>
+      <programlisting>m Micro
+s Small
+r Regular
+l Large
+v Very Large
+n Not Chosen / Other / Virtual / None</programlisting>
+    </section>
+  </section>
+</article>



From araber95 at mail.berlios.de  Mon Jul 13 13:35:22 2009
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Mon, 13 Jul 2009 13:35:22 +0200
Subject: [Cachewolf-svn] r2024 - trunk/src/CacheWolf/navi
Message-ID: <200907131135.n6DBZM70026019@sheep.berlios.de>

Author: araber95
Date: 2009-07-13 13:35:19 +0200 (Mon, 13 Jul 2009)
New Revision: 2024

Modified:
   trunk/src/CacheWolf/navi/MapLoaderGui.java
Log:
Bugfix for getting leading path part

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-07-13 09:51:27 UTC (rev 2023)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-07-13 11:35:19 UTC (rev 2024)
@@ -183,7 +183,7 @@
 		int EndPos;
 		int LastPos = java.lang.Math.min(newPath.length(),oldPath.length());
 		do {
-			EndPos=newPath.indexOf("/", StartPos);
+			EndPos=java.lang.Math.min(newPath.indexOf("/", StartPos),LastPos);
 			if (newPath.substring(StartPos,EndPos).equals(oldPath.substring(StartPos, EndPos))) {
 				LeadingPath=LeadingPath.concat(newPath.substring(StartPos,EndPos+1));
 				StartPos=EndPos+1;



From greiol at mail.berlios.de  Mon Jul 13 18:53:36 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 13 Jul 2009 18:53:36 +0200
Subject: [Cachewolf-svn] r2025 - trunk/src/CacheWolf/imp
Message-ID: <200907131653.n6DGraRg029007@sheep.berlios.de>

Author: greiol
Date: 2009-07-13 18:53:30 +0200 (Mon, 13 Jul 2009)
New Revision: 2025

Modified:
   trunk/src/CacheWolf/imp/GPXImporter.java
Log:
fixed typo in logtype recognition

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-13 11:35:19 UTC (rev 2024)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-13 16:53:30 UTC (rev 2025)
@@ -2,7 +2,6 @@
 
 import CacheWolf.CacheDB;
 import CacheWolf.CacheHolder;
-import CacheWolf.CacheImages;
 import CacheWolf.CacheSize;
 import CacheWolf.CacheTerrDiff;
 import CacheWolf.CacheType;
@@ -510,7 +509,7 @@
 		if (typeText.equals("Temporarily Disable Listing")) return "icon_disabled.gif";
 		if (typeText.equals("Webcam Photo Taken")) return "icon_camera.gif";
 		if (typeText.equals("Attended")) return "icon_attended.gif";
-		if (typeText.equals("Publish Listing")) return "icon_greenlight.gof";
+		if (typeText.equals("Publish Listing")) return "icon_greenlight.gif";
 		if (typeText.equals("Will Attend")) return "icon_rsvp.gif";
 		if (typeText.equals("Post Reviewer Note")) return "big_smile.gif";
 		if (typeText.equals("Unarchive")) return "traffic_cone.gif";



From greiol at mail.berlios.de  Mon Jul 13 22:51:57 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 13 Jul 2009 22:51:57 +0200
Subject: [Cachewolf-svn] r2026 - trunk/src/CacheWolf
Message-ID: <200907132051.n6DKpve9019885@sheep.berlios.de>

Author: greiol
Date: 2009-07-13 22:51:54 +0200 (Mon, 13 Jul 2009)
New Revision: 2026

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/Log.java
   trunk/src/CacheWolf/LogList.java
Log:
limit maximum number of logs stored in cache details

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-13 16:53:30 UTC (rev 2025)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-13 20:51:54 UTC (rev 2026)
@@ -93,7 +93,7 @@
 		 for (int i=size-1; i>=0; i--) { // Loop over all new logs, must start with oldest log
 			 if (CacheLogs.merge(newLogs.getLog(i))>=0) getParent().setLog_updated(true);
 		 }
-		 //CacheLogs=logs;
+		 if (CacheLogs.purgeLogs() > 0) hasUnsavedChanges=true;
 		 getParent().setNoFindLogs(CacheLogs.countNotFoundLogs());
 	 }
 

Modified: trunk/src/CacheWolf/Log.java
===================================================================
--- trunk/src/CacheWolf/Log.java	2009-07-13 16:53:30 UTC (rev 2025)
+++ trunk/src/CacheWolf/Log.java	2009-07-13 20:51:54 UTC (rev 2026)
@@ -97,6 +97,11 @@
 	public boolean isFoundLog() {
 		return icon.equals(GPXImporter.typeText2Image("Found"));
 	}
+
+	/** log was written by one of the aliases defined in preferences */
+	public boolean isOwnLog() {
+		return this.logger.equalsIgnoreCase(Global.getPref().myAlias) || this.logger.equalsIgnoreCase(Global.getPref().myAlias2); 
+	}
 	
 	/** Return XML representation of log for storing in cache.xml */
 	public String toXML(){

Modified: trunk/src/CacheWolf/LogList.java
===================================================================
--- trunk/src/CacheWolf/LogList.java	2009-07-13 16:53:30 UTC (rev 2025)
+++ trunk/src/CacheWolf/LogList.java	2009-07-13 20:51:54 UTC (rev 2026)
@@ -145,4 +145,22 @@
 		 }
 		 return buffer.toString();
 	 }
+
+	/**
+	 * trim down number of log to maximum number user wants to keep in database
+	 * @return number of removed logs
+	 */
+	public int purgeLogs() {
+		int maxKeep = Global.getPref().maxLogsToKeep;
+		boolean keepOwn = Global.getPref().alwaysKeepOwnLogs;
+		int purgedLogs = 0;
+		for (int i = logList.size(); i > maxKeep; i--) {
+			if (!(keepOwn && getLog(i-1).isOwnLog())) {
+				this.remove(i-1);
+				purgedLogs++;
+			}
+		}
+		return purgedLogs;
+	}
+	
 }



From greiol at mail.berlios.de  Mon Jul 13 23:03:29 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 13 Jul 2009 23:03:29 +0200
Subject: [Cachewolf-svn] r2027 - trunk/src/CacheWolf
Message-ID: <200907132103.n6DL3TGd020856@sheep.berlios.de>

Author: greiol
Date: 2009-07-13 23:03:27 +0200 (Mon, 13 Jul 2009)
New Revision: 2027

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
do not allow negative values for maxLogsToKeep

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-07-13 20:51:54 UTC (rev 2026)
+++ trunk/src/CacheWolf/Preferences.java	2009-07-13 21:03:27 UTC (rev 2027)
@@ -472,12 +472,12 @@
 			if (tmp != null){
 				processorMode=Convert.parseInt(tmp);
 			}
-
 		}
 		else if (name.equals("logkeeping")) {
 			tmp = atts.getValue("maximum");
 			if (tmp != null) 
 				maxLogsToKeep = Convert.parseInt(tmp);
+			if (maxLogsToKeep < 0) maxLogsToKeep = 0;
 			
 			tmp = atts.getValue("keepown");
 			if (tmp != null)



From greiol at mail.berlios.de  Tue Jul 14 13:36:20 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 14 Jul 2009 13:36:20 +0200
Subject: [Cachewolf-svn] r2028 - trunk
Message-ID: <200907141136.n6EBaK9j015908@sheep.berlios.de>

Author: greiol
Date: 2009-07-14 13:36:13 +0200 (Tue, 14 Jul 2009)
New Revision: 2028

Modified:
   trunk/getRes.sh
Log:
backup and restore of pref.xml
remove warnings if filenames contained blanks

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2009-07-13 21:03:27 UTC (rev 2027)
+++ trunk/getRes.sh	2009-07-14 11:36:13 UTC (rev 2028)
@@ -1,5 +1,14 @@
 #!/bin/sh
 
+# backup of prefs.xml
+if [ -f "work/pref.xml" ]; then
+	echo "backup of pref.xml"
+	mv work/pref.xml /tmp
+	if [ $? -ne 0 ] ; then
+		echo "echo could not save pref.xml to /tmp. aborting"
+	fi
+fi
+
 # clean up
 rm -rf work
 
@@ -15,6 +24,13 @@
 cp -fa res_noewe/webmapservices/* work/webmapservices/
 cp -fa res_noewe/languages/* work/languages/
 
-find work -type f -exec chmod 644 \{\} \;
-find work -type d -exec chmod 755 \{\} \;
+# set sane permissions
+find work -type f -exec chmod 644 "{}" \;
+find work -type d -exec chmod 755 "{}" \;
+
+# restore of pref.xml
+if [ -f "/tmp/pref.xml" ] ; then
+	echo "restore of pref.xml"
+	mv /tmp/pref.xml work/pref.xml
+fi
 #



From mik77 at mail.berlios.de  Tue Jul 14 21:37:11 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 14 Jul 2009 21:37:11 +0200
Subject: [Cachewolf-svn] r2029 - in trunk/src/CacheWolf: . imp
Message-ID: <200907141937.n6EJbBvc009699@sheep.berlios.de>

Author: mik77
Date: 2009-07-14 21:37:09 +0200 (Tue, 14 Jul 2009)
New Revision: 2029

Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Always load (not store) all logs when spidering own finds.

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-07-14 11:36:13 UTC (rev 2028)
+++ trunk/src/CacheWolf/MainMenu.java	2009-07-14 19:37:09 UTC (rev 2029)
@@ -761,7 +761,7 @@
 		
 		OCXMLImporterScreen options = new OCXMLImporterScreen(MyLocale.getMsg(5003,"Options"), OCXMLImporterScreen.IMAGES| OCXMLImporterScreen.TRAVELBUGS| OCXMLImporterScreen.MAXLOGS);
 		if (options.execute() == FormBase.IDCANCEL) {	return; }
-		
+				
 		SpiderGC spider = new SpiderGC(pref, profile, false);
 		OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
 		//Vm.debug("ByPass? " + profile.byPassIndexActive);
@@ -771,6 +771,8 @@
 		InfoBox infB = new InfoBox("Info", "Loading", InfoBox.PROGRESS_WITH_WARNINGS);
 		infB.exec();
 		
+		boolean loadAllLogs = (pref.maxLogsToSpider > 5);
+		
 		Vector cachesToUpdate = new Vector();
 		for(int i = 0; i <	cacheDB.size(); i++){
 			ch = cacheDB.get(i);
@@ -808,7 +810,7 @@
 			infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + ch.getWayPoint() +" (" + (j+1) + " / " + cachesToUpdate.size() + ")");
 			infB.redisplay();
 			if (ch.getWayPoint().substring(0,2).equalsIgnoreCase("GC")) {
-				int test = spider.spiderSingle(i, infB,forceLogin);
+				int test = spider.spiderSingle(i, infB, forceLogin, loadAllLogs);
 				if (test == SpiderGC.SPIDER_CANCEL) {
 					infB.close(0);
 					break;

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-14 11:36:13 UTC (rev 2028)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-14 19:37:09 UTC (rev 2029)
@@ -67,7 +67,6 @@
 	/**
 	 * The maximum number of logs that will be stored
 	 */
-	public static int MAXLOGS=250; // Can be pre-set from preferences
 	public static String passwort = ""; // Can be pre-set from preferences
 	public static boolean loggedIn = false;
 
@@ -104,7 +103,6 @@
 			pref.logInit();
 			p=new SpiderProperties();
 		}
-		MAXLOGS=pref.maxLogsToSpider;
 	}
 
 	/**
@@ -252,7 +250,7 @@
 	 * It assumes a login has already been performed!
 	 * @return 1 if spider was successful, -1 if spider was cancelled by closing the infobox, 0 error, but continue with next cache
 	 */
-	public int spiderSingle(int number, InfoBox pInfB, boolean forceLogin){
+	public int spiderSingle(int number, InfoBox pInfB, boolean forceLogin, boolean loadAllLogs){
 		int ret=-1;
 		this.infB = pInfB;
 		CacheHolder ch = new CacheHolder(); // cacheDB.get(number);
@@ -266,7 +264,6 @@
 		}
 		try{
 			// Read the cache data from GC.COM and compare to old data
-			boolean loadAllLogs = (MAXLOGS > 5);
 			ret=getCacheByWaypointName(ch,true,pref.downloadPics,pref.downloadTBs,false,loadAllLogs);
 			// Save the spidered data
 			if (ret == SPIDER_OK) {
@@ -619,7 +616,7 @@
 		//=======
 		// Now ready to spider each cache in the list
 		//=======
-		boolean loadAllLogs = (MAXLOGS > 5);
+		boolean loadAllLogs = (pref.maxLogsToSpider > 5) || spiderAllFinds;
 
 		int spiderErrors = 0;
 
@@ -670,7 +667,7 @@
 				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + ch.getWayPoint() +" (" + (cachesToLoad.size()+j) + " / " + totalCachesToLoad + ")");
 				infB.redisplay();
 
-				int test = spiderSingle(cacheDB.getIndex(ch), infB,false);
+				int test = spiderSingle(cacheDB.getIndex(ch), infB,false,loadAllLogs);
 				if (test == SPIDER_CANCEL) {
 					break;
 				} else if (test == SPIDER_ERROR) {
@@ -1136,7 +1133,7 @@
 				chD.OwnLogId = logId;
 				chD.OwnLog = new Log(icon,d,name,logText);
 			}
-			if (nLogs<=MAXLOGS) reslts.add(new Log(icon,d,name,logText));
+			if (nLogs<=pref.maxLogsToSpider) reslts.add(new Log(icon,d,name,logText));
 
 			singleLog = exSingleLog.findNext();
 			exIcon.setSource(singleLog);
@@ -1148,11 +1145,11 @@
 			exLogId.setSource(singleLog);
 			// We cannot simply stop if we have reached MAXLOGS just in case we are waiting for
 			// a log by our alias that happened earlier.
-			if (nLogs>=MAXLOGS && chD.getParent().is_found() && (chD.OwnLogId.length() != 0) && (chD.OwnLog != null) && !(chD.OwnLog.getDate().equals("1900-01-01"))) break;
+			if (nLogs>=pref.maxLogsToSpider && chD.getParent().is_found() && (chD.OwnLogId.length() != 0) && (chD.OwnLog != null) && !(chD.OwnLog.getDate().equals("1900-01-01"))) break;
 		}
-		if (nLogs>MAXLOGS) {
+		if (nLogs>pref.maxLogsToSpider) {
 			reslts.add(Log.maxLog());
-			pref.log("Too many logs. MAXLOGS reached ("+MAXLOGS+")");
+			pref.log("Too many logs. MAXLOGS reached ("+pref.maxLogsToSpider+")");
 		} else
 			pref.log(nLogs+" logs found");
 		return reslts;



From engywuck at mail.berlios.de  Wed Jul 15 08:32:21 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Wed, 15 Jul 2009 08:32:21 +0200
Subject: [Cachewolf-svn] r2030 - trunk/src/CacheWolf
Message-ID: <200907150632.n6F6WLcm027395@sheep.berlios.de>

Author: engywuck
Date: 2009-07-15 08:32:20 +0200 (Wed, 15 Jul 2009)
New Revision: 2030

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Time resolution in log entries now extended to milliseconds to render possible performance analysises. 

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-07-14 19:37:09 UTC (rev 2029)
+++ trunk/src/CacheWolf/Preferences.java	2009-07-15 06:32:20 UTC (rev 2030)
@@ -774,14 +774,14 @@
 	 * It will always append to an existing file.
 	 * To show the message on the console, the global variable debug must be set.
 	 * This can be done by adding
-	 * <pre><debug value="true"></pre>
+	 * <pre>&lt;debug value="true"&gt;</pre>
 	 * to the pref.xml file
 	 * @param text to log
 	 */
 	public void log(String text){
 		Time dtm = new Time();
 		dtm.getTime();
-		dtm.setFormat("dd.MM.yyyy'/'HH:mm");
+		dtm.setFormat("dd.MM.yyyy'/'HH:mm:ss.SSS");
 		text = dtm.toString()+ ": "+ text;
 		if (debug) Vm.debug(text);
 		text=text+"\n";



From greiol at mail.berlios.de  Wed Jul 15 23:23:20 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 15 Jul 2009 23:23:20 +0200
Subject: [Cachewolf-svn] r2031 - in trunk: res_noewe res_noewe/exporticons
	res_noewe/templates src/CacheWolf src/exp
Message-ID: <200907152123.n6FLNKcH025003@sheep.berlios.de>

Author: greiol
Date: 2009-07-15 23:23:08 +0200 (Wed, 15 Jul 2009)
New Revision: 2031

Added:
   trunk/res_noewe/exporticons/
   trunk/res_noewe/exporticons/Glopus.zip
   trunk/res_noewe/exporticons/GoogleEarth.zip
   trunk/res_noewe/exporticons/TomTom.zip
   trunk/res_noewe/templates/
   trunk/res_noewe/templates/ExpressLogger.tpl
   trunk/res_noewe/templates/GeoGrid.tpl
   trunk/res_noewe/templates/MSAutoRoute.tpl
   trunk/res_noewe/templates/TomTomASC.tpl
   trunk/res_noewe/templates/desti.tpl
   trunk/res_noewe/templates/index.tpl
   trunk/res_noewe/templates/kml.tpl
   trunk/res_noewe/templates/mn6route.tpl
   trunk/res_noewe/templates/mnroute.tpl
   trunk/res_noewe/templates/ozi_ns.tpl
   trunk/res_noewe/templates/page.tpl
Removed:
   trunk/res_noewe/ExpressLogger.tpl
   trunk/res_noewe/GeoGrid.tpl
   trunk/res_noewe/MSAutoRoute.tpl
   trunk/res_noewe/TomTomASC.tpl
   trunk/res_noewe/desti.tpl
   trunk/res_noewe/index.tpl
   trunk/res_noewe/kml.tpl
   trunk/res_noewe/mn6route.tpl
   trunk/res_noewe/mnroute.tpl
   trunk/res_noewe/ozi_ns.tpl
   trunk/res_noewe/page.tpl
Modified:
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/exp/HTMLExporter.java
Log:
moved templeates to own subdirectory

Deleted: trunk/res_noewe/ExpressLogger.tpl
===================================================================
--- trunk/res_noewe/ExpressLogger.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/ExpressLogger.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,16 +0,0 @@
-<#-- Express Logger GPX -->
-<#-- Codecs: ASCII, UTF8 -->
-<tmpl_par name="charset" value="UTF8">
-<#-- newline: CR, LF, CRLF -->
-<tmpl_par name="newline" value="CRLF">
-<?xml version="1.0" encoding="utf-8"?><br/>
-<gpx><br/>
-<tmpl_loop cache_index>
-   <wpt><br/>
-       <name><tmpl_var name=WAYPOINT></name><br/>
-       <cmlog:log version="1.0" found="true"><br/>
-           <cmlog:notes><tmpl_var name=NOTES></cmlog:notes><br/>
-       </cmlog:log><br/>
-   </wpt><br/>
-</tmpl_loop>
-</gpx><br/>
\ No newline at end of file

Deleted: trunk/res_noewe/GeoGrid.tpl
===================================================================
--- trunk/res_noewe/GeoGrid.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/GeoGrid.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,23 +0,0 @@
-<#-- AMAP Ascii Overlay -->
-<tmpl_par name="newline" value="CRLF">
-<tmpl_par name="decsep" value=".">
-<tmpl_loop cache_index>
-[Symbol <tmpl_var name=__COUNTER__>]<br />
-Typ=6<br />
-Group=1<br />
-Width=40<br />
-Height=40<br />
-Dir=100<br />
-Col=1<br />
-Zoom=1<br />
-Size=102<br />
-Area=1<br />
-XKoord=<tmpl_var name=LON><br />
-YKoord=<tmpl_var name=LAT><br />
-<tmpl_if __LAST__>
-[Overlay]<br />
-Symbols=<tmpl_var name=__COUNTER__><br />
-</tmpl_if>
-</tmpl_loop>
-
-

Deleted: trunk/res_noewe/MSAutoRoute.tpl
===================================================================
--- trunk/res_noewe/MSAutoRoute.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/MSAutoRoute.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,13 +0,0 @@
-<#-- Microsoft AutoRoute -->
-<#-- Codecs: ASCII, UTF8 -->
-<tmpl_par name="charset" value="ASCII">
-<#-- somme chars should not appear in the cachename -->
-<tmpl_par name="badchars" value=";"">
-<#-- newline: CR, LF, CRLF -->
-<tmpl_par name="newline" value="CRLF">
-<#-- decimal seperator: . or , -->
-<tmpl_par name="decsep" value=",">
-Name;Breitengrad;L?ngengrad;Typ1;Typ2;Waypoint;Datum;Hyperlink<br />
-<tmpl_loop cache_index>
-"<tmpl_var name=SHORTTYPE>-<tmpl_var name=SHORTSIZE>-<tmpl_var name=DIFFICULTY>-<tmpl_var name=TERRAIN> <tmpl_var name=NAME>";<tmpl_var name=LAT>;<tmpl_var name=LON>;"<tmpl_var name=TYPE>";"<tmpl_var name=SIZE>";"<tmpl_var name=WAYPOINT>";"<tmpl_var name=DATE>";"<tmpl_var name=URL>"<br />
-</tmpl_loop>

Deleted: trunk/res_noewe/TomTomASC.tpl
===================================================================
--- trunk/res_noewe/TomTomASC.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/TomTomASC.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,10 +0,0 @@
-<#-- TomTom ASC or POI -->
-<#-- Codecs: ASCII, UTF8 -->
-<tmpl_par name="charset" value="ASCII">
-<#-- somme chars should not appear in the cachename -->
-<tmpl_par name="badchars" value=",">
-<#-- newline: CR, LF, CRLF -->
-<tmpl_par name="newline" value="CRLF">
-<tmpl_loop cache_index>
-<tmpl_var name=LON>,<tmpl_var name=LAT>,"<tmpl_var name=SHORTTYPE>-<tmpl_var name=SHORTSIZE>-<tmpl_var name=DIFFICULTY>-<tmpl_var name=TERRAIN>-<tmpl_var name=NAME>"<br />
-</tmpl_loop>

Deleted: trunk/res_noewe/desti.tpl
===================================================================
--- trunk/res_noewe/desti.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/desti.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,10 +0,0 @@
-<#-- Detinator -->
-<#-- Codecs: ASCII, UTF8 -->
-<tmpl_par name="charset" value="ASCII">
-<#-- somme chars should not appear in the cachename -->
-<tmpl_par name="badchars" value=",">
-<#-- newline: CR, LF, CRLF -->
-<tmpl_par name="newline" value="CRLF">
-<tmpl_loop cache_index>
-<tmpl_var name=WAYPOINT>-<tmpl_var name=NAME>,<tmpl_var name=SHORTTYPE>-<tmpl_var name=SHORTSIZE>-<tmpl_var name=DIFFICULTY>-<tmpl_var name=TERRAIN>,<tmpl_var name=LON>,<tmpl_var name=LAT>,,,,<br />
-</tmpl_loop>


Property changes on: trunk/res_noewe/exporticons
___________________________________________________________________
Name: svn:mergeinfo
   + 

Added: trunk/res_noewe/exporticons/Glopus.zip
===================================================================
--- trunk/res_noewe/exporticons/Glopus.zip	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/exporticons/Glopus.zip	2009-07-15 21:23:08 UTC (rev 2031)
@@ -0,0 +1,62 @@
+PK
+8?}?????4?Q?#??
+??T?C?8D??H??0?6<C?'M?1N???<]!?q??g??|i ?$???b?~??.?"?D`j???,???u??2?\K???8])?S??8OTyu?)4?q?#???lj??#@LM?P?saLh??&?`?p???D??}??:M???/f??c??M??}a??#??!M????4?@??8??B????? ?c3%??Y/k-WR8?I?$,6?m???f?b??%?uz
+??:??
+?B??T_???E0??x,??;??(~[???5????Y?/_??ykP??G=F59??J6j?? ?T?h?"??????$X?6b??'??P???i?{U??]??????I!V]Eby?L??e?????V\X?wTG?4<O?@1uj?Wh?:t?h?k?K?O_?^?^oj??JB%?Fm?
+?)?_?????h??????C?k????????????O?_Le'??????m??Gl{4?-??????s/sokj(?]:????z?????G??mn<7??-??ia;??M?#_?o?7o????f?mgN}??5??????m???
+>z*???????g?w??????<[*????|???7??p????[???5aY????7??n|??h?????????N??O?G??????n?~??WB?????z??Z??=?????l???<?DWW`O??????????;b?/t???z*??c??\?{????[?k?kh????D????L??????w???{"L??'?]?H??:?????????v??}?PK
+?R*?QY???[M???E?E{??^?^????e?EB????,???f1E?h?3?.c??y??|?s???.?????9???X??????V??S?0???hB??????U???ZT\T?????	`Fp?7??#??Dp?gK???c;?M????\,_K??
+??ik??n??~?h;wC???NcL?????n?ig?GG???z?bjk????A??{8??>?)????????=aI1??;??@?l???Q??D????L?,k?G?8IP?+qZ???P$R?X?~,Y?????n??V;?????c????q???4(?`?X????f??F???%?n=>%???????h"??8{??Z?G?*?)iX?X?t?j,c??S?????A?Q???0Y?????[???;?q at 8???x?|?j??a????-??W?Z????h?!?????r?O	t??????s??n)YD?
+???L?H??ZU/r??????}?+x?$???????H??/J??	t>!z??f??V??N?x]s=??d?S)?????".?#/?^?ijfKe#??????Q\\?J???????-Z?R?D&?a``@]????u???/??h???cdd???8%?#ol????H???????|??dl????f?MH????w1z/??4Qs?[?????*?????"w ???\G??????S???y????K?>f????a??_-???{??-???????+?EO??*++?v??vt?T????*??}???57N??^6"}l[?{??zg??????x|????5D?????]c????????I?6"??u?^S}}??????? ????~???+????WOn?J?a???iiA?????????w?o????"Opp<Z???_??T??9???7,?#v?????????zy?z?vM????"5????????}??}???E?m?:n??V?t?????oj?b???GJs?7???7??u??m=y?????PK
+MIX?FM-B+????jLIa??6??E?IHBBH????>@??a?}??y??s????6?p??Z{?B??????????\????Q?j^X??(??8???Px?x?sw ?C?a]?N?F?z???????y??@?7*9	???a??Z?4J$?u?`o?{?????z?=W?^'F:Y??H?"??n\R?*??????pO;?#|l????>?l?(?o?G??E?V?4??a?'?)?8?&??d@>???????????? ?OM??????t?'?F?,?B??AA?H?`???	??????
+?J5hh?GS?2???&tt?p??z{-???^o?N7???ev?fIN???????? ?X?V????l6cppF????8 at r????j5T??]]]????B?@[[?r9ZI?2*??f466B"?@,???UUU???DEE???QZZ???b???BH?#??Gff&?[:8RRR_????\]]???U???K?UW????;?o?]aY?gjv'?[?O?AO?;?iT?????3???4???,_???<i???????F{/????????????DG?e?{?DWP??g_Y#?R:????|>??\??`d?R:?K?????W??	"??J???|????{V??	_f.*?+?)???G?FZ2;?<???t&??)??n???{?E??Bh????m?????-A E[6???7???????zb????????????????|????=????????K?<??Mo?q?]w?_???Y9y????p?/PK
+?B|?jF?u?g?fz?3??;t(??o/,?dg???/????NV??b.?~
+p?+LF=p??i???(?A???C0	i??E??UB?y???????RAM???A%S0:?-4??0E.????E?0??iNV??9?E???E?t??G?|U????M8	?H?????
+??i??/.?,?1s?&?)al	e,Q~hP?M?E.?]&?S0?a????px	OXMo,?X???qF}pYB???=??OzOC?3K?3??z?????g?S=&h?_?}??k??W???Ps3????$m?f??4?$I!eEs4??(???2???Z??w??by??OU??oq???F??U???????????|??}?Y?*?3????????????=?????????Z??????k??????^?????|?3?2???T2?????????m??ag??N??;????h???????7?GX????j?__??????N?2v??]???t????????9?|??????~???<~t?????<?+?k/LNF????g?????k?_?+??w?PK
+?????????E,,,`~~sss?????????155???ILLL`||ccc??????144???A???}}}???EOO?????????Nttt???mmmhmmEKK?????????F444???uuu???EMM???QUU???JTTT???eee?X,(--EII	???QTT???B ??yyy???ENN?????????????l6?d2!99F??z?:?Z??			P??P?TP*?????B??\.?L&Cll,?R)$	?b1D"?B!bbb ????????r??p6?????(0?L0??t?h4???!$$????R??P(??;?3?]?5%+1??????#?Uzj?{?(??E;?H?K9?i?q????;>M?{?3ThT8?9?f?????? ??q?Ab?1b???2????I^????H?Y}/?????y?j
+?x;#???????/\?#???????????qRtt??KKR?\?????R?:#?????}t?????G???.?>?~+??Y?	??'??k?O???k?1%^?Mu?{???o?O?????_PK
+? 
+a*??????@+?3?Jh?I?E???-4z?d?e?e??*?Y?v?]??r??????K??|??????Q{????g?????x?y??xC?B??????K/HH????t?*5DAa??
+?P?pJ????!???&????$?<zT?d-?????
+9lrT??
+?????????????/W?????
+???KW??7n?O,???gfn]?0??o{A?\K??????|??8?
+NF??8d?4B???+?GE????y??E}??|?S??@??k?k?T?	I????BF?0M?sc???U???????M????&???2?L?PK??CG?h?:_?>M?`;6??''?????5???3'?I?r_NNY?????\? +*????w???0?e???3?????9?>??i%??ktid?a?+?g?!t?]?P?D?{?	XVJK8?9W8???[????~F?M????7?\???F??????1?GQ??Y?x?e_r2??C>?{q?xq&??Yal?Z4jV?(
+??y6ej?x???w??1?G?Q>6^?h??i?>Yo?????C??>????LL???;??w?|???????Y?h?????6??????y??'V??????????y[?G?:R'^????????W??????????~98|????^?????s?gon?9????#??Kf?Y3??O/M??U???[?????^????}?;??><??]#?<b_0o???t?'???5????????=??\y??????6?u?;:gnm?7???x??:~?:?l?T
+???h?????Ew????????uk?.+??^?w?]w,???w?}KV?|pY????R?V.V?,]?b?????-??g??7,???????{???q
+?PK
+a?B?M.??|\?Y??g??2????T??T?=2Lxf??S??T=^B??{Tn??H?
+<????I?pT^?~??O?74?{5???%h??>??5#????
+??*???????B^?~J$pu???=?;?<???hg???k??~?;????>Hl?????h?|?u?p??????Sa???u$&%?Z?????n????d??o"/?+U???Ry]??[?L?{????I	/????a????h.y7???3g?moWn???~???????7?8q4??&??????z?????H?????P??]???]???_PK
+v#? ?Y???}?x/????IlH,$????????????1?6??f?{-???x????^/????0g?`a????a?N?????!???{??nK??=??????a?I	?R???	l?H??T?A?74??*+???CWW??r:??D?H?@y'???X??xY??<+?R??G?J(?O?????D??>?X??=x???aB??]?? mY??R??V?[???d?#'?E0??VU?vQ&?]S>??h?????A[%G???:-??V????0?K]?k.??????n?i?d???8666????????5D?QD"???`yy?p?P?`?@
+Y'@V???:?????>??8?~Y7B????=?"??'y(N?>4???Z??\?3???? ?D??U???????u	???!c??B5???3???|???\?|??>u???a?_????PUv?/=??e???Y?Pk??JI^?-{Po?0???|??>-???[??S??f??X???'???a???????Kj?f[???}k?o?5tZ9?qh??????e?E??????wG;;O???????
+~?B?q?????????w5???tO?????G?lH7??|??w????????????,_??2><08?U???????J?X??}????????^?n??????ux>????C?3?tdd??`??y^p?PK
+k??IZ?c E]?P??T?????5??A?YL????!n?H0?8?Iz??)?1?3??????7?{~Z
+m????z{????d?&?OS_???`f?4A??xu:?R_???26????.x???f3]v.?{??-?QE_?sj??$?Lx3??p?;????????????????`e1~???????????;p_I???Ww??jm???-+;4r{????????-|n????j??!???~?i?u[???N????D??g??M%???z?u?Hy}$?l?W??:????C?X4:V???Qy?Q??<{??n?|3?h>}#??X?????	??R??Rw?????9yD??????g?_|;?>??khb?i???h>m???u-..>??T?W?O.,\????P?^Y????O????????=?%?mf???q7?PK
+?? q??J?0???Qy9?X{??:?E:n4?x?4?YP?@????#?V????4??)??@?M@?8??\0??!?O?	?2axi????rV$?9???u??c"??A?Y?pd????SP????J?	/nv?B?F??!`?-??C?Q?????	PJSP_-D?Z ?h??A88?h"?&""h???	?K??=????(????8RA<TrDW??Or?n?????7g?.??J?L?????pP?(@Yi?6
+NC?????
+i2j*??????? p???
+Y(??B&N?T??()?@?'???
+r???? 9QW??B^
+ri???PVr ??P???X?Da?"&T?\??I?@Xr???i?\?Ri**s?????k?P???m?????p?(tk?`w??3j????@ia???t;@?)?Mz??vXil4M?????R6XlV??NH??t?L?`r?`'?? ??\n?s??????????!?>7??%y???i,6?]N?????Iv??@o??`v?Fv?d????
+??A?
+A@?"????r?i?L?2m???+i-???\`??s?????o??????>????????ic?B???76???????,H>$k??N??+e?q_J???2D???y???
+?T??"?-$\.QJ?????iT? d?,#)??W??d?h6???n??-???HW?U???<GF???a?Y??CF5?J??<?|Dp?????b]Z)?q`:>??? ?Pm??:?b??$?4,?nH9??\d4???P???K?"???gS??t??%?&?5???8?d??????PI?09L????w
+'=????TOz(b?!yg?Jo????S???P??*???TA?!??@!?Z?|???X??S??yeu????N???????;?\n????::???m:?L?7?????]g?2?v?@?qe???yn??o?l??#[???%???????V7???-????????o6y????s??t?/?t6??}MM??k}0Q(N=?N???}???q????????O_?????????????R~Y+??????QZ??x?????#f?????o??o???????+?Clg?gscsux??o?PK
+??L?D"!::?H???+?'???Z?T??WP?o??G?1o?}??u????'???QWq??9O??+|?????5??S?7:}???V???hQpH??N??^)~\???V)RS???_?????6=????|??N?????k????H??L?8(??R????[n??0??????3(?W???k???? 1??????>???p???L?x?T??????\[???L*K????wl?u9~?????_<???+??+?o????
+??
+MTS?iS1d??-?L?????s?????s7?????X~?????yf}????h.?K?N7313?????n&?''???MV?_O?=1?????#?O??*,c?q?S??(T?y^??&K?J?L)!X1?_Q=?U??U?hF?`MF#V?fl?????z?????/?T???Vdv`???q?iL??1Km?"W?yf3????*??U???
+??&|?Tl??&????&t???_?L??2???_b???]R%9X?T?W?(>'/(&Dy?c???Hh?a?+???%'Ku??
+y????(?15X?4c'?`??Q???N?%=??^?C?J??A?D5???{?Y?+?KZ?ghq+???w?1r?45??d???j?[XGpq???D+?#?T?*-F?%?F??j??u???a-?!C?k^?E??48?/ckv+>?^???}K?DM???}??VO?X?F?????}?M????V?7m8e?????~??7?\????8i'g??F?b??)??????{	??????kB?9????Q?B??>$???????{6
+?b??n?u(GktH?n?-??-U???{<????L???R???O?>t??!?c5?~Mz?uJ??lI?E?W??O??7u??v!????)??u?so????/?n?????h???KL??_???5???y/-??{?U??V;???n1??%???[?f%?y??z?Nz?[m8W}2?h??3??;}?s??/\????k!2e???Us?~hie????}V??gT?pb???L9#/N?~???o?-z??o??yI???E:?:`]?????y}J?????G?N???1}_Xf.x7??y???nk?{?
+?????Ug??????PK
+
+B``  ??????????B(????
+???????$L<~?sz?eE?1??[??a-??????=$m^{?]?65?g?????????o????w?y?m???????W?_?c?MR.??_d???'????||ITx/?O??I ?OYY????w??)%9?o^?<?
+??C]tR? 8?-??-MfD??H`?@@??5\??%?Sp?0?/??|???9????,?!???A?B?c??pd?%???{?{cgg?6???6?-?o6???p514*?????[??????VT?FQ,f3?d?.&??JT??A?s~~??x?q?????}}????==???mH%\????E"?????;w?0????9???bzj
+????!%9?Z-L????????677??????u???a?x???`yyKKKX\\????????%?333??????{r?||ccc??????144???A????Kj?!?www?????????@{{;?????????477???	???hhh@}}=???P[[??auu5???`?ZQi??dY^^???R??????????(((??dl2?`4??????<???"''????????`@ff&222?????????
+?Z???$?T*$$$@?T">>
+?r?????!???d???DDD?R)$?7???C(?QPP?b1D?O???
+? }??????/?|>???>>>?p8`??`?X??????'?L&<<<@?????7r?\]]???
+?ggg899????w?????:Wk??????S?:!??W?7Y?????R/]?)????AN?,+??t???M?????k?/?f??9q?=z?@)8??8??????K???O??????????v???r?????h????s?G("?????,}?_????9i??Q?<???3w?g?^?H?-?????????W
++*??+???!??cz?=?B??DM??c?|????=!?Q??h??S????7?:[x=?8?A?_??/?;?'Y?`?I0?=??'i???>?F???;?[?	_J?c.????($??~???PK
\ No newline at end of file

Added: trunk/res_noewe/exporticons/GoogleEarth.zip
===================================================================
--- trunk/res_noewe/exporticons/GoogleEarth.zip	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/exporticons/GoogleEarth.zip	2009-07-15 21:23:08 UTC (rev 2031)
@@ -0,0 +1,182 @@
+PK
+
+
+
+???-?=Du???:??(&??:?I?U?r)?Yp????%!x9|? ?@*??????/?Z}????????eP(????br????z???!???}??m?u?}????F?1Ad?'?B??????????)"%%?????R??SD??`??hP/??Tr$??d???????y?????????\?F#?
+?Z????????????Vv???UE?K?X?|?l??	?????K?#?x)8??\??????X??(?9?Q?"???n?Hi?
+???G
+$?{c=?????a???A?]?A??5p?z(?4?@??"?_^????W????????x??b?|???a?j?????:?.f???S|??p?ZX>
+????????}????n'_k?[??+y41?
+?%?'???3??#?U??j?q"?????cWC?pe?d????@I??3-_?.??~?{?????~3?~?N?N?4??v
+A_?mM???g1r?E??28?d(??	????i?9?=C???#????????y???&???b,?G+t????e???8???p$?[H??IH??=>???????C???????q???-;????d?j?/?p??E?v??\z????	????"???=??n9?T????4?O??nPm??????hn?F??A???????vW?d??z????? Q??B?W8?8%8E?)?N5PR????#?z????????&?S????UZb?/?????oi?U??!????O*?I?APTD?9&/m??4?K??5j???M?>?????TQ?Hy?:HJLvE&???`??"????9P??T^?????1????I3;?h??Wg?7g?Pc?W????????H~@??~u]?:(6HCy5j?Q?????:?8affH;?I7??G?:W???S*(??5R%?????j9_-????"??"??4kP$?O????;?M??_H??J??Q?????Py?Y?W?Hu????????{+??;Af;=?k&??U0={?A??1??.???>s??a:??Z?C??,r??@b??J?Tw?Y??????G?J?O???l???a??0??Va?_??R;???????5?};'??o|???F?U????????O??D?CXWbz?^(/?yf#.^/G???3??U?c?????t?????????R E&??
+'o???OK?<O?v??????#?JK???T??9?????????h.?Z???????w?????7|????)?6???O\?-+?j????vjP?S??4?48???	?E??KcNm[?leLG??G7J?z???G????s'Ag?m?
+n?lJJB?x?_??j??gY
+?????????|??!Y???EI9f%???X???e`??
+??fqL
+DVD&E??b??PL???T???=Ol_?C%g????8RkH??a!?????,
+????CO?????????Kl?Y???sw?m@??K?$?????$I???&{fN)I?@?K??1?????.8??sq??aI????/???=?????9??Y?g??,1h?y??E??"}??@?????BA`???R??0-?Z??????W?A?p?;I?????`?t??X??????=????
+??dY^`VkN???]0???H???sM???5????L?<???+?P9y-,;|??N??|?0??^`??[??:?0??z???/????IW??8g)yQ+???O??k?4?8??_d?Y?bFW???g?yE???j??6[??i?L?O;	$??RWp????U??8"A'=?3Y??)??x?l????????r?}e??I1?
+??ya???]G7?b??sN???/?lEQ??>E??<W??9??S????!??G????8~???Ef?_M???s?????8d???lT???^??I?E\????-?9R????yn?)???B?h9??>X????%?to??V??|??O?O>????}6??.N???"g*x? ?P???P?~?9?}????\????6?a}??{z??L?b?[??)N?? kI
+??6?4????`0?v!	fsy???	???)..????4F;?k?1+X?x??????)?????????????v*?>??9g?"??d=c^4?Wu?????	L?>????ym{???|????XEx???wL&	???.???3?[C?V??3??s???@ujuH?P?`??_}???1???k??^\?C?"j??1g	??	?%:?-?"??#O)9??YCB,?!x?y?I^????C???e?o0R4?g??_?T??U+?%M!?o??_???co/??W?????_|?p?<rm{?J??H??ba??lv?$??%g!?C???>?d?-??9??w???W???'^??I???~*?O?K_???S???R??Q?q??ey??????Z?
+??P?g?Hm?J??Q???c????G??MRkf?`?!??1??d?????%?To????)???{?fz?YH?yP?z?Cc?(?????	k???a??5&|?=???????Fv??r??2^???los????@KLc??>?U?
+{?/c$??^E_??z?h??j??A??F)~?|??????Sh5????)??dCN	I?,???y??H?A1Gb??`???#Q at 5??2??t??8s??Y??9?I???;????4E??^I???Co+??4??:KJ?%?&P?z??-?zr?8???ci?=R;?xU?/?(>?4?!??/???4+?r??"LO?M'??8C??4??8J(8?o?m?:?5k9????~N]?La0???a??tts???k???k?+)%/Y?.(???????o???yM?+???????|=~????????S?\??f!??T?o???f?O??"2#??F??S4?/T?k?_U=q?2???"??7K????_=?#+????sw????q?.qo??z?6?q????}?2i??t8?|????????????gM0?????s??n???{?6S????wc?Cq????p(?W???Mx???s??????#Rm?4???\??~????????}?????e?i??T?"uA@M?????7?B?7??t?}??L??I3W@???E?????
+??5h?{?#????o???%zQ?75u????g??????e?T3Fi1;7????+????H???M??;??^I?R??!?????9?d??U?5??=
+?v?????J?Njd??Qd&???5???O?????????m<??=?L?{?:b???If$????{/?N????R?}E??O~????>?????Ty?????s1\}%
+????ev???5?}
+?
+??!l.??????7r???|?~??)c?H4y8?t??;??z]?K5? ??N9WB?
+?Icx???G????MO???q?l?A?5?'???xdE?
+???YlAcc?????B???o?I???(??5?P???[t??3Y[6?u???h?$l??????c??KW??:??f??T)?f5??=x??=?v?<4bp	xa?u^H?^u???n?M????i?9?-9
+Sb??2O??u'??bx?????O<?h??-k?fV??Y???[:?K-.?:?????(!??H?X??N?]???3RpT?7?C3\??????a??^?w??Q&???]$?Ve?#b7O?[?????Y?f???C????W?w?Op?L???_&%G?????????k!F???YCA???)?|????;?~?w`l?u]?>???_?}??:??Q???N?(???N?H?AK?K?i??1ijBH?????u????KaEe?Q?-7??7?]z1??>??
+???k?-em?[hu??4??6"!;?&S?84??{??o|???????kA??_???<??1??$??????_do>?_Y?lW,SpPN?g?$?@e???c????]???8?s???_?0?????l?+WU?O97I?q?????????x???4?]?!?]?v??N~??3x???????7?<??nmf(784?zu?7??????ne??	??u|%???LJ+???|??~?K-?????K???+a?P`??R?????Z??D?y???=??v???3_??????N<N<.? ??A?[o?_??Gz?B??W?0??8]????o?xW???+?}Cvl????????QS??R1?d?y?F
+
+
+
+
+
+
+??P??9????]?????{?<$?
+14?;??????q5~#??!|?U/??g!<????i;?Czh?e??pl?????|?n??/????hsQ?8?*??PH?"?G?suE
+
+?["??:Tt?N????I??$?r?S7)BA?V??>????7??w???w?G???#?jEDF???????gh0-uD?qiaF*b"."`?*j?.?`?T??\,??^Wqw?GC%L?%B?$P?	\???????a????*?6335W5?E??]=?AR????????
+S?" ejH??2i?
+?)?+?AA?3?,?@}?63w?0?&?,?[?R}??^??
+K(?P?P??'?ud?Z?NLL?j????F??j???v??YYYY]]????v?[[[?^ogggoo??????????%???????3?/?????????????D????g?c??r}??Bg???'?????j?;????????k???????v_8)?w?<????{??q?????7?V?[g????CGno?=??;}j\6?_?O.???????????PK
+
+
+
+
+
+
+??QJ)???m?RJL???????{$	?z?:??/?m??qhO????5_?u??????<???????w3??=?3????;???2*??????????	@????=?w&??%???????8  ???~?,6???#X??
+?}$?i\?!????f??d??1jk?XV?????????%:?OKK?jk???SO???G??'??it!5>[?????op?.?,
+$i??]???=Z??u?h?cD)
+?%???4?>?h??c'?ST?/??yI??U?<!??????[?+????????a???????T~?????w?a?^??OJ??Q<w
+
+
+
+,?B????
+^<_e???F?4??"????????"o?3??i?M?@P?$?`M?CC??DT?662??N\Y?y?KS?~?????N@??
+??^}??}Qd???bN&"??(?/u2?@0?Z[????w|?_?5?_??`??>_???cB????
+
+
+
+Q&?????l?@????,.?<WPZX?0??V?6M(?P???l?OKd!??EA?,pD?Hf;??8V??9?(??0&I???Y1??q
+
+
+
+?????a4?+?EE ?????8f????~?b+?????????Ut#[?6
+/_??g???c?N???:Qp
+N?P?MA at 2?,?????;????<?y??;???e??!"-~??`:?JR?U.?[)O?yJ???05?	^?G??????:c?4?=???????oS?i?Zk&?? /?V?F??H?o?vuSE???ki?T3???
+
+
+
+??%??^<??r???????]\B)????}:????)?*??;{\??f???d?HO_?????o_?-??R,6?????2k?aW??~?????>???????U??-?O?B?X
+?y???jI??!???x???-V?ZPI]M]????vm}??3)????????f???5??	??'?PU@Pf4a??,?%?hQ????L0??U9?/???????6
+
+
+
+?0???	
+??l0????+>??'0??`???e1,?g???Liw?????
+
+
+
+
+
+
+gO???Z,H??
+:??[?4Z?_?1U?d@?3?U4?6?0Z??_?bLW?????^?$?l??9<??????????^??u??t????39???1j21x?
+? ?????????4?p?h4???????X+>?B???&??Y\\??v?V???`p:???	?
+}fu5,V$???r??`??'???C???
+
+
+
+???*~g5e???=%.?\??j???#0
+??A?@?%C?9"??(-?4?H/???????
+??<>Cy?6Q?*?Hc?8l???@<????^?????S,vm???? ?#5?????J?f	)??????C??~C?W?S??bp?Q??;?(7????%M???????y?m?$?d????????????{???-|8rA?0[??t?&"?Pq????i?N?????Z?HZ?t?3??:??3?=9?)c=??/?w?????1?RwB?*???F??W?j??????3?>??o?????utyB?>&N<>(?????'???O?zK???T?'?U???6??*??Ds??tkSt??`????7x??B??	J?1
+
+
+
+??m??h3"(?~.J??J	II"?(??B
+
+?K4?fD*??zQ?????mVs??\??{?n????8p????p?s?
+8%??Or ???f\K????????9[6??/???|?G??W?]e?????8?S@?B???,?}?????W??A?
+??Q?)?x????T???V?Zy???~?l?X??u\?=??z????,??qka-y?b?g?T???H***???i???x????*
+
+
+
+??#????V!?4_?hm?????;??Uw-YX#as}?????3?3??\????{???????.*?rYW??r??#??;?/d?
+??:`R??E?A7;?i?W`??1???a,
+??,<X~{bs5f`???l;??
+?/??{]?U??+??Y???x???[??{:???.???????o.|?)o?s???]??y????HPT8Q???e^???~??is??????4>???w??????????TbtF?r???~?|????y????Q7?l?g*5<=??JZ???'\? ?q??F3 ,&E??qS?B?S????1Nh??N?	????(&?(^QEY?5?U?y?!!?/o$RDUQB?4????bIElt
+
+
+
+!?1?/e??~????????X&?	su7I??T?d??IZ?_??Q#??B??R??;<????????R????g??Z????D2k!??S0
+????
+??R_k???Q??.?????[r???<t??Q??fJ8?$V??X??5X.???4L5?K????H???EwI?9???e?#%?/????fE??K???
+#???(?U3??h?
+
+
+
+???n?????=??????7?g:??Ovevk?.?D;j???????Go?=??f1???'?????IOd???a? ?C?	4??F?"s`"g?????9B	???V5???g?z2???=??S??B???qpJ????K	2j?P*???^?,???#.?lV??]???4?CC?+3?L???=??Sz?b?e??h?p??????I?$?k?Ls????
+1?K?????jy??'*???:??'?6HP?K?^z?????`5eR?X??x??O??[Z???'Nt?Zi???K??0??.],$?6??1p???:???????/??w????S?????D????????D[Ic??FZ???X??s?CRZgY[
+
+
+
+Q(?l?
+2???J}"c?P_X?+??/??_??r(???t2?LMvH
+
+
+
+?}??i
+M?'?)???in%?????????????M???5%s??]?d{<?H?SX?Y??m??1???]{??3?{rb?Z??'mS+F%-N???n??2e??%?? M??y?????0?
+?"?r??s?$?p
+??????{??j?#
+
+
+
+^??_V????'?'??w?1A(???5??mhEc??2`????6?|*'?%]Cg??k??C?s?
+F???Vp^1x?Z?H?^W,-?>S??ar?#?\????;?6?@`8
+2?`??NW????7??|J?=????P???ej?	?4@?E3??N?\8D???"?Gq.LL%?CAo???9?I\??a>???
+??@???h?
+
+
+
+???e??
+
+
+
+????Q?D",??/? "???a? "???|QU?Q???>#"FD??jupp?%???k??899?9<<dDtJD??)?Y$a???'"X?*wSQ?O
+????-??W??
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
\ No newline at end of file

Added: trunk/res_noewe/exporticons/TomTom.zip
===================================================================
--- trunk/res_noewe/exporticons/TomTom.zip	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/exporticons/TomTom.zip	2009-07-15 21:23:08 UTC (rev 2031)
@@ -0,0 +1,101 @@
+PK
+??EP9JUx
+<~	d??&G"?G?(????6r?8???	??c>O???
+?*???$?<??<I&z `?<??!?$?~?i?@Q?U?L?t?T?@>
+?????~I$M?????"???I?D?B???*??K?#??Hv$?4??`?2I?L?'??*dh
+?`?
+E?4?a)$GRl?$qB!GW?1T?L???,?tG%?UI???b?F??a?F1S#???'?ab?<?Mu?\?<?? ?2???Az???m?????&q?L????-J??
+1?"??(??p&Jq'J?cS??M??MV?#;#'?????p(	??????K?&\???d\r!??c??????(?+?K{?%?/??L*I?t??l???M??(???&??L???,????3?2??b9F?,wj??????Isw&Y>?r9m;???7-?"UE??x?o???c????b?5C?R????+]u?????]O?1???U?_*??}?S,??;??6c?????f????`?/?y?u?????[z~rg??}?i at yyhpi???3o??1?p?g??x??i?CB????:/(_?|T??Db???r?h?C????]???/??_????_?Y6*\?`??>d???,iX?????-?<2\YYVYy??2?D????7??;?????l??k????gK??????e????|?????C[??.?????f???c}???]Q??mI????oEil???S??V??????w?{?????u??~IUSCu??O???=??H??qy?????k?oj??a????=???9??l??????l???gkZ??????/V?o;?Vc?W?Y????P#?\T?z??????uVXj??5??j??/?m?????[S?X??M??P?????3??????3fa?B!up??fC?{???>z????m?????/c_nh?3}????(?B?????PK
+???di??T??a?}?????s?9?w?]?i}&?G?
+i???$??
+?#IH{?P?R??}p?%am5B??????-3^?S
+t?%&%Rp??Bn????{2?{???1y???^hS0??H?E??[??A^(A??Bt?}5?
+?P?e??P?;x&O?
+?YT?q?????p?\(??o?C???<_??M???<????u9?8c?0?U?T?????~?Mf???#???U0W!??????????<?R????8???y??)??yN?!]?AG?I???D!??s?2d?1???{ 1?9???DU???????5?????????upp???B<??5?-???q?a-?K?????ZE????@?h??yH?f?V?p2~?r<?\??x???$??>(??!UT!???k??B??D?GB?U?!??PU??????	?F?xh/?{?? ?F????o?6[???????W(?%5U???gU?$J.JMB"?'??M???:2?br@*????d5?5?_z??/{Vt{Pp*	??$|A?????E???????!
+:?W@??:?I??v?
+
+?+d??H"?"I??'????~x?? O?"f~,1IQD$??N?R?b~b4K?CX?$???qx????IIZ??E
+
+??*X??N??4B?? 2+???`?m?M???v??Q???5	l?^@nI?????`1?,????l=??Sx??Y??4????DY??Aj??2?]??)??_????-?dmG??Y?!?
+??'c????a???#?p8~Nu?r???5:?^?+?N@"z???????W}????o???>???E???a?8A??e??g8??Uw??x?i??}E??f7?7E~[ ??@x??D?yBl???o?f?-)?\!?	m????????#3'???l?6nb??-?SRZB????ZK??L??\????*s?9?+???)eee(?J*????????U?F.?l??&?/j????m4?o??jM?v???O??Z.?????6?????|?????E???]??????(???z?.?????C@??@?F??????&?j5?n??????N???4???tuu??L??????nzzz?j???Oo,???????????^??N?\sW??9}?????S??{#?v<?j??[[?>????m5??a??????1??"?????_M.6?^??D?O?3???n"?u?k????{?k?}h??<'g???????q???kW??????^???????????3?????R7????=??@ee???[?O??????M???^z??`?K?`??z?????rS?s???wH?/?m????:pI???C{?T?1??9)?'?????3?}??N?Cao?f?H????????EG???T??U+k???S>>c&<???pu???w=*r??U??I:???V?N?? ??G???+??>2b???^??????=??-?|vp???????7i??j1?M?????F*U}???G?????$??'???yA?^?(????e??0*?RWw??PK
+(W?sI?w8a???L&Y?`:;??????????]?????M?~p???????????0??p??+7???n//x?????{??? 
+F0?NH8??G??hDq???? ~Et?????U???(!?????????O??w?Ug??;"??p??Q???lW??>??x?
+?"3???M??? F??Xm?:5b?Z??!B?HD?y???8J???3fB.qrt?c8m????????????>w5??8[W?Z?:r?J???z455???---hnkC[G???DGW:?.B??FU????CC????????v#T???@e???q4X-h&Z??I+?j544??j???A?Nmo/z???K?G????g0 at O???=??0p?1hs???!tw_D????Ng??f??0NOadd&?	??Q???`6[1>1??4F?	[,X?VLNNbjj
+??O??`??!fgg??W?????d?Q??????????&???ia?[?p???ko^?/
+~???0?=|??@??K??????N@?H$?vh???????!???y??/E???????o~3R??D?()Q?????????|?????????);?+???)???????R?'6}sB????5?]R????l?W??p???????????G??????]?K?sX?@}??#%?+?S???%???|????#?????????/x&??mrJ??g???R????7>????.?x_o??!ha?
+??r???2Y,???y|??????,?????????[???~?????r??R?????9^n??PK
+??EP9JUx
+U?"'G?.?w1(RZ:?4%9???3'YJ S!'8O@'SM??pMI???\??O?N9U??Ns??4TEF?B??ed??MU????\]A\Q??r?Z??A&??<???V?'C?PU??:?#???i:K?K??I{0?e?s b?3??H?&$?DB5??M???|?I?	?<??O??1!b?*fIr??jX??????`:?Xp=??m??6?%I????Q?q???t???l#???isN6????19????n??t??ALq?8??Fs???? i8??5?qx7?}m?=8?D?am?P?e????$????? ????????4Es.":?H#?t??l?????9'?qY?s???sO???=???I? kT?4?,??q??????y???B?FT%?@?G??????????yg????????y>?PH^?9($(?+2?C???n
+SX?!??J~?=
+?Y@@?S!, ?@ (????B?9????MA?=!??X`I??????|/X?1??(s8?5K??ln??Y????l?![????-vC{G??????????x ??G?+?????Wv??O^Vg???????y?W?eQ.K??a??/h?*m????;??~?,Q?Im??J???#???c???K??|?e??^?Psrd???:;E????+
+?????}?3??.??k_?
+???:??m??v?N=??g??Ox?r??#D{???????<o????[??.{zXgzS???o^v???M???????i[gw?<???K??9??a?M?f?????l????e???ZZ?=???[?7?5???3??o??x??.??#?????y??y?c????h??9??(????q-???????}????W???????C???????G??x????l????5??^?a??i??_:??e??M?????R?????\?~???????^?r??W?{??U6|?W??S??/????k???{???:v?_??+????P?^?Ln??o?????3??mg???(???p???>??4A??J-zcz?<sf??o?PK
+????
+???????????????lmm??????????????????????????KyU?b??K?????i????	????M????>???????????{????????c?/?:%&?????>g?c?????????~????T??)????:??t??????{W?G??)F?`????????????r?;5B|?Io?%?????x?So?&??D<?o~???? ????sw??o??)c??'?`?????w{?????%???W?c??sV??[???_??w?????`?????dz???f?????~????4??????y??PK
+??EP9JUx
+LbB????8?Cgw???/?????>????0~????8?'???9??sNv?/??Os?????`???????;?????%?\?H*?/f?.??]$)]$?|??
+?nR?$?H.????r? I?y?
+??EP??KT?%2L?Jj??-???Z?T]&??IQ
+???,`?va?"z?<?HEEA\!?
+??3?3?QxN?Sq8???N$????????6?i???D5{??+?8
+???????&??#~u????ZU???w=??????8f??????????W??|???x???u?????n???_?>?qz??S?k????W??^?v???g?????j5^e?7o~r??x(??k?U#?????y?y?NgS??v?????N???l*xq?8????????PK
+{1??Y?`L????Z?o!JGB???r??A
+hP&(J?u)?'6?&/zS??$??Vu5""Q?*BDN?Y)?^???K?R??F8S?rV?c? ?????42??("????R>GA???????2O??+?A>(???&U??
+&G
+??q6x_?E??#?>>}I?????F??{???]?!?VT+q??9?~?????z^????]??G?)9O?3?h????^{????t??Z?ks??	]5Mw?????Jr?J?L????h
+???a/[?9??YI??m?????&?x??`?(?BS???.B??3???7?:%3"C??`??l???X?b????
+??y????=??<y?|??7??U6q?
+??}p?B?p&???N???:?z???t^,?D?D,?b0"%`DK??????)L??X\??#??A2?B?$??????d??S`???{p?P?K%??)Q??J????4?????9|?]???|?H???"?ChX8????$??|?D"?H!?!?H???
+?L?8?r?
+?J?*?
+j?????0??/L?c0`????"????Qg?.+S????`&???b?b??/???c_??P??
+
+????V???bT???S?????`
+VWW??????ulll??[????U???)????E?D??~???:??!?????PZ?????[_]~?ZN@??????????AE??\?ps???|????????????a?*?J??k???~????????e??2??3??_k??????L??????k}G?E?,?????^^???t7?>??G?.???s???_M??&??&&?E?N???]b?/,.????{???}??&?d?????{???????=s??Y??g%[9:+K;??{?[?a;}i?)J9??"???*?=????^??????s??oPK
+'%.??d??E?Gf?R?6???1??????P?Ci?
+?????-?F????2?1?????H;O??ch5?RNr%I??N?????a????6?3:A??<IG??s.??Pa4PRP????????R.??c???l6SUY??????\?Z??l??vn9?8?v?Kp?><?/_??????o??????C?	?D??????C??????A????$!?'??<N?g?a?H?D?}a.w??rI1?.?$?l?X??R?????????)?;??8?N\.?"S?F}=????????F???hnn??????V???hoo??????N????????????^??????g``???A???fdd???Q???gbb???I??????fff???Y??????gaa???E???X^^fee???U??/??????rZ,w??u??C?????_???{y%????z??"O?5???????|??7kdO?R???
+osZ_<???9e%????e/????[.???/W?cL???o??????K}???V?? =%??s??'C?????r,Y2???=??R???k? I?????S???Twd?|J:}???)I???=???dI??x???F$?????i?????????i???I?|?LTB??w??9??????U????.o?#o8??PK
+??EP9JUx
+?P,0=D?C~?9?r????To"??I.?q]??Jp?$7s?+[,L
+????k?0???s???Z?b;?-R?j?\???f???c-????v?;uh??4??m{?n??Wh??~M?????P?????i{<zz?7{?EKn\????????nmX???dK6?????^???K6<?x??U???_?p ??o??gV\??????/=p??7m???7?+?:=?b?[??{??#??,????7o9?S?????_8??]?7?a??t.????WJ?v?_>?np?mW^?le?????7:?y?????:?dc?kk??q??V???G?g'???&????{?Q??:wHW????r???N?Z??????k??;?k5????q??q????300???S???T??*z???<q????m?d?6???=Q???U?j????????????HM??n`2?d?jx??????b?b/?%????n?F???JM??????p>??~????/?G????G?????:?z????L?PK
+??EP9JUx
+? q??<9?!S
+?|B??'??~??QC:???=??S??8?>O???
+z
+Jd?xp3?<??2?????H?%
+0??<?D>B?*?????$?$IFx???L!?A
+
+z ?A???????|???M{_???}?4????
+??0?5????+??PB??d?&r??;*????b9?J20P!??20??HvGH??v5?@??t?L?d` ?Q?l????cG?<"???:ftR@>??
+
+
+???|????q?h1R?.?_xw??i?df??v???QC<??s?1????g?RSS????r????.V???????))????a?E???nW???????kI?Cg?e???????w???1cm???IN???4??j?nWg?w~m-w??zk??????g???????????==?(?]rkZU?GE99%'rr??;K?r?]?bw?M?/PK
+W?/????9????7?!?????????!????? ??????I??($??H?"h?Wp??!P????I????)7?.?	?8?@??N\????dJ?$?z?xbjw?Q+h??GHf?y???ZI???<????N<??4?`?eA-???-M???B?????cI?&=]???Mo?n?>M7fkB?[?^??5?$????\Aiuv?\$?u=?????P?Y?EQ?9??GC?%?R?}??t#?????X?Tt???? ???z+?????_?c???5C???a??f??TL]U?B???????P??9*e?? A?P??k?
+9=Px-soRY??FG6:j?R????|[????????s?&?T? 	5E?|2?????t?;nK7U?kb6'??e??P&?????n?VG????s|??h?Q+8I!??P???1?mM?;?U??l4????<??Y??%@?I?|????M??)???????0p
+H?T???)HA?o??O?>v????=o??	?xY)????,K?D???2???y@????M????.dw??.hf"????\=}?Lr???s]{?C?]?<????l????n??&;???=???qG|O4??[mI3??????K??????????}???@?{?7?z*?I????|?0??^?????oF??ajf'?????.??;qp???k??u?>p???mM?=k)|j'??????{a
+??EP9JUx
+jhb????a?!T???^?????K??z]k??H?M>?>???<??.?d?x?r?G49??1??K?]c???)MS$d?"PGB(?%?f?(??z?b?,??????9D???)?8$?u??!c?9
+'8?&QC2?Q:?g??@Q?B1d???R<?????>*?????=??%??0K?,'??y??=E
+%?P?D?.R<S??"%!?	?????H??Hyx=QJ??I??8'Q???)H??(I??dJ?2	?L2??????4?(?3?g?? DF"?#&3?"
+C#Ue??@DQ!ARH??A??J?
+T??ZEZ?8A%???U???
+LA*h ?*??@???PCQ??(i?~??4??0C?3p??T?j??:???o??;???c?N??N?,?M??AE??{?fP??????l?`?E??`XH?I?b?<?L???o?<???4?c???,????"	? U?[??{???[?ga?fX?a??j???-?}??6??a?l?i??F???E?6l??????>?g???????'L5????|???ig???^h[?j????:?Z???????@???????o???zO??j?q?????????;???Z|?Zv*?^e?=??????????v???Ws??j???*M??_??u?r;???~?z??U?^??t?=V??V?-??a???={>=??~?8y???????#^??|???s???????'7??7??i?rn??????w-???y??????2??W????Mog????t?????V??n+{?O^?????k,???;m????io??v???{9??????3?w??w?????????/^<?k??~{??!|m???OK;?>?c??E?$??V?C(?n_w??=??v??evC??'*?h??I?n]?#kivu?:?aV??'?Kn????w??g??w|??5????????\?l?{???Q??????7?M?S??T?*????????_t??)z??8????(??vq????M?+????8X_{??:???fa??;??@??@??eww???72:??\n????Vn^??i??m???PK
+H?4??iA?????xD$C&?A??B?R	?V?Z?F?V?$?j?4w???tHII?^???`@??.??i??z
+*?B+}??#?&?}??I?&MH??g?l6????????]W?3s~???s??w???k?
+Z??
+?X[)?kE?\??a??f?????g?~?7????-g??t??C????[??Ot?WT??!??/?[???L??????+t??A?
+?43?+???Y>??:??yx??v????ml?^m??$st0???????#??=?C??S??dX??-B&??	=?5?6='Ir?Z_???)?????{_?h?x^????{???????a;?a?<?oJ?I?
+'???\?_???{?"Q>?R/??)????\*?R?????U?N?A????s'7g????@?H???(?A35	<??"??\???J??FM?{?1?SV?&?y????p5???:~???W???*?}??'?'?-???????3????????Bt????$??>??T??&De?$???.s??S?????kQbw%???T??2R??x??8?%?"???)}p??zM??<??N	[??{???????????????73??+%]?O??g>??i?????_?l?8????2VN???&????q???I??Sa???????%'???PK
+?H`?@@??w ???y??????;y??|?y?????|/??????hd5??????<??????`ll????F????tXYY???L0?L?????????ppp???\\\?b????
+777????????6??O.?<=???ooo?P?????~~~????G@@
+????k??HKK?H$?8=b????DVV$	???????T???\???A&?A.?#??P(P??J?EEEP?T(.,A(?u%%%(--E9IYY?)??QQQ???J?v?6??????;?????????Amm-???P__???466???	???hiiAkk+??????????EGG:;;????n??n?M????^???>??????~`ppCCC???FGG166?q??qLLL`?brSSS??????f)fg1G17???y,,,`qqKKKX?X^???
+VWW??????ulPll`ss[[[??????vww??????}???N?%?yR??)G???bI????uz????9z?D.
+px??5eh?Qt?????)??????<?Qg}???4?F???!???w?u?A???#?2???:?u??'?u?)~ ????|?o????P^u??O~M?^??5wV?????o???n??W??7??s>?_5??%?????k???9??r_?_??2^??\??x??tF?%.?mB at 8G?????Dg??\?????6O??=????A?{O?D?????d?w???4`??b?%w}???'?%??????Y^(P'????L???????Ti4?"?????h{?????xx/?????????PK
+??EUx
+
+??EUx
+??EUx
++
+??EUx
+??EUx
+??EUx
\ No newline at end of file

Deleted: trunk/res_noewe/index.tpl
===================================================================
--- trunk/res_noewe/index.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/index.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,49 +0,0 @@
-<html>
-<head>
-<title></title>
-<meta name="generator" content="CacheWolf">
-<meta http-equiv="content-type" content="text/html; charset=utf-8">
-</head>
-<body>
- <tmpl_if navi_index>
-	 <tmpl_loop navi_index>
-	 	<a name=top></a>
-	  	<a href="#<tmpl_var HREF>"><tmpl_var TEXT></a>
-	 </tmpl_loop>
-</tmpl_if>
-<table border = "2px" align = "center">
- <tr style = "background-color:lightgrey;font-variant:small-caps; font-family:sans-serif;font-size:16;">
-    <td><a href = "index_type.html">Art</a></td>
-    <td><a href = "index_size.html">Size</a></td>
-    <td><a href = "index_wp.html">Wegpunkt</td>
-    <td><a href = "index_alpha.html">Name</a></td>
-    <td>Besitzer</td>
-    <td>Schwierigkeit</td>
-    <td>Gel&auml;nde</td>
-    <td><a href = "index_dist.html">Entfernung</a></td>
-    <td>Richtung</td>
-    <td>Koordinaten</td>
- </tr>
- <tmpl_loop cache_index>
- <tmpl_if ANCHORNAME>
-  <tr style = "font-family:sans-serif;font-size:12;">
- 		<td colspan="2" style = "background-color:lightgrey;font-variant:small-caps; font-family:sans-serif;font-size:16;"><a name = "<tmpl_var ANCHORNAME>"><tmpl_var ANCHORTEXT></a></td>
- 		<td><a href="#top">Back</a></td>
-  </tr>
- </tmpl_if>
- <tr style = "font-family:sans-serif;font-size:12;">
-    <td><tmpl_var TYPE></td>
-    <td><tmpl_var SIZE></td>
-    <td><a href = "<tmpl_var WAYPOINT>.html"><tmpl_var WAYPOINT></a></td>
-    <td><tmpl_var NAME></td>
-    <td><tmpl_var OWNER></td>
-    <td><tmpl_var DIFFICULTY></td>
-    <td><tmpl_var TERRAIN></td>
-    <td><tmpl_var DISTANCE></td>
-    <td><tmpl_var BEARING></td>
-    <td><tmpl_var LATLON></td>
- </tr>
- </tmpl_loop>
-</table>
-</body>
-</html>
\ No newline at end of file

Deleted: trunk/res_noewe/kml.tpl
===================================================================
--- trunk/res_noewe/kml.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/kml.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,19 +0,0 @@
-<tmpl_par name="newline" value="CRLF">
-<?xml version="1.0" encoding="UTF-8"?>
-<kml xmlns="http://earth.google.com/kml/2.1">
-
-<Document>
-  <name>Geocaching</name>
-  <description><![CDATA[Geocaching mit CacheWolf]]></description>
-<tmpl_loop cache_index>
- <Placemark><br/>
-   <description><tmpl_var name=NAME></description><br/>
-   <name><tmpl_var name=NAME></name><br/>
-   <Point><br/>
-     <coordinates><tmpl_var name=LON>,<tmpl_var name=LAT>,0</coordinates><br/>
-   </Point><br/>
- </Placemark><br/>
-</tmpl_loop>
-</Document>
-</kml>
-

Deleted: trunk/res_noewe/mn6route.tpl
===================================================================
--- trunk/res_noewe/mn6route.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/mn6route.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,9 +0,0 @@
-<#-- Mobile Navigator 6 Route -->
-<tmpl_par name="charset" value="ASCII">
-<#-- somme chars should not appear in the cachename -->
-<tmpl_par name="badchars" value="|">
-<#-- newline: CR, LF, CRLF -->
-<tmpl_par name="newline" value="CRLF">
-<tmpl_loop cache_index>
-[<tmpl_var name=NAME>|][0][10]|<tmpl_var name=LON>,<tmpl_var name=LAT>||<tmpl_var name=LON>|<tmpl_var name=LAT>[7]||[6]|||<tmpl_var name=LON>|<tmpl_var name=LAT>[3]||[2]|||[0]|||<br/>
-</tmpl_loop>
\ No newline at end of file

Deleted: trunk/res_noewe/mnroute.tpl
===================================================================
--- trunk/res_noewe/mnroute.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/mnroute.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,8 +0,0 @@
-<#-- Mobile Navigator Route -->
-<#-- newline: CR, LF, CRLF -->
-<tmpl_par name="newline" value="CRLF">
-<#-- somme chars should not appear in the cachename -->
-<tmpl_par name="badchars" value="|">
-<tmpl_loop cache_index>
-<tmpl_var name=NAME>|-|-|-|-|-|-|-|-|-|<tmpl_var name=LON>|<tmpl_var name=LAT>|-|<br/>
-</tmpl_loop>
\ No newline at end of file

Deleted: trunk/res_noewe/ozi_ns.tpl
===================================================================
--- trunk/res_noewe/ozi_ns.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/ozi_ns.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,13 +0,0 @@
-<#-- OziExplorer Namesearch -->
-<#-- Codecs: ASCII, UTF8 -->
-<tmpl_par name="charset" value="ASCII">
-<#-- somme chars should not appear in the cachename -->
-<tmpl_par name="badchars" value=",">
-<#-- newline: CR, LF, CRLF -->
-<tmpl_par name="newline" value="CRLF">
-;nst FORMAT :  FULL NAME,CODE,UTM ZONE,LAT,LONG,IGNORE ANYTHING ELSE<br />
-#1,,<br />
-#2,WGS 84<br />
-<tmpl_loop cache_index>
-"<tmpl_var name=SHORTTYPE>-<tmpl_var name=SHORTSIZE>-<tmpl_var name=DIFFICULTY>-<tmpl_var name=TERRAIN>-<tmpl_var name=NAME>",<tmpl_var name=TYPE>,,<tmpl_var name=LAT>,<tmpl_var name=LON>,<br />
-</tmpl_loop>

Deleted: trunk/res_noewe/page.tpl
===================================================================
--- trunk/res_noewe/page.tpl	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/res_noewe/page.tpl	2009-07-15 21:23:08 UTC (rev 2031)
@@ -1,55 +0,0 @@
-<html>
-<head>
-<title></title>
-<meta name="generator" content="CacheWolf">
-<meta http-equiv="content-type" content="text/html; charset=utf-8">
-</head>
-<body>
-<table border = "2px" align = "center">
-<tr style = "background-color:lightgrey;font-family:sans-serif;font-size:14;"><td>
-<tmpl_var TYPE> <tmpl_var WAYPOINT> <tmpl_var NAME> by <tmpl_var OWNER><br>
-Difficulty: <tmpl_var DIFFICULTY>&nbsp;&nbsp;Terrain: <tmpl_var TERRAIN>&nbsp;&nbsp;Size: <tmpl_var SIZE>
-</td></tr>
-<tr style = "font-family:sans-serif;font-size:12;"><td>
-Description:<br>
-<tmpl_var DESCRIPTION>
-</td></tr>
-<tr style = "font-family:sans-serif;font-size:12;"><td>
-Hints:<br>
-<tmpl_var HINTS>
-</td></tr>
-<tr style = "font-family:sans-serif;font-size:12;"><td>
-Decrypted Hints:<br>
-<tmpl_var DECRYPTEDHINTS>
-</td></tr>
-<tr style = "font-family:sans-serif;font-size:12;"><td>
-Logs:<br>
-<tmpl_var LOGS>
-</td></tr>
-<tr style = "font-family:sans-serif;font-size:12;"><td>
-Notes:<br>
-<tmpl_var NOTES>
-</td></tr>
-<tr style = "font-family:sans-serif;font-size:12;"><td>
-Pictures:<br>
-Cache:<br>
-<tmpl_loop cacheImg>
-<a href = "<tmpl_var FILE>"><tmpl_var TEXT></a><br>
-</tmpl_loop>
-User:<br>
-<tmpl_loop userImg>
-<a href = "<tmpl_var FILE>"><tmpl_var TEXT></a><br>
-</tmpl_loop>
-Logs:<br>
-<tmpl_loop logImg>
-<a href = "<tmpl_var FILE>"><tmpl_var TEXT></a><br>
-</tmpl_loop>
-Maps:<br>
-<tmpl_loop mapImg>
-<a href = "<tmpl_var FILE>"><tmpl_var TEXT></a><br>
-</tmpl_loop>
-</td></tr>
-<tr style = "font-family:sans-serif;font-size:12;"><td>
-</table>
-</body>
-</html>
\ No newline at end of file

Copied: trunk/res_noewe/templates/ExpressLogger.tpl (from rev 2030, trunk/res_noewe/ExpressLogger.tpl)


Property changes on: trunk/res_noewe/templates/ExpressLogger.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/GeoGrid.tpl (from rev 2030, trunk/res_noewe/GeoGrid.tpl)


Property changes on: trunk/res_noewe/templates/GeoGrid.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/MSAutoRoute.tpl (from rev 2030, trunk/res_noewe/MSAutoRoute.tpl)


Property changes on: trunk/res_noewe/templates/MSAutoRoute.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/TomTomASC.tpl (from rev 2030, trunk/res_noewe/TomTomASC.tpl)


Property changes on: trunk/res_noewe/templates/TomTomASC.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/desti.tpl (from rev 2030, trunk/res_noewe/desti.tpl)


Property changes on: trunk/res_noewe/templates/desti.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/index.tpl (from rev 2030, trunk/res_noewe/index.tpl)


Property changes on: trunk/res_noewe/templates/index.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/kml.tpl (from rev 2030, trunk/res_noewe/kml.tpl)


Property changes on: trunk/res_noewe/templates/kml.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/mn6route.tpl (from rev 2030, trunk/res_noewe/mn6route.tpl)


Property changes on: trunk/res_noewe/templates/mn6route.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/mnroute.tpl (from rev 2030, trunk/res_noewe/mnroute.tpl)


Property changes on: trunk/res_noewe/templates/mnroute.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/ozi_ns.tpl (from rev 2030, trunk/res_noewe/ozi_ns.tpl)


Property changes on: trunk/res_noewe/templates/ozi_ns.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/res_noewe/templates/page.tpl (from rev 2030, trunk/res_noewe/page.tpl)


Property changes on: trunk/res_noewe/templates/page.tpl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/src/CacheWolf/MainMenu.java	2009-07-15 21:23:08 UTC (rev 2031)
@@ -447,7 +447,7 @@
 				kml.doIt();
 			}
 			if(mev.selectedItem == exportTPL){
-				FileChooser fc = new FileChooser(FileChooserBase.OPEN, FileBase.getProgramDirectory());
+				FileChooser fc = new FileChooser(FileChooserBase.OPEN, FileBase.getProgramDirectory()+FileBase.separator+"templates");
 				fc.addMask("*.tpl");
 				fc.setTitle(MyLocale.getMsg(910,"Select Template file"));
 				if(fc.execute() != FormBase.IDCANCEL){

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2009-07-15 06:32:20 UTC (rev 2030)
+++ trunk/src/exp/HTMLExporter.java	2009-07-15 21:23:08 UTC (rev 2031)
@@ -21,13 +21,13 @@
 	Preferences pref;
 	Profile profile;
 	String [] template_init_index = {
-	 		"filename",  "index.tpl",
+	 		"filename",  "templates"+FileBase.separator+"index.tpl",
 	 		"case_sensitive", "true",
 	 		"max_includes",   "5"
 	 		//,"debug", "true"
 	 	};
 	String [] template_init_page = {
-	 		"filename",  "page.tpl",
+	 		"filename",  "templates"+FileBase.separator+"page.tpl",
 	 		"case_sensitive", "true",
 	 		"max_includes",   "5"
 	 	};



From greiol at mail.berlios.de  Wed Jul 15 23:51:17 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 15 Jul 2009 23:51:17 +0200
Subject: [Cachewolf-svn] r2032 - trunk
Message-ID: <200907152151.n6FLpH6T027271@sheep.berlios.de>

Author: greiol
Date: 2009-07-15 23:51:15 +0200 (Wed, 15 Jul 2009)
New Revision: 2032

Modified:
   trunk/build.xml
   trunk/getRes.sh
Log:
templates have moved to separate sub directory

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-07-15 21:23:08 UTC (rev 2031)
+++ trunk/build.xml	2009-07-15 21:51:15 UTC (rev 2032)
@@ -55,7 +55,7 @@
 	<property name="assemble.dir" value="assemble"/>
 
 	<!-- lists of files to be packaged, this should become less confusing later on -->
-	<property name="template.files" value="*.tpl"/>
+	<property name="template.files" value="templates/*.tpl"/>
 	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png"/>
 	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif,icon_greenlight.gif,icon_redlight.gif,icon_remove.gif"/>
 	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4.gif,3.gif,2.gif,13.gif,12.gif,100.gif,101.gif,102.gif,103.gif,104.gif"/>

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2009-07-15 21:23:08 UTC (rev 2031)
+++ trunk/getRes.sh	2009-07-15 21:51:15 UTC (rev 2032)
@@ -1,13 +1,17 @@
 #!/bin/sh
 
-# backup of prefs.xml
-if [ -f "work/pref.xml" ]; then
-	echo "backup of pref.xml"
-	mv work/pref.xml /tmp
-	if [ $? -ne 0 ] ; then
-		echo "echo could not save pref.xml to /tmp. aborting"
+filestosave="pref.xml garminmap.xml"
+
+for savefile in $filestosave; do 
+	if [ -f "work/$savefile" ]; then
+		echo "backup of $savefile"
+		mv "work/$savefile" /tmp/
+		if [ $? -ne 0 ] ; then
+			echo "could not backup $savefile to /tmp. aborting"
+			exit 1
+		fi
 	fi
-fi
+done
 
 # clean up
 rm -rf work
@@ -16,6 +20,7 @@
 mkdir -p work/attributes
 mkdir -p work/webmapservices
 mkdir -p work/languages
+mkdir -p work/templates
 
 # get ressources
 cp -fa resources/*.* work
@@ -23,14 +28,17 @@
 cp -fa resources/attributes/* work/attributes
 cp -fa res_noewe/webmapservices/* work/webmapservices/
 cp -fa res_noewe/languages/* work/languages/
+cp -fa res_noewe/templates/* work/templates/
 
 # set sane permissions
 find work -type f -exec chmod 644 "{}" \;
 find work -type d -exec chmod 755 "{}" \;
 
 # restore of pref.xml
-if [ -f "/tmp/pref.xml" ] ; then
-	echo "restore of pref.xml"
-	mv /tmp/pref.xml work/pref.xml
-fi
+for savefile in $filestosave; do
+	if [ -f "/tmp/$savefile" ] ; then
+		echo "restore of $savefile"
+		mv "/tmp/$savefile" "work/"
+	fi
+done
 #



From greiol at mail.berlios.de  Thu Jul 16 22:32:18 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 16 Jul 2009 22:32:18 +0200
Subject: [Cachewolf-svn] r2033 - in trunk: . res_noewe res_noewe/exporticons
	src/exp
Message-ID: <200907162032.n6GKWIxI007356@sheep.berlios.de>

Author: greiol
Date: 2009-07-16 22:32:14 +0200 (Thu, 16 Jul 2009)
New Revision: 2033

Added:
   trunk/res_noewe/exporticons/Garmin.zip
Removed:
   trunk/res_noewe/POIIcons.zip
Modified:
   trunk/build.xml
   trunk/getRes.sh
   trunk/res_noewe/exporticons/GoogleEarth.zip
   trunk/src/exp/KMLExporter.java
   trunk/src/exp/TomTomExporter.java
Log:
added transparency to google earth icons
moved icons for googlearth and tomtom export to directory exporticons
added preliminary gamin icon set (windows scripts still missing)
adapted ant build file and getres for unix

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-07-15 21:51:15 UTC (rev 2032)
+++ trunk/build.xml	2009-07-16 20:32:14 UTC (rev 2033)
@@ -272,12 +272,9 @@
 		<copy todir="${assemble.dir}/attributes" failonerror="true" verbose="true">
 			<fileset dir="resources/attributes"/>
 		</copy>
-		<!-- copy addons -->
-		<copy todir="${assemble.dir}" failonerror="true" verbose="true">
-			<fileset dir="res_noewe">
-				<include name="Garmin*.zip"/>
-				<include name="POI*.zip"/>
-			</fileset>
+		<!-- copy exporticons -->
+		<copy todir="${assemble.dir}/exporticons" failonerror="true" verbose="true">
+			<fileset dir="res_noewe/exporticons"/>
 		</copy>
 		<!-- copy logo -->
 		<copy todir="${assemble.dir}" file="resources/CacheWolf.ico" failonerror="true" verbose="true"/>

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2009-07-15 21:51:15 UTC (rev 2032)
+++ trunk/getRes.sh	2009-07-16 20:32:14 UTC (rev 2033)
@@ -21,6 +21,7 @@
 mkdir -p work/webmapservices
 mkdir -p work/languages
 mkdir -p work/templates
+mkdir -p work/exporticons
 
 # get ressources
 cp -fa resources/*.* work
@@ -29,6 +30,7 @@
 cp -fa res_noewe/webmapservices/* work/webmapservices/
 cp -fa res_noewe/languages/* work/languages/
 cp -fa res_noewe/templates/* work/templates/
+cp -fa res_noewe/exporticons/* work/exporticons/
 
 # set sane permissions
 find work -type f -exec chmod 644 "{}" \;

Deleted: trunk/res_noewe/POIIcons.zip
===================================================================
(Binary files differ)

Added: trunk/res_noewe/exporticons/Garmin.zip
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/exporticons/Garmin.zip
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/exporticons/GoogleEarth.zip
===================================================================
--- trunk/res_noewe/exporticons/GoogleEarth.zip	2009-07-15 21:51:15 UTC (rev 2032)
+++ trunk/res_noewe/exporticons/GoogleEarth.zip	2009-07-16 20:32:14 UTC (rev 2033)
@@ -1,5 +1,5 @@
 PK
-
+
 
 
 ???-?=Du???:??(&??:?I?U?r)?Yp????%!x9|? ?@*??????/?Z}????????eP(????br????z???!???}??m?u?}????F?1Ad?'?B??????????)"%%?????R??SD??`??hP/??Tr$??d???????y?????????\?F#?
@@ -29,72 +29,71 @@
 ???YlAcc?????B???o?I???(??5?P???[t??3Y[6?u???h?$l??????c??KW??:??f??T)?f5??=x??=?v?<4bp	xa?u^H?^u???n?M????i?9?-9
 Sb??2O??u'??bx?????O<?h??-k?fV??Y???[:?K-.?:?????(!??H?X??N?]???3RpT?7?C3\??????a??^?w??Q&???]$?Ve?#b7O?[?????Y?f???C????W?w?Op?L???_&%G?????????k!F???YCA???)?|????;?~?w`l?u]?>???_?}??:??Q???N?(???N?H?AK?K?i??1ijBH?????u????KaEe?Q?-7??7?]z1??>??
 ???k?-em?[hu??4??6"!;?&S?84??{??o|???????kA??_???<??1??$??????_do>?_Y?lW,SpPN?g?$?@e???c????]???8?s???_?0?????l?+WU?O97I?q?????????x???4?]?!?]?v??N~??3x???????7?<??nmf(784?zu?7??????ne??	??u|%???LJ+???|??~?K-?????K???+a?P`??R?????Z??D?y???=??v???3_??????N<N<.? ??A?[o?_??Gz?B??W?0??8]????o?xW???+?}Cvl????????QS??R1?d?y?F
-
+
 
 
-
+
 
 
 ??P??9????]?????{?<$?
 14?;??????q5~#??!|?U/??g!<????i;?Czh?e??pl?????|?n??/????hsQ?8?*??PH?"?G?suE
-
+
 ?["??:Tt?N????I??$?r?S7)BA?V??>????7??w???w?G???#?jEDF???????gh0-uD?qiaF*b"."`?*j?.?`?T??\,??^Wqw?GC%L?%B?$P?	\???????a????*?6335W5?E??]=?AR????????
 S?" ejH??2i?
 ?)?+?AA?3?,?@}?63w?0?&?,?[?R}??^??
 K(?P?P??'?ud?Z?NLL?j????F??j???v??YYYY]]????v?[[[?^ogggoo??????????%???????3?/?????????????D????g?c??r}??Bg???'?????j?;????????k???????v_8)?w?<????{??q?????7?V?[g????CGno?=??;}j\6?_?O.???????????PK
-
+
 
 
-
+
 
 
 ??QJ)???m?RJL???????{$	?z?:??/?m??qhO????5_?u??????<???????w3??=?3????;???2*??????????	@????=?w&??%???????8  ???~?,6???#X??
 ?}$?i\?!????f??d??1jk?XV?????????%:?OKK?jk???SO???G??'??it!5>[?????op?.?,
 $i??]???=Z??u?h?cD)
 ?%???4?>?h??c'?ST?/??yI??U?<!??????[?+????????a???????T~?????w?a?^??OJ??Q<w
-
+
 
 
 ,?B????
 ^<_e???F?4??"????????"o?3??i?M?@P?$?`M?CC??DT?662??N\Y?y?KS?~?????N@??
 ??^}??}Qd???bN&"??(?/u2?@0?Z[????w|?_?5?_??`??>_???cB????
-
+
 
-
-Q&?????l?@????,.?<WPZX?0??V?6M(?P???l?OKd!??EA?,pD?Hf;??8V??9?(??0&I???Y1??q
-
+
+Q3???c?l~q??c??????l?STZ??i?Y?)y?@N???U?Y?b??0?O?p?w?uFi~???>7?Q"
+??OQ??wLv???,??g?'C_E~? ?7??L^??&%U?;
+,???W???YI????)U??F???|/-jHPh?@??W??'?D?)GiE?E?Oq8o`????e??'|O?hQ?????.
+???Rq#2?/%	?????D?SO-???Jm?????"?o????	?D???VUI??]a???i?|e???~???vZ?)???;`R???Vv????
+
 
 
 ?????a4?+?EE ?????8f????~?b+?????????Ut#[?6
 /_??g???c?N???:Qp
 N?P?MA at 2?,?????;????<?y??;???e??!"-~??`:?JR?U.?[)O?yJ???05?	^?G??????:c?4?=???????oS?i?Zk&?? /?V?F??H?o?vuSE???ki?T3???
-
+
 
 
 ??%??^<??r???????]\B)????}:????)?*??;{\??f???d?HO_?????o_?-??R,6?????2k?aW??~?????>???????U??-?O?B?X
-?y???jI??!???x???-V?ZPI]M]????vm}??3)????????f???5??	??'?PU@Pf4a??,?%?hQ????L0??U9?/???????6
-
+?y???jI??!???x???-V?ZPI]M]????vm}??3)????????f???5??	??'?PU@Pf4a??,?%?hQ????L0??U9?/???????6
+?s?n<h(?-p?p???)O?{_	;?Y?d?*????_^q???a?+???(??????s<????/!x?o????_???e?n???????OW??uN	M
+
 
-
-?0???	
-??l0????+>??'0??`???e1,?g???Liw?????
-
+
+
 
-
-
-
 
 gO???Z,H??
 :??[?4Z?_?1U?d@?3?U4?6?0Z??_?bLW?????^?$?l??9<??????????^??u??t????39???1j21x?
 ? ?????????4?p?h4???????X+>?B???&??Y\\??v?V???`p:???	?
 }fu5,V$???r??`??'???C???
-
+
 
 
 ???*~g5e???=%.?\??j???#0
 ??A?@?%C?9"??(-?4?H/???????
 ??<>Cy?6Q?*?Hc?8l???@<????^?????S,vm???? ?#5?????J?f	)??????C??~C?W?S??bp?Q??;?(7????%M???????y?m?$?d????????????{???-|8rA?0[??t?&"?Pq????i?N?????Z?HZ?t?3??:??3?=9?)c=??/?w?????1?RwB?*???F??W?j??????3?>??o?????utyB?>&N<>(?????'???O?zK???T?'?U???6??*??Ds??tkSt??`????7x??B??	J?1
-
+
 
 
 ??m??h3"(?~.J??J	II"?(??B
@@ -102,58 +101,61 @@
 ?K4?fD*??zQ?????mVs??\??{?n????8p????p?s?
 8%??Or ???f\K????????9[6??/???|?G??W?]e?????8?S@?B???,?}?????W??A?
 ??Q?)?x????T???V?Zy???~?l?X??u\?=??z????,??qka-y?b?g?T???H***???i???x????*
-
+
 
-
-??#????V!?4_?hm?????;??Uw-YX#as}?????3?3??\????{???????.*?rYW??r??#??;?/d?
-??:`R??E?A7;?i?W`??1???a,
-??,<X~{bs5f`???l;??
-?/??{]?U??+??Y???x???[??{:???.???????o.|?)o?s???]??y????HPT8Q???e^???~??is??????4>???w??????????TbtF?r???~?|????y????Q7?l?g*5<=??JZ???'\? ?q??F3 ,&E??qS?B?S????1Nh??N?	????(&?(^QEY?5?U?y?!!?/o$RDUQB?4????bIElt
-
+
+?,	oO?<$7?"??x?YH? ?H???w??F???+??	7q???}G?wE???E8????&?U??/d#?$;!?????My????;^???K?-?:???a~???j
+?d8?B???d??jX=?50/?????DIj	????=q?pK#o,S?b??mb5?????Y{U9?q??bF???d??7?'/??.t???-U??l??h??7?????o???}??>?r??<$??&???MYSHg?7O?.?P???U?>??|???*r%db?/?i|??????%??Op1T?l??O4zM??z??To?~??6?l?y????????9{?Pfy4???f?g"?_9r,??S?vkq9??|?K??k)?9?,V?????c}???%???^{????d????T?hQ?u?l[????x05??'?<?7??5?AW#?+?*???<2C??????{w?????N??p?!\???????'???/??xrc????w??:?2???K?-^??[if???g?y??)}?b??s????.?B??????u???@?&???P?mf??~
+??J*;q(o?????YB?
+
 
-
-!?1?/e??~????????X&?	su7I??T?d??IZ?_??Q#??B??R??;<????????R????g??Z????D2k!??S0
-????
-??R_k???Q??.?????[r???<t??Q??fJ8?$V??X??5X.???4L5?K????H???EwI?9???e?#%?/????fE??K???
-#???(?U3??h?
-
+
+f@[???h??;]{z?^???je?@????
+m??????2A/?u1vs??????HF????"????P@???)?"? jL??1{????Q,@??eCc1N~??|??m?L?cM???;?W??pk?C?[??1?U?s??ly?3?(?,??%?0???W?w\??e?4<??5?a???|?r|??y?????Q
+0e?k-?t????w??`??_??+???-|'Jo8N9??O3?#??J4??;?cY??^????.??eO??????\?"Tt?X?N"?????g??u???0 ??$??gos???bb?`?Rg*?0?5??4sG??F+%?L??+?(0.N???I?TgU"??1?J????????pu?3|]?F??7*??
+
 
-
-???n?????=??????7?g:??Ovevk?.?D;j???????Go?=??f1???'?????IOd???a? ?C?	4??F?"s`"g?????9B	???V5???g?z2???=??S??B???qpJ????K	2j?P*???^?,???#.?lV??]???4?CC?+3?L???=??Sz?b?e??h?p??????I?$?k?Ls????
-1?K?????jy??'*???:??'?6HP?K?^z?????`5eR?X??x??O??[Z???'Nt?Zi???K??0??.],$?6??1p???:???????/??w????S?????D????????D[Ic??FZ???X??s?CRZgY[
-
+
+????!?_???N??????'??Y????$??Ii?d?U82???1??2j?????p?l?I??hd?O????? ?`2kq???(a)????(e?4?
+?E(e}??"?pm???j?y(?+V%??F????Go0????S???BS	???9-???_sqF??/?????m?t2;N????F%?
+?nKM1?x????b????o????}???+:[?m?T?)?HBv??0/v|L???
+?mj???jm????)?i??j1???#{9?r??i?????=u5{???x: ???~5?17???%P.M4??FQ??l?M+?	J?v???????w?????x?O?\i?d???Y???????????;O?????,?>h`?v*???q?????%tny??D???UxA?~?R?l????qvf?????Z[O????a?d2 ?*??v>@?!;?%7| ??????h??Z?????????R??H
+
 
-
-Q(?l?
-2???J}"c?P_X?+??/??_??r(???t2?LMvH
-
+
+??9hU??}$?b??????k???r?gN?<???	?A??R)??Y?
+3???o??U???=?v?S?p?X4u??5~z????O???????I?H?y>/??[?'O)????u*20J??-?i???lv?C???d[UJ?1]?:9$???_?8_?r?c?S???/P?}.
+l?.??????[?e?????(?Gd$????2>????7??AV?BA6?u_?\0?U?CD?X????LG??L%O{???Ng???e~??????U??????>L?E????????????V??LQ?e|??>??^?7??|q5m?S??v?f??oPgmB\s??????U????/BR??????\m??ka?????x??W?R???.?	?S?+?wU??n??G?D?????F?L?w?z;G_?????e??F?
+? ?????7l??W@?G?+?????????+?T??O?????b865?@D#b?/+uw$1d?r?:????m?S)???4u+j9??????J???????'?A?b.N???r???2?F?
+?+??D?n??qmr]???
+
 
 
 ?}??i
 M?'?)???in%?????????????M???5%s??]?d{<?H?SX?Y??m??1???]{??3?{rb?Z??'mS+F%-N???n??2e??%?? M??y?????0?
 ?"?r??s?$?p
 ??????{??j?#
-
+
 
-
-^??_V????'?'??w?1A(???5??mhEc??2`????6?|*'?%]Cg??k??C?s?
-F???Vp^1x?Z?H?^W,-?>S??ar?#?\????;?6?@`8
-2?`??NW????7??|J?=????P???ej?	?4@?E3??N?\8D???"?Gq.LL%?CAo???9?I\??a>???
-??@???h?
-
+
+8??1??s?>?m??????'???????!?2;??te??kn*rX>??C?;T?5Oq???"????L??N??????g?J!?????????/?7????)?n???f?RFq?2??S???B??G???W?zaS5O???????_?p??????????GJ??>M?WAw??;??e2X??`!??K???????q???????
+z?RQ??6???Y???#i?b:?l????2??Y$3u??_?ZO;??????j{??%u?m?????T?lB??????????+gP??_??v?????tmYD???????U??4??????????Y??????U??????_<r?????????my+m??I?I??X?,	?[~	???!5?????L??"???X??C?p?O!?'xwO-R?Q???3???9????*N???U??,=???o???*???k?!_???????\??r??;?+fv4????t?u??X!?>3s?y?w????~C:qM}P?p9?z???Q??yxKj???N??*gM?D?|?|?y??!I?e6?'[?Wo??I#dKp???hm???[?6?0[?)???V6?T^?{??????[??
+????[_?z?????37?:ZQA??nR?inOG?s????
+??r??\?M??6?>?~a???y?$"????????????ww?\M,?JP	=??nu??h?N??@(?$#?{}??u???cf
+
 
 
 ???e??
-
+
 
 
 ????Q?D",??/? "???a? "???|QU?Q???>#"FD??jupp?%???k??899?9<<dDtJD??)?Y$a???'"X?*wSQ?O
 ????-??W??
-
+
 
 
 
-
+
 
 
 
@@ -162,21 +164,20 @@
 
 
 
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
\ No newline at end of file
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
\ No newline at end of file

Modified: trunk/src/exp/KMLExporter.java
===================================================================
--- trunk/src/exp/KMLExporter.java	2009-07-15 21:51:15 UTC (rev 2032)
+++ trunk/src/exp/KMLExporter.java	2009-07-16 20:32:14 UTC (rev 2033)
@@ -224,15 +224,14 @@
 
 	public void copyIcons(String dir){
 		try {
-			ZipFile zif = new ZipFile (FileBase.getProgramDirectory() + "/POIIcons.zip");
+			ZipFile zif = new ZipFile (FileBase.getProgramDirectory() + FileBase.separator + "exporticons" + FileBase.separator + "GoogleEarth.zip");
 			ZipEntry zipEnt;
 			int len;
-			String entName, fileName; 
+			String fileName; 
 
 			for (int i = 0; i < CacheType.guiTypeStrings().length; i++) {
 				fileName = CacheType.typeImageForId(CacheType.guiSelect2Cw(i));
-				entName = "GoogleEarthIcons/" + fileName;
-				zipEnt = zif.getEntry(entName);
+				zipEnt = zif.getEntry(fileName);
 				if (zipEnt == null) continue;
 			    byte[] buff = new byte[ zipEnt.getSize() ];
 			    InputStream  fis = zif.getInputStream(zipEnt);

Modified: trunk/src/exp/TomTomExporter.java
===================================================================
--- trunk/src/exp/TomTomExporter.java	2009-07-15 21:51:15 UTC (rev 2032)
+++ trunk/src/exp/TomTomExporter.java	2009-07-16 20:32:14 UTC (rev 2033)
@@ -249,12 +249,12 @@
 	
 	public void copyIcon(int intWayType, String prefix, String typeName){
 		try {
-			ZipFile zif = new ZipFile (FileBase.getProgramDirectory() + "/POIIcons.zip");
+			ZipFile zif = new ZipFile (FileBase.getProgramDirectory() + FileBase.separator+"exporticons"+FileBase.separator+"TomTom.zip");
 			ZipEntry zipEnt;
 			int len;
 			String entName; 
 			
-			entName = "TomTomIcons/"+ "GC-" + typeName + ".bmp";
+			entName = "GC-" + typeName + ".bmp";
 			zipEnt = zif.getEntry(entName);
 			if (zipEnt == null) return;
 			
@@ -267,10 +267,10 @@
 		    fos.close();
 		    fis.close();
 		} catch (ZipException e) {
-			Vm.debug("Problem copying Icon" + "GC-" + typeName + ".bmp" );
+			Vm.debug("Problem copying Icon " + "GC-" + typeName + ".bmp" );
 			e.printStackTrace();
 		} catch (IOException e) {
-			Vm.debug("Problem copying Icon" + "GC-" + typeName + ".bmp" );
+			Vm.debug("Problem copying Icon " + "GC-" + typeName + ".bmp" );
 			e.printStackTrace();
 		}
 	}



From greiol at mail.berlios.de  Fri Jul 17 19:04:57 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 17 Jul 2009 19:04:57 +0200
Subject: [Cachewolf-svn] r2034 - trunk/src/exp
Message-ID: <200907171704.n6HH4vDF013251@sheep.berlios.de>

Author: greiol
Date: 2009-07-17 19:04:50 +0200 (Fri, 17 Jul 2009)
New Revision: 2034

Modified:
   trunk/src/exp/GpxExportNg.java
Log:
speed up exoort

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-16 20:32:14 UTC (rev 2033)
+++ trunk/src/exp/GpxExportNg.java	2009-07-17 17:04:50 UTC (rev 2034)
@@ -32,6 +32,7 @@
 import ewe.sys.Date;
 import ewe.sys.Handle;
 import ewe.sys.Process;
+import ewe.sys.Time;
 import ewe.sys.Vm;
 import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
@@ -68,9 +69,9 @@
 	/** export uses only waypoint id */
 	final static int WPNAME_ID_CLASSIC = 0;
 	/** export uses waypointid + type, terrain, difficulty, size */
-	final static int WPNAME_ID_SMART = 2;
+	final static int WPNAME_ID_SMART = 1;
 	/** export uses cache names (will be made unique by gpsbabel) */
-	final static int WPNAME_NAME_SMART = 3;
+	final static int WPNAME_NAME_SMART = 2;
 	/** write single GPX file */
 	final static int OUTPUT_SINGLE = 0;
 	/** write one file per "type" as determined by garminmap.xml */
@@ -106,30 +107,6 @@
 	// .concat("<bounds minlat=\"50.91695\" minlon=\"6.876383\" maxlat=\"50.935183\" maxlon=\"6.918817\" />")
 	;
 
-	final static String GPXCOMPACT = "\t<wpt lat=\"@@WPLAT@@\" lon=\"@@WPLON@@\">\n"
-			.concat("\t\t<time>@@CACHETIME@@T00:00:00</time>\n")
-			.concat("\t\t<name>@@WPNAME@@</name>\n")
-			.concat("\t\t<cmt>@@WPCMT@@</cmt>\n")
-			.concat("\t\t<desc>@@WPDESC@@</desc>\n")
-			.concat("\t\t<url>@@WPURL@@</url>\n")
-			.concat("\t\t<urlname>@@WPURLNAME@@</urlname>\n")
-			.concat("\t\t<sym>@@WPSYMBOL@@</sym>\n")
-			.concat("\t\t<type>@@WPTYPE@@</type>\n");
-
-	final static String GPXEXTENSION = "\t\t<groundspeak:cache id=\"@@CACHEID@@\" available=\"@@CACHEAVAILABLE@@\" archived=\"@@CACHEARCHIVED\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\n"
-			.concat("\t\t\t<groundspeak:name>@@CACHENAME@@</groundspeak:name>\n")
-			.concat("\t\t\t<groundspeak:placed_by>@@CACHEPLACEDBY@@</groundspeak:placed_by>\n")
-			.concat("\t\t\t<groundspeak:owner id=\"@@CACHEOWNERID@@\">@@CACHEOWNER@@</groundspeak:owner>\n")
-			.concat("\t\t\t<groundspeak:type>@@CACHETYPE@@</groundspeak:type>\n")
-			.concat("\t\t\t<groundspeak:container>@@CACHECONTAINER@@</groundspeak:container>\n")
-			.concat("\t\t\t<groundspeak:difficulty>@@CACHEDIFFICULTY@@</groundspeak:difficulty>\n")
-			.concat("\t\t\t<groundspeak:terrain>@@CACHETERRAIN@@</groundspeak:terrain>\n")
-			.concat("\t\t\t<groundspeak:country>@@CACHECOUNTRY@@</groundspeak:country>\n")
-			.concat("\t\t\t<groundspeak:state>@@CACHESTATE@@</groundspeak:state>\n")
-			.concat("\t\t\t<groundspeak:short_description html=\"@@CACHEHTML@@\">@@CACHESHORTDESCRIPTION@@</groundspeak:short_description>\n")
-			.concat("\t\t\t<groundspeak:long_description html=\"@@CACHEHTML@@\">@@CACHELONGDESCRIPTION@@</groundspeak:long_description>\n")
-			.concat("\t\t\t<groundspeak:encoded_hints>@@CACHEHINT@@</groundspeak:encoded_hints>\n");
-
 	final static String GPXLOG = "\t\t\t\t<groundspeak:log id=\"@@LOGID@@\">\n"
 			.concat("\t\t\t\t\t<groundspeak:date>@@LOGDATE@@T00:00:00</groundspeak:date>\n")
 			.concat("\t\t\t\t\t<groundspeak:type>@@LOGTYPE@@</groundspeak:type>\n")
@@ -189,7 +166,7 @@
 		exportTarget = exportOptions.getOutputTarget();
 		sendToGarmin = exportOptions.getSendToGarmin();
 		customIcons = exportOptions.getCustomIcons();
-
+		
 		if (exportTarget == OUTPUT_SEPARATE || exportTarget == OUTPUT_POI) {
 			final Hashtable fileHandles = new Hashtable();
 			final String outDir;
@@ -305,11 +282,15 @@
 				}
 
 				if (exportTarget == OUTPUT_POI) {
-					String tmp[] = new FileBugfix(outDir).list(
-							prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
-					for (int i = 0; i < tmp.length; i++) {
-						FileBugfix tmpFile = new FileBugfix(outDir + FileBase.separator + tmp[i]);
-						tmpFile.delete();
+					// only clean up output directory if user has chosen non empty prefix, 
+					// since otherwise all present POI would be deleted 
+					if (! prefix.equals("")) {
+						String tmp[] = new FileBugfix(outDir).list(
+								prefix + "*.gpi", ewe.io.FileBase.LIST_FILES_ONLY);
+						for (int i = 0; i < tmp.length; i++) {
+							FileBugfix tmpFile = new FileBugfix(outDir + FileBase.separator + tmp[i]);
+							tmpFile.delete();
+						}
 					}
 					pbf.exit(0);
 					poiCategories=fileHandles.size();
@@ -404,7 +385,9 @@
 					Global.getPref().dirty = true;
 				}
 			}
+
 			final File file;
+			
 			if (!sendToGarmin) {
 				final FileChooser fc = new FileChooser(FileChooserBase.SAVE,
 						Global.getPref().getExportPath(expName + "-GPX"));
@@ -421,6 +404,7 @@
 			} else {
 				file = new File("").createTempFile("gpxexport", null, null);
 			}
+
 			try {
 				ProgressBarForm pbf = new ProgressBarForm();
 				Handle h = new Handle();
@@ -434,6 +418,8 @@
 				pbf.setTask(h, "Exporting ...");
 				pbf.exec();
 
+				if (Global.getPref().debug) Vm.debug("start: "+new Time().getTime());
+
 				for (int i = 0; i < Global.getProfile().cacheDB.size(); i++) {
 					CacheHolder ch = Global.getProfile().cacheDB.get(i);
 					if (!ch.isVisible()) {
@@ -449,6 +435,8 @@
 					h.changed();
 				}
 
+				if (Global.getPref().debug) Vm.debug("stop: "+new Time().getTime());
+
 				pbf.exit(0);
 
 				outp.print("</gpx>\n");
@@ -520,6 +508,7 @@
 			return "";
 
 		StringBuffer ret = new StringBuffer();
+		ch.getFreshDetails();
 
 		try {
 			ret.append(formatCompact(ch));
@@ -528,7 +517,7 @@
 				ret.append(formatPqExtensions(ch));
 			}
 
-			ret.append("\t</wpt>\n");
+			ret.append("  </wpt>\n");
 		} catch (IllegalArgumentException e) {
 			exportErrors++;
 			ch.setIncomplete(true);
@@ -549,113 +538,104 @@
 	 * @return
 	 */
 	private String formatCompact(CacheHolder ch) {
-
-		Transformer trans = new Transformer(true);
-
-		trans.add(new Regex("@@WPLAT@@", String.valueOf(ch.pos.latDec).replace(',', '.')));
-
-		trans.add(new Regex("@@WPLON@@", String.valueOf(ch.pos.lonDec).replace(',', '.')));
-
-		if (ch.isAddiWpt()) {
-			try {
-				trans.add(new Regex("@@CACHETIME@@", ch.mainCache.getDateHidden()));
-			} catch (Exception e) {
-				Global.getPref().log(ch.getWayPoint() + " has no parent");
-				trans.add(new Regex("@@CACHETIME@@", "1970-01-01"));
+		
+		StringBuffer ret = new StringBuffer();
+		
+//			.concat("\t\t<desc>@@WPDESC@@</desc>\n")
+		
+		ret.append("  <wp lat=\""+String.valueOf(ch.pos.latDec).replace(',', '.')+"\" lon=\""+String.valueOf(ch.pos.lonDec).replace(',', '.')+"\">\n");
+		
+		if (exportStyle != STYLE_GPX_COMPACT) {
+			if (ch.isAddiWpt()) {
+				try {
+					ret.append("    <time>"+ch.mainCache.getDateHidden()+"T00:00:00</time>\n");
+				} catch (Exception e) {
+					Global.getPref().log(ch.getWayPoint() + " has no parent");
+					exportErrors++;
+					ret.append("    <time>1970-01-01T00:00:00</time>\n");
+				}
+			} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+				ret.append("    <time>1970-01-01T00:00:00</time>\n");
+			} else {
+				ret.append("    <time>"+ch.getDateHidden()+"T00:00:00</time>\n");
 			}
-		} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
-			trans.add(new Regex("@@CACHETIME@@", "1970-01-01"));
-		} else {
-			trans.add(new Regex("@@CACHETIME@@", ch.getDateHidden()));
 		}
-
-		if (exportIds == WPNAME_ID_SMART && ch.getType() != CacheType.CW_TYPE_CUSTOM) {
+		
+		if (exportIds == WPNAME_ID_SMART) {
 			if (ch.isAddiWpt()) {
-				trans.add(new Regex("@@WPNAME@@", SafeXML.cleanGPX(
-						ch.mainCache.getWayPoint().concat(" ").concat(ch.getWayPoint().substring(0, 2)))));
+				ret.append("    <name>".concat(SafeXML.cleanGPX(ch.mainCache.getWayPoint().concat(" ").concat(ch.getWayPoint().substring(0, 2)))).concat("</name>\n"));
+			} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+				ret.append("    <name>".concat(SafeXML.cleanGPX(ch.getWayPoint())).concat("</name>\n"));
 			} else {
-				trans.add(new Regex("@@WPNAME@@", SafeXML.cleanGPX(
-						ch.getWayPoint()
+				ret.append("    <name>".concat(SafeXML.cleanGPX(ch.getWayPoint())
 						.concat(" ")
 						.concat(CacheType.getExportShortId(ch.getType()))
 						.concat(String.valueOf(ch.getHard()))
 						.concat(String.valueOf(ch.getTerrain()))
-						.concat(CacheSize.getExportShortId(ch.getCacheSize())))));
+						.concat(CacheSize.getExportShortId(ch.getCacheSize())))
+						.concat(String.valueOf(ch.getNoFindLogs()))
+						.concat("</name>\n"));
 			}
+		} else if (exportIds == WPNAME_NAME_SMART) {
+			// TBD
 		} else {
-			trans.add(new Regex("@@WPNAME@@", ch.getWayPoint()));
+			ret.append("    <name>".concat(SafeXML.cleanGPX(ch.getWayPoint())).concat("</name>\n"));
 		}
-
-		if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
-			trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)));
-		} else {
+		
+		// no <cmt> for custom
+		if (ch.getType() != CacheType.CW_TYPE_CUSTOM) {
 			if (exportIds == WPNAME_ID_SMART && exportStyle == STYLE_GPX_COMPACT) {
 				if (ch.isAddiWpt()) {
-					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + ch.getFreshDetails().LongDescription)));
+					ret.append("    <cmt>".concat(SafeXML.cleanGPX(ch.getCacheName() + " " + ch.getFreshDetails().LongDescription)).concat("</cmt>\n"));
 				} else {
-					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getCacheName() + " " + "("+ch.getNoFindLogs()+")" + " " + Common.rot13(ch.getFreshDetails().Hints))));
+					ret.append("    <cmt>".concat(SafeXML.cleanGPX(ch.getCacheName() + " " + Common.rot13(ch.getFreshDetails().Hints))).concat("</cmt>\n"));
 				}
+			} else if (exportIds == WPNAME_NAME_SMART) {
+				// TBD
 			} else {
 				if (ch.isAddiWpt()) {
-					trans.add(new Regex("@@WPCMT@@", SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)));
-				} else {
-					trans.add(new Regex("\t\t<cmt>@@WPCMT@@</cmt>\n", ""));
-				}
+					ret.append("    <cmt>".concat(SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)).concat("</cmt>\n"));
+				} // caches have no <cmt> in gc.com PQs
 			}
 		}
 
-		if (ch.isAddiWpt()) {
-			trans.add(new Regex("@@WPDESC@@", SafeXML.cleanGPX(ch.getCacheName())));
+		if (ch.isAddiWpt() || ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+			ret.append("    <desc>".concat(SafeXML.cleanGPX(ch.getCacheName())).concat("</desc>\n"));
 		} else {
-			trans.add(new Regex("@@WPDESC@@", SafeXML.cleanGPX(
-					ch.getCacheName().concat(" by ")
-					.concat(ch.getCacheOwner())
-					.concat(", ")
+			ret.append("    <desc>".concat(SafeXML.cleanGPX(ch.getCacheName().concat(" by ").concat(ch.getCacheOwner()).concat(", ")
 					.concat(CacheType.cw2ExportString(ch.getType()))
-					.concat(" (")
-					.concat(CacheTerrDiff.shortDT(ch.getHard()))
-					.concat("/")
-					.concat(CacheTerrDiff.shortDT(ch.getTerrain()))
-					.concat(")"))));
+					.concat(" (").concat(CacheTerrDiff.shortDT(ch.getHard()))
+					.concat("/").concat(CacheTerrDiff.shortDT(ch.getTerrain())).concat(")")))
+					.concat("</desc>\n"));
 		}
 
-		if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
-			trans.add(new Regex("@@WPURL@@", ""));
-		} else {
-			if (ch.isAddiWpt()) {
-				// TODO: find out URL schema for additional waypoints
-				// TODO: check for OC caches
-				trans.add(new Regex("@@WPURL@@","http://www.geocaching.com/seek/wpt.aspx?wp=".concat(ch.getWayPoint())));
-			} else {
-				// TODO: check for OC caches
-				trans.add(new Regex("@@WPURL@@","http://www.geocaching.com/seek/cache_details.aspx?wp=".concat(ch.getWayPoint())));
+		if (exportStyle != STYLE_GPX_COMPACT) {
+			if (ch.getType() != CacheType.CW_TYPE_CUSTOM) {
+				ret.append("    <url>".concat(ch.details.URL).concat("</url>\n"));
+				ret.append("    <urlname>".concat(SafeXML.cleanGPX(ch.getCacheName())).concat("</urlname>\n"));
 			}
 		}
 
-		if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
-			trans.add(new Regex("@@WPURLNAME@@", ""));
-		} else {
-			trans.add(new Regex("@@WPURLNAME@@", SafeXML.cleanGPX(ch.getCacheName())));
-		}
-
 		if (customIcons) {
-			trans.add(new Regex("@@WPSYMBOL@@", poiMapper.getIcon(ch)));
+			ret.append("    <sym>".concat(poiMapper.getIcon(ch)).concat("</sym>\n"));
 		} else {
 			if (ch.isAddiWpt()) {
-				trans.add(new Regex("@@WPSYMBOL@@", CacheType.id2GpxString(ch.getType())
-						.substring(CacheType.id2GpxString(ch.getType()).indexOf("|") + 1)));
+				ret.append("    <sym>".concat(CacheType.id2GpxString(ch.getType())
+						.substring(CacheType.id2GpxString(ch.getType()).indexOf("|") + 1)).concat("</sym>\n"));
 			} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
-				trans.add(new Regex("@@WPSYMBOL@@", "Custom"));
+				ret.append("    <sym>Custom</sym>\n");
 			} else if (ch.is_found()) {
-				trans.add(new Regex("@@WPSYMBOL@@", "Geocache found"));
+				ret.append("    <sym>Geocache found</sym>\n");
 			} else {
-				trans.add(new Regex("@@WPSYMBOL@@", "Geocache"));
+				ret.append("    <sym>Geocache</sym>\n");
 			}
 		}
 
-		trans.add(new Regex("@@WPTYPE@@", CacheType.id2GpxString(ch.getType())));
-
-		return trans.replaceFirst(GPXCOMPACT);
+		if (exportStyle != STYLE_GPX_COMPACT) {
+			ret.append("    <type>".concat(CacheType.id2GpxString(ch.getType())).concat("</type>\n"));
+		}
+		
+		return ret.toString();
 	}
 
 	/**
@@ -668,39 +648,27 @@
 		if (ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt())
 			return "";
 
-		StringBuffer ret = new StringBuffer();
-		Transformer trans = new Transformer(true);
-		ch.getFreshDetails();
-		trans.add(new Regex("@@CACHEID@@", ch.GetCacheID()));
-		trans.add(new Regex("@@CACHEAVAILABLE@@", ch.is_available() ? TRUE : FALSE));
-		trans.add(new Regex("@@CACHEARCHIVED", ch.is_archived() ? TRUE : FALSE));
-		trans.add(new Regex("@@CACHENAME@@", SafeXML.cleanGPX(ch.getCacheName())));
-		trans.add(new Regex("@@CACHEPLACEDBY@@", SafeXML.cleanGPX(ch.getCacheOwner())));
-		trans.add(new Regex("@@CACHEOWNERID@@", "31415"));
-		trans.add(new Regex("@@CACHEOWNER@@", SafeXML.cleanGPX(ch.getCacheOwner())));
-		trans.add(new Regex("@@CACHETYPE@@", CacheType.id2GpxString(ch.getType())));
-		trans.add(new Regex("@@CACHECONTAINER@@", CacheSize.cw2ExportString(ch.getCacheSize())));
-		trans.add(new Regex("@@CACHEDIFFICULTY@@", CacheTerrDiff.shortDT(ch.getHard())));
-		trans.add(new Regex("@@CACHETERRAIN@@", CacheTerrDiff.shortDT(ch.getTerrain())));
-		trans.add(new Regex("@@CACHECOUNTRY@@", SafeXML.cleanGPX(ch.details.Country)));
-		trans.add(new Regex("@@CACHESTATE@@", SafeXML.cleanGPX((ch.details.State))));
-		trans.add(new Regex("@@CACHEHTML@@", ch.is_HTML() ? TRUE : FALSE));
-		trans.add(new Regex("@@CACHESHORTDESCRIPTION@@","CacheWolf can not provide a short description"));
-		trans.add(new Regex("@@CACHELONGDESCRIPTION@@", SafeXML.cleanGPX(formatLongDescription(ch))));
-		trans.add(new Regex("@@CACHEHINT@@", SafeXML.cleanGPX(ch.details.Hints)));
+		return "    <groundspeak:cache id=\"".concat(ch.GetCacheID()).concat("\" available=\"").concat(ch.is_available() ? TRUE : FALSE).concat("\" archived=\"").concat(ch.is_archived() ? TRUE : FALSE).concat("\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\n")
+		.concat("      <groundspeak:name>").concat(SafeXML.cleanGPX(ch.getCacheName())).concat("</groundspeak:name>\n")
+		.concat("      <groundspeak:placed_by>").concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat("</groundspeak:placed_by>\n")
+		.concat("      <groundspeak:owner id=\"").concat("31415").concat("\">").concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat("@@CACHEOWNER@@</groundspeak:owner>\n")
+		.concat("      <groundspeak:type>").concat(CacheType.id2GpxString(ch.getType())).concat("</groundspeak:type>\n")
+		.concat("      <groundspeak:container>").concat(CacheSize.cw2ExportString(ch.getCacheSize())).concat("</groundspeak:container>\n")
+		.concat("      <groundspeak:difficulty>").concat(CacheTerrDiff.shortDT(ch.getHard())).concat("</groundspeak:difficulty>\n")
+		.concat("      <groundspeak:terrain>").concat(CacheTerrDiff.shortDT(ch.getTerrain())).concat("</groundspeak:terrain>\n")
+		.concat("      <groundspeak:country>").concat(SafeXML.cleanGPX(ch.details.Country)).concat("</groundspeak:country>\n")
+		.concat("      <groundspeak:state>").concat(SafeXML.cleanGPX(ch.details.State)).concat("</groundspeak:state>\n")
+		.concat("      <groundspeak:short_description html=\"").concat(ch.is_HTML() ? TRUE : FALSE).concat("\"></groundspeak:short_description>\n")
+		.concat("      <groundspeak:long_description html=\"").concat(ch.is_HTML() ? TRUE : FALSE).concat("\">").concat(SafeXML.cleanGPX(formatLongDescription(ch))).concat("</groundspeak:long_description>\n")
+		.concat("      <groundspeak:encoded_hints>").concat(SafeXML.cleanGPX(ch.details.Hints)).concat("</groundspeak:encoded_hints>\n")
+		.concat("      <groundspeak:logs>\n")
+		.concat(formatLogs(ch))
+		.concat("      </groundspeak:logs>\n")
+		.concat("      <groundspeak:travelbugs>\n")
+//		.concat(formatTbs(ch))
+		.concat("      </groundspeak:travelbugs>\n")
+		.concat("    </groundspeak:cache>\n");
 
-		ret.append(trans.replaceAll(GPXEXTENSION));
-
-		ret.append("\t\t\t<groundspeak:logs>\n");
-		ret.append(formatLogs(ch));
-		ret.append("\t\t\t</groundspeak:logs>\n");
-
-		// ret.append("\t\t\t<groundspeak:travelbugs>\n");
-		// ret.append(formatTbs(ch));
-		// ret.append("\t\t\t</groundspeak:travelbugs>\n");
-
-		ret.append("\t\t</groundspeak:cache>\n");
-		return ret.toString();
 	}
 
 	/**
@@ -747,7 +715,14 @@
 
 //			if (exportStyle == STYLE_GPX_MYFINDS) 
 //				logId = log.getLogId();
-			
+
+//			ret.append("        <groundspeak:log id=\"".concat(log.getLogId()).concat("@@LOGID@@\">\n")
+//			ret.append("        <groundspeak:log id=\"31415\">\n"
+//			.concat("          <groundspeak:date>").concat(log.getDate()).concat("</groundspeak:date>\n")
+//			.concat("          <groundspeak:type>").concat(image2TypeText(log.getIcon())).concat("</groundspeak:type>\n")
+//			.concat("          <groundspeak:finder id=\"@@LOGFINDERID@@\">@@LOGFINDER@@</groundspeak:finder>\n")
+//			.concat("          <groundspeak:text encoded=\"@@LOGENCODE@@\">@@LOGTEXT@@</groundspeak:text>\n")
+//			.concat("        </groundspeak:log>\n"));
 			Transformer trans = new Transformer(true);
 			trans.add(new Regex("@@LOGID@@", logId));
 			trans.add(new Regex("@@LOGDATE@@", log.getDate()));



From engywuck at mail.berlios.de  Sat Jul 18 09:45:18 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sat, 18 Jul 2009 09:45:18 +0200
Subject: [Cachewolf-svn] r2035 - in trunk/src/CacheWolf: . imp
Message-ID: <200907180745.n6I7jI2r003680@sheep.berlios.de>

Author: engywuck
Date: 2009-07-18 09:45:15 +0200 (Sat, 18 Jul 2009)
New Revision: 2035

Modified:
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Little (!) optimizations.

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2009-07-17 17:04:50 UTC (rev 2034)
+++ trunk/src/CacheWolf/Attributes.java	2009-07-18 07:45:15 UTC (rev 2035)
@@ -62,7 +62,7 @@
 	 * Prepare for attributes to be written to cache.xml file 
 	 */
 	public String XmlAttributesWrite(){
-		StringBuffer sb=new StringBuffer(1000);
+		StringBuffer sb=new StringBuffer(3*count+2);
 		sb.append("<ATTRIBUTES>\n");
 		for (int i=0; i<count; i++) {
 			sb.append("   <ATT>");

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2009-07-17 17:04:50 UTC (rev 2034)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2009-07-18 07:45:15 UTC (rev 2035)
@@ -135,7 +135,7 @@
 	 * @param chD
 	 */
 	private String getPicDesc(int imagesShown,CacheHolderDetail chD) {
-		StringBuffer sb=new StringBuffer(1000);
+		StringBuffer sb=new StringBuffer(chD.images.size()*7+5);
 		sb.append("<hr><font size=\"+1\" color=\"red\">").append(MyLocale.getMsg(202,"IMAGES").toUpperCase()).append("</font>");
 		sb.append("<br><br>");
 		for (int i=imagesShown; i<chD.images.size(); i++) {

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-17 17:04:50 UTC (rev 2034)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-18 07:45:15 UTC (rev 2035)
@@ -176,7 +176,7 @@
 				//Ok now login!
 				try{
 					pref.log("[login]:Logging in as "+pref.myAlias);
-					StringBuffer sb=new StringBuffer(1000);
+					StringBuffer sb=new StringBuffer(30);
 					sb.append(URL.encodeURL("__VIEWSTATE",false));	sb.append("="); sb.append(URL.encodeURL(viewstate,false));
 					sb.append("&ctl00%24ContentBody%24"); sb.append(URL.encodeURL("myUsername",false));
 					sb.append("="); sb.append(encodeUTF8URL(Utils.encodeJavaUtf8String(pref.myAlias)));
@@ -1607,7 +1607,7 @@
 	private static String getResponseHeaders(HttpConnection conn) {
 		PropertyList pl = conn.documentProperties;
 		if (pl != null) {
-			StringBuffer sb = new StringBuffer(1000);
+			StringBuffer sb = new StringBuffer(pl.size()*4+1);
 			boolean gotany = false;
 
 			for (int i = 0; i < pl.size(); i++) {
@@ -1618,7 +1618,8 @@
 				}
 			}
 			if (gotany)
-				return sb.toString() + "\r\n";
+				sb.append("\r\n");
+				return sb.toString();
 		}
 		return "";
 	}



From engywuck at mail.berlios.de  Sat Jul 18 14:36:33 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sat, 18 Jul 2009 14:36:33 +0200
Subject: [Cachewolf-svn] r2036 - in trunk/src/CacheWolf: . imp
Message-ID: <200907181236.n6ICaXvB014419@sheep.berlios.de>

Author: engywuck
Date: 2009-07-18 14:36:31 +0200 (Sat, 18 Jul 2009)
New Revision: 2036

Modified:
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Better reverting last commit after checking implementation of StringBuffer... 

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2009-07-18 07:45:15 UTC (rev 2035)
+++ trunk/src/CacheWolf/Attributes.java	2009-07-18 12:36:31 UTC (rev 2036)
@@ -62,7 +62,7 @@
 	 * Prepare for attributes to be written to cache.xml file 
 	 */
 	public String XmlAttributesWrite(){
-		StringBuffer sb=new StringBuffer(3*count+2);
+		StringBuffer sb=new StringBuffer(1000);
 		sb.append("<ATTRIBUTES>\n");
 		for (int i=0; i<count; i++) {
 			sb.append("   <ATT>");

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2009-07-18 07:45:15 UTC (rev 2035)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2009-07-18 12:36:31 UTC (rev 2036)
@@ -135,7 +135,7 @@
 	 * @param chD
 	 */
 	private String getPicDesc(int imagesShown,CacheHolderDetail chD) {
-		StringBuffer sb=new StringBuffer(chD.images.size()*7+5);
+		StringBuffer sb=new StringBuffer(1000);
 		sb.append("<hr><font size=\"+1\" color=\"red\">").append(MyLocale.getMsg(202,"IMAGES").toUpperCase()).append("</font>");
 		sb.append("<br><br>");
 		for (int i=imagesShown; i<chD.images.size(); i++) {

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-18 07:45:15 UTC (rev 2035)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-07-18 12:36:31 UTC (rev 2036)
@@ -176,7 +176,7 @@
 				//Ok now login!
 				try{
 					pref.log("[login]:Logging in as "+pref.myAlias);
-					StringBuffer sb=new StringBuffer(30);
+					StringBuffer sb=new StringBuffer(1000);
 					sb.append(URL.encodeURL("__VIEWSTATE",false));	sb.append("="); sb.append(URL.encodeURL(viewstate,false));
 					sb.append("&ctl00%24ContentBody%24"); sb.append(URL.encodeURL("myUsername",false));
 					sb.append("="); sb.append(encodeUTF8URL(Utils.encodeJavaUtf8String(pref.myAlias)));
@@ -1607,7 +1607,7 @@
 	private static String getResponseHeaders(HttpConnection conn) {
 		PropertyList pl = conn.documentProperties;
 		if (pl != null) {
-			StringBuffer sb = new StringBuffer(pl.size()*4+1);
+			StringBuffer sb = new StringBuffer(1000);
 			boolean gotany = false;
 
 			for (int i = 0; i < pl.size(); i++) {
@@ -1618,8 +1618,7 @@
 				}
 			}
 			if (gotany)
-				sb.append("\r\n");
-				return sb.toString();
+				return sb.toString() + "\r\n";
 		}
 		return "";
 	}



From admin at berlios.de  Sat Jul 18 21:49:33 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 18 Jul 2009 21:49:33 +0200 (CEST)
Subject: [Bug #15262] getres.sh "lrmt"
Message-ID: <200907181949.n6IJnXFU022363@unicorn.berlios.de>

Bug #15262, was updated on 2009-Feb-13 20:21
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Other
Status: Open
Resolution: None
Bug Group: Fixed, ready to test
Priority: 5
Submitted by: greiol
Assigned to : greiol
Summary: getres.sh "l?rmt"

Details: getres.sh nutzt einige kommandos so, dass unn?tige fehlermeldungen entstehen (haupts?chlich fehlen ein paar -f optionen)

ein patch liegt unter http://cbr2008nrw.ohost.de/getresh.sh.patch.zip



Follow-Ups:

Date: 2009-Feb-13 22:58
By: pfeffer

Comment:
danke

1. ich kann den patch leider nicht anwenden. Bei mir ist das R in getres.sh kleingeschrieben und liegt unter programs.

2. l?sst sich Dein ge?ndertes skript auch mit sh statt mit bash ausf?hren?

da es bei mir nicht klappt, wendet den patch jemand anders an?

Gru?,
   Pfeffer.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15262&group_id=2211


From admin at berlios.de  Sat Jul 18 21:49:57 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 18 Jul 2009 21:49:57 +0200 (CEST)
Subject: [Cachewolf-svn] [Bug #15475] exportierte GPX Dateien in MapSource
	nicht lesbar
Message-ID: <200907181949.n6IJnv5c022840@unicorn.berlios.de>

Bug #15475, was updated on 2009-Apr-02 20:08
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Fixed, ready to test
Priority: 5
Submitted by: tester1111
Assigned to : greiol
Summary: exportierte GPX Dateien in MapSource nicht lesbar

Details: Hallo Entwickler von Cachewolf,

ich habe einige Caches als test.gpx Datei exportiert.
Wenn ich diese test.gpx Datei in MapSource ?ffnen m?chte kommt der Fehler: "test.gpx ist keine zul?ssige MapSourceDatei und konnte nicht ge?ffnet werden."

Ich habe so lange Caches aus der Datei entfernt bis MapSource die Datei wieder akzeptiert hat. Dabei ist mir aufgefallen, das in einem Cache ein ung?ltiges Zeichen (EOT / 04hex) drin stand.

Daraufhin habe ich mir die Seite auf Geocaching.com angesehen und entdeckt, dass in der Cachebeschreibung seltsame Zeichen benutzt wurden.

Der Cache, bei dem dies aufgetreten ist hei?t "New Year's Cache 2008" (GC188DE).

Vielleicht kann man solche Zeichen (wie z.B. EOT) beim Export entfernen.


Gru? Franz

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15475&group_id=2211


From admin at berlios.de  Sat Jul 18 21:50:30 2009
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 18 Jul 2009 21:50:30 +0200 (CEST)
Subject: [Cachewolf-svn] [Bug #15147] Garmin Export obsolet
Message-ID: <200907181950.n6IJoUWZ023370@unicorn.berlios.de>

Bug #15147, was updated on 2009-Jan-28 20:39
Here is a current snapshot of the bug.

Project: CacheWolf
Category: Import/Export
Status: Open
Resolution: None
Bug Group: Fixed, ready to test
Priority: 5
Submitted by: greiol
Assigned to : greiol
Summary: Garmin Export obsolet

Details: Der derzeitige Garmin Export via Men? erzeugt PCX5 Dateien. PCX5 wird seit vielen Versionen nicht mehr von Garmin unterst?tzt und kommt auch mit den "neuen langen" WP Identifiern von GC.com zurecht.

Vorschlag: entfernen

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=15147&group_id=2211


From greiol at mail.berlios.de  Sat Jul 18 23:29:16 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sat, 18 Jul 2009 23:29:16 +0200
Subject: [Cachewolf-svn] r2037 - trunk/src/CacheWolf
Message-ID: <200907182129.n6ILTGYZ021699@sheep.berlios.de>

Author: greiol
Date: 2009-07-18 23:29:15 +0200 (Sat, 18 Jul 2009)
New Revision: 2037

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
make terrain and difficulty editable

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-18 12:36:31 UTC (rev 2036)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-18 21:29:15 UTC (rev 2037)
@@ -19,14 +19,15 @@
 	mChoice chcType = new mChoice(CacheType.guiTypeStrings(), 0);
 	mChoice chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
 
-	mComboBox chcStatus = new mComboBox(new String[] { "", MyLocale.getMsg(313, "Flag 1"),
-	        MyLocale.getMsg(314, "Flag 2"), MyLocale.getMsg(315, "Flag 3"),
-	        MyLocale.getMsg(316, "Flag 4"), MyLocale.getMsg(317, "Search"),
-	        MyLocale.getMsg(318, "Found"), MyLocale.getMsg(319, "Not Found"),
-	        MyLocale.getMsg(320, "Owner") }, 0);
+	mComboBox chcStatus = new mComboBox(new String[] { "",
+			MyLocale.getMsg(313, "Flag 1"), MyLocale.getMsg(314, "Flag 2"),
+			MyLocale.getMsg(315, "Flag 3"), MyLocale.getMsg(316, "Flag 4"),
+			MyLocale.getMsg(317, "Search"), MyLocale.getMsg(318, "Found"),
+			MyLocale.getMsg(319, "Not Found"), MyLocale.getMsg(320, "Owner") },
+			0);
 
-	mButton btnNewWpt, btnShowBug, btnShowMap, btnGoto, btnAddPicture, btnBlack, btnNotes, btnSave,
-	        btnCancel;
+	mButton btnNewWpt, btnShowBug, btnShowMap, btnGoto, btnAddPicture,
+			btnBlack, btnNotes, btnSave, btnCancel;
 	mButton btnFoundDate, btnHiddenDate;
 	CellPanel pnlTools = new CellPanel();
 	mTextPad mNotes;
@@ -35,7 +36,8 @@
 	mImage imgBlackNo;
 	mImage imgShowBug, imgShowBugNo, imgNewWpt, imgGoto;
 	mImage imgShowMaps, imgAddImages, imgNotes;
-	mLabel lblDiff, lblTerr, lblAddiCount;
+	mLabel lblAddiCount;
+	mButton btnTerr, btnDiff;
 
 	CacheDB cacheDB;
 	CacheHolder thisCache;
@@ -53,7 +55,6 @@
 	Preferences pref; // Test
 	Profile profile;
 
-
 	public DetailsPanel() {
 		pref = Global.getPref();
 		profile = Global.getProfile();
@@ -67,16 +68,16 @@
 		if (Vm.isMobile() && sw >= 400)
 			imagesize = "_vga";
 		// Button 1: New Waypoint
-		pnlTools.addNext(btnNewWpt = new mButton(imgNewWpt = new mImage("newwpt" + imagesize
-		        + ".png")));
+		pnlTools.addNext(btnNewWpt = new mButton(imgNewWpt = new mImage(
+				"newwpt" + imagesize + ".png")));
 		btnNewWpt.setToolTip(MyLocale.getMsg(311, "Create Waypoint"));
 		PenEvent.wantPenMoved(btnNewWpt, PenEvent.WANT_PEN_MOVED_ONOFF, true);
 		imgNewWpt.transparentColor = new Color(255, 0, 0);
 		// Button 2: Goto
 		pnlTools.addNext(btnGoto = new mButton(imgGoto = new mImage("goto" + imagesize + ".png")));// Goto.gif
-																									// funzt
-																									// manchmal
-																									// nicht
+		// funzt
+		// manchmal
+		// nicht
 		imgGoto.transparentColor = Color.White;
 		btnGoto.setToolTip(MyLocale.getMsg(345, "Goto these coordinates"));
 		// Button 3: Travelbugs
@@ -86,12 +87,10 @@
 		// btnShowBug.modify(Control.Disabled,0);
 		btnShowBug.setToolTip(MyLocale.getMsg(346, "Show travelbugs"));
 		// Button 4: Show Map
-		pnlTools.addNext(btnShowMap = new mButton(imgShowMaps = new mImage("globe_small"
-		        + imagesize + ".gif")));
+		pnlTools.addNext(btnShowMap = new mButton(imgShowMaps = new mImage("globe_small" + imagesize + ".gif")));
 		btnShowMap.setToolTip(MyLocale.getMsg(347, "Show map"));
 		// Button 5: Add images
-		pnlTools.addNext(btnAddPicture = new mButton(imgAddImages = new mImage("images" + imagesize
-		        + ".gif")));
+		pnlTools.addNext(btnAddPicture = new mButton(imgAddImages = new mImage("images" + imagesize + ".gif")));
 		btnAddPicture.setToolTip(MyLocale.getMsg(348, "Add user pictures"));
 		// Button 6: Toggle blacklist status
 		imgBlackNo = new mImage("no_black" + imagesize + ".png");
@@ -101,85 +100,64 @@
 		pnlTools.addNext(btnBlack = new mButton(imgBlackNo));
 		btnBlack.setToolTip(MyLocale.getMsg(349, "Toggle Blacklist status"));
 		// Button 7: Notes
-		pnlTools
-		        .addNext(btnNotes = new mButton(imgNotes = new mImage("notes" + imagesize + ".gif")));
+		pnlTools.addNext(btnNotes = new mButton(imgNotes = new mImage("notes" + imagesize + ".gif")));
 		imgNotes.transparentColor = Color.DarkBlue;
 		btnNotes.setToolTip(MyLocale.getMsg(351, "Add/Edit notes"));
 		// Button 8: Date/time stamp
-		pnlTools
-		        .addLast(btnAddDateTime = new mButton(new mImage("date_time" + imagesize + ".gif")));
+		pnlTools.addLast(btnAddDateTime = new mButton(new mImage("date_time" + imagesize + ".gif")));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
 		// showMap.modify(Control.Disabled,0);
 		pnlTools.stretchFirstRow = true;
-		this.addLast(pnlTools, CellConstants.DONTSTRETCH, CellConstants.WEST).setTag(SPAN,
-		        new Dimension(3, 1));
+		this.addLast(pnlTools, CellConstants.DONTSTRETCH, CellConstants.WEST).setTag(SPAN, new Dimension(3, 1));
 		;
 
 		// //////////////////
 		// Main body of screen
 		// //////////////////
 
-		this.addNext(new mLabel(MyLocale.getMsg(300, "Type:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.NORTHWEST));
+		this.addNext(new mLabel(MyLocale.getMsg(300, "Type:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
 		CellPanel line1Panel = new CellPanel();
 		chcType.alwaysDrop = true;
-		line1Panel.addNext(chcType, CellConstants.HSTRETCH,
-		        (CellConstants.HFILL | CellConstants.WEST));
-		line1Panel.addLast(lblDiff = new mLabel(MyLocale.getMsg(1000, "D") + ": 5.5"),
-		        CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
-		this.addLast(line1Panel, DONTSTRETCH, HFILL)
-		        .setTag(CellConstants.SPAN, new Dimension(2, 1));
+		line1Panel.addNext(chcType, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 
-		this.addNext(new mLabel(MyLocale.getMsg(301, "Size:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.WEST));
+		line1Panel.addLast(btnDiff = new mButton(MyLocale.getMsg(1000, "D")	+ ": 5.5"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
+
+		this.addLast(line1Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+
+		this.addNext(new mLabel(MyLocale.getMsg(301, "Size:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		CellPanel line2Panel = new CellPanel();
 		chcSize.alwaysDrop = true;
-		line2Panel.addNext(chcSize, CellConstants.HSTRETCH,
-		        (CellConstants.HFILL | CellConstants.WEST));
-		line2Panel.addLast(lblTerr = new mLabel(MyLocale.getMsg(1001, "T") + ": 5.5"),
-		        CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
-		this.addLast(line2Panel, DONTSTRETCH, HFILL)
-		        .setTag(CellConstants.SPAN, new Dimension(2, 1));
+		line2Panel.addNext(chcSize, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 
-		this.addNext(new mLabel(MyLocale.getMsg(302, "Waypoint:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.WEST));
+		line2Panel.addLast(btnTerr = new mButton(MyLocale.getMsg(1001, "T")	+ ": 5.5"), CellConstants.DONTSTRETCH,
+				(CellConstants.DONTFILL | CellConstants.EAST));
+		this.addLast(line2Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+
+		this.addNext(new mLabel(MyLocale.getMsg(302, "Waypoint:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		line2Panel = new CellPanel();
-		line2Panel.addNext(inpWaypoint, CellConstants.HSTRETCH,
-		        (CellConstants.HFILL | CellConstants.WEST));
-		line2Panel.addLast(lblAddiCount = new mLabel(MyLocale.getMsg(1044, "Addis")+": 888"),
-		        CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
-		this.addLast(line2Panel, DONTSTRETCH, HFILL)
-		        .setTag(CellConstants.SPAN, new Dimension(2, 1));
+		line2Panel.addNext(inpWaypoint, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		line2Panel.addLast(lblAddiCount = new mLabel(MyLocale.getMsg(1044, "Addis") + ": 888"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
+		this.addLast(line2Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
-		this.addNext(new mLabel(MyLocale.getMsg(303, "Name:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.WEST));
-		this.addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)),
-		        CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		this.addNext(new mLabel(MyLocale.getMsg(303, "Name:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		this.addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 
-		this.addNext(new mLabel(MyLocale.getMsg(304, "Location:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.WEST));
-		this.addLast(btnWayLoc.setTag(CellConstants.SPAN, new Dimension(2, 1)),
-		        CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		this.addNext(new mLabel(MyLocale.getMsg(304, "Location:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		this.addLast(btnWayLoc.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 
-		this.addNext(new mLabel(MyLocale.getMsg(307, "Status:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.WEST));
+		this.addNext(new mLabel(MyLocale.getMsg(307, "Status:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		CellPanel cp = new CellPanel();
 		cp.addNext(chcStatus, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		cp.addLast(btnFoundDate = new mButton(new mImage("calendar" + imagesize + ".png")),
-		        DONTSTRETCH, DONTFILL);
-		this.addLast(cp, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
+		cp.addLast(btnFoundDate = new mButton(new mImage("calendar" + imagesize + ".png")), DONTSTRETCH, DONTFILL);
+		this.addLast(cp, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
-		this.addNext(new mLabel(MyLocale.getMsg(306, "Owner:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.WEST));
-		this.addLast(inpOwner.setTag(CellConstants.SPAN, new Dimension(2, 1)),
-		        CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		this.addNext(new mLabel(MyLocale.getMsg(306, "Owner:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		this.addLast(inpOwner.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 
-		this.addNext(new mLabel(MyLocale.getMsg(305, "Hidden on:")), CellConstants.DONTSTRETCH,
-		        (CellConstants.DONTFILL | CellConstants.WEST));
+		this.addNext(new mLabel(MyLocale.getMsg(305, "Hidden on:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		CellPanel ip = new CellPanel();
 		ip.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		ip.addLast(btnHiddenDate = new mButton(new mImage("calendar" + imagesize + ".png")),
-		        DONTSTRETCH, DONTFILL);
+		ip.addLast(btnHiddenDate = new mButton(new mImage("calendar" + imagesize + ".png")), DONTSTRETCH, DONTFILL);
 		this.addLast(ip, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
 		inpHidden.modifyAll(DisplayOnly, 0);
 
@@ -188,8 +166,7 @@
 
 		if ((MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600)) {
 			isBigScreen = true;
-			this.addLast(new mLabel(MyLocale.getMsg(308, "Notes:")), CellConstants.DONTSTRETCH,
-			        (CellConstants.DONTFILL | CellConstants.WEST));
+			this.addLast(new mLabel(MyLocale.getMsg(308, "Notes:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 			mNotes = new mTextPad();
 			mNotes.modify(ControlConstants.NotEditable, 0);
 			this.addLast(new MyScrollBarPanel(mNotes));
@@ -235,7 +212,8 @@
 			chcStatus.setText(MyLocale.getMsg(318, "Found") + " " + ch.getCacheStatus());
 		} else {
 			chcStatus.setText(ch.getCacheStatus());
-			// If the cache status contains a date, do not overwrite it with 'found' message
+			// If the cache status contains a date, do not overwrite it with
+			// 'found' message
 			if (ch.is_found() == true)
 				chcStatus.setText(MyLocale.getMsg(318, "Found"));
 		}
@@ -262,61 +240,62 @@
 
 		attV.showImages(ch.getCacheDetails(true).attributes);
 		if (ch.isAddiWpt() || ch.getType() == CacheType.CW_TYPE_CUSTOM) {
-			lblTerr.setText("");
-			lblDiff.setText("");
+			btnTerr.setText("T: -.-");
+			btnDiff.setText("D: -.-");
+			deactivatControl(btnTerr);
+			deactivatControl(btnDiff);
 		} else {
+			activateControl(btnTerr);
+			activateControl(btnDiff);
 			if (CacheTerrDiff.isValidTD(ch.getTerrain())) {
-				lblTerr.setText(MyLocale.getMsg(1001, "T") + ": "
-				        + CacheTerrDiff.longDT(ch.getTerrain()));
+				btnTerr.setText(MyLocale.getMsg(1001, "T") + ": " + CacheTerrDiff.longDT(ch.getTerrain()));
 			} else {
-				lblTerr.setText("");
+				btnTerr.setText("T: -.-");
 				ch.setIncomplete(true);
 				if (Global.getPref().debug)
-					Global.getPref()
-					        .log(ch.getWayPoint() + " has wrong terrain " + ch.getTerrain());
+					Global.getPref().log(ch.getWayPoint() + " has wrong terrain " + ch.getTerrain());
 			}
 			if (CacheTerrDiff.isValidTD(ch.getHard())) {
-				lblDiff.setText(MyLocale.getMsg(1000, "D") + ": "
-				        + CacheTerrDiff.longDT(ch.getHard()));
+				btnDiff.setText(MyLocale.getMsg(1000, "D") + ": " + CacheTerrDiff.longDT(ch.getHard()));
 			} else {
-				lblDiff.setText("");
+				btnDiff.setText("D: -.-");
 				ch.setIncomplete(true);
 				if (Global.getPref().debug)
-					Global.getPref()
-					        .log(ch.getWayPoint() + " has wrong difficulty " + ch.getHard());
+					Global.getPref().log(ch.getWayPoint() + " has wrong difficulty " + ch.getHard());
 			}
 		}
 		int addiCount = 0;
-		if (ch.mainCache==null) {
+		if (ch.mainCache == null) {
 			addiCount = ch.addiWpts.size();
 		} else {
 			addiCount = ch.mainCache.addiWpts.size();
 		}
-		lblAddiCount.setText( MyLocale.getMsg(1044, "Addis")+": "+String.valueOf(addiCount)); 
+		lblAddiCount.setText(MyLocale.getMsg(1044, "Addis") + ": " + String.valueOf(addiCount));
 
 		if (isBigScreen)
 			mNotes.setText(ch.getExistingDetails().getCacheNotes());
 	}
 
 	/**
-	 * if is addi -> returns the respective AddiWpt if is main -> returns the respective MainWpt
+	 * if is addi -> returns the respective AddiWpt if is main -> returns the
+	 * respective MainWpt
 	 */
 	public void createWptName() {
 		String wpt = inpWaypoint.getText().toUpperCase();
-		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-		        && (Global.mainTab.mainCache.startsWith("GC")
-		                || Global.mainTab.mainCache.startsWith("OC") || Global.mainTab.mainCache
-		                .startsWith("CW")) && wpt.startsWith("CW")) {
+		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) && 
+				(Global.mainTab.mainCache.startsWith("GC") || 
+					Global.mainTab.mainCache.startsWith("OC") || 
+					Global.mainTab.mainCache.startsWith("CW")) 
+				&& wpt.startsWith("CW")) {
 			// for what was this?:
-			Global.mainTab.lastselected = Global.mainTab.mainCache; // I don't know exactly, but
-																	// it's needed for creating a
-																	// series of Addis
+			Global.mainTab.lastselected = Global.mainTab.mainCache; // I don't know exactly, but it's needed for creating a series of Addis
 
-			inpWaypoint.setText(Global.getProfile()
-			        .getNewAddiWayPointName(Global.mainTab.mainCache));
+			inpWaypoint.setText(Global.getProfile().getNewAddiWayPointName(
+					Global.mainTab.mainCache));
 		}
 		if (!CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-		        && !(wpt.startsWith("GC") || wpt.startsWith("OC") || wpt.startsWith("CW"))) {
+				&& !(wpt.startsWith("GC") || wpt.startsWith("OC") || wpt
+						.startsWith("CW"))) {
 			inpWaypoint.setText(Global.getProfile().getNewWayPointName());
 		}
 	}
@@ -339,35 +318,38 @@
 		}
 		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
 			if (ev.target == btnNotes) {
-				dirty_notes = true; // TODO I think this is redundant, because the notes are saved
-									// seperately by the notes screen itself
-				NotesScreen nsc = new NotesScreen(thisCache.getCacheDetails(true));
+				dirty_notes = true; // TODO I think this is redundant, because
+									// the notes are saved
+				// seperately by the notes screen itself
+				NotesScreen nsc = new NotesScreen(thisCache
+						.getCacheDetails(true));
 				nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
 				if (isBigScreen)
 					mNotes.setText(thisCache.getCacheDetails(true).getCacheNotes());
 			} else if (ev.target == btnShowMap) {
 				Global.mainTab.SwitchToMovingMap(thisCache.pos, true);
 				/*
-				 * try { MapDetailForm mdf = new MapDetailForm(thisCache.wayPoint, pref, profile);
-				 * mdf.execute(); } catch (IllegalArgumentException e) { MessageBox tmp = new
-				 * MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(322,"Kann Bild/Karte
-				 * nicht finden")+": "+e.getMessage(), MessageBox.OKB); tmp.exec(); }
-				 */} else if (ev.target == btnShowBug) {
-				// InfoScreen is = new InfoScreen(thisCache.Travelbugs.toHtml(), "Travelbugs",
+				 * try { MapDetailForm mdf = new
+				 * MapDetailForm(thisCache.wayPoint, pref, profile);
+				 * mdf.execute(); } catch (IllegalArgumentException e) {
+				 * MessageBox tmp = new MessageBox(MyLocale.getMsg(321,"Error"),
+				 * MyLocale.getMsg(322,"Kann Bild/Karte nicht finden")+":
+				 * "+e.getMessage(), MessageBox.OKB); tmp.exec(); }
+				 */
+			} else if (ev.target == btnShowBug) {
+				// InfoScreen is = new InfoScreen(thisCache.Travelbugs.toHtml(),
+				// "Travelbugs",
 				// false, pref);
 				// is.execute();
-				TravelbugInCacheScreen ts = new TravelbugInCacheScreen(thisCache
-				        .getCacheDetails(true).Travelbugs.toHtml(), "Travelbugs");
+				TravelbugInCacheScreen ts = new TravelbugInCacheScreen(thisCache.getCacheDetails(true).Travelbugs.toHtml(),	"Travelbugs");
 				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
 			} else if (ev.target == btnCenter) {
 				CWPoint cp = new CWPoint(thisCache.LatLon);
 				if (!cp.isValid()) {
 					MessageBox tmpMB = new MessageBox(
-					        MyLocale.getMsg(312, "Error"),
-					        MyLocale
-					                .getMsg(4111,
-					                        "Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM"),
-					        FormBase.OKB);
+							MyLocale.getMsg(312, "Error"),
+							MyLocale.getMsg(4111, "Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM"),
+							FormBase.OKB);
 					tmpMB.exec();
 				} else {
 					pref.curCentrePt.set(cp);
@@ -412,7 +394,7 @@
 				Global.mainTab.newWaypoint(ch);
 			} else if (ev.target == btnGoto) {
 				// TODO if something changed saveWpt();
-				Global.mainTab.gotoP.setDestinationAndSwitch(thisCache); 
+				Global.mainTab.gotoP.setDestinationAndSwitch(thisCache);
 			} else if (ev.target == btnWayLoc) {
 				CWPoint coords = new CWPoint(btnWayLoc.getText(), CWPoint.CW);
 				CoordsScreen cs = new CoordsScreen(true);
@@ -420,8 +402,7 @@
 				if (cs.execute() == FormBase.IDOK) {
 					dirty_details = true;
 					coords = cs.getCoords();
-					Global.getProfile().notifyUnsavedChanges(
-					        !thisCache.pos.toString().equals(coords.toString()));
+					Global.getProfile().notifyUnsavedChanges(!thisCache.pos.toString().equals(coords.toString()));
 					thisCache.pos.set(coords);
 					btnWayLoc.setText(coords.toString());
 					thisCache.LatLon = coords.toString();
@@ -452,8 +433,10 @@
 				dc.reset(t);
 				if (dc.execute() == ewe.ui.FormBase.IDOK) {
 					chcStatus.setText(MyLocale.getMsg(318, "Found") + " "
-					        + Convert.toString(dc.year) + "-" + MyLocale.formatLong(dc.month, "00")
-					        + "-" + MyLocale.formatLong(dc.day, "00") + " " + dc.time);
+									+ Convert.toString(dc.year) + "-"
+									+ MyLocale.formatLong(dc.month, "00") + "-"
+									+ MyLocale.formatLong(dc.day, "00") + " "
+									+ dc.time);
 					dirty_details = true;
 					// profile.hasUnsavedChanges=true;
 				}
@@ -464,64 +447,104 @@
 				dc.setPreferredSize(240, 240);
 				if (inpHidden.getText().length() == 10)
 					try {
-						dc.setDate(new Time(Convert.parseInt(inpHidden.getText().substring(8)),
-						        Convert.parseInt(inpHidden.getText().substring(5, 7)), Convert
-						                .parseInt(inpHidden.getText().substring(0, 4))));
+						dc.setDate(new Time(Convert.parseInt(inpHidden
+								.getText().substring(8)), Convert
+								.parseInt(inpHidden.getText().substring(5, 7)),
+								Convert.parseInt(inpHidden.getText().substring(
+										0, 4))));
 					} catch (NumberFormatException e) {
 						dc.reset(new Time());
 					}
 				if (dc.execute() == ewe.ui.FormBase.IDOK) {
 					inpHidden.setText(Convert.toString(dc.year) + "-"
-					        + MyLocale.formatLong(dc.month, "00") + "-"
-					        + MyLocale.formatLong(dc.day, "00"));
+							+ MyLocale.formatLong(dc.month, "00") + "-"
+							+ MyLocale.formatLong(dc.day, "00"));
 					dirty_details = true;
 					// profile.hasUnsavedChanges=true;
 				}
+			} else if (ev.target == this.btnTerr) {
+				int returnValue;
+				TerrDiffForm tdf = new TerrDiffForm(true, thisCache
+						.getTerrain());
+				returnValue = tdf.execute();
+				if (returnValue == 1 && tdf.getDT() != thisCache.getTerrain()) {
+					thisCache.setTerrain(tdf.getDT());
+					btnTerr.setText(MyLocale.getMsg(1001, "T") + ": "
+							+ CacheTerrDiff.longDT(thisCache.getTerrain()));
+					dirty_details = true;
+				}
+			} else if (ev.target == this.btnDiff) {
+				int returnValue;
+				TerrDiffForm tdf = new TerrDiffForm(false, thisCache.getHard());
+				returnValue = tdf.execute();
+				if (returnValue == 1 && tdf.getDT() != thisCache.getHard()) {
+					thisCache.setHard(tdf.getDT());
+					btnDiff.setText(MyLocale.getMsg(1000, "D") + ": "
+							+ CacheTerrDiff.longDT(thisCache.getHard()));
+					dirty_details = true;
+				}
 			}
 			ev.consumed = true;
 		}
 	}
+	
+	private void activateControl(Control ctrl) {
+		if (ctrl.change(0, ControlConstants.Disabled))
+			ctrl.repaint();
+	}
+	
+	private void deactivatControl(Control ctrl) {
+		if (ctrl.change(ControlConstants.Disabled, 0))
+			ctrl.repaint();
+	}
 
 	public void saveDirtyWaypoint() {
-		// We have to update two objects: thisCache (a CacheHolderDetail) which contains
+		// We have to update two objects: thisCache (a CacheHolderDetail) which
+		// contains
 		// the full cache which will be written to the cache.xml file AND
 		// the CacheHolder object which sits in cacheDB
 		// Strip the found message if the status contains a date
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, "Found"))
-		        && chcStatus.getText().length() >= MyLocale.getMsg(318, "Found").length() + 11) {
+				&& chcStatus.getText().length() >= MyLocale
+						.getMsg(318, "Found").length() + 11) {
 			thisCache.setCacheStatus(chcStatus.getText().substring(
-			        MyLocale.getMsg(318, "Found").length() + 1));
+					MyLocale.getMsg(318, "Found").length() + 1));
 		} else {
 			thisCache.setCacheStatus(chcStatus.getText());
 		}
 		if (!thisCache.is_found() && thisCache.getCacheStatus().length() >= 10
-		        && thisCache.getCacheStatus().charAt(4) == '-') {
-			// Use same heuristic condition as in setDetails(CacheHolder) to determine, if this
+				&& thisCache.getCacheStatus().charAt(4) == '-') {
+			// Use same heuristic condition as in setDetails(CacheHolder) to
+			// determine, if this
 			// cache
 			// has to considered as found.
 			thisCache.setFound(true);
 		} else {
-			thisCache.setFound(chcStatus.getText().startsWith(MyLocale.getMsg(318, "Found")));
+			thisCache.setFound(chcStatus.getText().startsWith(
+					MyLocale.getMsg(318, "Found")));
 		}
 		thisCache.setCacheOwner(inpOwner.getText().trim());
-		thisCache.setOwned(thisCache.getCacheStatus().equals(MyLocale.getMsg(320, "Owner")));
+		thisCache.setOwned(thisCache.getCacheStatus().equals(
+				MyLocale.getMsg(320, "Owner")));
 		// Avoid setting is_owned if alias is empty and username is empty
 		if (thisCache.is_owned() == false) {
-			thisCache.setOwned((!pref.myAlias.equals("") && pref.myAlias.equals(thisCache
-			        .getCacheOwner()))
-			        || (!pref.myAlias2.equals("") && pref.myAlias2
-			                .equals(thisCache.getCacheOwner())));
+			thisCache.setOwned((!pref.myAlias.equals("") && pref.myAlias
+					.equals(thisCache.getCacheOwner()))
+					|| (!pref.myAlias2.equals("") && pref.myAlias2
+							.equals(thisCache.getCacheOwner())));
 		}
 		thisCache.setBlack(blackStatus);
 		String oldWaypoint = thisCache.getWayPoint();
 		thisCache.setWayPoint(inpWaypoint.getText().toUpperCase().trim());
-		thisCache.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize.getText()));
+		thisCache.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize
+				.getText()));
 		// If the waypoint does not have a name, give it one
 		if (thisCache.getWayPoint().equals("")) {
 			thisCache.setWayPoint(profile.getNewWayPointName());
 		}
 		// Don't allow single letter names=> Problems in updateBearingDistance
-		// This is a hack but faster than slowing down the loop in updateBearingDistance
+		// This is a hack but faster than slowing down the loop in
+		// updateBearingDistance
 		if (thisCache.getWayPoint().length() < 2)
 			thisCache.setWayPoint(thisCache.getWayPoint() + " ");
 		thisCache.setCacheName(inpName.getText().trim());
@@ -529,53 +552,47 @@
 		thisCache.setDateHidden(inpHidden.getText().trim());
 		byte oldType = thisCache.getType();
 		thisCache.setType(CacheType.guiSelect2Cw(chcType.getInt()));
-		// thisCache.saveCacheDetails(profile.dataDir); // this is redundant, because all changes
+		// thisCache.saveCacheDetails(profile.dataDir); // this is redundant,
+		// because all changes
 		// affecting the details are immediately saved
 		// Now update the table
 		CacheHolder ch = thisCache; // TODO variable ch is redundant
 
 		/*
-		 * The references have to be rebuilt if: - the cachetype changed from addi->normal or
-		 * normal->addi - the old cachetype or the new cachetype were 'addi' and the waypointname
-		 * has changed
+		 * The references have to be rebuilt if: - the cachetype changed from
+		 * addi->normal or normal->addi - the old cachetype or the new cachetype
+		 * were 'addi' and the waypointname has changed
 		 */
 		if (CacheType.isAddiWpt(ch.getType()) != CacheType.isAddiWpt(oldType)
-		        || ((CacheType.isAddiWpt(ch.getType()) || CacheType.isAddiWpt(oldType)) && !thisCache
-		                .getWayPoint().equals(oldWaypoint))) {
+				|| ((CacheType.isAddiWpt(ch.getType()) || CacheType
+						.isAddiWpt(oldType)) && !thisCache.getWayPoint()
+						.equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
 			if (CacheType.isAddiWpt(ch.getType())) {
 				int idx;
 				if (ch.getWayPoint().length() < 5)
 					idx = -1;
 				else {
-					idx = profile.getCacheIndex("GC"
-					        + ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
+					idx = profile.getCacheIndex("GC" + ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
 					if (idx < 0)
-						idx = profile.getCacheIndex("OC"
-						        + ch.getWayPoint()
-						                .substring(ch.getWayPoint().length() == 5 ? 1 : 2));
+						idx = profile.getCacheIndex("OC" + ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
 					if (idx < 0)
-						idx = profile.getCacheIndex("CW"
-						        + ch.getWayPoint()
-						                .substring(ch.getWayPoint().length() == 5 ? 1 : 2));
+						idx = profile.getCacheIndex("CW"+ ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
 					if (idx < 0)
 						(new MessageBox(
-						        MyLocale.getMsg(144, "Warning"),
-						        MyLocale.getMsg(734, "No main cache found for addi waypoint ")
-						                + " "
-						                + ch.getWayPoint()
-						                + "\n"
-						                + MyLocale
-						                        .getMsg(
-						                                735,
-						                                "Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),
-						        FormBase.OKB)).execute();
+								MyLocale.getMsg(144, "Warning"),
+								MyLocale.getMsg(734,"No main cache found for addi waypoint ")
+										+ " "+ ch.getWayPoint()+ "\n"
+										+ MyLocale.getMsg(735,"Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),
+								FormBase.OKB)).execute();
 				}
-				profile.buildReferences(); // TODO this takes quite long -> use profile.setAddiRef
-											// instead
+				profile.buildReferences(); // TODO this takes quite long -> use
+											// profile.setAddiRef
+				// instead
 			} else {
-				profile.buildReferences(); // we have to do this to release the link between the
-											// two caches
+				profile.buildReferences(); // we have to do this to release the
+											// link between the
+				// two caches
 			}
 		}
 		// set status also on addi wpts
@@ -597,10 +614,11 @@
 			this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
 			disp.setHtml(text);
 			ScrollBarPanel sbp = new MyScrollBarPanel(disp,
-			        ScrollablePanel.NeverShowHorizontalScrollers);
+					ScrollablePanel.NeverShowHorizontalScrollers);
 			this.addLast(sbp);
-			this.addLast(btCancel = new mButton(MyLocale.getMsg(3000, "Close")),
-			        CellConstants.DONTSTRETCH, CellConstants.FILL);
+			this.addLast(
+					btCancel = new mButton(MyLocale.getMsg(3000, "Close")),
+					CellConstants.DONTSTRETCH, CellConstants.FILL);
 		}
 
 		public void onEvent(Event ev) {
@@ -618,16 +636,18 @@
 			Menu mnuPopup;
 
 			DispPanel() {
-				TBMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(6016,
-				        "Pick up Travelbug"));
-				TBMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6017, "Drop Travelbug"));
+				TBMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(
+						6016, "Pick up Travelbug"));
+				TBMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6017,
+						"Drop Travelbug"));
 				mnuPopup = new Menu(TBMenuItems, "");
 			}
 
 			public void penRightReleased(Point p) {
 				setMenu(mnuPopup);
-				doShowMenu(p); // direct call (not through doMenu) is neccesary because it will
-								// exclude the whole table
+				doShowMenu(p); // direct call (not through doMenu) is neccesary
+								// because it will
+				// exclude the whole table
 			}
 
 			public void penHeld(Point p) {
@@ -637,33 +657,33 @@
 
 			public void popupMenuEvent(Object selectedItem) {
 				if (selectedItem == mnuPickupTB) {
-					Travelbug tb = TravelbugPickup
-					        .pickupTravelbug(thisCache.getCacheDetails(true).Travelbugs);
+					Travelbug tb = TravelbugPickup.pickupTravelbug(thisCache.getCacheDetails(true).Travelbugs);
 					if (tb != null) {
 						dirty_details = true;
 						// Get the list of my travelbugs
 						tbjList = new TravelbugJourneyList();
 						tbjList.readTravelbugsFile();
 						// Add the tb to this list
-						tbjList.addTbPickup(tb, Global.getProfile().name, thisCache.getWayPoint());
+						tbjList.addTbPickup(tb, Global.getProfile().name,
+								thisCache.getWayPoint());
 						tbjList.saveTravelbugsFile();
 						tbjList = null;
 						setHtml(thisCache.getCacheDetails(true).Travelbugs.toHtml());
 						repaint();
-						thisCache
-						        .setHas_bugs(thisCache.getCacheDetails(true).Travelbugs.size() > 0);
+						thisCache.setHas_bugs(thisCache.getCacheDetails(true).Travelbugs.size() > 0);
 					}
 				} else if (selectedItem == mnuDropTB) {
 					tbjList = new TravelbugJourneyList();
 					tbjList.readTravelbugsFile();
 					TravelbugList tbl = tbjList.getMyTravelbugs();
-					TravelbugScreen tbs = new TravelbugScreen(tbl, MyLocale.getMsg(6017,
-					        "Drop a travelbug"), false);
+					TravelbugScreen tbs = new TravelbugScreen(tbl, MyLocale
+							.getMsg(6017, "Drop a travelbug"), false);
 					tbs.execute();
 					if (tbs.selectedItem >= 0) {
 						Travelbug tb = tbl.getTB(tbs.selectedItem);
 						thisCache.getCacheDetails(true).Travelbugs.add(tb);
-						tbjList.addTbDrop(tb, Global.getProfile().name, thisCache.getWayPoint());
+						tbjList.addTbDrop(tb, Global.getProfile().name,
+								thisCache.getWayPoint());
 					}
 					tbjList.saveTravelbugsFile();
 					tbjList = null;
@@ -677,4 +697,38 @@
 		}
 	}
 
+	private class TerrDiffForm extends Form {
+		private mChoice mcDT;
+		private mButton btnOk, btnCancel;
+		private String[] DT = new String[] { "1.0", "1.5", "2.0", "2.5", "3.0", "3.5", "4.0", "4.5", "5.0" };
+
+		public TerrDiffForm(boolean terrain, int startVal) {
+			mcDT = new mChoice(DT, (startVal > 0) ? (startVal - 10) / 5 : 0);
+			btnOk = new mButton(MyLocale.getMsg(1605, "OK"));
+			btnCancel = new mButton(MyLocale.getMsg(1604, "Cancel"));
+
+			resizable = false;
+			setTitle(MyLocale.getMsg(31415, "D & T"));
+
+			addNext(new mLabel(terrain ? MyLocale.getMsg(31415, "Terrain")
+					: MyLocale.getMsg(31415, "Difficulty")));
+			addLast(mcDT);
+			addButton(btnOk);
+			addButton(btnCancel);
+		}
+
+		public void onEvent(Event ev) {
+			if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
+				if (ev.target == btnCancel) {
+					close(-1);
+				} else if (ev.target == btnOk) {
+					close(1);
+				}
+			}
+		}
+
+		public byte getDT() {
+			return (byte) (mcDT.selectedIndex * 5 + 10);
+		}
+	}
 }



From greiol at mail.berlios.de  Sun Jul 19 10:37:03 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 19 Jul 2009 10:37:03 +0200
Subject: [Cachewolf-svn] r2038 - in trunk/src: CacheWolf CacheWolf/imp exp
Message-ID: <200907190837.n6J8b3W1019963@sheep.berlios.de>

Author: greiol
Date: 2009-07-19 10:36:59 +0200 (Sun, 19 Jul 2009)
New Revision: 2038

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/imp/Rating.java
   trunk/src/exp/GpxExportNg.java
   trunk/src/exp/OziExporter.java
Log:
added ch.isCustomWpt and ch.isCacheWpt

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-07-18 21:29:15 UTC (rev 2037)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-07-19 08:36:59 UTC (rev 2038)
@@ -181,7 +181,7 @@
 		            
 			        start = xmlString.indexOf('"', end + 1);
 			        end = xmlString.indexOf('"', start + 1);
-			        if (isAddiWpt() || getType() == CacheType.CW_TYPE_CUSTOM) {
+			        if (isAddiWpt() || isCustomWpt()) {
 			        	setHard(CacheTerrDiff.CW_DT_UNSET);
 			        } else {
 				        try {
@@ -194,7 +194,7 @@
 			        }
 			        start = xmlString.indexOf('"', end + 1);
 				    end = xmlString.indexOf('"', start + 1);
-				    if (isAddiWpt() || getType() == CacheType.CW_TYPE_CUSTOM) {
+				    if (isAddiWpt() || isCustomWpt()) {
 				    	setTerrain(CacheTerrDiff.CW_DT_UNSET);
 				    } else {
 					    try {
@@ -212,7 +212,7 @@
 	
 			        start = xmlString.indexOf('"', end + 1);
 			        end = xmlString.indexOf('"', start + 1);
-			        if (isAddiWpt() || getType() == CacheType.CW_TYPE_CUSTOM) {
+			        if (isAddiWpt() || isCustomWpt()) {
 			        	setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
 			        } else {
 				        try {
@@ -570,6 +570,14 @@
 	public boolean isAddiWpt() {
 		return CacheType.isAddiWpt(this.getType());
 	}
+	
+	public boolean isCustomWpt() {
+		return CacheType.isCustomWpt(getType());
+	}
+	
+	public boolean isCacheWpt() {
+		return CacheType.isCacheWpt(getType());
+	}
 
 	public boolean hasAddiWpt() {
 		if (this.addiWpts.getCount()>0) return true;
@@ -924,7 +932,7 @@
 		setCacheSize(byteFromLong(value, 4));
 		setNoFindLogs((byteFromLong(value, 5)));
 		if (getHard() == -1 || getTerrain() == -1 || getCacheSize() == -1) {
-			if (this.isAddiWpt() || this.getType()==CacheType.CW_TYPE_CUSTOM) {
+			if (isAddiWpt() || isCustomWpt()) {
 				// Addis don't have their own values for difficulty, terrain and size
 				// Custom waypoints can't be updated to remove incomplete flag, so we 
 				// have to set reasonable values.

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2009-07-18 21:29:15 UTC (rev 2037)
+++ trunk/src/CacheWolf/CacheType.java	2009-07-19 08:36:59 UTC (rev 2038)
@@ -316,6 +316,36 @@
 		
 	}
 	
+	public static final boolean isCacheWpt(byte type) {
+		switch (type) {
+		case CW_TYPE_TRADITIONAL: // fall through
+		case CW_TYPE_MULTI: // fall through
+		case CW_TYPE_VIRTUAL: // fall through
+		case CW_TYPE_LETTERBOX: // fall through
+		case CW_TYPE_EVENT: // fall through
+		case CW_TYPE_QUIZ: // fall through
+		case CW_TYPE_UNKNOWN: // fall through
+		case CW_TYPE_MOVING: // fall through
+		case CW_TYPE_DRIVE_IN: // fall through
+		case CW_TYPE_WEBCAM: // fall through
+		case CW_TYPE_LOCATIONLESS: // fall through
+		case CW_TYPE_CITO: // fall through
+		case CW_TYPE_MEGA_EVENT: // fall through
+		case CW_TYPE_WHEREIGO: // fall through
+		case CW_TYPE_EARTH: // fall through
+		case CW_TYPE_APE: // fall through
+		case CW_TYPE_MAZE: return true;
+		default: return false;
+		}
+	}
+	
+	public static final boolean isCustomWpt(byte type) {
+		if (type == CW_TYPE_CUSTOM)
+			return true;
+		else
+			return false;
+	}
+	
 	/**
 	 * create list of cache types to be shown in GUI drop down lists
 	 * @return list of cache types to be shown in GUI drop down list

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-18 21:29:15 UTC (rev 2037)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-19 08:36:59 UTC (rev 2038)
@@ -239,7 +239,7 @@
 		chcSize.setInt(ch.getCacheSize());
 
 		attV.showImages(ch.getCacheDetails(true).attributes);
-		if (ch.isAddiWpt() || ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+		if (ch.isAddiWpt() || ch.isCustomWpt()) {
 			btnTerr.setText("T: -.-");
 			btnDiff.setText("D: -.-");
 			deactivatControl(btnTerr);

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-18 21:29:15 UTC (rev 2037)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-19 08:36:59 UTC (rev 2038)
@@ -446,7 +446,7 @@
 		}
 		if ((name.equals("groundspeak:type") || name.equals("type")|| name.equals("terra:style"))&& inCache){
 			holder.setType(CacheType.gpxType2CwType(strData));
-			if (holder.getType() == CacheType.CW_TYPE_CUSTOM) {
+			if (holder.isCustomWpt()) {
 				holder.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
 				holder.setHard(CacheTerrDiff.CW_DT_UNSET);
 				holder.setTerrain(CacheTerrDiff.CW_DT_UNSET);

Modified: trunk/src/CacheWolf/imp/Rating.java
===================================================================
--- trunk/src/CacheWolf/imp/Rating.java	2009-07-18 21:29:15 UTC (rev 2037)
+++ trunk/src/CacheWolf/imp/Rating.java	2009-07-19 08:36:59 UTC (rev 2038)
@@ -40,7 +40,7 @@
 		for (int i = 0; i < Global.getProfile().cacheDB.size(); i++) {
 			CacheHolder ch = Global.getProfile().cacheDB.get(i);
 			if (ch.isVisible()) {
-				if (!ch.isAddiWpt() && ch.getType() != CacheType.CW_TYPE_CUSTOM) {
+				if (ch.isCacheWpt()) {
 					int rate;
 					try {
 						rate = CWWrapper.exec(rater, ch.getWayPoint(), true);

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-18 21:29:15 UTC (rev 2037)
+++ trunk/src/exp/GpxExportNg.java	2009-07-19 08:36:59 UTC (rev 2038)
@@ -501,7 +501,7 @@
 	 */
 	private String formatCache(CacheHolder ch) {
 		// no addis or custom in MyFindsPq - and of course only finds
-		if ((STYLE_GPX_MYFINDS == exportStyle) && ((ch.getType() == CacheType.CW_TYPE_CUSTOM) || ch.isAddiWpt() || !ch.is_found()))
+		if ((STYLE_GPX_MYFINDS == exportStyle) && (ch.isCustomWpt() || ch.isAddiWpt() || !ch.is_found()))
 			return "";
 
 		if (!ch.pos.isValid())
@@ -513,7 +513,7 @@
 		try {
 			ret.append(formatCompact(ch));
 
-			if (exportStyle != STYLE_GPX_COMPACT && !(ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt())) {
+			if (exportStyle != STYLE_GPX_COMPACT && !(ch.isCustomWpt() || ch.isAddiWpt())) {
 				ret.append(formatPqExtensions(ch));
 			}
 
@@ -554,7 +554,7 @@
 					exportErrors++;
 					ret.append("    <time>1970-01-01T00:00:00</time>\n");
 				}
-			} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+			} else if (ch.isCustomWpt()) {
 				ret.append("    <time>1970-01-01T00:00:00</time>\n");
 			} else {
 				ret.append("    <time>"+ch.getDateHidden()+"T00:00:00</time>\n");
@@ -564,7 +564,7 @@
 		if (exportIds == WPNAME_ID_SMART) {
 			if (ch.isAddiWpt()) {
 				ret.append("    <name>".concat(SafeXML.cleanGPX(ch.mainCache.getWayPoint().concat(" ").concat(ch.getWayPoint().substring(0, 2)))).concat("</name>\n"));
-			} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+			} else if (ch.isCustomWpt()) {
 				ret.append("    <name>".concat(SafeXML.cleanGPX(ch.getWayPoint())).concat("</name>\n"));
 			} else {
 				ret.append("    <name>".concat(SafeXML.cleanGPX(ch.getWayPoint())
@@ -583,7 +583,7 @@
 		}
 		
 		// no <cmt> for custom
-		if (ch.getType() != CacheType.CW_TYPE_CUSTOM) {
+		if (!ch.isCustomWpt()) {
 			if (exportIds == WPNAME_ID_SMART && exportStyle == STYLE_GPX_COMPACT) {
 				if (ch.isAddiWpt()) {
 					ret.append("    <cmt>".concat(SafeXML.cleanGPX(ch.getCacheName() + " " + ch.getFreshDetails().LongDescription)).concat("</cmt>\n"));
@@ -599,7 +599,7 @@
 			}
 		}
 
-		if (ch.isAddiWpt() || ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+		if (ch.isAddiWpt() || ch.isCustomWpt()) {
 			ret.append("    <desc>".concat(SafeXML.cleanGPX(ch.getCacheName())).concat("</desc>\n"));
 		} else {
 			ret.append("    <desc>".concat(SafeXML.cleanGPX(ch.getCacheName().concat(" by ").concat(ch.getCacheOwner()).concat(", ")
@@ -610,7 +610,7 @@
 		}
 
 		if (exportStyle != STYLE_GPX_COMPACT) {
-			if (ch.getType() != CacheType.CW_TYPE_CUSTOM) {
+			if (!ch.isCustomWpt()) {
 				ret.append("    <url>".concat(ch.details.URL).concat("</url>\n"));
 				ret.append("    <urlname>".concat(SafeXML.cleanGPX(ch.getCacheName())).concat("</urlname>\n"));
 			}
@@ -622,7 +622,7 @@
 			if (ch.isAddiWpt()) {
 				ret.append("    <sym>".concat(CacheType.id2GpxString(ch.getType())
 						.substring(CacheType.id2GpxString(ch.getType()).indexOf("|") + 1)).concat("</sym>\n"));
-			} else if (ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+			} else if (ch.isCustomWpt()) {
 				ret.append("    <sym>Custom</sym>\n");
 			} else if (ch.is_found()) {
 				ret.append("    <sym>Geocache found</sym>\n");
@@ -645,7 +645,7 @@
 	 */
 	private String formatPqExtensions(CacheHolder ch) {
 		// no details pq details for addis or custom waypoints
-		if (ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt())
+		if (ch.isCustomWpt() || ch.isAddiWpt())
 			return "";
 
 		return "    <groundspeak:cache id=\"".concat(ch.GetCacheID()).concat("\" available=\"").concat(ch.is_available() ? TRUE : FALSE).concat("\" archived=\"").concat(ch.is_archived() ? TRUE : FALSE).concat("\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\n")
@@ -753,7 +753,7 @@
 	 * @return formatted output
 	 */
 	public String formatLongDescription(CacheHolder ch) {
-		if (ch.isAddiWpt() || ch.getType() == CacheType.CW_TYPE_CUSTOM) {
+		if (ch.isAddiWpt() || ch.isCustomWpt()) {
 			return ch.details.LongDescription;
 		} else {
 			StringBuffer ret = new StringBuffer();

Modified: trunk/src/exp/OziExporter.java
===================================================================
--- trunk/src/exp/OziExporter.java	2009-07-18 21:29:15 UTC (rev 2037)
+++ trunk/src/exp/OziExporter.java	2009-07-19 08:36:59 UTC (rev 2038)
@@ -41,7 +41,7 @@
 		// usually start at 1 and increment. Can be set to -1 (minus 1) and the number will be auto generated.
 		strBuf.append("-1,");
 		// Field 2 : Name - the waypoint name, use the correct length name to suit the GPS type.
-		if (ch.getType() == CacheType.CW_TYPE_CUSTOM || ch.isAddiWpt()) {
+		if (ch.isCustomWpt() || ch.isAddiWpt()) {
 			strBuf.append(ch.getWayPoint() + ",");
 		} else {
 			strBuf.append(ch.getWayPoint()



From engywuck at mail.berlios.de  Sun Jul 19 11:40:17 2009
From: engywuck at mail.berlios.de (engywuck at mail.berlios.de)
Date: Sun, 19 Jul 2009 11:40:17 +0200
Subject: [Cachewolf-svn] r2039 - trunk/src/CacheWolf
Message-ID: <200907190940.n6J9eHfu025217@sheep.berlios.de>

Author: engywuck
Date: 2009-07-19 11:40:15 +0200 (Sun, 19 Jul 2009)
New Revision: 2039

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
Don't change black status of cache by updating it via spider or imports.

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-07-19 08:36:59 UTC (rev 2038)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-07-19 09:40:15 UTC (rev 2039)
@@ -492,7 +492,6 @@
 		this.setOwned(ch.is_owned());
 		this.setFiltered(ch.is_filtered());
 		this.setIncomplete(ch.is_incomplete());
-		this.setBlack(ch.is_black());
 		this.addiWpts = ch.addiWpts;
 		this.mainCache=ch.mainCache;
 		this.setOcCacheID(ch.getOcCacheID());



From greiol at mail.berlios.de  Sun Jul 19 21:42:00 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 19 Jul 2009 21:42:00 +0200
Subject: [Cachewolf-svn] r2040 - trunk/src/CacheWolf
Message-ID: <200907191942.n6JJg0qr024582@sheep.berlios.de>

Author: greiol
Date: 2009-07-19 21:41:58 +0200 (Sun, 19 Jul 2009)
New Revision: 2040

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
roadmap for detail panel changes, mainly FIXMEs

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-19 09:40:15 UTC (rev 2039)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-19 19:41:58 UTC (rev 2040)
@@ -240,10 +240,10 @@
 
 		attV.showImages(ch.getCacheDetails(true).attributes);
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
-			btnTerr.setText("T: -.-");
-			btnDiff.setText("D: -.-");
-			deactivatControl(btnTerr);
-			deactivatControl(btnDiff);
+			btnTerr.setText(MyLocale.getMsg(1001, "T")+": -.-");
+			btnDiff.setText(MyLocale.getMsg(1000, "D")+": -.-");
+			deactivateControl(btnTerr);
+			deactivateControl(btnDiff);
 		} else {
 			activateControl(btnTerr);
 			activateControl(btnDiff);
@@ -308,19 +308,30 @@
 			if (ev.target == inpWaypoint) {
 				// If user used lower case -> convert directly to upper case
 				inpWaypoint.setText(inpWaypoint.getText().toUpperCase());
+				//FIXME: if name was changed, we should rename the waypoint.xml file. how? where?
+			} else if (ev.target == chcType) {
+				createWptName();
+				if (CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.selectedIndex))) {
+					activateControl(btnTerr);
+					activateControl(btnDiff);
+					activateControl(chcSize);
+				} else {
+					deactivateControl(btnTerr);
+					deactivateControl(btnDiff);
+					deactivateControl(chcSize);
+					chcSize.select(0);
+					btnTerr.setText(MyLocale.getMsg(1001, "T")+": -.-");
+					btnDiff.setText(MyLocale.getMsg(1000, "D")+": -.-");
+				}
 			}
+			//FIXME: check if something was actually changed, since datacachnge events also occur if you just hop through the fileds with the tab key (Why? don't know!)
 			dirty_details = true;
 			needsTableUpdate = true;
-			// profile.hasUnsavedChanges=true;
-			if (ev.target == chcType) {
-				createWptName();
-			}
 		}
 		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
 			if (ev.target == btnNotes) {
 				dirty_notes = true; // TODO I think this is redundant, because
-									// the notes are saved
-				// seperately by the notes screen itself
+									// the notes are saved separately by the notes screen itself
 				NotesScreen nsc = new NotesScreen(thisCache
 						.getCacheDetails(true));
 				nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
@@ -367,6 +378,7 @@
 					note = note + dtm.toString();
 				note = note + "\n";
 				thisCache.getCacheDetails(true).setCacheNotes(note);
+				//FIXME: better use saveDirtyWaypoint()?
 				thisCache.save();
 			} else if (ev.target == btnAddPicture) {
 				thisCache.getCacheDetails(true).addUserImage(profile);
@@ -393,7 +405,7 @@
 				ch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
 				Global.mainTab.newWaypoint(ch);
 			} else if (ev.target == btnGoto) {
-				// TODO if something changed saveWpt();
+				// FIXME: if something changed saveDirtyWaypoint();
 				Global.mainTab.gotoP.setDestinationAndSwitch(thisCache);
 			} else if (ev.target == btnWayLoc) {
 				CWPoint coords = new CWPoint(btnWayLoc.getText(), CWPoint.CW);
@@ -468,6 +480,7 @@
 						.getTerrain());
 				returnValue = tdf.execute();
 				if (returnValue == 1 && tdf.getDT() != thisCache.getTerrain()) {
+					//FIXME: do this when waypoint is checked for saving
 					thisCache.setTerrain(tdf.getDT());
 					btnTerr.setText(MyLocale.getMsg(1001, "T") + ": "
 							+ CacheTerrDiff.longDT(thisCache.getTerrain()));
@@ -478,6 +491,7 @@
 				TerrDiffForm tdf = new TerrDiffForm(false, thisCache.getHard());
 				returnValue = tdf.execute();
 				if (returnValue == 1 && tdf.getDT() != thisCache.getHard()) {
+					//FIXME: do this when waypoint is checked for saving
 					thisCache.setHard(tdf.getDT());
 					btnDiff.setText(MyLocale.getMsg(1000, "D") + ": "
 							+ CacheTerrDiff.longDT(thisCache.getHard()));
@@ -488,17 +502,24 @@
 		}
 	}
 	
+	/** allow user input on control item */
 	private void activateControl(Control ctrl) {
 		if (ctrl.change(0, ControlConstants.Disabled))
 			ctrl.repaint();
 	}
-	
-	private void deactivatControl(Control ctrl) {
+
+	/** block user input on control item */
+	private void deactivateControl(Control ctrl) {
 		if (ctrl.change(ControlConstants.Disabled, 0))
 			ctrl.repaint();
 	}
 
 	public void saveDirtyWaypoint() {
+		//FIXME: here we should check if the data is now different from what it used to be when calling the details panel instead of relying on dirty flags
+		//FIXME: take care of renaming waypoints
+		//FIXME: add method to convert back text of difficulty & terrain buttons
+		//FIXME: check if manual changes have converted a cache from incomplete to complete
+		
 		// We have to update two objects: thisCache (a CacheHolderDetail) which
 		// contains
 		// the full cache which will be written to the cache.xml file AND



From greiol at mail.berlios.de  Sun Jul 19 23:38:31 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Sun, 19 Jul 2009 23:38:31 +0200
Subject: [Cachewolf-svn] r2041 - trunk/src/CacheWolf
Message-ID: <200907192138.n6JLcVvr002577@sheep.berlios.de>

Author: greiol
Date: 2009-07-19 23:38:29 +0200 (Sun, 19 Jul 2009)
New Revision: 2041

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/DetailsPanel.java
Log:
CacheHolder: added function to reset incomplete state  if appropriate
DetailsPanel: check if cache is incomplete when leaving

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-07-19 19:41:58 UTC (rev 2040)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-07-19 21:38:29 UTC (rev 2041)
@@ -678,7 +678,8 @@
 			} catch (IOException e) {
 				if (! maybenew ) {
 					if (alarmuser) {
-						(new MessageBox("Error", "Could not read cache details for cache: "
+						//FIXME: put a message to languages file
+						(new MessageBox(MyLocale.getMsg(31415,"Error"), MyLocale.getMsg(31415, "Could not read cache details for cache: ")
 						        + this.getWayPoint(), FormBase.OKB)).execute();
 					}
 					details = null;
@@ -911,7 +912,10 @@
 		setType(byteFromLong(value, 3));
 		setCacheSize(byteFromLong(value, 4));
 		setNoFindLogs((byteFromLong(value, 5)));
-		if (( getHard() == -1 || getTerrain() == -1 || getCacheSize() == -1 ) || getType() == -1 ) {
+		if ( getHard() == CacheTerrDiff.CW_DT_ERROR 
+				|| getTerrain() == CacheTerrDiff.CW_DT_ERROR 
+				|| getCacheSize() == CacheSize.CW_SIZE_ERROR 
+				|| getType() == CacheType.CW_TYPE_ERROR ) {
 			setIncomplete(true);
 		}
 	}
@@ -935,9 +939,9 @@
 				// Addis don't have their own values for difficulty, terrain and size
 				// Custom waypoints can't be updated to remove incomplete flag, so we 
 				// have to set reasonable values.
-				if (getHard() == -1) setHard(CacheTerrDiff.CW_DT_UNSET);
-				if (getTerrain() == -1) setTerrain(CacheTerrDiff.CW_DT_UNSET);
-				if (getCacheSize() == -1) setCacheSize(CacheSize.CW_SIZE_NONE);
+				if (getHard() == CacheTerrDiff.CW_DT_ERROR) setHard(CacheTerrDiff.CW_DT_UNSET);
+				if (getTerrain() == CacheTerrDiff.CW_DT_ERROR) setTerrain(CacheTerrDiff.CW_DT_UNSET);
+				if (getCacheSize() == CacheSize.CW_SIZE_ERROR) setCacheSize(CacheSize.CW_SIZE_NONE);
 			} else {
 				setIncomplete(true);
 			}
@@ -1283,6 +1287,52 @@
 		if (is_incomplete && iconAndTextWPLevel==4) iconAndTextWP = null;
     	this.incomplete = is_incomplete;
     }
+	
+	public boolean checkIncomplete() {
+		boolean ret;
+		if (isCacheWpt()) {
+			if (getWayPoint().length() < 3
+					|| getHard() <= CacheTerrDiff.CW_DT_UNSET
+					|| getTerrain() <= CacheTerrDiff.CW_DT_UNSET
+					|| getCacheSize() == CacheSize.CW_SIZE_ERROR
+					|| getCacheOwner().length() == 0
+					|| getDateHidden().length() == 0 
+					|| getCacheName().length() == 0) 
+				ret = true;
+			else
+				ret = false;
+		} else if (isAddiWpt()) {
+			if (mainCache == null
+					|| getHard() != CacheTerrDiff.CW_DT_UNSET 
+					|| getCacheSize() != CacheSize.CW_SIZE_NOTCHOSEN
+					|| getTerrain() != CacheTerrDiff.CW_DT_UNSET
+					|| getWayPoint().length() < 2
+//					|| getCacheOwner().length() > 0
+//					|| getDateHidden().length() > 0 
+					|| getCacheName().length() == 0
+					)
+				ret = true;
+			else
+				ret = false;
+		} else if (isCustomWpt()) {
+			if (getHard() != CacheTerrDiff.CW_DT_UNSET 
+					|| getTerrain() != CacheTerrDiff.CW_DT_UNSET
+					|| getCacheSize() != CacheSize.CW_SIZE_NOTCHOSEN
+					|| getWayPoint().length() < 2
+//					|| getCacheOwner().length() > 0
+//					|| getDateHidden().length() > 0 
+					|| getCacheName().length() == 0
+					)
+				ret = true;
+			else
+				ret = false;
+		} else {
+			// we should not get here, so let's set a warning just in case
+			ret=true;
+		}
+		setIncomplete(ret);
+		return ret;
+	}
 
 	/**
 	 * Determines if the blacklist status is set for the cache. Do not use this method

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-19 19:41:58 UTC (rev 2040)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-19 21:38:29 UTC (rev 2041)
@@ -244,9 +244,12 @@
 			btnDiff.setText(MyLocale.getMsg(1000, "D")+": -.-");
 			deactivateControl(btnTerr);
 			deactivateControl(btnDiff);
+			deactivateControl(chcSize);
+			chcSize.select(0);
 		} else {
 			activateControl(btnTerr);
 			activateControl(btnDiff);
+			activateControl(chcSize);
 			if (CacheTerrDiff.isValidTD(ch.getTerrain())) {
 				btnTerr.setText(MyLocale.getMsg(1001, "T") + ": " + CacheTerrDiff.longDT(ch.getTerrain()));
 			} else {
@@ -618,6 +621,7 @@
 		}
 		// set status also on addi wpts
 		ch.setAttributesToAddiWpts();
+		ch.checkIncomplete();
 		dirty_notes = false;
 		dirty_details = false;
 		setNeedsTableUpdate(false);



From mik77 at mail.berlios.de  Mon Jul 20 23:14:34 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 20 Jul 2009 23:14:34 +0200
Subject: [Cachewolf-svn] r2042 - trunk/src/CacheWolf
Message-ID: <200907202114.n6KLEYu6007477@sheep.berlios.de>

Author: mik77
Date: 2009-07-20 23:14:32 +0200 (Mon, 20 Jul 2009)
New Revision: 2042

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Not very nice solution, but prevents scroll bars on QVGA displays.

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-19 21:38:29 UTC (rev 2041)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-20 21:14:32 UTC (rev 2042)
@@ -121,6 +121,7 @@
 		line1Panel.addNext(chcType, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 
 		line1Panel.addLast(btnDiff = new mButton(MyLocale.getMsg(1000, "D")	+ ": 5.5"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
+		btnDiff.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
 
 		this.addLast(line1Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
@@ -129,8 +130,8 @@
 		chcSize.alwaysDrop = true;
 		line2Panel.addNext(chcSize, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 
-		line2Panel.addLast(btnTerr = new mButton(MyLocale.getMsg(1001, "T")	+ ": 5.5"), CellConstants.DONTSTRETCH,
-				(CellConstants.DONTFILL | CellConstants.EAST));
+		line2Panel.addLast(btnTerr = new mButton(MyLocale.getMsg(1001, "T")	+ ": 5.5"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
+		btnTerr.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
 		this.addLast(line2Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
 		this.addNext(new mLabel(MyLocale.getMsg(302, "Waypoint:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));



From greiol at mail.berlios.de  Tue Jul 21 18:52:32 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 21 Jul 2009 18:52:32 +0200
Subject: [Cachewolf-svn] r2043 - in trunk/src: CacheWolf/imp exp
Message-ID: <200907211652.n6LGqWsO021504@sheep.berlios.de>

Author: greiol
Date: 2009-07-21 18:52:25 +0200 (Tue, 21 Jul 2009)
New Revision: 2043

Modified:
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/exp/GpxExportNg.java
Log:
added log type "Listing retracted"

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-20 21:14:32 UTC (rev 2042)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2009-07-21 16:52:25 UTC (rev 2043)
@@ -518,6 +518,7 @@
 		if (typeText.equals("Needs Maintenance")) return "icon_needsmaint.gif";
 		if (typeText.equals("Needs Archived")) return "icon_remove.gif";
 		if (typeText.equals("Update Coordinates")) return "coord_update.gif";
+		if (typeText.equals("Retract Listing")) return "img_redlight.gif";
 		Global.getPref().log("GPX Import: warning, unknown logtype "+typeText+" assuming Write note");
 		return "icon_note.gif";
 	}

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-20 21:14:32 UTC (rev 2042)
+++ trunk/src/exp/GpxExportNg.java	2009-07-21 16:52:25 UTC (rev 2043)
@@ -34,6 +34,7 @@
 import ewe.sys.Process;
 import ewe.sys.Time;
 import ewe.sys.Vm;
+import ewe.ui.Control;
 import ewe.ui.ControlConstants;
 import ewe.ui.ControlEvent;
 import ewe.ui.DataChangeEvent;
@@ -827,6 +828,8 @@
 			return "Update Coordinates";
 		if (image.equals("icon_remove.gif"))
 			return "Needs Archived";
+		if (image.equals("icon_redlight.gif"))
+			return "Retract Listing";
 		Global.getPref().log("GPX Export: warning - unknown logtype " + image + " was changed to 'Write note'");
 		exportErrors++;
 		return "Write note";
@@ -1233,5 +1236,17 @@
 		public String getPrefix() {
 			return ibPrefix.getText();
 		}
+		
+		/** set control to accept user interaction */
+		private void activateControl(Control ctrl) {
+			if (ctrl.change(0, ControlConstants.Disabled))
+				ctrl.repaint();
+		}
+		
+		/** set control to deny user interaction */
+		private void deactivatControl(Control ctrl) {
+			if (ctrl.change(ControlConstants.Disabled, 0))
+				ctrl.repaint();
+		}
 	}
 }



From greiol at mail.berlios.de  Tue Jul 21 18:55:18 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 21 Jul 2009 18:55:18 +0200
Subject: [Cachewolf-svn] r2044 - in trunk: res_noewe/templates src/CacheWolf
	src/exp
Message-ID: <200907211655.n6LGtI9F024878@sheep.berlios.de>

Author: greiol
Date: 2009-07-21 18:55:12 +0200 (Tue, 21 Jul 2009)
New Revision: 2044

Modified:
   trunk/res_noewe/templates/page.tpl
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/DataMover.java
   trunk/src/exp/HTMLExporter.java
Log:
added coordinates to html export template
cacheholder reports missing details to log if userfeedback is off
file copy job returns success and failure state
htmlexporter better logs and counts errors and gives summary only at end of export

Modified: trunk/res_noewe/templates/page.tpl
===================================================================
--- trunk/res_noewe/templates/page.tpl	2009-07-21 16:52:25 UTC (rev 2043)
+++ trunk/res_noewe/templates/page.tpl	2009-07-21 16:55:12 UTC (rev 2044)
@@ -8,7 +8,8 @@
 <table border = "2px" align = "center">
 <tr style = "background-color:lightgrey;font-family:sans-serif;font-size:14;"><td>
 <tmpl_var TYPE> <tmpl_var WAYPOINT> <tmpl_var NAME> by <tmpl_var OWNER><br>
-Difficulty: <tmpl_var DIFFICULTY>&nbsp;&nbsp;Terrain: <tmpl_var TERRAIN>&nbsp;&nbsp;Size: <tmpl_var SIZE>
+Difficulty: <tmpl_var DIFFICULTY>&nbsp;&nbsp;Terrain: <tmpl_var TERRAIN>&nbsp;&nbsp;Size: <tmpl_var SIZE><br>
+Coordinates: <tmpl_var LATLON>
 </td></tr>
 <tr style = "font-family:sans-serif;font-size:12;"><td>
 Description:<br>
@@ -52,4 +53,4 @@
 <tr style = "font-family:sans-serif;font-size:12;"><td>
 </table>
 </body>
-</html>
\ No newline at end of file
+</html>

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-07-21 16:52:25 UTC (rev 2043)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-07-21 16:55:12 UTC (rev 2044)
@@ -681,6 +681,8 @@
 						//FIXME: put a message to languages file
 						(new MessageBox(MyLocale.getMsg(31415,"Error"), MyLocale.getMsg(31415, "Could not read cache details for cache: ")
 						        + this.getWayPoint(), FormBase.OKB)).execute();
+					} else {
+						Global.getPref().log("Could not read details for waypoint " + getWayPoint());
 					}
 					details = null;
 					this.setIncomplete(true);

Modified: trunk/src/CacheWolf/DataMover.java
===================================================================
--- trunk/src/CacheWolf/DataMover.java	2009-07-21 16:52:25 UTC (rev 2043)
+++ trunk/src/CacheWolf/DataMover.java	2009-07-21 16:55:12 UTC (rev 2044)
@@ -276,23 +276,30 @@
 		}
 	}
 
-	public static void copy( String sFileSrc, String sFileDst)
-	  {
-	    try {
+	/**
+	 * copy a file
+	 * @param sFileSrc source file name
+	 * @param sFileDst destination file name
+	 * @return true on success, false if an error occurred
+	 */
+	public static boolean copy( String sFileSrc, String sFileDst) {
+		try {
 			File   fSrc = new File( sFileSrc );
-		    int    len  = 32768;
-		    byte[] buff = new byte[ (int)java.lang.Math.min( len, fSrc.length() ) ];
-		    FileInputStream  fis = new FileInputStream(  fSrc );
-		    FileOutputStream fos = new FileOutputStream( sFileDst);
-		    while( 0 < (len = fis.read( buff )) )
-		      fos.write( buff, 0, len );
-		    fos.flush();
-		    fos.close();
-		    fis.close();
-	    }
-	    catch (Exception ex){
-	    	Vm.debug("Filecopy failed: "+sFileSrc+"=>"+sFileDst);
-	    }
+			int    len  = 32768;
+			byte[] buff = new byte[ (int)java.lang.Math.min( len, fSrc.length() ) ];
+			FileInputStream  fis = new FileInputStream(  fSrc );
+			FileOutputStream fos = new FileOutputStream( sFileDst);
+			while( 0 < (len = fis.read( buff )) )
+				fos.write( buff, 0, len );
+			fos.flush();
+			fos.close();
+			fis.close();
+		}
+		catch (Exception ex){
+			Global.getPref().log("Filecopy failed: "+sFileSrc+"=>"+sFileDst,ex,Global.getPref().debug);
+			return false;
+		}
+		return true;
 	}
 
 	//////////////////////////////////////////////////////////////////////

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2009-07-21 16:52:25 UTC (rev 2043)
+++ trunk/src/exp/HTMLExporter.java	2009-07-21 16:55:12 UTC (rev 2044)
@@ -44,6 +44,7 @@
 		CacheHolder ch;
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
+		int exportErrors = 0;
 
 		new String();
 		FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, pref.getExportPath(expName));
@@ -59,7 +60,6 @@
 			Vector usrImg = new Vector();
 			Vector logIcons = new Vector(15);
 			String icon;
-			int exportErrors = 0;
 
 			Hashtable varParams;
 			Hashtable imgParams;
@@ -85,7 +85,7 @@
 						Global.getPref().log("HTMLExport: skipping export of incomplete waypoint "+ch.getWayPoint());
 						continue;
 					}
-					det=ch.getExistingDetails();
+					det=ch.getCacheDetails(false,false);
 					varParams = new Hashtable();
 					varParams.put("TYPE", CacheType.cw2ExportString(ch.getType()));
 					varParams.put("WAYPOINT", ch.getWayPoint());
@@ -150,8 +150,10 @@
 								String imgFile = new String(det.images.get(j).getFilename());
 								imgParams.put("FILE", imgFile);
 								imgParams.put("TEXT",det.images.get(j).getTitle());
-								DataMover.copy(profile.dataDir + imgFile,targetDir + imgFile);
-								cacheImg.add(imgParams);
+								if (DataMover.copy(profile.dataDir + imgFile,targetDir + imgFile))
+									cacheImg.add(imgParams);
+								else
+									exportErrors++;
 							}
 							page_tpl.setParam("cacheImg", cacheImg);
 							
@@ -162,8 +164,10 @@
 								String logImgFile = det.logImages.get(j).getFilename();
 								logImgParams.put("FILE", logImgFile);
 								logImgParams.put("TEXT",det.logImages.get(j).getTitle());
-								DataMover.copy(profile.dataDir + logImgFile,targetDir + logImgFile);
-								logImg.add(logImgParams);
+								if (DataMover.copy(profile.dataDir + logImgFile,targetDir + logImgFile))
+									logImg.add(logImgParams);
+								else
+									exportErrors++;
 							}
 							page_tpl.setParam("logImg", logImg);
 							
@@ -174,8 +178,10 @@
 								String usrImgFile = new String(det.userImages.get(j).getFilename());
 								usrImgParams.put("FILE", usrImgFile);
 								usrImgParams.put("TEXT",det.userImages.get(j).getTitle());
-								DataMover.copy(profile.dataDir + usrImgFile,targetDir + usrImgFile);
-								usrImg.add(usrImgParams);
+								if (DataMover.copy(profile.dataDir + usrImgFile,targetDir + usrImgFile))
+									usrImg.add(usrImgParams);
+								else
+									exportErrors++;
 							}
 							page_tpl.setParam("userImg", usrImg);
 							
@@ -190,15 +196,19 @@
 							if (test.exists()) {
 								mapImgParams.put("FILE", mapImgFile);
 								mapImgParams.put("TEXT",mapImgFile);
-								DataMover.copy(profile.dataDir + mapImgFile,targetDir + mapImgFile);
-								mapImg.add(mapImgParams);
+								if (DataMover.copy(profile.dataDir + mapImgFile,targetDir + mapImgFile))
+									mapImg.add(mapImgParams);
+								else
+									exportErrors++;
 								
 								mapImgParams = new Hashtable();
 								mapImgFile = ch.getWayPoint() + "_map_2.gif";
 								mapImgParams.put("FILE", mapImgFile);
 								mapImgParams.put("TEXT",mapImgFile);
-								DataMover.copy(profile.dataDir + mapImgFile,targetDir + mapImgFile);
-								mapImg.add(mapImgParams);
+								if (DataMover.copy(profile.dataDir + mapImgFile,targetDir + mapImgFile))
+									mapImg.add(mapImgParams);
+								else
+									exportErrors++;
 		
 								page_tpl.setParam("mapImg", mapImg);
 							}
@@ -212,6 +222,7 @@
 							page_tpl.setParam("logImg", ""); // ???
 							page_tpl.setParam("userImg", ""); // ???
 							page_tpl.setParam("mapImg", ""); // ???
+							exportErrors++;
 						}
 						
 						PrintWriter pagefile = new PrintWriter(new BufferedWriter(new FileWriter(targetDir + ch.getWayPoint()+".html")));
@@ -225,18 +236,19 @@
 						exportErrors++;
 						Global.getPref().log("HTMLExport: error wehen exporting "+ch.getWayPoint()+" reason: ",e,Global.getPref().debug);
 					}
-					if (exportErrors > 0) {
-						new MessageBox("Export Error", exportErrors+" waypoints have not been exported. See log for details.", FormBase.OKB).execute();
-					}
 				}//if is black, filtered
 			}
+
 			// Copy the log-icons to the destination directory
 			for (int j=0; j<logIcons.size(); j++) {
 				icon=(String) logIcons.elementAt(j);
-				DataMover.copy(FileBase.getProgramDirectory() + "/"+icon,targetDir + icon);
+				if (!DataMover.copy(FileBase.getProgramDirectory() + "/"+icon,targetDir + icon))
+					exportErrors++;
 				
 			}
-			DataMover.copy(FileBase.getProgramDirectory() + "/recommendedlog.gif",targetDir + "recommendedlog.gif");
+			if (!DataMover.copy(FileBase.getProgramDirectory() + "/recommendedlog.gif",targetDir + "recommendedlog.gif"))
+				exportErrors++;
+			
 			try{
 				Template tpl = new Template(template_init_index);
 				tpl.setParam("cache_index", cache_index);
@@ -261,6 +273,11 @@
 			
 		}//if
 		pbf.exit(0);
+		
+		if (exportErrors > 0) {
+			new MessageBox("Export Error", exportErrors+" errors during export. See log for details.", FormBase.OKB).execute();
+		}
+
 	}
 	
 	/**



From greiol at mail.berlios.de  Tue Jul 21 22:16:53 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 21 Jul 2009 22:16:53 +0200
Subject: [Cachewolf-svn] r2045 - trunk/src/CacheWolf
Message-ID: <200907212016.n6LKGrpX012649@sheep.berlios.de>

Author: greiol
Date: 2009-07-21 22:16:51 +0200 (Tue, 21 Jul 2009)
New Revision: 2045

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/CacheHolderDetail.java
Log:
added functions to rename a waypoint together with its associated files

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-07-21 16:55:12 UTC (rev 2044)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-07-21 20:16:51 UTC (rev 2045)
@@ -118,7 +118,7 @@
 	private IconAndText iconAndTextWP = null;
 	private int iconAndTextWPLevel = 0;
 
-		static char decSep,notDecSep;
+	static char decSep,notDecSep;
 	static {
 		decSep=MyLocale.getDigSeparator().charAt(0);
 		notDecSep=decSep=='.'?',':'.';
@@ -1461,5 +1461,23 @@
 		Global.getProfile().notifyUnsavedChanges(hasNote != this.hasNote);		
 		this.hasNote = hasNote;
 	}
+	
+	/**
+	 * rename a waypoint and all its associated files
+	 * @param newWptId new waypoint id (will be converted to upper case)
+	 * @return true on success, false on error
+	 */
+	public boolean rename(String newWptId) {
+		newWptId = newWptId.toUpperCase();
+		getFreshDetails();
+		if (details.rename(newWptId)) {
+			setWayPoint(newWptId);
+			save();
+			Global.getProfile().notifyUnsavedChanges(true);
+			return true;
+		} else {
+			return false;
+		}
+	}
 }
 

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-21 16:55:12 UTC (rev 2044)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-21 20:16:51 UTC (rev 2045)
@@ -440,6 +440,92 @@
 				if (this.images.get(i).getComment() != null) return true;
 			return false;
 		}
+
+		/**
+		 * change id in waypoint details and rename associated files. Function should only be called by CacheHolder
+		 * @param newWptId new id of the waypoint
+		 * @return true on success, false for failure
+		 */
+		protected boolean rename(String newWptId) {
+			boolean success = false;
+			String profiledir = Global.getProfile().dataDir;
+			int oldWptLength = getParent().getWayPoint().length();
+			
+			// just in case ... (got the pun? ;) )
+			newWptId = newWptId.toUpperCase();
+			
+			// update image information
+			for(int i = 0;i<images.size();i++){
+				String filename = images.get(i).getFilename();
+				String comment = images.get(i).getComment();
+				String title = images.get(i).getTitle();
+				if (filename.indexOf(getParent().getWayPoint())==0) {
+					filename=newWptId.concat(filename.substring(oldWptLength));
+					images.get(i).setFilename(filename);
+				}
+				if (comment.indexOf(getParent().getWayPoint())==0) {
+					comment=newWptId.concat(comment.substring(oldWptLength));
+					images.get(i).setComment(comment);
+				}
+				if (title.indexOf(getParent().getWayPoint())==0) {
+					title=newWptId.concat(title.substring(oldWptLength));
+					images.get(i).setTitle(title);
+				}
+			}
+			for(int i = 0;i<logImages.size();i++){
+				String filename = logImages.get(i).getFilename();
+				String comment = logImages.get(i).getComment();
+				String title = logImages.get(i).getTitle();
+				if (filename.indexOf(getParent().getWayPoint())==0) {
+					filename=newWptId.concat(filename.substring(oldWptLength));
+					logImages.get(i).setFilename(filename);
+				}
+				if (comment.indexOf(getParent().getWayPoint())==0) {
+					comment=newWptId.concat(comment.substring(oldWptLength));
+					logImages.get(i).setComment(comment);
+				}
+				if (title.indexOf(getParent().getWayPoint())==0) {
+					title=newWptId.concat(title.substring(oldWptLength));
+					logImages.get(i).setTitle(title);
+				}
+			}
+			for(int i = 0;i<userImages.size();i++){
+				String filename = userImages.get(i).getFilename();
+				String comment = userImages.get(i).getComment();
+				String title = userImages.get(i).getTitle();
+				if (filename.indexOf(getParent().getWayPoint())==0) {
+					filename=newWptId.concat(filename.substring(oldWptLength));
+					userImages.get(i).setFilename(filename);
+				}
+				if (comment.indexOf(getParent().getWayPoint())==0) {
+					comment=newWptId.concat(comment.substring(oldWptLength));
+					userImages.get(i).setComment(comment);
+				}
+				if (title.indexOf(getParent().getWayPoint())==0) {
+					title=newWptId.concat(title.substring(oldWptLength));
+					userImages.get(i).setTitle(title);
+				}
+			}
+
+			// rename the files
+			try {
+				// since we use *.* we do not need FileBugFix
+				String srcFiles[] = new File(profiledir).list(getParent().getWayPoint().concat("*.*"), ewe.io.FileBase.LIST_FILES_ONLY);
+				for (int i=0; i < srcFiles.length;i++){
+					String newfile = newWptId.concat(srcFiles[i].substring(oldWptLength));
+					File srcFile = new File(profiledir.concat(srcFiles[i]));
+					File dstFile = new File(profiledir.concat(newfile));
+					srcFile.move(dstFile);
+				}
+				success = true;
+			} catch (Exception e) {
+				Global.getPref().log("Error renaming waypoint details", e, Global.getPref().debug);
+				//TODO: any chance of a roll back?
+				//TODO: should we ignore a file not found?
+			}
+			
+			return success;
+		}
 }
 
 



From greiol at mail.berlios.de  Wed Jul 22 07:47:24 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 22 Jul 2009 07:47:24 +0200
Subject: [Cachewolf-svn] r2046 - trunk/src/exp
Message-ID: <200907220547.n6M5lOUw003034@sheep.berlios.de>

Author: greiol
Date: 2009-07-22 07:47:17 +0200 (Wed, 22 Jul 2009)
New Revision: 2046

Modified:
   trunk/src/exp/GpxExportNg.java
Log:
blush

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-21 20:16:51 UTC (rev 2045)
+++ trunk/src/exp/GpxExportNg.java	2009-07-22 05:47:17 UTC (rev 2046)
@@ -544,7 +544,7 @@
 		
 //			.concat("\t\t<desc>@@WPDESC@@</desc>\n")
 		
-		ret.append("  <wp lat=\""+String.valueOf(ch.pos.latDec).replace(',', '.')+"\" lon=\""+String.valueOf(ch.pos.lonDec).replace(',', '.')+"\">\n");
+		ret.append("  <wpt lat=\""+String.valueOf(ch.pos.latDec).replace(',', '.')+"\" lon=\""+String.valueOf(ch.pos.lonDec).replace(',', '.')+"\">\n");
 		
 		if (exportStyle != STYLE_GPX_COMPACT) {
 			if (ch.isAddiWpt()) {



From greiol at mail.berlios.de  Wed Jul 22 18:15:25 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 22 Jul 2009 18:15:25 +0200
Subject: [Cachewolf-svn] r2047 - in experiments: . greiol/src/CacheWolf
Message-ID: <200907221615.n6MGFPGE003363@sheep.berlios.de>

Author: greiol
Date: 2009-07-22 18:15:22 +0200 (Wed, 22 Jul 2009)
New Revision: 2047

Added:
   experiments/greiol/
Modified:
   experiments/greiol/src/CacheWolf/DetailsPanel.java
Log:
just to be on the safe side

Copied: experiments/greiol (from rev 2046, trunk)

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-22 05:47:17 UTC (rev 2046)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-22 16:15:22 UTC (rev 2047)
@@ -388,12 +388,16 @@
 				thisCache.getCacheDetails(true).addUserImage(profile);
 			} else if (ev.target == btnBlack) {
 				if (thisCache.is_black()) {
+					//FIXME: only change thisCache in save routine
 					thisCache.setBlack(false);
 					btnBlack.image = imgBlackNo;
 				} else {
+					//FIXME: only change thisCache in save routine
 					thisCache.setBlack(true);
 					btnBlack.image = imgBlack;
 				}
+				//FIXME: during display of details only the GUI should be relevant
+				// and we collect results at the end
 				blackStatus = thisCache.is_black();
 				thisCache.setAttributesToAddiWpts();
 				btnBlack.repaintNow();
@@ -517,6 +521,31 @@
 		if (ctrl.change(ControlConstants.Disabled, 0))
 			ctrl.repaint();
 	}
+	
+//	private void save2() {
+//		boolean saveWpt = false;
+//		boolean renameWpt = false;
+//		int newdiff;
+//		int newTerr;
+//	
+//		Objects to check:
+//		if (!this.inpName.equals(thisCache.getCacheName()))
+//			saveWpt = true;
+//		if (!this.inpHidden.equals(thisCache.getDateHidden()))
+//			saveWpt = true;
+//		if (!this.inpOwner.equals(thisCache.getCacheOwner()))
+//			saveWpt = true;
+//		if (!this.inpWaypoint.equals(thisCache.getWayPoint())) {
+//			saveWpt = true;
+//			renameWpt = true;
+//		}
+//		if (!this.chcSize)
+//		if (!this.chcStatus)
+//		if (!this.chcType)
+//		if (newdiff)
+//		if (newterr)
+//		if (btnBlack.getImage()
+//	}
 
 	public void saveDirtyWaypoint() {
 		//FIXME: here we should check if the data is now different from what it used to be when calling the details panel instead of relying on dirty flags



From greiol at mail.berlios.de  Wed Jul 22 22:51:42 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 22 Jul 2009 22:51:42 +0200
Subject: [Cachewolf-svn] r2048 - experiments/greiol/src/CacheWolf
Message-ID: <200907222051.n6MKpgnI016789@sheep.berlios.de>

Author: greiol
Date: 2009-07-22 22:51:40 +0200 (Wed, 22 Jul 2009)
New Revision: 2048

Modified:
   experiments/greiol/src/CacheWolf/DetailsPanel.java
   experiments/greiol/src/CacheWolf/MainTab.java
Log:
clean up details panel and make it usable to fix incomplete waypoints

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-22 16:15:22 UTC (rev 2047)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-22 20:51:40 UTC (rev 2048)
@@ -9,102 +9,173 @@
  * Also allows for creation of a custom waypoint.<br>
  */
 public class DetailsPanel extends CellPanel {
+	
+	// ===== GUI elements =====
+	/** waypoint id */
+	private static mInput inpWaypoint;
+	/** waypoint name */
+	private static mInput inpName;
+	/** waypoint hidden date */
+	private static mInput inpHidden;
+	/** waypoint owner */
+	private static mInput inpOwner;
+	/** FIXME */
+	private static mButton btnWayLoc;
+	/** FIXME */
+	private static mButton btnCenter;
+	/** add time stamp to notes */
+	private static mButton btnAddDateTime;
+	/** FIXME */
+	private static mButton btnNewWpt;
+	/** FIXME */
+	private static mButton btnShowBug;
+	/** FIXME */
+	private static mButton btnShowMap;
+	/** FIXME */
+	private static mButton btnGoto;
+	/** FIXME */
+	private static mButton btnAddPicture;
+	/** FIXME */
+	private static mButton btnBlack;
+	/** FIXME */
+	private static mButton btnNotes;
+	/** FIXME */
+	private static mButton btnFoundDate;
+	/** FIXME */
+	private static mButton btnHiddenDate;
+	/** FIXME */
+	private static mButton btnTerr;
+	/** FIXME */
+	private static mButton btnDiff;
+	/** drop down list with cache types */
+	private static mChoice chcType;
+	/** drop down list with container sizes */
+	private static mChoice chcSize;
+	/** FIXME */
+	private static mComboBox chcStatus;
+	/** FIXME */
+	private static CellPanel pnlTools;
+	/** FIXME */
+	private static mTextPad mNotes;
+	/** FIXME */
+	private static mLabel lblAddiCount;
+	/** FIXME move to image broker?*/
+	private static mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgNotes;
+	/** FIXME: what are they for? */
+	private static mImage imgShowMaps, imgAddImages;
+	
+	// ===== data handles =====
+	/** FIXME: never used? */
+	private static CacheDB cacheDB;
+	/** waypoint to be displayed */
+	private static CacheHolder thisCache;
+	/** FIXME: never used? */
+	private static int dbIndex = -1;
+	/** FIXME */
+	private static AttributesViewer attV;
+	/** preferences object */
+	private static Preferences pref;
+	/** waypoint profile */
+	private static Profile profile;
+	
+	// ===== flags =====
+	/** notes have changes */
+	private boolean dirty_notes;
+	/** details have changed FIXME: make this obsolete */
+	private boolean dirty_details;
+	/** cache is blacklisted FIXME: make this obsolete*/
+	private boolean blackStatus;
+	/** blacklist status was changed by user FIXME: make this obsolete */
+	private boolean blackStatusChanged;
+	/** FIXME */
+	private boolean needsTableUpdate;
+	/** screen is VGA or better */
+	private boolean isBigScreen;
+	
+	// ------------- initialize
+	// ------------- present data
+	// ------------- save data
+	// ------------- user interaction
+	// ------------- auxiliary methods
+	
 
-	mInput inpWaypoint = new mInput();
-	mInput inpName = new mInput();
-	mButton btnWayLoc = new mButton();
-	mInput inpHidden = new mInput();
-	mInput inpOwner = new mInput();
-	mButton btnDelete, btnCenter, btnAddDateTime;
-	mChoice chcType = new mChoice(CacheType.guiTypeStrings(), 0);
-	mChoice chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
+//	mInput inpWaypoint = new mInput();
+//	mInput inpName = new mInput();
+//	mButton btnWayLoc = new mButton();
+//	mInput inpHidden = new mInput();
+//	mInput inpOwner = new mInput();
+//	mChoice chcType = new mChoice(CacheType.guiTypeStrings(), 0);
+//	mChoice chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
+//	mComboBox chcStatus = new mComboBox(new String[] { "",
+//			MyLocale.getMsg(313, "Flag 1"), MyLocale.getMsg(314, "Flag 2"),
+//			MyLocale.getMsg(315, "Flag 3"), MyLocale.getMsg(316, "Flag 4"),
+//			MyLocale.getMsg(317, "Search"), MyLocale.getMsg(318, "Found"),
+//			MyLocale.getMsg(319, "Not Found"), MyLocale.getMsg(320, "Owner") },
+//			0);
 
-	mComboBox chcStatus = new mComboBox(new String[] { "",
-			MyLocale.getMsg(313, "Flag 1"), MyLocale.getMsg(314, "Flag 2"),
-			MyLocale.getMsg(315, "Flag 3"), MyLocale.getMsg(316, "Flag 4"),
-			MyLocale.getMsg(317, "Search"), MyLocale.getMsg(318, "Found"),
-			MyLocale.getMsg(319, "Not Found"), MyLocale.getMsg(320, "Owner") },
-			0);
+	
+	// TODO: move images to image broker
+	//mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgShowMaps, imgAddImages, imgNotes;
 
-	mButton btnNewWpt, btnShowBug, btnShowMap, btnGoto, btnAddPicture,
-			btnBlack, btnNotes, btnSave, btnCancel;
-	mButton btnFoundDate, btnHiddenDate;
-	CellPanel pnlTools = new CellPanel();
-	mTextPad mNotes;
-
-	mImage imgBlack;
-	mImage imgBlackNo;
-	mImage imgShowBug, imgShowBugNo, imgNewWpt, imgGoto;
-	mImage imgShowMaps, imgAddImages, imgNotes;
-	mLabel lblAddiCount;
-	mButton btnTerr, btnDiff;
-
-	CacheDB cacheDB;
-	CacheHolder thisCache;
-	int dbIndex = -1;
-
-	AttributesViewer attV;
-
-	private boolean dirty_notes = false;
-	private boolean dirty_details = false;
-	private boolean blackStatus = false;
-	private boolean blackStatusChanged = false;
-	private boolean needsTableUpdate = false;
-	private boolean isBigScreen = false;
-
-	Preferences pref; // Test
-	Profile profile;
-
 	public DetailsPanel() {
+		
+		// ===== initialize data handles =====
 		pref = Global.getPref();
 		profile = Global.getProfile();
 		cacheDB = profile.cacheDB;
-		// //////////////////
-		// Tools
-		// //////////////////
-		// Use larger Button-Icons on VGA-mobiles
-		int sw = MyLocale.getScreenWidth();
-		String imagesize = "";
-		if (Vm.isMobile() && sw >= 400)
-			imagesize = "_vga";
-		// Button 1: New Waypoint
-		pnlTools.addNext(btnNewWpt = new mButton(imgNewWpt = new mImage(
-				"newwpt" + imagesize + ".png")));
+		
+		// ===== initialize flags =====
+		dirty_notes = false;
+		dirty_details = false;
+		blackStatus = false;
+		blackStatusChanged = false;
+		needsTableUpdate = false;
+		// should this be limited to mobile devices? make a difference between big screen and big icons?
+		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
+
+		// ===== initialize GUI objects =====
+		// ----- tools panel ------
+		pnlTools = new CellPanel();
+		btnNewWpt = new mButton(imgNewWpt = new mImage(isBigScreen?"newwpt_vga.png":"newwpt.png"));
+		imgNewWpt.transparentColor = new Color(255, 0, 0);
 		btnNewWpt.setToolTip(MyLocale.getMsg(311, "Create Waypoint"));
-		PenEvent.wantPenMoved(btnNewWpt, PenEvent.WANT_PEN_MOVED_ONOFF, true);
-		imgNewWpt.transparentColor = new Color(255, 0, 0);
-		// Button 2: Goto
-		pnlTools.addNext(btnGoto = new mButton(imgGoto = new mImage("goto" + imagesize + ".png")));// Goto.gif
-		// funzt
-		// manchmal
-		// nicht
+		
+		btnGoto = new mButton(imgGoto = new mImage(isBigScreen?"goto_vga.png":"goto.png"));
 		imgGoto.transparentColor = Color.White;
 		btnGoto.setToolTip(MyLocale.getMsg(345, "Goto these coordinates"));
-		// Button 3: Travelbugs
-		imgShowBug = new mImage("bug" + imagesize + ".gif");
-		imgShowBugNo = new mImage("bug_no" + imagesize + ".gif");
-		pnlTools.addNext(btnShowBug = new mButton(imgShowBugNo));
-		// btnShowBug.modify(Control.Disabled,0);
+		
+		btnShowBug = new mButton(new mImage(isBigScreen?"bug_no_vga.gif":"bug_no.gif"));
 		btnShowBug.setToolTip(MyLocale.getMsg(346, "Show travelbugs"));
-		// Button 4: Show Map
-		pnlTools.addNext(btnShowMap = new mButton(imgShowMaps = new mImage("globe_small" + imagesize + ".gif")));
+		this.deactivateControl(btnShowBug);
+		
+		btnShowMap = new mButton(new mImage(isBigScreen?"globe_small_vga.gif":"globe_small.gif"));
 		btnShowMap.setToolTip(MyLocale.getMsg(347, "Show map"));
-		// Button 5: Add images
-		pnlTools.addNext(btnAddPicture = new mButton(imgAddImages = new mImage("images" + imagesize + ".gif")));
+		
+		btnAddPicture = new mButton(imgAddImages = new mImage(isBigScreen?"images_vga.gif":"images_vga.gif"));
 		btnAddPicture.setToolTip(MyLocale.getMsg(348, "Add user pictures"));
+		
+		
+		// ===== put the controls onto the GUI =====
+		// ----- tools panel ------
+		pnlTools.addNext(btnNewWpt);
+		pnlTools.addNext(btnGoto);
+		pnlTools.addNext(btnShowBug);
+		pnlTools.addNext(btnShowMap);
+		pnlTools.addNext(btnAddPicture);		
+
 		// Button 6: Toggle blacklist status
-		imgBlackNo = new mImage("no_black" + imagesize + ".png");
+		imgBlackNo = new mImage(isBigScreen?"no_black_vga.png":"no_black.png");
 		imgBlackNo.transparentColor = Color.Black;
-		imgBlack = new mImage("is_black" + imagesize + ".png");
+		imgBlack = new mImage(isBigScreen?"is_black_vga.png":"is_black.png");
 		imgBlack.transparentColor = Color.White;
 		pnlTools.addNext(btnBlack = new mButton(imgBlackNo));
 		btnBlack.setToolTip(MyLocale.getMsg(349, "Toggle Blacklist status"));
 		// Button 7: Notes
-		pnlTools.addNext(btnNotes = new mButton(imgNotes = new mImage("notes" + imagesize + ".gif")));
+		pnlTools.addNext(btnNotes = new mButton(imgNotes = new mImage(isBigScreen?"notes_vga.gif":"notes.gif")));
 		imgNotes.transparentColor = Color.DarkBlue;
 		btnNotes.setToolTip(MyLocale.getMsg(351, "Add/Edit notes"));
 		// Button 8: Date/time stamp
-		pnlTools.addLast(btnAddDateTime = new mButton(new mImage("date_time" + imagesize + ".gif")));
+		pnlTools.addLast(btnAddDateTime = new mButton(new mImage(isBigScreen?"date_time_vga.gif":"date_time.gif")));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
 		// showMap.modify(Control.Disabled,0);
 		pnlTools.stretchFirstRow = true;
@@ -114,6 +185,19 @@
 		// //////////////////
 		// Main body of screen
 		// //////////////////
+		chcType = new mChoice(CacheType.guiTypeStrings(), 0);
+		chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
+		chcStatus = new mComboBox(new String[] { "",
+				MyLocale.getMsg(313, "Flag 1"), MyLocale.getMsg(314, "Flag 2"),
+				MyLocale.getMsg(315, "Flag 3"), MyLocale.getMsg(316, "Flag 4"),
+				MyLocale.getMsg(317, "Search"), MyLocale.getMsg(318, "Found"),
+				MyLocale.getMsg(319, "Not Found"), MyLocale.getMsg(320, "Owner") },
+				0);
+	inpWaypoint = new mInput();
+	inpName = new mInput();
+	btnWayLoc = new mButton();
+	inpHidden = new mInput();
+	inpOwner = new mInput();
 
 		this.addNext(new mLabel(MyLocale.getMsg(300, "Type:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
 		CellPanel line1Panel = new CellPanel();
@@ -149,7 +233,7 @@
 		this.addNext(new mLabel(MyLocale.getMsg(307, "Status:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		CellPanel cp = new CellPanel();
 		cp.addNext(chcStatus, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		cp.addLast(btnFoundDate = new mButton(new mImage("calendar" + imagesize + ".png")), DONTSTRETCH, DONTFILL);
+		cp.addLast(btnFoundDate = new mButton(new mImage(isBigScreen?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
 		this.addLast(cp, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
 		this.addNext(new mLabel(MyLocale.getMsg(306, "Owner:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
@@ -158,15 +242,14 @@
 		this.addNext(new mLabel(MyLocale.getMsg(305, "Hidden on:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		CellPanel ip = new CellPanel();
 		ip.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		ip.addLast(btnHiddenDate = new mButton(new mImage("calendar" + imagesize + ".png")), DONTSTRETCH, DONTFILL);
+		ip.addLast(btnHiddenDate = new mButton(new mImage(isBigScreen?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
 		this.addLast(ip, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
 		inpHidden.modifyAll(DisplayOnly, 0);
 
 		attV = new AttributesViewer();
 		this.addLast(attV);
 
-		if ((MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600)) {
-			isBigScreen = true;
+		if (isBigScreen) {
 			this.addLast(new mLabel(MyLocale.getMsg(308, "Notes:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 			mNotes = new mTextPad();
 			mNotes.modify(ControlConstants.NotEditable, 0);
@@ -522,7 +605,7 @@
 			ctrl.repaint();
 	}
 	
-//	private void save2() {
+	private void saveIfNeeded() {
 //		boolean saveWpt = false;
 //		boolean renameWpt = false;
 //		int newdiff;
@@ -545,7 +628,7 @@
 //		if (newdiff)
 //		if (newterr)
 //		if (btnBlack.getImage()
-//	}
+	}
 
 	public void saveDirtyWaypoint() {
 		//FIXME: here we should check if the data is now different from what it used to be when calling the details panel instead of relying on dirty flags
@@ -657,6 +740,10 @@
 		setNeedsTableUpdate(false);
 		thisCache.getFreshDetails().hasUnsavedChanges = true;
 	}
+	
+	public String getDisplayedWaypoint() {
+		return thisCache.getWayPoint();
+	}
 
 	private class TravelbugInCacheScreen extends Form {
 

Modified: experiments/greiol/src/CacheWolf/MainTab.java
===================================================================
--- experiments/greiol/src/CacheWolf/MainTab.java	2009-07-22 16:15:22 UTC (rev 2047)
+++ experiments/greiol/src/CacheWolf/MainTab.java	2009-07-22 20:51:40 UTC (rev 2048)
@@ -153,7 +153,7 @@
 				detP.saveDirtyWaypoint();
 				if (needTableUpdate) {
 					tbP.myMod.updateRows();// This sorts the waypoint (if it is new) into the right position
-					tbP.selectRow(profile.getCacheIndex(detP.thisCache.getWayPoint()));
+					tbP.selectRow(profile.getCacheIndex(detP.getDisplayedWaypoint()));
 				}
 				//was tbP.refreshTable();
 				tbP.tc.update(true); // Update and repaint



From greiol at mail.berlios.de  Thu Jul 23 14:05:02 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 23 Jul 2009 14:05:02 +0200
Subject: [Cachewolf-svn] r2049 - experiments/greiol/src/CacheWolf
Message-ID: <200907231205.n6NC52Co021763@sheep.berlios.de>

Author: greiol
Date: 2009-07-23 14:04:55 +0200 (Thu, 23 Jul 2009)
New Revision: 2049

Modified:
   experiments/greiol/src/CacheWolf/DetailsPanel.java
   experiments/greiol/src/CacheWolf/MainTab.java
   experiments/greiol/src/CacheWolf/Preferences.java
Log:
intermediate results

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-22 20:51:40 UTC (rev 2048)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-23 12:04:55 UTC (rev 2049)
@@ -1,8 +1,35 @@
 package CacheWolf;
 
-import ewe.ui.*;
-import ewe.fx.*;
-import ewe.sys.*;
+import ewe.fx.Color;
+import ewe.fx.Dimension;
+import ewe.fx.Point;
+import ewe.fx.mImage;
+import ewe.sys.Convert;
+import ewe.sys.Time;
+import ewe.sys.Vm;
+import ewe.ui.CellConstants;
+import ewe.ui.CellPanel;
+import ewe.ui.Control;
+import ewe.ui.ControlConstants;
+import ewe.ui.ControlEvent;
+import ewe.ui.DataChangeEvent;
+import ewe.ui.DateChooser;
+import ewe.ui.Event;
+import ewe.ui.Form;
+import ewe.ui.FormBase;
+import ewe.ui.Gui;
+import ewe.ui.HtmlDisplay;
+import ewe.ui.Menu;
+import ewe.ui.MenuItem;
+import ewe.ui.MessageBox;
+import ewe.ui.ScrollBarPanel;
+import ewe.ui.ScrollablePanel;
+import ewe.ui.mButton;
+import ewe.ui.mChoice;
+import ewe.ui.mComboBox;
+import ewe.ui.mInput;
+import ewe.ui.mLabel;
+import ewe.ui.mTextPad;
 
 /**
  * Class to create the panel to show the cache details.<br>
@@ -35,9 +62,9 @@
 	private static mButton btnGoto;
 	/** FIXME */
 	private static mButton btnAddPicture;
-	/** FIXME */
+	/** toggle blacklist status */
 	private static mButton btnBlack;
-	/** FIXME */
+	/** add or edit notes for waypoint */
 	private static mButton btnNotes;
 	/** FIXME */
 	private static mButton btnFoundDate;
@@ -91,29 +118,15 @@
 	private boolean needsTableUpdate;
 	/** screen is VGA or better */
 	private boolean isBigScreen;
+	/** use big icons */
+	private boolean useBigIcons;
 	
 	// ------------- initialize
 	// ------------- present data
 	// ------------- save data
 	// ------------- user interaction
 	// ------------- auxiliary methods
-	
 
-//	mInput inpWaypoint = new mInput();
-//	mInput inpName = new mInput();
-//	mButton btnWayLoc = new mButton();
-//	mInput inpHidden = new mInput();
-//	mInput inpOwner = new mInput();
-//	mChoice chcType = new mChoice(CacheType.guiTypeStrings(), 0);
-//	mChoice chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
-//	mComboBox chcStatus = new mComboBox(new String[] { "",
-//			MyLocale.getMsg(313, "Flag 1"), MyLocale.getMsg(314, "Flag 2"),
-//			MyLocale.getMsg(315, "Flag 3"), MyLocale.getMsg(316, "Flag 4"),
-//			MyLocale.getMsg(317, "Search"), MyLocale.getMsg(318, "Found"),
-//			MyLocale.getMsg(319, "Not Found"), MyLocale.getMsg(320, "Owner") },
-//			0);
-
-	
 	// TODO: move images to image broker
 	//mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgShowMaps, imgAddImages, imgNotes;
 
@@ -130,52 +143,64 @@
 		blackStatus = false;
 		blackStatusChanged = false;
 		needsTableUpdate = false;
-		// should this be limited to mobile devices? make a difference between big screen and big icons?
-		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
+		isBigScreen = pref.isBigScreen;
+		useBigIcons = pref.useBigIcons;
 
 		// ===== initialize GUI objects =====
 		// ----- tools panel ------
 		pnlTools = new CellPanel();
-		btnNewWpt = new mButton(imgNewWpt = new mImage(isBigScreen?"newwpt_vga.png":"newwpt.png"));
+		btnNewWpt = new mButton(imgNewWpt = new mImage(useBigIcons?"newwpt_vga.png":"newwpt.png"));
+		//FIXME: get an image with proper transparency
 		imgNewWpt.transparentColor = new Color(255, 0, 0);
 		btnNewWpt.setToolTip(MyLocale.getMsg(311, "Create Waypoint"));
 		
-		btnGoto = new mButton(imgGoto = new mImage(isBigScreen?"goto_vga.png":"goto.png"));
+		btnGoto = new mButton(imgGoto = new mImage(useBigIcons?"goto_vga.png":"goto.png"));
+		//FIXME: get an image with proper transparency
 		imgGoto.transparentColor = Color.White;
 		btnGoto.setToolTip(MyLocale.getMsg(345, "Goto these coordinates"));
 		
-		btnShowBug = new mButton(new mImage(isBigScreen?"bug_no_vga.gif":"bug_no.gif"));
+		btnShowBug = new mButton(new mImage(useBigIcons?"bug_no_vga.gif":"bug_no.gif"));
 		btnShowBug.setToolTip(MyLocale.getMsg(346, "Show travelbugs"));
-		this.deactivateControl(btnShowBug);
+		deactivateControl(btnShowBug);
 		
-		btnShowMap = new mButton(new mImage(isBigScreen?"globe_small_vga.gif":"globe_small.gif"));
+		btnShowMap = new mButton(new mImage(useBigIcons?"globe_small_vga.gif":"globe_small.gif"));
 		btnShowMap.setToolTip(MyLocale.getMsg(347, "Show map"));
 		
-		btnAddPicture = new mButton(imgAddImages = new mImage(isBigScreen?"images_vga.gif":"images_vga.gif"));
+		btnAddPicture = new mButton(imgAddImages = new mImage(useBigIcons?"images_vga.gif":"images_vga.gif"));
 		btnAddPicture.setToolTip(MyLocale.getMsg(348, "Add user pictures"));
 		
+		btnBlack = new mButton(imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png"));
+		//FIXME: get an image with proper transparency
+		imgBlack.transparentColor = Color.Black;
+		btnBlack.setToolTip(MyLocale.getMsg(349, "Toggle Blacklist status"));
 		
+		btnNotes = new mButton(imgNotes = new mImage(useBigIcons?"notes_vga.gif":"notes.gif"));
+		//FIXME: get an image with proper transparency
+		imgNotes.transparentColor = Color.DarkBlue;
+		btnNotes.setToolTip(MyLocale.getMsg(351, "Add/Edit notes"));
+		
+		btnAddDateTime = new mButton(new mImage(useBigIcons?"date_time_vga.gif":"date_time.gif"));
+		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
+		
 		// ===== put the controls onto the GUI =====
 		// ----- tools panel ------
 		pnlTools.addNext(btnNewWpt);
 		pnlTools.addNext(btnGoto);
 		pnlTools.addNext(btnShowBug);
 		pnlTools.addNext(btnShowMap);
-		pnlTools.addNext(btnAddPicture);		
+		pnlTools.addNext(btnAddPicture);	
+		pnlTools.addNext(btnBlack);
+		pnlTools.addNext(btnNotes);
+		pnlTools.addLast(btnAddDateTime);
+		
+		/*****************************************************\
+		 
+		                      CLEAN UP BELOW
+		                      
+		\*****************************************************/
 
-		// Button 6: Toggle blacklist status
-		imgBlackNo = new mImage(isBigScreen?"no_black_vga.png":"no_black.png");
-		imgBlackNo.transparentColor = Color.Black;
-		imgBlack = new mImage(isBigScreen?"is_black_vga.png":"is_black.png");
-		imgBlack.transparentColor = Color.White;
-		pnlTools.addNext(btnBlack = new mButton(imgBlackNo));
-		btnBlack.setToolTip(MyLocale.getMsg(349, "Toggle Blacklist status"));
-		// Button 7: Notes
-		pnlTools.addNext(btnNotes = new mButton(imgNotes = new mImage(isBigScreen?"notes_vga.gif":"notes.gif")));
-		imgNotes.transparentColor = Color.DarkBlue;
-		btnNotes.setToolTip(MyLocale.getMsg(351, "Add/Edit notes"));
 		// Button 8: Date/time stamp
-		pnlTools.addLast(btnAddDateTime = new mButton(new mImage(isBigScreen?"date_time_vga.gif":"date_time.gif")));
+		pnlTools.addLast(btnAddDateTime = new mButton(new mImage(useBigIcons?"date_time_vga.gif":"date_time.gif")));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
 		// showMap.modify(Control.Disabled,0);
 		pnlTools.stretchFirstRow = true;
@@ -233,7 +258,7 @@
 		this.addNext(new mLabel(MyLocale.getMsg(307, "Status:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		CellPanel cp = new CellPanel();
 		cp.addNext(chcStatus, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		cp.addLast(btnFoundDate = new mButton(new mImage(isBigScreen?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
+		cp.addLast(btnFoundDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
 		this.addLast(cp, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
 		this.addNext(new mLabel(MyLocale.getMsg(306, "Owner:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
@@ -242,7 +267,7 @@
 		this.addNext(new mLabel(MyLocale.getMsg(305, "Hidden on:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		CellPanel ip = new CellPanel();
 		ip.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		ip.addLast(btnHiddenDate = new mButton(new mImage(isBigScreen?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
+		ip.addLast(btnHiddenDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
 		this.addLast(ip, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
 		inpHidden.modifyAll(DisplayOnly, 0);
 
@@ -256,8 +281,25 @@
 			this.addLast(new MyScrollBarPanel(mNotes));
 		}
 	}
+	
+	public void toggleBugImage() {
+		
+	}
+	
+	/** toggle blackStatus and update image accordingly */
+	public void toggleBlackStatus() {
+		blackStatus = ! blackStatus;
+		if (blackStatus) {
+			imgBlack = new mImage(useBigIcons?"is_black_vga.png":"is_black.png");
+			imgBlack.transparentColor = Color.White;
+		} else {
+			imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png");
+			imgBlack.transparentColor = Color.Black;
+		}
+		btnBlack.repaint();
+	}
 
-	public void clear() {
+	public void clearAttributes() {
 		attV.clear();
 	}
 
@@ -411,7 +453,7 @@
 					btnDiff.setText(MyLocale.getMsg(1000, "D")+": -.-");
 				}
 			}
-			//FIXME: check if something was actually changed, since datacachnge events also occur if you just hop through the fileds with the tab key (Why? don't know!)
+			//FIXME: check if something was actually changed, since datachange events also occur if you just hop through the fileds with the tab key (Why? don't know!)
 			dirty_details = true;
 			needsTableUpdate = true;
 		}
@@ -426,19 +468,7 @@
 					mNotes.setText(thisCache.getCacheDetails(true).getCacheNotes());
 			} else if (ev.target == btnShowMap) {
 				Global.mainTab.SwitchToMovingMap(thisCache.pos, true);
-				/*
-				 * try { MapDetailForm mdf = new
-				 * MapDetailForm(thisCache.wayPoint, pref, profile);
-				 * mdf.execute(); } catch (IllegalArgumentException e) {
-				 * MessageBox tmp = new MessageBox(MyLocale.getMsg(321,"Error"),
-				 * MyLocale.getMsg(322,"Kann Bild/Karte nicht finden")+":
-				 * "+e.getMessage(), MessageBox.OKB); tmp.exec(); }
-				 */
 			} else if (ev.target == btnShowBug) {
-				// InfoScreen is = new InfoScreen(thisCache.Travelbugs.toHtml(),
-				// "Travelbugs",
-				// false, pref);
-				// is.execute();
 				TravelbugInCacheScreen ts = new TravelbugInCacheScreen(thisCache.getCacheDetails(true).Travelbugs.toHtml(),	"Travelbugs");
 				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
 			} else if (ev.target == btnCenter) {
@@ -565,7 +595,7 @@
 					dirty_details = true;
 					// profile.hasUnsavedChanges=true;
 				}
-			} else if (ev.target == this.btnTerr) {
+			} else if (ev.target == btnTerr) {
 				int returnValue;
 				TerrDiffForm tdf = new TerrDiffForm(true, thisCache
 						.getTerrain());
@@ -577,7 +607,7 @@
 							+ CacheTerrDiff.longDT(thisCache.getTerrain()));
 					dirty_details = true;
 				}
-			} else if (ev.target == this.btnDiff) {
+			} else if (ev.target == btnDiff) {
 				int returnValue;
 				TerrDiffForm tdf = new TerrDiffForm(false, thisCache.getHard());
 				returnValue = tdf.execute();

Modified: experiments/greiol/src/CacheWolf/MainTab.java
===================================================================
--- experiments/greiol/src/CacheWolf/MainTab.java	2009-07-22 20:51:40 UTC (rev 2048)
+++ experiments/greiol/src/CacheWolf/MainTab.java	2009-07-23 12:04:55 UTC (rev 2049)
@@ -100,7 +100,7 @@
 	public void clearDetails() {
 		imageP.clearImages(); // Remove all images
 		descP.clear(); // write "loading ..."
-		detP.clear(); // Clear only the attributes
+		detP.clearAttributes(); // Clear only the attributes
 		hintLP.clear(); // Remove the logs
 		solverP.setInstructions("loading ...");
 	}	

Modified: experiments/greiol/src/CacheWolf/Preferences.java
===================================================================
--- experiments/greiol/src/CacheWolf/Preferences.java	2009-07-22 20:51:40 UTC (rev 2048)
+++ experiments/greiol/src/CacheWolf/Preferences.java	2009-07-23 12:04:55 UTC (rev 2049)
@@ -102,6 +102,9 @@
 			}
 		} else
 			fontSize = 11;
+		//TODO: should be overridden by preferences
+		useBigIcons = Vm.isMobile() && MyLocale.getScreenWidth() >= 400;
+		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);;
 	}
 
     //////////////////////////////////////////////////////////////////////////////////////
@@ -118,8 +121,7 @@
 	public String myAlias = "";
 	/** Optional password */
 	public String password="";
-	/** This is an alternative alias used to identify found caches (i.e. if using multiple IDs)
-	 *  It is currently not used yet */
+	/** This is an alternative alias used to identify found caches (i.e. if using multiple IDs) */
 	public String myAlias2 = "";
 	/** The path to the browser */
 	public String browser = "";
@@ -244,6 +246,8 @@
 	 */
 	public boolean debug = false;
 	//////////////////////////////////////////////
+	public boolean isBigScreen;
+	public boolean useBigIcons;
 
     //////////////////////////////////////////////////////////////////////////////////////
     // Public fields not stored in pref.xml
@@ -610,6 +614,7 @@
 		saveCustomMapsPath(getMapLoadPathInternal());
 		return getCustomMapsPath();
 	}
+
 	private String getMapLoadPathInternal() {
 		// here could also a list of map-types displayed...
 		// standard dir
@@ -757,7 +762,8 @@
 	//////////////////////////////////////////////////////////////////////////////////////
 
 	/** Log file is in program directory and called log.txt */
-	private final String LOGFILENAME=FileBase.getProgramDirectory()+"/log.txt";
+	// FIXME: should be placed where pref.xml is
+	private final String LOGFILENAME = FileBase.getProgramDirectory().concat(FileBase.separator).concat("log.txt");
 
 	/**
 	 * Method to delete an existing log file. Called on every SpiderGC.
@@ -953,4 +959,9 @@
 			}
 		}
 	}
+	
+	/** directory where pref.xml is stored */
+	public String getPathToConfigFile() {
+		return pathToConfigFile;
+	}
 }



From greiol at mail.berlios.de  Thu Jul 23 14:38:50 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 23 Jul 2009 14:38:50 +0200
Subject: [Cachewolf-svn] r2050 - in trunk/src: CacheWolf exp
Message-ID: <200907231238.n6NCcohB025326@sheep.berlios.de>

Author: greiol
Date: 2009-07-23 14:38:42 +0200 (Thu, 23 Jul 2009)
New Revision: 2050

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/exp/GpxExportNg.java
Log:
removed obsolete @@ tag from gpxexporter
removed additional arguments from chd URL url construction that are not needed to call cache page

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-23 12:04:55 UTC (rev 2049)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-23 12:38:42 UTC (rev 2050)
@@ -315,7 +315,7 @@
 			}
 			else {
 				if (getParent().getWayPoint().startsWith("GC")) {
-					URL = "http://www.geocaching.com/seek/cache_details.aspx?wp="+ getParent().getWayPoint() + "&Submit6=Find&log=y";
+					URL = "http://www.geocaching.com/seek/cache_details.aspx?wp="+ getParent().getWayPoint();
 				}
 			}
 			ex = new Extractor(text, "<SOLVER><![CDATA[", "]]></SOLVER>", 0, true);

Modified: trunk/src/exp/GpxExportNg.java
===================================================================
--- trunk/src/exp/GpxExportNg.java	2009-07-23 12:04:55 UTC (rev 2049)
+++ trunk/src/exp/GpxExportNg.java	2009-07-23 12:38:42 UTC (rev 2050)
@@ -652,7 +652,7 @@
 		return "    <groundspeak:cache id=\"".concat(ch.GetCacheID()).concat("\" available=\"").concat(ch.is_available() ? TRUE : FALSE).concat("\" archived=\"").concat(ch.is_archived() ? TRUE : FALSE).concat("\" xmlns:groundspeak=\"http://www.groundspeak.com/cache/1/0\">\n")
 		.concat("      <groundspeak:name>").concat(SafeXML.cleanGPX(ch.getCacheName())).concat("</groundspeak:name>\n")
 		.concat("      <groundspeak:placed_by>").concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat("</groundspeak:placed_by>\n")
-		.concat("      <groundspeak:owner id=\"").concat("31415").concat("\">").concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat("@@CACHEOWNER@@</groundspeak:owner>\n")
+		.concat("      <groundspeak:owner id=\"").concat("31415").concat("\">").concat(SafeXML.cleanGPX(ch.getCacheOwner())).concat("</groundspeak:owner>\n")
 		.concat("      <groundspeak:type>").concat(CacheType.id2GpxString(ch.getType())).concat("</groundspeak:type>\n")
 		.concat("      <groundspeak:container>").concat(CacheSize.cw2ExportString(ch.getCacheSize())).concat("</groundspeak:container>\n")
 		.concat("      <groundspeak:difficulty>").concat(CacheTerrDiff.shortDT(ch.getHard())).concat("</groundspeak:difficulty>\n")



From greiol at mail.berlios.de  Thu Jul 23 14:50:45 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 23 Jul 2009 14:50:45 +0200
Subject: [Cachewolf-svn] r2051 - trunk/src/CacheWolf
Message-ID: <200907231250.n6NCojZK026658@sheep.berlios.de>

Author: greiol
Date: 2009-07-23 14:50:39 +0200 (Thu, 23 Jul 2009)
New Revision: 2051

Modified:
   trunk/src/CacheWolf/CacheType.java
Log:
extended waypoint type string for gpx export

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2009-07-23 12:38:42 UTC (rev 2050)
+++ trunk/src/CacheWolf/CacheType.java	2009-07-23 12:50:39 UTC (rev 2051)
@@ -561,26 +561,26 @@
 	 */
 	public static final String id2GpxString(byte id) throws IllegalArgumentException {
 		switch (id) {
-		case CW_TYPE_TRADITIONAL: return GC_GPX_TRADITIONAL;
-		case CW_TYPE_MULTI: return GC_GPX_MULTI;
-		case CW_TYPE_VIRTUAL: return GC_GPX_VIRTUAL;
-		case CW_TYPE_LETTERBOX: return GC_GPX_LETTERBOX;
-		case CW_TYPE_EVENT: return GC_GPX_EVENT;
-		case CW_TYPE_UNKNOWN: return GC_GPX_UNKNOWN;
-		case CW_TYPE_WEBCAM: return GC_GPX_WEBCAM;
-		case CW_TYPE_LOCATIONLESS: return GC_GPX_LOCATIONLESS;
-		case CW_TYPE_CITO: return GC_GPX_CITO;
-		case CW_TYPE_EARTH: return GC_GPX_EARTH;
-		case CW_TYPE_MEGA_EVENT: return GC_GPX_MEGA_EVENT;
-		case CW_TYPE_WHEREIGO: return GC_GPX_WHEREIGO;
+		case CW_TYPE_TRADITIONAL: return "Geocache|".concat(GC_GPX_TRADITIONAL);
+		case CW_TYPE_MULTI: return "Geocache|".concat(GC_GPX_MULTI);
+		case CW_TYPE_VIRTUAL: return "Geocache|".concat(GC_GPX_VIRTUAL);
+		case CW_TYPE_LETTERBOX: return "Geocache|".concat(GC_GPX_LETTERBOX);
+		case CW_TYPE_EVENT: return "Geocache|".concat(GC_GPX_EVENT);
+		case CW_TYPE_UNKNOWN: return "Geocache|".concat(GC_GPX_UNKNOWN);
+		case CW_TYPE_WEBCAM: return "Geocache|".concat(GC_GPX_WEBCAM);
+		case CW_TYPE_LOCATIONLESS: return "Geocache|".concat(GC_GPX_LOCATIONLESS);
+		case CW_TYPE_CITO: return "Geocache|".concat(GC_GPX_CITO);
+		case CW_TYPE_EARTH: return "Geocache|".concat(GC_GPX_EARTH);
+		case CW_TYPE_MEGA_EVENT: return "Geocache|".concat(GC_GPX_MEGA_EVENT);
+		case CW_TYPE_WHEREIGO: return "Geocache|".concat(GC_GPX_WHEREIGO);
 		case CW_TYPE_PARKING: return GC_GPX_PARKING;
 		case CW_TYPE_STAGE: return GC_GPX_STAGE;
 		case CW_TYPE_QUESTION: return GC_GPX_QUESTION;
 		case CW_TYPE_FINAL: return GC_GPX_FINAL;
 		case CW_TYPE_TRAILHEAD: return GC_GPX_TRAILHEAD;
 		case CW_TYPE_REFERENCE: return GC_GPX_REFERENCE;
-		case CW_TYPE_MAZE: return GC_GPX_MAZE;
-		case CW_TYPE_APE: return GC_GPX_APE;
+		case CW_TYPE_MAZE: return "Geocache|".concat(GC_GPX_MAZE);
+		case CW_TYPE_APE: return "Geocache|".concat(GC_GPX_APE);
 		case CW_TYPE_CUSTOM: return CW_GUISTR_CUSTOM;
 		default: throw new IllegalArgumentException("unmatched argument "+id+" in CacheSize id2GpxString()");
 		}



From greiol at mail.berlios.de  Thu Jul 23 23:41:59 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 23 Jul 2009 23:41:59 +0200
Subject: [Cachewolf-svn] r2052 - experiments/greiol/src/CacheWolf
Message-ID: <200907232141.n6NLfxAX006360@sheep.berlios.de>

Author: greiol
Date: 2009-07-23 23:41:57 +0200 (Thu, 23 Jul 2009)
New Revision: 2052

Modified:
   experiments/greiol/src/CacheWolf/DetailsPanel.java
Log:
cleanup part 2 of n

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-23 12:50:39 UTC (rev 2051)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-23 21:41:57 UTC (rev 2052)
@@ -98,8 +98,8 @@
 	private static CacheHolder thisCache;
 	/** FIXME: never used? */
 	private static int dbIndex = -1;
-	/** FIXME */
-	private static AttributesViewer attV;
+	/** panel to display waypoint attributes */
+	private static AttributesViewer attViewer;
 	/** preferences object */
 	private static Preferences pref;
 	/** waypoint profile */
@@ -120,18 +120,16 @@
 	private boolean isBigScreen;
 	/** use big icons */
 	private boolean useBigIcons;
-	
-	// ------------- initialize
-	// ------------- present data
-	// ------------- save data
-	// ------------- user interaction
-	// ------------- auxiliary methods
 
 	// TODO: move images to image broker
 	//mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgShowMaps, imgAddImages, imgNotes;
 
 	public DetailsPanel() {
 		
+		// ===== local objects =====
+		/** helper panels to organize layout */
+		CellPanel helperPanel1, helperPanel2, helperPanel3, helperPanel4, helperPanel5; 
+		
 		// ===== initialize data handles =====
 		pref = Global.getPref();
 		profile = Global.getProfile();
@@ -147,6 +145,7 @@
 		useBigIcons = pref.useBigIcons;
 
 		// ===== initialize GUI objects =====
+		
 		// ----- tools panel ------
 		pnlTools = new CellPanel();
 		btnNewWpt = new mButton(imgNewWpt = new mImage(useBigIcons?"newwpt_vga.png":"newwpt.png"));
@@ -166,7 +165,7 @@
 		btnShowMap = new mButton(new mImage(useBigIcons?"globe_small_vga.gif":"globe_small.gif"));
 		btnShowMap.setToolTip(MyLocale.getMsg(347, "Show map"));
 		
-		btnAddPicture = new mButton(imgAddImages = new mImage(useBigIcons?"images_vga.gif":"images_vga.gif"));
+		btnAddPicture = new mButton(imgAddImages = new mImage(useBigIcons?"images_vga.gif":"images.gif"));
 		btnAddPicture.setToolTip(MyLocale.getMsg(348, "Add user pictures"));
 		
 		btnBlack = new mButton(imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png"));
@@ -182,6 +181,32 @@
 		btnAddDateTime = new mButton(new mImage(useBigIcons?"date_time_vga.gif":"date_time.gif"));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
 		
+		// ----- main body -----
+		
+		helperPanel1 = new CellPanel();
+		helperPanel2 = new CellPanel();
+		helperPanel3 = new CellPanel();
+		helperPanel4 = new CellPanel();
+		helperPanel5 = new CellPanel();
+		attViewer = new AttributesViewer();
+		
+		chcType = new mChoice(CacheType.guiTypeStrings(), 0);
+		chcType.alwaysDrop = true;
+		chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
+		chcSize.alwaysDrop = true;
+		chcStatus = new mComboBox(new String[] { "",
+				MyLocale.getMsg(313, "Flag 1"), MyLocale.getMsg(314, "Flag 2"),
+				MyLocale.getMsg(315, "Flag 3"), MyLocale.getMsg(316, "Flag 4"),
+				MyLocale.getMsg(317, "Search"), MyLocale.getMsg(318, "Found"),
+				MyLocale.getMsg(319, "Not Found"), MyLocale.getMsg(320, "Owner") },
+				0);
+		inpWaypoint = new mInput();
+		inpName = new mInput();
+		btnWayLoc = new mButton();
+		inpOwner = new mInput();
+		inpHidden = new mInput();
+		inpHidden.modifyAll(DisplayOnly, 0);
+		
 		// ===== put the controls onto the GUI =====
 		// ----- tools panel ------
 		pnlTools.addNext(btnNewWpt);
@@ -193,138 +218,82 @@
 		pnlTools.addNext(btnNotes);
 		pnlTools.addLast(btnAddDateTime);
 		
-		/*****************************************************\
-		 
-		                      CLEAN UP BELOW
-		                      
-		\*****************************************************/
-
-		// Button 8: Date/time stamp
-		pnlTools.addLast(btnAddDateTime = new mButton(new mImage(useBigIcons?"date_time_vga.gif":"date_time.gif")));
-		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
-		// showMap.modify(Control.Disabled,0);
 		pnlTools.stretchFirstRow = true;
-		this.addLast(pnlTools, CellConstants.DONTSTRETCH, CellConstants.WEST).setTag(SPAN, new Dimension(3, 1));
-		;
-
-		// //////////////////
-		// Main body of screen
-		// //////////////////
-		chcType = new mChoice(CacheType.guiTypeStrings(), 0);
-		chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
-		chcStatus = new mComboBox(new String[] { "",
-				MyLocale.getMsg(313, "Flag 1"), MyLocale.getMsg(314, "Flag 2"),
-				MyLocale.getMsg(315, "Flag 3"), MyLocale.getMsg(316, "Flag 4"),
-				MyLocale.getMsg(317, "Search"), MyLocale.getMsg(318, "Found"),
-				MyLocale.getMsg(319, "Not Found"), MyLocale.getMsg(320, "Owner") },
-				0);
-	inpWaypoint = new mInput();
-	inpName = new mInput();
-	btnWayLoc = new mButton();
-	inpHidden = new mInput();
-	inpOwner = new mInput();
-
-		this.addNext(new mLabel(MyLocale.getMsg(300, "Type:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
-		CellPanel line1Panel = new CellPanel();
-		chcType.alwaysDrop = true;
-		line1Panel.addNext(chcType, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
-
-		line1Panel.addLast(btnDiff = new mButton(MyLocale.getMsg(1000, "D")	+ ": 5.5"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
+		
+		// ----- helper panels -----
+		
+		btnDiff = new mButton(MyLocale.getMsg(1000, "D")	+ ": 5.5");
 		btnDiff.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
-
-		this.addLast(line1Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
-
-		this.addNext(new mLabel(MyLocale.getMsg(301, "Size:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		CellPanel line2Panel = new CellPanel();
-		chcSize.alwaysDrop = true;
-		line2Panel.addNext(chcSize, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
-
-		line2Panel.addLast(btnTerr = new mButton(MyLocale.getMsg(1001, "T")	+ ": 5.5"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
+		
+		btnTerr = new mButton(MyLocale.getMsg(1001, "T")	+ ": 5.5");
 		btnTerr.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
-		this.addLast(line2Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+		
+		lblAddiCount = new mLabel(MyLocale.getMsg(1044, "Addis") + ": 888");
+		
+		btnFoundDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png"));
+		
+		btnHiddenDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png"));
 
-		this.addNext(new mLabel(MyLocale.getMsg(302, "Waypoint:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		line2Panel = new CellPanel();
-		line2Panel.addNext(inpWaypoint, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		line2Panel.addLast(lblAddiCount = new mLabel(MyLocale.getMsg(1044, "Addis") + ": 888"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
-		this.addLast(line2Panel, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+		helperPanel1.addNext(chcType, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
+		helperPanel1.addLast(btnDiff, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));		
+		
+		helperPanel2.addNext(chcSize, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
+		helperPanel2.addLast(btnTerr, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
 
-		this.addNext(new mLabel(MyLocale.getMsg(303, "Name:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		this.addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		helperPanel3.addNext(inpWaypoint, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		helperPanel3.addLast(lblAddiCount, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
 
-		this.addNext(new mLabel(MyLocale.getMsg(304, "Location:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		this.addLast(btnWayLoc.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		helperPanel4.addNext(chcStatus, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		helperPanel4.addLast(btnFoundDate, DONTSTRETCH, DONTFILL);
 
-		this.addNext(new mLabel(MyLocale.getMsg(307, "Status:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		CellPanel cp = new CellPanel();
-		cp.addNext(chcStatus, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		cp.addLast(btnFoundDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
-		this.addLast(cp, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+		helperPanel5.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		helperPanel5.addLast(btnHiddenDate, DONTSTRETCH, DONTFILL);
+		
+		// ----- main body -----
+		addLast(pnlTools, CellConstants.DONTSTRETCH, CellConstants.WEST).setTag(SPAN, new Dimension(3, 1));
+		
+		addNext(new mLabel(MyLocale.getMsg(300, "Type:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
+		addLast(helperPanel1, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+		
+		addNext(new mLabel(MyLocale.getMsg(301, "Size:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
+		addLast(helperPanel2, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+		
+		addNext(new mLabel(MyLocale.getMsg(302, "Waypoint:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(helperPanel3, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
+		
+		addNext(new mLabel(MyLocale.getMsg(303, "Name:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		
+		addNext(new mLabel(MyLocale.getMsg(304, "Location:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(btnWayLoc.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		
+		addNext(new mLabel(MyLocale.getMsg(307, "Status:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(helperPanel4, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
-		this.addNext(new mLabel(MyLocale.getMsg(306, "Owner:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		this.addLast(inpOwner.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-
-		this.addNext(new mLabel(MyLocale.getMsg(305, "Hidden on:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		CellPanel ip = new CellPanel();
-		ip.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		ip.addLast(btnHiddenDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png")), DONTSTRETCH, DONTFILL);
-		this.addLast(ip, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
-		inpHidden.modifyAll(DisplayOnly, 0);
-
-		attV = new AttributesViewer();
-		this.addLast(attV);
-
+		addNext(new mLabel(MyLocale.getMsg(306, "Owner:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(inpOwner.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		
+		addNext(new mLabel(MyLocale.getMsg(305, "Hidden on:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(helperPanel5, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
+		
+		addLast(attViewer);
+		
 		if (isBigScreen) {
 			this.addLast(new mLabel(MyLocale.getMsg(308, "Notes:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 			mNotes = new mTextPad();
 			mNotes.modify(ControlConstants.NotEditable, 0);
-			this.addLast(new MyScrollBarPanel(mNotes));
+			addLast(new MyScrollBarPanel(mNotes));
 		}
 	}
+
+	// ------------- present data
 	
-	public void toggleBugImage() {
-		
-	}
-	
-	/** toggle blackStatus and update image accordingly */
-	public void toggleBlackStatus() {
-		blackStatus = ! blackStatus;
-		if (blackStatus) {
-			imgBlack = new mImage(useBigIcons?"is_black_vga.png":"is_black.png");
-			imgBlack.transparentColor = Color.White;
-		} else {
-			imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png");
-			imgBlack.transparentColor = Color.Black;
-		}
-		btnBlack.repaint();
-	}
+	/*****************************************************\
+	 
+	                      CLEAN UP BELOW
+	                      
+	\*****************************************************/
 
-	public void clearAttributes() {
-		attV.clear();
-	}
-
-	public void setNeedsTableUpdate(boolean tableUpdate) {
-		needsTableUpdate = tableUpdate;
-	}
-
-	public boolean needsTableUpdate() {
-		return needsTableUpdate;
-	}
-
-	public boolean isDirty() {
-		return dirty_notes || dirty_details || needsTableUpdate;
-	}
-
-	public boolean hasBlackStatusChanged() {
-		return blackStatusChanged;
-	}
-
-	/**
-	 * @param chD
-	 *            details of the cache to display
-	 * @param dbindex
-	 *            index in cacheDB, in which changes will be saved
-	 */
 	public void setDetails(CacheHolder ch) {
 		thisCache = ch;
 		dirty_notes = false;
@@ -364,7 +333,7 @@
 		btnShowBug.repaintNow();
 		chcSize.setInt(ch.getCacheSize());
 
-		attV.showImages(ch.getCacheDetails(true).attributes);
+		attViewer.showImages(ch.getCacheDetails(true).attributes);
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
 			btnTerr.setText(MyLocale.getMsg(1001, "T")+": -.-");
 			btnDiff.setText(MyLocale.getMsg(1000, "D")+": -.-");
@@ -405,7 +374,59 @@
 			mNotes.setText(ch.getExistingDetails().getCacheNotes());
 	}
 
+	// ------------- save data
+	// ------------- user interaction
+	// ------------- auxiliary methods
+
+
+	
+	public void toggleBugImage() {
+		
+	}
+	
+	/** toggle blackStatus and update image accordingly */
+	public void toggleBlackStatus() {
+		blackStatus = ! blackStatus;
+		if (blackStatus) {
+			imgBlack = new mImage(useBigIcons?"is_black_vga.png":"is_black.png");
+			imgBlack.transparentColor = Color.White;
+		} else {
+			imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png");
+			imgBlack.transparentColor = Color.Black;
+		}
+		btnBlack.repaint();
+	}
+
+	/** clear attributes panel */
+	public void clearAttributes() {
+		attViewer.clear();
+	}
+
+	public void setNeedsTableUpdate(boolean tableUpdate) {
+		needsTableUpdate = tableUpdate;
+	}
+
+	public boolean needsTableUpdate() {
+		return needsTableUpdate;
+	}
+
+	public boolean isDirty() {
+		return dirty_notes || dirty_details || needsTableUpdate;
+	}
+
+	public boolean hasBlackStatusChanged() {
+		return blackStatusChanged;
+	}
+
 	/**
+	 * @param chD
+	 *            details of the cache to display
+	 * @param dbindex
+	 *            index in cacheDB, in which changes will be saved
+	 */
+
+
+	/**
 	 * if is addi -> returns the respective AddiWpt if is main -> returns the
 	 * respective MainWpt
 	 */



From greiol at mail.berlios.de  Fri Jul 24 22:26:45 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 24 Jul 2009 22:26:45 +0200
Subject: [Cachewolf-svn] r2053 - experiments/greiol/src/CacheWolf
Message-ID: <200907242026.n6OKQjxF008539@sheep.berlios.de>

Author: greiol
Date: 2009-07-24 22:26:43 +0200 (Fri, 24 Jul 2009)
New Revision: 2053

Modified:
   experiments/greiol/src/CacheWolf/DetailsPanel.java
Log:
part 3

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-23 21:41:57 UTC (rev 2052)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-24 20:26:43 UTC (rev 2053)
@@ -36,7 +36,7 @@
  * Also allows for creation of a custom waypoint.<br>
  */
 public class DetailsPanel extends CellPanel {
-	
+
 	// ===== GUI elements =====
 	/** waypoint id */
 	private static mInput inpWaypoint;
@@ -46,15 +46,15 @@
 	private static mInput inpHidden;
 	/** waypoint owner */
 	private static mInput inpOwner;
+	/** waypoint coordinates, open change coordinates dialog */
+	private static mButton btnCoordinates;
 	/** FIXME */
-	private static mButton btnWayLoc;
-	/** FIXME */
 	private static mButton btnCenter;
 	/** add time stamp to notes */
 	private static mButton btnAddDateTime;
 	/** FIXME */
 	private static mButton btnNewWpt;
-	/** FIXME */
+	/** show details for travelbus in waypoint */
 	private static mButton btnShowBug;
 	/** FIXME */
 	private static mButton btnShowMap;
@@ -83,19 +83,19 @@
 	/** FIXME */
 	private static CellPanel pnlTools;
 	/** FIXME */
-	private static mTextPad mNotes;
+	private static mTextPad cacheNotes;
 	/** FIXME */
 	private static mLabel lblAddiCount;
 	/** FIXME move to image broker?*/
 	private static mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgNotes;
 	/** FIXME: what are they for? */
 	private static mImage imgShowMaps, imgAddImages;
-	
+
 	// ===== data handles =====
 	/** FIXME: never used? */
 	private static CacheDB cacheDB;
 	/** waypoint to be displayed */
-	private static CacheHolder thisCache;
+	private static CacheHolder ch;
 	/** FIXME: never used? */
 	private static int dbIndex = -1;
 	/** panel to display waypoint attributes */
@@ -104,12 +104,12 @@
 	private static Preferences pref;
 	/** waypoint profile */
 	private static Profile profile;
-	
+
 	// ===== flags =====
 	/** notes have changes */
 	private boolean dirty_notes;
 	/** details have changed FIXME: make this obsolete */
-	private boolean dirty_details;
+//	private boolean dirty_details;
 	/** cache is blacklisted FIXME: make this obsolete*/
 	private boolean blackStatus;
 	/** blacklist status was changed by user FIXME: make this obsolete */
@@ -125,19 +125,19 @@
 	//mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgShowMaps, imgAddImages, imgNotes;
 
 	public DetailsPanel() {
-		
+
 		// ===== local objects =====
 		/** helper panels to organize layout */
 		CellPanel helperPanel1, helperPanel2, helperPanel3, helperPanel4, helperPanel5; 
-		
+
 		// ===== initialize data handles =====
 		pref = Global.getPref();
 		profile = Global.getProfile();
 		cacheDB = profile.cacheDB;
-		
+
 		// ===== initialize flags =====
 		dirty_notes = false;
-		dirty_details = false;
+//		dirty_details = false;
 		blackStatus = false;
 		blackStatusChanged = false;
 		needsTableUpdate = false;
@@ -145,51 +145,50 @@
 		useBigIcons = pref.useBigIcons;
 
 		// ===== initialize GUI objects =====
-		
+
 		// ----- tools panel ------
 		pnlTools = new CellPanel();
 		btnNewWpt = new mButton(imgNewWpt = new mImage(useBigIcons?"newwpt_vga.png":"newwpt.png"));
 		//FIXME: get an image with proper transparency
 		imgNewWpt.transparentColor = new Color(255, 0, 0);
 		btnNewWpt.setToolTip(MyLocale.getMsg(311, "Create Waypoint"));
-		
+
 		btnGoto = new mButton(imgGoto = new mImage(useBigIcons?"goto_vga.png":"goto.png"));
 		//FIXME: get an image with proper transparency
 		imgGoto.transparentColor = Color.White;
 		btnGoto.setToolTip(MyLocale.getMsg(345, "Goto these coordinates"));
-		
+
 		btnShowBug = new mButton(new mImage(useBigIcons?"bug_no_vga.gif":"bug_no.gif"));
 		btnShowBug.setToolTip(MyLocale.getMsg(346, "Show travelbugs"));
-		deactivateControl(btnShowBug);
-		
+
 		btnShowMap = new mButton(new mImage(useBigIcons?"globe_small_vga.gif":"globe_small.gif"));
 		btnShowMap.setToolTip(MyLocale.getMsg(347, "Show map"));
-		
+
 		btnAddPicture = new mButton(imgAddImages = new mImage(useBigIcons?"images_vga.gif":"images.gif"));
 		btnAddPicture.setToolTip(MyLocale.getMsg(348, "Add user pictures"));
-		
+
 		btnBlack = new mButton(imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png"));
 		//FIXME: get an image with proper transparency
 		imgBlack.transparentColor = Color.Black;
 		btnBlack.setToolTip(MyLocale.getMsg(349, "Toggle Blacklist status"));
-		
+
 		btnNotes = new mButton(imgNotes = new mImage(useBigIcons?"notes_vga.gif":"notes.gif"));
 		//FIXME: get an image with proper transparency
 		imgNotes.transparentColor = Color.DarkBlue;
 		btnNotes.setToolTip(MyLocale.getMsg(351, "Add/Edit notes"));
-		
+
 		btnAddDateTime = new mButton(new mImage(useBigIcons?"date_time_vga.gif":"date_time.gif"));
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350, "Add timestamp to notes"));
-		
+
 		// ----- main body -----
-		
+
 		helperPanel1 = new CellPanel();
 		helperPanel2 = new CellPanel();
 		helperPanel3 = new CellPanel();
 		helperPanel4 = new CellPanel();
 		helperPanel5 = new CellPanel();
 		attViewer = new AttributesViewer();
-		
+
 		chcType = new mChoice(CacheType.guiTypeStrings(), 0);
 		chcType.alwaysDrop = true;
 		chcSize = new mChoice(CacheSize.guiSizeStrings(), 0);
@@ -202,11 +201,14 @@
 				0);
 		inpWaypoint = new mInput();
 		inpName = new mInput();
-		btnWayLoc = new mButton();
+		
+		btnCoordinates = new mButton();
+		btnCoordinates.setToolTip(MyLocale.getMsg(31415, "Edit coordinates"));
+		
 		inpOwner = new mInput();
 		inpHidden = new mInput();
 		inpHidden.modifyAll(DisplayOnly, 0);
-		
+
 		// ===== put the controls onto the GUI =====
 		// ----- tools panel ------
 		pnlTools.addNext(btnNewWpt);
@@ -217,26 +219,30 @@
 		pnlTools.addNext(btnBlack);
 		pnlTools.addNext(btnNotes);
 		pnlTools.addLast(btnAddDateTime);
-		
+
 		pnlTools.stretchFirstRow = true;
-		
+
 		// ----- helper panels -----
-		
+
 		btnDiff = new mButton(MyLocale.getMsg(1000, "D")	+ ": 5.5");
 		btnDiff.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
-		
+		btnDiff.setToolTip(MyLocale.getMsg(31415, "Edit difficulty"));
+
 		btnTerr = new mButton(MyLocale.getMsg(1001, "T")	+ ": 5.5");
 		btnTerr.setPreferredSize(pref.fontSize * 3, chcSize.getPreferredSize(null).height);
-		
+		btnTerr.setToolTip(MyLocale.getMsg(31415, "Edit terrain"));
+
 		lblAddiCount = new mLabel(MyLocale.getMsg(1044, "Addis") + ": 888");
-		
+
 		btnFoundDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png"));
-		
+		btnFoundDate.setToolTip(MyLocale.getMsg(31415, "Set found date / time"));
+
 		btnHiddenDate = new mButton(new mImage(useBigIcons?"calendar_vga.png":"calendar.png"));
+		btnHiddenDate.setToolTip(MyLocale.getMsg(31415, "Set hidden date"));
 
 		helperPanel1.addNext(chcType, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 		helperPanel1.addLast(btnDiff, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));		
-		
+
 		helperPanel2.addNext(chcSize, CellConstants.HSTRETCH,	(CellConstants.HFILL | CellConstants.WEST));
 		helperPanel2.addLast(btnTerr, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.EAST));
 
@@ -248,107 +254,114 @@
 
 		helperPanel5.addNext(inpHidden, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
 		helperPanel5.addLast(btnHiddenDate, DONTSTRETCH, DONTFILL);
-		
+
 		// ----- main body -----
 		addLast(pnlTools, CellConstants.DONTSTRETCH, CellConstants.WEST).setTag(SPAN, new Dimension(3, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(300, "Type:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
 		addLast(helperPanel1, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(301, "Size:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.NORTHWEST));
 		addLast(helperPanel2, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(302, "Waypoint:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(helperPanel3, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(303, "Name:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(inpName.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		
-		addNext(new mLabel(MyLocale.getMsg(304, "Location:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-		addLast(btnWayLoc.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		
+
+		addNext(new mLabel(MyLocale.getMsg(304, "Coordinates:")),	CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
+		addLast(btnCoordinates.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+
 		addNext(new mLabel(MyLocale.getMsg(307, "Status:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(helperPanel4, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN,	new Dimension(2, 1));
 
 		addNext(new mLabel(MyLocale.getMsg(306, "Owner:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(inpOwner.setTag(CellConstants.SPAN, new Dimension(2, 1)), CellConstants.DONTSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
-		
+
 		addNext(new mLabel(MyLocale.getMsg(305, "Hidden on:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
 		addLast(helperPanel5, DONTSTRETCH, HFILL).setTag(CellConstants.SPAN, new Dimension(2, 1));
-		
+
 		addLast(attViewer);
-		
+
 		if (isBigScreen) {
 			this.addLast(new mLabel(MyLocale.getMsg(308, "Notes:")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL | CellConstants.WEST));
-			mNotes = new mTextPad();
-			mNotes.modify(ControlConstants.NotEditable, 0);
-			addLast(new MyScrollBarPanel(mNotes));
+			cacheNotes = new mTextPad();
+			cacheNotes.modify(ControlConstants.NotEditable, 0);
+			addLast(new MyScrollBarPanel(cacheNotes));
 		}
 	}
 
 	// ------------- present data
-	
-	/*****************************************************\
-	 
-	                      CLEAN UP BELOW
-	                      
-	\*****************************************************/
 
-	public void setDetails(CacheHolder ch) {
-		thisCache = ch;
+	public void setDetails(CacheHolder nch) {
+		ch = nch;
+
+		int addiCount;
+
 		dirty_notes = false;
-		dirty_details = false;
+
 		inpWaypoint.setText(ch.getWayPoint());
 		inpName.setText(ch.getCacheName());
-		btnWayLoc.setText(ch.pos.toString());
 		inpHidden.setText(ch.getDateHidden());
 		inpOwner.setText(ch.getCacheOwner());
+		
+		btnCoordinates.setText(ch.pos.toString());
+		// If the cache status contains a date, do not overwrite it with 'found' message		
 		if (ch.getCacheStatus().length() >= 10 && ch.getCacheStatus().charAt(4) == '-') {
 			chcStatus.setText(MyLocale.getMsg(318, "Found") + " " + ch.getCacheStatus());
 		} else {
 			chcStatus.setText(ch.getCacheStatus());
-			// If the cache status contains a date, do not overwrite it with
-			// 'found' message
+
 			if (ch.is_found() == true)
 				chcStatus.setText(MyLocale.getMsg(318, "Found"));
 		}
+		
 		chcType.setInt(CacheType.cw2GuiSelect(ch.getType()));
-		if (ch.is_black()) {
-			btnBlack.image = imgBlack;
-		} else {
-			btnBlack.image = imgBlackNo;
-		}
-		blackStatus = ch.is_black();
+		
+		blackStatus = !ch.is_black();
+		toggleBlackStatus();
 		blackStatusChanged = false;
-		btnBlack.repaintNow();
+		
 		if (inpWaypoint.getText().length() == 0)
 			createWptName();
-		if (ch.has_bugs() == true) {
-			// btnShowBug.modify(Control.Disabled,1);
-			btnShowBug.image = imgShowBug;
+		
+		//TODO: update after TB dialog?
+		if (ch.has_bugs()) {
+			btnShowBug.image = new mImage(useBigIcons?"bug_vga.gif":"bug.gif");	
 		} else {
-			// btnShowBug.modify(Control.Disabled,0);
-			btnShowBug.image = imgShowBugNo;
+			btnShowBug.image = new mImage(useBigIcons?"bug_no_vga.gif":"bug_no.gif");
 		}
-		btnShowBug.repaintNow();
+		btnShowBug.repaint();
+		
 		chcSize.setInt(ch.getCacheSize());
 
 		attViewer.showImages(ch.getCacheDetails(true).attributes);
+		
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
 			btnTerr.setText(MyLocale.getMsg(1001, "T")+": -.-");
 			btnDiff.setText(MyLocale.getMsg(1000, "D")+": -.-");
 			deactivateControl(btnTerr);
 			deactivateControl(btnDiff);
 			deactivateControl(chcSize);
+			deactivateControl(inpOwner);
+			deactivateControl(inpHidden);
+			deactivateControl(btnShowBug);
+			deactivateControl(btnBlack);
 			chcSize.select(0);
 		} else {
 			activateControl(btnTerr);
 			activateControl(btnDiff);
 			activateControl(chcSize);
+			activateControl(inpOwner);
+			activateControl(inpHidden);
+			activateControl(btnShowBug);
+			activateControl(btnBlack);
 			if (CacheTerrDiff.isValidTD(ch.getTerrain())) {
 				btnTerr.setText(MyLocale.getMsg(1001, "T") + ": " + CacheTerrDiff.longDT(ch.getTerrain()));
 			} else {
 				btnTerr.setText("T: -.-");
+				//FIXME: put incomplete to save method?
 				ch.setIncomplete(true);
 				if (Global.getPref().debug)
 					Global.getPref().log(ch.getWayPoint() + " has wrong terrain " + ch.getTerrain());
@@ -357,41 +370,130 @@
 				btnDiff.setText(MyLocale.getMsg(1000, "D") + ": " + CacheTerrDiff.longDT(ch.getHard()));
 			} else {
 				btnDiff.setText("D: -.-");
+				//FIXME: put incomplete to save method?
 				ch.setIncomplete(true);
 				if (Global.getPref().debug)
-					Global.getPref().log(ch.getWayPoint() + " has wrong difficulty " + ch.getHard());
+					Global.getPref().log(nch.getWayPoint() + " has wrong difficulty " + ch.getHard());
 			}
 		}
-		int addiCount = 0;
+
 		if (ch.mainCache == null) {
-			addiCount = ch.addiWpts.size();
+			addiCount = nch.addiWpts.size();
 		} else {
-			addiCount = ch.mainCache.addiWpts.size();
+			addiCount = nch.mainCache.addiWpts.size();
 		}
+		
 		lblAddiCount.setText(MyLocale.getMsg(1044, "Addis") + ": " + String.valueOf(addiCount));
 
 		if (isBigScreen)
-			mNotes.setText(ch.getExistingDetails().getCacheNotes());
+			cacheNotes.setText(nch.getExistingDetails().getCacheNotes());
 	}
 
-	// ------------- save data
 	// ------------- user interaction
 	// ------------- auxiliary methods
 
+	/*****************************************************\
 
-	
-	public void toggleBugImage() {
+	                      CLEAN UP BELOW
+
+	\*****************************************************/
+
+	// ------------- save data
+	/**
+	 * save waypoint if there have been any changes
+	 * @return true if changes were saved, false if there were no changes to save
+	 */
+	protected boolean saveIfNeeded() {
+		// waypoint
+		// userimages ???
+		// coordinates
+		// status
+		// terrain
+		// difficulty
+		boolean needsSaving = false;
+		int newDifficulty, newTerrain;
 		
+		if (!inpHidden.getText().equals(ch.getDateHidden())) {
+			ch.setDateHidden(inpHidden.getText());
+			needsSaving = true;
+		}
+		
+		if (!inpOwner.getText().equals(ch.getCacheOwner())) {
+			ch.setCacheOwner(inpOwner.getText());
+			needsSaving = true;
+		}
+		
+		if (!inpName.getText().equals(ch.getCacheName())) {
+			ch.setCacheName(inpName.getText());
+			needsSaving = true;
+		}
+		
+		if (CacheSize.guiSizeStrings2CwSize(chcSize.getText()) != ch.getCacheSize()) {
+			ch.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize.getText()));
+			needsSaving = true;
+		}
+		
+		if (ch.getType() != CacheType.guiSelect2Cw(chcType.getInt())) {
+			ch.setType(CacheType.guiSelect2Cw(chcType.getInt()));
+			needsSaving = true;
+		}
+		
+		if (blackStatus != ch.is_black()) {
+			ch.setBlack(blackStatus);
+			needsSaving = true;
+			//TODO: propagate to addis. how?
+		}
+		
+		if (!ch.pos.toString().equals(btnCoordinates.getText())) {
+			ch.LatLon = btnCoordinates.getText();
+			/// PUH!
+		}
+		
+		if (isBigScreen) {
+			if (!cacheNotes.getText().equals(ch.getFreshDetails().getCacheNotes())) {
+				ch.getFreshDetails().setCacheNotes(cacheNotes.getText());
+				needsSaving = true;
+			}
+		}
+		
+		// ch.setAttributesToAddiWpts();
+		//		boolean saveWpt = false;
+		//		boolean renameWpt = false;
+		//		int newdiff;
+		//		int newTerr;
+		//	
+		//		Objects to check:
+
+
+		//		if (!this.inpWaypoint.equals(thisCache.getWayPoint())) {
+		//			saveWpt = true;
+		//			renameWpt = true;
+		//		}
+		//		if (!this.chcSize)
+		//		if (!this.chcStatus)
+		//		if (!this.chcType)
+		//		if (newdiff)
+		//		if (newterr)
+		//		if (btnBlack.getImage()
+		needsTableUpdate = needsTableUpdate || needsSaving;
+		return true;
 	}
-	
+
+
+	public void toggleBugImage() {
+
+	}
+
 	/** toggle blackStatus and update image accordingly */
 	public void toggleBlackStatus() {
 		blackStatus = ! blackStatus;
 		if (blackStatus) {
-			imgBlack = new mImage(useBigIcons?"is_black_vga.png":"is_black.png");
+			btnBlack.image = (imgBlack = new mImage(useBigIcons?"is_black_vga.png":"is_black.png"));
+			//FIXME: get image with proper transparency
 			imgBlack.transparentColor = Color.White;
 		} else {
-			imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png");
+			btnBlack.image = (imgBlack = new mImage(useBigIcons?"no_black_vga.png":"no_black.png"));
+			//FIXME: get image with proper transparency
 			imgBlack.transparentColor = Color.Black;
 		}
 		btnBlack.repaint();
@@ -411,7 +513,8 @@
 	}
 
 	public boolean isDirty() {
-		return dirty_notes || dirty_details || needsTableUpdate;
+		return dirty_notes || needsTableUpdate;
+		//return dirty_notes || dirty_details || needsTableUpdate;
 	}
 
 	public boolean hasBlackStatusChanged() {
@@ -434,9 +537,9 @@
 		String wpt = inpWaypoint.getText().toUpperCase();
 		if (CacheType.isAddiWpt(CacheType.guiSelect2Cw(chcType.getInt())) && 
 				(Global.mainTab.mainCache.startsWith("GC") || 
-					Global.mainTab.mainCache.startsWith("OC") || 
-					Global.mainTab.mainCache.startsWith("CW")) 
-				&& wpt.startsWith("CW")) {
+						Global.mainTab.mainCache.startsWith("OC") || 
+						Global.mainTab.mainCache.startsWith("CW")) 
+						&& wpt.startsWith("CW")) {
 			// for what was this?:
 			Global.mainTab.lastselected = Global.mainTab.mainCache; // I don't know exactly, but it's needed for creating a series of Addis
 
@@ -475,25 +578,28 @@
 				}
 			}
 			//FIXME: check if something was actually changed, since datachange events also occur if you just hop through the fileds with the tab key (Why? don't know!)
-			dirty_details = true;
+//			dirty_details = true;
 			needsTableUpdate = true;
 		}
 		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
 			if (ev.target == btnNotes) {
 				dirty_notes = true; // TODO I think this is redundant, because
-									// the notes are saved separately by the notes screen itself
-				NotesScreen nsc = new NotesScreen(thisCache
+				// the notes are saved separately by the notes screen itself
+				NotesScreen nsc = new NotesScreen(ch
 						.getCacheDetails(true));
 				nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
 				if (isBigScreen)
-					mNotes.setText(thisCache.getCacheDetails(true).getCacheNotes());
+					cacheNotes.setText(ch.getCacheDetails(true).getCacheNotes());
+				
 			} else if (ev.target == btnShowMap) {
-				Global.mainTab.SwitchToMovingMap(thisCache.pos, true);
+				Global.mainTab.SwitchToMovingMap(ch.pos, true);
+				
 			} else if (ev.target == btnShowBug) {
-				TravelbugInCacheScreen ts = new TravelbugInCacheScreen(thisCache.getCacheDetails(true).Travelbugs.toHtml(),	"Travelbugs");
+				TravelbugInCacheScreen ts = new TravelbugInCacheScreen(ch.getCacheDetails(true).Travelbugs.toHtml(),	"Travelbugs");
 				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
+				
 			} else if (ev.target == btnCenter) {
-				CWPoint cp = new CWPoint(thisCache.LatLon);
+				CWPoint cp = new CWPoint(ch.LatLon);
 				if (!cp.isValid()) {
 					MessageBox tmpMB = new MessageBox(
 							MyLocale.getMsg(312, "Error"),
@@ -504,9 +610,10 @@
 					pref.curCentrePt.set(cp);
 					Global.mainTab.updateBearDist();
 				}
+				
 			} else if (ev.target == btnAddDateTime) {
 				dirty_notes = true;
-				String note = thisCache.getCacheDetails(true).getCacheNotes();
+				String note = ch.getCacheDetails(true).getCacheNotes();
 				Time dtm = new Time();
 				dtm.getTime();
 				dtm.setFormat("E dd.MM.yyyy '/' HH:mm");
@@ -515,55 +622,62 @@
 				else
 					note = note + dtm.toString();
 				note = note + "\n";
-				thisCache.getCacheDetails(true).setCacheNotes(note);
+				ch.getCacheDetails(true).setCacheNotes(note);
 				//FIXME: better use saveDirtyWaypoint()?
-				thisCache.save();
+				ch.save();
+				
 			} else if (ev.target == btnAddPicture) {
-				thisCache.getCacheDetails(true).addUserImage(profile);
+				ch.getCacheDetails(true).addUserImage(profile);
+				
 			} else if (ev.target == btnBlack) {
-				if (thisCache.is_black()) {
-					//FIXME: only change thisCache in save routine
-					thisCache.setBlack(false);
-					btnBlack.image = imgBlackNo;
-				} else {
-					//FIXME: only change thisCache in save routine
-					thisCache.setBlack(true);
-					btnBlack.image = imgBlack;
-				}
-				//FIXME: during display of details only the GUI should be relevant
-				// and we collect results at the end
-				blackStatus = thisCache.is_black();
-				thisCache.setAttributesToAddiWpts();
-				btnBlack.repaintNow();
-				dirty_details = true;
-				blackStatusChanged = true;
+				toggleBlackStatus();
+//				if (ch.is_black()) {
+//					//FIXME: only change thisCache in save routine
+//					ch.setBlack(false);
+//					btnBlack.image = imgBlackNo;
+//				} else {
+//					//FIXME: only change thisCache in save routine
+//					ch.setBlack(true);
+//					btnBlack.image = imgBlack;
+//				}
+//				//FIXME: during display of details only the GUI should be relevant
+//				// and we collect results at the end
+//				blackStatus = ch.is_black();
+//				
+//				btnBlack.repaintNow();
+////				dirty_details = true;
+//				blackStatusChanged = true;
+				
 			} else if (ev.target == btnNewWpt) {
-				CacheHolder ch = new CacheHolder();
-				ch.LatLon = thisCache.LatLon;
-				ch.pos = new CWPoint(thisCache.pos);
-				ch.setType(CacheType.CW_TYPE_STAGE);
-				ch.setHard(CacheTerrDiff.CW_DT_UNSET);
-				ch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
-				ch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
-				Global.mainTab.newWaypoint(ch);
+				CacheHolder newch = new CacheHolder();
+				newch.LatLon = ch.LatLon;
+				newch.pos = new CWPoint(ch.pos);
+				newch.setType(CacheType.CW_TYPE_STAGE);
+				newch.setHard(CacheTerrDiff.CW_DT_UNSET);
+				newch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
+				newch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
+				Global.mainTab.newWaypoint(newch);
+				
 			} else if (ev.target == btnGoto) {
 				// FIXME: if something changed saveDirtyWaypoint();
-				Global.mainTab.gotoP.setDestinationAndSwitch(thisCache);
-			} else if (ev.target == btnWayLoc) {
-				CWPoint coords = new CWPoint(btnWayLoc.getText(), CWPoint.CW);
+				Global.mainTab.gotoP.setDestinationAndSwitch(ch);
+				
+			} else if (ev.target == btnCoordinates) {
+				CWPoint coords = new CWPoint(btnCoordinates.getText(), CWPoint.CW);
 				CoordsScreen cs = new CoordsScreen(true);
 				cs.setFields(coords, CWPoint.CW);
 				if (cs.execute() == FormBase.IDOK) {
-					dirty_details = true;
+//					dirty_details = true;
+					//FIXME: don't do this, use save funktion instead!!
 					coords = cs.getCoords();
-					Global.getProfile().notifyUnsavedChanges(!thisCache.pos.toString().equals(coords.toString()));
-					thisCache.pos.set(coords);
-					btnWayLoc.setText(coords.toString());
-					thisCache.LatLon = coords.toString();
+					Global.getProfile().notifyUnsavedChanges(!ch.pos.toString().equals(coords.toString()));
+					ch.pos.set(coords);
+					btnCoordinates.setText(coords.toString());
+					ch.LatLon = coords.toString();
 					// If the current centre is valid, calculate the distance and bearing to it
 					CWPoint centre = Global.getPref().curCentrePt;
 					if (centre.isValid())
-						thisCache.calcDistance(centre);
+						ch.calcDistance(centre);
 				}
 			} else if (ev.target == btnFoundDate) {
 				// DateChooser.dayFirst=true;
@@ -587,11 +701,11 @@
 				dc.reset(t);
 				if (dc.execute() == ewe.ui.FormBase.IDOK) {
 					chcStatus.setText(MyLocale.getMsg(318, "Found") + " "
-									+ Convert.toString(dc.year) + "-"
-									+ MyLocale.formatLong(dc.month, "00") + "-"
-									+ MyLocale.formatLong(dc.day, "00") + " "
-									+ dc.time);
-					dirty_details = true;
+							+ Convert.toString(dc.year) + "-"
+							+ MyLocale.formatLong(dc.month, "00") + "-"
+							+ MyLocale.formatLong(dc.day, "00") + " "
+							+ dc.time);
+//					dirty_details = true;
 					// profile.hasUnsavedChanges=true;
 				}
 			} else if (ev.target == btnHiddenDate) {
@@ -609,41 +723,41 @@
 					} catch (NumberFormatException e) {
 						dc.reset(new Time());
 					}
-				if (dc.execute() == ewe.ui.FormBase.IDOK) {
-					inpHidden.setText(Convert.toString(dc.year) + "-"
-							+ MyLocale.formatLong(dc.month, "00") + "-"
-							+ MyLocale.formatLong(dc.day, "00"));
-					dirty_details = true;
-					// profile.hasUnsavedChanges=true;
-				}
+					if (dc.execute() == ewe.ui.FormBase.IDOK) {
+						inpHidden.setText(Convert.toString(dc.year) + "-"
+								+ MyLocale.formatLong(dc.month, "00") + "-"
+								+ MyLocale.formatLong(dc.day, "00"));
+//						dirty_details = true;
+						// profile.hasUnsavedChanges=true;
+					}
 			} else if (ev.target == btnTerr) {
 				int returnValue;
-				TerrDiffForm tdf = new TerrDiffForm(true, thisCache
+				TerrDiffForm tdf = new TerrDiffForm(true, ch
 						.getTerrain());
 				returnValue = tdf.execute();
-				if (returnValue == 1 && tdf.getDT() != thisCache.getTerrain()) {
+				if (returnValue == 1 && tdf.getDT() != ch.getTerrain()) {
 					//FIXME: do this when waypoint is checked for saving
-					thisCache.setTerrain(tdf.getDT());
+					ch.setTerrain(tdf.getDT());
 					btnTerr.setText(MyLocale.getMsg(1001, "T") + ": "
-							+ CacheTerrDiff.longDT(thisCache.getTerrain()));
-					dirty_details = true;
+							+ CacheTerrDiff.longDT(ch.getTerrain()));
+//					dirty_details = true;
 				}
 			} else if (ev.target == btnDiff) {
 				int returnValue;
-				TerrDiffForm tdf = new TerrDiffForm(false, thisCache.getHard());
+				TerrDiffForm tdf = new TerrDiffForm(false, ch.getHard());
 				returnValue = tdf.execute();
-				if (returnValue == 1 && tdf.getDT() != thisCache.getHard()) {
+				if (returnValue == 1 && tdf.getDT() != ch.getHard()) {
 					//FIXME: do this when waypoint is checked for saving
-					thisCache.setHard(tdf.getDT());
+					ch.setHard(tdf.getDT());
 					btnDiff.setText(MyLocale.getMsg(1000, "D") + ": "
-							+ CacheTerrDiff.longDT(thisCache.getHard()));
-					dirty_details = true;
+							+ CacheTerrDiff.longDT(ch.getHard()));
+//					dirty_details = true;
 				}
 			}
 			ev.consumed = true;
 		}
 	}
-	
+
 	/** allow user input on control item */
 	private void activateControl(Control ctrl) {
 		if (ctrl.change(0, ControlConstants.Disabled))
@@ -655,38 +769,16 @@
 		if (ctrl.change(ControlConstants.Disabled, 0))
 			ctrl.repaint();
 	}
-	
-	private void saveIfNeeded() {
-//		boolean saveWpt = false;
-//		boolean renameWpt = false;
-//		int newdiff;
-//		int newTerr;
-//	
-//		Objects to check:
-//		if (!this.inpName.equals(thisCache.getCacheName()))
-//			saveWpt = true;
-//		if (!this.inpHidden.equals(thisCache.getDateHidden()))
-//			saveWpt = true;
-//		if (!this.inpOwner.equals(thisCache.getCacheOwner()))
-//			saveWpt = true;
-//		if (!this.inpWaypoint.equals(thisCache.getWayPoint())) {
-//			saveWpt = true;
-//			renameWpt = true;
-//		}
-//		if (!this.chcSize)
-//		if (!this.chcStatus)
-//		if (!this.chcType)
-//		if (newdiff)
-//		if (newterr)
-//		if (btnBlack.getImage()
-	}
 
+
+
+
 	public void saveDirtyWaypoint() {
 		//FIXME: here we should check if the data is now different from what it used to be when calling the details panel instead of relying on dirty flags
 		//FIXME: take care of renaming waypoints
 		//FIXME: add method to convert back text of difficulty & terrain buttons
 		//FIXME: check if manual changes have converted a cache from incomplete to complete
-		
+
 		// We have to update two objects: thisCache (a CacheHolderDetail) which
 		// contains
 		// the full cache which will be written to the cache.xml file AND
@@ -694,57 +786,70 @@
 		// Strip the found message if the status contains a date
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, "Found"))
 				&& chcStatus.getText().length() >= MyLocale
-						.getMsg(318, "Found").length() + 11) {
-			thisCache.setCacheStatus(chcStatus.getText().substring(
+				.getMsg(318, "Found").length() + 11) {
+			ch.setCacheStatus(chcStatus.getText().substring(
 					MyLocale.getMsg(318, "Found").length() + 1));
 		} else {
-			thisCache.setCacheStatus(chcStatus.getText());
+			ch.setCacheStatus(chcStatus.getText());
 		}
-		if (!thisCache.is_found() && thisCache.getCacheStatus().length() >= 10
-				&& thisCache.getCacheStatus().charAt(4) == '-') {
+		
+		if (!ch.is_found() && ch.getCacheStatus().length() >= 10
+				&& ch.getCacheStatus().charAt(4) == '-') {
 			// Use same heuristic condition as in setDetails(CacheHolder) to
 			// determine, if this
 			// cache
 			// has to considered as found.
-			thisCache.setFound(true);
+			ch.setFound(true);
 		} else {
-			thisCache.setFound(chcStatus.getText().startsWith(
+			ch.setFound(chcStatus.getText().startsWith(
 					MyLocale.getMsg(318, "Found")));
 		}
-		thisCache.setCacheOwner(inpOwner.getText().trim());
-		thisCache.setOwned(thisCache.getCacheStatus().equals(
+		
+		ch.setCacheOwner(inpOwner.getText().trim());
+		
+		ch.setOwned(ch.getCacheStatus().equals(
 				MyLocale.getMsg(320, "Owner")));
 		// Avoid setting is_owned if alias is empty and username is empty
-		if (thisCache.is_owned() == false) {
-			thisCache.setOwned((!pref.myAlias.equals("") && pref.myAlias
-					.equals(thisCache.getCacheOwner()))
+		if (ch.is_owned() == false) {
+			ch.setOwned((!pref.myAlias.equals("") && pref.myAlias
+					.equals(ch.getCacheOwner()))
 					|| (!pref.myAlias2.equals("") && pref.myAlias2
-							.equals(thisCache.getCacheOwner())));
+							.equals(ch.getCacheOwner())));
 		}
-		thisCache.setBlack(blackStatus);
-		String oldWaypoint = thisCache.getWayPoint();
-		thisCache.setWayPoint(inpWaypoint.getText().toUpperCase().trim());
-		thisCache.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize
+		
+		ch.setBlack(blackStatus);
+		
+		String oldWaypoint = ch.getWayPoint();
+		ch.setWayPoint(inpWaypoint.getText().toUpperCase().trim());
+		
+		ch.setCacheSize(CacheSize.guiSizeStrings2CwSize(chcSize
 				.getText()));
+		
 		// If the waypoint does not have a name, give it one
-		if (thisCache.getWayPoint().equals("")) {
-			thisCache.setWayPoint(profile.getNewWayPointName());
+		if (ch.getWayPoint().equals("")) {
+			ch.setWayPoint(profile.getNewWayPointName());
 		}
+		
 		// Don't allow single letter names=> Problems in updateBearingDistance
 		// This is a hack but faster than slowing down the loop in
 		// updateBearingDistance
-		if (thisCache.getWayPoint().length() < 2)
-			thisCache.setWayPoint(thisCache.getWayPoint() + " ");
-		thisCache.setCacheName(inpName.getText().trim());
-		thisCache.LatLon = thisCache.pos.toString();
-		thisCache.setDateHidden(inpHidden.getText().trim());
-		byte oldType = thisCache.getType();
-		thisCache.setType(CacheType.guiSelect2Cw(chcType.getInt()));
+		if (ch.getWayPoint().length() < 2)
+			ch.setWayPoint(ch.getWayPoint() + " ");
+		
+		ch.setCacheName(inpName.getText().trim());
+		
+		ch.LatLon = ch.pos.toString();
+		
+		ch.setDateHidden(inpHidden.getText().trim());
+		
+		byte oldType = ch.getType();
+		ch.setType(CacheType.guiSelect2Cw(chcType.getInt()));
+		
 		// thisCache.saveCacheDetails(profile.dataDir); // this is redundant,
 		// because all changes
 		// affecting the details are immediately saved
 		// Now update the table
-		CacheHolder ch = thisCache; // TODO variable ch is redundant
+		
 
 		/*
 		 * The references have to be rebuilt if: - the cachetype changed from
@@ -753,7 +858,7 @@
 		 */
 		if (CacheType.isAddiWpt(ch.getType()) != CacheType.isAddiWpt(oldType)
 				|| ((CacheType.isAddiWpt(ch.getType()) || CacheType
-						.isAddiWpt(oldType)) && !thisCache.getWayPoint()
+						.isAddiWpt(oldType)) && !ch.getWayPoint()
 						.equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
 			if (CacheType.isAddiWpt(ch.getType())) {
@@ -770,16 +875,16 @@
 						(new MessageBox(
 								MyLocale.getMsg(144, "Warning"),
 								MyLocale.getMsg(734,"No main cache found for addi waypoint ")
-										+ " "+ ch.getWayPoint()+ "\n"
-										+ MyLocale.getMsg(735,"Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),
+								+ " "+ ch.getWayPoint()+ "\n"
+								+ MyLocale.getMsg(735,"Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),
 								FormBase.OKB)).execute();
 				}
 				profile.buildReferences(); // TODO this takes quite long -> use
-											// profile.setAddiRef
+				// profile.setAddiRef
 				// instead
 			} else {
 				profile.buildReferences(); // we have to do this to release the
-											// link between the
+				// link between the
 				// two caches
 			}
 		}
@@ -787,13 +892,13 @@
 		ch.setAttributesToAddiWpts();
 		ch.checkIncomplete();
 		dirty_notes = false;
-		dirty_details = false;
+//		dirty_details = false;
 		setNeedsTableUpdate(false);
-		thisCache.getFreshDetails().hasUnsavedChanges = true;
+		ch.getFreshDetails().hasUnsavedChanges = true;
 	}
-	
+
 	public String getDisplayedWaypoint() {
-		return thisCache.getWayPoint();
+		return ch.getWayPoint();
 	}
 
 	private class TravelbugInCacheScreen extends Form {
@@ -832,14 +937,14 @@
 				TBMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(
 						6016, "Pick up Travelbug"));
 				TBMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6017,
-						"Drop Travelbug"));
+				"Drop Travelbug"));
 				mnuPopup = new Menu(TBMenuItems, "");
 			}
 
 			public void penRightReleased(Point p) {
 				setMenu(mnuPopup);
 				doShowMenu(p); // direct call (not through doMenu) is neccesary
-								// because it will
+				// because it will
 				// exclude the whole table
 			}
 
@@ -850,20 +955,20 @@
 
 			public void popupMenuEvent(Object selectedItem) {
 				if (selectedItem == mnuPickupTB) {
-					Travelbug tb = TravelbugPickup.pickupTravelbug(thisCache.getCacheDetails(true).Travelbugs);
+					Travelbug tb = TravelbugPickup.pickupTravelbug(ch.getCacheDetails(true).Travelbugs);
 					if (tb != null) {
-						dirty_details = true;
+//						dirty_details = true;
 						// Get the list of my travelbugs
 						tbjList = new TravelbugJourneyList();
 						tbjList.readTravelbugsFile();
 						// Add the tb to this list
 						tbjList.addTbPickup(tb, Global.getProfile().name,
-								thisCache.getWayPoint());
+								ch.getWayPoint());
 						tbjList.saveTravelbugsFile();
 						tbjList = null;
-						setHtml(thisCache.getCacheDetails(true).Travelbugs.toHtml());
+						setHtml(ch.getCacheDetails(true).Travelbugs.toHtml());
 						repaint();
-						thisCache.setHas_bugs(thisCache.getCacheDetails(true).Travelbugs.size() > 0);
+						ch.setHas_bugs(ch.getCacheDetails(true).Travelbugs.size() > 0);
 					}
 				} else if (selectedItem == mnuDropTB) {
 					tbjList = new TravelbugJourneyList();
@@ -874,16 +979,16 @@
 					tbs.execute();
 					if (tbs.selectedItem >= 0) {
 						Travelbug tb = tbl.getTB(tbs.selectedItem);
-						thisCache.getCacheDetails(true).Travelbugs.add(tb);
+						ch.getCacheDetails(true).Travelbugs.add(tb);
 						tbjList.addTbDrop(tb, Global.getProfile().name,
-								thisCache.getWayPoint());
+								ch.getWayPoint());
 					}
 					tbjList.saveTravelbugsFile();
 					tbjList = null;
-					thisCache.setHas_bugs(thisCache.getCacheDetails(true).Travelbugs.size() > 0);
-					setHtml(thisCache.getCacheDetails(true).Travelbugs.toHtml());
+					ch.setHas_bugs(ch.getCacheDetails(true).Travelbugs.size() > 0);
+					setHtml(ch.getCacheDetails(true).Travelbugs.toHtml());
 					repaint();
-					dirty_details = true;
+//					dirty_details = true;
 				} else
 					super.popupMenuEvent(selectedItem);
 			}



From apreisser at mail.berlios.de  Sun Jul 26 16:07:03 2009
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sun, 26 Jul 2009 16:07:03 +0200
Subject: [Cachewolf-svn] r2054 - trunk/res_noewe
Message-ID: <200907261407.n6QE73ea012632@sheep.berlios.de>

Author: apreisser
Date: 2009-07-26 16:07:02 +0200 (Sun, 26 Jul 2009)
New Revision: 2054

Modified:
   trunk/res_noewe/info_de.html
Log:
Ups, there was a typo.
Also changed a little bit the text to make it stylistic better

Modified: trunk/res_noewe/info_de.html
===================================================================
--- trunk/res_noewe/info_de.html	2009-07-24 20:26:43 UTC (rev 2053)
+++ trunk/res_noewe/info_de.html	2009-07-26 14:07:02 UTC (rev 2054)
@@ -8,8 +8,9 @@
 <br>
 CacheWolf wurde im Jahre 2003 erschaffen, um papierloses Cachen mit dem Sharp Zaurus zu erm?glichen.
 Da das Programm in Java geschrieben wurde, kam es nach einer Weile zu Anfragen, dieses Tools
-auch auf Pocket PCs laufen zu lassen.<BR>Da die existierenden Java-Laufzeit-Umgebungen der Pocket-PCs
-nicht die notwendige leistungsf?hig aufweisen, wurde CacheWolf f?r EWE neu implementiert.<BR><BR>
+auch auf anderen Pocket PCs laufen zu lassen.<BR>
+Allerdings weisen die existierenden Java-Laufzeit-Umgebungen f?r Pocket-PCs nicht die notwendige Leistungsf?higkeit auf.
+Daher wurde CacheWolf f?r EWE neu implementiert.<BR><BR>
 Du bist an der Weiterentwicklung von CacheWolf herzlich eingeladen.<BR><BR>
 CacheWolf Homepage: www.cachewolf.de<br>
 Diskussionsforum zu CacheWolf: www.geoclub.de<br><br>



From mik77 at mail.berlios.de  Mon Jul 27 10:33:03 2009
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Mon, 27 Jul 2009 10:33:03 +0200
Subject: [Cachewolf-svn] r2055 - trunk/src/CacheWolf
Message-ID: <200907270833.n6R8X3uH011262@sheep.berlios.de>

Author: mik77
Date: 2009-07-27 10:32:55 +0200 (Mon, 27 Jul 2009)
New Revision: 2055

Modified:
   trunk/src/CacheWolf/CWPoint.java
Log:
Allow separators when parsing decimal degrees.

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2009-07-26 14:07:02 UTC (rev 2054)
+++ trunk/src/CacheWolf/CWPoint.java	2009-07-27 08:32:55 UTC (rev 2055)
@@ -207,8 +207,9 @@
 									"[,./_;+:-]*\\s*" + // allow N xx xx.xxx / E xxx xx.xxx
 									"([EWewOo])\\s*([0-9]{1,3})(?:[?\uC2B0]\\s*|\\s+[?\uC2B0]?\\s*)([0-9]{1,2})(?:(?:['?]\\s*|\\s+['?]?\\s*)([0-9]{1,2}))?(?:[,.]([0-9]{1,8}))?\\s*['?\"]?" +
 									")|(?:" +
-									"(?:([NnSs])\\s*(?![+-]))?"   +     "([+-]?[0-9]{1,2})[,.]([0-9]{1,8})(?:(?=[+-EeWwOo])|\\s+|\\s*[?\uC2B0]\\s*)" +
-								  	"(?:([EeWwOo])\\s*(?![+-]))?"    +     "([+-]?[0-9]{1,3})[,.]([0-9]{1,8})\\s*[?\uC2B0]?" +
+                  "(?:([NnSs])\\s*(?![+-]))?"   +     "([+-]?[0-9]{1,2})[,.]([0-9]{1,8})(?:(?=[+-EeWwOo])|\\s+|\\s*[?\uC2B0]\\s*)" +
+                  "[,./_;:]*\\s*" +
+                  "(?:([EeWwOo])\\s*(?![+-]))?"    +     "([+-]?[0-9]{1,3})[,.]([0-9]{1,8})\\s*[?\uC2B0]?" +
 									")|(?:" +
 									"([0-9]{1,2}[C-HJ-PQ-X])\\s*[EeOo]?\\s*([0-9]{1,7})\\s+[Nn]?\\s*([0-9]{1,7})" +
 									")|(?:" +



From greiol at mail.berlios.de  Mon Jul 27 21:45:08 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 27 Jul 2009 21:45:08 +0200
Subject: [Cachewolf-svn] r2056 - experiments/greiol/src/CacheWolf
Message-ID: <200907271945.n6RJj81K004976@sheep.berlios.de>

Author: greiol
Date: 2009-07-27 21:45:06 +0200 (Mon, 27 Jul 2009)
New Revision: 2056

Modified:
   experiments/greiol/src/CacheWolf/CacheHolder.java
   experiments/greiol/src/CacheWolf/CacheHolderDetail.java
   experiments/greiol/src/CacheWolf/DetailsPanel.java
Log:
part4

Modified: experiments/greiol/src/CacheWolf/CacheHolder.java
===================================================================
--- experiments/greiol/src/CacheWolf/CacheHolder.java	2009-07-27 08:32:55 UTC (rev 2055)
+++ experiments/greiol/src/CacheWolf/CacheHolder.java	2009-07-27 19:45:06 UTC (rev 2056)
@@ -725,6 +725,7 @@
 	 * cache should be set to do so.
 	 */
 	public void save() {
+		checkIncomplete();
 		this.getFreshDetails().saveCacheDetails(Global.getProfile().dataDir);
 	}
 	
@@ -1075,9 +1076,19 @@
     	return wayPoint;
     }
 
+	/**
+	 * set a new waypointd id and rename all associated files (details & images)
+	 * @param wayPoint new waypoint identifier
+	 */
 	public void setWayPoint(String wayPoint) {
-		Global.getProfile().notifyUnsavedChanges(!wayPoint.equals(this.wayPoint));		
-    	this.wayPoint = wayPoint;
+		if (!wayPoint.equals(this.wayPoint)){
+			if (getFreshDetails().rename(wayPoint)) {
+				this.wayPoint = wayPoint;
+				Global.getProfile().notifyUnsavedChanges(true);
+			} else {
+				Global.getPref().log("Could not rename "+this.wayPoint+" to "+wayPoint);
+			}
+		}
     }
 
 	public String getCacheName() {
@@ -1461,23 +1472,5 @@
 		Global.getProfile().notifyUnsavedChanges(hasNote != this.hasNote);		
 		this.hasNote = hasNote;
 	}
-	
-	/**
-	 * rename a waypoint and all its associated files
-	 * @param newWptId new waypoint id (will be converted to upper case)
-	 * @return true on success, false on error
-	 */
-	public boolean rename(String newWptId) {
-		newWptId = newWptId.toUpperCase();
-		getFreshDetails();
-		if (details.rename(newWptId)) {
-			setWayPoint(newWptId);
-			save();
-			Global.getProfile().notifyUnsavedChanges(true);
-			return true;
-		} else {
-			return false;
-		}
-	}
 }
 

Modified: experiments/greiol/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- experiments/greiol/src/CacheWolf/CacheHolderDetail.java	2009-07-27 08:32:55 UTC (rev 2055)
+++ experiments/greiol/src/CacheWolf/CacheHolderDetail.java	2009-07-27 19:45:06 UTC (rev 2056)
@@ -451,9 +451,6 @@
 			String profiledir = Global.getProfile().dataDir;
 			int oldWptLength = getParent().getWayPoint().length();
 			
-			// just in case ... (got the pun? ;) )
-			newWptId = newWptId.toUpperCase();
-			
 			// update image information
 			for(int i = 0;i<images.size();i++){
 				String filename = images.get(i).getFilename();
@@ -523,6 +520,7 @@
 				//TODO: any chance of a roll back?
 				//TODO: should we ignore a file not found?
 			}
+			hasUnsavedChanges = true;
 			
 			return success;
 		}

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-27 08:32:55 UTC (rev 2055)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-27 19:45:06 UTC (rev 2056)
@@ -48,43 +48,43 @@
 	private static mInput inpOwner;
 	/** waypoint coordinates, open change coordinates dialog */
 	private static mButton btnCoordinates;
-	/** FIXME */
+	/** set center to current waypoint */
 	private static mButton btnCenter;
 	/** add time stamp to notes */
 	private static mButton btnAddDateTime;
-	/** FIXME */
+	/** create a new waypoint */
 	private static mButton btnNewWpt;
 	/** show details for travelbus in waypoint */
 	private static mButton btnShowBug;
-	/** FIXME */
+	/** switch to moving map and center on waypoint coordinates */
 	private static mButton btnShowMap;
-	/** FIXME */
+	/** set waypoint as destination and switch to goto ppanel */
 	private static mButton btnGoto;
-	/** FIXME */
+	/** add a user picture to waypoint */
 	private static mButton btnAddPicture;
 	/** toggle blacklist status */
 	private static mButton btnBlack;
 	/** add or edit notes for waypoint */
 	private static mButton btnNotes;
-	/** FIXME */
+	/** set found date */
 	private static mButton btnFoundDate;
-	/** FIXME */
+	/** set hidden date */
 	private static mButton btnHiddenDate;
-	/** FIXME */
+	/** set terrain value */
 	private static mButton btnTerr;
-	/** FIXME */
+	/** set difficulty value */
 	private static mButton btnDiff;
 	/** drop down list with cache types */
 	private static mChoice chcType;
 	/** drop down list with container sizes */
 	private static mChoice chcSize;
-	/** FIXME */
+	/** select waypoint status */
 	private static mComboBox chcStatus;
-	/** FIXME */
+	/** toolbar panel */
 	private static CellPanel pnlTools;
-	/** FIXME */
+	/** notes for waypoint */
 	private static mTextPad cacheNotes;
-	/** FIXME */
+	/** shows number of additional waypoints */
 	private static mLabel lblAddiCount;
 	/** FIXME move to image broker?*/
 	private static mImage imgBlack, imgBlackNo, imgShowBug, imgShowBugNo, imgNewWpt, imgGoto, imgNotes;
@@ -406,12 +406,16 @@
 	protected boolean saveIfNeeded() {
 		// waypoint
 		// userimages ???
-		// coordinates
 		// status
-		// terrain
-		// difficulty
+		
+		//FIXME: check boolean flags
+
+		/** one or more properties have changed and details need to be saved */
 		boolean needsSaving = false;
-		int newDifficulty, newTerrain;
+		/** rebuild references if type changed from addi to custom or cache and vice versa */
+		boolean rebuildReferences = false;
+		/** temp vars */
+		byte tmpbyte;
 		
 		if (!inpHidden.getText().equals(ch.getDateHidden())) {
 			ch.setDateHidden(inpHidden.getText());
@@ -434,6 +438,7 @@
 		}
 		
 		if (ch.getType() != CacheType.guiSelect2Cw(chcType.getInt())) {
+			//check if type changed addi <-> custom||cahe to rebuild references
 			ch.setType(CacheType.guiSelect2Cw(chcType.getInt()));
 			needsSaving = true;
 		}
@@ -446,9 +451,22 @@
 		
 		if (!ch.pos.toString().equals(btnCoordinates.getText())) {
 			ch.LatLon = btnCoordinates.getText();
-			/// PUH!
+			ch.pos = new CWPoint(ch.LatLon);
+			needsSaving = true;
 		}
 		
+		tmpbyte = decodeTerrDiff(btnDiff.getText(), ch.isCacheWpt());
+		if (tmpbyte != ch.getHard()) {
+			ch.setHard(tmpbyte);
+			needsSaving = true;
+		}
+		
+		tmpbyte = decodeTerrDiff(btnTerr.getText(), ch.isCacheWpt());
+		if (tmpbyte != ch.getTerrain()) {
+			ch.setTerrain(tmpbyte);
+			needsSaving = true;
+		}
+		
 		if (isBigScreen) {
 			if (!cacheNotes.getText().equals(ch.getFreshDetails().getCacheNotes())) {
 				ch.getFreshDetails().setCacheNotes(cacheNotes.getText());
@@ -456,26 +474,11 @@
 			}
 		}
 		
-		// ch.setAttributesToAddiWpts();
-		//		boolean saveWpt = false;
-		//		boolean renameWpt = false;
-		//		int newdiff;
-		//		int newTerr;
-		//	
-		//		Objects to check:
-
-
-		//		if (!this.inpWaypoint.equals(thisCache.getWayPoint())) {
-		//			saveWpt = true;
-		//			renameWpt = true;
-		//		}
-		//		if (!this.chcSize)
-		//		if (!this.chcStatus)
-		//		if (!this.chcType)
-		//		if (newdiff)
-		//		if (newterr)
-		//		if (btnBlack.getImage()
-		needsTableUpdate = needsTableUpdate || needsSaving;
+		if (needsSaving) {
+			ch.save();
+			needsTableUpdate = true;
+		}
+		
 		return true;
 	}
 
@@ -516,6 +519,23 @@
 		return dirty_notes || needsTableUpdate;
 		//return dirty_notes || dirty_details || needsTableUpdate;
 	}
+	
+	/**
+	 * convert the string displayed in the terrain in difficulty buttons to a byte for intrernal use<br>
+	 * assumes that the relevant information will at positions 3 and 5 in a 0 indexed string 
+	 * @param td string for terrain or difficulty
+	 * @param isCache true if waypoint is a cache, false for addis and custom
+	 * @return 0 for additional or custum waypoints, -1 for caches if td is not valid, parsed byte otherwise
+	 */
+	private byte decodeTerrDiff(String td, boolean isCache) {
+		if (! isCache) return 0;
+		
+		td = td.substring(3,1).concat(td.substring(5,1));
+		
+		if (td.equals("--")) return -1;
+		
+		return Byte.parseByte(td);
+	}
 
 	public boolean hasBlackStatusChanged() {
 		return blackStatusChanged;
@@ -623,6 +643,9 @@
 					note = note + dtm.toString();
 				note = note + "\n";
 				ch.getCacheDetails(true).setCacheNotes(note);
+				if (isBigScreen) {
+					cacheNotes.setText(ch.details.getCacheNotes());
+				}
 				//FIXME: better use saveDirtyWaypoint()?
 				ch.save();
 				



From greiol at mail.berlios.de  Mon Jul 27 21:59:42 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Mon, 27 Jul 2009 21:59:42 +0200
Subject: [Cachewolf-svn] r2057 - experiments/greiol/src/CacheWolf
Message-ID: <200907271959.n6RJxgqd006158@sheep.berlios.de>

Author: greiol
Date: 2009-07-27 21:59:41 +0200 (Mon, 27 Jul 2009)
New Revision: 2057

Modified:
   experiments/greiol/src/CacheWolf/CacheHolder.java
Log:
upps. wrong version submitted

Modified: experiments/greiol/src/CacheWolf/CacheHolder.java
===================================================================
--- experiments/greiol/src/CacheWolf/CacheHolder.java	2009-07-27 19:45:06 UTC (rev 2056)
+++ experiments/greiol/src/CacheWolf/CacheHolder.java	2009-07-27 19:59:41 UTC (rev 2057)
@@ -1076,19 +1076,9 @@
     	return wayPoint;
     }
 
-	/**
-	 * set a new waypointd id and rename all associated files (details & images)
-	 * @param wayPoint new waypoint identifier
-	 */
 	public void setWayPoint(String wayPoint) {
-		if (!wayPoint.equals(this.wayPoint)){
-			if (getFreshDetails().rename(wayPoint)) {
-				this.wayPoint = wayPoint;
-				Global.getProfile().notifyUnsavedChanges(true);
-			} else {
-				Global.getPref().log("Could not rename "+this.wayPoint+" to "+wayPoint);
-			}
-		}
+		Global.getProfile().notifyUnsavedChanges(!wayPoint.equals(this.wayPoint));		
+    	this.wayPoint = wayPoint;
     }
 
 	public String getCacheName() {
@@ -1472,5 +1462,23 @@
 		Global.getProfile().notifyUnsavedChanges(hasNote != this.hasNote);		
 		this.hasNote = hasNote;
 	}
+	
+	/**
+	 * rename a waypoint and all its associated files
+	 * @param newWptId new waypoint id (will be converted to upper case)
+	 * @return true on success, false on error
+	 */
+	public boolean rename(String newWptId) {
+		newWptId = newWptId.toUpperCase();
+		getFreshDetails();
+		if (details.rename(newWptId)) {
+			setWayPoint(newWptId);
+			save();
+			Global.getProfile().notifyUnsavedChanges(true);
+			return true;
+		} else {
+			return false;
+		}
+	}
 }
 



From greiol at mail.berlios.de  Tue Jul 28 09:27:07 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 28 Jul 2009 09:27:07 +0200
Subject: [Cachewolf-svn] r2058 - experiments/greiol/src/CacheWolf
Message-ID: <200907280727.n6S7R7TB005060@sheep.berlios.de>

Author: greiol
Date: 2009-07-28 09:27:06 +0200 (Tue, 28 Jul 2009)
New Revision: 2058

Modified:
   experiments/greiol/src/CacheWolf/DetailsPanel.java
Log:
part 5 save routine

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-27 19:59:41 UTC (rev 2057)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-28 07:27:06 UTC (rev 2058)
@@ -34,6 +34,7 @@
 /**
  * Class to create the panel to show the cache details.<br>
  * Also allows for creation of a custom waypoint.<br>
+ * TODO: should we add buttons for cache state (enable, disable, archive)?
  */
 public class DetailsPanel extends CellPanel {
 
@@ -404,9 +405,10 @@
 	 * @return true if changes were saved, false if there were no changes to save
 	 */
 	protected boolean saveIfNeeded() {
-		// waypoint
 		// userimages ???
 		// status
+		// setfound
+		// set owned
 		
 		//FIXME: check boolean flags
 
@@ -425,6 +427,7 @@
 		if (!inpOwner.getText().equals(ch.getCacheOwner())) {
 			ch.setCacheOwner(inpOwner.getText());
 			needsSaving = true;
+			//TODO: check with alias and somehow check with status 
 		}
 		
 		if (!inpName.getText().equals(ch.getCacheName())) {
@@ -474,6 +477,38 @@
 			}
 		}
 		
+		// status - die logik dahinter verstehe ich noch nicht
+		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, "Found"))){
+			if (!ch.is_found()) {
+				ch.setFound(true);
+				needsSaving = true;
+			}
+			//FIXME: hier fehlt noch was
+		} else if (chcStatus.getText().startsWith(MyLocale.getMsg(320, "Owner"))) {
+			if (!ch.is_owned()) {
+				ch.setOwned(true);
+				needsSaving = true;
+			}
+		} else {
+			if (ch.is_found() || !ch.getCacheStatus().equals(chcStatus.getText())) {
+				ch.setCacheStatus(chcStatus.getText());
+				ch.setFound(false);
+				needsSaving = true;
+			}
+		}
+		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, "Found")) && chcStatus.getText().length() >= MyLocale.getMsg(318, "Found").length() + 11) {
+			ch.setCacheStatus(chcStatus.getText().substring(MyLocale.getMsg(318, "Found").length() + 1));
+		} else {
+			ch.setCacheStatus(chcStatus.getText());
+		}
+		
+		//always make this the last check, since it will also save the changes
+		if (!ch.getWayPoint().equals(inpWaypoint.getText().trim().toUpperCase())) {
+			ch.rename(inpWaypoint.getText().trim().toUpperCase());
+			needsSaving = false;
+			needsTableUpdate = true;
+		}
+		
 		if (needsSaving) {
 			ch.save();
 			needsTableUpdate = true;



From greiol at mail.berlios.de  Tue Jul 28 19:43:54 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 28 Jul 2009 19:43:54 +0200
Subject: [Cachewolf-svn] r2059 - experiments/greiol/src/CacheWolf
Message-ID: <200907281743.n6SHhsu4019459@sheep.berlios.de>

Author: greiol
Date: 2009-07-28 19:43:50 +0200 (Tue, 28 Jul 2009)
New Revision: 2059

Modified:
   experiments/greiol/src/CacheWolf/CacheHolder.java
   experiments/greiol/src/CacheWolf/DetailsPanel.java
   experiments/greiol/src/CacheWolf/Profile.java
Log:
circles are getting bigger. i'll have to split this up or i'll never be able to merge back again

Modified: experiments/greiol/src/CacheWolf/CacheHolder.java
===================================================================
--- experiments/greiol/src/CacheWolf/CacheHolder.java	2009-07-28 07:27:06 UTC (rev 2058)
+++ experiments/greiol/src/CacheWolf/CacheHolder.java	2009-07-28 17:43:50 UTC (rev 2059)
@@ -124,11 +124,19 @@
 		notDecSep=decSep=='.'?',':'.';
 	}
 
-	public CacheHolder() {  // Just a public constructor
+	public CacheHolder() {
+		type = CacheType.CW_TYPE_CUSTOM;
+		cacheSize = CacheSize.CW_SIZE_NOTCHOSEN;
+		hard = CacheTerrDiff.CW_DT_UNSET;
+		terrain = CacheTerrDiff.CW_DT_UNSET;
 	}
 	
 	public CacheHolder(String wp) {
-		this.wayPoint = wp;
+		wayPoint = wp;
+		type = CacheType.CW_TYPE_CUSTOM;
+		cacheSize = CacheSize.CW_SIZE_NOTCHOSEN;
+		hard = CacheTerrDiff.CW_DT_UNSET;
+		terrain = CacheTerrDiff.CW_DT_UNSET;
     }
 	
 	public CacheHolder(String xmlString, int version) {
@@ -1292,6 +1300,7 @@
     }
 	
 	public boolean checkIncomplete() {
+		// TODO: discuss if we should only check cache waypoints and silently "fix" everything else
 		boolean ret;
 		if (isCacheWpt()) {
 			if (getWayPoint().length() < 3
@@ -1305,11 +1314,11 @@
 			else
 				ret = false;
 		} else if (isAddiWpt()) {
-			if (mainCache == null
-					|| getHard() != CacheTerrDiff.CW_DT_UNSET 
+			// do not check for maincache==null sind main cache may be null during gox import
+			if (getHard() != CacheTerrDiff.CW_DT_UNSET
 					|| getCacheSize() != CacheSize.CW_SIZE_NOTCHOSEN
 					|| getTerrain() != CacheTerrDiff.CW_DT_UNSET
-					|| getWayPoint().length() < 2
+					|| getWayPoint().length() < 3
 //					|| getCacheOwner().length() > 0
 //					|| getDateHidden().length() > 0 
 					|| getCacheName().length() == 0
@@ -1321,7 +1330,7 @@
 			if (getHard() != CacheTerrDiff.CW_DT_UNSET 
 					|| getTerrain() != CacheTerrDiff.CW_DT_UNSET
 					|| getCacheSize() != CacheSize.CW_SIZE_NOTCHOSEN
-					|| getWayPoint().length() < 2
+					|| getWayPoint().length() < 3
 //					|| getCacheOwner().length() > 0
 //					|| getDateHidden().length() > 0 
 					|| getCacheName().length() == 0

Modified: experiments/greiol/src/CacheWolf/DetailsPanel.java
===================================================================
--- experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-28 07:27:06 UTC (rev 2058)
+++ experiments/greiol/src/CacheWolf/DetailsPanel.java	2009-07-28 17:43:50 UTC (rev 2059)
@@ -689,23 +689,6 @@
 				
 			} else if (ev.target == btnBlack) {
 				toggleBlackStatus();
-//				if (ch.is_black()) {
-//					//FIXME: only change thisCache in save routine
-//					ch.setBlack(false);
-//					btnBlack.image = imgBlackNo;
-//				} else {
-//					//FIXME: only change thisCache in save routine
-//					ch.setBlack(true);
-//					btnBlack.image = imgBlack;
-//				}
-//				//FIXME: during display of details only the GUI should be relevant
-//				// and we collect results at the end
-//				blackStatus = ch.is_black();
-//				
-//				btnBlack.repaintNow();
-////				dirty_details = true;
-//				blackStatusChanged = true;
-				
 			} else if (ev.target == btnNewWpt) {
 				CacheHolder newch = new CacheHolder();
 				newch.LatLon = ch.LatLon;
@@ -920,30 +903,9 @@
 						.equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
 			if (CacheType.isAddiWpt(ch.getType())) {
-				int idx;
-				if (ch.getWayPoint().length() < 5)
-					idx = -1;
-				else {
-					idx = profile.getCacheIndex("GC" + ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
-					if (idx < 0)
-						idx = profile.getCacheIndex("OC" + ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
-					if (idx < 0)
-						idx = profile.getCacheIndex("CW"+ ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
-					if (idx < 0)
-						(new MessageBox(
-								MyLocale.getMsg(144, "Warning"),
-								MyLocale.getMsg(734,"No main cache found for addi waypoint ")
-								+ " "+ ch.getWayPoint()+ "\n"
-								+ MyLocale.getMsg(735,"Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),
-								FormBase.OKB)).execute();
-				}
-				profile.buildReferences(); // TODO this takes quite long -> use
-				// profile.setAddiRef
-				// instead
+				profile.setAddiRef(ch);
 			} else {
-				profile.buildReferences(); // we have to do this to release the
-				// link between the
-				// two caches
+				profile.buildReferences();
 			}
 		}
 		// set status also on addi wpts

Modified: experiments/greiol/src/CacheWolf/Profile.java
===================================================================
--- experiments/greiol/src/CacheWolf/Profile.java	2009-07-28 07:27:06 UTC (rev 2058)
+++ experiments/greiol/src/CacheWolf/Profile.java	2009-07-28 17:43:50 UTC (rev 2059)
@@ -446,11 +446,14 @@
 			mainindex = getCacheIndex("OC" + mainwpt);
 		if (mainindex < 0)
 			mainindex = getCacheIndex("CW" + mainwpt);
-		if (mainindex < 0)
-			throw new IllegalArgumentException("no main cache found for: " + ch.getWayPoint());
-		CacheHolder mainch = cacheDB.get(mainindex);
-		mainch.addiWpts.add(ch);
-		ch.mainCache = mainch;
+		if (mainindex < 0) {
+			ch.setIncomplete(true);
+		} else {
+			CacheHolder mainch = cacheDB.get(mainindex);
+			mainch.addiWpts.add(ch);
+			ch.mainCache = mainch;
+			ch.setAttributesFromMainCache();
+		}
 	}
 
 	public String toString() {
@@ -530,7 +533,7 @@
 	 * and main cache.
 	 */
 	public void buildReferences(){
-		CacheHolder ch, mainCh;
+		CacheHolder ch;
 
 		// Build index for faster search and clear all references
 		for (int i = cacheDB.size() - 1; i >= 0; i--) {
@@ -543,20 +546,8 @@
 		int max = cacheDB.size();
 		for (int i = 0; i < max; i++) {
 			ch = cacheDB.get(i);
-			if (ch.isAddiWpt()) {
-				// search main cache
-				mainCh = cacheDB.get("GC" + ch.getWayPoint().substring(2));
-				if (mainCh == null)  // TODO save the source (GC or OC or Custom) of the maincache somewhere else to avoid ambiguity of addi-wpt-names
-					mainCh = cacheDB.get("OC" + ch.getWayPoint().substring(2));
-				if (mainCh == null)  // TODO save the source (GC or OC or Custom) of the maincache somewhere else to avoid ambiguity of addi-wpt-names
-					mainCh = cacheDB.get("CW" + ch.getWayPoint().substring(2));
-
-				if (mainCh != null) {
-					mainCh.addiWpts.add(ch);
-					ch.mainCache = mainCh;
-					ch.setAttributesFromMainCache();
-				}// if
-			}// if
+			if (ch.isAddiWpt()) 
+				setAddiRef(ch);
 		}// for
 		// sort addi wpts
 		for (int i = 0; i < max; i++) {



From greiol at mail.berlios.de  Tue Jul 28 20:54:09 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 28 Jul 2009 20:54:09 +0200
Subject: [Cachewolf-svn] r2060 - in trunk: . src/CacheWolf
Message-ID: <200907281854.n6SIs92p010093@sheep.berlios.de>

Author: greiol
Date: 2009-07-28 20:54:07 +0200 (Tue, 28 Jul 2009)
New Revision: 2060

Removed:
   trunk/cachewolf/
Modified:
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/Profile.java
Log:
delete empty directory
only build references between caches in one place

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-28 17:43:50 UTC (rev 2059)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-28 18:54:07 UTC (rev 2060)
@@ -582,7 +582,9 @@
 		// affecting the details are immediately saved
 		// Now update the table
 		CacheHolder ch = thisCache; // TODO variable ch is redundant
-
+		
+		ch.checkIncomplete();
+		
 		/*
 		 * The references have to be rebuilt if: - the cachetype changed from
 		 * addi->normal or normal->addi - the old cachetype or the new cachetype
@@ -594,35 +596,16 @@
 						.equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
 			if (CacheType.isAddiWpt(ch.getType())) {
-				int idx;
-				if (ch.getWayPoint().length() < 5)
-					idx = -1;
-				else {
-					idx = profile.getCacheIndex("GC" + ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
-					if (idx < 0)
-						idx = profile.getCacheIndex("OC" + ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
-					if (idx < 0)
-						idx = profile.getCacheIndex("CW"+ ch.getWayPoint().substring(ch.getWayPoint().length() == 5 ? 1 : 2));
-					if (idx < 0)
-						(new MessageBox(
-								MyLocale.getMsg(144, "Warning"),
-								MyLocale.getMsg(734,"No main cache found for addi waypoint ")
-										+ " "+ ch.getWayPoint()+ "\n"
-										+ MyLocale.getMsg(735,"Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),
-								FormBase.OKB)).execute();
-				}
-				profile.buildReferences(); // TODO this takes quite long -> use
-											// profile.setAddiRef
-				// instead
+				profile.setAddiRef(ch);
 			} else {
-				profile.buildReferences(); // we have to do this to release the
-											// link between the
-				// two caches
+				// rebuild links between caches
+				profile.buildReferences();
 			}
+		} else {
+			// set status also on addi wpts
+			ch.setAttributesToAddiWpts();
 		}
-		// set status also on addi wpts
-		ch.setAttributesToAddiWpts();
-		ch.checkIncomplete();
+		
 		dirty_notes = false;
 		dirty_details = false;
 		setNeedsTableUpdate(false);

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-07-28 17:43:50 UTC (rev 2059)
+++ trunk/src/CacheWolf/Profile.java	2009-07-28 18:54:07 UTC (rev 2060)
@@ -446,11 +446,14 @@
 			mainindex = getCacheIndex("OC" + mainwpt);
 		if (mainindex < 0)
 			mainindex = getCacheIndex("CW" + mainwpt);
-		if (mainindex < 0)
-			throw new IllegalArgumentException("no main cache found for: " + ch.getWayPoint());
-		CacheHolder mainch = cacheDB.get(mainindex);
-		mainch.addiWpts.add(ch);
-		ch.mainCache = mainch;
+		if (mainindex < 0) {
+			ch.setIncomplete(true);
+		} else {
+			CacheHolder mainch = cacheDB.get(mainindex);
+			mainch.addiWpts.add(ch);
+			ch.mainCache = mainch;
+			ch.setAttributesFromMainCache();
+		}
 	}
 
 	public String toString() {
@@ -530,7 +533,7 @@
 	 * and main cache.
 	 */
 	public void buildReferences(){
-		CacheHolder ch, mainCh;
+		CacheHolder ch;
 
 		// Build index for faster search and clear all references
 		for (int i = cacheDB.size() - 1; i >= 0; i--) {
@@ -543,28 +546,13 @@
 		int max = cacheDB.size();
 		for (int i = 0; i < max; i++) {
 			ch = cacheDB.get(i);
-			if (ch.isAddiWpt()) {
-				// search main cache
-				mainCh = cacheDB.get("GC" + ch.getWayPoint().substring(2));
-				if (mainCh == null)  // TODO save the source (GC or OC or Custom) of the maincache somewhere else to avoid ambiguity of addi-wpt-names
-					mainCh = cacheDB.get("OC" + ch.getWayPoint().substring(2));
-				if (mainCh == null)  // TODO save the source (GC or OC or Custom) of the maincache somewhere else to avoid ambiguity of addi-wpt-names
-					mainCh = cacheDB.get("CW" + ch.getWayPoint().substring(2));
-
-				if (mainCh != null) {
-					mainCh.addiWpts.add(ch);
-					ch.mainCache = mainCh;
-					ch.setAttributesFromMainCache();
-				}// if
-			}// if
-		}// for
+			if (ch.isAddiWpt()) 
+				setAddiRef(ch);
+		}
 		// sort addi wpts
 		for (int i = 0; i < max; i++) {
 			ch = cacheDB.get(i);
 			if (ch.hasAddiWpt() && (ch.addiWpts.size() > 1)) {
-				// ch.addiWpts.sort(new
-				// MyComparer(ch.addiWpts,MyLocale.getMsg(1002,"Waypoint"),ch.addiWpts.size()),
-				// false);
 				ch.addiWpts.sort(new ewe.util.Comparer() {
 					public int compare(Object o1, Object o2) {
 						return ((CacheHolder) o1).getWayPoint().compareTo(



From greiol at mail.berlios.de  Tue Jul 28 21:25:43 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 28 Jul 2009 21:25:43 +0200
Subject: [Cachewolf-svn] r2061 - trunk/src/CacheWolf
Message-ID: <200907281925.n6SJPh9T018224@sheep.berlios.de>

Author: greiol
Date: 2009-07-28 21:25:40 +0200 (Tue, 28 Jul 2009)
New Revision: 2061

Modified:
   trunk/src/CacheWolf/CacheHolder.java
Log:
- set more user friendly defaults (less incomplete warnings)
- check cache completeness when waypoint is saved (in case missing data was added)
- add some more comments
- remove check for main cache from addis since main cache may be not be set during initial import

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2009-07-28 18:54:07 UTC (rev 2060)
+++ trunk/src/CacheWolf/CacheHolder.java	2009-07-28 19:25:40 UTC (rev 2061)
@@ -48,11 +48,11 @@
 	/** The angle (0=North, 180=South) from the current centre to this point */
 	public double degrees = 0;
 	/** The difficulty of the cache from 1 to 5 in .5 incements */ 
-	private byte hard = CacheTerrDiff.CW_DT_ERROR;
+	private byte hard = CacheTerrDiff.CW_DT_UNSET;
 	/** The terrain rating of the cache from 1 to 5 in .5 incements */
-	private byte terrain = CacheTerrDiff.CW_DT_ERROR;
+	private byte terrain = CacheTerrDiff.CW_DT_UNSET;
 	/** The cache type (@see CacheType for translation table)  */
-	private byte type = CacheType.CW_TYPE_ERROR; 
+	private byte type = CacheType.CW_TYPE_CUSTOM; 
 	/** True if the cache has been archived */
 	private boolean archived = false;
 	/** True if the cache is available for searching */
@@ -124,11 +124,12 @@
 		notDecSep=decSep=='.'?',':'.';
 	}
 
-	public CacheHolder() {  // Just a public constructor
+	public CacheHolder() {
+		// do nothing
 	}
 	
 	public CacheHolder(String wp) {
-		this.wayPoint = wp;
+		wayPoint = wp;
     }
 	
 	public CacheHolder(String xmlString, int version) {
@@ -566,21 +567,24 @@
 		pos.set(latLon);
 	}
 
+	/** return true if waypoint is an additional waypoint of a cache */
 	public boolean isAddiWpt() {
 		return CacheType.isAddiWpt(this.getType());
 	}
 	
+	/** return true if waypoint is a custom waypoint */
 	public boolean isCustomWpt() {
 		return CacheType.isCustomWpt(getType());
 	}
 	
+	/** return true if waypoint is a cache main waypoint */
 	public boolean isCacheWpt() {
 		return CacheType.isCacheWpt(getType());
 	}
 
+	/** return true waypoint has one or more additional waypoints */
 	public boolean hasAddiWpt() {
-		if (this.addiWpts.getCount()>0) return true;
-		else return false;
+		return addiWpts.getCount()>0;
 	}
 
 
@@ -594,6 +598,7 @@
 			bearing = NOBEARING;
 		}
 	}
+
 	public void setAttributesFromMainCache(){
 		CacheHolder mainCh = this.mainCache;
 		this.setCacheOwner(mainCh.getCacheOwner());
@@ -725,6 +730,7 @@
 	 * cache should be set to do so.
 	 */
 	public void save() {
+		checkIncomplete();
 		this.getFreshDetails().saveCacheDetails(Global.getProfile().dataDir);
 	}
 	
@@ -1290,7 +1296,9 @@
     	this.incomplete = is_incomplete;
     }
 	
+	/** checks the waypoint data integrity to set a warning flag if something is missing */
 	public boolean checkIncomplete() {
+		// TODO: discuss if we should only check cache waypoints and silently "fix" everything else
 		boolean ret;
 		if (isCacheWpt()) {
 			if (getWayPoint().length() < 3
@@ -1304,11 +1312,14 @@
 			else
 				ret = false;
 		} else if (isAddiWpt()) {
-			if (mainCache == null
-					|| getHard() != CacheTerrDiff.CW_DT_UNSET 
+			//FIXME: do not check for mainCache == null, since it will be null during initial import
+			//FIXME: find out why we only check waypoints with IDs of a certain length ???
+//			if (mainCache == null
+//					|| getHard() != CacheTerrDiff.CW_DT_UNSET 
+			if (getHard() != CacheTerrDiff.CW_DT_UNSET
 					|| getCacheSize() != CacheSize.CW_SIZE_NOTCHOSEN
 					|| getTerrain() != CacheTerrDiff.CW_DT_UNSET
-					|| getWayPoint().length() < 2
+					|| getWayPoint().length() < 3
 //					|| getCacheOwner().length() > 0
 //					|| getDateHidden().length() > 0 
 					|| getCacheName().length() == 0
@@ -1320,7 +1331,7 @@
 			if (getHard() != CacheTerrDiff.CW_DT_UNSET 
 					|| getTerrain() != CacheTerrDiff.CW_DT_UNSET
 					|| getCacheSize() != CacheSize.CW_SIZE_NOTCHOSEN
-					|| getWayPoint().length() < 2
+					|| getWayPoint().length() < 3
 //					|| getCacheOwner().length() > 0
 //					|| getDateHidden().length() > 0 
 					|| getCacheName().length() == 0



From greiol at mail.berlios.de  Tue Jul 28 21:30:33 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 28 Jul 2009 21:30:33 +0200
Subject: [Cachewolf-svn] r2062 - trunk/src/CacheWolf
Message-ID: <200907281930.n6SJUXP5019381@sheep.berlios.de>

Author: greiol
Date: 2009-07-28 21:30:30 +0200 (Tue, 28 Jul 2009)
New Revision: 2062

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
Log:
set flag for unsaved changes

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-28 19:25:40 UTC (rev 2061)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2009-07-28 19:30:30 UTC (rev 2062)
@@ -523,7 +523,7 @@
 				//TODO: any chance of a roll back?
 				//TODO: should we ignore a file not found?
 			}
-			
+			hasUnsavedChanges = true;
 			return success;
 		}
 }



From greiol at mail.berlios.de  Tue Jul 28 22:01:58 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 28 Jul 2009 22:01:58 +0200
Subject: [Cachewolf-svn] r2063 - trunk/src/CacheWolf
Message-ID: <200907282001.n6SK1wnW024031@sheep.berlios.de>

Author: greiol
Date: 2009-07-28 22:01:50 +0200 (Tue, 28 Jul 2009)
New Revision: 2063

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
- prepare flags for big icons and big screen, so we do not need to calculate this in every panle 
- build interface for path to config file, since this is where we should create files if needed -- at least once we manage to separate software and configuration
- corrected some comments

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-07-28 19:30:30 UTC (rev 2062)
+++ trunk/src/CacheWolf/Preferences.java	2009-07-28 20:01:50 UTC (rev 2063)
@@ -28,6 +28,11 @@
 	public static final int ASK = 2;
 	// Hashtable is saving filter data objects the user wants to save
 	private Hashtable filterList = new Hashtable(15);
+	/** screen is big enough to hold additional information like cache notes */
+	public boolean isBigScreen;
+	/** display big icons. default only true for VGA PDAs */
+	// TODO: make this configurable via pref.xml
+	public boolean useBigIcons;
 
 	//////////////////////////////////////////////////////////////////////////////////////
     // Constructor
@@ -102,6 +107,9 @@
 			}
 		} else
 			fontSize = 11;
+		
+		useBigIcons = Vm.isMobile() && MyLocale.getScreenWidth() >= 400;
+		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
 	}
 
     //////////////////////////////////////////////////////////////////////////////////////
@@ -118,14 +126,13 @@
 	public String myAlias = "";
 	/** Optional password */
 	public String password="";
-	/** This is an alternative alias used to identify found caches (i.e. if using multiple IDs)
-	 *  It is currently not used yet */
+	/** This is an alternative alias used to identify found caches (i.e. if using multiple IDs) */
 	public String myAlias2 = "";
 	/** The path to the browser */
 	public String browser = "";
-	/** Name of proxy for spidering */
+	/** Name of HTTP proxy for spidering */
 	public String myproxy = "";
-	/** Proxyport when spidering */
+	/** HTTP proxy port when spidering */
 	public String myproxyport = "";
 	/** Flag whether proxy is to be used */
 	public boolean proxyActive=false;
@@ -610,6 +617,7 @@
 		saveCustomMapsPath(getMapLoadPathInternal());
 		return getCustomMapsPath();
 	}
+
 	private String getMapLoadPathInternal() {
 		// here could also a list of map-types displayed...
 		// standard dir
@@ -756,6 +764,7 @@
     // Log functions
 	//////////////////////////////////////////////////////////////////////////////////////
 
+	// FIXME: should use path to config file instead of program directory
 	/** Log file is in program directory and called log.txt */
 	private final String LOGFILENAME=FileBase.getProgramDirectory()+"/log.txt";
 
@@ -953,4 +962,11 @@
 			}
 		}
 	}
+	
+	/** get directory where pref.xml is stored<br>
+	 *  use this if you need a path where the user has sufficient rights to create a file */
+	public String getPathToConfigFile() {
+		return pathToConfigFile;
+	}
+
 }



From greiol at mail.berlios.de  Tue Jul 28 22:46:59 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Tue, 28 Jul 2009 22:46:59 +0200
Subject: [Cachewolf-svn] r2064 - trunk/src/CacheWolf
Message-ID: <200907282046.n6SKkxDF032213@sheep.berlios.de>

Author: greiol
Date: 2009-07-28 22:46:49 +0200 (Tue, 28 Jul 2009)
New Revision: 2064

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/NotesScreen.java
   trunk/src/CacheWolf/StatusBar.java
Log:
- get preferred icon size from preferences
- we need less ugly icons ;)

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-28 20:01:50 UTC (rev 2063)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-28 20:46:49 UTC (rev 2064)
@@ -62,10 +62,8 @@
 		// //////////////////
 		// Tools
 		// //////////////////
-		// Use larger Button-Icons on VGA-mobiles
-		int sw = MyLocale.getScreenWidth();
 		String imagesize = "";
-		if (Vm.isMobile() && sw >= 400)
+		if (pref.useBigIcons)
 			imagesize = "_vga";
 		// Button 1: New Waypoint
 		pnlTools.addNext(btnNewWpt = new mButton(imgNewWpt = new mImage(

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2009-07-28 20:01:50 UTC (rev 2063)
+++ trunk/src/CacheWolf/MainTab.java	2009-07-28 20:46:49 UTC (rev 2064)
@@ -52,7 +52,7 @@
 		int sw = MyLocale.getScreenWidth();
 		if ( sw <= 240) this.dontExpandTabs=true;
 		String imagesize="";
-		if (Vm.isMobile() && sw >= 400) imagesize="_vga";  
+		if (pref.useBigIcons) imagesize="_vga";  
 		calcP = new CalcPanel(); // Init here so that Global.MainT is already set
 		tbP = new TablePanel(pref, profile, statBar);
 		Card c = this.addCard(new TableForm(tbP), MyLocale.getMsg(1200,"List"), null);

Modified: trunk/src/CacheWolf/NotesScreen.java
===================================================================
--- trunk/src/CacheWolf/NotesScreen.java	2009-07-28 20:01:50 UTC (rev 2063)
+++ trunk/src/CacheWolf/NotesScreen.java	2009-07-28 20:46:49 UTC (rev 2064)
@@ -16,9 +16,8 @@
 	ScrollBarPanel sbp = new MyScrollBarPanel(wayNotes);
 	
 	public NotesScreen(CacheHolderDetail ch){
-		int sw = MyLocale.getScreenWidth();
 		String imagesize = "";
-		if (Vm.isMobile() && sw >= 400) imagesize="_vga";
+		if (Global.getPref().useBigIcons) imagesize="_vga";
 		addDateTime = new mButton(new mImage("date_time"+imagesize+".gif"));
 		
 		this.title = "Notes";

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2009-07-28 20:01:50 UTC (rev 2063)
+++ trunk/src/CacheWolf/StatusBar.java	2009-07-28 20:46:49 UTC (rev 2064)
@@ -21,8 +21,7 @@
 	
 	public StatusBar(Preferences p, CacheDB db){
 		pref=p;
-		int sw = MyLocale.getScreenWidth();
-		MobileVGA = (Vm.isMobile() && sw >= 400);
+		MobileVGA = pref.useBigIcons;
 		String imagesize="";
 		if(MobileVGA) imagesize="_vga";  
 		addNext(btnCacheTour=new mButton(imgCacheTour=new mImage("cachetour"+imagesize+".png")),CellConstants.DONTSTRETCH, CellConstants.DONTFILL);



From greiol at mail.berlios.de  Wed Jul 29 18:52:26 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Wed, 29 Jul 2009 18:52:26 +0200
Subject: [Cachewolf-svn] r2065 - trunk/src/CacheWolf
Message-ID: <200907291652.n6TGqQWe002086@sheep.berlios.de>

Author: greiol
Date: 2009-07-29 18:52:24 +0200 (Wed, 29 Jul 2009)
New Revision: 2065

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
make D and T edible. hopefully this should help to fix some (most) of the warning signs by calling the details page

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-28 20:46:49 UTC (rev 2064)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-29 16:52:24 UTC (rev 2065)
@@ -244,11 +244,19 @@
 			deactivateControl(btnTerr);
 			deactivateControl(btnDiff);
 			deactivateControl(chcSize);
+			deactivateControl(inpOwner);
+			deactivateControl(inpHidden);
+			deactivateControl(btnShowBug);
+			deactivateControl(btnBlack);
 			chcSize.select(0);
 		} else {
 			activateControl(btnTerr);
 			activateControl(btnDiff);
 			activateControl(chcSize);
+			activateControl(inpOwner);
+			activateControl(inpHidden);
+			activateControl(btnShowBug);
+			activateControl(btnBlack);
 			if (CacheTerrDiff.isValidTD(ch.getTerrain())) {
 				btnTerr.setText(MyLocale.getMsg(1001, "T") + ": " + CacheTerrDiff.longDT(ch.getTerrain()));
 			} else {
@@ -317,10 +325,18 @@
 					activateControl(btnTerr);
 					activateControl(btnDiff);
 					activateControl(chcSize);
+					activateControl(inpOwner);
+					activateControl(inpHidden);
+					activateControl(btnShowBug);
+					activateControl(btnBlack);
 				} else {
 					deactivateControl(btnTerr);
 					deactivateControl(btnDiff);
 					deactivateControl(chcSize);
+					deactivateControl(inpOwner);
+					deactivateControl(inpHidden);
+					deactivateControl(btnShowBug);
+					deactivateControl(btnBlack);
 					chcSize.select(0);
 					btnTerr.setText(MyLocale.getMsg(1001, "T")+": -.-");
 					btnDiff.setText(MyLocale.getMsg(1000, "D")+": -.-");
@@ -478,25 +494,31 @@
 				}
 			} else if (ev.target == this.btnTerr) {
 				int returnValue;
-				TerrDiffForm tdf = new TerrDiffForm(true, thisCache
-						.getTerrain());
+				TerrDiffForm tdf = new TerrDiffForm(true, 
+						decodeTerrDiff(btnTerr, 
+								MyLocale.getMsg(1001, "T"), 
+								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
+							)
+						);
 				returnValue = tdf.execute();
-				if (returnValue == 1 && tdf.getDT() != thisCache.getTerrain()) {
-					//FIXME: do this when waypoint is checked for saving
-					thisCache.setTerrain(tdf.getDT());
-					btnTerr.setText(MyLocale.getMsg(1001, "T") + ": "
-							+ CacheTerrDiff.longDT(thisCache.getTerrain()));
+				Vm.debug(returnValue+"");
+				if (returnValue == 1) {
+					btnTerr.setText(MyLocale.getMsg(1001, "T") + ": " + CacheTerrDiff.longDT(tdf.getDT()));
 					dirty_details = true;
 				}
 			} else if (ev.target == this.btnDiff) {
 				int returnValue;
-				TerrDiffForm tdf = new TerrDiffForm(false, thisCache.getHard());
+				TerrDiffForm tdf = new TerrDiffForm(false, 
+						decodeTerrDiff(btnDiff, 
+								MyLocale.getMsg(1001, "D"), 
+								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
+							)
+						);
+						
 				returnValue = tdf.execute();
-				if (returnValue == 1 && tdf.getDT() != thisCache.getHard()) {
-					//FIXME: do this when waypoint is checked for saving
-					thisCache.setHard(tdf.getDT());
+				if (returnValue == 1) {
 					btnDiff.setText(MyLocale.getMsg(1000, "D") + ": "
-							+ CacheTerrDiff.longDT(thisCache.getHard()));
+							+ CacheTerrDiff.longDT(tdf.getDT()));
 					dirty_details = true;
 				}
 			}
@@ -603,13 +625,41 @@
 			// set status also on addi wpts
 			ch.setAttributesToAddiWpts();
 		}
-		
+		thisCache.setHard(decodeTerrDiff(this.btnDiff,MyLocale.getMsg(1000, "D"),thisCache.isCacheWpt()));
+		thisCache.setTerrain(decodeTerrDiff(this.btnTerr,MyLocale.getMsg(1001, "T"),thisCache.isCacheWpt()));
 		dirty_notes = false;
 		dirty_details = false;
 		setNeedsTableUpdate(false);
 		thisCache.getFreshDetails().hasUnsavedChanges = true;
 	}
+	
+	/**
+	 * convert the string displayed in the terrain in difficulty buttons to a byte for intrernal use<br>
+	 * assumes that the relevant information will at positions 3 and 5 in a 0 indexed string
+	 * @param button button control to get the text from 
+	 * @param td localized string for abbreviation of terrain or difficulty
+	 * @param isCache true if waypoint is a cache, false for addis and custom
+	 * @return 0 for additional or custum waypoints, -1 for caches if td is not valid, parsed byte otherwise
+	 */
+	private byte decodeTerrDiff(mButton button, String td, boolean isCache) {
+		StringBuffer tdv = new StringBuffer(2);
+		
+		// terrain and difficulty are always unset for non cache waypoints
+		if (! isCache) return CacheTerrDiff.CW_DT_UNSET;
+		
+		// cut off beginning of string
+		String buttonText = button.getText().substring(td.length()+2);
+		// we now should have a string of length 3
+		if (buttonText.length() != 3) return -1;
 
+		buttonText=tdv.append(buttonText.charAt(0)).append(buttonText.charAt(2)).toString();
+
+		// unset value is invalid
+		if (buttonText.equals("--")) return CacheTerrDiff.CW_DT_ERROR;
+		
+		return Byte.parseByte(buttonText);
+	}
+
 	private class TravelbugInCacheScreen extends Form {
 
 		private DispPanel disp = new DispPanel();



From greiol at mail.berlios.de  Thu Jul 30 19:37:53 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Thu, 30 Jul 2009 19:37:53 +0200
Subject: [Cachewolf-svn] r2066 - trunk/src/CacheWolf
Message-ID: <200907301737.n6UHbrUL021598@sheep.berlios.de>

Author: greiol
Date: 2009-07-30 19:37:45 +0200 (Thu, 30 Jul 2009)
New Revision: 2066

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
set icon and screen size after pref.xml file has been parsed to avoid clashes in MyLocal

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-07-29 16:52:24 UTC (rev 2065)
+++ trunk/src/CacheWolf/Preferences.java	2009-07-30 17:37:45 UTC (rev 2066)
@@ -108,8 +108,7 @@
 		} else
 			fontSize = 11;
 		
-		useBigIcons = Vm.isMobile() && MyLocale.getScreenWidth() >= 400;
-		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
+
 	}
 
     //////////////////////////////////////////////////////////////////////////////////////
@@ -287,6 +286,8 @@
 			else
 				log("Error reading pref.xml: ", e);
 		}
+		useBigIcons = Vm.isMobile() && MyLocale.getScreenWidth() >= 400;
+		isBigScreen = (MyLocale.getScreenWidth() >= 400) && (MyLocale.getScreenHeight() >= 600);
 	}
 
 	/** Helper variables for XML parser */



From greiol at mail.berlios.de  Fri Jul 31 23:12:48 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 31 Jul 2009 23:12:48 +0200
Subject: [Cachewolf-svn] r2067 - trunk/src/CacheWolf
Message-ID: <200907312112.n6VLCm34008584@sheep.berlios.de>

Author: greiol
Date: 2009-07-31 23:12:47 +0200 (Fri, 31 Jul 2009)
New Revision: 2067

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
removed some obsolete comments
added some FIXMEs
removed parallel usage of thisCache and ch for the same object in the same subroutine

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-07-30 17:37:45 UTC (rev 2066)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-07-31 21:12:47 UTC (rev 2067)
@@ -192,12 +192,6 @@
 		return blackStatusChanged;
 	}
 
-	/**
-	 * @param chD
-	 *            details of the cache to display
-	 * @param dbindex
-	 *            index in cacheDB, in which changes will be saved
-	 */
 	public void setDetails(CacheHolder ch) {
 		thisCache = ch;
 		dirty_notes = false;
@@ -548,6 +542,8 @@
 		// contains
 		// the full cache which will be written to the cache.xml file AND
 		// the CacheHolder object which sits in cacheDB
+		//FIXME: so how do we do this??
+		
 		// Strip the found message if the status contains a date
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, "Found"))
 				&& chcStatus.getText().length() >= MyLocale
@@ -601,29 +597,28 @@
 		// because all changes
 		// affecting the details are immediately saved
 		// Now update the table
-		CacheHolder ch = thisCache; // TODO variable ch is redundant
 		
-		ch.checkIncomplete();
+		thisCache.checkIncomplete();
 		
 		/*
 		 * The references have to be rebuilt if: - the cachetype changed from
 		 * addi->normal or normal->addi - the old cachetype or the new cachetype
 		 * were 'addi' and the waypointname has changed
 		 */
-		if (CacheType.isAddiWpt(ch.getType()) != CacheType.isAddiWpt(oldType)
-				|| ((CacheType.isAddiWpt(ch.getType()) || CacheType
+		if (CacheType.isAddiWpt(thisCache.getType()) != CacheType.isAddiWpt(oldType)
+				|| ((CacheType.isAddiWpt(thisCache.getType()) || CacheType
 						.isAddiWpt(oldType)) && !thisCache.getWayPoint()
 						.equals(oldWaypoint))) {
 			// If we changed the type to addi, check that a parent exists
-			if (CacheType.isAddiWpt(ch.getType())) {
-				profile.setAddiRef(ch);
+			if (CacheType.isAddiWpt(thisCache.getType())) {
+				profile.setAddiRef(thisCache);
 			} else {
 				// rebuild links between caches
 				profile.buildReferences();
 			}
 		} else {
 			// set status also on addi wpts
-			ch.setAttributesToAddiWpts();
+			thisCache.setAttributesToAddiWpts();
 		}
 		thisCache.setHard(decodeTerrDiff(this.btnDiff,MyLocale.getMsg(1000, "D"),thisCache.isCacheWpt()));
 		thisCache.setTerrain(decodeTerrDiff(this.btnTerr,MyLocale.getMsg(1001, "T"),thisCache.isCacheWpt()));



From greiol at mail.berlios.de  Fri Jul 31 23:46:11 2009
From: greiol at mail.berlios.de (greiol at mail.berlios.de)
Date: Fri, 31 Jul 2009 23:46:11 +0200
Subject: [Cachewolf-svn] r2068 - trunk
Message-ID: <200907312146.n6VLkB1O013246@sheep.berlios.de>

Author: greiol
Date: 2009-07-31 23:46:09 +0200 (Fri, 31 Jul 2009)
New Revision: 2068

Modified:
   trunk/build.xml
Log:
added ftp upload target. please check your ant version, since this is an optional ant task

Modified: trunk/build.xml
===================================================================
--- trunk/build.xml	2009-07-31 21:12:47 UTC (rev 2067)
+++ trunk/build.xml	2009-07-31 21:46:09 UTC (rev 2068)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no"?>
 <project name="CacheWolf" default="release">
-	
+
 	<!--
 		This is the ant (http://ant.apache.org/) build file for CacheWolf
 		
@@ -30,206 +30,205 @@
 		<condition>
 			<not>
 				<or>
-					<os family="windows"/>
-					<os name="Linux"/>
+					<os family="windows" />
+					<os name="Linux" />
 				</or>
 			</not>
 		</condition>
 	</fail>
-	
+
 	<!-- seems the ewe compiler uses different paths on windows and linux :-( -->
-	<condition property="ewe.progdir" value="CacheWolf" else="programs/CacheWolf" >
-		<os family="windows"/>
+	<condition property="ewe.progdir" value="CacheWolf" else="programs/CacheWolf">
+		<os family="windows" />
 	</condition>
 
 	<!-- TODO: find out how to get svn revision information platform independent. -->
 	<!-- TODO: especially since svnversion would give better information if current directory is up to date -->
 	<!-- set a default build.version as long as not defined otherwiese on command line -->
-	<tstamp><format property="build.version" pattern="yyyyMMdd"/></tstamp>
+	<tstamp>
+		<format property="build.version" pattern="yyyyMMdd" />
+	</tstamp>
 	<!-- set build type to experimental as long as not defined otherwiese on command line -->
-	<property name="build.type" value="3"/>
+	<property name="build.type" value="3" />
 
 	<!-- define output directorties -->
-	<property name="pkg.dir" value="published"/>
-	<property name="classes.dir" value="bin"/>
-	<property name="assemble.dir" value="assemble"/>
+	<property name="pkg.dir" value="published" />
+	<property name="classes.dir" value="bin" />
+	<property name="assemble.dir" value="assemble" />
 
 	<!-- lists of files to be packaged, this should become less confusing later on -->
-	<property name="template.files" value="templates/*.tpl"/>
-	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png"/>
-	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif,icon_greenlight.gif,icon_redlight.gif,icon_remove.gif"/>
-	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4.gif,3.gif,2.gif,13.gif,12.gif,100.gif,101.gif,102.gif,103.gif,104.gif"/>
-	<property name="icons.browser.files" value="g.png,g2.png,y.png,y2.png"/>
-	<property name="doc.files" value="wolflang.html,GCTemplate.html,info.html,legende.html"/>
+	<property name="template.files" value="templates/*.tpl" />
+	<property name="icons.gui.files" value="dnf.gif,bug.gif,red.png,yellow.png,blue.png" />
+	<property name="icons.log.files" value="traffic_cone.gif,recommendedlog.gif,icon_smile.gif,icon_sad.gif,icon_rsvp.gif,icon_note.gif,icon_needsmaint.gif,icon_maint.gif,icon_enabled.gif,icon_disabled.gif,icon_camera.gif,icon_attended.gif,big_smile.gif,coord_update.gif,icon_greenlight.gif,icon_redlight.gif,icon_remove.gif" />
+	<property name="icons.cache.files" value="11.gif,8.gif,6.gif,5.gif,4.gif,3.gif,2.gif,13.gif,12.gif,100.gif,101.gif,102.gif,103.gif,104.gif" />
+	<property name="icons.browser.files" value="g.png,g2.png,y.png,y2.png" />
+	<property name="doc.files" value="wolflang.html,GCTemplate.html,info.html,legende.html" />
 
+	<!-- please note that the ftp task is optional for ant implementations, so plaese make sure your ant version supports this before you use it -->
+	<target name="upload" description="upload release to ftp server" depends="release">
+		<fail message="please set property ftp.user" unless="ftp.user" />
+		<fail message="please set property ftp.server" unless="ftp.server" />
+		<fail message="please set property ftp.password" unless="ftp.password" />
+		<fail message="please set property ftp.remotedir" unless="ftp.remotedir" />
+		<ftp server="${ftp.server}" userid="${ftp.user}" password="${ftp.password}" remotedir="${ftp.remotedir}" verbose="yes" binary="yes" passive="yes">
+			<fileset dir="${pkg.dir}" />
+		</ftp>
+	</target>
+
 	<target name="fixreleasenumber" description="fix the release number in " depends="clean">
 		<echo message="setting build version: ${build.version}" />
-		<replaceregexp file="src/CacheWolf/Version.java" 
-			match="static final int SVN_REVISION = (.*);" 
-			replace="static final int SVN_REVISION = ${build.version};"/>
+		<replaceregexp file="src/CacheWolf/Version.java" match="static final int SVN_REVISION = (.*);" replace="static final int SVN_REVISION = ${build.version};" />
 		<echo message="setting build type: ${build.type}" />
-		<replaceregexp file="src/CacheWolf/Version.java" 
-			match="static final int VERSION_TYPE = (.*);" 
-			replace="static final int VERSION_TYPE = ${build.type};"/>
+		<replaceregexp file="src/CacheWolf/Version.java" match="static final int VERSION_TYPE = (.*);" replace="static final int VERSION_TYPE = ${build.type};" />
 
 	</target>
 
 	<!-- <target name="release" depends="CW-ARM,CW-MIPS,CW-SH3,CW-PPC2003,CW-EWE,CW-Win32,CW-Java" description="package all platforms"> -->
 	<target name="release" depends="CW-PPC2003,CW-PPC2003-CAB,CW-EWE,CW-Win32,CW-Java" description="package all platforms">
-		<echo message="packages for all platforms are now in ${pkg.dir}"/>
+		<echo message="packages for all platforms are now in ${pkg.dir}" />
 	</target>
 
 	<target name="CW-PPC2003-CAB" depends="CW-PPC2003,compilecabhelper" description="package PPC2003 build as CAB" if="build.cab">
-		<delete dir="${assemble.dir}"/>
-		<mkdir dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
+		<mkdir dir="${assemble.dir}" />
 		<java classname="build.CabHelper" classpath="bin" failonerror="true">
-			<arg value="${pkg.dir}/CacheWolf-PPC2003.zip"/>
-			<arg value="${assemble.dir}"/>
+			<arg value="${pkg.dir}/CacheWolf-PPC2003.zip" />
+			<arg value="${assemble.dir}" />
 		</java>
-		<cab cabfile="${pkg.dir}/CacheWolf-PPC2003.cab" basedir="${assemble.dir}"/>
-		<delete dir="${assemble.dir}"/>
+		<cab cabfile="${pkg.dir}/CacheWolf-PPC2003.cab" basedir="${assemble.dir}" />
+		<delete dir="${assemble.dir}" />
 	</target>
-	
+
 	<target name="CW-ARM" depends="ewebuild" description="package ARM release of CacheWolf">
-		<mkdir dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}" />
 
-		<mkdir dir="${pkg.dir}"/>
+		<mkdir dir="${pkg.dir}" />
 
-		<antcall target="copyres"/>
+		<antcall target="copyres" />
 
-		<copy file="${ewe.progdir]/PocketPC-ARM/CacheWolf.exe" todir="${assemble.dir}"/>
-		<zip destfile="${pkg.dir}/CacheWolf-ARM.zip" basedir="${assemble.dir}"/>
+		<copy file="${ewe.progdir]/PocketPC-ARM/CacheWolf.exe" todir="${assemble.dir}" />
+		<zip destfile="${pkg.dir}/CacheWolf-ARM.zip" basedir="${assemble.dir}" />
 
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
 	</target>
-	
+
 	<target name="CW-MIPS" depends="ewebuild" description="package MIPS release of CacheWolf">
-		<mkdir dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}" />
 
-		<mkdir dir="${pkg.dir}"/>
+		<mkdir dir="${pkg.dir}" />
 
-		<antcall target="copyres"/>
+		<antcall target="copyres" />
 
-		<copy file="${ewe.progdir}/PocketPC-MIPS/CacheWolf.exe" todir="${assemble.dir}"/>
-		<zip destfile="${pkg.dir}/CacheWolf-MIPS.zip" basedir="${assemble.dir}"/>
+		<copy file="${ewe.progdir}/PocketPC-MIPS/CacheWolf.exe" todir="${assemble.dir}" />
+		<zip destfile="${pkg.dir}/CacheWolf-MIPS.zip" basedir="${assemble.dir}" />
 
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
 	</target>
 
 	<target name="CW-SH3" depends="ewebuild" description="package SH3 release of CacheWolf">
-		<mkdir dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}" />
 
-		<mkdir dir="${pkg.dir}"/>
+		<mkdir dir="${pkg.dir}" />
 
-		<copy file="${ewe.progdir}/PocketPC-SH3/CacheWolf.exe" todir="${assemble.dir}"/>
-		<antcall target="copyres"/>
+		<copy file="${ewe.progdir}/PocketPC-SH3/CacheWolf.exe" todir="${assemble.dir}" />
+		<antcall target="copyres" />
 
-		<zip destfile="${pkg.dir}/CacheWolf-SH3.zip" basedir="${assemble.dir}"/>
+		<zip destfile="${pkg.dir}/CacheWolf-SH3.zip" basedir="${assemble.dir}" />
 
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
 	</target>
 
 	<target name="CW-PPC2003" depends="ewebuild" description="package PocketPC 2003 release of CacheWolf">
-		<mkdir dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}" />
 
-		<mkdir dir="${pkg.dir}"/>
+		<mkdir dir="${pkg.dir}" />
 
-		<copy file="${ewe.progdir}/PocketPC2003/CacheWolf.exe" todir="${assemble.dir}"/>
+		<copy file="${ewe.progdir}/PocketPC2003/CacheWolf.exe" todir="${assemble.dir}" />
 		<!-- copy big attributes -->
 		<copy todir="${assemble.dir}/attributes-big">
-			<fileset dir="resources/attributes-big"/>
+			<fileset dir="resources/attributes-big" />
 		</copy>
-		<antcall target="copyres"/>
-		<antcall target="copyppcdll"/>
+		<antcall target="copyres" />
+		<antcall target="copyppcdll" />
 
-		<zip destfile="${pkg.dir}/CacheWolf-PPC2003.zip" basedir="${assemble.dir}"/>
+		<zip destfile="${pkg.dir}/CacheWolf-PPC2003.zip" basedir="${assemble.dir}" />
 
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
 	</target>
-	
+
 	<target name="CW-EWE" depends="ewebuild" description="package Ewe release of CacheWolf">
-		<mkdir dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}" />
 
-		<mkdir dir="${pkg.dir}"/>
+		<mkdir dir="${pkg.dir}" />
 
-		<copy file="work/CacheWolf.ewe" todir="${assemble.dir}"/>
-		<antcall target="copyres"/>
+		<copy file="work/CacheWolf.ewe" todir="${assemble.dir}" />
+		<antcall target="copyres" />
 
-		<zip destfile="${pkg.dir}/CacheWolf-EWE.zip" basedir="${assemble.dir}"/>
+		<zip destfile="${pkg.dir}/CacheWolf-EWE.zip" basedir="${assemble.dir}" />
 
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
 	</target>
-	
+
 	<target name="CW-Win32" depends="ewebuild" description="package Win32 release of CacheWolf">
-		<mkdir dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}" />
 
-		<mkdir dir="${pkg.dir}"/>
+		<mkdir dir="${pkg.dir}" />
 
-		<copy file="${ewe.progdir}/x86-Win32-StaticLinked/CacheWolf.exe" todir="${assemble.dir}"/>
-		<antcall target="copyres"/>
+		<copy file="${ewe.progdir}/x86-Win32-StaticLinked/CacheWolf.exe" todir="${assemble.dir}" />
+		<antcall target="copyres" />
 
-		<zip destfile="${pkg.dir}/CacheWolf-Win32.zip" basedir="${assemble.dir}"/>
+		<zip destfile="${pkg.dir}/CacheWolf-Win32.zip" basedir="${assemble.dir}" />
 
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
 	</target>
-	
+
 	<target name="CW-Java" depends="ewebuild" description="package Java release of CacheWolf">
-		<mkdir dir="${assemble.dir}"/>
+		<mkdir dir="${assemble.dir}" />
 
-		<copy file="${ewe.progdir}/Jar/CacheWolf.jar" todir="${assemble.dir}"/>
-		<copy file="lib/java_ewe.dll" todir="${assemble.dir}"/>
-		<copy file="docs/cachewolf.svg" todir="${assemble.dir}"/>
-		<antcall target="copyres"/>
+		<copy file="${ewe.progdir}/Jar/CacheWolf.jar" todir="${assemble.dir}" />
+		<copy file="lib/java_ewe.dll" todir="${assemble.dir}" />
+		<copy file="docs/cachewolf.svg" todir="${assemble.dir}" />
+		<antcall target="copyres" />
 
-		<mkdir dir="${pkg.dir}"/>
-		<zip destfile="${pkg.dir}/CacheWolf-Java.zip" basedir="${assemble.dir}"/>
+		<mkdir dir="${pkg.dir}" />
+		<zip destfile="${pkg.dir}/CacheWolf-Java.zip" basedir="${assemble.dir}" />
 
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${assemble.dir}" />
 	</target>
-	
+
 	<target name="ewebuild" depends="compile" description="build platform files">
-		<echo message="Operating System ${os.name} Version ${os.version} Arch ${os.arch}"/>
+		<echo message="Operating System ${os.name} Version ${os.version} Arch ${os.arch}" />
 		<exec executable="programs/ewecl" os="Linux">
-			<arg value="programs/Jewel.ewe"/>
-			<arg value="-c cw-pda.jnf"/>
+			<arg value="programs/Jewel.ewe" />
+			<arg value="-c cw-pda.jnf" />
 		</exec>
 		<exec executable="programs/ewecl" os="Linux">
-			<arg value="programs/Jewel.ewe"/>
-			<arg value="-c"/>
-			<arg value="cw-pc.jnf"/>
+			<arg value="programs/Jewel.ewe" />
+			<arg value="-c" />
+			<arg value="cw-pc.jnf" />
 		</exec>
 		<exec executable="programs/ewe.exe" osfamily="windows">
-			<arg value="programs/Jewel.ewe"/>
-			<arg value="-c"/>
-			<arg value="cw-pda.jnf"/>
+			<arg value="programs/Jewel.ewe" />
+			<arg value="-c" />
+			<arg value="cw-pda.jnf" />
 		</exec>
 		<exec executable="programs/ewe.exe" osfamily="windows">
-			<arg value="programs/Jewel.ewe"/>
+			<arg value="programs/Jewel.ewe" />
 			<arg value="-c" />
-			<arg value="cw-pc.jnf"/>
+			<arg value="cw-pc.jnf" />
 		</exec>
 	</target>
-	
+
 	<target name="clean" description="clean up before build">
-		<delete dir="${pkg.dir}"/>
-		<delete dir="${classes.dir}"/>
-		<delete dir="programs/CacheWolf"/>
-		<delete dir="${assemble.dir}"/>
+		<delete dir="${pkg.dir}" />
+		<delete dir="${classes.dir}" />
+		<delete dir="programs/CacheWolf" />
+		<delete dir="${assemble.dir}" />
 	</target>
 
 	<target name="compile" depends="fixreleasenumber" description="compile sources with java">
-		<mkdir dir="${classes.dir}"/>
-		<javac
-			source="1.3" 
-			target="1.1" 
-			encoding="windows-1252"
-			classpath="./lib/CompileEwe.zip:./lib/"
-			destdir="${classes.dir}"
-			deprecation="off"
-			nowarn="on"
-			srcdir="src"
-			includes="CacheWolf/*.java,CacheWolf/*/*.java,exp/*.java,utils/*.java"
-		/>
+		<mkdir dir="${classes.dir}" />
+		<javac source="1.3" target="1.1" encoding="windows-1252" classpath="./lib/CompileEwe.zip:./lib/" destdir="${classes.dir}" deprecation="off" nowarn="on" srcdir="src" includes="CacheWolf/*.java,CacheWolf/*/*.java,exp/*.java,utils/*.java" />
 
 	</target>
 
@@ -241,60 +240,53 @@
 		<!-- copy templates -->
 		<copy todir="${assemble.dir}" failonerror="true" verbose="true">
 			<fileset dir="res_noewe">
-				<include name="${template.files}"/>
+				<include name="${template.files}" />
 			</fileset>
 		</copy>
 		<!-- copy gui icons -->
 		<copy todir="${assemble.dir}" failonerror="true" verbose="true">
-			<fileset dir="res_noewe" includes="${icons.gui.files}"/>
+			<fileset dir="res_noewe" includes="${icons.gui.files}" />
 		</copy>
 		<!-- copy browser icons -->
 		<copy todir="${assemble.dir}" failonerror="true" verbose="true">
-			<fileset dir="res_noewe" includes="${icons.browser.files}"/>
+			<fileset dir="res_noewe" includes="${icons.browser.files}" />
 		</copy>
 		<!-- copy cache icons -->
 		<copy todir="${assemble.dir}" failonerror="true" verbose="true">
-			<fileset dir="res_noewe" includes="${icons.cache.files}"/>
+			<fileset dir="res_noewe" includes="${icons.cache.files}" />
 		</copy>
 		<!-- copy log icons -->
 		<copy todir="${assemble.dir}" failonerror="true" verbose="true">
-			<fileset dir="res_noewe" includes="${icons.log.files}"/>
+			<fileset dir="res_noewe" includes="${icons.log.files}" />
 		</copy>
 		<!-- copy webmapservices -->
 		<copy todir="${assemble.dir}/webmapservices" failonerror="true" verbose="true">
-			<fileset dir="res_noewe/webmapservices"/>
+			<fileset dir="res_noewe/webmapservices" />
 		</copy>
 		<!-- copy languages -->
 		<copy todir="${assemble.dir}/languages" failonerror="true" verbose="true">
-			<fileset dir="res_noewe/languages"/>
+			<fileset dir="res_noewe/languages" />
 		</copy>
 		<!-- copy attributes -->
 		<copy todir="${assemble.dir}/attributes" failonerror="true" verbose="true">
-			<fileset dir="resources/attributes"/>
+			<fileset dir="resources/attributes" />
 		</copy>
 		<!-- copy exporticons -->
 		<copy todir="${assemble.dir}/exporticons" failonerror="true" verbose="true">
-			<fileset dir="res_noewe/exporticons"/>
+			<fileset dir="res_noewe/exporticons" />
 		</copy>
 		<!-- copy logo -->
-		<copy todir="${assemble.dir}" file="resources/CacheWolf.ico" failonerror="true" verbose="true"/>
+		<copy todir="${assemble.dir}" file="resources/CacheWolf.ico" failonerror="true" verbose="true" />
 		<!-- copy documentation -->
 		<copy todir="${assemble.dir}" failonerror="true" verbose="true">
-			<fileset dir="res_noewe" includes="${doc.files}"/>
+			<fileset dir="res_noewe" includes="${doc.files}" />
 		</copy>
 		<!-- spider.def -->
-		<copy todir="${assemble.dir}" file="res_noewe/spider.def" failonerror="true" verbose="true"/>
+		<copy todir="${assemble.dir}" file="res_noewe/spider.def" failonerror="true" verbose="true" />
 	</target>
 
 	<target name="compilecabhelper" description="helper classes for building cabs" if="build.cab">
-		<mkdir dir="${classes.dir}"/>
-		<javac
-			source="1.5" 
-			target="1.5" 
-			encoding="windows-1252"
-			destdir="${classes.dir}"
-			srcdir="src"
-			includes="build/*.java"
-		/>
+		<mkdir dir="${classes.dir}" />
+		<javac source="1.5" target="1.5" encoding="windows-1252" destdir="${classes.dir}" srcdir="src" includes="build/*.java" />
 	</target>
 </project>



