From salzkammergut at mail.berlios.de  Fri Feb  1 00:31:14 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Fri, 1 Feb 2008 00:31:14 +0100
Subject: [Cachewolf-svn] r1210 - in trunk: res_noewe/languages
	resources/attributes src/CacheWolf
Message-ID: <200801312331.m0VNVErG024379@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-01 00:29:22 +0100 (Fri, 01 Feb 2008)
New Revision: 1210

Added:
   trunk/resources/attributes/available-non.gif
   trunk/resources/attributes/bicycles-non.gif
   trunk/resources/attributes/boat-non.gif
   trunk/resources/attributes/cactus-non.gif
   trunk/resources/attributes/campfires-non.gif
   trunk/resources/attributes/camping-non.gif
   trunk/resources/attributes/cliff-non.gif
   trunk/resources/attributes/climbing-non.gif
   trunk/resources/attributes/compass-non.gif
   trunk/resources/attributes/cow-non.gif
   trunk/resources/attributes/danger-non.gif
   trunk/resources/attributes/dogs-non.gif
   trunk/resources/attributes/fee-non.gif
   trunk/resources/attributes/firstaid-non.gif
   trunk/resources/attributes/hiking-non.gif
   trunk/resources/attributes/horses-non.gif
   trunk/resources/attributes/hunting-non.gif
   trunk/resources/attributes/jeeps-non.gif
   trunk/resources/attributes/kids-non.gif
   trunk/resources/attributes/mine-non.gif
   trunk/resources/attributes/motorcycles-non.gif
   trunk/resources/attributes/night-non.gif
   trunk/resources/attributes/onehour-non.gif
   trunk/resources/attributes/parking-non.gif
   trunk/resources/attributes/phone-non.gif
   trunk/resources/attributes/picnic-non.gif
   trunk/resources/attributes/poisonoak-non.gif
   trunk/resources/attributes/public-non.gif
   trunk/resources/attributes/quads-non.gif
   trunk/resources/attributes/rappelling-non.gif
   trunk/resources/attributes/restrooms-non.gif
   trunk/resources/attributes/scenic-non.gif
   trunk/resources/attributes/scuba-non.gif
   trunk/resources/attributes/snakes-non.gif
   trunk/resources/attributes/snowmobiles-non.gif
   trunk/resources/attributes/stealth-non.gif
   trunk/resources/attributes/stroller-non.gif
   trunk/resources/attributes/swimming-non.gif
   trunk/resources/attributes/thorn-non.gif
   trunk/resources/attributes/ticks-non.gif
   trunk/resources/attributes/water-non.gif
   trunk/resources/attributes/wheelchair-non.gif
   trunk/resources/attributes/winter-non.gif
   trunk/src/CacheWolf/AttributesSelector.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/AttributesViewer.java
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/FilterScreen.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Feature: Filter by Attributes. Created by Wortfetzen. Thanks!
Filtering is now possible for caches that have one of several attributes, have all selected attributes or don't have an attribute. To enable the filter, all caches have to be re-loaded to generate the attribute information in the index.xml file.
This is a slightly modified version which works independently of the selected attribute size. If the large attributes (30x30) are used, they are re-scaled on the fly to 20x20. I have not tested this on the PDA to see whether it takes too long, but expect that this is no problem as the grey icons which are always displayed, are available in 20x20 resolution.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-31 23:29:22 UTC (rev 1210)
@@ -230,6 +230,12 @@
 		734=Kein Hauptwegpunkt gefunden zu
 		735=Addi Waypoints m%fcssen das Format xxYYYY haben, wobei xx beliebige Zeichen und YYYY die Zeichen des Hauptcaches nach dem GC sind
 		736=Zu viele Logs (Maximum in Pr%e4ferenzen einstellen)
+		737=Cache-Attribute
+		738=Attribute
+		739=Filter mit
+		740=Allen
+		741=Einem
+		742=Keinem
 		800=Erstelle Liste
 		801=suche...
 		802=Caches identifiziert. Suche weiter...
@@ -515,8 +521,8 @@
 		2584=Geeignet f%fc Rollst%fchle
 		2585=Im Winter nicht verf%fcgbar
 		2586=Auch im Winter verf%fcgbar
-		2587=Cache-wartung notwendig
-		2588=Keine Cachewartung notwendig
+		2587=Keine Cachewartung notwendig
+		2588=Cache-wartung notwendig
 		3000=Schlie%dfen
 		4000=Geladene Caches:
 		4100=Verzeichnis w%e4hlen:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-31 23:29:22 UTC (rev 1210)
@@ -231,6 +231,12 @@
 		734=No main waypoint found for
 		735=Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC
 		736=Too many logs (Limit can be adjusted in preferences)
+		737=Cache-attributes
+		738=Attributes
+		739=Filter on
+		740=all
+		741=one
+		742=none
 		800=Creating list
 		801=searching...
 		802=Caches identified. searching...
@@ -510,8 +516,8 @@
 		2584=wheelchair accessible
 		2585=not available in winter
 		2586=available in winter
-		2587=Needs maintenance
-		2588=No maintenance needed
+		2587=No maintenance needed
+		2588=Needs maintenance
 		3000=Close
 		4000=Loaded caches
 		4101=Maps

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/res_noewe/languages/NL.cfg	2008-01-31 23:29:22 UTC (rev 1210)
@@ -452,8 +452,8 @@
 		2584=Rolstoel vriendelijk
 		2585=Niet beschikbaar in de winter
 		2586=In de winter beschikbaar
-		2587=Onderhoud noodzakelijk
-		2588=Geen onderhoud nodig
+		2587=Geen onderhoud nodig
+		2588=Onderhoud noodzakelijk
 		3000=Sluiten
 		4000=Geladen caches
 		4101=Kaarten

Added: trunk/resources/attributes/available-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/available-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/bicycles-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/bicycles-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/boat-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/boat-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cactus-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cactus-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/campfires-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/campfires-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/camping-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/camping-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cliff-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cliff-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/climbing-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/climbing-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/compass-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/compass-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cow-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cow-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/danger-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/danger-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/dogs-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/dogs-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/fee-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/fee-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/firstaid-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/firstaid-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hiking-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hiking-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/horses-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/horses-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hunting-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hunting-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/jeeps-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/jeeps-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/kids-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/kids-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/mine-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/mine-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/motorcycles-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/motorcycles-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/night-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/night-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/onehour-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/onehour-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/parking-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/parking-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/phone-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/phone-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/picnic-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/picnic-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/poisonoak-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/poisonoak-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/public-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/public-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/quads-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/quads-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/rappelling-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/rappelling-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/restrooms-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/restrooms-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scenic-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scenic-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scuba-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scuba-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snakes-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snakes-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snowmobiles-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snowmobiles-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stealth-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stealth-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stroller-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stroller-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/swimming-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/swimming-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/thorn-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/thorn-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/ticks-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/ticks-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/water-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/water-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wheelchair-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wheelchair-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/winter-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/winter-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Attribute.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -15,11 +15,13 @@
 	
 	private int attNo;
 
+	public int getAttrNr () { return attNo; }
+
 	/**
 	 * The attribute names are identical to the image names.
 	 * Internally the first image name has number 0, the next number 1 and so on.
 	 */
-	private static String [] attributeNames= {
+	public static final String [] attributeNames= {
 			"error.gif",			//00 Unknown attribute
 			"available-no.gif", 	//01 not 24-7
 			"available-yes.gif", 	//02 available 24-7
@@ -107,8 +109,9 @@
 			"wheelchair-yes.gif", 	//84 wheelchair accessible
 			"winter-no.gif", 		//85 not available for winter
 			"winter-yes.gif", 		//86 available in winter
- 	        "firstaid-yes.gif",     //87 needs maintenance
- 	        "firstaid-no.gif"};     //88 does not need maintenance
+			"firstaid-no.gif",              //87 does not need maintenance
+			"firstaid-yes.gif"              //88 needs maintenance
+	};
 	private static mImage [] attributeImages=new mImage[89];
 	private static String IMAGEDIR=File.getProgramDirectory()+"/attributes/";
 	

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Attributes.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -16,6 +16,9 @@
 	 */
 	private Attribute attribs[]=new Attribute[MAXATTRIBS];
 
+	public long attributesYes;
+	public long attributesNo;
+
 	public Attributes() { 
 	}
 
@@ -32,6 +35,8 @@
 	 */
 	 public void clear() {
 		count=0;
+		attributesYes=0;
+		attributesNo=0;
 	}
 	
     ////////////////////////////////////////////////
@@ -74,7 +79,14 @@
 	 * @param attributeName
 	 */
 	public void add(String attributeName){
-		if (count<attribs.length) attribs[count++]=new Attribute(attributeName);
+		if (count<attribs.length) {
+			Attribute attr = new Attribute(attributeName);
+			attribs[count++] = attr;
+			if (attributeName.endsWith("-yes.gif"))
+				attributesYes |= (1l << ( (long)(Math.ceil((long)attr.getAttrNr() / 2.0) - 1.0) ) );
+			else
+				attributesNo |= (1l << ( (long)(Math.ceil((long)attr.getAttrNr() / 2.0) - 1.0) ) );
+		}
     }
 
 	/**

Added: trunk/src/CacheWolf/AttributesSelector.java
===================================================================
--- trunk/src/CacheWolf/AttributesSelector.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/AttributesSelector.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -0,0 +1,142 @@
+package CacheWolf;
+
+import ewe.fx.*;
+import ewe.graphics.*;
+import ewe.sys.*;
+import ewe.ui.*;
+
+public class AttributesSelector extends AttributesViewer {
+	protected static int TILESIZE=22; // Here we always use the small icons thus tilesize=22
+	public long selectionMaskYes = 0;
+	public long selectionMaskNo = 0;
+
+	public AttributesSelector() {
+		super( true /* senseless, but hey - its java :D */);
+		//Rect r = new Rect(0,0,TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS); // As on GC: 6 wide, 2 high
+		iap.virtualSize = new Rect(0,0,200,200);
+		iap.setPreferredSize(170, 155);
+		addLast(iap,CellConstants.STRETCH,FILL);
+		addLast(mInfo=new mLabel(""),HSTRETCH,HFILL);
+	}
+
+	public void setSelectionMasks(long yes, long no) {
+		selectionMaskYes = yes;
+		selectionMaskNo = no;
+		showAttributePalette();
+	}
+
+	protected class attAniImage extends AttributesViewer.attAniImage {
+		public String info;
+		public String attrName;
+		public String value;
+		public int attrNr;
+		public long bitMask;
+		attAniImage (mImage img) {
+			super(img);
+		}
+		attAniImage (attAniImage cp, String val) {
+			super(null);
+			mImage rawImg=new mImage(Attribute.getImageDir() + cp.attrName + val );
+			setMImage (rawImg.getHeight()!=20 ? rawImg.scale(20,20,null,Image.FOR_DISPLAY) : rawImg  );
+			value = val;
+			info = MyLocale.getMsg( value.equals("-no.gif") ? (2500+cp.attrNr-1) : 2500+cp.attrNr,"No attribute info found");
+			attrName = cp.attrName;
+			location = cp.location;
+			attrNr = cp.attrNr;
+			bitMask = cp.bitMask;
+		}
+	}
+	
+	protected class attInteractivePanel extends AttributesViewer.attInteractivePanel {
+				public boolean imageMovedOn(AniImage which) {
+			if (!((attAniImage)which).info.startsWith("*")) { // If text starts with * we have no explanation yet
+				mInfo.setText(((attAniImage)which).info);
+				mInfo.repaintNow();
+			}
+			return true;
+		}
+		public boolean imageMovedOff(AniImage which) {
+			mInfo.setText("");
+			mInfo.repaintNow();
+			return true;
+		}
+		public boolean imagePressed(AniImage which, Point pos) {
+			if (which != null) {
+				String value = ((attAniImage)which).value;
+				long bit = ((attAniImage)which).bitMask;
+				if (value.equals("-non.gif")) {
+					selectionMaskYes |= bit;
+					selectionMaskNo  &= ~bit;
+					value="-yes.gif";
+				} else if (value.equals("-yes.gif")) {
+					selectionMaskYes &= ~bit;
+					selectionMaskNo  |= bit;
+					value="-no.gif";
+				} else {
+					selectionMaskYes &= ~bit;
+					selectionMaskNo  &= ~bit;
+					value="-non.gif";
+				}
+				attAniImage tmpImg = new attAniImage( (attAniImage)which, value );
+				removeImage(which);
+				addImage(tmpImg);
+				//System.out.println ("AniImage pressed: " + ((attAniImage)which).info);
+				refresh();
+				notifyDataChange(new DataChangeEvent(DataChangeEvent.DATA_CHANGED,this));
+			}
+			return true;
+		}
+	}
+	protected InteractivePanel iap=new attInteractivePanel();
+
+	public void showAttributePalette() {
+		iap.images.clear();
+		int width = 170;
+		int height = 180;
+		if (getParent() != null) {
+			//iap.setFixedSize(getParent().getSize(null).width-10, getParent().getSize(null).height-20);
+			width = getParent().getSize(null).width-10;
+			height = getParent().getSize(null).height-40;
+			iap.virtualSize = new Rect(0,0,width,height);
+			iap.setPreferredSize(width,height);
+		}
+		int x = 2; int y = 2;
+		long bitMask = 0;
+		String attrName;
+		String value;
+		for (int i=0; i < Attribute.attributeNames.length; ++i) {
+			if (Attribute.attributeNames[i].endsWith("-yes.gif")) {
+				attrName = Attribute.attributeNames[i].substring(0,Attribute.attributeNames[i].length()-8);
+				bitMask = ( 1l << ( (long)(java.lang.Math.ceil((long)i / 2.0) - 1.0) ) );
+				if ( (selectionMaskYes & bitMask) != 0 )
+					value = "-yes.gif";
+				else if ( (selectionMaskNo & bitMask) != 0 )
+					value = "-no.gif";
+				else
+					value = "-non.gif";
+				mImage rawImg=new mImage(Attribute.getImageDir()+attrName+value);	
+				attAniImage img=new attAniImage(rawImg.getHeight()!=20 ? rawImg.scale(20,20,null,Image.FOR_DISPLAY) : rawImg );
+				img.info=MyLocale.getMsg(2500+i,"No attribute info found");
+				img.value=value;
+				img.attrName=attrName;
+				img.attrNr = i;
+				img.bitMask = bitMask;
+
+				if (x+TILESIZE > width) {
+					x = 2;
+					y += TILESIZE;
+				}
+				img.location=new Rect(x,y,TILESIZE,TILESIZE);
+				//System.out.println("img.location=new Rect("+x+","+y+","+TILESIZE+","+TILESIZE+");");
+				iap.addImage(img);
+				x += TILESIZE;
+			}
+		}
+		iap.repaintNow();
+	}
+	
+/*	public void resizeTo(int width, int height) {
+		super.resizeTo(width,height);
+	}
+*/	
+}


Property changes on: trunk/src/CacheWolf/AttributesSelector.java
___________________________________________________________________
Name: svn:keywords
   + LastChangedRevision

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/AttributesViewer.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -6,12 +6,12 @@
 import ewe.ui.*;
 
 public class AttributesViewer extends CellPanel {
-	private static int TILESIZE=Attribute.getImageWidth()+2;
-	private final static int ICONS_PER_ROW=MyLocale.getScreenWidth()/TILESIZE<Attributes.MAXATTRIBS ? MyLocale.getScreenWidth()/TILESIZE : Attributes.MAXATTRIBS;
-	private final static int ICONROWS=(Attributes.MAXATTRIBS+ICONS_PER_ROW-1)/ICONS_PER_ROW;
-	private mLabel mInfo;
+	protected static int TILESIZE=Attribute.getImageWidth()+2;
+	protected final static int ICONS_PER_ROW=MyLocale.getScreenWidth()/TILESIZE<Attributes.MAXATTRIBS ? MyLocale.getScreenWidth()/TILESIZE : Attributes.MAXATTRIBS;
+	protected final static int ICONROWS=(Attributes.MAXATTRIBS+ICONS_PER_ROW-1)/ICONS_PER_ROW;
+	protected mLabel mInfo;
 
-	private class attInteractivePanel extends InteractivePanel {
+	protected class attInteractivePanel extends InteractivePanel {
 		public boolean imageMovedOn(AniImage which) {
 			if (!((attAniImage)which).info.startsWith("*")) { // If text starts with * we have no explanation yet
 				mInfo.setText(((attAniImage)which).info);
@@ -26,7 +26,7 @@
 		}
 	}
 	
-	private class attAniImage extends AniImage {
+	protected class attAniImage extends AniImage {
 		public String info;
 		attAniImage (mImage img) {
 			super(img);
@@ -40,7 +40,11 @@
 		addLast(iap,CellConstants.HSTRETCH,CellConstants.FILL);
 		addLast(mInfo=new mLabel(""),HSTRETCH,HFILL);
 	}
-	private InteractivePanel iap=new attInteractivePanel();
+	public AttributesViewer ( boolean dontinitialize ){
+		// this is only to prevent automatic constructor calling [ AttributesViewer () ]
+		// from AttributesSelector
+	}
+	protected InteractivePanel iap=new attInteractivePanel();
 	
 	public void showImages(Attributes att) {
 		iap.images.clear();

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/CacheHolder.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -102,6 +102,9 @@
 	public String sort;
 	private static StringBuffer sb=new StringBuffer(530); // Used in toXML()
 
+	public long attributesYes = 0;
+	public long attributesNo  = 0;
+
 //	static int nObjects=0;
 	public CacheHolder() {//nObjects++;Vm.debug("CacheHolder() nO="+nObjects);
 	}
@@ -210,6 +213,15 @@
 			start=xmlString.indexOf('"',end+1); end=xmlString.indexOf('"',start+1);
 			numFoundsSinceRecommendation = Convert.toInt(xmlString.substring(start+1,end));
 			recommendationScore = LogList.getScore(numRecommended, numFoundsSinceRecommendation);
+
+			start=xmlString.indexOf('"',end+1); end=xmlString.indexOf('"',start+1);
+			if (start > -1 && end > -1) {
+				attributesYes = Convert.parseLong(xmlString.substring(start+1,end));
+
+				start=xmlString.indexOf('"',end+1); end=xmlString.indexOf('"',start+1);
+				if (start > -1 && end > -1)
+					attributesNo = Convert.parseLong(xmlString.substring(start+1,end));
+			}
 		} catch (Exception ex) {
 
 		}
@@ -279,6 +291,9 @@
 		this.is_HTML = ch.is_HTML;
 		this.sort=ch.sort;
 		this.lastSyncOC = ch.lastSyncOC;
+
+		this.attributesYes = ch.attributesYes;
+		this.attributesNo = ch.attributesNo;
 	}
 	/**
 	 * Call it only when necessary, it takes time, because all logs must be parsed
@@ -344,6 +359,8 @@
 		sb.append("\" lastSyncOC = \"" );sb.append(lastSyncOC ); 
 		sb.append("\" num_recommended = \"");sb.append(Convert.formatInt(numRecommended)); 
 		sb.append("\" num_found = \"" );sb.append(Convert.formatInt(numFoundsSinceRecommendation));
+		sb.append("\" attributesYes = \"" ); sb.append(Convert.formatLong(attributesYes));
+		sb.append("\" attributesNo = \"" ); sb.append(Convert.formatLong(attributesNo));
 		sb.append("\" />\n");
 		return sb.toString();
 	}

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Filter.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -104,6 +104,10 @@
 	private boolean available=false;
 	private boolean notAvailable = false;
 	double pi180=java.lang.Math.PI / 180.0;
+
+	private long attributesYesPattern = 0;
+	private long attributesNoPattern = 0;
+	private int attributesChoice = 0;
 	
 	/**
 	*	Apply a route filter. Each waypoint is on a seperate line.
@@ -309,6 +313,9 @@
 		terrdirec = profile.filterTerr.charAt(0) == 'L' ? SMALLER : 
 				(profile.filterTerr.charAt(0) == '=' ? EQUAL : GREATER );
 		fscTerr = Common.parseDouble(profile.filterTerr.substring(1));  // Terrain
+		attributesYesPattern = profile.filterAttrYes;
+		attributesNoPattern = profile.filterAttrNo;
+		attributesChoice = profile.filterAttrChoice;
 	}
 	
 	/**
@@ -462,7 +469,39 @@
 				else cacheSizePattern = OTHER;
 				if ((cacheSizePattern & sizeMatchPattern) == 0) { ch.is_filtered=true; continue; }
 			}
-			
+			///////////////////////////////
+			// Filter criterium 11: Attributes
+			///////////////////////////////
+			if ( (attributesYesPattern != 0 || attributesNoPattern != 0) && ch.mainCache == null) {
+				if (attributesChoice == 0) {
+					// AND-condition:
+					if (
+						(ch.attributesYes & attributesYesPattern) != attributesYesPattern
+						|| (ch.attributesNo & attributesNoPattern) != attributesNoPattern )
+					{
+						ch.is_filtered=true;
+						continue;
+					}
+				} else if (attributesChoice == 1) {
+					// OR-condition:
+					if (
+						(ch.attributesYes & attributesYesPattern) == 0
+						&& (ch.attributesNo & attributesNoPattern) == 0 )
+					{
+						ch.is_filtered=true;
+						continue;
+					}
+				} else {
+					// NOT-condition:
+					if (
+						(ch.attributesYes & attributesYesPattern) != 0
+						|| (ch.attributesNo & attributesNoPattern) != 0 )
+					{
+						ch.is_filtered=true;
+						continue;
+					}
+				}
+			}
 		} // for
 		// Ensure that for all main caches that are filtered, the addis are also filtered independently of 
 		// the filter status of the addi
@@ -520,7 +559,9 @@
 		    prof.filterSize.equals(Profile.FILTERSIZE) &&
 		    prof.filterDist.equals("L") &&
 		    prof.filterDiff.equals("L") &&
-		    prof.filterTerr.equals("L"));
+		    prof.filterTerr.equals("L") &&
+		    prof.filterAttrYes == 0l &&
+		    prof.filterAttrNo == 0l);
 	}
 
 }

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/FilterScreen.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -17,9 +17,9 @@
 	private static final Color COLOR_FILTERALL=new Color(255,0,0); // Red
     	
 	private mButton btnCancel, btnApply,btnRoute,
-					btnBearing,btnTypes,btnAttributes,btnRatings,btnContainer,btnSearch,btnAddi, btnSelect,btnDeselect;
+					btnBearing,btnTypes,btnAttributes,btnRatings,btnContainer,btnSearch,btnAddi, btnSelect,btnDeselect,btnCacheAttributes;
 	
-	private mChoice chcDist, chcDiff, chcTerr;
+	private mChoice chcDist, chcDiff, chcTerr, chcAttrib;
 	private mCheckBox chkFound, chkNotFound, chkTrad, chkVirtual, chkEvent, chkEarth, chkMega,
 					  chkOwned, chkNotOwned, chkMulti, chkLetter, chkWebcam, chkMystery, chkLocless,
 	                  chkCustom,chkParking,	chkStage, chkQuestion, chkFinal, chkTrailhead, chkReference,
@@ -29,6 +29,8 @@
 					  chkSSW, chkSW, chkWSW, chkW, chkWNW;
 	
 	private mInput inpDist, inpTerr, inpDiff;
+
+	AttributesSelector attV;
 	
 	private CellPanel pnlBearDist=new CellPanel();
 	private CellPanel pnlAttributes=new CellPanel();
@@ -39,6 +41,7 @@
 	private CellPanel pnlRose = new CellPanel();
 	private CellPanel pnlButtons=new CellPanel();
 	private CellPanel pnlAddi=new CellPanel();
+	private CellPanel pnlCacheAttributes=new CellPanel();
 	private CardPanel cp=new CardPanel();
 
 	// A subclassed checkbox with a "third" state (=grey background).
@@ -236,7 +239,20 @@
 		//////////////////////////
 		addTitle(pnlSearch,"Search");
 		pnlSearch.addLast(new mLabel("To be implemented"));
+
+
+		//////////////////////////
+		// Panel 8 - Cache attributes
+		//////////////////////////
 		
+		addTitle(pnlCacheAttributes,MyLocale.getMsg(737,"Attributes"));
+		pnlCacheAttributes.addNext(new mLabel(MyLocale.getMsg(739,"Filter on")+":"), CellConstants.DONTSTRETCH, CellConstants.FILL);
+		pnlCacheAttributes.addLast(chcAttrib = new mChoice(new String[]{MyLocale.getMsg(740,"all"), MyLocale.getMsg(741,"one"), MyLocale.getMsg(742,"none")},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+
+		attV=new AttributesSelector();
+		pnlCacheAttributes.addLast(attV, CellConstants.STRETCH|CellConstants.LEFT|CellConstants.BORDER, CellConstants.STRETCH);
+		attV.setSelectionMasks( 0l, 0l );
+		
 		Frame frmScreen=new Frame();
 		mLabel lblInfo; 
 		frmScreen.addLast(lblInfo=new mLabel(MyLocale.getMsg(725,"Note: Filters are additive, active filter=green"))).setTag(SPAN,new Dimension(2,1));
@@ -252,6 +268,7 @@
 		pnlButtons.addLast(btnTypes=new mButton(MyLocale.getMsg(723,"Types"))); 
 		pnlButtons.addLast(btnAddi=new mButton(MyLocale.getMsg(733,"Add. Wpt"))); 
 		pnlButtons.addLast(btnContainer=new mButton(MyLocale.getMsg(724,"Container")));
+		pnlButtons.addLast(btnCacheAttributes=new mButton(MyLocale.getMsg(738,"Attributes")));
 		// Search ist f?r 0.9n noch deaktiviert
 		//pnlButtons.addLast(btnSearch=new mButton("Search")); btnSearch.modify(Disabled,0);
 		addNext(pnlButtons,HSTRETCH,FILL);
@@ -263,6 +280,7 @@
 		cp.addItem(pnlAddi,"Addi",null);
 		cp.addItem(pnlContainer,"Size",null);
 		cp.addItem(pnlSearch,"Search",null);
+		cp.addItem(pnlCacheAttributes,"Attr",null);
 		addLast(cp);
 
 		CellPanel btPanel = new CellPanel();
@@ -270,7 +288,7 @@
 		btPanel.addNext(btnApply = new mButton(MyLocale.getMsg(709,"Apply")),CellConstants.STRETCH, CellConstants.FILL);
 		btPanel.addLast(btnRoute = new mButton("Route"),CellConstants.STRETCH, CellConstants.FILL);
 		addLast(btPanel.setTag(Control.SPAN, new Dimension(3,1)), CellConstants.STRETCH, CellConstants.FILL);
-		setPreferredSize(240,240);
+		setPreferredSize(240,260);
 		cp.select(3);
 	}
 	
@@ -400,6 +418,12 @@
 		//////////////////////////
 		// Panel 7 - Search
 		//////////////////////////
+
+		//////////////////////////
+		// Panel 8 - Cache attributes
+		//////////////////////////
+		attV.setSelectionMasks( prof.filterAttrYes, prof.filterAttrNo );
+		chcAttrib.select(prof.filterAttrChoice);
 		
 		// Adjust colors of buttons depending on which filters are active
 		setColors();
@@ -492,6 +516,14 @@
 		btnContainer.repaint();
 			
 		// Panel 7 - Search
+
+		// Panel 8 - Cache attributes
+		if ( attV.selectionMaskYes == 0l && attV.selectionMaskNo == 0l)
+			btnCacheAttributes.backGround=COLOR_FILTERINACTIVE;
+		else
+			btnCacheAttributes.backGround=COLOR_FILTERACTIVE;
+		btnCacheAttributes.repaint();
+
 		
 	}
 	
@@ -596,6 +628,9 @@
 				} else { 
 					pfl.filterTerr="G"+inpTerr.getText();
 				}
+				pfl.filterAttrYes = attV.selectionMaskYes;
+				pfl.filterAttrNo = attV.selectionMaskNo;
+				pfl.filterAttrChoice = chcAttrib.selectedIndex;
 				Filter flt = new Filter();
 				flt.setFilter();
 				flt.doFilter();
@@ -619,6 +654,7 @@
 			else if (ev.target == btnAddi)cp.select(4);
 			else if (ev.target == btnContainer)cp.select(5);
 			else if (ev.target == btnSearch)cp.select(6);
+			else if (ev.target == btnCacheAttributes)cp.select(7);
 			else if (ev.target == btnDeselect) {
 				chkNW.state= chkNNW.state  = chkN.state    = chkNNE.state  = 
 				chkNE.state   = chkENE.state  = chkE.state    = chkESE.state  = 

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/Profile.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -61,6 +61,10 @@
 	public int filterActive=Filter.FILTER_INACTIVE;
 	public boolean filterInverted=false;
 
+	public long filterAttrYes = 0l;
+	public long filterAttrNo = 0l;
+	public int filterAttrChoice = 0;
+
 	public boolean selectionChanged = true; // ("H?ckchen") used by movingMap to get to knao if it should update the caches in the map 
 	/** True if the profile has been modified and not saved
 	 * The following modifications set this flag: New profile centre, Change of waypoint data 
@@ -149,7 +153,7 @@
 			detfile.print("    <FILTER status = \""+filterActive+(filterInverted?"T":"F")+ 
 					"\" rose = \""+filterRose+"\" type = \""+filterType+
 					"\" var = \""+filterVar+"\" dist = \""+filterDist.replace('"',' ')+"\" diff = \""+
-					filterDiff+"\" terr = \""+filterTerr+"\" size = \""+filterSize+"\" />\n");
+					filterDiff+"\" terr = \""+filterTerr+"\" size = \""+filterSize+"\" attributesYes = \""+filterAttrYes+"\" attributesNo = \""+filterAttrNo+"\" attributesChoice = \""+filterAttrChoice+"\" />\n");
 			detfile.print("    <SYNCOC date = \""+last_sync_opencaching+"\" dist = \""+distOC+"\"/>\n");
 			int size=cacheDB.size();
 			for(int i = 0; i<size;i++){
@@ -246,6 +250,15 @@
 					filterDiff = ex.findNext();
 					filterTerr = ex.findNext();
 					filterSize = ex.findNext();
+					String attr = ex.findNext();
+					if (attr != null && !attr.equals(""))
+						filterAttrYes = Convert.parseLong(attr);
+					attr = ex.findNext();
+					if (attr != null && !attr.equals(""))
+						filterAttrNo = Convert.parseLong(attr);
+					attr = ex.findNext();
+					if (attr != null && !attr.equals(""))
+						filterAttrChoice = Convert.parseInt(attr);
 				}
 			}
 			in.close();

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-01-31 16:44:16 UTC (rev 1209)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-01-31 23:29:22 UTC (rev 1210)
@@ -1107,8 +1107,8 @@
 			chD.attributes.add(attribute);
 			attribute=attEx.findNext();
 		}
-		//chD.attributesYes = chD.attributes.attributesYes;
-		//chD.attributesNo = chD.attributes.attributesNo;
+		chD.attributesYes = chD.attributes.attributesYes;
+		chD.attributesNo = chD.attributes.attributesNo;
 	}
 
 



From mik77 at mail.berlios.de  Fri Feb  1 18:42:27 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 1 Feb 2008 18:42:27 +0100
Subject: [Cachewolf-svn] r1211 - trunk/resources/attributes
Message-ID: <200802011742.m11HgRDe024216@sheep.berlios.de>

Author: mik77
Date: 2008-02-01 18:42:23 +0100 (Fri, 01 Feb 2008)
New Revision: 1211

Added:
   trunk/resources/attributes/wading-non.gif
Log:
missing icon added

Added: trunk/resources/attributes/wading-non.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wading-non.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From mik77 at mail.berlios.de  Fri Feb  1 18:44:54 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 1 Feb 2008 18:44:54 +0100
Subject: [Cachewolf-svn] r1212 - trunk
Message-ID: <200802011744.m11His1T028837@sheep.berlios.de>

Author: mik77
Date: 2008-02-01 18:44:51 +0100 (Fri, 01 Feb 2008)
New Revision: 1212

Modified:
   trunk/fwrtsnapshot.sh
Log:
Add icons for attributes filter to datfiles.tar

Modified: trunk/fwrtsnapshot.sh
===================================================================
--- trunk/fwrtsnapshot.sh	2008-02-01 17:42:23 UTC (rev 1211)
+++ trunk/fwrtsnapshot.sh	2008-02-01 17:44:51 UTC (rev 1212)
@@ -29,6 +29,7 @@
 install -c -m 644 work/CacheWolf.ewe published/
 install -c -m 644 res_noewe/* published/dat/
 install -c -m 644 resources/attributes-big/*.gif published/dat/attributes/
+install -c -m 644 resources/attributes/*-non.gif published/dat/attributes/
 install -c -m 644 res_noewe/webmapservices/* published/dat/webmapservices/
 install -c -m 644 res_noewe/languages/* published/dat/languages/
 (cd published/dat && find * -type f | sort | \



From mik77 at mail.berlios.de  Fri Feb  1 18:51:26 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 1 Feb 2008 18:51:26 +0100
Subject: [Cachewolf-svn] r1213 - trunk/res_noewe/languages
Message-ID: <200802011751.m11HpQWS003613@sheep.berlios.de>

Author: mik77
Date: 2008-02-01 18:51:24 +0100 (Fri, 01 Feb 2008)
New Revision: 1213

Modified:
   trunk/res_noewe/languages/DE.cfg
Log:
small spelling corrections

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-02-01 17:44:51 UTC (rev 1212)
+++ trunk/res_noewe/languages/DE.cfg	2008-02-01 17:51:24 UTC (rev 1213)
@@ -454,7 +454,7 @@
 		2517=*compass-no
 		2518=*compass-yes
 		2519=*cow-no
-		2520=Auchtung auf Weidevieh
+		2520=Achtung Weidevieh
 		2521=*danger-no
 		2522=Gef%e4hrliches Gebiet
 		2523=Keine Hunde
@@ -514,7 +514,7 @@
 		2577=*ticks-no
 		2578=Zecken!
 		2579=*wading-no
-		2580=Waten m%e4glich
+		2580=Waten m%f6glich
 		2581=*water-no
 		2582=Trinkwasser verf%fcgbar
 		2583=F%fcr Rollst%fchle nicht geeignet



From mik77 at mail.berlios.de  Fri Feb  1 23:04:11 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 1 Feb 2008 23:04:11 +0100
Subject: [Cachewolf-svn] r1214 - trunk/src/CacheWolf
Message-ID: <200802012204.m11M4BZS013754@sheep.berlios.de>

Author: mik77
Date: 2008-02-01 23:04:09 +0100 (Fri, 01 Feb 2008)
New Revision: 1214

Modified:
   trunk/src/CacheWolf/CWPoint.java
Log:
correctly display longitudes more western than -100 degrees

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2008-02-01 17:51:24 UTC (rev 1213)
+++ trunk/src/CacheWolf/CWPoint.java	2008-02-01 22:04:09 UTC (rev 1214)
@@ -359,7 +359,7 @@
 		case DD: 	return MyLocale.formatDouble(this.lonDec, "000.00000").replace(',','.');
 		case CW:
 		case DMM:
-		case DMS:	return (lonDec<100.0?"0":"")+getDMS(lonDec,0,format);
+		case DMS:	return (((lonDec<100.0) && (lonDec>-100.0))?"0":"")+getDMS(lonDec,0,format);
 		default: 	return ""; 
 		}
 	}



From mik77 at mail.berlios.de  Sat Feb  2 10:35:51 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 2 Feb 2008 10:35:51 +0100
Subject: [Cachewolf-svn] r1215 - trunk/src/CacheWolf
Message-ID: <200802020935.m129Zpja028472@sheep.berlios.de>

Author: mik77
Date: 2008-02-02 10:35:49 +0100 (Sat, 02 Feb 2008)
New Revision: 1215

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
fixed bug when creating a series of AddiWpts without leaving the DetailsPanel

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-02-01 22:04:09 UTC (rev 1214)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-02-02 09:35:49 UTC (rev 1215)
@@ -282,7 +282,9 @@
 		if (CacheType.isAddiWpt(transSelect(chcType.getInt())) && 
 				(Global.mainTab.mainCache.startsWith("GC")||Global.mainTab.mainCache.startsWith("OC")||Global.mainTab.mainCache.startsWith("CW")) &&
 				wpt.startsWith("CW")) {
-			// for what was this?: Global.mainTab.lastselected=Global.mainTab.mainCache;
+			// for what was this?:
+			Global.mainTab.lastselected=Global.mainTab.mainCache; //I don't know exactly, but it's needed for creating a series of Addis
+			
 			inpWaypoint.setText(Global.getProfile().getNewAddiWayPointName(Global.mainTab.mainCache));
 		} 
 		if (!CacheType.isAddiWpt(transSelect(chcType.getInt())) && !(wpt.startsWith("GC") 



From pfeffer at mail.berlios.de  Fri Feb  8 18:37:57 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 8 Feb 2008 18:37:57 +0100
Subject: [Cachewolf-svn] r1216 - in trunk: res_noewe/languages
	src/CacheWolf/navi
Message-ID: <200802081737.m18HbvJN007489@sheep.berlios.de>

Author: pfeffer
Date: 2008-02-08 18:37:44 +0100 (Fri, 08 Feb 2008)
New Revision: 1216

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/navi/Navigate.java
Log:
GPS: new error message in the case of missing java_ewe.dll, see http://www.geoclub.de/viewtopic.php?p=349095#349095

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-02-02 09:35:49 UTC (rev 1215)
+++ trunk/res_noewe/languages/DE.cfg	2008-02-08 17:37:44 UTC (rev 1216)
@@ -622,6 +622,7 @@
 		4403=Fehler
 		4404=Konnte keine Verbindung zum GPS-Empf%e4nger %0a herstellen. Fehler beim %f6ffnen des seriellen Ports%0a
 		4405=%0aM%f6gliche Gr%fcnde:%0a Falscher Port %0a Ein anderes Programm blokiert den Anschluss %0a gilt nur auf Loox-Ger%e4ten: ge%f6ffneter Infrarot-Port blockiert das GPS
+		4406=Kopieren Sie java_ewe.dll in das Verzeichnis des Cachwolf-Programms
 		4500=Ges:
 		4501=Gez:
 		4502=Gef:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-02-02 09:35:49 UTC (rev 1215)
+++ trunk/res_noewe/languages/EN.cfg	2008-02-08 17:37:44 UTC (rev 1216)
@@ -609,6 +609,7 @@
 		4403=Error
 		4404=Could not connect to GPS-receiver.%0a Error while opening serial Port%0a
 		4405=%0apossible reasons:\n Another (GPS-)program is blocking the port%0awrong port%0aOn Loox: active infra-red port is blocking GPS"
+		4406=Please copy jave_ewe.dll into the directory of the cachewolf program
 		4500=Tot:
 		4501=Vis:
 		4502=Fnd:

Modified: trunk/src/CacheWolf/navi/Navigate.java
===================================================================
--- trunk/src/CacheWolf/navi/Navigate.java	2008-02-02 09:35:49 UTC (rev 1215)
+++ trunk/src/CacheWolf/navi/Navigate.java	2008-02-08 17:37:44 UTC (rev 1216)
@@ -73,6 +73,11 @@
 					+ e.getMessage()
 					+ MyLocale.getMsg(4405, "\npossible reasons:\n Another (GPS-)program is blocking the port\nwrong port\nOn Loox: active infra-red port is blocking GPS"), 
 					MessageBox.OKB)).execute(); 
+		} catch (UnsatisfiedLinkError e) {
+			(new MessageBox(MyLocale.getMsg(4403, "Error"), 
+					MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ") 
+					+ MyLocale.getMsg(4406, "Please copy jave_ewe.dll into the directory of the cachewolf program"), 
+					MessageBox.OKB)).execute(); 
 		}
 	}
 



From salzkammergut at mail.berlios.de  Sat Feb 16 12:57:36 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 16 Feb 2008 12:57:36 +0100
Subject: [Cachewolf-svn] r1217 - trunk/src/CacheWolf
Message-ID: <200802161157.m1GBvacS012998@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-16 12:57:25 +0100 (Sat, 16 Feb 2008)
New Revision: 1217

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
ListView: Bugfix for Rev 1209. Can change column width by dragging.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-02-08 17:37:44 UTC (rev 1216)
+++ trunk/src/CacheWolf/myTableControl.java	2008-02-16 11:57:25 UTC (rev 1217)
@@ -281,14 +281,14 @@
 	int row;
 	
 	public void startDragging(DragContext dc) {
-		if (!Global.mainForm.cacheListVisible) {
-			dc.cancelled=true;
-			return;
-		}
 		Vector cacheDB=Global.getProfile().cacheDB;
 		 Point p=cellAtPoint(dc.start.x,dc.start.y,null);
 		 wayPoint=null;
 		 if (p.y>=0) { 
+			if (!Global.mainForm.cacheListVisible) {
+				dc.cancelled=true;
+				return;
+			}
 			 row=p.y;
 			 CacheHolder ch=(CacheHolder)cacheDB.get(p.y);
 			 wayPoint=ch.wayPoint;



From salzkammergut at mail.berlios.de  Sun Feb 24 18:53:15 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 24 Feb 2008 18:53:15 +0100
Subject: [Cachewolf-svn] r1218 - trunk/src/CacheWolf
Message-ID: <200802241753.m1OHrFlS008189@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-24 18:53:08 +0100 (Sun, 24 Feb 2008)
New Revision: 1218

Modified:
   trunk/src/CacheWolf/CacheList.java
Log:
CacheList: Add .CL Extension if none is supplied. When dragging a cache, the main waypoint is now inserted above the addi waypoints (as requested by various users).

Modified: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2008-02-16 11:57:25 UTC (rev 1217)
+++ trunk/src/CacheWolf/CacheList.java	2008-02-24 17:53:08 UTC (rev 1218)
@@ -209,6 +209,7 @@
 				fc.setTitle(MyLocale.getMsg(191,"Select File"));
 				if(fc.execute() != FileChooser.IDCANCEL){
 					currFile = fc.getChosen();
+					if (currFile.indexOf('.')==0 || !currFile.toUpperCase().endsWith("."+EXTENSION)) currFile+="."+EXTENSION;
 					saveToFile(currFile);
 				}
 			} else if (ev.target==btnUp) {
@@ -301,6 +302,8 @@
 		if (idx==-1) return false;
 		CacheHolder ch=(CacheHolder) Global.getProfile().cacheDB.get(idx);
 		boolean cachesAdded=false;
+		// Add main cache
+		cachesAdded|=addCache(ch);
 		// Add addis if user wants it
 		if (chkAddAddis.state && ch.hasAddiWpt()) {
 			CacheHolder addiWpt;
@@ -309,8 +312,6 @@
 				if (!addiWpt.is_filtered) cachesAdded|=addCache(addiWpt);
 			}
 		}
-		// Add main cache
-		cachesAdded|=addCache(ch);
 		// Update screen if any cache was added
 		if (cachesAdded) {	
 			lstCaches.select(lstCaches.itemsSize()-1);



From salzkammergut at mail.berlios.de  Sun Feb 24 20:42:25 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 24 Feb 2008 20:42:25 +0100
Subject: [Cachewolf-svn] r1219 - trunk/src/CacheWolf
Message-ID: <200802241942.m1OJgPAQ006400@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-24 20:42:23 +0100 (Sun, 24 Feb 2008)
New Revision: 1219

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Spider: Distance input can now use either decimal point or comma.
See also: http://www.geoclub.de/ftopic22394-8.html

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-02-24 17:53:08 UTC (rev 1218)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-02-24 19:42:23 UTC (rev 1219)
@@ -304,7 +304,7 @@
 		if (options.execute() == OCXMLImporterScreen.IDCANCEL) {return; }
 		String dist = options.distanceInput.getText();
 		if (dist.length()== 0) return;
-		distance = Convert.toDouble(dist);
+		distance = Common.parseDouble(dist);
 		boolean doNotgetFound = options.foundCheckBox.getState();
 		boolean getImages = options.imagesCheckBox.getState();
 		options.close(0);



From salzkammergut at mail.berlios.de  Sun Feb 24 21:00:28 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 24 Feb 2008 21:00:28 +0100
Subject: [Cachewolf-svn] r1220 - trunk/src/CacheWolf
Message-ID: <200802242000.m1OK0SBH007690@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-24 21:00:25 +0100 (Sun, 24 Feb 2008)
New Revision: 1220

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
listView: If blacklisted caches are shown, the title row of the tickbox column is coloured black.

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2008-02-24 19:42:23 UTC (rev 1219)
+++ trunk/src/CacheWolf/myTableModel.java	2008-02-24 20:00:25 UTC (rev 1220)
@@ -210,7 +210,7 @@
 				else if(ch.is_found == true) ta.fillColor = COLOR_FOUND;
 				else if(ch.is_flaged == true) ta.fillColor = COLOR_FLAGED;
 			} catch (Exception e) {};
-		}
+		} else if (row==-1 && colMap[col]==0 && Filter.showBlacklisted) ta.fillColor=Color.Black;
 		return ta;
 	}
 



From salzkammergut at mail.berlios.de  Sun Feb 24 21:41:10 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 24 Feb 2008 21:41:10 +0100
Subject: [Cachewolf-svn] r1221 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200802242041.m1OKfAhm019179@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-24 21:40:59 +0100 (Sun, 24 Feb 2008)
New Revision: 1221

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Listview: Moved "Update selected caches" from context menu to import menu in menu main.
Moved "Filter non marked" from context menu to filter menu in menu main.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-02-24 20:00:25 UTC (rev 1220)
+++ trunk/res_noewe/languages/DE.cfg	2008-02-24 20:40:59 UTC (rev 1221)
@@ -55,7 +55,7 @@
 		157=System
 		158=Version pr%fcfen
 		159=Filter
-		160=Selektierte ausfiltern
+		160=Markierte ausfiltern
 		161=Zeige Blacklist
 		162=Kalibrierte herunterladen
 		170=Basisverzeichnis f%fcr die Profile w%e4hlen

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-02-24 20:00:25 UTC (rev 1220)
+++ trunk/res_noewe/languages/EN.cfg	2008-02-24 20:40:59 UTC (rev 1221)
@@ -15,9 +15,9 @@
 		111=Exit
 		112=Search
 		113=Clear Search
-		114=Create
-		115=Invert
-		116=Clear
+		114=Create filter
+		115=Invert filter
+		116=Clear filter
 		117=About
 		118=WolfLanguage
 		119=Search for:
@@ -55,7 +55,7 @@
 		157=System
 		158=Version Check
 		159=Filter
-		160=Filter selected
+		160=Filter out selected
 		161=Show Blacklist
 		162=Download calibrated
 		170=Select base directory for cache data
@@ -203,7 +203,7 @@
 		706=Found
 		707=Owner
 		708=Cancel
-		709=Apply
+		709=Apply filter
 		710=Archived
 		711=Not available
 		712=Select route file
@@ -269,7 +269,7 @@
 		1008=Dist
 		1009=Bear
 		1010=Goto this one
-		1011=filter out non-selected
+		1011=Filter out non-selected
 		1012=Delete selected
 		1013=With selection
 		1014=Update cache data

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-02-24 20:00:25 UTC (rev 1220)
+++ trunk/src/CacheWolf/MainMenu.java	2008-02-24 20:40:59 UTC (rev 1221)
@@ -25,11 +25,11 @@
 public class MainMenu extends MenuBar {
 	private MenuItem profiles, preferences,loadcaches,loadOC,savenexit,savenoxit,exit,search,searchClr;
 	private MenuItem downloadmap, kalibmap, importmap;
-	private MenuItem spider, chkVersion;
+	private MenuItem spider, update, chkVersion;
 	private MenuItem about, wolflang, sysinfo, legend;
 	private MenuItem exportpcx5, exporthtml, exporttop50, exportGPX, exportASC, exportTomTom, exportMSARCSV;
 	private MenuItem exportOZI, exportKML, exportTPL, exportMagellan;
-	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtBlack, filtApply;
+	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtNonSelected, filtBlack, filtApply;
 	private MenuItem exportGPS, exportCacheMate,mnuSeparator;
 	private MenuItem orgCopy, orgMove, orgDelete,orgRebuild;
 	public MenuItem filtCacheTour,orgTravelbugs, mnuForceLogin;
@@ -53,12 +53,13 @@
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for import, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] mnuImport = new MenuItem[5];
+		MenuItem[] mnuImport = new MenuItem[6];
 		mnuImport[0] = loadcaches  = new MenuItem(MyLocale.getMsg(129,"Import GPX")); //TODO internationalization
 		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download von opencaching.de")); 
 		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider von geocaching.com")); 
-		mnuImport[3] = mnuSeparator = new MenuItem("-"); 
-		mnuImport[4] = mnuForceLogin      = new MenuItem("Always login to GC"); 
+		mnuImport[3] = update      = new MenuItem(MyLocale.getMsg(1014,"Update cache data"));
+		mnuImport[4] = mnuSeparator = new MenuItem("-"); 
+		mnuImport[5] = mnuForceLogin      = new MenuItem("Always login to GC"); 
 		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175,"Import"));
 		if (Global.getPref().forceLogin) mnuForceLogin.modifiers^=MenuItem.Checked;
 
@@ -122,35 +123,37 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Filter" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] filterMenuItems=new MenuItem[10];
+		MenuItem[] filterMenuItems=new MenuItem[11];
 		filterMenuItems[0] = filtApply  = new MenuItem(MyLocale.getMsg(709,"Apply")); 
 		filterMenuItems[1] = filtCreate  = new MenuItem(MyLocale.getMsg(114,"Create")); 
 		filterMenuItems[2] = filtInvert  = new MenuItem(MyLocale.getMsg(115,"Invert")); 
 		filterMenuItems[3] = filtClear   = new MenuItem(MyLocale.getMsg(116,"Clear"));
 		filterMenuItems[4] = mnuSeparator;
 		filterMenuItems[5] = filtSelected = new MenuItem(MyLocale.getMsg(160,"Filter selected"));
-		filterMenuItems[6] = mnuSeparator;
-		filterMenuItems[7] = filtBlack   = new MenuItem(MyLocale.getMsg(161,"Show Blacklist"));
-		filterMenuItems[8] = mnuSeparator;
-		filterMenuItems[9] = filtCacheTour = new MenuItem(MyLocale.getMsg(198,"Cachetour"));
+		filterMenuItems[6] = filtNonSelected = new MenuItem(MyLocale.getMsg(1011,"Filter out non selected"));
+		filterMenuItems[7] = mnuSeparator;
+		filterMenuItems[8] = filtBlack   = new MenuItem(MyLocale.getMsg(161,"Show Blacklist"));
+		filterMenuItems[9] = mnuSeparator;
+		filterMenuItems[10] = filtCacheTour = new MenuItem(MyLocale.getMsg(198,"Cachetour"));
 
 		///////////////////////////////////////////////////////////////////////
 		// Create a combined "Filter and Search" pulldown menu for devices with small screens
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] filterAndSearchMenuItems=new MenuItem[13];
+		MenuItem[] filterAndSearchMenuItems=new MenuItem[14];
 		filterAndSearchMenuItems[0]=filtApply;
 		filterAndSearchMenuItems[1]=filtCreate;
 		filterAndSearchMenuItems[2]=filtInvert;
 		filterAndSearchMenuItems[3]=filtClear;
 		filterAndSearchMenuItems[4]=mnuSeparator;
 		filterAndSearchMenuItems[5]=filtSelected;
-		filterAndSearchMenuItems[6]=mnuSeparator;
-		filterAndSearchMenuItems[7]=filtBlack;
-		filterAndSearchMenuItems[8]=mnuSeparator;
-		filterAndSearchMenuItems[9]=search;
-		filterAndSearchMenuItems[10]=searchClr;
-		filterAndSearchMenuItems[11] = mnuSeparator;
-		filterAndSearchMenuItems[12] = filtCacheTour;
+		filterAndSearchMenuItems[6]=filtNonSelected;
+		filterAndSearchMenuItems[7]=mnuSeparator;
+		filterAndSearchMenuItems[8]=filtBlack;
+		filterAndSearchMenuItems[9]=mnuSeparator;
+		filterAndSearchMenuItems[10]=search;
+		filterAndSearchMenuItems[11]=searchClr;
+		filterAndSearchMenuItems[12] = mnuSeparator;
+		filterAndSearchMenuItems[13] = filtCacheTour;
 
 		// Depending on screen width display either filter and searach menus or the combined menu 
 		if (MyLocale.getScreenWidth()>300) {
@@ -314,6 +317,8 @@
 				filtBlack.modifiers&=~MenuItem.Checked;
 				tbp.resetModel();
 			}
+			if (mev.selectedItem == update) 
+				updateSelectedCaches();
 			if(mev.selectedItem == mnuForceLogin) {
 				mnuForceLogin.modifiers^=MenuItem.Checked;
 				Global.getPref().forceLogin=(mnuForceLogin.modifiers&MenuItem.Checked)!=0;
@@ -504,6 +509,16 @@
 				}
 				tbp.refreshTable();
 			}
+			if (mev.selectedItem == filtNonSelected){
+				CacheHolder ch;
+				for(int i = cacheDB.size()-1; i >=0; i--){
+					ch = (CacheHolder)cacheDB.get(i);
+					// incremental filter. Keeps status of all marked caches and
+					// adds unmarked caches to filtered list
+					ch.is_filtered = !ch.is_Checked || ch.is_filtered;
+				}
+				tbp.refreshTable();
+			}
 			if(mev.selectedItem == filtBlack){
 				filtBlack.modifiers^=MenuItem.Checked;
 				Filter.showBlacklisted=!Filter.showBlacklisted;
@@ -598,4 +613,75 @@
 		}
 	}
 
+	private void updateSelectedCaches() {
+		Preferences pref=Global.getPref();
+		Profile profile=Global.getProfile();
+		Vector cacheDB=profile.cacheDB;
+		CacheHolder ch;
+		
+		SpiderGC spider = new SpiderGC(pref, profile, false);
+		OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
+		//Vm.debug("ByPass? " + profile.byPassIndexActive);
+		Vm.showWait(true);
+		boolean alreadySaid = false;
+		boolean alreadySaid2 = false;
+		boolean test = true;
+		InfoBox infB = new InfoBox("Info", "Loading", InfoBox.PROGRESS_WITH_WARNINGS);
+		infB.exec();
+		
+		Vector cachesToUpdate = new Vector();
+		for(int i = 0; i <	cacheDB.size(); i++){
+			ch = (CacheHolder)cacheDB.get(i);
+			if(ch.is_Checked == true && !ch.is_filtered) {
+				if ( ch.wayPoint.length()>1 && (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC") 
+						|| ch.wayPoint.substring(0,2).equalsIgnoreCase("OC")))
+//					if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
+//					Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
+//					Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
+//					TODO: Diese Meldungen vor dem Einloggen darstellen						
+				{
+					cachesToUpdate.add(new Integer(i));
+				} else {
+					if (ch.isAddiWpt() && ch.mainCache!=null && !ch.mainCache.is_Checked && !alreadySaid2) { // Is the father ticked?
+						alreadySaid2=true;
+						(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).execute();
+					}
+					if (!ch.isAddiWpt() && !alreadySaid) {
+						alreadySaid = true;
+						(new MessageBox("Information",ch.wayPoint+ ": Diese Funktion steht gegenw?rtig nur f?r Geocaching.com und Opencaching.de zur Verf?gung", MessageBox.OKB)).execute();
+					}
+				}
+
+			}
+		}
+
+		for(int j = 0; j <	cachesToUpdate.size(); j++){
+			int i = ((Integer)cachesToUpdate.get(j)).intValue();
+			ch = (CacheHolder)cacheDB.get(i);
+			infB.setInfo("Loading: " + ch.wayPoint);
+			infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + ch.wayPoint +" (" + (j+1) + " / " + cachesToUpdate.size() + ")");
+			infB.redisplay();
+			if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))   
+				test = spider.spiderSingle(i, infB);
+			else  
+				test = ocSync.syncSingle(i, infB);
+			if (!test) {
+				infB.close(0);
+				break;
+			} else 
+				profile.hasUnsavedChanges=true;	
+
+//			cacheDB.clear();
+//			profile.readIndex();
+		}
+		infB.close(0);
+//		profile.hasUnsavedChanges=true;	
+		profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
+		profile.restoreFilter();
+		profile.updateBearingDistance();
+		tbp.refreshTable();
+		Vm.showWait(false);
+		
+	}
+	
 }

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-02-24 20:00:25 UTC (rev 1220)
+++ trunk/src/CacheWolf/myTableControl.java	2008-02-24 20:40:59 UTC (rev 1221)
@@ -24,9 +24,7 @@
 			MyLocale.getMsg(1020,"Open in $browser online"),
 			MyLocale.getMsg(1018,"Open in browser offline"),
 			"-",
-			MyLocale.getMsg(1011,"Filter"),
-			MyLocale.getMsg(1012,"Delete"),
-			MyLocale.getMsg(1014,"Update"),
+			MyLocale.getMsg(1012,"Delete selected"),
 			"-",
 			MyLocale.getMsg(1015,"Select all"),
 			MyLocale.getMsg(1016,"De-select all")},
@@ -114,15 +112,6 @@
 			setSelectForAll(false);
 		}
 
-		if (selectedItem.toString().equals(MyLocale.getMsg(1011,"Filter"))){
-			for(int i = cacheDB.size()-1; i >=0; i--){
-				ch = (CacheHolder)cacheDB.get(i);
-				// incremental filter. Keeps status of all marked caches and
-				// adds unmarked caches to filtered list
-				ch.is_filtered = !ch.is_Checked || ch.is_filtered;
-			}
-			tbp.refreshTable();
-		}
 		if (selectedItem.toString().equals(MyLocale.getMsg(1012,"Delete"))){
 			Vm.showWait(true);
 			// Count # of caches to delete
@@ -159,70 +148,6 @@
 			Vm.showWait(false);
 		}
 
-		if (selectedItem.toString().equals(MyLocale.getMsg(1014,"Update"))){
-			SpiderGC spider = new SpiderGC(pref, profile, false);
-			OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
-			//Vm.debug("ByPass? " + profile.byPassIndexActive);
-			Vm.showWait(true);
-			boolean alreadySaid = false;
-			boolean alreadySaid2 = false;
-			boolean test = true;
-			InfoBox infB = new InfoBox("Info", "Loading", InfoBox.PROGRESS_WITH_WARNINGS);
-			infB.exec();
-			
-			Vector cachesToUpdate = new Vector();
-			for(int i = 0; i <	cacheDB.size(); i++){
-				ch = (CacheHolder)cacheDB.get(i);
-				if(ch.is_Checked == true && !ch.is_filtered) {
-					if ( ch.wayPoint.length()>1 && (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC") 
-							|| ch.wayPoint.substring(0,2).equalsIgnoreCase("OC")))
-//						if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
-//						Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
-//						Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
-//						TODO: Diese Meldungen vor dem Einloggen darstellen						
-					{
-						cachesToUpdate.add(new Integer(i));
-					} else {
-						if (ch.isAddiWpt() && ch.mainCache!=null && !ch.mainCache.is_Checked && !alreadySaid2) { // Is the father ticked?
-							alreadySaid2=true;
-							(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).execute();
-						}
-						if (!ch.isAddiWpt() && !alreadySaid) {
-							alreadySaid = true;
-							(new MessageBox("Information",ch.wayPoint+ ": Diese Funktion steht gegenw?rtig nur f?r Geocaching.com und Opencaching.de zur Verf?gung", MessageBox.OKB)).execute();
-						}
-					}
-
-				}
-			}
-
-			for(int j = 0; j <	cachesToUpdate.size(); j++){
-				int i = ((Integer)cachesToUpdate.get(j)).intValue();
-				ch = (CacheHolder)cacheDB.get(i);
-				infB.setInfo("Loading: " + ch.wayPoint);
-				infB.setInfo(MyLocale.getMsg(5513,"Loading: ") + ch.wayPoint +" (" + (j+1) + " / " + cachesToUpdate.size() + ")");
-				infB.redisplay();
-				if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))   
-					test = spider.spiderSingle(i, infB);
-				else  
-					test = ocSync.syncSingle(i, infB);
-				if (!test) {
-					infB.close(0);
-					break;
-				} else 
-					profile.hasUnsavedChanges=true;	
-
-//				cacheDB.clear();
-//				profile.readIndex();
-			}
-			infB.close(0);
-//			profile.hasUnsavedChanges=true;	
-			profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
-			profile.restoreFilter();
-			profile.updateBearingDistance();
-			tbp.refreshTable();
-			Vm.showWait(false);
-		}
 		if (selectedItem.toString().equals(MyLocale.getMsg(1019,"Centre"))){
 			CacheHolder thisCache = (CacheHolder)cacheDB.get(tbp.getSelectedCache());
 			CWPoint cp=new CWPoint(thisCache.LatLon);



From salzkammergut at mail.berlios.de  Tue Feb 26 22:01:00 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 26 Feb 2008 22:01:00 +0100
Subject: [Cachewolf-svn] r1222 - in trunk: res_noewe resources src/CacheWolf
	src/CacheWolf/navi
Message-ID: <200802262101.m1QL100x004875@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-26 22:00:52 +0100 (Tue, 26 Feb 2008)
New Revision: 1222

Added:
   trunk/res_noewe/1858.gif
   trunk/resources/1858.png
Modified:
   trunk/src/CacheWolf/CacheList.java
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/RadarPanel.java
   trunk/src/CacheWolf/myInteractivePanel.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/myTableModel.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
Added new CacheType: WherIGo. Also tidied up to move the determination of the cache picture to CacheType. This makes it easier to extend in the future.


Added: trunk/res_noewe/1858.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/1858.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/1858.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/1858.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2008-02-24 20:40:59 UTC (rev 1221)
+++ trunk/src/CacheWolf/CacheList.java	2008-02-26 21:00:52 UTC (rev 1222)
@@ -91,7 +91,7 @@
 				 CacheHolder ch=(CacheHolder)cacheList.get(idx);
 				 wayPoint=ch.wayPoint;
 				 IconAndText imgDrag=new IconAndText();
-				 imgDrag.addColumn((IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)]);
+				 imgDrag.addColumn((IImage) CacheType.cache2Img(ch.type));
 				 imgDrag.addColumn(ch.wayPoint);
 				 dc.dragData=dc.startImageDrag(imgDrag,new Point(8,8),this);
 			 } 
@@ -326,7 +326,7 @@
 			// Add cache reference to hidden list
 			cacheList.add(ch);
 			// Add Cache and cache icon to visible list
-			lstCaches.addItem((new MenuItem()).iconize(ch.wayPoint+"   "+ch.CacheName,(IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)],true));
+			lstCaches.addItem((new MenuItem()).iconize(ch.wayPoint+"   "+ch.CacheName,(IImage) CacheType.cache2Img(ch.type),true));
 		    dirty=true;
 			return true;
 		} else

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2008-02-24 20:40:59 UTC (rev 1221)
+++ trunk/src/CacheWolf/CacheType.java	2008-02-26 21:00:52 UTC (rev 1222)
@@ -3,6 +3,9 @@
  */
 package CacheWolf;
 
+import ewe.fx.IImage;
+import ewe.fx.Image;
+import ewe.sys.Convert;
 import ewe.sys.Vm;
 
 
@@ -28,6 +31,38 @@
 */
 
 public class CacheType {
+	public static Image cacheImages[] = new Image[454]; // Images are used by TableControl
+	public static int WHERIGO=200; // The cache we mapped the wherigo to
+	static {
+		cacheImages[0] = new Image("0.png");
+		//cacheImages[1] = new Image();
+		cacheImages[2] = new Image("2.png");
+		cacheImages[3] = new Image("3.png");
+		cacheImages[4] = new Image("4.png");
+		cacheImages[5] = new Image("5.png");
+		cacheImages[6] = new Image("6.png");
+		cacheImages[8] = new Image("8.png");
+		//cacheImages[9] = new Image();
+		//cacheImages[10] = new Image();
+		cacheImages[11] = new Image("11.png");
+		cacheImages[12] = new Image("12.png");
+		cacheImages[13] = new Image("13.png");
+		//additional waypoints, begin with 50
+		cacheImages[50] = new Image("pkg.png");
+		cacheImages[51] = new Image("stage.png");
+		cacheImages[52] = new Image("puzzle.png");
+		cacheImages[53] = new Image("flag.png");
+		cacheImages[54] = new Image("trailhead.png");
+		cacheImages[55] = new Image("waypoint.png");
+
+		cacheImages[108] = new Image("108.png");
+		cacheImages[109] = new Image("109.png");
+		cacheImages[110] = new Image("110.png");
+		cacheImages[137] = new Image("137.png");
+		cacheImages[WHERIGO] = new Image("1858.png");  // Fudge as whereigo is really 1858
+		cacheImages[453] = new Image("453.png");
+	}
+
 	//Types from gc.com
 	static protected final int GC_TRADITIONAL = 2;
 	static protected final int GC_MULTI = 3;
@@ -76,6 +111,7 @@
 	static protected final int CW_CITO = 13;
 	static protected final int CW_EARTH = 137;
 	static protected final int CW_MEGA_EVENT = 453;
+	static protected final int CW_WHERIGO = 1858;
 	static protected final int CW_PARKING = 50;
 	static protected final int CW_STAGE_OF_MULTI = 51;
 	static protected final int CW_QUESTION = 52;
@@ -105,6 +141,7 @@
 	static protected final String CW_PIC_CITO = "13.png";
 	static protected final String CW_PIC_EARTH = "137.png";
 	static protected final String CW_PIC_MEGA_EVENT = "453.png";
+	static protected final String CW_PIC_WHERIGO = "1858.png";
 	static protected final String CW_PIC_PARKING = "pkg.png";
 	static protected final String CW_PIC_STAGE_OF_MULTI = "stage.png";
 	static protected final String CW_PIC_QUESTION = "puzzle.png";
@@ -127,7 +164,7 @@
 			{"CITO","13"},{"Earthcache","137"},
 			{"Parking","50"},{"Stage","51"},
 			{"Question","52"},{"Final","53"},
-			{"Trailhead","54"},{"Reference","55"}};
+			{"Trailhead","54"},{"Reference","55"},{"WhereIGo","1858"}};
 
 	public static String transType(String geoNum){
 		String geo = new String("Unknown");
@@ -142,6 +179,7 @@
 		if(geoNum.equals("13")) geo = "Cache In Trash Out Event";
 		if(geoNum.equals("137")) geo = "Earthcache";
 		if(geoNum.equals("453")) geo = "Mega Event Cache";
+		if(geoNum.equals("1858")) geo = "WhereIGo Cache";
 		if(geoNum.equals("50")) geo = "Parking Area";
 		if(geoNum.equals("51")) geo = "Stages of a Multicache";
 		if(geoNum.equals("52")) geo = "Question to Answer";
@@ -172,6 +210,7 @@
 			case CW_CITO:			return CW_PIC_CITO;
 			case CW_EARTH:			return CW_PIC_EARTH;
 			case CW_MEGA_EVENT:		return CW_PIC_MEGA_EVENT;
+			case CW_WHERIGO:	    return CW_PIC_WHERIGO;
 			case CW_PARKING:		return CW_PIC_PARKING;
 			case CW_STAGE_OF_MULTI:	return CW_PIC_STAGE_OF_MULTI;
 			case CW_QUESTION:		return CW_PIC_QUESTION;
@@ -204,6 +243,7 @@
 		if (typeText.equals("Cache In Trash Out Event")) return "13";
 		if (typeText.equals("Earthcache") || typeText.equals("Earth")) return "137";
 		if (typeText.equals("Mega-Event Cache")) return "453";
+		if (typeText.equals("Wherigo Cache")) return "1858";
 		if (typeText.equals("Waypoint|Parking Area")) return "50";
 		if (typeText.equals("Waypoint|Stages of a Multicache")) return "51";
 		if (typeText.equals("Waypoint|Question to Answer")) return "52";
@@ -246,7 +286,14 @@
 			//no match found? return custom type!
 			return "0";
 		}
-	
-	
 
+		
+	public static Image cache2Img(String cacheType) {
+		int ct=Convert.parseInt(cacheType);
+		if (ct==1858)
+			return cacheImages[WHERIGO];
+		else	
+			return cacheImages[ct]; // TODO save in cacheholder as int
+	}
+
 }

Modified: trunk/src/CacheWolf/RadarPanel.java
===================================================================
--- trunk/src/CacheWolf/RadarPanel.java	2008-02-24 20:40:59 UTC (rev 1221)
+++ trunk/src/CacheWolf/RadarPanel.java	2008-02-26 21:00:52 UTC (rev 1222)
@@ -134,9 +134,9 @@
 							iActP.addImage(aImg);
 						}
 					}
-					Image imgCache=myTableModel.cacheImages[Convert.parseInt(holder.type)];
+					Image imgCache=CacheType.cache2Img(holder.type);
 					// If we have no image for the cache type use a question mark
-					if (imgCache==null) imgCache=myTableModel.cacheImages[8]; 
+					if (imgCache==null) imgCache=CacheType.cacheImages[8]; 
 					rpi = new RadarPanelImage(imgCache);
 					rpi.wayPoint = holder.wayPoint;
 					rpi.rownum = i;

Modified: trunk/src/CacheWolf/myInteractivePanel.java
===================================================================
--- trunk/src/CacheWolf/myInteractivePanel.java	2008-02-24 20:40:59 UTC (rev 1221)
+++ trunk/src/CacheWolf/myInteractivePanel.java	2008-02-26 21:00:52 UTC (rev 1222)
@@ -109,7 +109,7 @@
 			 //wayPoint=ch.wayPoint;
 			 //Vm.debug("Waypoint : "+ch.wayPoint);
 			 IconAndText icnDrag=new IconAndText();
-			 icnDrag.addColumn((IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)]);
+			 icnDrag.addColumn((IImage) CacheType.cache2Img(ch.type));
 			 icnDrag.addColumn(ch.wayPoint);
 			 dc.dragData=dc.startImageDrag(icnDrag,new Point(8,8),this);
 			 //if (dc instanceof ImageDragContext) Vm.debug(">>>>Is Image drag");

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-02-24 20:40:59 UTC (rev 1221)
+++ trunk/src/CacheWolf/myTableControl.java	2008-02-26 21:00:52 UTC (rev 1222)
@@ -219,7 +219,7 @@
 			 wayPoint=ch.wayPoint;
 			 //Vm.debug("Waypoint : "+ch.wayPoint);
 			 imgDrag=new IconAndText();
-			 imgDrag.addColumn((IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)]);
+			 imgDrag.addColumn((IImage) CacheType.cache2Img(ch.type));
 			 imgDrag.addColumn(ch.wayPoint);
 			 dc.dragData=dc.startImageDrag(imgDrag,new Point(8,8),this);
 		 } else super.startDragging(dc);

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2008-02-24 20:40:59 UTC (rev 1221)
+++ trunk/src/CacheWolf/myTableModel.java	2008-02-26 21:00:52 UTC (rev 1222)
@@ -42,7 +42,6 @@
 			MyLocale.getMsg(1008,"Dist"),MyLocale.getMsg(1009,"Bear"),MyLocale.getMsg(1017,"S"),
 			MyLocale.getMsg(1026,"#Rec"),MyLocale.getMsg(1027,"OC-IDX")};
 	
-	public static Image cacheImages[] = new Image[454]; // Images are used by TableControl
 	private static Image noFindLogs[] = new Image[4];
 	private mImage red, blue, yellow, skull; // green
 	private Image checkboxTicked,checkboxUnticked;
@@ -68,32 +67,6 @@
 		this.numRows = cacheDB.size();
 		//Dimension selrow = new Dimension(-1,1);
 		//this.cursorSize = selrow;
-		cacheImages[0] = new Image("0.png");
-		//cacheImages[1] = new Image();
-		cacheImages[2] = new Image("2.png");
-		cacheImages[3] = new Image("3.png");
-		cacheImages[4] = new Image("4.png");
-		cacheImages[5] = new Image("5.png");
-		cacheImages[6] = new Image("6.png");
-		cacheImages[8] = new Image("8.png");
-		//cacheImages[9] = new Image();
-		//cacheImages[10] = new Image();
-		cacheImages[11] = new Image("11.png");
-		cacheImages[12] = new Image("12.png");
-		cacheImages[13] = new Image("13.png");
-		//additional waypoints, begin with 50
-		cacheImages[50] = new Image("pkg.png");
-		cacheImages[51] = new Image("stage.png");
-		cacheImages[52] = new Image("puzzle.png");
-		cacheImages[53] = new Image("flag.png");
-		cacheImages[54] = new Image("trailhead.png");
-		cacheImages[55] = new Image("waypoint.png");
-
-		cacheImages[108] = new Image("108.png");
-		cacheImages[109] = new Image("109.png");
-		cacheImages[110] = new Image("110.png");
-		cacheImages[137] = new Image("137.png");
-		cacheImages[453] = new Image("453.png");
 		noFindLogs[0] = new Image("no_1_log.png");
 		noFindLogs[1] = new Image("no_2_log.png");
 		noFindLogs[2] = new Image("no_3_log.png");
@@ -248,9 +221,7 @@
 						else 
 							return checkboxUnticked;
 					case 1: // Type
-						try {
-							return (IImage) cacheImages[Convert.parseInt(ch.type)]; // TODO save in cacheholder as int
-						} catch (NumberFormatException e) { return "?";}
+						return (IImage) CacheType.cache2Img(ch.type);
 					case 2: // Difficulty;
 						return ch.hard;
 					case 3: // Terrain

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2008-02-24 20:40:59 UTC (rev 1221)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2008-02-26 21:00:52 UTC (rev 1222)
@@ -2,6 +2,7 @@
 
 import CacheWolf.CWPoint;
 import CacheWolf.CacheHolder;
+import CacheWolf.CacheType;
 import CacheWolf.Global;
 import CacheWolf.InfoBox;
 import CacheWolf.MainTab;
@@ -300,8 +301,7 @@
 			for (int i=cacheDB.size()-1; i>=0; i--) {
 				ch = (CacheHolder) cacheDB.get(i);
 				if (ch.is_Checked && !ch.is_filtered && ch != mainT.ch) {
-					int ct = Convert.parseInt(ch.type);
-					if (ch.pos.isValid()) addSymbol(ch.CacheName, ch, myTableModel.cacheImages[ct], ch.pos);
+					if (ch.pos.isValid()) addSymbol(ch.CacheName, ch, CacheType.cache2Img(ch.type), ch.pos);
 				}
 			}
 		}
@@ -323,8 +323,7 @@
 		}
 		if (ch != null) {
 			addSymbol("selectedCache", MARK_CACHE_IMAGE, ch.pos);
-			int ct = Convert.parseInt(ch.type);
-			addSymbolIfNecessary(ch.CacheName, ch, myTableModel.cacheImages[ct], ch.pos);
+			addSymbolIfNecessary(ch.CacheName, ch, CacheType.cache2Img(ch.type), ch.pos);
 		}
 		markedCache = ch;
 	}



From salzkammergut at mail.berlios.de  Wed Feb 27 20:45:45 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 27 Feb 2008 20:45:45 +0100
Subject: [Cachewolf-svn] r1223 - trunk/src/CacheWolf
Message-ID: <200802271945.m1RJjjVD008344@sheep.berlios.de>

Author: salzkammergut
Date: 2008-02-27 20:45:40 +0100 (Wed, 27 Feb 2008)
New Revision: 1223

Modified:
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/FilterScreen.java
   trunk/src/CacheWolf/Profile.java
Log:
Added WherIGo cache to filter

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2008-02-26 21:00:52 UTC (rev 1222)
+++ trunk/src/CacheWolf/Filter.java	2008-02-27 19:45:40 UTC (rev 1223)
@@ -45,8 +45,9 @@
 	private static final int TRAILHEAD = 32768;
 	private static final int REFERENCE = 65536;
 	private static final int CITO = 131072;
+	private static final int WHERIGO = 262144;
 	private static final int TYPE_ALL=TRADITIONAL|MULTI|VIRTUAL|LETTER|EVENT|WEBCAM|MYSTERY|LOCLESS|CUSTOM
-	                                  |MEGA|EARTH|PARKING|STAGE|QUESTION|FINAL|TRAILHEAD|REFERENCE|CITO;
+	                                  |MEGA|EARTH|PARKING|STAGE|QUESTION|FINAL|TRAILHEAD|REFERENCE|CITO|WHERIGO;
 
 	private static final int N = 1;
 	private static final int NNE = 2;
@@ -276,6 +277,7 @@
 		if (filterType.charAt(15) == '1') typeMatchPattern|=TRAILHEAD;
 		if (filterType.charAt(16) == '1') typeMatchPattern|=REFERENCE;
 		if (filterType.charAt(17) == '1') typeMatchPattern|=CITO;
+		if (filterType.charAt(18) == '1') typeMatchPattern|=WHERIGO;
 		hasTypeMatchPattern= typeMatchPattern!=TYPE_ALL;
 		roseMatchPattern=0;
 		String filterRose=profile.filterRose;
@@ -370,6 +372,7 @@
 				else if(ch.type.equals("54"))cacheTypePattern = TRAILHEAD;
 				else if(ch.type.equals("55"))cacheTypePattern = REFERENCE;
 				else if(ch.type.equals("13"))cacheTypePattern = CITO;
+				else if(ch.type.equals("1858"))cacheTypePattern = WHERIGO;
 				if ((cacheTypePattern & typeMatchPattern) == 0) { ch.is_filtered=true; continue; }
 			}			
 			///////////////////////////////

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2008-02-26 21:00:52 UTC (rev 1222)
+++ trunk/src/CacheWolf/FilterScreen.java	2008-02-27 19:45:40 UTC (rev 1223)
@@ -26,7 +26,7 @@
 					  chkMicro,chkSmall,chkRegular,chkLarge,chkVeryLarge,chkOther,chkCito,
 	                  chkArchived,chkNotArchived, chkAvailable,chkNotAvailable,
 					  chkNW, chkNNW , chkN , chkNNE, chkNE, chkENE, chkE, chkESE, chkSE, chkSSE, chkS,
-					  chkSSW, chkSW, chkWSW, chkW, chkWNW;
+					  chkSSW, chkSW, chkWSW, chkW, chkWNW,chkWherigo;
 	
 	private mInput inpDist, inpTerr, inpDiff;
 
@@ -201,6 +201,9 @@
 		pnlCacheTypes.addNext(addImg("0.png"));
 		pnlCacheTypes.addLast(chkCustom = new mCheckBox("Custom"), CellConstants.DONTSTRETCH, CellConstants.FILL);
 
+		pnlCacheTypes.addNext(addImg("1858.png"));
+		pnlCacheTypes.addNext(chkWherigo = new myChkBox("WherIGo"), CellConstants.DONTSTRETCH, CellConstants.FILL);
+
 		pnlCacheTypes.addNext(addImg("110.png"));
 		pnlCacheTypes.addNext(addiWptChk = new myChkBox("Add. Wpt"), CellConstants.DONTSTRETCH, CellConstants.FILL);
 
@@ -245,7 +248,7 @@
 		// Panel 8 - Cache attributes
 		//////////////////////////
 		
-		addTitle(pnlCacheAttributes,MyLocale.getMsg(737,"Attributes"));
+		if (MyLocale.getScreenHeight()>240) addTitle(pnlCacheAttributes,MyLocale.getMsg(737,"Attributes"));
 		pnlCacheAttributes.addNext(new mLabel(MyLocale.getMsg(739,"Filter on")+":"), CellConstants.DONTSTRETCH, CellConstants.FILL);
 		pnlCacheAttributes.addLast(chcAttrib = new mChoice(new String[]{MyLocale.getMsg(740,"all"), MyLocale.getMsg(741,"one"), MyLocale.getMsg(742,"none")},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 
@@ -390,6 +393,7 @@
 		chkMega.state       = fltType.charAt(9) == '1';
 		chkCustom.state     = fltType.charAt(10) == '1';
 		chkCito.state       = fltType.charAt(17) == '1';
+		chkWherigo.state    = fltType.charAt(18) == '1';
 		
 		// Note addiWptState is set by setColors
 		
@@ -491,7 +495,7 @@
 		chkFinal.state && chkTrailhead.state && chkReference.state) ;
 		if (!(chkTrad.state && chkMulti.state && 	chkVirtual.state && chkLetter.state &&
 		      chkEvent.state && chkWebcam.state && chkMystery.state && chkEarth.state &&
-		      chkLocless.state && chkMega.state && chkCito.state && chkCustom.state && allAddis) ) 
+		      chkLocless.state && chkMega.state && chkCito.state && chkWherigo.state && chkCustom.state && allAddis) ) 
 			btnTypes.backGround=COLOR_FILTERACTIVE;
 		else
 			btnTypes.backGround=COLOR_FILTERINACTIVE;
@@ -499,7 +503,7 @@
 			      chkEvent.state || chkWebcam.state || chkMystery.state || chkEarth.state ||
 			      chkLocless.state || chkMega.state || chkCustom.state || chkParking.state 
 			      || chkStage.state || chkQuestion.state || 
-					chkFinal.state || chkTrailhead.state || chkCito.state || chkReference.state )) 
+					chkFinal.state || chkTrailhead.state || chkCito.state || chkWherigo.state || chkReference.state )) 
 			btnTypes.backGround=COLOR_FILTERALL;
 		btnTypes.repaint();
 
@@ -582,8 +586,8 @@
 								(chkFinal.state   ? "1" : "0") +
 								(chkTrailhead.state ? "1" : "0") +
 								(chkReference.state ? "1" : "0")+
-								(chkCito.state ? "1" : "0");
-				
+								(chkCito.state ? "1" : "0")+
+								(chkWherigo.state ? "1" : "0");
 				pfl.filterRose = (chkNW.state  ? "1":"0")+
 							 (chkNNW.state ? "1":"0")+
 							 (chkN.state   ? "1":"0")+

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2008-02-26 21:00:52 UTC (rev 1222)
+++ trunk/src/CacheWolf/Profile.java	2008-02-27 19:45:40 UTC (rev 1223)
@@ -45,7 +45,7 @@
 
 	// When extending the filter check "normaliseFilters"
 	// which ensures backward compatibility. Normally no change should be needed
-	public final static String FILTERTYPE="111111111111111111";
+	public final static String FILTERTYPE="1111111111111111111";
 	public final static String FILTERROSE="1111111111111111";
 	public final static String FILTERVAR="11111111";
 	public final static String FILTERSIZE="111111";



