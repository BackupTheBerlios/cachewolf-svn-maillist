From salzkammergut at mail.berlios.de  Tue Jan  1 18:54:40 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 1 Jan 2008 18:54:40 +0100
Subject: [Cachewolf-svn] r1161 - trunk/src/CacheWolf
Message-ID: <200801011754.m01Hse7q014982@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-01 18:54:27 +0100 (Tue, 01 Jan 2008)
New Revision: 1161

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
mainTab: Made the green background of the calc icon transparent

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-12-25 16:08:31 UTC (rev 1160)
+++ trunk/src/CacheWolf/MainTab.java	2008-01-01 17:54:27 UTC (rev 1161)
@@ -71,7 +71,8 @@
 		c.iconize(new Image("solver.gif"),true);
 
 		c = this.addCard(calcP, MyLocale.getMsg(1206,"Calc"), null);
-		c.iconize(new Image("ewe/HandHeld.bmp"),true);
+		mImage imgCalc=new mImage("ewe/HandHeld.bmp"); imgCalc.transparentColor=new Color(0,255,0);
+		c.iconize(imgCalc,true);
 
 		nav = new Navigate();
 		c = this.addCard(gotoP = new GotoPanel(nav), "Goto", null);



From salzkammergut at mail.berlios.de  Tue Jan  1 20:18:53 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 1 Jan 2008 20:18:53 +0100
Subject: [Cachewolf-svn] r1162 - trunk/src/CacheWolf
Message-ID: <200801011918.m01JIrQI000243@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-01 20:18:41 +0100 (Tue, 01 Jan 2008)
New Revision: 1162

Modified:
   trunk/src/CacheWolf/RadarPanel.java
   trunk/src/CacheWolf/myInteractivePanel.java
Log:
RadarPanel: The default font size as set in the preferences is now also used in the RadarPanel.
See http://www.geoclub.de/ftopic21124.html

Modified: trunk/src/CacheWolf/RadarPanel.java
===================================================================
--- trunk/src/CacheWolf/RadarPanel.java	2008-01-01 17:54:27 UTC (rev 1161)
+++ trunk/src/CacheWolf/RadarPanel.java	2008-01-01 19:18:41 UTC (rev 1162)
@@ -97,8 +97,8 @@
 	* Private method to draw the caches.
 	*/
 	private void drawCaches(){
-		Font font = new Font("Verdana", Font.BOLD, 10);
-		FontMetrics fm = getFontMetrics();
+		Font font = new Font("Gui", Font.BOLD,Global.getPref().fontSize);
+		FontMetrics fm = getFontMetrics(font);
 		AniImage aImg;
 		RadarPanelImage rpi;
 		int x,y = 0;
@@ -122,6 +122,7 @@
 							int tw;
 							Image img = new Image(tw=fm.getTextWidth(s),fm.getHeight());
 							Graphics g = new Graphics(img);
+							g.setFont(font);
 							g.setColor(Color.Black);
 							g.fillRect(0,0,tw, fm.getHeight());
 							g.setColor(Color.White);

Modified: trunk/src/CacheWolf/myInteractivePanel.java
===================================================================
--- trunk/src/CacheWolf/myInteractivePanel.java	2008-01-01 17:54:27 UTC (rev 1161)
+++ trunk/src/CacheWolf/myInteractivePanel.java	2008-01-01 19:18:41 UTC (rev 1162)
@@ -17,8 +17,8 @@
 	boolean penMoving = false;
 	int x1,y1,x2,y2 = 0;
 	static Color RED = new Color(255,0,0);
-	Font font = new Font("gui", Font.BOLD, 10);
-	FontMetrics fm = getFontMetrics();
+	Font font = new Font("gui", Font.BOLD,Global.getPref().fontSize);
+	FontMetrics fm = getFontMetrics(font);
 	long timePenOn=0;
 	AniImage imgInfo;
 	String strDifficulty=MyLocale.getMsg(1120,"Diff");
@@ -65,6 +65,7 @@
 		int h=fm.getHeight();
 		Image img = new Image(tw,h+h);
 		Graphics g = new Graphics(img);
+		g.setFont(font);
 		g.setColor(new Color(0,0,255));
 		g.fillRect(0,0,tw, h+h);
 		g.setColor(Color.White);
@@ -111,7 +112,7 @@
 			 icnDrag.addColumn((IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)]);
 			 icnDrag.addColumn(ch.wayPoint);
 			 dc.dragData=dc.startImageDrag(icnDrag,new Point(8,8),this);
-			 if (dc instanceof ImageDragContext) Vm.debug(">>>>Is Image drag");
+			 //if (dc instanceof ImageDragContext) Vm.debug(">>>>Is Image drag");
 			 canScroll=false;
 		}
 	 }
@@ -137,6 +138,7 @@
 			int tw,th;
 			Image img = new Image(tw=fm.getTextWidth(wayPoint+15),th=fm.getHeight()>15?fm.getHeight():15);
 			Graphics g = new Graphics(img);
+			g.setFont(font);
 			g.setColor(Color.White);
 			g.fillRect(0,0,tw, th);
 			g.setColor(new Color(255,0,0));



From tweetyhh at mail.berlios.de  Wed Jan  2 20:45:25 2008
From: tweetyhh at mail.berlios.de (tweetyhh at mail.berlios.de)
Date: Wed, 2 Jan 2008 20:45:25 +0100
Subject: [Cachewolf-svn] r1163 - in trunk: res_noewe/languages src/exp
Message-ID: <200801021945.m02JjPB1003897@sheep.berlios.de>

Author: tweetyhh
Date: 2008-01-02 20:45:17 +0100 (Wed, 02 Jan 2008)
New Revision: 1163

Added:
   trunk/src/exp/DistanceComparer.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/src/exp/MagellanExporter.java
Log:
Update Magellan Exporter:
- placed and lastFound fields are now filled with data.
- new "hidden" Feature: If in the Cachewolf directory now are a "magellan.cfg" file the
exporter will read it: "NameOfFile=coordinate"
it then asks for a directory, where to store die exportet Files. For everey line there will be files like
"NameOfFile#.gs" which will contains the caches in order from the coordinate, which should be 
in the normal Format of "N 53? 36.167 E 010? 00.000"


Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-01 19:18:41 UTC (rev 1162)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-02 19:45:17 UTC (rev 1163)
@@ -381,6 +381,11 @@
 		1801=Kacheln herunterladen
 		2000=GPX Export
 		2001=von
+		2100=Magellan Exporter
+		2101=Fehler beim laden der Datei magellan.cfg
+		2102=Zieldatei w?hlen
+		2103=Fehler beim lesen der Datei magellan.cfg
+		2104=Ausgabeverzeichnis f?r die .gs Dateien ausw?hlen
 		2500=Fehler beim Laden oder unkekanntes Attribut
 		2501=Nicht immer zug%e4nglich
 		2502=Immer zug%e4nglich (24/7)

Added: trunk/src/exp/DistanceComparer.java
===================================================================
--- trunk/src/exp/DistanceComparer.java	2008-01-01 19:18:41 UTC (rev 1162)
+++ trunk/src/exp/DistanceComparer.java	2008-01-02 19:45:17 UTC (rev 1163)
@@ -0,0 +1,25 @@
+package exp;
+
+import CacheWolf.CWPoint;
+import CacheWolf.CacheHolder;
+import ewe.util.Comparer;
+
+public class DistanceComparer implements Comparer {
+	
+	CWPoint centre;
+	
+	public DistanceComparer(CWPoint centre) {
+		this.centre = centre;
+	}
+
+	public int compare(Object one, Object two) {
+		if ((! (one instanceof CacheHolder)) && (!(two instanceof CacheHolder))) {
+			return 0;
+		} else {
+			CacheHolder a = (CacheHolder) one;
+			CacheHolder b = (CacheHolder) two;
+			return (int) ((a.pos.getDistance(centre) - b.pos.getDistance(centre)) * 1000);
+		}
+	}
+	
+}


Property changes on: trunk/src/exp/DistanceComparer.java
___________________________________________________________________
Name: svn:mime-type
   + text/x-java
Name: svn:keywords
   + Author Date Id Rev URL
Name: svn:eol-style
   + native

Modified: trunk/src/exp/MagellanExporter.java
===================================================================
--- trunk/src/exp/MagellanExporter.java	2008-01-01 19:18:41 UTC (rev 1162)
+++ trunk/src/exp/MagellanExporter.java	2008-01-02 19:45:17 UTC (rev 1163)
@@ -3,10 +3,15 @@
 import CacheWolf.*;
 import ewe.sys.*;
 import ewe.filechooser.FileChooser;
+import ewe.io.BufferedReader;
 import ewe.io.BufferedWriter;
 import ewe.io.File;
+import ewe.io.FileNotFoundException;
+import ewe.io.FileReader;
 import ewe.io.FileWriter;
+import ewe.io.LineNumberReader;
 import ewe.io.PrintWriter;
+import ewe.io.StringStream;
 import ewe.ui.ProgressBarForm;
 import ewe.util.*;
 import ewe.io.IOException;
@@ -51,10 +56,50 @@
 		expName = expName.substring(expName.indexOf(".") + 1);
 	}
 
+	public void doIt() {
+		File configFile = new File("magellan.cfg");
+		if (configFile.exists()) {
+			FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, pref.getExportPath(expName+"Dir"));
+			fc.setTitle(MyLocale.getMsg(2104, "Choose directory for exporting .gs files"));
+			String targetDir;
+			if(fc.execute() != FileChooser.IDCANCEL){
+				targetDir = fc.getChosen() + "/";
+				pref.setExportPath(expName+"Dir", targetDir);
+
+				CWPoint centre = profile.centre;
+				try {
+					LineNumberReader reader = new LineNumberReader(new BufferedReader(new FileReader(configFile)));
+					String line, fileName, coordinate;
+					while ((line = reader.readLine()) != null)  {
+						StringTokenizer tokenizer = new StringTokenizer(line,"=");
+						fileName = targetDir + tokenizer.nextToken().trim() + ".gs";
+						coordinate = tokenizer.nextToken().trim();
+						CWPoint point = new CWPoint(coordinate);
+						DistanceComparer dc = new DistanceComparer(point);
+						cacheDB.sort(dc, false);
+						doIt(fileName);
+					}
+					reader.close();
+				} catch (FileNotFoundException e) {
+					InfoBox info = new InfoBox(MyLocale.getMsg(2100, "Magellan Exporter"),MyLocale.getMsg(2101, "Failure at loading magellan.cfg\n" + e.getMessage()));
+					info.show();
+				} catch (IOException e) {
+					InfoBox info = new InfoBox(MyLocale.getMsg(2100, "Magellan Exporter"),MyLocale.getMsg(2103, "Failure at reading magellan.cfg\n" + e.getMessage()));
+					info.show();
+				} finally {
+					cacheDB.sort(new DistanceComparer(centre),false);
+				}
+			}
+		}
+		else {
+			doIt(null);
+		}
+	}
+	
 	/**
 	 * Does the most work for exporting data
 	 */
-	public void doIt() {
+	public void doIt(String baseFileName) {
 		File outFile;
 		String fileBaseName;
 		String str = null;
@@ -63,9 +108,13 @@
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
 
-		outFile = getOutputFile();
-		if (outFile == null)
-			return;
+		if (baseFileName == null) {
+			outFile = getOutputFile();
+			if (outFile == null)
+				return;
+		} else {
+			outFile = new File(baseFileName);
+		}
 
 		fileBaseName = outFile.getFullPath();
 		// cut .gs
@@ -137,7 +186,7 @@
 		File file;
 		FileChooser fc = new FileChooser(FileChooser.SAVE, pref
 				.getExportPath(expName));
-		fc.setTitle("Select target file:");
+		fc.setTitle(MyLocale.getMsg(2102, "Select target file:"));
 		fc.addMask(mask);
 		if (fc.execute() != FileChooser.IDCANCEL) {
 			file = fc.getChosenFile();
@@ -156,6 +205,14 @@
 	 * @return formated cache data
 	 */
 	public String record(CacheHolderDetail chD) {
+		/*
+		static protected final int GC_AW_PARKING = 50;
+		static protected final int GC_AW_STAGE_OF_MULTI = 51;
+		static protected final int GC_AW_QUESTION = 52;
+		static protected final int GC_AW_FINAL = 53;
+		static protected final int GC_AW_TRAILHEAD = 54;
+		static protected final int GC_AW_REFERENCE = 55;
+		*/
 		StringBuffer sb = new StringBuffer();
 		sb.append("$PMGNGEO,");
 		sb.append(chD.pos.getLatDeg(CWPoint.DMM));
@@ -166,26 +223,53 @@
 		sb.append(chD.pos.getLonMin(CWPoint.DMM));
 		sb.append(",");
 		sb.append("E,");
-		sb.append("0000,");
-		sb.append("F,"); // or "M" ?
+		sb.append("0000,"); // Height
+		sb.append("M,"); // in meter
 		sb.append(chD.wayPoint);
 		sb.append(",");
-		sb.append(removeCommas(chD.CacheName));
+		String add = "";
+		if (chD.isAddiWpt()) {
+			if (chD.type.equals("50")) {
+				add = "Pa:";
+			} else if (chD.type.equals("51")) {
+				add = "St:";
+			} else if (chD.type.equals("52")) {
+				add = "Qu:"; 
+			} else if (chD.type.equals("53")) {	
+				add = "Fi:";
+			} else if (chD.type.equals("54")) {
+				add = "Tr:";
+			} else if (chD.type.equals("55")) {	
+				add = "Re:";
+			}
+			sb.append(add).append(removeCommas(chD.CacheName));
+		} else {
+			sb.append(removeCommas(chD.CacheName));
+		}		
 		sb.append(",");
 		sb.append(removeCommas(chD.CacheOwner));
 		sb.append(",");
 		sb.append(removeCommas(Common.rot13(chD.Hints)));
 		sb.append(",");
-		// Rewrite Unknown Caches
-		if (!chD.type.equals("8")) {
+		
+		if (!add.equals("")) { // Set Picture in Explorist to Virtual
+			sb.append("Virtual Cache");
+		} else if (!chD.type.equals("8")) { // Rewrite Unknown Caches
 			sb.append(CacheType.transType(chD.type));
 		} else {
 			sb.append("Mystery Cache");
 		}
 		sb.append(",");
-		sb.append(""); // UNKNOWN // Time
+		sb.append(toGsDateFormat(chD.DateHidden));  // created - DDMMYYY, YYY = year - 1900
 		sb.append(",");
-		sb.append(""); // UNKNOWN // TIME
+		String lastFound = "0000";
+		for (int i = 0; i < chD.CacheLogs.size(); i++) {
+			if (chD.CacheLogs.getLog(i).isFoundLog() && chD.CacheLogs.getLog(i).getDate().compareTo(lastFound) > 0 ) {
+				lastFound = chD.CacheLogs.getLog(i).getDate();
+			}
+		}
+		
+		sb.append(toGsDateFormat(lastFound)); // lastFound - DDMMYYY, YYY = year - 1900
 		sb.append(",");
 		sb.append(removeCommas(chD.hard));
 		sb.append(",");
@@ -211,4 +295,19 @@
 	private String removeCommas(String input) {
 		return input.replace(',', '.');
 	}
-}
+	
+	/**
+	 * change the Dateformat from "yyyy-mm-dd" to ddmmyyy, where yyy is years after 1900 
+	 * @param input Date in yyyy-mm-dd
+ 	 * @return Date in ddmmyyy
+	 */
+	private String toGsDateFormat(String input) {
+		if (input.length() >= 10) {
+			return input.substring(8, 10) + input.substring(5, 7) + "1" + input.substring(2, 4);
+		} 
+		else {
+			return "";
+		}
+	}
+	
+}
\ No newline at end of file



From salzkammergut at mail.berlios.de  Thu Jan  3 18:28:38 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 3 Jan 2008 18:28:38 +0100
Subject: [Cachewolf-svn] r1164 - in trunk: res_noewe resources src/CacheWolf
Message-ID: <200801031728.m03HSc2Y016443@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-03 18:28:12 +0100 (Thu, 03 Jan 2008)
New Revision: 1164

Added:
   trunk/res_noewe/11.gif
   trunk/res_noewe/12.gif
   trunk/res_noewe/13.gif
   trunk/res_noewe/2.gif
   trunk/res_noewe/3.gif
   trunk/res_noewe/4.gif
   trunk/res_noewe/5.gif
   trunk/res_noewe/6.gif
   trunk/res_noewe/8.gif
   trunk/res_noewe/g.png
   trunk/res_noewe/g2.png
   trunk/res_noewe/y.png
   trunk/res_noewe/y2.png
Removed:
   trunk/resources/g.png
   trunk/resources/g2.png
   trunk/resources/y.png
   trunk/resources/y2.png
Modified:
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Enabled the context menu "Show cache offline in browser" on all platforms. Copied the necessary files into the "no_ewe" directory. Now even on PDA a HTML representation of the cache can be generated (always in file "temp.html"). This file can then be viewed in Webbrowser (need to press "refresh") and added to "Favourites".
See also: http://www.geoclub.de/ftopic21200.html (Thanks to Kappler for the idea).

Added: trunk/res_noewe/11.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/11.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/12.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/12.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/13.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/13.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/3.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/3.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/4.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/4.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/5.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/5.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/6.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/6.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/8.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/8.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/g.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/g.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/g2.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/g2.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/y.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/y.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/y2.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/y2.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/resources/g.png
===================================================================
(Binary files differ)

Deleted: trunk/resources/g2.png
===================================================================
(Binary files differ)

Deleted: trunk/resources/y.png
===================================================================
(Binary files differ)

Deleted: trunk/resources/y2.png
===================================================================
(Binary files differ)

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2008-01-02 19:45:17 UTC (rev 1163)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2008-01-03 17:28:12 UTC (rev 1164)
@@ -15,7 +15,8 @@
 
 
 public class ShowCacheInBrowser {
-	String saveTo=File.getProgramDirectory()+"/temp.html";
+	String pd=File.getProgramDirectory();
+	String saveTo=pd+"/temp.html";
 	static Hashtable diff=null;
 	static Hashtable terr=null;
 	static Hashtable args=null;
@@ -23,8 +24,8 @@
 	ShowCacheInBrowser() {
 		if (diff==null) {
 			diff=new Hashtable(15);
-			String y="<img src=\"./y.png\" border=0>";
-			String y2="<img src=\"./y2.png\" border=0>";
+			String y="<img src=\"file://" + pd + "/y.png\" border=0>";
+			String y2="<img src=\"file://" + pd + "/y2.png\" border=0>";
 			diff.put("1",y);
 			diff.put("1.5",y+y2);
 			diff.put("2",y+y);
@@ -36,8 +37,8 @@
 			diff.put("5",y+y+y+y+y);
 	
 			terr=new Hashtable(15);
-			String g="<img src=\"./g.png\" border=0>";
-			String g2="<img src=\"./g2.png\" border=0>";
+			String g="<img src=\"file://" + pd + "/g.png\" border=0>";
+			String g2="<img src=\"file://" + pd + "/g2.png\" border=0>";
 			terr.put("1",g);
 			terr.put("1.5",g+g2);
 			terr.put("2",g+g);
@@ -49,7 +50,7 @@
 			terr.put("5",g+g+g+g+g);
 			
 			args = new Hashtable();
-			args.put("filename", File.getProgramDirectory()+"/GCTemplate.html");
+			args.put("filename", pd+"/GCTemplate.html");
 			args.put("case_sensitive", "true");
 			args.put("loop_context_vars", Boolean.TRUE);
 			args.put("max_includes", new Integer(5));
@@ -64,9 +65,9 @@
 				Vm.showWait(true);
 				try {
 					if (chD.wayPoint.startsWith("OC"))
-						tpl.setParam("TYPE", "\"./"+CacheType.transOCType(chD.type)+".gif\"");
+						tpl.setParam("TYPE", "\"file://"+File.getProgramDirectory()+"/"+CacheType.transOCType(chD.type)+".gif\"");
 					else	
-						tpl.setParam("TYPE", "\"./"+chD.type+".gif\"");
+						tpl.setParam("TYPE", "\"file://"+File.getProgramDirectory()+"/"+chD.type+".gif\"");
 					tpl.setParam("SIZE", chD.CacheSize);
 					tpl.setParam("WAYPOINT", chD.wayPoint);
 					tpl.setParam("CACHE_NAME", chD.CacheName);

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-01-02 19:45:17 UTC (rev 1163)
+++ trunk/src/CacheWolf/myTableControl.java	2008-01-03 17:28:12 UTC (rev 1164)
@@ -51,15 +51,15 @@
 	/** Full menu when listview includes checkbox */
 	public void setMenuFull() {
 		setMenu(mFull);
-		if (!Vm.getPlatform().equals("Win32") && !Vm.getPlatform().equals("Java"))
-		   ((MenuItem)mFull.items.get(5)).modifiers|=MenuItem.Disabled;
+//		if (!Vm.getPlatform().equals("Win32") && !Vm.getPlatform().equals("Java"))
+//		   ((MenuItem)mFull.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
 	
 	/** Small menu when listview does not include checkbox */
 	public void setMenuSmall() {
 		setMenu(mSmall);
-		if (!Vm.getPlatform().equals("Win32") && !Vm.getPlatform().equals("Java"))
-			   ((MenuItem)mSmall.items.get(5)).modifiers|=MenuItem.Disabled;
+		//if (!Vm.getPlatform().equals("Win32") && !Vm.getPlatform().equals("Java"))
+		//	   ((MenuItem)mSmall.items.get(5)).modifiers|=MenuItem.Disabled;
 	}
 	
 	public void penRightReleased(Point p){



From salzkammergut at mail.berlios.de  Thu Jan  3 19:11:55 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 3 Jan 2008 19:11:55 +0100
Subject: [Cachewolf-svn] r1165 - trunk/src/CacheWolf
Message-ID: <200801031811.m03IBt45006539@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-03 19:11:47 +0100 (Thu, 03 Jan 2008)
New Revision: 1165

Modified:
   trunk/src/CacheWolf/LogList.java
Log:
Bugfix: DNFs were not displayed any more.
See: http://www.geoclub.de/ftopic21226.html

Modified: trunk/src/CacheWolf/LogList.java
===================================================================
--- trunk/src/CacheWolf/LogList.java	2008-01-03 17:28:12 UTC (rev 1164)
+++ trunk/src/CacheWolf/LogList.java	2008-01-03 18:11:47 UTC (rev 1165)
@@ -95,7 +95,7 @@
 	 public int countNotFoundLogs() {
 		int countNoFoundLogs = 0;
 		while(countNoFoundLogs < size() && countNoFoundLogs < 5){
-			if(getLog(countNoFoundLogs).getIcon().equals("icon_sad")) {
+			if(getLog(countNoFoundLogs).getIcon().startsWith("icon_sad")) {
 				countNoFoundLogs++;
 			}else break;
 		}



From mik77 at mail.berlios.de  Fri Jan  4 22:51:25 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 4 Jan 2008 22:51:25 +0100
Subject: [Cachewolf-svn] r1166 - trunk/src/CacheWolf/navi
Message-ID: <200801042151.m04LpP5N025241@sheep.berlios.de>

Author: mik77
Date: 2008-01-04 22:51:20 +0100 (Fri, 04 Jan 2008)
New Revision: 1166

Modified:
   trunk/src/CacheWolf/navi/TrackOverlay.java
Log:
Filter out every second track point after 30*60 samples (30 minutes) and filter out three of four track points after one hour. But performance when switching or scaling map is still poor when using GK-calibrated maps.

Modified: trunk/src/CacheWolf/navi/TrackOverlay.java
===================================================================
--- trunk/src/CacheWolf/navi/TrackOverlay.java	2008-01-03 18:11:47 UTC (rev 1165)
+++ trunk/src/CacheWolf/navi/TrackOverlay.java	2008-01-04 21:51:20 UTC (rev 1166)
@@ -88,12 +88,22 @@
 		if (tracks == null || tracks.size() == 0) return;
 		int tri, i;
 		Track tr;
-		for (tri=tracks.size()-1; tri >= 0; tri--) {
+		int numberOfTracks = tracks.size();
+		int numberOfPoints = ((Track)tracks.get(numberOfTracks - 1)).num;
+		if (numberOfTracks > 1){
+			numberOfPoints += (numberOfTracks - 1) * ((Track)tracks.get(0)).num;
+		}
+		int n = 0;
+		
+		for (tri=0; tri < numberOfTracks; tri++) {
 			tr = (Track)tracks.get(tri);
 			//draw.setPen(new Pen((Color) tr.trackColor,Pen.SOLID,3));
 			draw.setColor(tr.trackColor);
 			if (tr.num > 0) {
 				for (i=0; i < tr.num; i++) {
+					n++;
+					if  ((numberOfPoints - n > 30*60) && ((n & 1) == 0)) continue;
+					if  ((numberOfPoints - n > 60*60) && ((n & 2) == 0)) continue;
 					paintPoint(tr.trackColor, tr.TrackPoints[i]);
 				}
 			}



From salzkammergut at mail.berlios.de  Sat Jan  5 12:02:08 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 5 Jan 2008 12:02:08 +0100
Subject: [Cachewolf-svn] r1167 - trunk/src/CacheWolf
Message-ID: <200801051102.m05B28VG007581@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-05 12:02:02 +0100 (Sat, 05 Jan 2008)
New Revision: 1167

Modified:
   trunk/src/CacheWolf/CacheList.java
Log:
CacheList: Bugfix. A keypress in the list view caused a stack overflow.

Modified: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2008-01-04 21:51:20 UTC (rev 1166)
+++ trunk/src/CacheWolf/CacheList.java	2008-01-05 11:02:02 UTC (rev 1167)
@@ -124,7 +124,7 @@
 			 * we redirect the focus to the list view, assuming that that is where
 			 * the key event needs to go.
 			 */
-			if (needsInit) {
+			if (needsInit && ev.target==this) {
 				Gui.takeFocus(Global.mainTab.tbP.tc, Control.ByKeyboard);
 				ev.target=Global.mainTab.tbP.tc;
 				postEvent(ev);



From salzkammergut at mail.berlios.de  Sat Jan  5 13:53:46 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 5 Jan 2008 13:53:46 +0100
Subject: [Cachewolf-svn] r1168 - trunk/src/CacheWolf
Message-ID: <200801051253.m05Crkol001858@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-05 13:53:38 +0100 (Sat, 05 Jan 2008)
New Revision: 1168

Modified:
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
Solver: Added a "DEG" <-> "RAD" switch in the SolverPanel. By clicking on this switch the mode for degrees can be changed between degrees and radiants. This mode applies to the following functions:
  sin/cos/tan/asin/acos/atan and bearing/project.
  The mode is stored in the preferences.
Fix: With sk(number) command, addis are now numbered starting with 00.
Bugfix: When a new addi was created without a corresponding cache.xml file, the skeleton command crashed and failed to create a skeleton.


Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2008-01-05 11:02:02 UTC (rev 1167)
+++ trunk/src/CacheWolf/Parser.java	2008-01-05 12:53:38 UTC (rev 1168)
@@ -74,7 +74,7 @@
 *     1) Add its name and alias and allowed number of args to array functions
 *     2) Add a new private method in the "functions" section
 *     3) Add call to private method in executeFunction 
-*   @author salzkammergut January 2007
+*   @author salzkammergut Januay 2007
 */ 
 public class Parser{
 
@@ -193,6 +193,9 @@
     		if (!((String)sym.getKey()).startsWith("$")) 
     			symbolTable.remove(sym.getKey());
     	}
+    	Double pi=new Double(java.lang.Math.PI);
+    	symbolTable.put("PI",pi);
+    	symbolTable.put("pi",pi); // To make it easier for the user we also add a lowercase version of pi
     }
     
 	private boolean isVariable(String varName) {
@@ -341,6 +344,22 @@
 ///////////////////////////////////////////
 //  FUNCTIONS
 ///////////////////////////////////////////
+	
+	/** If we are in DEGree mode, convert the argument to RADiants, if not leave it unchanged */
+	private double convertInput(double arg) {
+		if (Global.getPref().solverDegMode)
+			return arg*java.lang.Math.PI/180.0;
+		else
+			return arg;
+	}
+	
+	/** If we are in DEGree mode, convert the argument to degrees */
+	private double convertOutput(double arg) {
+		if (Global.getPref().solverDegMode)
+			return arg/java.lang.Math.PI*180.0;
+		else
+			return arg;
+	}
     
 	/** Get or set the current centre */
 	private void funcCenter(int nargs) throws Exception {
@@ -427,7 +446,7 @@
  		if (!isValidCoord(coordA)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordA);
 		if (!isValidCoord(coordB)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordB);
 	   	cwPt.set(coordA);
-	   	return cwPt.getBearing(new CWPoint(coordB));
+	   	return convertOutput(cwPt.getBearing(new CWPoint(coordB))*java.lang.Math.PI/180.0);
     }
     /**
      * Encode a string by replacing all characters in a string with their corresponding characters in
@@ -553,8 +572,8 @@
     private String funcProject() throws Exception {
     	double distance=popCalcStackAsNumber(0);
     	if (distance<0) err(MyLocale.getMsg(1718,"Cannot project a negative distance"));
-    	double degrees=popCalcStackAsNumber(0);
-    	if (degrees<0 || degrees>360) err(MyLocale.getMsg(1719,"Projection degrees must be in interval [0;360]"));
+    	double degrees=convertInput(popCalcStackAsNumber(0));
+    	if (degrees<0 || degrees>2*java.lang.Math.PI) err(MyLocale.getMsg(1719,"Projection degrees must be in interval [0;360]"));
     	String coord=popCalcStackAsString();
 		if (!isValidCoord(coord)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coord);
     	cwPt.set(coord);
@@ -605,7 +624,7 @@
 			   goto($01xxxx); STOP
 			ENDIF*/
 			for (int i=0; i<nStages; i++) {
-				String stage=MyLocale.formatLong(i+1,"00");
+				String stage=MyLocale.formatLong(i,"00");
 				String stageWpt="$"+stage+waypointName.substring(2);
 				op.append("IF "+stageWpt+"=\"\" THEN\n");
 				op.append("  "+stageWpt+" = \"\"\n");
@@ -636,7 +655,9 @@
 					op.append("] = \" $");
 					op.append(addiWpt.wayPoint);
 					CacheHolderDetail chD=new CacheHolderDetail(addiWpt);
-					chD.readCache(Global.getProfile().dataDir);
+					try {
+						chD.readCache(Global.getProfile().dataDir);
+					} catch( Exception ex) {};
 					if (chD.LongDescription.trim().length()>0)
 						op.append("\n   \""+STRreplace.replace(chD.LongDescription,"\"","\"\"")+"\"");
 					op.append("\n   goto($");
@@ -941,14 +962,14 @@
 	
 	private void executeFunction(String funcName, int nargs, fnType funcDef) throws Exception {
 		if (!funcDef.nargsValid(nargs)) err(MyLocale.getMsg(1727,"Invalid number of arguments"));
-	         if (funcDef.alias.equals("asin")) calcStack.add(new java.lang.Double(java.lang.Math.asin(popCalcStackAsNumber(0))));
+	         if (funcDef.alias.equals("asin")) calcStack.add(new java.lang.Double(convertOutput(java.lang.Math.asin(popCalcStackAsNumber(0)))));
 	 	else if (funcDef.alias.equals("abs")) calcStack.add(new java.lang.Double(java.lang.Math.abs(popCalcStackAsNumber(0))));
-	    else if (funcDef.alias.equals("acos")) calcStack.add(new java.lang.Double(java.lang.Math.acos(popCalcStackAsNumber(0))));
-	    else if (funcDef.alias.equals("atan")) calcStack.add(new java.lang.Double(java.lang.Math.atan(popCalcStackAsNumber(0))));
+	    else if (funcDef.alias.equals("acos")) calcStack.add(new java.lang.Double(convertOutput(java.lang.Math.acos(popCalcStackAsNumber(0)))));
+	    else if (funcDef.alias.equals("atan")) calcStack.add(new java.lang.Double(convertOutput(java.lang.Math.atan(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("bearing")) calcStack.add(new java.lang.Double(funcBearing()));
 	    else if (funcDef.alias.equals("center")) funcCenter(nargs);
 	    else if (funcDef.alias.equals("cls")) funcCls();
-	    else if (funcDef.alias.equals("cos")) calcStack.add(new java.lang.Double(java.lang.Math.cos(popCalcStackAsNumber(0))));
+	    else if (funcDef.alias.equals("cos")) calcStack.add(new java.lang.Double(java.lang.Math.cos(convertInput(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("count")) funcCount();
 	    else if (funcDef.alias.equals("cp")) calcStack.add(funcCp());     
 	    else if (funcDef.alias.equals("ct")) calcStack.add(new java.lang.Double(funcCrossTotal(nargs)));
@@ -968,11 +989,11 @@
 	    else if (funcDef.alias.equals("rot13")) calcStack.add(Common.rot13(popCalcStackAsString()));
 //	    else if (funcDef.alias.equals("rs")) funcRequireSemicolon(nargs);
 	    else if (funcDef.alias.equals("show"));
-	    else if (funcDef.alias.equals("sin")) calcStack.add(new java.lang.Double(java.lang.Math.sin(popCalcStackAsNumber(0))));
+	    else if (funcDef.alias.equals("sin")) calcStack.add(new java.lang.Double(java.lang.Math.sin(convertInput(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("skeleton")) funcSkeleton(nargs);
 	    else if (funcDef.alias.equals("sqrt")) calcStack.add(new java.lang.Double(funcSqrt())); 
 	    else if (funcDef.alias.equals("sval")) calcStack.add(funcSval(popCalcStackAsString()));
-	    else if (funcDef.alias.equals("tan")) calcStack.add(new java.lang.Double(java.lang.Math.tan(popCalcStackAsNumber(0))));
+	    else if (funcDef.alias.equals("tan")) calcStack.add(new java.lang.Double(java.lang.Math.tan(convertInput(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("uc")) calcStack.add(popCalcStackAsString().toUpperCase());
 	    else if (funcDef.alias.equals("val")) calcStack.add(new java.lang.Double(funcVal(popCalcStackAsString())));
 	    else err(MyLocale.getMsg(1728,"Function not yet implemented: ")+funcName);

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-01-05 11:02:02 UTC (rev 1167)
+++ trunk/src/CacheWolf/Preferences.java	2008-01-05 12:53:38 UTC (rev 1168)
@@ -122,6 +122,8 @@
 	public int maxLogsToSpider = DEFAULT_MAX_LOGS_TO_SPIDER;
 	/** True if the Solver should ignore the case of variables */
 	public boolean solverIgnoreCase=true;
+	/** True if the solver expects arguments for trigonometric functions in degrees */
+	public boolean solverDegMode=true;
 	/** The type of connection which GPSBABEL uses: com1 OR usb. */
 	public String garminConn="com1";  
 	/** Additional options for GPSBabel, i.e. -s to synthethise short names */
@@ -276,6 +278,8 @@
 		}
 		else if (name.equals("solver")) {
 			solverIgnoreCase=Boolean.valueOf(atts.getValue("ignorevariablecase")).booleanValue();
+			tmp = atts.getValue("degMode");
+			if (tmp != null) solverDegMode=Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("mapspath")) {
 			customMapsPath=atts.getValue("dir");
@@ -351,7 +355,7 @@
 			outp.print("    <travelbugs colmap=\""+travelbugColMap+"\" colwidths=\""+travelbugColWidth+"\" shownonlogged=\""+travelbugShowOnlyNonLogged+"\" />\n");
 			outp.print("    <imagepanel showdeletedimages=\""+showDeletedImages+"\"/>\n");
 			outp.print("    <hintlogpanel logsperpage=\""+logsPerPage+"\" initialhintheight=\""+initialHintHeight+"\"  maxspiderlogs=\""+maxLogsToSpider+"\" />\n");
-			outp.print("    <solver ignorevariablecase=\""+solverIgnoreCase+"\"/>\n");
+			outp.print("    <solver ignorevariablecase=\""+solverIgnoreCase+"\" degMode=\""+solverDegMode+"\" />\n");
 			outp.print("    <garmin connection = \""+garminConn+"\" GPSBabelOptions = \""+garminGPSBabelOptions+"\" />\n");
 			outp.print("    <opencaching downloadPicsOC=\""+downloadPicsOC+"\" downloadMaps=\""+downloadMapsOC+"\" downloadMissing=\""+downloadmissingOC+"\"/>\n");
 			outp.print("	<location lat = \""+curCentrePt.getLatDeg(CWPoint.DD)+"\" long = \""+curCentrePt.getLonDeg(CWPoint.DD)+"\"/>\n");

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2008-01-05 11:02:02 UTC (rev 1167)
+++ trunk/src/CacheWolf/SolverPanel.java	2008-01-05 12:53:38 UTC (rev 1168)
@@ -27,6 +27,7 @@
 	Vector msgFIFO = new Vector();
 	Menu mnuContext;
 	private String originalInstructions="";
+	mButton btnDegRad; 
 	
 	public boolean isDirty() {
 		return !originalInstructions.equals(getInstructions());
@@ -76,6 +77,10 @@
 	}
 	CellPanel programPanel, outputPanel;
 	
+	private String getSolverDegMode() {
+		return Global.getPref().solverDegMode ? "DEG" : "RAD";
+	}
+	
 	public SolverPanel (Preferences p, Profile prof){
 		pref = p;
 		profile = prof;
@@ -86,8 +91,16 @@
 		split.setSplitter(PanelSplitter.AFTER|PanelSplitter.HIDDEN,PanelSplitter.BEFORE|PanelSplitter.HIDDEN,0);
 
 		programPanel.addLast(new ScrollBarPanel(mText = new InputPanel())).setTag(SPAN, new Dimension(2,1));
-		programPanel.addNext(mBtSolve= new mButton(MyLocale.getMsg(1735,"Solve!")),CellConstants.HSTRETCH, CellConstants.HFILL);
-		programPanel.addLast(btnWolfLang= new mButton(MyLocale.getMsg(118,"WolfLanguage")),CellConstants.HSTRETCH, CellConstants.HFILL);
+		CellPanel pnlStatButtons=new CellPanel();
+		pnlStatButtons.addNext(btnDegRad=new mButton(getSolverDegMode()),CellConstants.DONTSTRETCH,CellConstants.DONTFILL);
+		btnDegRad.backGround=Color.Sand;
+		btnDegRad.borderStyle=btnDegRad.borderWidth=0;
+		CellPanel pnlButtons=new CellPanel();
+		pnlButtons.addNext(mBtSolve= new mButton(MyLocale.getMsg(1735,"Solve!")),CellConstants.HSTRETCH, CellConstants.HFILL);
+		pnlButtons.addLast(btnWolfLang= new mButton(MyLocale.getMsg(118,"WolfLanguage")),CellConstants.HSTRETCH, CellConstants.HFILL);
+		pnlButtons.equalWidths=true;
+		pnlStatButtons.addLast(pnlButtons,CellConstants.HSTRETCH,CellConstants.HFILL);
+		programPanel.addLast(pnlStatButtons,HSTRETCH,HFILL);
 		/*programPanel.addNext(btnLoad= new mButton(MyLocale.getMsg(1736,"Load")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		programPanel.addNext(btnSave= new mButton(MyLocale.getMsg(1737,"Save")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		programPanel.addLast(btnSaveAs= new mButton(MyLocale.getMsg(1738,"SaveAs")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
@@ -125,6 +138,10 @@
 				InfoScreen is = new InfoScreen(File.getProgramDirectory() + "/" + "wolflang.html", MyLocale.getMsg(118,"WolfLanguage"), true, pref);
 				is.execute(parent.getFrame(), Gui.CENTER_FRAME);
 			}
+			if (ev.target==btnDegRad) {
+				Global.getPref().solverDegMode=!Global.getPref().solverDegMode;
+				btnDegRad.setText(getSolverDegMode());
+			}
 /*			if(ev.target == btnLoad){
 				FileChooser fc = new FileChooser(FileChooser.OPEN, profile.dataDir);
 				



From salzkammergut at mail.berlios.de  Sat Jan  5 15:03:10 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 5 Jan 2008 15:03:10 +0100
Subject: [Cachewolf-svn] r1169 - trunk/src/CacheWolf
Message-ID: <200801051403.m05E3A0L004964@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-05 15:03:07 +0100 (Sat, 05 Jan 2008)
New Revision: 1169

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
myTableModel: By clicking on the header row of the tickboxes the additional information in the list view (Number of not found logs, travelbug in cache, spider status etc.) can be hidden/unhidden. 

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2008-01-05 12:53:38 UTC (rev 1168)
+++ trunk/src/CacheWolf/myTableModel.java	2008-01-05 14:03:07 UTC (rev 1169)
@@ -265,7 +265,7 @@
 						return ch.wayPoint;
 					case 5: // Cachename
 						// Fast return for majority of case
-						if (ch.has_bug == false && ch.noFindLogs==0) return ch.CacheName; 
+						if (!showExtraWptInfo || (ch.has_bug == false && ch.noFindLogs==0)) return ch.CacheName; 
 						// Now need more checks
 						IconAndText wpVal = new IconAndText();
 						if(ch.has_bug == true) wpVal.addColumn(bug);
@@ -337,6 +337,14 @@
 				// cell.x is the physical column but we have to sort by the
 				// column it is mapped into
 				int mappedCol=colMap[cell.x];
+				if (mappedCol==0) { // Click on Tickbox header
+					// Hide/unhide the additional information about a waypoint such as 
+					// travelbugs/number of notfound logs/yellow circle/red circle etc.
+					// This helps on small PDA screens
+					showExtraWptInfo=!showExtraWptInfo; 
+					this.table.repaint();
+					return true;
+				}
 				Vm.showWait(true);
 				Point a = tcControl.getSelectedCell(null);
 				if(a != null) ch = (CacheHolder)cacheDB.get(a.y);



From pfeffer at mail.berlios.de  Sat Jan  5 17:51:49 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 5 Jan 2008 17:51:49 +0100
Subject: [Cachewolf-svn] r1170 - trunk
Message-ID: <200801051651.m05Gpnwj017482@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-05 17:51:47 +0100 (Sat, 05 Jan 2008)
New Revision: 1170

Added:
   trunk/currentversions.txt
Log:
preparing version checking

Added: trunk/currentversions.txt
===================================================================
--- trunk/currentversions.txt	2008-01-05 14:03:07 UTC (rev 1169)
+++ trunk/currentversions.txt	2008-01-05 16:51:47 UTC (rev 1170)
@@ -0,0 +1,22 @@
+# Release
+T0VersionMajor: 0
+T0VersionMinor: 9
+T0Revision: 0
+
+# ReleaseCandidate
+T1VersionMajor: 1
+T1VersionMinor: 0
+T1SvnRevision: 1100
+
+# InDevelopmentStable
+T2VersionMajor: 1
+T2VersionMinor: 0
+T2SvnRevision: 1110
+
+# InDevelopmentNewest
+T3VersionMajor: 1
+T3VersionMinor: 0
+T3SvnRevision: http://flyingfish.freewrt.org:8180/job/Cachewolf/lastBuild/
+
+RecommendedType: 3
+



From salzkammergut at mail.berlios.de  Sat Jan  5 18:08:55 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 5 Jan 2008 18:08:55 +0100
Subject: [Cachewolf-svn] r1171 - in trunk: res_noewe src/CacheWolf
Message-ID: <200801051708.m05H8t5F018038@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-05 18:08:46 +0100 (Sat, 05 Jan 2008)
New Revision: 1171

Modified:
   trunk/res_noewe/wolflang.html
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
Parser: Added new functions deg(), rad() to switch mode for trig functions.
Added new conversion functions deg2rad() and rad2deg()  [alias d2r() and r2d() ]
Updated wolflang.html with new functions

Modified: trunk/res_noewe/wolflang.html
===================================================================
--- trunk/res_noewe/wolflang.html	2008-01-05 16:51:47 UTC (rev 1170)
+++ trunk/res_noewe/wolflang.html	2008-01-05 17:08:46 UTC (rev 1171)
@@ -28,8 +28,14 @@
 <b><u>Trigonometric functions</u></b><br>
  cos(), sin(), tan(),<br>
  atan(), asin(), acos():<br>
-<i> Example: a = cos(1);<br>
+<i> Example: a = cos(90);<br>
  or a = atan(b);</i><br>
+<u>Change mode for trig functions</u><br>
+ deg()<br>
+ rad()<br>
+<u>Trig conversion functions</u><br>
+ deg2rad()  <i>alias</i> d2r()<br>
+ rad2deg()  <i>alias</i> r2d()<br>   
 <br>
 <b><u>Numeric functions</u></b><br>
 ct(number) # crosstotal<br>

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2008-01-05 16:51:47 UTC (rev 1170)
+++ trunk/src/CacheWolf/Parser.java	2008-01-05 17:08:46 UTC (rev 1171)
@@ -51,6 +51,7 @@
 import ewe.sys.*;
 import java.lang.Double;
 
+
 /**
 *	The wolf language parser. New version - January 2007
 *   
@@ -106,6 +107,9 @@
     	new fnType("crosstotal","ct",6),
     	new fnType("ct","ct",2),
      	new fnType("curpos","cp",1),
+     	new fnType("d2r","deg2rad",2),
+     	new fnType("deg","deg",1),
+     	new fnType("deg2rad","deg2rad",2),
      	new fnType("distance","distance",4),
      	new fnType("encode","encode",8),
     	new fnType("format","format",6),
@@ -123,6 +127,9 @@
     	new fnType("project","project",8),
      	new fnType("pz","pz",3),
     	new fnType("quersumme","ct",6),
+    	new fnType("r2d","rad2deg",2),
+    	new fnType("rad","rad",1),
+    	new fnType("rad2deg","rad2deg",2),
     	new fnType("replace","replace",8),
     	new fnType("reverse","reverse",2),
     	new fnType("rot13","rot13",2),
@@ -332,7 +339,10 @@
     	fnType fnd=null;
     	str=str.toLowerCase();
     	for (int i=functions.length-1; i>=0; i--) {
-    		if (functions[i].funcName.startsWith(str)) {
+    		// Return the function if there is an exact match
+    		if (functions[i].funcName.equals(str)) return functions[i];
+    		if (functions[i].funcName.startsWith(str)) { // Partial match?
+        		// Only one partial match allowed
     			if (fnd!=null) err(MyLocale.getMsg(1708,"Ambiguous function name: ")+str);
     			fnd=functions[i];
     		}
@@ -361,7 +371,17 @@
 			return arg;
 	}
     
-	/** Get or set the current centre */
+    /** Calculate brearing from one point to the next */
+    private double funcBearing() throws Exception {
+    	String coordB=popCalcStackAsString();
+    	String coordA=popCalcStackAsString();
+ 		if (!isValidCoord(coordA)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordA);
+		if (!isValidCoord(coordB)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordB);
+	   	cwPt.set(coordA);
+	   	return convertOutput(cwPt.getBearing(new CWPoint(coordB))*java.lang.Math.PI/180.0);
+    }
+
+    /** Get or set the current centre */
 	private void funcCenter(int nargs) throws Exception {
 		if (nargs==0) {
 			calcStack.add(Global.getPref().curCentrePt.toString());
@@ -428,7 +448,18 @@
     	return a;
     }
     
-    /** Calculate distance between 2 points */
+    private void funcDeg(boolean arg) {
+    	Global.getPref().solverDegMode=arg;
+    	Global.mainTab.solverP.showSolverMode();
+    }
+    
+    /** Convert degrees into Radiants */
+    private double funcDeg2Rad() throws Exception {
+    	double a=popCalcStackAsNumber(0);
+    	return a/180.0*java.lang.Math.PI;
+    }
+    	
+    	/** Calculate distance between 2 points */
     private double funcDistance() throws Exception {
     	String coordB=popCalcStackAsString();
     	String coordA=popCalcStackAsString();
@@ -439,15 +470,6 @@
     	return cwPt.getDistance(new CWPoint(coordB))*1000.0;
     }
     
-    /** Calculate brearing from one point to the next */
-    private double funcBearing() throws Exception {
-    	String coordB=popCalcStackAsString();
-    	String coordA=popCalcStackAsString();
- 		if (!isValidCoord(coordA)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordA);
-		if (!isValidCoord(coordB)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordB);
-	   	cwPt.set(coordA);
-	   	return convertOutput(cwPt.getBearing(new CWPoint(coordB))*java.lang.Math.PI/180.0);
-    }
     /**
      * Encode a string by replacing all characters in a string with their corresponding characters in
      * another string
@@ -580,6 +602,12 @@
     	return cwPt.project(degrees,distance/1000.0).toString();
     }
 
+    /** Convert Radiants into degrees */
+    private double funcRad2Deg() throws Exception {
+    	double a=popCalcStackAsNumber(0);
+    	return a*180.0/java.lang.Math.PI;
+    }
+    
     /** Replace all occurrences of a string with another string */
     private String funcReplace() throws Exception {
     	String replaceWith=popCalcStackAsString();
@@ -973,6 +1001,8 @@
 	    else if (funcDef.alias.equals("count")) funcCount();
 	    else if (funcDef.alias.equals("cp")) calcStack.add(funcCp());     
 	    else if (funcDef.alias.equals("ct")) calcStack.add(new java.lang.Double(funcCrossTotal(nargs)));
+	    else if (funcDef.alias.equals("deg")) funcDeg(true);     
+	    else if (funcDef.alias.equals("deg2rad")) calcStack.add(new java.lang.Double(funcDeg2Rad())); 
 	    else if (funcDef.alias.equals("distance")) calcStack.add(new java.lang.Double(funcDistance()));
 	    else if (funcDef.alias.equals("encode")) calcStack.add(funcEncode());
 	    else if (funcDef.alias.equals("format")) calcStack.add(funcFormat(nargs));
@@ -984,6 +1014,8 @@
 	    else if (funcDef.alias.equals("mid")) calcStack.add(funcMid(nargs));
 	    else if (funcDef.alias.equals("project")) calcStack.add(funcProject());     
 	    else if (funcDef.alias.equals("pz")) funcPz(nargs);     
+	    else if (funcDef.alias.equals("rad")) funcDeg(false);     
+	    else if (funcDef.alias.equals("rad2deg")) calcStack.add(new java.lang.Double(funcRad2Deg())); 
 	    else if (funcDef.alias.equals("replace")) calcStack.add(funcReplace());
 	    else if (funcDef.alias.equals("reverse")) calcStack.add(funcReverse(popCalcStackAsString()));
 	    else if (funcDef.alias.equals("rot13")) calcStack.add(Common.rot13(popCalcStackAsString()));

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2008-01-05 16:51:47 UTC (rev 1170)
+++ trunk/src/CacheWolf/SolverPanel.java	2008-01-05 17:08:46 UTC (rev 1171)
@@ -81,6 +81,11 @@
 		return Global.getPref().solverDegMode ? "DEG" : "RAD";
 	}
 	
+	public void showSolverMode() {
+		btnDegRad.setText(getSolverDegMode());
+		btnDegRad.repaint();
+	}
+	
 	public SolverPanel (Preferences p, Profile prof){
 		pref = p;
 		profile = prof;



From pfeffer at mail.berlios.de  Sat Jan  5 20:50:02 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 5 Jan 2008 20:50:02 +0100
Subject: [Cachewolf-svn] r1172 - trunk
Message-ID: <200801051950.m05Jo2D3013832@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-05 20:49:57 +0100 (Sat, 05 Jan 2008)
New Revision: 1172

Modified:
   trunk/currentversions.txt
Log:
test for version checking

Modified: trunk/currentversions.txt
===================================================================
--- trunk/currentversions.txt	2008-01-05 17:08:46 UTC (rev 1171)
+++ trunk/currentversions.txt	2008-01-05 19:49:57 UTC (rev 1172)
@@ -4,14 +4,14 @@
 T0Revision: 0
 
 # ReleaseCandidate
-T1VersionMajor: 1
-T1VersionMinor: 0
-T1SvnRevision: 1100
+T1VersionMajor: 0
+T1VersionMinor: 9
+T1SvnRevision: 800
 
 # InDevelopmentStable
-T2VersionMajor: 1
-T2VersionMinor: 0
-T2SvnRevision: 1110
+T2VersionMajor: 0
+T2VersionMinor: 9
+T2SvnRevision: 1000
 
 # InDevelopmentNewest
 T3VersionMajor: 1



From pfeffer at mail.berlios.de  Sat Jan  5 21:16:47 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 5 Jan 2008 21:16:47 +0100
Subject: [Cachewolf-svn] r1173 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200801052016.m05KGldL014724@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-05 21:16:39 +0100 (Sat, 05 Jan 2008)
New Revision: 1173

Added:
   trunk/src/CacheWolf/UrlFetcher.java
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Version.java
Log:
Version checking: first working version

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-05 19:49:57 UTC (rev 1172)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-05 20:16:39 UTC (rev 1173)
@@ -64,8 +64,8 @@
 		173=GPSBabel:
 		174=Kurznamen
 		175=Import
-		176=Neue Version
-		177=Neue Version%0averf%fcgbar
+		176=--frei geworden--
+		177=--frei geworden--
 		178=Versionspr%fcfung
 		179=Sie haben die%0aaktuelle Version.
 		180=Caches hierher
@@ -567,6 +567,17 @@
 		6124=Kassiopeia Gamma
 		6125=Deneb im Schwan
 		6126=Mimosa im Kreuz des S%fcdens
+		7000=Freigegeben
+		7001=Kandidat f%fcr Freigabe
+		7002=In Entwicklung, stabil
+		7003=In Entwicklung, neuste
+		7010=bereits aktuell(er)
+		7011=Update verf%fcgbar
+		7012=nicht verf%fcgbar
+		7013=Fehler
+		7020=Empfohlener Versionstyp
+		7021=Dieser Versiontyp
+		7022=Versionstyp
 		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-05 19:49:57 UTC (rev 1172)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-05 20:16:39 UTC (rev 1173)
@@ -64,8 +64,8 @@
 		173=GPSBabel:
 		174=Short Names
 		175=Import
-		176=New version
-		177=New version%0aavailable
+		176=-- not used any more--
+		177=-- not used any more--
 		178=Version Check
 		179=You are at%0athe current version.
 		180=Drag caches
@@ -556,6 +556,17 @@
 		6104=Cassiopeia
 		6105=Cygnus
 		6106=Mimosa in Southern Cross
+		7000=Release
+		7001=Release candidate
+		7002=in development, stable
+		7003=in development, newest
+		7010=bereits aktuell(er)
+		7011=Update available
+		7012=not available
+		7013=error
+		7020=recommended version type
+		7021=type of this version
+		7022=Type of version
 		{..}
 	{..}
 {..}

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-01-05 19:49:57 UTC (rev 1172)
+++ trunk/src/CacheWolf/MainMenu.java	2008-01-05 20:16:39 UTC (rev 1173)
@@ -14,14 +14,14 @@
 import exp.*;
 
 /**
-*	This class creates the menu for cachewolf. It is also responsible
-*	for reacting to user inputs in the menu.<br>
-*	This class id=100
-*	@see MainForm
-*	@see MainTab
-*   Last change:
-*     20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
-*/
+ *	This class creates the menu for cachewolf. It is also responsible
+ *	for reacting to user inputs in the menu.<br>
+ *	This class id=100
+ *	@see MainForm
+ *	@see MainTab
+ *   Last change:
+ *     20061123 salzkammergut Tidied up, added MyLocale, added additional internationalisation, combine save/filter for small screens, garminConn
+ */
 public class MainMenu extends MenuBar {
 	private MenuItem profiles, preferences,loadcaches,loadOC,savenexit,savenoxit,exit,search,searchClr;
 	private MenuItem downloadmap, kalibmap, importmap;
@@ -37,7 +37,7 @@
 	private Form father;
 	private TablePanel tbp;
 	private FilterScreen scnFilter=new FilterScreen();
-	
+
 	public MainMenu(Form f){
 		father = f;
 		String cwd = File.getProgramDirectory();
@@ -49,7 +49,7 @@
 		mnuProfile[0] = mnuNewProfile = new MenuItem(MyLocale.getMsg(1107,"New"));
 		mnuProfile[1] = mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109,"Open"));
 		Menu profileMenu = new Menu(mnuProfile,MyLocale.getMsg(121,"Profiles"));
-		
+
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for import, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
@@ -61,7 +61,7 @@
 		mnuImport[4] = mnuForceLogin      = new MenuItem("Always login to GC"); 
 		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175,"Import"));
 		if (Global.getPref().forceLogin) mnuForceLogin.modifiers^=MenuItem.Checked;
-		
+
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for export, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
@@ -82,7 +82,7 @@
 		exitems[10] = exportKML = new MenuItem(MyLocale.getMsg(125,"to Google Earth"));
 		exitems[11] = exportMagellan = new MenuItem(MyLocale.getMsg(132,"to Magellan"));
 		exitems[12] = exportTPL = new MenuItem(MyLocale.getMsg(128,"via Template"));
-		
+
 		Menu exportMenu = new Menu(exitems, MyLocale.getMsg(107,"Export"));
 
 		///////////////////////////////////////////////////////////////////////
@@ -111,14 +111,14 @@
 		appMenuItems[9] = savenexit = new MenuItem(MyLocale.getMsg(110,"Save & Exit")); 
 		appMenuItems[10] = exit = new MenuItem(MyLocale.getMsg(111,"Exit"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(120,"Application"),new Menu(appMenuItems,null)));
-		
+
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Search" pulldown menu
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] searchMenuItems=new MenuItem[2];
 		searchMenuItems[0] = search = new MenuItem(MyLocale.getMsg(112,"Search$"+(char)6)); // char 6 = ctrl +f 
 		searchMenuItems[1] = searchClr = new MenuItem(MyLocale.getMsg(113,"Clear search"));
-		
+
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Filter" pulldown menu
 		///////////////////////////////////////////////////////////////////////
@@ -133,7 +133,7 @@
 		filterMenuItems[7] = filtBlack   = new MenuItem(MyLocale.getMsg(161,"Show Blacklist"));
 		filterMenuItems[8] = mnuSeparator;
 		filterMenuItems[9] = filtCacheTour = new MenuItem(MyLocale.getMsg(198,"Cachetour"));
-		
+
 		///////////////////////////////////////////////////////////////////////
 		// Create a combined "Filter and Search" pulldown menu for devices with small screens
 		///////////////////////////////////////////////////////////////////////
@@ -151,7 +151,7 @@
 		filterAndSearchMenuItems[10]=searchClr;
 		filterAndSearchMenuItems[11] = mnuSeparator;
 		filterAndSearchMenuItems[12] = filtCacheTour;
-		
+
 		// Depending on screen width display either filter and searach menus or the combined menu 
 		if (MyLocale.getScreenWidth()>300) {
 			this.addMenu(new PullDownMenu(MyLocale.getMsg(112,"Search"),new Menu(searchMenuItems,null)));
@@ -159,7 +159,7 @@
 		} else {
 			this.addMenu(new PullDownMenu(MyLocale.getMsg(159,"Filter"),new Menu(filterAndSearchMenuItems,null)));
 		}
-		
+
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Organise" pulldown menu
 		///////////////////////////////////////////////////////////////////////
@@ -183,11 +183,11 @@
 		aboutMenuItems[4] = chkVersion = new MenuItem(MyLocale.getMsg(158,"Version Check"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(117,"About"),new Menu(aboutMenuItems,null)));
 	}
-	
+
 	public void setTablePanel(TablePanel t){
 		tbp = t;
 	}
-	
+
 	public void allowProfileChange(boolean profileChangeAllowed) {
 		if (profileChangeAllowed) {
 			mnuNewProfile.modifiers&=~MenuItem.Disabled;
@@ -197,7 +197,7 @@
 			mnuOpenProfile.modifiers|=MenuItem.Disabled;
 		}
 	}
-	
+
 	public void setForceLogin() {
 		mnuForceLogin.modifiers=Global.getPref().forceLogin ? Global.mainTab.mnuMain.modifiers|MenuItem.Checked : Global.mainTab.mnuMain.modifiers&~MenuItem.Checked;
 	}
@@ -223,7 +223,7 @@
 			if(mev.selectedItem == mnuNewProfile){
 				Global.mainTab.saveUnsavedChanges(true);
 				NewProfileForm f=new NewProfileForm(pref.baseDir);
-			    int code=f.execute(getFrame(), Gui.CENTER_FRAME);
+				int code=f.execute(getFrame(), Gui.CENTER_FRAME);
 				if (code==0) { 
 					profile.clearProfile(); 
 					pref.lastProfile=profile.name=f.profileDir;
@@ -237,30 +237,30 @@
 				f.close(0);
 			}
 			if(mev.selectedItem == mnuOpenProfile){
-					Global.mainTab.saveUnsavedChanges(true);
-					if (pref.selectProfile(profile,Preferences.PROFILE_SELECTOR_FORCED_ON,false)) {
-						tbp.myMod.numRows=0;
-						CacheHolder.removeAllDetails();
-						profile.cacheDB.clear();
-						InfoBox infB = new InfoBox("CacheWolf",MyLocale.getMsg(5000,"Loading Cache-List"));
-						infB.exec();
-						infB.waitUntilPainted(1000);
-						Vm.showWait(infB, true);
-						profile.readIndex();
-						Vm.showWait(infB, false);
-						pref.curCentrePt.set(profile.centre);
-						filtBlack.modifiers&=~MenuItem.Checked;
-						Filter.showBlacklisted=false;
-						Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
-						infB.close(0);
-						profile.restoreFilter(); // Restore the isActive & isInverted status of the filter
-						tbp.resetModel();
+				Global.mainTab.saveUnsavedChanges(true);
+				if (pref.selectProfile(profile,Preferences.PROFILE_SELECTOR_FORCED_ON,false)) {
+					tbp.myMod.numRows=0;
+					CacheHolder.removeAllDetails();
+					profile.cacheDB.clear();
+					InfoBox infB = new InfoBox("CacheWolf",MyLocale.getMsg(5000,"Loading Cache-List"));
+					infB.exec();
+					infB.waitUntilPainted(1000);
+					Vm.showWait(infB, true);
+					profile.readIndex();
+					Vm.showWait(infB, false);
+					pref.curCentrePt.set(profile.centre);
+					filtBlack.modifiers&=~MenuItem.Checked;
+					Filter.showBlacklisted=false;
+					Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
+					infB.close(0);
+					profile.restoreFilter(); // Restore the isActive & isInverted status of the filter
+					tbp.resetModel();
 				}
 			}
 			if(mev.selectedItem == mnuEditCenter){
 				ProfileDataForm f=new ProfileDataForm(pref,profile);
-			    int code=f.execute(getFrame(), Gui.CENTER_FRAME);
-			    tbp.refreshTable();
+				int code=f.execute(getFrame(), Gui.CENTER_FRAME);
+				tbp.refreshTable();
 				f.close(0);
 			}
 			///////////////////////////////////////////////////////////////////////
@@ -292,7 +292,7 @@
 							if (doSpider) how = GPXImporter.DOIT_WITHSPOILER;
 							else how = GPXImporter.DOIT_NOSPOILER;
 					}
-					*/
+					 */
 					for (int i = 0; i < files.length; i++){ 
 						String file = dir + "/" + files[i];
 						if (file.endsWith("loc")){
@@ -449,7 +449,7 @@
 				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 				tbp.saveColWidth(pref);
 			}
-			
+
 			if(mev.selectedItem == savenexit){
 				profile.saveIndex(pref,Profile.SHOW_PROGRESS_BAR);
 				tbp.saveColWidth(pref);
@@ -535,7 +535,7 @@
 				dm.moveCaches();
 				tbp.refreshTable();
 			}
-			
+
 			if(mev.selectedItem == orgDelete){
 				profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 				DataMover dm = new DataMover();
@@ -581,30 +581,22 @@
 				sb.append("<br>Decimal separator is: \""); sb.append(pref.digSeparator);
 				sb.append("\"<br>Device is PDA: ");		sb.append(Vm.isMobile());
 				sb.append("<br>Screen: ");				sb.append(MyLocale.getScreenWidth()); 
-					sb.append(" x ");	 sb.append(MyLocale.getScreenHeight()); 
+				sb.append(" x ");	 sb.append(MyLocale.getScreenHeight()); 
 				sb.append("<br>Font size: ");			sb.append(f.getSize());
 				sb.append("<br>Entries in DB: ");		sb.append(cacheDB.size());
 				sb.append("<br>File separator is: \""); sb.append(Vm.getProperty("file.separator","def")); 
 				sb.append("\"<br>Programme directory is "); sb.append(File.getProgramDirectory());
 				sb.append("<br>Number of details in RAM is "); sb.append(CacheHolder.cachesWithLoadedDetails.size());
 				sb.append(" Max.: ");					sb.append(Global.getPref().maxDetails);
-				sb.append("<br>CacheWolf version: ");		sb.append(vers.getRelease());
+				sb.append("<br>CacheWolf version: ");		sb.append(vers.getReleaseDetailed());
 				sb.append("<br>");
 				InfoScreen is = new InfoScreen(sb.toString(), "System", false,pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
 			if(mev.selectedItem == chkVersion){
-				Version vers = new Version();
-				if(vers.newVersionAvailable(pref)){
-					InfoBox inf = new InfoBox(MyLocale.getMsg(176,"New Version"), MyLocale.getMsg(177,"New version\navailable."));
-					inf.execute();
-				} else {
-					InfoBox inf = new InfoBox(MyLocale.getMsg(178,"Version Check"), MyLocale.getMsg(179,"You are at\nthe current version."));
-					inf.execute();
-				}
+				(new InfoBox(MyLocale.getMsg(178, "Version Checking"), Version.getUpdateMessage())).execute();
 			}
-
 		}
 	}
-	
+
 }

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-01-05 19:49:57 UTC (rev 1172)
+++ trunk/src/CacheWolf/Preferences.java	2008-01-05 20:16:39 UTC (rev 1173)
@@ -564,7 +564,7 @@
 	public void logInit(){
 		File logFile = new File(LOGFILENAME);
 		logFile.delete();
-		log("CW Version "+Version.getRelease());
+		log("CW Version "+Version.getReleaseDetailed());
 	}
 	
 	/**

Added: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2008-01-05 19:49:57 UTC (rev 1172)
+++ trunk/src/CacheWolf/UrlFetcher.java	2008-01-05 20:16:39 UTC (rev 1173)
@@ -0,0 +1,39 @@
+package CacheWolf;
+
+import ewe.data.PropertyList;
+import ewe.io.ByteArrayInputStream;
+import ewe.io.IOException;
+import ewe.io.JavaUtf8Codec;
+import ewe.net.Socket;
+import ewe.util.ByteArray;
+import ewe.util.CharArray;
+import ewe.util.Properties;
+
+public class UrlFetcher {
+	public static String fetchString(String address) throws IOException // TODO follow http-redirections
+	{
+		ByteArray daten = fetchByteArray(address);
+		JavaUtf8Codec codec = new JavaUtf8Codec();
+		CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
+		return c_data.toString();
+	}
+
+	public static Properties fetchPropertyList(String url) throws IOException {
+		ByteArray doc = fetchByteArray(url);
+		Properties props = new Properties();
+		props.load(new ByteArrayInputStream(doc));
+		return props; 
+	}
+	public static ByteArray fetchByteArray(String url) throws IOException {	
+		HttpConnection conn;
+		conn = new HttpConnection(url);
+		conn.setRequestorProperty("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
+		conn.setRequestorProperty("Connection", "close");
+		conn.documentIsEncoded = true;
+		Socket sock = conn.connect();
+		if (conn.responseCode >= 400) throw new IOException("URL: "+ url + "\nhttp response code: " + conn.responseCode);
+		ByteArray daten = conn.readData(sock);
+		sock.close();
+		return daten;
+	}
+}
\ No newline at end of file

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2008-01-05 19:49:57 UTC (rev 1172)
+++ trunk/src/CacheWolf/Version.java	2008-01-05 20:16:39 UTC (rev 1173)
@@ -1,59 +1,113 @@
 
 package CacheWolf;
 
+import com.stevesoft.ewe_pat.Regex;
 import ewe.net.*;
+import ewe.data.Property;
+import ewe.data.PropertyList;
 import ewe.io.*;
 import ewe.util.*;
 import ewe.sys.*;
 
+/**
+ * Class to hold and handle version information of the cachewolf project
+ * language localisation string at at number 7000 
+ */
+
 public class Version {
-	static final String VER_MAJOR = "BE";
-	static final String VER_MINOR = "";
-	static final String VER_BUILD = " ";
+	static final int VER_MAJOR = 0;
+	static final int VER_MINOR = 9;
 	static final String VER_SVN ="$LastChangedRevision$"; // the number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
-	
+	static final int SVN_REVISION = Common.parseInt(VER_SVN.substring(VER_SVN.indexOf(" ")+1, VER_SVN.lastIndexOf(" ")));
+	static final int VERSION_TYPE = 1;
+	public static final String[] VERSION_TYPES = {
+		"Release", 
+		"ReleaseCandidate",
+		"InDevelopmentStable",
+		"InDevelopmentNewest"
+	};
+	/** only valid after calling checkForUpdates() */
+	static int[] updateavailabe = {0,0,0,0,0}; 
+
+	public static String getRelease() {
+		return Convert.toString(VER_MAJOR) + "." + Convert.toString(VER_MINOR);
+	}
+
+	public static String getReleaseDetailed() {
+		// habe die SVN-Nummer doch aus der Anzeige erstmal wieder herausgenommen, weil es in einem final Release doch recht seltsam auss?he.
+		// Sinnvoll w?re daher vielleicht, eine Methode getReleaseDatail, die die SVN-Versionnummer mit angibt und z.B. im "?ber"-Dialog angezeigt werden k?nnte.
+		return getRelease() + "." + Convert.toString(SVN_REVISION) + " " + VERSION_TYPES[VERSION_TYPE];
+	}
+
 	/**
+	 * Checks if newer versions of cachewolf are available 
+	 * @return [0] = recommended version type, [1]...[4]: 0: no update available, 1: newer version available, 2: version doesn't exists, 3: error 
+	 * @throws IOException
+	 */
+	public static void checkForUpdates() throws IOException {
+		Properties curvers = UrlFetcher.fetchPropertyList("http://svn.berlios.de/svnroot/repos/cachewolf/trunk/currentversions.txt");
+		for (int i = updateavailabe.length-1; i >=1; i--) {
+			updateavailabe[i] = (checkVersion(curvers, "T"+(i-1))); 
+		}
+		updateavailabe[0] = Convert.toInt(curvers.getProperty("RecommendedType", "0"));
+	}
+
+	/**
+	 * you must call checkForUpdates() before this method
 	 * @return
 	 */
-	public static String getRelease() {
-		 // habe die SVN-Nummer doch aus der Anzeige erstmal wieder herausgenommen, weil es in einem final Release doch recht seltsam auss?he.
-		 // Sinnvoll w?re daher vielleicht, eine Methode getReleaseDatail, die die SVN-Versionnummer mit angibt und z.B. im "?ber"-Dialog angezeigt werden k?nnte.
-		return VER_MAJOR + VER_MINOR + VER_BUILD + VER_SVN.substring(VER_SVN.indexOf(" "), VER_SVN.lastIndexOf(" "));
+	public static String newVersionsArrayToString() {
+		StringBuffer ret = new StringBuffer(500);
+		for (int i=1; i <= updateavailabe.length -1; i++) {
+			if (updateavailabe[i] != 2 || i-1 == VERSION_TYPE) {
+				ret.append(MyLocale.getMsg(7000+i-1, VERSION_TYPES[i-1]));
+				if (i == updateavailabe[0]) ret.append("*");
+				if (i-1 == VERSION_TYPE ) ret.append("+");
+				ret.append(": ");
+				ret.append(MyLocale.getMsg(7010 + updateavailabe[i], Convert.toString(updateavailabe[i])));
+				ret.append("\n");
+			}
+		}
+		ret.append("* = ").append(MyLocale.getMsg(7020, "Recommended version type"));
+		ret.append("\n+ = ").append(MyLocale.getMsg(7021, "This version type"));
+		return ret.toString();
 	}
-	
-	public boolean newVersionAvailable(Preferences pref){
-		boolean newvers = false;
-		String vers = new String();
-		try{
-			vers = fetch("http://download.berlios.de/cachewolf/currentversion.txt", pref);
-		}catch(Exception ex){
-			Vm.debug("No load berlios?!");
+
+	public static String getUpdateMessage() {
+		try {
+			checkForUpdates();
+			return MyLocale.getMsg(7022, "Version type") +"\n"+ newVersionsArrayToString();
+		} catch (IOException e) {
+			return "Error getting current version information\n"+e.getMessage();
 		}
-		if(!vers.equals(getRelease()) && vers.length()>0){
-			newvers = true;
-		}
-		return newvers;
 	}
-	
-	private static String fetch(String address, Preferences pref) throws IOException
-	   	{
-			//Vm.debug(address);
-			HttpConnection conn;
-			if(pref.myproxy.length() > 0){
-				conn = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), address);
-				//Vm.debug(address);
-			} else {
-				conn = new HttpConnection(address);
+
+	/**
+	 * @param url
+	 * @return: 1 = newer Version available, 0 = this is up to date, 3 = check failed
+	 */
+
+	private static int checkVersion(Properties curvers, String prefix) {
+		try {
+			int curv = Convert.toInt(curvers.getProperty(prefix + "VersionMajor", "0")); 
+			if (curv > VER_MAJOR) return 1;
+			if (curv < VER_MAJOR) return 0;
+			curv = Convert.toInt(curvers.getProperty(prefix + "VersionMinor", "0"));
+			if (curv > VER_MINOR) return 1;
+			if (curv < VER_MINOR) return 0;
+			String svnRString = curvers.getProperty(prefix + "SvnRevision","0");
+			if (svnRString.startsWith("http")) {
+				String tmp = UrlFetcher.fetchString(svnRString);
+				Regex s = new Regex("(?i)Revision[\\s]*[:=][\\s]*[\\\\r]*[\\\\n]*[\\s]*([0-9]*)");
+				s.search(tmp);
+				if (!s.didMatch()) return 3;
+				svnRString = s.stringMatched(1); 
 			}
-			conn.setRequestorProperty("USER_AGENT", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-			conn.setRequestorProperty("Connection", "close");
-			conn.documentIsEncoded = true;
-			Socket sock = conn.connect();
-			ByteArray daten = conn.readData(sock);
-			JavaUtf8Codec codec = new JavaUtf8Codec();
-			CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-			////Vm.debug(c_data.toString());
-			sock.close();
-			return c_data.toString();
+			if (Convert.toInt(svnRString) > SVN_REVISION) return 1;
+			return 0;
+		} catch (IOException e) {
+			return 3;
 		}
+	}
+
 }



From pfeffer at mail.berlios.de  Sat Jan  5 22:05:25 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sat, 5 Jan 2008 22:05:25 +0100
Subject: [Cachewolf-svn] r1174 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200801052105.m05L5PHe017008@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-05 22:05:19 +0100 (Sat, 05 Jan 2008)
New Revision: 1174

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/Version.java
Log:
Version check:  show sand watch while fetching currentversion info, messagebox size: big enough, another localisation

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-05 20:16:39 UTC (rev 1173)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-05 21:05:19 UTC (rev 1174)
@@ -578,6 +578,7 @@
 		7020=Empfohlener Versionstyp
 		7021=Dieser Versiontyp
 		7022=Versionstyp
+		7023=Fehler beim Download der aktuellen Versionsinformationen
 		{..}
 	{..}
 {..}

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-05 20:16:39 UTC (rev 1173)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-05 21:05:19 UTC (rev 1174)
@@ -567,6 +567,7 @@
 		7020=recommended version type
 		7021=type of this version
 		7022=Type of version
+		7023=Error downloading current version information
 		{..}
 	{..}
 {..}

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-01-05 20:16:39 UTC (rev 1173)
+++ trunk/src/CacheWolf/MainMenu.java	2008-01-05 21:05:19 UTC (rev 1174)
@@ -573,7 +573,6 @@
 				StringBuffer sb=new StringBuffer(400);
 				Rect s = (Rect)Window.getGuiInfo(Window.INFO_SCREEN_RECT,null,new Rect(),0);
 				Font f = mApp.guiFont;
-				Version vers = new Version();
 				sb.append("Profile: "); 				sb.append(profile.dataDir);
 				sb.append("<br>Platform: "); 			sb.append(Vm.getPlatform());
 				sb.append("<br>Locale lang is: ");		sb.append(MyLocale.getLocaleLanguage()); 
@@ -588,13 +587,15 @@
 				sb.append("\"<br>Programme directory is "); sb.append(File.getProgramDirectory());
 				sb.append("<br>Number of details in RAM is "); sb.append(CacheHolder.cachesWithLoadedDetails.size());
 				sb.append(" Max.: ");					sb.append(Global.getPref().maxDetails);
-				sb.append("<br>CacheWolf version: ");		sb.append(vers.getReleaseDetailed());
+				sb.append("<br>CacheWolf version: ");		sb.append(Version.getReleaseDetailed());
 				sb.append("<br>");
 				InfoScreen is = new InfoScreen(sb.toString(), "System", false,pref);
 				is.execute(father.getFrame(), Gui.CENTER_FRAME);
 			}
 			if(mev.selectedItem == chkVersion){
-				(new InfoBox(MyLocale.getMsg(178, "Version Checking"), Version.getUpdateMessage())).execute();
+				Vm.showWait(true);
+				(new MessageBox(MyLocale.getMsg(178, "Version Checking"), Version.getUpdateMessage(), MessageBox.OKB)).execute();
+				Vm.showWait(false);
 			}
 		}
 	}

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2008-01-05 20:16:39 UTC (rev 1173)
+++ trunk/src/CacheWolf/Version.java	2008-01-05 21:05:19 UTC (rev 1174)
@@ -19,13 +19,14 @@
 	static final int VER_MINOR = 9;
 	static final String VER_SVN ="$LastChangedRevision$"; // the number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	static final int SVN_REVISION = Common.parseInt(VER_SVN.substring(VER_SVN.indexOf(" ")+1, VER_SVN.lastIndexOf(" ")));
-	static final int VERSION_TYPE = 1;
+	static final int VERSION_TYPE = 3;
 	public static final String[] VERSION_TYPES = {
 		"Release", 
 		"ReleaseCandidate",
 		"InDevelopmentStable",
 		"InDevelopmentNewest"
 	};
+	
 	/** only valid after calling checkForUpdates() */
 	static int[] updateavailabe = {0,0,0,0,0}; 
 
@@ -78,7 +79,7 @@
 			checkForUpdates();
 			return MyLocale.getMsg(7022, "Version type") +"\n"+ newVersionsArrayToString();
 		} catch (IOException e) {
-			return "Error getting current version information\n"+e.getMessage();
+			return MyLocale.getMsg(7023, "Error getting current version information") +"\n" + e.getMessage();
 		}
 	}
 



From salzkammergut at mail.berlios.de  Sun Jan  6 15:16:15 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 6 Jan 2008 15:16:15 +0100
Subject: [Cachewolf-svn] r1175 - trunk/src/CacheWolf
Message-ID: <200801061416.m06EGF9P030370@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-06 15:16:02 +0100 (Sun, 06 Jan 2008)
New Revision: 1175

Modified:
   trunk/src/CacheWolf/CacheList.java
   trunk/src/CacheWolf/DataMover.java
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/NewProfileForm.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/ProfilesForm.java
   trunk/src/CacheWolf/SearchCache.java
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/TablePanel.java
Log:
Filter: Tidied up the saving of the filter status.

Modified: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/CacheList.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -283,8 +283,9 @@
 		}
 		// The sort command places all filtered caches at the end
 		cacheDB.sort(new mySort(),false);
-		Filter.filterActive=Filter.FILTER_CACHELIST;
-		Filter.filterInverted=false;
+		Global.getProfile().filterActive=Filter.FILTER_CACHELIST;
+		Global.getProfile().filterInverted=false;
+		Global.getProfile().hasUnsavedChanges=true;
 		updateScreen(cacheList.size()-wrongBlackStatus);
 		if (wrongBlackStatus>0)
 			(new MessageBox(MyLocale.getMsg(5500,"Error"),MyLocale.getMsg(4600,"Some cache(s) cannot be shown because of wrong blacklist status"), MessageBox.OKB)).execute();

Modified: trunk/src/CacheWolf/DataMover.java
===================================================================
--- trunk/src/CacheWolf/DataMover.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/DataMover.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -54,7 +54,7 @@
 		}
 		processCaches(new Copier(MyLocale.getMsg(141, "Copy"),dstProfile));
 		// write indexfiles and keep the filter status
-		dstProfile.saveIndex(pref, Profile.NO_SHOW_PROGRESS_BAR,dstProfile.filterActive,dstProfile.filterInverted);
+		dstProfile.saveIndex(pref, Profile.NO_SHOW_PROGRESS_BAR);
 	}
 	
 	public void moveCaches() {
@@ -78,7 +78,7 @@
 		}
 		processCaches(new Mover(MyLocale.getMsg(142, "Move"),dstProfile));
 		// write indexfiles
-		dstProfile.saveIndex(pref, Profile.NO_SHOW_PROGRESS_BAR,dstProfile.filterActive,dstProfile.filterInverted);
+		dstProfile.saveIndex(pref, Profile.NO_SHOW_PROGRESS_BAR); 
 		profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 	}
 	

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/Filter.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -19,9 +19,9 @@
 	/** Toggle for showing blacklisted caches. Can be toggled through the Filter menu */
 	public static boolean showBlacklisted=false;
 	/** Indicator whether a filter is inverted */
-	public static boolean filterInverted=false;
+	//public static boolean filterInverted=false;
 	/** Indicator whether a filter is active. Used in status bar to indicate filter status */
-	public static int filterActive=FILTER_INACTIVE;
+	//public static int filterActive=FILTER_INACTIVE;
 	
 	private static final int SMALLER = -1;
 	private static final int EQUAL = 0;
@@ -98,7 +98,6 @@
 	double fscTerr;
 	double fscDiff;
 	
-	
 	private boolean archived = false;
 	private boolean notArchived = false;
 	
@@ -465,7 +464,9 @@
 			}
 			
 		} // for
-		filterActive=FILTER_ACTIVE;
+		Global.getProfile().filterActive=FILTER_ACTIVE;
+		Global.getProfile().filterInverted=false;
+		Global.getProfile().hasUnsavedChanges=true;
 	}
 	
 	/**
@@ -483,7 +484,8 @@
 			else
 				ch.is_filtered=true; // Hide all those that have the wrong is_black status
 		}
-		filterInverted=true;
+		Global.getProfile().filterInverted=true;
+		Global.getProfile().hasUnsavedChanges=true;
 	}
 	
 	/**
@@ -496,8 +498,9 @@
 			ch = (CacheHolder)cacheDB.get(i);
 			ch.is_filtered=(ch.is_black^showBlacklisted) ; // Always filter blacklisted caches
 		}
-		filterActive=FILTER_INACTIVE;
-		filterInverted=false;
+		Global.getProfile().filterActive=FILTER_INACTIVE;
+		Global.getProfile().filterInverted=false;
+		Global.getProfile().hasUnsavedChanges=true;
 	}
 
 	public boolean hasFilter() {

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/MainMenu.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -253,7 +253,6 @@
 					Filter.showBlacklisted=false;
 					Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 					infB.close(0);
-					profile.restoreFilter(); // Restore the isActive & isInverted status of the filter
 					tbp.resetModel();
 				}
 			}
@@ -272,8 +271,6 @@
 				spGC.doIt();
 				cacheDB.clear();
 				profile.readIndex();
-				profile.restoreFilter();
-				profile.updateBearingDistance();
 				tbp.resetModel();
 			}
 			if(mev.selectedItem == loadcaches){

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/MainTab.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -372,6 +372,7 @@
 			}
 		}
 		if (saveIndex) profile.saveIndex(Global.getPref(),false);
+		Global.getPref().savePreferences();
 	}
 	
 	private void checkProfileChange() {

Modified: trunk/src/CacheWolf/NewProfileForm.java
===================================================================
--- trunk/src/CacheWolf/NewProfileForm.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/NewProfileForm.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -51,8 +51,8 @@
 						profileDir="";
 						this.close(-1);
 					}
-					Filter.filterActive=Filter.FILTER_INACTIVE;
-					Filter.filterInverted=false;
+					Global.getProfile().filterActive=Filter.FILTER_INACTIVE;
+					Global.getProfile().filterInverted=false;
 					this.close(0);
 				}
 			}

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/Profile.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -98,13 +98,13 @@
 	 *   
 	 *   Saves the index with the filter settings from Filter
 	 */
-	public void saveIndex(Preferences pref, boolean showprogress){
-		saveIndex(pref,showprogress, Filter.filterActive,Filter.filterInverted);
-	}
+//	public void saveIndex(Preferences pref, boolean showprogress){
+//		saveIndex(pref,showprogress, Filter.filterActive,Filter.filterInverted);
+//	}
 
 	
 	/** Save index with filter settings given */ 
-	public void saveIndex(Preferences pref, boolean showprogress, int saveFilterActive, boolean saveFilterInverted){
+	public void saveIndex(Preferences pref, boolean showprogress) { 
 		ProgressBarForm pbf = new ProgressBarForm();
 		Handle h = new Handle();
 		if(showprogress){
@@ -146,7 +146,7 @@
 				distOC = "0";
 			}
 
-			detfile.print("    <FILTER status = \""+saveFilterActive+(saveFilterInverted?"T":"F")+ 
+			detfile.print("    <FILTER status = \""+filterActive+(filterInverted?"T":"F")+ 
 					"\" rose = \""+filterRose+"\" type = \""+filterType+
 					"\" var = \""+filterVar+"\" dist = \""+filterDist.replace('"',' ')+"\" diff = \""+
 					filterDiff+"\" terr = \""+filterTerr+"\" size = \""+filterSize+"\" />\n");
@@ -277,7 +277,7 @@
 			if (filterInverted) 
 				flt.invertFilter();
 		} else if (filterActive==Filter.FILTER_CACHELIST) {
-			flt.filterActive=filterActive;
+			//flt.filterActive=filterActive;
 		}
 	}
 

Modified: trunk/src/CacheWolf/ProfilesForm.java
===================================================================
--- trunk/src/CacheWolf/ProfilesForm.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/ProfilesForm.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -118,8 +118,8 @@
 				close(-1);
 			}
 			if (ev.target == btnOK || ev.target == choice){
-				Filter.filterActive=Filter.FILTER_INACTIVE;
-				Filter.filterInverted=false;
+				Global.getProfile().filterActive=Filter.FILTER_INACTIVE;
+				Global.getProfile().filterInverted=false;
 				if (choice.getSelectedItem()!=null) {
 					newSelectedProfile=choice.getSelectedItem().toString();
 					close(1);

Modified: trunk/src/CacheWolf/SearchCache.java
===================================================================
--- trunk/src/CacheWolf/SearchCache.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/SearchCache.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -54,8 +54,8 @@
 			ch.is_flaged=false;
 			ch.is_filtered=(ch.is_black^Filter.showBlacklisted) ;
 		}
-		Global.getProfile().filterActive=Filter.filterActive; //TODO This is a hack. Need to tidy this up
-		Global.getProfile().filterInverted=Filter.filterInverted;
+		//Global.getProfile().filterActive=Filter.filterActive; //TODO This is a hack. Need to tidy this up
+		//Global.getProfile().filterInverted=Filter.filterInverted;
 		Global.getProfile().restoreFilter();
 	}
 }

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/StatusBar.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -46,9 +46,9 @@
 					MyLocale.getMsg(4502,"Fnd:") + " " + stats.totalFound() + "  ";
 		disp.setText(strStatus);
 		// Indicate that a filter is active in the status line
-		if (Filter.filterActive==Filter.FILTER_ACTIVE)
+		if (Global.getProfile().filterActive==Filter.FILTER_ACTIVE)
 			btnFlt.backGround=new Color(0,255,0);
-		else if (Filter.filterActive==Filter.FILTER_CACHELIST)
+		else if (Global.getProfile().filterActive==Filter.FILTER_CACHELIST)
 			btnFlt.backGround=new Color(0,0,255);
 		else
 			btnFlt.backGround=null;
@@ -65,7 +65,7 @@
 		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if (ev.target == btnFlt){
 				Filter flt = new Filter();
-				if (Filter.filterActive==Filter.FILTER_INACTIVE) {
+				if (Global.getProfile().filterActive==Filter.FILTER_INACTIVE) {
 					flt.setFilter();
 					flt.doFilter();
 				} else {

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2008-01-05 21:05:19 UTC (rev 1174)
+++ trunk/src/CacheWolf/TablePanel.java	2008-01-06 14:16:02 UTC (rev 1175)
@@ -79,9 +79,7 @@
 	public void resetModel() {
 		myMod.numRows = cacheDB.size();
 		Global.getProfile().updateBearingDistance();
-		Filter flt = new Filter();
-		flt.setFilter();
-		flt.doFilter();
+		Global.getProfile().restoreFilter(); // Restore the isActive & isInverted status of the filter
 		tc.scrollToVisible(0,0);
 		refreshTable();
 	}



From salzkammergut at mail.berlios.de  Sun Jan  6 15:44:37 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 6 Jan 2008 15:44:37 +0100
Subject: [Cachewolf-svn] r1176 - trunk/src/CacheWolf
Message-ID: <200801061444.m06EibZp031685@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-06 15:44:32 +0100 (Sun, 06 Jan 2008)
New Revision: 1176

Modified:
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
Log:
Addition to previous commit: Clear the "unsavedChanges" Flag when loading a new profile.

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2008-01-06 14:16:02 UTC (rev 1175)
+++ trunk/src/CacheWolf/MainForm.java	2008-01-06 14:44:32 UTC (rev 1176)
@@ -75,6 +75,7 @@
 			pref.curCentrePt.set(profile.centre);
 			profile.updateBearingDistance();
 			profile.restoreFilter();
+			profile.hasUnsavedChanges=false;
 			setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 		} catch (Exception e){
 			if(pref.debug == true) Vm.debug("MainForm:: Exception:: " + e.toString());

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2008-01-06 14:16:02 UTC (rev 1175)
+++ trunk/src/CacheWolf/MainMenu.java	2008-01-06 14:44:32 UTC (rev 1176)
@@ -254,6 +254,7 @@
 					Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 					infB.close(0);
 					tbp.resetModel();
+					Global.getProfile().hasUnsavedChanges=false;
 				}
 			}
 			if(mev.selectedItem == mnuEditCenter){



From salzkammergut at mail.berlios.de  Sun Jan  6 18:41:13 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 6 Jan 2008 18:41:13 +0100
Subject: [Cachewolf-svn] r1177 - trunk/src/CacheWolf
Message-ID: <200801061741.m06HfDDE032629@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-06 18:41:00 +0100 (Sun, 06 Jan 2008)
New Revision: 1177

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/PreferencesScreen.java
Log:
Feature: DescriptionPanel can now display images. As this may take some time on PDAs, the feature can be disabled in the preferences.

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-01-06 14:44:32 UTC (rev 1176)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-01-06 17:41:00 UTC (rev 1177)
@@ -1,5 +1,7 @@
 package CacheWolf;
 
+import com.stevesoft.ewe_pat.Regex;
+
 import ewe.ui.*;
 import ewe.fx.*;
 import ewe.sys.*;
@@ -15,10 +17,12 @@
 	CellPanel buttonP = new CellPanel();
 	CellPanel descP = new CellPanel();
 	
+	private String desc;
+
 	public DescriptionPanel(){
 		buttonP.addNext(btnPlus = new mButton("+"),CellConstants.HSTRETCH, (CellConstants.HFILL));
 		buttonP.addLast(btnMinus = new mButton("-"),CellConstants.HSTRETCH, (CellConstants.HFILL));
-		ScrollBarPanel sbp = new ScrollBarPanel(disp, ScrollBarPanel.NeverShowHorizontalScrollers);
+		ScrollBarPanel sbp = new ScrollBarPanel(disp, 0);
 		descP.addLast(sbp);
 		this.addLast(descP);
 		this.addLast(buttonP,CellConstants.HSTRETCH,CellConstants.HFILL);
@@ -33,7 +37,6 @@
 		if (currCache == cache) return;
 		int scrollto = 0;
 		if (cache.hasSameMainCache(currCache)) scrollto = disp.getTopLine();
-		String desc;
 		if (cache == null) desc = "";
 		else {
 			if (cache.isAddiWpt()) {
@@ -45,9 +48,40 @@
 				desc = cache.LongDescription;
 		}
 		if (!desc.equals(description)) {
+			//disp.getDecoderProperties().setBoolean("allowImages",true);
 			Vm.showWait(true); 
-			if (cache.is_HTML)	disp.setHtml(desc);
-			else				disp.setPlainText(desc);
+			if (cache.is_HTML) {
+				if (Global.getPref().descShowImg) {
+					StringBuffer s=new StringBuffer(desc.length()+cache.Images.size()*100);
+					int start=0;
+					int pos;
+					int imageNo=0;
+					Regex imgRex = new Regex("src=(?:\\s*[^\"|']*?)(?:\"|')(.*?)(?:\"|')");
+					while (start>=0 && (pos=desc.indexOf("<img",start))>0) {
+						s.append(desc.substring(start,pos));
+						imgRex.searchFrom(desc,pos);
+						String imgUrl=imgRex.stringMatched(1);
+						//Vm.debug("imgUrl "+imgUrl);
+						if (imgUrl.lastIndexOf('.')>0 && imgUrl.toLowerCase().startsWith("http")) {
+							String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
+							// If we have an image which we stored when spidering, we can display it
+							if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
+								s.append("<img src=\""+
+								   Global.getProfile().dataDir+cache.Images.get(imageNo)+"\">");
+								imageNo++;
+							}
+						}
+						start=desc.indexOf(">",pos);
+						if (start>=0) start++;
+						if (imageNo >= cache.Images.getCount())break;
+					}
+					if (start>=0) s.append(desc.substring(start));
+					desc=s.toString();
+				}
+				disp.setHtml(desc);
+			}
+			else
+				disp.setPlainText(desc);
 			disp.scrollTo(scrollto,false);
 			description = desc;
 			Vm.showWait(false);
@@ -60,7 +94,7 @@
 
 		Vm.showWait(true);
 		currLine = disp.getTopLine();
-		if (currCache.is_HTML)	disp.setHtml(currCache.LongDescription);
+		if (currCache.is_HTML)	disp.setHtml(desc);
 		else				disp.setPlainText(currCache.LongDescription);
 		disp.scrollTo(currLine,false);
 		Vm.showWait(false);

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-01-06 14:44:32 UTC (rev 1176)
+++ trunk/src/CacheWolf/Preferences.java	2008-01-06 17:41:00 UTC (rev 1177)
@@ -124,6 +124,8 @@
 	public boolean solverIgnoreCase=true;
 	/** True if the solver expects arguments for trigonometric functions in degrees */
 	public boolean solverDegMode=true;
+	/** True if the description panel should show images */
+	public boolean descShowImg=true;
 	/** The type of connection which GPSBABEL uses: com1 OR usb. */
 	public String garminConn="com1";  
 	/** Additional options for GPSBabel, i.e. -s to synthethise short names */
@@ -262,6 +264,9 @@
 		else if (name.equals("imagepanel")) {
 			showDeletedImages = Boolean.valueOf(atts.getValue("showdeletedimages")).booleanValue();
 		}
+		else if (name.equals("descpanel")) {
+			descShowImg = Boolean.valueOf(atts.getValue("showimages")).booleanValue();
+		} 
 		else if (name.equals("screen")) {
 			menuAtTop=Boolean.valueOf(atts.getValue("menuattop")).booleanValue();
 			tabsAtTop=Boolean.valueOf(atts.getValue("tabsattop")).booleanValue();
@@ -353,6 +358,7 @@
 			outp.print("    <fixedsip state = \""+fixSIP+"\"/>\n");
 			outp.print("    <listview colmap=\""+listColMap+"\" colwidths=\""+listColWidth+"\" />\n");
 			outp.print("    <travelbugs colmap=\""+travelbugColMap+"\" colwidths=\""+travelbugColWidth+"\" shownonlogged=\""+travelbugShowOnlyNonLogged+"\" />\n");
+			outp.print("    <descpanel showimages=\""+descShowImg+"\" />\n");
 			outp.print("    <imagepanel showdeletedimages=\""+showDeletedImages+"\"/>\n");
 			outp.print("    <hintlogpanel logsperpage=\""+logsPerPage+"\" initialhintheight=\""+initialHintHeight+"\"  maxspiderlogs=\""+maxLogsToSpider+"\" />\n");
 			outp.print("    <solver ignorevariablecase=\""+solverIgnoreCase+"\" degMode=\""+solverDegMode+"\" />\n");

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2008-01-06 14:44:32 UTC (rev 1176)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2008-01-06 17:41:00 UTC (rev 1177)
@@ -18,7 +18,7 @@
 	mInput NSDeg, NSm, EWDeg, EWm, DataDir, Proxy, ProxyPort, Alias, nLogs, Browser, fontSize, inpGPS, 
 	       inpLogsPerPage,inpMaxLogsToSpider,inpPassword,inpLanguage;
 	mCheckBox dif, ter, loc, own, hid, stat, dist, bear, chkAutoLoad, chkShowDeletedImg, chkMenuAtTop, 
-	          chkTabsAtTop, chkShowStatus,chkHasCloseButton,chkSynthShort,chkProxyActive;
+	          chkTabsAtTop, chkShowStatus,chkHasCloseButton,chkSynthShort,chkProxyActive, chkDescShowImg;
 	mTabbedPanel mTab;
 	mChoice chcGarminPort;
 	mLabel lblGarmin;
@@ -129,10 +129,16 @@
 		
 		Frame frmImages=new Frame();
 		frmImages.borderStyle=CellPanel.BDR_RAISEDOUTER|CellPanel.BDR_SUNKENINNER|CellPanel.BF_TOP|CellPanel.BF_BOTTOM;
-		frmImages.addNext(new mLabel(MyLocale.getMsg(623,"Images:")),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		frmImages.addLast(chkShowDeletedImg = new mCheckBox(MyLocale.getMsg(624,"Show deleted images")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.EAST));
-		chkShowDeletedImg.setTag(INSETS,new Insets(0,0,2,0));
+		//frmImages.addNext(new mLabel(MyLocale.getMsg(623,"Images:")),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		frmImages.addLast(chkShowDeletedImg = new mCheckBox(MyLocale.getMsg(624,"Show deleted images")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		chkShowDeletedImg.setTag(INSETS,new Insets(2,0,0,0));
 		if (pref.showDeletedImages) chkShowDeletedImg.setState(true);
+		//mLabel dummy;
+		//frmImages.addNext(dummy=new mLabel(""),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
+		//dummy.setTag(INSETS,new Insets(0,0,2,0));
+		frmImages.addLast(chkDescShowImg = new mCheckBox("Bilder in Beschreibung anzeigen"),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
+		chkDescShowImg.setTag(INSETS,new Insets(0,0,2,0));
+		if (pref.descShowImg) chkDescShowImg.setState(true);
 		pnlDisplay.addLast(frmImages,CellConstants.STRETCH,CellConstants.FILL);
 
 		Frame frmHintLog=new Frame();
@@ -257,6 +263,7 @@
 				pref.hasCloseButton=chkHasCloseButton.getState();
 				pref.travelbugColMap=tccBugs.getSelectedCols();
 				pref.listColMap=tccList.getSelectedCols();
+				pref.descShowImg=chkDescShowImg.getState();
 				Global.mainTab.tbP.myMod.setColumnNamesAndWidths();
 				pref.savePreferences();
 				pref.dirty = true; // Need to update table in case columns were enabled/disabled



From salzkammergut at mail.berlios.de  Sun Jan  6 20:19:54 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 6 Jan 2008 20:19:54 +0100
Subject: [Cachewolf-svn] r1178 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200801061919.m06JJsI1002021@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-06 20:19:45 +0100 (Sun, 06 Jan 2008)
New Revision: 1178

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/PreferencesScreen.java
Log:
Added internationalization for last commit - Showing pictures in description panel

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-06 17:41:00 UTC (rev 1177)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-06 19:19:45 UTC (rev 1178)
@@ -191,7 +191,8 @@
 		634=Proxy verwenden
 		635=Gr%f6%dfe
 		636=OC Empfehlungen
-		637=OC Index		
+		637=OC Index
+		638=Bilder in Beschreibung anzeigen		
 		700=Filter setzen
 		701=Entfernung
 		702=Schwierigkeit

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-06 17:41:00 UTC (rev 1177)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-06 19:19:45 UTC (rev 1178)
@@ -192,7 +192,8 @@
 		634=use Proxy
 		635=Size
 		636=OC Recs
-		637=OC Index		
+		637=OC Index
+		638=Show pictures in description		
 		700=Set filter
 		701=Distance
 		702=Difficulty

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2008-01-06 17:41:00 UTC (rev 1177)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2008-01-06 19:19:45 UTC (rev 1178)
@@ -136,7 +136,7 @@
 		//mLabel dummy;
 		//frmImages.addNext(dummy=new mLabel(""),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
 		//dummy.setTag(INSETS,new Insets(0,0,2,0));
-		frmImages.addLast(chkDescShowImg = new mCheckBox("Bilder in Beschreibung anzeigen"),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
+		frmImages.addLast(chkDescShowImg = new mCheckBox(MyLocale.getMsg(638,"Show pictures in description")),CellConstants.VSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST|CellConstants.NORTH));
 		chkDescShowImg.setTag(INSETS,new Insets(0,0,2,0));
 		if (pref.descShowImg) chkDescShowImg.setState(true);
 		pnlDisplay.addLast(frmImages,CellConstants.STRETCH,CellConstants.FILL);



From salzkammergut at mail.berlios.de  Sun Jan  6 23:04:11 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 6 Jan 2008 23:04:11 +0100
Subject: [Cachewolf-svn] r1179 - trunk/src/CacheWolf
Message-ID: <200801062204.m06M4Bw7017466@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-06 23:04:08 +0100 (Sun, 06 Jan 2008)
New Revision: 1179

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
Log:
Modification to make the last commit work with the statically linked exe.

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-01-06 19:19:45 UTC (rev 1178)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-01-06 22:04:08 UTC (rev 1179)
@@ -67,7 +67,8 @@
 							// If we have an image which we stored when spidering, we can display it
 							if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
 								s.append("<img src=\""+
-								   Global.getProfile().dataDir+cache.Images.get(imageNo)+"\">");
+								   //Global.getProfile().dataDir+
+								   cache.Images.get(imageNo)+"\">");
 								imageNo++;
 							}
 						}
@@ -78,7 +79,12 @@
 					if (start>=0) s.append(desc.substring(start));
 					desc=s.toString();
 				}
-				disp.setHtml(desc);
+				//disp.setHtml(desc);
+				disp.startHtml();
+				disp.getDecoderProperties().set("documentroot",Global.getProfile().dataDir);
+				disp.addHtml(desc,new ewe.sys.Handle());
+				disp.endHtml();
+				
 			}
 			else
 				disp.setPlainText(desc);



From salzkammergut at mail.berlios.de  Sun Jan  6 23:35:46 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 6 Jan 2008 23:35:46 +0100
Subject: [Cachewolf-svn] r1180 - trunk/src/CacheWolf
Message-ID: <200801062235.m06MZkF8019612@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-06 23:35:43 +0100 (Sun, 06 Jan 2008)
New Revision: 1180

Modified:
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/Profile.java
Log:
Filter: Bugfix saving status of filter when inverted

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2008-01-06 22:04:08 UTC (rev 1179)
+++ trunk/src/CacheWolf/Filter.java	2008-01-06 22:35:43 UTC (rev 1180)
@@ -484,7 +484,7 @@
 			else
 				ch.is_filtered=true; // Hide all those that have the wrong is_black status
 		}
-		Global.getProfile().filterInverted=true;
+		Global.getProfile().filterInverted=!Global.getProfile().filterInverted;
 		Global.getProfile().hasUnsavedChanges=true;
 	}
 	

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2008-01-06 22:04:08 UTC (rev 1179)
+++ trunk/src/CacheWolf/Profile.java	2008-01-06 22:35:43 UTC (rev 1180)
@@ -270,12 +270,15 @@
 	 *  The values of Filter.isActive and Filter.isInactive are set by the filter 
 	 **/
 	void restoreFilter() {
+		boolean inverted=filterInverted; // Save it as doFilter will clear filterInverted
 		Filter flt=new Filter();
 		if (filterActive==Filter.FILTER_ACTIVE) {
 			flt.setFilter();
 			flt.doFilter();
-			if (filterInverted) 
+			if (inverted) {
 				flt.invertFilter();
+				filterInverted=true; // Needed because previous line inverts filterInverted
+			}
 		} else if (filterActive==Filter.FILTER_CACHELIST) {
 			//flt.filterActive=filterActive;
 		}



From mik77 at mail.berlios.de  Tue Jan  8 19:44:41 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 8 Jan 2008 19:44:41 +0100
Subject: [Cachewolf-svn] r1181 - trunk/src/CacheWolf
Message-ID: <200801081844.m08IifMj032731@sheep.berlios.de>

Author: mik77
Date: 2008-01-08 19:44:38 +0100 (Tue, 08 Jan 2008)
New Revision: 1181

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
Log:
use images of main cache for description of additional waypoint

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-01-06 22:35:43 UTC (rev 1180)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-01-08 18:44:38 UTC (rev 1181)
@@ -5,6 +5,7 @@
 import ewe.ui.*;
 import ewe.fx.*;
 import ewe.sys.*;
+import ewe.util.Vector;
 
 /**
 *	This class shows the long description on a cache.
@@ -52,7 +53,13 @@
 			Vm.showWait(true); 
 			if (cache.is_HTML) {
 				if (Global.getPref().descShowImg) {
-					StringBuffer s=new StringBuffer(desc.length()+cache.Images.size()*100);
+					Vector Images;
+					if (cache.isAddiWpt()) {
+						Images = cache.mainCache.getCacheDetails(true).Images;
+					} else {
+						Images = cache.Images;						
+					}					
+					StringBuffer s=new StringBuffer(desc.length()+Images.size()*100);
 					int start=0;
 					int pos;
 					int imageNo=0;
@@ -68,13 +75,13 @@
 							if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
 								s.append("<img src=\""+
 								   //Global.getProfile().dataDir+
-								   cache.Images.get(imageNo)+"\">");
+								   Images.get(imageNo)+"\">");
 								imageNo++;
 							}
 						}
 						start=desc.indexOf(">",pos);
 						if (start>=0) start++;
-						if (imageNo >= cache.Images.getCount())break;
+						if (imageNo >= Images.getCount())break;
 					}
 					if (start>=0) s.append(desc.substring(start));
 					desc=s.toString();



From salzkammergut at mail.berlios.de  Tue Jan 15 21:15:26 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 15 Jan 2008 21:15:26 +0100
Subject: [Cachewolf-svn] r1182 - in trunk: res_noewe/languages src/CacheWolf
Message-ID: <200801152015.m0FKFQr8020911@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-15 21:15:21 +0100 (Tue, 15 Jan 2008)
New Revision: 1182

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/Parser.java
Log:
Bugfix for project-Function
See http://www.geoclub.de/ftopic21548.html

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-08 18:44:38 UTC (rev 1181)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-15 20:15:21 UTC (rev 1182)
@@ -378,6 +378,7 @@
 		1736=Laden
 		1737=Speichern
 		1738=Speichern als	
+		1739=Winkel muss im Bereich [0;2*PI] sein
 		1800=Georeferenzierte Karten herunterladen
 		1801=Kacheln herunterladen
 		2000=GPX Export

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-08 18:44:38 UTC (rev 1181)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-15 20:15:21 UTC (rev 1182)
@@ -378,6 +378,7 @@
 		1736=Load
 		1737=Save
 		1738=SaveAs	
+		1739=Projection degrees must be in interval [0;2*PI]
 		1800=Download georeferenced maps
 		1801=Download tiles
 		2000=GPX Export

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2008-01-08 18:44:38 UTC (rev 1181)
+++ trunk/src/CacheWolf/Parser.java	2008-01-15 20:15:21 UTC (rev 1182)
@@ -356,7 +356,7 @@
 ///////////////////////////////////////////
 	
 	/** If we are in DEGree mode, convert the argument to RADiants, if not leave it unchanged */
-	private double convertInput(double arg) {
+	private double makeRadiant(double arg) {
 		if (Global.getPref().solverDegMode)
 			return arg*java.lang.Math.PI/180.0;
 		else
@@ -364,7 +364,7 @@
 	}
 	
 	/** If we are in DEGree mode, convert the argument to degrees */
-	private double convertOutput(double arg) {
+	private double makeDegree(double arg) {
 		if (Global.getPref().solverDegMode)
 			return arg/java.lang.Math.PI*180.0;
 		else
@@ -378,7 +378,9 @@
  		if (!isValidCoord(coordA)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordA);
 		if (!isValidCoord(coordB)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coordB);
 	   	cwPt.set(coordA);
-	   	return convertOutput(cwPt.getBearing(new CWPoint(coordB))*java.lang.Math.PI/180.0);
+	   	double angleDeg=cwPt.getBearing(new CWPoint(coordB));
+	   	// getBearing returns a result in degrees
+	   	return Global.getPref().solverDegMode ? angleDeg : angleDeg * java.lang.Math.PI/180.0;
     }
 
     /** Get or set the current centre */
@@ -594,8 +596,14 @@
     private String funcProject() throws Exception {
     	double distance=popCalcStackAsNumber(0);
     	if (distance<0) err(MyLocale.getMsg(1718,"Cannot project a negative distance"));
-    	double degrees=convertInput(popCalcStackAsNumber(0));
-    	if (degrees<0 || degrees>2*java.lang.Math.PI) err(MyLocale.getMsg(1719,"Projection degrees must be in interval [0;360]"));
+    	double degrees=popCalcStackAsNumber(0);
+    	// If we are not in degree mode, arg is in radiants ==> convert it
+    	if (!Global.getPref().solverDegMode) degrees=degrees * 180.0 / java.lang.Math.PI; 
+    	if (degrees<0 || degrees>360) 
+    		if (Global.getPref().solverDegMode) 
+    			err(MyLocale.getMsg(1719,"Projection degrees must be in interval [0;360]"));
+    		else
+    			err(MyLocale.getMsg(1739,"Projection degrees must be in interval [0;2*PI]"));
     	String coord=popCalcStackAsString();
 		if (!isValidCoord(coord)) err(MyLocale.getMsg(1712,"Invalid coordinate: ")+coord);
     	cwPt.set(coord);
@@ -990,14 +998,14 @@
 	
 	private void executeFunction(String funcName, int nargs, fnType funcDef) throws Exception {
 		if (!funcDef.nargsValid(nargs)) err(MyLocale.getMsg(1727,"Invalid number of arguments"));
-	         if (funcDef.alias.equals("asin")) calcStack.add(new java.lang.Double(convertOutput(java.lang.Math.asin(popCalcStackAsNumber(0)))));
+	         if (funcDef.alias.equals("asin")) calcStack.add(new java.lang.Double(makeDegree(java.lang.Math.asin(popCalcStackAsNumber(0)))));
 	 	else if (funcDef.alias.equals("abs")) calcStack.add(new java.lang.Double(java.lang.Math.abs(popCalcStackAsNumber(0))));
-	    else if (funcDef.alias.equals("acos")) calcStack.add(new java.lang.Double(convertOutput(java.lang.Math.acos(popCalcStackAsNumber(0)))));
-	    else if (funcDef.alias.equals("atan")) calcStack.add(new java.lang.Double(convertOutput(java.lang.Math.atan(popCalcStackAsNumber(0)))));
+	    else if (funcDef.alias.equals("acos")) calcStack.add(new java.lang.Double(makeDegree(java.lang.Math.acos(popCalcStackAsNumber(0)))));
+	    else if (funcDef.alias.equals("atan")) calcStack.add(new java.lang.Double(makeDegree(java.lang.Math.atan(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("bearing")) calcStack.add(new java.lang.Double(funcBearing()));
 	    else if (funcDef.alias.equals("center")) funcCenter(nargs);
 	    else if (funcDef.alias.equals("cls")) funcCls();
-	    else if (funcDef.alias.equals("cos")) calcStack.add(new java.lang.Double(java.lang.Math.cos(convertInput(popCalcStackAsNumber(0)))));
+	    else if (funcDef.alias.equals("cos")) calcStack.add(new java.lang.Double(java.lang.Math.cos(makeRadiant(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("count")) funcCount();
 	    else if (funcDef.alias.equals("cp")) calcStack.add(funcCp());     
 	    else if (funcDef.alias.equals("ct")) calcStack.add(new java.lang.Double(funcCrossTotal(nargs)));
@@ -1021,11 +1029,11 @@
 	    else if (funcDef.alias.equals("rot13")) calcStack.add(Common.rot13(popCalcStackAsString()));
 //	    else if (funcDef.alias.equals("rs")) funcRequireSemicolon(nargs);
 	    else if (funcDef.alias.equals("show"));
-	    else if (funcDef.alias.equals("sin")) calcStack.add(new java.lang.Double(java.lang.Math.sin(convertInput(popCalcStackAsNumber(0)))));
+	    else if (funcDef.alias.equals("sin")) calcStack.add(new java.lang.Double(java.lang.Math.sin(makeRadiant(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("skeleton")) funcSkeleton(nargs);
 	    else if (funcDef.alias.equals("sqrt")) calcStack.add(new java.lang.Double(funcSqrt())); 
 	    else if (funcDef.alias.equals("sval")) calcStack.add(funcSval(popCalcStackAsString()));
-	    else if (funcDef.alias.equals("tan")) calcStack.add(new java.lang.Double(java.lang.Math.tan(convertInput(popCalcStackAsNumber(0)))));
+	    else if (funcDef.alias.equals("tan")) calcStack.add(new java.lang.Double(java.lang.Math.tan(makeRadiant(popCalcStackAsNumber(0)))));
 	    else if (funcDef.alias.equals("uc")) calcStack.add(popCalcStackAsString().toUpperCase());
 	    else if (funcDef.alias.equals("val")) calcStack.add(new java.lang.Double(funcVal(popCalcStackAsString())));
 	    else err(MyLocale.getMsg(1728,"Function not yet implemented: ")+funcName);



From salzkammergut at mail.berlios.de  Tue Jan 15 22:40:56 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 15 Jan 2008 22:40:56 +0100
Subject: [Cachewolf-svn] r1183 - trunk/src/CacheWolf
Message-ID: <200801152140.m0FLeuXE028109@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-15 22:40:53 +0100 (Tue, 15 Jan 2008)
New Revision: 1183

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
SolverPanel: Ensure that the solver instructions are saved when exiting the application directly from the solver panel

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-01-15 20:15:21 UTC (rev 1182)
+++ trunk/src/CacheWolf/MainTab.java	2008-01-15 21:40:53 UTC (rev 1183)
@@ -363,6 +363,11 @@
 	 * @param askForConfirmation If true, the save can be cancelled by user
 	 */
 	public void saveUnsavedChanges(boolean askForConfirmation) {
+		if (oldCard!=0) {
+			onLeavingPanel(oldCard);
+			onEnteringPanel(0);
+			oldCard=0;
+		}
 		boolean saveIndex=!askForConfirmation; // Definitely save it if no confirmation needed
 		updatePendingChanges();
 		if (askForConfirmation) { // Don't know whether to save, have to ask

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2008-01-15 20:15:21 UTC (rev 1182)
+++ trunk/src/CacheWolf/SolverPanel.java	2008-01-15 21:40:53 UTC (rev 1183)
@@ -135,6 +135,7 @@
     }
 	
 	public void onEvent(Event ev){
+		if (ev instanceof DataChangeEvent) Global.mainTab.cacheDirty=true;
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if(ev.target == mBtSolve){
 				processCommand(mText.getText());



From salzkammergut at mail.berlios.de  Sat Jan 19 16:02:56 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 19 Jan 2008 16:02:56 +0100
Subject: [Cachewolf-svn] r1184 - trunk/src/CacheWolf
Message-ID: <200801191502.m0JF2urv024191@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-19 16:02:51 +0100 (Sat, 19 Jan 2008)
New Revision: 1184

Modified:
   trunk/src/CacheWolf/RadarPanel.java
Log:
RadarPanel: Fix. Don't show waypoints without coordinates (e.g. addis) in the center
(See http://www.geoclub.de/ftopic21609.html)

Modified: trunk/src/CacheWolf/RadarPanel.java
===================================================================
--- trunk/src/CacheWolf/RadarPanel.java	2008-01-15 21:40:53 UTC (rev 1183)
+++ trunk/src/CacheWolf/RadarPanel.java	2008-01-19 15:02:51 UTC (rev 1184)
@@ -107,7 +107,7 @@
 		double pi180=java.lang.Math.PI / 180.0;
 		for(int i = cacheDB.size()-1; i >=0 ; i--){
 			holder = (CacheHolder)cacheDB.get(i);
-			if(!holder.is_filtered) {
+			if(!holder.is_filtered && holder.pos.isValid()) {
 				degrees = holder.degrees * pi180;
 				x =new Float(holder.kilom/scale *  java.lang.Math.sin(degrees)).intValue();
 				y = -new Float(holder.kilom/scale *  java.lang.Math.cos(degrees)).intValue();



From salzkammergut at mail.berlios.de  Sat Jan 19 17:05:21 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 19 Jan 2008 17:05:21 +0100
Subject: [Cachewolf-svn] r1185 - trunk/src/CacheWolf
Message-ID: <200801191605.m0JG5Lv8027296@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-19 17:05:18 +0100 (Sat, 19 Jan 2008)
New Revision: 1185

Modified:
   trunk/src/CacheWolf/Filter.java
Log:
Filter: Bugfix: When filtering out multis, the addis were not filtered with the parent.
(See: http://www.geoclub.de/ftopic21609-0-asc-07.html)

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2008-01-19 15:02:51 UTC (rev 1184)
+++ trunk/src/CacheWolf/Filter.java	2008-01-19 16:05:18 UTC (rev 1185)
@@ -464,6 +464,15 @@
 			}
 			
 		} // for
+		// Ensure that for all main caches that are filtered, the addis are also filtered independently of 
+		// the filter status of the addi
+		for(int i = cacheDB.size()-1; i >=0 ; i--){
+			ch = (CacheHolder)cacheDB.get(i);
+			if (ch.mainCache!=null) {
+				// We have found an addi, filte it if its parent is filtered
+				ch.is_filtered|=ch.mainCache.is_filtered;
+			}
+		}
 		Global.getProfile().filterActive=FILTER_ACTIVE;
 		Global.getProfile().filterInverted=false;
 		Global.getProfile().hasUnsavedChanges=true;



From salzkammergut at mail.berlios.de  Sat Jan 19 22:15:04 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 19 Jan 2008 22:15:04 +0100
Subject: [Cachewolf-svn] r1186 - trunk/src/CacheWolf
Message-ID: <200801192115.m0JLF4qX031676@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-19 22:15:01 +0100 (Sat, 19 Jan 2008)
New Revision: 1186

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Tidied up, improved logging functions. Note: The proxy feature still needs to be tested, I have no proxy.


Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-01-19 16:05:18 UTC (rev 1185)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-01-19 21:15:01 UTC (rev 1186)
@@ -100,13 +100,13 @@
 		infB = new InfoBox(MyLocale.getMsg(5507,"Status"), MyLocale.getMsg(5508,"Logging in..."));
 		infB.exec();
 		try{
-			pref.log("Fetching login page");
+			pref.log("[login]:Fetching login page");
 			//Access the page once to get a viewstate
 			start = fetch(loginPage);   //http://www.geocaching.com/login/Default.aspx
 		} catch(Exception ex){
 			infB.close(0);
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5499,"Error loading login page"), MessageBox.OKB)).execute();
-			pref.log("Could not fetch: gc.com login page",ex);
+			pref.log("[login]:Could not fetch: gc.com login page",ex);
 			passwort="";
 			return ERR_LOGIN;
 		}
@@ -120,20 +120,20 @@
 				viewstate = rexViewstate.stringMatched(1);
 				//Vm.debug("ViewState: " + viewstate);
 			} else
-				pref.log("Viewstate not found before login");
+				pref.log("[login]:Viewstate not found before login");
 			
 			if(start.indexOf(loginSuccess) > 0)
-				pref.log("Already logged in");
+				pref.log("[login]:Already logged in");
 			else {
 				rexEventvalidation.search(start);
 				if(rexEventvalidation.didMatch()){
 					eventvalidation = rexEventvalidation.stringMatched(1);
 					//Vm.debug("EVENTVALIDATION: " + eventvalidation);
 				} else
-					pref.log("Eventvalidation not found before login");
+					pref.log("[login]:Eventvalidation not found before login");
 				//Ok now login!
 				try{
-					pref.log("Logging in as "+pref.myAlias);
+					pref.log("[login]:Logging in as "+pref.myAlias);
 					StringBuffer sb=new StringBuffer(1000);
 					sb.append(URL.encodeURL("__VIEWSTATE",false));	sb.append("="); sb.append(URL.encodeURL(viewstate,false));
 					sb.append("&"); sb.append(URL.encodeURL("myUsername",false));
@@ -148,15 +148,15 @@
 					sb.append("="); sb.append(URL.encodeURL(eventvalidation,false));
 					start = fetch_post(loginPage, sb.toString(), nextPage);  // /login/default.aspx
 					if(start.indexOf(loginSuccess) > 0)
-						pref.log("Login successful");
+						pref.log("[login]:Login successful");
 					else {
-						pref.log("Login failed. Wrong Account or Password?");
+						pref.log("[login]:Login failed. Wrong Account or Password?");
 						infB.close(0);
 						(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5501,"Login failed! Wrong account or password?"), MessageBox.OKB)).execute();
 						return ERR_LOGIN;
 					}
 				}catch(Exception ex){
-					pref.log("Login failed.", ex);
+					pref.log("[login]:Login failed with exception.", ex);
 					infB.close(0);
 					(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5501,"Login failed. Error loading page after login."), MessageBox.OKB)).execute();
 					return ERR_LOGIN;
@@ -165,18 +165,18 @@
 
 			rexViewstate.search(start);
 			if (!rexViewstate.didMatch()) {
-				pref.log("Viewstate not found");
+				pref.log("[login]:Viewstate not found");
 			}
 			viewstate = rexViewstate.stringMatched(1);
 			rexCookieID.search(start);
 			if (!rexCookieID.didMatch()) {
-				pref.log("CookieID not found");
-			}
-			cookieID = rexCookieID.stringMatched(1);
+				pref.log("[login]:CookieID not found. Using old one.");
+			} else
+				cookieID = rexCookieID.stringMatched(1);
 			//Vm.debug(cookieID);
 			rexCookieSession.search(start);
 			if (!rexCookieSession.didMatch()) {
-				pref.log("CookieSession not found Using old one.");
+				pref.log("[login]:CookieSession not found. Using old one.");
 				//cookieSession="";
 			} else
 				cookieSession = rexCookieSession.stringMatched(1);
@@ -275,6 +275,8 @@
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5509,"Coordinates for centre must be set"), MessageBox.OKB)).execute();
 			return;
 		}
+		if (System.getProperty("os.name")!=null)pref.log("Operating system: "+System.getProperty("os.name")+"/"+System.getProperty("os.arch"));
+		if (System.getProperty("java.vendor")!=null)pref.log("Java: "+System.getProperty("java.vendor")+"/"+System.getProperty("java.version"));
 		// Prepare an index of caches for faster searching
 		indexDB = new Hashtable(cacheDB.size());
 		CacheHolder ch;
@@ -482,7 +484,8 @@
 					// General Cache Data
 					//==========
 					chD.setLatLon(getLatLon(completeWebPage));
-					if (pref.debug) pref.log("LatLon: " + chD.LatLon);
+					pref.log("LatLon: " + chD.LatLon);
+					if (pref.debug) pref.log("chD.pos: " + chD.pos.toString());
 					if (chD.LatLon.equals("???")) {
 						pref.log(">>>> Failed to spider Cache. Retry.");
 						continue; // Restart the spider
@@ -493,44 +496,44 @@
 	
 					pref.log("Getting cache name");
 					chD.CacheName = SafeXML.cleanback(getName(completeWebPage));
-					pref.log("Got cache name");
-					if (pref.debug) pref.log("Name: " + chD.CacheName);
-	
+					if (pref.debug) pref.log("Name: " + chD.CacheName); else pref.log("Got name");
+						
 					pref.log("Trying owner");
 					chD.CacheOwner = SafeXML.cleanback(getOwner(completeWebPage)).trim();
 					if(chD.CacheOwner.equals(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equals(pref.myAlias2))) chD.is_owned = true;
-					pref.log("Got owner");
 					if (pref.debug) pref.log("Owner: " + chD.CacheOwner +"; is_owned = "+chD.is_owned+";  alias1,2 = ["+pref.myAlias+"|"+pref.myAlias2+"]");
-	
+					else pref.log("Got owner");
+
+						
 					pref.log("Trying date hidden");
 					chD.DateHidden = DateFormat.MDY2YMD(getDateHidden(completeWebPage));
-					pref.log("Got date hidden");
 					if (pref.debug) pref.log("Hidden: " + chD.DateHidden);
-	
+					else pref.log("Got date hidden");
+					
 					pref.log("Trying hints");
 					chD.setHints(getHints(completeWebPage));
-					pref.log("Got hints");
 					if (pref.debug) pref.log("Hints: " + chD.Hints);
-	
+					else pref.log("Got hints");
+					
 					pref.log("Trying size");
 					chD.CacheSize = getSize(completeWebPage);
-					pref.log("Got size");
 					if (pref.debug) pref.log("Size: " + chD.CacheSize);
+					else pref.log("Got size");
 	
 					pref.log("Trying difficulty");
 					chD.hard = getDiff(completeWebPage);
-					pref.log("Got difficulty");
 					if (pref.debug) pref.log("Hard: " + chD.hard);
+					else pref.log("Got difficulty");
 	
 					pref.log("Trying terrain");
 					chD.terrain = getTerr(completeWebPage);
-					pref.log("Got terrain");
 					if (pref.debug) pref.log("Terr: " + chD.terrain);
+					else pref.log("Got terrain");
 	
 					pref.log("Trying cache type");
 					chD.type = getType(completeWebPage);
-					pref.log("Got cache type");
 					if (pref.debug) pref.log("Type: " + chD.type);
+					else pref.log("Got cache type");
 	
 					//==========
 					// Logs
@@ -1089,214 +1092,92 @@
 	*	it will be a gc.com address. This method is used to obtain
 	*	the result of a search for caches screen.
 	*/
-	public static String fetch(String address)
-	   	{
-			CharArray c_data;
-			String data="";
-			try{
-				//Vm.debug(address);
-				HttpConnection conn;
-				if(pref.myproxy.length() > 0 && pref.proxyActive){
-					pref.log("Using proxy: " + pref.myproxy + " / " +pref.myproxyport);
-					conn = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), address);
-					//Vm.debug(address);
-				} else {
-					conn = new HttpConnection(address);
-				}
-				conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-				if(cookieSession.length()>0){
-					conn.setRequestorProperty("Cookie", "ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
-					pref.log("Cookie Zeug: " + "Cookie: ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
-				} else
-					pref.log("No Cookie found");
-				conn.setRequestorProperty("Connection", "close");
-				conn.documentIsEncoded = true;
-				pref.log("Connecting");
-				Socket sock = conn.connect();
-				pref.log("Connect ok!");
-				ByteArray daten = conn.readData(sock);
-				pref.log("Read socket ok");
-				JavaUtf8Codec codec = new JavaUtf8Codec();
-				c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-
-				/*
-				 * prepend the response headers to the document
-				 * like non-linux Ewe does
-				 *
-				 * @TODO directly use the properties in the
-				 * code which calls this method instead
-				 */
-				PropertyList pl = conn.documentProperties;
-				if (pl != null) {
-					StringBuffer sb = new StringBuffer();
-					boolean gotany = false;
-
-					for (int i = 0; i < pl.size(); i++) {
-						Property p = (Property)pl.get(i);
-						if (p.value != null) {
-							sb.append(p.name + ": " + p.value + "\r\n");
-							gotany = true;
-						}
-					}
-					if (gotany)
-						data += sb.toString() + "\r\n";
-				}
-				data += c_data.toString();
-				//Vm.debug("SpiderGC.fetch() result = " + data);
-				sock.close();
-			}catch(IOException ioex){
-				pref.log("IOException in fetch", ioex);
-			}finally{
-				//continue
-			}
-			return data;
+	public static String fetch(String address) {
+		CharArray c_data;
+		try{
+			HttpConnection conn;
+			if(pref.myproxy.length() > 0 && pref.proxyActive){
+				pref.log("[fetch]:Using proxy: " + pref.myproxy + " / " +pref.myproxyport);
+			} 
+			conn = new HttpConnection(address);
+			conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
+			if(cookieSession.length()>0){
+				conn.setRequestorProperty("Cookie", "ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
+				pref.log("[fetch]:Cookie Zeug: " + "Cookie: ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
+			} else
+				pref.log("[fetch]:No Cookie found");
+			conn.setRequestorProperty("Connection", "close");
+			conn.documentIsEncoded = true;
+			if (pref.debug) pref.log("[fetch]:Connecting");
+			Socket sock = conn.connect();
+			if (pref.debug) pref.log("[fetch]:Connect ok!");
+			ByteArray daten = conn.readData(sock);
+			if (pref.debug) pref.log("[fetch]:Read data ok");
+			JavaUtf8Codec codec = new JavaUtf8Codec();
+			c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
+			sock.close();
+			return getResponseHeaders(conn)+ c_data.toString();
+		}catch(IOException ioex){
+			pref.log("IOException in fetch", ioex);
+		}finally{
+			//continue
 		}
+		return "";
+	}
 
 	/**
 	*	After a fetch to gc.com the next fetches have to use the post method.
 	*	This method does exactly that. Actually this method is generic in the sense
 	*	that it can be used to post to a URL using http post.
 	*/
-	private static String fetch_post(String address, String document, String path) throws IOException
-	   	{
-
-			//String line = "";
-			String totline = "";
-			if(!pref.proxyActive){
-				try {
-					/*
-					// Create a socket to the host
-					String hostname = "www.geocaching.com";
-					int port = 80;
-					InetAddress addr = InetAddress.getByName(hostname);
-					Socket socket = new Socket(hostname, port);
-					// Send header
-					//String path = "/seek/nearest.aspx";
-					BufferedWriter wr = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream(), "UTF8"));
-					BufferedReader rd = new BufferedReader(new InputStreamReader(socket.getInputStream()));
-					wr.write("POST "+path+" HTTP/1.1\r\n");
-					wr.write("Host: www.geocaching.com\r\n");
-					if(cookieSession.length()>0){
-						wr.write("Cookie: ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
-					}
-					Vm.debug("Doc length: " + document.length());
-					wr.write("Content-Length: "+document.length()+"\r\n");
-					wr.write("Content-Type: application/x-www-form-urlencoded\r\n");
-					wr.write("Connection: close\r\n");
-					wr.write("\r\n");
-					// Send data
-					wr.write(document);
-					wr.write("\r\n");
-					wr.flush();
-					//Vm.debug("Sent the data!");
-					// Get response
-					while ((line = rd.readLine()) != null) {
-						totline += line + "\n";
-					}
-					wr.close();
-					rd.close();
-					*/
-					HttpConnection conn;
-					conn = new HttpConnection(address);
-					JavaUtf8Codec codec = new JavaUtf8Codec();
-					conn.documentIsEncoded = true;
-					//Vm.debug(address + " / " + document);
-					//document = document + "\r\n";
-					//conn.setPostData(document.toCharArray());
-					conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-					conn.setPostData(codec.encodeText(document.toCharArray(),0,document.length(),true,null));
-					conn.setRequestorProperty("Content-Type", "application/x-www-form-urlencoded");
-					if(cookieSession.length()>0){
-						if (cookieSession!=null) conn.setRequestorProperty("Cookie", "ASP.NET_SessionId="+cookieSession+"; userid="+cookieID);
-					}
-					conn.setRequestorProperty("Connection", "close");
-					Socket sock = conn.connect();
-
-					//Vm.debug("getting stuff!");
-					ByteArray daten = conn.readData(sock);
-					//Vm.debug("coming back!");
-					CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-					sock.close();
-					//Vm.debug(c_data.toString());
-					totline = "";
-
-					/*
-					 * prepend the response headers to the document
-					 * like non-linux Ewe does
-					 *
-					 * @TODO directly use the properties in the
-					 * code which calls this method instead
-					 */
-					PropertyList pl = conn.documentProperties;
-					if (pl != null) {
-						StringBuffer sb = new StringBuffer();
-						boolean gotany = false;
-
-						for (int i = 0; i < pl.size(); i++) {
-							Property p = (Property)pl.get(i);
-							if (p.value != null) {
-								sb.append(p.name + ": " + p.value + "\r\n");
-								gotany = true;
-							}
-						}
-						if (gotany)
-							totline += sb.toString() + "\r\n";
-					}
-					totline += c_data.toString();
-				} catch (Exception e) {
-				}
+	private static String fetch_post(String address, String document, String path) throws IOException {
+		HttpConnection conn;
+		try {
+			conn = new HttpConnection(address);
+			JavaUtf8Codec codec = new JavaUtf8Codec();
+			conn.documentIsEncoded = true;
+			conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
+			conn.setPostData(codec.encodeText(document.toCharArray(),0,document.length(),true,null));
+			conn.setRequestorProperty("Content-Type", "application/x-www-form-urlencoded");
+			if(cookieSession.length()>0){
+				conn.setRequestorProperty("Cookie", "ASP.NET_SessionId="+cookieSession+"; userid="+cookieID);
+				pref.log("[fetch]:Cookie Zeug: " + "Cookie: ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
 			} else {
-				HttpConnection conn;
-				conn = new HttpConnection(pref.myproxy, Convert.parseInt(pref.myproxyport), address);
-				JavaUtf8Codec codec = new JavaUtf8Codec();
-				conn.documentIsEncoded = true;
-				//Vm.debug(address + " / " + document);
-				//document = document + "\r\n";
-				//conn.setPostData(document.toCharArray());
-				conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
-				conn.setPostData(codec.encodeText(document.toCharArray(),0,document.length(),true,null));
-				conn.setRequestorProperty("Content-Type", "application/x-www-form-urlencoded");
-				if(cookieSession.length()>0){
-					conn.setRequestorProperty("Cookie", "ASP.NET_SessionId="+cookieSession+"; userid="+cookieID);
-				}
-				conn.setRequestorProperty("Connection", "close");
-				Socket sock = conn.connect();
+				pref.log("[fetch]:No Cookie found");
+			}
+			conn.setRequestorProperty("Connection", "close");
+			if (pref.debug) pref.log("[fetch]:Connecting");
+			Socket sock = conn.connect();
+			if (pref.debug) pref.log("[fetch]:Connect ok!");
+			ByteArray daten = conn.readData(sock);
+			if (pref.debug) pref.log("[fetch]:Read data ok");
+			CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
+			sock.close();
+			return getResponseHeaders(conn)+c_data.toString();
+		} catch (Exception e) {	}
+		return "";
+	}
 
-				//Vm.debug("getting stuff!");
-				ByteArray daten = conn.readData(sock);
-				//Vm.debug("coming back!");
-				CharArray c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
-				sock.close();
-				//Vm.debug(c_data.toString());
-				totline = "";
+	private static String getResponseHeaders(HttpConnection conn) {
+		PropertyList pl = conn.documentProperties;
+		if (pl != null) {
+			StringBuffer sb = new StringBuffer(1000);
+			boolean gotany = false;
 
-				/*
-				 * prepend the response headers to the document
-				 * like non-linux Ewe does
-				 *
-				 * @TODO directly use the properties in the
-				 * code which calls this method instead
-				 */
-				PropertyList pl = conn.documentProperties;
-				if (pl != null) {
-					StringBuffer sb = new StringBuffer();
-					boolean gotany = false;
-
-					for (int i = 0; i < pl.size(); i++) {
-						Property p = (Property)pl.get(i);
-						if (p.value != null) {
-							sb.append(p.name + ": " + p.value + "\r\n");
-							gotany = true;
-						}
-					}
-					if (gotany)
-						totline += sb.toString() + "\r\n";
+			for (int i = 0; i < pl.size(); i++) {
+				Property p = (Property)pl.get(i);
+				if (p.value != null) {
+					sb.append(p.name).append(": ").append(p.value).append("\r\n");
+					gotany = true;
 				}
-				totline += c_data.toString();
 			}
-			return totline;
+			if (gotany)
+				return sb.toString() + "\r\n";
 		}
-
+		return "";
+	}
+	
+	
 	final static String hex = ewe.util.TextEncoder.hex;
 
 	public String encodeUTF8URL(byte[] what) {



From arno4401 at uni-trier.de  Sat Jan 19 23:44:21 2008
From: arno4401 at uni-trier.de (Dr. Robert Arnold)
Date: Sat, 19 Jan 2008 23:44:21 +0100
Subject: [Cachewolf-svn] r1186 - trunk/src/CacheWolf
In-Reply-To: <200801192115.m0JLF4qX031676@sheep.berlios.de>
References: <200801192115.m0JLF4qX031676@sheep.berlios.de>
Message-ID: <op.t46738njon161k@leichter>

man braucht sich nicht mehr um den Proxy zu k?mmern, das macht jetz seit  
einiger Zeit die HttpConnection-Klasse in Cachewolfs selbst. (Ist  
allerdings auch ungetestet).

Gru?,
    Robert.

Am 19.01.2008, 22:15 Uhr, schrieb <salzkammergut at mail.berlios.de>:

> Author: salzkammergut
> Date: 2008-01-19 22:15:01 +0100 (Sat, 19 Jan 2008)
> New Revision: 1186
>
> Modified:
>    trunk/src/CacheWolf/SpiderGC.java
> Log:
> SpiderGC: Tidied up, improved logging functions. Note: The proxy feature  
> still needs to be tested, I have no proxy.
>
>
> Modified: trunk/src/CacheWolf/SpiderGC.java
> ===================================================================
> --- trunk/src/CacheWolf/SpiderGC.java	2008-01-19 16:05:18 UTC (rev 1185)
> +++ trunk/src/CacheWolf/SpiderGC.java	2008-01-19 21:15:01 UTC (rev 1186)
> @@ -100,13 +100,13 @@
>  		infB = new InfoBox(MyLocale.getMsg(5507,"Status"),  
> MyLocale.getMsg(5508,"Logging in..."));
>  		infB.exec();
>  		try{
> -			pref.log("Fetching login page");
> +			pref.log("[login]:Fetching login page");
>  			//Access the page once to get a viewstate
>  			start = fetch(loginPage);    
> //http://www.geocaching.com/login/Default.aspx
>  		} catch(Exception ex){
>  			infB.close(0);
>  			(new MessageBox(MyLocale.getMsg(5500,"Error"),  
> MyLocale.getMsg(5499,"Error loading login page"),  
> MessageBox.OKB)).execute();
> -			pref.log("Could not fetch: gc.com login page",ex);
> +			pref.log("[login]:Could not fetch: gc.com login page",ex);
>  			passwort="";
>  			return ERR_LOGIN;
>  		}
> @@ -120,20 +120,20 @@
>  				viewstate = rexViewstate.stringMatched(1);
>  				//Vm.debug("ViewState: " + viewstate);
>  			} else
> -				pref.log("Viewstate not found before login");
> +				pref.log("[login]:Viewstate not found before login");
>  			
>  			if(start.indexOf(loginSuccess) > 0)
> -				pref.log("Already logged in");
> +				pref.log("[login]:Already logged in");
>  			else {
>  				rexEventvalidation.search(start);
>  				if(rexEventvalidation.didMatch()){
>  					eventvalidation = rexEventvalidation.stringMatched(1);
>  					//Vm.debug("EVENTVALIDATION: " + eventvalidation);
>  				} else
> -					pref.log("Eventvalidation not found before login");
> +					pref.log("[login]:Eventvalidation not found before login");
>  				//Ok now login!
>  				try{
> -					pref.log("Logging in as "+pref.myAlias);
> +					pref.log("[login]:Logging in as "+pref.myAlias);
>  					StringBuffer sb=new StringBuffer(1000);
>  					sb.append(URL.encodeURL("__VIEWSTATE",false));	sb.append("=");  
> sb.append(URL.encodeURL(viewstate,false));
>  					sb.append("&"); sb.append(URL.encodeURL("myUsername",false));
> @@ -148,15 +148,15 @@
>  					sb.append("="); sb.append(URL.encodeURL(eventvalidation,false));
>  					start = fetch_post(loginPage, sb.toString(), nextPage);  //  
> /login/default.aspx
>  					if(start.indexOf(loginSuccess) > 0)
> -						pref.log("Login successful");
> +						pref.log("[login]:Login successful");
>  					else {
> -						pref.log("Login failed. Wrong Account or Password?");
> +						pref.log("[login]:Login failed. Wrong Account or Password?");
>  						infB.close(0);
>  						(new MessageBox(MyLocale.getMsg(5500,"Error"),  
> MyLocale.getMsg(5501,"Login failed! Wrong account or password?"),  
> MessageBox.OKB)).execute();
>  						return ERR_LOGIN;
>  					}
>  				}catch(Exception ex){
> -					pref.log("Login failed.", ex);
> +					pref.log("[login]:Login failed with exception.", ex);
>  					infB.close(0);
>  					(new MessageBox(MyLocale.getMsg(5500,"Error"),  
> MyLocale.getMsg(5501,"Login failed. Error loading page after login."),  
> MessageBox.OKB)).execute();
>  					return ERR_LOGIN;
> @@ -165,18 +165,18 @@
> 			rexViewstate.search(start);
>  			if (!rexViewstate.didMatch()) {
> -				pref.log("Viewstate not found");
> +				pref.log("[login]:Viewstate not found");
>  			}
>  			viewstate = rexViewstate.stringMatched(1);
>  			rexCookieID.search(start);
>  			if (!rexCookieID.didMatch()) {
> -				pref.log("CookieID not found");
> -			}
> -			cookieID = rexCookieID.stringMatched(1);
> +				pref.log("[login]:CookieID not found. Using old one.");
> +			} else
> +				cookieID = rexCookieID.stringMatched(1);
>  			//Vm.debug(cookieID);
>  			rexCookieSession.search(start);
>  			if (!rexCookieSession.didMatch()) {
> -				pref.log("CookieSession not found Using old one.");
> +				pref.log("[login]:CookieSession not found. Using old one.");
>  				//cookieSession="";
>  			} else
>  				cookieSession = rexCookieSession.stringMatched(1);
> @@ -275,6 +275,8 @@
>  			(new MessageBox(MyLocale.getMsg(5500,"Error"),  
> MyLocale.getMsg(5509,"Coordinates for centre must be set"),  
> MessageBox.OKB)).execute();
>  			return;
>  		}
> +		if (System.getProperty("os.name")!=null)pref.log("Operating system:  
> "+System.getProperty("os.name")+"/"+System.getProperty("os.arch"));
> +		if (System.getProperty("java.vendor")!=null)pref.log("Java:  
> "+System.getProperty("java.vendor")+"/"+System.getProperty("java.version"));
>  		// Prepare an index of caches for faster searching
>  		indexDB = new Hashtable(cacheDB.size());
>  		CacheHolder ch;
> @@ -482,7 +484,8 @@
>  					// General Cache Data
>  					//==========
>  					chD.setLatLon(getLatLon(completeWebPage));
> -					if (pref.debug) pref.log("LatLon: " + chD.LatLon);
> +					pref.log("LatLon: " + chD.LatLon);
> +					if (pref.debug) pref.log("chD.pos: " + chD.pos.toString());
>  					if (chD.LatLon.equals("???")) {
>  						pref.log(">>>> Failed to spider Cache. Retry.");
>  						continue; // Restart the spider
> @@ -493,44 +496,44 @@
>  	
>  					pref.log("Getting cache name");
>  					chD.CacheName = SafeXML.cleanback(getName(completeWebPage));
> -					pref.log("Got cache name");
> -					if (pref.debug) pref.log("Name: " + chD.CacheName);
> -	
> +					if (pref.debug) pref.log("Name: " + chD.CacheName); else  
> pref.log("Got name");
> +						
>  					pref.log("Trying owner");
>  					chD.CacheOwner =  
> SafeXML.cleanback(getOwner(completeWebPage)).trim();
>  					if(chD.CacheOwner.equals(pref.myAlias) ||  
> (pref.myAlias2.length()>0 && chD.CacheOwner.equals(pref.myAlias2)))  
> chD.is_owned = true;
> -					pref.log("Got owner");
>  					if (pref.debug) pref.log("Owner: " + chD.CacheOwner +"; is_owned =  
> "+chD.is_owned+";  alias1,2 = ["+pref.myAlias+"|"+pref.myAlias2+"]");
> -	
> +					else pref.log("Got owner");
> +
> +						
>  					pref.log("Trying date hidden");
>  					chD.DateHidden =  
> DateFormat.MDY2YMD(getDateHidden(completeWebPage));
> -					pref.log("Got date hidden");
>  					if (pref.debug) pref.log("Hidden: " + chD.DateHidden);
> -	
> +					else pref.log("Got date hidden");
> +					
>  					pref.log("Trying hints");
>  					chD.setHints(getHints(completeWebPage));
> -					pref.log("Got hints");
>  					if (pref.debug) pref.log("Hints: " + chD.Hints);
> -	
> +					else pref.log("Got hints");
> +					
>  					pref.log("Trying size");
>  					chD.CacheSize = getSize(completeWebPage);
> -					pref.log("Got size");
>  					if (pref.debug) pref.log("Size: " + chD.CacheSize);
> +					else pref.log("Got size");
>  	
>  					pref.log("Trying difficulty");
>  					chD.hard = getDiff(completeWebPage);
> -					pref.log("Got difficulty");
>  					if (pref.debug) pref.log("Hard: " + chD.hard);
> +					else pref.log("Got difficulty");
>  	
>  					pref.log("Trying terrain");
>  					chD.terrain = getTerr(completeWebPage);
> -					pref.log("Got terrain");
>  					if (pref.debug) pref.log("Terr: " + chD.terrain);
> +					else pref.log("Got terrain");
>  	
>  					pref.log("Trying cache type");
>  					chD.type = getType(completeWebPage);
> -					pref.log("Got cache type");
>  					if (pref.debug) pref.log("Type: " + chD.type);
> +					else pref.log("Got cache type");
>  	
>  					//==========
>  					// Logs
> @@ -1089,214 +1092,92 @@
>  	*	it will be a gc.com address. This method is used to obtain
>  	*	the result of a search for caches screen.
>  	*/
> -	public static String fetch(String address)
> -	   	{
> -			CharArray c_data;
> -			String data="";
> -			try{
> -				//Vm.debug(address);
> -				HttpConnection conn;
> -				if(pref.myproxy.length() > 0 && pref.proxyActive){
> -					pref.log("Using proxy: " + pref.myproxy + " / " +pref.myproxyport);
> -					conn = new HttpConnection(pref.myproxy,  
> Convert.parseInt(pref.myproxyport), address);
> -					//Vm.debug(address);
> -				} else {
> -					conn = new HttpConnection(address);
> -				}
> -				conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U;  
> Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
> -				if(cookieSession.length()>0){
> -					conn.setRequestorProperty("Cookie",  
> "ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
> -					pref.log("Cookie Zeug: " + "Cookie:  
> ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
> -				} else
> -					pref.log("No Cookie found");
> -				conn.setRequestorProperty("Connection", "close");
> -				conn.documentIsEncoded = true;
> -				pref.log("Connecting");
> -				Socket sock = conn.connect();
> -				pref.log("Connect ok!");
> -				ByteArray daten = conn.readData(sock);
> -				pref.log("Read socket ok");
> -				JavaUtf8Codec codec = new JavaUtf8Codec();
> -				c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
> -
> -				/*
> -				 * prepend the response headers to the document
> -				 * like non-linux Ewe does
> -				 *
> -				 * @TODO directly use the properties in the
> -				 * code which calls this method instead
> -				 */
> -				PropertyList pl = conn.documentProperties;
> -				if (pl != null) {
> -					StringBuffer sb = new StringBuffer();
> -					boolean gotany = false;
> -
> -					for (int i = 0; i < pl.size(); i++) {
> -						Property p = (Property)pl.get(i);
> -						if (p.value != null) {
> -							sb.append(p.name + ": " + p.value + "\r\n");
> -							gotany = true;
> -						}
> -					}
> -					if (gotany)
> -						data += sb.toString() + "\r\n";
> -				}
> -				data += c_data.toString();
> -				//Vm.debug("SpiderGC.fetch() result = " + data);
> -				sock.close();
> -			}catch(IOException ioex){
> -				pref.log("IOException in fetch", ioex);
> -			}finally{
> -				//continue
> -			}
> -			return data;
> +	public static String fetch(String address) {
> +		CharArray c_data;
> +		try{
> +			HttpConnection conn;
> +			if(pref.myproxy.length() > 0 && pref.proxyActive){
> +				pref.log("[fetch]:Using proxy: " + pref.myproxy + " / "  
> +pref.myproxyport);
> +			}
> +			conn = new HttpConnection(address);
> +			conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U;  
> Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
> +			if(cookieSession.length()>0){
> +				conn.setRequestorProperty("Cookie",  
> "ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
> +				pref.log("[fetch]:Cookie Zeug: " + "Cookie:  
> ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
> +			} else
> +				pref.log("[fetch]:No Cookie found");
> +			conn.setRequestorProperty("Connection", "close");
> +			conn.documentIsEncoded = true;
> +			if (pref.debug) pref.log("[fetch]:Connecting");
> +			Socket sock = conn.connect();
> +			if (pref.debug) pref.log("[fetch]:Connect ok!");
> +			ByteArray daten = conn.readData(sock);
> +			if (pref.debug) pref.log("[fetch]:Read data ok");
> +			JavaUtf8Codec codec = new JavaUtf8Codec();
> +			c_data = codec.decodeText(daten.data, 0, daten.length, true, null);
> +			sock.close();
> +			return getResponseHeaders(conn)+ c_data.toString();
> +		}catch(IOException ioex){
> +			pref.log("IOException in fetch", ioex);
> +		}finally{
> +			//continue
>  		}
> +		return "";
> +	}
> 	/**
>  	*	After a fetch to gc.com the next fetches have to use the post method.
>  	*	This method does exactly that. Actually this method is generic in  
> the sense
>  	*	that it can be used to post to a URL using http post.
>  	*/
> -	private static String fetch_post(String address, String document,  
> String path) throws IOException
> -	   	{
> -
> -			//String line = "";
> -			String totline = "";
> -			if(!pref.proxyActive){
> -				try {
> -					/*
> -					// Create a socket to the host
> -					String hostname = "www.geocaching.com";
> -					int port = 80;
> -					InetAddress addr = InetAddress.getByName(hostname);
> -					Socket socket = new Socket(hostname, port);
> -					// Send header
> -					//String path = "/seek/nearest.aspx";
> -					BufferedWriter wr = new BufferedWriter(new  
> OutputStreamWriter(socket.getOutputStream(), "UTF8"));
> -					BufferedReader rd = new BufferedReader(new  
> InputStreamReader(socket.getInputStream()));
> -					wr.write("POST "+path+" HTTP/1.1\r\n");
> -					wr.write("Host: www.geocaching.com\r\n");
> -					if(cookieSession.length()>0){
> -						wr.write("Cookie: ASP.NET_SessionId="+cookieSession +";  
> userid="+cookieID);
> -					}
> -					Vm.debug("Doc length: " + document.length());
> -					wr.write("Content-Length: "+document.length()+"\r\n");
> -					wr.write("Content-Type: application/x-www-form-urlencoded\r\n");
> -					wr.write("Connection: close\r\n");
> -					wr.write("\r\n");
> -					// Send data
> -					wr.write(document);
> -					wr.write("\r\n");
> -					wr.flush();
> -					//Vm.debug("Sent the data!");
> -					// Get response
> -					while ((line = rd.readLine()) != null) {
> -						totline += line + "\n";
> -					}
> -					wr.close();
> -					rd.close();
> -					*/
> -					HttpConnection conn;
> -					conn = new HttpConnection(address);
> -					JavaUtf8Codec codec = new JavaUtf8Codec();
> -					conn.documentIsEncoded = true;
> -					//Vm.debug(address + " / " + document);
> -					//document = document + "\r\n";
> -					//conn.setPostData(document.toCharArray());
> -					conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U;  
> Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
> -					conn.setPostData(codec.encodeText(document.toCharArray(),0,document.length(),true,null));
> -					conn.setRequestorProperty("Content-Type",  
> "application/x-www-form-urlencoded");
> -					if(cookieSession.length()>0){
> -						if (cookieSession!=null) conn.setRequestorProperty("Cookie",  
> "ASP.NET_SessionId="+cookieSession+"; userid="+cookieID);
> -					}
> -					conn.setRequestorProperty("Connection", "close");
> -					Socket sock = conn.connect();
> -
> -					//Vm.debug("getting stuff!");
> -					ByteArray daten = conn.readData(sock);
> -					//Vm.debug("coming back!");
> -					CharArray c_data = codec.decodeText(daten.data, 0, daten.length,  
> true, null);
> -					sock.close();
> -					//Vm.debug(c_data.toString());
> -					totline = "";
> -
> -					/*
> -					 * prepend the response headers to the document
> -					 * like non-linux Ewe does
> -					 *
> -					 * @TODO directly use the properties in the
> -					 * code which calls this method instead
> -					 */
> -					PropertyList pl = conn.documentProperties;
> -					if (pl != null) {
> -						StringBuffer sb = new StringBuffer();
> -						boolean gotany = false;
> -
> -						for (int i = 0; i < pl.size(); i++) {
> -							Property p = (Property)pl.get(i);
> -							if (p.value != null) {
> -								sb.append(p.name + ": " + p.value + "\r\n");
> -								gotany = true;
> -							}
> -						}
> -						if (gotany)
> -							totline += sb.toString() + "\r\n";
> -					}
> -					totline += c_data.toString();
> -				} catch (Exception e) {
> -				}
> +	private static String fetch_post(String address, String document,  
> String path) throws IOException {
> +		HttpConnection conn;
> +		try {
> +			conn = new HttpConnection(address);
> +			JavaUtf8Codec codec = new JavaUtf8Codec();
> +			conn.documentIsEncoded = true;
> +			conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U;  
> Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
> +			conn.setPostData(codec.encodeText(document.toCharArray(),0,document.length(),true,null));
> +			conn.setRequestorProperty("Content-Type",  
> "application/x-www-form-urlencoded");
> +			if(cookieSession.length()>0){
> +				conn.setRequestorProperty("Cookie",  
> "ASP.NET_SessionId="+cookieSession+"; userid="+cookieID);
> +				pref.log("[fetch]:Cookie Zeug: " + "Cookie:  
> ASP.NET_SessionId="+cookieSession +"; userid="+cookieID);
>  			} else {
> -				HttpConnection conn;
> -				conn = new HttpConnection(pref.myproxy,  
> Convert.parseInt(pref.myproxyport), address);
> -				JavaUtf8Codec codec = new JavaUtf8Codec();
> -				conn.documentIsEncoded = true;
> -				//Vm.debug(address + " / " + document);
> -				//document = document + "\r\n";
> -				//conn.setPostData(document.toCharArray());
> -				conn.setRequestorProperty("User-Agent", "Mozilla/5.0 (Windows; U;  
> Windows NT 5.1; en-US; rv:1.7.5) Gecko/20041107 Firefox/1.0");
> -				conn.setPostData(codec.encodeText(document.toCharArray(),0,document.length(),true,null));
> -				conn.setRequestorProperty("Content-Type",  
> "application/x-www-form-urlencoded");
> -				if(cookieSession.length()>0){
> -					conn.setRequestorProperty("Cookie",  
> "ASP.NET_SessionId="+cookieSession+"; userid="+cookieID);
> -				}
> -				conn.setRequestorProperty("Connection", "close");
> -				Socket sock = conn.connect();
> +				pref.log("[fetch]:No Cookie found");
> +			}
> +			conn.setRequestorProperty("Connection", "close");
> +			if (pref.debug) pref.log("[fetch]:Connecting");
> +			Socket sock = conn.connect();
> +			if (pref.debug) pref.log("[fetch]:Connect ok!");
> +			ByteArray daten = conn.readData(sock);
> +			if (pref.debug) pref.log("[fetch]:Read data ok");
> +			CharArray c_data = codec.decodeText(daten.data, 0, daten.length,  
> true, null);
> +			sock.close();
> +			return getResponseHeaders(conn)+c_data.toString();
> +		} catch (Exception e) {	}
> +		return "";
> +	}
> -				//Vm.debug("getting stuff!");
> -				ByteArray daten = conn.readData(sock);
> -				//Vm.debug("coming back!");
> -				CharArray c_data = codec.decodeText(daten.data, 0, daten.length,  
> true, null);
> -				sock.close();
> -				//Vm.debug(c_data.toString());
> -				totline = "";
> +	private static String getResponseHeaders(HttpConnection conn) {
> +		PropertyList pl = conn.documentProperties;
> +		if (pl != null) {
> +			StringBuffer sb = new StringBuffer(1000);
> +			boolean gotany = false;
> -				/*
> -				 * prepend the response headers to the document
> -				 * like non-linux Ewe does
> -				 *
> -				 * @TODO directly use the properties in the
> -				 * code which calls this method instead
> -				 */
> -				PropertyList pl = conn.documentProperties;
> -				if (pl != null) {
> -					StringBuffer sb = new StringBuffer();
> -					boolean gotany = false;
> -
> -					for (int i = 0; i < pl.size(); i++) {
> -						Property p = (Property)pl.get(i);
> -						if (p.value != null) {
> -							sb.append(p.name + ": " + p.value + "\r\n");
> -							gotany = true;
> -						}
> -					}
> -					if (gotany)
> -						totline += sb.toString() + "\r\n";
> +			for (int i = 0; i < pl.size(); i++) {
> +				Property p = (Property)pl.get(i);
> +				if (p.value != null) {
> +					sb.append(p.name).append(": ").append(p.value).append("\r\n");
> +					gotany = true;
>  				}
> -				totline += c_data.toString();
>  			}
> -			return totline;
> +			if (gotany)
> +				return sb.toString() + "\r\n";
>  		}
> -
> +		return "";
> +	}
> +	
> +	
>  	final static String hex = ewe.util.TextEncoder.hex;
> 	public String encodeUTF8URL(byte[] what) {
>
> _______________________________________________
> Cachewolf-svn mailing list
> Cachewolf-svn at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/cachewolf-svn




From salzkammergut at mail.berlios.de  Sun Jan 20 16:32:41 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 20 Jan 2008 16:32:41 +0100
Subject: [Cachewolf-svn] r1187 - trunk/src/CacheWolf
Message-ID: <200801201532.m0KFWfL7005238@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-20 16:32:37 +0100 (Sun, 20 Jan 2008)
New Revision: 1187

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: The "cache_available" status is updated from the main list of caches (without fetching the cache details).

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-01-19 21:15:01 UTC (rev 1186)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-01-20 15:32:37 UTC (rev 1187)
@@ -370,9 +370,28 @@
 					//Vm.debug(getDist(lineRex.stringMatched(1)) + " / " +getWP(lineRex.stringMatched(1)));
 					found_on_page++;
 					if(getDist(lineRex.stringMatched(1)) <= distance){
-						if(indexDB.get((String)getWP(lineRex.stringMatched(1))) == null){
-							cachesToLoad.add(getWP(lineRex.stringMatched(1)));
-						} else pref.log(getWP(lineRex.stringMatched(1))+" already in DB");
+						String waypoint=getWP(lineRex.stringMatched(1));
+						Integer nr;
+						if((nr=(Integer)indexDB.get(waypoint)) == null){
+							cachesToLoad.add(waypoint);
+						} else {
+							pref.log(waypoint+" already in DB");
+							ch=(CacheHolder) cacheDB.get(nr.intValue());
+							// If the <strike> tag is used, the cache is marked as unavailable or archived
+							boolean is_archived_GC=lineRex.stringMatched(1).indexOf("<strike><font color=\"red\">")!=-1;
+							boolean is_available_GC=lineRex.stringMatched(1).indexOf("<strike>")==-1;
+							if (ch.is_archived!=is_archived_GC) { // Update the database with the cache status
+								pref.log("Updating status of "+waypoint+" to "+(is_archived_GC?"archived":"not archived"));
+								ch.is_archived=is_archived_GC;
+								chD=ch.getCacheDetails(true,false);
+								ch.detailsAdded();
+							} else if (ch.is_available!=is_available_GC) { // Update the database with the cache status
+								pref.log("Updating status of "+waypoint+" to "+(is_available_GC?"available":"not available"));
+								ch.is_available=is_available_GC;
+								chD=ch.getCacheDetails(true,false);
+								ch.detailsAdded();
+							}
+						}
 					} else distance = 0;
 					lineRex.searchFrom(dummy, lineRex.matchedTo());
 				}



From natureshadow at mail.berlios.de  Sun Jan 20 22:34:09 2008
From: natureshadow at mail.berlios.de (natureshadow at mail.berlios.de)
Date: Sun, 20 Jan 2008 22:34:09 +0100
Subject: [Cachewolf-svn] r1188 - trunk/resources
Message-ID: <200801202134.m0KLY9n2012442@sheep.berlios.de>

Author: natureshadow
Date: 2008-01-20 22:33:39 +0100 (Sun, 20 Jan 2008)
New Revision: 1188

Added:
   trunk/resources/108_32x32.png
   trunk/resources/bug_32x32.png
   trunk/resources/bug_no_32x32.gif
   trunk/resources/date_time_32x32.png
   trunk/resources/descr_32x32.gif
   trunk/resources/details_32x32.gif
   trunk/resources/globe_small_32x32.gif
   trunk/resources/goto_32x32-png
   trunk/resources/goto_32x32.gif
   trunk/resources/more_32x32.gif
   trunk/resources/newwpt_32x32.png
   trunk/resources/no_black_32x32.png
   trunk/resources/notes_32x32.gif
   trunk/resources/solver_32x32.gif
Log:
Added larger icons (32x32) for VGA pdas that have problems displaying the standard icons in a reasonable size.


Added: trunk/resources/108_32x32.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/108_32x32.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/bug_32x32.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/bug_32x32.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/bug_no_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/bug_no_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/date_time_32x32.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/date_time_32x32.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/descr_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/descr_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/details_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/details_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/globe_small_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/globe_small_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/goto_32x32-png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/goto_32x32-png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/goto_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/goto_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/more_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/more_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/newwpt_32x32.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/newwpt_32x32.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/no_black_32x32.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/no_black_32x32.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/notes_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/notes_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/solver_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/solver_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From natureshadow at mail.berlios.de  Mon Jan 21 01:24:48 2008
From: natureshadow at mail.berlios.de (natureshadow at mail.berlios.de)
Date: Mon, 21 Jan 2008 01:24:48 +0100
Subject: [Cachewolf-svn] r1189 - trunk/resources
Message-ID: <200801210024.m0L0OmLd007802@sheep.berlios.de>

Author: natureshadow
Date: 2008-01-21 01:24:42 +0100 (Mon, 21 Jan 2008)
New Revision: 1189

Modified:
   trunk/resources/108_32x32.png
   trunk/resources/bug_32x32.png
   trunk/resources/bug_no_32x32.gif
   trunk/resources/date_time_32x32.png
   trunk/resources/descr_32x32.gif
   trunk/resources/details_32x32.gif
   trunk/resources/globe_small_32x32.gif
   trunk/resources/more_32x32.gif
   trunk/resources/newwpt_32x32.png
   trunk/resources/no_black_32x32.png
   trunk/resources/notes_32x32.gif
   trunk/resources/solver_32x32.gif
Log:
32x32 icons are now really that size, not only in their names :-P


Modified: trunk/resources/108_32x32.png
===================================================================
(Binary files differ)

Modified: trunk/resources/bug_32x32.png
===================================================================
(Binary files differ)

Modified: trunk/resources/bug_no_32x32.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/date_time_32x32.png
===================================================================
(Binary files differ)

Modified: trunk/resources/descr_32x32.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/details_32x32.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/globe_small_32x32.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/more_32x32.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/newwpt_32x32.png
===================================================================
(Binary files differ)

Modified: trunk/resources/no_black_32x32.png
===================================================================
(Binary files differ)

Modified: trunk/resources/notes_32x32.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/solver_32x32.gif
===================================================================
(Binary files differ)



From pfeffer at mail.berlios.de  Wed Jan 23 22:15:34 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 23 Jan 2008 22:15:34 +0100
Subject: [Cachewolf-svn] r1190 - in trunk: resources src/CacheWolf
Message-ID: <200801232115.m0NLFYbf025610@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-23 22:15:30 +0100 (Wed, 23 Jan 2008)
New Revision: 1190

Added:
   trunk/resources/projecttab.gif
   trunk/resources/projecttab_32x32.gif
   trunk/resources/radar_32x32.gif
Modified:
   trunk/resources/goto_32x32.gif
   trunk/src/CacheWolf/MainTab.java
Log:
MainTab: make use of the new bigger symbols if the screen width is more than 400 pixels and the device is mobile (Vm.isMobile) - Please test on a VGA-PDA

Modified: trunk/resources/goto_32x32.gif
===================================================================
(Binary files differ)

Added: trunk/resources/projecttab.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/projecttab.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/projecttab_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/projecttab_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/radar_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/radar_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-01-21 00:24:42 UTC (rev 1189)
+++ trunk/src/CacheWolf/MainTab.java	2008-01-23 21:15:30 UTC (rev 1190)
@@ -50,38 +50,41 @@
 		this.statBar=statBar;
 		MyLocale.setSIPButton();
 		//Don't expand tabs if the screen is very narrow, i.e. HP IPAQ 65xx, 69xx
-		if (MyLocale.getScreenWidth() <= 240) this.dontExpandTabs=true;
+		int sw = MyLocale.getScreenWidth();
+		if ( sw <= 240) this.dontExpandTabs=true;
+		String imagesize="";
+		if (Vm.isMobile() && sw >= 400) imagesize="_32x32";  
 		calcP = new CalcPanel(); // Init here so that Global.MainT is already set
 		tbP = new TablePanel(pref, profile, statBar);
 		Card c = this.addCard(new TableForm(tbP), MyLocale.getMsg(1200,"List"), null);
-
+		
 		c = this.addCard(detP, MyLocale.getMsg(1201,"Details"), null);
-		c.iconize(new Image("details.gif"),true);
+		c.iconize(new Image("details"+imagesize+".gif"),true);
 
 		c = this.addCard(descP, MyLocale.getMsg(1202,"Description"), null);
-		c.iconize(new Image("descr.gif"),true);
+		c.iconize(new Image("descr"+imagesize+".gif"),true);
 
 		c = this.addCard(new ScrollBarPanel(imageP = new ImagePanel()), MyLocale.getMsg(1203,"Images"), null);
-		c.iconize(new Image("images.gif"),true);
+		c.iconize(new Image("images"+imagesize+".gif"),true);
 
 		c = this.addCard(hintLP, MyLocale.getMsg(1204,"Hints & Logs"), null);
-		c.iconize(new Image("more.gif"),true);
+		c.iconize(new Image("more"+imagesize+".gif"),true);
 
 		c = this.addCard(solverP = new SolverPanel(pref, profile), MyLocale.getMsg(1205,"Solver"), null);
-		c.iconize(new Image("solver.gif"),true);
+		c.iconize(new Image("solver"+imagesize+".gif"),true);
 
 		c = this.addCard(calcP, MyLocale.getMsg(1206,"Calc"), null);
-		mImage imgCalc=new mImage("ewe/HandHeld.bmp"); imgCalc.transparentColor=new Color(0,255,0);
+		mImage imgCalc=new mImage("projecttab"+imagesize+".gif"); imgCalc.transparentColor=new Color(0,255,0);
 		c.iconize(imgCalc,true);
 
 		nav = new Navigate();
 		c = this.addCard(gotoP = new GotoPanel(nav), "Goto", null);
-		c.iconize(new Image("goto.gif"),true);
+		c.iconize(new Image("goto"+imagesize+".gif"),true);
 		nav.setGotoPanel(gotoP);
 
 		c = this.addCard(radarP, "Radar", null);
 		radarP.setMainTab(this);
-		c.iconize(new Image("radar.gif"),true);
+		c.iconize(new Image("radar"+imagesize+".gif"),true);
 		mnuMain.allowProfileChange(true);
 //		if (pref.noTabs) top.modify(ShrinkToNothing,0);//TODO
 	}



From pfeffer at mail.berlios.de  Wed Jan 23 23:07:15 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 23 Jan 2008 23:07:15 +0100
Subject: [Cachewolf-svn] r1191 - trunk/src/CacheWolf
Message-ID: <200801232207.m0NM7FSx029358@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-23 23:07:08 +0100 (Wed, 23 Jan 2008)
New Revision: 1191

Added:
   trunk/src/CacheWolf/MyScrollBarPanel.java
Modified:
   trunk/src/CacheWolf/CalcPanel.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/GPSPortOptions.java
   trunk/src/CacheWolf/HintLogPanel.java
   trunk/src/CacheWolf/ImageDetailForm.java
   trunk/src/CacheWolf/InfoScreen.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/NotesScreen.java
   trunk/src/CacheWolf/PreferencesScreen.java
   trunk/src/CacheWolf/SolverPanel.java
   trunk/src/CacheWolf/TableColumnChooser.java
   trunk/src/CacheWolf/TablePanel.java
   trunk/src/CacheWolf/TravelbugJourneyScreen.java
   trunk/src/CacheWolf/TravelbugScreen.java
Log:
ScrollBars: change their size automatically with the fontsize (if fontsize == 11 -> scrollbar will default to the old default, which is 15)

Modified: trunk/src/CacheWolf/CalcPanel.java
===================================================================
--- trunk/src/CacheWolf/CalcPanel.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/CalcPanel.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -97,7 +97,7 @@
 		
 		// Output 
 		txtOutput = new TextDisplay(3,1); // Need to limit size for small screens
-		ScrollBarPanel sbp = new ScrollBarPanel(txtOutput);
+		ScrollBarPanel sbp = new MyScrollBarPanel(txtOutput);
 		BottomP.addLast(sbp.setTag(Control.SPAN, new Dimension(4,1)),CellConstants.STRETCH, (CellConstants.FILL|CellConstants.WEST));
 		
 		//add Panels

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -23,7 +23,8 @@
 	public DescriptionPanel(){
 		buttonP.addNext(btnPlus = new mButton("+"),CellConstants.HSTRETCH, (CellConstants.HFILL));
 		buttonP.addLast(btnMinus = new mButton("-"),CellConstants.HSTRETCH, (CellConstants.HFILL));
-		ScrollBarPanel sbp = new ScrollBarPanel(disp, 0);
+		ScrollBarPanel sbp = new MyScrollBarPanel(disp, 0);
+		//sbp.setScrollBarSize(40,40, 20);
 		descP.addLast(sbp);
 		this.addLast(descP);
 		this.addLast(buttonP,CellConstants.HSTRETCH,CellConstants.HFILL);

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/DetailsPanel.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -514,7 +514,7 @@
 			this.setTitle(title);
 			this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
 			disp.setHtml(text);
-			ScrollBarPanel sbp = new ScrollBarPanel(disp, ScrollBarPanel.NeverShowHorizontalScrollers);
+			ScrollBarPanel sbp = new MyScrollBarPanel(disp, ScrollBarPanel.NeverShowHorizontalScrollers);
 			this.addLast(sbp);
 			this.addLast(btCancel = new mButton(MyLocale.getMsg(3000,"Close")),CellConstants.DONTSTRETCH, CellConstants.FILL);
 		}

Modified: trunk/src/CacheWolf/GPSPortOptions.java
===================================================================
--- trunk/src/CacheWolf/GPSPortOptions.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/GPSPortOptions.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -95,7 +95,7 @@
 		btnTest = new mButton("Test$u");
 		ed.addField(ed.addLast(btnTest.setCell(Editor.DONTSTRETCH)),"test");
 		txtOutput = new TextDisplay();
-		ScrollBarPanel sbp = new ScrollBarPanel(txtOutput);
+		ScrollBarPanel sbp = new MyScrollBarPanel(txtOutput);
 		sbp.setOptions(ScrollBarPanel.AlwaysShowVerticalScrollers | ScrollBarPanel.AlwaysShowHorizontalScrollers);
 		ed.addField(ed.addLast(sbp),"out");
 		forwardGpsChkB = new mCheckBox("z");

Modified: trunk/src/CacheWolf/HintLogPanel.java
===================================================================
--- trunk/src/CacheWolf/HintLogPanel.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/HintLogPanel.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -41,7 +41,7 @@
 		int initialHintHeight=Global.getPref().initialHintHeight;
 		if (initialHintHeight<0 || initialHintHeight>1000) initialHintHeight=Global.getPref().DEFAULT_INITIAL_HINT_HEIGHT;
 		hintpane.setPreferredSize(100,initialHintHeight); 
-		ScrollBarPanel sbphint = new ScrollBarPanel(hint);
+		ScrollBarPanel sbphint = new MyScrollBarPanel(hint);
 		hintpane.addLast(sbphint,CellConstants.STRETCH, (CellConstants.FILL|CellConstants.WEST));
 		hintpane.addNext(prevBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		hintpane.addNext(decodeButton,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
@@ -49,7 +49,7 @@
 		hintpane.addLast(moreBt,CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.EAST));
 		hint.modify(Control.NotEditable,0);
 
-		ScrollBarPanel sbplog = new ScrollBarPanel((ScrollClient)htmlImagDisp, ScrollBarPanel.NeverShowHorizontalScrollers);
+		ScrollBarPanel sbplog = new MyScrollBarPanel((ScrollClient)htmlImagDisp, ScrollBarPanel.NeverShowHorizontalScrollers);
 		//logpane.addLast(sbplog,CellConstants.STRETCH, CellConstants.FILL);
 		Rect r = new Rect(new Dimension (Global.getPref().myAppWidth-sbplog.vbar.getRect().width, 20));
 		htmlImagDisp.virtualSize = r;

Modified: trunk/src/CacheWolf/ImageDetailForm.java
===================================================================
--- trunk/src/CacheWolf/ImageDetailForm.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/ImageDetailForm.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -20,7 +20,7 @@
 	ScrollBarPanel scp;
 	
 	public ImageDetailForm(String imgLoc, Preferences p){
-		scp = new ScrollBarPanel(ipp);
+		scp = new MyScrollBarPanel(ipp);
 		setUp(imgLoc, p);
 		this.title = "Image";
 		this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);

Modified: trunk/src/CacheWolf/InfoScreen.java
===================================================================
--- trunk/src/CacheWolf/InfoScreen.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/InfoScreen.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -32,7 +32,7 @@
 			}
 		} else text = datei;
 		disp.setHtml(text);
-		ScrollBarPanel sbp = new ScrollBarPanel(disp, ScrollBarPanel.NeverShowHorizontalScrollers);
+		ScrollBarPanel sbp = new MyScrollBarPanel(disp, ScrollBarPanel.NeverShowHorizontalScrollers);
 		this.addLast(sbp);
 		this.addLast(btCancel = new mButton(MyLocale.getMsg(3000,"Close")),CellConstants.DONTSTRETCH, CellConstants.FILL);
 	}

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/MainTab.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -64,7 +64,7 @@
 		c = this.addCard(descP, MyLocale.getMsg(1202,"Description"), null);
 		c.iconize(new Image("descr"+imagesize+".gif"),true);
 
-		c = this.addCard(new ScrollBarPanel(imageP = new ImagePanel()), MyLocale.getMsg(1203,"Images"), null);
+		c = this.addCard(new MyScrollBarPanel(imageP = new ImagePanel()), MyLocale.getMsg(1203,"Images"), null);
 		c.iconize(new Image("images"+imagesize+".gif"),true);
 
 		c = this.addCard(hintLP, MyLocale.getMsg(1204,"Hints & Logs"), null);

Added: trunk/src/CacheWolf/MyScrollBarPanel.java
===================================================================
--- trunk/src/CacheWolf/MyScrollBarPanel.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/MyScrollBarPanel.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -0,0 +1,17 @@
+package CacheWolf;
+
+import ewe.ui.ScrollBarPanel;
+import ewe.ui.ScrollClient;
+
+public class MyScrollBarPanel extends ScrollBarPanel {
+	public MyScrollBarPanel(ScrollClient client,int options) {
+		super(client, options);
+		int s = java.lang.Math.round(((float)Global.getPref().fontSize) / 11f * 15f); // standard fontsize = 1, standard bottum size = 15
+		setScrollBarSize(s, s, s);
+	}
+	public MyScrollBarPanel(ScrollClient client)
+	{
+		this(client,0);
+	}
+
+}

Modified: trunk/src/CacheWolf/NotesScreen.java
===================================================================
--- trunk/src/CacheWolf/NotesScreen.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/NotesScreen.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -17,7 +17,7 @@
 	mButton addDateTime = new mButton((IImage)new mImage("date_time.png"));
 	mButton btSave = new mButton(MyLocale.getMsg(127,"Save"));
 	mButton cancelBtn = new mButton("Cancel");
-	ScrollBarPanel sbp = new ScrollBarPanel(wayNotes);
+	ScrollBarPanel sbp = new MyScrollBarPanel(wayNotes);
 	
 	public NotesScreen(CacheHolderDetail ch){
 		this.title = "Notes";

Modified: trunk/src/CacheWolf/PreferencesScreen.java
===================================================================
--- trunk/src/CacheWolf/PreferencesScreen.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/PreferencesScreen.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -31,7 +31,7 @@
 	CellPanel pnlMore = new CellPanel();
 	CellPanel pnlTB = new CellPanel();
 	Frame frmGarmin = new Frame();
-	ScrollBarPanel scp;
+	ScrollBarPanel scp; // TODO not neede any more?
 	String [] garminPorts= new String[]{"com1","com2","com3","com4","com5","com6","com7","usb"};
 	
 	public PreferencesScreen (Preferences p){

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/SolverPanel.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -95,7 +95,7 @@
 		outputPanel = split.getNextPanel();
 		split.setSplitter(PanelSplitter.AFTER|PanelSplitter.HIDDEN,PanelSplitter.BEFORE|PanelSplitter.HIDDEN,0);
 
-		programPanel.addLast(new ScrollBarPanel(mText = new InputPanel())).setTag(SPAN, new Dimension(2,1));
+		programPanel.addLast(new MyScrollBarPanel(mText = new InputPanel())).setTag(SPAN, new Dimension(2,1));
 		CellPanel pnlStatButtons=new CellPanel();
 		pnlStatButtons.addNext(btnDegRad=new mButton(getSolverDegMode()),CellConstants.DONTSTRETCH,CellConstants.DONTFILL);
 		btnDegRad.backGround=Color.Sand;

Modified: trunk/src/CacheWolf/TableColumnChooser.java
===================================================================
--- trunk/src/CacheWolf/TableColumnChooser.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/TableColumnChooser.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -27,7 +27,7 @@
         addNext(new mLabel(""));
         addLast(new mLabel(MyLocale.getMsg(6051,"Don't show column")));
         
-        addNext(new ScrollBarPanel(lstShown=new myList(6,shownCols),ScrollBarPanel.AlwaysShowVerticalScrollers));
+        addNext(new MyScrollBarPanel(lstShown=new myList(6,shownCols),ScrollBarPanel.AlwaysShowVerticalScrollers));
         CellPanel cpMid=new CellPanel();
         cpMid.addLast(new mLabel(""));
         mImage imgRight=new mImage("ewe/rightarrowsmall.bmp");imgRight.transparentColor=Color.White;
@@ -37,7 +37,7 @@
         cpMid.addLast(btnLeft=new mButton(imgLeft));
         cpMid.addLast(new mLabel(""));
         addNext(cpMid,VSTRETCH,VFILL);
-        addLast(new ScrollBarPanel(lstHidden=new myList(6,hiddenCols),ScrollBarPanel.AlwaysShowVerticalScrollers));
+        addLast(new MyScrollBarPanel(lstHidden=new myList(6,hiddenCols),ScrollBarPanel.AlwaysShowVerticalScrollers));
         
         CellPanel pnlButtons=new CellPanel();
 		mImage imgDown=new mImage("ewe/downarrowsmall.bmp"); imgDown.transparentColor=Color.White;

Modified: trunk/src/CacheWolf/TablePanel.java
===================================================================
--- trunk/src/CacheWolf/TablePanel.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/TablePanel.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -33,7 +33,7 @@
 		Profile profile=Global.getProfile();
 		this.statBar = statBar;
 		cacheDB = profile.cacheDB;
-		addLast(new ScrollBarPanel(tc = new myTableControl(this)));
+		addLast(new MyScrollBarPanel(tc = new myTableControl(this)));
 		if (statBar!=null) addLast(statBar,CellConstants.DONTSTRETCH, CellConstants.FILL);
 		myMod = new myTableModel(tc, getFontMetrics());
 		myMod.hasRowHeaders = false;

Modified: trunk/src/CacheWolf/TravelbugJourneyScreen.java
===================================================================
--- trunk/src/CacheWolf/TravelbugJourneyScreen.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/TravelbugJourneyScreen.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -77,7 +77,7 @@
 		title="Travelbugs"+cache;
 		tcTbJourneyList=new tbListControl();
 		tcTbJourneyList.setTableModel(modTbJourneyList=new tbListTableModel());
-		tablepane.addLast(new ScrollBarPanel(tcTbJourneyList,ScrollBarPanel.AlwaysShowVerticalScrollers),STRETCH,FILL);
+		tablepane.addLast(new MyScrollBarPanel(tcTbJourneyList,ScrollBarPanel.AlwaysShowVerticalScrollers),STRETCH,FILL);
 	
 		lowerpane = split.getNextPanel();
 		

Modified: trunk/src/CacheWolf/TravelbugScreen.java
===================================================================
--- trunk/src/CacheWolf/TravelbugScreen.java	2008-01-23 21:15:30 UTC (rev 1190)
+++ trunk/src/CacheWolf/TravelbugScreen.java	2008-01-23 22:07:08 UTC (rev 1191)
@@ -22,7 +22,7 @@
 		this.setTitle(title);
 		this.setPreferredSize(240, -1);
 		disp=new myList(tbl,allowNew);
-		ScrollBarPanel sbp = new ScrollBarPanel(disp, ScrollBarPanel.NeverShowHorizontalScrollers);
+		ScrollBarPanel sbp = new MyScrollBarPanel(disp, ScrollBarPanel.NeverShowHorizontalScrollers);
 		this.addLast(sbp);
 		this.addNext(btCancel = new mButton(MyLocale.getMsg(614,"Cancel")),CellConstants.DONTSTRETCH, CellConstants.FILL);
 		this.addLast(btAccept = new mButton("OK"),CellConstants.DONTSTRETCH, CellConstants.FILL);



From pfeffer at mail.berlios.de  Wed Jan 23 23:10:00 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 23 Jan 2008 23:10:00 +0100
Subject: [Cachewolf-svn] r1192 - trunk/src/CacheWolf
Message-ID: <200801232210.m0NMA0Xb029434@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-23 23:09:58 +0100 (Wed, 23 Jan 2008)
New Revision: 1192

Modified:
   trunk/src/CacheWolf/MyScrollBarPanel.java
Log:
Scrollbar: added a comment

Modified: trunk/src/CacheWolf/MyScrollBarPanel.java
===================================================================
--- trunk/src/CacheWolf/MyScrollBarPanel.java	2008-01-23 22:07:08 UTC (rev 1191)
+++ trunk/src/CacheWolf/MyScrollBarPanel.java	2008-01-23 22:09:58 UTC (rev 1192)
@@ -3,6 +3,14 @@
 import ewe.ui.ScrollBarPanel;
 import ewe.ui.ScrollClient;
 
+/**
+ * Always use this class instead of ewe.ui.ScrollBarPanel
+ * as it will change it's size automatically with
+ * the font size, which is entered in the preferences dialog
+ * 
+ * @author pfeffer
+ */
+
 public class MyScrollBarPanel extends ScrollBarPanel {
 	public MyScrollBarPanel(ScrollClient client,int options) {
 		super(client, options);



From pfeffer at mail.berlios.de  Wed Jan 23 23:23:12 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed, 23 Jan 2008 23:23:12 +0100
Subject: [Cachewolf-svn] r1193 - trunk/src/CacheWolf/navi
Message-ID: <200801232223.m0NMNClQ030650@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-23 23:23:10 +0100 (Wed, 23 Jan 2008)
New Revision: 1193

Modified:
   trunk/src/CacheWolf/navi/MapImporter.java
   trunk/src/CacheWolf/navi/MovingMap.java
   trunk/src/CacheWolf/navi/SelectMap.java
Log:
scrollBars: I forgot some

Modified: trunk/src/CacheWolf/navi/MapImporter.java
===================================================================
--- trunk/src/CacheWolf/navi/MapImporter.java	2008-01-23 22:09:58 UTC (rev 1192)
+++ trunk/src/CacheWolf/navi/MapImporter.java	2008-01-23 22:23:10 UTC (rev 1193)
@@ -77,7 +77,7 @@
 			Vm.debug("Cannot load world file!");
 		}
 		mapInteractivePanel pane = new mapInteractivePanel(this);
-		scp = new ScrollBarPanel(pane);
+		scp = new CacheWolf.MyScrollBarPanel(pane);
 		Image img = new Image(Common.getImageName(mapsPath + thisMap));
 		PixelBuffer pB = new PixelBuffer(img);
 		//pB = pB.scale((int)(pref.myAppWidth*0.98),(int)(pref.myAppHeight*0.98));

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2008-01-23 22:09:58 UTC (rev 1192)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2008-01-23 22:23:10 UTC (rev 1193)
@@ -1836,7 +1836,7 @@
 			}
 		}
 		list.selectItem(oldmap, true);
-		this.addLast(scb = new ScrollBarPanel(list),CellConstants.STRETCH, CellConstants.FILL);
+		this.addLast(scb = new CacheWolf.MyScrollBarPanel(list),CellConstants.STRETCH, CellConstants.FILL);
 		cancelButton = new mButton("Cancel");
 		cancelButton.setHotKey(0, KeyEvent.getCancelKey(true));
 		this.addNext(cancelButton,CellConstants.STRETCH, CellConstants.FILL);

Modified: trunk/src/CacheWolf/navi/SelectMap.java
===================================================================
--- trunk/src/CacheWolf/navi/SelectMap.java	2008-01-23 22:09:58 UTC (rev 1192)
+++ trunk/src/CacheWolf/navi/SelectMap.java	2008-01-23 22:23:10 UTC (rev 1193)
@@ -27,8 +27,8 @@
 	
 	public SelectMap(){
 		mapsPath = Global.getPref().getMapManuallySavePath(false)+"/"; //  File.getProgramDirectory() + "/maps/";
-		top = new ScrollBarPanel(CMaps);
-		bot = new ScrollBarPanel(nonCMaps);
+		top = new CacheWolf.MyScrollBarPanel(CMaps);
+		bot = new CacheWolf.MyScrollBarPanel(nonCMaps);
 		this.title = MyLocale.getMsg(4101,"Maps");
 		this.addLast(new mLabel(MyLocale.getMsg(4102,"Calibrated Maps")), CellConstants.STRETCH, CellConstants.FILL);
 		this.addLast(top, CellConstants.STRETCH, CellConstants.FILL);



From pfeffer at mail.berlios.de  Fri Jan 25 00:05:11 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 25 Jan 2008 00:05:11 +0100
Subject: [Cachewolf-svn] r1194 - trunk/res_noewe
Message-ID: <200801242305.m0ON5B8g002125@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-25 00:04:58 +0100 (Fri, 25 Jan 2008)
New Revision: 1194

Added:
   trunk/res_noewe/images_32x32.gif
Log:
For VGA on PDA: one icon was missed in the last commits

Added: trunk/res_noewe/images_32x32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/images_32x32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From pfeffer at mail.berlios.de  Fri Jan 25 20:48:44 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 25 Jan 2008 20:48:44 +0100
Subject: [Cachewolf-svn] r1195 - in trunk: res_noewe/languages
	src/CacheWolf/navi
Message-ID: <200801251948.m0PJmiYR031954@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-25 20:48:22 +0100 (Fri, 25 Jan 2008)
New Revision: 1195

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/navi/MapImporter.java
   trunk/src/CacheWolf/navi/MapInfoObject.java
Log:
Localisation fpr MapImport and MapInfoObject

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-24 23:04:58 UTC (rev 1194)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-25 19:48:22 UTC (rev 1195)
@@ -491,7 +491,23 @@
 		4109=Lade Karten...
 		4110=Lade
 		4111=Koordinaten m%fcssen in dem Format N XX XX,XXX E XXX XX,XXX eingegeben werden
+		4112=E/A-Fehler beim Kopieren von:+
+		4113=+nach:+
+		4114=+Fehler:+
+		4115=Fehler: Kann Bild nicht dekodieren:+
+		4116=+-+Bild nicht kopiert
+		4117=Fehler beim Importieren der .map-Datei:+
+		4118=E/A-Fehler beim Lesen oder Schreiben der Kalibrierungsdatei
+		4119=Keine Kalibrierungsdatei gefunden f?r:+
+		4120=Fertig.
 		4200=Kartenverzeichnis w%e4hlen
+		4300=Leer 1 Punkt =+
+		4301=+meter
+		4302=Breite/L%e4nge au?erhalb des zul%e4ssigen Bereiches beim Lesen von+
+		4303=Zu wenig Zeilen in Datei+
+		4304=Zu wenig Punkte, um die Karte zu kalibrieren
+		4305=Ung?ltige Transformationsparameter%0a (Matrix kann nicht invertiert werden)%0a in der Datei %0a
+		4306=Karte ist nicht georeferenziert
 		4500=Ges:
 		4501=Gez:
 		4502=Gef:

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-24 23:04:58 UTC (rev 1194)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-25 19:48:22 UTC (rev 1195)
@@ -485,7 +485,23 @@
 		4109=Loading maps...
 		4110=loading
 		4111=Coordinates must be entered in the format N XX XX.XXX E XXX XX.XXX
+		4112=IO-Error while copying image from:+
+		4113=to:+
+		4114=+error:+
+		4115=Error: could not decode image:+
+		4116=+-+image not copied
+		4117=Error while importing .map-file:+
+		4118=IO-Error while reading or writing calibration file
+		4119=No calibration file found for:+
+		4120=done.
 		4200=Choose map directory
+		4300=empty 1 Pixel =+
+		4301=+meters
+		4302=Lat/Lon out of range while reading+
+		4303=not enough lines in file+
+		4304=not enough points to calibrate the map
+		4305=Not allowed values in affine%0a (matrix cannot be inverted)%0a in file %0a
+		4306=map not calibrated
 		4500=Tot:
 		4501=Vis:
 		4502=Fnd:

Modified: trunk/src/CacheWolf/navi/MapImporter.java
===================================================================
--- trunk/src/CacheWolf/navi/MapImporter.java	2008-01-24 23:04:58 UTC (rev 1194)
+++ trunk/src/CacheWolf/navi/MapImporter.java	2008-01-25 19:48:22 UTC (rev 1195)
@@ -180,10 +180,10 @@
 				}
 			} catch(IOException ex){
 				imageerror = true;
-				inf.addWarning("\nIO-Error while copying image from: " + curInFullPath + " to: " + curOutFullPath + " error: " + ex.getMessage());
+				inf.addWarning("\n"+MyLocale.getMsg(4112, "IO-Error while copying image from: ") + curInFullPath + MyLocale.getMsg(4113, " to: ") + curOutFullPath + MyLocale.getMsg(4114, " error: ") + ex.getMessage());
 			} catch (IllegalArgumentException e) { // thrown from Image.getImageInfo when it could not interprete the header (e.g. bmp with 32 bits per pixel)
 				imageerror = true;
-				inf.addWarning("\nError: could not decode image: " + curInFullPath + " - image not copied");
+				inf.addWarning("\n"+MyLocale.getMsg(4115, "Error: could not decode image: ") + curInFullPath + MyLocale.getMsg(4116, " - image not copied"));
 			} finally {
 				try {
 					if (in != null) in.close();
@@ -297,16 +297,16 @@
 					} // while
 					if (inMap != null)	inMap.close();
 				} catch(IllegalArgumentException ex){ // is thrown from Convert.toDouble and saveWFL if affine[0-5]==0 NumberFormatException is a subclass of IllegalArgumentExepction
-					inf.addWarning("\nError while importing .map-file: "+ex.getMessage());
+					inf.addWarning("\n"+MyLocale.getMsg(4117, "Error while importing .map-file: ")+ex.getMessage());
 				} catch(IOException ex){
-					inf.addWarning("\nIO-Error while reading or writing calibration file\n" + ex.getMessage());
+					inf.addWarning("\n"+MyLocale.getMsg(4118, "IO-Error while reading or writing calibration file")+"\n" + ex.getMessage());
 				} 
 			} else { // if map file.exists
-				if (!imageerror) inf.addWarning("\nNo calibration file found for: " + currfile + " - you can calibrate it manually");
+				if (!imageerror) inf.addWarning("\n"+MyLocale.getMsg(4119, "No calibration file found for: ") + currfile + " - you can calibrate it manually");
 			}
 		} // for file
 		Vm.showWait(this, false);
-		inf.addText("\ndone.");
+		inf.addText("\n"+MyLocale.getMsg(4120, "done."));
 		inf.addOkButton();
 		//inf.addOkButton(); doesn't work
 		if(Global.mainTab.mm != null) Global.mainTab.mm.mapsloaded = false; 

Modified: trunk/src/CacheWolf/navi/MapInfoObject.java
===================================================================
--- trunk/src/CacheWolf/navi/MapInfoObject.java	2008-01-24 23:04:58 UTC (rev 1194)
+++ trunk/src/CacheWolf/navi/MapInfoObject.java	2008-01-25 19:48:22 UTC (rev 1195)
@@ -25,7 +25,9 @@
 
 
 /**
- * class to read, save and do the calculations for calibrated and calibrating maps
+ * class to read, save and do the calculations for calibrated and 
+ * calibrating maps
+ * start offset for language file: 4300
  * @author pfeffer
  *
  */
@@ -89,7 +91,7 @@
 	 */
 	public MapInfoObject(double scalei, double lat) {
 		super(new CWPoint(1,0), new CWPoint(0,1));
-		mapName="empty 1 Pixel = "+scalei+"meters";
+		mapName=MyLocale.getMsg(4300, "empty 1 Pixel = ") + scalei + MyLocale.getMsg(4301,"meters");
 		double meters2deg = 1/(1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
 		double pixel2deg = meters2deg * scalei;
 		affine[0]=0; //x2lat
@@ -197,10 +199,10 @@
 			if( !buttomright.isValid() ) {
 				affine[0] = 0; affine[1] = 0; affine[2] = 0; affine[3] = 0; 
 				topleft.makeInvalid();
-				throw (new IOException("Lat/Lon out of range while reading "+mapsPath + thisMap + ".wfl"));
+				throw (new IOException(MyLocale.getMsg(4301, "Lat/Lon out of range while reading ")+mapsPath + thisMap + ".wfl"));
 			}
 		} catch (NullPointerException e) { // in.readline liefert null zur?ck, wenn keine Daten mehr vorhanden sind
-			throw (new IOException("not enough lines in file "+mapsPath + thisMap + ".wfl"));
+			throw (new IOException(MyLocale.getMsg(4303, "not enough lines in file ")+mapsPath + thisMap + ".wfl"));
 		}
 		doCalculations();
 		origAffineUpperLeft = new CWPoint(affineTopleft);
@@ -219,7 +221,7 @@
 		//N 48 16.000 E 11 32.000
 		//N 48 16.000 E 11 50.000
 		//N 48 9.000 E 11 32.000
-		if (GCPs.size() < 3 ) throw new IllegalArgumentException("not enough points to calibrate the map");
+		if (GCPs.size() < 3 ) throw new IllegalArgumentException(MyLocale.getMsg(4304, "not enough points to calibrate the map"));
 		GCPoint gcp = new GCPoint();
 		//Calculate parameters for latitutde affine transformation (affine 0,2,4)
 		Matrix X = new Matrix(GCPs.size(),3);
@@ -311,12 +313,12 @@
 			// double metersPerLat = 1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0));
 			CWPoint buttomleftimage = topleft.project(rotationRad * 180 / Math.PI + 180, heightkm);
 			CWPoint buttomleftimage2 = calcLatLon(0, heightpixel);
-			double kw = buttomleftimage.getDistance(buttomleftimage2);
-			double kw2 = buttomleftimage.getBearing(buttomleftimage2);
-			Vm.debug("project test: " + buttomleftimage.getDistance(topleft));
+			//double kw = buttomleftimage.getDistance(buttomleftimage2);
+			//double kw2 = buttomleftimage.getBearing(buttomleftimage2);
+			//Vm.debug("project test: " + buttomleftimage.getDistance(topleft));
 			// double heightpixel = calcMapXY(buttomleftimage).y / Math.cos(rotationRad); 
 			scale = (float) (heightkm * 1000 / heightpixel); 
-		} catch (ArithmeticException ex) { throw new ArithmeticException("Not allowed values in affine\n (matrix cannot be inverted)\n in file \n" + fileNameWFL); }
+		} catch (ArithmeticException ex) { throw new ArithmeticException(MyLocale.getMsg(4305, "Not allowed values in affine\n (matrix cannot be inverted)\n in file \n") + fileNameWFL); }
 	}
 
 	public void saveWFL() throws IOException, IllegalArgumentException {
@@ -334,17 +336,19 @@
 	 */
 	public void saveWFL(String mapsPath, String mapFileName) throws IOException, IllegalArgumentException {
 		if (affine[0]==0 && affine[1]==0 && affine[2]==0 && affine[3]==0 && 
-				!topleft.isValid()) throw (new IllegalArgumentException("map not calibrated"));
+				!topleft.isValid()) throw (new IllegalArgumentException(MyLocale.getMsg(4306, "map not calibrated")));
 		PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(mapsPath + "/" + mapFileName + ".wfl")));
-		String towrite=Convert.toString(affine[0])+"\n" +
-		Convert.toString(affine[1])+"\n" +
-		Convert.toString(affine[2])+"\n" + 
-		Convert.toString(affine[3])+"\n" + 
-		Convert.toString(affineTopleft.latDec)+"\n" +
-		Convert.toString(affineTopleft.lonDec)+"\n" +
-		Convert.toString(buttomright.latDec)+"\n" +
-		Convert.toString(buttomright.lonDec)+"\n" + 
-		((coordTrans == 0 || coordTrans == TransformCoordinates.EPSG_WGS84) ? "" : Convert.toString(coordTrans)+"\n");
+		StringBuffer towriteB=new StringBuffer(400);
+		towriteB.append(Convert.toString(affine[0])).append("\n");
+		towriteB.append(Convert.toString(affine[1])).append("\n");
+		towriteB.append(Convert.toString(affine[2])).append("\n");
+		towriteB.append(Convert.toString(affine[3])).append("\n");
+		towriteB.append(Convert.toString(affineTopleft.latDec)).append("\n");
+		towriteB.append(Convert.toString(affineTopleft.lonDec)).append("\n");
+		towriteB.append(Convert.toString(buttomright.latDec)).append("\n");
+		towriteB.append(Convert.toString(buttomright.lonDec)).append("\n");
+		towriteB.append(((coordTrans == 0 || coordTrans == TransformCoordinates.EPSG_WGS84) ? "" : Convert.toString(coordTrans)+"\n"));
+		String towrite = towriteB.toString();
 		if (digSep.equals(",")) towrite=towrite.replace(',', '.');
 		outp.print(towrite);
 		outp.close();



From pfeffer at mail.berlios.de  Fri Jan 25 21:06:01 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Fri, 25 Jan 2008 21:06:01 +0100
Subject: [Cachewolf-svn] r1196 - trunk/src/CacheWolf/navi
Message-ID: <200801252006.m0PK61So000417@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-25 21:05:48 +0100 (Fri, 25 Jan 2008)
New Revision: 1196

Removed:
   trunk/src/CacheWolf/navi/MapDetailForm.java
Log:
removed long outdated java file MapDetailForm.java

Deleted: trunk/src/CacheWolf/navi/MapDetailForm.java
===================================================================
--- trunk/src/CacheWolf/navi/MapDetailForm.java	2008-01-25 19:48:22 UTC (rev 1195)
+++ trunk/src/CacheWolf/navi/MapDetailForm.java	2008-01-25 20:05:48 UTC (rev 1196)
@@ -1,65 +0,0 @@
-package CacheWolf.navi;
-import CacheWolf.ImageDetailForm;
-import CacheWolf.MyLocale;
-import CacheWolf.Preferences;
-import CacheWolf.Profile;
-import ewe.graphics.*;
-import ewe.sys.*;
-import ewe.fx.*;
-import ewe.ui.*;
-import ewe.util.*;
-
-/**
- *	Class to display map images in different zoom levels.
- *	Extends ImageDetailForm that handles the resizing to screen
- *	size. The extension in this class handles the switching between
- *	different (map) images.
- */
-public class MapDetailForm extends ImageDetailForm {
- /* // it's obsolete since we have a well working moving map 
-	mButton btSwitch;
-	String cache;
-	String imgLoc = new String();
-	int status = 0;
-	Profile profile;
-	
-	public MapDetailForm(String cacheName, Preferences p, Profile prof){
-		profile=prof;  // keep ref for later use
-		cache=cacheName;
-		imgLoc = prof.dataDir + cacheName + "_map.gif";
-		scp = new ScrollBarPanel(ipp);
-		setUp(imgLoc, p);
-		this.title = "Maps";
-		this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
-		this.addLast(scp.getScrollablePanel(), this.STRETCH, this.FILL);
-		CellPanel butPanel = new CellPanel();
-		btSwitch = new mButton("Zoom");
-		butPanel.addLast(btSwitch);
-		this.addLast(butPanel, this.HSTRETCH, this.FILL);
-	}
-
-	public void onEvent(Event ev){
-		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
-			if (ev.target == btSwitch){
-				ipp.removeImage(ai);
-				imgLoc = profile.dataDir + cache;
-				if(status == 0) {
-					imgLoc = imgLoc + "_map_2.gif";
-					status = 1;
-				} else {
-					imgLoc = imgLoc + "_map.gif";
-					status = 0;
-				}
-				try {
-					setUp(imgLoc, pref);
-					this.repaintNow();
-				} catch (IllegalArgumentException e) {
-					MessageBox tmp = new MessageBox(MyLocale.getMsg(321,"Fehler"), MyLocale.getMsg(322,"Kann Bild/Karte nicht finden")+": "+imgLoc, MessageBox.OKB); // @todo: language support
-					tmp.exec();
-				}
-			}
-		}
-	}
-	*/
-}
-



From mik77 at mail.berlios.de  Fri Jan 25 22:47:26 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 25 Jan 2008 22:47:26 +0100
Subject: [Cachewolf-svn] r1197 - trunk/src/CacheWolf
Message-ID: <200801252147.m0PLlQYB007162@sheep.berlios.de>

Author: mik77
Date: 2008-01-25 22:47:24 +0100 (Fri, 25 Jan 2008)
New Revision: 1197

Modified:
   trunk/src/CacheWolf/CWPoint.java
Log:
Allow negative values in GK coordinates

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2008-01-25 20:05:48 UTC (rev 1196)
+++ trunk/src/CacheWolf/CWPoint.java	2008-01-25 21:47:24 UTC (rev 1197)
@@ -216,7 +216,7 @@
 									")|(?:" +
 									"([0-9]{1,2}[C-HJ-PQ-X])\\s*[EeOo]?\\s*([0-9]{1,7})\\s+[Nn]?\\s*([0-9]{1,7})" +
 									")|(?:" +
-									"[Rr]:?\\s*([0-9]{1,7})\\s+[Hh]:?\\s*([0-9]{1,7})" +
+									"[Rr]:?\\s*([+-]?[0-9]{1,7})\\s+[Hh]:?\\s*([+-]?[0-9]{1,7})" +
 									")"); 
 				this.latDec = -91; // return unset / unvalid values if parsing was not successfull
 				this.lonDec = -361;



From pfeffer at mail.berlios.de  Sun Jan 27 20:07:47 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 27 Jan 2008 20:07:47 +0100
Subject: [Cachewolf-svn] r1198 - in trunk: res_noewe/languages
	src/CacheWolf/navi
Message-ID: <200801271907.m0RJ7ltH010005@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-27 20:07:32 +0100 (Sun, 27 Jan 2008)
New Revision: 1198

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/navi/MapInfoObject.java
   trunk/src/CacheWolf/navi/MovingMap.java
   trunk/src/CacheWolf/navi/Navigate.java
   trunk/src/CacheWolf/navi/SkyOrientation.java
   trunk/src/CacheWolf/navi/TransformCoordinates.java
   trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java
Log:
navi: languages lokalised for a big part, mainly in the MovingMap

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-27 19:07:32 UTC (rev 1198)
@@ -127,7 +127,7 @@
 		323=Fehler beim Schreiben der Datei
 		324= - neu versuchen?
 		325=Zuwenige Referenzpunkte, Karte nicht kalibriert
-		326=Es steht keine kalibrierte Karte zur Verf%fcgung %0a Bitte w%e4hlen Sie einen Ma%dfstab,%0a in dem der Track und die markierten Caches angezeigt werden sollen
+		326=
 		327=Information
 		328=Gefunden am
 		329=Versteckt am
@@ -501,17 +501,91 @@
 		4119=Keine Kalibrierungsdatei gefunden f?r:+
 		4120=Fertig.
 		4200=Kartenverzeichnis w%e4hlen
+		4201=Information
+		4203=Lade Kartenliste...
+		4204=Es steht keine kalibrierte Karte zur Verf%fcgung %0a Bitte w%e4hlen Sie einen Ma%dfstab,%0a in dem der Track und die markierten Caches angezeigt werden sollen
+		4205=Es steht keine kalibrierte Karte zur Verf%fcgung %0a Sie k%f6nnen Karten herunterladen im Hauptmen%fc: Anwendung/Karten/kalibrierte herunterladen
+		4206=Entf:+
+		4207=Fehler
+		4208=Programmfehler: %0a nichterlaubter mapChangeModus:+
+		4210=Die mitwandernde Karte kann nicht ohne Karte gestartet werden. %0a Bitte w%e4hlen Sie eine %0a (evtl. eine leere)
+		4211=Keine+
+		4212=%fcbersichtlichere
+		4213=detailliertere
+		4214=+Karte verf%fcgbar
+		4215=Keine Caches mit H%e4ckchen ausgew%e4hlt
+		4216=Lade Karte...
+		4217=Konnte zu folgender Datei geh%f6rendes Bild nicht finden: %0a
+		4218=Konnte folgende Karte nicht laden: %0a
+		4219=Nicht genug (RAM)-Speicher frei, %0a um folgende Karte zu laden: %0a
+		4220=%0aSie k%f6nnen versuchen, %0a alle Programme zu schlie%dfen %0a und CacheWolf neuzustarten
+		4221=Nicht gen%fcgend Ressourcen verf%fcgbar:+
+		4222=Fehler: (RAM) Speicher voll
+		4230=Setze Ziel hier$z
+		4231=Setze Ziel hier
+		4232=Hier neuen Wegpunkt erzeugen$n
+		4233=Hier neuen Wegpunkt erzeugen
+		4234=Karte manuell ausw%e4hlen$s
+		4235=Karte manuell ausw%e4hlen
+		4236=Kartenverzeichnis wechseln$c
+		4237=Kartenverzeichnis wechseln
+		4238=Karte anzeigen
+		4239=Karte anzeigen
+		4240=Karte ausblenden
+		4241=Karte ausblenden
+		4242=Modus f%fcr automatischen Kartenwechsel
+		4244=H?chsten Detailgrad, die aktuelle und Zielposition enth?lt
+		4245=H?chsten Detailgrad, die aktuelle und Zielposition enth?lt
+		4246=H?chster verf?gbarer Detaillierungsgrad
+		4247=H?chster verf?gbare Detaillierungsgrad
+		4248=Manuellen Detaillierungsgrad m?glichst beibehalten
+		4249=Manuellen Detaillierungsgrad m?glichst beibehalten
+		4250=Detaillierungsgrad manuell w?hlen
+		4252=Karte laden, die alle markierten Caches enth?lt
+		4253=Karte laden, die alle markierten Caches enth?lt
+		4254=Karte mit mehr Details laden
+		4255=Karte mit mehr Details laden
+		4256=Karte mir mehr ?berblick laden
+		4257=Karte mir mehr ?berblick laden
+		4258=Karte verschieben und neue laden		
+		4260=Karte zum Ziel verschieben
+		4261=Karte zum Ziel verschieben
+		4262=Karte zum GPS verschieben
+		4263=Karte zum GPS verschieben
+		4264=Karte zum Zentrum verschieben
+		4265=Karte zum Zentrum verschieben
+		4270=?ffne
+		4271=Karten
+		4272=--- Karten von akt. Position und Ziel ---
+		4273=--- Karten der aktuellen Position ---
+		4274=--- Karten des Ziels ---
+		4275=--- Andere Karten ---
+		4276=Abbrechen
+		4277=Ausw?hlen
+		4278=Kann folgende .wfl-Datei nicht laden:+%0a
 		4300=Leer 1 Punkt =+
 		4301=+meter
 		4302=Breite/L%e4nge au?erhalb des zul%e4ssigen Bereiches beim Lesen von+
 		4303=Zu wenig Zeilen in Datei+
 		4304=Zu wenig Punkte, um die Karte zu kalibrieren
-		4305=Ung?ltige Transformationsparameter%0a (Matrix kann nicht invertiert werden)%0a in der Datei %0a
+		4305=Ung%fcltige Transformationsparameter%0a (Matrix kann nicht invertiert werden)%0a in der Datei %0a
 		4306=Karte ist nicht georeferenziert
+		4400=Warnung
+		4401=Ignoriere Fehler: Konnte Daten nicht an Host weiterleiten:%0a
+		4402=F?r einen neuen Versuch, stoppe und starte GPS neu
+		4403=Fehler
+		4404=Konnte keine Verbindung zum GPS-Empf?nger %0a herstellen. Fehler beim ?ffnen des seriellen Ports%0a
+		4405=M?gliche Gr?nde:%0a Falscher Port %0a Ein anderes Programm blokiert den Anschluss %0a Auf Loox-Ger?ten: ge?ffneter Infrarot-Port blockiert das GPS
 		4500=Ges:
 		4501=Gez:
 		4502=Gef:
 		4600=Nicht alle Caches k%f6nnen angezeigt werden. Inkompatibler Blacklist Status.
+		4900=+ist keine deutsche Gau?-Kr?ger-Koordinate
+		4920=EPSG-Code+
+		4921=+nicht unterst?tzt
+		4922=EPSG code fehlt in:+%0a
+		4923=fromWgs84: EPSG code+
+		4924=ToWgs84: EPSG code+
 		5000=Lade Cacheliste
 		5497=Fehler: Ein Tag in spider.def fehlt
 		5498=Login nicht m%f6glich. Fehler beim Laden der Seite nach Login.

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-27 19:07:32 UTC (rev 1198)
@@ -495,6 +495,61 @@
 		4119=No calibration file found for:+
 		4120=done.
 		4200=Choose map directory
+		4201=Information
+		4203=Loading list of maps...
+		4206=Dist:+
+		4207=Error
+		4208=Bug: %0aillegal mapChangeModus:+
+		4210=Moving map cannot run without a map - please select one. %0a You can select an empty map
+		4211=No+
+		4212=less
+		4213=more
+		4214=+detailed map available
+		4215=No caches selected by check mark
+		4216=Loading map...
+		4217=Could not find image associated with: %0a
+		4218=Could not load map: %0a
+		4219=Not enough memory to load map: %0a
+		4220=%0a You can try to close %0a all prgrams and %0a restart CacheWolf
+		4221=Not enough ressources to load map:+
+		4222=Out of memory error
+		4230=Goto here$g
+		4232=Create new Waypoint here$n
+		4234=Select a map manually$s
+		4236=Change map directory$c
+		4237=Change map directory
+		4238=Show map
+		4239=Show map
+		4240=Hide map
+		4241=Hide map
+		4242=Modus for automatic map change
+		4244=Highest res. containing dest. & cur. position
+		4246=Highest resolution
+		4247=Highest resolution
+		4248=Keep manual resolution
+		4249=Keep manual resolution
+		4250=Change resolution manually
+		4252=Load a map containing all marked caches
+		4253=Load a map containing all marked caches
+		4254=Load a map with more details
+		4255=Load a map with more details
+		4256=Load a map for a better overview
+		4257=Load a map for a better overview
+		4258=Move map to and load map
+		4260=Move map to goto point
+		4261=Move map to goto point
+		4262=Move map to GPS position
+		4263=Move map to GPS position
+		4264=Move map to centre
+		4265=Move map to centre
+		4270=Open
+		4271=--- Maps containing GPS and goto pos. ---
+		4273=--- Maps containing curr. position ---
+		4274=--- Maps containing goto position ---
+		4275=--- Other maps ---
+		4276=Cancel
+		4277=Select
+		4278=Cannot load wfl-file: \n
 		4300=empty 1 Pixel =+
 		4301=+meters
 		4302=Lat/Lon out of range while reading+
@@ -502,10 +557,22 @@
 		4304=not enough points to calibrate the map
 		4305=Not allowed values in affine%0a (matrix cannot be inverted)%0a in file %0a
 		4306=map not calibrated
+		4400=Warning
+		4401=Ignoring error:%0a could not forward GPS data to host:%0a
+		4402=%0astop and start GPS to retry
+		4403=Error
+		4404=Could not connect to GPS-receiver.%0a Error while opening serial Port%0a
+		4405=%0apossible reasons:\n Another (GPS-)program is blocking the port%0awrong port%0aOn Loox: active infra-red port is blocking GPS"
 		4500=Tot:
 		4501=Vis:
 		4502=Fnd:
 		4600=Some cache(s) cannot be shown because of wrong blacklist status
+		4900=+is not a german Gauss-Krueger coordinate
+		4920=EPSG code+
+		4921=+not supported
+		4922=EPSG code missing in:+
+		4923=fromWgs84: EPSG code+
+		4924=ToWgs84: EPSG code+
 		5498=Login failed. Error loading page after login. 
 		5499=Error loading login page
 		5000=Load Cachelist

Modified: trunk/src/CacheWolf/navi/MapInfoObject.java
===================================================================
--- trunk/src/CacheWolf/navi/MapInfoObject.java	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/src/CacheWolf/navi/MapInfoObject.java	2008-01-27 19:07:32 UTC (rev 1198)
@@ -311,8 +311,8 @@
 			double gamma = beta - rotationRad;
 			double heightkm = diagonal * Math.cos(gamma);
 			// double metersPerLat = 1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0));
-			CWPoint buttomleftimage = topleft.project(rotationRad * 180 / Math.PI + 180, heightkm);
-			CWPoint buttomleftimage2 = calcLatLon(0, heightpixel);
+			//CWPoint buttomleftimage = topleft.project(rotationRad * 180 / Math.PI + 180, heightkm);
+			//CWPoint buttomleftimage2 = calcLatLon(0, heightpixel);
 			//double kw = buttomleftimage.getDistance(buttomleftimage2);
 			//double kw2 = buttomleftimage.getBearing(buttomleftimage2);
 			//Vm.debug("project test: " + buttomleftimage.getDistance(topleft));

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2008-01-27 19:07:32 UTC (rev 1198)
@@ -86,7 +86,7 @@
 		this.hasTopBar = false;
 		this.noBorder = true;
 		this.setPreferredSize(pref.myAppWidth, pref.myAppHeight);
-		this.title = "Moving Map";
+		this.title = "Moving Map"; 
 		this.backGround = new Color(254,254,254); // background must not be black because black is interpreted as transparent and transparent images above (eg trackoverlay) want be drawn in windows-VM, so be care, don|t use white either
 		//this.mapPath = Global.getPref().getMapLoadPath();
 
@@ -180,18 +180,18 @@
 		//this.mapPath = mapsPath;
 		Vm.showWait(this, true);
 		resetCenterOfMap();
-		InfoBox inf = new InfoBox("Info", "Loading list of maps...");
+		InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
 		inf.exec();
 		inf.waitUntilPainted(100);
 		boolean saveGpsIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;
 		maps = new MapsList(mapsPath); // this actually loads the maps
 		if (maps.isEmpty()) {
-			(new MessageBox(MyLocale.getMsg(327, "Information"), MyLocale.getMsg(326, "Es steht keine kalibrierte Karte zur Verf?gung \n Bitte w?hlen Sie einen Ma?stab,\n in dem der Track und die markierten Caches angezeigt werden sollen"), MessageBox.OKB)).execute();
-			(new MessageBox(MyLocale.getMsg(327, "Information"), MyLocale.getMsg(326, "Es steht keine kalibrierte Karte zur Verf?gung \n Sie k?nnen eine herunter laden im Hauptmen?: Anwendung/Karten/kalibrierte herunterladen"), MessageBox.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4204, "No georeferenced map available \n Please choose a scale \n to show the track and the caches"), MessageBox.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4205, "No georeferenced map available  \n you can get one by the menu: Application/Maps/download calibrated"), MessageBox.OKB)).execute();
 			noMapsAvailable = true;
 		} else noMapsAvailable = false;
-		maps.addEmptyMaps(lat);
+		maps.addEmptyMaps(lat); // the empty maps must be added last, otherwise in method setBestMap, when no mapt is available, a malfunction will happen, see there
 		dontUpdatePos = saveGpsIgnoreStatus;
 		inf.close(0);
 		Vm.showWait(this, false);
@@ -250,13 +250,13 @@
 				if (dd.value < 1) {
 					dd.value = dd.value * 1000; 
 					dd.decimalPlaces = 0;
-					d = "Dist: " + dd.toString() + "m";
+					d = MyLocale.getMsg(4206, "Dist: ") + dd.toString() + "m";
 					int digits = (int)java.lang.Math.floor( java.lang.Math.log(dd.value) / java.lang.Math.log(10.0) );
 					digits = java.lang.Math.max(0, digits);
 				} 
 				else {
 					dd.decimalPlaces = 2;
-					d = "Dist: " + dd.toString() + "km";
+					d = MyLocale.getMsg(4206, "Dist: ") + dd.toString() + "km";
 					int digits = (int)java.lang.Math.floor( java.lang.Math.log(dd.value) / java.lang.Math.log(10.0) );
 					digits = java.lang.Math.max(0, digits);
 				}
@@ -835,7 +835,7 @@
 	 */
 	public void updatePosition(CWPoint where){
 		if (dontUpdatePos || loadingMapList) return; // avoid multi-threading problems
-		Vm.debug("updatepos, lat: "+where.latDec+" lon: "+where.lonDec);
+		//Vm.debug("updatepos, lat: "+where.latDec+" lon: "+where.lonDec);
 		if (!mapsloaded) {
 			loadMaps(Global.getPref().getMapLoadPath(), where.latDec);
 			lastCompareX = Integer.MAX_VALUE;
@@ -929,11 +929,11 @@
 			//	either Goto-Pos or GPS-Pos not set
 			else newmap = maps.getBestMap(cll, screen, 0.000001f, false); 
 			break;
-		default: (new MessageBox("Error", "Programmfehler: \nillegal mapChangeModus: " + mapChangeModus, MessageBox.OKB)).execute(); break;
+		default: (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4208, "Bug: \nillegal mapChangeModus: ") + mapChangeModus, MessageBox.OKB)).execute(); break;
 		}
 		if ( newmap != null && (currentMap == null || !currentMap.mapName.equals(newmap.mapName)) ) {
 			if (loadIfSameScale || !MapsList.scaleEquals(currentMap.scale / currentMap.zoomFactor, newmap) ) {
-				Vm.debug("better map found");
+				//Vm.debug("better map found");
 				setMap(newmap, where);
 				moveScreenXYtoLatLon(new Point(screen.x, screen.y), cll, true);
 			}
@@ -945,10 +945,10 @@
 			posCircle.where.set(cll); // choosemap calls setmap with posCircle-coos
 			try {
 				setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), where); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
-			} catch (IOException e) { (new MessageBox("Error", "setBestMap: problem in: setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), lat, lon) lat/lon:" + where.toString(), MessageBox.OKB)).exec(); }
-			while (currentMap == null) {
-				mmp.chooseMap(); // force the user to select a scale // TODO empty maps on top?
-				if (currentMap == null) (new MessageBox("Error", "Moving map cannot run without a map - please select one. \n You can select an empty map", MessageBox.OKB)).execute();
+			} catch (IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4209, "setBestMap: problem in: setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), lat, lon) lat/lon:") + where.toString(), MessageBox.OKB)).exec(); }
+			while (currentMap == null) { // this actually cannot happen, but maybe in case of an inconstistent code change (esp. regarding empty maps)
+				mmp.chooseMap(); // force the user to select a scale 
+				 if (currentMap == null) (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4210, "Moving map cannot run without a map - please select one. \n You can select an empty map"), MessageBox.OKB)).execute();
 			}
 		}
 		inBestMap = false;
@@ -1008,13 +1008,16 @@
 			setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
 			dontUpdatePos = saveGpsIgnStatus;
 		}
-		else (new MessageBox("Error", "No "+ (betterOverview ? "less" : "more") + " detailed map available", MessageBox.OKB)).execute();
+		else (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4211, "No ") + 
+				(betterOverview ? MyLocale.getMsg(4212, "less") : MyLocale.getMsg(4213, "more") ) + 
+				MyLocale.getMsg(4214, " detailed map available"), 
+				MessageBox.OKB)).execute();
 	}
 
 	public void loadMapForAllCaches(){
 		Area sur = Global.getProfile().getSourroundingArea(true);
 		if (sur == null) {
-			(new MessageBox("Error", "Keine  Caches mit H?ckchen ausgew?hlt", MessageBox.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4215, "Keine  Caches mit H?ckchen ausgew?hlt"), MessageBox.OKB)).execute();
 			return;
 		}
 		MapInfoObject newmap = maps.getMapForArea(sur.topleft, sur.buttomright);
@@ -1075,7 +1078,7 @@
 		saveIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;  // make updatePosition ignore calls during loading new map
 		InfoBox inf;
-		inf = new InfoBox("Info", "Loading map...");
+		inf = new InfoBox(MyLocale.getMsg(4201, "Information"), MyLocale.getMsg(4216, "Loading map..."));
 		inf.show();
 		inf.waitUntilPainted(100);
 		try {
@@ -1094,7 +1097,7 @@
 			if (ImageFilename == null ) {
 				mmp.mapImage = new MapImage();
 				maps.remove(currentMap);
-				(new MessageBox("Error", "Could not find image associated with: \n"+currentMap.fileNameWFL, MessageBox.OKB)).execute();
+				(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4217, "Could not find image associated with: \n")+currentMap.fileNameWFL, MessageBox.OKB)).execute();
 			}
 			else { 
 				if (ImageFilename.length() > 0) mmp.mapImage = new MapImage(ImageFilename); // attention: when running in native java-vm, no exception will be thrown, not even OutOfMemeoryError
@@ -1125,7 +1128,7 @@
 			updateOnlyPosition(where, false);
 			inf.close(0);
 			Vm.showWait(false);
-			(new MessageBox("Error", "Could not load map: "+ newmap.getImageFilename(), MessageBox.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4218, "Could not load map: \n")+ newmap.getImageFilename(), MessageBox.OKB)).execute();
 			dontUpdatePos = saveIgnoreStatus;
 		} catch (OutOfMemoryError e) {
 			if (mmp.mapImage != null) {
@@ -1137,7 +1140,10 @@
 			updateOnlyPosition(where, false);
 			inf.close(0);
 			Vm.showWait(false);
-			(new MessageBox("Error", "Not enough memory to load map: "+ newmap.getImageFilename()+"\nYou can try to close\n all prgrams and \nrestart CacheWolf", MessageBox.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4219, "Not enough memory to load map: \n") 
+					+ newmap.getImageFilename()
+					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 
+					MessageBox.OKB)).execute();
 			dontUpdatePos = saveIgnoreStatus;
 		}catch (SystemResourceException e) {
 			if (mmp.mapImage != null) {
@@ -1149,7 +1155,10 @@
 			updateOnlyPosition(where, false); // TODO this doesn't work correctly if the resolution changed, I guess because the pixels of PosCircle will be interpreted from the new resolution, but should be interpreted using the old resolution to test: select a map with a much greater value of m per pixel manually 
 			inf.close(0);
 			Vm.showWait(false);
-			(new MessageBox("Error", "Not enough ressources to load map: "+ newmap.getImageFilename()+"\nYou can try to close\n all prgrams and \nrestart CacheWolf", MessageBox.OKB)).execute();
+			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4221, "Not enough ressources to load map: ")
+					+ newmap.getImageFilename()
+					+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"), 
+					MessageBox.OKB)).execute();
 			dontUpdatePos = saveIgnoreStatus;
 		}
 	}
@@ -1262,7 +1271,8 @@
 				else tmp = new MapImage(mapImage1to1.scale((int) (newImageRect.width*zoomFactor), (int)(newImageRect.height*zoomFactor), newImageRect, 0));
 				currentMap.zoom(zoomFactor, newImageRect.x, newImageRect.y);
 			} catch (OutOfMemoryError e) {
-				(new MessageBox("Error", "Out of memory error", MessageBox.OKB)).execute();
+				(new MessageBox(MyLocale.getMsg(4207, "Error"), 
+						MyLocale.getMsg(4222, "Out of memory error"), MessageBox.OKB)).execute();
 				//tmp = mapImage1to1;
 			} //if (tmp != null) currentMap.zoom();}
 			Vm.getUsedMemory(true);
@@ -1314,32 +1324,32 @@
  */
 class MovingMapPanel extends InteractivePanel implements EventListener {
 	Menu kontextMenu;
-	MenuItem gotoMenuItem = new MenuItem("Goto here$g", 0, null);
-	MenuItem newWayPointMenuItem = new MenuItem("Create new Waypoint here$n", 0, null);;
+	MenuItem gotoMenuItem = new MenuItem(MyLocale.getMsg(4230, "Goto here$g"), 0, null);
+	MenuItem newWayPointMenuItem = new MenuItem(MyLocale.getMsg(4232, "Create new Waypoint here$n"), 0, null);;
 	MenuItem openCacheDescMenuItem,addCachetoListMenuItem;
 	
 	MenuItem miLuminary[];
 
 	Menu mapsMenu;
-	MenuItem selectMapMI = new MenuItem("Select a map manually$s", new IconAndText(new mImage("map_open.png"), "Select a map manually", null, Graphics.RIGHT));
-	MenuItem changeMapDirMI = new MenuItem("Change map directory$c", new IconAndText(new mImage("map_cd.png"), "Change map directory", null, Graphics.RIGHT));
-	MenuItem showMapMI = new MenuItem("Show map", new IconAndText(new mImage("map_on.png"), "Show map", null, Graphics.RIGHT));
-	MenuItem hideMapMI = new MenuItem("Hide map", new IconAndText(new mImage("map_off.png"), "Hide map", null, Graphics.RIGHT));
+	MenuItem selectMapMI = new MenuItem(MyLocale.getMsg(4234, "Select a map manually$s"), new IconAndText(new mImage("map_open.png"), MyLocale.getMsg(4235, "Select a map manually"), null, Graphics.RIGHT));
+	MenuItem changeMapDirMI = new MenuItem(MyLocale.getMsg(4236, "Change map directory$c"), new IconAndText(new mImage("map_cd.png"), MyLocale.getMsg(4237, "Change map directory"), null, Graphics.RIGHT));
+	MenuItem showMapMI = new MenuItem(MyLocale.getMsg(4238, "Show map"), new IconAndText(new mImage("map_on.png"), MyLocale.getMsg(4239, "Show map"), null, Graphics.RIGHT));
+	MenuItem hideMapMI = new MenuItem(MyLocale.getMsg(4240, "Hide map"), new IconAndText(new mImage("map_off.png"), MyLocale.getMsg(4241, "Hide map"), null, Graphics.RIGHT));
 	// automatic
-	MenuItem mapChangeModusMI = new MenuItem("Modus for automatic map change", MenuItem.Separator, null);;
-	MenuItem highestResGpsDestMI = new MenuItem("Highest res. containing dest. & cur. position", new IconAndText(new mImage("res_gps_goto.png"), "Highest res. containing dest. & cur. position", null, Graphics.RIGHT)); //immer h?chste Aufl?sung w?hlen, die akt. Pos. und Ziel enthalten 
-	MenuItem highestResolutionMI = new MenuItem("Highest resolution", new IconAndText(new mImage("res_high.png"), "Highest resolution", null, Graphics.RIGHT)); //immer h?chste Aufl?sung w?hlen 
-	MenuItem keepManResolutionMI = new MenuItem("Keep manual resolution", new IconAndText(new mImage("res_manuell.png"), "Keep manual resolution", null, Graphics.RIGHT)); // manuell gew?hlte Aufl?sung beibehalten  
+	MenuItem mapChangeModusMI = new MenuItem(MyLocale.getMsg(4242, "Modus for automatic map change"), MenuItem.Separator, null);;
+	MenuItem highestResGpsDestMI = new MenuItem(MyLocale.getMsg(4244, "Highest res. containing dest. & cur. position"), new IconAndText(new mImage("res_gps_goto.png"), MyLocale.getMsg(4245, "Highest res. containing dest. & cur. position"), null, Graphics.RIGHT)); //immer h?chste Aufl?sung w?hlen, die akt. Pos. und Ziel enthalten 
+	MenuItem highestResolutionMI = new MenuItem(MyLocale.getMsg(4246, "Highest resolution"), new IconAndText(new mImage("res_high.png"), MyLocale.getMsg(4247, "Highest resolution"), null, Graphics.RIGHT)); //immer h?chste Aufl?sung w?hlen 
+	MenuItem keepManResolutionMI = new MenuItem(MyLocale.getMsg(4248, "Keep manual resolution"), new IconAndText(new mImage("res_manuell.png"), MyLocale.getMsg(4249, "Keep manual resolution"), null, Graphics.RIGHT)); // manuell gew?hlte Aufl?sung beibehalten  
 	// manuell
-	MenuItem mapChangeResMI = new MenuItem("Change resolution manually", MenuItem.Separator, null);;
-	MenuItem AllCachesResMI = new MenuItem("Load a map containing all marked caches",  new IconAndText(new mImage("loupe_all.png"), "Load a map containing all marked caches", null, Graphics.RIGHT));   
-	MenuItem moreDetailsMI = new MenuItem("Load a map with more details", new IconAndText(new mImage("loupe_more_details.png"), "Load a map with more details", null, Graphics.RIGHT)); // laod a map with more details 
-	MenuItem moreOverviewMI = new MenuItem("Load a map for a better overview", new IconAndText(new mImage("loupe_better_overview.png"), "Load a map for a better overview", null, Graphics.RIGHT)); // Load a map for a better overview --> lesser details  
+	MenuItem mapChangeResMI = new MenuItem(MyLocale.getMsg(4250, "Change resolution manually"), MenuItem.Separator, null);;
+	MenuItem AllCachesResMI = new MenuItem(MyLocale.getMsg(4252, "Load a map containing all marked caches"),  new IconAndText(new mImage("loupe_all.png"), MyLocale.getMsg(4253, "Load a map containing all marked caches"), null, Graphics.RIGHT));   
+	MenuItem moreDetailsMI = new MenuItem(MyLocale.getMsg(4254, "Load a map with more details"), new IconAndText(new mImage("loupe_more_details.png"), MyLocale.getMsg(4255, "Load a map with more details"), null, Graphics.RIGHT)); // laod a map with more details 
+	MenuItem moreOverviewMI = new MenuItem(MyLocale.getMsg(4256, "Load a map for a better overview"), new IconAndText(new mImage("loupe_better_overview.png"), MyLocale.getMsg(4257, "Load a map for a better overview"), null, Graphics.RIGHT)); // Load a map for a better overview --> lesser details  
 	// move map to
-	MenuItem moveToMI = new MenuItem("Move map to an load map", MenuItem.Separator, null);;
-	MenuItem moveToDestMI = new MenuItem("Move to goto point", new IconAndText(new mImage("move2goto.png"), "Move to goto point", null, Graphics.RIGHT)); //* Karte zum Ziel verschieben (und ggf. entsprechende Karte laden) 
-	MenuItem moveToGpsMI = new MenuItem("Move to GPS position", new IconAndText(new mImage("move2gps.png"), "Move to GPS position", null, Graphics.RIGHT));   
-	MenuItem moveToCenterMI = new MenuItem("Move to centre", new IconAndText(new mImage("move2center.png"), "Move to centre", null, Graphics.RIGHT));   
+	MenuItem moveToMI = new MenuItem(MyLocale.getMsg(4258, "Move map to and load map"), MenuItem.Separator, null);;
+	MenuItem moveToDestMI = new MenuItem(MyLocale.getMsg(4260, "Move to goto point"), new IconAndText(new mImage("move2goto.png"), MyLocale.getMsg(4261, "Move to goto point"), null, Graphics.RIGHT)); //* Karte zum Ziel verschieben (und ggf. entsprechende Karte laden) 
+	MenuItem moveToGpsMI = new MenuItem(MyLocale.getMsg(4262, "Move to GPS position"), new IconAndText(new mImage("move2gps.png"), MyLocale.getMsg(4263, "Move to GPS position"), null, Graphics.RIGHT));   
+	MenuItem moveToCenterMI = new MenuItem(MyLocale.getMsg(4264, "Move to centre"), new IconAndText(new mImage("move2center.png"), MyLocale.getMsg(4265, "Move to centre"), null, Graphics.RIGHT));   
 
 	CacheHolder clickedCache;
 	MovingMap mm;
@@ -1597,7 +1607,7 @@
 				if (clickedOnImage != null && clickedOnImage instanceof MapSymbol) {
 					clickedCache = ((CacheHolder)((MapSymbol)clickedOnImage).mapObject);
 					if (clickedCache != null) {
-						openCacheDescMenuItem = new MenuItem("Open '"+(clickedCache.CacheName.length()>0?clickedCache.CacheName:clickedCache.wayPoint)+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
+						openCacheDescMenuItem = new MenuItem(MyLocale.getMsg(4270, "Open")+" '"+(clickedCache.CacheName.length()>0 ? clickedCache.CacheName : clickedCache.wayPoint)+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
 						kontextMenu.addItem(openCacheDescMenuItem);
 						if (Global.mainForm.cacheListVisible) { 
 							addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
@@ -1755,7 +1765,7 @@
 	Vector maps;
 
 	public ListBox(Vector maps, CWPoint Gps, CWPoint gotopos, MapInfoObject curMap){
-		this.title = "Maps";
+		this.title = MyLocale.getMsg(4271, "Maps");
 		// if (Gui.screenIs(Gui.PDA_SCREEN)) this.setPreferredSize(200,100); else 
 		// set width to screenwidth *3/4 but to at least 240 if the screen is big engough for 240px width
 		this.setPreferredSize(java.lang.Math.max(MyLocale.getScreenWidth()*3/4, java.lang.Math.min(240, MyLocale.getScreenWidth()) ), MyLocale.getScreenHeight()*3/4);
@@ -1770,7 +1780,7 @@
 		int row = -1;
 		if (curMap == null) curMapFound = true;
 		if (gotopos != null && Gps != null) {
-			list.addItem("--- Karten von akt. Position und Ziel ---");
+			list.addItem(MyLocale.getMsg(4272, "--- Maps containing GPS and goto pos. ---"));
 			row++;
 			cmp = "FF1"+(new Area(new CWPoint(Gps.latDec, Gps.lonDec), gotopos)).getEasyFindString();
 			for(int i = 0; i<maps.size();i++){
@@ -1789,7 +1799,7 @@
 			}
 		}
 		if (Gps != null) {
-			list.addItem("--- Karten der aktuellen Position ---");
+			list.addItem(MyLocale.getMsg(4273, "--- Maps containing curr. position ---"));
 			row++;
 			cmp = "FF1"+Area.getEasyFindString(new CWPoint(Gps.latDec, Gps.lonDec), 30);
 			for(int i = 0; i<maps.size();i++){
@@ -1808,7 +1818,7 @@
 			}
 		}
 		if (gotopos != null) {
-			list.addItem("--- Karten des Ziels ---");
+			list.addItem(MyLocale.getMsg(4274, "--- Karten des Ziels ---"));
 			row++;
 			cmp = "FF1"+Area.getEasyFindString(gotopos, 30);
 			for(int i = 0; i<maps.size();i++){
@@ -1825,7 +1835,7 @@
 				}
 			}
 		}
-		list.addItem("--- andere Karten ---");
+		list.addItem(MyLocale.getMsg(4275, "--- andere Karten ---"));
 		row++;
 		for(int i = 0; i<maps.size();i++){
 			ml = (MapListEntry)maps.get(i);
@@ -1837,10 +1847,10 @@
 		}
 		list.selectItem(oldmap, true);
 		this.addLast(scb = new CacheWolf.MyScrollBarPanel(list),CellConstants.STRETCH, CellConstants.FILL);
-		cancelButton = new mButton("Cancel");
+		cancelButton = new mButton(MyLocale.getMsg(4276, "Cancel"));
 		cancelButton.setHotKey(0, KeyEvent.getCancelKey(true));
 		this.addNext(cancelButton,CellConstants.STRETCH, CellConstants.FILL);
-		okButton = new mButton("Select");
+		okButton = new mButton(MyLocale.getMsg(4277, "Select"));
 		okButton.setHotKey(0, KeyEvent.getActionKey(true));
 		this.addLast(okButton,CellConstants.STRETCH, CellConstants.FILL);
 		okButton.takeFocus(0);
@@ -1874,7 +1884,8 @@
 				selected = true;
 				this.close(FormBase.IDOK);
 				} catch (IOException e) {
-					(new MessageBox("Error", "Cannot load wfl-file: \n" + ((MapListEntry)maps.get(mapNum)).filename, MessageBox.OKB)).execute();
+					(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4278, "Cannot load wfl-file: \n") 
+							+ ((MapListEntry)maps.get(mapNum)).filename, MessageBox.OKB)).execute();
 				}
 			}
 			else {

Modified: trunk/src/CacheWolf/navi/Navigate.java
===================================================================
--- trunk/src/CacheWolf/navi/Navigate.java	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/src/CacheWolf/navi/Navigate.java	2008-01-27 19:07:32 UTC (rev 1198)
@@ -2,6 +2,7 @@
 
 import CacheWolf.CWPoint;
 import CacheWolf.Global;
+import CacheWolf.MyLocale;
 import CacheWolf.Preferences;
 import ewe.fx.Color;
 import ewe.io.IOException;
@@ -13,6 +14,13 @@
 import ewe.ui.MessageBox;
 import ewe.util.mString;
 
+/**
+ * Non-Gui Class to handle all things regarding navigation
+ * (GPS, Sun direction etc.)
+ * start offset in localisation file: 4400 
+ * @author Pfeffer
+ *
+ */
 public class Navigate {
 	public CWPoint destination = new CWPoint();
 	public CWGPSPoint gpsPos = new CWGPSPoint();
@@ -43,7 +51,10 @@
 		try {
 			serThread = new SerialThread(pref.mySPO, gpsPos, (pref.forwardGPS ? pref.forwardGpsHost : ""));
 			if (pref.forwardGPS && !serThread.tcpForward) {
-				(new MessageBox("Warning", "Ignoring error:\n could not forward GPS data to host:\n"+pref.forwardGpsHost+"\n"+serThread.lastError+"\nstop and start GPS to retry",MessageBox.OKB)).exec();
+				(new MessageBox(MyLocale.getMsg(4400, "Warning"), 
+						MyLocale.getMsg(4401, "Ignoring error:\n could not forward GPS data to host:\n")
+						+ pref.forwardGpsHost+"\n" + serThread.lastError
+						+ MyLocale.getMsg(4402, "\nstop and start GPS to retry"), MessageBox.OKB)).exec();
 			}
 			if (gpsPos.latDec == 0 && gpsPos.lonDec == 0) { // TODO use isValid() // TODO raus damit?
 				gpsPos.latDec = destination.latDec; // setze Zielpunkt als Ausgangspunkt
@@ -57,7 +68,11 @@
 			if (gotoPanel != null) gotoPanel.gpsStarted();
 			if (movingMap != null) movingMap.gpsStarted();
 		} catch (IOException e) {
-			(new MessageBox("Error", "Could not connect to GPS-receiver.\n Error while opening serial Port " + e.getMessage()+"\npossible reasons:\n Another (GPS-)program is blocking the port\nwrong port\nOn Loox: active infra-red port is blocking GPS", MessageBox.OKB)).execute(); 
+			(new MessageBox(MyLocale.getMsg(4403, "Error"), 
+					MyLocale.getMsg(4404, "Could not connect to GPS-receiver.\n Error while opening serial Port ") 
+					+ e.getMessage()
+					+ MyLocale.getMsg(4405, "\npossible reasons:\n Another (GPS-)program is blocking the port\nwrong port\nOn Loox: active infra-red port is blocking GPS"), 
+					MessageBox.OKB)).execute(); 
 		}
 	}
 
@@ -123,7 +138,7 @@
 				SkyOrientation.getSunAzimut(gpsPos.Time, gpsPos.Date, gpsPos.latDec, gpsPos.lonDec);
 				double jd = SkyOrientation.utc2juliandate(gpsPos.Time, gpsPos.Date);
 				skyOrientationDir = SkyOrientation.getLuminaryDir(luminary, jd, gpsPos);
-				ewe.sys.Vm.debug("neu: "+ skyOrientationDir.lonDec+ "jd: " + jd);
+				// ewe.sys.Vm.debug("neu: "+ skyOrientationDir.lonDec+ "jd: " + jd);
 			} catch (NumberFormatException e) { // irgendeine Info zu Berechnung des Sonnenaziumt fehlt (insbesondere Datum und Uhrzeit sind nicht unbedingt gleichzeitig verf?gbar wenn es einen Fix gibt)
 				skyOrientationDir.set(-361, -361); // any value out of range (bigger than 360) will prevent drawArrows from drawing it 
 			}

Modified: trunk/src/CacheWolf/navi/SkyOrientation.java
===================================================================
--- trunk/src/CacheWolf/navi/SkyOrientation.java	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/src/CacheWolf/navi/SkyOrientation.java	2008-01-27 19:07:32 UTC (rev 1198)
@@ -38,7 +38,7 @@
 		// Sirius
 	};
 	
-	public static String [] LUMINARY_NAMES = { // TODO MyLocale.getMsg(xxx, "Sun"),
+	public static String [] LUMINARY_NAMES = { 
 		MyLocale.getMsg(6100, "Sun"), 
 		MyLocale.getMsg(6101, "Moon"), 
 		MyLocale.getMsg(6102, "Grater Bear"),
@@ -48,7 +48,7 @@
 		MyLocale.getMsg(6106, "Southern Cross")
 	};
 
-	public static String [] LUMINARY_DESC = { // TODO MyLocale.getMsg(xxx, "Sun"),
+	public static String [] LUMINARY_DESC = {
 		MyLocale.getMsg(6100, "Sun"), 
 		MyLocale.getMsg(6101, "Moon"), 
 		MyLocale.getMsg(6122, "Alioth in Greater Bear"),
@@ -171,12 +171,12 @@
 			// null = Sueden auf Null = Norden umrechnen
 			azimut +=180.;
 			if (azimut >360.) azimut -=360.;
-			ewe.sys.Vm.debug("sunAzimut1: " + azimut);
-			ewe.sys.Vm.debug("sun Elevation: " +getSunAzimut2 (utc, datum, lat, lon).latDec);
-			CWPoint MoonDir = getMoonDir(jd, new CWPoint(lat, lon));
-			ewe.sys.Vm.debug("Moon Elevation: " + MoonDir.latDec + "Moon Azimut: " + MoonDir.lonDec);
-			CWPoint OrionDir = getAlnilamDir(jd, new CWPoint(lat, lon));
-			ewe.sys.Vm.debug("Alnilam (Orion) Elevation: " + OrionDir.latDec + "Alnilam (Orion) Azimut: " + OrionDir.lonDec );
+			//ewe.sys.Vm.debug("sunAzimut1: " + azimut);
+			//ewe.sys.Vm.debug("sun Elevation: " +getSunAzimut2 (utc, datum, lat, lon).latDec);
+			//CWPoint MoonDir = getMoonDir(jd, new CWPoint(lat, lon));
+			//ewe.sys.Vm.debug("Moon Elevation: " + MoonDir.latDec + "Moon Azimut: " + MoonDir.lonDec);
+			//CWPoint OrionDir = getAlnilamDir(jd, new CWPoint(lat, lon));
+			//ewe.sys.Vm.debug("Alnilam (Orion) Elevation: " + OrionDir.latDec + "Alnilam (Orion) Azimut: " + OrionDir.lonDec );
 			
 			return azimut;
 		} catch (IndexOutOfBoundsException e) {

Modified: trunk/src/CacheWolf/navi/TransformCoordinates.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinates.java	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/src/CacheWolf/navi/TransformCoordinates.java	2008-01-27 19:07:32 UTC (rev 1198)
@@ -2,6 +2,7 @@
 
 import CacheWolf.CWPoint;
 import CacheWolf.Matrix;
+import CacheWolf.MyLocale;
 
 import java.lang.Math;
 
@@ -22,7 +23,9 @@
  * by the Bundesamt f?r Kartographie und Geod?sie for whole Germany: see:
  *  * http://crs.bkg.bund.de/crseu/crs/descrtrans/BeTA/BETA2007dokumentation.pdf
  *  * http://crs.bkg.bund.de/crs-eu/ click on "national CRS" -> germany -> DE_DHDN / GK_3 -> DE_DHDN (BeTA, 2007) to ETRS89
- * @author Robert Arnold
+ *  
+ *  Start offset in languages file: 4900
+ * @author Pfeffer
  *
  */
 public class TransformCoordinates {
@@ -222,7 +225,7 @@
 		case EPSG_GK3: stripe = 3; break;
 		case EPSG_GK4: stripe = 4; break;
 		case EPSG_GK5: stripe = 5; break;
-		default: throw new IllegalArgumentException("wgs84ToGermanGk: epsgcode: " + epsgcode + "is not a german Gau?-Kr?ger coordinate");
+		default: throw new IllegalArgumentException("wgs84ToGermanGk: epsgcode: " + epsgcode + MyLocale.getMsg(4900, " is not a german Gauss-Krueger coordinate"));
 		}
 		return stripe; 
 	}

Modified: trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java	2008-01-25 21:47:24 UTC (rev 1197)
+++ trunk/src/CacheWolf/navi/TransformCoordinatesProperties.java	2008-01-27 19:07:32 UTC (rev 1198)
@@ -5,7 +5,19 @@
 import ewe.sys.Convert;
 import ewe.util.Properties;
 import CacheWolf.CWPoint;
+import CacheWolf.MyLocale;
 
+/**
+ * Class to load the parameters of a datum shift of a map and
+ * the projection parameters from an Inputstream by the corresponding
+ * EPSG code
+ * After instantiation you can simply use to and fromWGS84 to
+ * convert between WGS84 and the given Coordinate reference system, given
+ * by the EPSG code
+ * Start offset in the language file: 4920  
+ * @author Pfeffer
+ *
+ */
 public class TransformCoordinatesProperties extends Properties {
 	public int epsgCode;
 	
@@ -13,11 +25,14 @@
 		super();
 		load(is);
 		epsgCode = Convert.toInt(getProperty("EpsgCode", "-1"));
-		if (epsgCode == -1) throw new IllegalArgumentException("EPSG code missing in: " + is.getName());
+		if (epsgCode == -1) throw new IllegalArgumentException(MyLocale.getMsg(4922, "EPSG code missing in: ") + is.getName());
 	}
 	
 	public TransformCoordinatesProperties(int epsgcodei) {
-		if (!TransformCoordinates.isSupported(epsgcodei)) throw new IllegalArgumentException("EPSG code " + epsgcodei + "not supported");
+		if (!TransformCoordinates.isSupported(epsgcodei)) throw new IllegalArgumentException(
+				MyLocale.getMsg(4920, "EPSG code ") 
+				+ epsgcodei 
+				+ MyLocale.getMsg(4921, " not supported"));
 		epsgCode = epsgcodei;
 	}
 
@@ -42,7 +57,10 @@
 			GkPoint xy = TransformCoordinates.wgs84ToGermanGk(ll, epsgCode);
 			ret = new CWPoint(xy.northing, xy.getGkEasting());
 			break;
-		default: throw new IllegalArgumentException("fromWgs84: EPSG code " + epsgCode + "not supported");
+		default: throw new IllegalArgumentException(
+				MyLocale.getMsg(4923, "fromWgs84: EPSG code ") 
+				+ epsgCode 
+				+ MyLocale.getMsg(4921, " not supported"));
 		}
 		return ret;
 	}
@@ -67,7 +85,10 @@
 			GkPoint xy = new GkPoint(p.lonDec, p.latDec);
 			ret = TransformCoordinates.germanGkToWgs84(xy);
 			break;
-		default: throw new IllegalArgumentException("ToWgs84: EPSG code " + epsgCode + "not supported");
+		default: throw new IllegalArgumentException(
+				MyLocale.getMsg(4924, "ToWgs84: EPSG code ")
+				+ epsgCode
+				+ MyLocale.getMsg(4921, " not supported"));
 		}
 		return ret;
 	}



From mik77 at mail.berlios.de  Sun Jan 27 20:17:38 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 27 Jan 2008 20:17:38 +0100
Subject: [Cachewolf-svn] r1199 - in trunk: res_noewe/languages
	src/CacheWolf/navi
Message-ID: <200801271917.m0RJHcrc010506@sheep.berlios.de>

Author: mik77
Date: 2008-01-27 20:17:33 +0100 (Sun, 27 Jan 2008)
New Revision: 1199

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/src/CacheWolf/navi/GotoPanel.java
   trunk/src/CacheWolf/navi/MapLoader.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
   trunk/src/CacheWolf/navi/MapsList.java
Log:
Localization added. NL translation still missing.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-27 19:07:32 UTC (rev 1198)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-27 19:17:33 UTC (rev 1199)
@@ -318,7 +318,16 @@
 		1501=Aktuell
 		1502=Grad
 		1503=Nordausrichtung
-		1600=Opencahing.de Download
+		1504=Start
+		1505=Stop
+		1506=Karte
+		1507=Koordinaten ung%fcltig:
+		1508=Breite
+		1509=L%e4nge
+		1510=Keine Daten vom GPS%0aVerbindung zum seriellen Port geschlossen
+		1511=Kann Daten vom GPS nicht interpretieren%0a M%f6gliche Gr%fcnde:%0afalscher Port,%0afalsche Baudrate,%0akein NMEA-Protokoll%0aVerbindung zum seriellen Port geschlossen%0aLetzter String:%0a 
+		1512=Wegpunkt
+		1600=Opencaching.de Download
 		1601=max. Abstand:
 		1602=Bilder downloaden
 		1603=Karten downloaden
@@ -381,13 +390,44 @@
 		1739=Winkel muss im Bereich [0;2*PI] sein
 		1800=Georeferenzierte Karten herunterladen
 		1801=Kacheln herunterladen
+		1802=Download georeferenzierter Karten%0a W%e4hle Onlinedienst:
+		1803=f%fcr
+		1804=alle
+		1805=selektierte
+		1806=Caches
+		1807=Ca. m pro Pixel:
+		1808=%dcberlappung in Pixel:
+		1809=Lade %dcbersichtskarte
+		1810=In einem Rechteck von:
+		1811=um das Zentrum: 
+		1812=Kacheln
+		1813=Lade Karte f%fcr
+		1814=Pro Cache		
+		1815=Lade georeferenzierte Karten
+		1816=Lade georeferenzierte Karten%0a %0a %0a %0a %0a
+		1817=Keine Caches selektiert
+		1818=getSortedMapServiceIndex: Index 
+		1819=nicht gefunden
+		1820=Lade Karte '
+		1821=%0a f%fcr Cache:%0a
+		1822=Cache: 
+		1823=Ignoriere Fehler: 
+		1824=Lade %dcberblickskarte
+		1825=%dcberblickskarte: Ignoriere Fehler: 
+		1826=Laden und Kalibrieren der Karten beendet
+		1827='Radius' muss gr%f6%dfer als 0 sein
+		1828='%dcberlappung' muss gr%f6%dfer oder gleich 0 sein
+		1829=Bitte 'Zentrum' eingeben, um das die Karten geladen werden sollen
+		1830=Der gew%e4hlte Kartendienst bietet Karten in einem Ma%dfstab von 
+		1831= bis 
+		1832=%0a Bitte 'Ca. m pro Pixel' entsprechend anpassen
 		2000=GPX Export
 		2001=von
 		2100=Magellan Exporter
 		2101=Fehler beim laden der Datei magellan.cfg
-		2102=Zieldatei w??hlen
+		2102=Zieldatei w%e4hlen
 		2103=Fehler beim lesen der Datei magellan.cfg
-		2104=Ausgabeverzeichnis f??r die .gs Dateien ausw??hlen
+		2104=Ausgabeverzeichnis f%fcr die .gs Dateien ausw%e4hlen
 		2500=Fehler beim Laden oder unkekanntes Attribut
 		2501=Nicht immer zug%e4nglich
 		2502=Immer zug%e4nglich (24/7)
@@ -498,7 +538,7 @@
 		4116=+-+Bild nicht kopiert
 		4117=Fehler beim Importieren der .map-Datei:+
 		4118=E/A-Fehler beim Lesen oder Schreiben der Kalibrierungsdatei
-		4119=Keine Kalibrierungsdatei gefunden f?r:+
+		4119=Keine Kalibrierungsdatei gefunden f%fcr:+
 		4120=Fertig.
 		4200=Kartenverzeichnis w%e4hlen
 		4201=Information
@@ -565,7 +605,7 @@
 		4278=Kann folgende .wfl-Datei nicht laden:+%0a
 		4300=Leer 1 Punkt =+
 		4301=+meter
-		4302=Breite/L%e4nge au?erhalb des zul%e4ssigen Bereiches beim Lesen von+
+		4302=Breite/L%e4nge au%dferhalb des zul%e4ssigen Bereiches beim Lesen von+
 		4303=Zu wenig Zeilen in Datei+
 		4304=Zu wenig Punkte, um die Karte zu kalibrieren
 		4305=Ung%fcltige Transformationsparameter%0a (Matrix kann nicht invertiert werden)%0a in der Datei %0a
@@ -580,6 +620,47 @@
 		4501=Gez:
 		4502=Gef:
 		4600=Nicht alle Caches k%f6nnen angezeigt werden. Inkompatibler Blacklist Status.
+		4700=Ignoriere Fehler beim%0aLaden der Kalibrierungsdatei%0a
+		4701=Suche nach bester Karte
+		4702=Optimierung
+		4703=Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?%0aIt can take several minutes.
+		4703=Cachewolf kann das Laden von Karten beschleunigen indem eine Markierung zum Dateinamen hinzugef%fcgt wird. Soll dies jetzt getan werden?%0aEs kann einige Minuten dauern.
+		4704=%0aUmbenennen der Datei:
+		4705=Fehler beim Umbenennen:%0a
+		4706=%0anach:%0an
+		4707=Fehler beim Lesen von: 
+		4800=Lade Onlinekartendienste
+		4801=Ignoriere Fehler beim %0a Lesen der Web Map Service Definitionsdatei %0a
+		4802=Lade kalibriertes (georeferenziertes) %0a Kartenbild %0a '
+		4803=' %0a Lade Kachel %0a Reihe 
+		4804= Spalte 
+		4805=Kachel 
+		4806=: Ignoriere Fehler: 
+		4807=loadTo: Karte laden fehlgeschlagen: Kein http-redirect erhalten
+		4808=downloadImage: content-type: 
+		4809= ist kein Bild, Anfang des Inhalts: 
+		4810=Fehler beim Laden oder Speichern der Karte:%0a
+		4811=OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):%0a Diese Methode muss %fcberladen werden um sie zu nutzen
+		4812=WebMapService: Eigenschaft >Name:< fehlt in Datei:%0a
+		4813=WebMapService: Eigenschaft >MainUrl:< fehlt in Datei:%0a
+		4814=WebMapService: CoordinateReferenceSystemCacheWolf nicht angegeben
+		4815=Dieses Koordinaten-Referenzsystem wird von Cachewolf nicht unterst%fctzt:%0a
+		4816=WebMapService: Eigenschaft >CoordinateReferenceSystemUrlPart:< fehlt in Datei:%0a
+		4817=Anzahl der Strings in CoordinateReferenceSystemUrlPart (
+		4818=) muss mit der Anzahl der Codes in CoordinateReferenceSystemCacheWolf (
+		4819=)%fcbereinstimmen. Benutzte normale Leerschritte als Trenner
+		4820=WebMapService: Eigenschaft >CoordinateReferenceSystemUrlPart:< fehlerhaft in Datei:%0a
+		4821=WebMapService: Eigenschaft >ImageFileExtension:< fehlt in Datei:%0a
+		4822=Bereich: 
+		4823= wird vom Dienst: 
+		4824=nicht abgedeckt, Dienstbereich: 
+		4825=Ma%dfstab 
+		4826= wird von diesem Kartendienst nicht unterst%fctzt, unterst%fctzter Ma%dfstabsbereich: 
+		4827= (gemessen vertikal in Metern pro Pixel)
+		4828=Koordinatensystem wird von Cachewolf nicht unterst%fctzt: 
+		4829=getUrlForBoundingBox: Punkt: 
+		4830=Kein passender Gau%df-Kr%fcger-Streifen in der EPSG-Codeliste in der .wms-Datei
+		4831=getMapInfoObject: Koordinatensystem wird von Cachewolf nicht unterst%fctzt: 
 		4900=+ist keine deutsche Gau?-Kr?ger-Koordinate
 		4920=EPSG-Code+
 		4921=+nicht unterst?tzt
@@ -614,7 +695,7 @@
 		6006=Von Datum
 		6007=Von Log
 		6008=Nach Prof
-	    6009=Nach Wegpt
+	  6009=Nach Wegpt
 		6010=Nach Datum
 		6011=Nach Log
 		6015=*** ANDERER ***

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2008-01-27 19:07:32 UTC (rev 1198)
+++ trunk/res_noewe/languages/EN.cfg	2008-01-27 19:17:33 UTC (rev 1199)
@@ -319,6 +319,15 @@
 		1501=Current
 		1502=deg
 		1503=North centered
+		1504=Start
+		1505=Stop
+		1506=Map
+		1507=Coordinates are out of range:
+		1508=latitude
+		1509=longditue
+		1510=No data from GPS%0aConnection to serial port closed
+		1511=Cannot interpret data from GPS%0a possible reasons:%0a wrong Port,%0a wrong Baudrate,%0a not NMEA-Protocol%0aConnection to serial port closed%0aLast String tried to interprete:%0a 
+		1512=Waypoint
 		1600=Opencahing.de Download
 		1601=Distance:
 		1602=Download Images
@@ -381,6 +390,37 @@
 		1739=Projection degrees must be in interval [0;2*PI]
 		1800=Download georeferenced maps
 		1801=Download tiles
+		1802=Download georeferenced maps%0a Select online service:
+		1803=for
+		1804=all
+		1805=selected
+		1806=caches
+		1807=Approx. m per pixel:
+		1808=overlapping in pixel:
+		1809=download an overview map
+		1810=Within a rectangle of:
+		1811=around the centre: 
+		1812=Tiles
+		1813=Download one map for
+		1814=Per cache
+		1815=Downloading georeferenced maps
+		1816=Downloading georeferenced maps%0a %0a %0a %0a %0a
+		1817=No caches are seleted
+		1818=getSortedMapServiceIndex: index 
+		1819=not found
+		1820=Downloading map '
+		1821=%0a for cache:%0a
+		1822=Cache: 
+		1823=Ignoring error: 
+		1824=downloading overview map
+		1825=Overview map: Ignoring error: 
+		1826=Finished downloading and calibration of maps
+		1827='radius' must be graeter than 0
+		1828='overlapping' must be greater or equal 0 
+		1829=Please enter the 'centre' around which the maps shall be downloaded
+		1830=The selected online map service provides map in the scale from 
+		1831= to 
+		1832=%0a please adjust 'Approx. meter pro pixel' accordingly
 		2000=GPX Export
 		2001=of
 		2500=Error loading attributes or unknown attribute
@@ -567,6 +607,46 @@
 		4501=Vis:
 		4502=Fnd:
 		4600=Some cache(s) cannot be shown because of wrong blacklist status
+		4700=Ignoring error while%0areading calibration file%0a
+		4701=Searching for best map
+		4702=Optimisation
+		4703=Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?%0aIt can take several minutes.
+		4704=%0aRenaming file:
+		4705=Failed to rename:%0a
+		4706=%0ato:%0an
+		4707=Error while reading: 
+		4800=Loading online map services
+		4801=Ignoring error while %0a reading web map service definition file %0a
+		4802=Downloading calibrated (georeferenced) %0a map image %0a '
+		4803=' %0a Downloading tile %0a row 
+		4804= column 
+		4805=Tile 
+		4806=: Ignoring error: 
+		4807=loadTo: failed to download map: didn't get http-redirect
+		4808=downloadImage: content-type: 
+		4809= is not an image, begin of content: 
+		4810=Error while downloading or saving map:%0a
+		4811=OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):%0a This method must be overloaded in order to be able to use it
+		4812=WebMapService: property >Name:< missing in file:%0a
+		4813=WebMapService: property >MainUrl:< missing in file:%0a
+		4814=WebMapService: no CoordinateReferenceSystemCacheWolf given
+		4815=Coordinate reference system not supported by CacheWolf:%0a
+		4816=WebMapService: property >CoordinateReferenceSystemUrlPart:< missing in file:%0a
+		4817=Number of strings in CoordinateReferenceSystemUrlPart (
+		4818=) must match the number of codes in CoordinateReferenceSystemCacheWolf (
+		4819=) use normal space as separator
+		4820=WebMapService: property >CoordinateReferenceSystemUrlPart:< incorrect in file:%0a
+		4821=WebMapService: property >ImageFileExtension:< missing in file:%0a
+		4822=area: 
+		4823= not covered by service: 
+		4824=, service area: 
+		4825=scale 
+		4826= not supported by online map service, supported scale range: 
+		4827= (measured in meters per pixel vertically)
+		4828=Coordinate system not supported by Cachewolf: 
+		4829=getUrlForBoundingBox: Point: 
+		4830=No matching Gau?-Kr?ger-Stripe in the EPSG-code list in the .wms
+		4831=getMapInfoObject: Coordinate system not supported by Cachewolf: 
 		4900=+is not a german Gauss-Krueger coordinate
 		4920=EPSG code+
 		4921=+not supported

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2008-01-27 19:07:32 UTC (rev 1198)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2008-01-27 19:17:33 UTC (rev 1199)
@@ -92,10 +92,10 @@
 		cacheDB = profile.cacheDB;
 
 		// Button
-		ButtonP.addNext(btnGPS = new mButton("Start"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		ButtonP.addNext(btnGPS = new mButton(MyLocale.getMsg(1504,"Start")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		ButtonP.addNext(btnCenter = new mButton(MyLocale.getMsg(309,"Centre")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		ButtonP.addNext(btnSave = new mButton(MyLocale.getMsg(311,"Create Waypoint")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		ButtonP.addLast(btnMap = new mButton("Map"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		ButtonP.addLast(btnMap = new mButton(MyLocale.getMsg(1506,"Map")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 
 		//Format selection for coords		
 		//context menu
@@ -147,21 +147,10 @@
 		if (compassRose.isNorthCentered()) miNorthCentered.modifiers |= MenuItem.Checked;
 		else miNorthCentered.modifiers &= MenuItem.Checked;
 
-		//log
-		LogP.addNext(lblLog = new mLabel("Log "),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		LogP.addNext(chkLog = new mCheckBox(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		LogP.addNext(inpLogSeconds = new mInput("10"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		LogP.addLast(new mLabel("sec"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-
-		chkLog.useCross = true;
-		chkLog.setState(false);
-		inpLogSeconds.columns = 5;
-
 		//add Panels
 		this.addLast(ButtonP,CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST).setTag(SPAN,new Dimension(2,1));
 		this.addLast(CoordsP,CellConstants.HSTRETCH, CellConstants.HFILL|CellConstants.NORTH).setTag(SPAN,new Dimension(2,1));
 		this.addLast(roseP,CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST).setTag(SPAN,new Dimension(2,1));
-		//this.addLast(LogP,CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.NORTHWEST).setTag(SPAN,new Dimension(1,1));
 
 		// for debuging
 		/*		CWGPSPoint myGPS;
@@ -216,7 +205,7 @@
 	 */ 
 	public void setDestination(CWPoint dest){
 		myNavigation.setDestination(dest);
-		if (!myNavigation.destination.isValid()) (new MessageBox("Error", "Coordinates are out of range: \n"+"latitude: "+myNavigation.destination.latDec+"\n longditue: "+myNavigation.destination.lonDec, MessageBox.OKB)).execute();
+		if (!myNavigation.destination.isValid()) (new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(1507,"Coordinates are out of range:") +"\n"+MyLocale.getMsg(1508,"latitude")+": "+myNavigation.destination.latDec+"\n "+MyLocale.getMsg(1509,"longditue")+": "+myNavigation.destination.lonDec, MessageBox.OKB)).execute();
 		
 	}
 	
@@ -276,13 +265,13 @@
 		}
 		// receiving no data
 		if (fix == -1) {
-			if (gpsStatus != RED) (new MessageBox("Error", "No data from GPS\nConnection to serial port closed",MessageBox.OKB)).exec();
+			if (gpsStatus != RED) (new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1510, "No data from GPS\nConnection to serial port closed"),MessageBox.OKB)).exec();
 			gpsStatus = RED;
 			myNavigation.stopGps();
 		}
 		// cannot interprete data
 		if (fix == -2) {
-			if (gpsStatus != RED) (new MessageBox("Error", "Cannot interpret data from GPS\n possible reasons:\n wrong Port,\n wrong Baudrate,\n not NMEA-Protocol\nConnection to serial port closed\nLast String tried to interprete:\n "+myNavigation.gpsPos.lastStrExamined, MessageBox.OKB)).exec();
+			if (gpsStatus != RED) (new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1511, "Cannot interpret data from GPS\n possible reasons:\n wrong Port,\n wrong Baudrate,\n not NMEA-Protocol\nConnection to serial port closed\nLast String tried to interprete:\n")+myNavigation.gpsPos.lastStrExamined, MessageBox.OKB)).exec();
 			gpsStatus = RED;
 			myNavigation.stopGps(); // TODO automatic in myNavigate?
 		}
@@ -290,7 +279,7 @@
 
 	public void gpsStarted() {
 		chkLog.modify(ControlConstants.Disabled,0);
-		btnGPS.setText("Stop");
+		btnGPS.setText(MyLocale.getMsg(1505,"Stop"));
 	}
 	
 	public void startGps() {
@@ -299,7 +288,7 @@
 	}
 
 	public void gpsStoped() {
-		btnGPS.setText("Start");
+		btnGPS.setText(MyLocale.getMsg(1504,"Start"));
 		gpsStatus = this.backGround;
 		chkLog.modify(0,ControlConstants.Disabled);
 		this.repaintNow(); // without this the change in the background color will not be displayed
@@ -307,7 +296,7 @@
 
 	
 	private String getGotoBtnText() {
-		if (myNavigation.destination == null) return "not set";
+		if (myNavigation.destination == null) return MyLocale.getMsg(999,"Not set");
 		else return myNavigation.destination.toString(currFormat);
 	}
 	
@@ -395,7 +384,7 @@
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			// start/stop GPS connection
 			if (ev.target == btnGPS){
-				if (btnGPS.getText().equals("Start")) startGps();
+				if (btnGPS.getText().equals(MyLocale.getMsg(1504, "Start"))) startGps();
 				else myNavigation.stopGps();
 			}
 
@@ -542,7 +531,7 @@
 	}
 		
 	private void drawWayPointData(Graphics g){
-		String strTemp = "WayPoint";
+		String strTemp = MyLocale.getMsg(1512, "Waypoint");
 		g.setColor(Color.DarkBlue);
 		g.fillRect(0, 0, fm.getTextWidth(strTemp) + 4, lineHeight);
 		g.setColor(Color.White);		

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2008-01-27 19:07:32 UTC (rev 1198)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2008-01-27 19:17:33 UTC (rev 1199)
@@ -5,6 +5,7 @@
 import CacheWolf.Global;
 import CacheWolf.HttpConnection;
 import CacheWolf.InfoBox;
+import CacheWolf.MyLocale;
 import CacheWolf.Preferences;
 import ewe.ui.*;
 import ewe.io.*;
@@ -20,6 +21,7 @@
 
 /**
  *
+ * start offset for language file: 4800
  */
 
 //Um Karten zu holen!
@@ -65,7 +67,7 @@
 			try {
 				if (!showprogress && ((i & 0) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
 					showprogress = true;      
-					progressBox = new InfoBox("Info", "Loading online map services");
+					progressBox = new InfoBox(MyLocale.getMsg(327, "Info"), MyLocale.getMsg(4800, "Loading online map services"));
 					progressBox.exec(); 
 					progressBox.waitUntilPainted(500);
 					ewe.sys.Vm.showWait(true);
@@ -73,7 +75,7 @@
 				tempOMS = new WebMapService(wmspath + "/" + FileName);
 				onlineMapServices.add(tempOMS);
 			}catch(Exception ex){ 
-				if (f == null) (f=new MessageBox("Warning", "Ignoring error while \n reading web map service definition file \n"+ex.toString(), MessageBox.OKB)).exec();
+				if (f == null) (f=new MessageBox(MyLocale.getMsg(144, "Warning"), MyLocale.getMsg(4801, "Ignoring error while \n reading web map service definition file \n")+ex.toString(), MessageBox.OKB)).exec();
 			}
 		}
 		tempOMS = new ExpediaMapService();
@@ -185,12 +187,12 @@
 			lon = topleft.lonDec;
 			for (int col = 1; col <= numMapsX; col++) {
 				if (progressInfobox != null)
-					progressInfobox.setInfo("Downloading calibrated (georeferenced) \n map image \n '" + currentOnlineMapService.getName()+"' \n Downloading tile \n row "+row+" / "+numMapsY+" column "+ col + " / "+numMapsX);
+					progressInfobox.setInfo(MyLocale.getMsg(4802, "Downloading calibrated (georeferenced) \n map image \n '") + currentOnlineMapService.getName()+MyLocale.getMsg(4803, "' \n Downloading tile \n row")+" "+row+" / "+numMapsY+MyLocale.getMsg(4804, " column")+" "+ col + " / "+numMapsX);
 				center.set(lat, lon);
 				try {
 					downloadMap(center, tileScale, tilesSize, tilesPath);
 				} catch (Exception e) {
-					this.progressInfobox.addWarning("Tile " + row + "/" + col + ": Ignoring error: " + e.getMessage()+"\n");
+					this.progressInfobox.addWarning(MyLocale.getMsg(4805, "Tile")+" " + row + "/" + col + MyLocale.getMsg(4806, ": Ignoring error:")+" " + e.getMessage()+"\n");
 				}
 				if (progressInfobox.isClosed) return;
 				lon += loninc;
@@ -269,13 +271,13 @@
 					}
 					i++;
 				}
-				if (i > 4) throw new IOException("loadTo: failed to download map: didn't get http-redirect");
+				if (i > 4) throw new IOException(MyLocale.getMsg(4807, "loadTo: failed to download map: didn't get http-redirect"));
 				String ct = (String)connImg.documentProperties.getValue("content-type", "");
 				if (!ct.substring(0, 5).equalsIgnoreCase("image") )  {
 					String tmp = connImg.readText(sockImg, null).toString(); // TODO if the content is binary will will get an Exception in InfoBox, trying to display the content
 					tmp = tmp.substring(0, (tmp.length() < 1000 ? tmp.length() : 1000));
 					sockImg.close();
-					throw new IOException("downloadImage: content-type: " + ct + " is not an image, begin of content: " + tmp); 
+					throw new IOException(MyLocale.getMsg(4808, "downloadImage: content-type:")+" " + ct + MyLocale.getMsg(4809, " is not an image, begin of content:")+" " + tmp); 
 				}
 				daten = connImg.readData(sockImg);
 				fos = new FileOutputStream(dateiF);
@@ -285,7 +287,7 @@
 			}
 			//Vm.debug("done");
 		}catch(IOException e){
-			throw new IOException("Error while downloading or saving map:\n" + e.getMessage());
+			throw new IOException(MyLocale.getMsg(4810, "Error while downloading or saving map:\n") + e.getMessage());
 		}
 //		(new MessageBox("Error", "Error saving calibration file:\n"+e.getMessage(), MessageBox.OKB)).exec();
 
@@ -389,7 +391,7 @@
 
 	
 	protected MapInfoObject getMapInfoObjectInternal(Area maparea, Point pixelsize) {
-		throw new IllegalArgumentException("OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):\n This method must be overloaded in order to be able to use it");
+		throw new IllegalArgumentException(MyLocale.getMsg(4811, "OnlineMapService: getMapInfoObjectInternal(Area maparea, Point pixelsize):\n This method must be overloaded in order to be able to use it"));
 	}
 	
 	/**
@@ -434,29 +436,29 @@
 		String tmp = File.getFileExt(filename_);
 		this.filename = tmp.substring(0, tmp.lastIndexOf('.'));
 		name = wms.getProperty("Name", "").trim();
-		if (name == "") throw new IllegalArgumentException("WebMapService: property >Name:< missing in file:\n" + filename);
+		if (name == "") throw new IllegalArgumentException(MyLocale.getMsg(4812, "WebMapService: property >Name:< missing in file:\n") + filename);
 		MainUrl = wms.getProperty("MainUrl", "").trim();;
-		if (MainUrl == "") throw new IllegalArgumentException("WebMapService: property >MainUrl:< missing in file:\n" + filename);
+		if (MainUrl == "") throw new IllegalArgumentException(MyLocale.getMsg(4813, "WebMapService: property >MainUrl:< missing in file:\n") + filename);
 		mapType = wms.getProperty("MapType", "maptype_unknown").trim();
 		serviceTypeUrlPart = wms.getProperty("ServiceTypeUrlPart", "SERVICE=WMS").trim();
 		layersUrlPart = wms.getProperty("LayersUrlPart", "").trim();;
 		versionUrlPart = wms.getProperty("VersionUrlPart", "").trim();;
 		tmp = wms.getProperty("CoordinateReferenceSystemCacheWolf", "").trim();
-		if (tmp.equals("")) throw new IllegalArgumentException("WebMapService: no CoordinateReferenceSystemCacheWolf given");
+		if (tmp.equals("")) throw new IllegalArgumentException(MyLocale.getMsg(4814, "WebMapService: no CoordinateReferenceSystemCacheWolf given"));
 		String[] tmp2 = mString.split(tmp, ' ');
 		coordinateReferenceSystem = new int[tmp2.length];
 		for (int i = 0; i < tmp2.length; i++) {
 			coordinateReferenceSystem[i] = Convert.toInt(tmp2[i].trim());
-			if (!TransformCoordinates.isSupported(coordinateReferenceSystem[i])) throw new IllegalArgumentException("Coordinate reference system not supported by CacheWolf:\n" + coordinateReferenceSystem[i]);
+			if (!TransformCoordinates.isSupported(coordinateReferenceSystem[i])) throw new IllegalArgumentException(MyLocale.getMsg(4815, "Coordinate reference system not supported by CacheWolf:\n") + coordinateReferenceSystem[i]);
 		}
 		tmp = wms.getProperty("CoordinateReferenceSystemUrlPart", "").trim();
-		if (tmp == "") throw new IllegalArgumentException("CoordinateReferenceSystemUrlPart: property >MainUrl:< missing in file:\n" + filename);
+		if (tmp == "") throw new IllegalArgumentException(MyLocale.getMsg(4816, "WebMapService: property >CoordinateReferenceSystemUrlPart:< missing in file:\n") + filename);
 		tmp2 = mString.split(tmp, ' ');
-		if (tmp2.length != coordinateReferenceSystem.length) throw new IllegalArgumentException("number of String in CoordinateReferenceSystemUrlPart ("+tmp2.length+") must match the number of codes in CoordinateReferenceSystemCacheWolf ("+coordinateReferenceSystem.length+") use normal space as separator");
+		if (tmp2.length != coordinateReferenceSystem.length) throw new IllegalArgumentException(MyLocale.getMsg(4817, "number of strings in CoordinateReferenceSystemUrlPart (")+tmp2.length+MyLocale.getMsg(4818, ") must match the number of codes in CoordinateReferenceSystemCacheWolf (")+coordinateReferenceSystem.length+MyLocale.getMsg(4819, ") use normal space as separator"));
 		coordinateReferenceSystemUrlPart = new String[tmp2.length];
 		for (int i = 0; i < tmp2.length; i++) {
 			coordinateReferenceSystemUrlPart[i] = tmp2[i].trim();
-			if (coordinateReferenceSystemUrlPart[i] == "") throw new IllegalArgumentException("CoordinateReferenceSystemUrlPart: property >MainUrl:< missing in file:\n" + filename);
+			if (coordinateReferenceSystemUrlPart[i] == "") throw new IllegalArgumentException(MyLocale.getMsg(4820, "WebMapService: property >CoordinateReferenceSystemUrlPart:< incorrect in file:\n") + filename);
 		}
 		requestUrlPart = wms.getProperty("RequestUrlPart", "REQUEST=GetMap").trim();
 		imageFormatUrlPart = wms.getProperty("ImageFormatUrlPart", "").trim();
@@ -473,7 +475,7 @@
 		minscale = minscaleWMS / Math.sqrt(2); // in WMS scale is measured diagonal while in CacheWolf it is measured vertical
 		maxscale = maxscaleWMS / Math.sqrt(2);
 		imageFileExt = wms.getProperty("ImageFileExtension", "").trim();
-		if (imageFileExt == "") throw new IllegalArgumentException("WebMapService: property >ImageFileExtension:< missing in file:\n" + filename);
+		if (imageFileExt == "") throw new IllegalArgumentException(MyLocale.getMsg(4821, "WebMapService: property >ImageFileExtension:< missing in file:\n") + filename);
 		recommendedScale = (float) Common.parseDouble(wms.getProperty("RecommendedScale", "5").trim());
 	}
 
@@ -516,14 +518,14 @@
 	}
 
 	protected String getUrlForBoundingBoxInternal(Area maparea, Point pixelsize) {
-		if (!boundingBox.isOverlapping(maparea)) throw new IllegalArgumentException("area: " + maparea.toString() + " not covered by service: " + name + ", service area: " + boundingBox.toString());
+		if (!boundingBox.isOverlapping(maparea)) throw new IllegalArgumentException(MyLocale.getMsg(4822, "area:")+" " + maparea.toString() + MyLocale.getMsg(4823, " not covered by service:")+" " + name + MyLocale.getMsg(4824, ", service area:")+" " + boundingBox.toString());
 		// http://www.geoserver.nrw.de/GeoOgcWms1.3/servlet/TK25?SERVICE=WMS&VERSION=1.1.0&REQUEST=GetMap&SRS=EPSG:31466&BBOX=2577567.0149,5607721.7566,2578567.0077,5608721.7602&WIDTH=500&HEIGHT=500&LAYERS=Raster:TK25_KMF:Farbkombination&STYLES=&FORMAT=image/png
 		CWPoint buttomleft = new CWPoint (maparea.buttomright.latDec, maparea.topleft.lonDec);
 		CWPoint topright = new CWPoint (maparea.topleft.latDec, maparea.buttomright.lonDec);
 		double scaleh = maparea.buttomright.getDistance(buttomleft) * 1000 / pixelsize.x; 
 		double scalev = maparea.topleft.getDistance(topright) * 1000 / pixelsize.y; 
 		double scale = Math.sqrt(scaleh * scaleh + scalev * scalev); // meters per pixel measured diagonal
-		if ( scale < minscaleWMS || scale > maxscaleWMS ) throw new IllegalArgumentException("scale " + scale / Math.sqrt(2)+ " not supported by online map service, supported scale range: " + minscale + " - " + maxscale + " (measured in meters per pixel vertically)");
+		if ( scale < minscaleWMS || scale > maxscaleWMS ) throw new IllegalArgumentException(MyLocale.getMsg(4825, "scale")+" " + scale / Math.sqrt(2)+ MyLocale.getMsg(4826, " not supported by online map service, supported scale range:")+" " + minscale + " - " + maxscale + MyLocale.getMsg(4827, " (measured in meters per pixel vertically)"));
 		int crs = 0;
 		String bbox = "BBOX=";
 		if (TransformCoordinates.isGermanGk(coordinateReferenceSystem[0])) {
@@ -535,7 +537,7 @@
 			bbox += "," + TransformCoordinates.wgs84ToGermanGk(topright, coordinateReferenceSystem[crs]).toString(2, "", ",");
 		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84) 
 			bbox += buttomleft.toString(CWPoint.LON_LAT)  + "," + topright.toString(CWPoint.LON_LAT);
-		else throw new IllegalArgumentException("Coordinate system not supported by cachewolf: " + coordinateReferenceSystem.toString());
+		else throw new IllegalArgumentException(MyLocale.getMsg(4828, "Coordinate system not supported by cachewolf:")+" " + coordinateReferenceSystem.toString());
 		String ret = MainUrl + "SERVICE=WMS" + "&"+ versionUrlPart + "&" + requestUrlPart + "&" + 
 		coordinateReferenceSystemUrlPart[crs] + "&" + bbox + 
 		"&WIDTH=" + pixelsize.x + "&HEIGHT=" + pixelsize.y + "&" + 
@@ -557,13 +559,13 @@
 		if (coordinateReferenceSystem.length > 1) {
 			GkPoint gkbl = TransformCoordinates.wgs84ToGermanGk(p); // TODO: think / read about what to do if buttom left and top right ae not in the same Gau?-Kr?ger stripe?
 			crs = TransformCoordinates.whichEpsg(coordinateReferenceSystem, gkbl);
-			if (crs < 0) throw new IllegalArgumentException("getUrlForBoundingBox: Point: " + gkbl.toString() + "no matching Gau?-Kr?ger-Stripe in the EPSG-code list in the .wms");
+			if (crs < 0) throw new IllegalArgumentException(MyLocale.getMsg(4829, "getUrlForBoundingBox: Point:")+" " + gkbl.toString() + MyLocale.getMsg(4830, "no matching Gau?-Kr?ger-Stripe in the EPSG-code list in the .wms"));
 		}
 		return crs;
 	}
 
 	protected MapInfoObject getMapInfoObjectInternal(Area maparea, Point pixelsize) {
-		if (!boundingBox.isOverlapping(maparea)) throw new IllegalArgumentException("area: " + maparea.toString() + " not covered by service: " + name + ", service area: " + boundingBox.toString());
+		if (!boundingBox.isOverlapping(maparea)) throw new IllegalArgumentException(MyLocale.getMsg(4822, "area:")+" " + maparea.toString() + MyLocale.getMsg(4823, " not covered by service:")+" " + name + MyLocale.getMsg(4824, ", service area:")+" " + boundingBox.toString());
 		Vector georef = new Vector(4);
 
 		// calculate a rectangle in the according coordinate reference system
@@ -599,7 +601,7 @@
 			buttomright.shift(metersperpixalhorizontal, 0);
 			topright = new CWPoint (topleft.latDec, buttomright.lonDec);
 			buttomleft = new CWPoint (buttomright.latDec, topleft.lonDec);
-		} else throw new IllegalArgumentException("getMapInfoObject: Coordinate system not supported by cachewolf: " + coordinateReferenceSystem);
+		} else throw new IllegalArgumentException(MyLocale.getMsg(4831, "getMapInfoObject: Coordinate system not supported by cachewolf:")+" " + coordinateReferenceSystem);
 		georef.add(new GCPoint(topleft, new Point(0, 0)));
 		georef.add(new GCPoint(buttomright, new Point(pixelsize.x, pixelsize.y)));
 		georef.add(new GCPoint(topright, new Point(pixelsize.x, 0)));

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2008-01-27 19:07:32 UTC (rev 1198)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2008-01-27 19:17:33 UTC (rev 1199)
@@ -17,6 +17,7 @@
  * @author pfeffer
  * This Class is the Dialog for Download calibrated from expedia.com
  * is called from 
+ *  * start offset for language file: 1800
  */
 
 public class MapLoaderGui extends Form {
@@ -26,24 +27,24 @@
 	CellPanel pnlTiles = new CellPanel();
 	CellPanel pnlPerCache = new CellPanel();
 
-	final String descString = "Download georeferenced maps\n Select online service:";
+	final String descString = MyLocale.getMsg(1802,"Download georeferenced maps\n Select online service:");
 	mChoice mapServiceChoice;
-	mCheckBox forCachesChkBox = new mCheckBox("for");
-	mChoice forSelectedChkBox = new mChoice(new String[] {"all", "selected"}, 0);
-	mChoice forSelectedChkBoxPerCache = new mChoice(new String[] {"all", "selected"}, 1);
-	mLabel cachesLbl = new mLabel("caches");
+	mCheckBox forCachesChkBox = new mCheckBox(MyLocale.getMsg(1803,"for"));
+	mChoice forSelectedChkBox = new mChoice(new String[] {MyLocale.getMsg(1804,"all"), MyLocale.getMsg(1805,"selected")}, 0);
+	mChoice forSelectedChkBoxPerCache = new mChoice(new String[] {MyLocale.getMsg(1804,"all"), MyLocale.getMsg(1805,"selected")}, 1);
+	mLabel cachesLbl = new mLabel(MyLocale.getMsg(1806,"caches"));
 	mInput distanceInput;
 	mLabel distLbl;
 	mLabel km = new mLabel("km");
 	mLabel coosLbl;
 	mButton coosBtn;
-	mLabel scaleLbl = new mLabel("Approx. m per pixel:");
+	mLabel scaleLbl = new mLabel(MyLocale.getMsg(1807,"Approx. m per pixel:"));
 	mInput scaleInput = new mInput ("3");
 	mInput scaleInputPerCache = new mInput ("1");
-	mLabel overlappingLbl = new mLabel("overlapping in pixel:");
+	mLabel overlappingLbl = new mLabel(MyLocale.getMsg(1808,"overlapping in pixel:"));
 	mInput overlappingInput = new mInput("100");
-	mCheckBox overviewChkBox = new mCheckBox("download an overview map");
-	mCheckBox overviewChkBoxPerCache = new mCheckBox("download an overview map");
+	mCheckBox overviewChkBox = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
+	mCheckBox overviewChkBoxPerCache = new mCheckBox(MyLocale.getMsg(1809,"download an overview map"));
 
 	MapLoader mapLoader;
 	String[] unsortedMapServices;
@@ -81,13 +82,13 @@
 		pnlTiles.addNext(forCachesChkBox);
 		pnlTiles.addNext(forSelectedChkBox);
 		pnlTiles.addLast(cachesLbl);
-		pnlTiles.addNext(distLbl = new mLabel(MyLocale.getMsg(1802,"Within a rectangle of:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		pnlTiles.addNext(distLbl = new mLabel(MyLocale.getMsg(1810,"Within a rectangle of:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		distanceInput = new mInput();
 		int tmp = Convert.toInt((Global.getProfile().distOC));
 		distanceInput.setText(Convert.toString((tmp > 0 ? tmp : 15)));
 		pnlTiles.addNext(distanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		pnlTiles.addLast(km);
-		pnlTiles.addNext(coosLbl = new mLabel(MyLocale.getMsg(1803, "around the centre: ")));
+		pnlTiles.addNext(coosLbl = new mLabel(MyLocale.getMsg(1811, "around the centre:")+" "));
 		pnlTiles.addLast(coosBtn = new mButton(center.toString()));
 		pnlTiles.addNext(scaleLbl);
 		mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
@@ -108,13 +109,13 @@
 		okBtiles.setHotKey(0, IKeys.ENTER);
 		pnlTiles.addLast(okBtiles,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		updateForCachesState();
-		mTab.addCard(pnlTiles, MyLocale.getMsg(1804, "Tiles"), MyLocale.getMsg(1804, "Tiles"));
+		mTab.addCard(pnlTiles, MyLocale.getMsg(1812, "Tiles"), MyLocale.getMsg(1812, "Tiles"));
 
 		// per cache panel
-		pnlPerCache.addNext(new mLabel("Download one map for"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
+		pnlPerCache.addNext(new mLabel(MyLocale.getMsg(1813, "Download one map for")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
 		pnlPerCache.addNext(forSelectedChkBoxPerCache, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
-		pnlPerCache.addLast(new mLabel("caches"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
-		pnlPerCache.addNext(new mLabel("Approx. m per pixel"), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
+		pnlPerCache.addLast(new mLabel(MyLocale.getMsg(1806, "caches")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
+		pnlPerCache.addNext(new mLabel(MyLocale.getMsg(1807, "Approx. m per pixel")), CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
 		pnlPerCache.addLast(scaleInputPerCache, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
 
 		cancelBPerCache = new mButton(MyLocale.getMsg(1604,"Cancel"));
@@ -125,7 +126,7 @@
 		okBPerCache.setHotKey(0, IKeys.ENTER);
 		pnlPerCache.addLast(okBPerCache, CellConstants.DONTSTRETCH, (CellConstants.DONTFILL));
 
-		mTab.addCard(pnlPerCache, MyLocale.getMsg(1805, "Per cache"), MyLocale.getMsg(1805, "Per Cache"));
+		mTab.addCard(pnlPerCache, MyLocale.getMsg(1814, "Per cache"), MyLocale.getMsg(1813, "Per Cache"));
 		this.addLast(mTab);
 	}
 
@@ -160,7 +161,7 @@
 		for (int i = 0; i < sortingMapServices.length; i++) {
 			if (sortingMapServices[i] == originalindex) return i;
 		}
-		throw new IllegalStateException("getSortedMapServiceIndex: index " + originalindex + "not found");
+		throw new IllegalStateException(MyLocale.getMsg(1818, "getSortedMapServiceIndex: index")+" " + originalindex + MyLocale.getMsg(1819, "not found"));
 	}
 
 	public String getMapsDir() {
@@ -172,7 +173,7 @@
 	public void downloadTiles() {
 		String mapsDir = getMapsDir();
 		if (mapsDir == null) return;
-		InfoBox progressBox = new InfoBox("Downloading georeferenced maps", "Downloading georeferenced maps\n \n \n \n \n", InfoBox.PROGRESS_WITH_WARNINGS);
+		InfoBox progressBox = new InfoBox(MyLocale.getMsg(1815, "Downloading georeferenced maps"), MyLocale.getMsg(1816, "Downloading georeferenced maps\n \n \n \n \n"), InfoBox.PROGRESS_WITH_WARNINGS);
 		progressBox.setPreferredSize(220, 300);
 		progressBox.setInfoHeight(160);
 		progressBox.relayout(false);
@@ -183,7 +184,7 @@
 		if (forCachesChkBox.getState() || perCache) {
 			Area surArea = Global.getProfile().getSourroundingArea(onlySelected); // calculate map boundaries from cacheDB
 			if (surArea == null) {
-				(new MessageBox("Error", "No Caches are seleted", MessageBox.OKB)).execute();
+				(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1817, "No Caches are seleted"), MessageBox.OKB)).execute();
 				Vm.showWait(false);
 				progressBox.close(0);
 				return;
@@ -194,12 +195,12 @@
 			mapLoader.setTiles(center, radius * 1000, scale, size, overlapping);
 		}
 		if (overviewmap) {
-			progressBox.setInfo("downloading overview map"); 
+			progressBox.setInfo(MyLocale.getMsg(1824, "downloading overview map")); 
 			float scale = MapLoader.getScale(center, radius * 1000, size);
 			try {
 				mapLoader.downloadMap(center, scale, size, mapsDir);
 			} catch (Exception e) {
-				progressBox.addWarning("Overview map: Ignoring error: " + e.getMessage()+"\n");
+				progressBox.addWarning(MyLocale.getMsg(1825, "Overview map: Ignoring error:")+" " + e.getMessage()+"\n");
 			}
 		}
 		if (!perCache){  // download tiles
@@ -220,18 +221,18 @@
 					}
 					if (ch.pos.isValid() && ch.pos.latDec != 0 && ch.pos.lonDec != 0) { // TODO != 0 sollte verschwinden, sobald das handling von nicht gesetzten Koos ?berall korrekt ist
 						numdownloaded++;
-						progressBox.setInfo("Downloading map '"+mapLoader.currentOnlineMapService.getName()+"'\n"+numdownloaded+" / "+numCaches+"\n for cache:\n"+ch.CacheName);
+						progressBox.setInfo(MyLocale.getMsg(1820, "Downloading map '")+mapLoader.currentOnlineMapService.getName()+"'\n"+numdownloaded+" / "+numCaches+MyLocale.getMsg(1821, "\n for cache:\n")+ch.CacheName);
 						try {
 							mapLoader.downloadMap(ch.pos, scale, size, mapsDir);
 						} catch (Exception e) {
-							progressBox.addWarning("Cache: " + ch.CacheName + "(" + ch.wayPoint + ") Ignoring error: " + e.getMessage()+"\n");
+							progressBox.addWarning(MyLocale.getMsg(1822, "Cache:")+" " + ch.CacheName + "(" + ch.wayPoint + ") "+MyLocale.getMsg(1823, "Ignoring error:")+" " + e.getMessage()+"\n");
 						}
 					}
 				}
 			}
 		}
 		Vm.showWait(false);
-		progressBox.addWarning("Finished downloading and calibration of maps");
+		progressBox.addWarning(MyLocale.getMsg(1826, "Finished downloading and calibration of maps"));
 		progressBox.addOkButton();
 		progressBox.waitUntilClosed();
 		mapLoader.setProgressInfoBox(null);
@@ -272,7 +273,7 @@
 				mapLoader.setCurrentMapService(sortingMapServices[mapServiceChoice.selectedIndex]);
 				if (ev.target == okBtiles) { // get tiles
 					perCache = false;
-					if (forSelectedChkBox.getSelectedItem().toString().equalsIgnoreCase("all")) onlySelected = false;
+					if (forSelectedChkBox.getSelectedItem().toString().equalsIgnoreCase(MyLocale.getMsg(1804, "all"))) onlySelected = false;
 					else onlySelected = true;
 					overviewmap = overviewChkBox.getState();
 					radius = Convert.toFloat(distanceInput.getText());
@@ -280,27 +281,27 @@
 					overlapping = Convert.toInt(overlappingInput.getText());
 					if (!forCachesChkBox.getState()) {
 						if (radius <= 0) { 
-							(new MessageBox("Error", "'radius' must be graeter than null", MessageBox.OKB)).execute();
+							(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1827, "'radius' must be graeter than 0"), MessageBox.OKB)).execute();
 							return;
 						}
 						if (overlapping < 0) { 
-							(new MessageBox("Error", "'overlapping' must be greater or equal 0 ", MessageBox.OKB)).execute();
+							(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1828, "'overlapping' must be greater or equal 0"), MessageBox.OKB)).execute();
 							return;
 						}
 						if (!center.isValid() && !forCachesChkBox.getState()) {
-							(new MessageBox("Error", "Please enter the 'centre' around which the maps shall be downloaded", MessageBox.OKB)).execute();
+							(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1829, "Please enter the 'centre' around which the maps shall be downloaded"), MessageBox.OKB)).execute();
 							return;
 						}
 					}
 				} else { // per cache
 					perCache = true;
-					if (forSelectedChkBoxPerCache.getSelectedItem().toString().equalsIgnoreCase("all")) onlySelected = false;
+					if (forSelectedChkBoxPerCache.getSelectedItem().toString().equalsIgnoreCase(MyLocale.getMsg(1804, "all"))) onlySelected = false;
 					else onlySelected = true;
 					overviewmap = overviewChkBoxPerCache.getState();
 					scale = Convert.toFloat(scaleInputPerCache.getText());
 				}
 				if (scale < mapLoader.currentOnlineMapService.minscale || scale > mapLoader.currentOnlineMapService.maxscale) {
-					(new MessageBox("Error", "The selected online map service provides map in the scale from " + mapLoader.currentOnlineMapService.minscale + " to "+ mapLoader.currentOnlineMapService.maxscale +"\n please adjust 'Approx. meter pro pixel' accordingly", MessageBox.OKB)).execute();
+					(new MessageBox(MyLocale.getMsg(321, "Error"), MyLocale.getMsg(1830, "The selected online map service provides map in the scale from")+" " + mapLoader.currentOnlineMapService.minscale + MyLocale.getMsg(1831, " to")+" "+ mapLoader.currentOnlineMapService.maxscale +MyLocale.getMsg(1832, "\n please adjust 'Approx. meter pro pixel' accordingly"), MessageBox.OKB)).execute();
 					return;
 				}
 				this.close(Form.IDOK); 

Modified: trunk/src/CacheWolf/navi/MapsList.java
===================================================================
--- trunk/src/CacheWolf/navi/MapsList.java	2008-01-27 19:07:32 UTC (rev 1198)
+++ trunk/src/CacheWolf/navi/MapsList.java	2008-01-27 19:17:33 UTC (rev 1199)
@@ -3,6 +3,7 @@
 import CacheWolf.CWPoint;
 import CacheWolf.Common;
 import CacheWolf.InfoBox;
+import CacheWolf.MyLocale;
 import utils.FileBugfix;
 import ewe.io.CompressedRandomStream;
 import ewe.io.File;
@@ -20,7 +21,7 @@
  * class to handle a list of maps
  * it loads the list, finds the best map for a given location,
  * says if a map is available for a given lat lon at a given scale
- * @author r
+ * start offset for language file: 4700
  *
  */
 public class MapsList extends Vector {
@@ -60,7 +61,7 @@
 					add(tempMIO);
 					//ewe.sys.Vm.debug(tempMIO.getEasyFindString() + tempMIO.mapName);
 				}catch(Exception ex){ // TODO exception ist, glaub ich evtl ?berfl?ssig 
-					if (f == null) (f=new MessageBox("Warning", "Ignoring error while \n reading calibration file \n"+ex.toString(), MessageBox.OKB)).exec();
+					if (f == null) (f=new MessageBox(MyLocale.getMsg(144, "Warning"), MyLocale.getMsg(4700, "Ignoring error while \n reading calibration file \n")+ex.toString(), MessageBox.OKB)).exec();
 				} /* catch(ArithmeticException ex){ // affine contain not allowed values 
 					if (f == null) (f=new MessageBox("Warning", "Ignoring error while \n reading calibration file \n"+ex.toString(), MessageBox.OKB)).exec();
 				} */
@@ -118,7 +119,7 @@
 		for (int i=size()-1; i >= 0 ;i--) {
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
 				showprogress = true;      
-				progressBox = new InfoBox("Info", "Searching for best map");
+				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
 				progressBox.exec(); 
 				progressBox.waitUntilPainted(100);
 				ewe.sys.Vm.showWait(true);
@@ -197,7 +198,7 @@
 		for (int i=size() -1; i>=0 ;i--) {
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
 				showprogress = true;      
-				progressBox = new InfoBox("Info", "Searching for best map");
+				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
 				progressBox.exec(); 
 				progressBox.waitUntilPainted(100);
 				ewe.sys.Vm.showWait(true);
@@ -266,7 +267,7 @@
 		for (int i=size()-1; i >= 0 ;i--) { 
 			if (!showprogress && ((i & 31) == 0) && (new Time().getTime()-start  > 100) ) { // reason for (i & 7 == 0): test time only after i is incremented 15 times
 				showprogress = true;      
-				progressBox = new InfoBox("Info", "Searching for best map");
+				progressBox = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4701,"Searching for best map"));
 				progressBox.exec(); 
 				progressBox.waitUntilPainted(100);
 				ewe.sys.Vm.showWait(true);
@@ -441,10 +442,10 @@
 				sortEntryBBox = "FF1"+map.getEasyFindString();
 				ewe.sys.Vm.debug(sortEntryBBox + ": "+filename);
 				if (rename == 0) { // never asked before
-					if ( (new MessageBox("Optmisiation", "Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?\n It can take several minutes", 
+					if ( (new MessageBox(MyLocale.getMsg(4702,"Optimisation"), MyLocale.getMsg(4703,"Cachewolf can make loading maps much faster by adding a identification mark to the filename. Do you want me to do this now?\n It can take several minutes"), 
 							MessageBox.YESB | MessageBox.NOB)).execute() == MessageBox.IDYES)
 					{
-						renameProgressInfoB = new InfoBox("Info", "\nRenaming file:    \n");
+						renameProgressInfoB = new InfoBox(MyLocale.getMsg(327,"Info"), MyLocale.getMsg(4704,"\nRenaming file:")+"    \n");
 						renameProgressInfoB.exec();
 						renameProgressInfoB.waitUntilPainted(100);
 						rename = 1; // rename
@@ -452,21 +453,21 @@
 				}
 				if (rename == 1) {
 					renameCounter++;
-					renameProgressInfoB.setInfo("\nRenaming file: " + renameCounter+"\n");
+					renameProgressInfoB.setInfo(MyLocale.getMsg(4704,"\nRenaming file:")+" " + renameCounter+"\n");
 					String f = path+filename+".wfl";
 					String to = sortEntryBBox+"E-"+filename+".wfl";
 					if (!new File(f).rename(to))
-						(new MessageBox("Error", "Failed to rename:\n"+f+".wfl"+"\nto:\n"+to, MessageBox.OKB)).exec();
+						(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4705,"Failed to rename:\n")+f+".wfl"+MyLocale.getMsg(4706,"\nto:\n")+to, MessageBox.OKB)).exec();
 					f = Common.getImageName(path+filename);
 					to = sortEntryBBox+"E-"+filename+Common.getFilenameExtension(f);
 					if (!new File(f).rename(to)) 
-						(new MessageBox("Error", "Failed to rename:\n"+f+".wfl"+"\nto:\n"+to, MessageBox.OKB)).exec();
+						(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4705,"Failed to rename:\n")+f+".wfl"+MyLocale.getMsg(4706,"\nto:\n")+to, MessageBox.OKB)).exec();
 					filename = sortEntryBBox+"E-"+filename;
 					map.mapName = sortEntryBBox+"E-"+map.mapName;
 					map.fileNameWFL = path + filename + ".wfl";
 				}
 			} catch (IOException ioex) { // this should not happen
-				(new MessageBox("Error", "Error while reading: "+path+filename+": "+ ioex.getMessage(), MessageBox.OKB)).exec();
+				(new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4706,"Error while reading:")+" "+path+filename+": "+ ioex.getMessage(), MessageBox.OKB)).exec();
 			}
 		}
 	}



From pfeffer at mail.berlios.de  Sun Jan 27 20:43:31 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 27 Jan 2008 20:43:31 +0100
Subject: [Cachewolf-svn] r1200 - in trunk: res_noewe resources
Message-ID: <200801271943.m0RJhV93012227@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-27 20:43:13 +0100 (Sun, 27 Jan 2008)
New Revision: 1200

Added:
   trunk/resources/images.gif
   trunk/resources/images_32x32.gif
   trunk/resources/recommendedlog.gif
Removed:
   trunk/res_noewe/images.gif
   trunk/res_noewe/images_32x32.gif
   trunk/res_noewe/recommendedlog.gif
Log:
moved some ressources to the correct folder

Deleted: trunk/res_noewe/images.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/images_32x32.gif
===================================================================
(Binary files differ)

Deleted: trunk/res_noewe/recommendedlog.gif
===================================================================
(Binary files differ)

Copied: trunk/resources/images.gif (from rev 1199, trunk/res_noewe/images.gif)

Copied: trunk/resources/images_32x32.gif (from rev 1199, trunk/res_noewe/images_32x32.gif)

Copied: trunk/resources/recommendedlog.gif (from rev 1199, trunk/res_noewe/recommendedlog.gif)



From pfeffer at mail.berlios.de  Sun Jan 27 21:16:50 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Sun, 27 Jan 2008 21:16:50 +0100
Subject: [Cachewolf-svn] r1201 - trunk/src/CacheWolf
Message-ID: <200801272016.m0RKGo45014350@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-27 21:16:45 +0100 (Sun, 27 Jan 2008)
New Revision: 1201

Modified:
   trunk/src/CacheWolf/DescriptionPanel.java
Log:
hopefully fixed: DescriptionPanel.setText(DescriptionPanel.java:77): ArrayIndexOutOfBoundsException, see http://www.geoclub.de/ftopic21816.html

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2008-01-27 19:43:13 UTC (rev 1200)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2008-01-27 20:16:45 UTC (rev 1201)
@@ -65,24 +65,26 @@
 					int pos;
 					int imageNo=0;
 					Regex imgRex = new Regex("src=(?:\\s*[^\"|']*?)(?:\"|')(.*?)(?:\"|')");
-					while (start>=0 && (pos=desc.indexOf("<img",start))>0) {
-						s.append(desc.substring(start,pos));
-						imgRex.searchFrom(desc,pos);
-						String imgUrl=imgRex.stringMatched(1);
-						//Vm.debug("imgUrl "+imgUrl);
-						if (imgUrl.lastIndexOf('.')>0 && imgUrl.toLowerCase().startsWith("http")) {
-							String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
-							// If we have an image which we stored when spidering, we can display it
-							if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
-								s.append("<img src=\""+
-								   //Global.getProfile().dataDir+
-								   Images.get(imageNo)+"\">");
-								imageNo++;
+					if (Images.getCount() > 0) {
+						while (start>=0 && (pos=desc.indexOf("<img",start))>0) {
+							s.append(desc.substring(start,pos));
+							imgRex.searchFrom(desc,pos);
+							String imgUrl=imgRex.stringMatched(1);
+							//Vm.debug("imgUrl "+imgUrl);
+							if (imgUrl.lastIndexOf('.')>0 && imgUrl.toLowerCase().startsWith("http")) {
+								String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
+								// If we have an image which we stored when spidering, we can display it
+								if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
+									s.append("<img src=\""+
+											//Global.getProfile().dataDir+
+											Images.get(imageNo)+"\">");
+									imageNo++;
+								}
 							}
+							start=desc.indexOf(">",pos);
+							if (start>=0) start++;
+							if (imageNo >= Images.getCount())break;
 						}
-						start=desc.indexOf(">",pos);
-						if (start>=0) start++;
-						if (imageNo >= Images.getCount())break;
 					}
 					if (start>=0) s.append(desc.substring(start));
 					desc=s.toString();



From mik77 at mail.berlios.de  Tue Jan 29 19:54:57 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 29 Jan 2008 19:54:57 +0100
Subject: [Cachewolf-svn] r1202 - trunk/src/CacheWolf/navi
Message-ID: <200801291854.m0TIsvX4028642@sheep.berlios.de>

Author: mik77
Date: 2008-01-29 19:54:55 +0100 (Tue, 29 Jan 2008)
New Revision: 1202

Modified:
   trunk/src/CacheWolf/navi/GotoPanel.java
Log:
some cleanup

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2008-01-27 20:16:45 UTC (rev 1201)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2008-01-29 18:54:55 UTC (rev 1202)
@@ -40,10 +40,7 @@
 	int currFormat;
 
 	mLabel lblGPS, lblPosition, lblDST;
-	mLabel lblLog;
 	Color gpsStatus;
-	mCheckBox chkLog;
-	mInput inpLogSeconds;
 
 	MainTab mainT;
 	Vector cacheDB;
@@ -55,7 +52,6 @@
 	CellPanel ButtonP = new CellPanel();
 	CellPanel CoordsP = new CellPanel();
 	CellPanel roseP = new CellPanel();
-	CellPanel LogP = new CellPanel();
 
 	ImageControl icRose;
 	GotoRose compassRose;
@@ -278,7 +274,6 @@
 	}
 
 	public void gpsStarted() {
-		chkLog.modify(ControlConstants.Disabled,0);
 		btnGPS.setText(MyLocale.getMsg(1505,"Stop"));
 	}
 	
@@ -290,7 +285,6 @@
 	public void gpsStoped() {
 		btnGPS.setText(MyLocale.getMsg(1504,"Start"));
 		gpsStatus = this.backGround;
-		chkLog.modify(0,ControlConstants.Disabled);
 		this.repaintNow(); // without this the change in the background color will not be displayed
 	}
 



From mik77 at mail.berlios.de  Tue Jan 29 20:03:20 2008
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 29 Jan 2008 20:03:20 +0100
Subject: [Cachewolf-svn] r1203 - trunk/res_noewe/languages
Message-ID: <200801291903.m0TJ3K82029938@sheep.berlios.de>

Author: mik77
Date: 2008-01-29 20:03:19 +0100 (Tue, 29 Jan 2008)
New Revision: 1203

Modified:
   trunk/res_noewe/languages/DE.cfg
Log:
all umlauts coded and some menu entries shortened

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-29 18:54:55 UTC (rev 1202)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-29 19:03:19 UTC (rev 1203)
@@ -574,19 +574,19 @@
 		4240=Karte ausblenden
 		4241=Karte ausblenden
 		4242=Modus f%fcr automatischen Kartenwechsel
-		4244=H?chsten Detailgrad, die aktuelle und Zielposition enth?lt
-		4245=H?chsten Detailgrad, die aktuelle und Zielposition enth?lt
-		4246=H?chster verf?gbarer Detaillierungsgrad
-		4247=H?chster verf?gbare Detaillierungsgrad
-		4248=Manuellen Detaillierungsgrad m?glichst beibehalten
-		4249=Manuellen Detaillierungsgrad m?glichst beibehalten
-		4250=Detaillierungsgrad manuell w?hlen
-		4252=Karte laden, die alle markierten Caches enth?lt
-		4253=Karte laden, die alle markierten Caches enth?lt
+		4244=H%f6chster Detailgrad mit aktueller und Zielposition
+		4245=H%f6chster Detailgrad mit aktueller und Zielposition
+		4246=H%f6chster verf%fcgbarer Detailgrad
+		4247=H%f6chster verf%fcgbarer Detailgrad
+		4248=Manuellen Detailgrad m%f6glichst beibehalten
+		4249=Manuellen Detailgrad m%f6glichst beibehalten
+		4250=Detailgrad manuell w%e4hlen
+		4252=Karte mit allen markierten Caches laden
+		4253=Karte mit allen markierten Caches laden
 		4254=Karte mit mehr Details laden
 		4255=Karte mit mehr Details laden
-		4256=Karte mir mehr ?berblick laden
-		4257=Karte mir mehr ?berblick laden
+		4256=Karte mir mehr %dcberblick laden
+		4257=Karte mir mehr %dcberblick laden
 		4258=Karte verschieben und neue laden		
 		4260=Karte zum Ziel verschieben
 		4261=Karte zum Ziel verschieben
@@ -594,14 +594,14 @@
 		4263=Karte zum GPS verschieben
 		4264=Karte zum Zentrum verschieben
 		4265=Karte zum Zentrum verschieben
-		4270=?ffne
+		4270=%d6ffne
 		4271=Karten
 		4272=--- Karten von akt. Position und Ziel ---
 		4273=--- Karten der aktuellen Position ---
 		4274=--- Karten des Ziels ---
 		4275=--- Andere Karten ---
 		4276=Abbrechen
-		4277=Ausw?hlen
+		4277=Ausw%e4hlen
 		4278=Kann folgende .wfl-Datei nicht laden:+%0a
 		4300=Leer 1 Punkt =+
 		4301=+meter
@@ -612,10 +612,10 @@
 		4306=Karte ist nicht georeferenziert
 		4400=Warnung
 		4401=Ignoriere Fehler: Konnte Daten nicht an Host weiterleiten:%0a
-		4402=F?r einen neuen Versuch, stoppe und starte GPS neu
+		4402=F%fcr einen neuen Versuch, stoppe und starte GPS neu
 		4403=Fehler
-		4404=Konnte keine Verbindung zum GPS-Empf?nger %0a herstellen. Fehler beim ?ffnen des seriellen Ports%0a
-		4405=M?gliche Gr?nde:%0a Falscher Port %0a Ein anderes Programm blokiert den Anschluss %0a Auf Loox-Ger?ten: ge?ffneter Infrarot-Port blockiert das GPS
+		4404=Konnte keine Verbindung zum GPS-Empf%e4nger %0a herstellen. Fehler beim %f6ffnen des seriellen Ports%0a
+		4405=M%f6gliche Gr%fcnde:%0a Falscher Port %0a Ein anderes Programm blokiert den Anschluss %0a Auf Loox-Ger%e4ten: ge%f6ffneter Infrarot-Port blockiert das GPS
 		4500=Ges:
 		4501=Gez:
 		4502=Gef:
@@ -661,9 +661,9 @@
 		4829=getUrlForBoundingBox: Punkt: 
 		4830=Kein passender Gau%df-Kr%fcger-Streifen in der EPSG-Codeliste in der .wms-Datei
 		4831=getMapInfoObject: Koordinatensystem wird von Cachewolf nicht unterst%fctzt: 
-		4900=+ist keine deutsche Gau?-Kr?ger-Koordinate
+		4900=+ist keine deutsche Gau%df-Kr%fcger-Koordinate
 		4920=EPSG-Code+
-		4921=+nicht unterst?tzt
+		4921=+nicht unterst%fctzt
 		4922=EPSG code fehlt in:+%0a
 		4923=fromWgs84: EPSG code+
 		4924=ToWgs84: EPSG code+



From pfeffer at mail.berlios.de  Tue Jan 29 21:39:17 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 29 Jan 2008 21:39:17 +0100
Subject: [Cachewolf-svn] r1204 - trunk/res_noewe/languages
Message-ID: <200801292039.m0TKdHDd011354@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-29 21:39:11 +0100 (Tue, 29 Jan 2008)
New Revision: 1204

Modified:
   trunk/res_noewe/languages/DE.cfg
Log:
DE: Rechtschreibfehler korrigiert

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2008-01-29 19:03:19 UTC (rev 1203)
+++ trunk/res_noewe/languages/DE.cfg	2008-01-29 20:39:11 UTC (rev 1204)
@@ -585,8 +585,8 @@
 		4253=Karte mit allen markierten Caches laden
 		4254=Karte mit mehr Details laden
 		4255=Karte mit mehr Details laden
-		4256=Karte mir mehr %dcberblick laden
-		4257=Karte mir mehr %dcberblick laden
+		4256=Karte mit mehr %dcberblick laden
+		4257=Karte mit mehr %dcberblick laden
 		4258=Karte verschieben und neue laden		
 		4260=Karte zum Ziel verschieben
 		4261=Karte zum Ziel verschieben
@@ -615,7 +615,7 @@
 		4402=F%fcr einen neuen Versuch, stoppe und starte GPS neu
 		4403=Fehler
 		4404=Konnte keine Verbindung zum GPS-Empf%e4nger %0a herstellen. Fehler beim %f6ffnen des seriellen Ports%0a
-		4405=M%f6gliche Gr%fcnde:%0a Falscher Port %0a Ein anderes Programm blokiert den Anschluss %0a Auf Loox-Ger%e4ten: ge%f6ffneter Infrarot-Port blockiert das GPS
+		4405=%0aM%f6gliche Gr%fcnde:%0a Falscher Port %0a Ein anderes Programm blokiert den Anschluss %0a gilt nur auf Loox-Ger%e4ten: ge%f6ffneter Infrarot-Port blockiert das GPS
 		4500=Ges:
 		4501=Gez:
 		4502=Gef:



From pfeffer at mail.berlios.de  Tue Jan 29 21:40:18 2008
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Tue, 29 Jan 2008 21:40:18 +0100
Subject: [Cachewolf-svn] r1205 - trunk/src/CacheWolf
Message-ID: <200801292040.m0TKeIYa011596@sheep.berlios.de>

Author: pfeffer
Date: 2008-01-29 21:40:10 +0100 (Tue, 29 Jan 2008)
New Revision: 1205

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Maps: no "\" anymore in any path (replaced by "/")

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-01-29 20:39:11 UTC (rev 1204)
+++ trunk/src/CacheWolf/Preferences.java	2008-01-29 20:40:10 UTC (rev 1205)
@@ -287,7 +287,7 @@
 			if (tmp != null) solverDegMode=Boolean.valueOf(tmp).booleanValue();
 		}
 		else if (name.equals("mapspath")) {
-			customMapsPath=atts.getValue("dir");
+			customMapsPath=atts.getValue("dir").replace('\\', '/');
 		}
 		else if (name.equals("debug")) debug=Boolean.valueOf(atts.getValue("value")).booleanValue();
 		
@@ -368,7 +368,7 @@
 			outp.print("    <spider forcelogin=\""+forceLogin+"\"/>\n");
 			outp.print("    <gotopanel northcentered=\""+northCenteredGoto+"\" />\n");
 			outp.print("    <details cacheSize=\""+maxDetails+"\" delete=\""+deleteDetails+"\"/>\n");
-			if (customMapsPath!=null) outp.print("	<mapspath dir = \""+ customMapsPath +"\"/>\n");
+			if (customMapsPath!=null) outp.print("	<mapspath dir = \""+ customMapsPath.replace('\\','/') +"\"/>\n");
 			if (debug) outp.print("    <debug value=\"true\" />\n"); // Keep the debug switch if it is set
 			// save last path of different exporters
 			Iterator itPath = exporterPaths.entries();
@@ -391,8 +391,8 @@
 	private static final String mapsPath = "maps/standard";
 	
 	/**
-	 * Gibt den vom Benutzer gesetzten Pfad zu den Maps
-	 * @return custom Maps Path, null wenn nicht gesetzt
+	 * custom = set by the user
+	 * @return custom Maps Path, null if not set
 	 */
 	public String getCustomMapsPath() {
 	   return customMapsPath;	
@@ -400,7 +400,7 @@
 	
 	public void saveCustomMapsPath(String mapspath_) {
 		if (customMapsPath == null || !customMapsPath.equals(mapspath_)) {
-			customMapsPath=new String(mapspath_);
+			customMapsPath=new String(mapspath_).replace('\\', '/');
 			savePreferences();
 		}
 	}
@@ -427,7 +427,7 @@
 		if (ret != null) return ret; 
 		ret = getMapManuallySavePath(false);
 		File t = new FileBugfix(ret);
-		String[] f = t.list("*.wfl", File.LIST_ALWAYS_INCLUDE_DIRECTORIES | File.LIST_FILES_ONLY);
+		String[] f = t.list("*.wfl", File.LIST_FILES_ONLY);
 		if (f != null && f.length > 0) return  baseDir + mapsPath;
 		f = t.list("*.wfl", File.LIST_DIRECTORIES_ONLY | File.LIST_ALWAYS_INCLUDE_DIRECTORIES);
 		if (f != null && f.length > 0) { // see if in a subdir of <baseDir>/maps/standard are .wfl files
@@ -470,7 +470,7 @@
 	}
 
 	/**
-	 * it creates the directory if it doesn't exist
+	 * @param create if true the directory if it doesn't exist will be created
 	 * @return the path where manually imported maps should be stored
 	 * this should be adjustable in preferences...
 	 */
@@ -489,7 +489,7 @@
 	 * to this path the automatically downloaded maps are saved
 	 */
 	public String getMapDownloadSavePath(String mapkind) {
-		String subdir = Global.getProfile().dataDir.substring(Global.getPref().baseDir.length());
+		String subdir = Global.getProfile().dataDir.substring(Global.getPref().baseDir.length()).replace('\\', '/');
 		String mapsDir = Global.getPref().baseDir + "maps/" + Common.ClearForFileName(mapkind)+ "/" + subdir;
 		if (!(new File(mapsDir).isDirectory())) { // dir exists? 
 			if (new File(mapsDir).mkdirs() == false) // dir creation failed?
@@ -501,7 +501,7 @@
 	}
 
 	public String getMapExpediaLoadPath() {
-		return Global.getPref().baseDir + "maps/expedia"; // baseDir has trailing /
+		return Global.getPref().baseDir.replace('\\', '/') + "maps/expedia"; // baseDir has trailing /
 	}
 	
     //////////////////////////////////////////////////////////////////////////////////////



From salzkammergut at mail.berlios.de  Wed Jan 30 18:51:43 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 30 Jan 2008 18:51:43 +0100
Subject: [Cachewolf-svn] r1206 - trunk/src/CacheWolf
Message-ID: <200801301751.m0UHphCf027834@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-30 18:51:31 +0100 (Wed, 30 Jan 2008)
New Revision: 1206

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Added additional debug info when login fails (only displayed if debug=true)

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2008-01-29 20:40:10 UTC (rev 1205)
+++ trunk/src/CacheWolf/SpiderGC.java	2008-01-30 17:51:31 UTC (rev 1206)
@@ -151,6 +151,10 @@
 						pref.log("[login]:Login successful");
 					else {
 						pref.log("[login]:Login failed. Wrong Account or Password?");
+						if (pref.debug) {
+							pref.log("[login.LoginUrl]:"+sb.toString());
+							pref.log("[login.Answer]:"+start);
+						}
 						infB.close(0);
 						(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5501,"Login failed! Wrong account or password?"), MessageBox.OKB)).execute();
 						return ERR_LOGIN;
@@ -1103,6 +1107,8 @@
 			chD.attributes.add(attribute);
 			attribute=attEx.findNext();
 		}
+		//chD.attributesYes = chD.attributes.attributesYes;
+		//chD.attributesNo = chD.attributes.attributesNo;
 	}
 
 



From salzkammergut at mail.berlios.de  Thu Jan 31 17:00:51 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 31 Jan 2008 17:00:51 +0100
Subject: [Cachewolf-svn] r1207 - in trunk/src: CacheWolf exp
Message-ID: <200801311600.m0VG0pXM018195@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-31 17:00:45 +0100 (Thu, 31 Jan 2008)
New Revision: 1207

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/exp/LocExporter.java
Log:
Feature: Export to Garmin: For Garmin etrex users the waypoint name can be limited to 6 (or any other number of characters as set in the preferences: garmin.MaxWaypointLength). If this number is greater than 0, the last n characters of the waypoint are used. If it is 0, the waypoint name is left unchanged.
See also http://www.geoclub.de/ftopic21892.html

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2008-01-30 17:51:31 UTC (rev 1206)
+++ trunk/src/CacheWolf/Preferences.java	2008-01-31 16:00:45 UTC (rev 1207)
@@ -130,6 +130,8 @@
 	public String garminConn="com1";  
 	/** Additional options for GPSBabel, i.e. -s to synthethise short names */
 	public String garminGPSBabelOptions=""; 
+	/** Max. length for Garmin waypoint names (for etrex which can only accept 6 chars) */
+	public int garminMaxLen=0;
 	public boolean downloadPicsOC = true; //TODO Sollten die auch im Profil gespeichert werden mit Preferences als default Werte ?
 	public boolean downloadMapsOC = true;
 	public boolean downloadmissingOC = false;
@@ -260,6 +262,8 @@
 			garminConn=atts.getValue("connection");
 			tmp = atts.getValue("GPSBabelOptions");
 			if (tmp != null) garminGPSBabelOptions=tmp;
+			tmp = atts.getValue("MaxWaypointLength");
+			if (tmp != null) garminMaxLen=Convert.toInt(atts.getValue("MaxWaypointLength"));
 		}
 		else if (name.equals("imagepanel")) {
 			showDeletedImages = Boolean.valueOf(atts.getValue("showdeletedimages")).booleanValue();
@@ -362,7 +366,7 @@
 			outp.print("    <imagepanel showdeletedimages=\""+showDeletedImages+"\"/>\n");
 			outp.print("    <hintlogpanel logsperpage=\""+logsPerPage+"\" initialhintheight=\""+initialHintHeight+"\"  maxspiderlogs=\""+maxLogsToSpider+"\" />\n");
 			outp.print("    <solver ignorevariablecase=\""+solverIgnoreCase+"\" degMode=\""+solverDegMode+"\" />\n");
-			outp.print("    <garmin connection = \""+garminConn+"\" GPSBabelOptions = \""+garminGPSBabelOptions+"\" />\n");
+			outp.print("    <garmin connection = \""+garminConn+"\" GPSBabelOptions = \""+garminGPSBabelOptions+"\" MaxWaypointLength = \""+garminMaxLen+"\" />\n");
 			outp.print("    <opencaching downloadPicsOC=\""+downloadPicsOC+"\" downloadMaps=\""+downloadMapsOC+"\" downloadMissing=\""+downloadmissingOC+"\"/>\n");
 			outp.print("	<location lat = \""+curCentrePt.getLatDeg(CWPoint.DD)+"\" long = \""+curCentrePt.getLonDeg(CWPoint.DD)+"\"/>\n");
 			outp.print("    <spider forcelogin=\""+forceLogin+"\"/>\n");

Modified: trunk/src/exp/LocExporter.java
===================================================================
--- trunk/src/exp/LocExporter.java	2008-01-30 17:51:31 UTC (rev 1206)
+++ trunk/src/exp/LocExporter.java	2008-01-31 16:00:45 UTC (rev 1207)
@@ -36,7 +36,14 @@
 		if (!chD.pos.isValid()) return null;
 		StringBuffer strBuf = new StringBuffer(200);
 		strBuf.append("<waypoint>\r\n   <name id=\"");
-		strBuf.append(simplifyString(chD.wayPoint));
+		String wptName=simplifyString(chD.wayPoint);
+		if (Global.getPref().garminMaxLen==0)
+			strBuf.append(wptName);
+		else {
+			try {
+				strBuf.append(wptName.substring(wptName.length()-Global.getPref().garminMaxLen));
+			} catch (Exception ex){ pref.log("Invalid value for garmin.MaxWaypointLength"); }
+		}
 		strBuf.append("\"><![CDATA[");
 		strBuf.append(simplifyString(chD.CacheName));
 		strBuf.append("]]></name>\r\n   <coord lat=\"");



From salzkammergut at mail.berlios.de  Thu Jan 31 17:26:22 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 31 Jan 2008 17:26:22 +0100
Subject: [Cachewolf-svn] r1208 - trunk/src/CacheWolf
Message-ID: <200801311626.m0VGQMjX022018@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-31 17:26:17 +0100 (Thu, 31 Jan 2008)
New Revision: 1208

Modified:
   trunk/src/CacheWolf/SearchCache.java
Log:
Search: Feature: Search now also looks in the cache status ("Found", "Flag 1", ...) in addition to waypoint name and cache title. Although the cachestatus offers some pre-set texts, any text can be entered here (For example "#1" or "TODO"). Search is uppercase in all three fields (name, title and status).
See also http://www.geoclub.de/ftopic21760-6.html

Modified: trunk/src/CacheWolf/SearchCache.java
===================================================================
--- trunk/src/CacheWolf/SearchCache.java	2008-01-31 16:00:45 UTC (rev 1207)
+++ trunk/src/CacheWolf/SearchCache.java	2008-01-31 16:26:17 UTC (rev 1208)
@@ -34,7 +34,8 @@
 				ch = (CacheHolder)cacheDB.get(i);
 				if (ch.is_filtered) break; // Reached end of visible records
 				if(ch.wayPoint.toUpperCase().indexOf(searchStr) <0 && 
-				   ch.CacheName.toUpperCase().indexOf(searchStr) <0){
+				   ch.CacheName.toUpperCase().indexOf(searchStr) <0 && 
+				   ch.CacheStatus.toUpperCase().indexOf(searchStr)<0){
 					ch.is_flaged = false;
 					ch.is_filtered = true;
 				} else



From salzkammergut at mail.berlios.de  Thu Jan 31 17:44:21 2008
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 31 Jan 2008 17:44:21 +0100
Subject: [Cachewolf-svn] r1209 - trunk/src/CacheWolf
Message-ID: <200801311644.m0VGiLKU025153@sheep.berlios.de>

Author: salzkammergut
Date: 2008-01-31 17:44:16 +0100 (Thu, 31 Jan 2008)
New Revision: 1209

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
Listview: Fix. Disabled dragging when the cachelist is not open.
See also http://www.geoclub.de/ftopic21841.html

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2008-01-31 16:26:17 UTC (rev 1208)
+++ trunk/src/CacheWolf/myTableControl.java	2008-01-31 16:44:16 UTC (rev 1209)
@@ -281,7 +281,11 @@
 	int row;
 	
 	public void startDragging(DragContext dc) {
-		 Vector cacheDB=Global.getProfile().cacheDB;
+		if (!Global.mainForm.cacheListVisible) {
+			dc.cancelled=true;
+			return;
+		}
+		Vector cacheDB=Global.getProfile().cacheDB;
 		 Point p=cellAtPoint(dc.start.x,dc.start.y,null);
 		 wayPoint=null;
 		 if (p.y>=0) { 
@@ -297,7 +301,7 @@
 	 }
 
 	 public void stopDragging(DragContext dc) {
-		 if (wayPoint!=null) {
+		 if (wayPoint!=null && !dc.cancelled) {
 			 //Vm.debug("Stop  Dragging"+dc.curPoint.x+"/"+dc.curPoint.y);
 			 dc.stopImageDrag(true);
 			 Point p = Gui.getPosInParent(this,getWindow());



