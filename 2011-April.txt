From araber95 at mail.berlios.de  Fri Apr  1 12:48:01 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri,  1 Apr 2011 12:48:01 PM +0200
Subject: [Cachewolf-svn] r2969 - in trunk: res_noewe/webmapservices
	src/CacheWolf src/CacheWolf/navi
Message-ID: <20110401104801.79D67480B1A@sheep.berlios.de>

Author: araber95
Date: 2011-04-01 12:48:01 +0200 (Fri, 01 Apr 2011)
New Revision: 2969

Modified:
   trunk/res_noewe/webmapservices/pt_t500.wms
   trunk/src/CacheWolf/UrlFetcher.java
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
1. expedia will work again
2. portugal wms: defaults changed

Modified: trunk/res_noewe/webmapservices/pt_t500.wms
===================================================================
--- trunk/res_noewe/webmapservices/pt_t500.wms	2011-03-31 09:48:15 UTC (rev 2968)
+++ trunk/res_noewe/webmapservices/pt_t500.wms	2011-04-01 10:48:01 UTC (rev 2969)
@@ -12,10 +12,10 @@
 #LayersUrlPart:     LAYERS=sc500k|Carta de Portugal Continental 1:500.000|0.249451424214819|249451.424214819
 LayersUrlPart:     LAYERS=sc500k
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
+ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 42.2787 W 10.1943
 BoundingBoxBottomRightWGS84: N 36.7636 W 5.71067
 MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .png
+MaxScale:   100
+RecommendedScale:   50
+ImageFileExtension: .jpg

Modified: trunk/src/CacheWolf/UrlFetcher.java
===================================================================
--- trunk/src/CacheWolf/UrlFetcher.java	2011-03-31 09:48:15 UTC (rev 2968)
+++ trunk/src/CacheWolf/UrlFetcher.java	2011-04-01 10:48:01 UTC (rev 2969)
@@ -42,6 +42,7 @@
 	static PropertyList permanentRequestorProperties = null;
 	static String postData=null;
 	static String urltmp=null;
+	static String realUrl=null;
 	static boolean forceRedirect=false;
 	
 	public static PropertyList getDocumentProperties() {
@@ -49,7 +50,7 @@
 			return conn.documentProperties;
 		else return null;
 	}
-	public static String getRealUrl() { return urltmp; };
+	public static String getRealUrl() { return realUrl; };
 	public static void setMaxRedirections(int value) { maxRedirections=value; };
 	public static void setForceRedirect() { forceRedirect=true; };
 	public static void setRequestorProperties(PropertyList value) { requestorProperties=value; };
@@ -95,10 +96,18 @@
 	 */
 	public static ByteArray fetchByteArray(String url) throws IOException {	
 		int i=0;
-		conn = new HttpConnection(url);		
+		conn = new HttpConnection(url); //todo reuse: don#t reuse, some params are not correctly reset with SetUrl		
 		urltmp = url;
 		do  { // allow max 5 redirections (http 302 location)
 			i++;
+			if (urltmp == null) {
+				// hack for expedia, doing the original url again. 
+				// expedia always must redirect >=1 time, but sometimes that is missed
+				// see also: http://www.geoclub.de/viewtopic.php?p=305071#305071
+				urltmp=url;
+				i=i-1;
+			}
+			realUrl=urltmp;
 			conn.setUrl(urltmp);
 			conn.documentIsEncoded = isUrlEncoded(urltmp);
 			if (permanentRequestorProperties == null) initPermanentRequestorProperty();
@@ -112,13 +121,11 @@
 			if (conn.responseCode >= 400) throw new IOException("URL: "+ urltmp + "\nhttp response code: " + conn.responseCode);
 			urltmp = conn.getRedirectTo();
 			if(urltmp!=null){
-				URL eweUrl = new URL(url);
-				if(urltmp.indexOf(eweUrl.getHost())<0){
-					urltmp = new URL(eweUrl.getProtocol(), eweUrl.getHost(),eweUrl.getPort(), urltmp).url;
-				}
-				urltmp = STRreplace.replace(urltmp, eweUrl.getHost() + "/\\.\\./", eweUrl.getHost() + "/");
+				conn.disconnect();
+				conn=conn.getRedirectedConnection(urltmp);
+				forceRedirect=false; // one time or more redirected
 			}
-		} while (((urltmp != null) || (urltmp == null) && forceRedirect) && i <= maxRedirections ); 
+		} while (((urltmp != null) || (urltmp == null) && forceRedirect) && i <= maxRedirections );	
 		if (i > maxRedirections) throw new IOException("too many http redirections while trying to fetch: "+url + " only "+maxRedirections+" are allowed");
 		ByteArray daten;
 		if (conn.isOpen()) {

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2011-03-31 09:48:15 UTC (rev 2968)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2011-04-01 10:48:01 UTC (rev 2969)
@@ -519,9 +519,14 @@
 		if(!dateiF.exists()){
 			if (forceredirect) UrlFetcher.setForceRedirect();
 			UrlFetcher.fetchDataFile(realurl, datei);
-			String ct = (String) UrlFetcher.getDocumentProperties().getValue("content-type","");
+			String ct=null;
+			try {
+				ct = (String) UrlFetcher.getDocumentProperties().getValue("content-type","");
+			} catch (Exception e) {
+				ct="document property content-type does not exist!";
+			}
 			if (!ct.substring(0, 5).equalsIgnoreCase("image") )  {
-				dateiF = new FileBugfix(datei); //??? muss das nochmal ???
+				dateiF = new FileBugfix(datei);
 				dateiF.delete();
 				throw new IOException(MyLocale.getMsg(4808, "downloadImage: content-type:")+" " + ct + MyLocale.getMsg(4809, " is not an image, begin of content:")+" (deleted)");
 			}



From apreisser at mail.berlios.de  Sat Apr  2 02:14:07 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat,  2 Apr 2011 02:14:07 PM +0200
Subject: [Cachewolf-svn] r2970 - in trunk: res_noewe src/CacheWolf/imp
Message-ID: <20110402121407.AB171480BED@sheep.berlios.de>

Author: apreisser
Date: 2011-04-02 14:14:07 +0200 (Sat, 02 Apr 2011)
New Revision: 2970

Added:
   trunk/res_noewe/icon_smile_sad.gif
Modified:
   trunk/src/CacheWolf/imp/SpiderGC.java
Log:
Cleans up URL of inlined images (Smilies)

Added: trunk/res_noewe/icon_smile_sad.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/icon_smile_sad.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2011-04-01 10:48:01 UTC (rev 2969)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2011-04-02 12:14:07 UTC (rev 2970)
@@ -106,6 +106,11 @@
 	/** no probs, but exmpl found und not want this */
 	public static int SPIDER_IGNORE = 2;
 
+	/**
+	 * This is the pattern for inlined smilies
+	 */
+	private static final String 		string = "<img src=\"/images/icons/";
+
 	private static int ERR_LOGIN = -10;
 	private static Preferences pref;
 	private Profile profile;
@@ -2628,6 +2633,7 @@
 			icon=icon.substring(0, icon.length() - 1); // ' changes to " in UMTS-connection! first char in iconExEnd.
 			name = exName.findNext();
 			logText = exLog.findNext();
+			logText = correctSmilies (logText);
 			logId = exLogId.findNext();
 			String ed=exDate.findNext();
 			String d = DateFormat.logdate2YMD(ed);
@@ -2667,6 +2673,22 @@
 	}
 
 	/**
+	 * This methods cleans up the path for inlined smilies in logtexts.
+	 * @param logText
+	 * @return
+	 */
+	private String correctSmilies(String logText) {
+		int indexOf = logText.indexOf(string);
+		while (indexOf >= 0) {
+			String prefix = logText.substring(0, indexOf);
+			String postFix = logText.substring(indexOf + string.length());
+			logText = prefix + "<img src=\"" + postFix;
+			indexOf = logText.indexOf(string);
+		}
+		return logText;
+	}
+
+	/**
 	 * Read the travelbug names from a previously fetched Cache page and then
 	 * read the travelbug purpose for each travelbug
 	 * 
@@ -3369,6 +3391,6 @@
 		public void endElement(String name) {
 
 		}
-
 	}
 }
+



From araber95 at mail.berlios.de  Sun Apr  3 04:26:55 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sun,  3 Apr 2011 04:26:55 PM +0200
Subject: [Cachewolf-svn] r2971 - in trunk/src/CacheWolf: . navi
Message-ID: <20110403142655.6E2F8480C81@sheep.berlios.de>

Author: araber95
Date: 2011-04-03 16:26:55 +0200 (Sun, 03 Apr 2011)
New Revision: 2971

Modified:
   trunk/src/CacheWolf/GeocoderOsm.java
   trunk/src/CacheWolf/navi/MapInfoObject.java
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
1. win32 Version searching koordinates error , see http://www.geoclub.de/viewtopic.php?f=40&t=53817
2. removed double / on creating wfl-file (perhaps solves  http://www.geoclub.de/viewtopic.php?f=40&t=53608)

Modified: trunk/src/CacheWolf/GeocoderOsm.java
===================================================================
--- trunk/src/CacheWolf/GeocoderOsm.java	2011-04-02 12:14:07 UTC (rev 2970)
+++ trunk/src/CacheWolf/GeocoderOsm.java	2011-04-03 14:26:55 UTC (rev 2971)
@@ -73,7 +73,7 @@
 						if (xe.tag.equalsIgnoreCase("place")) {
 							lat = (String) xe.attributes.getPropertyValues("lat").get(0);
 							lon = (String) xe.attributes.getPropertyValues("lon").get(0);
-							where.set(Common.parseDouble(lat), Common.parseDouble(lon));
+							where.set(Common.parseDouble(lat.trim()), Common.parseDouble(lon.trim()));
 							desc = (String) xe.attributes.getPropertyValues("display_name").get(0);
 							erg.add(new GeocodeAnswer(where, desc));
 						}

Modified: trunk/src/CacheWolf/navi/MapInfoObject.java
===================================================================
--- trunk/src/CacheWolf/navi/MapInfoObject.java	2011-04-02 12:14:07 UTC (rev 2970)
+++ trunk/src/CacheWolf/navi/MapInfoObject.java	2011-04-03 14:26:55 UTC (rev 2971)
@@ -328,6 +328,9 @@
 	 * @throws IllegalArgumentException when affine[x] for all x == 0 ("map not calibrated").
 	 */
 	public void saveWFL(String mapsPath, String mapFileName) throws IOException, IllegalArgumentException {
+		if (mapsPath.endsWith("/")) {
+			mapsPath=mapsPath.substring(0, mapsPath.length()-1);
+		}
 		if (affine[0]==0 && affine[1]==0 && affine[2]==0 && affine[3]==0 && 
 				!topleft.isValid()) throw (new IllegalArgumentException(MyLocale.getMsg(4306, "map not calibrated")));
 		PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(mapsPath + "/" + mapFileName + ".wfl")));

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2011-04-02 12:14:07 UTC (rev 2970)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2011-04-03 14:26:55 UTC (rev 2971)
@@ -182,7 +182,7 @@
 		//if (toplefti.latDec <= bottomrighti.latDec || toplefti.lonDec >= toplefti.lonDec) throw new IllegalArgumentException("topleft must be left and above bottom right");
 		topleft = new CWPoint(toplefti);
 		bottomright = new CWPoint(bottomrighti);
-		double metersPerLat = (1000*(new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
+		double metersPerLat = (1000.0 * (new CWPoint(0,0)).getDistance(new CWPoint(1,0)));
 		double metersPerLon = metersPerLat * java.lang.Math.cos((toplefti.latDec + bottomright.latDec)/2/180*java.lang.Math.PI);
 		double metersperpixel = currentOnlineMapService.getMetersPerPixel(scale);
 		double pixelsPerLat = metersPerLat / metersperpixel;



From araber95 at mail.berlios.de  Tue Apr  5 06:04:48 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue,  5 Apr 2011 06:04:48 PM +0200
Subject: [Cachewolf-svn] r2972 - in trunk/tools/MakeWMSFile: . capxml2wms
	capxml2wms/My Project capxml2wms/bin/Debug
Message-ID: <20110405160448.A0E02480EA9@sheep.berlios.de>

Author: araber95
Date: 2011-04-05 18:04:48 +0200 (Tue, 05 Apr 2011)
New Revision: 2972

Modified:
   trunk/tools/MakeWMSFile/capxml2wms.sln
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj
   trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user
Log:
doing with vb 2010 Express:
A bit more robust and usable.
Typo Bottom for Buttom.


Modified: trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Application.Designer.vb	2011-04-05 16:04:48 UTC (rev 2972)
@@ -1,7 +1,7 @@
 ???'------------------------------------------------------------------------------
 ' <auto-generated>
 '     Dieser Code wurde von einem Tool generiert.
-'     Laufzeitversion:2.0.50727.3082
+'     Laufzeitversion:4.0.30319.1
 '
 '     ??nderungen an dieser Datei k??nnen falsches Verhalten verursachen und gehen verloren, wenn
 '     der Code erneut generiert wird.
@@ -16,7 +16,7 @@
     
     'HINWEIS: Diese Datei wird automatisch generiert. ??ndern Sie sie nicht direkt. Zum ??ndern
     ' oder bei in dieser Datei auftretenden Buildfehlern wechseln Sie zum Projekt-Designer.
-    ' (Wechseln Sie dazu zu den Projekteigenschaften, oder doppelklicken Sie auf den Knoten "Eigenes Projekt" im
+    ' (Wechseln Sie dazu zu den Projekteigenschaften, oder doppelklicken Sie auf den Knoten "Mein Projekt" im
     ' Projektmappen-Explorer). Nehmen Sie auf der Registerkarte "Anwendung" entsprechende ??nderungen vor.
     '
     Partial Friend Class MyApplication

Modified: trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Resources.Designer.vb	2011-04-05 16:04:48 UTC (rev 2972)
@@ -1,7 +1,7 @@
 ???'------------------------------------------------------------------------------
 ' <auto-generated>
 '     Dieser Code wurde von einem Tool generiert.
-'     Laufzeitversion:2.0.50727.3082
+'     Laufzeitversion:4.0.30319.1
 '
 '     ??nderungen an dieser Datei k??nnen falsches Verhalten verursachen und gehen verloren, wenn
 '     der Code erneut generiert wird.
@@ -22,7 +22,7 @@
     '''<summary>
     '''  Eine stark typisierte Ressourcenklasse zum Suchen von lokalisierten Zeichenfolgen usw.
     '''</summary>
-    <Global.System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "2.0.0.0"),  _
+    <Global.System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "4.0.0.0"),  _
      Global.System.Diagnostics.DebuggerNonUserCodeAttribute(),  _
      Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(),  _
      Global.Microsoft.VisualBasic.HideModuleNameAttribute()>  _

Modified: trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/My Project/Settings.Designer.vb	2011-04-05 16:04:48 UTC (rev 2972)
@@ -1,7 +1,7 @@
 ???'------------------------------------------------------------------------------
 ' <auto-generated>
 '     Dieser Code wurde von einem Tool generiert.
-'     Laufzeitversion:2.0.50727.3082
+'     Laufzeitversion:4.0.30319.1
 '
 '     ??nderungen an dieser Datei k??nnen falsches Verhalten verursachen und gehen verloren, wenn
 '     der Code erneut generiert wird.
@@ -15,12 +15,12 @@
 Namespace My
     
     <Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(),  _
-     Global.System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "9.0.0.0"),  _
+     Global.System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "10.0.0.0"),  _
      Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _
     Partial Friend NotInheritable Class MySettings
         Inherits Global.System.Configuration.ApplicationSettingsBase
         
-        Private Shared defaultInstance As MySettings = CType(Global.System.Configuration.ApplicationSettingsBase.Synchronized(New MySettings),MySettings)
+        Private Shared defaultInstance As MySettings = CType(Global.System.Configuration.ApplicationSettingsBase.Synchronized(New MySettings()),MySettings)
         
 #Region "Funktion zum automatischen Speichern von My.Settings"
 #If _MyType = "WindowsForms" Then

Modified: trunk/tools/MakeWMSFile/capxml2wms/bin/Debug/capxml2wms.exe
===================================================================
(Binary files differ)

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.Designer.vb	2011-04-05 16:04:48 UTC (rev 2972)
@@ -23,298 +23,297 @@
     <System.Diagnostics.DebuggerStepThrough()> _
     Private Sub InitializeComponent()
         Dim resources As System.ComponentModel.ComponentResourceManager = New System.ComponentModel.ComponentResourceManager(GetType(capxml2wms))
-        Me.ButtonErstellen = New System.Windows.Forms.Button
-        Me.TextBoxUrl = New System.Windows.Forms.TextBox
-        Me.Label1 = New System.Windows.Forms.Label
-        Me.TextBoxXML = New System.Windows.Forms.TextBox
-        Me.Label2 = New System.Windows.Forms.Label
-        Me.ComboBoxVersion = New System.Windows.Forms.ComboBox
-        Me.ButtonGetCapabilities = New System.Windows.Forms.Button
-        Me.ButtonShowMap = New System.Windows.Forms.Button
-        Me.CheckedListBoxLayers = New System.Windows.Forms.CheckedListBox
-        Me.Label3 = New System.Windows.Forms.Label
-        Me.ButtonCheckNone = New System.Windows.Forms.Button
-        Me.ButtonCheckAll = New System.Windows.Forms.Button
-        Me.ComboBoxEPSG = New System.Windows.Forms.ComboBox
-        Me.Label4 = New System.Windows.Forms.Label
-        Me.HScrollBar1 = New System.Windows.Forms.HScrollBar
-        Me.Label5 = New System.Windows.Forms.Label
-        Me.ComboBoxFormat = New System.Windows.Forms.ComboBox
-        Me.ComboBoxBBox = New System.Windows.Forms.ComboBox
-        Me.Label6 = New System.Windows.Forms.Label
-        Me.ComboBoxBBoxI = New System.Windows.Forms.ComboBox
-        Me.ButtonFindScale = New System.Windows.Forms.Button
+        Me.ButtonErstellen = New System.Windows.Forms.Button()
+        Me.Panel1 = New System.Windows.Forms.Panel()
+        Me.ComboBoxBBoxI = New System.Windows.Forms.ComboBox()
+        Me.Label6 = New System.Windows.Forms.Label()
+        Me.ComboBoxBBox = New System.Windows.Forms.ComboBox()
+        Me.ComboBoxFormat = New System.Windows.Forms.ComboBox()
+        Me.Label5 = New System.Windows.Forms.Label()
+        Me.Label4 = New System.Windows.Forms.Label()
+        Me.ComboBoxEPSG = New System.Windows.Forms.ComboBox()
+        Me.ButtonFindScale = New System.Windows.Forms.Button()
+        Me.ButtonCheckAll = New System.Windows.Forms.Button()
+        Me.ButtonCheckNone = New System.Windows.Forms.Button()
+        Me.Label3 = New System.Windows.Forms.Label()
+        Me.CheckedListBoxLayers = New System.Windows.Forms.CheckedListBox()
+        Me.Panel2 = New System.Windows.Forms.Panel()
+        Me.TextBoxXML = New System.Windows.Forms.TextBox()
+        Me.ButtonGetCapabilities = New System.Windows.Forms.Button()
+        Me.ComboBoxVersion = New System.Windows.Forms.ComboBox()
+        Me.Label2 = New System.Windows.Forms.Label()
+        Me.Label1 = New System.Windows.Forms.Label()
+        Me.TextBoxUrl = New System.Windows.Forms.TextBox()
+        Me.Panel1.SuspendLayout()
+        Me.Panel2.SuspendLayout()
         Me.SuspendLayout()
         '
         'ButtonErstellen
         '
         Me.ButtonErstellen.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.ButtonErstellen.Location = New System.Drawing.Point(540, 552)
+        Me.ButtonErstellen.Location = New System.Drawing.Point(537, 553)
         Me.ButtonErstellen.Name = "ButtonErstellen"
         Me.ButtonErstellen.Size = New System.Drawing.Size(123, 36)
         Me.ButtonErstellen.TabIndex = 1
-        Me.ButtonErstellen.Text = "WMS-Datei erstellen"
+        Me.ButtonErstellen.Text = "3. WMS-Datei erstellen"
         Me.ButtonErstellen.UseVisualStyleBackColor = True
         '
-        'TextBoxUrl
+        'Panel1
         '
-        Me.TextBoxUrl.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
+        Me.Panel1.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
+                    Or System.Windows.Forms.AnchorStyles.Left) _
                     Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.TextBoxUrl.Location = New System.Drawing.Point(20, 57)
-        Me.TextBoxUrl.Name = "TextBoxUrl"
-        Me.TextBoxUrl.Size = New System.Drawing.Size(496, 20)
-        Me.TextBoxUrl.TabIndex = 0
+        Me.Panel1.Controls.Add(Me.ComboBoxBBoxI)
+        Me.Panel1.Controls.Add(Me.Label6)
+        Me.Panel1.Controls.Add(Me.ComboBoxBBox)
+        Me.Panel1.Controls.Add(Me.ComboBoxFormat)
+        Me.Panel1.Controls.Add(Me.Label5)
+        Me.Panel1.Controls.Add(Me.Label4)
+        Me.Panel1.Controls.Add(Me.ComboBoxEPSG)
+        Me.Panel1.Controls.Add(Me.ButtonFindScale)
+        Me.Panel1.Controls.Add(Me.ButtonCheckAll)
+        Me.Panel1.Controls.Add(Me.ButtonCheckNone)
+        Me.Panel1.Controls.Add(Me.Label3)
+        Me.Panel1.Controls.Add(Me.CheckedListBoxLayers)
+        Me.Panel1.Location = New System.Drawing.Point(20, 240)
+        Me.Panel1.Name = "Panel1"
+        Me.Panel1.Size = New System.Drawing.Size(643, 306)
+        Me.Panel1.TabIndex = 24
         '
-        'Label1
+        'ComboBoxBBoxI
         '
-        Me.Label1.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
-                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.Label1.AutoSize = True
-        Me.Label1.Location = New System.Drawing.Point(21, 27)
-        Me.Label1.Name = "Label1"
-        Me.Label1.Size = New System.Drawing.Size(205, 13)
-        Me.Label1.TabIndex = 2
-        Me.Label1.Text = "http Adresse des WMS-Servers eingeben:"
+        Me.ComboBoxBBoxI.FormattingEnabled = True
+        Me.ComboBoxBBoxI.Location = New System.Drawing.Point(190, 36)
+        Me.ComboBoxBBoxI.Name = "ComboBoxBBoxI"
+        Me.ComboBoxBBoxI.Size = New System.Drawing.Size(252, 21)
+        Me.ComboBoxBBoxI.TabIndex = 35
+        Me.ComboBoxBBoxI.Visible = False
         '
-        'TextBoxXML
+        'Label6
         '
-        Me.TextBoxXML.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
-                    Or System.Windows.Forms.AnchorStyles.Left) _
+        Me.Label6.AutoSize = True
+        Me.Label6.Location = New System.Drawing.Point(141, 6)
+        Me.Label6.Name = "Label6"
+        Me.Label6.Size = New System.Drawing.Size(35, 13)
+        Me.Label6.TabIndex = 34
+        Me.Label6.Text = "BBox:"
+        '
+        'ComboBoxBBox
+        '
+        Me.ComboBoxBBox.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
                     Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.TextBoxXML.Location = New System.Drawing.Point(20, 83)
-        Me.TextBoxXML.Multiline = True
-        Me.TextBoxXML.Name = "TextBoxXML"
-        Me.TextBoxXML.ReadOnly = True
-        Me.TextBoxXML.ScrollBars = System.Windows.Forms.ScrollBars.Both
-        Me.TextBoxXML.Size = New System.Drawing.Size(643, 288)
-        Me.TextBoxXML.TabIndex = 4
-        Me.TextBoxXML.WordWrap = False
+        Me.ComboBoxBBox.FormattingEnabled = True
+        Me.ComboBoxBBox.Location = New System.Drawing.Point(144, 23)
+        Me.ComboBoxBBox.Name = "ComboBoxBBox"
+        Me.ComboBoxBBox.Size = New System.Drawing.Size(489, 21)
+        Me.ComboBoxBBox.TabIndex = 33
         '
-        'Label2
+        'ComboBoxFormat
         '
-        Me.Label2.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.Label2.AutoSize = True
-        Me.Label2.Location = New System.Drawing.Point(511, 27)
-        Me.Label2.Name = "Label2"
-        Me.Label2.Size = New System.Drawing.Size(75, 13)
-        Me.Label2.TabIndex = 5
-        Me.Label2.Text = "WMS-Version:"
-        Me.Label2.Visible = False
+        Me.ComboBoxFormat.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxFormat.FormattingEnabled = True
+        Me.ComboBoxFormat.Location = New System.Drawing.Point(512, 104)
+        Me.ComboBoxFormat.Name = "ComboBoxFormat"
+        Me.ComboBoxFormat.Size = New System.Drawing.Size(121, 21)
+        Me.ComboBoxFormat.TabIndex = 32
         '
-        'ComboBoxVersion
+        'Label5
         '
-        Me.ComboBoxVersion.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.ComboBoxVersion.FormattingEnabled = True
-        Me.ComboBoxVersion.Items.AddRange(New Object() {"1.0.0", "1.1.0", "1.1.1"})
-        Me.ComboBoxVersion.Location = New System.Drawing.Point(588, 24)
-        Me.ComboBoxVersion.MaxDropDownItems = 3
-        Me.ComboBoxVersion.Name = "ComboBoxVersion"
-        Me.ComboBoxVersion.Size = New System.Drawing.Size(75, 21)
-        Me.ComboBoxVersion.TabIndex = 6
+        Me.Label5.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.Label5.AutoSize = True
+        Me.Label5.Location = New System.Drawing.Point(514, 88)
+        Me.Label5.Name = "Label5"
+        Me.Label5.Size = New System.Drawing.Size(42, 13)
+        Me.Label5.TabIndex = 31
+        Me.Label5.Text = "Format:"
         '
-        'ButtonGetCapabilities
+        'Label4
         '
-        Me.ButtonGetCapabilities.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.ButtonGetCapabilities.Location = New System.Drawing.Point(540, 43)
-        Me.ButtonGetCapabilities.Name = "ButtonGetCapabilities"
-        Me.ButtonGetCapabilities.Size = New System.Drawing.Size(123, 36)
-        Me.ButtonGetCapabilities.TabIndex = 7
-        Me.ButtonGetCapabilities.Text = "M??glichkeiten abfragen"
-        Me.ButtonGetCapabilities.UseVisualStyleBackColor = True
+        Me.Label4.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.Label4.AutoSize = True
+        Me.Label4.Location = New System.Drawing.Point(514, 47)
+        Me.Label4.Name = "Label4"
+        Me.Label4.Size = New System.Drawing.Size(39, 13)
+        Me.Label4.TabIndex = 30
+        Me.Label4.Text = "EPSG:"
         '
-        'ButtonShowMap
+        'ComboBoxEPSG
         '
-        Me.ButtonShowMap.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.ButtonShowMap.Location = New System.Drawing.Point(540, 397)
-        Me.ButtonShowMap.Name = "ButtonShowMap"
-        Me.ButtonShowMap.Size = New System.Drawing.Size(123, 36)
-        Me.ButtonShowMap.TabIndex = 8
-        Me.ButtonShowMap.Text = "Test Karte anzeigen"
-        Me.ButtonShowMap.UseVisualStyleBackColor = True
+        Me.ComboBoxEPSG.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxEPSG.FormattingEnabled = True
+        Me.ComboBoxEPSG.Location = New System.Drawing.Point(512, 64)
+        Me.ComboBoxEPSG.Name = "ComboBoxEPSG"
+        Me.ComboBoxEPSG.Size = New System.Drawing.Size(121, 21)
+        Me.ComboBoxEPSG.TabIndex = 29
         '
-        'CheckedListBoxLayers
+        'ButtonFindScale
         '
-        Me.CheckedListBoxLayers.Anchor = CType(((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left) _
-                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.CheckedListBoxLayers.CheckOnClick = True
-        Me.CheckedListBoxLayers.FormattingEnabled = True
-        Me.CheckedListBoxLayers.HorizontalScrollbar = True
-        Me.CheckedListBoxLayers.Location = New System.Drawing.Point(20, 397)
-        Me.CheckedListBoxLayers.Name = "CheckedListBoxLayers"
-        Me.CheckedListBoxLayers.Size = New System.Drawing.Size(496, 109)
-        Me.CheckedListBoxLayers.TabIndex = 9
+        Me.ButtonFindScale.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ButtonFindScale.Location = New System.Drawing.Point(517, 265)
+        Me.ButtonFindScale.Name = "ButtonFindScale"
+        Me.ButtonFindScale.Size = New System.Drawing.Size(123, 36)
+        Me.ButtonFindScale.TabIndex = 28
+        Me.ButtonFindScale.Text = "2. Optimale Scale finden"
+        Me.ButtonFindScale.UseVisualStyleBackColor = True
         '
-        'Label3
+        'ButtonCheckAll
         '
-        Me.Label3.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.Label3.AutoSize = True
-        Me.Label3.Location = New System.Drawing.Point(21, 381)
-        Me.Label3.Name = "Label3"
-        Me.Label3.Size = New System.Drawing.Size(36, 13)
-        Me.Label3.TabIndex = 10
-        Me.Label3.Text = "Layer:"
+        Me.ButtonCheckAll.Location = New System.Drawing.Point(6, 24)
+        Me.ButtonCheckAll.Name = "ButtonCheckAll"
+        Me.ButtonCheckAll.Size = New System.Drawing.Size(60, 20)
+        Me.ButtonCheckAll.TabIndex = 27
+        Me.ButtonCheckAll.Text = "alle  x"
+        Me.ButtonCheckAll.UseVisualStyleBackColor = True
         '
         'ButtonCheckNone
         '
-        Me.ButtonCheckNone.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.ButtonCheckNone.Location = New System.Drawing.Point(212, 377)
+        Me.ButtonCheckNone.Location = New System.Drawing.Point(72, 23)
         Me.ButtonCheckNone.Name = "ButtonCheckNone"
         Me.ButtonCheckNone.Size = New System.Drawing.Size(60, 20)
-        Me.ButtonCheckNone.TabIndex = 13
+        Me.ButtonCheckNone.TabIndex = 26
         Me.ButtonCheckNone.Text = "kein x"
         Me.ButtonCheckNone.UseVisualStyleBackColor = True
         '
-        'ButtonCheckAll
+        'Label3
         '
-        Me.ButtonCheckAll.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.ButtonCheckAll.Location = New System.Drawing.Point(149, 377)
-        Me.ButtonCheckAll.Name = "ButtonCheckAll"
-        Me.ButtonCheckAll.Size = New System.Drawing.Size(60, 20)
-        Me.ButtonCheckAll.TabIndex = 14
-        Me.ButtonCheckAll.Text = "alle  x"
-        Me.ButtonCheckAll.UseVisualStyleBackColor = True
+        Me.Label3.AutoSize = True
+        Me.Label3.Location = New System.Drawing.Point(3, 6)
+        Me.Label3.Name = "Label3"
+        Me.Label3.Size = New System.Drawing.Size(36, 13)
+        Me.Label3.TabIndex = 25
+        Me.Label3.Text = "Layer:"
         '
-        'ComboBoxEPSG
+        'CheckedListBoxLayers
         '
-        Me.ComboBoxEPSG.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.ComboBoxEPSG.FormattingEnabled = True
-        Me.ComboBoxEPSG.Location = New System.Drawing.Point(20, 526)
-        Me.ComboBoxEPSG.Name = "ComboBoxEPSG"
-        Me.ComboBoxEPSG.Size = New System.Drawing.Size(121, 21)
-        Me.ComboBoxEPSG.TabIndex = 15
+        Me.CheckedListBoxLayers.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
+                    Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.CheckedListBoxLayers.CheckOnClick = True
+        Me.CheckedListBoxLayers.FormattingEnabled = True
+        Me.CheckedListBoxLayers.HorizontalScrollbar = True
+        Me.CheckedListBoxLayers.Location = New System.Drawing.Point(6, 72)
+        Me.CheckedListBoxLayers.Name = "CheckedListBoxLayers"
+        Me.CheckedListBoxLayers.Size = New System.Drawing.Size(496, 229)
+        Me.CheckedListBoxLayers.TabIndex = 24
         '
-        'Label4
+        'Panel2
         '
-        Me.Label4.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.Label4.AutoSize = True
-        Me.Label4.Location = New System.Drawing.Point(22, 509)
-        Me.Label4.Name = "Label4"
-        Me.Label4.Size = New System.Drawing.Size(39, 13)
-        Me.Label4.TabIndex = 16
-        Me.Label4.Text = "EPSG:"
+        Me.Panel2.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.Panel2.Controls.Add(Me.TextBoxXML)
+        Me.Panel2.Controls.Add(Me.ButtonGetCapabilities)
+        Me.Panel2.Controls.Add(Me.ComboBoxVersion)
+        Me.Panel2.Controls.Add(Me.Label2)
+        Me.Panel2.Controls.Add(Me.Label1)
+        Me.Panel2.Controls.Add(Me.TextBoxUrl)
+        Me.Panel2.Location = New System.Drawing.Point(20, 12)
+        Me.Panel2.Name = "Panel2"
+        Me.Panel2.Size = New System.Drawing.Size(643, 222)
+        Me.Panel2.TabIndex = 25
         '
-        'HScrollBar1
+        'TextBoxXML
         '
-        Me.HScrollBar1.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.HScrollBar1.Location = New System.Drawing.Point(540, 377)
-        Me.HScrollBar1.Minimum = 1
-        Me.HScrollBar1.Name = "HScrollBar1"
-        Me.HScrollBar1.Size = New System.Drawing.Size(123, 17)
-        Me.HScrollBar1.TabIndex = 17
-        Me.HScrollBar1.Value = 1
+        Me.TextBoxXML.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
+                    Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.TextBoxXML.Location = New System.Drawing.Point(6, 52)
+        Me.TextBoxXML.Multiline = True
+        Me.TextBoxXML.Name = "TextBoxXML"
+        Me.TextBoxXML.ReadOnly = True
+        Me.TextBoxXML.ScrollBars = System.Windows.Forms.ScrollBars.Both
+        Me.TextBoxXML.Size = New System.Drawing.Size(627, 167)
+        Me.TextBoxXML.TabIndex = 13
+        Me.TextBoxXML.WordWrap = False
         '
-        'Label5
+        'ButtonGetCapabilities
         '
-        Me.Label5.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.Label5.AutoSize = True
-        Me.Label5.Location = New System.Drawing.Point(148, 509)
-        Me.Label5.Name = "Label5"
-        Me.Label5.Size = New System.Drawing.Size(42, 13)
-        Me.Label5.TabIndex = 18
-        Me.Label5.Text = "Format:"
+        Me.ButtonGetCapabilities.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ButtonGetCapabilities.Location = New System.Drawing.Point(517, 9)
+        Me.ButtonGetCapabilities.Name = "ButtonGetCapabilities"
+        Me.ButtonGetCapabilities.Size = New System.Drawing.Size(123, 36)
+        Me.ButtonGetCapabilities.TabIndex = 12
+        Me.ButtonGetCapabilities.Text = "1. M??glichkeiten abfragen"
+        Me.ButtonGetCapabilities.UseVisualStyleBackColor = True
         '
-        'ComboBoxFormat
+        'ComboBoxVersion
         '
-        Me.ComboBoxFormat.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.ComboBoxFormat.FormattingEnabled = True
-        Me.ComboBoxFormat.Location = New System.Drawing.Point(151, 526)
-        Me.ComboBoxFormat.Name = "ComboBoxFormat"
-        Me.ComboBoxFormat.Size = New System.Drawing.Size(121, 21)
-        Me.ComboBoxFormat.TabIndex = 19
+        Me.ComboBoxVersion.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.ComboBoxVersion.FormattingEnabled = True
+        Me.ComboBoxVersion.Items.AddRange(New Object() {"1.0.0", "1.1.0", "1.1.1", "1.3.0"})
+        Me.ComboBoxVersion.Location = New System.Drawing.Point(412, 25)
+        Me.ComboBoxVersion.MaxDropDownItems = 3
+        Me.ComboBoxVersion.Name = "ComboBoxVersion"
+        Me.ComboBoxVersion.Size = New System.Drawing.Size(84, 21)
+        Me.ComboBoxVersion.TabIndex = 11
         '
-        'ComboBoxBBox
+        'Label2
         '
-        Me.ComboBoxBBox.Anchor = CType(((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left) _
-                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.ComboBoxBBox.FormattingEnabled = True
-        Me.ComboBoxBBox.Location = New System.Drawing.Point(20, 567)
-        Me.ComboBoxBBox.Name = "ComboBoxBBox"
-        Me.ComboBoxBBox.Size = New System.Drawing.Size(496, 21)
-        Me.ComboBoxBBox.TabIndex = 20
+        Me.Label2.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.Label2.AutoSize = True
+        Me.Label2.Location = New System.Drawing.Point(409, 9)
+        Me.Label2.Name = "Label2"
+        Me.Label2.Size = New System.Drawing.Size(75, 13)
+        Me.Label2.TabIndex = 10
+        Me.Label2.Text = "WMS-Version:"
         '
-        'Label6
+        'Label1
         '
-        Me.Label6.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.Label6.AutoSize = True
-        Me.Label6.Location = New System.Drawing.Point(22, 550)
-        Me.Label6.Name = "Label6"
-        Me.Label6.Size = New System.Drawing.Size(35, 13)
-        Me.Label6.TabIndex = 21
-        Me.Label6.Text = "BBox:"
+        Me.Label1.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.Label1.AutoSize = True
+        Me.Label1.Location = New System.Drawing.Point(3, 9)
+        Me.Label1.Name = "Label1"
+        Me.Label1.Size = New System.Drawing.Size(205, 13)
+        Me.Label1.TabIndex = 9
+        Me.Label1.Text = "http Adresse des WMS-Servers eingeben:"
         '
-        'ComboBoxBBoxI
+        'TextBoxUrl
         '
-        Me.ComboBoxBBoxI.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Left), System.Windows.Forms.AnchorStyles)
-        Me.ComboBoxBBoxI.FormattingEnabled = True
-        Me.ComboBoxBBoxI.Location = New System.Drawing.Point(20, 580)
-        Me.ComboBoxBBoxI.Name = "ComboBoxBBoxI"
-        Me.ComboBoxBBoxI.Size = New System.Drawing.Size(252, 21)
-        Me.ComboBoxBBoxI.TabIndex = 22
-        Me.ComboBoxBBoxI.Visible = False
+        Me.TextBoxUrl.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
+                    Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
+        Me.TextBoxUrl.Location = New System.Drawing.Point(6, 25)
+        Me.TextBoxUrl.Name = "TextBoxUrl"
+        Me.TextBoxUrl.Size = New System.Drawing.Size(400, 20)
+        Me.TextBoxUrl.TabIndex = 8
         '
-        'ButtonFindScale
-        '
-        Me.ButtonFindScale.Anchor = CType((System.Windows.Forms.AnchorStyles.Bottom Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
-        Me.ButtonFindScale.Location = New System.Drawing.Point(540, 439)
-        Me.ButtonFindScale.Name = "ButtonFindScale"
-        Me.ButtonFindScale.Size = New System.Drawing.Size(123, 36)
-        Me.ButtonFindScale.TabIndex = 23
-        Me.ButtonFindScale.Text = "Optimale Scale finden"
-        Me.ButtonFindScale.UseVisualStyleBackColor = True
-        '
         'capxml2wms
         '
         Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
         Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
         Me.ClientSize = New System.Drawing.Size(675, 601)
-        Me.Controls.Add(Me.ButtonFindScale)
-        Me.Controls.Add(Me.ComboBoxBBoxI)
-        Me.Controls.Add(Me.Label6)
-        Me.Controls.Add(Me.ComboBoxBBox)
-        Me.Controls.Add(Me.ComboBoxFormat)
-        Me.Controls.Add(Me.Label5)
-        Me.Controls.Add(Me.HScrollBar1)
-        Me.Controls.Add(Me.Label4)
-        Me.Controls.Add(Me.ComboBoxEPSG)
-        Me.Controls.Add(Me.ButtonCheckAll)
-        Me.Controls.Add(Me.ButtonCheckNone)
-        Me.Controls.Add(Me.Label3)
-        Me.Controls.Add(Me.CheckedListBoxLayers)
-        Me.Controls.Add(Me.ButtonShowMap)
-        Me.Controls.Add(Me.ButtonGetCapabilities)
-        Me.Controls.Add(Me.ComboBoxVersion)
-        Me.Controls.Add(Me.Label2)
-        Me.Controls.Add(Me.TextBoxXML)
-        Me.Controls.Add(Me.Label1)
-        Me.Controls.Add(Me.TextBoxUrl)
+        Me.Controls.Add(Me.Panel2)
+        Me.Controls.Add(Me.Panel1)
         Me.Controls.Add(Me.ButtonErstellen)
         Me.Icon = CType(resources.GetObject("$this.Icon"), System.Drawing.Icon)
         Me.Name = "capxml2wms"
         Me.Text = "capxml2wms"
+        Me.Panel1.ResumeLayout(False)
+        Me.Panel1.PerformLayout()
+        Me.Panel2.ResumeLayout(False)
+        Me.Panel2.PerformLayout()
         Me.ResumeLayout(False)
-        Me.PerformLayout()
 
     End Sub
     Private WithEvents ButtonErstellen As System.Windows.Forms.Button
-    Private WithEvents TextBoxUrl As System.Windows.Forms.TextBox
-    Private WithEvents Label1 As System.Windows.Forms.Label
-    Private WithEvents TextBoxXML As System.Windows.Forms.TextBox
-    Private WithEvents ComboBoxVersion As System.Windows.Forms.ComboBox
-    Private WithEvents Label2 As System.Windows.Forms.Label
-    Private WithEvents ButtonGetCapabilities As System.Windows.Forms.Button
-    Private WithEvents ButtonShowMap As System.Windows.Forms.Button
-    Private WithEvents CheckedListBoxLayers As System.Windows.Forms.CheckedListBox
-    Private WithEvents Label3 As System.Windows.Forms.Label
-    Private WithEvents ButtonCheckNone As System.Windows.Forms.Button
+    Friend WithEvents Panel1 As System.Windows.Forms.Panel
+    Private WithEvents ButtonFindScale As System.Windows.Forms.Button
     Private WithEvents ButtonCheckAll As System.Windows.Forms.Button
+    Private WithEvents ButtonCheckNone As System.Windows.Forms.Button
+    Private WithEvents Label3 As System.Windows.Forms.Label
+    Private WithEvents CheckedListBoxLayers As System.Windows.Forms.CheckedListBox
+    Private WithEvents ComboBoxBBoxI As System.Windows.Forms.ComboBox
+    Private WithEvents Label6 As System.Windows.Forms.Label
+    Private WithEvents ComboBoxBBox As System.Windows.Forms.ComboBox
+    Private WithEvents ComboBoxFormat As System.Windows.Forms.ComboBox
+    Private WithEvents Label5 As System.Windows.Forms.Label
     Private WithEvents Label4 As System.Windows.Forms.Label
     Private WithEvents ComboBoxEPSG As System.Windows.Forms.ComboBox
-    Private WithEvents HScrollBar1 As System.Windows.Forms.HScrollBar
-    Private WithEvents Label5 As System.Windows.Forms.Label
-    Private WithEvents ComboBoxFormat As System.Windows.Forms.ComboBox
-    Private WithEvents ComboBoxBBox As System.Windows.Forms.ComboBox
-    Private WithEvents Label6 As System.Windows.Forms.Label
-    Private WithEvents ComboBoxBBoxI As System.Windows.Forms.ComboBox
-    Private WithEvents ButtonFindScale As System.Windows.Forms.Button
+    Friend WithEvents Panel2 As System.Windows.Forms.Panel
+    Private WithEvents TextBoxXML As System.Windows.Forms.TextBox
+    Private WithEvents ButtonGetCapabilities As System.Windows.Forms.Button
+    Private WithEvents ComboBoxVersion As System.Windows.Forms.ComboBox
+    Private WithEvents Label2 As System.Windows.Forms.Label
+    Private WithEvents Label1 As System.Windows.Forms.Label
+    Private WithEvents TextBoxUrl As System.Windows.Forms.TextBox
 
 End Class

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.resx	2011-04-05 16:04:48 UTC (rev 2972)
@@ -112,12 +112,12 @@
     <value>2.0</value>
   </resheader>
   <resheader name="reader">
-    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
   </resheader>
   <resheader name="writer">
-    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
+    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
   </resheader>
-  <assembly alias="System.Drawing" name="System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
+  <assembly alias="System.Drawing" name="System.Drawing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
   <data name="$this.Icon" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
     <value>
         AAABAAEAMC8AAAEAGAAQHAAAFgAAACgAAAAwAAAAXgAAAAEAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vb	2011-04-05 16:04:48 UTC (rev 2972)
@@ -85,39 +85,13 @@
         End If
         CheckedListBoxLayers.Items.Add(Layername, False)
     End Sub
-
-    Private Sub ButtonGetCapabilities_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonGetCapabilities.Click
-        GotCapabilities = GetCapabilities()
-        maxScale = 1000
-        minScale = 0
-        If Not recScale Is Nothing Then
-            recScale.Clear()
-        End If
-    End Sub
-
-    Private Sub ButtonShowMap_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonShowMap.Click
-        Dim MeineSkalierung As Double
-        MeineSkalierung = 2.0 * Me.HScrollBar1.Value
-        mapUrl = makeGetMapUrl(MeineSkalierung)
-        Dim center As point
-        center.x = 0
-        center.y = 0
-        Dim SM As New Map(mapUrl, 0, 0, 0, center)
-        'MsgBox("Noch nicht vorhanden!", MsgBoxStyle.Information, "Hinweis!")
-        SM.ButtonAddToRecommendedScale.Visible = False
-        SM.ButtonHelp.Visible = False
-        SM.ButtonScaleDown.Visible = False
-        SM.ButtonScaleUp.Visible = False
-        SM.ButtonUseAsMaxScale.Visible = False
-        SM.ButtonUseAsMinScale.Visible = False
-        SM.LabelScaleDiagonal.Visible = False
-        SM.LabelScaleVertical.Visible = False
-        SM.ShowDialog()
-    End Sub
     Friend _srs As Integer
     Friend _pixelwidth As Integer
     Private Sub ButtonFindScale_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonFindScale.Click
         Dim BBoxString As String
+        If Me.ComboBoxEPSG.Items.Count = 0 Then
+            Return
+        End If
 
         _srs = Me.ComboBoxEPSG.SelectedItem
 
@@ -199,75 +173,7 @@
         mapUrl += "&FORMAT=" & Me.ComboBoxFormat.SelectedItem.ToString
         makeGetMapUrlFromBBox = mapUrl
     End Function
-    Private Function makeGetMapUrl(ByVal scale As Double) As String
-        'http:// www.lv-bw.de/dv/service/getrds2.asp?login=dv&pw=anonymous
-        '&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap
-        '&SRS=EPSG:31467
-        '&BBOX=3500394.51 , 5371405.09 , 3520394.51 , 5391405.09 
-        '&WIDTH=1000
-        '&HEIGHT=1000
-        '&LAYERS=DVTK50K
-        '&STYLES=
-        '&FORMAT=image/png
-
-
-        mapUrl = wmsUrl & "SERVICE=WMS&VERSION=" & Version & "&REQUEST=GetMap"
-
-        mapUrl += "&SRS=EPSG:" & Me.ComboBoxEPSG.SelectedItem
-
-        Dim rxmin As Double
-        Dim rxmax As Double
-        Dim rymin As Double
-        Dim rymax As Double
-
-        If Me.ComboBoxEPSG.SelectedItem = "4326" Then
-            Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
-            GetBBoxValues(Me.ComboBoxBBoxI.SelectedItem)
-        Else
-            Try
-                GetBBoxValues(Me.OBBoxes.Item("EPSG:" & Me.ComboBoxEPSG.SelectedItem))
-            Catch ex As Exception
-                'todo: und jetzt umrechnen !
-                'das spar ich mir wohl, oder !
-                Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
-                GetBBoxValues(Me.ComboBoxBBoxI.SelectedItem)
-                ' jetzt haben wir die BBox zum WGS84
-                MsgBox("Kartenansicht f?r diese Auswahl nicht implementiert", MsgBoxStyle.Exclamation)
-                Exit Function
-            End Try
-        End If
-
-        Dim HalbeKantenlaengex As Double = (rmaxx - rminx) / scale
-        Dim HalbeKantenlaengey As Double = (rmaxy - rminy) / scale
-        Dim HalbeKantenlaenge As Double = HalbeKantenlaengex
-        If HalbeKantenlaengex > HalbeKantenlaengey Then
-            HalbeKantenlaenge = HalbeKantenlaengey
-        End If
-        ' is in x und y die gleiche Einheit?
-        rxmin = rxmitte - HalbeKantenlaenge
-        rxmax = rxmitte + HalbeKantenlaenge
-        rymin = rymitte - HalbeKantenlaenge
-        rymax = rymitte + HalbeKantenlaenge
-
-        Dim BBox As String = "&BBox=" & rxmin.ToString(DPunkt) & "," & rymin.ToString(DPunkt) & ","
-        BBox += rxmax.ToString(DPunkt) & "," & rymax.ToString(DPunkt)
-
-        mapUrl += BBox
-        mapUrl += "&WIDTH=500"
-        mapUrl += "&HEIGHT=500"
-        ' und die gew?hlten Layer durch Komma getrennt
-        Dim SelectedLayers As String = ""
-        For Each s As String In CheckedListBoxLayers.CheckedItems
-            SelectedLayers += "," & s.Split("|")(0)
-        Next
-        If SelectedLayers <> "" Then
-            mapUrl += "&LAYERS=" & SelectedLayers.Substring(1).Replace(" ", "%20")
-        End If
-        mapUrl += "&STYLES="
-        mapUrl += "&FORMAT=" & Me.ComboBoxFormat.SelectedItem.ToString
-        makeGetMapUrl = mapUrl
-    End Function
-
+    
     Friend Function metersToBBoxVertical(ByVal epsg As Integer) As Double
         If epsg = 4326 Then
             metersToBBoxVertical = 360 / (WGS84.a * Math.PI * 2)
@@ -297,15 +203,19 @@
     End Function
     Private Sub ButtonErstellen_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonErstellen.Click
 
+        If Not GotCapabilities Then
+            GotCapabilities = GetCapabilities()
+        End If
+        If Not GotCapabilities Then
+            Return
+        End If
+
+
         Dim wmsFileName As String = IO.Path.ChangeExtension(xmlFileName, ".wms")
         IO.File.Delete(wmsFileName) 'vorsichtshalber
         Dim encoding As System.Text.Encoding = New System.Text.UTF8Encoding(False)
         Dim F As New System.IO.StreamWriter(wmsFileName, False, encoding)
 
-        If Not GotCapabilities Then
-            GotCapabilities = GetCapabilities()
-        End If
-
         Me.ComboBoxBBoxI.SelectedIndex = Me.ComboBoxBBox.SelectedIndex
         GetBBoxValues(Me.ComboBoxBBoxI.SelectedItem)
 
@@ -337,7 +247,7 @@
         F.WriteLine("StylesUrlPart:     STYLES=")
         F.WriteLine("ImageFormatUrlPart:FORMAT=" & Me.ComboBoxFormat.SelectedItem.ToString)
         F.WriteLine("BoundingBoxTopLeftWGS84: " & maxy & " " & minx)
-        F.WriteLine("BoundingBoxButtomRightWGS84: " & miny & " " & maxx)
+        F.WriteLine("BoundingBoxBottomRightWGS84: " & miny & " " & maxx)
         F.WriteLine("#BBox_Mitte: " & mittey & " " & mittex)
         F.WriteLine("MinScale:   " & (Math.Ceiling(minScale * 10000) / 10000).ToString(DPunkt))
         F.WriteLine("MaxScale:   " & (Math.Floor(maxScale * 10000) / 10000).ToString(DPunkt))
@@ -425,7 +335,6 @@
 
     Private Sub TextBoxUrl_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TextBoxUrl.TextChanged
         GotCapabilities = False
-        Me.ButtonShowMap.Enabled = False
         wmsUrl = Me.TextBoxUrl.Text
         capsUrl = Me.TextBoxUrl.Text
     End Sub
@@ -500,8 +409,6 @@
         Me.TextBoxXML.Text = System.Text.Encoding.UTF8.GetString(ms.GetBuffer())
         ms.Close()
 
-        Me.ButtonShowMap.Enabled = True
-
         '1. Version aus WMT_MS_Capabilities
         For Each nl As XmlNode In xd.GetElementsByTagName("WMT_MS_Capabilities")
             If nl.NodeType = XmlNodeType.Element Then
@@ -522,16 +429,22 @@
             End If
         Next
 
+        If Caps Is Nothing Then
+            Return False
+        End If
+
         '2. OnlineResource  aus Service
-        For Each nl As XmlNode In Service
-            If nl.NodeType = XmlNodeType.Element Then
-                If nl.Name = "OnlineResource" Then
-                    Dim ne As XmlElement = nl
-                    OnlineResource = ne.GetAttribute("xlink:href")
-                    Exit For
+        If Not Service Is Nothing Then
+            For Each nl As XmlNode In Service
+                If nl.NodeType = XmlNodeType.Element Then
+                    If nl.Name = "OnlineResource" Then
+                        Dim ne As XmlElement = nl
+                        OnlineResource = ne.GetAttribute("xlink:href")
+                        Exit For
+                    End If
                 End If
-            End If
-        Next
+            Next
+        End If
 
         Dim Request As XmlElement = Nothing
         Dim Exception As XmlElement = Nothing
@@ -558,7 +471,7 @@
             End If
         Next
         If Layer Is Nothing Then
-            Exit Function
+            Return False
         End If
 
         Dim ltmp() As String
@@ -589,16 +502,6 @@
                 End If
             Next
         Next
-        Me.ComboBoxEPSG.SelectedIndex = -1
-        For i As Integer = 0 To Me.ComboBoxEPSG.Items.Count - 1
-            If Me.ComboBoxEPSG.Items.Item(i) = "4326" Then
-                Me.ComboBoxEPSG.SelectedIndex = i
-                Exit For
-            Else
-                'falls ?berhaupt was drin steht
-                Me.ComboBoxEPSG.SelectedIndex = 0
-            End If
-        Next
 
         '11.
         Me.ComboBoxFormat.Items.Clear()
@@ -676,23 +579,45 @@
             If n.NodeType = XmlNodeType.Element Then
                 Dim e As XmlElement = n
                 Dim stmp As String = e.GetAttribute("SRS")
-                If Not OBBoxes.ContainsKey(stmp) Then
-                    OBBoxes.Add(stmp, e)
+                If Not stmp = "EPSG:4326" Then
+                    If Not OBBoxes.ContainsKey(stmp) Then
+                        OBBoxes.Add(stmp, e)
+                    End If
                 End If
             End If
         Next
+        '<LatLonBoundingBox minx="8.334125" miny="44.552846" maxx="11.658327" maxy="46.739748" />
         If Not OBBoxes.ContainsKey("EPSG:4326") Then
             For Each n As XmlNode In Layer.GetElementsByTagName("LatLonBoundingBox")
                 If n.NodeType = XmlNodeType.Element Then
                     Dim e As XmlElement = n
-                    Dim stmp As String = e.GetAttribute("SRS")
-                    If Not stmp = "" And Not OBBoxes.ContainsKey(stmp) Then
+                    If Not OBBoxes.ContainsKey("EPSG:4326") Then
                         OBBoxes.Add("EPSG:4326", e)
+                        If Me.ComboBoxEPSG.Items.Count = 0 Then
+                            Dim s As String = "4326"
+                            SRSD.Add("SRS=EPSG:" & s, " ")
+                            SRS = SRS & "SRS=EPSG:" & s & " "
+                            SRSCW = SRSCW & " " & s
+                            ComboBoxEPSG.Items.Add(s)
+                        End If
                     End If
                 End If
             Next
         End If
 
+        ' 14 Nacharbeiten
+        Me.ComboBoxEPSG.SelectedIndex = -1
+        For i As Integer = 0 To Me.ComboBoxEPSG.Items.Count - 1
+            If Me.ComboBoxEPSG.Items.Item(i) = "4326" Then
+                Me.ComboBoxEPSG.SelectedIndex = i
+                Exit For
+            Else
+                'falls ?berhaupt was drin steht
+                Me.ComboBoxEPSG.SelectedIndex = 0
+            End If
+        Next
+
+
         ButtonCheckAll_Click(Nothing, Nothing)
         Return True
 
@@ -709,6 +634,9 @@
         'Dim rminy As Double
         'Dim rmaxx As Double
         'Dim rmaxy As Double
+        If e Is Nothing Then
+            Return
+        End If
         minx = e.GetAttribute("minx")
         rminx = Double.Parse(minx, DPunkt.NumberFormat)
         minx = Format(rminx, "0.0000").Replace(",", ".")
@@ -798,4 +726,12 @@
 
     End Function
 
+    Private Sub ButtonGetCapabilities_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonGetCapabilities.Click
+        GotCapabilities = GetCapabilities()
+        maxScale = 1000
+        minScale = 0
+        If Not recScale Is Nothing Then
+            recScale.Clear()
+        End If
+    End Sub
 End Class

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj	2011-04-05 16:04:48 UTC (rev 2972)
@@ -1,5 +1,5 @@
 ???<?xml version="1.0" encoding="utf-8"?>
-<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
+<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">
   <PropertyGroup>
     <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
     <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
@@ -14,10 +14,11 @@
     <ApplicationIcon>gc.ico</ApplicationIcon>
     <FileUpgradeFlags>
     </FileUpgradeFlags>
-    <OldToolsVersion>2.0</OldToolsVersion>
-    <TargetFrameworkVersion>v3.5</TargetFrameworkVersion>
+    <OldToolsVersion>3.5</OldToolsVersion>
+    <TargetFrameworkVersion>v4.0</TargetFrameworkVersion>
     <UpgradeBackupLocation>
     </UpgradeBackupLocation>
+    <IsWebBootstrapper>false</IsWebBootstrapper>
     <PublishUrl>publish\</PublishUrl>
     <Install>true</Install>
     <InstallFrom>Disk</InstallFrom>
@@ -30,7 +31,6 @@
     <MapFileExtensions>true</MapFileExtensions>
     <ApplicationRevision>0</ApplicationRevision>
     <ApplicationVersion>1.0.0.%2a</ApplicationVersion>
-    <IsWebBootstrapper>false</IsWebBootstrapper>
     <UseApplicationTrust>false</UseApplicationTrust>
     <BootstrapperEnabled>true</BootstrapperEnabled>
   </PropertyGroup>
@@ -41,7 +41,7 @@
     <DefineTrace>true</DefineTrace>
     <OutputPath>bin\Debug\</OutputPath>
     <DocumentationFile>capxml2wms.xml</DocumentationFile>
-    <NoWarn>42016,41999,42017,42018,42019,42032,42036,42020,42021,42022</NoWarn>
+    <NoWarn>42016,41999,42017,42018,42019,42032,42036,42020,42021,42022,42353,42354,42355</NoWarn>
   </PropertyGroup>
   <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
     <DebugType>pdbonly</DebugType>
@@ -50,7 +50,7 @@
     <Optimize>true</Optimize>
     <OutputPath>bin\Release\</OutputPath>
     <DocumentationFile>capxml2wms.xml</DocumentationFile>
-    <NoWarn>42016,41999,42017,42018,42019,42032,42036,42020,42021,42022</NoWarn>
+    <NoWarn>42016,41999,42017,42018,42019,42032,42036,42020,42021,42022,42353,42354,42355</NoWarn>
   </PropertyGroup>
   <ItemGroup>
     <Reference Include="System" />
@@ -133,7 +133,7 @@
   <ItemGroup>
     <BootstrapperPackage Include="Microsoft.Net.Client.3.5">
       <Visible>False</Visible>
-      <ProductName>.NET Framework Client Profile</ProductName>
+      <ProductName>.NET Framework 3.5 SP1 Client Profile</ProductName>
       <Install>false</Install>
     </BootstrapperPackage>
     <BootstrapperPackage Include="Microsoft.Net.Framework.2.0">

Modified: trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms/capxml2wms.vbproj.user	2011-04-05 16:04:48 UTC (rev 2972)
@@ -1,4 +1,5 @@
-???<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
+???<?xml version="1.0" encoding="utf-8"?>
+<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
   <PropertyGroup>
     <PublishUrlHistory>http://localhost/capxml2wms/</PublishUrlHistory>
     <InstallUrlHistory>

Modified: trunk/tools/MakeWMSFile/capxml2wms.sln
===================================================================
--- trunk/tools/MakeWMSFile/capxml2wms.sln	2011-04-03 14:26:55 UTC (rev 2971)
+++ trunk/tools/MakeWMSFile/capxml2wms.sln	2011-04-05 16:04:48 UTC (rev 2972)
@@ -1,6 +1,6 @@
 ???
-Microsoft Visual Studio Solution File, Format Version 10.00
-# Visual Basic Express 2008
+Microsoft Visual Studio Solution File, Format Version 11.00
+# Visual Basic Express 2010
 Project("{F184B08F-C81C-45F6-A57F-5ABD9991F28F}") = "capxml2wms", "capxml2wms\capxml2wms.vbproj", "{623B1E12-B5BF-4835-A982-AE5500BFADC8}"
 EndProject
 Global



From pfeffer at mail.berlios.de  Wed Apr  6 11:07:37 2011
From: pfeffer at mail.berlios.de (pfeffer at mail.berlios.de)
Date: Wed,  6 Apr 2011 11:07:37 PM +0200
Subject: [Cachewolf-svn] r2973 - trunk/src/CacheWolf/navi
Message-ID: <20110406210737.A4811480EC0@sheep.berlios.de>

Author: pfeffer
Date: 2011-04-06 23:07:37 +0200 (Wed, 06 Apr 2011)
New Revision: 2973

Modified:
   trunk/src/CacheWolf/navi/MapLoader.java
Log:
MapLoader: small bug fixed: now uses "ServiceTypeUrlPart" from wms file instead of the fixed string "SERVICE=WMS"

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2011-04-05 16:04:48 UTC (rev 2972)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2011-04-06 21:07:37 UTC (rev 2973)
@@ -128,7 +128,7 @@
 	public void setFetchOnlyMapWithCache(boolean value) {
 		fetchOnlyMapWithCache=value;
 	}
-	
+
 	public String[] getAvailableOnlineMapServices(){
 		int s = onlineMapServices.size();
 		String[] services = new String[s];
@@ -231,7 +231,7 @@
 			lon = topleft.lonDec;
 			for (int col = 1; col <= numMapsX; col++) {
 				center.set(lat, lon);
-				if (!fetchOnlyMapWithCache || hasCache(center,latinc,loninc)) {					
+				if (!fetchOnlyMapWithCache || hasCache(center,latinc,loninc)) {
 					if (progressInfobox != null)
 						progressInfobox.setInfo(MyLocale.getMsg(4802, "Downloading calibrated (georeferenced) \n map image \n '") + currentOnlineMapService.getName()+MyLocale.getMsg(4803, "' \n Downloading tile \n row")+" "+row+" / "+numMapsY+MyLocale.getMsg(4804, " column")+" "+ col + " / "+numMapsX);
 					try {
@@ -283,13 +283,13 @@
 		String url = currentOnlineMapService.getUrlForCenterScale(center, scale, pixelsize);
 		String fName = path + imagename + imagetype;
 		FileBugfix fn = new FileBugfix(path + imagename + ".wfl");
-		FileBugfix fn1 = new FileBugfix(fName);						
+		FileBugfix fn1 = new FileBugfix(fName);
 		if (!fn.exists() || fn.length()==0 || !fn1.exists() || fn1.length()==0) {
 			if (currentOnlineMapService instanceof ExpediaMapService) {
 				downloadImage(url, path+imagename+imagetype);
 			}
 			else {
-				WebMapService wms = (WebMapService) currentOnlineMapService;				
+				WebMapService wms = (WebMapService) currentOnlineMapService;
 				if (wms.requestUrlPart.startsWith("REQUEST")) {
 					downloadImage(url, path+imagename+imagetype);
 				}
@@ -307,10 +307,10 @@
 						mb.execute();
 						return;
 					}
-					
+
 					String mapProgramParams = "";
-					
-					if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {					
+
+					if (wms.requestUrlPart.equalsIgnoreCase("Kosmos")) {
 						// minx miny maxx maxy + pixelsize.x
 						mapProgramParams="bitmapgen" +
 							" \""+FileBase.getProgramDirectory().replace('/',File.separatorChar)+"\\"+wms.serviceTypeUrlPart+"\""+
@@ -318,16 +318,16 @@
 							" -mb " +
 							bottomleft.toString(TransformCoordinates.LAT_LON).replace(',',' ') + " " +
 							topright.toString(TransformCoordinates.LAT_LON).replace(',',' ') +
-							" -w "+pixelsize.x;				
-						Vm.exec(mapProgram, mapProgramParams, 0, true);				
+							" -w "+pixelsize.x;
+						Vm.exec(mapProgram, mapProgramParams, 0, true);
 					}
-					else {						
+					else {
 						if (wms.requestUrlPart.equalsIgnoreCase("Maperitive")) {
 							// Maperitive runs on Windows and Linux
 							// generating scriptfile for Maperitive from wmsfile
 							String cwPath = FileBase.getProgramDirectory().replace('/',FileBase.separatorChar) + FileBase.separatorChar;
 							String scriptFileName = cwPath + "maperitive.script";
-							
+
 							PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(scriptFileName)));
 							outp.println("use-ruleset alias=default");
 							outp.println("clear-map");
@@ -338,7 +338,7 @@
 							else {
 								outp.println("add-web-map provider=" + wms.serviceTypeUrlPart);
 							}
-							
+
 							if (!wms.stylesUrlPart.equals("")) {
 								String myrules = mapProgramPath + wms.stylesUrlPart.replace('/',FileBase.separatorChar);
 								outp.println("use-ruleset location=" + myrules);
@@ -349,7 +349,7 @@
 								outp.println("load-source " + mapProgramPath + wms.layersUrlPart.replace('/',FileBase.separatorChar));
 								// implicit does apply-ruleset
 							}
-							
+
 							String koords = bottomleft.toString(TransformCoordinates.LON_LAT) + "," + topright.toString(TransformCoordinates.LON_LAT);
 							outp.println("bounds-set "+koords);
 							outp.println("zoom-bounds");
@@ -360,7 +360,7 @@
 								outp.print("export-bitmap file=" + fName);
 							}
 							outp.print(" bounds="+ koords);
-							String pxSize = " width="+pixelsize.x + " height="+pixelsize.y;						
+							String pxSize = " width="+pixelsize.x + " height="+pixelsize.y;
 							outp.print(pxSize);
 							outp.println(" kml=false");
 							outp.close();
@@ -369,7 +369,7 @@
 								mapProgramParams = "-exitafter " + "\"" + scriptFileName + "\"";
 							}
 							else {
-								mapProgramParams = "-exitafter " + scriptFileName;								
+								mapProgramParams = "-exitafter " + scriptFileName;
 							}
 							Vm.exec(mapProgram, mapProgramParams, 0, true);
 							// preparation for generating wfl from the ozi map-file
@@ -382,7 +382,7 @@
 							jgwFile.delete();
 						}
 					}
-				}			
+				}
 			}
 			mio.saveWFL();
 		}
@@ -485,13 +485,13 @@
 			} catch(IOException ex){
 				Global.getPref().log(MyLocale.getMsg(4118, "IO-Error while reading or writing calibration file"), ex);
 			}
-			mapFile.delete(); 
+			mapFile.delete();
 		} else { // if map file.exists
 			Global.getPref().log(MyLocale.getMsg(4119, "No calibration file found for: "), null);
 		}
 		return GCPs;
 	}
-	
+
 	public String createFilename(CWPoint center, float scale) {
 		String filename = Common.ClearForFileName(currentOnlineMapService.getNameForFileSystem()+"_s"+Common.DoubleToString(scale,0,1)
 				+ "_c" + center.toString(TransformCoordinates.LAT_LON).replace(',', '-'));
@@ -521,7 +521,7 @@
 			UrlFetcher.fetchDataFile(realurl, datei);
 			String ct=null;
 			try {
-				ct = (String) UrlFetcher.getDocumentProperties().getValue("content-type","");
+				ct = (String) UrlFetcher.getDocumentProperties().getValue("content-type","no-content-type provided");
 			} catch (Exception e) {
 				ct="document property content-type does not exist!";
 			}
@@ -819,7 +819,7 @@
 		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84)
 			bbox += bottomleft.toString(TransformCoordinates.LON_LAT)  + "," + topright.toString(TransformCoordinates.LON_LAT);
 		else throw new IllegalArgumentException(MyLocale.getMsg(4828, "Coordinate system not supported by cachewolf:")+" " + coordinateReferenceSystem.toString());
-		String ret = MainUrl + "SERVICE=WMS" + "&"+ versionUrlPart + "&" + requestUrlPart + "&" +
+		String ret = MainUrl + serviceTypeUrlPart + "&" + versionUrlPart + "&" + requestUrlPart + "&" +
 		coordinateReferenceSystemUrlPart[crs] + "&" + bbox +
 		"&WIDTH=" + pixelsize.x + "&HEIGHT=" + pixelsize.y + "&" +
 		layersUrlPart + "&" + stylesUrlPart + "&" + imageFormatUrlPart;



From mik77 at mail.berlios.de  Sun Apr 10 01:36:47 2011
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 10 Apr 2011 01:36:47 PM +0200
Subject: [Cachewolf-svn] r2974 - trunk/src/CacheWolf
Message-ID: <20110410113648.17800480FC5@sheep.berlios.de>

Author: mik77
Date: 2011-04-10 13:36:47 +0200 (Sun, 10 Apr 2011)
New Revision: 2974

Modified:
   trunk/src/CacheWolf/DBStats.java
Log:
Don't show blacklist stats, when blacklist is not used.

Modified: trunk/src/CacheWolf/DBStats.java
===================================================================
--- trunk/src/CacheWolf/DBStats.java	2011-04-06 21:07:37 UTC (rev 2973)
+++ trunk/src/CacheWolf/DBStats.java	2011-04-10 11:36:47 UTC (rev 2974)
@@ -31,11 +31,11 @@
  */
 public class DBStats {
 	CacheDB cacheDB = null;
-	
+
 	public DBStats(CacheDB db){
 		cacheDB = db;
 	}
-	
+
 	/**
 	 * Method to get the number of caches displayed in the list.
 	 * It will count waypoints only that start with
@@ -55,18 +55,18 @@
 				if (CacheType.isAddiWpt(holder.getType())) {
 					whiteWaypoints++;
 				}
-				else {				
+				else {
 					whiteCaches++;
-				}		
+				}
 			}
 		}
 		if (big)
 			return counter+"("+whiteCaches+"/"+whiteWaypoints+")";
 		else
 			return ""+whiteCaches;
-		
+
 	}
-	
+
 	/**
 	 * Method to get the number of caches available for display
 	 * @return
@@ -82,7 +82,7 @@
 			holder = cacheDB.get(i);
 			if(holder.is_black()){
 			  if (CacheType.isAddiWpt(holder.getType())) {
-				  blackWaypoints++;  
+				  blackWaypoints++;
 			  }
 			  else {
 				  blackCaches++;
@@ -92,17 +92,23 @@
 				if (CacheType.isAddiWpt(holder.getType())) {
 					whiteWaypoints++;
 				}
-				else {				
+				else {
 					whiteCaches++;
-				}		
+				}
 			}
 		}
-		if (big)
-			return all+"("+whiteCaches+"/"+whiteWaypoints+"+"+blackCaches+"/"+blackWaypoints+")";
+		if (big){
+			if ( blackCaches > 0 || blackWaypoints > 0) {
+				return all+"("+whiteCaches+"/"+whiteWaypoints+"+"+blackCaches+"/"+blackWaypoints+")";
+			}
+			else {
+				return all+"("+whiteCaches+"/"+whiteWaypoints+")";
+			}
+		}
 		else
 			return ""+whiteCaches;
 	}
-	
+
 	public int totalFound(){
 		CacheHolder holder;
 		int counter = 0;



From apreisser at mail.berlios.de  Sat Apr 16 02:18:49 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 16 Apr 2011 02:18:49 PM +0200
Subject: [Cachewolf-svn] r2975 - in trunk/src/CacheWolf: . exp
Message-ID: <20110416121849.D7359481455@sheep.berlios.de>

Author: apreisser
Date: 2011-04-16 14:18:49 +0200 (Sat, 16 Apr 2011)
New Revision: 2975

Modified:
   trunk/src/CacheWolf/TravelbugJourneyList.java
   trunk/src/CacheWolf/exp/OziExporter.java
Log:
Constructor marked as public declared as public.
Minor change on code formatting

Modified: trunk/src/CacheWolf/TravelbugJourneyList.java
===================================================================
--- trunk/src/CacheWolf/TravelbugJourneyList.java	2011-04-10 11:36:47 UTC (rev 2974)
+++ trunk/src/CacheWolf/TravelbugJourneyList.java	2011-04-16 12:18:49 UTC (rev 2975)
@@ -40,9 +40,15 @@
 
 public class TravelbugJourneyList extends MinML {
 
-	/** The Vector holdin the travelbug journeys */
+	/** The Vector holding the travelbug journeys */
 	private Vector tbJourneyList=new Vector(10);
 	
+	/**
+	 * Public constructor
+	 */
+	public TravelbugJourneyList() {
+	}
+
 	/** Return a TravelbugJourney */
 	public TravelbugJourney getTBJourney(int i) {
 		return (TravelbugJourney) tbJourneyList.elementAt(i);
@@ -101,9 +107,6 @@
 		return count;
 	}
 	
-	TravelbugJourneyList() { // Public constructor
-	}
-	
 	/**
 	 * Return a list of the travelbugs still in my possession
 	 * @return 

Modified: trunk/src/CacheWolf/exp/OziExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/OziExporter.java	2011-04-10 11:36:47 UTC (rev 2974)
+++ trunk/src/CacheWolf/exp/OziExporter.java	2011-04-16 12:18:49 UTC (rev 2975)
@@ -30,7 +30,6 @@
 import CacheWolf.Preferences;
 import CacheWolf.Profile;
 
-
 /**
 *	Class to export the cache database (index) to an OziExplorer File
 */



From apreisser at mail.berlios.de  Sat Apr 16 02:25:22 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 16 Apr 2011 02:25:22 PM +0200
Subject: [Cachewolf-svn] r2976 - in trunk/res_noewe: . languages
Message-ID: <20110416122522.EA983481455@sheep.berlios.de>

Author: apreisser
Date: 2011-04-16 14:25:22 +0200 (Sat, 16 Apr 2011)
New Revision: 2976

Added:
   trunk/res_noewe/icon_smile_dissapprove.gif
   trunk/res_noewe/icon_smile_shy.gif
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
Log:
Some messages added for future catastrophes (or another TBJourneyScreen...)

Added: trunk/res_noewe/icon_smile_dissapprove.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/icon_smile_dissapprove.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: trunk/res_noewe/icon_smile_shy.gif
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/icon_smile_shy.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2011-04-16 12:18:49 UTC (rev 2975)
+++ trunk/res_noewe/languages/DE.cfg	2011-04-16 12:25:22 UTC (rev 2976)
@@ -994,6 +994,7 @@
 5520=Nur das eingestellte Maximum an Caches wurde geladen.\nWiederholen sie das Spidern sp?ter um weitere Caches zu laden.\nEs wurden keine vorhandenen Caches aktualisiert.
 5521=Seite+
 5522=Pr?fen auf ?ltere XML-Dateien ( ohne <CACHE... /> ) ?
+
 6000=Guid
 6001=Name
 6002=Track#
@@ -1035,7 +1036,19 @@
 6046=Nur nicht geloggte zeigen
 6047=Ausgew?hlte Zeilen l?schen
 6050=Spalten zeigen
-6051=Spalten verbergen
+6051=Spalten verbergen
+6052=Men?
+6053=Travelbug Men?
+6054=Alle anzeigen
+6055=Sortieren...
+6056=Expertenansicht
+6057=zur?ck
+6058=Aufgenommen:
+6059=Datum: 
+6060=Abgelegt:
+6061=Schlie?en
+6062=Track-Nr
+
 6100=Sonne
 6101=Mond
 6102=Gro?er Wagen

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2011-04-16 12:18:49 UTC (rev 2975)
+++ trunk/res_noewe/languages/EN.cfg	2011-04-16 12:25:22 UTC (rev 2976)
@@ -1035,7 +1035,19 @@
 6046=Show only not logged
 6047=Delete selected Travelbugs
 6050=Show column
-6051=Don't show column
+6051=Don't show column
+6052=Menu
+6053=Travelbug Menu
+6054=Show all
+6055=Sort ...
+6056=Expertview
+6057=Back
+6058=Retrieved:
+6059=Date: 
+6060=Dropped off:
+6061=Close
+6062=Track-No
+
 6100=Sun
 6101=Moon
 6102=Greater Bear

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2011-04-16 12:18:49 UTC (rev 2975)
+++ trunk/res_noewe/languages/FR.cfg	2011-04-16 12:25:22 UTC (rev 2976)
@@ -1036,6 +1036,18 @@
 6047=Effacer lignes selectionn?es
 6050=Montrer colonnes
 6051=Masquer colonnes
+6052=Menu
+6053=Travelbug Men?
+6054=Alle anzeigen
+6055=Sort ...
+6056=Expertenansicht
+6057=Back
+6058=Retrieved:
+6059=Date: 
+6060=Dropped off:
+6061=Close
+6062=Track-Nr
+
 6100=Soleil
 6101=Lune
 6102=Grande Ourse

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2011-04-16 12:18:49 UTC (rev 2975)
+++ trunk/res_noewe/languages/NL.cfg	2011-04-16 12:25:22 UTC (rev 2976)
@@ -1035,7 +1035,19 @@
 6046=Toon alleen gelogd.
 6047=Verwijder geselecteerde Travelbugs.
 6050=Toon kolom
-6051=Toon kolom niet.
+6051=Toon kolom niet.
+6052=Menu
+6053=Travelbug Men?
+6054=Alle anzeigen
+6055=Sort ...
+6056=Expertenansicht
+6057=Back
+6058=Retrieved:
+6059=Date: 
+6060=Dropped off:
+6061=Close
+6062=Track-Nr
+
 6100=Zon
 6101=Maan
 6102=Grote Beer

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2011-04-16 12:18:49 UTC (rev 2975)
+++ trunk/res_noewe/languages/PL.cfg	2011-04-16 12:25:22 UTC (rev 2976)
@@ -1035,7 +1035,19 @@
 6046=Pokaz tylko nie zalogowane
 6047=Usun wybrane Travelbugi
 6050=Pokaz kolumny
-6051=Nie pokazuj kolumny
+6051=Nie pokazuj kolumny
+6052=Menu
+6053=Travelbug Men?
+6054=Alle anzeigen
+6055=Sort ...
+6056=Expertenansicht
+6057=Back
+6058=Retrieved:
+6059=Date: 
+6060=Dropped off:
+6061=Close
+6062=Track-Nr
+
 6100=Slonce
 6101=Ksiezyc
 6102=Wielka Niedzwiedzica



From apreisser at mail.berlios.de  Sat Apr 16 02:25:53 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 16 Apr 2011 02:25:53 PM +0200
Subject: [Cachewolf-svn] r2977 - trunk/src/CacheWolf
Message-ID: <20110416122553.CE67B481455@sheep.berlios.de>

Author: apreisser
Date: 2011-04-16 14:25:53 +0200 (Sat, 16 Apr 2011)
New Revision: 2977

Modified:
   trunk/src/CacheWolf/Preferences.java
Log:
Entry for experimental purposes added

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2011-04-16 12:25:22 UTC (rev 2976)
+++ trunk/src/CacheWolf/Preferences.java	2011-04-16 12:25:53 UTC (rev 2977)
@@ -339,6 +339,13 @@
 	public boolean debug = false;
 	//////////////////////////////////////////////
 
+	/**
+	 * This switches the behaviour of GUI-Element factories. If set to true, it will construct alternative Forms.
+	 * It can only be set in the Preference-File directly, not by user-interaction now.
+	 * Add  <MobileGui value="true"/> to your pref.xml
+	 */
+	public boolean mobileGUI = false;
+
     //////////////////////////////////////////////////////////////////////////////////////
     // Public fields not stored in pref.xml
 	//////////////////////////////////////////////////////////////////////////////////////
@@ -681,6 +688,7 @@
 		else if (name.equals("Symbols")) {
 			useOwnSymbols=Boolean.valueOf(atts.getValue("useOwnSymbols")).booleanValue();
 		}
+		else if (name.equals("MobileGui")) mobileGUI=Boolean.valueOf(atts.getValue("value")).booleanValue();
 	}
 
 	public void characters( char ch[], int start, int length ) {
@@ -780,6 +788,7 @@
 			outp.print("    <showCachesOnMap on=\""+SafeXML.strxmlencode(showCachesOnMap)+"\"/>\n");
 			outp.print("    <SortingGroupedByCache on=\""+SafeXML.strxmlencode(SortingGroupedByCache)+"\"/>\n");
 			outp.print("    <Symbols useOwnSymbols=\"" + SafeXML.strxmlencode(useOwnSymbols) + "\"/>\n");
+			if (mobileGUI) outp.print("    <MobileGui value=\"true\" />\n"); // Keep the vmgui switch if it is set
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {



From apreisser at mail.berlios.de  Sat Apr 16 02:35:45 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 16 Apr 2011 02:35:45 PM +0200
Subject: [Cachewolf-svn] r2978 - trunk/src/CacheWolf
Message-ID: <20110416123545.C061C481455@sheep.berlios.de>

Author: apreisser
Date: 2011-04-16 14:35:45 +0200 (Sat, 16 Apr 2011)
New Revision: 2978

Modified:
   trunk/src/CacheWolf/CacheList.java
Log:
Removed unused variable

Modified: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2011-04-16 12:25:53 UTC (rev 2977)
+++ trunk/src/CacheWolf/CacheList.java	2011-04-16 12:35:45 UTC (rev 2978)
@@ -133,14 +133,12 @@
 		myList(int rows, int columns, boolean multi) { super(rows,columns,multi); }
 
 		//  Allow the caches to be dragged out of the cachelist
-		String wayPoint;
 		int idx;
 
 		public void startDragging(DragContext dc) {
 			 idx=getSelectedIndex(0);
 			 if (idx>=0) {
 				 CacheHolder ch=cacheList.get(idx);
-				 wayPoint=ch.getWayPoint();
 				 IconAndText imgDrag=new IconAndText();
 				 imgDrag.addColumn(CacheType.getTypeImage(ch.getType()));
 				 imgDrag.addColumn(ch.getWayPoint());



From araber95 at mail.berlios.de  Sat Apr 16 04:53:27 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 16 Apr 2011 04:53:27 PM +0200
Subject: [Cachewolf-svn] r2979 - in trunk: res_noewe/symbols resources
	src/CacheWolf src/CacheWolf/navi
Message-ID: <20110416145328.1D6A3481455@sheep.berlios.de>

Author: araber95
Date: 2011-04-16 16:53:27 +0200 (Sat, 16 Apr 2011)
New Revision: 2979

Added:
   trunk/res_noewe/symbols/2foundsize.png
   trunk/resources/found.png
Modified:
   trunk/res_noewe/symbols/readme.htm
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/GuiImageBroker.java
   trunk/src/CacheWolf/RadarPanel.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
symbol for finds on map

Added: trunk/res_noewe/symbols/2foundsize.png
===================================================================
(Binary files differ)


Property changes on: trunk/res_noewe/symbols/2foundsize.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: trunk/res_noewe/symbols/readme.htm
===================================================================
--- trunk/res_noewe/symbols/readme.htm	2011-04-16 12:35:45 UTC (rev 2978)
+++ trunk/res_noewe/symbols/readme.htm	2011-04-16 14:53:27 UTC (rev 2979)
@@ -13,18 +13,18 @@
 <!--[if gte mso 9]><xml>
  <o:DocumentProperties>
   <o:Author>.</o:Author>
-  <o:LastAuthor>.</o:LastAuthor>
-  <o:Revision>5</o:Revision>
+  <o:LastAuthor>Franz</o:LastAuthor>
+  <o:Revision>7</o:Revision>
   <o:Created>2009-10-23T21:05:00Z</o:Created>
-  <o:LastSaved>2010-06-08T16:27:00Z</o:LastSaved>
+  <o:LastSaved>2011-04-16T14:48:00Z</o:LastSaved>
   <o:Pages>1</o:Pages>
-  <o:Words>238</o:Words>
-  <o:Characters>1506</o:Characters>
+  <o:Words>256</o:Words>
+  <o:Characters>1615</o:Characters>
   <o:Company>CF Computer</o:Company>
-  <o:Lines>12</o:Lines>
+  <o:Lines>13</o:Lines>
   <o:Paragraphs>3</o:Paragraphs>
-  <o:CharactersWithSpaces>1741</o:CharactersWithSpaces>
-  <o:Version>10.6858</o:Version>
+  <o:CharactersWithSpaces>1868</o:CharactersWithSpaces>
+  <o:Version>10.6870</o:Version>
  </o:DocumentProperties>
 </xml><![endif]--><!--[if gte mso 9]><xml>
  <w:WordDocument>
@@ -84,7 +84,7 @@
 	font-family:"Times New Roman";}
 </style>
 <![endif]--><!--[if gte mso 9]><xml>
- <o:shapedefaults v:ext="edit" spidmax="5122"/>
+ <o:shapedefaults v:ext="edit" spidmax="6146"/>
 </xml><![endif]--><!--[if gte mso 9]><xml>
  <o:shapelayout v:ext="edit">
   <o:idmap v:ext="edit" data="1"/>
@@ -106,6 +106,10 @@
 Symbole angezeigt, falls sie existieren und der Dateiname auf <span
 class=SpellE>size</span> endet.</p>
 
+<p class=MsoNormal>F?r <span class=GramE>gefundene</span> Cache k?nnen auf der
+Karte entsprechende Symbole angezeigt werden. Der Dateiname muss daf?r auf <span
+class=SpellE>foundsize</span> enden.</p>
+
 <p class=MsoNormal>Es m?ssen nur die Dateien erstellt werden, die ersetzt
 werden sollen.</p>
 
@@ -125,8 +129,8 @@
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>They're
 supposed to be 16x16 <span class=SpellE>PNGs</span> or less.<o:p></o:p></span></p>
 
-<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>On the map larger
-symbols are shown, if they exist and the filename ends on size.<o:p></o:p></span></p>
+<p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>On the map
+larger symbols are shown, if they exist and the filename ends on size.<o:p></o:p></span></p>
 
 <p class=MsoNormal><span lang=EN-GB style='mso-ansi-language:EN-GB'>Incorrectly
 named files will be ignored.<o:p></o:p></span></p>
@@ -154,12 +158,11 @@
 <p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
 EN-GB'>old</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'> Nr<span
 style='mso-tab-count:1'>? </span><span class=SpellE>newNr</span><span
-style='mso-tab-count:1'> </span><span style='mso-tab-count:1'>??????????? </span>meaning<o:p></o:p></span></p>
+style='mso-tab-count:2'>???????????? </span>meaning<o:p></o:p></span></p>
 
 <p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
 EN-GB'>0.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'><span
-style='mso-tab-count:1'>?? </span>0.png<span style='mso-tab-count:1'>?? </span><span
-style='mso-tab-count:1'>??????????? </span>Custom<o:p></o:p></span></p>
+style='mso-tab-count:1'>?? </span>0.png<span style='mso-tab-count:2'>?????????????? </span>Custom<o:p></o:p></span></p>
 
 <p class=MsoNormal><span class=GramE><span lang=EN-GB style='mso-ansi-language:
 EN-GB'>1.png</span></span><span lang=EN-GB style='mso-ansi-language:EN-GB'><span

Added: trunk/resources/found.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/found.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2011-04-16 12:35:45 UTC (rev 2978)
+++ trunk/src/CacheWolf/CacheType.java	2011-04-16 14:53:27 UTC (rev 2979)
@@ -31,26 +31,27 @@
 	public byte _cwMappedCType; // CW Cache Typ intern
 	public byte _cwCType; // CW Cache Typ intern
 	public char _cwCGroup; // Cache Typ Group intern
-	public String _cwCTypeV1; // V1 Cache Typ 
-	public String _gcCTypeSpider; // GC Type on Spider Import from GC.com 
-	public String _ocCTypeXmlImport; // GC Type on Spider Import from GC.com 
-	public byte _cwCTypeV2; // V2 Cache Typ 
+	public String _cwCTypeV1; // V1 Cache Typ
+	public String _gcCTypeSpider; // GC Type on Spider Import from GC.com
+	public String _ocCTypeXmlImport; // GC Type on Spider Import from GC.com
+	public byte _cwCTypeV2; // V2 Cache Typ
 	public char _gpxShortCType; // Short Typ (one char abbreviation)
 	public String _imageName; // name of imageName for Icon, "showCacheInBrowser" and "KML Export"
 	public String _gpxWptTypeTag; // gpx wpt <type> tag
 	public String _gpxWptSymTag; // gpx wpt <sym> tag
 	public String _gpxWptGCextensionTypTag; // gpx cache extension <groundspeak:type> tag
-	public String _gpxAlternativeWptTypTags; // alternative typ - names for gpx from other sources 		
+	public String _gpxAlternativeWptTypTags; // alternative typ - names for gpx from other sources
 	public int _msgNrCTypeName; // message number for gui cache Typ name
 	public int _GUIOrder; // sort Order in GUI selection //TODO more intelligent implementation (now manually change each line on new one)
-	public int _FilterStringPos; // BitNr in Filter String (profile) 
+	public int _FilterStringPos; // BitNr in Filter String (profile)
 	public int _FilterPattern; // 2**BitNr in Filter int (does not correspond with BitNr in String)
-	public Image _iconImage; 
+	public Image _iconImage;
 	public Image _mapImage;
-	public CTyp(byte cwMappedCType, byte cwCType, char cwCGroup, String cwCTypeV1, String gcCTypeSpider, 
-			String ocCTypeXmlImport, byte cwCTypeV2, char gpxShortCType, String imageName, 
+	public Image _foundImage;
+	public CTyp(byte cwMappedCType, byte cwCType, char cwCGroup, String cwCTypeV1, String gcCTypeSpider,
+			String ocCTypeXmlImport, byte cwCTypeV2, char gpxShortCType, String imageName,
 			String[] gpx, int msgNrCTypeName, int gUIOrder, int filterStringPos, int filterPattern) {
-		
+
 		_cwMappedCType = cwMappedCType;
 		_cwCType = cwCType;
 		_cwCGroup = cwCGroup;
@@ -71,13 +72,14 @@
 		if (!_imageName.equals("")) {
 			_iconImage=new Image(_imageName);
 			_mapImage=_iconImage;
+			_foundImage=new Image("found.png");
 		}
 	}
 }
 
 
 /**
- * Handles all aspects of converting cache type information 
+ * Handles all aspects of converting cache type information
  * from and to the various im- and exporters ...
  * converting legacy profiles to current standard
  *
@@ -158,12 +160,12 @@
 		new CTyp(CW_TYPE_REFERENCE,CW_TYPE_REFERENCE,'A',"55","","",(byte) -73,'R',"typeReference.png",new String[] {"Waypoint|Reference Point","Reference Point","Reference Point",""},55,18,16,0x010000),
 		// error on waypoint
 		new CTyp(CW_TYPE_ERROR,CW_TYPE_ERROR,'E',"","","",(byte) -1,'-',"guiError.png",new String[] {"","","",""},49,-1,-1,0),
-        // mapped types (recognized on input from gpx or download-spider / or cw - version)                 
+        // mapped types (recognized on input from gpx or download-spider / or cw - version)
 		new CTyp(CW_TYPE_UNKNOWN,(byte) 1,'C',"","","1",(byte) -1,'U',"",new String[] {"Geocache|Other","Geocache","Other","Other"},21,-1,-1,0),
 		new CTyp(CW_TYPE_UNKNOWN,(byte) 7,'C',"7","","7",(byte) -121,'U',"",new String[] {"Geocache|Quiz","Geocache","Quiz","Quiz"},7,-1,-1,0),
 		new CTyp(CW_TYPE_UNKNOWN,(byte) 9,'C',"9","","9",(byte) -119,'U',"",new String[] {"Geocache|Moving","Geocache","Moving","Moving"},9,-1,-1,0),
 		new CTyp(CW_TYPE_TRADITIONAL,(byte) 10,'C',"10","","10",(byte) -118,'U',"",new String[] {"Geocache|DriveIn","Geocache","DriveIn","DriveIn"},10,-1,-1,0),
-		new CTyp(CW_TYPE_EVENT,(byte) 14,'C',"","3653","",(byte) -1,'X',"",new String[] {"Geocache|Lost and Found Event Cache","Geocache","Lost and Found Event Cache",""},6,-1,-1,0),		         
+		new CTyp(CW_TYPE_EVENT,(byte) 14,'C',"","3653","",(byte) -1,'X',"",new String[] {"Geocache|Lost and Found Event Cache","Geocache","Lost and Found Event Cache",""},6,-1,-1,0),
 		new CTyp(CW_TYPE_TRADITIONAL,(byte) 102,'C',"","9","",(byte) -1,'T',"",new String[] {"Geocache|Project APE Cache","Geocache","Project APE Cache","APE"},16,-1,-1,0),
 		new CTyp(CW_TYPE_EVENT,(byte) 103,'C',"","1304","",(byte) -1,'X',"",new String[] {"Geocache|GPS Adventures Exhibit","Geocache","GPS Adventures Exhibit","MAZE"},17,-1,-1,0),
 		new CTyp(CW_TYPE_UNKNOWN,(byte) 108,'C',"","","8",(byte) -1,'U',"",new String[] {"only on OC download","","",""},19,-1,-1,0),
@@ -179,12 +181,12 @@
 	   }
 	}
 	public static byte Ref_Index(final byte type) {
-		byte ret=Ref_Index[cTypRef[Ref_Index[type+1]]._cwMappedCType + 1];
+		final byte ret=Ref_Index[cTypRef[Ref_Index[type+1]]._cwMappedCType + 1];
 		return ret;
 	}
-	
-	
-	
+
+
+
 	/**
 	 * check if a given waypoint type is an additional waypoint
 	 * @param type waypoint type to check
@@ -209,8 +211,8 @@
 	public static boolean isCustomWpt(final byte type) {
 		return cTypRef[Ref_Index(type)]._cwCGroup == 'P';
 	}
-	
-	
+
+
 	// done for DetailsPanel.java and KML- and TomTom-Exporter
 	/**
 	 * create list of cache types to be shown in GUI drop down lists
@@ -225,7 +227,7 @@
 				j=cTypRef[i]._GUIOrder;
 			}
 		}
-		String[] ret = new String[j+1];
+		final String[] ret = new String[j+1];
 		for (int i = 0; i < cTypRef.length; i++) {
 			if (cTypRef[i]._GUIOrder > -1) {
 				ret[cTypRef[i]._GUIOrder]=MyLocale.getMsg(cTypRef[i]._msgNrCTypeName,"");
@@ -259,8 +261,8 @@
 		return cTypRef[Ref_Index(typeId)]._GUIOrder;
 	}
 
-	
-	
+
+
 	/**
 	 * convert the strings found in import of GPX from GC, OC or TC to internal cache type
 	 * @param gpxType type information found in GPX
@@ -273,14 +275,14 @@
 		for (byte i=0; i<cTypRef.length; i++) {
 			if (cTypRef[i]._gpxWptGCextensionTypTag.equalsIgnoreCase(gpxType)) {return cTypRef[i]._cwMappedCType;};
 		}
-		String lowerCaseGPXType = gpxType.toLowerCase();
+		final String lowerCaseGPXType = gpxType.toLowerCase();
 		for (byte i=0; i<cTypRef.length; i++) {
 			if (cTypRef[i]._gpxAlternativeWptTypTags.toLowerCase().indexOf(lowerCaseGPXType) != -1) {
 				return cTypRef[i]._cwMappedCType;
 			};
 		}
 		// TODO extend definition of _gpxAlternativeWptTypTags for all cases of Mystery
-		// old code was : if (!(gpxType.indexOf("Mystery")==-1)) return CW_TYPE_UNKNOWN; 
+		// old code was : if (!(gpxType.indexOf("Mystery")==-1)) return CW_TYPE_UNKNOWN;
 		return -1;
 	}
 
@@ -341,8 +343,8 @@
 		return -1;
 	}
 
-	
-	
+
+
 	/**
 	 * translate cache type to a short version for compact exporters or "smart" cache names.
 	 * @param typeId CacheWolf internal type information
@@ -407,13 +409,17 @@
 	public static Image getMapImage(final byte typeId) {
 		return cTypRef[Ref_Index(typeId)]._mapImage;
 	}
+
+	public static Image getFoundImage(final byte typeId) {
+		return cTypRef[Ref_Index(typeId)]._foundImage;
+	}
 	/**
 	 * select image to be displayed for a given cache type
 	 * @param typeId internal cache type id
 	 * @param Image object to be displayed
 	 */
 	public static void setTypeImage(final byte id, final Image iconImage) {
-		if (cTypRef[Ref_Index(id)]._iconImage != cTypRef[Ref_Index(id)]._mapImage) 
+		if (cTypRef[Ref_Index(id)]._iconImage != cTypRef[Ref_Index(id)]._mapImage)
 			cTypRef[Ref_Index(id)]._iconImage.free();
 		cTypRef[Ref_Index(id)]._iconImage=iconImage;
 	}
@@ -423,12 +429,15 @@
 	 * @param Image object to be displayed
 	 */
 	public static void setMapImage(final byte id, final Image mapImage) {
-		if (cTypRef[Ref_Index(id)]._iconImage != cTypRef[Ref_Index(id)]._mapImage) 
+		if (cTypRef[Ref_Index(id)]._iconImage != cTypRef[Ref_Index(id)]._mapImage)
 			cTypRef[Ref_Index(id)]._mapImage.free();
 		cTypRef[Ref_Index(id)]._mapImage=mapImage;
 	}
-	
-	
+	public static void setFoundImage(final byte id, final Image foundImage) {
+		cTypRef[Ref_Index(id)]._foundImage=foundImage;
+	}
+
+
 	// TODO do it better in Version 4
 	public static int getCacheTypePattern(final byte typeId) {
 		return cTypRef[Ref_Index(typeId)]._FilterPattern;
@@ -456,6 +465,6 @@
 		}
 		return (typeMatchPattern & TYPE_MAIN) != 0;
 	}
-	
+
 	// TODO it for OCXMLImporterScreen and FilterScreen ?
 }

Modified: trunk/src/CacheWolf/GuiImageBroker.java
===================================================================
--- trunk/src/CacheWolf/GuiImageBroker.java	2011-04-16 12:35:45 UTC (rev 2978)
+++ trunk/src/CacheWolf/GuiImageBroker.java	2011-04-16 14:53:27 UTC (rev 2979)
@@ -53,12 +53,17 @@
 		// Noting to do
 	}
 
-	public static Image getTypeImage(byte typeId,boolean map) {
+	public static Image getTypeImage(byte typeId,boolean map, boolean found) {
 		if (!map) {
 			return CacheType.getTypeImage(typeId);
 		}
 		else {
-			return CacheType.getMapImage(typeId);
+			if (found) {
+				return CacheType.getFoundImage(typeId);
+			}
+			else {
+				return CacheType.getMapImage(typeId);
+			}
 		}
 	}
 
@@ -78,6 +83,7 @@
 		if (dir.isDirectory()){
 			int id;
 			boolean size=false;
+			boolean found=false;
 			String name = "";
 			String [] pngFiles;
 			pngFiles=dir.list("*.png",0);
@@ -88,18 +94,29 @@
 					size=true;
 					name=name.substring(0,name.length()-4);
 				}
+				if (name.toLowerCase().endsWith("found")){
+					found=true;
+					name=name.substring(0,name.length()-5);
+				}
 				try {
 					id = Integer.parseInt(name);
 				}
-				catch (Exception E){
+				catch (final Exception E){
 					id = -1; //filename invalid for symbols
 				}
 				if (0<=id && id<=CacheType.maxCWCType){
-					String s=FileBase.getProgramDirectory()+sdir+pngFiles[i];
+					final String s=FileBase.getProgramDirectory()+sdir+pngFiles[i];
 					Global.getPref().log("own symbol: "+(i+1)+" = "+pngFiles[i]);
 					if (size){
-						CacheType.setMapImage((byte) id, new Image(s));
+						if (found) {
+							CacheType.setFoundImage((byte) id, new Image(s));
+						}
+						else {
+							CacheType.setMapImage((byte) id, new Image(s));
+						}
 						size=false;
+						found=false;
+
 					}
 					else{
 						CacheType.setTypeImage((byte) id, new Image(s));

Modified: trunk/src/CacheWolf/RadarPanel.java
===================================================================
--- trunk/src/CacheWolf/RadarPanel.java	2011-04-16 12:35:45 UTC (rev 2978)
+++ trunk/src/CacheWolf/RadarPanel.java	2011-04-16 14:53:27 UTC (rev 2979)
@@ -69,43 +69,43 @@
 	*/
 	public RadarPanel(){
 		this.addLast(iActP = new myInteractivePanel(), CellConstants.STRETCH, CellConstants.FILL);
-		CellPanel cp = new CellPanel();
+		final CellPanel cp = new CellPanel();
 		cp.addNext(btMinus,CellConstants.HSTRETCH, (CellConstants.FILL|CellConstants.WEST));
 		cp.addNext(btToggle,CellConstants.HSTRETCH, CellConstants.FILL);
 		cp.addLast(btPlus,CellConstants.HSTRETCH, (CellConstants.FILL|CellConstants.EAST));
 		this.addLast(cp, CellConstants.HSTRETCH, CellConstants.FILL);
 	}
-	
+
 	public void setMainTab(MainTab tb){
 		mt = tb;
 		iActP.setMainTab(tb);
 	}
-	
+
 	/**
 	* Informs the radar panel on preferences and currently loaded cache
-	* database. It also calculates the maximum size available for drawing 
+	* database. It also calculates the maximum size available for drawing
 	* the radar.
 	*/
 	public void setParam(Preferences p, CacheDB db, CacheHolder sWp){
 		selectedWaypoint = sWp;
 		pref = p;
 		cacheDB = db;
-		height = (pref.myAppHeight)*6/5; // add 10% each at top/bottom 
+		height = (pref.myAppHeight)*6/5; // add 10% each at top/bottom
 		width = (pref.myAppWidth)*6/5;
 	}
-	
+
 	// Call this after the centre has changed to re-center the radar panel
 	public void recenterRadar() {
 		reCenterImage=true;
 	}
-	
+
 	/**
 	* Public method to draw the different caches and the
 	* radar background
 	*/
 	public void drawThePanel(){
 		// If there are any images remove them!
-		int anz = iActP.images.size();
+		final int anz = iActP.images.size();
 		for(int i = 0; i<anz;i++){
 			iActP.removeImage((AniImage)iActP.images.get(0));
 		}
@@ -116,25 +116,25 @@
 		if (reCenterImage) {
 			// Hack to scroll to left origin for a defined position for subsequent
 			// scroll which centers the image
-			iActP.scroll(-1000,-1000); 
-			Dimension dispSize=getDisplayedSize(null);
+			iActP.scroll(-1000,-1000);
+			final Dimension dispSize=getDisplayedSize(null);
 			iActP.scroll((width-dispSize.width)/2,(height-dispSize.height+btMinus.getSize(null).height)/2);
 			reCenterImage=false;
 		}
 	}
-	
+
 	/**
 	* Private method to draw the caches.
 	*/
 	private void drawCaches(){
-		Font radarFont = new Font("Gui", Font.BOLD,Global.getPref().fontSize);
-		FontMetrics fm = getFontMetrics(radarFont);
+		final Font radarFont = new Font("Gui", Font.BOLD,Global.getPref().fontSize);
+		final FontMetrics fm = getFontMetrics(radarFont);
 		AniImage aImg;
 		RadarPanelImage rpi;
 		int drX,drY = 0;
 		CacheHolder holder;
 		double degrees;
-		double pi180=java.lang.Math.PI / 180.0;
+		final double pi180=java.lang.Math.PI / 180.0;
 		for(int i = cacheDB.size()-1; i >=0 ; i--){
 			holder = cacheDB.get(i);
 			if(holder.isVisible() && holder.pos.isValid()) {
@@ -148,10 +148,10 @@
 							s=holder.getWayPoint();
 						else
 							s=holder.getCacheName();
-						if (s.length()>0) { 
+						if (s.length()>0) {
 							int tw;
-							Image img = new Image(tw=fm.getTextWidth(s),fm.getHeight());
-							Graphics g = new Graphics(img);
+							final Image img = new Image(tw=fm.getTextWidth(s),fm.getHeight());
+							final Graphics g = new Graphics(img);
 							g.setFont(radarFont);
 							g.setColor(Color.Black);
 							g.fillRect(0,0,tw, fm.getHeight());
@@ -164,20 +164,20 @@
 							iActP.addImage(aImg);
 						}
 					}
-					Image imgCache=GuiImageBroker.getTypeImage(holder.getType(),true);
+					Image imgCache=GuiImageBroker.getTypeImage(holder.getType(),true, holder.is_found());
 					// If we have no image for the cache type use a question mark
-					if (imgCache==null) imgCache=GuiImageBroker.getTypeImage(CacheType.CW_TYPE_UNKNOWN,true); 
+					if (imgCache==null) imgCache=GuiImageBroker.getTypeImage(CacheType.CW_TYPE_UNKNOWN,true,false);
 					rpi = new RadarPanelImage(imgCache);
 					rpi.wayPoint = holder.getWayPoint();
 					rpi.rownum = i;
-					int dx = imgCache.getWidth();
-					int dy = imgCache.getHeight();
+					final int dx = imgCache.getWidth();
+					final int dy = imgCache.getHeight();
 					rpi.setLocation(centerX+drX-dx/2,centerY+drY-dy/2);
 					iActP.addImage(rpi);
 					if(holder == selectedWaypoint){ // Draw red circle around selected wpt
-						int diag = (int) (java.lang.Math.sqrt(dx*dx+dy*dy)+0.5);
-						Image imgCircle = new Image(diag, diag);
-						Graphics gCircle = new Graphics(imgCircle);
+						final int diag = (int) (java.lang.Math.sqrt(dx*dx+dy*dy)+0.5);
+						final Image imgCircle = new Image(diag, diag);
+						final Graphics gCircle = new Graphics(imgCircle);
 						gCircle.setColor(Color.Black);
 						gCircle.fillRect(0,0,diag,diag);
 						gCircle.setColor(new Color(255,0,0));
@@ -192,22 +192,22 @@
 			}// if is_black...
 		}
 	}
-	
+
 	/**
 	* Private method to draw the black background and green radar.
 	* Also calculates some other parameters.
 	* Always call this before calling drawCaches().
 	*/
 	private void drawBackground(){
-		Rect r = new Rect(new Dimension(width, height));
+		final Rect r = new Rect(new Dimension(width, height));
 		iActP.virtualSize = r;
 		iActP.refresh();
-		Image img = new Image(width, height);
-		Graphics g = new Graphics(img);
+		final Image img = new Image(width, height);
+		final Graphics g = new Graphics(img);
 		g.setColor(Color.Black);
 		g.fillRect(0,0,width, height);
-		
-		
+
+
 		if(width < height) {
 			scale = (double)scaleKm / (double)height;
 		} else {
@@ -218,7 +218,7 @@
 		//centerY = (int)(centerY-centerY*0.15);
 		g.setColor(new Color(0,255,0));
 		int radstep= 0, steps=0, radius = 0;
-		
+
 		if(width > height){
 			radstep = (int)(10 / scale);
 			steps = (width / radstep);
@@ -239,15 +239,15 @@
 			radius = radstep/5;
 			g.drawEllipse(centerX-radius/2,centerY-radius/2, radius,radius);
 			g.free();
-		}	
-		AniImage aImg = new AniImage(img);
+		}
+		final AniImage aImg = new AniImage(img);
 		//iActP.addImage(aImg);
 		iActP.backgroundImage = img;
-		int xPos = (pref.myAppWidth/2 - width/2);
+		final int xPos = (pref.myAppWidth/2 - width/2);
 		aImg.setLocation(xPos,0);
 		aImg.refresh();
 	}
-	
+
 	public void onEvent(Event ev){
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if (ev.target == btPlus){

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2011-04-16 12:35:45 UTC (rev 2978)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2011-04-16 14:53:27 UTC (rev 2979)
@@ -136,8 +136,8 @@
 	double lastDistance = -1;
 
 	// the layer for the buttons
-	private MovingMapControls controlsLayer;
-	
+	private final MovingMapControls controlsLayer;
+
 	float lastHighestResolutionGPSDestScale = -1;
 
 	public static final int tileWidth = 100;
@@ -158,7 +158,7 @@
 		pref.fillWhiteArea = fillWhiteArea;
 		if (!fillWhiteArea) { // remove tiles from panel
 			for (int i = mmp.images.size() -1; i >= 0; i--) {
-				AniImage im = (AniImage) mmp.images.get(i);
+				final AniImage im = (AniImage) mmp.images.get(i);
 				if ((im instanceof MapImage)
 						&& (!((im instanceof MapSymbol)
 								|| (im instanceof TrackOverlay) || mmp.mapImage == im))) {
@@ -177,16 +177,16 @@
 		}
 
 	}
-	
-	
+
+
 	public boolean isMobileVga() {
 		return mobileVGA;
 	}
-	
+
 	public InteractivePanel getMmp() {
 		return mmp;
 	}
-	
+
 	public MovingMapControls getControlsLayer() {
 		return controlsLayer;
 	}
@@ -209,12 +209,12 @@
 		mmp = new MovingMapPanel(this);
 		this.addLast(mmp);
 
-		if (Vm.isMobile() && MyLocale.getScreenWidth() >= 400) 
+		if (Vm.isMobile() && MyLocale.getScreenWidth() >= 400)
 			mobileVGA = true;
 		String imagesize="";
 		if(mobileVGA) imagesize="_vga";
 
-		
+
 		statusImageHaveSignal = new AniImage("position_green"+imagesize+".png");
 		statusImageNoSignal = new AniImage("position_yellow"+imagesize+".png");
 		statusImageNoGps = new AniImage("position_red"+imagesize+".png");
@@ -224,8 +224,8 @@
 		directionArrows.properties = mImage.AlwaysOnTop;
 		mmp.addImage(directionArrows);
 		//target distance
-		int fontSize = ( 3 * pref.fontSize ) / 2;
-		Font imageFont = new Font("Helvetica", Font.PLAIN, fontSize );
+		final int fontSize = ( 3 * pref.fontSize ) / 2;
+		final Font imageFont = new Font("Helvetica", Font.PLAIN, fontSize );
 		fm = getFontMetrics(imageFont);
 		setGpsStatus(noGPS);
 		posCircle.properties = mImage.AlwaysOnTop;
@@ -238,10 +238,10 @@
 		lastHighestResolutionGPSDestScale = -1;
 
 		lastRepaintMapPos = new Point(pref.myAppWidth +1, pref.myAppHeight +1);
-		
+
 		controlsLayer = new MovingMapControls(this);
-		
-		
+
+
 	}
 
 	public void resizeTo(int w,int h) {
@@ -274,12 +274,12 @@
 	public void loadMaps(String mapsPath, double lat){
 		if (loadingMapList) return;
 		loadingMapList = true;
-		InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
+		final InfoBox inf = new InfoBox(MyLocale.getMsg(4201, "Info"), MyLocale.getMsg(4203, "Loading list of maps..."));
 		Vm.showWait(this, true);
 		inf.exec();
 		inf.waitUntilPainted(100);
 		resetCenterOfMap();
-		boolean saveGpsIgnoreStatus = dontUpdatePos;
+		final boolean saveGpsIgnoreStatus = dontUpdatePos;
 		dontUpdatePos = true;
 		maps = new MapsList(mapsPath); // this actually loads the maps
 		if (maps.isEmpty()) {
@@ -301,7 +301,7 @@
 		{
 			double lineLengthMeters = 40 * currentMap.scale;
 
-			int metricSystem = pref.metricSystem;
+			final int metricSystem = pref.metricSystem;
 			double localizedLineLength = 0;
 			int bigUnit = -1;
 			int smallUnit = -1;
@@ -338,10 +338,10 @@
 			String lineLengthString = Convert.toString((int) localizedLineLength) + Metrics.getUnit(currentUnit);
 
 			if	(digits < 0){
-				Double tmp = new Double();
+				final Double tmp = new Double();
 				tmp.set(localizedLineLength);
 
-				int decimals = (int)(-1 * digits);
+				final int decimals = (int)(-1 * digits);
 
 				lineLengthString = tmp.toString(decimals+2,decimals,0) + Metrics.getUnit(currentUnit);
 //				lineLengthString = MyLocale.formatDouble(tmp,"0.000") + Metrics.getUnit(currentUnit);
@@ -349,7 +349,7 @@
 
 			lineLengthMeters = Metrics.convertUnit( localizedLineLength, currentUnit, Metrics.METER);
 
-			int lineLengthPixels = (int)java.lang.Math.round( lineLengthMeters / currentMap.scale );
+			final int lineLengthPixels = (int)java.lang.Math.round( lineLengthMeters / currentMap.scale );
 
 			controlsLayer.updateContent("scale", lineLengthString, lineLengthPixels);
 		}
@@ -362,14 +362,14 @@
 	public void updateDistance(boolean repaint) {
 		if (gotoPos != null && posCircle.where.isValid())
 		{
-			double currentDistance = gotoPos.where.getDistance(posCircle.where);
+			final double currentDistance = gotoPos.where.getDistance(posCircle.where);
 			if (currentDistance != lastDistance)
 			{
 				lastDistance = currentDistance;
-				ewe.sys.Double dd = new ewe.sys.Double();
+				final ewe.sys.Double dd = new ewe.sys.Double();
 				String d;
 
-				int metricSystem = pref.metricSystem;
+				final int metricSystem = pref.metricSystem;
 				double localizedDistance = 0;
 				int bigUnit = -1;
 				int smallUnit = -1;
@@ -411,18 +411,18 @@
 	}
 
 	public final FormFrame myExec(CWPoint centerTo, boolean forceCenter) {
-		FormFrame ret = exec();
+		final FormFrame ret = exec();
 		running = true;
 		// disconnect movingMap from GPS TODO only if GPS-pos is not on the screen
 		if (forceCenter) setGpsStatus(noGPS);
 		// to load maplist + place a map on screen otherwise no symbol can be placed
 		ignoreGps=true; // else overlay symbols are removed on started gps
-		
+
 		rebuildOverlaySet(); // show tracks , even if reentering map
-		
+
 		updatePosition(centerTo);
 		setCenterOfScreen(centerTo, false);
-		
+
 		if (getControlsLayer()!=null) {
 			getControlsLayer().changeRoleState(MovingMapControls.ROLE_MENU, false);
 		}
@@ -435,7 +435,7 @@
 		}
 		setMarkedCache(Global.mainTab.ch); // this is the selected one (not necessary marked)
 		showCachesOnMap();
-		
+
 		if (myNavigation.destinationIsCache) {
 			destChanged(myNavigation.destinationCache);
 		}
@@ -445,7 +445,7 @@
 
 		repaint();
 		ignoreGps=false;
-		
+
 		return ret;
 	}
 
@@ -458,7 +458,7 @@
 		if (ch != null) {
 			if ( ch.pos.isValid()) {
 				addSymbol("selectedCache", MARK_CACHE_IMAGE, ch.pos);
-				addSymbolIfNecessary(ch.getCacheName(), ch, GuiImageBroker.getTypeImage(ch.getType(),true), ch.pos);
+				addSymbolIfNecessary(ch.getCacheName(), ch, GuiImageBroker.getTypeImage(ch.getType(),true,ch.is_found()), ch.pos);
 				markedCache = ch;
 			}
 		}
@@ -491,10 +491,10 @@
 		try {
 			TrackOverlaySetCenterTopLeft = ScreenXY2LatLon(100, 100);
 			addMissingOverlays();
-		} catch (NullPointerException e) {
+		} catch (final NullPointerException e) {
 			// hapens if currentmap == null or PosCircle not valid
 		}
-		catch (IllegalArgumentException e) {
+		catch (final IllegalArgumentException e) {
 			// happens if screensize is still not known    ---> in both cases creation of Overlayset will be done in updateOverlayPos if tracks != null
 		}
 	}
@@ -518,9 +518,9 @@
 			TrackOverlays = new TrackOverlay[9];
 			TrackOverlaySetCenterTopLeft = ScreenXY2LatLon(100, 100);
 		}
-		boolean saveGPSIgnoreStatus = dontUpdatePos; // avoid multi-threading problems
+		final boolean saveGPSIgnoreStatus = dontUpdatePos; // avoid multi-threading problems
 		dontUpdatePos = true;
-		Point upperleftOf4 = getXYonScreen(TrackOverlaySetCenterTopLeft); // TrackOverlay[4] == center of Trackoverlays
+		final Point upperleftOf4 = getXYonScreen(TrackOverlaySetCenterTopLeft); // TrackOverlay[4] == center of Trackoverlays
 		//upperleftOf4.x = (upperleftOf4.x + 1* width) % (width * 2) - 1 * width;
 		//upperleftOf4.y = (upperleftOf4.y + 1* height) % (height * 2) - 1 * height;
 		int i;
@@ -549,7 +549,7 @@
 		TrackOverlays[ov]=null;
 	}
 	public void rearangeOverlays() {
-		Point oldp = getXYonScreen(TrackOverlaySetCenterTopLeft);
+		final Point oldp = getXYonScreen(TrackOverlaySetCenterTopLeft);
 		if (TrackOverlays[1].isOnScreen()) { // oben raus
 			TrackOverlaySetCenterTopLeft.set(ScreenXY2LatLon(oldp.x, oldp.y - 2* height));
 			destroyOverlay(6);
@@ -714,9 +714,9 @@
 		//	Point upperleft = getMapXYPosition();
 		Point posOnScreen;
 		posOnScreen = getXYonScreen(TrackOverlays[4].topLeft);
-		Dimension ws = mmp.getSize(null);
-		int ww = ws.width;
-		int wh = ws.height;
+		final Dimension ws = mmp.getSize(null);
+		final int ww = ws.width;
+		final int wh = ws.height;
 		//Vm.sleep(100); // this is necessary because the ewe vm ist not multi-threaded and the serial thread also needs time
 		int num, pX, pY;
 		for (int yi=0; yi<3; yi++) {
@@ -768,8 +768,8 @@
 	}
 
 	public void moveScreenXYtoLatLon(Point s, CWPoint c, boolean repaint) {
-		Point mappos = getMapPositionOnScreen();
-		Point onscreenpos = getXYonScreen(c);
+		final Point mappos = getMapPositionOnScreen();
+		final Point onscreenpos = getXYonScreen(c);
 		if (mmp != null && mmp.mapImage != null) mmp.mapImage.move(mappos.x - onscreenpos.x + s.x, mappos.y - onscreenpos.y + s.y);
 		mapMoved(s.x - onscreenpos.x, s.y - onscreenpos.y);
 		if (repaint) mmp.repaintNow();
@@ -781,10 +781,10 @@
 	 * @param diffY
 	 */
 	public void mapMoved(int diffX, int diffY) {
-		int w = posCircle.getWidth();
-		int h = posCircle.getHeight();
-		int npx = posCircleX-w/2+diffX;
-		int npy = posCircleY-h/2+diffY;
+		final int w = posCircle.getWidth();
+		final int h = posCircle.getHeight();
+		final int npx = posCircleX-w/2+diffX;
+		final int npy = posCircleY-h/2+diffY;
 		posCircle.move(npx, npy);
 		posCircleX = posCircleX+diffX;
 		posCircleY = posCircleY+diffY;
@@ -808,10 +808,10 @@
 		if (currentMap == null || !posCircle.where.isValid())
 			return new Point(pref.myAppWidth +1, pref.myAppHeight +1);
 		// in case no calculation is possible return somthing outside of the screen
-		Point mapPos = new Point();
+		final Point mapPos = new Point();
 		//if (mmp.mapImage != null) mmp.mapImage.getLocation(mapPos);
 		//else {
-		Point mapposint = currentMap.calcMapXY(posCircle.where);
+		final Point mapposint = currentMap.calcMapXY(posCircle.where);
 		mapPos.x = posCircleX - mapposint.x;
 		mapPos.y = posCircleY - mapposint.y;
 		//}
@@ -826,13 +826,13 @@
 	 */
 	public Point getXYonScreen(TrackPoint ll){
 		if (currentMap == null) return null;
-		Point coords = currentMap.calcMapXY(ll);
-		Point mapPos = getMapPositionOnScreen();
+		final Point coords = currentMap.calcMapXY(ll);
+		final Point mapPos = getMapPositionOnScreen();
 		return new Point(coords.x + mapPos.x, coords.y + mapPos.y);
 	}
 
 	public CWPoint ScreenXY2LatLon (int px, int py){
-		Point mapPos = getMapPositionOnScreen();
+		final Point mapPos = getMapPositionOnScreen();
 		return currentMap.calcLatLon(px - mapPos.x, py - mapPos.y);
 	}
 
@@ -854,10 +854,10 @@
 
 	public MapSymbol addSymbol(String pName, String filename, CWPoint where) {
 		if (symbols==null) symbols=new Vector();
-		MapSymbol ms = new MapSymbol(pName, filename, where);
+		final MapSymbol ms = new MapSymbol(pName, filename, where);
 		ms.loadImage();
 		ms.properties |= mImage.AlwaysOnTop;
-		Point pOnScreen = getXYonScreen(where);
+		final Point pOnScreen = getXYonScreen(where);
 		ms.setLocation(pOnScreen.x-ms.getWidth()/2, pOnScreen.y-ms.getHeight()/2);
 		symbols.add(ms);
 		mmp.addImage(ms);
@@ -866,10 +866,10 @@
 
 	public MapSymbol addSymbol(String pName, Object mapObject, String filename, CWPoint where) {
 		if (symbols==null) symbols=new Vector();
-		MapSymbol ms = new MapSymbol(pName, mapObject, filename, where);
+		final MapSymbol ms = new MapSymbol(pName, mapObject, filename, where);
 		ms.loadImage();
 		ms.properties |= mImage.AlwaysOnTop;
-		Point pOnScreen = getXYonScreen(where);
+		final Point pOnScreen = getXYonScreen(where);
 		ms.setLocation(pOnScreen.x-ms.getWidth()/2, pOnScreen.y-ms.getHeight()/2);
 		symbols.add(ms);
 		mmp.addImage(ms);
@@ -888,9 +888,9 @@
 
 	public void addSymbol(String pName, Object mapObject, Image imSymb, CWPoint ll) {
 		if (symbols==null) symbols=new Vector();
-		MapSymbol ms = new MapSymbol(pName, mapObject, imSymb, ll);
+		final MapSymbol ms = new MapSymbol(pName, mapObject, imSymb, ll);
 		ms.properties = mImage.AlwaysOnTop;
-		Point pOnScreen = getXYonScreen(ll);
+		final Point pOnScreen = getXYonScreen(ll);
 		if (pOnScreen != null) ms.setLocation(pOnScreen.x-ms.getWidth()/2, pOnScreen.y-ms.getHeight()/2);
 		symbols.add(ms);
 		mmp.addImage(ms);
@@ -902,20 +902,22 @@
 		removeMapSymbol("goto");
 		if (d == null || !d.isValid() ) return;
 		gotoPos = addSymbol("goto", "goto_map.png", d);
-		//updateDistance(); - this is called from updatePosition
 		forceMapLoad = true;
-		if (this.width != 0) updatePosition(posCircle.where); // dirty hack: if this.width == 0, then the symbols are not on the screen and get hidden by updateSymbolPositions
+		// dirty hack: if this.width == 0, then the symbols are not on the screen
+		// and get hidden by updateSymbolPositions
+		if (this.width != 0) updatePosition(posCircle.where);
 	}
 
 	public void destChanged(CacheHolder ch) {
-		CWPoint d = new CWPoint (ch.pos);
+		final CWPoint d = new CWPoint (ch.pos);
 		if(!running || (gotoPos != null && gotoPos.where.equals(d))) return;
 		removeMapSymbol("goto");
 		if (!d.isValid() ) return;
 		gotoPos = addSymbol("goto", ch, "goto_map.png", d);
-		//updateDistance(); - this is called from updatePosition
 		forceMapLoad = true;
-		if (this.width != 0) updatePosition(posCircle.where); // dirty hack: if this.width == 0, then the symbols are not on the screen and get hidden by updateSymbolPositions
+		// dirty hack: if this.width == 0, then the symbols are not on the screen
+		// and get hidden by updateSymbolPositions
+		if (this.width != 0) updatePosition(posCircle.where);
 	}
 
 	public CWPoint getGotoPos(){
@@ -932,12 +934,12 @@
 	}
 
 	public void removeMapSymbol(String pName) {
-		int symbNr = findMapSymbol(pName);
+		final int symbNr = findMapSymbol(pName);
 		if (symbNr != -1) removeMapSymbol(symbNr);
 	}
 
 	public void removeMapSymbol(Object obj) {
-		int symbNr = findMapSymbol(obj);
+		final int symbNr = findMapSymbol(obj);
 		if (symbNr != -1) removeMapSymbol(symbNr);
 	}
 
@@ -973,7 +975,7 @@
 	 */
 	public void updateOnlyPosition(CWPoint where, boolean updateOverlay){
 		posCircle.where.set(where);
-		Point mapPos = getMapPositionOnScreen();
+		final Point mapPos = getMapPositionOnScreen();
 		if (forceMapLoad || (java.lang.Math.abs(lastRepaintMapPos.x - mapPos.x) > 1 || java.lang.Math.abs(lastRepaintMapPos.y - mapPos.y) > 1))
 		{
 			lastRepaintMapPos = mapPos;
@@ -1006,8 +1008,8 @@
 		loadBestMap(where);
 		if (width==0 || height==0) { pref.log("[MovingMap:updatePosition]no window shown"); return; } // why is this called with these values
 		updateOnlyPosition(where, true);
-		Point mapPos = getMapPositionOnScreen();
-		boolean screenNotCompletlyCovered = (mmp.mapImage == null)
+		final Point mapPos = getMapPositionOnScreen();
+		final boolean screenNotCompletlyCovered = (mmp.mapImage == null)
 				|| (mmp.mapImage != null && (
 				   mapPos.y > 0                                      || mapPos.x                           > 0
 				|| mapPos.y + mmp.mapImage.getHeight() < this.height || mapPos.x + mmp.mapImage.getWidth() < this.width));
@@ -1027,17 +1029,17 @@
 				lastCompareY = mapPos.y;
 			}
 			else{
-				int deltaX = mapPos.x - lastXPos;
-				int deltaY = mapPos.y - lastYPos;
+				final int deltaX = mapPos.x - lastXPos;
+				final int deltaY = mapPos.y - lastYPos;
 				for(int i = mmp.images.size() -1; i >= 0; i--){
-					AniImage im = (AniImage) mmp.images.get(i);
+					final AniImage im = (AniImage) mmp.images.get(i);
 					if ((im instanceof MapImage)
 						&& (!((im instanceof MapSymbol)
 							|| (im instanceof TrackOverlay)
 							|| mmp.mapImage == im))) {
 						//locAlways contains the real coordinates while
 						//location is only correct if the image is on the screen.
-						Point p = ((MapImage)im).locAlways;
+						final Point p = ((MapImage)im).locAlways;
 						p.x += deltaX;
 						p.y += deltaY;
 						im.setLocation(p.x, p.y);
@@ -1055,18 +1057,18 @@
 	private void showCachesOnMap() {
 		// if (width == 0 || height == 0) return;
 		CacheHolder ch;
-		Area screenArea = new Area(ScreenXY2LatLon(0,0), ScreenXY2LatLon(width,height));
+		final Area screenArea = new Area(ScreenXY2LatLon(0,0), ScreenXY2LatLon(width,height));
 		for (int i = cacheDB.size() - 1; i >= 0; i--) {
 			ch = cacheDB.get(i);
 			if (screenArea.isInBound(ch.pos)) {
 				// because visible and valid don't change while showing map -->need no remove
 				if (ch.isVisible() && ch.pos.isValid()) {
 					if (pref.showCachesOnMap) {
-						addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType(),true), ch.pos);
+						addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType(),true,ch.is_found()), ch.pos);
 					}
 					else {
 						if (ch.is_Checked) {
-							addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType(),true), ch.pos);
+							addSymbolIfNecessary(ch.cacheName, ch, GuiImageBroker.getTypeImage(ch.getType(),true,ch.is_found()), ch.pos);
 						}
 						else {
 							removeMapSymbol(ch);
@@ -1096,7 +1098,7 @@
 			if (gotoPosCH != null) {
 				if (screenArea.isInBound(gotoPosCH.pos)) {
 					if (!pref.showCachesOnMap) {
-						addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType(),true), gotoPosCH.pos);
+						addSymbolIfNecessary(gotoPosCH.cacheName, gotoPosCH, GuiImageBroker.getTypeImage(gotoPosCH.getType(),true,gotoPosCH.is_found()), gotoPosCH.pos);
 					}
 					addSymbolOnTop("goto", gotoPosCH, "goto_map.png", gotoPos.where);
 				}
@@ -1105,7 +1107,7 @@
 		// show Selected
 		if (markedCache != null) {
 			if (screenArea.isInBound(markedCache.pos)) {
-				addSymbolIfNecessary(markedCache.cacheName, markedCache, GuiImageBroker.getTypeImage(markedCache.getType(),true), markedCache.pos);
+				addSymbolIfNecessary(markedCache.cacheName, markedCache, GuiImageBroker.getTypeImage(markedCache.getType(),true, false), markedCache.pos);
 				addSymbolOnTop("selectedCache", markedCache, MARK_CACHE_IMAGE, markedCache.pos);
 			}
 		}
@@ -1115,14 +1117,14 @@
 		if (mmp.mapImage == null) return; // if error at map load
 		// Clean up any additional images, tiles will removed and any
 		// other item be added again later
-		Vector icons = new Vector(mmp.images.size());
-		try {			
+		final Vector icons = new Vector(mmp.images.size());
+		try {
 		Vm.showWait(true);
 		dontUpdatePos=true; // no new Position while filling
-		
-		int s = mmp.images.size(); // avoid calling size() in each iteration
+
+		final int s = mmp.images.size(); // avoid calling size() in each iteration
 		for (int i = 0; i < s ;  i++) {
-			AniImage im = (AniImage) mmp.images.get(i);
+			final AniImage im = (AniImage) mmp.images.get(i);
 			if (!(im instanceof MapImage) ||
 				(im instanceof MapSymbol) ||
 				(im instanceof TrackOverlay) ||
@@ -1135,16 +1137,16 @@
 		MovingMapCache.getCache().clearUsedFlags();
 
 		// Holds areas not filled by currentmap and/or used tiles
-		Vector rectangles = new Vector();
+		final Vector rectangles = new Vector();
 		// calculate areas which will not drawn
-		Point mapPosx = getMapPositionOnScreen();
+		final Point mapPosx = getMapPositionOnScreen();
 		if ( screenNotCompletlyCovered && ( // screen not completely covered is only used, because it is already calculated
 				mapPosx.x > this.width || mapPosx.y > this.height // map doesn't overlap with the screen
 				|| mapPosx.x + mmp.mapImage.getWidth() < 0 || mapPosx.y + mmp.mapImage.getHeight() < 0) ) {
 			rectangles.add(new Rect(0,0, this.width, this.height)); // if the map is completely outside the screen, just fill the screen, nit all the space beteween the map and the screen
 		} else {
-			Rect whiteArea = new Rect((int)(-width/10), (int)(-height/10), (int)(width*1.1), (int)(height*1.1));
-			Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
+			final Rect whiteArea = new Rect((-width/10), (-height/10), (int)(width*1.1), (int)(height*1.1));
+			final Rect blackArea = new Rect(mapPosx.x, mapPosx.y, mmp.mapImage.getWidth(), mmp.mapImage.getHeight());
 			calculateRectangles(blackArea, whiteArea, rectangles);
 		}
 		// I've sometimes experienced an endless loop which might be
@@ -1157,7 +1159,7 @@
 			try {
 				updateTileForWhiteArea(rectangles);
 			}
-			catch (ewe.sys.SystemResourceException sre) {
+			catch (final ewe.sys.SystemResourceException sre) {
 				// next time there may be no problem, and ask only once
 				if (reflectResourceException) {
 					if (new MessageBox(
@@ -1168,34 +1170,34 @@
 						reflectResourceException=true;
 					}
 					else {
-						reflectResourceException=false;						
+						reflectResourceException=false;
 					}
 				}
 			}
 		}
-		} 
+		}
 		finally {
 			// Remove all tiles not needed from the cache to reduce memory
 			MovingMapCache.getCache().cleanCache();
 			// At Last redraw all icons on the map
 			mmp.images.addAll(icons);
-			Vm.showWait(false);		
-			dontUpdatePos=false; // do next Position 
+			Vm.showWait(false);
+			dontUpdatePos=false; // do next Position
 			repaint();
-		} 
+		}
 	}
 	private void updateTileForWhiteArea(Vector rectangles) {
 		Rect blackArea;
-		Rect r = (Rect) rectangles.get(0);
+		final Rect r = (Rect) rectangles.get(0);
 		rectangles.removeElementAt(0);
 		//calculate the center of the rectangle and try to get an map for it
-		int middlewidth = r.x + (r.width)/2;
-		int middleheight = r.y + (r.height)/2;
-		CWPoint centerPoint = ScreenXY2LatLon(middlewidth, middleheight);
-		Rect screen = new Rect ();
+		final int middlewidth = r.x + (r.width)/2;
+		final int middleheight = r.y + (r.height)/2;
+		final CWPoint centerPoint = ScreenXY2LatLon(middlewidth, middleheight);
+		final Rect screen = new Rect ();
 		screen.height = r.height ;//- r.y;
 		screen.width = r.width ;//- r.x;
-		MapInfoObject bestMap = maps.getBestMap(centerPoint, screen, currentMap.scale, true,false);
+		final MapInfoObject bestMap = maps.getBestMap(centerPoint, screen, currentMap.scale, true,false);
 		if (bestMap == null){
 			//No map found, area must be left white
 			return;
@@ -1209,21 +1211,21 @@
 		}
 		//Pfeffer got an NPE in the following if-statement. I think the image-filename has got not the correct extension.
 		//For me, showing a message seems better than throwing the NPE
-		String imagefilename = bestMap.getImageFilename();
+		final String imagefilename = bestMap.getImageFilename();
 		if (imagefilename == null){
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4217, "Could not find image associated with: \n")+currentMap.fileNameWFL, FormBase.OKB)).execute();
 			return;
 		}
 
 		if (!imagefilename.equals(currentMap.getImageFilename())) {
-			String filename = bestMap.getImageFilename();
+			final String filename = bestMap.getImageFilename();
 			if (filename.length() > 0) {
 				//calculate position of the new map on the screen
-				Point mapPos = new Point();
-				Point mapposint = bestMap.calcMapXY(posCircle.where);
+				final Point mapPos = new Point();
+				final Point mapposint = bestMap.calcMapXY(posCircle.where);
 				mapPos.x = posCircleX - mapposint.x;
 				mapPos.y = posCircleY - mapposint.y;
-				Point mapDimension = bestMap.calcMapXY(bestMap.bottomright);
+				final Point mapDimension = bestMap.calcMapXY(bestMap.bottomright);
 				blackArea = new Rect (mapPos.x, mapPos.y, mapDimension.x, mapDimension.y);
 				//Are there any white areas left?
 				calculateRectangles(blackArea, r, rectangles);
@@ -1243,8 +1245,8 @@
 	private void generateTiles(Rect blackArea, String filename, Point mapPos,
 			Dimension rect2, MapImage fullImage) {
 		//Generate tiles from the map
-		int numRows = ((rect2.height-1)/tileHeight)+1;
-		int numCols = ((rect2.width-1)/tileWidth)+1;
+		final int numRows = ((rect2.height-1)/tileHeight)+1;
+		final int numCols = ((rect2.width-1)/tileWidth)+1;
 		for (int row = 0; row < numRows; row++) {
 			for (int column = 0; column < numCols; column++) {
 				//Tile is not needed, don't process
@@ -1265,7 +1267,7 @@
 					//Check if not already added. this might happen if the map for horizontal and vertical stripe is the same
 					boolean added=false;
 					for(int i=mmp.images.size()-1; i >= 0; i--) {
-						MapImage m=(MapImage) mmp.images.get(i);
+						final MapImage m=(MapImage) mmp.images.get(i);
 						if (m == im){
 							added=true;
 							break;
@@ -1282,17 +1284,17 @@
 
 	private void putImageIntoCache(String filename, MapImage fullImage, Point mapPos, Rect blackArea) {
 		MapImage im;
-		int numRows = (fullImage.getHeight()-1)/tileHeight + 1;
-		int numCols = (fullImage.getWidth()-1)/tileWidth + 1;
+		final int numRows = (fullImage.getHeight()-1)/tileHeight + 1;
+		final int numCols = (fullImage.getWidth()-1)/tileWidth + 1;
 		for (int row2 = 0; row2 < numRows; row2++) {
 			for (int column2 = 0; column2 < numCols; column2++) {
-				int realWidth = java.lang.Math.min(tileWidth, (fullImage.getWidth() - tileWidth*column2));
-				int realHeight = java.lang.Math.min(tileHeight, (fullImage.getHeight() - tileHeight*row2));
+				final int realWidth = java.lang.Math.min(tileWidth, (fullImage.getWidth() - tileWidth*column2));
+				final int realHeight = java.lang.Math.min(tileHeight, (fullImage.getHeight() - tileHeight*row2));
 				if (!isCoveredByBlackArea(mapPos, row2, column2, blackArea, new Dimension(fullImage.getWidth(), fullImage.getHeight()))){
 					continue;
 				}
-				Image image2 = new Image(realWidth, realHeight);
-				int[] pixels = new int[realWidth * realHeight];
+				final Image image2 = new Image(realWidth, realHeight);
+				final int[] pixels = new int[realWidth * realHeight];
 				fullImage.getPixels(pixels, 0, tileWidth * column2, tileHeight * row2, realWidth, realHeight, 0);
 				image2.setPixels(pixels, 0, 0, 0, realWidth, realHeight, 0);
 				im = new MapImage();
@@ -1304,12 +1306,12 @@
 	}
 
 	private boolean isCoveredByBlackArea (Point mapPos, int row,int column,Rect blackArea, Dimension mapDimension){
-		int realWidth = java.lang.Math.min(tileWidth, (mapDimension.width - tileWidth*column));
-		int realHeight = java.lang.Math.min(tileHeight, (mapDimension.height - tileHeight*row));
-		int left = mapPos.x + column * tileWidth;
-		int right = left + realWidth;
-		int top = mapPos.y + row * tileHeight;
-		int bottom = top +realHeight;
+		final int realWidth = java.lang.Math.min(tileWidth, (mapDimension.width - tileWidth*column));
+		final int realHeight = java.lang.Math.min(tileHeight, (mapDimension.height - tileHeight*row));
+		final int left = mapPos.x + column * tileWidth;
+		final int right = left + realWidth;
+		final int top = mapPos.y + row * tileHeight;
+		final int bottom = top +realHeight;
 		if (right < blackArea.x || bottom < blackArea.y){
 			return false;
 		}
@@ -1328,10 +1330,10 @@
 	*/
 	private void calculateRectangles(Rect blackArea, Rect whiteArea, Vector rectangles) {
 		if (width == 0 || height == 0) return;
-		int offsetX = width/10;
-		int offsetY = height/10;
-		int width=this.width+offsetX;
-		int height=this.height+offsetY;
+		final int offsetX = width/10;
+		final int offsetY = height/10;
+		final int width=this.width+offsetX;
+		final int height=this.height+offsetY;
 		if (whiteArea.x >= width || whiteArea.y >= height) return;
 
 		if (blackArea.x < -offsetX){
@@ -1350,7 +1352,7 @@
 		}
 
 		if (blackArea.x > whiteArea.x) {
-			Rect r= new Rect ();
+			final Rect r= new Rect ();
 			r.x = -offsetX;
 			r.y = whiteArea.y;
 			r.width = blackArea.x + offsetX;
@@ -1358,7 +1360,7 @@
 			rectangles.add(r);
 		}
 		if (blackArea.y > whiteArea.y) {
-			Rect r= new Rect ();
+			final Rect r= new Rect ();
 			r.x = whiteArea.x;
 			r.y = -offsetY;
 			r.width = whiteArea.width;
@@ -1366,7 +1368,7 @@
 			rectangles.add(r);
 		}
 		if ((blackArea.y + blackArea.height) <  whiteArea.y + whiteArea.height) {
-			Rect r= new Rect ();
+			final Rect r= new Rect ();
 			r.x = whiteArea.x;
 			r.y = blackArea.y + blackArea.height;
 			r.width = whiteArea.width;
@@ -1374,7 +1376,7 @@
 			rectangles.add(r);
 		}
 		if ((blackArea.x + blackArea.width)<  whiteArea.x + whiteArea.width) {
-			Rect r= new Rect ();
+			final Rect r= new Rect ();
 			r.x = blackArea.x + blackArea.width;
 			r.y = whiteArea.y;
 			r.width = (whiteArea.x + whiteArea.width) - r.x;
@@ -1385,7 +1387,7 @@
 
 	public void updateGps(int fix) {
 		if (!running || ignoreGps) return;
-		// runMovingMap neccessary in case of multi-threaded Java-VM: 
+		// runMovingMap neccessary in case of multi-threaded Java-VM:
 		// ticked could be called during load of mmp
 		if ((fix > 0) && (myNavigation.gpsPos.getSats()>= 0)) { // TODO is getSats really necessary?
 			directionArrows.setDirections((float)myNavigation.gpsPos.getBearing(myNavigation.destination),
@@ -1435,10 +1437,10 @@
 	public void setBestMap(CWPoint where, boolean loadIfSameScale) {
 		if (inBestMap) return;
 		inBestMap = true;
-		Object [] s = getRectForMapChange(where);
-		CWPoint cll = (CWPoint) s[0];
-		Rect screen = (Rect) s[1];
-		boolean posCircleOnScreen = ((Boolean) s[2]).booleanValue();
+		final Object [] s = getRectForMapChange(where);
+		final CWPoint cll = (CWPoint) s[0];
+		final Rect screen = (Rect) s[1];
+		final boolean posCircleOnScreen = ((Boolean) s[2]).booleanValue();
 		MapInfoObject newmap = null;
 		wantMapTest = true;
 		switch (mapChangeModus) {
@@ -1491,7 +1493,7 @@
 			posCircle.where.set(cll); // choosemap calls setmap with posCircle-coos
 			try {
 				setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), where); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
-			} catch (IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4209, "setBestMap: problem in: setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), lat, lon) lat/lon:") + where.toString(), FormBase.OKB)).exec(); }
+			} catch (final IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4209, "setBestMap: problem in: setMap( ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(), lat, lon) lat/lon:") + where.toString(), FormBase.OKB)).exec(); }
 			while (currentMap == null) { // this actually cannot happen, but maybe in case of an inconstistent code change (esp. regarding empty maps)
 				mmp.chooseMap(); // force the user to select a scale
 				 if (currentMap == null) (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4210, "Moving map cannot run without a map - please select one. \n You can select an empty map"), FormBase.OKB)).execute();
@@ -1520,8 +1522,8 @@
 	 * @return
 	 */
 	public Object[] getRectForMapChange(CWPoint ll) {
-		int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
-		int h = (height != 0 ? height : pref.myAppHeight);
+		final int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
+		final int h = (height != 0 ? height : pref.myAppHeight);
 		int pX, pY;
 		CWPoint cll;
 		Boolean posCircleOnScreen = java.lang.Boolean.FALSE;
@@ -1535,7 +1537,7 @@
 			pX = w/2;
 			pY = h/2;
 		}
-		Object[] ret = new Object[3];
+		final Object[] ret = new Object[3];
 		ret[0] = cll;
 		ret[1] = new Rect(pX, pY, w, h);
 		ret[2] = posCircleOnScreen;
@@ -1548,9 +1550,9 @@
 	 * @return
 	 */
 	public void loadMoreDetailedMap(boolean betterOverview){
-		int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
-		int h = (height != 0 ? height : pref.myAppHeight);
-		Rect screen = new Rect(w/2, h/2, w, h);
+		final int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
+		final int h = (height != 0 ? height : pref.myAppHeight);
+		final Rect screen = new Rect(w/2, h/2, w, h);
 
 		CWPoint cll;
 		if (currentMap != null) {
@@ -1559,9 +1561,9 @@
 			cll = new CWPoint(posCircle.where);
 		}
 
-		MapInfoObject m = maps.getMapChangeResolution(cll, screen, currentMap.scale * currentMap.zoomFactor, !betterOverview);
+		final MapInfoObject m = maps.getMapChangeResolution(cll, screen, currentMap.scale * currentMap.zoomFactor, !betterOverview);
 		if (m != null) {
-			boolean saveGpsIgnStatus = dontUpdatePos;
+			final boolean saveGpsIgnStatus = dontUpdatePos;
 			dontUpdatePos = true;
 			setMap(m, cll);
 			setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
@@ -1577,31 +1579,31 @@
 	}
 
 	public void loadMapForAllCaches(){
-		Area sur = Global.getProfile().getSourroundingArea(true);
+		final Area sur = Global.getProfile().getSourroundingArea(true);
 		if (sur == null) {
 			(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4215, "Keine  Caches mit H???ckchen ausgew???hlt"), FormBase.OKB)).execute();
 			return;
 		}
 		MapInfoObject newmap = maps.getMapForArea(sur.topleft, sur.bottomright);
 		if (newmap == null ) { // no map that includs all caches is available -> load map with lowest resolution
-			Object [] s = getRectForMapChange(posCircle.where);
-			CWPoint cll = (CWPoint) s[0];
-			Rect screen = (Rect) s[1];
+			final Object [] s = getRectForMapChange(posCircle.where);
+			final CWPoint cll = (CWPoint) s[0];
+			final Rect screen = (Rect) s[1];
 			newmap = maps.getBestMap(cll, screen, Float.MAX_VALUE -1, false,true);
 		}
 		if (newmap == null) { // no map is covering any area of the caches -> zoom an empty map to cover all caches on screen
 			try {
-				Object [] s = getRectForMapChange(posCircle.where);
+				final Object [] s = getRectForMapChange(posCircle.where);
 			//	CWPoint cll = (CWPoint) s[0];
-				Rect screen = (Rect) s[1];
-				float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.bottomright.lonDec) * 1000 / (screen.width-15)); // 15 for the size of the cache image
-				float neededscaley = (float) (sur.topleft.getDistance(sur.bottomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height-15)); // 15 for the size of the cache image
+				final Rect screen = (Rect) s[1];
+				final float neededscalex = (float) (sur.topleft.getDistance(sur.topleft.latDec, sur.bottomright.lonDec) * 1000 / (screen.width-15)); // 15 for the size of the cache image
+				final float neededscaley = (float) (sur.topleft.getDistance(sur.bottomright.latDec, sur.topleft.lonDec) * 1000 / (screen.height-15)); // 15 for the size of the cache image
 				newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap(); // beware: "-4" only works if the empty maps were added last see MapsList.addEmptyMaps
 				newmap.zoom(newmap.scale * newmap.zoomFactor / (neededscalex > neededscaley ? neededscalex : neededscaley), 0, 0);
 				forceMapLoad = true;
-			} catch (IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4279, "loadMapForAllCaches: IO-Exception in: newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap();"), FormBase.OKB)).exec(); }
+			} catch (final IOException e) { (new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4279, "loadMapForAllCaches: IO-Exception in: newmap = ((MapListEntry)maps.elementAt(maps.getCount() - 4)).getMap();"), FormBase.OKB)).exec(); }
 		}
-		boolean saveGpsIgnStatus = dontUpdatePos;
+		final boolean saveGpsIgnStatus = dontUpdatePos;
 		dontUpdatePos = true;
 		setMap(newmap, posCircle.where);
 		setResModus(MovingMap.NORMAL_KEEP_RESOLUTION);
@@ -1647,7 +1649,7 @@
 			updateOnlyPosition(where, true);
 			return;
 		}
-		try {			
+		try {
 			Vm.showWait(true);
 			boolean saveIgnoreStatus;
 			saveIgnoreStatus = dontUpdatePos;
@@ -1657,18 +1659,18 @@
 				this.currentMap = newmap;
 				this.title = currentMap.mapName;
 				// neccessary to make updateposition to test if the current map is the best one for the GPS-Position
-				lastCompareX = Integer.MAX_VALUE; 
+				lastCompareX = Integer.MAX_VALUE;
 				lastCompareY = Integer.MAX_VALUE;
 				if (mmp.mapImage != null ) {
-					mmp.removeImage(mmp.mapImage); 
-					mmp.mapImage.free(); 
-					mmp.mapImage = null; 
+					mmp.removeImage(mmp.mapImage);
+					mmp.mapImage.free();
+					mmp.mapImage = null;
 					mapImage1to1 = mmp.mapImage;
 					// calls the garbage collection
-					Vm.getUsedMemory(true); 
-				} 
+					Vm.getUsedMemory(true);
+				}
 				// give memory free before loading the new map to avoid out of memory error
-				String ImageFilename = currentMap.getImageFilename();
+				final String ImageFilename = currentMap.getImageFilename();
 				if (ImageFilename == null ) {
 					mmp.mapImage = new MapImage();
 					maps.remove(currentMap);
@@ -1678,7 +1680,7 @@
 					if (ImageFilename.length() > 0) {
 						// attention: when running in native java-vm,
 						// no exception will be thrown, not even OutOfMemeoryError
-						mmp.mapImage = new MapImage(ImageFilename); 
+						mmp.mapImage = new MapImage(ImageFilename);
 					}
 					else mmp.mapImage = new MapImage(); // no image associated with the calibration info ("empty map")
 				}
@@ -1694,28 +1696,28 @@
 				forceMapLoad = false;
 				directionArrows.setMap(currentMap);
 				updateScale();
-				// this doesn't work in a ticked-thread in the ewe-vm. 
+				// this doesn't work in a ticked-thread in the ewe-vm.
 				// That's why i made a new mThread in gotoPanel for ticked
 				dontUpdatePos = saveIgnoreStatus;
-			} catch (IllegalArgumentException e) { 
+			} catch (final IllegalArgumentException e) {
 				// thrown by new AniImage() in ewe-vm if file not found;
 				pref.log("[MovingMap:setMap]IllegalArgumentException",e,true);
 				if (mmp.mapImage != null) {
 					mmp.removeImage(mmp.mapImage);
 					mmp.mapImage.free();
-					mmp.mapImage = null; 
+					mmp.mapImage = null;
 					mapImage1to1 = mmp.mapImage;
 				}
 				rebuildOverlaySet();
 				updateOnlyPosition(where, false);
 				(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4218, "Could not load map: \n")+ newmap.getImageFilename(), FormBase.OKB)).execute();
 				dontUpdatePos = saveIgnoreStatus;
-			} catch (OutOfMemoryError e) {
+			} catch (final OutOfMemoryError e) {
 				pref.log("[MovingMap:setMap]OutOfMemoryError",e,true);
 				if (mmp.mapImage != null) {
 					mmp.removeImage(mmp.mapImage);
 					mmp.mapImage.free();
-					mmp.mapImage = null; 
+					mmp.mapImage = null;
 					mapImage1to1 = mmp.mapImage;
 				}
 				rebuildOverlaySet();
@@ -1725,12 +1727,12 @@
 						+ MyLocale.getMsg(4220, "\nYou can try to close\n all prgrams and \nrestart CacheWolf"),
 						FormBase.OKB)).execute();
 				dontUpdatePos = saveIgnoreStatus;
-			}catch (SystemResourceException e) {
+			}catch (final SystemResourceException e) {
 				pref.log("[MovingMap:setMap]SystemResourceException",e,true);
 				if (mmp.mapImage != null) {
 					mmp.removeImage(mmp.mapImage);
 					mmp.mapImage.free();
-					mmp.mapImage = null; 
+					mmp.mapImage = null;
 					mapImage1to1 = mmp.mapImage;
 				}
 				rebuildOverlaySet();
@@ -1751,21 +1753,21 @@
 		if (!posCircle.where.isValid()) {
 			posCircle.where.set(newCenter);
 		}
-		Point circlePosOnMap = currentMap.calcMapXY(posCircle.where);
-		Point centerOnMap = currentMap.calcMapXY(newCenter);
-		int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
-		int h = (height != 0 ? height : pref.myAppHeight);
-		int mapPosX = w/2 - centerOnMap.x;
-		int mapPosY = h/2 - centerOnMap.y;
-		int newPosCircleX = mapPosX + circlePosOnMap.x;
-		int newPosCircleY = mapPosY + circlePosOnMap.y;
+		final Point circlePosOnMap = currentMap.calcMapXY(posCircle.where);
+		final Point centerOnMap = currentMap.calcMapXY(newCenter);
+		final int w = (width != 0 ? width : pref.myAppWidth); // width == 0 happens if this routine is run before the windows is on the screen
+		final int h = (height != 0 ? height : pref.myAppHeight);
+		final int mapPosX = w/2 - centerOnMap.x;
+		final int mapPosY = h/2 - centerOnMap.y;
+		final int newPosCircleX = mapPosX + circlePosOnMap.x;
+		final int newPosCircleY = mapPosY + circlePosOnMap.y;
 
 		if (mmp != null && mmp.mapImage != null) mmp.mapImage.move(mapPosX, mapPosY);
 
-		int wCircle = posCircle.getWidth();
-		int hCircle = posCircle.getHeight();
-		int npx = newPosCircleX-wCircle/2;
-		int npy = newPosCircleY-hCircle/2;
+		final int wCircle = posCircle.getWidth();
+		final int hCircle = posCircle.getHeight();
+		final int npx = newPosCircleX-wCircle/2;
+		final int npy = newPosCircleY-hCircle/2;
 		posCircle.move(npx, npy);
 		posCircleX = newPosCircleX;
 		posCircleY = newPosCircleY;
@@ -1776,8 +1778,8 @@
 	public void hideMap() {
 		if (mmp != null && mmp.mapImage != null)
 			mmp.mapImage.hide();
-		for(Iterator i=mmp.images.iterator(); i.hasNext ();){
-			AniImage image = (AniImage) i.next();
+		for(final Iterator i=mmp.images.iterator(); i.hasNext ();){
+			final AniImage image = (AniImage) i.next();
 			if (image instanceof MapImage && !(image instanceof MapSymbol) && !(image instanceof TrackOverlay)){
 				((MapImage) image).hide();
 			}
@@ -1789,8 +1791,8 @@
 	public void showMap() {
 		if (mmp != null && mmp.mapImage != null) mmp.mapImage.unhide();
 		mapHidden = false;
-		for(Iterator i=mmp.images.iterator(); i.hasNext ();){
-			AniImage image = (AniImage) i.next();
+		for(final Iterator i=mmp.images.iterator(); i.hasNext ();){
+			final AniImage image = (AniImage) i.next();
 			if (image instanceof MapImage && !(image instanceof MapSymbol) && !(image instanceof TrackOverlay)){
 				((MapImage) image).unhide();
 			}
@@ -1812,7 +1814,7 @@
 	public void zoomScreenRect(Point firstclickpoint, int w, int h) {
 		int newImageWidth = (int) (this.width *  (this.width  < 481 ? 2 : 1.6)); // (maximal) size of the zoomed image
 		int newImageHeight= (int) (this.height * (this.width < 481 ?  2 : 1.6)); // dont make this to big, otherwise it causes out of memory errors
-		CWPoint center = ScreenXY2LatLon(firstclickpoint.x + w/2, firstclickpoint.y + h/2);
+		final CWPoint center = ScreenXY2LatLon(firstclickpoint.x + w/2, firstclickpoint.y + h/2);
 		float zoomFactor;
 		if (h < 0) {
 			h = java.lang.Math.abs(h);
@@ -1829,10 +1831,10 @@
 		// calculate rect in unzoomed image in a way that the centre of the new image is the centre of selected area but give priority to the prefered image size of the scaled image
 		newImageHeight = (int) (newImageHeight / zoomFactor / currentMap.zoomFactor);
 		newImageWidth = (int) (newImageWidth / zoomFactor / currentMap.zoomFactor);
-		Point mappos = getMapPositionOnScreen();
-		int xinunscaledimage = (int) ((firstclickpoint.x - mappos.x + w/2) / currentMap.zoomFactor + currentMap.shift.x - newImageWidth /2);
-		int yinunscaledimage = (int) ((firstclickpoint.y - mappos.y + h/2) / currentMap.zoomFactor + currentMap.shift.y - newImageHeight /2);
-		Rect newImageRect = new Rect(xinunscaledimage , yinunscaledimage, newImageWidth, newImageHeight);
+		final Point mappos = getMapPositionOnScreen();
+		final int xinunscaledimage = (int) ((firstclickpoint.x - mappos.x + w/2) / currentMap.zoomFactor + currentMap.shift.x - newImageWidth /2);
+		final int yinunscaledimage = (int) ((firstclickpoint.y - mappos.y + h/2) / currentMap.zoomFactor + currentMap.shift.y - newImageHeight /2);
+		final Rect newImageRect = new Rect(xinunscaledimage , yinunscaledimage, newImageWidth, newImageHeight);
 		if (mapImage1to1 != null && mmp.mapImage != null && mapImage1to1.image != null)
 		{
 			// try to avoid overlapping by shifting
@@ -1863,7 +1865,7 @@
 	}
 
 	public void zoomout() {
-		CWPoint center = currentMap.center;
+		final CWPoint center = currentMap.center;
 		float zoomfactor = currentMap.zoomFactor / 2;
 		if (zoomfactor < 1) {
 			zoomfactor = 1;
@@ -1880,7 +1882,7 @@
 	}
 
 	public void zoom1to1() {
-		CWPoint center = ScreenXY2LatLon(this.width /2 , this.height/2);
+		final CWPoint center = ScreenXY2LatLon(this.width /2 , this.height/2);
 		if (mapImage1to1 != null) zoomFromUnscaled(1, new Rect(0,0,mapImage1to1.getWidth(), mapImage1to1.getHeight()), center);
 		else zoomFromUnscaled(1, new Rect(0,0, 1,1), center);
 	}
@@ -1893,7 +1895,7 @@
 	 */
 	public void zoomFromUnscaled (float zoomFactor, Rect newImageRect, CWPoint center) {
 		Vm.showWait(this, true);
-		boolean savegpsstatus = dontUpdatePos;
+		final boolean savegpsstatus = dontUpdatePos;
 		if (mapImage1to1 != null) {
 			dontUpdatePos = true; // avoid multi-thread problems
 			int saveprop = mImage.IsMoveable;
@@ -1912,7 +1914,7 @@
 				if (zoomFactor == 1) tmp = mapImage1to1;
 				else tmp = new MapImage(mapImage1to1.scale((int) (newImageRect.width*zoomFactor), (int)(newImageRect.height*zoomFactor), newImageRect, 0));
 				currentMap.zoom(zoomFactor, newImageRect.x, newImageRect.y);
-			} catch (OutOfMemoryError e) {
+			} catch (final OutOfMemoryError e) {
 				(new MessageBox(MyLocale.getMsg(4207, "Error"),
 						MyLocale.getMsg(4222, "Out of memory error"), FormBase.OKB)).execute();
 				//tmp = mapImage1to1;
@@ -1925,7 +1927,7 @@
 			mmp.images.moveToBack(mmp.mapImage);
 			if (mapImage1to1 != null && mmp.mapImage != null && mapImage1to1.image != null)
 			{
-				Point mappos = getMapPositionOnScreen();
+				final Point mappos = getMapPositionOnScreen();
 				mmp.mapImage.move(mappos.x,mappos.y);
 			}
 		} else // no map image loaded
@@ -1957,18 +1959,18 @@
 	}
 
 	public boolean handleCommand(int actionCommand) {
-		if (CLOSE == actionCommand) {			
-			WindowEvent tmp = new WindowEvent();
+		if (CLOSE == actionCommand) {
+			final WindowEvent tmp = new WindowEvent();
 			tmp.type = WindowEvent.CLOSE;
 			postEvent(tmp);
 			return true;
-		} 
+		}
 		if (SELECT_MAP == actionCommand) {
 			mmp.chooseMap();
 			return true;
 		}
 		if (CHANGE_MAP_DIR == actionCommand) {
-			FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().getCustomMapsPath());
+			final FileChooser fc = new FileChooser(FileChooserBase.DIRECTORY_SELECT, Global.getPref().getCustomMapsPath());
 			fc.addMask("*.wfl");
 			fc.setTitle(MyLocale.getMsg(4200,"Select map directory:"));
 			if(fc.execute() != FormBase.IDCANCEL){
@@ -2074,12 +2076,12 @@
 		return mapHidden;
 	}
 
-	
+
 	public void setPaintPosDestLine(boolean paintPosDestLine) {
 		this.paintPosDestLine = paintPosDestLine;
 	}
-	
-	
+
+
 }
 
 /**
@@ -2099,13 +2101,13 @@
 	Point saveMapLoc = null;
 	boolean saveGpsIgnoreStatus;
 	boolean paintingZoomArea;
-	
+
 	ImageList saveImageList = null;
 	int lastZoomWidth , lastZoomHeight;
-	
+
 	boolean ignoreNextDrag=false;
 	boolean onlyIfCache=false;
-	
+
 	public MovingMapPanel(MovingMap f){
 		this.mm = f;
 		miLuminary = new MenuItem[SkyOrientation.LUMINARY_NAMES.length];
@@ -2124,7 +2126,7 @@
 		}
 		if (mm.getControlsLayer().imageBeginDragged(which, pos)) {
 			return false;
-		}			
+		}
 		// move (drag) map
 		//if (!(which == null || which == mapImage || which instanceof TrackOverlay || which == mm.directionArrows) ) return false;
 		saveGpsIgnoreStatus = mm.dontUpdatePos;
@@ -2136,7 +2138,7 @@
 	}
 
 	public boolean imageNotDragged(ImageDragContext dc,Point pos){
-		boolean ret = super.imageNotDragged(dc, pos);
+		final boolean ret = super.imageNotDragged(dc, pos);
 		bringMaptoBack();
 		if (dc.image == null) moveMap(pos.x - saveMapLoc.x, pos.y - saveMapLoc.y);
 		else mapMoved(pos.x - saveMapLoc.x, pos.y - saveMapLoc.y);
@@ -2186,10 +2188,10 @@
 					}
 					mm.zoomScreenRect(saveMapLoc, lastZoomWidth, lastZoomHeight);
 				}
-				if (paintingZoomArea && 
+				if (paintingZoomArea &&
 					(ev.type == PenEvent.PEN_MOVED_ON || ev.type == PenEvent.PEN_MOVE || ev.type == PenEvent.PEN_DRAG)) {
 					int left, top;
-					Graphics dr = this.getGraphics();
+					final Graphics dr = this.getGraphics();
 					if (lastZoomWidth < 0)left = saveMapLoc.x + lastZoomWidth;
 					else left = saveMapLoc.x;
 					if (lastZoomHeight < 0)top = saveMapLoc.y + lastZoomHeight;
@@ -2247,7 +2249,7 @@
 	public void doPaint(Graphics g,Rect area) {
 		super.doPaint(g, area);
 		if (mm.gotoPos != null && mm.paintPosDestLine) {
-			Point dest = mm.getXYonScreen(mm.gotoPos.where);
+			final Point dest = mm.getXYonScreen(mm.gotoPos.where);
 			g.setPen(new Pen(Color.DarkBlue, Pen.SOLID, 3));
 			g.drawLine(mm.posCircleX, mm.posCircleY, dest.x, dest.y);
 		}
@@ -2257,7 +2259,7 @@
 		CWPoint gpspos;
 		if (mm.myNavigation.gpsPos.Fix > 0) gpspos = new CWPoint(mm.myNavigation.gpsPos.latDec, mm.myNavigation.gpsPos.lonDec);
 		else gpspos = null;
-		ListBox l = new ListBox(mm.maps, gpspos, mm.getGotoPos(), mm.currentMap);
+		final ListBox l = new ListBox(mm.maps, gpspos, mm.getGotoPos(), mm.currentMap);
 		if(l.execute() == FormBase.IDOK){
 			mm.autoSelectMap = false;
 			if (l.selectedMap.isInBound(mm.posCircle.where) || l.selectedMap.getImageFilename().length()==0) {
@@ -2296,7 +2298,7 @@
 				kontextMenu.addItem(newWayPointMenuItem);
 				kontextMenu.addItem(new MenuItem("-"));
 			}
-			AniImage clickedOnImage = images.findHotImage(p);
+			final AniImage clickedOnImage = images.findHotImage(p);
 			if (clickedOnImage != null && clickedOnImage instanceof MapSymbol) {
 				if ( ((MapSymbol)clickedOnImage).mapObject instanceof CacheHolder) {
 					clickedCache = (CacheHolder)( ((MapSymbol)clickedOnImage).mapObject);
@@ -2306,7 +2308,7 @@
 						kontextMenu.addItem(openCacheDescMenuItem);
 						openCacheDetailMenuItem = new MenuItem(MyLocale.getMsg(200, "Open Details")+" '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$e");
 						kontextMenu.addItem(openCacheDetailMenuItem);
-						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto")+ " '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$g"); 
+						gotoCacheMenuItem = new MenuItem(MyLocale.getMsg(4279, "Goto")+ " '"+(clickedCache.getCacheName().length()>0 ? clickedCache.getCacheName() : clickedCache.getWayPoint())+"'$g");
 						kontextMenu.addItem(gotoCacheMenuItem);
 						if (Global.mainForm.cacheListVisible) {
 							addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
@@ -2320,7 +2322,7 @@
 						if (clickedCache.getType() == CacheType.CW_TYPE_QUESTION) {
 							stmp=clickedCache.getCacheDetails(false).LongDescription;
 							if (!stmp.equals("")) {
-								kontextMenu.addItem(missionMenuItem=new MenuItem("?: "));								
+								kontextMenu.addItem(missionMenuItem=new MenuItem("?: "));
 							}
 						}
 						kontextMenu.addItem(new MenuItem("-"));
@@ -2333,7 +2335,7 @@
 			}
 			/*
 			 *  this kontext will be replaced by the settings of the rose in the goto panel
-			 *    
+			 *
 			if ( !(mm.directionArrows.onHotArea(p.x, p.y)) ) {
 			}
 			else {
@@ -2351,11 +2353,11 @@
 			else kontextMenu=null;
 		}
 	}
-	
+
 	public boolean imageMovedOn(AniImage which) {
 		if (which instanceof MapSymbol) {
 			if ( ((MapSymbol)which).mapObject instanceof CacheHolder) {
-				CacheHolder ch = (CacheHolder) ((MapSymbol) which).mapObject;
+				final CacheHolder ch = (CacheHolder) ((MapSymbol) which).mapObject;
 				this.toolTip=ch.getWayPoint()+"\n"
 							+ ch.cacheName+"\n"
 							+ "Difficulty: "+CacheTerrDiff.longDT(ch.getHard())+"\n"
@@ -2379,27 +2381,27 @@
 
 	public void onEvent(Event ev){
 		// nothing selected in kontext
-		if (kontextMenu != null 
-				&& ev instanceof PenEvent 
-				&& ev.type == PenEvent.PEN_DOWN 
+		if (kontextMenu != null
+				&& ev instanceof PenEvent
+				&& ev.type == PenEvent.PEN_DOWN
 				&& ev.target == this) {
-			kontextMenu.close(); 
-			kontextMenu = null; 
+			kontextMenu.close();
+			kontextMenu = null;
 			return;
 		}
 		// something selected
 		if (ev instanceof MenuEvent) {
 			if (ev.target == kontextMenu) {
 				if ((((MenuEvent)ev).type==MenuEvent.SELECTED)) {
-					MenuItem action = (MenuItem) kontextMenu.getSelectedItem();
+					final MenuItem action = (MenuItem) kontextMenu.getSelectedItem();
 					if (action == gotoMenuItem) {
 						closeKontextMenu();
 						mm.myNavigation.setDestination(mm.ScreenXY2LatLon(saveMapLoc.x, saveMapLoc.y));
 					}
 					if (action == openCacheDescMenuItem || action == openCacheDetailMenuItem) {
 						leaveMovingMap();
-						MainTab mainT = Global.mainTab;
-						if (action == openCacheDescMenuItem) 
+						final MainTab mainT = Global.mainTab;
+						if (action == openCacheDescMenuItem)
 							mainT.openPanel(clickedCache,2);
 						else
 							mainT.openPanel(clickedCache,1);
@@ -2410,7 +2412,7 @@
 					}
 					if (action == newWayPointMenuItem) {
 						leaveMovingMap();
-						CacheHolder newWP = new CacheHolder();
+						final CacheHolder newWP = new CacheHolder();
 						newWP.pos = mm.ScreenXY2LatLon(saveMapLoc.x, saveMapLoc.y);
 						newWP.setLatLon(newWP.pos.toString());
 						Global.mainTab.newWaypoint(newWP);
@@ -2444,7 +2446,7 @@
 	private void closeKontextMenu() {
 		kontextMenu.close();
 		// for not to do an additional klick (before reacting on klicks)
-		PenEvent pev = new PenEvent();
+		final PenEvent pev = new PenEvent();
 		pev.target=this;
 		pev.type=PenEvent.PEN_DOWN;
 		this.postEvent(pev);
@@ -2453,10 +2455,10 @@
 	}
 	private void leaveMovingMap() {
 		closeKontextMenu();
-		WindowEvent close = new WindowEvent();
+		final WindowEvent close = new WindowEvent();
 		close.target = this;
 		close.type = WindowEvent.CLOSE;
-		this.postEvent(close);		
+		this.postEvent(close);
 	}
 }
 
@@ -2481,7 +2483,7 @@
 		String cmp;
 		int oldmap = -1;
 		boolean curMapFound = false;
-		boolean[] inList = new boolean[maps.size()];
+		final boolean[] inList = new boolean[maps.size()];
 		int row = -1;
 		if (curMap == null) curMapFound = true;
 		if (gotopos != null && Gps != null) {
@@ -2493,7 +2495,7 @@
 				try {
 					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
 					else { map = ml.getMap();}
-				} catch (IOException ex) {continue; } // could not read .wfl-file
+				} catch (final IOException ex) {continue; } // could not read .wfl-file
 				if( map.isInBound(Gps.latDec, Gps.lonDec) && map.isInBound(gotopos) )
 				{
 					list.addItem(i + ": " + map.mapName);
@@ -2515,7 +2517,7 @@
 				try {
 					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
 					else { map = ml.getMap();}
-				} catch (IOException ex) {continue; } // could not read .wfl-file
+				} catch (final IOException ex) {continue; } // could not read .wfl-file
 				if( map.isInBound(Gps.latDec, Gps.lonDec) )
 				{
 					list.addItem(i + ": " + map.mapName);
@@ -2537,7 +2539,7 @@
 				try {
 					if (!Area.containsRoughly(ml.sortEntryBBox, cmp)) continue; // TODO if no map available
 					else { map = ml.getMap();}
-				} catch (IOException ex) {continue; } // could not read .wfl-file
+				} catch (final IOException ex) {continue; } // could not read .wfl-file
 				if(map.isInBound(gotopos)) {
 					list.addItem(i + ": " + map.mapName);
 					row++;
@@ -2585,7 +2587,7 @@
 				selectedMap = ((MapListEntry)maps.get(mapNum)).getMap();
 				selected = true;
 				this.close(FormBase.IDOK);
-				} catch (IOException e) {
+				} catch (final IOException e) {
 					(new MessageBox(MyLocale.getMsg(4207, "Error"), MyLocale.getMsg(4278, "Cannot load wfl-file: \n")
 							+ ((MapListEntry)maps.get(mapNum)).filename, FormBase.OKB)).execute();
 				}
@@ -2594,7 +2596,7 @@
 				selected = false;
 				this.close(FormBase.IDCANCEL);
 			}
-		}catch (NegativeArraySizeException e) {
+		}catch (final NegativeArraySizeException e) {
 			// happens in substring when a dividing line selected
 		}
 	}
@@ -2757,7 +2759,7 @@
 		if (map == null) return;
 
 		float angleRad;
-		int centerX = location.width/2, centerY = location.height/2;
+		final int centerX = location.width/2, centerY = location.height/2;
 		if (arrow[0] == null) arrow[0] = new Point();
 		if (arrow[1] == null) arrow[1] = new Point();
 		arrow[0].x = centerX;



From araber95 at mail.berlios.de  Sat Apr 16 04:54:00 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 16 Apr 2011 04:54:00 PM +0200
Subject: [Cachewolf-svn] r2980 - trunk/res_noewe/webmapservices
Message-ID: <20110416145400.DD7DF481455@sheep.berlios.de>

Author: araber95
Date: 2011-04-16 16:54:00 +0200 (Sat, 16 Apr 2011)
New Revision: 2980

Modified:
   trunk/res_noewe/webmapservices/it-88_p.wms
   trunk/res_noewe/webmapservices/it_t25.wms
Log:
changed wms for italy

Modified: trunk/res_noewe/webmapservices/it-88_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/it-88_p.wms	2011-04-16 14:53:27 UTC (rev 2979)
+++ trunk/res_noewe/webmapservices/it-88_p.wms	2011-04-16 14:54:00 UTC (rev 2980)
@@ -1,20 +1,26 @@
-TakenFromUrl:   http://wiki.gfoss.it/index.php/GIS_Open_Data#Italia
-GetCapabilitiesUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?request=getcapabilities&service=WMS&version=1.1.1
-Name:   it.Sardinien photo
-MapType:   photo
-MainUrl:   http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
+TakenFromUrl:       http://webgis.regione.sardegna.it:80/wmsconnector/com.esri.wms.Esrimap/ras_wms?
+GetCapabilitiesUrl: http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               it.sardegna p
+MapType:                        photo
+MainUrl:            http://webgis.regione.sardegna.it/wmsconnector/com.esri.wms.Esrimap/ras_wms?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
 CoordinateReferenceSystemCacheWolf:  4326
 CoordinateReferenceSystemUrlPart: SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=ortofoto_it_2006
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 41.400307 E 7.964019
-BoundingBoxBottomRightWGS84:   N 38.792131 E 10.022418
-MinScale:   4
-MaxScale:   6
-# RecommendedScale:   1.000
-RecommendedScale:   4
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=ortofoto_it_2000|Ortofoto IT2000||
+#LayersUrlPart:     LAYERS=ortofoto_it_2006|Ortofoto IT2006||
+#LayersUrlPart:     LAYERS=Carta fisica|Carta fisica||
+#LayersUrlPart:     LAYERS=CTR10K raster|CTR10K raster||
+#LayersUrlPart:     LAYERS=IKONOS_RGB_Mosaico_Sardegna|IKONOS Mosaico RGB||
+#LayersUrlPart:     LAYERS=orto2k_totale|Ortofoto 2K||
+LayersUrlPart:     LAYERS=ortofoto_it_2006
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 41.4003 E 7.9640
+BoundingBoxBottomRightWGS84: N 38.7921 E 10.0224
+#BBox_Mitte: N 40.0962197844 E 8.99321880565
+MinScale:   0.3453
+MaxScale:   2.7621
+RecommendedScale:    1 0.5 1.5
 ImageFileExtension: .png

Modified: trunk/res_noewe/webmapservices/it_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/it_t25.wms	2011-04-16 14:53:27 UTC (rev 2979)
+++ trunk/res_noewe/webmapservices/it_t25.wms	2011-04-16 14:54:00 UTC (rev 2980)
@@ -21,7 +21,7 @@
 BoundingBoxTopLeftWGS84: N 48.0000 E 6.0000
 BoundingBoxBottomRightWGS84: N 36.0000 E 19.0000
 # min and maxScale found by testing the server (pfeffer 1-10-2009)
-MinScale:   0
-MaxScale:   6.6
-RecommendedScale:   2.5
+MinScale:   1
+MaxScale:   25
+RecommendedScale:   2.5 5 8
 ImageFileExtension: .gif



From araber95 at mail.berlios.de  Sat Apr 16 05:04:30 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 16 Apr 2011 05:04:30 PM +0200
Subject: [Cachewolf-svn] r2981 - trunk/res_noewe/webmapservices
Message-ID: <20110416150430.EF4E9481455@sheep.berlios.de>

Author: araber95
Date: 2011-04-16 17:04:30 +0200 (Sat, 16 Apr 2011)
New Revision: 2981

Added:
   trunk/res_noewe/webmapservices/dk_p.wms
   trunk/res_noewe/webmapservices/dk_t.wms
   trunk/res_noewe/webmapservices/dk_t25.wms
   trunk/res_noewe/webmapservices/dk_t50.wms
   trunk/res_noewe/webmapservices/it-25_p.wms
   trunk/res_noewe/webmapservices/wfl-format.txt
Log:
1.adding wms dk
2.adding wms it lombardia photo
3. adding description for wfl-file

Added: trunk/res_noewe/webmapservices/dk_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/dk_p.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/dk_p.wms	2011-04-16 15:04:30 UTC (rev 2981)
@@ -0,0 +1,46 @@
+???TakenFromUrl:       http://kortforsyningen.kms.dk/orto_foraar?
+GetCapabilitiesUrl: http://kortforsyningen.kms.dk/service?servicename=orto_foraar&&login=kfmonitor&password=kfmonitor&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               dk p
+MapType:                        photo
+MainUrl:            http://kortforsyningen.kms.dk/service?servicename=orto_foraar&&login=kfmonitor&password=kfmonitor&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=orto_foraar|Ortofoto for??r||
+#LayersUrlPart:     LAYERS=jylland2004_40cm|jylland2004_40cm||
+#LayersUrlPart:     LAYERS=fyn2005_40cm|fyn2005_40cm||
+#LayersUrlPart:     LAYERS=jylland2005_40cm|jylland2005_40cm||
+#LayersUrlPart:     LAYERS=jylland2006_40cm|jylland2006_40cm||
+#LayersUrlPart:     LAYERS=sjaelland2006_40cm|sjaelland2006_40cm||
+#LayersUrlPart:     LAYERS=sjaelland2006_10cm|sjaelland2006_10cm||
+#LayersUrlPart:     LAYERS=bornholm2006_40cm|bornholm2006_40cm||
+#LayersUrlPart:     LAYERS=jylland2007_20cm|jylland2007_20cm||
+#LayersUrlPart:     LAYERS=jylland2007_10cm|jylland2007_10cm||
+#LayersUrlPart:     LAYERS=sjaelland2007_10cm|sjaelland2007_10cm||
+#LayersUrlPart:     LAYERS=jylland2008_20cm|jylland2008_20cm||
+#LayersUrlPart:     LAYERS=jylland2008_10cm|jylland2008_10cm||
+#LayersUrlPart:     LAYERS=sjaelland2008_10cm|sjaelland2008_10cm||
+#LayersUrlPart:     LAYERS=jylland2009_20cm|jylland2009_20cm||
+#LayersUrlPart:     LAYERS=jylland2009_10cm|jylland2009_10cm||
+#LayersUrlPart:     LAYERS=sjaelland2009_20cm|sjaelland2009_20cm||
+#LayersUrlPart:     LAYERS=sjaelland2009_10cm|sjaelland2009_10cm||
+#LayersUrlPart:     LAYERS=bornholm2010_hrks10cm|bornholm2010_hrks10cm||
+#LayersUrlPart:     LAYERS=fyn2010_20cm|fyn2010_20cm||
+#LayersUrlPart:     LAYERS=fyn2010_10cm|fyn2010_10cm||
+#LayersUrlPart:     LAYERS=jylland2010_20cm|jylland2010_20cm||
+#LayersUrlPart:     LAYERS=jylland2010_10cm|jylland2010_10cm||
+#LayersUrlPart:     LAYERS=sjaelland2010_20cm|sjaelland2010_20cm||
+#LayersUrlPart:     LAYERS=sjaelland2010_10cm|sjaelland2010_10cm||
+#LayersUrlPart:     LAYERS=sjaelland2010_hrks10cm|sjaelland2010_hrks10cm||
+LayersUrlPart:     LAYERS=orto_foraar
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 58.4744 E 2.4783
+BoundingBoxBottomRightWGS84: N 53.0150 E 17.5575
+#BBox_Mitte: N 55.7447 E 10.017915
+MinScale:   0
+MaxScale:   25
+RecommendedScale:    1 4 8
+ImageFileExtension: .jpg

Added: trunk/res_noewe/webmapservices/dk_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/dk_t.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/dk_t.wms	2011-04-16 15:04:30 UTC (rev 2981)
@@ -0,0 +1,21 @@
+???TakenFromUrl:       http://kortforsyningen.kms.dk/topo_skaermkort?
+GetCapabilitiesUrl: http://kortforsyningen.kms.dk/service?servicename=topo_skaermkort&login=kfmonitor&password=kfmonitor&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               dk topo
+MapType:                        topo
+MainUrl:            http://kortforsyningen.kms.dk/service?servicename=topo_skaermkort&login=kfmonitor&password=kfmonitor&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=dtk_skaermkort|DTK/Sk??rmkort||
+LayersUrlPart:     LAYERS=dtk_skaermkort
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 58.4744 E 2.4783
+BoundingBoxBottomRightWGS84: N 53.0150 E 17.5575
+#BBox_Mitte: N 55.7447 E 10.017915
+MinScale:   0
+MaxScale:   20
+RecommendedScale:    4 1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/dk_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/dk_t25.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/dk_t25.wms	2011-04-16 15:04:30 UTC (rev 2981)
@@ -0,0 +1,40 @@
+???TakenFromUrl:       http://kortforsyningen.kms.dk/topo25?
+GetCapabilitiesUrl: http://kortforsyningen.kms.dk/service?servicename=topo25&login=kfmonitor&password=kfmonitor&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               dk t25
+MapType:                        topo
+MainUrl:            http://kortforsyningen.kms.dk/service?servicename=topo25&login=kfmonitor&password=kfmonitor&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=topo25_graa_2008|DTK/kort25 gr?? 2008||
+#LayersUrlPart:     LAYERS=topo25_daempet_2008|DTK/kort25 d??mpet 2008||
+#LayersUrlPart:     LAYERS=topo25_klassisk_2008|DTK/kort25 klassisk 2008||
+#LayersUrlPart:     LAYERS=topo25_graa_2007|DTK/kort25 gr?? 2007||
+#LayersUrlPart:     LAYERS=topo25_daempet_2007|DTK/kort25 d??mpet 2007||
+#LayersUrlPart:     LAYERS=topo25_klassisk_2007|DTK/kort25 klassisk 2007||
+#LayersUrlPart:     LAYERS=topo25_graa_2006|DTK/kort25 gr?? 2006||
+#LayersUrlPart:     LAYERS=topo25_daempet_2006|DTK/kort25 d??mpet 2006||
+#LayersUrlPart:     LAYERS=topo25_klassisk_2006|DTK/kort25 klassisk 2006||
+#LayersUrlPart:     LAYERS=topo25_graa_2005|DTK/kort25 gr?? 2005||
+#LayersUrlPart:     LAYERS=topo25_daempet_2005|DTK/kort25 d??mpet 2005||
+#LayersUrlPart:     LAYERS=topo25_klassisk_2005|DTK/kort25 klassisk 2005||
+#LayersUrlPart:     LAYERS=topo25_graa_2004|DTK/kort25 gr?? 2004||
+#LayersUrlPart:     LAYERS=topo25_daempet_2004|DTK/kort25 d??mpet 2004||
+#LayersUrlPart:     LAYERS=topo25_klassisk_2004|DTK/kort25 klassisk 2004||
+#LayersUrlPart:     LAYERS=topo25_daempet_2002|DTK/kort25 d??mpet 2002||
+#LayersUrlPart:     LAYERS=topo25_klassisk_2002|DTK/kort25 klassisk 2002||
+#LayersUrlPart:     LAYERS=topo25_graa|DTK/kort25 gr??||
+#LayersUrlPart:     LAYERS=topo25_daempet|DTK/kort25 d??mpet||
+#LayersUrlPart:     LAYERS=topo25_klassisk|DTK/kort25 klassisk||
+LayersUrlPart:     LAYERS=topo25_klassisk
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 58.4744 E 2.4783
+BoundingBoxBottomRightWGS84: N 53.0150 E 17.5575
+#BBox_Mitte: N 55.7447 E 10.017915
+MinScale:   1
+MaxScale:   20
+RecommendedScale:    2.5 5
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/dk_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/dk_t50.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/dk_t50.wms	2011-04-16 15:04:30 UTC (rev 2981)
@@ -0,0 +1,26 @@
+TakenFromUrl:       http://kortforsyningen.kms.dk/topo50?
+GetCapabilitiesUrl: http://kortforsyningen.kms.dk/service?servicename=topo50&login=kfmonitor&password=kfmonitor&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               dk t50
+MapType:                        topo
+MainUrl:            http://kortforsyningen.kms.dk/service?servicename=topo50&login=kfmonitor&password=kfmonitor&
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=dtk_2cm_2007|DTK/kort50 2007|0.000000|0.000000
+#LayersUrlPart:     LAYERS=dtk_2cm_2006|DTK/kort50 2006|0.000000|0.000000
+#LayersUrlPart:     LAYERS=dtk_2cm_2005|DTK/kort50 2005|0.000000|0.000000
+#LayersUrlPart:     LAYERS=dtk_2cm_2004|DTK/kort50 2004|0.000000|0.000000
+#LayersUrlPart:     LAYERS=dtk_2cm_2002|DTK/kort50 2002|0.000000|0.000000
+#LayersUrlPart:     LAYERS=dtk_2cm|DTK/kort50|0.000000|0.000000
+LayersUrlPart:     LAYERS=dtk_2cm
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 58.4744 E 2.4783
+BoundingBoxBottomRightWGS84: N 53.0150 E 17.5575
+#BBox_Mitte: N 55.7447 E 10.017915
+MinScale:   1
+MaxScale:   20
+RecommendedScale:    5 4 6
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/it-25_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/it-25_p.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/it-25_p.wms	2011-04-16 15:04:30 UTC (rev 2981)
@@ -0,0 +1,22 @@
+TakenFromUrl:       http://10.220.56.127/ArcGIS93/services/wms/ortofoto_UTM32N_wms/MapServer/WMSServer
+GetCapabilitiesUrl: http://www.cartografia.regione.lombardia.it/ArcGIS93/services/wms/ortofoto_UTM32N_wms/MapServer/WMSServer?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               it.lombardia p
+MapType:                        photo
+MainUrl:            http://www.cartografia.regione.lombardia.it/ArcGIS93/services/wms/ortofoto_UTM32N_wms/MapServer/WMSServer?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  4326
+CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=0|lombardia2007wgs84.ecw||
+#LayersUrlPart:     LAYERS=1|Province||
+LayersUrlPart:     LAYERS=0
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 46.7475 E 8.2398
+BoundingBoxBottomRightWGS84: N 44.5181 E 11.7416
+#BBox_Mitte: N 45.632761 E 9.990684
+MinScale:   0.3453
+MaxScale:   2.7621
+RecommendedScale:    1
+ImageFileExtension: .png

Added: trunk/res_noewe/webmapservices/wfl-format.txt
===================================================================
--- trunk/res_noewe/webmapservices/wfl-format.txt	                        (rev 0)
+++ trunk/res_noewe/webmapservices/wfl-format.txt	2011-04-16 15:04:30 UTC (rev 2981)
@@ -0,0 +1,34 @@
+f0 affine lat x
+f1 affine lon x
+f2 affine lat y
+f3 affine lon y
+topleft.lat
+topleft.lon
+bottomright.lat
+bottomright.lon
+EPSG - Code
+
+
+
+
+
+Berechnung der Koordinaten ll aus einem Bildpunkt (x,y)
+		ll.lat = x * f0 + y * f2 + topleft.lat;
+		ll.lon = x * f1 + y * f3 + topleft.lon;
+
+Berechnung 
+			//calculate reverse affine
+			double nenner=(-f1*f2+f0*f3);
+			transLatX = f3/nenner; // nenner == 0 cannot happen as long als affine is correct
+			transLonX = -f2/nenner;
+			transLatY = -f1/nenner;
+			transLonY = f0/nenner;
+
+Berechnung Bildpunkt x,y aus Koordinaten t
+		x = (int)Math.round(transLatX * (t.latDec - topleft.lat) + transLonX * (t.lonDec - topleft.lon));
+		y = (int)Math.round(transLatY * (t.latDec - topleft.lat) + transLonY * (t.lonDec - topleft.lon));
+
+Beispiel
+Berechnung f2,f1 vereinfacht bei f0,f3=0(keineDrehung) Bildgr?sse 500x500
+(bottomright.lon-topleft.lon)/499=f1
+(bottomright.lat-topleft.lat)/499=f2



From araber95 at mail.berlios.de  Sat Apr 16 05:09:59 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Sat, 16 Apr 2011 05:09:59 PM +0200
Subject: [Cachewolf-svn] r2982 - trunk/res_noewe/webmapservices
Message-ID: <20110416150959.65741481455@sheep.berlios.de>

Author: araber95
Date: 2011-04-16 17:09:59 +0200 (Sat, 16 Apr 2011)
New Revision: 2982

Modified:
   trunk/res_noewe/webmapservices/dk_t.wms
   trunk/res_noewe/webmapservices/dk_t25.wms
   trunk/res_noewe/webmapservices/dk_t50.wms
Log:
dk wms changed png to jpg

Modified: trunk/res_noewe/webmapservices/dk_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/dk_t.wms	2011-04-16 15:04:30 UTC (rev 2981)
+++ trunk/res_noewe/webmapservices/dk_t.wms	2011-04-16 15:09:59 UTC (rev 2982)
@@ -11,11 +11,11 @@
 #LayersUrlPart:     LAYERS=dtk_skaermkort|DTK/Sk?rmkort||
 LayersUrlPart:     LAYERS=dtk_skaermkort
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
+ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 58.4744 E 2.4783
 BoundingBoxBottomRightWGS84: N 53.0150 E 17.5575
 #BBox_Mitte: N 55.7447 E 10.017915
 MinScale:   0
 MaxScale:   20
 RecommendedScale:    4 1
-ImageFileExtension: .png
+ImageFileExtension: .jpg

Modified: trunk/res_noewe/webmapservices/dk_t25.wms
===================================================================
--- trunk/res_noewe/webmapservices/dk_t25.wms	2011-04-16 15:04:30 UTC (rev 2981)
+++ trunk/res_noewe/webmapservices/dk_t25.wms	2011-04-16 15:09:59 UTC (rev 2982)
@@ -30,11 +30,11 @@
 #LayersUrlPart:     LAYERS=topo25_klassisk|DTK/kort25 klassisk||
 LayersUrlPart:     LAYERS=topo25_klassisk
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
+ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 58.4744 E 2.4783
 BoundingBoxBottomRightWGS84: N 53.0150 E 17.5575
 #BBox_Mitte: N 55.7447 E 10.017915
 MinScale:   1
 MaxScale:   20
 RecommendedScale:    2.5 5
-ImageFileExtension: .png
+ImageFileExtension: .jpg

Modified: trunk/res_noewe/webmapservices/dk_t50.wms
===================================================================
--- trunk/res_noewe/webmapservices/dk_t50.wms	2011-04-16 15:04:30 UTC (rev 2981)
+++ trunk/res_noewe/webmapservices/dk_t50.wms	2011-04-16 15:09:59 UTC (rev 2982)
@@ -16,11 +16,11 @@
 #LayersUrlPart:     LAYERS=dtk_2cm|DTK/kort50|0.000000|0.000000
 LayersUrlPart:     LAYERS=dtk_2cm
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
+ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 58.4744 E 2.4783
 BoundingBoxBottomRightWGS84: N 53.0150 E 17.5575
 #BBox_Mitte: N 55.7447 E 10.017915
 MinScale:   1
 MaxScale:   20
 RecommendedScale:    5 4 6
-ImageFileExtension: .png
+ImageFileExtension: .jpg



From araber95 at mail.berlios.de  Tue Apr 19 03:59:20 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 19 Apr 2011 03:59:20 PM +0200
Subject: [Cachewolf-svn] r2983 - in trunk: res_noewe/webmapservices
	src/CacheWolf/imp
Message-ID: <20110419135921.0D05D481482@sheep.berlios.de>

Author: araber95
Date: 2011-04-19 15:59:20 +0200 (Tue, 19 Apr 2011)
New Revision: 2983

Modified:
   trunk/res_noewe/webmapservices/us_p.wms
   trunk/src/CacheWolf/imp/OCXMLImporter.java
Log:
1. update us photo with new wms-server
2. OC Import: Handling Status on Update as in gpx-Import (until OC changes gpx export)

Modified: trunk/res_noewe/webmapservices/us_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/us_p.wms	2011-04-16 15:09:59 UTC (rev 2982)
+++ trunk/res_noewe/webmapservices/us_p.wms	2011-04-19 13:59:20 UTC (rev 2983)
@@ -1,22 +1,21 @@
-TakenFromUrl:       http://terraservice.net/
-GetCapabilitiesUrl: http://terraservice.net/ogccapabilities.ashx?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               USA photo
+TakenFromUrl:       http://igskmncngs617.cr.usgs.gov/arcgis/services/baseline/ImageServer/WMSServer
+GetCapabilitiesUrl: http://isse.cr.usgs.gov/ArcGIS/services/Baseline/ImageServer/WMSServer?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               us p
 MapType:                        photo
-MainUrl:            http://terraservice.net/ogcwms.aspx?
+MainUrl:            http://isse.cr.usgs.gov/ArcGIS/services/Baseline/ImageServer/WMSServer?
 ServiceTypeUrlPart: SERVICE=WMS
 VersionUrlPart:     VERSION=1.1.1
 CoordinateReferenceSystemCacheWolf:  4326
 CoordinateReferenceSystemUrlPart: SRS=EPSG:4326 
 RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=DOQ|USGS Digital Ortho-Quadrangles||
-#LayersUrlPart:     LAYERS=DRG|USGS Raster Graphics (Topo Maps)||
-#LayersUrlPart:     LAYERS=UrbanArea|USGS Urban Areas Ortho-Imagery||
-LayersUrlPart:     LAYERS=DOQ
+#LayersUrlPart:     LAYERS=0|IGSKMNCNGS617/baseline||
+LayersUrlPart:     LAYERS=0
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/jpeg
-BoundingBoxTopLeftWGS84: N 71.5500 W 168.6700
-BoundingBoxBottomRightWGS84: N 17.8400 W 65.1500
+ImageFormatUrlPart:FORMAT=image/png
+BoundingBoxTopLeftWGS84: N 81.9971 W 170.9250
+BoundingBoxBottomRightWGS84: N 6.2961 W 50.8429
+#BBox_Mitte: N 44.146614 W 110.883977
 MinScale:   0
-MaxScale:   45
-RecommendedScale:   5
-ImageFileExtension: .jpg
+MaxScale:   20
+RecommendedScale:    1 0.75 2
+ImageFileExtension: .png

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2011-04-16 15:09:59 UTC (rev 2982)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2011-04-19 13:59:20 UTC (rev 2983)
@@ -203,12 +203,12 @@
 		String finalMessage;
 
 		String lastS =  profile.getLast_sync_opencaching();
-		CWPoint centre = pref.getCurCentrePt(); // No need to clone curCentrePt as centre is only read
+		final CWPoint centre = pref.getCurCentrePt(); // No need to clone curCentrePt as centre is only read
 		if (!centre.isValid()) {
 			(new MessageBox("Error", "Coordinates for centre must be set", FormBase.OKB)).execute();
 			return;
 		}
-		OCXMLImporterScreen importOpt = new OCXMLImporterScreen(
+		final OCXMLImporterScreen importOpt = new OCXMLImporterScreen(
 				MyLocale.getMsg(130,"Download from opencaching"),
 				OCXMLImporterScreen.ALL |
 				OCXMLImporterScreen.DIST |
@@ -226,7 +226,7 @@
 
 		if (dist.length()== 0) return;
 
-		Double distDouble = new Double();
+		final Double distDouble = new Double();
 		distDouble.value = Common.parseDouble(dist);
 		dist = distDouble.toString(0, 1, 0).replace(',', '.');
 		//check, if distance is greater than before
@@ -294,7 +294,7 @@
 		String finalMessage = "";
 		try{
 			holder = null;
-			String target = profile.dataDir + "dummy.zip";
+			final String target = profile.dataDir + "dummy.zip";
 			UrlFetcher.fetchDataFile(address, target);
 
 			//parse
@@ -303,9 +303,9 @@
 				throw new IOException("no updates available");
 			}
 
-			ZipFile zif = new ZipFile (target);
+			final ZipFile zif = new ZipFile (target);
 			ZipEntry zipEnt;
-			Enumeration zipEnum = zif.entries();
+			final Enumeration zipEnum = zif.entries();
 			inf.setInfo("...unzipping update file");
 			while (zipEnum.hasMoreElements())
 			{
@@ -318,10 +318,10 @@
 				}
 			}
 			zif.close();
-		}catch (ZipException e){
+		}catch (final ZipException e){
 			finalMessage = MyLocale.getMsg(1614,"Error while unzipping udpate file");
 			success = false;
-		}catch (IOException e){
+		}catch (final IOException e){
 			if (e.getMessage().equalsIgnoreCase("no updates available")) { finalMessage = "No updates available"; success = false; }
 			else {
 				if (e.getMessage().equalsIgnoreCase("could not connect") ||
@@ -330,11 +330,11 @@
 				} else { finalMessage = "IOException: "+e.getMessage(); }
 				success = false;
 			}
-		}catch (IllegalArgumentException e) {
+		}catch (final IllegalArgumentException e) {
 			finalMessage = MyLocale.getMsg(1621,"Error parsing update file\n this is likely a bug in " + hostname + "\nplease try again later\n, state:")+" "+state+", waypoint: "+ holder.getWayPoint();
 			success = false;
 			pref.log("Parse error: " + state + " " + holder.getWayPoint(),e,true);
-		}catch (Exception e){ // here should be used the correct exception
+		}catch (final Exception e){ // here should be used the correct exception
 			if (holder != null)	finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: "+ holder.getWayPoint();
 			else finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: <unkown>";
 			success = false;
@@ -363,10 +363,10 @@
 		strData ="";
 
 		if (name.equals("oc11xml")){
-			Time lastSync = new Time();
+			final Time lastSync = new Time();
 			try {
 				lastSync.parse(atts.getValue("date"),"yyyy-MM-dd HH:mm:ss");
-			}catch (IllegalArgumentException e){
+			}catch (final IllegalArgumentException e){
 				pref.log("",e,true);
 			}
 			// reduce time at 1 second to avoid sync problems
@@ -409,7 +409,7 @@
 	}
 
 	public void characters(char[] ch2,int start,int length){
-		String chars = new String(ch2,start,length);
+		final String chars = new String(ch2,start,length);
 		strData += chars;
 		if (debugGPX) pref.log(strData,null);
 	}
@@ -437,13 +437,23 @@
 			//  are there more ? ;
 			if (atts.getValue("id").equals("1")) {
 				holder.setAvailable(true);
+				holder.setArchived(false);
 			} else {
 				holder.setAvailable(false);
 				if( (atts.getValue("id").equals("3")) || (atts.getValue("id").equals("6"))|| (atts.getValue("id").equals("7")) ) {
 					if (!isSyncSingle) {
-						holder=null; // holder.setArchived(true);
+						holder=null;
 						numCacheImported--;
 					}
+					else {
+						// Umsetzung wie in gpx f?r Status 6
+						if (atts.getValue("id").equals("6")) {
+							holder.setArchived(false);
+						}
+						else {
+							holder.setArchived(true);
+						}
+					}
 				}
 			}
 			return;
@@ -455,7 +465,7 @@
 
 		if(name.equals("waypoints")){
 			holder.setWayPoint(atts.getValue("oc"));
-			String CName = atts.getValue("nccom") + " " + atts.getValue("gccom");
+			final String CName = atts.getValue("nccom") + " " + atts.getValue("gccom");
 			if (!CName.equals(" ")) {
 				holder.setCacheOwner(holder.getCacheOwner() + " / " + CName.trim());
 				holder.getCacheDetails(false).attributes.add(7); // wwwlink
@@ -468,9 +478,9 @@
 			if (holder.getWayPoint().length()==0) throw new IllegalArgumentException("empty waypointname"); // this should not happen - it is likey a bug in opencaching / it happens on 27-12-2006 on cache OC143E
 			return;
 		}
-		
+
 		if (name.equals("attribute")) {
-			int id = Integer.parseInt(atts.getValue("id"));
+			final int id = Integer.parseInt(atts.getValue("id"));
 			holder.getCacheDetails(false).attributes.add(id);
 			holder.setAttribsAsBits(holder.getCacheDetails(false).attributes.getAttribsAsBits());
 			return;
@@ -511,18 +521,18 @@
 		if (holder==null) return;
 
 		inf.setInfo(MyLocale.getMsg(1612,"Importing Cachlog:")+" " + numLogImported);
-		
+
 		if (name.equals("logtype")){
 			logtype = Convert.toInt(atts.getValue("id"));
 			switch (logtype) {
 			case 1:
 				logIcon = Log.typeText2Image("Found");
 				break;
-			case 2:	
+			case 2:
 				logIcon = Log.typeText2Image("Not Found");
 				holder.setNoFindLogs((byte)(holder.getNoFindLogs()+1));
 				break;
-			case 3: 
+			case 3:
 				logIcon = Log.typeText2Image("Note");
 			}
 			loggerRecommended = atts.getValue("recommended").equals("1");
@@ -542,7 +552,7 @@
 		if(name.equals("id")){ // </id>
 			// the guid (=strData) is not part of gpx , so we use id of cacheID
 			holder = getHolder(cacheID, true); // Allocate a new CacheHolder object
-			holder.setOcCacheID(cacheID); 
+			holder.setOcCacheID(cacheID);
 			holder.getCacheDetails(false).URL = "http://" + hostname + "/viewcache.php?cacheid=" + cacheID;
 			return;
 		}
@@ -634,7 +644,7 @@
 
 			if (isHTML)	linebraek = "<br>\n";
 			else 					linebraek = "\n";
-			
+
 			     // this is set by "hint" a few lines down: if a long description is already updated, then this one is likely to be in another language
 			if (holder.is_updated())	holder.getCacheDetails(false).LongDescription += linebraek + processingDescLang + ":" +  linebraek + strData  +  linebraek;
 			else 					 	holder.getCacheDetails(false).LongDescription =              processingDescLang + ":" +  linebraek + strData  +  linebraek;
@@ -664,7 +674,7 @@
 				numLogImported++;
 				holder.getCacheDetails(false).hasUnsavedChanges = true; //chD.saveCacheDetails(profile.dataDir);
 			}
-			// 
+			//
 			if((logFinder.toLowerCase().compareTo(user) == 0 || logFinder.equalsIgnoreCase(pref.myAlias2)) && logtype == 1) {
 				if (incFinds || !holder.is_new()) {
 					// aber vorhandene werden mit gefunden aktualisiert
@@ -678,7 +688,7 @@
 					cacheDB.removeElementAt(cacheDB.getIndex(holder));
 					DBindexID.remove(holder.GetCacheID());
 					// und Dateien l?schen?
-					File tmpFile = new File(profile.dataDir + holder.getWayPoint()+".xml");
+					final File tmpFile = new File(profile.dataDir + holder.getWayPoint()+".xml");
 					tmpFile.delete();
 					// todo: was ist mit den schon heruntergeladenen Bildern?
 				}
@@ -720,7 +730,7 @@
 		if(name.equals("picture")){
 			inf.setInfo(MyLocale.getMsg(1613,"Pictures:")+" " + ++picCnt);
 			//String fileName = holder.wayPoint + "_" + picUrl.substring(picUrl.lastIndexOf("/")+1);
-			ImageInfo ii = new ImageInfo();
+			final ImageInfo ii = new ImageInfo();
 			ii.setTitle(picTitle);
 			ii.setURL(picUrl);
 			getPic(ii);
@@ -732,7 +742,7 @@
 	private CacheHolder getHolder(String guid, boolean create){// See also LOCXMLImporter
 		CacheHolder ch = null;
 		//Integer INTR = (Integer)DBindexID.get(guid);
-		String wp = (String)DBindexID.get(guid);
+		final String wp = (String)DBindexID.get(guid);
 		//if(INTR != null){
 		if(wp != null){
 			//ch = cacheDB.get(INTR.intValue());
@@ -743,13 +753,13 @@
 		return ch;
 	}
 
-	
+
 	private void getImageNamesFromDescription() {
 		String fetchUrl;
 		String imgTag;
 		String imgAltText;
-		Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enthlt keine Anfhrungszeichen
-		Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
+		final Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enthlt keine Anfhrungszeichen
+		final Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
 		imgRegexAlt.setIgnoreCase(true);
 		imgRegexUrl.setIgnoreCase(true);
 		int descIndex=0;
@@ -779,23 +789,23 @@
 				if (!fetchUrl.startsWith("http://")) {
 					fetchUrl = new URL(new URL("http://" + hostname+"/"), fetchUrl).toString();
 				}
-			} catch (MalformedURLException e) {			
-				String ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring MalformedUrlException: " + e.getMessage()+ " while downloading from URL:" + fetchUrl;
+			} catch (final MalformedURLException e) {
+				final String ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.getWayPoint() + ": ignoring MalformedUrlException: " + e.getMessage()+ " while downloading from URL:" + fetchUrl;
 				inf.addWarning("\n"+ErrMessage);
 				pref.log(ErrMessage,e);
 			}
-			ImageInfo imageInfo = new ImageInfo();
+			final ImageInfo imageInfo = new ImageInfo();
 			imageInfo.setURL(fetchUrl);
 			imageInfo.setTitle(imgAltText);
 			getPic(imageInfo);
 		}
 	}
 
-	
-	private void getPic(ImageInfo imageInfo) { // TODO handling of relativ URLs		
+
+	private void getPic(ImageInfo imageInfo) { // TODO handling of relativ URLs
 		String fileName = holder.getWayPoint() + "_" + imageInfo.getURL().substring(imageInfo.getURL().lastIndexOf('/')+1);
 		fileName = Common.ClearForFileName(fileName).toLowerCase();
-		String target = profile.dataDir + fileName;
+		final String target = profile.dataDir + fileName;
 		imageInfo.setFilename(fileName);
 		try {
 			File ftest = new FileBugfix(target);
@@ -817,7 +827,7 @@
 					}
 				}
 			}
-		} catch (IOException e) {
+		} catch (final IOException e) {
 			String ErrMessage;
 			String wp, n;
 			if (holder != null && holder.getWayPoint() != null) wp = holder.getWayPoint();
@@ -839,5 +849,5 @@
 		}
 
 	}
-	
+
 }



From araber95 at mail.berlios.de  Wed Apr 20 12:47:37 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 20 Apr 2011 12:47:37 AM +0200
Subject: [Cachewolf-svn] r2984 - trunk/res_noewe/webmapservices
Message-ID: <20110419224737.C4B9A481490@sheep.berlios.de>

Author: araber95
Date: 2011-04-20 00:47:37 +0200 (Wed, 20 Apr 2011)
New Revision: 2984

Added:
   trunk/res_noewe/webmapservices/de_t_itc.wms
Log:
wms for de (and more) osm by itc halle changed layers

Copied: trunk/res_noewe/webmapservices/de_t_itc.wms (from rev 2981, trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms)
===================================================================
--- trunk/res_noewe/webmapservices/de_t_itc.wms	                        (rev 0)
+++ trunk/res_noewe/webmapservices/de_t_itc.wms	2011-04-19 22:47:37 UTC (rev 2984)
@@ -0,0 +1,34 @@
+?TakenFromUrl:       http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&
+GetCapabilitiesUrl: http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
+Name:               de OSM(ITC Halle)  t
+MapType:                        topo
+MainUrl:            http://osmwms.itc-halle.de/maps/osmfree?
+ServiceTypeUrlPart: SERVICE=WMS
+VersionUrlPart:     VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:  31466 31467 31468 31469
+CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468 SRS=EPSG:31469 
+RequestUrlPart:     REQUEST=GetMap
+#LayersUrlPart:     LAYERS=osmwms|OpenStreetMap-WMS||
+#LayersUrlPart:     LAYERS=grenzen|Administrative Grenzen||
+#LayersUrlPart:     LAYERS=flaechen|Fl?chen (M 1:5000)||
+#LayersUrlPart:     LAYERS=gebaeude|Geb?udefl?chen (M1:50000)||
+#LayersUrlPart:     LAYERS=wasser|Wasserstrassen (M 1:100000000)||
+#LayersUrlPart:     LAYERS=schienen|Bahn (M 1:10000000)||
+#LayersUrlPart:     LAYERS=strassen|Strassen und Wege (M 1:100000000)||
+#LayersUrlPart:     LAYERS=Wanderwege|Wanderwege (M 1:100000000)|0|49890.2848429637
+#LayersUrlPart:     LAYERS=Radwanderwege|Radwanderwege_50000 (M 1:100000000)|0|49890.2848429637
+#LayersUrlPart:     LAYERS=power|Stromleitungen (M 1:100000)||
+#LayersUrlPart:     LAYERS=Funkmasten|Funkmasten||
+#LayersUrlPart:     LAYERS=Atomkraftwerke|Atomkraftwerke||
+#LayersUrlPart:     LAYERS=punkte|Punkte (M 1:20000)||
+#LayersUrlPart:     LAYERS=orte|Ortsnamen (M 1:100000000)||
+LayersUrlPart:     LAYERS=grenzen,flaechen,gebaeude,wasser,schienen,strassen,Wanderwege,Radwanderwege,orte
+StylesUrlPart:     STYLES=
+ImageFormatUrlPart:FORMAT=image/jpeg
+BoundingBoxTopLeftWGS84: N 81.8600 W 31.2600
+BoundingBoxBottomRightWGS84: N 34.8100 E 69.0700
+#BBox_Mitte: N 58.335 E 18.905
+MinScale:   0.1
+MaxScale:   180
+RecommendedScale:   5 1 2.5 10 15 30 60
+ImageFileExtension: .jpg



From araber95 at mail.berlios.de  Wed Apr 20 11:24:11 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 20 Apr 2011 11:24:11 AM +0200
Subject: [Cachewolf-svn] r2985 - trunk/res_noewe/webmapservices
Message-ID: <20110420092411.BF29B4813DD@sheep.berlios.de>

Author: araber95
Date: 2011-04-20 11:24:11 +0200 (Wed, 20 Apr 2011)
New Revision: 2985

Removed:
   trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
Log:
oh

Deleted: trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms
===================================================================
--- trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2011-04-19 22:47:37 UTC (rev 2984)
+++ trunk/res_noewe/webmapservices/de_t_osm_itc-halle.wms	2011-04-20 09:24:11 UTC (rev 2985)
@@ -1,61 +0,0 @@
-TakenFromUrl:       http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&
-GetCapabilitiesUrl: http://osmwms.itc-halle.de/maps/osmfree?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               Deutschland t SF=0..88 OSM(Server itc-halle)
-MapType:                        topo
-MainUrl:            http://osmwms.itc-halle.de/maps/osmfree?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  31466 31467 31468
-CoordinateReferenceSystemUrlPart: SRS=EPSG:31466 SRS=EPSG:31467 SRS=EPSG:31468
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=osmwms|OpenStreetMap-WMS||
-#LayersUrlPart:     LAYERS=grenzen|Administrative Grenzen (M 1:100000000)||
-#LayersUrlPart:     LAYERS=grenzen_50000|Administrative Grenzen (M 1:50000)|0|24.9451424214819
-#LayersUrlPart:     LAYERS=grenzen_200000|Administrative Grenzen (M 1:200000)|24.9451424214819|99.7805696859274
-#LayersUrlPart:     LAYERS=grenzen_400000|Administrative Grenzen (M 1:400000)|99.7805696859274|199.561139371855
-#LayersUrlPart:     LAYERS=grenzen_100000000|Administrative Grenzen (M 1:100000000)|199.561139371855|49890.2848429637
-#LayersUrlPart:     LAYERS=flaechen|Fl?chen (M 1:100000000)||
-#LayersUrlPart:     LAYERS=flaechen_5000|Fl?chen (M 1:5000)|0|2.49451424214819
-#LayersUrlPart:     LAYERS=flaechen_20000|Fl?chen (M 1:20000)|2.49451424214819|9.97805696859274
-#LayersUrlPart:     LAYERS=flaechen_100000|Fl?chen (M 1:10000)|9.97805696859274|49.8902848429637
-#LayersUrlPart:     LAYERS=flaechen_200000|Fl?chen (M 1:200000)|49.8902848429637|99.7805696859274
-#LayersUrlPart:     LAYERS=flaechen_2000000|Fl?chen (M 1:2000000)|99.7805696859274|997.805696859274
-#LayersUrlPart:     LAYERS=flaechen_100000000|Fl?chen (M 1:100000000)|997.805696859274|49890.2848429637
-#LayersUrlPart:     LAYERS=gebaeude|Geb?ude (M1:50000)|0|24.9451424214819
-#LayersUrlPart:     LAYERS=wasser|Wasserstrassen (M 1:100000000)||
-#LayersUrlPart:     LAYERS=wasser_50000|Wasserstrassen (M 1:50000)|0|24.9451424214819
-#LayersUrlPart:     LAYERS=wasser_100000|Wasserstrassen (M 1:100000)|24.9451424214819|49.8902848429637
-#LayersUrlPart:     LAYERS=wasser_200000|Wasserstrassen (M 1:200000)|49.8902848429637|99.7805696859274
-#LayersUrlPart:     LAYERS=wasser_500000|Wasserstrassen (M 1:500000)|99.7805696859274|249.451424214819
-#LayersUrlPart:     LAYERS=wasser_1000000|Wasserstrassen (M 1:1000000)|249.451424214819|498.902848429637
-#LayersUrlPart:     LAYERS=wasser_100000000|Wasserstrassen (M 1:100000000)|498.902848429637|49890.2848429637
-#LayersUrlPart:     LAYERS=schienen|Schienenwege (M 1:1000000)||
-#LayersUrlPart:     LAYERS=rail|Bahn (M 1:1000000)|0|498.902848429637
-#LayersUrlPart:     LAYERS=sbahn|S-Bahn (M 1:50000)|0|24.9451424214819
-#LayersUrlPart:     LAYERS=ubahn|U-Bahn (M 1:20000)|0|9.97805696859274
-#LayersUrlPart:     LAYERS=tram|Strassenbahn (M 1:20000)|0|9.97805696859274
-#LayersUrlPart:     LAYERS=strassen|Strassen und Wege (M 1:100000000)||
-#LayersUrlPart:     LAYERS=strassen_br|Strassen und Wege (Br?cken M 1:10000)|0|4.98902848429637
-#LayersUrlPart:     LAYERS=strassen_20000|Strassen und Wege (M 1:20000)|0|9.97805696859274
-#LayersUrlPart:     LAYERS=strassen_50000|Strassen und Wege (M 1:50000)|9.97805696859274|24.9451424214819
-#LayersUrlPart:     LAYERS=strassen_200000|Strassen und Wege (M 1:200000)|24.9451424214819|99.7805696859274
-#LayersUrlPart:     LAYERS=strassen_400000|Strassen und Wege (M 1:400000)|99.7805696859274|199.561139371855
-#LayersUrlPart:     LAYERS=strassen_1000000|Strassen und Wege (M 1:1000000)|199.561139371855|498.902848429637
-#LayersUrlPart:     LAYERS=strassen_100000000|Strassen und Wege (M 1:100000000)|498.902848429637|49890.2848429637
-#LayersUrlPart:     LAYERS=strassen_x|Strassen und Wege (bez. M 1:200000)|0|99.7805696859274
-#LayersUrlPart:     LAYERS=power|Stromleitungen (M 1:100000)|0|498.902848429637
-#LayersUrlPart:     LAYERS=punkte|Punkte (M 1:20000)|0|9.97805696859274
-#LayersUrlPart:     LAYERS=orte|Ortsnamen (M 1:100000000)|0|49890.2848429637
-#LayersUrlPart:     LAYERS=credits|Copyright||
-LayersUrlPart:     LAYERS=osmwms
-#LayersUrlPart:     LAYERS=grenzen,grenzen_50000,grenzen_200000,grenzen_400000,grenzen_100000000,flaechen,flaechen_5000,flaechen_20000,flaechen_100000,flaechen_200000,flaechen_2000000,flaechen_100000000,gebaeude,wasser,wasser_50000,wasser_100000,wasser_200000,wasser_500000,wasser_1000000,wasser_100000000,schienen,rail,sbahn,ubahn,tram,strassen,strassen_br,strassen_20000,strassen_50000,strassen_200000,strassen_400000,strassen_1000000,strassen_100000000,strassen_x,power,orte
-#LayersUrlPart:     LAYERS=grenzen_50000,flaechen_20000,gebaeude,wasser_50000,rail,sbahn,ubahn,tram,strassen_br,strassen_20000,strassen_x,power,orte
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 55.1087 E 5.2905
-BoundingBoxBottomRightWGS84: N 47.1503 E 15.3245
-#BBox_Mitte: N 51.1295 E 10.30751
-#MinScale:   0
-#MaxScale:   45
-RecommendedScale:   2,5
-ImageFileExtension: .png



From araber95 at mail.berlios.de  Wed Apr 20 07:47:30 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Wed, 20 Apr 2011 07:47:30 PM +0200
Subject: [Cachewolf-svn] r2986 - trunk/res_noewe/webmapservices
Message-ID: <20110420174730.502AD481403@sheep.berlios.de>

Author: araber95
Date: 2011-04-20 19:47:29 +0200 (Wed, 20 Apr 2011)
New Revision: 2986

Modified:
   trunk/res_noewe/webmapservices/us_p.wms
   trunk/res_noewe/webmapservices/us_t.wms
Log:
wms service us update

Modified: trunk/res_noewe/webmapservices/us_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/us_p.wms	2011-04-20 09:24:11 UTC (rev 2985)
+++ trunk/res_noewe/webmapservices/us_p.wms	2011-04-20 17:47:29 UTC (rev 2986)
@@ -1,7 +1,7 @@
 TakenFromUrl:       http://igskmncngs617.cr.usgs.gov/arcgis/services/baseline/ImageServer/WMSServer
 GetCapabilitiesUrl: http://isse.cr.usgs.gov/ArcGIS/services/Baseline/ImageServer/WMSServer?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               us p
-MapType:                        photo
+Name:               USA p
+MapType:            photo
 MainUrl:            http://isse.cr.usgs.gov/ArcGIS/services/Baseline/ImageServer/WMSServer?
 ServiceTypeUrlPart: SERVICE=WMS
 VersionUrlPart:     VERSION=1.1.1
@@ -11,11 +11,11 @@
 #LayersUrlPart:     LAYERS=0|IGSKMNCNGS617/baseline||
 LayersUrlPart:     LAYERS=0
 StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
+ImageFormatUrlPart:FORMAT=image/jpeg
 BoundingBoxTopLeftWGS84: N 81.9971 W 170.9250
 BoundingBoxBottomRightWGS84: N 6.2961 W 50.8429
 #BBox_Mitte: N 44.146614 W 110.883977
 MinScale:   0
 MaxScale:   20
-RecommendedScale:    1 0.75 2
-ImageFileExtension: .png
+RecommendedScale:    1 0.5 2
+ImageFileExtension: .jpg

Modified: trunk/res_noewe/webmapservices/us_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/us_t.wms	2011-04-20 09:24:11 UTC (rev 2985)
+++ trunk/res_noewe/webmapservices/us_t.wms	2011-04-20 17:47:29 UTC (rev 2986)
@@ -1,8 +1,8 @@
 TakenFromUrl:       http://terraservice.net/
 GetCapabilitiesUrl: http://terraservice.net/ogccapabilities.ashx?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               USA topo
-MapType:                        topo
-MainUrl:            http://terraservice.net/ogcwms.aspx?
+Name:               USA t
+MapType:            topo
+MainUrl:            http://terraservice.net/ogcmap.ashx?
 ServiceTypeUrlPart: SERVICE=WMS
 VersionUrlPart:     VERSION=1.1.1
 CoordinateReferenceSystemCacheWolf:  4326
@@ -18,5 +18,5 @@
 BoundingBoxBottomRightWGS84: N 17.8400 W 65.1500
 MinScale:   0
 MaxScale:   45
-RecommendedScale:   5
+RecommendedScale:   2.5 5 10
 ImageFileExtension: .jpg



From araber95 at mail.berlios.de  Fri Apr 22 02:41:00 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Fri, 22 Apr 2011 02:41:00 PM +0200
Subject: [Cachewolf-svn] r2987 - trunk/res_noewe/webmapservices
Message-ID: <20110422124101.1D53A48134B@sheep.berlios.de>

Author: araber95
Date: 2011-04-22 14:41:00 +0200 (Fri, 22 Apr 2011)
New Revision: 2987

Removed:
   trunk/res_noewe/webmapservices/at-1_p.wms
   trunk/res_noewe/webmapservices/at_t.wms
Log:
service not / no longer available

Deleted: trunk/res_noewe/webmapservices/at-1_p.wms
===================================================================
--- trunk/res_noewe/webmapservices/at-1_p.wms	2011-04-20 17:47:29 UTC (rev 2986)
+++ trunk/res_noewe/webmapservices/at-1_p.wms	2011-04-22 12:41:00 UTC (rev 2987)
@@ -1,66 +0,0 @@
-TakenFromUrl:       http://gis.bgld.gv.at:80/wmsconnector/com.esri.wms.Esrimap/CentropeMap?
-GetCapabilitiesUrl: http://gis.bgld.gv.at:80/wmsconnector/com.esri.wms.Esrimap/CentropeMap?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
-Name:               at.Burgenland p SF=1..10
-MapType:                        photo
-MainUrl:            http://gis.bgld.gv.at:80/wmsconnector/com.esri.wms.Esrimap/CentropeMap?
-ServiceTypeUrlPart: SERVICE=WMS
-VersionUrlPart:     VERSION=1.1.1
-CoordinateReferenceSystemCacheWolf:  31287
-CoordinateReferenceSystemUrlPart: SRS=EPSG:31287
-#      <SRS>EPSG:31256</SRS>
-#      <SRS>EPSG:31259</SRS>
-#      <SRS>EPSG:31287</SRS>
-#      <SRS>EPSG:31297</SRS>
-#      <SRS>EPSG:4326</SRS>
-#      <SRS>EPSG:4267</SRS>
-#      <SRS>EPSG:4269</SRS> 
-RequestUrlPart:     REQUEST=GetMap
-#LayersUrlPart:     LAYERS=oek50|OEK50||
-#LayersUrlPart:     LAYERS=ortho1m_farbe|Orthofoto Farbe||
-#LayersUrlPart:     LAYERS=Flugdatum_Farbe|Flugdatum Orthofoto Farbe||
-#LayersUrlPart:     LAYERS=Flugjahr_ortho|FlugjahrOrthofoto||
-#LayersUrlPart:     LAYERS=Polygondecker|Polygondecker||
-#LayersUrlPart:     LAYERS=orientierungskarte|Orientierungskarte|NaN|NaN
-#LayersUrlPart:     LAYERS=Ziel_1_Gebiet|Ziel_1_Gebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Ziel_2_Gebiet|Ziel_2_Gebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Vogelschutzrichtlinie|Vogelschutzrichtlinie (SPA)||
-#LayersUrlPart:     LAYERS=Habitatrichtlinie|Habitat-Richtlinie (PSCI)||
-#LayersUrlPart:     LAYERS=Naturpark|Naturpark||
-#LayersUrlPart:     LAYERS=Landschaftsschutzgebiet|Landschaftsschutzgebiet||
-#LayersUrlPart:     LAYERS=Nationalpark|Nationalpark||
-#LayersUrlPart:     LAYERS=Naturschutzgebiet|Naturschutzgebiet||
-#LayersUrlPart:     LAYERS=geschuetzteLandschaftsteile|geschuetzte Landschaftsteile||
-#LayersUrlPart:     LAYERS=sonstigeSchutzgebiete|sonstige Schutzgebiete||
-#LayersUrlPart:     LAYERS=Quellschongebiet|Quellschongebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Grundwasserschongebiet|Grundwasserschongebiet|NaN|99999999
-#LayersUrlPart:     LAYERS=Wasserschongebiet_allgemein|Wasserschongebiet_allgemein|NaN|99999999
-#LayersUrlPart:     LAYERS=iki|Katastropheninformation|NaN|99999999
-#LayersUrlPart:     LAYERS=Messstelle_gw|Messstelle Grundwasser|NaN|99999999
-#LayersUrlPart:     LAYERS=Messstelle_og|Messstelle Oberflaechengewaesser|NaN|99999999
-#LayersUrlPart:     LAYERS=Messstelle_ns|Messstelle Niederschlaege|NaN|99999999
-#LayersUrlPart:     LAYERS=wep|Waldentwicklungsplan|NaN|99999999
-#LayersUrlPart:     LAYERS=flu_50t|Fliessgewaesser||
-#LayersUrlPart:     LAYERS=see|Stehende Gewaesser||
-#LayersUrlPart:     LAYERS=so_str|sonstige Strasse||
-#LayersUrlPart:     LAYERS=l_str|Landesstrasse L||
-#LayersUrlPart:     LAYERS=b_str|Landesstrasse B||
-#LayersUrlPart:     LAYERS=s_str|Schnellstrasse||
-#LayersUrlPart:     LAYERS=a_str|Autobahn||
-#LayersUrlPart:     LAYERS=radwanderrouten|Radwanderrouten||
-#LayersUrlPart:     LAYERS=oertl_str|oertliches Strassennetz||
-#LayersUrlPart:     LAYERS=adressen|Adressen|NaN|99999999
-#LayersUrlPart:     LAYERS=geo_nam|geonam|NaN|NaN
-#LayersUrlPart:     LAYERS=PolitischeGemeinden|Politische Gemeinden||
-#LayersUrlPart:     LAYERS=PolitischeBezirke|Politische Bezirke||
-#LayersUrlPart:     LAYERS=Nuts3Regionen|Nuts3 Regionen|NaN|99999999
-#LayersUrlPart:     LAYERS=Landesgrenzen|Landesgrenzen||
-LayersUrlPart:     LAYERS=ortho1m_farbe,flu_50t,see,so_str,l_str,b_str,s_str,a_str,oertl_str
-StylesUrlPart:     STYLES=
-ImageFormatUrlPart:FORMAT=image/png
-BoundingBoxTopLeftWGS84: N 48.1886 E 15.9545
-BoundingBoxBottomRightWGS84: N 46.7613 E 17.2342
-#BBox_Mitte: N 47.47496561765 E 16.5943567439
-#MinScale:   0
-#MaxScale:   45
-RecommendedScale:   1
-ImageFileExtension: .png

Deleted: trunk/res_noewe/webmapservices/at_t.wms
===================================================================
--- trunk/res_noewe/webmapservices/at_t.wms	2011-04-20 17:47:29 UTC (rev 2986)
+++ trunk/res_noewe/webmapservices/at_t.wms	2011-04-22 12:41:00 UTC (rev 2987)
@@ -1,21 +0,0 @@
-TakenFromUrl:   http://www.kompass.at/community/huettenfinder/
-GetCapabilitiesUrl:   http://82.150.199.97/koogle-live.php?Service=WMS&Version=1.1.1&Request=GetCapabilities
-Name:   at kompass
-MapType:   topo
-MainUrl:   http://82.150.199.97/koogle-live.php?
-ServiceTypeUrlPart:   SERVICE=WMS
-VersionUrlPart:   VERSION=1.1.1
-#&EXCEPTIONS=application/vnd.ogc.se_inimage
-#&SRS=EPSG:900913
-CoordinateReferenceSystemCacheWolf:   4326
-CoordinateReferenceSystemUrlPart:   SRS=EPSG:4326
-RequestUrlPart:   REQUEST=GetMap
-LayersUrlPart:   LAYERS=koogle
-StylesUrlPart:   STYLES=
-ImageFormatUrlPart:   FORMAT=image/png
-BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
-BoundingBoxBottomRightWGS84:   N 46.357433 E 17.202733
-MinScale:   1
-MaxScale:   20
-RecommendedScale:   1 2 5 10
-ImageFileExtension: .png



From apreisser at mail.berlios.de  Sat Apr 23 02:26:00 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 23 Apr 2011 02:26:00 PM +0200
Subject: [Cachewolf-svn] r2988 - in trunk/src/CacheWolf: . model view
Message-ID: <20110423122600.C2F794814C9@sheep.berlios.de>

Author: apreisser
Date: 2011-04-23 14:26:00 +0200 (Sat, 23 Apr 2011)
New Revision: 2988

Added:
   trunk/src/CacheWolf/model/
   trunk/src/CacheWolf/model/TravelBugScreenModel.java
   trunk/src/CacheWolf/view/
   trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java
   trunk/src/CacheWolf/view/ewe/
   trunk/src/CacheWolf/view/pda/
Modified:
   trunk/src/CacheWolf/DateTimeChooser.java
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
Log:
More PDA-friendly TravelbugScreen implemented.
This version is in an early experimental state and and can only be activated by directly editing Your pref.xml (See Preferences.java line 791 how set MobileGui to true)

Modified: trunk/src/CacheWolf/DateTimeChooser.java
===================================================================
--- trunk/src/CacheWolf/DateTimeChooser.java	2011-04-22 12:41:00 UTC (rev 2987)
+++ trunk/src/CacheWolf/DateTimeChooser.java	2011-04-23 12:26:00 UTC (rev 2988)
@@ -62,6 +62,7 @@
 	public int hour;
 	public int minute;
 	public String time;
+	Time dateSet;
 	
 	public boolean autoAdvance = true;
 	public boolean didAll = false;
@@ -75,7 +76,7 @@
 	Control timeDisplay;
 	//Control minuteDisplay;
 
-	Time getTime() {
+	Time getDate() {
 		Time t = (Time)dateSet.getCopy();
 		t.day = day;
 		t.month = month;
@@ -84,7 +85,6 @@
 		t.minute = minute;
 		t.update();
 		return t;
-		//return new Time(day,month,year);
 	}
 	
 	void addTable(TableControl tc,TableModel tm,String pName) {
@@ -246,7 +246,6 @@
 		else super.onControlEvent(ev);
 	}
 	
-	Time dateSet;
 	
 	public void setDate(Time t) {
 		dateSet = t;
@@ -275,6 +274,30 @@
 		//dayChooser.repaintNow();
 		//monthChooser.repaintNow();
 	}
+
+	public int getDay() {		
+		return day;
+	}
+
+	public int getMonth() {
+		return month;
+	}
+
+	public int getYear() {
+		return year;
+	}
+
+	public String getTime() {
+		return time;
+	}
+
+	public int getHour() {
+		return hour;
+	}
+
+	public int getMinute() {
+		return minHeight;
+	}
 } // DateTimeChooser
 
 

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2011-04-22 12:41:00 UTC (rev 2987)
+++ trunk/src/CacheWolf/MainForm.java	2011-04-23 12:26:00 UTC (rev 2988)
@@ -83,6 +83,7 @@
 		pref.setPathToConfigFile(pathtoprefxml); // in case pathtoprefxml == null the preferences will determine the path itself
 		doIt();
 	}
+	
 	protected void checkButtons() {
 		if (pref.hasCloseButton) super.checkButtons();
 	}

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2011-04-22 12:41:00 UTC (rev 2987)
+++ trunk/src/CacheWolf/MainMenu.java	2011-04-23 12:26:00 UTC (rev 2988)
@@ -48,6 +48,7 @@
 import CacheWolf.navi.MapImporter;
 import CacheWolf.navi.MapLoaderGui;
 import CacheWolf.navi.SelectMap;
+import CacheWolf.view.TravelbugJourneyScreenFactory;
 import ewe.filechooser.FileChooser;
 import ewe.filechooser.FileChooserBase;
 import ewe.fx.Font;
@@ -736,9 +737,9 @@
 				tbp.refreshTable();
 			}
 			if(mev.selectedItem == orgTravelbugs){
-				TravelbugJourneyScreen tbs=new TravelbugJourneyScreen();
+				Form tbs=TravelbugJourneyScreenFactory.createTravelbugJourneyScreen();
 				tbs.setPreferredSize(800,600);
-				tbs.execute(); //getFrame(), Gui.CENTER_FRAME);
+				tbs.execute();
 				tbs.close(0);
 			}
 			if(mev.selectedItem == cacheTour){

Added: trunk/src/CacheWolf/model/TravelBugScreenModel.java
===================================================================
--- trunk/src/CacheWolf/model/TravelBugScreenModel.java	                        (rev 0)
+++ trunk/src/CacheWolf/model/TravelBugScreenModel.java	2011-04-23 12:26:00 UTC (rev 2988)
@@ -0,0 +1,33 @@
+package CacheWolf.model;
+
+import CacheWolf.CacheHolder;
+import CacheWolf.Global;
+import CacheWolf.TravelbugJourney;
+import CacheWolf.TravelbugJourneyList;
+import ewe.util.Vector;
+
+public class TravelBugScreenModel {
+
+	public CacheHolder actualCache;
+	public TravelbugJourneyList allTravelbugJourneys;
+	public Vector shownTravelbugJourneys = new Vector ();
+	public boolean onlyLogged;
+	public int sortCriteria;
+
+	public void toggleOnlyLogged() {
+		onlyLogged = !onlyLogged;
+		createShowSet();
+		Global.getPref().travelbugShowOnlyNonLogged = onlyLogged;
+		Global.getPref().savePreferences();
+	}
+
+	public void createShowSet() {
+		shownTravelbugJourneys.clear();
+		for (int i = 0; i < allTravelbugJourneys.size(); i++) {
+			TravelbugJourney tbJourney = allTravelbugJourneys.getTBJourney(i);
+			if (!onlyLogged || (onlyLogged && (!tbJourney.getFromLogged() || !tbJourney.getToLogged()))) {
+				shownTravelbugJourneys.add(tbJourney);
+			}
+		}
+	}
+}


Property changes on: trunk/src/CacheWolf/model/TravelBugScreenModel.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java
===================================================================
--- trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java	2011-04-23 12:26:00 UTC (rev 2988)
@@ -0,0 +1,76 @@
+package CacheWolf.view;
+
+import java.lang.reflect.Constructor;
+
+import CacheWolf.CacheDB;
+import CacheWolf.CacheHolder;
+import CacheWolf.Global;
+import CacheWolf.TravelbugJourneyList;
+import CacheWolf.model.TravelBugScreenModel;
+import CacheWolf.view.ewe.TravelbugJourneyScreen;
+import CacheWolf.view.pda.PDATravelbugJourneyScreen;
+import ewe.reflect.Reflect;
+import ewe.sys.Vm;
+import ewe.ui.Form;
+
+public class TravelbugJourneyScreenFactory {
+
+	/**
+	 * Variante fuer Desktop unter Java???
+	 */
+	private static boolean isSwing ;
+	static{
+		Global.getPref().log("Static initializer start ");
+		Class swingClass = null;
+		try {
+			swingClass = TravelbugJourneyScreen.class.getClassLoader().loadClass("javax.swing.JTable");
+		} catch (Exception e) {
+			Global.getPref().log("Swing not found");
+			Global.getPref().log(e.toString());
+			//ignore!
+		}
+		isSwing = swingClass!=null;
+	}
+
+	/**
+	 * Variante fuer Android-PDA
+	 */
+	private static final boolean isAndroid = false;
+
+	public static Form createTravelbugJourneyScreen() {
+		TravelBugScreenModel model = new TravelBugScreenModel();
+		model.onlyLogged = Global.getPref().travelbugShowOnlyNonLogged;
+		int curCacheNo = Global.mainTab.tbP.getSelectedCache();
+		CacheDB cacheDB = Global.getProfile().cacheDB;
+		CacheHolder ch = cacheDB.get(curCacheNo);
+		model.actualCache = ch;
+		TravelbugJourneyList myTravelbugJourneys = new TravelbugJourneyList();
+		myTravelbugJourneys.readTravelbugsFile();
+
+		model.allTravelbugJourneys = myTravelbugJourneys;
+
+		Global.getPref().log("Mobile-Device: " + Vm.isMobile());
+		Global.getPref().log("Preference for Mobile-Device: " + Global.getPref().mobileGUI);
+		if (Vm.isMobile() && Global.getPref().mobileGUI) {
+			try {
+				Class loadClass = Reflect.getForName("CacheWolf.view.pda.PDATravelbugJourneyScreen").getReflectedClass();
+				Constructor constructor = loadClass.getConstructor(new Class[]{model.getClass()});
+				Form result = (Form) constructor.newInstance(new Object[] {model});
+				Global.getPref().log("TBScreen successfully instantiated");
+				return result;
+			} catch (Throwable e) {
+				Global.getPref().log("CacheWolf.view.pda.PDATravelbugJourneyScreen not found");
+				Global.getPref().log("Error in instantiating TravelBugJourneyScreen", e, true);
+				e.printStackTrace();
+				//ignore?? VM on WinPC seems to have no classloader
+				return new PDATravelbugJourneyScreen(model);
+			}
+		} else if (isSwing) {
+			return new TravelbugJourneyScreen(model);
+		} else if (isAndroid) {
+			return new TravelbugJourneyScreen(model);
+		} else {
+			return new TravelbugJourneyScreen(model);
+		}
+	}
+}


Property changes on: trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain



From apreisser at mail.berlios.de  Sat Apr 23 02:28:54 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 23 Apr 2011 02:28:54 PM +0200
Subject: [Cachewolf-svn] r2989 - in trunk/src/CacheWolf/view: ewe pda
Message-ID: <20110423122854.84B044814C9@sheep.berlios.de>

Author: apreisser
Date: 2011-04-23 14:28:54 +0200 (Sat, 23 Apr 2011)
New Revision: 2989

Added:
   trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java
   trunk/src/CacheWolf/view/ewe/TravelbugMenu.java
   trunk/src/CacheWolf/view/pda/PDADateTimeChooser.java
   trunk/src/CacheWolf/view/pda/PDAEmptyButton.java
   trunk/src/CacheWolf/view/pda/PDAListButton.java
   trunk/src/CacheWolf/view/pda/PDAListButtonObject.java
   trunk/src/CacheWolf/view/pda/PDAMenu.java
   trunk/src/CacheWolf/view/pda/PDAMenuButton.java
   trunk/src/CacheWolf/view/pda/PDAMenuButtonObject.java
   trunk/src/CacheWolf/view/pda/PDAOptionPane.java
   trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java
   trunk/src/CacheWolf/view/pda/PDATravelbugDetailPanel.java
   trunk/src/CacheWolf/view/pda/PDATravelbugJourneyScreen.java
   trunk/src/CacheWolf/view/pda/PDATravelbugMenuPanel.java
   trunk/src/CacheWolf/view/pda/PDATravelbugSortMenu.java
Log:
More PDA-friendly TravelbugScreen implemented.
This version is in an early experimental state and and can only be activated by directly editing Your pref.xml (See Preferences.java line 791 how set MobileGui to true)

Copied: trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java (from rev 2879, trunk/src/CacheWolf/TravelbugJourneyScreen.java)
===================================================================
--- trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/ewe/TravelbugJourneyScreen.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,782 @@
+/*
+GNU General Public License
+CacheWolf is a software for PocketPC, Win and Linux that
+enables paperless caching.
+It supports the sites geocaching.com and opencaching.de
+
+Copyright (C) 2006  CacheWolf development team
+See http://developer.berlios.de/projects/cachewolf/
+for more information.
+Contact: 	bilbowolf at users.berlios.de
+			kalli at users.berlios.de
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; version 2 of the License.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+package CacheWolf.view.ewe;
+
+/**
+ * A list to manage the travelbugs. Each row represents one @see TravelbugJourney.
+ * The lower half of the screen which is separated from the top by a splitter bar,
+ * contains four tabs: One for the travelbug, one for the source (where the travelbug 
+ * was picked up), one for the destination (where the travelbug was dropped) and one
+ * for the mission. These tabs are used for inputting data about the travelbug journey.
+ * The travelbugs are read from file travelbugs.xml which is stored in the base directory.
+ * When the screen is closed, all data is written back to the file.
+ * @author salzkammergut
+ */
+
+import CacheWolf.CacheDB;
+import CacheWolf.CacheHolder;
+import CacheWolf.CacheHolderDetail;
+import CacheWolf.DateTimeChooser;
+import CacheWolf.Global;
+import CacheWolf.MyLocale;
+import CacheWolf.MyScrollBarPanel;
+import CacheWolf.TableColumnChooser;
+import CacheWolf.Travelbug;
+import CacheWolf.TravelbugJourney;
+import CacheWolf.TravelbugList;
+import CacheWolf.TravelbugPickup;
+import CacheWolf.imp.SpiderGC;
+import CacheWolf.model.TravelBugScreenModel;
+import CacheWolf.utils.CWWrapper;
+import ewe.fx.Color;
+import ewe.fx.Dimension;
+import ewe.fx.FontMetrics;
+import ewe.fx.IImage;
+import ewe.fx.IconAndText;
+import ewe.fx.Image;
+import ewe.fx.Point;
+import ewe.fx.Rect;
+import ewe.fx.mImage;
+import ewe.sys.Convert;
+import ewe.sys.Time;
+import ewe.sys.Vm;
+import ewe.ui.CellConstants;
+import ewe.ui.CellPanel;
+import ewe.ui.Control;
+import ewe.ui.ControlConstants;
+import ewe.ui.ControlEvent;
+import ewe.ui.DataChangeEvent;
+import ewe.ui.Event;
+import ewe.ui.Form;
+import ewe.ui.FormEvent;
+import ewe.ui.Gui;
+import ewe.ui.HtmlDisplay;
+import ewe.ui.IKeys;
+import ewe.ui.Menu;
+import ewe.ui.MenuItem;
+import ewe.ui.MultiPanelEvent;
+import ewe.ui.PanelSplitter;
+import ewe.ui.PenEvent;
+import ewe.ui.ScrollablePanel;
+import ewe.ui.SplittablePanel;
+import ewe.ui.TableCellAttributes;
+import ewe.ui.TableControl;
+import ewe.ui.TableModel;
+import ewe.ui.mButton;
+import ewe.ui.mCheckBox;
+import ewe.ui.mInput;
+import ewe.ui.mLabel;
+import ewe.ui.mTabbedPanel;
+
+public class TravelbugJourneyScreen extends Form {
+
+	// ============= VIEW
+	/** The list control */
+	// Set to Public to implement MVC-Pattern [AP]
+	public tbListControl tcTbJourneyList;
+	/** The list model */
+	// Set to Public to implement MVC-Pattern [AP]
+	public tbListTableModel modTbJourneyList;
+	/** The actual journeys */
+
+	/** The panel for the lower half of the screen */
+	private CellPanel lowerpane;
+	private mInput inpName, inpTrackingNo,
+			inpFromDate, inpFromProfile, inpFromWaypoint,
+			inpToDate, inpToProfile, inpToWaypoint;
+	private mLabel lblId;
+	private mButton btnFromDate, btnToDate;
+	private mCheckBox chkFromLogged, chkToLogged;
+	private HtmlDisplay txtMission;
+	private mTabbedPanel pnlTab;
+
+	/** The currently selected row */
+	// Set to Public to implement MVC-Pattern [AP]
+	public int selectedRow = -1;
+
+	/** A label which holds the number of currently displayed travelbug journeys */
+	private mLabel lblNumVisibleJourneys;
+	private final Color RED = new Color(255, 0, 0);
+	private int exitKeys[] = { 75009 };
+
+	// =========== CONTROLLER
+	public TravelbugMenu mnuTBMenu;
+	// ========== MODEL
+	public TravelBugScreenModel model;
+
+	/**
+	 * A flag to track whether the current cache has to be saved because a
+	 * travelbug was added to or taken from it.
+	 */
+	// Set to Public to implement MVC-Pattern [AP]
+	public boolean chDmodified = false;
+
+	// =========== MODEL
+	// Set to Public to implement MVC-Pattern [AP]
+//	public TravelbugJourneyList tblMyTravelbugJourneys;
+	/** List of TBs in the current cache */
+	// Set to Public to implement MVC-Pattern [AP]
+	public TravelbugList tblSrcCache;
+	/** The current cache */
+	// Set to Public to implement MVC-Pattern [AP]
+	public CacheHolderDetail chD;
+	/** The base data of the current cache */
+	// Set to Public to implement MVC-Pattern [AP]
+	public CacheHolder ch;
+	/** The name of the current waypoint */
+	// Set to Public to implement MVC-Pattern [AP]
+	public String waypoint = "";
+
+	public TravelbugJourneyScreen(TravelBugScreenModel newModel) {
+		model = newModel;
+		CacheDB cacheDB = Global.getProfile().cacheDB;
+		SplittablePanel split = new SplittablePanel(PanelSplitter.VERTICAL);
+		// On modern PDAs the splitter is to small to move it with the stylus.
+		// We will make it a littler thicker
+		MyLocale.setSplitterSize(split);
+		CellPanel tablepane = split.getNextPanel();
+		int curCacheNo = Global.mainTab.tbP.getSelectedCache();
+		String cache = "";
+		if (curCacheNo >= 0 && curCacheNo < cacheDB.size()) {
+			ch = cacheDB.get(curCacheNo);
+			cache = MyLocale.getMsg(6022, ": Current cache: ") + ch.getWayPoint() + " - " + ch.getCacheName();
+			waypoint = ch.getWayPoint();
+			chD = ch.getCacheDetails(true);
+			tblSrcCache = ch.getCacheDetails(true).Travelbugs;
+		}
+		title = "Travelbugs" + cache;
+		tcTbJourneyList = new tbListControl(model);
+		tcTbJourneyList.setTableModel(modTbJourneyList = new tbListTableModel());
+		tablepane.addLast(new MyScrollBarPanel(tcTbJourneyList, ScrollablePanel.AlwaysShowVerticalScrollers), STRETCH,
+				FILL);
+
+		lowerpane = split.getNextPanel();
+
+		pnlTab = new mTabbedPanel();
+		pnlTab.extraControlsRight = lblNumVisibleJourneys = new mLabel("  0");
+		// ------------------------------------------------
+		// SET Menu
+		// ------------------------------------------------
+		mnuTBMenu = new TravelbugMenu(model);
+		mnuTBMenu.view = this;
+
+		addLast(mnuTBMenu, HSTRETCH, HFILL);
+
+		// ------------------------------------------------
+		// First Tab - Name & Tracking #
+		// ------------------------------------------------
+		CellPanel pnlName = new CellPanel();
+		pnlName.addNext(new mLabel(MyLocale.getMsg(6025, "Name:")), DONTSTRETCH, DONTFILL);
+		pnlName.addLast(inpName = new mInput(), HSTRETCH, HFILL);
+		pnlName.addNext(new mLabel(MyLocale.getMsg(6026, "Tracking #:")), DONTSTRETCH, DONTFILL);
+		pnlName.addLast(inpTrackingNo = new mInput(), HSTRETCH, HFILL);
+		pnlName.addNext(new mLabel(MyLocale.getMsg(6027, "ID/GUID:")), DONTSTRETCH, DONTFILL);
+		pnlName.addLast(lblId = new mLabel(""), HSTRETCH, HFILL);
+		pnlTab.addCard(pnlName, MyLocale.getMsg(6028, "Name"), "Name");
+
+		// ------------------------------------------------
+		// Second Tab - Where was the TB picked up from
+		// ------------------------------------------------
+		CellPanel pnlFrom = new CellPanel();
+		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6029, "Profile/Cache:")), DONTSTRETCH, DONTFILL | WEST);
+		pnlFrom.addNext(inpFromProfile = new mInput(), HSTRETCH, HFILL);
+		pnlFrom.addLast(inpFromWaypoint = new mInput(), HSTRETCH, HFILL);
+
+		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6030, "Date found:")), DONTSTRETCH, DONTFILL | WEST);
+		pnlFrom.addNext(inpFromDate = new mInput(), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		pnlFrom.addLast(btnFromDate = new mButton(new mImage("calendar.png")), DONTSTRETCH, DONTFILL | WEST);
+		btnFromDate.modify(0, ControlConstants.TakesKeyFocus);
+
+		pnlFrom.addNext(new mLabel(MyLocale.getMsg(6031, "Logged:")), DONTSTRETCH, DONTFILL | WEST);
+		pnlFrom.addLast(chkFromLogged = new mCheckBox(""), DONTSTRETCH, DONTFILL | WEST);
+		chkFromLogged.exitKeys = exitKeys;
+		pnlFrom.addLast(new mLabel(""));
+
+		pnlTab.addCard(pnlFrom, MyLocale.getMsg(6032, "From"), "From");
+
+		// ------------------------------------------------
+		// Third Tab - Where was the TB dropped
+		// ------------------------------------------------
+		CellPanel pnlTo = new CellPanel();
+		pnlTo.addNext(new mLabel(MyLocale.getMsg(6029, "Profile/Cache:")), DONTSTRETCH, DONTFILL | WEST);
+		pnlTo.addNext(inpToProfile = new mInput(), HSTRETCH, HFILL);
+		pnlTo.addLast(inpToWaypoint = new mInput(), HSTRETCH, HFILL);
+
+		pnlTo.addNext(new mLabel(MyLocale.getMsg(6033, "Date dropped:")), DONTSTRETCH, DONTFILL | WEST);
+		pnlTo.addNext(inpToDate = new mInput(), CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		// inpToDate.modifyAll(DisplayOnly,0);
+		pnlTo.addLast(btnToDate = new mButton(new mImage("calendar.png")), DONTSTRETCH, DONTFILL | WEST);
+		btnToDate.modify(0, ControlConstants.TakesKeyFocus);
+		// pnlTo.addLast(new mLabel(""));
+
+		pnlTo.addNext(new mLabel(MyLocale.getMsg(6031, "Logged:")), DONTSTRETCH, DONTFILL | WEST);
+		pnlTo.addLast(chkToLogged = new mCheckBox(""), DONTSTRETCH, DONTFILL | WEST);
+		chkToLogged.exitKeys = exitKeys;
+		pnlTo.addLast(new mLabel(""));
+
+		pnlTab.addCard(pnlTo, MyLocale.getMsg(6034, "To"), "To");
+
+		// ------------------------------------------------
+		// Last Panel - TB Mission
+		// ------------------------------------------------
+		CellPanel pnlDest = new CellPanel();
+		pnlDest.addLast(new mLabel(MyLocale.getMsg(6035, "Mission:")));
+		pnlDest.addLast(txtMission = new HtmlDisplay(), STRETCH, FILL);
+		txtMission.rows = 3;
+		pnlTab.addCard(pnlDest, MyLocale.getMsg(6036, "Mission"), "Mission");
+
+		lowerpane.addLast(pnlTab, STRETCH, FILL);
+
+		split.setSplitter(PanelSplitter.AFTER | PanelSplitter.HIDDEN, PanelSplitter.BEFORE | PanelSplitter.HIDDEN, 0);
+		addLast(split, STRETCH, FILL);
+
+		modTbJourneyList.numRows = model.allTravelbugJourneys.size();
+		// Get the columns to display and their widths from preferences
+		modTbJourneyList.columnMap =
+				TableColumnChooser.str2Array(Global.getPref().travelbugColMap, 0, 11, 0, -1);
+		modTbJourneyList.colWidth =
+				TableColumnChooser.str2Array(Global.getPref().travelbugColWidth, 10, 1024, 50, -1);
+		modTbJourneyList.numCols = modTbJourneyList.columnMap.length;
+
+		modTbJourneyList.select(0, 12, true);
+		/* Restore the saved setting about showing only non-logged bugs */
+		if (Global.getPref().travelbugShowOnlyNonLogged) {
+			tcTbJourneyList.toggleNonLogged();
+		}
+		updateNumBugs();
+
+	}
+
+	/** Indicate the number of journeys currently displayed */
+	private void updateNumBugs() {
+		lblNumVisibleJourneys.setText("" + modTbJourneyList.numRows);
+		lblNumVisibleJourneys.repaint();
+	}
+
+	/** The control which had the last focus */
+	private Control currentControl;
+
+	public void onEvent(Event ev) {
+		// Update the table from the input form
+		if ((ev instanceof MultiPanelEvent || ev instanceof ControlEvent || ev instanceof DataChangeEvent)
+				&& selectedRow != -1 &&
+				selectedRow < model.allTravelbugJourneys.size()) {
+			TravelbugJourney tbj = model.allTravelbugJourneys.getTBJourney(selectedRow);
+			if (currentControl == inpName)
+				tbj.getTb().setName(inpName.getText());
+			else if (currentControl == inpTrackingNo)
+				tbj.getTb().setTrackingNo(inpTrackingNo.getText());
+			else if (currentControl == inpFromProfile)
+				tbj.setFromProfile(inpFromProfile.getText());
+			else if (currentControl == inpFromWaypoint)
+				tbj.setFromWaypoint(inpFromWaypoint.getText());
+			else if (currentControl == inpFromDate)
+				tbj.setFromDate(inpFromDate.getText());
+			else if (currentControl == chkFromLogged)
+				tbj.setFromLogged(chkFromLogged.state);
+			else if (currentControl == inpToProfile)
+				tbj.setToProfile(inpToProfile.getText());
+			else if (currentControl == inpToWaypoint)
+				tbj.setToWaypoint(inpToWaypoint.getText());
+			else if (currentControl == inpToDate)
+				tbj.setToDate(inpToDate.getText());
+			else if (currentControl == chkToLogged)
+				tbj.setToLogged(chkToLogged.state);
+			// else if (ev.target==txtMission)
+			// tb.setMission(txtMission.getText());
+			tcTbJourneyList.repaint();
+		}
+		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED && selectedRow != -1) {
+			if (ev.target == inpTrackingNo) {
+				pnlTab.selectNextTab(true, true);
+				Gui.takeFocus(inpFromProfile, ControlConstants.ByKeyboard);
+				pnlTab.repaint();
+			}
+			if (ev.target == inpFromDate)
+				Gui.takeFocus(chkFromLogged, ControlConstants.ByKeyboard);
+			if (ev.target == inpToDate)
+				Gui.takeFocus(chkToLogged, ControlConstants.ByKeyboard);
+			if (ev.target == btnFromDate || ev.target == btnToDate) {
+				mInput inpDate = ev.target == btnFromDate ? inpFromDate : inpToDate;
+				DateTimeChooser dc = new DateTimeChooser(Vm.getLocale());
+				dc.title = MyLocale.getMsg(328, "Date found");
+				dc.setPreferredSize(240, 240);
+				String foundDate = inpDate.getText();
+				Time t = new Time();
+				try {
+					t.parse(foundDate, "y-M-d H:m");
+				} catch (IllegalArgumentException e) {
+					try {
+						t.parse(foundDate, "y-M-d");
+					} catch (IllegalArgumentException e1) {
+						// Can't parse date - should not happen
+					}
+				}
+				;
+				dc.reset(t);
+				if (dc.execute() == ewe.ui.FormBase.IDOK) {
+					inpDate.setText(Convert.toString(dc.year) + "-" + MyLocale.formatLong(dc.month, "00") + "-"
+							+ MyLocale.formatLong(dc.day, "00") + " " + dc.time);
+					if (ev.target == btnFromDate) {
+						model.allTravelbugJourneys.getTBJourney(selectedRow).setFromDate(inpDate.getText());
+						Gui.takeFocus(chkFromLogged, ControlConstants.ByKeyboard);
+					} else {
+						model.allTravelbugJourneys.getTBJourney(selectedRow).setToDate(inpDate.getText());
+						Gui.takeFocus(chkToLogged, ControlConstants.ByKeyboard);
+					}
+					tcTbJourneyList.repaint();
+				}
+			}
+		}
+		if (ev instanceof ControlEvent && ev.type == ControlEvent.EXITED) {
+			pnlTab.selectNextTab(true, true);
+			if (ev.target == chkFromLogged)
+				Gui.takeFocus(inpToProfile, ControlConstants.ByKeyboard);
+			if (ev.target == chkToLogged)
+				Gui.takeFocus(txtMission, ControlConstants.ByKeyboard);
+		}
+		// The user closed the travelbugs screen
+		if (ev instanceof FormEvent && ev.type == FormEvent.CLOSED && chD != null) {
+			model.allTravelbugJourneys.saveTravelbugsFile();
+			model.allTravelbugJourneys.clear();
+			// Save the flag about showing non-logged journeys only
+			boolean old = Global.getPref().travelbugShowOnlyNonLogged;
+			Global.getPref().travelbugShowOnlyNonLogged = (tcTbJourneyList.mnuToggleList.modifiers & MenuItem.Checked) == MenuItem.Checked;
+			String travelbugColWidth = modTbJourneyList.getColWidths();
+			// If the preferences changed, save the pref.xml file
+			Vm.showWait(true);
+			if (!Global.getPref().travelbugColWidth.equals(travelbugColWidth) ||
+					old != Global.getPref().travelbugShowOnlyNonLogged) {
+				Global.getPref().travelbugColWidth = travelbugColWidth;
+				Global.getPref().savePreferences();
+			}
+			// If the list of travelbugs in the cache was modified, we need to
+			// save the cache too
+			if (chDmodified) {
+				ch.setHas_bugs(chD.Travelbugs.size() > 0);
+				ch.save();
+			}
+			Vm.showWait(false);
+			chD = null;
+		}
+		updateNumBugs();
+		currentControl = Gui.focusedControl();
+	}
+
+	// ==============================================================
+	// tbListTableModel
+	// ==============================================================
+	class tbListTableModel extends TableModel {
+		private FontMetrics fm;
+		private Image imgRed;
+
+		tbListTableModel() {
+
+			fillToEqualHeights = true;
+			allRowsSameSize = true;
+			hasRowHeaders = false;
+			// shadeAlternateRows=true;
+			cursorSize = new Dimension(12, 1);
+			clipData = true;
+			fm = getFontMetrics();
+			// A red dot indicates that the journey has not been completely
+			// logged
+			imgRed = new Image("red.png");
+		}
+
+		private int colWidth[];
+		private int columnMap[];
+
+		public Object getCellText(int row, int col) {
+			return null;
+		}
+
+		public Object getCellData(int row, int col) {
+			if (row == -1) {
+				return TravelbugJourney.getElementNameByNumber(columnMap[col]);
+			} else {
+				int map = columnMap[col];
+				// If we have not yet logged the from or the to, a red dot is
+				// placed in front of the first item
+				if (col == 0 && (!model.allTravelbugJourneys.getTBJourney(row).getFromLogged() ||
+						!model.allTravelbugJourneys.getTBJourney(row).getToLogged())) {
+					// Is it a column with a checkbox?
+					if (map != 7 && map != 11)
+						return new IconAndText((IImage) imgRed, (String) model.allTravelbugJourneys.getTBJourney(row)
+								.getElementByNumber(map), fm);
+					else { // Checkbox - special treatment
+						IconAndText iat = new IconAndText(imgRed, "", fm);
+						iat.addColumn(model.allTravelbugJourneys.getTBJourney(row).getElementByNumber(map));
+						return iat;
+					}
+				} else
+					return model.allTravelbugJourneys.getTBJourney(row).getElementByNumber(map);
+			}
+		}
+
+		public int calculateRowHeight(int row) {
+			return charHeight + 2;
+		}
+
+		public int calculateColWidth(int col) {
+			if (col == -1)
+				return 0;
+			else if (col < numCols)
+				return colWidth[columnMap[col]];
+			else
+				return 0;
+		}
+
+		public TableCellAttributes getCellAttributes(int row, int col, boolean isSelected, TableCellAttributes ta) {
+			ta = super.getCellAttributes(row, col, isSelected, ta);
+			ta.alignment = CellConstants.LEFT;
+			ta.anchor = CellConstants.LEFT;
+			// Color the elements red, if we have not yet logged
+			if (row >= 0)
+				switch (columnMap[col]) {
+				case 6: // fromDate
+					if (!model.allTravelbugJourneys.getTBJourney(row).getFromLogged())
+						ta.foreground = RED;
+					break;
+				case 10: // toDate
+					if (!model.allTravelbugJourneys.getTBJourney(row).getToLogged())
+						ta.foreground = RED;
+					break;
+				}
+			return ta;
+		}
+
+		public void showFields(TravelbugJourney tbj) {
+			inpName.setText(tbj.getTb().getName());
+			inpTrackingNo.setText(tbj.getTb().getTrackingNo());
+			lblId.setText(tbj.getTb().getGuid());
+			inpFromProfile.setText(tbj.getFromProfile());
+			inpFromWaypoint.setText(tbj.getFromWaypoint());
+			inpFromDate.setText(tbj.getFromDate());
+			chkFromLogged.setState(tbj.getFromLogged());
+			inpToProfile.setText(tbj.getToProfile());
+			inpToWaypoint.setText(tbj.getToWaypoint());
+			inpToDate.setText(tbj.getToDate());
+			chkToLogged.setState(tbj.getToLogged());
+			txtMission.setHtml(tbj.getTb().getMission());
+		}
+
+		private boolean sortAsc = false;
+		private int sortedBy = -1;
+		private int lastRow = -1;
+		public int penEventModifiers;
+
+		public boolean penPressed(Point onTable, Point cell) {
+			boolean retval = false;
+			if (cell != null && cell.y == -1) { // Hit a header => sort the
+				// table accordingly
+				Vm.showWait(true);
+				if (cell.x == sortedBy)
+					sortAsc = !sortAsc;
+				else
+					sortAsc = false;
+				sortedBy = cell.x;
+				// Check whether the list only shows non-logged journeys. If so,
+				// a subset
+				// of the table must be sorted
+				if ((tcTbJourneyList.mnuToggleList.modifiers & MenuItem.Checked) == MenuItem.Checked) {
+					model.allTravelbugJourneys.sortFirstHalf(columnMap[cell.x], sortAsc, modTbJourneyList.numRows);
+				} else { // Showing all journeys - sort the full table
+					model.allTravelbugJourneys.sort(columnMap[cell.x], sortAsc);
+				}
+				tcTbJourneyList.repaint();
+				Vm.showWait(false);
+				retval = true;
+			} else if (cell != null && cell.y >= 0 && (penEventModifiers & IKeys.SHIFT) > 0) {
+				// A range of rows can be marked by shift-click on the first and
+				// last row
+				if (lastRow != -1) { // Second row being marked with shift key
+					// pressed
+					if (lastRow < cell.y)
+						toggleSelect(lastRow, cell.y);
+					else
+						toggleSelect(cell.y, lastRow);
+					lastRow = -1;
+					retval = true;
+				} else { // Remember this row as start of range, but don't
+					// toggle yet
+					lastRow = cell.y;
+				}
+			} else { // Single row marked
+				lastRow = -1;
+			}
+			return retval;
+		}
+
+		/** Select a range of rows */
+		private void toggleSelect(int fromRow, int toRow) {
+			tcTbJourneyList.clearSelection(null);
+			tcTbJourneyList.addToSelection(new Rect(0, fromRow, numCols, toRow - fromRow + 1), false, true);
+		}
+
+		/**
+		 * Return the column widths as a comma delimited string for storing in
+		 * the preferences
+		 * 
+		 * @return
+		 */
+		private String getColWidths() {
+			// Update the list with the current widths
+			for (int col = 0; col < numCols; col++) {
+				colWidth[columnMap[col]] = getColWidth(col);
+			}
+			// Convert to string
+			StringBuffer sb = new StringBuffer(40);
+			for (int i = 0; i < colWidth.length; i++) {
+				if (sb.length() != 0)
+					sb.append(',');
+				sb.append(colWidth[i]);
+			}
+			return sb.toString();
+		}
+	}
+
+	// ==============================================================
+	// tbListControl
+	// ==============================================================
+	class tbListControl extends TableControl {
+		private MenuItem mnuNewTB, mnuDeleteTB, mnuGetMission, mnuOpenOnline, mnuDropTB, mnuPickupTB, mnuDeleteTBs;
+		public MenuItem mnuToggleList;
+		private Menu mnuFullMenu, mnuDeleteMenu;
+		private TravelBugScreenModel tbModel;
+
+		tbListControl(TravelBugScreenModel tbModel) {
+			this.tbModel = tbModel;
+			MenuItem[] TBMenuItems = new MenuItem[10];
+			TBMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(6040, "Pick up TB from current cache"));
+			TBMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6041, "Drop TB in cache"));
+			TBMenuItems[2] = new MenuItem("-");
+			TBMenuItems[3] = mnuNewTB = new MenuItem(MyLocale.getMsg(6042, "New Travelbug"));
+			TBMenuItems[4] = mnuDeleteTB = new MenuItem(MyLocale.getMsg(6043, "Delete Travelbug"));
+			TBMenuItems[5] = new MenuItem("-");
+			TBMenuItems[6] = mnuGetMission = new MenuItem(MyLocale.getMsg(6044, "Get Mission"));
+			TBMenuItems[7] = mnuOpenOnline = new MenuItem(MyLocale.getMsg(6045, "Open on-line"));
+			TBMenuItems[8] = new MenuItem("-");
+			TBMenuItems[9] = mnuToggleList = new MenuItem(MyLocale.getMsg(6046, "Show only not logged"));
+			mnuFullMenu = new Menu(TBMenuItems, "");
+			// A second pop-up menu with only one entry, if a range of rows is
+			// selected
+			MenuItem[] TBMenuItemsDel = new MenuItem[1];
+			TBMenuItemsDel[0] = mnuDeleteTBs = new MenuItem(MyLocale.getMsg(6047, "Delete selected Travelbugs"));
+			mnuDeleteMenu = new Menu(TBMenuItemsDel, "");
+			mnuDropTB.modifiers |= MenuItem.Disabled;
+			mnuDeleteTB.modifiers |= MenuItem.Disabled;
+			mnuGetMission.modifiers |= MenuItem.Disabled;
+			mnuOpenOnline.modifiers |= MenuItem.Disabled;
+		}
+
+		public void onEvent(Event ev) {
+			if (ev instanceof PenEvent) {
+				modTbJourneyList.penEventModifiers = ((PenEvent) ev).modifiers;
+			}
+
+			Rect sel = getSelection();
+			if (sel.y < tbModel.allTravelbugJourneys.size()) {
+				mnuDeleteTB.modifiers &= ~MenuItem.Disabled;
+				mnuGetMission.modifiers &= ~MenuItem.Disabled;
+				mnuOpenOnline.modifiers &= ~MenuItem.Disabled;
+				if (tbModel.allTravelbugJourneys.getTBJourney(sel.y).inMyPosession())
+					mnuDropTB.modifiers &= ~MenuItem.Disabled;
+				else
+					mnuDropTB.modifiers |= MenuItem.Disabled;
+			} else {
+				mnuDeleteTB.modifiers |= MenuItem.Disabled;
+				mnuGetMission.modifiers |= MenuItem.Disabled;
+				mnuOpenOnline.modifiers |= MenuItem.Disabled;
+			}
+			// If more than one row is selected, show the limited pop-up menu
+			if (sel.height > 1)
+				setMenu(mnuDeleteMenu);
+			else
+				setMenu(mnuFullMenu);
+			if (ev instanceof PenEvent)
+				modTbJourneyList.penEventModifiers = ((PenEvent) ev).modifiers;
+			super.onEvent(ev);
+		}
+
+		private Rect getSelection() {
+			Rect sel = getSelection(null);
+			return sel;
+		}
+
+		public void penRightReleased(Point p) {
+			menuState.doShowMenu(p, true, null); // direct call (not through
+			// doMenu) is neccesary
+			// because it will exclude
+			// the whole table
+		}
+
+		public void penHeld(Point p) {
+			menuState.doShowMenu(p, true, null);
+		}
+
+		public void popupMenuEvent(Object selectedItem) {
+			if (selectedItem == mnuPickupTB) {
+				Travelbug tb = TravelbugPickup.pickupTravelbug(tblSrcCache);
+				if (tb != null) {
+					chDmodified = true;
+					tbModel.allTravelbugJourneys.addTbPickup(tb, Global.getProfile().name, waypoint);
+					modTbJourneyList.numRows = tbModel.allTravelbugJourneys.size();
+					tcTbJourneyList.repaint();
+				}
+			}
+			if (selectedItem == mnuDropTB) {
+				if (selectedRow >= 0 && selectedRow < modTbJourneyList.numRows) {
+					Travelbug tb = tbModel.allTravelbugJourneys.getTBJourney(selectedRow).getTb();
+					chD.Travelbugs.add(tb);
+					tbModel.allTravelbugJourneys.addTbDrop(tb, Global.getProfile().name, waypoint);
+					chDmodified = true;
+					ch.setHas_bugs(true);
+				}
+				repaint();
+			}
+			if (selectedItem == mnuNewTB) {
+				TravelbugJourney tbj = new TravelbugJourney("New");
+				tbj.setFromProfile(Global.getProfile().name);
+				tbj.setFromWaypoint(waypoint);
+				tbModel.allTravelbugJourneys.add(tbj);
+				modTbJourneyList.numRows = tbModel.allTravelbugJourneys.size();
+				cursorTo(tbModel.allTravelbugJourneys.size() - 1, 1, true);
+				tcTbJourneyList.repaint();
+			}
+			if (selectedItem == mnuDeleteTB && selectedRow >= 0) {
+				tbModel.allTravelbugJourneys.remove(selectedRow);
+				modTbJourneyList.numRows = tbModel.allTravelbugJourneys.size();
+				if (selectedRow > 0)
+					cursorTo(selectedRow - 1, 0, true);
+				else
+					modTbJourneyList.showFields(new TravelbugJourney(""));
+				tcTbJourneyList.repaint();
+			}
+			/*
+			 * Delete a group of travelbugs which have been marked with
+			 * Shift-Click
+			 */
+			if (selectedItem == mnuDeleteTBs) {
+				Rect sel = getSelection();
+				for (int i = 0; i < sel.height; i++)
+					tbModel.allTravelbugJourneys.remove(sel.y);
+				modTbJourneyList.numRows = tbModel.allTravelbugJourneys.size();
+				if (sel.y < modTbJourneyList.numRows)
+					cursorTo(sel.y, 0, true);
+				else
+					modTbJourneyList.showFields(new TravelbugJourney(""));
+				tcTbJourneyList.repaint();
+			}
+			if (selectedItem == mnuGetMission && selectedRow > -1) {
+				TravelbugJourney tbj = tbModel.allTravelbugJourneys.getTBJourney(selectedRow);
+				SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+				Vm.showWait(true);
+
+				// if we have an ID, get mission by ID
+				if (tbj.getTb().getGuid().length() != 0) {
+					tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
+				} else {
+					// try to get mission and name by tracking number
+					boolean suceeded = false;
+					if (tbj.getTb().getTrackingNo().length() != 0) {
+						suceeded = spider.getBugMissionAndNameByTrackNr(tbj.getTb());
+					}
+					// if this has't worked, try to get ID by name
+					if (!suceeded) {
+						tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName().trim()));
+						// if we have an ID now, get mission by ID
+						if (tbj.getTb().getGuid().length() != 0) {
+							tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
+						}
+					}
+				}
+
+				Vm.showWait(false);
+				tcTbJourneyList.repaint();
+				txtMission.setHtml(tbj.getTb().getMission());
+				inpName.setText(tbj.getTb().getName());
+				lblId.setText(tbj.getTb().getGuid());
+				lowerpane.repaint();
+			}
+			if (selectedItem == mnuOpenOnline && selectedRow >= 0) {
+				TravelbugJourney tbj = tbModel.allTravelbugJourneys.getTBJourney(selectedRow);
+				SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+				Vm.showWait(true);
+				// First check whether ID is set, if not get it
+				if (tbj.getTb().getGuid().length() == 0)
+					tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName()));
+				if (tbj.getTb().getGuid().length() != 0) {
+					Vm.showWait(false);
+					try {
+						String s;
+						if (tbj.getTb().getGuid().length() > 10)
+							s = "http://www.geocaching.com/track/details.aspx?guid=" + tbj.getTb().getGuid();
+						else
+							s = "http://www.geocaching.com/track/details.aspx?id=" + tbj.getTb().getGuid();
+
+						CWWrapper.exec(Global.getPref().browser, s);
+						Global.getPref().log("Executed: \"" + Global.getPref().browser + "\" \"" + s + "\"");
+					} catch (Exception ioex) {
+						Global.getPref().log("Ignored Exception", ioex, true);
+					}
+				}
+			}
+			if (selectedItem == mnuToggleList) {
+				toggleNonLogged();
+			}
+			updateNumBugs();
+		}
+
+		/**
+		 * Toggle between displaying all journeys or just those which still need
+		 * to be logged
+		 */
+		public void toggleNonLogged() {
+			mnuToggleList.modifiers ^= MenuItem.Checked;
+			if ((mnuToggleList.modifiers & MenuItem.Checked) == MenuItem.Checked) {
+				// First sort the non-logged items to the top
+				tbModel.allTravelbugJourneys.sort(TravelbugJourney.BOTHLOGGED, false);
+				// modListTable.numRows=tblMyTravelbugJourneys.size();
+				modTbJourneyList.numRows = tbModel.allTravelbugJourneys.countNonLogged();
+			} else {
+				modTbJourneyList.numRows = tbModel.allTravelbugJourneys.size();
+			}
+			tcTbJourneyList.repaint();
+		}
+
+		public void cursorTo(int row, int col, boolean selectNew) {
+			super.cursorTo(row, col, selectNew);
+			selectedRow = row;
+			if (row >= 0) {
+				modTbJourneyList.showFields(tbModel.allTravelbugJourneys.getTBJourney(row));
+			} else {
+				modTbJourneyList.showFields(new TravelbugJourney(""));
+			}
+		}
+	}
+
+}

Added: trunk/src/CacheWolf/view/ewe/TravelbugMenu.java
===================================================================
--- trunk/src/CacheWolf/view/ewe/TravelbugMenu.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/ewe/TravelbugMenu.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,176 @@
+package CacheWolf.view.ewe;
+
+import CacheWolf.Global;
+import CacheWolf.MyLocale;
+import CacheWolf.Travelbug;
+import CacheWolf.TravelbugJourney;
+import CacheWolf.TravelbugList;
+import CacheWolf.TravelbugPickup;
+import CacheWolf.imp.SpiderGC;
+import CacheWolf.model.TravelBugScreenModel;
+import CacheWolf.utils.CWWrapper;
+import ewe.fx.Rect;
+import ewe.sys.Vm;
+import ewe.ui.Event;
+import ewe.ui.Menu;
+import ewe.ui.MenuBar;
+import ewe.ui.MenuEvent;
+import ewe.ui.MenuItem;
+import ewe.ui.PullDownMenu;
+
+/**
+ * Controller for the {@link TravelbugList}. Preferrably used by
+ * {@link TravelbugJourneyScreen}
+ * 
+ * @author andi
+ * 
+ */
+public class TravelbugMenu extends MenuBar {
+	private MenuItem mnuNewTB;
+	private MenuItem mnuDeleteTB;
+	private MenuItem mnuGetMission;
+	private MenuItem mnuOpenOnline;
+	private MenuItem mnuDropTB;
+	private MenuItem mnuPickupTB;
+	private MenuItem mnuDeleteTBs;
+
+	/**
+	 * The model controlled by this
+	 */
+	/**
+	 * The View displaying the model for this
+	 */
+	public TravelbugJourneyScreen view;
+	private TravelBugScreenModel model;
+
+	
+	public TravelbugMenu(TravelBugScreenModel model) {
+		this.model = model;
+		MenuItem[] TBMenuItems = new MenuItem[9];
+		TBMenuItems[0] = mnuPickupTB = new MenuItem(MyLocale.getMsg(6040, "Pick up TB from current cache"));
+		TBMenuItems[1] = mnuDropTB = new MenuItem(MyLocale.getMsg(6041, "Drop TB in cache"));
+		TBMenuItems[2] = new MenuItem("-");
+		TBMenuItems[3] = mnuNewTB = new MenuItem(MyLocale.getMsg(6042, "New Travelbug"));
+		TBMenuItems[4] = mnuDeleteTB = new MenuItem(MyLocale.getMsg(6043, "Delete Travelbug"));
+		TBMenuItems[5] = new MenuItem("-");
+		TBMenuItems[6] = mnuGetMission = new MenuItem(MyLocale.getMsg(6044, "Get Mission"));
+		TBMenuItems[7] = mnuOpenOnline = new MenuItem(MyLocale.getMsg(6045, "Open on-line"));
+		TBMenuItems[8] = new MenuItem("-");
+		// A second pop-up menu with only one entry, if a range of rows is
+		// selected
+		MenuItem[] TBMenuItemsDel = new MenuItem[1];
+		TBMenuItemsDel[0] = mnuDeleteTBs = new MenuItem(MyLocale.getMsg(6047, "Delete selected Travelbugs"));
+		// mnuDropTB.modifiers |= MenuItem.Disabled;
+		// mnuDeleteTB.modifiers |= MenuItem.Disabled;
+		// mnuGetMission.modifiers |= MenuItem.Disabled;
+		// mnuOpenOnline.modifiers |= MenuItem.Disabled;
+
+		this.addMenu(new PullDownMenu(MyLocale.getMsg(120, "Application"), new Menu(TBMenuItems, null)));
+
+	}
+
+	public void onEvent(Event event) {
+		if (event instanceof MenuEvent) {
+			MenuEvent mev = (MenuEvent) event;
+			if (mev.selectedItem == mnuPickupTB) {
+				Travelbug tb = TravelbugPickup.pickupTravelbug(view.tblSrcCache);
+				if (tb != null) {
+					view.chDmodified = true;
+					model.allTravelbugJourneys.addTbPickup(tb, Global.getProfile().name, view.waypoint);
+					view.modTbJourneyList.numRows = model.allTravelbugJourneys.size();
+					view.repaint();
+				}
+
+			} else if (mev.selectedItem == mnuDropTB) {
+				if (view.selectedRow >= 0 && view.selectedRow < view.modTbJourneyList.numRows) {
+					Travelbug tb = model.allTravelbugJourneys.getTBJourney(view.selectedRow).getTb();
+					view.chD.Travelbugs.add(tb);
+					model.allTravelbugJourneys.addTbDrop(tb, Global.getProfile().name, view.waypoint);
+					view.chDmodified = true;
+					view.ch.setHas_bugs(true);
+				}
+				view.repaint();
+			} else if (mev.selectedItem == mnuNewTB) {
+				TravelbugJourney tbj = new TravelbugJourney("New");
+				tbj.setFromProfile(Global.getProfile().name);
+				tbj.setFromWaypoint(view.waypoint);
+				model.allTravelbugJourneys.add(tbj);
+				view.modTbJourneyList.numRows = model.allTravelbugJourneys.size();
+				// view.cursorTo(view.tblMyTravelbugJourneys.size()-1,1,true);
+				view.repaint();
+			} else if (mev.selectedItem == mnuDeleteTB && view.selectedRow >= 0) {
+				model.allTravelbugJourneys.remove(view.selectedRow);
+				view.modTbJourneyList.numRows = model.allTravelbugJourneys.size();
+				if (view.selectedRow > 0) {
+					// cursorTo(view.selectedRow-1,0,true);
+				} else {
+					// view.modTbJourneyList.showFields(new
+					// TravelbugJourney(""));
+				}
+				view.repaint();
+			}
+			/*
+			 * Delete a group of travelbugs which have been marked with
+			 * Shift-Click
+			 */
+			if (mev.selectedItem == mnuDeleteTBs) {
+				Rect sel = view.tcTbJourneyList.getSelection(null);
+				for (int i = 0; i < sel.height; i++)
+					model.allTravelbugJourneys.remove(sel.y);
+				view.modTbJourneyList.numRows = model.allTravelbugJourneys.size();
+				if (sel.y < view.modTbJourneyList.numRows) {
+					// cursorTo(sel.y,0,true);
+				} else {
+					view.modTbJourneyList.showFields(new TravelbugJourney(""));
+				}
+				view.repaint();
+			} else if (mev.selectedItem == mnuGetMission && view.selectedRow > -1) {
+				TravelbugJourney tbj = model.allTravelbugJourneys.getTBJourney(view.selectedRow);
+				SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+				Vm.showWait(true);
+
+				// if we have an ID, get mission by ID
+				if (tbj.getTb().getGuid().length() != 0) {
+					tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
+				} else {
+					// try to get mission and name by tracking number
+					boolean suceeded = false;
+					if (tbj.getTb().getTrackingNo().length() != 0) {
+						suceeded = spider.getBugMissionAndNameByTrackNr(tbj.getTb());
+					}
+					// if this has't worked, try to get ID by name
+					if (!suceeded) {
+						tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName().trim()));
+						// if we have an ID now, get mission by ID
+						if (tbj.getTb().getGuid().length() != 0) {
+							tbj.getTb().setMission(spider.getBugMissionByGuid(tbj.getTb().getGuid()));
+						}
+					}
+				}
+			} else if (mev.selectedItem == mnuOpenOnline && view.selectedRow >= 0) {
+				TravelbugJourney tbj = model.allTravelbugJourneys.getTBJourney(view.selectedRow);
+				SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+				Vm.showWait(true);
+				// First check whether ID is set, if not get it
+				if (tbj.getTb().getGuid().length() == 0)
+					tbj.getTb().setGuid(spider.getBugId(tbj.getTb().getName()));
+				if (tbj.getTb().getGuid().length() != 0) {
+					Vm.showWait(false);
+					try {
+						String s;
+						if (tbj.getTb().getGuid().length() > 10)
+							s = "http://www.geocaching.com/track/details.aspx?guid=" + tbj.getTb().getGuid();
+						else
+							s = "http://www.geocaching.com/track/details.aspx?id=" + tbj.getTb().getGuid();
+
+						CWWrapper.exec(Global.getPref().browser, s);
+						Global.getPref().log("Executed: \"" + Global.getPref().browser + "\" \"" + s + "\"");
+					} catch (Exception ioex) {
+						Global.getPref().log("Ignored Exception", ioex, true);
+					}
+				}
+			}
+
+		}
+	}
+}


Property changes on: trunk/src/CacheWolf/view/ewe/TravelbugMenu.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDADateTimeChooser.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDADateTimeChooser.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDADateTimeChooser.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,253 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.MyLocale;
+import ewe.fx.Color;
+import ewe.fx.Font;
+import ewe.fx.Rect;
+import ewe.sys.Convert;
+import ewe.sys.Time;
+import ewe.ui.CellPanel;
+import ewe.ui.ControlEvent;
+import ewe.ui.Form;
+import ewe.ui.Gui;
+import ewe.ui.Panel;
+import ewe.ui.mButton;
+import ewe.ui.mLabel;
+import ewe.util.Grid;
+
+public class PDADateTimeChooser extends Form  {
+
+	private int year; 
+	private int month; 
+	private int day; 
+
+	private int hour; 
+	public int getHour() {
+		return hour;
+	}
+
+	public int getMinute() {
+		return minute;
+	}
+
+	private int minute; 
+
+	private	mLabel lbDay;
+	private mLabel lbMonth;
+	private mLabel lbYear;
+	private mLabel lbHour;
+	private mLabel lbMinute;
+	private mLabel lbSep;
+	
+	private mButton btDayUp;
+	private mButton btMonthUp;
+	private mButton btYearUp;
+	private mButton btHourUp;
+	private mButton btMinuteUp;
+
+	private mButton btDayDown;
+	private mButton btMonthDown;
+	private mButton btYearDown;
+	private mButton btHourDown;
+	private mButton btMinuteDown;
+
+	private mButton btSet;
+	private mButton btTime;
+	private mButton btCalendar;
+	private mButton btCancel;
+
+	public PDADateTimeChooser (){
+		int screenWidth = MyLocale.getScreenWidth();
+		String string = "SET TIME CANCEL";
+		int fontsize =  screenWidth/string.length();
+		Rect size = Gui.getSize(getFontMetrics(), string, 5,0);
+		while (size.width < screenWidth) {
+			fontsize += 5;
+			font = new Font(getFont().getName(), Font.BOLD,fontsize);
+			size = Gui.getSize(getFontMetrics(), string, 5, 0);
+		}
+
+		backGround = Color.White;
+
+		lbDay = new mLabel("");
+		lbDay.anchor=mLabel.CENTER;
+		lbMonth = new mLabel ("");
+		lbMonth.anchor=mLabel.CENTER;
+		lbYear = new mLabel ("");
+		lbYear.anchor=mLabel.CENTER;
+		lbHour = new mLabel ("HH");
+		lbHour.anchor=mLabel.CENTER;
+		lbSep = new mLabel(":");
+		lbMinute = new mLabel ("MM");
+		lbMinute.anchor=mLabel.CENTER;
+
+		btDayUp = new mButton (" ^^ ");btDayUp.backGround=Color.LightBlue;
+		btMonthUp = new mButton (" ^^ ");btMonthUp.backGround=Color.LightBlue;
+		btYearUp = new mButton ("  ^^  ");btYearUp.backGround=Color.LightBlue;
+		btHourUp = new mButton ("  ^^  ");btHourUp.backGround=Color.LightBlue;
+		btMinuteUp = new mButton ("  ^^  ");btMinuteUp.backGround=Color.LightBlue;
+
+		btDayDown = new mButton ("vv");btDayDown.backGround=Color.LightBlue;
+		btMonthDown = new mButton ("vv");btMonthDown.backGround=Color.LightBlue;
+		btYearDown = new mButton (" vv ");btYearDown.backGround=Color.LightBlue;
+		btHourDown = new mButton (" vv ");btHourDown.backGround=Color.LightBlue;
+		btMinuteDown = new mButton (" vv ");btMinuteDown.backGround=Color.LightBlue;
+		
+		btSet = new mButton ("Set");btSet.backGround=Color.Sand;
+		btTime = new mButton ("Time");btTime.backGround=Color.Sand;
+		btCalendar  = new mButton("Cal");btCalendar.backGround=Color.Sand;
+		btCancel = new mButton ("Cancel");btCancel.backGround=Color.Sand;
+
+		layoutCalendar();
+		
+		addListener(this);
+	}
+
+	
+	private void layoutCalendar() {
+		removeAll();
+		addNext (lbDay,HSTRETCH,HFILL);
+		addNext (lbMonth,HSTRETCH,HFILL);
+		addLast (lbYear,HSTRETCH,HFILL);
+
+		addNext (btDayUp,HSTRETCH,HFILL);
+		addNext (btMonthUp,HSTRETCH,HFILL);
+		addLast (btYearUp,HSTRETCH,HFILL);
+
+		addNext (btDayDown,HSTRETCH,HFILL);
+		addNext (btMonthDown,HSTRETCH,HFILL);
+		addLast (btYearDown,HSTRETCH,HFILL);
+		
+		addNext (btSet, HSTRETCH,CENTER|HFILL);
+		addNext (btTime, HSTRETCH,CENTER|HFILL);
+		addLast (btCancel, HSTRETCH,CENTER|HFILL);
+	}
+	
+	private void layoutTime() {
+		removeAll ();
+		Panel p = new CellPanel();
+		p.addNext (lbHour, HSTRETCH,HFILL);
+		p.addNext (lbSep,DONTSTRETCH,DONTFILL);
+		p.addLast (lbMinute, HSTRETCH,CENTER);
+		p.addNext (btHourUp, HSTRETCH,HFILL);
+		p.addNext(new mLabel(""));
+		p.addLast (btMinuteUp, HSTRETCH,HFILL);
+		p.addNext (btHourDown, HSTRETCH,HFILL);
+		p.addNext(new mLabel(""));
+		p.addLast (btMinuteDown, HSTRETCH,HFILL);
+		
+		addLast (p, HSTRETCH,HFILL);
+
+		Panel p1 = new CellPanel();
+		p1.addNext(btSet, HSTRETCH,CENTER|HFILL);
+		p1.addNext(btCalendar, HSTRETCH,CENTER|HFILL);
+		p1.addLast(btCancel, HSTRETCH,CENTER|HFILL);
+		addLast (p1, HSTRETCH,CENTER|HFILL);
+	}
+
+	public int getDay() {
+		return day;
+	}
+
+	public int getMonth() {
+		return month;
+	}
+
+	public String getTime() {
+		return Convert.toString(year) + "-" + MyLocale.formatLong(month, "00") + "-"
+		+ MyLocale.formatLong(day, "00") + " " + MyLocale.formatLong(hour, "00") +
+		":"+MyLocale.formatLong(minute, "00");
+	}
+
+	public int getYear() {
+		return year;
+	}
+
+	public void reset(Time t) {
+		year = t.year;
+		month = t.month;
+		day = t.day;
+		hour = t.hour;
+		minute=t.minute;
+
+		lbDay.setText(Integer.toString(day));
+		lbMonth.setText(Integer.toString(month));
+		lbYear.setText(Integer.toString(year));
+		lbHour.setText(Integer.toString(hour));
+		lbMinute.setText(MyLocale.formatLong(minute, "00"));
+	}
+	
+	public void onControlEvent(ControlEvent ev) {
+		switch (ev.type) {
+		case ControlEvent.PRESSED:
+			if (ev.target == btDayUp && day < 31) {
+				day++;
+				lbDay.setText(Integer.toString(day));
+			}
+			else if (ev.target == btDayDown && day > 1){
+				day--;
+				lbDay.setText(Integer.toString(day));
+			}
+			
+			else if (ev.target == btMonthUp && month < 12){
+				month++;
+				lbMonth.setText(Integer.toString(month));
+			}
+			else if (ev.target == btMonthDown && month > 1){
+				month--;
+				lbMonth.setText(Integer.toString(month));
+			}
+
+			else if (ev.target == btYearUp){
+				year++;
+				lbYear.setText(Integer.toString(year));
+			}
+			else if (ev.target == btYearDown){
+				year--;
+				lbYear.setText(Integer.toString(year));
+			}
+			
+			else if (ev.target == btHourUp && hour < 23){
+				hour++;
+				lbHour.setText(Integer.toString(hour));
+			}
+			else if (ev.target == btHourDown && hour > 0){
+				hour--;
+				lbHour.setText(Integer.toString(hour));
+			}
+			else if (ev.target == btMinuteUp && minute < 59){
+				minute++;
+				lbMinute.setText(MyLocale.formatLong(minute, "00"));
+			}
+			else if (ev.target == btMinuteDown && minute > 0){
+				minute--;
+				lbMinute.setText(MyLocale.formatLong(minute, "00"));
+			}
+
+			else if (ev.target == btSet){
+				exit(IDOK);
+			}
+			else if (ev.target == btTime){
+				Gui.flashMessage("Uhrzeit anzeigen", 1000, this, 0);
+				made=false;
+				layoutTime();
+				make(true);
+				relayoutMe(true);
+				reShow(0,0,width,height);
+			}
+			else if (ev.target == btCalendar){
+				Gui.flashMessage("Calendar anzeigen!", 1000, this, 0);
+				made=false;
+				layoutCalendar();
+				make(true);
+				relayoutMe(true);
+				reShow(0,0,width,height);				
+			}
+			else if (ev.target == btCancel){
+				exit(IDNO);
+			}
+			
+		}
+		super.onControlEvent(ev);
+	}
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDADateTimeChooser.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDAEmptyButton.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDAEmptyButton.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDAEmptyButton.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,7 @@
+package CacheWolf.view.pda;
+
+import ewe.ui.mButton;
+
+public class PDAEmptyButton extends mButton {
+
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDAEmptyButton.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDAListButton.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDAListButton.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDAListButton.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,42 @@
+package CacheWolf.view.pda;
+
+import ewe.fx.Color;
+import ewe.fx.Font;
+import ewe.ui.CellConstants;
+import ewe.ui.mButton;
+
+public class PDAListButton extends mButton {
+
+	public String fromText;
+	public String toText;
+	public boolean toLogged;
+	public boolean fromLogged;
+	
+	public PDAListButton(String newText, String newAction) {
+		super(newText);
+		action = newAction;
+		buttonObject = new PDAListButtonObject(this);
+
+		backGround = Color.White;
+		foreGround = Color.Black;
+
+		font = new Font(getFont().getName(), Font.BOLD, 40);
+		anchor = CellConstants.WEST;
+		textPosition=2;
+	}
+
+	public void make(boolean paramBoolean) {
+		if (this.buttonObject != null)
+			return;
+		this.buttonObject = new PDAListButtonObject(this);
+	}
+	
+//	public Dimension getPreferredSize(Dimension paramDimension) {
+//		Dimension size = super.getPreferredSize(paramDimension);
+//		FontMetrics fm = new FontMetrics(font, getWindow());
+//		size.height = (int)(fm.getHeight()*2.5);
+//		size.width=fm.getTextWidth(text);
+//		return size;
+//	}
+
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDAListButton.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDAListButtonObject.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDAListButtonObject.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDAListButtonObject.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,58 @@
+package CacheWolf.view.pda;
+
+import ewe.fx.Color;
+import ewe.fx.Font;
+import ewe.fx.Graphics;
+import ewe.fx.Rect;
+import ewe.ui.ButtonObject;
+
+public class PDAListButtonObject extends ButtonObject {
+	private PDAListButton pdaListButton;
+
+	public PDAListButtonObject(PDAListButton pdaListButton) {
+		super(pdaListButton);
+		this.pdaListButton = pdaListButton;
+	}
+
+	public void paint(Graphics paramGraphics) {
+		if ((this.soft) && (this.control != null))
+			this.control.doBackground(paramGraphics);
+		if (this.text == null)
+			this.text = "";
+		drawButton(paramGraphics);
+		Rect localRect1 = paramGraphics.reduceClip(new Rect(this.borderWidth, this.borderWidth, this.size.width
+				- (this.borderWidth * 2), this.size.height - (this.borderWidth * 2)));
+		try {
+			paramGraphics.setColor(foreground);
+			int x = 10;
+			if (this.image != null) {
+				int y = (size.height - image.getHeight()) / 2;
+				this.image.draw(paramGraphics, 10, y, 0);
+				x += image.getWidth();
+				x += 10;
+			}
+			paramGraphics.setFont(this.font);
+			paramGraphics.drawText(text, x, 10);
+			Font tmpFont = new Font(font.getName(), Font.BOLD, 20);
+			paramGraphics.setFont(tmpFont);
+			if (pdaListButton.fromText != null) {
+				paramGraphics.drawText(pdaListButton.fromText, x + 15, 45);
+			}
+			if (!pdaListButton.fromLogged) {
+				paramGraphics.setColor(new Color(255, 0, 0));
+				paramGraphics.fillEllipse(x, 50, 10, 10);
+				paramGraphics.setColor(foreground);
+			}
+			if (pdaListButton.toText != null) {
+				paramGraphics.drawText(pdaListButton.toText, x + 15, 70);
+			}
+			if (!pdaListButton.toLogged) {
+				paramGraphics.setColor(new Color(255, 0, 0));
+				paramGraphics.fillEllipse(x, 75, 10, 10);
+				paramGraphics.setColor(foreground);
+			}
+		} finally {
+			paramGraphics.restoreClip(localRect1);
+		}
+	}
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDAListButtonObject.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDAMenu.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDAMenu.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDAMenu.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,40 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.MyLocale;
+import ewe.ui.ControlEvent;
+import ewe.ui.Form;
+
+public abstract class PDAMenu extends Form {
+
+	protected static final String CANCEL = "__Cancel_Exit__";
+
+	public abstract void actionPerformed(String actionCommand);
+
+	public PDAMenu(){
+		setPreferredSize(MyLocale.getScreenWidth(), MyLocale.getScreenHeight());
+	}
+	
+	public void onControlEvent(ControlEvent paramEvent) {
+		switch (paramEvent.type) {
+		case ControlEvent.PRESSED:
+			if (paramEvent.action.equals(CANCEL)) {
+				exit(0);
+				
+			} else {
+				actionPerformed(paramEvent.action);
+			}
+		}
+		super.onControlEvent(paramEvent);
+	}
+
+	protected void buildMenu() {
+		PDAMenuButton button = new PDAMenuButton(MyLocale.getMsg(6057, "Back"), CANCEL);
+		addLast(button);
+	}
+
+	protected void addMenuItem(String item, String actionCommand) {
+		PDAMenuButton button = new PDAMenuButton(item, actionCommand);
+		addLast(button);
+	}
+
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDAMenu.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDAMenuButton.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDAMenuButton.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDAMenuButton.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,35 @@
+package CacheWolf.view.pda;
+
+import ewe.fx.Color;
+import ewe.fx.Font;
+import ewe.ui.CellConstants;
+import ewe.ui.mButton;
+
+public class PDAMenuButton extends mButton {
+
+	public String fromText;
+	public String toText;
+	public boolean toLogged;
+	public boolean fromLogged;
+
+	public PDAMenuButton(String newText, String newAction) {
+		super(newText);
+		action = newAction;
+
+		minHeight = 200;
+		preferredHeight=200;
+		maxHeight=200;
+		backGround = Color.Sand;
+		foreGround = Color.Black;
+
+		font = new Font(getFont().getName(), Font.BOLD, 40);
+		anchor = CellConstants.WEST;
+		textPosition = 2;
+	}
+	
+	public void make(boolean paramBoolean) {
+		if (this.buttonObject != null)
+			return;
+		this.buttonObject = new PDAMenuButtonObject(this);
+	}
+}
\ No newline at end of file


Property changes on: trunk/src/CacheWolf/view/pda/PDAMenuButton.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDAMenuButtonObject.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDAMenuButtonObject.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDAMenuButtonObject.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,24 @@
+package CacheWolf.view.pda;
+
+import ewe.fx.Dimension;
+import ewe.ui.ButtonObject;
+
+public class PDAMenuButtonObject extends ButtonObject{
+	private PDAMenuButton pdaMenuButton;
+	private Dimension calculateSize;
+
+	public PDAMenuButtonObject(PDAMenuButton pdaListButton) {
+		super(pdaListButton);
+		this.pdaMenuButton = pdaListButton;
+	}
+
+	  public Dimension calculateSize(Dimension paramDimension){
+		  calculateSize = super.calculateSize(paramDimension);
+		  if (calculateSize.height < 100){
+			  calculateSize.height=100;
+			  paramDimension.height=100;
+		  }
+		  return calculateSize;
+	  }
+
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDAMenuButtonObject.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDAOptionPane.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDAOptionPane.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDAOptionPane.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,49 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.Preferences;
+import ewe.fx.Color;
+import ewe.fx.Font;
+import ewe.ui.ControlEvent;
+import ewe.ui.Form;
+import ewe.ui.Frame;
+import ewe.ui.Gui;
+import ewe.ui.mLabel;
+
+public class PDAOptionPane extends Form {
+	public static final int CANCEL = 0;
+	public static final int OK = 1;
+	private static final String OK_STR = "OK";
+	private static final String CANCEL_STR = "CANCEL";
+
+	private int result = CANCEL;
+
+	public static int showConfirmDialog(Frame parent, String title, String message) {
+		PDAOptionPane pane = new PDAOptionPane();
+		pane.title = title;
+		pane.backGround=new Color(255,128,128);
+		Font tmpFont = new Font("Helvetica", Font.BOLD, Preferences.getPrefObject().fontSize * 2);
+		mLabel messageLabel = new mLabel(message);
+		messageLabel.font=tmpFont;
+		pane.addLast(messageLabel, HFILL, HSTRETCH);
+		PDAMenuButton button = new PDAMenuButton("OK", OK_STR);
+		pane.addNext(button, FILL, STRETCH);
+		button = new PDAMenuButton("Abbruch", CANCEL_STR);
+		pane.addLast(button, FILL, STRETCH);
+		pane.setLocation(0, 0);
+		pane.execute(null, Gui.FILL_FRAME);
+		return pane.result;
+	}
+
+	public void onControlEvent(ControlEvent event) {
+		switch (event.type) {
+		case ControlEvent.PRESSED:
+			String action = event.action;
+			if (action.equals(OK_STR)) {
+				result = OK;
+				exit(0);
+			} else if (action.equals(CANCEL_STR)) {
+				exit(0);
+			}
+		}
+	}
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDAOptionPane.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,188 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.CacheDB;
+import CacheWolf.CacheHolder;
+import CacheWolf.CacheHolderDetail;
+import CacheWolf.Global;
+import CacheWolf.MyLocale;
+import CacheWolf.Travelbug;
+import CacheWolf.TravelbugJourney;
+import CacheWolf.imp.SpiderGC;
+import CacheWolf.utils.CWWrapper;
+import ewe.sys.Vm;
+
+public class PDATravelbugDetailMenu extends PDAMenu {
+
+	private static final String BROWSER = "browser";
+
+	private static final String SPIDER = "spider";
+
+	private static final String DELETE = "delete";
+
+	private static final String EXIT = "exit";
+
+	private static final String DROP = "drop";
+
+	private PDATravelbugDetailPanel view;
+
+	private PDATravelbugJourneyScreen journeyScreen;
+
+	public PDATravelbugDetailMenu(PDATravelbugDetailPanel view, PDATravelbugJourneyScreen journeyScreen) {
+		this.view = view;
+		this.journeyScreen = journeyScreen;
+
+		setTitle("TravelBugDetail - Menu");
+
+		addMenuItem(MyLocale.getMsg(6041, "Drop TB in cache"), DROP);
+		addMenuItem(MyLocale.getMsg(6044, "Get mission (and name)"), SPIDER);
+		addMenuItem(MyLocale.getMsg(6045, "Open on-line"), BROWSER);
+		addMenuItem(MyLocale.getMsg(6043, "Delete Travelbug"), DELETE);
+		addMenuItem(MyLocale.getMsg(6061, "Close"), EXIT);
+
+		buildMenu();
+
+	}
+
+	public void actionPerformed(String action) {
+		if (action.equals(DROP)) {
+			Travelbug tb = view.getTravelbug().getTb();
+			int curCacheNo = Global.mainTab.tbP.getSelectedCache();
+			CacheDB cacheDB = Global.getProfile().cacheDB;
+			if (curCacheNo >= 0 && curCacheNo < cacheDB.size()) {
+				CacheHolder ch = cacheDB.get(curCacheNo);
+				CacheHolderDetail cacheDetails = ch.getCacheDetails(true);
+				cacheDetails.Travelbugs.add(tb);
+				journeyScreen.model.allTravelbugJourneys.addTbDrop(tb, Global.getProfile().name, ch.getWayPoint());
+				ch.setHas_bugs(true);
+				ch.save();
+				//Set Input fields to the new Values:
+				view.getInpToWaypoint().setText(view.getTravelbug().getToWaypoint());
+				view.getInpToProfile().setText(view.getTravelbug().getToProfile());
+				view.getInpToDate().setText(view.getTravelbug().getToDate());
+				//Save now. The action won't recognize the changes:
+				journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();	
+			}
+			journeyScreen.setupTBButtons();
+			exit(0);
+		} else if (action.equals(BROWSER)) {
+			SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+			Vm.showWait(true);
+			// First check whether ID is set, if not get it
+			Travelbug tb = view.getTravelbug().getTb();
+			if (tb.getGuid().length() == 0) {
+				tb.setGuid(spider.getBugId(tb.getName()));
+			}
+			if (tb.getGuid().length() != 0) {
+				Vm.showWait(false);
+				try {
+					String s;
+					if (tb.getGuid().length() > 10)
+						s = "http://www.geocaching.com/track/details.aspx?guid=" + tb.getGuid();
+					else
+						s = "http://www.geocaching.com/track/details.aspx?id=" + tb.getGuid();
+
+					CWWrapper.exec(Global.getPref().browser, s);
+					Global.getPref().log("Executed: \"" + Global.getPref().browser + "\" \"" + s + "\"");
+				} catch (Exception ioex) {
+					Global.getPref().log("Ignored Exception", ioex, true);
+				}
+			}
+			exit(0);
+		} else if (action.equals(SPIDER)) {
+			Travelbug tb = view.getTravelbug().getTb();
+			SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile());
+			Vm.showWait(true);
+
+			// if we have an ID, get mission by ID
+			if (tb.getGuid().length() != 0) {
+				tb.setMission(spider.getBugMissionByGuid(tb.getGuid()));
+			} else {
+				// try to get mission and name by tracking number
+				boolean suceeded = false;
+				if (tb.getTrackingNo().length() != 0) {
+					suceeded = spider.getBugMissionAndNameByTrackNr(tb);
+				}
+				// if this has't worked, try to get ID by name
+				if (!suceeded) {
+					tb.setGuid(spider.getBugId(tb.getName().trim()));
+					// if we have an ID now, get mission by ID
+					if (tb.getGuid().length() != 0) {
+						tb.setMission(spider.getBugMissionByGuid(tb.getGuid()));
+					}
+				}
+			}
+			journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();
+			Vm.showWait(false);
+			exit(0);
+		} else if (action.equals(DELETE)) {
+			// LOESCHEN DES TB's aus der Datenbank ist Boese!!!
+			// Erst mal eine Sicherheitesabfrage bauen:
+			int r = PDAOptionPane.showConfirmDialog(this.getFrame(), "Sind Sie Sicher???",
+					"Wollen Sie wirklich den TB l?schen??");
+			if (r == PDAOptionPane.OK) {
+				for (int i = 0; i < journeyScreen.model.allTravelbugJourneys.size(); i++) {
+					TravelbugJourney tbJourney =
+							journeyScreen.model.allTravelbugJourneys.getTBJourney(i);
+					if (tbJourney.getTb().getTrackingNo().equals(view.getTravelbug().getTb().getTrackingNo())) {
+						journeyScreen.model.allTravelbugJourneys.remove(i);
+						journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();
+						journeyScreen.setupTBButtons();
+						break;
+					}
+				}
+			}
+		} else if (action.equals(EXIT)) {
+			boolean changed = false;
+			if (!view.getInpName().text.equals(view.getTravelbug().getTb().getName())) {
+				view.getTravelbug().getTb().setName(view.getInpName().text);
+				changed = true;
+			}
+			if (!view.getInpTrackingNo().text.equals(view.getTravelbug().getTb().getTrackingNo())) {
+				view.getTravelbug().getTb().setTrackingNo(view.getInpTrackingNo().text);
+				changed = true;
+			}
+
+			if (!view.getInpFromProfile().text.equals(view.getTravelbug().getFromProfile())) {
+				view.getTravelbug().setFromProfile(view.getInpFromProfile().text);
+				changed = true;
+			}
+			if (!view.getInpFromWaypoint().text.equals(view.getTravelbug().getFromWaypoint())) {
+				view.getTravelbug().setFromWaypoint(view.getInpFromWaypoint().text);
+				changed = true;
+			}
+			if (!view.getInpFromDate().text.equals(view.getTravelbug().getFromDate())) {
+				view.getTravelbug().setFromDate(view.getInpFromDate().text);
+				changed = true;
+			}
+			if (view.getTravelbug().getFromLogged() != view.getChkFromLogged().state) {
+				view.getTravelbug().setFromLogged(view.getChkFromLogged().state);
+				changed = true;
+			}
+
+			if (!view.getInpToProfile().text.equals(view.getTravelbug().getToProfile())) {
+				view.getTravelbug().setToProfile(view.getInpToProfile().text);
+				changed = true;
+			}
+			if (!view.getInpToWaypoint().text.equals(view.getTravelbug().getToWaypoint())) {
+				view.getTravelbug().setToWaypoint(view.getInpToWaypoint().text);
+				changed = true;
+			}
+			if (!view.getInpToDate().text.equals(view.getTravelbug().getToDate())) {
+				view.getTravelbug().setToDate(view.getInpToDate().text);
+				changed = true;
+			}
+			if (view.getTravelbug().getToLogged() != view.getChkToLogged().state) {
+				view.getTravelbug().setToLogged(view.getChkToLogged().state);
+				changed = true;
+			}
+
+			if (changed) {
+				journeyScreen.model.allTravelbugJourneys.saveTravelbugsFile();
+				journeyScreen.createShowSet();
+			}
+
+			exit(1);
+		}
+	}
+
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDATravelbugDetailMenu.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDATravelbugDetailPanel.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDATravelbugDetailPanel.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDATravelbugDetailPanel.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,290 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.MyLocale;
+import CacheWolf.Preferences;
+import CacheWolf.TravelbugJourney;
+import ewe.fx.Color;
+import ewe.fx.Dimension;
+import ewe.fx.Font;
+import ewe.fx.mImage;
+import ewe.sys.Convert;
+import ewe.sys.Time;
+import ewe.sys.Vm;
+import ewe.ui.CardPanel;
+import ewe.ui.CellConstants;
+import ewe.ui.CellPanel;
+import ewe.ui.ControlConstants;
+import ewe.ui.ControlEvent;
+import ewe.ui.Form;
+import ewe.ui.Gui;
+import ewe.ui.HtmlDisplay;
+import ewe.ui.SipButton;
+import ewe.ui.WindowConstants;
+import ewe.ui.mButton;
+import ewe.ui.mCheckBox;
+import ewe.ui.mInput;
+import ewe.ui.mLabel;
+
+public class PDATravelbugDetailPanel extends Form {
+
+	private static final String MENUE = "MENUE";
+
+	private static final String BACK = "back";
+
+	private static final String FORWARD = "Vor";
+
+	private static final String FROM_DATE = "from_date";
+
+	private static final String TO_DATE = "to_date";
+
+	private TravelbugJourney travelbug;
+
+	public TravelbugJourney getTravelbug() {
+		return travelbug;
+	}
+
+	private CardPanel pnlTab;
+
+	private mInput inpName;
+
+	public mInput getInpName() {
+		return inpName;
+	}
+
+	private mInput inpTrackingNo;
+
+	public mInput getInpTrackingNo() {
+		return inpTrackingNo;
+	}
+
+	private mLabel lblId;
+
+	private mInput inpFromProfile;
+
+	public mInput getInpFromProfile() {
+		return inpFromProfile;
+	}
+
+	private mInput inpFromWaypoint;
+
+	public mInput getInpFromWaypoint() {
+		return inpFromWaypoint;
+	}
+
+	private mInput inpFromDate;
+
+	public mInput getInpFromDate() {
+		return inpFromDate;
+	}
+
+	private mButton btnFromDate;
+
+	private mCheckBox chkFromLogged;
+
+	public mCheckBox getChkFromLogged() {
+		return chkFromLogged;
+	}
+
+	private mInput inpToProfile;
+
+	public mInput getInpToProfile() {
+		return inpToProfile;
+	}
+
+	private mInput inpToWaypoint;
+
+	public mInput getInpToWaypoint() {
+		return inpToWaypoint;
+	}
+
+	private mInput inpToDate;
+
+	public mInput getInpToDate() {
+		return inpToDate;
+	}
+
+	private mButton btnToDate;
+
+	private mCheckBox chkToLogged;
+
+	public mCheckBox getChkToLogged() {
+		return chkToLogged;
+	}
+
+	private HtmlDisplay txtMission;
+
+	private PDATravelbugJourneyScreen view;
+
+	public PDATravelbugDetailPanel(TravelbugJourney tbJourney, PDATravelbugJourneyScreen view) {
+		SipButton.sipButtonSize = new Dimension(35, 40);
+		Vm.setSIP(Vm.SIP_LEAVE_BUTTON);
+		this.windowFlagsToSet = WindowConstants.FLAG_SHOW_SIP_BUTTON;
+		travelbug = tbJourney;
+		this.view = view;
+		setTitle(tbJourney.getTb().getName());
+
+		pnlTab = new CardPanel();
+		addLast(pnlTab);
+
+		// ------------------------------------------------
+		// First Tab - Name & Tracking #
+		// ------------------------------------------------
+		CellPanel pnlName = new CellPanel();
+		CellPanel panel = new CellPanel();
+		panel.backGround = Color.White;
+		panel.addNext(new mLabel(MyLocale.getMsg(6025, "Name:")), DONTSTRETCH, DONTFILL | WEST);
+		inpName = new mInput(tbJourney.getTb().getName());
+		inpName.backGround = Color.White;
+		inpName.borderStyle = BDR_OUTLINE | BF_LEFT | BF_TOP | BF_RIGHT | BF_SQUARE;
+		panel.addLast(inpName, HSTRETCH, HFILL);
+		panel.addNext(new mLabel(MyLocale.getMsg(6026, "Tracking #:")), DONTSTRETCH, DONTFILL | WEST);
+		inpTrackingNo = new mInput(tbJourney.getTb().getTrackingNo());
+		inpTrackingNo.backGround = Color.White;
+		inpTrackingNo.borderStyle = BDR_OUTLINE | BF_LEFT | BF_TOP | BF_RIGHT | BF_SQUARE;
+		panel.addLast(inpTrackingNo, HSTRETCH, HFILL);
+		panel.addNext(new mLabel(MyLocale.getMsg(6027, "ID/GUID:")), DONTSTRETCH, DONTFILL | WEST);
+		lblId = new mLabel(tbJourney.getTb().getGuid());
+		lblId.backGround = Color.White;
+		lblId.borderStyle = BDR_OUTLINE | BF_LEFT | BF_TOP | BF_RIGHT | BF_SQUARE;
+		panel.addLast(lblId, HSTRETCH, HFILL);
+		pnlName.addLast(panel, STRETCH, FILL);
+		// VON-Tab
+		mLabel label = new mLabel(MyLocale.getMsg(6058, "Retrieved:"));
+		Font tmpFont = new Font("Helvetica", Font.BOLD, Preferences.getPrefObject().fontSize * 2);
+		label.font = tmpFont;
+		panel.addLast(label, DONTSTRETCH, DONTFILL | WEST);
+		panel.addNext(new mLabel(MyLocale.getMsg(6029, "Profile/Cache:")), DONTSTRETCH, DONTFILL | WEST);
+		inpFromProfile = new mInput(tbJourney.getFromProfile());
+		panel.addNext(inpFromProfile, HSTRETCH, HFILL);
+		inpFromWaypoint = new mInput(tbJourney.getFromWaypoint());
+		panel.addLast(inpFromWaypoint, HSTRETCH, HFILL);
+
+		panel.addNext(new mLabel(MyLocale.getMsg(6059, "Date:")), DONTSTRETCH, DONTFILL | WEST);
+		inpFromDate = new mInput(tbJourney.getFromDate());
+		panel.addNext(inpFromDate, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		btnFromDate = new mButton(new mImage("calendar.png"));
+		btnFromDate.action = FROM_DATE;
+		panel.addLast(btnFromDate, DONTSTRETCH, HFILL | WEST);
+		btnFromDate.modify(0, ControlConstants.TakesKeyFocus);
+
+		panel.addNext(new mLabel(MyLocale.getMsg(6031, "Logged:")), DONTSTRETCH, DONTFILL | WEST);
+		chkFromLogged = new mCheckBox("");
+		chkFromLogged.setState(tbJourney.getFromLogged());
+		panel.addLast(chkFromLogged, DONTSTRETCH, DONTFILL | WEST);
+		chkFromLogged.exitKeys = exitKeys;
+		// To-Tab
+		label = new mLabel(MyLocale.getMsg(6060, "Dropped off:"));
+		label.font = tmpFont;
+		panel.addLast(label, DONTSTRETCH, DONTFILL | WEST);
+		panel.addNext(new mLabel(MyLocale.getMsg(6029, "Profile/Cache:")), DONTSTRETCH, DONTFILL | WEST);
+		inpToProfile = new mInput(tbJourney.getToProfile());
+		panel.addNext(inpToProfile, HSTRETCH, HFILL);
+		inpToWaypoint = new mInput(tbJourney.getToWaypoint());
+		panel.addLast(inpToWaypoint, HSTRETCH, HFILL);
+
+		panel.addNext(new mLabel(MyLocale.getMsg(6059, "Date:")), DONTSTRETCH, DONTFILL | WEST);
+		inpToDate = new mInput(tbJourney.getToDate());
+		panel.addNext(inpToDate, CellConstants.HSTRETCH, (CellConstants.HFILL | CellConstants.WEST));
+		btnToDate = new mButton(new mImage("calendar.png"));
+		btnToDate.action = TO_DATE;
+		panel.addLast(btnToDate, DONTSTRETCH, HFILL | WEST);
+		btnToDate.modify(0, ControlConstants.TakesKeyFocus);
+
+		panel.addNext(new mLabel(MyLocale.getMsg(6031, "Logged:")), DONTSTRETCH, DONTFILL | WEST);
+		chkToLogged = new mCheckBox("");
+		chkToLogged.setState(tbJourney.getToLogged());
+		panel.addLast(chkToLogged, DONTSTRETCH, DONTFILL | WEST);
+		chkToLogged.exitKeys = exitKeys;
+
+		panel = new CellPanel();
+		PDAMenuButton pdaListButton = new PDAMenuButton("<<<", BACK);
+		pdaListButton.change(ControlConstants.Disabled, 0);
+		panel.addNext(pdaListButton, HSTRETCH, HFILL);
+		panel.addNext(new PDAMenuButton(MyLocale.getMsg(6052, "MENU"), MENUE));
+		panel.addLast(new PDAMenuButton(">>>", FORWARD), HSTRETCH, HFILL);
+		pnlName.addLast(panel, HSTRETCH, HFILL);
+
+		pnlTab.addItem(pnlName, MyLocale.getMsg(6028, "Name"), "Name");
+
+		// ------------------------------------------------
+		// Last Panel - TB Mission
+		// ------------------------------------------------
+		CellPanel pnlDest = new CellPanel();
+		label = new mLabel(MyLocale.getMsg(6035, "Mission:"));
+		tmpFont = new Font("Helvetica", Font.BOLD, Preferences.getPrefObject().fontSize * 2);
+		label.setFont(tmpFont);
+		pnlDest.addLast(label, DONTSTRETCH, DONTFILL);
+		txtMission = new HtmlDisplay();
+		txtMission.setHtml(tbJourney.getTb().getMission());
+		pnlDest.addLast(txtMission, STRETCH, FILL);
+		txtMission.rows = 3;
+
+		panel = new CellPanel();
+		panel.addNext(new PDAMenuButton("<<<", BACK), HSTRETCH, HFILL);
+		panel.addNext(new PDAMenuButton(MyLocale.getMsg(6052, "MENU"), MENUE));
+		pdaListButton = new PDAMenuButton(">>>", "");
+		pdaListButton.change(ControlConstants.Disabled, 0);
+		panel.addLast(pdaListButton, HSTRETCH, HFILL);
+		panel.backGround = new Color(250, 0, 0);
+		pnlDest.addLast(panel, DONTSTRETCH, FILL);
+		pnlTab.addItem(pnlDest, MyLocale.getMsg(6036, "Mission"), "Mission");
+		SipButton.placeIn(this);
+		Gui.takeFocus(null, ControlConstants.ByKeyboard);
+	}
+
+	public void onControlEvent(ControlEvent paramEvent) {
+		switch (paramEvent.type) {
+		case ControlEvent.PRESSED:
+			String action = paramEvent.action;
+			if (action.equals(FORWARD)) {
+				pnlTab.select(pnlTab.getSelectedItem()+1);
+			} else if (action.equals(BACK)) {
+				pnlTab.select(pnlTab.getSelectedItem()-1);
+//				pnlTab.selectNextTab(false, true);
+			} else if (action.equals(MENUE)) {
+				PDATravelbugDetailMenu detailMenu = new PDATravelbugDetailMenu(this, view);
+				int execute = detailMenu.execute();
+				if (execute == 1){
+					exit(0);
+				}				
+			} else if (action.equals(FROM_DATE) || action.equals(TO_DATE)) {
+				mInput inpDate = action.equals(FROM_DATE) ? inpFromDate : inpToDate;
+				PDADateTimeChooser dc = new PDADateTimeChooser();
+				dc.setTitle(MyLocale.getMsg(328, "Date found"));
+				dc.setLocation(0, 0);
+//				dc.setPreferredSize(240, 240);
+				String foundDate = inpDate.getText();
+				Time t = new Time();
+				try {
+					t.parse(foundDate, "y-M-d H:m");
+				} catch (IllegalArgumentException e) {
+					try {
+						t.parse(foundDate, "y-M-d");
+					} catch (IllegalArgumentException e1) {
+						// Can't parse date - should not happen
+					}
+				}
+				dc.reset(t);
+				if (dc.execute() == ewe.ui.FormBase.IDOK) {
+					inpDate.setText(Convert.toString(dc.getYear ()) + "-" + MyLocale.formatLong(dc.getMonth (), "00") + "-"
+							+ MyLocale.formatLong(dc.getDay(), "00") + " " + dc.getTime() + " " + MyLocale.formatLong(dc.getHour(), "00") +
+							":"+MyLocale.formatLong(dc.getMinute(), "00"));
+				}
+			}
+		}
+	}
+
+	public void focusFirst(int paramInt) {
+		super.focusFirst(paramInt);
+		// Erst mal den Focus so setzen, dass die Tastatur nicht aufgeklappt
+		// wird.
+		// Wenn der TB noch nicht abgelegt wurde, dann den Focus auf den Button
+		// zum ablegen, sonst immer auf die Aufnahme
+		if (travelbug.getToDate().length() == 0 && travelbug.getFromDate().length() > 0) {
+			Gui.takeFocus(btnToDate, paramInt);
+
+		} else {
+			Gui.takeFocus(btnFromDate, paramInt);
+		}
+	}
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDATravelbugDetailPanel.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDATravelbugJourneyScreen.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDATravelbugJourneyScreen.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDATravelbugJourneyScreen.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,140 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.MyLocale;
+import CacheWolf.TravelbugJourney;
+import CacheWolf.model.TravelBugScreenModel;
+import ewe.graphics.AniImage;
+import ewe.sys.Vm;
+import ewe.ui.CellConstants;
+import ewe.ui.ControlEvent;
+import ewe.ui.Form;
+
+public class PDATravelbugJourneyScreen extends Form {
+	private static final String LINE = "Line";
+
+	private static final String NEXT_PAGE = "NextPage";
+
+	private static final String PREV_PAGE = "PrevPage";
+
+	private static final String MENUE = "Menue";
+
+	PDAListButton[] listButtons;
+
+	TravelBugScreenModel model;
+	// public boolean onlyLogged = false;
+	// /**
+	// * List of all travelbugs in inventory
+	// */
+	// public TravelbugJourneyList myTravelbugJourneys;
+	//
+	// private Vector tbJourneysShowSet;
+	/**
+	 * The index of the first item in the list shown
+	 */
+	private int firstLine;
+
+	private final int linesOnScreen = 7;
+
+	/**
+	 * The six visible entries in the List
+	 */
+
+	public PDATravelbugJourneyScreen(TravelBugScreenModel travelbugModel) {
+		listButtons = new PDAListButton[linesOnScreen];
+		addListener(this);
+		setTitle("TravelBugs");
+
+		model = travelbugModel;
+
+		// backgroundImage = new Image("bug_vga.gif");
+		for (int i = 0; i < model.allTravelbugJourneys.size(); i++) {
+			model.shownTravelbugJourneys.add(model.allTravelbugJourneys.getTBJourney(i));
+		}
+
+		firstLine = 0;
+		for (int i = 0; i < linesOnScreen; i++) {
+			listButtons[i] = new PDAListButton("", LINE + i);
+			addLast(listButtons[i], CellConstants.STRETCH, CellConstants.FILL);
+		}
+		model.createShowSet();
+		setupTBButtons();
+		PDAMenuButton b1 = new PDAMenuButton("<<<", PREV_PAGE);
+		addNext(b1, CellConstants.HSTRETCH, CellConstants.HFILL);
+		b1 = new PDAMenuButton(MyLocale.getMsg(6052, "MENU"), MENUE);
+		b1.anchor = 0;
+		addNext(b1, CellConstants.HSTRETCH, CellConstants.HFILL);
+		b1 = new PDAMenuButton(">>>", NEXT_PAGE);
+		b1.anchor = CellConstants.EAST;
+		addLast(b1, CellConstants.HSTRETCH, CellConstants.HFILL);
+	}
+
+	public void onControlEvent(ControlEvent ev) {
+		if (ev instanceof ControlEvent) {
+			switch (ev.type) {
+			case ControlEvent.PRESSED:
+				if (ev.action.equals(NEXT_PAGE) && model.shownTravelbugJourneys.size() > firstLine + linesOnScreen) {
+					firstLine += linesOnScreen;
+					setupTBButtons();
+				} else if (ev.action.equals(PREV_PAGE) && firstLine > 0) {
+					firstLine -= linesOnScreen;
+					if (firstLine < 0) {
+						firstLine = 0;
+					}
+					setupTBButtons();
+				} else if (ev.action.startsWith(LINE)) {
+					int line = ev.action.charAt(LINE.length()) - '0';
+					TravelbugJourney tbJourney = (TravelbugJourney) model.shownTravelbugJourneys.get(line + firstLine);
+					Form form = new PDATravelbugDetailPanel(tbJourney, this);
+					form.setPreferredSize(800, 600);
+					form.execute();
+					setupTBButtons();
+				} else if (ev.action.equals(MENUE)) {
+					Form form = new PDATravelbugMenuPanel(this);
+					form.setPreferredSize(800, 600);
+					int execute = form.execute();
+					if (execute == 1){
+						exit(0);
+					}
+					setupTBButtons();
+				}
+				break;
+			default:
+				super.onControlEvent(ev);
+			}
+		}
+	}
+
+	public void setupTBButtons() {
+		for (int i = 0; i < linesOnScreen; i++) {
+			if (i + firstLine < model.shownTravelbugJourneys.size()) {
+				TravelbugJourney tbJourney = (TravelbugJourney) model.shownTravelbugJourneys.get(i + firstLine);
+				String tbName = tbJourney.getTb().getName();
+				listButtons[i].text = tbName;
+				listButtons[i].fromText = tbJourney.getFromWaypoint() + '/' + tbJourney.getFromProfile();
+				listButtons[i].fromLogged = tbJourney.getFromLogged();
+				listButtons[i].toText = tbJourney.getToWaypoint() + '/' + tbJourney.getToProfile();
+				listButtons[i].toLogged = tbJourney.getToLogged();
+				listButtons[i].image = new AniImage("bug_vga.gif");
+			} else {
+				listButtons[i].text =
+						listButtons[i].fromText =
+								listButtons[i].toText = "";
+				listButtons[i].toLogged =
+						listButtons[i].fromLogged = true;
+				listButtons[i].image = null;
+			}
+			listButtons[i].repaint();
+		}
+	}
+
+	public void toggleOnlyLogged() {
+		model.toggleOnlyLogged();
+		firstLine = 0;
+		setupTBButtons();
+	}
+
+	public void createShowSet() {
+		firstLine = 0;
+		model.createShowSet();
+	}
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDATravelbugJourneyScreen.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDATravelbugMenuPanel.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDATravelbugMenuPanel.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDATravelbugMenuPanel.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,101 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.CacheDB;
+import CacheWolf.CacheHolder;
+import CacheWolf.CacheHolderDetail;
+import CacheWolf.Global;
+import CacheWolf.MyLocale;
+import CacheWolf.Travelbug;
+import CacheWolf.TravelbugJourney;
+import CacheWolf.TravelbugList;
+import CacheWolf.TravelbugPickup;
+import CacheWolf.view.ewe.TravelbugJourneyScreen;
+import ewe.fx.Dimension;
+
+public class PDATravelbugMenuPanel extends PDAMenu {
+
+	private static final String RETRIEVE = "retrieve";
+	private static final String TOGGLE_LOG = "toggle_log";
+	private static final String NEW_TB = "new_tb";
+	private static final String EXPERT = "expert_view";
+	private static final String SORT = "sort";
+	private static final String EXIT = "exit";
+	private PDATravelbugJourneyScreen view;
+
+	public PDATravelbugMenuPanel(PDATravelbugJourneyScreen view) {
+		this.view =view;
+		setTitle(MyLocale.getMsg(6053, "Travelbug - Menu"));
+
+		addMenuItem(view.model.onlyLogged ? MyLocale.getMsg(6054, "Show all") : MyLocale.getMsg(6046, "Show only not logged"),
+				TOGGLE_LOG);
+		addMenuItem(MyLocale.getMsg(6055, "Sort ..."), SORT);
+		addMenuItem(MyLocale.getMsg(6042, "New Travelbug"), NEW_TB);
+		addMenuItem(MyLocale.getMsg(6040, "Pick up TB from current cache"), RETRIEVE);
+		addMenuItem(MyLocale.getMsg(6056, "Expertview"), EXPERT);
+		addMenuItem(MyLocale.getMsg(6061, "Close"), EXIT);
+		buildMenu ();
+	}
+
+	public void actionPerformed(String actionCommand) {
+		if (actionCommand.equals(RETRIEVE)) {
+			int curCacheNo = Global.mainTab.tbP.getSelectedCache();
+			CacheDB cacheDB = Global.getProfile().cacheDB;
+			if (curCacheNo >= 0 && curCacheNo < cacheDB.size()) {
+				CacheHolder ch = cacheDB.get(curCacheNo);
+				String waypoint = ch.getWayPoint();
+				TravelbugList tblSrcCache = ch.getCacheDetails(true).Travelbugs;
+
+				Travelbug tb = TravelbugPickup.pickupTravelbug(tblSrcCache);
+				if (tb != null) {
+					view.model.allTravelbugJourneys.addTbPickup(tb, Global.getProfile().name, waypoint);
+					CacheHolderDetail cacheDetails = ch.getCacheDetails(true);
+					ch.setHas_bugs(cacheDetails.Travelbugs.size() > 0);
+					ch.save();
+					view.model.allTravelbugJourneys.saveTravelbugsFile();
+				}
+			}
+			view.createShowSet();
+			view.setupTBButtons();
+			exit(0);
+		} else if (actionCommand.equals(TOGGLE_LOG)) {
+			view.toggleOnlyLogged();
+			exit(0);
+		} else if (actionCommand.equals(EXPERT)) {
+			TravelbugJourneyScreen travelbugJourneyScreen = new TravelbugJourneyScreen(view.model);
+			Dimension arg0 = new Dimension();
+			getSize(arg0);
+			travelbugJourneyScreen.setPreferredSize(arg0.width, arg0.height);
+			travelbugJourneyScreen.execute();
+			exit(0);
+			view.exit(0);
+		} else if (actionCommand.equals(NEW_TB)) {
+			int curCacheNo = Global.mainTab.tbP.getSelectedCache();
+			CacheDB cacheDB = Global.getProfile().cacheDB;
+			CacheHolder ch = cacheDB.get(curCacheNo);
+			TravelbugJourney tbj = new TravelbugJourney("New");
+			tbj.setFromProfile(Global.getProfile().name);
+			tbj.setFromWaypoint("");
+			tbj.setFromLogged(true);
+			view.model.allTravelbugJourneys.add(tbj);
+			CacheHolderDetail cacheDetails = ch.getCacheDetails(true);
+			ch.setHas_bugs(cacheDetails.Travelbugs.size() > 0);
+			ch.save();
+			view.model.allTravelbugJourneys.saveTravelbugsFile();
+			view.createShowSet();
+			view.setupTBButtons();
+			exit(0);
+		} else if (actionCommand.equals(SORT)) {
+			PDATravelbugSortMenu sortMenu = new PDATravelbugSortMenu();
+			sortMenu.execute();
+			if (sortMenu.sortColumn > 0) {
+				view.model.allTravelbugJourneys.sort(sortMenu.sortColumn, sortMenu.ascending);
+				view.createShowSet();
+				view.setupTBButtons();
+			}
+			exit(0);
+		} else if (actionCommand.equals(EXIT)){
+			exit(1);
+		}
+	}
+
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDATravelbugMenuPanel.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain

Added: trunk/src/CacheWolf/view/pda/PDATravelbugSortMenu.java
===================================================================
--- trunk/src/CacheWolf/view/pda/PDATravelbugSortMenu.java	                        (rev 0)
+++ trunk/src/CacheWolf/view/pda/PDATravelbugSortMenu.java	2011-04-23 12:28:54 UTC (rev 2989)
@@ -0,0 +1,86 @@
+package CacheWolf.view.pda;
+
+import CacheWolf.MyLocale;
+import ewe.fx.Rect;
+import ewe.ui.Window;
+
+public class PDATravelbugSortMenu extends PDAMenu {
+	private static final String NAME = "name";
+	private static final String FROM_WP = "from_wp";
+	private static final String FROM_DATE = "from_date";
+	private static final String TO_WP = "to_wp";
+	private static final String TO_DATE = "to_date";
+	private static final String TRACK_NR = "track_nw";
+	private static final String EXIT = "exit";
+	public int sortColumn = -1;
+	public boolean ascending = true;
+
+	public PDATravelbugSortMenu() {
+		super();
+		PDAMenuButton button = new PDAMenuButton(MyLocale.getMsg(6028, "Name"), NAME);
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("^^", NAME + "_UP");
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("vv", NAME + "_DOWN");
+		addLast(button, HSTRETCH, HFILL);
+
+		button = new PDAMenuButton(MyLocale.getMsg(6005, "From Wpt"), FROM_WP);
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("^^", FROM_WP + "_UP");
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("vv", FROM_WP + "_DOWN");
+		addLast(button, HSTRETCH, HFILL);
+
+		button = new PDAMenuButton(MyLocale.getMsg(6006, "From Date"), FROM_DATE);
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("^^", FROM_DATE + "_UP");
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("vv", FROM_DATE + "_DOWN");
+		addLast(button, HSTRETCH, HFILL);
+
+		button = new PDAMenuButton(MyLocale.getMsg(6009, "To Wpt"), TO_WP);
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("^^", TO_WP + "_UP");
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("vv", TO_WP + "_DOWN");
+		addLast(button, HSTRETCH, HFILL);
+
+		button = new PDAMenuButton(MyLocale.getMsg(6010, "To Date"), TO_DATE);
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("^^", TO_DATE + "_UP");
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("vv", TO_DATE + "_DOWN");
+		addLast(button, HSTRETCH, HFILL);
+
+		button = new PDAMenuButton(MyLocale.getMsg(6062, "Track-No"), TRACK_NR);
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("^^", TRACK_NR + "_UP");
+		addNext(button, HSTRETCH, HFILL);
+		button = new PDAMenuButton("vv", TRACK_NR + "_DOWN");
+		addLast(button, HSTRETCH, HFILL);
+
+		button = new PDAMenuButton(MyLocale.getMsg(6057, "Back"), EXIT);
+		addLast(button);
+
+		Rect s = (Rect) Window.getGuiInfo(Window.INFO_SCREEN_RECT, null, new Rect(), 0);
+		setPreferredSize(s.width, s.height);
+	}
+
+	public void actionPerformed(String actionCommand) {
+		if (actionCommand.startsWith(NAME)) {
+			sortColumn = 1;
+		} else if (actionCommand.startsWith(FROM_WP)) {
+			sortColumn = 5;
+		} else if (actionCommand.startsWith(FROM_DATE)) {
+			sortColumn = 6;
+		} else if (actionCommand.startsWith(TO_WP)) {
+			sortColumn = 9;
+		} else if (actionCommand.startsWith(TO_DATE)) {
+			sortColumn = 10;
+		} else if (actionCommand.startsWith(TRACK_NR)) {
+			sortColumn = 2;
+		}
+		ascending = actionCommand.endsWith("DOWN");
+		exit(0);
+	}
+}


Property changes on: trunk/src/CacheWolf/view/pda/PDATravelbugSortMenu.java
___________________________________________________________________
Added: svn:mime-type
   + text/plain



From apreisser at mail.berlios.de  Sat Apr 23 04:20:41 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Sat, 23 Apr 2011 04:20:41 PM +0200
Subject: [Cachewolf-svn] r2990 - trunk/src/CacheWolf/view
Message-ID: <20110423142042.052754814C9@sheep.berlios.de>

Author: apreisser
Date: 2011-04-23 16:20:41 +0200 (Sat, 23 Apr 2011)
New Revision: 2990

Modified:
   trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java
Log:
Throw Exception on instantiatin using unsupported Toolkits

Modified: trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java
===================================================================
--- trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java	2011-04-23 12:28:54 UTC (rev 2989)
+++ trunk/src/CacheWolf/view/TravelbugJourneyScreenFactory.java	2011-04-23 14:20:41 UTC (rev 2990)
@@ -66,9 +66,9 @@
 				return new PDATravelbugJourneyScreen(model);
 			}
 		} else if (isSwing) {
-			return new TravelbugJourneyScreen(model);
+			throw new InstantiationError ("No Swing GUI available");
 		} else if (isAndroid) {
-			return new TravelbugJourneyScreen(model);
+			throw new InstantiationError ("No Android GUI available");
 		} else {
 			return new TravelbugJourneyScreen(model);
 		}



From araber95 at mail.berlios.de  Tue Apr 26 01:36:31 2011
From: araber95 at mail.berlios.de (araber95 at mail.berlios.de)
Date: Tue, 26 Apr 2011 01:36:31 PM +0200
Subject: [Cachewolf-svn] r2991 - trunk
Message-ID: <20110426113631.C906348141C@sheep.berlios.de>

Author: araber95
Date: 2011-04-26 13:36:31 +0200 (Tue, 26 Apr 2011)
New Revision: 2991

Modified:
   trunk/fwrtsnapshot.sh
Log:
script fwrtsnapshot.sh changed to new dirs

Modified: trunk/fwrtsnapshot.sh
===================================================================
--- trunk/fwrtsnapshot.sh	2011-04-23 14:20:41 UTC (rev 2990)
+++ trunk/fwrtsnapshot.sh	2011-04-26 11:36:31 UTC (rev 2991)
@@ -18,8 +18,8 @@
 rm -rf bin
 mkdir -p bin/CacheWolf
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
-    -cp lib/CompileEwe.zip:lib -d bin -deprecation -nowarn \
-    src/CacheWolf/*.java src/CacheWolf/*/*.java src/CacheWolf/navi/touchControls/*.java
+     -cp lib/CompileEwe.zip:lib -d bin -deprecation -nowarn \
+     src/CacheWolf/*.java src/CacheWolf/*/*.java src/CacheWolf/navi/touchControls/*.java src/CacheWolf/view/*/*.java	 
 javac -source 1.3 -target 1.1 -encoding windows-1252 \
     -cp ./lib/CompileEwe.zip:lib -d lib -deprecation -nowarn \
 	lib/net/ax86/*.java ./lib/org/json/*.java



From apreisser at mail.berlios.de  Wed Apr 27 07:54:09 2011
From: apreisser at mail.berlios.de (apreisser at mail.berlios.de)
Date: Wed, 27 Apr 2011 07:54:09 PM +0200
Subject: [Cachewolf-svn] r2992 - trunk
Message-ID: <20110427175409.B5B09480D2F@sheep.berlios.de>

Author: apreisser
Date: 2011-04-27 19:54:09 +0200 (Wed, 27 Apr 2011)
New Revision: 2992

Modified:
   trunk/compile.bat
Log:
Additional source directories added to compile-script

Modified: trunk/compile.bat
===================================================================
--- trunk/compile.bat	2011-04-26 11:36:31 UTC (rev 2991)
+++ trunk/compile.bat	2011-04-27 17:54:09 UTC (rev 2992)
@@ -1,4 +1,4 @@
 if not exist bin\CacheWolf mkdir bin\CacheWolf
-javac -source 1.3 -target 1.1 -cp ./lib/CompileEwe.zip;./lib/  -d ./bin/ -deprecation ./src/CacheWolf/*.java ./src/CacheWolf/imp/*.java ./src/CacheWolf/navi/*.java ./src/CacheWolf/navi/touchControls/*.java ./src/CacheWolf/exp/*.java ./src/CacheWolf/utils/*.java 
+javac -source 1.3 -target 1.1 -cp ./lib/CompileEwe.zip;./lib/  -d ./bin/ -deprecation ./src/CacheWolf/*.java ./src/CacheWolf/imp/*.java ./src/CacheWolf/navi/*.java ./src/CacheWolf/navi/touchControls/*.java ./src/CacheWolf/exp/*.java ./src/CacheWolf/utils/*.java ./src/CacheWolf/model/*.java ./src/CacheWolf/view/*.java  ./src/CacheWolf/view/ewe/*.java  ./src/CacheWolf/view/pda/*.java
 javac -source 1.3 -target 1.1 -cp ./lib/CompileEwe.zip;./lib/  -d ./lib/ -deprecation ./lib/net/ax86/*.java ./lib/org/json/*.java
-pause
\ No newline at end of file
+pause



