From salzkammergut at mail.berlios.de  Sun Jul  1 00:57:30 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Jul 2007 00:57:30 +0200
Subject: [Cachewolf-svn] r767 - trunk/resources
Message-ID: <200706302257.l5UMvUgI009454@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-01 00:57:10 +0200 (Sun, 01 Jul 2007)
New Revision: 767

Added:
   trunk/resources/notes.gif
Log:
Nachtrag zu Rev 765 - Notes Icon

Added: trunk/resources/notes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/notes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From mik77 at mail.berlios.de  Sun Jul  1 01:50:45 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 1 Jul 2007 01:50:45 +0200
Subject: [Cachewolf-svn] r768 - in trunk: resources/attributes src/CacheWolf
Message-ID: <200706302350.l5UNojBe021816@sheep.berlios.de>

Author: mik77
Date: 2007-07-01 01:49:56 +0200 (Sun, 01 Jul 2007)
New Revision: 768

Modified:
   trunk/resources/attributes/available-no.gif
   trunk/resources/attributes/available-yes.gif
   trunk/resources/attributes/bicycles-no.gif
   trunk/resources/attributes/bicycles-yes.gif
   trunk/resources/attributes/boat-no.gif
   trunk/resources/attributes/boat-yes.gif
   trunk/resources/attributes/cactus-no.gif
   trunk/resources/attributes/cactus-yes.gif
   trunk/resources/attributes/campfires-no.gif
   trunk/resources/attributes/campfires-yes.gif
   trunk/resources/attributes/camping-no.gif
   trunk/resources/attributes/camping-yes.gif
   trunk/resources/attributes/cliff-no.gif
   trunk/resources/attributes/cliff-yes.gif
   trunk/resources/attributes/climbing-no.gif
   trunk/resources/attributes/climbing-yes.gif
   trunk/resources/attributes/compass-no.gif
   trunk/resources/attributes/compass-yes.gif
   trunk/resources/attributes/cow-no.gif
   trunk/resources/attributes/cow-yes.gif
   trunk/resources/attributes/danger-no.gif
   trunk/resources/attributes/danger-yes.gif
   trunk/resources/attributes/dogs-no.gif
   trunk/resources/attributes/dogs-yes.gif
   trunk/resources/attributes/error.gif
   trunk/resources/attributes/fee-no.gif
   trunk/resources/attributes/fee-yes.gif
   trunk/resources/attributes/hiking-no.gif
   trunk/resources/attributes/hiking-yes.gif
   trunk/resources/attributes/horses-no.gif
   trunk/resources/attributes/horses-yes.gif
   trunk/resources/attributes/hunting-no.gif
   trunk/resources/attributes/hunting-yes.gif
   trunk/resources/attributes/jeeps-no.gif
   trunk/resources/attributes/jeeps-yes.gif
   trunk/resources/attributes/kids-no.gif
   trunk/resources/attributes/kids-yes.gif
   trunk/resources/attributes/mine-no.gif
   trunk/resources/attributes/mine-yes.gif
   trunk/resources/attributes/motorcycles-no.gif
   trunk/resources/attributes/motorcycles-yes.gif
   trunk/resources/attributes/night-no.gif
   trunk/resources/attributes/night-yes.gif
   trunk/resources/attributes/onehour-no.gif
   trunk/resources/attributes/onehour-yes.gif
   trunk/resources/attributes/parking-no.gif
   trunk/resources/attributes/parking-yes.gif
   trunk/resources/attributes/phone-no.gif
   trunk/resources/attributes/phone-yes.gif
   trunk/resources/attributes/picnic-no.gif
   trunk/resources/attributes/picnic-yes.gif
   trunk/resources/attributes/poisonoak-no.gif
   trunk/resources/attributes/poisonoak-yes.gif
   trunk/resources/attributes/public-no.gif
   trunk/resources/attributes/public-yes.gif
   trunk/resources/attributes/quads-no.gif
   trunk/resources/attributes/quads-yes.gif
   trunk/resources/attributes/rappelling-no.gif
   trunk/resources/attributes/rappelling-yes.gif
   trunk/resources/attributes/restrooms-no.gif
   trunk/resources/attributes/restrooms-yes.gif
   trunk/resources/attributes/scenic-no.gif
   trunk/resources/attributes/scenic-yes.gif
   trunk/resources/attributes/scuba-no.gif
   trunk/resources/attributes/scuba-yes.gif
   trunk/resources/attributes/snakes-no.gif
   trunk/resources/attributes/snakes-yes.gif
   trunk/resources/attributes/snowmobiles-no.gif
   trunk/resources/attributes/snowmobiles-yes.gif
   trunk/resources/attributes/stealth-no.gif
   trunk/resources/attributes/stealth-yes.gif
   trunk/resources/attributes/stroller-no.gif
   trunk/resources/attributes/stroller-yes.gif
   trunk/resources/attributes/swimming-no.gif
   trunk/resources/attributes/swimming-yes.gif
   trunk/resources/attributes/thorn-no.gif
   trunk/resources/attributes/thorn-yes.gif
   trunk/resources/attributes/ticks-no.gif
   trunk/resources/attributes/ticks-yes.gif
   trunk/resources/attributes/wading-no.gif
   trunk/resources/attributes/wading-yes.gif
   trunk/resources/attributes/water-no.gif
   trunk/resources/attributes/water-yes.gif
   trunk/resources/attributes/wheelchair-no.gif
   trunk/resources/attributes/wheelchair-yes.gif
   trunk/resources/attributes/winter-no.gif
   trunk/resources/attributes/winter-yes.gif
   trunk/src/CacheWolf/AttributesViewer.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/NotesScreen.java
Log:
- Anpassung an D/T im DetailsPanel um horizontales Scrollen auf PDA zu verhindern

- Verkleinerung der Attribut-Icons um vertikales Scrollen auf dem PDA zu verhindern

- ResizeOnSIP f?\195?\188r NotesScreen

Modified: trunk/resources/attributes/available-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/available-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/bicycles-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/bicycles-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/boat-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/boat-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/cactus-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/cactus-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/campfires-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/campfires-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/camping-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/camping-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/cliff-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/cliff-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/climbing-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/climbing-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/compass-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/compass-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/cow-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/cow-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/danger-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/danger-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/dogs-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/dogs-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/error.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/fee-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/fee-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/hiking-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/hiking-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/horses-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/horses-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/hunting-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/hunting-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/jeeps-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/jeeps-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/kids-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/kids-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/mine-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/mine-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/motorcycles-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/motorcycles-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/night-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/night-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/onehour-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/onehour-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/parking-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/parking-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/phone-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/phone-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/picnic-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/picnic-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/poisonoak-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/poisonoak-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/public-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/public-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/quads-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/quads-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/rappelling-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/rappelling-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/restrooms-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/restrooms-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/scenic-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/scenic-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/scuba-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/scuba-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/snakes-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/snakes-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/snowmobiles-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/snowmobiles-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/stealth-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/stealth-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/stroller-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/stroller-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/swimming-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/swimming-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/thorn-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/thorn-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/ticks-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/ticks-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/wading-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/wading-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/water-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/water-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/wheelchair-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/wheelchair-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/winter-no.gif
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/winter-yes.gif
===================================================================
(Binary files differ)

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2007-06-30 22:57:10 UTC (rev 767)
+++ trunk/src/CacheWolf/AttributesViewer.java	2007-06-30 23:49:56 UTC (rev 768)
@@ -8,7 +8,7 @@
 public class AttributesViewer extends CellPanel {
 	private final static int ICONS_PER_ROW=6;
 	private final static int ICONROWS=2;
-	private static int TILESIZE=32;
+	private static int TILESIZE=22;
 	private mLabel mInfo;
 
 	private class attInteractivePanel extends InteractivePanel {
@@ -20,7 +20,7 @@
 			return true;
 		}
 		public boolean imageMovedOff(AniImage which) {
-			mInfo.setText(MyLocale.getMsg(2600,"Attributes:"));
+			mInfo.setText("");
 			mInfo.repaintNow();
 			return true;
 		}
@@ -37,8 +37,8 @@
 		Rect r = new Rect(0,0,TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS); // As on GC: 6 wide, 2 high
 		iap.virtualSize = r;
 		iap.setFixedSize(TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS);
-		addLast(mInfo=new mLabel(MyLocale.getMsg(2600,"Attributes:")),HSTRETCH,HFILL);
 		addLast(iap,CellConstants.HSTRETCH,CellConstants.FILL);
+		addLast(mInfo=new mLabel(""),HSTRETCH,HFILL);
 	}
 	private InteractivePanel iap=new attInteractivePanel();
 	

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-06-30 22:57:10 UTC (rev 767)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-06-30 23:49:56 UTC (rev 768)
@@ -90,12 +90,16 @@
 		////////////////////
 
 		this.addNext(new mLabel(MyLocale.getMsg(300,"Type:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.NORTHWEST));
-		this.addNext(chcType,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		this.addLast(lblDiff=new mLabel(MyLocale.getMsg(1000,"D")+": 5.5"),CellConstants.DONTSTRETCH,(CellConstants.DONTFILL|CellConstants.EAST));
+		CellPanel line1Panel = new CellPanel();
+		line1Panel.addNext(chcType,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		line1Panel.addLast(lblDiff=new mLabel(MyLocale.getMsg(1000,"D")+": 5.5"),CellConstants.DONTSTRETCH,(CellConstants.DONTFILL|CellConstants.EAST));
+		this.addLast(line1Panel,DONTSTRETCH,HFILL).setTag(Control.SPAN, new Dimension(2,1));
 		
 		this.addNext(new mLabel(MyLocale.getMsg(301,"Size:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		this.addNext(chcSize,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		this.addLast(lblTerr=new mLabel(MyLocale.getMsg(1001,"T")+": 5.5"),CellConstants.DONTSTRETCH,(CellConstants.DONTFILL|CellConstants.EAST));
+		CellPanel line2Panel = new CellPanel();
+		line2Panel.addNext(chcSize,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		line2Panel.addLast(lblTerr=new mLabel(MyLocale.getMsg(1001,"T")+": 5.5"),CellConstants.DONTSTRETCH,(CellConstants.DONTFILL|CellConstants.EAST));
+		this.addLast(line2Panel,DONTSTRETCH,HFILL).setTag(Control.SPAN, new Dimension(2,1));
 		
 		this.addNext(new mLabel(MyLocale.getMsg(302,"Waypoint:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		this.addLast(inpWaypoint.setTag(Control.SPAN, new Dimension(2,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));

Modified: trunk/src/CacheWolf/NotesScreen.java
===================================================================
--- trunk/src/CacheWolf/NotesScreen.java	2007-06-30 22:57:10 UTC (rev 767)
+++ trunk/src/CacheWolf/NotesScreen.java	2007-06-30 23:49:56 UTC (rev 768)
@@ -21,6 +21,7 @@
 	public NotesScreen(CacheHolderDetail ch){
 		this.title = "Notes";
 		setPreferredSize(Global.getPref().myAppWidth, Global.getPref().myAppHeight);
+		this.resizeOnSIP = true;
 		thisCache = ch;
 		wayNotes.setText(thisCache.CacheNotes);
 		addLast(sbp.setTag(Control.SPAN, new Dimension(3,1)),CellConstants.STRETCH, (CellConstants.FILL|CellConstants.WEST));



From salzkammergut at mail.berlios.de  Sun Jul  1 10:19:24 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Jul 2007 10:19:24 +0200
Subject: [Cachewolf-svn] r769 - trunk/src/CacheWolf
Message-ID: <200707010819.l618JOXV031689@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-01 10:19:19 +0200 (Sun, 01 Jul 2007)
New Revision: 769

Modified:
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/AttributesViewer.java
Log:
Attribute: Der AttributeViewer erkennt anhand des error.gif Icons automatisch die Groesse
der Icons (20 oder 32). Dadurch kann der Benutzer selbst auswaehlen welche Attributgroesse er will.

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2007-06-30 23:49:56 UTC (rev 768)
+++ trunk/src/CacheWolf/Attribute.java	2007-07-01 08:19:19 UTC (rev 769)
@@ -19,7 +19,7 @@
 	 * The attribute names are identical to the image names.
 	 * Internally the first image name has number 0, the next number 1 and so on.
 	 */
-	private String [] attributeNames= {
+	private static String [] attributeNames= {
 			"error.gif",			//00 Unknown attribute
 			"available-no.gif", 	//01 not 24-7
 			"available-yes.gif", 	//02 available 24-7
@@ -31,8 +31,8 @@
 			"cactus-yes.gif",		//08
 			"campfires-no.gif", 	//09 no campfires
 			"campfires-yes.gif", 	//10 campfires allowed
-			"camping-no.gif", 		//11
-			"camping-yes.gif", 		//12
+			"camping-no.gif", 		//11 No camping
+			"camping-yes.gif", 		//12 Camping allowed
 			"cliff-no.gif", 		//13
 			"cliff-yes.gif", 		//14 falling-rocks nearby
 			"climbing-no.gif", 		//15 no difficult climbing
@@ -107,24 +107,40 @@
 			"wheelchair-yes.gif", 	//84 wheelchair accessible
 			"winter-no.gif", 		//85 not available for winter
 			"winter-yes.gif"}; 		//86 available in winter
-	private mImage [] attributeImages=new mImage[87];
+	private static mImage [] attributeImages=new mImage[87];
 	private static String IMAGEDIR=File.getProgramDirectory()+"\\Attributes\\";
 	
 	public static String getImageDir() {
 		return IMAGEDIR; 
 	}
     
-    
+    /**
+     * Returns the image name for a give attribute number
+     * @return Image Name
+     */
 	public String getImageName(){
 		if (attNo>attributeNames.length)
 			return "error.gif";
 		else return attributeNames[attNo];
 	}
 	
+	/**
+	 * Returns the text description of the image
+	 * @return Text description of Image
+	 */
 	public String getInfo(){
 		return MyLocale.getMsg(2500+attNo,"No attribute info found");
 	}
 	
+	/**
+	 * Returns the width of the attribute icons
+	 * @return The width of the images 
+	 */
+	public static int getImageWidth() {
+		initErrorImg();
+		return attributeImages[0].image.getWidth();
+	}
+	
     /**
      * Get the image for a given attribute number. We use lazy initialisation here, i.e. the images are only
      * loaded when they are requested. 
@@ -154,9 +170,13 @@
     	return 0; // Error
     }
 
+    private static void initErrorImg() {
+		if (attributeImages[0]==null) attributeImages[0]=new mImage(IMAGEDIR+"error.gif");
+    }
+    
     { // Static initialisation of error image
-		attributeImages[0]=new mImage(IMAGEDIR+"error.gif");
-	}
+    	initErrorImg();
+    }
 
 	
 }

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2007-06-30 23:49:56 UTC (rev 768)
+++ trunk/src/CacheWolf/Attributes.java	2007-07-01 08:19:19 UTC (rev 769)
@@ -6,7 +6,7 @@
 import ewe.util.*;
 
 public class Attributes {
-	private static int MAXATTRIBS=10;
+	private static int MAXATTRIBS=12;
 	/**
 	 * The number of attributes for this cache (=number of array elements in use in attribs)
 	 */

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2007-06-30 23:49:56 UTC (rev 768)
+++ trunk/src/CacheWolf/AttributesViewer.java	2007-07-01 08:19:19 UTC (rev 769)
@@ -8,7 +8,7 @@
 public class AttributesViewer extends CellPanel {
 	private final static int ICONS_PER_ROW=6;
 	private final static int ICONROWS=2;
-	private static int TILESIZE=22;
+	private static int TILESIZE=Attribute.getImageWidth()+2;
 	private mLabel mInfo;
 
 	private class attInteractivePanel extends InteractivePanel {



From salzkammergut at mail.berlios.de  Sun Jul  1 12:03:27 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Jul 2007 12:03:27 +0200
Subject: [Cachewolf-svn] r770 - trunk/src/CacheWolf
Message-ID: <200707011003.l61A3RrZ005033@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-01 12:03:20 +0200 (Sun, 01 Jul 2007)
New Revision: 770

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Beim Aktualisieren von Caches bleiben die Notes in Addi Wegpunkten erhalten


Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-01 08:19:19 UTC (rev 769)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-01 10:03:20 UTC (rev 770)
@@ -918,7 +918,11 @@
 			rowBlock = exRowBlock.findNext();
 			while(exRowBlock.endOfSearch()==false){
 				CacheHolderDetail cx = new CacheHolderDetail();
-				
+				cx.wayPoint = MyLocale.formatLong(counter, "00") + wayPoint.substring(2);
+				counter++;
+				try{ // If addi exists, try to read it to preserve the notes
+					cx.readCache(profile.dataDir);
+				} catch (Exception ex) {};	
 				nameRex.search(rowBlock);
 				koordRex.search(rowBlock);
 				typeRex.search(rowBlock);
@@ -930,8 +934,6 @@
 				if(typeRex.didMatch()) cx.type = CacheType.typeText2Number("Waypoint|"+typeRex.stringMatched(1));
 				rowBlock = exRowBlock.findNext();
 				descRex.search(rowBlock);
-				cx.wayPoint = MyLocale.formatLong(counter, "00") + wayPoint.substring(2);
-				counter++;
 				cx.LongDescription = descRex.stringMatched(1); 
 				//Vm.debug(descRex.stringMatched(1));
 				int idx=profile.getCacheIndex(cx.wayPoint);



From salzkammergut at mail.berlios.de  Sun Jul  1 12:06:23 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Jul 2007 12:06:23 +0200
Subject: [Cachewolf-svn] r771 - trunk/src/CacheWolf
Message-ID: <200707011006.l61A6Nc1005198@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-01 12:06:20 +0200 (Sun, 01 Jul 2007)
New Revision: 771

Modified:
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/AttributesViewer.java
Log:
AttributesViewer: Der Viewer versucht moeglichst viele Attribute in einer Zeile darzustellen
um vertikales Scrollen zu vermeiden. Die Anzahl der dargestellten Attribute pro Zeile ist bezogen
auf die Bildschirmbreite (wird bei Groessenaenderung des Fensters nicht angepa?\195?\159t)

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2007-07-01 10:03:20 UTC (rev 770)
+++ trunk/src/CacheWolf/Attributes.java	2007-07-01 10:06:20 UTC (rev 771)
@@ -6,7 +6,7 @@
 import ewe.util.*;
 
 public class Attributes {
-	private static int MAXATTRIBS=12;
+	public final static int MAXATTRIBS=12;
 	/**
 	 * The number of attributes for this cache (=number of array elements in use in attribs)
 	 */

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2007-07-01 10:03:20 UTC (rev 770)
+++ trunk/src/CacheWolf/AttributesViewer.java	2007-07-01 10:06:20 UTC (rev 771)
@@ -6,9 +6,9 @@
 import ewe.ui.*;
 
 public class AttributesViewer extends CellPanel {
-	private final static int ICONS_PER_ROW=6;
-	private final static int ICONROWS=2;
 	private static int TILESIZE=Attribute.getImageWidth()+2;
+	private final static int ICONS_PER_ROW=MyLocale.getScreenWidth()/TILESIZE<Attributes.MAXATTRIBS ? MyLocale.getScreenWidth()/TILESIZE : Attributes.MAXATTRIBS;
+	private final static int ICONROWS=(Attributes.MAXATTRIBS+ICONS_PER_ROW-1)/ICONS_PER_ROW;
 	private mLabel mInfo;
 
 	private class attInteractivePanel extends InteractivePanel {



From salzkammergut at mail.berlios.de  Sun Jul  1 12:41:58 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Jul 2007 12:41:58 +0200
Subject: [Cachewolf-svn] r772 - in trunk: resources src/CacheWolf
Message-ID: <200707011041.l61Afwkp028780@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-01 12:41:37 +0200 (Sun, 01 Jul 2007)
New Revision: 772

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/MainMenu.java
Log:
MainMenu: Hauptmenue etwas umstrukturiert (Untermenue Import um weitere Importmoeglichkeiten integrieren zu koennen)
Zentrum auf erste Ebene usw.

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-07-01 10:06:20 UTC (rev 771)
+++ trunk/resources/cachewolf.Languages.cfg	2007-07-01 10:41:37 UTC (rev 772)
@@ -22,7 +22,7 @@
 		118=WolfLanguage
 		119=Suche nach:
 		120=Anwendung
-		121=Profile
+		121=Profil
 		122=zu Garmin
 		123=zu CacheMate
 		124=nach OZI
@@ -55,12 +55,13 @@
 		159=Filter
 		160=Selektierte
 		161=Zeige Blacklist
-		162=kalibrierte herunterladen
+		162=Kalibrierte herunterladen
 		170=Basisverzeichnis f%fcr die Profile w%e4hlen
 		171=Profil existiert nicht:+
 		172=Kann das Kartenverzeichnis nicht erstellen:%0a
 		173=Garmin: PC Port:
 		174=Kurznamen
+		175=Import
 		200=Details
 		201=Beschreibung
 		202=Bilder
@@ -337,8 +338,8 @@
 		2508=*cactus-yes
 		2509=Keine Lagerfeuer
 		2510=Lagerfeuer erlaubt
-		2511=*camping-no
-		2512=*camping-yes
+		2511=Kein Camping
+		2512=Camping erlaubt
 		2513=*cliff-no
 		2514=Gefahr durch Steinfall
 		2515=Kein schwieriges Klettern
@@ -413,7 +414,6 @@
 		2584=Geeignet f%fc Rollst%fchle
 		2585=Im Winter nicht verf%fcgbar
 		2586=Auch im Winter verf%fcgbar
-		2600=Attribute:
 		3000=Schlie%dfen
 		4000=Geladene Caches:
 		4100=Verzeichnis w%e4hlen:
@@ -456,7 +456,7 @@
 		118=WolfLanguage
 		119=Search for:
 		120=Application
-		121=Profiles
+		121=Profile
 		122=to Garmin
 		123=to CacheMate
 		124=to OZI
@@ -494,6 +494,7 @@
 		172=Error: cannot create maps directory:%0a
 		173=Garmin: PC Port:
 		174=Short Names
+		175=Import
 		200=Details
 		201=Description
 		202=Images
@@ -770,8 +771,8 @@
 		2508=*cactus-yes
 		2509=no campfires
 		2510=campfires allowed
-		2511=*camping-no
-		2512=*camping-yes
+		2511=No camping
+		2512=Camping allowed
 		2513=*cliff-no
 		2514=falling rocks nearby
 		2515=no difficult climbing
@@ -846,7 +847,6 @@
 		2584=wheelchair accessible
 		2585=not available in winter
 		2586=available in winter
-		2600=Attributes:
 		3000=Close
 		4000=Loaded caches
 		4101=Maps

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2007-07-01 10:06:20 UTC (rev 771)
+++ trunk/src/CacheWolf/MainMenu.java	2007-07-01 10:41:37 UTC (rev 772)
@@ -41,13 +41,21 @@
 		///////////////////////////////////////////////////////////////////////
 		// subMenu for profiles, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] mnuProfile = new MenuItem[3];
+		MenuItem[] mnuProfile = new MenuItem[2];
 		mnuProfile[0] = mnuNewProfile = new MenuItem(MyLocale.getMsg(1107,"New"));
 		mnuProfile[1] = mnuOpenProfile = new MenuItem(MyLocale.getMsg(1109,"Open"));
-		mnuProfile[2] = mnuEditCenter = new MenuItem(MyLocale.getMsg(1110,"Center"));
 		Menu profileMenu = new Menu(mnuProfile,MyLocale.getMsg(121,"Profiles"));
 		
 		///////////////////////////////////////////////////////////////////////
+		// subMenu for import, part of "Application" menu below
+		///////////////////////////////////////////////////////////////////////
+		MenuItem[] mnuImport = new MenuItem[3];
+		mnuImport[0] = loadcaches  = new MenuItem(MyLocale.getMsg(129,"Import GPX")); //TODO internationalization
+		mnuImport[1] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download von opencaching.de")); 
+		mnuImport[2] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider von geocaching.com")); 
+		Menu importMenu = new Menu(mnuImport, MyLocale.getMsg(175,"Import"));
+		
+		///////////////////////////////////////////////////////////////////////
 		// subMenu for export, part of "Application" menu below
 		///////////////////////////////////////////////////////////////////////
 		MenuItem[] exitems = new MenuItem[12];
@@ -81,19 +89,18 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Application" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem [] appMenuItems=new MenuItem[12];
-		appMenuItems[0] = profiles 	 = new MenuItem(MyLocale.getMsg(121,"Profiles"), 0, profileMenu); 
+		MenuItem [] appMenuItems=new MenuItem[11];
+		appMenuItems[0] = profiles 	 = new MenuItem(MyLocale.getMsg(121,"Profile"), 0, profileMenu); 
 		appMenuItems[1] = preferences = new MenuItem(MyLocale.getMsg(108,"Preferences")); 
-		appMenuItems[2] = loadcaches  = new MenuItem(MyLocale.getMsg(129,"Import GPX")); //TODO internationalization
-		appMenuItems[3] = loadOC      = new MenuItem(MyLocale.getMsg(130,"Download von opencaching.de")); 
-		appMenuItems[4] = spider      = new MenuItem(MyLocale.getMsg(131,"Spider von geocaching.com")); 
-		appMenuItems[5] = new MenuItem(MyLocale.getMsg(149,"Maps"),0,mapsMenu);
-		appMenuItems[6] = mnuSeparator = new MenuItem("-");
-		appMenuItems[7] = new MenuItem(MyLocale.getMsg(107,"Export"),0,exportMenu);
-		appMenuItems[8] = mnuSeparator;
-		appMenuItems[9] = savenoxit = new MenuItem(MyLocale.getMsg(127,"Save")); 
-		appMenuItems[10] = savenexit = new MenuItem(MyLocale.getMsg(110,"Save & Exit")); 
-		appMenuItems[11] = exit = new MenuItem(MyLocale.getMsg(111,"Exit"));
+		appMenuItems[2] = mnuEditCenter = new MenuItem(MyLocale.getMsg(1110,"Center"));
+		appMenuItems[3] = mnuSeparator = new MenuItem("-");
+		appMenuItems[4] = new MenuItem(MyLocale.getMsg(175,"Import"),0,importMenu);
+		appMenuItems[5] = new MenuItem(MyLocale.getMsg(107,"Export"),0,exportMenu);
+		appMenuItems[6] = new MenuItem(MyLocale.getMsg(149,"Maps"),0,mapsMenu);
+		appMenuItems[7] = mnuSeparator;
+		appMenuItems[8] = savenoxit = new MenuItem(MyLocale.getMsg(127,"Save")); 
+		appMenuItems[9] = savenexit = new MenuItem(MyLocale.getMsg(110,"Save & Exit")); 
+		appMenuItems[10] = exit = new MenuItem(MyLocale.getMsg(111,"Exit"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(120,"Application"),new Menu(appMenuItems,null)));
 		
 		///////////////////////////////////////////////////////////////////////



From salzkammergut at mail.berlios.de  Sun Jul  1 23:05:49 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 1 Jul 2007 23:05:49 +0200
Subject: [Cachewolf-svn] r773 - trunk/resources
Message-ID: <200707012105.l61L5n2t010261@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-01 23:05:39 +0200 (Sun, 01 Jul 2007)
New Revision: 773

Modified:
   trunk/resources/spider.def
Log:
spider.def: Wenn das Zentrum exakt mit den Koordinaten eines Caches uebereinstimmt wurde dieser
Cache nicht gespidert.

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-07-01 10:41:37 UTC (rev 772)
+++ trunk/resources/spider.def	2007-07-01 21:05:39 UTC (rev 773)
@@ -7,6 +7,7 @@
 # Version 2.3 - 20070602 sizeRex an GC ?nderungen angepasst
 # Version 2.4 - 20070616 neu: Attribute
 # Version 2.5 - 20070629 Anpassungen an Listen?nderung bei GC
+# Version 2.6 - 20070701 Bugfix: Wenn Zentrum exakt in Cachekoordinaten liegt wurde der Cache nicht gespidert
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -24,8 +25,8 @@
 firstPage          = http://www.geocaching.com/seek/nearest.aspx?lat=
 firstPage2         = &lon=
 # Regex to search for cachenames 
-lineRex            = images/icons/compass((?s).*?)</tr>
 listBlockRex       = <table id="dlResults"((?s).*?)</table>
+lineRex            = (?:images/icons/compass|<td\ valign="top"\ align="left"><br\ />)((?s).*?)</tr>
 distRex            = <br\ />(.*?)(km|mi)</td>
 waypointRex        = </a> \\((.*?)\\)<br>
 showOnlyFound      = &f=1



From salzkammergut at mail.berlios.de  Mon Jul  2 19:42:02 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 2 Jul 2007 19:42:02 +0200
Subject: [Cachewolf-svn] r774 - trunk/src/CacheWolf
Message-ID: <200707021742.l62Hg25s026750@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-02 19:41:58 +0200 (Mon, 02 Jul 2007)
New Revision: 774

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Nachtrag zur letzten Revision

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-01 21:05:39 UTC (rev 773)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-02 17:41:58 UTC (rev 774)
@@ -269,7 +269,7 @@
 				lineRex.search(dummy);
 			}catch(NullPointerException nex){}
 			while(lineRex.didMatch()){
-				//Vm.debug(getDist(rexLine.stringMatched(1)) + " / " +getWP(rexLine.stringMatched(1)));
+				//Vm.debug(getDist(lineRex.stringMatched(1)) + " / " +getWP(lineRex.stringMatched(1)));
 				found_on_page++;
 				if(getDist(lineRex.stringMatched(1)) <= distance){
 					if(indexDB.get((String)getWP(lineRex.stringMatched(1))) == null){
@@ -510,7 +510,7 @@
 	private double getDist(String doc){
 		inRex = new Regex(p.getProperty("distRex"));
 		inRex.search(doc);
-		if(doc.indexOf("Here") > 0) return(0);
+		if(doc.indexOf("Here") >= 0) return(0);
 		if(pref.digSeparator.equals(",")) return Convert.toDouble(inRex.stringMatched(1).replace('.',','));
 		return Convert.toDouble(inRex.stringMatched(1));
 	}



From salzkammergut at mail.berlios.de  Mon Jul  2 23:37:39 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 2 Jul 2007 23:37:39 +0200
Subject: [Cachewolf-svn] r775 - trunk/src/CacheWolf
Message-ID: <200707022137.l62LbdJZ015083@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-02 23:37:31 +0200 (Mon, 02 Jul 2007)
New Revision: 775

Added:
   trunk/src/CacheWolf/DateTimeChooser.java
Modified:
   trunk/src/CacheWolf/DetailsPanel.java
Log:
DetailsPanel: Beim Gefunden Datum kann jetzt ueber einen Datums- und Uhrzeitpicker auch die Uhrzeit angegeben werden.


Added: trunk/src/CacheWolf/DateTimeChooser.java
===================================================================
--- trunk/src/CacheWolf/DateTimeChooser.java	2007-07-02 17:41:58 UTC (rev 774)
+++ trunk/src/CacheWolf/DateTimeChooser.java	2007-07-02 21:37:31 UTC (rev 775)
@@ -0,0 +1,498 @@
+package CacheWolf;
+import ewe.ui.*;
+import ewe.fx.*;
+import ewe.sys.*;
+import ewe.util.*;
+import ewe.reflect.*;
+
+
+public class DateTimeChooser extends Editor {
+
+	MultiPanel panels = new CardPanel();
+	
+	public int year;
+	public String monthName;
+	public int month;
+	public int day;
+	public int hour;
+	public int minute;
+	public String time;
+	
+	public boolean autoAdvance = true;
+	public boolean didAll = false;
+	
+	TableControl dayChooser, monthChooser, yearChooser,timeChooser;
+	public Locale locale = Vm.getLocale();
+	
+	Control dayDisplay;
+	Control monthDisplay;
+	Control yearDisplay;
+	Control timeDisplay;
+	//Control minuteDisplay;
+
+	Time getTime() {
+		Time t = (Time)dateSet.getCopy();
+		t.day = day;
+		t.month = month;
+		t.year = year;
+		t.hour = hour;
+		t.minute = minute;
+		t.update();
+		return t;
+		//return new Time(day,month,year);
+	}
+	
+	void addTable(TableControl tc,TableModel tm,String name) {
+		tc.setTableModel(tm);
+		tc.setClickMode(true);
+		panels.addItem(tc,name,null);
+		//tc.addListener(this);
+	}
+	
+	boolean added = false;
+	Control addTopData(CellPanel cp,String field) {
+		Control dl = new mButton();//DumbLabel(1,10);
+		cp.addNext(addField(dl,field),HSTRETCH,HFILL);
+		dl.addListener(this);
+		//dl.anchor = CENTER;
+		dl.modify(DrawFlat,0);
+		dl.borderStyle = BDR_OUTLINE|BF_TOP|BF_RIGHT|BF_SQUARE;
+		//if (!added) dl.borderStyle |= BF_LEFT;
+		added = true;
+		dl.borderColor = Color.Black;
+		return dl;
+	}
+	
+	public String firstPanel = "monthName";
+	
+	public void reset(Time t) {
+		setDate(t);
+		didAll = false;
+		newDate();
+		panels.select(firstPanel);
+	}
+	
+	public CellPanel addTopSection(CellPanel addTo,Control cp) {
+		addTo.modify(DrawFlat,0);
+		addTo.defaultTags.set(INSETS,new Insets(0,0,0,0));
+		mButton b = new mButton();
+		b.borderStyle = BDR_OUTLINE|BF_LEFT|BF_TOP|BF_RIGHT|BF_SQUARE;
+		b.image = new DrawnIcon(DrawnIcon.CROSS,10,10,new Color(0x80,0,0));
+		addTo.addNext(addField(b,"reject")).setCell(DONTSTRETCH);
+		addTo.addNext(cp,HSTRETCH,HFILL);
+		b = new mButton();
+		b.borderStyle = BDR_OUTLINE|BF_TOP|BF_RIGHT|BF_SQUARE;
+		b.image = new DrawnIcon(DrawnIcon.TICK,10,10,new Color(0,0x80,0));
+		addTo.addNext(addField(b,"accept")).setCell(DONTSTRETCH);
+		return addTo;
+	}
+	
+	CardPanel cards = new CardPanel();
+	
+	public DateTimeChooser(Locale l) {
+		if (l != null) locale = l;
+		setDate(new Time());
+		addLast(cards);
+		CellPanel addTo = new CellPanel();
+		cards.addItem(addTo,"full",null);
+		
+		CellPanel cp = new CellPanel();
+		CellPanel top = new CellPanel();
+		cp.equalWidths = true;
+		firstPanel = "day";
+		dayDisplay = addTopData(cp,"day");
+		monthDisplay = addTopData(cp,"monthName");
+		yearDisplay = addTopData(cp,"year");
+		timeDisplay = addTopData(cp,"time");
+		cp.endRow();
+	
+	
+		addTopSection(top,cp);
+		addTo.addLast(top).setCell(HSTRETCH);
+		addTo.addLast((Control)panels);	
+		
+		addTable(dayChooser = new TableControl(),new dayChooserTableModel(locale),"day");
+		addTable(monthChooser = new TableControl(),new monthChooserTableModel(locale),"monthName");
+		addTable(yearChooser = new TableControl(),new yearChooserTableModel(),"year");
+		addTable(timeChooser = new TableControl(),new timeChooserTableModel(),"time");
+	
+		mButton b = new mButton();
+		//b.borderStyle = BDR_OUTLINE|BF_LEFT|BF_TOP|BF_RIGHT|BF_SQUARE;
+		b.image = new DrawnIcon(DrawnIcon.CROSS,10,10,new Color(0x80,0,0));
+		addField(b,"reject");
+		b.image = new DrawnIcon(DrawnIcon.CROSS,10,10,new Color(0x80,0,0));
+		b = new mButton();
+		b.image = new DrawnIcon(DrawnIcon.TICK,10,10,new Color(0,0x80,0));
+		addField(b,"accept");
+		newDate();
+		
+	}
+	
+	public void fieldChanged(FieldTransfer ft,Editor ed) {
+		newDate();
+	}
+	
+	public void action(FieldTransfer ft,Editor ed) {
+		String n = ft.fieldName;
+		if (n.equals("day")||n.equals("monthName")||n.equals("year")||n.equals("time"))
+			panels.select(n);
+		if (n.equals("accept") || n.equals("entered"))
+			exit(IDOK);
+		if (n.equals("reject")) exit(IDCANCEL);
+	}
+	
+	public void onControlEvent(ControlEvent ev) {
+		if (ev instanceof TableEvent && ev.type == TableEvent.CELL_CLICKED){
+			if (ev.target == dayChooser){
+				day = Convert.toInt((String)((TableEvent)ev).cellData);
+				newDate();
+				toControls("day");
+				if (autoAdvance && !didAll) {
+					panels.select("monthName");
+				}
+			}else if (ev.target == monthChooser){
+				month = (int)((ewe.sys.Long)(((TableEvent)ev).cellData)).value;
+				newDate();
+				monthName = locale.getString(locale.SHORT_MONTH,month,0);
+				toControls("monthName");
+				if (autoAdvance && !didAll) {
+					panels.select("year");
+					didAll = true;
+				}
+			}else if (ev.target == yearChooser){
+				String p = (String)((TableEvent)ev).cellData;
+				int dec = year % 100;
+				year -= dec;
+				if (p.charAt(0) == 'C'){
+					if (p.charAt(1) == '+') year = year+100+dec;
+					else year = year-100+dec;
+				}else{
+					int val = Convert.toInt(p);
+					if (val > 9) year = val*100;
+					else {
+						dec = dec*10+val;
+						year += dec%100;
+					}
+				}
+				newDate();
+				toControls("year");
+			}else if (ev.target == timeChooser){
+				timeChooserTableModel tcm = (timeChooserTableModel)timeChooser.getTableModel();
+				int newHour=tcm.getHourFor(((TableEvent)ev).row,((TableEvent)ev).col);
+				if (newHour>-1) hour=newHour;
+				int newMinute=tcm.getMinuteFor(((TableEvent)ev).row,((TableEvent)ev).col);
+				if (newMinute>-1) minute=newMinute;
+				time=MyLocale.formatLong(hour,"00")+":"+MyLocale.formatLong(minute,"00");
+				tcm.set(hour,minute);
+				timeChooser.repaintNow();
+				newDate();
+				toControls("time");
+			}
+		}
+		if (ev.type == ev.CANCELLED) exit(IDCANCEL);
+		else super.onControlEvent(ev);
+	}
+	
+	Time dateSet;
+	
+	public void setDate(Time t) {
+		dateSet = t;
+		if (!t.isValid()) t = new Time();
+		String s = Time.toString(t,t instanceof TimeOfDay ? t.getFormat() : locale.getString(Locale.SHORT_DATE_FORMAT,0,0),locale);
+		day = t.day; month = t.month; year = t.year; hour=t.hour; minute=t.minute;
+		time=MyLocale.formatLong(hour,"00")+":"+MyLocale.formatLong(minute,"00");
+		monthName = locale.getString(locale.SHORT_MONTH,t.month,0);
+		toControls("day,month,year,monthName,time"); 
+	}
+	
+	public void newDate() {
+		Time t = new Time(day,month,year); t.hour=hour; t.minute=minute;
+		Time t2 = t;
+		if (!t2.isValid()) t2 = new Time(day = 1,month,year);
+		if (!t2.isValid()) t2 = new Time();
+		if (t2 != t){
+			setDate(t2);
+		}
+		dayChooserTableModel dcm = (dayChooserTableModel)dayChooser.getTableModel();
+		dcm.set(day,month,year);
+		monthChooserTableModel mcm = (monthChooserTableModel)monthChooser.getTableModel();
+		mcm.set(day,month,year);
+		timeChooserTableModel tcm = (timeChooserTableModel)timeChooser.getTableModel();
+		tcm.set(hour,minute);
+		//dayChooser.repaintNow();
+		//monthChooser.repaintNow();
+	}
+} // DateTimeChooser
+
+
+//-------------------------------------------------------
+class monthChooserTableModel extends InputPanelTableModel {
+//-------------------------------------------------------
+	int chosenMonth;
+	Locale locale = Vm.getLocale();
+
+	monthChooserTableModel(Locale locale) {
+		this.locale = locale;
+		numRows = 3;
+		numCols = 4;
+		hasColumnHeaders = false;
+		hasRowHeaders = false;
+		fillToEqualHeights = fillToEqualWidths = true;
+	}
+	
+	void set(int day,int month,int year) {
+		int old = chosenMonth;
+		chosenMonth = month;
+		if (old != chosenMonth) refreshMonth(old);
+	}
+
+	int getMonthFor(int row,int cell) {
+		if (row == -1 || cell == -1) return 0;
+		int idx = row*4+cell;
+		return idx+1;
+	}
+
+	Point getCellFor(int month,Point dest) {
+		month--;
+		int row = (month/4)%3;
+		int col = month%4;
+		return Point.unNull(dest).set(col,row);
+	}
+
+	void refreshMonth(int month) {
+		Point p = getCellFor(month,null);
+		table.repaintCell(p.y,p.x);
+	}
+
+	public TableCellAttributes getCellAttributes(int row,int col,boolean isSelected,TableCellAttributes ta) {
+		ta.flat = true;
+		ta = super.getCellAttributes(row,col,isSelected,ta);
+		ta.borderStyle = fixBorder(table.BDR_OUTLINE|table.BF_BOTTOM|table.BF_RIGHT,row,col,true);
+		if (getMonthFor(row,col) == chosenMonth && !isSelected){
+			ta.fillColor = new Color(0x80,0x80,0xff);
+		}
+		return ta;
+	}
+
+	public Object getCellText(int row,int col) {
+		return locale.getString(locale.SHORT_MONTH,getMonthFor(row,col),0);
+	}
+
+	public Object getCellData(int row,int col) {
+		int month = getMonthFor(row,col);
+		return new ewe.sys.Long().set(month);
+	}
+}
+
+//-------------------------------------------------------
+class dayChooserTableModel extends InputPanelTableModel {
+//-------------------------------------------------------
+	
+	Vector days = new Vector();
+	Locale locale = Vm.getLocale();
+	int firstDayIndex = 0;
+	int numDays = 28;
+	
+	int chosenDay = 0;
+	
+	
+	void set(int day,int month,int year) {
+		//ewe.sys.Vm.debug(month+","+year);
+		numDays = Time.numberOfDays(month,year);
+		Time t = new Time(1,month,year);
+		firstDayIndex = t.indexOfDayInWeek(t.dayOfWeek,locale)-1;
+		//ewe.sys.Vm.debug(""+firstDayIndex+", "+numDays);
+		int oldDay = chosenDay;
+		chosenDay = day;
+		if (oldDay != chosenDay) refreshDay(oldDay);
+	}
+	
+	int getDayFor(int row,int cell) {
+		if (row == -1 || cell == -1) return 0;
+		int idx = row*7+cell;
+		if (idx >= firstDayIndex && idx < firstDayIndex+numDays) return idx-firstDayIndex+1;
+		idx = idx+35;
+		if (idx >= firstDayIndex && idx < firstDayIndex+numDays) return idx-firstDayIndex+1;
+		return 0;
+	}
+	
+	Point getCellFor(int day,Point dest) {
+		day += firstDayIndex-1;
+		int row = (day/7)%5;
+		int col = day%7;
+		return Point.unNull(dest).set(col,row);
+	}
+	
+	void refreshDay(int day) {
+		Point p = getCellFor(day,null);
+		table.repaintCell(p.y,p.x);
+	}
+	
+	public TableCellAttributes getCellAttributes(int row,int col,boolean isSelected,TableCellAttributes ta) {
+		ta.flat = true;
+		ta = super.getCellAttributes(row,col,isSelected,ta);
+		ta.borderStyle = fixBorder(table.BDR_OUTLINE|table.BF_BOTTOM|table.BF_RIGHT,row,col,true);
+		if (getDayFor(row,col) == chosenDay && !isSelected){
+			ta.fillColor = new Color(0x80,0x80,0xff);
+		}
+		return ta;
+	}
+	
+	dayChooserTableModel(Locale l) {
+		this.locale = l;
+		numRows = 5;
+		numCols = 7;
+		hasColumnHeaders = true;
+		hasRowHeaders = false;
+		for (int i = 1; i<=7; i++) days.add(l.getString(l.SHORT_DAY_OF_WEEK,i,0));
+	
+		fillToEqualHeights = fillToEqualWidths = true;
+	}
+	
+	public boolean canSelect(int row,int col) {
+		return (getDayFor(row,col) != 0);
+	}
+	
+	public Object getCellData(int row,int col) {
+		if (row == -1) return days.get(col);
+		else {
+			int val = getDayFor(row,col);
+			if (val == 0) return null;
+			return Convert.toString(val);
+		}
+	}
+	
+}
+
+
+//-------------------------------------------------------
+class yearChooserTableModel extends InputPanelTableModel {
+//-------------------------------------------------------
+	
+	yearChooserTableModel() {
+		numRows = 4;
+		numCols = 4;
+		hasColumnHeaders = false;
+		hasRowHeaders = false;
+	}
+	String [] all = mString.split("19xx|7|8|9|20xx|4|5|6|21xx|1|2|3|18xx|0|C+|C-");
+
+	public Object getCellText(int row,int col) {
+		if (row >= 0 && col >= 0) 
+			return all[col+row*4];
+		return null;
+	}
+	
+	public Object getCellData(int row,int col) {
+		String str = (String)getCellText(row,col);
+		if (str.length() > 2) str = str.substring(0,2);
+		return str;
+	}
+	
+	public TableCellAttributes getCellAttributes(int row,int col,boolean isSelected,TableCellAttributes ta) {
+		ta.flat = true;
+		ta = super.getCellAttributes(row,col,isSelected,ta);
+		return ta;
+	}
+
+}
+
+//-------------------------------------------------------
+class timeChooserTableModel extends InputPanelTableModel {
+//	-------------------------------------------------------
+	int chosenHour=-2,chosenMinute=-2;
+	
+	timeChooserTableModel() {
+		numRows = 6;
+		numCols = 15;
+		hasColumnHeaders = false;
+		hasRowHeaders = false;
+	}
+	void set(int hour,int minute) {
+		int old = chosenHour;
+		chosenHour = hour;
+		if (old != chosenHour) refreshHour(old);
+		old = chosenMinute;
+		chosenMinute = minute;
+		if (old != chosenMinute) refreshMinute(old);
+	}
+
+	int getHourFor(int row,int cell) {
+		if (row == -1 || cell == -1) return 0;
+		if (cell>=4) return -1;
+		return row*4+cell;
+	}
+
+	Point getCellForHour(int hour,Point dest) {
+		int row = (hour/4)%6;
+		int col = hour%4;
+		return Point.unNull(dest).set(col,row);
+	}
+
+	void refreshHour(int hour) {
+		Point p = getCellForHour(hour,null);
+		table.repaintCell(p.y,p.x);
+	}
+
+	int getMinuteFor(int row,int cell) {
+		if (row == -1 || cell == -1) return 0;
+		if (cell<=4) return -1;
+		return row*10+cell-5;
+	}
+
+	Point getCellForMinute(int minute,Point dest) {
+		int row = (minute/10)%6;
+		int col = minute%10;
+		return Point.unNull(dest).set(col,row);
+	}
+
+	void refreshMinute(int minute) {
+		Point p = getCellForMinute(minute,null);
+		table.repaintCell(p.y,p.x);
+	}
+
+
+	public Object getCellText(int row,int col) {
+		if (row >= 0 && col >= 0) 
+			if (col<4) 
+				return Convert.toString(row*4+col);
+			else if (col==4) 
+				return "";
+			else 
+				return  Convert.toString(row*10+col-5);
+		return null;
+	}
+
+	public Object getCellData(int row,int col) {
+		return (String)getCellText(row,col);
+	}
+
+	public TableCellAttributes getCellAttributes(int row,int col,boolean isSelected,TableCellAttributes ta) {
+		ta.flat = true;
+		if (col==4) {
+			ta = super.getCellAttributes(row,col,isSelected,ta);
+			ta.fillColor=Color.LightGray;
+		} else
+			ta = super.getCellAttributes(row,col,isSelected,ta);
+		if (getHourFor(row,col) == chosenHour && !isSelected){
+			ta.fillColor = new Color(0x80,0x80,0xff);
+		}
+		if (getMinuteFor(row,col) == chosenMinute && !isSelected){
+			ta.fillColor = new Color(0x80,0x80,0xff);
+		}
+		return ta;
+	}
+
+	public int calculateColWidth(int col) {
+		if (col==4)
+        	return 4;
+        else if (col<4)
+        	return super.calculateColWidth(col)+2;
+        else	
+        	return super.calculateColWidth(col);
+	}
+}
+
+
+
+

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-07-02 17:41:58 UTC (rev 774)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-07-02 21:37:31 UTC (rev 775)
@@ -369,12 +369,23 @@
 				}
 			}
 			else if (ev.target==btnFoundDate) {
-				DateChooser.dayFirst=true;
-				DateChooser dc=new DateChooser(Vm.getLocale());
+				//DateChooser.dayFirst=true;
+				DateTimeChooser dc=new DateTimeChooser(Vm.getLocale());
 				dc.title=MyLocale.getMsg(328,"Date found"); 
 				dc.setPreferredSize(240,240);
+				String foundDate=chcStatus.getText();
+				if (foundDate.startsWith(MyLocale.getMsg(318,"Found")+" ")) foundDate=foundDate.substring(MyLocale.getMsg(318,"Found").length()+1);
+				Time t=new Time();
+				try {
+					t.parse(foundDate,"y-M-d H:m");
+				} catch(IllegalArgumentException e) {
+					try {
+						t.parse(foundDate,"y-M-d");
+					} catch(IllegalArgumentException e1) {}
+				};
+				dc.reset(t);
 				if (dc.execute()==ewe.ui.FormBase.IDOK) {
-				  chcStatus.setText(MyLocale.getMsg(318,"Found")+" "+Convert.toString(dc.year)+"-"+MyLocale.formatLong(dc.month,"00")+"-"+MyLocale.formatLong(dc.day,"00"));
+				  chcStatus.setText(MyLocale.getMsg(318,"Found")+" "+Convert.toString(dc.year)+"-"+MyLocale.formatLong(dc.month,"00")+"-"+MyLocale.formatLong(dc.day,"00")+" "+dc.time);
 				  dirty_details=true;
 				}
 			}



From salzkammergut at mail.berlios.de  Tue Jul  3 23:37:38 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 3 Jul 2007 23:37:38 +0200
Subject: [Cachewolf-svn] r776 - trunk/src/CacheWolf
Message-ID: <200707032137.l63LbcH2014162@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-03 23:37:34 +0200 (Tue, 03 Jul 2007)
New Revision: 776

Modified:
   trunk/src/CacheWolf/CoordsScreen.java
Log:
CoordsScreen: Vereinfachung der Eingabe: Durch wiederholtes Betaetigen der Enter-Taste kann von Feld zu Feld gesprungen werden.

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2007-07-02 21:37:31 UTC (rev 775)
+++ trunk/src/CacheWolf/CoordsScreen.java	2007-07-03 21:37:34 UTC (rev 776)
@@ -22,8 +22,7 @@
 	CWPoint coordInp = new CWPoint();
 	CellPanel TopP = new CellPanel();
 	CellPanel BottomP = new CellPanel();
-
-	
+	int exitKeys[]={75009};
 	int currFormat;
 	
 	public CoordsScreen()
@@ -35,10 +34,10 @@
 		TopP.addNext(chkDMS =new mCheckBox("d?m\'s\""),CellConstants.DONTSTRETCH,CellConstants.WEST);
 		TopP.addLast(chkUTM =new mCheckBox("UTM"),CellConstants.DONTSTRETCH, CellConstants.WEST);
 
-		chkDD.setGroup(chkFormat);
-		chkDMM.setGroup(chkFormat);
-		chkDMS.setGroup(chkFormat);
-		chkUTM.setGroup(chkFormat);
+		chkDD.setGroup(chkFormat); chkDD.exitKeys=exitKeys;
+		chkDMM.setGroup(chkFormat);chkDMM.exitKeys=exitKeys;
+		chkDMS.setGroup(chkFormat);chkDMS.exitKeys=exitKeys;
+		chkUTM.setGroup(chkFormat);chkUTM.exitKeys=exitKeys;
 
 		// Input for degrees
 		TopP.addNext(chcNS = new mChoice(new String[]{"N", "S"},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
@@ -77,34 +76,41 @@
 		//btnParse.setTag(SPAN,new Dimension(4,1));
 		TopP.addLast(btnCopy = new mButton(MyLocale.getMsg(618,"Copy")),CellConstants.HSTRETCH, (CellConstants.HFILL));
 		//btnCopy.setTag(SPAN,new Dimension(4,1));
-
-
-		
+		chcNS.exitKeys=exitKeys; chcEW.exitKeys=exitKeys;
 		//add Panels
 		this.addLast(TopP,CellConstants.DONTSTRETCH, CellConstants.WEST).setTag(SPAN,new Dimension(4,1));
 //		this.addLast(BottomP,CellConstants.VSTRETCH, CellConstants.VFILL|CellConstants.WEST).setTag(SPAN,new Dimension(4,1));
-		
+		chcNS.takeFocus(Control.ByKeyboard);
 	}
 	
 	public void activateFields(int format){
-		// first enable all fields
-		this.modifyAll(0,ControlConstants.Disabled);
-		
+		inpEWDeg.wantReturn=false; inpEWm.wantReturn=false; inpEWs.wantReturn=false; inpUTMNorthing.wantReturn=false;
 		switch (format){
-		case CWPoint.DD: 	inpNSm.modify(ControlConstants.Disabled,0);inpEWm.modify(ControlConstants.Disabled,0);
-				 	inpNSs.modify(ControlConstants.Disabled,0);inpEWs.modify(ControlConstants.Disabled,0);
-		case CWPoint.CW:
-		case CWPoint.DMM: 	inpNSs.modify(ControlConstants.Disabled,0);inpEWs.modify(ControlConstants.Disabled,0);
-		case CWPoint.DMS: 	inpUTMZone.modify(ControlConstants.Disabled,0);
-					inpUTMNorthing.modify(ControlConstants.Disabled,0);
-					inpUTMEasting.modify(ControlConstants.Disabled,0);
-					break;
-		case CWPoint.UTM: 	inpNSDeg.modify(ControlConstants.Disabled,0);inpEWDeg.modify(ControlConstants.Disabled,0);
-					inpNSm.modify(ControlConstants.Disabled,0);inpEWm.modify(ControlConstants.Disabled,0);
-	 				inpNSs.modify(ControlConstants.Disabled,0);inpEWs.modify(ControlConstants.Disabled,0);
-	 				chcNS.modify(ControlConstants.Disabled,0);
-	 				chcEW.modify(ControlConstants.Disabled,0);
-	 				break;
+			case CWPoint.DD:
+				enable(chcNS); enable(inpNSDeg); disable(inpNSm); disable(inpNSs);
+				enable(chcEW); enable(inpEWDeg); disable(inpEWm); disable(inpEWs);
+				inpEWDeg.wantReturn=true;
+				disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+				break;
+			case CWPoint.CW:
+			case CWPoint.DMM: 	
+				enable(chcNS); enable(inpNSDeg); enable(inpNSm); disable(inpNSs);
+				enable(chcEW); enable(inpEWDeg); enable(inpEWm); disable(inpEWs);
+				inpEWm.wantReturn=true;
+				disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+				break;
+			case CWPoint.DMS: 	
+				enable(chcNS); enable(inpNSDeg); enable(inpNSm); enable(inpNSs);
+				enable(chcEW); enable(inpEWDeg); enable(inpEWm); enable(inpEWs);
+				inpEWs.wantReturn=true;
+				disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+				break;
+			case CWPoint.UTM: 	
+				disable(chcNS); disable(inpNSDeg); disable(inpNSm); disable(inpNSs);
+				disable(chcEW); disable(inpEWDeg); disable(inpEWm); disable(inpEWs);
+				enable(inpUTMZone); enable(inpUTMNorthing); enable(inpUTMEasting);
+				inpUTMNorthing.wantReturn=true;
+	 			break;
 		}
 		
 		this.stretchLastColumn = true;
@@ -112,6 +118,9 @@
 		this.repaintNow();
 	}
 
+	private void enable(Control c) {c.modify(ControlConstants.TakesKeyFocus,ControlConstants.Disabled); }
+	private void disable(Control c) {c.modify(ControlConstants.Disabled,ControlConstants.TakesKeyFocus); }
+	
 	public void readFields(CWPoint coords, int format){
 		String NS, EW;
 		if (format == CWPoint.UTM)
@@ -160,8 +169,19 @@
 	public void onEvent(Event ev){
 
 		//Vm.debug(ev.toString());
-
+		// Ensure that the Enter key moves to the appropriate field
+		// for Checkboxes and Choice controls this is done via the exitKeys
+		// For input fields we use the wantReturn field
+		if(ev instanceof ControlEvent && ev.type == ControlEvent.EXITED){
+			if (((ControlEvent)ev).target==chkDD || ((ControlEvent)ev).target==chkDMM ||
+			    ((ControlEvent)ev).target==chkDMS) Gui.takeFocus(chcNS,Control.ByKeyboard);	
+			if (((ControlEvent)ev).target==chkUTM) Gui.takeFocus(inpUTMZone,Control.ByKeyboard);
+			if (((ControlEvent)ev).target==chcNS) Gui.takeFocus(inpNSDeg,Control.ByKeyboard);
+			if (((ControlEvent)ev).target==chcEW) Gui.takeFocus(inpEWDeg,Control.ByKeyboard);
+		}
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
+			if (((ControlEvent)ev).target==inpEWDeg || ((ControlEvent)ev).target==inpEWm ||
+					((ControlEvent)ev).target==inpEWs || ((ControlEvent)ev).target==inpUTMNorthing) Gui.takeFocus(btnApply,Control.ByKeyboard);	
 			if (ev.target == chkFormat){
 				readFields(coordInp, currFormat);
 				currFormat = chkFormat.getSelectedIndex();
@@ -204,8 +224,6 @@
 					this.repaintNow();
 				}
 			}
-				
-				
 		}
 		super.onEvent(ev);
 	}



From salzkammergut at mail.berlios.de  Sat Jul  7 23:13:57 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 7 Jul 2007 23:13:57 +0200
Subject: [Cachewolf-svn] r777 - in trunk: resources src/CacheWolf
Message-ID: <200707072113.l67LDvOt011116@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-07 23:13:41 +0200 (Sat, 07 Jul 2007)
New Revision: 777

Added:
   trunk/resources/cachetour.png
   trunk/resources/clnew.png
   trunk/resources/clopen.png
   trunk/resources/clsave.png
   trunk/resources/clsaveas.png
   trunk/src/CacheWolf/CacheList.java
Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/Global.java
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/StatusBar.java
   trunk/src/CacheWolf/myInteractivePanel.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Neues Feature: Cachetour - Zusammenstellen von Cachetouren innerhalb eines Profils
Durch ein Icon in Statuszeile bzw. Menue Verwalten wird eine Liste eingeblendet, in die Caches aus der Listenansicht bzw.
dem Radarpanel gezogen werden koennen. Optional werden Addis automatisch mitgezogen. 
Durch "Anwenden" werden nur die ausgewaehlten Caches in der exakten gewaehlten Reihenfolge in der Listenansicht
dargestellt, alle anderen werden weggefiltert. 

Added: trunk/resources/cachetour.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/cachetour.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/resources/cachewolf.Languages.cfg	2007-07-07 21:13:41 UTC (rev 777)
@@ -62,6 +62,28 @@
 		173=Garmin: PC Port:
 		174=Kurznamen
 		175=Import
+		176=Neue Version
+		177=Neue Version%0averf%fcgbar
+		178=Versionspr%fcfung
+		179=Sie haben die%0aaktuelle Version.
+		180=Caches hierher
+		181=ziehen
+		182=Neue Liste
+		183=Liste laden
+		184=Speichern als
+		185=Speichern (ohne Nachfrage)
+		186=Addi Wegpunkte mitziehen
+		187=Nur diese Wegpunkte anzeigen
+		188=CACHETOUR: NEU
+		189=Liste anwenden
+		190=Nur diese Wegpunkte zeigen
+		191=Datei w%e4hlen
+		192=%c4nderungen speichern
+		193=Addis hinzuf%fcgen
+		195=Derzeitiges Zentrum		
+		196=Gesamte # Caches (GC&OC)%0aGesamt # sichtbar%0aGesamt # gefunden
+		197=Cachetour anzeigen/verbergen
+		198=Cachetour	
 		200=Details
 		201=Beschreibung
 		202=Bilder
@@ -495,6 +517,28 @@
 		173=Garmin: PC Port:
 		174=Short Names
 		175=Import
+		176=New version
+		177=New version%0aavailable
+		178=Version Check
+		179=You are at%0athe current version.
+		180=Drag caches
+		181=here
+		182=New list
+		183=Load list
+		184=Save as
+		185=Save (without confirmation)
+		186=Also drag Addi Wpts
+		187=Show only these waypoints
+		188=CACHETOUR: NEW
+		189=Apply list
+		190=Show only these waypoints
+		191=Select file
+		192=Save changes
+		193=add Addis
+		195=Current Center
+		196=Total # of caches (GC&OC)%0aTotal # visible%0aTotal # found
+		197=Show/Hide cachetour	
+		198=Cachetour
 		200=Details
 		201=Description
 		202=Images

Added: trunk/resources/clnew.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/clnew.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/clopen.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/clopen.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/clsave.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/clsave.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/clsaveas.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/clsaveas.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/CacheWolf/CacheList.java
===================================================================
--- trunk/src/CacheWolf/CacheList.java	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/src/CacheWolf/CacheList.java	2007-07-07 21:13:41 UTC (rev 777)
@@ -0,0 +1,409 @@
+package CacheWolf;
+
+import ewe.filechooser.FileChooser;
+import ewe.fx.*;
+import ewe.io.*;
+import ewe.sys.*;
+import ewe.ui.*;
+import ewe.util.*;
+
+/********************************************************
+ * This class implements the core functionality of a flexible cachelist for collecting
+ * "Cachetours". Caches can be dragged into the list from the main list view and
+ * from the radar panel view. Caches can be removed from the list by dragging them
+ * out or selecting them and pressing the "delete" key. Within the list the selected
+ * cache can be moved up/down using two buttons. The finished list can be saved and 
+ * reloaded with the selected position being stored. The list can be applied as
+ * a filter to the main list, thereby hiding all caches that are not in the list
+ * and sorting the caches according to the list. 
+ * Created by skg, Februar 2007
+ ********************************************************/
+public class CacheList extends CellPanel {
+    /** The extension for cachelists (CL) */ 
+    private final String EXTENSION="CL";
+	private final String TITLE=MyLocale.getMsg(188,"CACHETOUR: NEW");
+    CacheList() {
+		this.setPreferredSize(100,-1); 
+		this.equalWidths=true;
+		mImage imgDown=new mImage("ewe/downarrowsmall.bmp"); imgDown.transparentColor=Color.White;
+		mImage imgUp=new mImage("ewe/uparrowsmall.bmp"); imgUp.transparentColor=Color.White;
+		// Title
+		lblTitle=new mLabel(TITLE);
+		lblTitle.backGround=new Color(0,0,200); lblTitle.foreGround=Color.White; 
+		addLast(lblTitle,HSTRETCH,HFILL|HCENTER);
+		// The actual list
+		lstCaches=new myList(10,1,false); lstCaches.text="CacheList"; 
+		lstCaches.addItem(MyLocale.getMsg(180,"Drag caches"));lstCaches.addItem(MyLocale.getMsg(181,"here"));
+		ScrollablePanel scp=lstCaches.getScrollablePanel();
+		addLast(scp,STRETCH,FILL); scp.setOptions(ScrollablePanel.NeverShowHorizontalScrollers);
+		// The buttons to move the selected cache
+		addNext(btnDown=new mButton(imgDown),HSHRINK,HFILL); btnDown.modify(Disabled,0);
+		addLast(btnUp=new mButton(imgUp),HSHRINK,HFILL); btnUp.modify(Disabled,0);
+		// Buttons to clear, load and save the list
+		CellPanel cp=new CellPanel(); cp.equalWidths=true;
+		cp.addNext(btnNew=new mButton(imgNew=new mImage("clnew.png")),HSTRETCH,HFILL);
+		imgNew.transparentColor=new Color(255,0,0); btnNew.setToolTip(MyLocale.getMsg(182,"New list"));
+		cp.addNext(btnLoad=new mButton(imgOpen=new mImage("clopen.png")),HSTRETCH,HFILL);
+		imgOpen.transparentColor=new Color(255,0,0);btnLoad.setToolTip(MyLocale.getMsg(183,"Load list"));
+		cp.addNext(btnSaveAs=new mButton(imgSaveAs=new mImage("clsaveas.png")),HSTRETCH,HFILL);
+		imgSaveAs.transparentColor=new Color(0,255,0);btnSaveAs.setToolTip(MyLocale.getMsg(184,"Save as"));
+		cp.addLast(btnSave=new mButton(imgSave=new mImage("clsave.png")),HSTRETCH,HFILL);
+		imgSave.transparentColor=new Color(255,0,0);btnSave.setToolTip(MyLocale.getMsg(185,"Save (without confirmation)"));
+		addLast(cp,HSTRETCH,HFILL);
+		// Button to toggle whether additional waypoints are automatically dragged
+		// with the parent waypoint
+		addLast(chkAddAddis=new mCheckBox(MyLocale.getMsg(193,"add Addis")),HSTRETCH,HFILL);
+		chkAddAddis.setToolTip(MyLocale.getMsg(186,"Also drag Addi Wpts"));
+		// Finally button to apply the list as a filter
+		addLast(btnFilter=new mButton(MyLocale.getMsg(189,"Apply List")),HSTRETCH,HFILL);btnFilter.modify(Disabled,0);
+		btnFilter.setToolTip(MyLocale.getMsg(190,"Show only these waypoints"));
+	}
+    /** Flag to ensure the initial message "Caches hierher ziehen" is cleared
+     * when the first cache is dragged into the list */
+	private boolean needsInit=true;
+	/** The actual list. This is mirrored by cacheList */
+	private myList lstCaches;
+	/** True if there are unsaved changes */
+	private boolean dirty=false;
+	// The UI elements
+	private mLabel lblTitle; 
+	private mCheckBox chkAddAddis;
+	private mButton btnDown, btnUp, btnLoad, btnNew, btnSave, btnSaveAs, btnFilter;
+    private mImage imgOpen,imgNew,imgSave,imgSaveAs;
+	/** This list mirrors the items in the list of selected caches for faster access. When the 
+     * list of selected caches is manipulated (btnUp, btnDown), this list is also kept up to date
+     */
+	private Vector cacheList=new Vector(20);
+	/** The full filename of the current file */
+	private String currFile=null;
+	
+	private class myList extends mList {
+		myList(int rows, int columns, boolean multi) { super(rows,columns,multi); }
+		
+		//  Allow the caches to be dragged out of the cachelist
+		String wayPoint;
+		int idx;
+		
+		public void startDragging(DragContext dc) {
+			 idx=getSelectedIndex(0);
+			 if (idx>=0) {
+				 CacheHolder ch=(CacheHolder)cacheList.get(idx);
+				 wayPoint=ch.wayPoint;
+				 IconAndText imgDrag=new IconAndText();
+				 imgDrag.addColumn((IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)]);
+				 imgDrag.addColumn(ch.wayPoint);
+				 dc.dragData=dc.startImageDrag(imgDrag,new Point(8,8),this);
+			 } 
+		}
+
+		public void dragged(DragContext dc) {
+			 	dc.imageDrag();
+		}
+		 
+		public void stopDragging(DragContext dc) {
+			 dc.stopImageDrag(true);
+			 Point p = Gui.getPosInParent(this,getWindow());
+			 p.x += dc.curPoint.x;
+			 p.y += dc.curPoint.y;
+			 Control c = getWindow().findChild(p.x,p.y);
+		     if (!(c instanceof myList)) { 
+		    	 // target is not myList => Remove dragged cache from list
+		    	 cacheList.del(idx);
+		    	 lstCaches.deleteItem(idx);
+		    	 repaint();
+		    	 changeUpDownButtonStatus();
+		     }
+		 }
+		
+		// Alternative method of deleting a cache from the list through
+		// Keyboard interface
+		public void onKeyEvent(KeyEvent ev) {
+			if (ev.type == KeyEvent.KEY_PRESS && ev.target == this){
+				if (ev.key == IKeys.DELETE && cacheList.size()>0) {
+			    	 idx=getSelectedIndex(0);
+					 cacheList.del(idx);
+			    	 lstCaches.deleteItem(idx);
+			    	 repaint();
+			    	 changeUpDownButtonStatus();
+				}
+			}
+			super.onKeyEvent(ev);
+		}
+
+	} //******************* myList
+	
+	/** Simple sort to ensure that the main list keeps the order of this list */
+	private class mySort implements Comparer{
+		public int compare(Object o1, Object o2){
+			CacheHolder oo1 = (CacheHolder)o1;
+			CacheHolder oo2 = (CacheHolder)o2;
+			return oo1.sort.compareTo(oo2.sort);
+		}
+	}
+	
+	/** Enable the up/down buttons only if at least 2 caches are in the list */
+	private void changeUpDownButtonStatus() {
+		btnUp.modify(0,Disabled);
+		if (needsInit || lstCaches.itemsSize()<2 || lstCaches.getSelectedIndex(0)==0) btnUp.modify(Disabled,0);
+		btnDown.modify(0,Disabled);
+		if (needsInit || lstCaches.itemsSize()<2 || lstCaches.getSelectedIndex(0)==lstCaches.itemsSize()-1) btnDown.modify(Disabled,0);
+		btnUp.repaintNow();
+		btnDown.repaintNow();
+		// Need at least 2 caches in list to enable it
+		btnFilter.modify(0,Disabled);
+		if (needsInit || lstCaches.itemsSize()<2) btnFilter.modify(Disabled,0);
+		btnFilter.repaintNow();
+	}
+	
+	public void onEvent(Event ev) {
+		if (ev instanceof MenuEvent && ev.type==MenuEvent.SELECTED) {
+			if (lstCaches.itemsSize()>0) {
+				int lstCacheIdx=lstCaches.getSelectedIndex(0);
+				CacheHolder ch=(CacheHolder)cacheList.get(lstCacheIdx);
+				int idx=Global.getProfile().cacheDB.find(ch);
+				// Select the cache also in the main list view
+				Global.mainTab.tbP.selectRow(idx);
+				// Ensure that the main view is updated with the selected cache, i.e.
+				// DetailsPanel, HintLog, Pictures etc.
+				int activeTab=Global.mainTab.cardPanel.selectedItem;
+				if (activeTab==0) 
+					Global.mainTab.tbP.tc.repaint();
+				else
+					Global.mainTab.onEvent(new MultiPanelEvent(0,Global.mainTab,activeTab));
+			}
+		}
+		if (ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED) {
+			if (ev.target==btnNew) { 
+				newCacheList();
+			} else if(ev.target == btnLoad){
+				FileChooser fc = new FileChooser(FileChooser.OPEN, Global.getProfile().dataDir);
+				//fc.addMask(currCh.wayPoint + ".wl");
+				fc.addMask("*."+EXTENSION);
+				fc.addMask("*.*");
+				fc.setTitle(MyLocale.getMsg(191,"Select File"));
+				if(fc.execute() != FileChooser.IDCANCEL){
+					currFile = fc.getChosen();
+					readFromFile(currFile);
+				}
+			} else if((ev.target == btnSave) && (currFile != null)){
+				saveToFile(currFile);
+			} else if((ev.target == btnSaveAs)||((ev.target == btnSave) && (currFile == null))){
+				FileChooser fc = new FileChooser(FileChooser.SAVE, Global.getProfile().dataDir);
+				//fc.addMask(currCh.wayPoint + ".wl");
+				fc.addMask("*."+EXTENSION);
+				fc.setTitle(MyLocale.getMsg(191,"Select File"));
+				if(fc.execute() != FileChooser.IDCANCEL){
+					currFile = fc.getChosen();
+					saveToFile(currFile);
+				}
+			} else if (ev.target==btnUp) {
+				int sel=lstCaches.getSelectedIndex(0);
+				if (sel>0) {
+					dirty=true;
+					// Swap items in hidden list
+					Object swap=cacheList.get(sel-1);
+					cacheList.set(sel-1,cacheList.get(sel));
+					cacheList.set(sel,swap);
+					// Swap items in visible cachelist and repaint
+					swap=lstCaches.items.get(sel-1);
+					lstCaches.items.set(sel-1,lstCaches.items.get(sel));
+					lstCaches.items.set(sel,swap);
+					lstCaches.repaintDataNow();
+					lstCaches.select(sel-1);
+				}
+			} else if (ev.target==btnDown) {
+				int sel=lstCaches.getSelectedIndex(0);
+				if (sel<lstCaches.itemsSize()-1) {
+					dirty=true;
+					// Swap items in hidden list
+					Object swap=cacheList.get(sel+1);
+					cacheList.set(sel+1,cacheList.get(sel));
+					cacheList.set(sel,swap);
+					// Swap items in visible cachelist and repaint
+					swap=lstCaches.items.get(sel+1);
+					lstCaches.items.set(sel+1,lstCaches.items.get(sel));
+					lstCaches.items.set(sel,swap);
+					lstCaches.repaintDataNow();
+					lstCaches.select(sel+1);
+				}
+			} else if (ev.target==btnFilter) {
+				Vector cacheDB=Global.getProfile().cacheDB;
+				CacheHolder ch;
+				// Start by setting all caches to filtered
+				for(int i = cacheDB.size()-1; i >=0 ; i--){
+					ch = (CacheHolder)cacheDB.get(i);
+					ch.is_filtered=true ; // ignore blacklist attribute
+					ch.sort="\uFFFF";
+				}
+				// Now "unfilter" the caches in our list
+				for (int i = cacheList.size()-1; i>=0; i--) {
+					ch = (CacheHolder)cacheList.get(i);
+					ch.is_filtered=false;
+					ch.sort=MyLocale.formatLong(i,"00000");
+				}
+				// The sort command places all filtered caches at the end
+				cacheDB.sort(new mySort(),false);
+				Filter.filterActive=true;
+				Filter.filterInverted=false;
+				updateScreen();
+			}
+		}
+		changeUpDownButtonStatus();
+	}
+
+
+	/** Add a cache (and its addis) to the list 
+	 * @return true if the cache is not already in lstCaches */
+	public boolean addCache(String wayPoint) {
+		// Check whether this is the first cache being added
+		if (needsInit)  {lstCaches.deleteItem(0);lstCaches.deleteItem(0);  needsInit=false; }
+		int idx=Global.getProfile().getCacheIndex(wayPoint);
+		if (idx==-1) return false;
+		CacheHolder ch=(CacheHolder) Global.getProfile().cacheDB.get(idx);
+		boolean cachesAdded=false;
+		// Add addis if user wants it
+		if (chkAddAddis.state && ch.hasAddiWpt()) {
+			CacheHolder addiWpt;
+			for (int j=0; j<ch.addiWpts.getCount();j++){
+				addiWpt = (CacheHolder)ch.addiWpts.get(j);
+				if (!addiWpt.is_filtered) cachesAdded|=addCache(addiWpt);
+			}
+		}
+		// Add main cache
+		cachesAdded|=addCache(ch);
+		// Update screen if any cache was added
+		if (cachesAdded) {	
+			lstCaches.select(lstCaches.itemsSize()-1);
+			changeUpDownButtonStatus();
+		}
+		return cachesAdded;	
+	}
+
+	/** Add a cache to the visible and invisible list */
+	private boolean addCache(CacheHolder ch) {
+		if (cacheList.find(ch)<0) {
+			// Add cache reference to hidden list
+			cacheList.add(ch);
+			// Add Cache and cache icon to visible list
+			lstCaches.addItem((new MenuItem()).iconize(ch.wayPoint+"   "+ch.CacheName,(IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)],true));
+		    dirty=true;
+			return true;
+		} else
+			return false;
+	}
+	
+	void updateScreen() {
+		Global.mainTab.tbP.myMod.numRows=cacheList.size();
+		// Check whether the currently selected cache is still visible
+		//selectRow(getSelectedCache());
+		Global.mainTab.tbP.tc.update(true); // Update and repaint
+		if (Global.mainTab.tbP.statBar!=null) Global.mainTab.tbP.statBar.updateDisplay();
+		int selPanel;
+		if ((selPanel=Global.mainTab.cardPanel.selectedItem)>-1) {
+			if (selPanel==1) {
+				//postEvent(new MultiPanelEvent(MultiPanelEvent.SELECTED,Global.mainTab,1));
+				Global.mainTab.detP.repaint();
+			}
+		}
+	}
+
+	/** Check if there are any unsaved changes and ask user if he wants to save */
+	public void saveIfDirty() {
+		if (dirty) {
+			if ((new MessageBox(MyLocale.getMsg(144,"Warning"),MyLocale.getMsg(192,"Save changes"),MessageBox.MBYESNO)).execute()==MessageBox.IDYES) {
+				if (currFile!=null)
+					saveToFile(currFile);
+				else {
+					FileChooser fc = new FileChooser(FileChooser.SAVE, Global.getProfile().dataDir);
+					fc.addMask("*."+EXTENSION);
+					fc.setTitle(MyLocale.getMsg(191,"Select File"));
+					if(fc.execute() != FileChooser.IDCANCEL){
+						currFile = fc.getChosen();
+						saveToFile(currFile);
+					}
+				}
+			}
+		}
+		dirty=false;
+	}
+	
+	/** Clear the cachelist (save unsaved changes if needed) */
+	private void newCacheList() { 		
+		saveIfDirty();
+		lstCaches.items.clear();
+		cacheList.clear();
+		lstCaches.repaint();
+		lblTitle.setText(TITLE);
+		currFile=null;
+	}
+	
+	/** Read a list of caches */
+	private void readFromFile(String fileName) {
+		if (needsInit)  {lstCaches.deleteItem(0);lstCaches.deleteItem(0);  needsInit=false; }
+		int select=-1;
+		try {
+			FileReader in = new FileReader(fileName);
+			String wayPoint;
+			int idx;
+			Vector cacheDB=Global.getProfile().cacheDB;
+			int lineNr=0;
+			while ((wayPoint = in.readLine()) != null){
+				wayPoint=wayPoint.trim();
+				// Select the cache starting with >
+				if (wayPoint.startsWith(">")) {
+					wayPoint=wayPoint.substring(1);
+					select=lineNr;
+				}
+				// Only add the cache if it is in this profile
+				idx=Global.getProfile().getCacheIndex(wayPoint);
+				if (idx>=0) {
+					addCache((CacheHolder) cacheDB.get(idx));
+				}
+				lineNr++;
+			}
+			in.close();
+		} catch(Exception e) {
+			Global.getPref().log("Problem reading: " +fileName,e,true);
+		}
+		if (select>-1)
+			lstCaches.select(select);
+		else	
+		    lstCaches.select(lstCaches.itemsSize()-1);
+		lstCaches.repaint();
+		this.postEvent(new MenuEvent(MenuEvent.SELECTED,this,null));
+		changeUpDownButtonStatus();
+		setTitle(fileName);
+		dirty=false;
+	}
+	
+	/** Save the cachelist */
+	private void saveToFile(String fileName) {
+		int selectedIndex=lstCaches.getSelectedIndex(0);
+		try {
+			PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(fileName)));
+			for (int i=0; i<cacheList.size(); i++) {
+				// Put a > in front of the selected cache
+				outp.print((i==selectedIndex?">":"")+((CacheHolder)cacheList.get(i)).wayPoint+"\n");
+			}
+			outp.close();
+		} catch(Exception e) {
+			Global.getPref().log("Problem saving: " +fileName,e,true);
+		}
+		setTitle(fileName);
+		dirty=false;
+	}
+	
+	/** Set the title */
+	private void setTitle(String fileName) {
+		String localFileName=fileName.replace('\\','/');
+		// Delete the path preceding the filename
+		if (localFileName.lastIndexOf('/')>0)
+			localFileName=localFileName.substring(localFileName.lastIndexOf('/')+1);
+		// Drop the extension
+		if (localFileName.indexOf('.')>0)
+			lblTitle.setText(localFileName.substring(0,localFileName.indexOf('.')));
+		else
+			lblTitle.setText(localFileName);
+		lblTitle.repaint();
+	}
+}

Modified: trunk/src/CacheWolf/Global.java
===================================================================
--- trunk/src/CacheWolf/Global.java	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/src/CacheWolf/Global.java	2007-07-07 21:13:41 UTC (rev 777)
@@ -18,5 +18,6 @@
 	  }
       // A bit of a hack to allow access from one panel to another
 	  static public MainTab mainTab;
+	  static public MainForm mainForm;
 }
 

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/src/CacheWolf/MainForm.java	2007-07-07 21:13:41 UTC (rev 777)
@@ -9,6 +9,10 @@
 *	Class ID = 5000
 */
 public class MainForm extends Form {
+	// The next three declares are for the cachelist
+	boolean cacheListVisible=false;
+    CacheList cacheList;
+    SplittablePanel split;
 	
 	StatusBar statBar=null;
 	Preferences pref = Global.getPref(); // Singleton pattern
@@ -42,6 +46,7 @@
 	}
 	
 	public void doIt(){
+		Global.mainForm=this;
 		this.title = "CacheWolf " + Version.getRelease();
 		this.exitSystemOnClose = true;
 		this.resizable = true;
@@ -83,16 +88,25 @@
 		if (pref.showStatus) statBar = new StatusBar(pref, profile.cacheDB);
 		mMenu = new MainMenu(this);
 		mTab = new MainTab(mMenu,statBar);
+		split=new SplittablePanel(PanelSplitter.HORIZONTAL);
+		split.theSplitter.thickness=0; split.theSplitter.modify(Invisible,0);
+		CellPanel pnlCacheList = split.getNextPanel();
+		CellPanel pnlMainTab = split.getNextPanel(); 
+		split.setSplitter(PanelSplitter.MIN_SIZE|PanelSplitter.BEFORE,PanelSplitter.HIDDEN|PanelSplitter.BEFORE,PanelSplitter.CLOSED);
+		pnlCacheList.addLast(cacheList=new CacheList(),STRETCH,FILL);
+		pnlMainTab.addLast(mTab,STRETCH,FILL);
+		mTab.dontAutoScroll=true;
 		if (pref.menuAtTop) {
 			this.addLast(mMenu,CellConstants.DONTSTRETCH, CellConstants.FILL);
-			this.addLast(mTab,CellConstants.STRETCH, CellConstants.FILL);
+			this.addLast(split,STRETCH,FILL);
 		} else {
-			this.addLast(mTab,CellConstants.STRETCH, CellConstants.FILL);
+			this.addLast(split,STRETCH,FILL);
 			this.addLast(mMenu,CellConstants.DONTSTRETCH, CellConstants.FILL);
 		}
 		mMenu.setTablePanel(mTab.getTablePanel());
 		infB.close(0);
 		mTab.tbP.selectFirstRow();
+		//mTab.tbP.tc.paintSelection();
 		Vm.showWait(false);
 	}
 
@@ -122,4 +136,22 @@
 		super.onEvent(ev);
 	}
 
+	public void toggleCacheListVisible() {
+		cacheListVisible=!cacheListVisible;
+		if (cacheListVisible) {
+			// Make the splitterbar visible with a width of 6 
+			split.theSplitter.modify(0,Invisible);
+			split.theSplitter.resizeTo(6,split.theSplitter.getRect().height);
+			Global.mainForm.mMenu.orgCacheTour.modifiers|=MenuItem.Checked;
+		} else {
+			// Hide the splitterbar and set width to 0
+			split.theSplitter.modify(Invisible,0);
+			split.theSplitter.resizeTo(0,split.theSplitter.getRect().height);
+			Global.mainForm.mMenu.orgCacheTour.modifiers&=~MenuItem.Checked;
+		}
+		split.theSplitter.doOpenClose(cacheListVisible);
+		Global.mainForm.mMenu.repaint();
+		
+	}
+	
 }

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/src/CacheWolf/MainMenu.java	2007-07-07 21:13:41 UTC (rev 777)
@@ -29,6 +29,7 @@
 	private MenuItem filtCreate, filtClear, filtInvert, filtSelected, filtBlack, filtApply;
 	private MenuItem exportGPS, exportCacheMate,mnuSeparator;
 	private MenuItem orgCopy, orgMove, orgDelete;
+	public MenuItem orgCacheTour;
 	private MenuItem mnuNewProfile, mnuOpenProfile, mnuEditCenter;
 	private Form father;
 	private TablePanel tbp;
@@ -150,10 +151,12 @@
 		///////////////////////////////////////////////////////////////////////
 		// Create the "Organize" pulldown menu
 		///////////////////////////////////////////////////////////////////////
-		MenuItem[] organizeMenuItems=new MenuItem[3];
+		MenuItem[] organizeMenuItems=new MenuItem[5];
 		organizeMenuItems[0] = orgCopy  = new MenuItem(MyLocale.getMsg(141,"Copy")); 
 		organizeMenuItems[1] = orgMove  = new MenuItem(MyLocale.getMsg(142,"Move")); 
 		organizeMenuItems[2] = orgDelete   = new MenuItem(MyLocale.getMsg(143,"Delete"));
+		organizeMenuItems[3] = mnuSeparator;
+		organizeMenuItems[4] = orgCacheTour = new MenuItem(MyLocale.getMsg(198,"Cachetour"));
 		this.addMenu(new PullDownMenu(MyLocale.getMsg(140,"Organize"),new Menu(organizeMenuItems,null)));
 
 		///////////////////////////////////////////////////////////////////////
@@ -496,6 +499,10 @@
 				dm.deleteCaches();
 				tbp.refreshTable();
 			}
+			if(mev.selectedItem == orgCacheTour){
+				orgCacheTour.modifiers^=MenuItem.Checked;
+				Global.mainForm.toggleCacheListVisible();			
+			}
 			///////////////////////////////////////////////////////////////////////
 			// "About" pulldown menu
 			///////////////////////////////////////////////////////////////////////
@@ -533,14 +540,15 @@
 			if(mev.selectedItem == chkVersion){
 				Version vers = new Version();
 				if(vers.newVersionAvailable(pref)){
-					InfoBox inf = new InfoBox("New Version", "New version\navailable.");// TODO Internationalisation when code has been written
+					InfoBox inf = new InfoBox(MyLocale.getMsg(176,"New Version"), MyLocale.getMsg(177,"New version\navailable."));
 					inf.execute();
 				} else {
-					InfoBox inf = new InfoBox("Version Check", "You are at\nthe current version.");// TODO Internationalisation when code has been written
+					InfoBox inf = new InfoBox(MyLocale.getMsg(178,"Version Check"), MyLocale.getMsg(179,"You are at\nthe current version."));
 					inf.execute();
 				}
 			}
 
 		}
 	}
+	
 }

Modified: trunk/src/CacheWolf/StatusBar.java
===================================================================
--- trunk/src/CacheWolf/StatusBar.java	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/src/CacheWolf/StatusBar.java	2007-07-07 21:13:41 UTC (rev 777)
@@ -16,12 +16,18 @@
 	Preferences pref;
 	mButton btnFlt;
 	mImage imgFlt;
+	mButton btnCacheTour;
+	mImage imgCacheTour; 
 	
 	public StatusBar(Preferences p, Vector db){
 		pref=p;
+		addNext(btnCacheTour=new mButton(imgCacheTour=new mImage("cachetour.png")),CellConstants.DONTSTRETCH, CellConstants.DONTFILL);
+		imgCacheTour.transparentColor=Color.White;
+		btnCacheTour.setPreferredSize(20,13);btnCacheTour.borderWidth=0; 
+		btnCacheTour.setToolTip(MyLocale.getMsg(197,"Show/Hide cachetour"));
 		stats = new DBStats(db);
 		addNext(disp = new mLabel(""),CellConstants.DONTSTRETCH, CellConstants.FILL);
-		disp.setToolTip("Total # of caches (GC&OC)\nTotal # visible\nTotal # found");
+		disp.setToolTip(MyLocale.getMsg(196,"Total # of caches (GC&OC)\nTotal # visible\nTotal # found"));
 		addNext(btnFlt= new mButton(imgFlt=new mImage("filter.png")),CellConstants.DONTSTRETCH, CellConstants.DONTFILL); 
 		btnFlt.backGround=new ewe.fx.Color(0,255,0); 
 		btnFlt.setPreferredSize(20,13);
@@ -29,7 +35,7 @@
 		btnFlt.setToolTip("Filter status");
 //		addNext(lblFlt= new mLabel("Flt"),CellConstants.DONTSTRETCH, CellConstants.DONTFILL); lblFlt.backGround=new ewe.fx.Color(0,255,0);
 		addLast(lblCenter=new mLabel(""),CellConstants.STRETCH, WEST|CellConstants.FILL);
-		lblCenter.setToolTip("Current center");
+		lblCenter.setToolTip(MyLocale.getMsg(195,"Current center"));
 		updateDisplay();
 	}
 	
@@ -65,6 +71,9 @@
 				}
 				Global.mainTab.tbP.refreshTable();
 			}
+			if (ev.target == btnCacheTour){
+				Global.mainForm.toggleCacheListVisible();			
+			}
 		}
 		super.onEvent(ev);
 	}

Modified: trunk/src/CacheWolf/myInteractivePanel.java
===================================================================
--- trunk/src/CacheWolf/myInteractivePanel.java	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/src/CacheWolf/myInteractivePanel.java	2007-07-07 21:13:41 UTC (rev 777)
@@ -1,6 +1,7 @@
 package CacheWolf;
 import ewe.graphics.*;
 import ewe.ui.*;
+import ewe.util.Vector;
 import ewe.sys.*;
 import ewe.fx.*;
 import ewe.graphics.*;
@@ -23,6 +24,7 @@
 	AniImage imgInfo;
 	String strDifficulty=MyLocale.getMsg(1120,"Diff");
 	String strTerrain=MyLocale.getMsg(1121,"Terr");
+	AniImage imgDrag; // Allows the dragging of the cache into the cachelist
 	
 	private void clearInfo() {
 		removeImage(imgInfo);
@@ -74,7 +76,8 @@
 		imgInfo.properties = mImage.IsNotHot;
 		addImage(imgInfo);
 		refreshOnScreen(imgInfo);
-		return true;
+		imgDrag=which;
+	return true;
 	}
 	public boolean imageMovedOff(AniImage which) {
 		clearInfo();
@@ -82,41 +85,92 @@
 	}
 	public void onPenEvent(PenEvent ev) {
 		super.onPenEvent(ev);
-		if (ev.type==PenEvent.PEN_UP) clearInfo();
+		if (ev.type==PenEvent.PEN_UP) {
+			clearInfo();
+			// The next line is needed due to a bug in EWE (it does not call penReleased)
+			if (isDragging) penReleased(new Point(ev.x,ev.y));
+		}
 	}
-	/*
-	public void onEvent(Event ev){
-		BufferedGraphics bfg;
-		Graphics g;
-		if(ev instanceof PenEvent && ev.type == PenEvent.PEN_DRAG){
-			PenEvent pev = (PenEvent)ev;
-			if(penMoving == false){
-				penMoving = true;
-				x1 = pev.x;
-				y1 = pev.y;
-				x2 = x1;
-				y2 = y1;
-				Vm.debug("Pen starting");
-			} else {
-				bfg = new BufferedGraphics(this.getGraphics(), new Rect(new Dimension(50,50)));
-				g = bfg.getGraphics();
-				g.setDrawOp(Graphics.DRAW_XOR);
-				g.setPen(new Pen(RED,Pen.SOLID,1));
-				g.drawRect(x1,y1,20,20);
-				bfg.release();
-				x2 = pev.x;
-				y2 = pev.y;
-				bfg = new BufferedGraphics(this.getGraphics(), new Rect(new Dimension(50,50)));
-				g = bfg.getGraphics();
-				g.setDrawOp(Graphics.DRAW_XOR);
-				g.setPen(new Pen(RED,Pen.SOLID,1));
-				g.drawRect(x1,y1,x2-x1,y2-y1);
-				bfg.release();
-				Vm.debug("Pen moving");
-			}
+	
+    ///////////////////////////////////////////////////
+	//  Allow the caches to be dragged into a cachelist
+    ///////////////////////////////////////////////////
+	
+	String wayPoint;
+	
+	public void startDragging(DragContext dc) {
+		Vector cacheDB=Global.getProfile().cacheDB;
+//Vm.debug("myIAP startDrag "+dc.start.x+"/"+dc.start.y+"  "+ch.wayPoint);
+		 int idx=Global.getProfile().getCacheIndex(wayPoint); 
+		if (idx>=0) {
+			 CacheHolder ch=(CacheHolder) cacheDB.get(idx);
+			 //wayPoint=ch.wayPoint;
+			 //Vm.debug("Waypoint : "+ch.wayPoint);
+			 IconAndText icnDrag=new IconAndText();
+			 icnDrag.addColumn((IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)]);
+			 icnDrag.addColumn(ch.wayPoint);
+			 dc.dragData=dc.startImageDrag(icnDrag,new Point(8,8),this);
+			 if (dc instanceof ImageDragContext) Vm.debug(">>>>Is Image drag");
+		}
+	 }
+
+	 public void stopDragging(DragContext dc) {}
+	 public void draggingStarted(ImageDragContext dc) {}
+	 public void draggingStopped(ImageDragContext dc) {}
+	 
+	 public boolean imageBeginDragged(AniImage which,Point pos) {
+		clearInfo();
+		wayPoint=null;
+		AniImage dragImage=null;
+		if (which instanceof RadarPanelImage) {
+			RadarPanelImage imgRP=(RadarPanelImage) which;
+			ewe.util.Vector cacheDB=Global.getProfile().cacheDB;
+			CacheHolder ch=(CacheHolder) cacheDB.get(imgRP.rownum);
+			wayPoint=ch.wayPoint;
 			
+			int tw,th;
+			Image img = new Image(tw=fm.getTextWidth(wayPoint+15),th=fm.getHeight()>15?fm.getHeight():15);
+			Graphics g = new Graphics(img);
+			g.setColor(Color.White);
+			g.fillRect(0,0,tw, th);
+			g.setColor(new Color(255,0,0));
+			g.drawText(wayPoint, 15,1);
+			g.drawImage(which.image,0,0);
+			dragImage=new AniImage(img);
+			dragImage.properties|=AniImage.IsMoveable;
+			dragImage.setLocation(pos.x,pos.y);
 		}
-		super.onEvent(ev);
-	}
-	*/
+		return super.imageBeginDragged(dragImage,pos);
+	 }
+
+	 public boolean imageDragged(ImageDragContext drag, Point pos) {
+		 	if (drag.image!=null) {
+/*			    Point p = Gui.getPosInParent(this,getWindow());
+			 	p.x += pos.x-origin.x;
+			 	p.y += pos.y-origin.y;
+			 	Control c = getWindow().findChild(p.x,p.y);
+*/
+				drag.clearPendingDrags();
+		 	}
+		 	return super.imageDragged(drag,pos);
+	 }
+	 
+	 public boolean imageNotDragged(ImageDragContext drag, Point pos) {
+		if (drag.image!=null) {
+			images.remove(drag.image);
+			drag.image=null;
+			refresh();
+		}			
+		 Point p = Gui.getPosInParent(this,getWindow());
+		 p.x += drag.curPoint.x-origin.x;
+		 p.y += drag.curPoint.y-origin.y;
+		 Control c = getWindow().findChild(p.x,p.y);
+	     if (c instanceof mList && c.text.equals("CacheList")) {
+	    	 if (Global.mainForm.cacheList.addCache(wayPoint)) {
+	    		 c.repaintNow();
+	    		 ((mList) c).makeItemVisible(((mList)c).itemsSize()-1);
+	    	 }
+	     }
+		 return false; 
+	 }
 }

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-07-03 21:37:34 UTC (rev 776)
+++ trunk/src/CacheWolf/myTableControl.java	2007-07-07 21:13:41 UTC (rev 777)
@@ -213,4 +213,51 @@
 	    if (ev instanceof PenEvent) Global.mainTab.tbP.myMod.penEventModifiers=((PenEvent)ev).modifiers;
 		super.onEvent(ev);
 	}
+    ///////////////////////////////////////////////////
+	//  Allow the caches to be dragged into a cachelist
+    ///////////////////////////////////////////////////
+	
+	IconAndText imgDrag;
+	String wayPoint;
+	
+	public void startDragging(DragContext dc) {//TODO Dragging of header widths
+		 Vector cacheDB=Global.getProfile().cacheDB;
+		 Point p=cellAtPoint(dc.start.x,dc.start.y,null);
+		 wayPoint=null;
+		 if (p.y>=0) { 
+			 CacheHolder ch=(CacheHolder)cacheDB.get(p.y);
+			 wayPoint=ch.wayPoint;
+			 //Vm.debug("Waypoint : "+ch.wayPoint);
+			 imgDrag=new IconAndText();
+			 imgDrag.addColumn((IImage) Global.mainTab.tbP.myMod.cacheImages[Convert.parseInt(ch.type)]);
+			 imgDrag.addColumn(ch.wayPoint);
+			 dc.dragData=dc.startImageDrag(imgDrag,new Point(8,8),this);
+		 } else super.startDragging(dc);
+	 }
+
+	 public void stopDragging(DragContext dc) {
+		 if (wayPoint!=null) {
+			 //Vm.debug("Stop  Dragging"+dc.curPoint.x+"/"+dc.curPoint.y);
+			 dc.stopImageDrag(true);
+			 Point p = Gui.getPosInParent(this,getWindow());
+			 p.x += dc.curPoint.x;
+			 p.y += dc.curPoint.y;
+			 Control c = getWindow().findChild(p.x,p.y);
+		     if (c instanceof mList && c.text.equals("CacheList")) {
+		    	 if (Global.mainForm.cacheList.addCache(wayPoint)) {
+		    		 c.repaintNow();
+		    		 ((mList) c).makeItemVisible(((mList)c).itemsSize()-1);
+		    	 }
+		     }
+			 //Vm.debug("Control "+c.toString()+"/"+c.text);
+		 }else super.stopDragging(dc);
+	 }
+	 
+	 public void dragged(DragContext dc) {
+	 	if (wayPoint!=null)
+		   dc.imageDrag();
+	 	else
+	 		super.dragged(dc);
+	 }
+
 }



From salzkammergut at mail.berlios.de  Sat Jul  7 23:30:58 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 7 Jul 2007 23:30:58 +0200
Subject: [Cachewolf-svn] r778 - trunk/src/CacheWolf
Message-ID: <200707072130.l67LUwtL012057@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-07 23:30:52 +0200 (Sat, 07 Jul 2007)
New Revision: 778

Modified:
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/CWPoint.java
   trunk/src/CacheWolf/TrackPoint.java
Log:
Aufraeumen - Entfernen nicht verwendeter Funktionen

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2007-07-07 21:13:41 UTC (rev 777)
+++ trunk/src/CacheWolf/Attributes.java	2007-07-07 21:30:52 UTC (rev 778)
@@ -17,14 +17,20 @@
 	private Attribute attribs[]=new Attribute[MAXATTRIBS];
 
 	public Attributes() { 
-//		attribs[0]=new Attribute("camping-no.gif"); attribs[1]=new Attribute("dogs-yes.gif"); attribs[2]=new Attribute("onehour-yes.gif"); count=3; //TODO REMOVE THIS
 	}
 
-	public int getCount(){
+	/**
+	 * Get the number of attributes in the list
+	 * @return number of attributes
+	 */public int getCount(){
 		return count;
 	}
 	
-	public void clear() {
+	/**
+	 * Clear the attributes list
+	 *
+	 */
+	 public void clear() {
 		count=0;
 	}
 	
@@ -63,20 +69,39 @@
 		return sb.toString();
 	}
 	
+	/**
+	 * Add a new attributes
+	 * @param attributeName
+	 */
 	public void add(String attributeName){
 		if (count<attribs.length) attribs[count++]=new Attribute(attributeName);
     }
 
+	/**
+	 * Get the name of the i'th attribute in the list
+	 * @param i The number of the attribute to retrieve
+	 * @return The name of the attribute (e.g. horses-no.gif)
+	 */
 	public String getName(int i) {
 		if (i>=0 && i<count) return attribs[i].getImageName();
 		return "error.gif";
 	}
 	
+	/**
+	 * Get the image corresponding to an attribute
+	 * @param i The number of the attribute for which the image is to be retrieved
+	 * @return The mImage of the attribute
+	 */
 	public mImage getImage(int i) {
 		if (i>=0 && i<count) return attribs[i].getImage();
 		return new Attribute().getImage();
 	}
 
+	/**
+	 * Get the infotext for an attribute
+	 * @param i The number of the attribute for which the infotext is to be retrieved
+	 * @return The infotext of the attribute
+	 */
 	public String getInfo(int i) {
 		if (i>=0 && i<count) return attribs[i].getInfo();
 		return "No info";

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2007-07-07 21:13:41 UTC (rev 777)
+++ trunk/src/CacheWolf/CWPoint.java	2007-07-07 21:30:52 UTC (rev 778)
@@ -107,26 +107,15 @@
 	
 	
 	/**
-	 * Create CWPoint using UTM coordinates  
-	 * @param strZone UTM-zone, e.g. 32U
-	 * @param strNorthing Northing component
-	 * @param strEasting  Easting component
-	 */
-	//TODO Remove ? Currently not used at all
-	public CWPoint ( String strZone, String strNorthing, String strEasting){
-		set(strZone, strNorthing, strEasting);
-	}
-
-	/**
 	 * set lat and lon by parsing coordinates with Regex 
 	 * @param coord  String like N 49? 33.167 E 011? 21.608
 	 */
 	public CWPoint(String coord) {
 		set(coord);
 	}
-	public boolean equals (CWPoint p) {
+	/*public boolean equals (CWPoint p) {
 		return super.equals(p);
-	}
+	}*/
 
 	/**
 	 * Set lat and lon 
@@ -285,16 +274,6 @@
 				lonDec <= 360 && lonDec >= -360;
 	}
 	
-	/**
-	 * Constrain latitude and longitude to allowed values
-	 *
-	 */
-	private void makeValid() {
-		if (latDec>90.0) latDec=90.0;
-		if (latDec<-90.0) latDec=-90.0;
-		if (lonDec>180.0) lonDec=180.0;
-		if (lonDec<-180.0) lonDec=-180.0;
-	}
 
 	/**
 	 * set lat and lon by using UTM coordinates  

Modified: trunk/src/CacheWolf/TrackPoint.java
===================================================================
--- trunk/src/CacheWolf/TrackPoint.java	2007-07-07 21:13:41 UTC (rev 777)
+++ trunk/src/CacheWolf/TrackPoint.java	2007-07-07 21:30:52 UTC (rev 778)
@@ -48,11 +48,12 @@
 		TrackPoints = new TrackPoint[5000];
 		num = 0;
 	}
-	
+/*===== add is currently not used	
 	public void add(double lat, double lon) {
 		TrackPoints[num] = new TrackPoint(lat, lon);
 		num++;
 	}
+=====*/	
 	/*
 	 * throws IndexOutOfBoundsException when track is full
 	 */
@@ -61,7 +62,7 @@
 		TrackPoints[num] = new TrackPoint(t);
 		num++;
 	}
-
+/*===== loadTrack/saveTrack are currently not used
 	public void loadTrack(String filename){ // TODO untested!
 		byte [] all = ewe.sys.Vm.readResource(null,filename);
 		if (all == null) return; // TODO error handling
@@ -86,5 +87,7 @@
 	}catch (IOException e) {
 		(new MessageBox("Error", "Error reading trackfile:\n"+e.toString(), MessageBox.OKB)).execute();}
 	}
+=====*/
+
 }
 



From salzkammergut at mail.berlios.de  Sun Jul  8 00:06:59 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 8 Jul 2007 00:06:59 +0200
Subject: [Cachewolf-svn] r779 - in trunk: resources src/CacheWolf
Message-ID: <200707072206.l67M6xrO015419@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-08 00:06:53 +0200 (Sun, 08 Jul 2007)
New Revision: 779

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/MovingMap.java
Log:
CacheTour: Auch aus der Moving Map koennen Caches hinzugefuegt werden (ueber das Kontextmenue wenn zunaechst die 
Cacheliste angezeigt wurde).

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-07-07 21:30:52 UTC (rev 778)
+++ trunk/resources/cachewolf.Languages.cfg	2007-07-07 22:06:53 UTC (rev 779)
@@ -83,7 +83,8 @@
 		195=Derzeitiges Zentrum		
 		196=Gesamte # Caches (GC&OC)%0aGesamt # sichtbar%0aGesamt # gefunden
 		197=Cachetour anzeigen/verbergen
-		198=Cachetour	
+		198=Cachetour
+		199=Zu Cachetour hinzuf%fcgen	
 		200=Details
 		201=Beschreibung
 		202=Bilder
@@ -539,6 +540,7 @@
 		196=Total # of caches (GC&OC)%0aTotal # visible%0aTotal # found
 		197=Show/Hide cachetour	
 		198=Cachetour
+		199=Add to cachetour
 		200=Details
 		201=Description
 		202=Images

Modified: trunk/src/CacheWolf/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/MovingMap.java	2007-07-07 21:30:52 UTC (rev 778)
+++ trunk/src/CacheWolf/MovingMap.java	2007-07-07 22:06:53 UTC (rev 779)
@@ -1299,7 +1299,7 @@
 	Menu kontextMenu;
 	MenuItem gotoMenuItem = new MenuItem("Goto here$g", 0, null);
 	MenuItem newWayPointMenuItem = new MenuItem("Create new Waypoint here$n", 0, null);;
-	MenuItem openCacheDescMenuItem;
+	MenuItem openCacheDescMenuItem,addCachetoListMenuItem;
 
 	Menu mapsMenu;
 	MenuItem selectMapMI = new MenuItem("Select a map manually$s", 0, null);
@@ -1560,8 +1560,12 @@
 			AniImage clickedOnImage = images.findHotImage(p);
 			if (clickedOnImage != null && clickedOnImage instanceof MapSymbol) {
 				clickedCache = ((CacheHolder)((MapSymbol)clickedOnImage).mapObject);
-				if (clickedCache != null) openCacheDescMenuItem = new MenuItem("Open '"+clickedCache.CacheName+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
+				if (clickedCache != null) openCacheDescMenuItem = new MenuItem("Open '"+(clickedCache.CacheName.length()>0?clickedCache.CacheName:clickedCache.wayPoint)+"'$o"); // clickedCache == null can happen if clicked on the goto-symbol
 				kontextMenu.addItem(openCacheDescMenuItem);
+				if (clickedCache !=null && Global.mainForm.cacheListVisible) { 
+					addCachetoListMenuItem = new MenuItem(MyLocale.getMsg(199,"Add to cachetour"));
+					kontextMenu.addItem(addCachetoListMenuItem);
+				}
 			}
 			kontextMenu.exec(this, new Point(p.x, p.y), this);
 		}
@@ -1673,6 +1677,10 @@
 						newWP.LatLon=newWP.pos.toString(); 
 						Global.mainTab.newWaypoint(newWP);
 					}
+					if (action == addCachetoListMenuItem) {
+						kontextMenu.close();
+						Global.mainForm.cacheList.addCache(clickedCache.wayPoint);
+					}
 
 				}
 			} // if (ev.target == kontextMenu)



From bilbowolf at mail.berlios.de  Sun Jul  8 10:00:28 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Sun, 8 Jul 2007 10:00:28 +0200
Subject: [Cachewolf-svn] r780 - branches/bugfix_09n/src/CacheWolf
Message-ID: <200707080800.l6880S2P006934@sheep.berlios.de>

Author: bilbowolf
Date: 2007-07-08 10:00:25 +0200 (Sun, 08 Jul 2007)
New Revision: 780

Modified:
   branches/bugfix_09n/src/CacheWolf/Version.java
Log:
0.9n Patch 4 versionierung

Modified: branches/bugfix_09n/src/CacheWolf/Version.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/Version.java	2007-07-07 22:06:53 UTC (rev 779)
+++ branches/bugfix_09n/src/CacheWolf/Version.java	2007-07-08 08:00:25 UTC (rev 780)
@@ -8,7 +8,7 @@
 
 public class Version {
 	static final String VER_MAJOR = "0.9n";
-	static final String VER_MINOR = " patch 3";
+	static final String VER_MINOR = " patch 4";
 	static final String VER_BUILD = " RC ";
 	static final String VER_SVN ="$LastChangedRevision$"; //the  number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	



From bilbowolf at mail.berlios.de  Sun Jul  8 20:41:11 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Sun, 8 Jul 2007 20:41:11 +0200
Subject: [Cachewolf-svn] r781 - trunk/src/CacheWolf
Message-ID: <200707081841.l68IfBP2004280@sheep.berlios.de>

Author: bilbowolf
Date: 2007-07-08 20:41:04 +0200 (Sun, 08 Jul 2007)
New Revision: 781

Modified:
   trunk/src/CacheWolf/Version.java
Log:
Neu BE versionierung

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2007-07-08 08:00:25 UTC (rev 780)
+++ trunk/src/CacheWolf/Version.java	2007-07-08 18:41:04 UTC (rev 781)
@@ -7,9 +7,9 @@
 import ewe.sys.*;
 
 public class Version {
-	static final String VER_MAJOR = "0.9n";
+	static final String VER_MAJOR = "BE";
 	static final String VER_MINOR = "";
-	static final String VER_BUILD = " RC ";
+	static final String VER_BUILD = " ";
 	static final String VER_SVN ="$LastChangedRevision$"; //the  number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	
 	/**



From salzkammergut at mail.berlios.de  Sun Jul  8 23:47:51 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 8 Jul 2007 23:47:51 +0200
Subject: [Cachewolf-svn] r782 - trunk/src/CacheWolf
Message-ID: <200707082147.l68Llp4b013626@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-08 23:47:47 +0200 (Sun, 08 Jul 2007)
New Revision: 782

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Fix: Wenn ein Cache unvollstaendig gespidert wurde und keine XML Datei existiert, konnte er nicht aktualisiert werden,
da das Lesen der XML Datei einen Fehler verursachte.


Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-08 18:41:04 UTC (rev 781)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-08 21:47:47 UTC (rev 782)
@@ -169,7 +169,11 @@
 		CacheHolderDetail chD=new CacheHolderDetail(ch);
 		try{
 			// Get all existing details of the cache
-			chD.readCache(profile.dataDir);
+			try {
+				chD.readCache(profile.dataDir);
+			} catch (IOException ioex) {
+				pref.log("No .XML file found for cache "+chD.wayPoint);
+			};
 			// Read the cache data from GC.COM and compare to old data
 			ret=getCacheByWaypointName(chD,true,true,false,true);
 			// Save the spidered data 
@@ -178,8 +182,8 @@
 				chD.saveCacheDetails(profile.dataDir);
 				cacheDB.set(number, new CacheHolder(chD)); // TODO Could copy into existing object
 			}
-		}catch(IOException ioex){
-			pref.log("Could not load " + chD.wayPoint + "file in spiderSingle");
+		}catch(Exception ex){
+			pref.log("Error spidering " + chD.wayPoint + " in spiderSingle");
 		}
 		return ret;
 	} // spiderSingle



From bilbowolf at mail.berlios.de  Thu Jul 12 07:26:56 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Thu, 12 Jul 2007 07:26:56 +0200
Subject: [Cachewolf-svn] r783 - in trunk: resources src/CacheWolf
Message-ID: <200707120526.l6C5QuxX015817@sheep.berlios.de>

Author: bilbowolf
Date: 2007-07-12 07:26:53 +0200 (Thu, 12 Jul 2007)
New Revision: 783

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/resources/mnroute.tpl
   trunk/src/CacheWolf/FilterScreen.java
   trunk/src/CacheWolf/Version.java
Log:
Kleinigkeiten

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-07-08 21:47:47 UTC (rev 782)
+++ trunk/resources/cachewolf.Languages.cfg	2007-07-12 05:26:53 UTC (rev 783)
@@ -189,7 +189,7 @@
 		717=Alle w%e4hlen
 		718=Cache Bewertungen
 		719=Cache Typen
-		720=Attribute
+		720=Status
 		721=Richtung
 		722=Bewertung
 		723=Typen
@@ -646,7 +646,7 @@
 		717=Select all
 		718=Cache ratings
 		719=Cache types
-		720=Attributes
+		720=Status
 		721=Direction
 		722=Rating
 		723=Types

Modified: trunk/resources/mnroute.tpl
===================================================================
--- trunk/resources/mnroute.tpl	2007-07-08 21:47:47 UTC (rev 782)
+++ trunk/resources/mnroute.tpl	2007-07-12 05:26:53 UTC (rev 783)
@@ -1,6 +1,8 @@
 <#-- Mobile Navigator Route -->
 <#-- newline: CR, LF, CRLF -->
 <tmpl_par name="newline" value="CRLF">
+<#-- somme chars should not appear in the cachename -->
+<tmpl_par name="badchars" value="|">
 <tmpl_loop cache_index>
--|-|-|-|-|-|-|-|-|-|<tmpl_var name=LON>|<tmpl_var name=LAT>|-|<br/>
+<tmpl_var name=NAME>|-|-|-|-|-|-|-|-|-|<tmpl_var name=LON>|<tmpl_var name=LAT>|-|<br/>
 </tmpl_loop>
\ No newline at end of file

Modified: trunk/src/CacheWolf/FilterScreen.java
===================================================================
--- trunk/src/CacheWolf/FilterScreen.java	2007-07-08 21:47:47 UTC (rev 782)
+++ trunk/src/CacheWolf/FilterScreen.java	2007-07-12 05:26:53 UTC (rev 783)
@@ -125,7 +125,7 @@
 		//////////////////////////
 		// Panel 2 - Cache attributes
 		//////////////////////////
-		addTitle(pnlAttributes,MyLocale.getMsg(720,"Attributes"));
+		addTitle(pnlAttributes,MyLocale.getMsg(720,"Status"));
 		mLabel lblTitleAtt; 
 		pnlAttributes.addLast(lblTitleAtt=new mLabel(MyLocale.getMsg(715,"Show all caches with status:")),HSTRETCH,FILL);
 		lblTitleAtt.setTag(SPAN,new Dimension(2,1));

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2007-07-08 21:47:47 UTC (rev 782)
+++ trunk/src/CacheWolf/Version.java	2007-07-12 05:26:53 UTC (rev 783)
@@ -18,7 +18,7 @@
 	public static String getRelease() {
 		 // habe die SVN-Nummer doch aus der Anzeige erstmal wieder herausgenommen, weil es in einem final Release doch recht seltsam auss?he.
 		 // Sinnvoll w?re daher vielleicht, eine Methode getReleaseDatail, die die SVN-Versionnummer mit angibt und z.B. im "?ber"-Dialog angezeigt werden k?nnte.
-		return VER_MAJOR + VER_MINOR; //+ VER_BUILD + VER_SVN.substring(VER_SVN.indexOf(" "), VER_SVN.lastIndexOf(" "));
+		return VER_MAJOR + VER_MINOR + VER_BUILD + VER_SVN.substring(VER_SVN.indexOf(" "), VER_SVN.lastIndexOf(" "));
 	}
 	
 	public boolean newVersionAvailable(Preferences pref){



From mik77 at mail.berlios.de  Sat Jul 14 19:12:53 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 14 Jul 2007 19:12:53 +0200
Subject: [Cachewolf-svn] r784 - trunk/src/CacheWolf
Message-ID: <200707141712.l6EHCrx2005980@sheep.berlios.de>

Author: mik77
Date: 2007-07-14 19:12:45 +0200 (Sat, 14 Jul 2007)
New Revision: 784

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
Set mainCache to main Cache of Addi, if an Addi was selected. So we can create correct Addi-Names when another Addi of this cache was selected and not only when the main cache was selected.

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-07-12 05:26:53 UTC (rev 783)
+++ trunk/src/CacheWolf/MainTab.java	2007-07-14 17:12:45 UTC (rev 784)
@@ -120,6 +120,15 @@
 	 */
 	public void newWaypoint(CacheHolder ch){
 		mainCache=lastselected;
+		int selectedIndex = profile.getCacheIndex( lastselected );
+		if (selectedIndex >= 0)
+		{
+			CacheHolder selectedCache = (CacheHolder) profile.cacheDB.get( selectedIndex );
+			if ( selectedCache.isAddiWpt() )
+			{
+				mainCache = selectedCache.mainCache.wayPoint;
+			}			
+		}
 		if (detP.isDirty()) detP.saveDirtyWaypoint();
 		Global.getProfile().hasUnsavedChanges=true;
 		String waypoint= ch.wayPoint = profile.getNewWayPointName();



From admin at berlios.de  Tue Jul 17 15:05:24 2007
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 17 Jul 2007 15:05:24 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3572] Batchmode
Message-ID: <200707171305.l6HD5O82024290@unicorn.berlios.de>

Feature Request #3572, was updated on 2007-Jul-17 15:05
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3572&group_id=2211

Category: None
Status: Open
Priority: 5
Summary: Batchmode

By: greiol
Date: 2007-Jul-17 15:05

Message:
Logged In: YES 
user_id=30600
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4

commandlineoption zum einlesen neuer PQs oder GPX
dateien. die notwendigen optionen m?ssten wohl der
dateiname und der profilname sein

perfekt w?re es wenn das ohne gui start geschehen
w?rde. dann k?nnte procmal die ankommenden PQs direkt
reinladen ;)

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3572&group_id=2211


From admin at berlios.de  Tue Jul 17 15:09:14 2007
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 17 Jul 2007 15:09:14 +0200 (CEST)
Subject: [Feature #3573] cachestatus ndern
Message-ID: <200707171309.l6HD9Een002192@unicorn.berlios.de>

Feature Request #3573, was updated on 2007-Jul-17 15:09
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3573&group_id=2211

Category: None
Status: Open
Priority: 5
Summary: cachestatus ?ndern

By: greiol
Date: 2007-Jul-17 15:09

Message:
Logged In: YES 
user_id=30600
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4

es w?re sch?n wenn man den status eines caches (aktiv,
disabled, archiviert) aus dem programm heraus ?ndern
k?nnte, da die information ?ber archivierung f?r GC.com
PMs ja nur per mail kommt (ok, man k?nnte von hand
nachspidern, aber dann kann ich auch auf einen "ins
archiv" knopf dr?cken)

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3573&group_id=2211


From admin at berlios.de  Tue Jul 17 15:10:14 2007
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 17 Jul 2007 15:10:14 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3574] Atrribute auch bei PQs nachladen
Message-ID: <200707171310.l6HDAEec004284@unicorn.berlios.de>

Feature Request #3574, was updated on 2007-Jul-17 15:10
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3574&group_id=2211

Category: None
Status: Open
Priority: 5
Summary: Atrribute auch bei PQs nachladen

By: greiol
Date: 2007-Jul-17 15:10

Message:
Logged In: YES 
user_id=30600
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4

zumindest wenn das laden von bildern aktiviert ist und
ohnehin auf gc.com zugegriffen werden muss.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3574&group_id=2211


From salzkammergut at mail.berlios.de  Sun Jul 22 17:00:20 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 22 Jul 2007 17:00:20 +0200
Subject: [Cachewolf-svn] r785 - trunk/src/CacheWolf
Message-ID: <200707221500.l6MF0K4J025612@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-22 17:00:17 +0200 (Sun, 22 Jul 2007)
New Revision: 785

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
Solver: Bugfix 
Die Solverbefehle wurden bei Aenderungen im Detailpanel geloescht.

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-07-14 17:12:45 UTC (rev 784)
+++ trunk/src/CacheWolf/MainTab.java	2007-07-22 15:00:17 UTC (rev 785)
@@ -317,11 +317,9 @@
 			if (chMain==null) {
 				chD.Solver=solverP.getInstructions();
 				chD.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chD.wayPoint+"/S:"+chD.Solver);
-				solverP.clearDirty();
 			} else {
 				chMain.Solver=solverP.getInstructions();
 				chMain.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chMain.wayPoint+"/S:"+chMain.Solver);
-				solverP.clearDirty();
 				chMain=null;
 			}
 		}

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2007-07-14 17:12:45 UTC (rev 784)
+++ trunk/src/CacheWolf/SolverPanel.java	2007-07-22 15:00:17 UTC (rev 785)
@@ -26,22 +26,19 @@
 	Parser parser = new Parser();
 	Vector msgFIFO = new Vector();
 	Menu mnuContext;
-	private boolean dirty=false;
+	private String originalInstructions="";
 	
 	public boolean isDirty() {
-		return dirty;
+		return !originalInstructions.equals(getInstructions());
 	}
-	public void clearDirty() {
-		dirty=false;
-	}
 	
 	public String getInstructions() {
 		return mText.getText();
 	}
 	public void setInstructions(String text) {
+		originalInstructions=text;
 		mText.setText(text);
 		mText.repaint();
-		dirty=false;
 	}
 	
 	
@@ -119,7 +116,6 @@
     }
 	
 	public void onEvent(Event ev){
-		if (ev.target==mText) {dirty=true; }
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if(ev.target == mBtSolve){
 				processCommand(mText.getText());



From kalli at mail.berlios.de  Mon Jul 23 21:15:32 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Mon, 23 Jul 2007 21:15:32 +0200
Subject: [Cachewolf-svn] r786 - trunk/src/CacheWolf
Message-ID: <200707231915.l6NJFW0R022425@sheep.berlios.de>

Author: kalli
Date: 2007-07-23 21:15:29 +0200 (Mon, 23 Jul 2007)
New Revision: 786

Modified:
   trunk/src/CacheWolf/GPXImporter.java
Log:
Bugfix: Die Stati, die beim updaten des Caches gesetzt wurden, wurden nicht in der Datenbank abgelegt. 

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-07-22 15:00:17 UTC (rev 785)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-07-23 19:15:29 UTC (rev 786)
@@ -339,6 +339,7 @@
 				} catch (Exception e) {Vm.debug("Could not open file: " + e.toString());};
 				oldCh.update(holder);
 				oldCh.saveCacheDetails(saveDir);
+				cacheDB.set(index, oldCh);
 				//crw.saveIndex(cacheDB,saveDir);
 			}
 			



From salzkammergut at mail.berlios.de  Wed Jul 25 23:40:03 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 25 Jul 2007 23:40:03 +0200
Subject: [Cachewolf-svn] r787 - in trunk: resources resources/attributes
	src/CacheWolf
Message-ID: <200707252140.l6PLe3Tt017487@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-25 23:39:52 +0200 (Wed, 25 Jul 2007)
New Revision: 787

Added:
   trunk/resources/attributes/firstaid-no.gif
   trunk/resources/attributes/firstaid-yes.gif
Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/Attribute.java
Log:
Attribute: Needs Maintenance hinzugefuegt

Added: trunk/resources/attributes/firstaid-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/firstaid-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/firstaid-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/firstaid-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-07-23 19:15:29 UTC (rev 786)
+++ trunk/resources/cachewolf.Languages.cfg	2007-07-25 21:39:52 UTC (rev 787)
@@ -437,6 +437,8 @@
 		2584=Geeignet f%fc Rollst%fchle
 		2585=Im Winter nicht verf%fcgbar
 		2586=Auch im Winter verf%fcgbar
+		2587=Cache-wartung notwendig
+		2588=Keine Cachewartung notwendig
 		3000=Schlie%dfen
 		4000=Geladene Caches:
 		4100=Verzeichnis w%e4hlen:
@@ -893,6 +895,8 @@
 		2584=wheelchair accessible
 		2585=not available in winter
 		2586=available in winter
+		2587=Needs maintenance
+		2588=No maintenance needed
 		3000=Close
 		4000=Loaded caches
 		4101=Maps

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2007-07-23 19:15:29 UTC (rev 786)
+++ trunk/src/CacheWolf/Attribute.java	2007-07-25 21:39:52 UTC (rev 787)
@@ -106,8 +106,10 @@
 			"wheelchair-no.gif", 	//83 not wheelchair accessible
 			"wheelchair-yes.gif", 	//84 wheelchair accessible
 			"winter-no.gif", 		//85 not available for winter
-			"winter-yes.gif"}; 		//86 available in winter
-	private static mImage [] attributeImages=new mImage[87];
+			"winter-yes.gif", 		//86 available in winter
+ 	        "firstaid-yes.gif",     //87 needs maintenance
+ 	        "firstaid-no.gif"};     //88 does not need maintenance
+	private static mImage [] attributeImages=new mImage[89];
 	private static String IMAGEDIR=File.getProgramDirectory()+"\\Attributes\\";
 	
 	public static String getImageDir() {



From salzkammergut at mail.berlios.de  Thu Jul 26 00:28:12 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 26 Jul 2007 00:28:12 +0200
Subject: [Cachewolf-svn] r788 - trunk/src/CacheWolf
Message-ID: <200707252228.l6PMSC79019509@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-26 00:27:53 +0200 (Thu, 26 Jul 2007)
New Revision: 788

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Bugfix Spitze Klammer (http://www.geoclub.de/ftopic17597.html)

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-25 21:39:52 UTC (rev 787)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-25 22:27:53 UTC (rev 788)
@@ -554,7 +554,7 @@
 		rex2.search(doc);
 		res = ((inRex.stringMatched(1)==null)?"":inRex.stringMatched(1)) + "<br>";
 		res += rex2.stringMatched(1); 
-		return SafeXML.cleanback(res);
+		return res; // SafeXML.cleanback(res);
 	}
 	
 	/**
@@ -965,6 +965,25 @@
 			chD.attributes.add(attribute);
 			attribute=attEx.findNext();
 		}
+		// Temporary fix to collect attribute descriptions
+		// Like "horses-no.gif,no horses\n"
+		Extractor attInfo=new Extractor(atts,"Alt=\"","\"",0,true);
+		String info=attInfo.findNext();
+		File attInfoFile=new File(File.getProgramDirectory()+"\\attributes.txt");
+		Stream strout = null;
+		int i=0;
+		try {
+			strout = attInfoFile.toWritableStream(true);
+			while (attInfo.endOfSearch()==false) {
+				strout.write((chD.attributes.getName(i++)+","+info+"\n").getBytes());
+				info=attInfo.findNext();
+			}
+			strout.close();
+		} catch (IOException ex) { 
+			return;
+		} finally {
+			if (strout!=null) strout.close();
+		}
 	}
 	
 	



From salzkammergut at mail.berlios.de  Thu Jul 26 00:33:56 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 26 Jul 2007 00:33:56 +0200
Subject: [Cachewolf-svn] r789 - trunk/src/CacheWolf
Message-ID: <200707252233.l6PMXunV026034@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-26 00:33:44 +0200 (Thu, 26 Jul 2007)
New Revision: 789

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Spider: Temporary fix fuer Attribute wieder entfernt (versehentlich mit 788 eingecheckt)

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-25 22:27:53 UTC (rev 788)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-25 22:33:44 UTC (rev 789)
@@ -965,25 +965,6 @@
 			chD.attributes.add(attribute);
 			attribute=attEx.findNext();
 		}
-		// Temporary fix to collect attribute descriptions
-		// Like "horses-no.gif,no horses\n"
-		Extractor attInfo=new Extractor(atts,"Alt=\"","\"",0,true);
-		String info=attInfo.findNext();
-		File attInfoFile=new File(File.getProgramDirectory()+"\\attributes.txt");
-		Stream strout = null;
-		int i=0;
-		try {
-			strout = attInfoFile.toWritableStream(true);
-			while (attInfo.endOfSearch()==false) {
-				strout.write((chD.attributes.getName(i++)+","+info+"\n").getBytes());
-				info=attInfo.findNext();
-			}
-			strout.close();
-		} catch (IOException ex) { 
-			return;
-		} finally {
-			if (strout!=null) strout.close();
-		}
 	}
 	
 	



From salzkammergut at mail.berlios.de  Thu Jul 26 21:17:50 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 26 Jul 2007 21:17:50 +0200
Subject: [Cachewolf-svn] r790 - trunk/src/CacheWolf
Message-ID: <200707261917.l6QJHoTm018670@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-26 21:17:47 +0200 (Thu, 26 Jul 2007)
New Revision: 790

Modified:
   trunk/src/CacheWolf/GPXImporter.java
Log:
GPXImporter: Bugfix

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-07-25 22:33:44 UTC (rev 789)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-07-26 19:17:47 UTC (rev 790)
@@ -339,7 +339,7 @@
 				} catch (Exception e) {Vm.debug("Could not open file: " + e.toString());};
 				oldCh.update(holder);
 				oldCh.saveCacheDetails(saveDir);
-				cacheDB.set(index, oldCh);
+				cacheDB.set(index, new CacheHolder(oldCh));
 				//crw.saveIndex(cacheDB,saveDir);
 			}
 			



From salzkammergut at mail.berlios.de  Thu Jul 26 22:47:25 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 26 Jul 2007 22:47:25 +0200
Subject: [Cachewolf-svn] r791 - trunk/src/CacheWolf
Message-ID: <200707262047.l6QKlP3Z024592@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-26 22:47:19 +0200 (Thu, 26 Jul 2007)
New Revision: 791

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Fix fuer Probleme mit Umlauten und anderen Sonderzeichen in Usernamen und Passworten

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-26 19:17:47 UTC (rev 790)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-26 20:47:19 UTC (rev 791)
@@ -114,8 +114,8 @@
 			try{
 				pref.log("Logging in as "+pref.myAlias);
 				doc = URL.encodeURL("__VIEWSTATE",false) +"="+ URL.encodeURL(viewstate,false)
-					+ "&" + URL.encodeURL("myUsername",false) +"="+ URL.encodeURL(pref.myAlias,false)
-				    + "&" + URL.encodeURL("myPassword",false) +"="+ URL.encodeURL(passwort,false)
+					+ "&" + URL.encodeURL("myUsername",false) +"="+ encodeUTF8(new String(Utils.encodeJavaUtf8String(pref.myAlias)))
+				    + "&" + URL.encodeURL("myPassword",false) +"="+ encodeUTF8(new String(Utils.encodeJavaUtf8String(passwort)))
 				    + "&" + URL.encodeURL("cookie",false) +"="+ URL.encodeURL("on",false)
 				    + "&" + URL.encodeURL("Button1",false) +"="+ URL.encodeURL("Login",false);
 				start = fetch_post(loginPage, doc, p.getProperty("nextPage"));  // /login/default.aspx
@@ -1108,4 +1108,39 @@
 			}
 			return totline;
 		}
+	
+	final static String hex = ewe.util.TextEncoder.hex;
+	
+	public String encodeUTF8(String username) {
+		char [] what = ewe.sys.Vm.getStringChars(username);
+		int max = what.length;
+		char [] dest = new char[6*max]; // Assume each char is a UTF char and encoded into 6 chars
+		char d = 0;
+		for (int i = 0; i<max; i++){
+			char c = what[i];
+			if (c == ' ') c = '+';
+			else if (c<='\u00FF') { 
+				if(c <= ' ' || c == '+' || c == '&' || c == '%' || c == '=' || 
+				   c == '|' || c == '{' || c == '}' || c>'\u007F'){
+					dest[d++] = '%';
+					dest[d++] = hex.charAt((c >> 4) & 0xf);
+					dest[d++] = hex.charAt(c & 0xf);
+					continue;
+				}
+			
+			} else {
+				dest[d++] = '%';
+				dest[d++] = hex.charAt((c >> 12) & 0xf);
+				dest[d++] = hex.charAt((c >> 8) & 0xf);
+				dest[d++] = '%';
+				dest[d++] = hex.charAt((c >> 4) & 0xf);
+				dest[d++] = hex.charAt(c & 0xf);
+				continue;
+			}
+			dest[d++] = c;
+		}
+		return new String(dest,0,d);
+	}
+	
+	
 }
\ No newline at end of file



From salzkammergut at mail.berlios.de  Thu Jul 26 23:13:30 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 26 Jul 2007 23:13:30 +0200
Subject: [Cachewolf-svn] r792 - trunk/src/CacheWolf
Message-ID: <200707262113.l6QLDUuu026509@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-26 23:13:25 +0200 (Thu, 26 Jul 2007)
New Revision: 792

Modified:
   trunk/src/CacheWolf/MainForm.java
   trunk/src/CacheWolf/MainMenu.java
Log:
FR: Der Name des derzeitigen Profils wird in der Titelzeile angezeigt
(http://www.geoclub.de/ftopic17611.html)

Modified: trunk/src/CacheWolf/MainForm.java
===================================================================
--- trunk/src/CacheWolf/MainForm.java	2007-07-26 20:47:19 UTC (rev 791)
+++ trunk/src/CacheWolf/MainForm.java	2007-07-26 21:13:25 UTC (rev 792)
@@ -47,7 +47,7 @@
 	
 	public void doIt(){
 		Global.mainForm=this;
-		this.title = "CacheWolf " + Version.getRelease();
+		//this.title = "CacheWolf " + Version.getRelease();
 		this.exitSystemOnClose = true;
 		this.resizable = true;
 		this.moveable = true;
@@ -73,6 +73,7 @@
 			pref.curCentrePt.set(profile.centre);
 			profile.updateBearingDistance();
 			profile.restoreFilter();
+			setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 		} catch (Exception e){
 			if(pref.debug == true) Vm.debug("MainForm:: Exception:: " + e.toString());
 		}

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2007-07-26 20:47:19 UTC (rev 791)
+++ trunk/src/CacheWolf/MainMenu.java	2007-07-26 21:13:25 UTC (rev 792)
@@ -207,6 +207,7 @@
 					Filter.showBlacklisted=false;
 					filtBlack.modifiers&=~MenuItem.Checked;
 					tbp.refreshTable();
+					Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 				}
 				f.close(0);
 			}
@@ -224,6 +225,7 @@
 						pref.curCentrePt.set(profile.centre);
 						filtBlack.modifiers&=~MenuItem.Checked;
 						Filter.showBlacklisted=false;
+						Global.mainForm.setTitle("Cachewolf "+Version.getRelease()+" - "+profile.name);
 						infB.close(0);
 						profile.restoreFilter(); // Restore the isActive & isInverted status of the filter
 						tbp.resetModel();



From salzkammergut at mail.berlios.de  Sat Jul 28 19:02:56 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 28 Jul 2007 19:02:56 +0200
Subject: [Cachewolf-svn] r793 - trunk/src/CacheWolf
Message-ID: <200707281702.l6SH2umg028490@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-28 19:02:35 +0200 (Sat, 28 Jul 2007)
New Revision: 793

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Fix fuer Probleme mit Distanz

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-26 21:13:25 UTC (rev 792)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-28 17:02:35 UTC (rev 793)
@@ -515,6 +515,7 @@
 		inRex = new Regex(p.getProperty("distRex"));
 		inRex.search(doc);
 		if(doc.indexOf("Here") >= 0) return(0);
+		if (!inRex.didMatch()) return 0;
 		if(pref.digSeparator.equals(",")) return Convert.toDouble(inRex.stringMatched(1).replace('.',','));
 		return Convert.toDouble(inRex.stringMatched(1));
 	}



From kalli at mail.berlios.de  Sat Jul 28 20:13:09 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Sat, 28 Jul 2007 20:13:09 +0200
Subject: [Cachewolf-svn] r794 - in trunk: resources src/CacheWolf src/exp
Message-ID: <200707281813.l6SID9uP007515@sheep.berlios.de>

Author: kalli
Date: 2007-07-28 20:12:58 +0200 (Sat, 28 Jul 2007)
New Revision: 794

Modified:
   trunk/resources/POIIcons.zip
   trunk/src/CacheWolf/CacheType.java
   trunk/src/exp/KMLExporter.java
   trunk/src/exp/TomTomExporter.java
Log:
KML-Export: Gruppierung nach Available, Found, Ownes, Not Available sowie Cachetypen. Icons werden aus POIICons.zip geholt

!!! Achtung !!! Resource POIIcons.zip hat sich geaendert

Modified: trunk/resources/POIIcons.zip
===================================================================
(Binary files differ)

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2007-07-28 17:02:35 UTC (rev 793)
+++ trunk/src/CacheWolf/CacheType.java	2007-07-28 18:12:58 UTC (rev 794)
@@ -114,7 +114,21 @@
 	
 	//fields
 	int type = 0;
+	
+	// array with names and types for exporters
+	public final static int WPT_TEXT = 0;
+	public final static int WPT_NUM = 1;
 
+	public static String[][] wayType = {{"Custom","0"},{"Traditional","2"},
+			{"Multi","3"}, {"Virtual","4"},
+			{"Letterbox","5"},{"Event","6"},
+			{"Mega Event","453"}, {"Mystery","8"},
+			{"Webcam","11"},{"Locationless","12"},
+			{"CITO","13"},{"Earthcache","137"},
+			{"Parking","50"},{"Stage","51"},
+			{"Question","52"},{"Final","53"},
+			{"Trailhead","54"},{"Reference","55"}};
+
 	public static String transType(String geoNum){
 		String geo = new String("Unknown");
 		if(geoNum.equals("2")) geo = "Traditional Cache";

Modified: trunk/src/exp/KMLExporter.java
===================================================================
--- trunk/src/exp/KMLExporter.java	2007-07-28 17:02:35 UTC (rev 793)
+++ trunk/src/exp/KMLExporter.java	2007-07-28 18:12:58 UTC (rev 794)
@@ -1,7 +1,21 @@
 package exp;
-import ewe.fx.Color;
+
+import ewe.io.BufferedWriter;
 import ewe.io.File;
+import ewe.io.FileOutputStream;
+import ewe.io.FileWriter;
+import ewe.io.IOException;
+import ewe.io.InputStream;
+import ewe.io.PrintWriter;
 import ewe.sys.Convert;
+import ewe.sys.Handle;
+import ewe.sys.Vm;
+import ewe.ui.ProgressBarForm;
+import ewe.util.*;
+import ewe.util.Map.MapEntry;
+import ewe.util.zip.ZipEntry;
+import ewe.util.zip.ZipException;
+import ewe.util.zip.ZipFile;
 import CacheWolf.*;
 
 /**
@@ -13,9 +27,19 @@
 	private static final String COLOR_FOUND = "ff98fb98"; 
 	private static final String COLOR_OWNED = "ffffaa55"; 
 	private static final String COLOR_AVAILABLE = "ffffffff";
-	private static final String COLOR_ARCHIVED = "ff0000ff";
+	private static final String COLOR_NOT_AVAILABLE = "ff0000ff";
 
 
+	static final int AVAILABLE = 0;
+	static final int FOUND = 1;
+	static final int OWNED = 2;
+	static final int NOT_AVAILABLE = 3;
+	static final int UNKNOWN = 4;
+	
+	
+	String []categoryNames = {"Available","Found", "Owned", "Not Available", "UNKNOWN"};
+	Hashtable [] outCacheDB = new Hashtable[categoryNames.length];
+
 	public KMLExporter(){
 		super();
 		this.setMask("*.kml");
@@ -27,7 +51,205 @@
 			super();
 			this.setMask("*.kml");
 	}
+
+	public void doIt(int variant){
+		File outFile;
+		String str;
+		CacheHolder ch;
+		CacheHolder addiWpt;
+		CacheHolderDetail holder;
+		ProgressBarForm pbf = new ProgressBarForm();
+		Handle h = new Handle();
+		
+		if (variant == ASK_FILE) {
+			outFile = getOutputFile();
+			if (outFile == null) return;
+		} else {
+			outFile = new File(tmpFileName);
+		}
+
+		pbf.showMainTask = false;
+		pbf.setTask(h,"Exporting ...");
+		pbf.exec();
+
+		int counter = 0;
+		int expCount = 0;
+		for(int i = 0; i<cacheDB.size();i++){
+			ch = (CacheHolder)cacheDB.get(i);
+			if(ch.is_black == false && ch.is_filtered == false) counter++;
+		}
+		copyIcons(outFile.getParent());
+		buildOutDB();
+		
+		try{
+			PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(outFile)));
+			str = this.header();
+			if (str != null) outp.print(str);
+			for (int cat = 0; cat < categoryNames.length; cat++) {
+				// skip over empty categories
+				if (outCacheDB[cat]==null) continue;
+
+				Iterator outLoop = outCacheDB[cat].entries();
+				outp.print(startFolder(categoryNames[cat]));
+
+				Vector tmp;
+				MapEntry entry; 
+				while (outLoop.hasNext()){
+					entry = (MapEntry) outLoop.next();
+					tmp = (Vector)entry.getValue();
+					// skip over empty cachetypes
+					if (tmp.size() == 0) continue;
+					outp.print(startFolder(CacheType.transType((String)entry.getKey())));
+
+					for(int i = 0; i<tmp.size(); i++){
+						ch = (CacheHolder) tmp.get(i);
+						expCount++;
+						h.progress = (float)expCount/(float)counter;
+						h.changed();
+						if (ch.isAddiWpt()) continue;
+						holder=new CacheHolderDetail(ch);
+						try {
+							holder.readCache(profile.dataDir);
+						} catch (IOException e) {
+							continue;
+						}
+						if (holder.pos.isValid()){
+							str = record(holder, holder.pos.getLatDeg(CWPoint.DD).replace('.', this.decimalSeparator),
+								     holder.pos.getLonDeg(CWPoint.DD).replace('.', this.decimalSeparator));
+							if (str != null) outp.print(str);
+						}
+						if (ch.hasAddiWpt()){
+						outp.print(startFolder("Additional Waypoints", false));
+							for(int j = 0; j<ch.addiWpts.size(); j++){
+								addiWpt = (CacheHolder) ch.addiWpts.get(j);
+								holder=new CacheHolderDetail(addiWpt);
+								expCount++;
+								if (holder.pos.isValid()){
+									str = record(holder, holder.pos.getLatDeg(CWPoint.DD).replace('.', this.decimalSeparator),
+										     holder.pos.getLonDeg(CWPoint.DD).replace('.', this.decimalSeparator));
+									if (str != null) outp.print(str);
+								}
+								
+							}
+						outp.print(endFolder());// addi wpts
+						}
+					}
+					outp.print(endFolder());// cachetype
+				}
+				outp.print(endFolder());// category
+			}
+			
+			str = trailer();
+			if (str != null) outp.print(str);
+			outp.close();
+			pbf.exit(0);
+		} catch (IOException ioE){
+			Vm.debug("Error opening " + outFile.getName());
+		}
+		//try
+
+	}
 	
+	private void buildOutDB(){
+		CacheHolder ch;
+		Vector tmp;
+		Iterator categoryLoop;
+		MapEntry entry;
+		boolean foundOne;
+		
+		// create the roots for the different categories
+		for (int i = 0; i < categoryNames.length; i++) {
+			outCacheDB[i] = new Hashtable();
+			// create the roots for the cachetypes
+			for (int j = 0; j < CacheType.wayType.length; j++) {
+				outCacheDB[i].put(CacheType.wayType[j][CacheType.WPT_NUM], new Vector());
+			}
+		}
+
+		// fill structure with data from cacheDB
+		for(int i = 0; i<cacheDB.size(); i++){
+			ch=(CacheHolder)cacheDB.get(i);
+			if(ch.is_black == false && ch.is_filtered == false && !ch.isAddiWpt()){
+				if (ch.is_found) { tmp = (Vector) outCacheDB[FOUND].get(ch.type);}
+				else if (ch.is_owned) { tmp = (Vector) outCacheDB[OWNED].get(ch.type);}
+				else if (ch.is_archived || !ch.is_available){ tmp = (Vector) outCacheDB[NOT_AVAILABLE].get(ch.type);}
+				else if (ch.is_available){ tmp = (Vector) outCacheDB[AVAILABLE].get(ch.type);}
+				else { tmp = (Vector) outCacheDB[UNKNOWN].get(ch.type);}
+				
+				tmp.add(ch);
+			}
+		}
+		
+		//eleminate empty categories
+		for (int i = 0; i < categoryNames.length; i++) {
+			categoryLoop = outCacheDB[i].entries();
+			foundOne = false;
+			//look if all vectors for cachetypes are filled
+			while (categoryLoop.hasNext()){
+				entry = (MapEntry) categoryLoop.next();
+				tmp = (Vector)entry.getValue();
+				if (tmp.size()> 0){
+					foundOne = true;
+					break;
+				}
+			}
+			// set hashtable for that category to null
+			if (!foundOne)outCacheDB[i] = null;
+		}
+		
+
+	}
+	
+	private String startFolder(String name){
+		return startFolder(name, true);
+	}
+	
+	private String startFolder(String name, boolean open){
+		StringBuffer strBuf = new StringBuffer(200);
+		strBuf.append("<Folder>\r\n");
+		strBuf.append("<name>" + name + "</name>\r\n");
+		strBuf.append("<open>" + (open?"1":"0") + "</open>\r\n");
+
+		return strBuf.toString();
+	}
+
+	private String endFolder() {
+		
+		return "</Folder>\r\n";
+	}
+
+	public void copyIcons(String dir){
+		try {
+			ZipFile zif = new ZipFile (File.getProgramDirectory() + "/POIIcons.zip");
+			ZipEntry zipEnt;
+			int len;
+			String entName, fileName; 
+
+			for (int i = 0; i < CacheType.wayType.length; i++) {
+				fileName = CacheType.type2pic(Convert.parseInt(CacheType.wayType[i][CacheType.WPT_NUM]));
+				entName = "GoogleEarthIcons/" + fileName;
+				zipEnt = zif.getEntry(entName);
+				if (zipEnt == null) continue;
+			    byte[] buff = new byte[ (int) zipEnt.getSize() ];
+			    InputStream  fis = zif.getInputStream(zipEnt);
+			    FileOutputStream fos = new FileOutputStream( dir + "/" + fileName);
+			    while( 0 < (len = fis.read( buff )) )
+			      fos.write( buff, 0, len );
+			    fos.flush();
+			    fos.close();
+			    fis.close();
+			}
+
+			} catch (ZipException e) {
+				Vm.debug("Problem copying Icon");
+				e.printStackTrace();
+			} catch (IOException e) {
+				Vm.debug("Problem copying Icon");
+				e.printStackTrace();
+			}
+	}
+
+	
 	public String header () {
 		StringBuffer strBuf = new StringBuffer(200);
 				
@@ -36,15 +258,18 @@
 		strBuf.append("<Folder>\r\n");
 		strBuf.append("<name>CacheWolf</name>\r\n");
 		strBuf.append("<open>1</open>\r\n");
-
+	
 		return strBuf.toString();
 	}
-	
+
+
 	public String record(CacheHolderDetail ch, String lat, String lon){
 		StringBuffer strBuf = new StringBuffer(200);
 		
 		strBuf.append("   <Placemark>\r\n");
-		strBuf.append("      <description>http://www.geocaching.com/seek/cache_details.aspx?wp="+ch.wayPoint+"</description>\r\n");
+		if (ch.URL != null){
+			strBuf.append("      <description>"+SafeXML.clean(ch.URL)+"</description>\r\n");
+		}
 		strBuf.append("      <name>"+ ch.wayPoint + " - " + SafeXML.clean(ch.CacheName) +"</name>\r\n");
 		strBuf.append("      <LookAt>\r\n");
 		strBuf.append("         <latitude>" + lat + "</latitude>\r\n");
@@ -57,7 +282,8 @@
 		strBuf.append("      <Style>\r\n");
 		strBuf.append("      <IconStyle>\r\n");
 		strBuf.append("         <Icon>\r\n");
-		strBuf.append("            <href>"+ File.getProgramDirectory()+ "/" + CacheType.type2pic(Convert.parseInt(ch.type))+ "</href>\r\n");
+//		strBuf.append("            <href>"+ File.getProgramDirectory()+ "/" + CacheType.type2pic(Convert.parseInt(ch.type))+ "</href>\r\n");
+		strBuf.append("            <href>"+ CacheType.type2pic(Convert.parseInt(ch.type))+ "</href>\r\n");
 		strBuf.append("         </Icon>\r\n");
 		strBuf.append("      </IconStyle>\r\n");
 		strBuf.append("      <LabelStyle>\r\n");
@@ -81,7 +307,7 @@
 	private String getColor(CacheHolderDetail ch){
 		if (ch.is_found) return COLOR_FOUND;
 		if (ch.is_owned) return COLOR_OWNED;
-		if (ch.is_archived) return COLOR_ARCHIVED;
+		if (ch.is_archived || !ch.is_available) return COLOR_NOT_AVAILABLE;
 		
 		return COLOR_AVAILABLE;
 	}

Modified: trunk/src/exp/TomTomExporter.java
===================================================================
--- trunk/src/exp/TomTomExporter.java	2007-07-28 17:02:35 UTC (rev 793)
+++ trunk/src/exp/TomTomExporter.java	2007-07-28 18:12:58 UTC (rev 794)
@@ -21,15 +21,6 @@
 	Profile profile;
 
 	
-	String[][] wayType = {{"Custom","0"},{"Traditional","2"},
-						{"Multi","3"}, {"Virtual","4"},
-						{"Letterbox","5"},{"Event","6"},
-						{"Mega Event","453"}, {"Mystery","8"},
-						{"Webcam","11"},{"Locationless","12"},
-						{"CITO","13"},{"Earthcache","137"},
-						{"Parking","50"},{"Stage","51"},
-						{"Question","52"},{"Final","53"},
-						{"Trailhead","54"},{"Reference","55"}};
 
 	
 	public TomTomExporter() {
@@ -94,14 +85,14 @@
 		ext = format==TT_ASC?".asc":".ov2";
 		try{
 			//loop through type
-			for(int j = 0; j < wayType.length; j++){
-				fileName = dirName + "/" + prefix + wayType[j][TT_WPT_TEXT]+ ext;
+			for(int j = 0; j < CacheType.wayType.length; j++){
+				fileName = dirName + "/" + prefix + CacheType.wayType[j][TT_WPT_TEXT]+ ext;
 				dfile = new File(fileName);
 				dfile.delete();
 				out =  new RandomAccessFile(fileName,"rw");
 				for(int i = 0; i<cacheDB.size(); i++){
 					holder=(CacheHolder)cacheDB.get(i);
-					if(holder.type.equals(wayType[j][TT_WPT_NUM]) && holder.is_black == false && holder.is_filtered == false){
+					if(holder.type.equals(CacheType.wayType[j][TT_WPT_NUM]) && holder.is_black == false && holder.is_filtered == false){
 						currExp++;
 						h.progress = (float)currExp/(float)counter;
 						h.changed();
@@ -119,7 +110,7 @@
 				if (dfile.length()==0) {
 					dfile.delete();
 				} else {
-					copyIcon(j, dirName + "/" + prefix + wayType[j][TT_WPT_TEXT]); 
+					copyIcon(j, dirName + "/" + prefix + CacheType.wayType[j][TT_WPT_TEXT]); 
 				}
 			}//for wayType
 			pbf.exit(0);
@@ -271,7 +262,7 @@
 			int len;
 			String entName; 
 			
-			entName = "TomTomIcons/"+ "GC-" + wayType[intWayType][TT_WPT_TEXT] + ".bmp";
+			entName = "TomTomIcons/"+ "GC-" + CacheType.wayType[intWayType][TT_WPT_TEXT] + ".bmp";
 			zipEnt = zif.getEntry(entName);
 			if (zipEnt == null) return;
 			
@@ -284,10 +275,10 @@
 		    fos.close();
 		    fis.close();
 		} catch (ZipException e) {
-			Vm.debug("Problem copying Icon" + "GC-" + wayType[intWayType][TT_WPT_TEXT] + ".bmp" );
+			Vm.debug("Problem copying Icon" + "GC-" + CacheType.wayType[intWayType][TT_WPT_TEXT] + ".bmp" );
 			e.printStackTrace();
 		} catch (IOException e) {
-			Vm.debug("Problem copying Icon" + "GC-" + wayType[intWayType][TT_WPT_TEXT] + ".bmp" );
+			Vm.debug("Problem copying Icon" + "GC-" + CacheType.wayType[intWayType][TT_WPT_TEXT] + ".bmp" );
 			e.printStackTrace();
 		}
 



From salzkammergut at mail.berlios.de  Sat Jul 28 20:50:30 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 28 Jul 2007 20:50:30 +0200
Subject: [Cachewolf-svn] r795 - in trunk: resources src/CacheWolf
Message-ID: <200707281850.l6SIoUxm009307@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-28 20:50:23 +0200 (Sat, 28 Jul 2007)
New Revision: 795

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
CoordsScreen: Feature: Im freien Textfeld zum Parsen von Koordinaten kann jetzt der Wegpunktname eines Caches von GC 
eingegeben werden. Die Koordinaten dieses Caches werden geholt und geparst. 
Zweck: Schnelleres und einfacheres Setzen eines Zentrums beim Spidern eines neuen Profils

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-07-28 18:12:58 UTC (rev 794)
+++ trunk/resources/cachewolf.Languages.cfg	2007-07-28 18:50:23 UTC (rev 795)
@@ -284,6 +284,8 @@
 		1402=Ost
 		1403=Richtung
 		1404=Strecke
+		1405=Koordinaten von GC laden: GCxxxxx unten eingeben
+		1406=Koordinaten in beliebigem Format oder GCxxxx
 		1500=Ziel:
 		1501=Aktuell
 		1600=Opencahing.de Download
@@ -743,6 +745,8 @@
 		1402=Easting
 		1403=Bearing
 		1404=Distance
+		1405=To load coordinates from GC, enter GCxxxxx below
+		1406=Enter coordinates in any format or GCxxxx
 		1500=DST:
 		1501=Current
 		1600=Opencahing.de Download

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2007-07-28 18:12:58 UTC (rev 794)
+++ trunk/src/CacheWolf/CoordsScreen.java	2007-07-28 18:50:23 UTC (rev 795)
@@ -61,11 +61,12 @@
 		TopP.addNext(inpUTMEasting = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		TopP.addLast(inpUTMNorthing = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 
-		// Input for free Text
+		TopP.addLast(new mLabel(MyLocale.getMsg(1405,"To load coordinates from GC, enter GCxxxxx below")),CellConstants.HSTRETCH, (CellConstants.HFILL)).setTag(SPAN,new Dimension(4,1));
+			// Input for free Text
 		TopP.addNext(inpText = new mInput(),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		inpText.toolTip=MyLocale.getMsg(1406,"Enter coordinates in any format or GCxxxxx");
 		inpText.setTag(SPAN,new Dimension(3,1));
 		TopP.addLast(btnParse = new mButton(MyLocale.getMsg(619,"Parse")),CellConstants.HSTRETCH, (CellConstants.HFILL));
-
 		
 		// Buttons for cancel and apply, copy and paste
 		TopP.addNext(btnCancel = new mButton(MyLocale.getMsg(614,"Cancel")),CellConstants.HSTRETCH, (CellConstants.HFILL));
@@ -213,7 +214,13 @@
 
 			if (ev.target == btnParse){
 				// try to parse coords
-				CWPoint coord = new CWPoint(inpText.getText());
+				CWPoint coord;
+				if (inpText.getText().trim().startsWith("GC")) {
+					SpiderGC spider = new SpiderGC(Global.getPref(), Global.getProfile(), false);
+					coord = new CWPoint(spider.getCacheCoordinates(inpText.getText().trim()));
+				} else {	
+					coord = new CWPoint(inpText.getText());
+				}
 				if (coord.latDec == 0 && coord.lonDec == 0){
 					MessageBox tmpMB = new MessageBox(MyLocale.getMsg(312,"Error"), MyLocale.getMsg(4111,"Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM"), MessageBox.OKB);
 					tmpMB.exec();

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-28 18:12:58 UTC (rev 794)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-28 18:50:23 UTC (rev 795)
@@ -189,6 +189,33 @@
 	} // spiderSingle
 	
 	/**
+	 * Fetch the coordinates of a waypoint from GC
+	 * @param wayPoint the name of the waypoint
+	 * @return the cache coordinates
+	 */
+	public String getCacheCoordinates(String wayPoint) {
+		String completeWebPage;
+		InfoBox infB = new InfoBox("Info", "Loading", InfoBox.PROGRESS_WITH_WARNINGS);
+		infB.exec();
+		if (p==null) {
+			infB.close(0);
+			(new MessageBox(MyLocale.getMsg(5500,"Error"), "Could not load 'spider.def'", MessageBox.OKB)).execute();
+			return "";
+		}
+		if (login()!=Form.IDOK) return "";
+		String doc = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + wayPoint;
+		try{
+			pref.log("Fetching: " + wayPoint);
+			completeWebPage = fetch(doc);
+		}catch(Exception ex){
+			pref.log("Could not fetch " + wayPoint,ex);
+			return "";
+		}
+		infB.close(0);
+		return getLatLon(completeWebPage);	
+	}
+	
+	/**
 	*	Method to start the spider for a search around the center coordinates
 	*/
 	public void doIt(){
@@ -539,6 +566,7 @@
 	private String getLatLon(String doc){
 		inRex = new Regex(p.getProperty("latLonRex"));
 		inRex.search(doc);
+		if (!inRex.didMatch()) return "";
 		return inRex.stringMatched(1);
 	}
 	



From salzkammergut at mail.berlios.de  Sat Jul 28 21:00:36 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 28 Jul 2007 21:00:36 +0200
Subject: [Cachewolf-svn] r796 - trunk
Message-ID: <200707281900.l6SJ0ajH009829@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-28 21:00:33 +0200 (Sat, 28 Jul 2007)
New Revision: 796

Modified:
   trunk/getRes.bat
   trunk/getRes.sh
Log:
Update getRes

Modified: trunk/getRes.bat
===================================================================
--- trunk/getRes.bat	2007-07-28 18:50:23 UTC (rev 795)
+++ trunk/getRes.bat	2007-07-28 19:00:33 UTC (rev 796)
@@ -6,6 +6,7 @@
 del .\work\*.ico
 REM get ressources
 copy .\resources\*.* .\work\*.*
+copy .\resources\attributes\*.* .\work\attributes\*.*
 copy .\lib\*.dll .\work\
 move .\work\cachewolf.Languages.cfg .\work\_config\
 

Modified: trunk/getRes.sh
===================================================================
--- trunk/getRes.sh	2007-07-28 18:50:23 UTC (rev 795)
+++ trunk/getRes.sh	2007-07-28 19:00:33 UTC (rev 796)
@@ -7,6 +7,7 @@
 rm ./work/*.ico
 # get ressources
 cp resources/*.* work
+cp resources/attributes/*.* work/attributes
 mv work/cachewolf.Languages.cfg work/_config/cachewolf.Languages.cfg
 
 



From bilbowolf at mail.berlios.de  Sun Jul 29 15:17:18 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Sun, 29 Jul 2007 15:17:18 +0200
Subject: [Cachewolf-svn] r797 - in trunk/src: . CacheWolf utils
Message-ID: <200707291317.l6TDHI1x012633@sheep.berlios.de>

Author: bilbowolf
Date: 2007-07-29 15:17:13 +0200 (Sun, 29 Jul 2007)
New Revision: 797

Added:
   trunk/src/io/
   trunk/src/utils/
   trunk/src/utils/CWWrapper.java
Modified:
   trunk/src/CacheWolf/CacheWolf.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Ich glaube ich habe das exec Problem gel?\195?\182st.

Modified: trunk/src/CacheWolf/CacheWolf.java
===================================================================
--- trunk/src/CacheWolf/CacheWolf.java	2007-07-28 19:00:33 UTC (rev 796)
+++ trunk/src/CacheWolf/CacheWolf.java	2007-07-29 13:17:13 UTC (rev 797)
@@ -261,6 +261,3 @@
 // or the local files "JavaDoc" directory
 // Javadoc Main Page: http://java.sun.com/j2se/javadoc/index.jsp
 // javadoc -classpath ewe.jar -d "cachewolf doc" cachewolf/*.java
-//page conunter:
-// select * from mos_content where id = 13
-// update mos_content set hits = 0 where id = 13

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2007-07-28 19:00:33 UTC (rev 796)
+++ trunk/src/CacheWolf/Profile.java	2007-07-29 13:17:13 UTC (rev 797)
@@ -14,6 +14,7 @@
 import ewe.ui.ProgressBarForm;
 import ewe.util.Hashtable;
 import ewe.util.Vector;
+import ewe.util.*;
 
 /**
  * This class holds a profile, i.e. a group of caches with a centre location
@@ -173,6 +174,7 @@
 	 *	than the collection of caches in a directory.
 	 */
 	public void readIndex(){
+		
 		try {
 			selectionChanged = true;
 			boolean fmtDec=false;
@@ -183,6 +185,10 @@
 			String text=in.readLine(); // <CACHELIST>
 			if (text!=null && text.indexOf("decimal")>0) fmtDec=true;
 			Extractor ex = new Extractor(null, " = \"", "\" ", 0, true);
+			
+			//OperationTimer optt = new OperationTimer();
+			//optt.start("Reading...");
+			
 			while ((text = in.readLine()) != null){
 				// Check for Line with cache data
 				if (text.indexOf("<CACHE ")>=0){
@@ -271,6 +277,13 @@
 				}
 			}
 			in.close();
+			
+			//optt.end();
+			//long times[];
+			//times = optt.getTimes();
+			//Vm.debug("Reading ended: " + times[0]);
+			
+			
 			// Build references between caches and addi wpts
 			buildReferences();
 		} catch (FileNotFoundException e) {

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-07-28 19:00:33 UTC (rev 796)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-07-29 13:17:13 UTC (rev 797)
@@ -119,7 +119,11 @@
 				    + "&" + URL.encodeURL("cookie",false) +"="+ URL.encodeURL("on",false)
 				    + "&" + URL.encodeURL("Button1",false) +"="+ URL.encodeURL("Login",false);
 				start = fetch_post(loginPage, doc, p.getProperty("nextPage"));  // /login/default.aspx
-				pref.log("Login successful");
+				if(start.indexOf("You are logged in as") > 0) pref.log("Login successful");
+				else {
+					pref.log("Login failed.");
+					return ERR_LOGIN;
+				}
 			}catch(Exception ex){
 				//Vm.debug("Could not login: gc.com start page");
 				pref.log("Login failed.", ex);

Added: trunk/src/utils/CWWrapper.java
===================================================================
--- trunk/src/utils/CWWrapper.java	2007-07-28 19:00:33 UTC (rev 796)
+++ trunk/src/utils/CWWrapper.java	2007-07-29 13:17:13 UTC (rev 797)
@@ -0,0 +1,33 @@
+package utils;
+import CacheWolf.*;
+import ewe.sys.*;
+
+/**
+ * Class built as a wrapper for the buggy Vm.exec
+ * in EWE Version 1.49
+ * It identifies the plattform and uses a different call
+ * to Vm.exec() depending on the plattform.
+ * It uses depreciated classes, which is OK for now.
+ */
+public class CWWrapper {
+	
+	public static exec(String str) throws IOException{
+		String plattform = Vm.getPlatform();
+		if(plattform.equals("WinCE")){
+			Vm.exec(str, "", 0, true);
+		}
+		if(plattform.equals("Win32")){
+			Vm.exec(str, "", 0, true);
+		}
+		if(plattform.equals("Unix")){
+			String[] strarr = new String[1];
+			strarr[0] = str;
+			String[] dummy = new String[1];
+			Vm.exec(strarr, dummy);
+		}
+		if(plattform.equals("Java")){
+			ewe.sys.Process p = Vm.exec(str);
+			p.waitFor();
+		}
+	}
+}
\ No newline at end of file



From bilbowolf at mail.berlios.de  Sun Jul 29 15:19:44 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Sun, 29 Jul 2007 15:19:44 +0200
Subject: [Cachewolf-svn] r798 - trunk/src/CacheWolf
Message-ID: <200707291319.l6TDJip0012746@sheep.berlios.de>

Author: bilbowolf
Date: 2007-07-29 15:19:42 +0200 (Sun, 29 Jul 2007)
New Revision: 798

Modified:
   trunk/src/CacheWolf/Version.java
Log:
Versionierung f?\195?\188r neue BE

Modified: trunk/src/CacheWolf/Version.java
===================================================================
--- trunk/src/CacheWolf/Version.java	2007-07-29 13:17:13 UTC (rev 797)
+++ trunk/src/CacheWolf/Version.java	2007-07-29 13:19:42 UTC (rev 798)
@@ -10,7 +10,7 @@
 	static final String VER_MAJOR = "BE";
 	static final String VER_MINOR = "";
 	static final String VER_BUILD = " ";
-	static final String VER_SVN ="$LastChangedRevision$"; //the  number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
+	static final String VER_SVN ="$LastChangedRevision$"; // the  number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	
 	/**
 	 * @return



From salzkammergut at mail.berlios.de  Sun Jul 29 18:03:03 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 29 Jul 2007 18:03:03 +0200
Subject: [Cachewolf-svn] r799 - trunk/src/CacheWolf
Message-ID: <200707291603.l6TG33Z6024213@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-29 18:02:58 +0200 (Sun, 29 Jul 2007)
New Revision: 799

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
TableModel: Bugfix: Die Zeilegroesse wird jetzt richtig an die Fontgroesse angepa?\195?\159t

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2007-07-29 13:19:42 UTC (rev 798)
+++ trunk/src/CacheWolf/myTableModel.java	2007-07-29 16:02:58 UTC (rev 799)
@@ -188,7 +188,7 @@
 	}
 
 	public int calculateRowHeight(int row){
-		return 18;
+		return charHeight+3;
 	}
 
 	public int calculateColWidth(int col){



From salzkammergut at mail.berlios.de  Mon Jul 30 23:49:39 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 30 Jul 2007 23:49:39 +0200
Subject: [Cachewolf-svn] r800 - trunk/src/CacheWolf
Message-ID: <200707302149.l6ULndqU019277@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-30 23:49:24 +0200 (Mon, 30 Jul 2007)
New Revision: 800

Modified:
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/myTableModel.java
Log:
ListPanel: Bugfix. Wenn versucht wurde einen CWxxxx Wegpunkt zu Spidern, haengte sich CW nach der Infobox auf.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-07-29 16:02:58 UTC (rev 799)
+++ trunk/src/CacheWolf/myTableControl.java	2007-07-30 21:49:24 UTC (rev 800)
@@ -146,11 +146,11 @@
 					} else { 
 						if (ch.isAddiWpt() && !ch.mainCache.is_Checked && !alreadySaid2) { // Is the father ticked?
 							alreadySaid2=true;
-							(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).exec();
+							(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).execute();
 						}
 						if (!ch.isAddiWpt() && !alreadySaid) {
 							alreadySaid = true;
-							(new MessageBox("Information",ch.wayPoint+ ": Diese Funktion steht gegenw?rtig nur f?r Geocaching.com und Opencaching.de zur Verf?gung", MessageBox.OKB)).exec();
+							(new MessageBox("Information",ch.wayPoint+ ": Diese Funktion steht gegenw?rtig nur f?r Geocaching.com und Opencaching.de zur Verf?gung", MessageBox.OKB)).execute();
 			    		}
 					}
 				}
@@ -171,7 +171,7 @@
 			CWPoint cp=new CWPoint(thisCache.LatLon);
 			if (!cp.isValid()){
 				MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321,"Error"), MyLocale.getMsg(4111,"Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM"), MessageBox.OKB);
-				tmpMB.exec();
+				tmpMB.execute();
 			} else {				
 				pref.curCentrePt.set(cp);
 				Global.mainTab.updateBearDist(); // Update the distances with a warning message

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2007-07-29 16:02:58 UTC (rev 799)
+++ trunk/src/CacheWolf/myTableModel.java	2007-07-30 21:49:24 UTC (rev 800)
@@ -188,7 +188,7 @@
 	}
 
 	public int calculateRowHeight(int row){
-		return charHeight+3;
+		return charHeight+4;
 	}
 
 	public int calculateColWidth(int col){



From salzkammergut at mail.berlios.de  Mon Jul 30 23:53:43 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 30 Jul 2007 23:53:43 +0200
Subject: [Cachewolf-svn] r801 - trunk/src/CacheWolf
Message-ID: <200707302153.l6ULrh2h019527@sheep.berlios.de>

Author: salzkammergut
Date: 2007-07-30 23:53:29 +0200 (Mon, 30 Jul 2007)
New Revision: 801

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
Solver: Fix fuer Speicherprobleme. Ueberarbeitung und Bereinigung von mainTab
(http://www.geoclub.de/ftopic17684.html)

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-07-30 21:49:24 UTC (rev 800)
+++ trunk/src/CacheWolf/MainTab.java	2007-07-30 21:53:29 UTC (rev 801)
@@ -25,15 +25,17 @@
 	RadarPanel radarP = new RadarPanel();
 	ImagePanel imageP;
 	SolverPanel solverP;
-	String lastselected = new String();
-	CacheHolder ch=null,chNew=null;
+	String lastselected = "";
+	CacheHolder ch=null;
 	CacheHolderDetail chD =null, chMain=null;
 	MainMenu mnuMain;
 	StatusBar statBar;
 	MovingMap mm;
 	Navigate nav;
 	String mainCache="";
-
+	int oldCard=0;
+	boolean cacheDirty=false;
+	
 	public MainTab(MainMenu mainMenu,StatusBar statBar){
 		Global.mainTab=this;
 		mnuMain=mainMenu;
@@ -86,6 +88,152 @@
 		this.selectAndExpand(0);
 	}
 
+
+	public void onEvent(Event ev)
+	{
+		if(ev instanceof MultiPanelEvent){
+			// Check whether a profile change is allowed, if not disable the relevant options
+			checkProfileChange();
+			// Perform clean up actions for the panel we are leaving
+			onLeavingPanel(oldCard);
+			// Prepare actions for the panel we are about to enter
+			onEnteringPanel(getSelectedItem());
+			oldCard=getSelectedItem();
+		}
+		super.onEvent(ev); //Make sure you call this.
+		// If we are in Listview update status
+		if (this.getSelectedItem()==0) statBar.updateDisplay();
+	}
+
+	/**
+	 * Code to execute when leaving a panel (oldCard is the panel number)
+	 *
+	 */
+	private void onLeavingPanel(int panelNo) {
+		if (panelNo==0) { // Leaving the list view
+			// Get the cache for the current line (ch)
+			// Get the details for the current line (chD)
+			// If it is Addi get details of main Wpt (chMain)
+			chMain=null;
+			cacheDirty=false;
+			if (tbP.getSelectedCache()>=cacheDB.size() || tbP.getSelectedCache()<0) {
+				ch=null; chD=null; 
+				lastselected="";
+			} else {
+				ch = (CacheHolder)cacheDB.get(tbP.getSelectedCache());
+				lastselected=ch.wayPoint;  // Used in Parser.Skeleton
+				try {
+					chD=new CacheHolderDetail(ch);
+					chD.readCache(profile.dataDir);//Vm.debug("MainTab:readCache "+chD.wayPoint+"/S:"+chD.Solver);
+				} catch(Exception e){
+					//Vm.debug("Error loading: "+ch.wayPoint);
+				}
+			}
+		}
+		if (panelNo==1) { // Leaving the Details Panel
+			// Update chD with Details
+			if(detP.isDirty()) {
+				cacheDirty=true;
+				detP.saveDirtyWaypoint();
+			}
+		}
+		if (panelNo==5) { // Leaving the Solver Panel
+			// Update chD or chMain with Solver
+			// If chMain is set (i.e. if it is an addi Wpt) save it immediately
+			if (chD!=null && solverP.isDirty()) {
+				cacheDirty=true;
+				if (chMain==null) {
+					chD.Solver=solverP.getInstructions();
+				} else {
+					chMain.Solver=solverP.getInstructions();
+					chMain.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chMain.wayPoint+"/S:"+chMain.Solver);
+					chMain=null;
+				}
+			}
+		}
+	}
+
+	/**
+	 * Code to execute when entering a panel (getSelectedItem() is the panel number)
+	 *
+	 */
+	private void onEnteringPanel(int panelNo) {
+		switch (panelNo) {// Switch by panel number
+		case 0:
+			// If Solver or Details has changed, save Cache
+			updatePendingChanges();
+			if (detP.hasBlackStatusChanged()) {
+				// Restore the filter status (this automatically sets the status for blacklisted caches)
+				//TODO This is not very elegant (see also SearchCache)
+				Filter flt=new Filter();
+				if (Filter.filterActive) {
+					flt.setFilter();
+					flt.doFilter();
+				} else {
+					flt.clearFilter();
+				}
+				if (Filter.filterInverted) 
+					flt.invertFilter();
+				tbP.refreshTable();
+			}
+			break;
+		case 1:  // DetailsPanel
+			if (chD==null) { // Empty DB - show a dummy detail
+				newWaypoint(chD=new CacheHolderDetail()); 
+			}
+			MyLocale.setSIPButton();
+			detP.setDetails(chD);
+			break;
+		case 2: // Description Panel
+			if (chD!=null) {
+				MyLocale.setSIPOff();
+				descP.setText(chD);
+			}
+			break;
+		case 3: // Picture Panel
+			if (chD!=null) {
+				MyLocale.setSIPOff();
+				imageP.setImages(chD);
+			}
+			break;
+		case 4:  // Log Hint Panel
+			if (chD!=null) {
+				MyLocale.setSIPOff();
+				hintLP.setText(chD);
+			}
+			break;
+		case 5:  // Solver Panel
+			MyLocale.setSIPButton();
+			if (chD!=null) {
+				if (chD.isAddiWpt()) { 
+					chMain=new CacheHolderDetail(chD.mainCache);
+					try {
+						chMain.readCache(profile.dataDir); //Vm.debug("mainT:readCache "+chD.wayPoint+"=>Main=>"+chMain.wayPoint+"/S:"+chMain.Solver);
+					} catch(Exception e){pref.log("Error reading cache",e);}
+					solverP.setInstructions(chMain.Solver);
+				} else {
+					//Vm.debug("mainT: Waypoint:"+chD.wayPoint);
+					solverP.setInstructions(chD.Solver);
+				}
+			}
+			break;
+		case 6:  // CalcPanel
+			if (chD!=null) {
+				MyLocale.setSIPButton();
+				calcP.setFields(chD);
+			}
+			break;
+		case 7: // GotoPanel
+			MyLocale.setSIPButton();
+			break;
+		case 8:  // Cache Radar Panel
+			MyLocale.setSIPOff();
+			radarP.setParam(pref, cacheDB, chD==null?"":chD.wayPoint);
+			radarP.drawThePanel();
+			break;
+		}
+	}
+	
 	/** Update the distances of all caches to the center and display a message 
 	 */
 	public void updateBearDist(){// Called from DetailsPanel, GotoPanel and myTableControl
@@ -111,7 +259,7 @@
 
 
 	/**
-	 * this is called from goto / MovingMap / CalcPanel and so on to 
+	 * this is called from goto / MovingMap / CalcPanel / DetailsPanel and so on to 
 	 * offer the user the possibility of entering an new waypoint
 	 * at a given position. ch must already been preset with a valid
 	 * CacheHolder object
@@ -119,17 +267,17 @@
 	 * @param ch
 	 */
 	public void newWaypoint(CacheHolder ch){
+		onLeavingPanel(oldCard);
+		onEnteringPanel(0); oldCard=0;
 		mainCache=lastselected;
 		int selectedIndex = profile.getCacheIndex( lastselected );
-		if (selectedIndex >= 0)
-		{
+		if (selectedIndex >= 0) {
 			CacheHolder selectedCache = (CacheHolder) profile.cacheDB.get( selectedIndex );
-			if ( selectedCache.isAddiWpt() )
-			{
+			if ( selectedCache.isAddiWpt() ) {
 				mainCache = selectedCache.mainCache.wayPoint;
 			}			
 		}
-		if (detP.isDirty()) detP.saveDirtyWaypoint();
+		//if (detP.isDirty()) detP.saveDirtyWaypoint();
 		Global.getProfile().hasUnsavedChanges=true;
 		String waypoint= ch.wayPoint = profile.getNewWayPointName();
 		ch.type = "0";
@@ -147,125 +295,7 @@
 
 	}
 
-
-	public void onEvent(Event ev)
-	{
-    	if(ev instanceof MultiPanelEvent){
-			// A panel is selected.
-			mnuMain.allowProfileChange(false);	  
-			if(this.getSelectedItem() == 0){// List view selected
-				mnuMain.allowProfileChange(true);	  
-	//			Vm.setParameter(Vm.SET_ALWAYS_SHOW_SIP_BUTTON,0);
-	//			Vm.setSIP(0);
-				MyLocale.setSIPOff();
-			}
-			// Get current cacheHolder
-			if (tbP.getSelectedCache()>=cacheDB.size() || tbP.getSelectedCache()<0) {
-				chNew=null; chD=null;
-				lastselected="";
-			}
-			else {
-				chNew = (CacheHolder)cacheDB.get(tbP.getSelectedCache());
-				lastselected=chNew.wayPoint;  // Used in Parser.Skeleton
-			}
-			// Are we back in Listview
-			//if(this.getSelectedItem() == 0) {
-				updatePendingChanges(); // Save dirty data from Details/Solver
-				// Is it the same as the last one?
-			//}
-		    if (chNew!=ch) { // new object not same reference as old
-	            chD=null; // Throw away the details, not longer valid
-			}
-	        ch=chNew;		
-			// Only load the details if we leave the list view and the details
-			// have not already been loaded
-			if(this.getSelectedItem() != 0 && chD==null){// any panel other than list view without detail
-				try {
-					chD=new CacheHolderDetail(ch);
-					chD.readCache(profile.dataDir);//Vm.debug("MainTab:readCache "+chD.wayPoint+"/S:"+chD.Solver);
-				} catch(Exception e){
-					//Vm.debug("Error loading: "+ch.wayPoint);
-				}
-			}
-			// We are in list view, update the status display
-			else statBar.updateDisplay();
-			switch (this.getSelectedItem()) {// Switch by panel number
-			case 0:
-				if (detP.hasBlackStatusChanged()) {
-					// Restore the filter status (this automatically sets the status for blacklisted caches)
-					//TODO This is not very elegant (see also SearchCache)
-					Filter flt=new Filter();
-					if (Filter.filterActive) {
-						flt.setFilter();
-						flt.doFilter();
-					} else {
-						flt.clearFilter();
-					}
-					if (Filter.filterInverted) 
-						flt.invertFilter();
-					tbP.refreshTable();
-				}
-				break;
-			case 1:  // DetailsPanel
-				if (chD==null) { // Empty DB - show a dummy detail
-					newWaypoint(chD=new CacheHolderDetail()); 
-				}
-				MyLocale.setSIPButton();
-				detP.setDetails(chD);
-				break;
-			case 2: // Description Panel
-				if (chD!=null) {
-					MyLocale.setSIPOff();
-					descP.setText(chD);
-				}
-				break;
-			case 3: // Picture Panel
-				if (chD!=null) {
-					MyLocale.setSIPOff();
-					imageP.setImages(chD);
-				}
-				break;
-			case 4:  // Log Hint Panel
-				if (chD!=null) {
-					MyLocale.setSIPOff();
-					hintLP.setText(chD);
-				}
-				break;
-			case 5:  // Solver Panel
-				MyLocale.setSIPButton();
-				if (chD!=null) {
-					if (chD.isAddiWpt()) { 
-						chMain=new CacheHolderDetail(chD.mainCache);
-						try {
-							chMain.readCache(profile.dataDir);//Vm.debug("mainT:readCache "+chD.wayPoint+"=>Main=>"+chMain.wayPoint+"/S:"+chMain.Solver);
-						} catch(Exception e){pref.log("Error reading cache",e);}
-						solverP.setInstructions(chMain.Solver);
-					} else {
-						//Vm.debug("mainT: Waypoint:"+chD.wayPoint);
-						solverP.setInstructions(chD.Solver);
-					}
-				}
-				break;
-			case 6:  // CalcPanel
-				if (chD!=null) {
-					MyLocale.setSIPButton();
-					calcP.setFields(chD);
-				}
-				break;
-
-			case 7: // GotoPanel
-				MyLocale.setSIPButton();
-				break;
-			case 8:  // Cache Radar Panel
-				MyLocale.setSIPOff();
-				radarP.setParam(pref, cacheDB, chD==null?"":chD.wayPoint);
-				radarP.drawThePanel();
-				break;
-			}
-		}
-		super.onEvent(ev); //Make sure you call this.
-	}
-
+	
 	/**
 	 * sets posCircle Lat/Lon to centerTo
 	 * 
@@ -289,7 +319,7 @@
 				try {
 					int i = 0;
 					while (MapImage.screenDim.width == 0 && i < 10*60) { i++; ewe.sys.mThread.sleep(100);} // wait until the window size of the moving map is known note: ewe.sys.sleep() will pause the whole vm - no other thread will run
-					if (i >= 10*60) {(new MessageBox("Error", "MovingMap cannot be displaed - this is most likely a bug - plaese report it on www.geoclub.de", MessageBox.OKB)).execute(); return;}
+					if (i >= 10*60) {(new MessageBox("Error", "MovingMap cannot be displayed - this is most likely a bug - plaese report it on www.geoclub.de", MessageBox.OKB)).execute(); return;}
 					mm.setCenterOfScreen(centerTo, false); // this can only be executed if mm knows its window size that's why myExec must be executed before
 					mm.updatePosition(centerTo.latDec, centerTo.lonDec);
 					/*			if(!mm.posCircle.isOnScreen()) { // TODO this doesn't work because lat lon is set to the wished pos and not to gps anymore
@@ -304,34 +334,24 @@
 					(new MessageBox("Error", "This must not happen please report to pfeffer how to produce this error message", MessageBox.OKB)).execute(); } 
 			}
 		} catch (Exception e) { 
-			Global.getPref().log("Error starting mavoing map (2): " + e.getMessage(), e, true);
-			(new MessageBox("Error", "Error starting mavoing map: " + e.getMessage(), MessageBox.OKB)).execute(); }
+			Global.getPref().log("Error starting moving map (2): " + e.getMessage(), e, true);
+			(new MessageBox("Error", "Error starting moving map: " + e.getMessage(), MessageBox.OKB)).execute(); }
 	}
 
-	/** Save any changes from DetailsPanel before operating on the database */
-	public void updatePendingChanges() {
-		if(detP.isDirty()) {
-			detP.saveDirtyWaypoint();
+	void updatePendingChanges() {
+		if (cacheDirty) {
+			chD.saveCacheDetails(Global.getProfile().dataDir);
+			//Vm.debug("mainT: Saveing "+chD.wayPoint);
 		}
-		if (chD!=null && solverP.isDirty()) {
-			if (chMain==null) {
-				chD.Solver=solverP.getInstructions();
-				chD.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chD.wayPoint+"/S:"+chD.Solver);
-			} else {
-				chMain.Solver=solverP.getInstructions();
-				chMain.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chMain.wayPoint+"/S:"+chMain.Solver);
-				chMain=null;
-			}
-		}
 	}
-
-	/** Save the index file and any pending change in DetailsPanel
+	
+	/** Save the index file
 	 * 
 	 * @param askForConfirmation If true, the save can be cancelled by user
 	 */
 	public void saveUnsavedChanges(boolean askForConfirmation) {
 		boolean saveIndex=!askForConfirmation; // Definitely save it if no confirmation needed
-		updatePendingChanges(); // Updated the cacheDB with pending changes from DetailsPanel
+		updatePendingChanges();
 		if (askForConfirmation) { // Don't know whether to save, have to ask
 			if (profile.hasUnsavedChanges &&     // Only ask if there were changes 
 					(new MessageBox(MyLocale.getMsg(144,"Warnung"),MyLocale.getMsg(1207,"Your profile has unsaved changes. Do you want to save?"),MessageBox.DEFOKB|MessageBox.NOB)).execute()==MessageBox.IDOK) {
@@ -340,6 +360,15 @@
 		}
 		if (saveIndex) profile.saveIndex(Global.getPref(),false);
 	}
+	
+	private void checkProfileChange() {
+		// A panel is selected. Could be the same panel twice
+		mnuMain.allowProfileChange(false);	  
+		if(this.getSelectedItem() == 0){// List view selected
+			mnuMain.allowProfileChange(true);	  
+			MyLocale.setSIPOff();
+		}
+	}
 }
+// 
 
-



From mik77 at mail.berlios.de  Tue Jul 31 00:01:04 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Tue, 31 Jul 2007 00:01:04 +0200
Subject: [Cachewolf-svn] r802 - trunk/src/CacheWolf
Message-ID: <200707302201.l6UM14Ok019987@sheep.berlios.de>

Author: mik77
Date: 2007-07-31 00:00:51 +0200 (Tue, 31 Jul 2007)
New Revision: 802

Modified:
   trunk/src/CacheWolf/myTableModel.java
Log:
Spaltenh?\195?\182he auf Minimum f?\195?\188r Icons begrenzen

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2007-07-30 21:53:29 UTC (rev 801)
+++ trunk/src/CacheWolf/myTableModel.java	2007-07-30 22:00:51 UTC (rev 802)
@@ -188,7 +188,7 @@
 	}
 
 	public int calculateRowHeight(int row){
-		return charHeight+4;
+		return java.lang.Math.max(18, charHeight+4);
 	}
 
 	public int calculateColWidth(int col){



