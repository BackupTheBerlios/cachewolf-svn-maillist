<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2109 - in trunk: lib/com/bbn/openmap	lib/com/bbn/openmap/proj lib/com/bbn/openmap/proj/coords	lib/com/bbn/openmap/util res_noewe/languages	res_noewe/webmapservices src/CacheWolf src/CacheWolf/exp	src/CacheWolf/imp src/CacheWolf/navi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2109%20-%20in%20trunk%3A%20lib/com/bbn/openmap%0A%09lib/com/bbn/openmap/proj%20lib/com/bbn/openmap/proj/coords%0A%09lib/com/bbn/openmap/util%20res_noewe/languages%0A%09res_noewe/webmapservices%20src/CacheWolf%20src/CacheWolf/exp%0A%09src/CacheWolf/imp%20src/CacheWolf/navi&In-Reply-To=%3C200908291142.n7TBgkIU004945%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002032.html">
   <LINK REL="Next"  HREF="002034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2109 - in trunk: lib/com/bbn/openmap	lib/com/bbn/openmap/proj lib/com/bbn/openmap/proj/coords	lib/com/bbn/openmap/util res_noewe/languages	res_noewe/webmapservices src/CacheWolf src/CacheWolf/exp	src/CacheWolf/imp src/CacheWolf/navi</H1>
    <B>pfeffer at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2109%20-%20in%20trunk%3A%20lib/com/bbn/openmap%0A%09lib/com/bbn/openmap/proj%20lib/com/bbn/openmap/proj/coords%0A%09lib/com/bbn/openmap/util%20res_noewe/languages%0A%09res_noewe/webmapservices%20src/CacheWolf%20src/CacheWolf/exp%0A%09src/CacheWolf/imp%20src/CacheWolf/navi&In-Reply-To=%3C200908291142.n7TBgkIU004945%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2109 - in trunk: lib/com/bbn/openmap	lib/com/bbn/openmap/proj lib/com/bbn/openmap/proj/coords	lib/com/bbn/openmap/util res_noewe/languages	res_noewe/webmapservices src/CacheWolf src/CacheWolf/exp	src/CacheWolf/imp src/CacheWolf/navi">pfeffer at mail.berlios.de
       </A><BR>
    <I>Sat Aug 29 13:42:46 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002032.html">[Cachewolf-svn] [Bug #16194] invalid Character Entitiy bei	korruptem zip file
</A></li>
        <LI>Next message: <A HREF="002034.html">[Cachewolf-svn] r2110 - trunk/src/CacheWolf/navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2033">[ date ]</a>
              <a href="thread.html#2033">[ thread ]</a>
              <a href="subject.html#2033">[ subject ]</a>
              <a href="author.html#2033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pfeffer
Date: 2009-08-29 13:42:30 +0200 (Sat, 29 Aug 2009)
New Revision: 2109

Added:
   trunk/res_noewe/webmapservices/region_at_hu_cz.wms
   trunk/src/CacheWolf/navi/UTMProjection.java
Removed:
   trunk/lib/com/bbn/openmap/LatLonPoint.class
   trunk/lib/com/bbn/openmap/MoreMath.class
   trunk/lib/com/bbn/openmap/proj/AziDist.class
   trunk/lib/com/bbn/openmap/proj/Ellipsoid.class
   trunk/lib/com/bbn/openmap/proj/GreatCircle.class
   trunk/lib/com/bbn/openmap/proj/Length.class
   trunk/lib/com/bbn/openmap/proj/Planet.class
   trunk/lib/com/bbn/openmap/proj/ProjMath.class
   trunk/lib/com/bbn/openmap/proj/coords/DMSLatLonPoint.class
   trunk/lib/com/bbn/openmap/proj/coords/MGRSPoint.class
   trunk/lib/com/bbn/openmap/proj/coords/UTMPoint.class
   trunk/lib/com/bbn/openmap/util/ArgParser$Arg.class
   trunk/lib/com/bbn/openmap/util/ArgParser$HelpArg.class
   trunk/lib/com/bbn/openmap/util/ArgParser.class
   trunk/lib/com/bbn/openmap/util/Assert.class
   trunk/lib/com/bbn/openmap/util/AssertionException.class
Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/src/CacheWolf/CWPoint.java
   trunk/src/CacheWolf/CalcPanel.java
   trunk/src/CacheWolf/Common.java
   trunk/src/CacheWolf/CoordsScreen.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/Filter.java
   trunk/src/CacheWolf/NewProfileWizard.java
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/Preferences.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/ProfileDataForm.java
   trunk/src/CacheWolf/Test.java
   trunk/src/CacheWolf/exp/OVLExporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/navi/CWGPSPoint.java
   trunk/src/CacheWolf/navi/GkProjection.java
   trunk/src/CacheWolf/navi/GotoPanel.java
   trunk/src/CacheWolf/navi/LambertProjection.java
   trunk/src/CacheWolf/navi/MapImporter.java
   trunk/src/CacheWolf/navi/MapInfoObject.java
   trunk/src/CacheWolf/navi/MapLoader.java
   trunk/src/CacheWolf/navi/MapLoaderGui.java
   trunk/src/CacheWolf/navi/ProjectedPoint.java
   trunk/src/CacheWolf/navi/Projection.java
   trunk/src/CacheWolf/navi/TransformCoordinates.java
Log:
CoordsScreen / CalcPanel / Solver / GotoPanel: make the implemented coordinate reference transformation available to the GUI
TransformCoordinates: implemented UTM, removed lib openmap

Deleted: trunk/lib/com/bbn/openmap/LatLonPoint.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/MoreMath.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/AziDist.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/Ellipsoid.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/GreatCircle.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/Length.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/Planet.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/ProjMath.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/coords/DMSLatLonPoint.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/coords/MGRSPoint.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/proj/coords/UTMPoint.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/util/ArgParser$Arg.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/util/ArgParser$HelpArg.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/util/ArgParser.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/util/Assert.class
===================================================================
(Binary files differ)

Deleted: trunk/lib/com/bbn/openmap/util/AssertionException.class
===================================================================
(Binary files differ)

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/res_noewe/languages/DE.cfg	2009-08-29 11:42:30 UTC (rev 2109)
@@ -459,7 +459,7 @@
 		1710=Kann leere Zeichenkette nicht z%e4hlen
 		1711=Ersatzzeichenketten m%fcssen gleiche L%e4nge haben
 		1712=Unzul%e4ssige Koordinate:
-		1713=Falsches Koordinatenformat. Erlaubt sind CW/DD/DMM/DMS/UTM
+		1713=Falsches Koordinatenformat. Erlaubt sind cw / dd / dmm / dms /+
 		1714=Goto: Wegpunkt existiert nicht:
 		1715=instr: Startposition nicht in Zeichenkette
 		1716=mid: Ganzzahliger Parameter erwartet

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/res_noewe/languages/EN.cfg	2009-08-29 11:42:30 UTC (rev 2109)
@@ -459,7 +459,7 @@
 		1710=Cannot count empty string
 		1711=Replacement characters strings must be of equal length
 		1712=Invalid coordinate:
-		1713=Invalid coordinate format. Allowed are CW/DD/DMM/DMS/UTM
+		1713=Invalid coordinate format. Allowed are cw / dd / dmm / dms /+
 		1714=Goto: Waypoint does not exist:
 		1715=instr: Start position not in string
 		1716=mid: Integer argument expected

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/res_noewe/languages/FR.cfg	2009-08-29 11:42:30 UTC (rev 2109)
@@ -442,7 +442,7 @@
 		1710=Ne peut pas compter cha%eene de caract%e8res vide
 		1711=Cha%eenes de caract%e8res de remplacement doivent avoir la m&#234;me longuer
 		1712=Coordonn%e9e invalide: 
-		1713=Format de coordonn%e9es pas valide. Faut avoir CW/DD/DMM/DMS/UTM
+		1713=Format de coordonn%e9es pas valide. Faut avoir cw / dd / dmm / dms /+
 		1714=Goto: Waypoint n'existe pas: 
 		1715=instr: Position de d%e9part pas en cha%eene de caract%e8re
 		1716=mid: Attendu param%e8tre en nombre entier

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/res_noewe/languages/NL.cfg	2009-08-29 11:42:30 UTC (rev 2109)
@@ -406,7 +406,7 @@
 		1710=Kan de lege string niet tellen.
 		1711=Gekopieerde karakter strings moeten van dezelfde lengte zijn.
 		1712=Ongeldige co%f6rdinaten:
-		1713=Ongeldig co%f6rdinaat formaat. Toegestaan zijn CW/DD/DMM/DMS/UTM
+		1713=Ongeldig co%f6rdinaat formaat. Toegestaan zijn cw / dd / dmm / dms /+
 		1714=Ga naar: Waypoint bestaat niet:
 		1715=Instr: Start co%f6rdinaat niet in string.
 		1716=Mid: Geheel getal verwacht.

Added: trunk/res_noewe/webmapservices/region_at_hu_cz.wms
===================================================================
--- trunk/res_noewe/webmapservices/region_at_hu_cz.wms	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/res_noewe/webmapservices/region_at_hu_cz.wms	2009-08-29 11:42:30 UTC (rev 2109)
@@ -0,0 +1,42 @@
+TakenFromUrl:   <A HREF="http://www.centropemap.org">http://www.centropemap.org</A>
+GetCapabilitiesUrl:   <A HREF="http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_administrative_units_bordersonly.map&amp;VERSION=1.1.1&amp;REQUEST=GetCapabilities&amp;SERVICE=WMS">http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_administrative_units_bordersonly.map&amp;VERSION=1.1.1&amp;REQUEST=GetCapabilities&amp;SERVICE=WMS</A>
+Name:   at photo lambert
+MapType:   photo
+MainUrl:   <A HREF="http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_administrative_units_bordersonly.map">http://www.centropemap.org/cgi-bin/mapserv?map=/data/wms/centrope/ce_administrative_units_bordersonly.map</A>
+ServiceTypeUrlPart:   SERVICE=WMS
+VersionUrlPart:   VERSION=1.1.1
+CoordinateReferenceSystemCacheWolf:   31287
+CoordinateReferenceSystemUrlPart:   SRS=EPSG:31287
+RequestUrlPart:   REQUEST=GetMap
+#LayersUrlPart:   LAYERS=Bezirke        &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;187.08941170883&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Gemeinden      &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;187.08866335268&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Landesgrenzen      &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;9354.45187653775&quot; /&gt;
+#LayersUrlPart:   LAYERS=Natura2000_SPA     &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; Natura 2000 Vogelschutzrichtlinie (SPA)
+#LayersUrlPart:   LAYERS=Natura2000_pSCI    &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; Natura 2000 Habitatrichtlinie (SCI)
+#LayersUrlPart:   LAYERS=Naturpark      &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Landschaftsschutzgebiet&lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Nationalpark       &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Naturschutzgebiet  &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Autobahn       &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;748.356524301095&quot; /&gt;
+#LayersUrlPart:   LAYERS=Landesstr_B        &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;748.356524301095&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Landesstr_L        &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;187.08941170883&quot; /&gt;
+#LayersUrlPart:   LAYERS=Orientierungskarte &lt;ScaleHint min=&quot;0&quot; max=&quot;9.35482605461281&quot; /&gt;
+#LayersUrlPart:   LAYERS=S/W-Orthofoto      &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;9.35482605461281&quot; /&gt;
+#LayersUrlPart:   LAYERS=Radwanderrouten    &lt;ScaleHint min=&quot;3.74140657254004&quot; max=&quot;187.08941170883&quot; /&gt; 
+#LayersUrlPart:   LAYERS=Startbild      &lt;ScaleHint min=&quot;74.8363633684521&quot; max=&quot;3741.78112479318&quot; /&gt; Hintergrund
+#LayersUrlPart:   LAYERS=Geonamen       &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;5.61229694784759&quot; /&gt; Orts- und Flurnamen
+#LayersUrlPart:   LAYERS=Flug_Orthofoto     &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; Flugjahr Orthofoto
+#LayersUrlPart:   LAYERS=Flug_ALS       &lt;ScaleHint min=&quot;0.935071009578714&quot; max=&quot;1870.89074948563&quot; /&gt; Flugjahr Laserscanning
+#LayersUrlPart:   LAYERS=S/W-Orthofoto,Bezirke,Gemeinden,Landesgrenzen,Autobahn,Landesstr_B,Landesstr_L,Radwanderrouten
+LayersUrlPart:   LAYERS=S/W-Orthofoto,Orientierungskarte,Geonamen,Autobahn,Landesstr_B,Landesstr_L,Radwanderrouten
+StylesUrlPart:   STYLES=
+ImageFormatUrlPart:   FORMAT=image/png
+BoundingBoxTopLeftWGS84:   N 49.027050  E 9.529250
+BoundingBoxButtomRightWGS84:   N 46.357433 E 17.202733
+MinScale:   0
+MaxScale:   45
+RecommendedScale:   1
+ImageFileExtension: .png
+# nicht &#252;berall Luftbilder
+# nicht &#252;berall gut kalibriert
+# bis Skalierung 4,3 gibts noch Fotos, ab 4,5 nur noch Strassen (schlecht kalibriert)

Modified: trunk/src/CacheWolf/CWPoint.java
===================================================================
--- trunk/src/CacheWolf/CWPoint.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/CWPoint.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,13 +1,11 @@
 package CacheWolf;
 
-import ewe.sys.Convert;
+
 import CacheWolf.navi.ProjectedPoint;
 import CacheWolf.navi.TrackPoint;
 import CacheWolf.navi.TransformCoordinates;
 import CacheWolf.navi.GeodeticCalculator;
 
-import com.bbn.openmap.proj.coords.*;
-import com.bbn.openmap.*;
 import com.stevesoft.ewe_pat.Regex;
 
 /**
@@ -17,19 +15,14 @@
  *
  */
 public class CWPoint extends TrackPoint{
-	public MGRSPoint utm = new MGRSPoint();
-	public boolean utmValid = false;
-
-	public static final int DD = 0;
-	public static final int DMM = 1;
-	public static final int DMS = 2;
-	public static final int UTM = 3;
-	public static final int GK = 4;
-	public static final int CW = 5;
-	public static final int REGEX = 6;
-	public static final int LAT_LON = 7;
-	public static final int LON_LAT = 8;
 	
+	public static final int CW 		= TransformCoordinates.CW;
+	public static final int DD 		= TransformCoordinates.DD;
+	public static final int DMM 	= TransformCoordinates.DMM;
+	public static final int LAT_LON	= TransformCoordinates.LAT_LON;
+	public static final int LON_LAT	= TransformCoordinates.LON_LAT;
+	public static final int UTM 	= TransformCoordinates.UTM;
+
 	/** Degrees/Radians conversion constant. */
 	static private final double PiOver180 = Math.PI / 180.0;	
 
@@ -40,7 +33,6 @@
 	 */
 	public CWPoint(double lat, double lon) {
 		super(lat, lon);
-		this.utmValid = false;
 	}
 
 	/**
@@ -49,20 +41,10 @@
 	
 	public CWPoint() {
 		super(-361,-361); // construct with unvalid == unset lat/lon 
-		this.utmValid = false;
 		
 	}
 
-	/**
-	 * Create CWPoint by using a LatLonPoint 
-	 * @param CWPoint LatLonPoint
-	 */
 
-	public CWPoint(LatLonPoint llPoint){
-		super (llPoint.getLatitude(), llPoint.getLongitude());
-		this.utmValid = false;
-	}
-
 	/**
 	 * Create CWPoint by using a CWPoint 
 	 * @param CWPoint LatLonPoint
@@ -70,7 +52,6 @@
 
 	public CWPoint(TrackPoint cwPoint){
 		super(cwPoint.latDec, cwPoint.lonDec);
-		this.utmValid = false;
 	}
 
 	
@@ -126,20 +107,9 @@
 	public void set (double lat, double lon){
 		this.latDec = lat;
 		this.lonDec = lon;
-		this.utmValid = false;
 	}
 
-	/**
-	 * Set CWPoint by using a LatLonPoint 
-	 * @param CWPoint LatLonPoint
-	 */
 
-	public void set (LatLonPoint llPoint){
-		this.latDec = llPoint.getLatitude();
-		this.lonDec = llPoint.getLongitude();
-		this.utmValid = false;
-	}
-
 	/**
 	 * Set CWPoint by using a CWPoint 
 	 * @param CWPoint cwPointt
@@ -148,7 +118,6 @@
 	public void set (TrackPoint cwPoint){
 		this.latDec = cwPoint.latDec;
 		this.lonDec = cwPoint.lonDec;
-		this.utmValid = false;
 	}
 
 	
@@ -161,7 +130,7 @@
 
 		if (coord!=null) {
 			switch (format){
-			case CW: 	ParseLatLon pll = new ParseLatLon (coord);
+			case TransformCoordinates.CW: 	ParseLatLon pll = new ParseLatLon (coord);
 				try {
 					pll.parse();
 					this.latDec = pll.lat2;
@@ -171,7 +140,7 @@
 					this.lonDec = 361;
 					break;
 				}
-			case REGEX: set(coord);
+			case TransformCoordinates.REGEX: set(coord);
 			break;
 
 			default: 	this.latDec = 91; this.lonDec = 361;
@@ -179,7 +148,6 @@
 		} else { 
 			this.latDec = 91; this.lonDec = 361;
 		}
-		this.utmValid = false;
 	}
 
 
@@ -201,7 +169,12 @@
 					)|(?: 
 					   ([0-9]{1,2}[C-HJ-PQ-X])\s*[EeOo]?\s*([0-9]{1,7})\s+[Nn]?\s*([0-9]{1,7}) 
 					)
-		*/		
+		*/	
+	String crsid = null;
+	if (coord.charAt(2)=='.') { // first 2 letters = Internet domain of projected area
+		crsid = coord.substring(0, coord.indexOf(' '));
+		coord = coord.substring(coord.indexOf(' ') + 1, coord.length());
+	}
 				Regex rex=new Regex(&quot;(?:&quot; +
 									&quot;([NSns])\\s*([0-9]{1,2})(?:[&#176;\uC2B0]\\s*|\\s+[&#176;\uC2B0]?\\s*)([0-9]{1,2})(?:(?:['&#146;]\\s*|\\s+['&#146;]?\\s*)([0-9]{1,2}))?(?:[,.]([0-9]{1,8}))?\\s*['&#146;\&quot;]?\\s*&quot; +
 									&quot;[,./_;+:-]*\\s*&quot; + // allow N xx xx.xxx / E xxx xx.xxx
@@ -214,30 +187,36 @@
 									&quot;([0-9]{1,2}[C-HJ-PQ-X])\\s*[EeOo]?\\s*([0-9]{1,7})\\s+[Nn]?\\s*([0-9]{1,7})&quot; +
 									&quot;)|(?:&quot; +
 									&quot;[Rr]:?\\s*([+-]?[0-9]{1,7})\\s+[Hh]:?\\s*([+-]?[0-9]{1,7})&quot; +
+									&quot;)|(?:&quot; + 
+									&quot;([\\-]{0,1}[0-9]{1,8})\\s+([\\-]{0,1}[0-9]{1,8})&quot; + // projected easting northing  
 									&quot;)&quot;); 
-				this.latDec = -91; // return unset / unvalid values if parsing was not successfull
-				this.lonDec = -361;
+				this.makeInvalid(); //return unset / unvalid values if parsing was not successfull
 				rex.search(coord);
 				if (rex.stringMatched(1)!= null) { // Std format
-					// Handle &quot;E&quot; oder &quot;O&quot; for longitiude
+					// Handle &quot;E&quot; or &quot;O&quot; for longitiude
 					String strEW = rex.stringMatched(6).toUpperCase();
 					if (!strEW.equals(&quot;W&quot;)) strEW = &quot;E&quot;;
 					if (rex.stringMatched(4)!=null){ //Seconds available
 						set(rex.stringMatched(1).toUpperCase(), rex.stringMatched(2),rex.stringMatched(3),rex.stringMatched(4) + &quot;.&quot; + rex.stringMatched(5),
-							strEW, rex.stringMatched(7),rex.stringMatched(8),rex.stringMatched(9) + &quot;.&quot; + rex.stringMatched(10),DMS);
+							strEW, rex.stringMatched(7),rex.stringMatched(8),rex.stringMatched(9) + &quot;.&quot; + rex.stringMatched(10),TransformCoordinates.DMS);
 					} else {
 						set(rex.stringMatched(1).toUpperCase(), rex.stringMatched(2),rex.stringMatched(3)+ &quot;.&quot; + rex.stringMatched(5), null,
-							strEW, rex.stringMatched(7),rex.stringMatched(8)+ &quot;.&quot; + rex.stringMatched(10), null, DMM);
+							strEW, rex.stringMatched(7),rex.stringMatched(8)+ &quot;.&quot; + rex.stringMatched(10), null, TransformCoordinates.DMM);
 					}
 						
 				} else if (rex.stringMatched(12) != null){ // Decimal
-					
 					set(rex.stringMatched(11)==null?&quot;N&quot;:rex.stringMatched(11).toUpperCase(), rex.stringMatched(12)+ &quot;.&quot; + rex.stringMatched(13), null, null,
-						rex.stringMatched(14)==null?&quot;E&quot;:rex.stringMatched(14).toUpperCase(), rex.stringMatched(15)+ &quot;.&quot; + rex.stringMatched(16), null, null, DD);
+						rex.stringMatched(14)==null?&quot;E&quot;:rex.stringMatched(14).toUpperCase(), rex.stringMatched(15)+ &quot;.&quot; + rex.stringMatched(16), null, null, TransformCoordinates.DD);
 				} else if (rex.stringMatched(17) != null){ // UTM
-					set(rex.stringMatched(17),rex.stringMatched(19),rex.stringMatched(18)); //parse sequence is E N, but set needs N E
+					set(rex.stringMatched(19), rex.stringMatched(18), rex.stringMatched(17)); //parse sequence is E N, but set needs N E
 				} else if (rex.stringMatched(20) != null){ // GK
-					set(rex.stringMatched(21),rex.stringMatched(20));
+					set(rex.stringMatched(21),rex.stringMatched(20), TransformCoordinates.LOCALSYSTEM_DEFAULT);
+				} else if (rex.stringMatched(22) != null) { // general projected coordinate reference system
+					if (crsid != null) {
+						int ls = TransformCoordinates.getLocalSystemCode(crsid);
+						if (ls == -1) makeInvalid();
+						else set(rex.stringMatched(23), rex.stringMatched(22), ls);
+					}
 				}
 				//else Vm.debug(&quot;CWPoint: &quot;+coord+&quot; could not be parsed&quot;);
 			}	/**
@@ -256,13 +235,13 @@
 		     String strLonEW, String strLonDeg, String strLonMin, String strLonSec,
 		     int format) {
 		switch (format){
-			case DD: 	this.latDec = Common.parseDouble(strLatDeg);
+			case TransformCoordinates.DD: 	this.latDec = Common.parseDouble(strLatDeg);
 						this.lonDec = Common.parseDouble(strLonDeg);
 						break;
-			case DMM: 	this.latDec = Math.abs(Common.parseDouble(strLatDeg)) + Math.abs((Common.parseDouble(strLatMin)/60));
+			case TransformCoordinates.DMM: 	this.latDec = Math.abs(Common.parseDouble(strLatDeg)) + Math.abs((Common.parseDouble(strLatMin)/60));
 						this.lonDec = Math.abs(Common.parseDouble(strLonDeg)) + Math.abs((Common.parseDouble(strLonMin)/60));
 						break;
-			case DMS: 	this.latDec = Math.abs(Common.parseDouble(strLatDeg)) + Math.abs((Common.parseDouble(strLatMin)/60))+Math.abs((Common.parseDouble(strLatSec)/3600));
+			case TransformCoordinates.DMS: 	this.latDec = Math.abs(Common.parseDouble(strLatDeg)) + Math.abs((Common.parseDouble(strLatMin)/60))+Math.abs((Common.parseDouble(strLatSec)/3600));
 						this.lonDec = Math.abs(Common.parseDouble(strLonDeg)) + Math.abs((Common.parseDouble(strLonMin)/60))+Math.abs((Common.parseDouble(strLonSec)/3600));
 						break;
 			
@@ -272,8 +251,18 @@
 		// To avoid changing sign twice if we have something like W -34.2345
 		if (strLatNS.trim().equals(&quot;S&quot;) &amp;&amp; this.latDec&gt;0) this.latDec *= -1;
 		if (strLonEW.trim().equals(&quot;W&quot;) &amp;&amp; this.lonDec&gt;0) this.lonDec *= -1;
-		this.utmValid = false;
 	}
+	
+	/**
+	 * sets by UTM with respect to WGS84
+	 * @param UTMNorthing
+	 * @param UTMEasting
+	 * @param utmzone
+	 */
+	public void set(String UTMNorthing, String UTMEasting, String utmzone){
+		ProjectedPoint utm = new ProjectedPoint(new CWPoint(Common.parseDouble(UTMNorthing), Common.parseDouble(UTMEasting)), utmzone, TransformCoordinates.LOCALSYSTEM_UTM_WGS84, true);
+		set(TransformCoordinates.ProjectedToWgs84(utm, TransformCoordinates.LOCALSYSTEM_UTM_WGS84, true));
+	}
 
 	
 	/**
@@ -298,49 +287,39 @@
 		lonDec = 91;
 	}
 
+	
 	/**
-	 * set lat and lon by using UTM coordinates  
-	 * @param strZone UTM-zone, e.g. 32U
-	 * @param strNorthing Northing component
+	 * set lat and lon by using a local coordinates system  
 	 * @param strEasting  Easting component
+	 * @param strNorthing Northing component
+	 * @param localCooSystem one of TransformCoordinates.LOCALSYSTEM_XXX
 	 */
-	public void set ( String strZone, String strNorthing, String strEasting){
-		LatLonPoint ll =  new LatLonPoint();
-		
-		utm.zone_letter = strZone.charAt(strZone.length()-1);
-		utm.zone_number = Convert.toInt(strZone.substring(0,strZone.length()-1));
-		utm.northing = (float) Common.parseDouble(strNorthing);
-		utm.easting = (float) Common.parseDouble(strEasting);
-		
-		ll = utm.toLatLonPoint(); // returns null if unvalit UTM-coordinates
-		if (ll != null) { 
-			this.utmValid = true;
-			this.latDec = ll.getLatitude();
-			this.lonDec = ll.getLongitude();
-		} else {this.latDec = 91; this.lonDec = 361; }
+	public void set (String strNorthing, String strEasting, int localCooSystem){
+		CWPoint pp = new CWPoint(Common.parseDouble(strNorthing),Common.parseDouble(strEasting));
+		ProjectedPoint gk = new ProjectedPoint(pp, localCooSystem, true, true);
+		set(TransformCoordinates.ProjectedToWgs84(gk, localCooSystem, true));
 	}
-	
+
 	/**
-	 * set lat and lon by using GK coordinates  
+	 * set lat and lon by using UTM coordinates  
 	 * @param strEasting  Easting component
 	 * @param strNorthing Northing component
+	 * @param localCooSystem one of TransformCoordinates.LOCALSYSTEM_XXX which requires an explicit zone
 	 */
-	public void set (String strNorthing, String strEasting){
+	public void set (String strNorthing, String strEasting, String zone, int localCooSystem){
 		CWPoint pp = new CWPoint(Common.parseDouble(strNorthing),Common.parseDouble(strEasting));
-		ProjectedPoint gk = new ProjectedPoint(pp, ProjectedPoint.LOCALSYSTEM_DEFAULT, true, true);
-		set(TransformCoordinates.ProjectedToWgs84(gk, ProjectedPoint.LOCALSYSTEM_DEFAULT, true));
+		ProjectedPoint gk = new ProjectedPoint(pp, zone, localCooSystem, true);
+		set(TransformCoordinates.ProjectedToWgs84(gk, localCooSystem, true));
 	}
-
 	/**
 	 * Get degrees of latitude in different formats
 	 * @param format	Format: DD, DMM, DMS,
 	 */
 	public String getLatDeg(int format) {
 		switch (format) {
-		case DD: 	return MyLocale.formatDouble(this.latDec, &quot;00.00000&quot;).replace(',','.');
-		case CW:
-		case DMM:
-		case DMS:	return getDMS(latDec,0,format);
+		case TransformCoordinates.DD: 	return MyLocale.formatDouble(this.latDec, &quot;00.00000&quot;).replace(',','.');
+		case TransformCoordinates.DMM:
+		case TransformCoordinates.DMS:	return getDMS(latDec,0,format);
 		default: return &quot;&quot;;
 		}
 	}
@@ -351,10 +330,9 @@
 	 */
 	public String getLonDeg(int format) {
 		switch (format) {
-		case DD: 	return MyLocale.formatDouble(this.lonDec, &quot;000.00000&quot;).replace(',','.');
-		case CW:
-		case DMM:
-		case DMS:	return (((lonDec&lt;100.0) &amp;&amp; (lonDec&gt;-100.0))?&quot;0&quot;:&quot;&quot;)+getDMS(lonDec,0,format);
+		case TransformCoordinates.DD: 	return MyLocale.formatDouble(this.lonDec, &quot;000.00000&quot;).replace(',','.');
+		case TransformCoordinates.DMM:
+		case TransformCoordinates.DMS:	return (((lonDec&lt;100.0) &amp;&amp; (lonDec&gt;-100.0))?&quot;0&quot;:&quot;&quot;)+getDMS(lonDec,0,format);
 		default: 	return &quot;&quot;; 
 		}
 	}
@@ -406,9 +384,8 @@
 		double tmpMin, tmpSec;
 		tmpMin= (deg - iDeg)*60.0;
 		switch(format) {
-			case DD: return &quot;&quot;;
-			case CW:
-			case DMM: 	
+			case TransformCoordinates.DD: return &quot;&quot;;
+			case TransformCoordinates.DMM: 	
 			    // Need to check if minutes would round up to 60
 				if (java.lang.Math.round(tmpMin*1000.0) == 60000) { tmpMin =0;  iDeg++; }
 				switch (what) {
@@ -416,7 +393,7 @@
 					case 1: return MyLocale.formatDouble(tmpMin, &quot;00.000&quot;).replace(',','.');
 					case 2: return &quot;&quot;;
 				}
-			case DMS:
+			case TransformCoordinates.DMS:
 				tmpSec= (tmpMin - (int)tmpMin) * 60.0;
 				tmpMin=(int) tmpMin;
 				// Check if seconds round up to 60 
@@ -455,59 +432,6 @@
 	}
 
 	/**
-	 * Get UTMzonenumber, e.g. 32U
-	 */
-	public String getUTMZone(){
-		checkUTMvalid();
-		return Convert.toString(utm.zone_number) + utm.zone_letter;
-	}
-	
-	/**
-	 * Get UTM northing
-	 */
-	public String getUTMNorthing(){
-		checkUTMvalid();
-		return Convert.toString((long)utm.northing).replace(',','.');
-	}
-
-	/**
-	 * Get UTM easting
-	 */
-	public String getUTMEasting() {
-		checkUTMvalid();
-		return Convert.toString((long)utm.easting).replace(',','.');
-	}
-	
-	/**
-	 * Get GK northing
-	 */
-	public String getGKNorthing(int decimalplaces){
-		double gkNorthing = TransformCoordinates.wgs84ToLocalsystem(this, ProjectedPoint.LOCALSYSTEM_DEFAULT).getNorthing();
-		
-		ewe.sys.Double n = new ewe.sys.Double();
-		n.set(gkNorthing);
-		n.decimalPlaces = decimalplaces;
-		return n.toString().replace(',', '.');
-	}
-
-	/**
-	 * Get GK easting
-	 */
-	public String getGKEasting(int decimalplaces) {
-		double gkEasting = TransformCoordinates.wgs84ToLocalsystem(this, ProjectedPoint.LOCALSYSTEM_DEFAULT).getEasting();
-		
-		ewe.sys.Double e = new ewe.sys.Double();
-		e.set(gkEasting);
-		e.decimalPlaces = decimalplaces;
-		return e.toString().replace(',', '.');
-	}
-	
-	public String getGermanGkCoordinates() {
-		return TransformCoordinates.wgs84ToLocalsystem(this, ProjectedPoint.LOCALSYSTEM_DEFAULT).toString(0, &quot;R:&quot;, &quot; H:&quot;);
-	}
-
-	
-	/**
 	 * Method to calculate a projected waypoint
 	 * @param degrees Bearing
 	 * @param distance Distance in km
@@ -597,7 +521,7 @@
 	 * @return  string like N 49&#176; 33.167 E 011&#176; 21.608 
 	 */	
 	public String toString(){
-		return toString(CW);
+		return toString(TransformCoordinates.CW);
 		
 	}
 	/**
@@ -608,36 +532,21 @@
 	public String toString(int format){
 		if (!isValid()) return MyLocale.getMsg(999,&quot;not set&quot;);
 		switch (format) {
-		case DD:	return getNSLetter() + &quot; &quot; + STRreplace.replace(getLatDeg(format),&quot;-&quot;,&quot;&quot;) + &quot;&#176; &quot;
+		case TransformCoordinates.DD:	return getNSLetter() + &quot; &quot; + STRreplace.replace(getLatDeg(format),&quot;-&quot;,&quot;&quot;) + &quot;&#176; &quot;
 						+  getEWLetter() + &quot; &quot; + STRreplace.replace(getLonDeg(format),&quot;-&quot;,&quot;&quot;)+ &quot;&#176;&quot;;
-		case CW:	format = DMM;	
-					return getNSLetter() + &quot; &quot; + getLatDeg(format) + &quot;&#176; &quot; + getLatMin(format) + &quot; &quot;
+		case TransformCoordinates.DMM:	return getNSLetter() + &quot; &quot; + getLatDeg(format) + &quot;&#176; &quot; + getLatMin(format) + &quot; &quot;
 						+  getEWLetter() + &quot; &quot; + getLonDeg(format) + &quot;&#176; &quot; + getLonMin(format);
-		case DMM:	return getNSLetter() + &quot; &quot; + getLatDeg(format) + &quot;&#176; &quot; + getLatMin(format) + &quot; &quot;
-						+  getEWLetter() + &quot; &quot; + getLonDeg(format) + &quot;&#176; &quot; + getLonMin(format);
-		case DMS:	return getNSLetter() + &quot; &quot; + getLatDeg(format) + &quot;&#176; &quot; + getLatMin(format) + &quot;\' &quot; + getLatSec(format) + &quot;\&quot; &quot; 
+		case TransformCoordinates.DMS:	return getNSLetter() + &quot; &quot; + getLatDeg(format) + &quot;&#176; &quot; + getLatMin(format) + &quot;\' &quot; + getLatSec(format) + &quot;\&quot; &quot; 
 						+  getEWLetter() + &quot; &quot; + getLonDeg(format) + &quot;&#176; &quot; + getLonMin(format) + &quot;\' &quot; + getLonSec(format) + &quot;\&quot;&quot;;
-		case UTM:	return getUTMZone()  + &quot; E &quot; + getUTMEasting()+ &quot; N &quot; + getUTMNorthing();
-		case LON_LAT:
-			return Common.DoubleToString(lonDec, 8) +  &quot;,&quot; + Common.DoubleToString(latDec, 8);
-		case LAT_LON:
-			return Common.DoubleToString(latDec, 8) +  &quot;,&quot; + Common.DoubleToString(lonDec, 8);
-		case GK:
-			return getGermanGkCoordinates();
-		default: return &quot;Unknown Format: &quot; + format;
+		//case TransformCoordinates.UTM: 	return TransformCoordinates.wgs84ToLocalsystem(this, TransformCoordinates.LOCALSYSTEM_UTM_WGS84).toHumanReadableString();
+		//case TransformCoordinates.CUSTOM:	return getGermanGkCoordinates();
+		default: return TransformCoordinates.getLocalSystem(format).id + &quot; &quot; + TransformCoordinates.wgs84ToLocalsystem(this, format).toHumanReadableString();
+			//return &quot;Unknown Format: &quot; + format;
 
 		}
 
 	}
 	
-	/**
-	 * Checks, if the data of utm is valid, if not, utm ist calculated
-	 */	
-	private void checkUTMvalid() {
-		if (this.utmValid) return;
-		this.utm = MGRSPoint.LLtoMGRS(new LatLonPoint(this.latDec, this.lonDec));
-		this.utmValid = true;
-	}
 	
 	/**
 	*	Method to identify one of 16 compass directions based

Modified: trunk/src/CacheWolf/CalcPanel.java
===================================================================
--- trunk/src/CacheWolf/CalcPanel.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/CalcPanel.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,6 +1,7 @@
 package CacheWolf;
 
 import CacheWolf.navi.Metrics;
+import CacheWolf.navi.TransformCoordinates;
 import ewe.ui.*;
 import ewe.ui.formatted.TextDisplay;
 import ewe.fx.Dimension;
@@ -30,10 +31,11 @@
 	}
 }
 
-public class CalcPanel extends CellPanel {
+public final class CalcPanel extends CellPanel {
 
-	mCheckBox chkDMM, chkDMS, chkDD, chkUTM, chkGK;
+	mCheckBox chkDMM, chkDMS, chkDD, chkCustom;
 	CheckBoxGroup chkFormat = new CheckBoxGroup();
+	mChoice localCooSystem;
 	mChoice chcDistUnit;
 	mInput inpBearing, inpDistance, inpText;
 	TextDisplay txtOutput;
@@ -65,15 +67,17 @@
 		TopP.addNext(chkDD =new mCheckBox(&quot;d.d&#176;&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
 		TopP.addNext(chkDMM =new mCheckBox(&quot;d&#176;m.m\'&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
 		TopP.addNext(chkDMS =new mCheckBox(&quot;d&#176;m\'s\&quot;&quot;),CellConstants.DONTSTRETCH,CellConstants.WEST);
-		TopP.addNext(chkUTM =new mCheckBox(&quot;UTM&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
-		TopP.addLast(chkGK =new mCheckBox(&quot;GK&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		TopP.addNext(chkCustom =new mCheckBox(&quot;&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
 
 		chkDD.setGroup(chkFormat);
 		chkDMM.setGroup(chkFormat);
 		chkDMS.setGroup(chkFormat);
-		chkUTM.setGroup(chkFormat);
-		chkGK.setGroup(chkFormat);
-		chkFormat.setInt(CWPoint.DMM);
+		chkCustom.setGroup(chkFormat);
+		chkFormat.setInt(2);
+		currFormat = 2;
+		String[] ls = TransformCoordinates.getProjectedSystemNames();
+		TopP.addLast(localCooSystem = new mChoice(ls, 0),CellConstants.DONTSTRETCH, CellConstants.WEST);
+
 		btnChangeLatLon=new mButton();
 		TopP.addLast(btnChangeLatLon,CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		//inpBearing and direction, unit for inpDistance
@@ -113,9 +117,13 @@
 		
 	}
 	
-	public void readFields(CWPoint coords, BearingDistance degKm, int format){
-		coords.set(btnChangeLatLon.getText());
-		currFormat = chkFormat.getSelectedIndex();
+	private final int getLocalCooSystem() {
+		return CoordsScreen.getLocalSystem(currFormat);
+	}
+	
+	public final void readFields(CWPoint coords, BearingDistance degKm){
+		// coords.set(btnChangeLatLon.getText());
+		currFormat = CoordsScreen.combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt());
 		degKm.degrees = Common.parseDouble(inpBearing.getText());
 		
 		double rawDistance = Common.parseDouble(inpDistance.getText());
@@ -152,7 +160,7 @@
 		return;
 	}
 	
-	// ch must be not null
+	// ch must not be null
 	public void setFields(CacheHolder ch){
 		if ( !ch.getWayPoint().equalsIgnoreCase(lastWaypoint) ) {
 			lastWaypoint = ch.getWayPoint();
@@ -160,19 +168,18 @@
 				inpBearing.setText(&quot;0&quot;);
 				inpDistance.setText(&quot;0&quot;);
 
-				currFormat = CWPoint.DMM;
+				currFormat = 2;
 				if (ch.LatLon.length()== 0) coordInp.set(0,0);
-				else coordInp.set(ch.LatLon, CWPoint.CW);
-				setFields(coordInp, CWPoint.DMM);				
+				else coordInp.set(ch.LatLon, TransformCoordinates.CW);
+				setFields();				
 			}
 		}
 	}
 	
 	
-	public void setFields(CWPoint coords, int format) {
-		if (format == CWPoint.CW) format = CWPoint.DMM;
-		btnChangeLatLon.setText(coords.toString(format));
-		chkFormat.selectIndex(format);
+	public void setFields() {
+		btnChangeLatLon.setText(coordInp.toString(getLocalCooSystem()));
+		//chkFormat.selectIndex(currFormat);
 	}
 
 
@@ -180,14 +187,16 @@
 
 		//Vm.debug(ev.toString());
 		if(ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED){
-			if (ev.target == chkFormat){
-				readFields(coordInp,bd, currFormat);
-				setFields(coordInp, currFormat);
+			if (ev.target == chkFormat 
+					|| ((ev.type == ControlEvent.PRESSED) &amp;&amp; (ev.target == localCooSystem )) ) {
+				if (ev.target == localCooSystem) chkFormat.selectIndex(3);
+				readFields(coordInp, bd);
+				setFields();
 				this.repaintNow();
 			}
 
 			if (ev.target == btnCalc){
-				readFields(coordInp, bd, currFormat);
+				readFields(coordInp, bd);
 				coordOut = coordInp.project(bd.degrees, bd.distance);
 				txtOutput.appendText(coordOut.toString(currFormat)+ &quot;\n&quot;,true);
 			}
@@ -196,7 +205,7 @@
 			}
 			if (ev.target == btnSave){
 				CacheHolder ch = new CacheHolder();
-				readFields(coordInp, bd, currFormat);
+				readFields(coordInp, bd);
 				coordOut = coordInp.project(bd.degrees, bd.distance);
 				ch.LatLon = coordOut.toString();
 				ch.pos.set(coordOut);
@@ -205,16 +214,16 @@
 			}
 			
 			if (ev.target == btnGoto){
-				readFields(coordInp, bd, currFormat);
+				readFields(coordInp, bd);
 				coordOut = coordInp.project(bd.degrees, bd.distance);
 				mainT.gotoP.setDestinationAndSwitch(coordOut); 
 			}
 			if (ev.target == btnChangeLatLon){
 				CoordsScreen cs = new CoordsScreen();
-				readFields(coordInp, bd, currFormat);
-				cs.setFields(coordInp,currFormat);
+				readFields(coordInp, bd);
+				cs.setFields(coordInp, getLocalCooSystem());
 				if (cs.execute()== FormBase.IDOK){
-					btnChangeLatLon.setText(cs.getCoords().toString(currFormat));
+					btnChangeLatLon.setText(cs.getCoords().toString(getLocalCooSystem()));
 					coordInp.set(cs.getCoords());
 				}
 			}

Modified: trunk/src/CacheWolf/Common.java
===================================================================
--- trunk/src/CacheWolf/Common.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/Common.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+
 import CacheWolf.utils.FileBugfix;
 import ewe.io.File;
 import ewe.sys.Convert;
@@ -138,6 +139,16 @@
 		if (name.startsWith(&quot;/&quot;)) return new String(&quot;..&quot;+name); // on linux (*nix) machines it is quite usual to give the complete file path to the serial port, but ewe expects only &quot;ttyS0&quot; or similar
 		else                      return name;
 	}
+	
+	public static String arrayToString(String[] a, String sep) {
+		if (a == null || a.length == 0) return &quot;&quot;;
+		StringBuffer sb = new StringBuffer();
+		sb.append(a[0]);
+		for (int i=1; i &lt; a.length; i++) {
+			sb.append(sep).append(a[i]);
+		}
+		return sb.toString();
+	}
 
 
 }

Modified: trunk/src/CacheWolf/CoordsScreen.java
===================================================================
--- trunk/src/CacheWolf/CoordsScreen.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/CoordsScreen.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -2,20 +2,23 @@
 
 import CacheWolf.imp.SpiderGC;
 import CacheWolf.navi.Navigate;
+import CacheWolf.navi.ProjectedPoint;
+import CacheWolf.navi.TransformCoordinates;
 import ewe.ui.*;
 import ewe.fx.Dimension;
 import ewe.sys.*;
 
 /**
-*	Class for entering coordinates&lt;br&gt;
-*	Class IDs 1400 and 600 (same as calc panel and preferences screen)&lt;br&gt;
-*/
+ *	Class for entering coordinates&lt;br&gt;
+ *	Class IDs 1400 and 600 (same as calc panel and preferences screen)&lt;br&gt;
+ */
 
 
 public class CoordsScreen extends Form {
 
-	mCheckBox chkDMM, chkDMS, chkDD, chkUTM, chkGK;
+	mCheckBox chkDMM, chkDMS, chkDD, chkCustom;
 	CheckBoxGroup chkFormat = new CheckBoxGroup();
+	mChoice localCooSystem;
 	mChoice chcNS, chcEW;
 	mInput inpNSDeg, inpNSm, inpNSs, inpEWDeg, inpEWm, inpEWs;
 	mInput inpUTMZone, inpUTMNorthing, inpUTMEasting;
@@ -26,21 +29,21 @@
 	CellPanel mainPanel = new CellPanel();
 	int exitKeys[]={75009};
 	int currFormat;
-	
+
 	private boolean allowInvalid = false;
-	
+
 	public CoordsScreen(boolean allowInvalidCoords)
 	{
 		allowInvalid = allowInvalidCoords;
-		
+
 		InitCoordsScreen();		
 	}
-	
+
 	public CoordsScreen()
 	{
 		InitCoordsScreen();		
 	}
-	
+
 	private void InitCoordsScreen()
 	{
 		this.setTitle(&quot;&quot;);
@@ -48,15 +51,18 @@
 		topLinePanel.addNext(chkDD =new mCheckBox(&quot;d.d&#176;&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
 		topLinePanel.addNext(chkDMM =new mCheckBox(&quot;d&#176;m.m\'&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
 		topLinePanel.addNext(chkDMS =new mCheckBox(&quot;d&#176;m\'s\&quot;&quot;),CellConstants.DONTSTRETCH,CellConstants.WEST);
-		topLinePanel.addNext(chkUTM =new mCheckBox(&quot;UTM&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
-		topLinePanel.addLast(chkGK =new mCheckBox(&quot;GK&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		//topLinePanel.addNext(chkUTM =new mCheckBox(&quot;UTM&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
+		topLinePanel.addNext(chkCustom =new mCheckBox(&quot;&quot;),CellConstants.DONTSTRETCH, CellConstants.WEST);
 
+		String[] ls = TransformCoordinates.getProjectedSystemNames();
+		topLinePanel.addLast(localCooSystem = new mChoice(ls, 0),CellConstants.DONTSTRETCH, CellConstants.WEST);
+
 		chkDD.setGroup(chkFormat); chkDD.exitKeys=exitKeys;
 		chkDMM.setGroup(chkFormat);chkDMM.exitKeys=exitKeys;
 		chkDMS.setGroup(chkFormat);chkDMS.exitKeys=exitKeys;
-		chkUTM.setGroup(chkFormat);chkUTM.exitKeys=exitKeys;
-		chkGK.setGroup(chkFormat);chkGK.exitKeys=exitKeys;
-		
+		//	chkUTM.setGroup(chkFormat);chkUTM.exitKeys=exitKeys;
+		//localCooSystem.setGroup(chkFormat);chkGK.exitKeys=exitKeys;
+		chkCustom.setGroup(chkFormat);chkCustom.exitKeys=exitKeys;
 		this.addLast(topLinePanel,CellConstants.DONTSTRETCH, CellConstants.WEST);
 
 		// Input for degrees
@@ -65,7 +71,7 @@
 		mainPanel.addNext(inpNSDeg = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		mainPanel.addNext(inpNSm = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		mainPanel.addLast(inpNSs = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		
+
 		mainPanel.addNext(chcEW = new mChoice(new String[]{&quot;E&quot;, &quot;W&quot;},0),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		chcEW.setInt(0);
 		mainPanel.addNext(inpEWDeg = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
@@ -83,19 +89,19 @@
 			mainPanel.addNext(new mLabel(MyLocale.getMsg(1402,&quot;Easting&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
 			mainPanel.addLast(new mLabel(MyLocale.getMsg(1401,&quot;Northing&quot;)),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.SOUTHWEST));
 		}
-		
+
 		mainPanel.addNext(inpUTMZone = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		mainPanel.addNext(inpUTMEasting = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		mainPanel.addNext(inpUTMNorthing = new mInput(),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		mainPanel.addLast(btnGps = new mButton(&quot;GPS&quot;),CellConstants.HSTRETCH, (CellConstants.HFILL));
-		
-		mainPanel.addLast(new mLabel(MyLocale.getMsg(1405,&quot;To load coordinates from GC, enter GCxxxxx below&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL)).setTag(SPAN,new Dimension(4,1));
-			// Input for free Text
+
+		//	mainPanel.addLast(new mLabel(MyLocale.getMsg(1405,&quot;To load coordinates from GC, enter GCxxxxx below&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL)).setTag(SPAN,new Dimension(4,1));
+		// Input for free Text
 		mainPanel.addNext(inpText = new mInput(),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		inpText.toolTip=MyLocale.getMsg(1406,&quot;Enter coordinates in any format or GCxxxxx&quot;);
 		inpText.setTag(SPAN,new Dimension(3,1));
 		mainPanel.addLast(btnParse = new mButton(MyLocale.getMsg(619,&quot;Parse&quot;)),CellConstants.HSTRETCH, (CellConstants.HFILL));
-		
+
 		// Buttons for cancel and apply, copy and paste
 		btnCancel = new mButton(MyLocale.getMsg(614,&quot;Cancel&quot;));
 		btnCancel.setHotKey(0, IKeys.ESCAPE);
@@ -112,43 +118,42 @@
 		this.addLast(mainPanel,CellConstants.DONTSTRETCH, CellConstants.WEST);
 		chcNS.takeFocus(ControlConstants.ByKeyboard);
 	}
-	
+
 	public void activateFields(int format){
 		inpEWDeg.wantReturn=false; inpEWm.wantReturn=false; inpEWs.wantReturn=false; inpUTMNorthing.wantReturn=false;
 		switch (format){
-			case CWPoint.DD:
-				enable(chcNS); enable(inpNSDeg); disable(inpNSm); disable(inpNSs);
-				enable(chcEW); enable(inpEWDeg); disable(inpEWm); disable(inpEWs);
-				inpEWDeg.wantReturn=true;
-				disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
-				break;
-			case CWPoint.CW:
-			case CWPoint.DMM: 	
-				enable(chcNS); enable(inpNSDeg); enable(inpNSm); disable(inpNSs);
-				enable(chcEW); enable(inpEWDeg); enable(inpEWm); disable(inpEWs);
-				inpEWm.wantReturn=true;
-				disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
-				break;
-			case CWPoint.DMS: 	
-				enable(chcNS); enable(inpNSDeg); enable(inpNSm); enable(inpNSs);
-				enable(chcEW); enable(inpEWDeg); enable(inpEWm); enable(inpEWs);
-				inpEWs.wantReturn=true;
-				disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
-				break;
-			case CWPoint.UTM: 	
-				disable(chcNS); disable(inpNSDeg); disable(inpNSm); disable(inpNSs);
-				disable(chcEW); disable(inpEWDeg); disable(inpEWm); disable(inpEWs);
-				enable(inpUTMZone); enable(inpUTMNorthing); enable(inpUTMEasting);
-				inpUTMNorthing.wantReturn=true;
-	 			break;
-			case CWPoint.GK: 	
-				disable(chcNS); disable(inpNSDeg); disable(inpNSm); disable(inpNSs);
-				disable(chcEW); disable(inpEWDeg); disable(inpEWm); disable(inpEWs);
-				disable(inpUTMZone); enable(inpUTMNorthing); enable(inpUTMEasting);
-				inpUTMNorthing.wantReturn=true;
-	 			break;
+		case TransformCoordinates.DD:
+			enable(chcNS); enable(inpNSDeg); disable(inpNSm); disable(inpNSs);
+			enable(chcEW); enable(inpEWDeg); disable(inpEWm); disable(inpEWs);
+			inpEWDeg.wantReturn=true;
+			disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+			enable(localCooSystem);
+			break;
+		case TransformCoordinates.DMM: 	
+			enable(chcNS); enable(inpNSDeg); enable(inpNSm); disable(inpNSs);
+			enable(chcEW); enable(inpEWDeg); enable(inpEWm); disable(inpEWs);
+			inpEWm.wantReturn=true;
+			disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+			enable(localCooSystem);
+			break;
+		case TransformCoordinates.DMS: 	
+			enable(chcNS); enable(inpNSDeg); enable(inpNSm); enable(inpNSs);
+			enable(chcEW); enable(inpEWDeg); enable(inpEWm); enable(inpEWs);
+			inpEWs.wantReturn=true;
+			disable(inpUTMZone); disable(inpUTMNorthing); disable(inpUTMEasting);
+			enable(localCooSystem);
+			break;
+		default: 	
+			disable(chcNS); disable(inpNSDeg); disable(inpNSm); disable(inpNSs);
+			disable(chcEW); disable(inpEWDeg); disable(inpEWm); disable(inpEWs);
+			if (TransformCoordinates.localSystems[localCooSystem.getInt()].zoneSeperatly) enable(inpUTMZone);
+			else disable(inpUTMZone); 
+			enable(inpUTMNorthing); enable(inpUTMEasting);
+			disable(localCooSystem);
+			inpUTMNorthing.wantReturn=true;
+			break;
 		}
-		
+
 		this.stretchLastColumn = true;
 		this.stretchLastRow = true;
 		this.repaintNow();
@@ -156,37 +161,37 @@
 
 	private void enable(Control c) {c.modify(ControlConstants.TakesKeyFocus,ControlConstants.Disabled); }
 	private void disable(Control c) {c.modify(ControlConstants.Disabled,ControlConstants.TakesKeyFocus); }
-	
-	public void readFields(CWPoint coords, int format){
+
+	public void readFields(CWPoint coords){
 		String NS, EW;
-		if (format == CWPoint.UTM)
-			coords.set(inpUTMZone.getText(), 
-					   inpUTMNorthing.getText(), inpUTMEasting.getText());
-		else if (format == CWPoint.GK) {
-			coords.set(inpUTMNorthing.getText(), inpUTMEasting.getText());			
+		if (localSystemToformatSel(currFormat) &gt;= formatSelToLocalSystem.length) {
+			if (TransformCoordinates.getLocalSystem(currFormat).zoneSeperatly)
+				coords.set(inpUTMNorthing.getText(), inpUTMEasting.getText(), inpUTMZone.getText(), currFormat); 
+			else
+				coords.set(inpUTMNorthing.getText(), inpUTMEasting.getText(), currFormat);			
 		}
 		else {
 			NS = chcNS.getInt()== 0?&quot;N&quot;:&quot;S&quot;;
 			EW = chcEW.getInt()== 0?&quot;E&quot;:&quot;W&quot;;
 			coords.set(NS, inpNSDeg.getText(), inpNSm.getText(), inpNSs.getText(),
-							 EW, inpEWDeg.getText(), inpEWm.getText(), inpEWs.getText(),
-							 format);
+					EW, inpEWDeg.getText(), inpEWm.getText(), inpEWs.getText(),
+					currFormat);
 		}
-
+		int formatsel = combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt());
+		currFormat = getLocalSystem(formatsel);
 		return;
 	}
 	public void setFields(CWPoint coords, int format) {
-		if (format == CWPoint.CW) format = CWPoint.DMM;
-		if (format == CWPoint.UTM){
-			inpUTMZone.setText(coords.getUTMZone());
-			inpUTMNorthing.setText(coords.getUTMNorthing());
-			inpUTMEasting.setText((coords.getUTMEasting()));
-		}
-		else if (format == CWPoint.GK){
-			inpUTMZone.setText(&quot;&quot;);
+		int formatsel = localSystemToformatSel(format); 
+		if ( formatsel &gt;= formatSelToLocalSystem.length){ // projected point = neither dd, dd&#176; mm.mm nor dd&#176; mm' ss.s&quot;
 			if (coords.isValid()){
-				inpUTMNorthing.setText(coords.getGKNorthing(0));
-				inpUTMEasting.setText((coords.getGKEasting(0)));				
+				localCooSystem.setInt(formatsel - formatSelToLocalSystem.length);
+				ProjectedPoint pp = TransformCoordinates.wgs84ToLocalsystem(coords, format);
+				inpText.setText(pp.toHumanReadableString());
+				inpUTMNorthing.setText(Common.DoubleToString(pp.getNorthing(),0));
+				inpUTMEasting.setText(Common.DoubleToString(pp.getEasting(),0));
+				if (TransformCoordinates.getLocalSystem(format).zoneSeperatly) inpUTMZone.setText(pp.getZoneString()); 
+				else inpUTMZone.setText(&quot;&quot;);
 			}
 			else {
 				inpUTMNorthing.setText(&quot;0&quot;);
@@ -196,16 +201,16 @@
 		else {
 			chcNS.setInt(coords.getNSLetter().equals(&quot;N&quot;)?0:1);
 			chcEW.setInt(coords.getEWLetter().equals(&quot;E&quot;)?0:1);
-			
+
 			inpNSDeg.setText(STRreplace.replace(coords.getLatDeg(format),&quot;-&quot;,&quot;&quot;));
 			inpNSm.setText(coords.getLatMin(format));
 			inpNSs.setText(coords.getLatSec(format));
-			
+
 			inpEWDeg.setText(STRreplace.replace(coords.getLonDeg(format),&quot;-&quot;,&quot;&quot;));
 			inpEWm.setText(coords.getLonMin(format));
 			inpEWs.setText(coords.getLonSec(format));
 		}
-		chkFormat.selectIndex(format);
+		chkFormat.selectIndex(java.lang.Math.min(localSystemToformatSel(format), formatSelToLocalSystem.length));
 		inpText.setText(coords.toString(format));
 		currFormat = format;
 		activateFields(format);
@@ -214,8 +219,8 @@
 	public CWPoint getCoords(){
 		return coordInp;
 	}
-	
 
+
 	public void onEvent(Event ev){
 
 		//Vm.debug(ev.toString());
@@ -224,20 +229,19 @@
 		// For input fields we use the wantReturn field
 		if(ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.EXITED){
 			if (((ControlEvent)ev).target==chkDD || ((ControlEvent)ev).target==chkDMM ||
-			    ((ControlEvent)ev).target==chkDMS) Gui.takeFocus(chcNS,ControlConstants.ByKeyboard);	
-			if (((ControlEvent)ev).target==chkUTM) Gui.takeFocus(inpUTMZone,ControlConstants.ByKeyboard);
-			if (((ControlEvent)ev).target==chkGK) Gui.takeFocus(inpUTMEasting,ControlConstants.ByKeyboard);
+					((ControlEvent)ev).target==chkDMS) Gui.takeFocus(chcNS,ControlConstants.ByKeyboard);	
+			if (((ControlEvent)ev).target==chkCustom) Gui.takeFocus(inpUTMEasting,ControlConstants.ByKeyboard);
 			if (((ControlEvent)ev).target==chcNS) Gui.takeFocus(inpNSDeg,ControlConstants.ByKeyboard);
 			if (((ControlEvent)ev).target==chcEW) Gui.takeFocus(inpEWDeg,ControlConstants.ByKeyboard);
 		}
 		if(ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED){
 			if (((ControlEvent)ev).target==inpEWDeg || ((ControlEvent)ev).target==inpEWm ||
 					((ControlEvent)ev).target==inpEWs || ((ControlEvent)ev).target==inpUTMNorthing) Gui.takeFocus(btnApply,ControlConstants.ByKeyboard);	
-			if (ev.target == chkFormat){
-				readFields(coordInp, currFormat);
-				currFormat = chkFormat.getSelectedIndex();
+			
+			if (ev.target == chkFormat || ev.target == localCooSystem){
+				if (ev.target == localCooSystem) chkFormat.selectIndex(3);
+				readFields(coordInp);
 				setFields(coordInp, currFormat);
-				activateFields(currFormat);
 				this.repaintNow();
 			}
 
@@ -246,8 +250,8 @@
 			}
 
 			if (ev.target == btnApply){
-				currFormat = chkFormat.getSelectedIndex();
-				readFields(coordInp, currFormat);
+				currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
+				readFields(coordInp);
 				if (coordInp.isValid()) this.close(IDOK);
 				else {
 					if	( allowInvalid ) {
@@ -259,15 +263,14 @@
 					}
 				}
 			}
-			
+
 			if (ev.target == btnPaste){
 				inpText.setText(Vm.getClipboardText(&quot;&quot;));
 			}
-			
+
 			if (ev.target == btnCopy){
-				currFormat = chkFormat.getSelectedIndex();
-				readFields(coordInp, currFormat);
-				Vm.setClipboardText(coordInp.toString(chkFormat.getSelectedIndex()));
+				readFields(coordInp); // TODO was anderes als Gau&#223;-Kr&#252;ger unterst&#252;tzen
+				Vm.setClipboardText(coordInp.toString(currFormat));
 			}
 
 			if (ev.target == btnParse){
@@ -280,36 +283,61 @@
 				} else {	
 					coord = new CWPoint(inp);
 				}
-				if (coord.latDec == -91 &amp;&amp; coord.lonDec == -361){
+				if (!coord.isValid()){
 					MessageBox tmpMB = new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(4111,&quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;), FormBase.OKB);
 					tmpMB.exec();
 				}else {
-					currFormat = chkFormat.getSelectedIndex();
+					currFormat =  getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
 					setFields(coord,currFormat);
-					activateFields(currFormat);
 					this.repaintNow();
 				}
 			}
-			
+
 			if (ev.target == btnGps){
 				Navigate nav=Global.mainTab.nav;
 				if (nav.gpsPos.isValid()){
 					CWPoint coord = nav.gpsPos;
-					currFormat = chkFormat.getSelectedIndex();
+					currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
 					setFields(coord,currFormat);
-					activateFields(currFormat);
 				}
 			}
-			
+
 			if (ev.target == btnClear){
 				CWPoint coord = new CWPoint(91,361);
-				currFormat = chkFormat.getSelectedIndex();
+				currFormat = getLocalSystem(combineToFormatSel(chkFormat.getSelectedIndex(), localCooSystem.getInt()));
 				setFields(coord,currFormat);
-				activateFields(currFormat);
 			}
 		}
 		super.onEvent(ev);
 	}
 
+	private static final int[] formatSelToLocalSystem = {
+		TransformCoordinates.DD,
+		TransformCoordinates.DMM,
+		TransformCoordinates.DMS,
+	};
+
+	public int localSystemToformatSel(int cwpointformat) {
+		for (int i=0; i &lt; formatSelToLocalSystem.length; i++) 
+			if (formatSelToLocalSystem[i] == cwpointformat) return i;
+		for (int i=0; i &lt; TransformCoordinates.localSystems.length; i++) 
+			if (TransformCoordinates.localSystems[i].code == cwpointformat) return i + formatSelToLocalSystem.length;
+		
+		throw new IllegalArgumentException(&quot;CoordScreen.CWPointformatToformatSel: cwpointformat &quot; + cwpointformat + &quot;not supported&quot;);
+	}
+
+	public static final int getLocalSystem(int formatsel) { // be carefull: this method is also used by CalcPanel
+		if (formatsel &lt; formatSelToLocalSystem.length) return formatSelToLocalSystem[formatsel];
+		return TransformCoordinates.localSystems[formatsel - formatSelToLocalSystem.length].code;
+	}
 	
+	public static final int combineToFormatSel(int radiobuttonindex, int choiceindex) {
+		int ret = radiobuttonindex;
+		if (ret == formatSelToLocalSystem.length) ret += choiceindex;
+		return ret;
+	}
+
 }
+
+
+

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/DetailsPanel.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.navi.TransformCoordinates;
 import ewe.fx.Color;
 import ewe.fx.Dimension;
 import ewe.fx.Point;
@@ -557,9 +558,9 @@
 				// FIXME: if something changed saveDirtyWaypoint();
 				Global.mainTab.gotoP.setDestinationAndSwitch(cache);
 			} else if (ev.target == btnCoordinates) {
-				CWPoint coords = new CWPoint(btnCoordinates.getText(), CWPoint.CW);
+				CWPoint coords = new CWPoint(btnCoordinates.getText(), TransformCoordinates.CW);
 				final CoordsScreen cs = new CoordsScreen(true);
-				cs.setFields(coords, CWPoint.CW);
+				cs.setFields(coords, TransformCoordinates.CW);
 				if (cs.execute() == FormBase.IDOK) {
 					dirtyDetails = true;
 					coords = cs.getCoords();

Modified: trunk/src/CacheWolf/Filter.java
===================================================================
--- trunk/src/CacheWolf/Filter.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/Filter.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -6,6 +6,7 @@
 import ewe.io.*;
 import com.stevesoft.ewe_pat.*;
 import CacheWolf.imp.*;
+import CacheWolf.navi.TransformCoordinates;
 
 /**
 *	Class that actually filters the cache database.&lt;br&gt;
@@ -172,7 +173,7 @@
 				//... go through the current cache database
 				for(int i = cacheDB.size()-1; i &gt;=0 ; i--){
 					ch = cacheDB.get(i);
-					cwp = new CWPoint(ch.LatLon, CWPoint.CW);
+					cwp = new CWPoint(ch.LatLon, TransformCoordinates.CW);
 					calcDistance = DistToSegment(fromPoint, toPoint, cwp);
 					calcDistance = (calcDistance*180*60)/java.lang.Math.PI;
 					calcDistance = calcDistance * 1.852;

Modified: trunk/src/CacheWolf/NewProfileWizard.java
===================================================================
--- trunk/src/CacheWolf/NewProfileWizard.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/NewProfileWizard.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.navi.TransformCoordinates;
 import ewe.ui.FormBase;
 import ewe.ui.Gui;
 
@@ -18,7 +19,7 @@
 			profile.dataDir=pref.baseDir+f.profileDir+&quot;/&quot;;
 			
 			CoordsScreen cs = new CoordsScreen();
-			cs.setFields(new CWPoint(), CWPoint.CW);
+			cs.setFields(new CWPoint(), TransformCoordinates.CW);
 			if (cs.execute() == FormBase.IDOK) {
 				profile.setCenterCoords(cs.getCoords());
 			}

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/Parser.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -46,7 +46,7 @@
 
 import CacheWolf.navi.Metrics;
 import CacheWolf.navi.Navigate;
-
+import CacheWolf.navi.TransformCoordinates;
 import com.stevesoft.ewe_pat.Regex;
 
 import ewe.sys.Convert;
@@ -527,13 +527,8 @@
     	String coord=popCalcStackAsString();
 		if (!isValidCoord(coord)) err(MyLocale.getMsg(1712,&quot;Invalid coordinate: &quot;)+coord);
     	cwPt.set(coord);
-    	int fmt=CWPoint.CW;
-    	if (fmtStr.equals(&quot;dd&quot;)) fmt=CWPoint.DD;
-    	else if (fmtStr.equals(&quot;dmm&quot;)) fmt=CWPoint.DMM;
-    	else if (fmtStr.equals(&quot;dms&quot;)) fmt=CWPoint.DMS;
-    	else if (fmtStr.equals(&quot;utm&quot;)) fmt=CWPoint.UTM;
-    	else if (fmtStr.equals(&quot;gk&quot;)) fmt=CWPoint.GK;
-    	else if (!fmtStr.equals(&quot;cw&quot;)) err(MyLocale.getMsg(1713,&quot;Invalid coordinate format. Allowed are CW/DD/DMM/DMS/UTM/GK&quot;));
+    	int fmt = TransformCoordinates.getLocalSystemCode(fmtStr);
+    	if (fmt == TransformCoordinates.LOCALSYSTEM_NOT_SUPPORTED) err(MyLocale.getMsg(1713,&quot;Invalid coordinate format. Allowed are cw / dd / dmm / dms / &quot;) + Common.arrayToString(TransformCoordinates.getProjectedSystemIDs(), &quot; / &quot;));
     	return cwPt.toString(fmt);
     }
 
@@ -554,7 +549,7 @@
     			err(MyLocale.getMsg(1714,&quot;Goto: Waypoint does not exist: &quot;)+waypointName);
     			return;
     		}
-    		ch.LatLon=cwPt.toString(CWPoint.CW);
+    		ch.LatLon=cwPt.toString(TransformCoordinates.CW);
     		ch.pos.set(cwPt);
     		ch.calcDistance(Global.getPref().curCentrePt); // Update distance/bearing
     		nav.setDestination(ch);
@@ -995,7 +990,7 @@
 				String coord=popCalcStackAsString();
 				cwPt.set(coord);
 				if (cwPt.isValid() || coord.equals(&quot;&quot;)) { // Can clear coord with empty string
-					ch.LatLon=cwPt.toString(CWPoint.CW);
+					ch.LatLon=cwPt.toString(TransformCoordinates.CW);
 					ch.pos.set(cwPt);
 					ch.calcDistance(Global.getPref().curCentrePt); // Update distance and bearing
 		    	    Global.getProfile().selectionChanged=true; // Tell moving map to updated displayed waypoints

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/Preferences.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -2,6 +2,7 @@
 
 import CacheWolf.imp.SpiderGC;
 import CacheWolf.navi.Metrics;
+import CacheWolf.navi.TransformCoordinates;
 import CacheWolf.utils.FileBugfix;
 import ewe.io.*;
 import ewe.sys.*;
@@ -554,7 +555,7 @@
 			outp.print(&quot;    &lt;garmin connection = \&quot;&quot; + SafeXML.strxmlencode(garminConn) + &quot;\&quot; GPSBabelOptions = \&quot;&quot; + SafeXML.strxmlencode(garminGPSBabelOptions) + &quot;\&quot; MaxWaypointLength = \&quot;&quot; + SafeXML.strxmlencode(garminMaxLen) +
 					        &quot;\&quot; addDetailsToWaypoint = \&quot;&quot; + SafeXML.strxmlencode(addDetailsToWaypoint) + &quot;\&quot; addDetailsToName = \&quot;&quot; + SafeXML.strxmlencode(addDetailsToName) + &quot;\&quot; /&gt;\n&quot;);
 			outp.print(&quot;    &lt;opencaching downloadMissing=\&quot;&quot; + SafeXML.strxmlencode(downloadmissingOC) + &quot;\&quot;/&gt;\n&quot;);
-			outp.print(&quot;    &lt;location lat = \&quot;&quot; + SafeXML.strxmlencode(curCentrePt.getLatDeg(CWPoint.DD)) + &quot;\&quot; long = \&quot;&quot; + SafeXML.strxmlencode(curCentrePt.getLonDeg(CWPoint.DD)) + &quot;\&quot;/&gt;\n&quot;);
+			outp.print(&quot;    &lt;location lat = \&quot;&quot; + SafeXML.strxmlencode(curCentrePt.getLatDeg(TransformCoordinates.DD)) + &quot;\&quot; long = \&quot;&quot; + SafeXML.strxmlencode(curCentrePt.getLonDeg(TransformCoordinates.DD)) + &quot;\&quot;/&gt;\n&quot;);
 			outp.print(&quot;    &lt;spider forcelogin=\&quot;&quot; + SafeXML.strxmlencode(forceLogin) + &quot;\&quot; spiderUpdates=\&quot;&quot; + SafeXML.strxmlencode(spiderUpdates) + &quot;\&quot; maxSpiderNumber=\&quot;&quot; + SafeXML.strxmlencode(maxSpiderNumber) + &quot;\&quot; downloadPics=\&quot;&quot; + SafeXML.strxmlencode(downloadPics) + &quot;\&quot; downloadTBs=\&quot;&quot; + SafeXML.strxmlencode(downloadTBs) +&quot;\&quot;/&gt;\n&quot;);
 			outp.print(&quot;    &lt;gotopanel northcentered=\&quot;&quot; + SafeXML.strxmlencode(northCenteredGoto) + &quot;\&quot; /&gt;\n&quot;);
 			outp.print(&quot;    &lt;details cacheSize=\&quot;&quot; + SafeXML.strxmlencode(maxDetails) + &quot;\&quot; delete=\&quot;&quot; + SafeXML.strxmlencode(deleteDetails) + &quot;\&quot;/&gt;\n&quot;);

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/Profile.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,6 +1,7 @@
 package CacheWolf;
 
 import CacheWolf.navi.Area;
+import CacheWolf.navi.TransformCoordinates;
 import ewe.io.BufferedWriter;
 import ewe.io.File;
 import ewe.io.FileNotFoundException;
@@ -271,7 +272,7 @@
 						String lat=SafeXML.cleanback(text.substring(start,text.indexOf(&quot;\&quot;&quot;,start)));
 						start=text.indexOf(&quot;long=\&quot;&quot;)+6;
 						String lon=SafeXML.cleanback(text.substring(start,text.indexOf(&quot;\&quot;&quot;,start)));
-						centre.set(lat+&quot; &quot;+lon,CWPoint.CW); // Fast parse
+						centre.set(lat+&quot; &quot;+lon,TransformCoordinates.CW); // Fast parse
 					}	
 				} else if (text.indexOf(&quot;&lt;VERSION&quot;)&gt;=0) {
 					int start=text.indexOf(&quot;value = \&quot;&quot;)+9;

Modified: trunk/src/CacheWolf/ProfileDataForm.java
===================================================================
--- trunk/src/CacheWolf/ProfileDataForm.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/ProfileDataForm.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,5 +1,6 @@
 package CacheWolf;
 
+import CacheWolf.navi.TransformCoordinates;
 import ewe.ui.CellPanel;
 import ewe.ui.ControlEvent;
 import ewe.ui.Event;
@@ -59,7 +60,7 @@
 			}
 			if (ev.target == btnCurrentCentre){
 				CoordsScreen cs = new CoordsScreen();
-				cs.setFields(pref.curCentrePt, CWPoint.CW);
+				cs.setFields(pref.curCentrePt, TransformCoordinates.CW);
 				if (cs.execute()== FormBase.IDOK){
 					pref.curCentrePt.set(cs.getCoords());
 					btnCurrentCentre.setText(pref.curCentrePt.toString());
@@ -68,7 +69,7 @@
 			}
 			if (ev.target == btnProfileCentre){
 				CoordsScreen cs = new CoordsScreen();
-				cs.setFields(profile.centre, CWPoint.CW);
+				cs.setFields(profile.centre, TransformCoordinates.CW);
 				if (cs.execute()== FormBase.IDOK){
 					profile.notifyUnsavedChanges(cs.getCoords().equals(profile.centre));
 					profile.centre.set(cs.getCoords());

Modified: trunk/src/CacheWolf/Test.java
===================================================================
--- trunk/src/CacheWolf/Test.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/Test.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -5,7 +5,9 @@
 import ewe.io.RandomAccessFile;
 import ewe.sys.*;
 
-import java.lang.Math;;
+import java.lang.Math;
+
+import CacheWolf.navi.TransformCoordinates;
  
 
 public class Test extends mThread{
@@ -39,7 +41,7 @@
 		// 1.000 CWPoint via constructor
 		start = new Time();
 		for (i=0; i&lt;100; i++){
-			new CWPoint(&quot;N 51&#176; 27.635 E 009&#176; 37.621&quot;, CWPoint.CW);
+			new CWPoint(&quot;N 51&#176; 27.635 E 009&#176; 37.621&quot;, TransformCoordinates.CW);
 		}
 		end = new Time();
 		printResult(&quot;CWPoint(\&quot;N 51&#176; 27.635 E 009&#176; 37.621\&quot;, CWPoint.CW)&quot;, start, end, i);
@@ -48,7 +50,7 @@
 		start = new Time();
 		for (i=0; i&lt;100; i++){
 			CWPoint cwP = new CWPoint();
-			cwP.set(&quot;N 51&#176; 27.635 E 009&#176; 37.621&quot;, CWPoint.CW);
+			cwP.set(&quot;N 51&#176; 27.635 E 009&#176; 37.621&quot;, TransformCoordinates.CW);
 			
 		}
 		end = new Time();
@@ -70,7 +72,7 @@
 		start = new Time();
 		CWPoint cwSet = new CWPoint();
 		for (i=0; i&lt;100; i++){
-			cwSet.set(&quot;N 51&#176; 27.635 E 009&#176; 37.621&quot;, CWPoint.CW);
+			cwSet.set(&quot;N 51&#176; 27.635 E 009&#176; 37.621&quot;, TransformCoordinates.CW);
 		}
 		end = new Time();
 		printResult(&quot;cwSet.set(\&quot;N 51&#176; 27.635 E 009&#176; 37.621\&quot;, CWPoint.CW) CWPoint set&quot;, start, end, i);
@@ -104,7 +106,7 @@
 	}
 	
 	void testPassedRegex(String pattern, String expectedResult, int format) {
-		CWPoint coord = new CWPoint(pattern, CWPoint.REGEX);
+		CWPoint coord = new CWPoint(pattern, TransformCoordinates.REGEX);
 		String res = coord.toString(format);
 
 		if (expectedResult.equals(res)) return; 
@@ -114,36 +116,36 @@
 	}
 	
 	void testRegex(){
-		testPassedRegex(&quot;S1 2.3W4 5.6&quot;,&quot;S 01&#176; 02.300 W 004&#176; 05.600&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;N1 12.123 E7 34.345&quot;,&quot;N 01&#176; 12.123 E 007&#176; 34.345&quot;, CWPoint.CW);
-		testPassedRegex(&quot;S1 12.123 E7 34.345&quot;,&quot;S 01&#176; 12.123 E 007&#176; 34.345&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;N1 12.123 W7 34.345&quot;,&quot;N 01&#176; 12.123 W 007&#176; 34.345&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;S1 12.123 W7 34.345&quot;,&quot;S 01&#176; 12.123 W 007&#176; 34.345&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;N1 12.123 E7 34,345&quot;,&quot;N 01&#176; 12.123 E 007&#176; 34.345&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;n1 1.0 E12 34.3456363&quot;,&quot;N 01&#176; 01.000 E 012&#176; 34.346&quot;, CWPoint.CW); //Kleinbuchstaben erlaubt 
-		testPassedRegex(&quot;S99 60.2345 W180 65.34534&quot;,&quot;S 90&#176; 00.000 W 180&#176; 00.000&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;N1 12.1234 O12 34.3456&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.346&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;N1 12.1234E12 34.3456&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.346&quot;, CWPoint.CW);
-		testPassedRegex(&quot;asdfka N1&#176; 12.1234 E12&#176;34.345 sdfskd &quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.345&quot;, CWPoint.CW);
-		testPassedRegex(&quot;N1&#176; 12.1234 E12&#176;34.345&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.345&quot;, CWPoint.CW); 
-		testPassedRegex(&quot;N1&#176; 12.1234E12&#176;34.345&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.345&quot;, CWPoint.CW); 
-		testPassedRegex(&quot; S17&#176; 23 13.12345 w 127&#176; 34 34.567 &quot;,&quot;S 17&#176; 23' 13.1\&quot; W 127&#176; 34' 34.6\&quot;&quot;, CWPoint.DMS); // Deg Min Sek
-		testPassedRegex(&quot; S17&#176; 23 ' 13.12345    \&quot; w 127&#176; 34'34.567\&quot; &quot;,&quot;S 17&#176; 23' 13.1\&quot; W 127&#176; 34' 34.6\&quot;&quot;, CWPoint.DMS); // Deg Min Sek
-		testPassedRegex(&quot;12.3456 23.4567&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3456&#176; 23.4567&#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3456&#176; 23.4567 &#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3456&#176;23.4567 &#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3456+23.4567 &#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;N  12.3456   W  23.4567 &#176;&quot;,&quot;N 12.34560&#176; W 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3457-23.4567 &#176;&quot;,&quot;N 12.34570&#176; W 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;-12.3456 23.4567&quot;,&quot;S 12.34560&#176; E 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3456 -23.4567&quot;,&quot;N 12.34560&#176; W 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;-12.345668 -23,456734&quot;,&quot;S 12.34567&#176; W 023.45673&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3456-23.4567&quot;,&quot;N 12.34560&#176; W 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;12.3456+23.4567&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;91.2345 180.23456&quot;,&quot;N 90.00000&#176; E 180.00000&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;91.2345 180.23456&quot;,&quot;N 90.00000&#176; E 180.00000&#176;&quot;, CWPoint.DD); 
-		testPassedRegex(&quot;32U 475592 5584875&quot;,&quot;32U E 475592 N 5584875&quot;, CWPoint.UTM); 
-		testPassedRegex(&quot;14X 1 2&quot;,&quot;13N E 668186 N 2&quot;, CWPoint.UTM); 
+		testPassedRegex(&quot;S1 2.3W4 5.6&quot;,&quot;S 01&#176; 02.300 W 004&#176; 05.600&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;N1 12.123 E7 34.345&quot;,&quot;N 01&#176; 12.123 E 007&#176; 34.345&quot;, TransformCoordinates.CW);
+		testPassedRegex(&quot;S1 12.123 E7 34.345&quot;,&quot;S 01&#176; 12.123 E 007&#176; 34.345&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;N1 12.123 W7 34.345&quot;,&quot;N 01&#176; 12.123 W 007&#176; 34.345&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;S1 12.123 W7 34.345&quot;,&quot;S 01&#176; 12.123 W 007&#176; 34.345&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;N1 12.123 E7 34,345&quot;,&quot;N 01&#176; 12.123 E 007&#176; 34.345&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;n1 1.0 E12 34.3456363&quot;,&quot;N 01&#176; 01.000 E 012&#176; 34.346&quot;, TransformCoordinates.CW); //Kleinbuchstaben erlaubt 
+		testPassedRegex(&quot;S99 60.2345 W180 65.34534&quot;,&quot;S 90&#176; 00.000 W 180&#176; 00.000&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;N1 12.1234 O12 34.3456&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.346&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;N1 12.1234E12 34.3456&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.346&quot;, TransformCoordinates.CW);
+		testPassedRegex(&quot;asdfka N1&#176; 12.1234 E12&#176;34.345 sdfskd &quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.345&quot;, TransformCoordinates.CW);
+		testPassedRegex(&quot;N1&#176; 12.1234 E12&#176;34.345&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.345&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot;N1&#176; 12.1234E12&#176;34.345&quot;,&quot;N 01&#176; 12.123 E 012&#176; 34.345&quot;, TransformCoordinates.CW); 
+		testPassedRegex(&quot; S17&#176; 23 13.12345 w 127&#176; 34 34.567 &quot;,&quot;S 17&#176; 23' 13.1\&quot; W 127&#176; 34' 34.6\&quot;&quot;, TransformCoordinates.DMS); // Deg Min Sek
+		testPassedRegex(&quot; S17&#176; 23 ' 13.12345    \&quot; w 127&#176; 34'34.567\&quot; &quot;,&quot;S 17&#176; 23' 13.1\&quot; W 127&#176; 34' 34.6\&quot;&quot;, TransformCoordinates.DMS); // Deg Min Sek
+		testPassedRegex(&quot;12.3456 23.4567&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3456&#176; 23.4567&#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3456&#176; 23.4567 &#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3456&#176;23.4567 &#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3456+23.4567 &#176;&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;N  12.3456   W  23.4567 &#176;&quot;,&quot;N 12.34560&#176; W 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3457-23.4567 &#176;&quot;,&quot;N 12.34570&#176; W 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;-12.3456 23.4567&quot;,&quot;S 12.34560&#176; E 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3456 -23.4567&quot;,&quot;N 12.34560&#176; W 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;-12.345668 -23,456734&quot;,&quot;S 12.34567&#176; W 023.45673&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3456-23.4567&quot;,&quot;N 12.34560&#176; W 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;12.3456+23.4567&quot;,&quot;N 12.34560&#176; E 023.45670&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;91.2345 180.23456&quot;,&quot;N 90.00000&#176; E 180.00000&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;91.2345 180.23456&quot;,&quot;N 90.00000&#176; E 180.00000&#176;&quot;, TransformCoordinates.DD); 
+		testPassedRegex(&quot;32U 475592 5584875&quot;,&quot;32U E 475592 N 5584875&quot;, TransformCoordinates.UTM); 
+		testPassedRegex(&quot;14X 1 2&quot;,&quot;13N E 668186 N 2&quot;, TransformCoordinates.UTM); 
 	}
 }

Modified: trunk/src/CacheWolf/exp/OVLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/OVLExporter.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/exp/OVLExporter.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,5 +1,6 @@
 package CacheWolf.exp;
 import CacheWolf.*;
+import CacheWolf.navi.TransformCoordinates;
 import ewe.sys.*;
 
 /**
@@ -57,8 +58,8 @@
 		str.append(&quot;MapName=Gesamtes Bundesgebiet (D1000)\r\n&quot;);
 		str.append(&quot;DimmFc=100\r\n&quot;);
 		str.append(&quot;ZoomFc=100\r\n&quot;);
-		str.append(&quot;CenterLat=&quot;+pref.curCentrePt.getLatDeg(CWPoint.CW)+&quot;.00\r\n&quot;);
-		str.append(&quot;CenterLong=&quot;+pref.curCentrePt.getLonDeg(CWPoint.CW)+&quot;.00\r\n&quot;);
+		str.append(&quot;CenterLat=&quot;+pref.curCentrePt.getLatDeg(TransformCoordinates.CW)+&quot;.00\r\n&quot;);
+		str.append(&quot;CenterLong=&quot;+pref.curCentrePt.getLonDeg(TransformCoordinates.CW)+&quot;.00\r\n&quot;);
 		str.append(&quot;RefColor=255\r\n&quot;);
 		str.append(&quot;RefRad=58\r\n&quot;);
 		str.append(&quot;RefLine=6\r\n&quot;);

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -16,6 +16,8 @@
 import CacheWolf.Profile;
 import CacheWolf.SafeXML;
 import CacheWolf.UrlFetcher;
+
+import CacheWolf.navi.TransformCoordinates;
 import CacheWolf.utils.FileBugfix;
 
 import com.stevesoft.ewe_pat.Regex;
@@ -204,8 +206,8 @@
 		else url += &quot;&amp;picture=0&quot;;
 		url += &quot;&amp;cachelog=1&quot;
 			+ &quot;&amp;removedobject=0&quot;
-			+ &quot;&amp;lat=&quot; + centre.getLatDeg(CWPoint.DD)
-			+ &quot;&amp;lon=&quot; + centre.getLonDeg(CWPoint.DD)
+			+ &quot;&amp;lat=&quot; + centre.getLatDeg(TransformCoordinates.DD)
+			+ &quot;&amp;lon=&quot; + centre.getLonDeg(TransformCoordinates.DD)
 			+ &quot;&amp;distance=&quot; + dist
 			+ &quot;&amp;charset=utf-8&quot;
 			+ &quot;&amp;cdata=0&quot;

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -53,6 +53,7 @@
 import CacheWolf.SafeXML;
 import CacheWolf.Travelbug;
 import CacheWolf.navi.Metrics;
+import CacheWolf.navi.TransformCoordinates;
 
 import com.stevesoft.ewe_pat.*;
 import ewe.ui.*;
@@ -443,7 +444,7 @@
 			if (spiderAllFinds) {
 				ln = p.getProp(&quot;firstPageFinds&quot;) + encodeUTF8URL(Utils.encodeJavaUtf8String(pref.myAlias));
 			} else {
-				ln = p.getProp(&quot;firstPage&quot;) + origin.getLatDeg(CWPoint.DD) + p.getProp(&quot;firstPage2&quot;) + origin.getLonDeg(CWPoint.DD)
+				ln = p.getProp(&quot;firstPage&quot;) + origin.getLatDeg(TransformCoordinates.DD) + p.getProp(&quot;firstPage2&quot;) + origin.getLonDeg(TransformCoordinates.DD)
 			                              + p.getProp(&quot;maxDistance&quot;) + Integer.toString( (int)saveDistanceInMiles );
 				if(doNotgetFound) ln = ln + p.getProp(&quot;showOnlyFound&quot;);
 			}
@@ -573,7 +574,7 @@
 				if (spiderAllFinds) {
 					postStr = p.getProp(&quot;firstLine&quot;);
 				} else {
-					postStr = p.getProp(&quot;firstLine&quot;) + origin.getLatDeg(CWPoint.DD) + &quot;&amp;&quot; + origin.getLonDeg(CWPoint.DD)
+					postStr = p.getProp(&quot;firstLine&quot;) + origin.getLatDeg(TransformCoordinates.DD) + &quot;&amp;&quot; + origin.getLonDeg(TransformCoordinates.DD)
 							                             + p.getProp(&quot;maxDistance&quot;) + Integer.toString( (int)saveDistanceInMiles );
 					if(doNotgetFound) postStr = postStr + p.getProp(&quot;showOnlyFound&quot;);
 				}

Modified: trunk/src/CacheWolf/navi/CWGPSPoint.java
===================================================================
--- trunk/src/CacheWolf/navi/CWGPSPoint.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/CWGPSPoint.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -260,7 +260,7 @@
 						} break;
 						} // switch
 					} // while
-					if (Fix &gt; 0) this.set(latNS, latDeg, latMin, &quot;0&quot;, lonEW, lonDeg, lonMin, &quot;0&quot;, CWPoint.DMM);
+					if (Fix &gt; 0) this.set(latNS, latDeg, latMin, &quot;0&quot;, lonEW, lonDeg, lonMin, &quot;0&quot;, TransformCoordinates.DMM);
 
 				} // if
 
@@ -351,7 +351,7 @@
 					else {
 						if (status.equals(&quot;A&quot;)){
 							this.set(latNS, latDeg, latMin, &quot;0&quot;,
-									lonEW, lonDeg, lonMin, &quot;0&quot;, CWPoint.DMM);				
+									lonEW, lonDeg, lonMin, &quot;0&quot;, TransformCoordinates.DMM);				
 						}
 					}
 				} // if
@@ -475,8 +475,8 @@
 
 
 	public void printAll(){
-		Vm.debug(&quot;Latitude:     &quot; + this.getLatDeg(DD));
-		Vm.debug(&quot;Longitude:    &quot; + this.getLonDeg(DD));
+		Vm.debug(&quot;Latitude:     &quot; + this.getLatDeg(TransformCoordinates.DD));
+		Vm.debug(&quot;Longitude:    &quot; + this.getLonDeg(TransformCoordinates.DD));
 		Vm.debug(&quot;Speed:        &quot; + this.Speed);
 		Vm.debug(&quot;Bearing:      &quot; + this.Bear);
 		Vm.debug(&quot;Time:         &quot; + this.Time);

Modified: trunk/src/CacheWolf/navi/GkProjection.java
===================================================================
--- trunk/src/CacheWolf/navi/GkProjection.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/GkProjection.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -2,7 +2,7 @@
 
 import CacheWolf.CWPoint;
 
-public class GkProjection extends Projection{
+public final class GkProjection extends Projection{
 	double falseEasting;
 	double falseNorthing;
 	double degreeOfStripe0;
@@ -82,7 +82,7 @@
 	 * @param stripewidth width in degree of the stripe of the Gau&#223;-Kr&#252;ger-System (3 degreee usually used in Gau&#223;-Kr&#252;ger, 6 degree usually in UTM)
 	 * @return
 	 */
-	private static CWPoint unproject(ProjectedPoint gkp, double stripelon, Ellipsoid ellipsoid, double scale) {
+	public static CWPoint unproject(ProjectedPoint gkp, double stripelon, Ellipsoid ellipsoid, double scale) {
 		double L0 = stripelon; // decimal degree of the center of the stripe
 		double y = gkp.getRawEasting()/scale;
 
@@ -114,11 +114,12 @@
 		return new CWPoint(lat, lon);
 	}
 	
-	private static ProjectedPoint project(CWPoint latlon, Ellipsoid ellipsoid, double stripewidth, int stripe, double degreeOfStripe0, double scale, ProjectedPoint gkp) {
+	public static ProjectedPoint project(CWPoint latlon, Ellipsoid ellipsoid, double stripewidth, int stripe, double degreeOfStripe0, double scale, ProjectedPoint gkp) {
 		double e2 = (ellipsoid.a * ellipsoid.a - ellipsoid.b * ellipsoid.b)/(ellipsoid.a * ellipsoid.a);
 		double l = latlon.lonDec;
 		if (l&lt;0) l+=360;
 		l = (l - degreeOfStripe0 - stripe * stripewidth) /180*Math.PI;
+//		if (l &lt; - 2* Math.PI) l += 4 * Math.PI;
 		double B = latlon.latDec /180*Math.PI;
 		double N = ellipsoid.a/ Math.sqrt(1- e2 * Math.pow(Math.sin(B),2));
 		double nue = Math.sqrt(Math.pow(ellipsoid.a, 2) / Math.pow(ellipsoid.b, 2)* e2 * Math.pow(Math.cos(B), 2));

Modified: trunk/src/CacheWolf/navi/GotoPanel.java
===================================================================
--- trunk/src/CacheWolf/navi/GotoPanel.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/GotoPanel.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -27,14 +27,14 @@
  */
 
 
-public class GotoPanel extends CellPanel {
+public final class GotoPanel extends CellPanel {
 
 	//public CWGPSPoint gpsPosition = new CWGPSPoint();
 	//public CWPoint toPoint = new CWPoint();
 	public Navigate myNavigation;
 	mButton btnGPS, btnCenter,btnSave;
 	mButton btnGoto, btnMap;
-	int currFormat;
+	int currFormatSel;
 
 	mLabel lblGPS, lblPosition, lblDST;
 	Color gpsStatus;
@@ -61,14 +61,14 @@
 	final static Font BOLD = new Font(&quot;Arial&quot;, Font.BOLD, 14);
 
 	int ticker = 0;
-	
+
 	Menu mnuContextFormt;
-	MenuItem miDMM, miDMS, miDD, miUTM, miGK;
-	
+	MenuItem miCooformat[] = new MenuItem[TransformCoordinates.localSystems.length + 3]; //miDMM, miDMS, miDD, miUTM, miGK;
+
 	Menu mnuContextRose;
 	MenuItem miLuminary[] = new MenuItem[SkyOrientation.LUMINARY_NAMES.length];
 	MenuItem miNorthCentered;
-	
+
 	/**
 	 * Create GotoPanel 
 	 * @param Preferences 	global preferences
@@ -93,17 +93,14 @@
 		//Format selection for coords		
 		//context menu
 		mnuContextFormt = new Menu();
-		mnuContextFormt.addItem(miDD = new MenuItem(&quot;d.d&#239;&#191;&#189;&quot;));
-		miDD.modifiers &amp;= ~MenuItem.Checked;
-		mnuContextFormt.addItem(miDMM = new MenuItem(&quot;d&#239;&#191;&#189;m.m\'&quot;));
-		miDMM.modifiers |= MenuItem.Checked;
-		mnuContextFormt.addItem(miDMS = new MenuItem(&quot;d&#239;&#191;&#189;m\'s\&quot;&quot;));
-		miDMS.modifiers &amp;= ~MenuItem.Checked;
-		mnuContextFormt.addItem(miUTM = new MenuItem(&quot;UTM&quot;));
-		miUTM.modifiers &amp;= ~MenuItem.Checked;
-		mnuContextFormt.addItem(miGK = new MenuItem(&quot;GK&quot;));
-		miGK.modifiers &amp;= ~MenuItem.Checked;
-		currFormat = CWPoint.DMM;
+		currFormatSel = 1; // default to d&#176; m.m
+		mnuContextFormt.addItem(miCooformat[0] = new MenuItem(&quot;d.d&#176;&quot;));
+		miCooformat[0].modifiers &amp;= ~MenuItem.Checked;
+		mnuContextFormt.addItem(miCooformat[1] = new MenuItem(&quot;d&#176;m.m\'&quot;));
+		miCooformat[1].modifiers |= MenuItem.Checked; // default
+		mnuContextFormt.addItem(miCooformat[2] = new MenuItem(&quot;d&#176;m\'s\&quot;&quot;));
+		miCooformat[2].modifiers &amp;= ~MenuItem.Checked;
+		mnuContextFormt.addItems(TransformCoordinates.getProjectedSystemNames());
 
 		// Create context menu for compass rose: select luminary for orientation
 		mnuContextRose = new Menu();
@@ -119,7 +116,7 @@
 		lblGPS.setMenu(mnuContextFormt);
 		lblGPS.modifyAll(ControlConstants.WantHoldDown, 0);
 
-		lblPosition = new mLabel(myNavigation.gpsPos.toString(currFormat));
+		lblPosition = new mLabel(myNavigation.gpsPos.toString(CoordsScreen.getLocalSystem(currFormatSel)));
 		lblPosition.anchor = CellConstants.CENTER;
 		lblPosition.setMenu(mnuContextFormt);
 		lblPosition.modifyAll(ControlConstants.WantHoldDown, 0);
@@ -131,15 +128,15 @@
 		lblDST.modifyAll(ControlConstants.WantHoldDown, 0);
 
 		CoordsP.addLast(btnGoto = new mButton(getGotoBtnText()),CellConstants.HSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		
+
 		//Rose for bearing
-//		compassRose = new GotoRose(&quot;rose.png&quot;);
+		//		compassRose = new GotoRose(&quot;rose.png&quot;);
 		compassRose = new GotoRose();
 		icRose = new ImageControl(compassRose);
 		icRose.setMenu(mnuContextRose);
 		icRose.modifyAll(ControlConstants.WantHoldDown, 0); // this is necessary in order to make PenHold on a PDA work as right click
 		roseP.addLast(icRose,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.NORTH));
-		
+
 		mnuContextRose.addItem(new MenuItem(&quot;&quot;, MenuItem.Separator, null));
 		mnuContextRose.addItem(miNorthCentered = new MenuItem(MyLocale.getMsg(1503,&quot;North Centered&quot;)));
 		if (compassRose.isNorthCentered()) miNorthCentered.modifiers |= MenuItem.Checked;
@@ -171,15 +168,15 @@
 		 */
 
 		//while (true){
-//		int notinterpreted = 0;
-//		if (myGPS.examine(&quot;@&#239;&#191;&#189;&#239;&#191;&#189;H @&#239;&#191;&#189;&#239;&#191;&#189;H&#239;&#191;&#189;@&#239;&#191;&#189;&#239;&#191;&#189;HH&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;H&quot;)) { notinterpreted = 0;} else notinterpreted++;
-//		if (notinterpreted &gt; 5) myGPS.noInterpretableData();
-//		// myGPS.noInterpretableData();
+		//		int notinterpreted = 0;
+		//		if (myGPS.examine(&quot;@&#239;&#191;&#189;&#239;&#191;&#189;H @&#239;&#191;&#189;&#239;&#191;&#189;H&#239;&#191;&#189;@&#239;&#191;&#189;&#239;&#191;&#189;HH&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;&#239;&#191;&#189;H&quot;)) { notinterpreted = 0;} else notinterpreted++;
+		//		if (notinterpreted &gt; 5) myGPS.noInterpretableData();
+		//		// myGPS.noInterpretableData();
 
 
-//		}	
+		//		}	
 	}
-	
+
 	public void resizeTo(int pWidth, int pHeight){
 		super.resizeTo(pWidth, pHeight);
 		Rect coordsRect = CoordsP.getRect();
@@ -204,15 +201,15 @@
 	public void setDestination(CWPoint dest){
 		myNavigation.setDestination(dest);
 		if (!myNavigation.destination.isValid()) (new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;), MyLocale.getMsg(1507,&quot;Coordinates are out of range:&quot;) +&quot;\n&quot;+MyLocale.getMsg(1508,&quot;latitude&quot;)+&quot;: &quot;+myNavigation.destination.latDec+&quot;\n &quot;+MyLocale.getMsg(1509,&quot;longditue&quot;)+&quot;: &quot;+myNavigation.destination.lonDec, FormBase.OKB)).execute();
-		
+
 	}
-	
+
 	public void destChanged(CWPoint d) { // called from myNavigate
 		btnGoto.setText(getGotoBtnText());
 		updateDistance();
 	}
-	
 
+
 	/**
 	 * set the coords of the destination and switch to gotoPanel  
 	 * @param LatLon destination
@@ -225,12 +222,12 @@
 		myNavigation.setDestination(ch);
 		mainT.select(this);
 	}
-	
+
 	/**
 	 * updates distance and bearing
 	 *
 	 */
-	
+
 	public void updateDistance() {
 		//update distance
 		float distance = -1.0f;
@@ -252,7 +249,7 @@
 		if ((fix &gt; 0) &amp;&amp; (myNavigation.gpsPos.getSats()&gt;= 0)) {
 			// display values only, if signal good
 			//Vm.debug(&quot;currTrack.add: nachher&quot;);
-			lblPosition.setText(myNavigation.gpsPos.toString(currFormat));
+			lblPosition.setText(myNavigation.gpsPos.toString(CoordsScreen.getLocalSystem(currFormatSel)));
 			speed.set(myNavigation.gpsPos.getSpeed());
 			sunAzimut.set(myNavigation.skyOrientationDir.lonDec);
 			bearMov.set(myNavigation.gpsPos.getBear());
@@ -271,7 +268,7 @@
 			gpsStatus = RED;
 			myNavigation.stopGps();
 		}
-		// cannot interprete data
+		// cannot interpret data
 		if (fix == -2) {
 			if (gpsStatus != RED) (new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1511, &quot;Cannot interpret data from GPS\n possible reasons:\n wrong Port,\n wrong Baudrate,\n not NMEA-Protocol\nConnection to serial port closed\nLast String tried to interprete:\n&quot;)+myNavigation.gpsPos.lastStrExamined, FormBase.OKB)).exec();
 			gpsStatus = RED;
@@ -282,7 +279,7 @@
 	public void gpsStarted() {
 		btnGPS.setText(MyLocale.getMsg(1505,&quot;Stop&quot;));
 	}
-	
+
 	public void startGps() {
 		myNavigation.startGps(pref.logGPS, Convert.toInt(pref.logGPSTimer));
 	}
@@ -293,12 +290,12 @@
 		this.repaintNow(); // without this the change in the background color will not be displayed
 	}
 
-	
+
 	private String getGotoBtnText() {
 		if (myNavigation.destination == null) return MyLocale.getMsg(999,&quot;Not set&quot;);
-		else return myNavigation.destination.toString(currFormat);
+		else return myNavigation.destination.toString(CoordsScreen.getLocalSystem(currFormatSel));
 	}
-	
+
 	public void switchToMovingMap() {
 		CWPoint centerTo = null;
 		if (myNavigation.isGpsPosValid()) centerTo = new CWPoint(myNavigation.gpsPos); // set gps-pos if gps is on
@@ -316,72 +313,43 @@
 		if (centerTo != null &amp;&amp; centerTo.isValid())
 			mainT.SwitchToMovingMap(centerTo, false);
 		else
-		(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1513, &quot;Cannot start moving map without valid coordinates. Please enter coordinates as destination, as center, in selected cache or start GPS&quot;), FormBase.OKB)).execute(); 
+			(new MessageBox(MyLocale.getMsg(321, &quot;Error&quot;), MyLocale.getMsg(1513, &quot;Cannot start moving map without valid coordinates. Please enter coordinates as destination, as center, in selected cache or start GPS&quot;), FormBase.OKB)).execute(); 
 	}
-	
+
 	/**
 	 * Eventhandler
 	 */
-
 	public void onEvent(Event ev){
 		if (ev instanceof MenuEvent) { 
-			if (ev.type == MenuEvent.SELECTED ) {
-				MenuItem action = (MenuItem) mnuContextFormt.getSelectedItem(); 
-				if (action != null) {
-					if (action == miDD) {
-						mnuContextFormt.close();
-						currFormat = CWPoint.DD;
-						}
-					if (action == miDMM) {
-						mnuContextFormt.close();
-						currFormat = CWPoint.DMM;
-					}
-					if (action == miDMS) {
-						mnuContextFormt.close();
-						currFormat = CWPoint.DMS;
-					}
-					if (action == miUTM) {
-						mnuContextFormt.close();
-						currFormat = CWPoint.UTM;
-					}
-					if (action == miGK) {
-						mnuContextFormt.close();
-						currFormat = CWPoint.GK;
-					}
-					miDD.modifiers &amp;= ~MenuItem.Checked;
-					miDMM.modifiers &amp;= ~MenuItem.Checked;
-					miDMS.modifiers &amp;= ~MenuItem.Checked;
-					miUTM.modifiers &amp;= ~MenuItem.Checked;
-					miGK.modifiers &amp;= ~MenuItem.Checked;
-					switch (currFormat) {
-					case CWPoint.DD: miDD.modifiers |= MenuItem.Checked; break;   
-					case CWPoint.DMM: miDMM.modifiers |= MenuItem.Checked; break;   
-					case CWPoint.DMS: miDMS.modifiers |= MenuItem.Checked; break;   
-					case CWPoint.UTM: miUTM.modifiers |= MenuItem.Checked; break;
-					case CWPoint.GK: miGK.modifiers |= MenuItem.Checked; break;
-					}
-
-					lblPosition.setText(myNavigation.gpsPos.toString(currFormat));
+			if (ev.type == MenuEvent.SELECTED) {
+				if (((MenuEvent)ev).menu == mnuContextFormt) {
+					mnuContextFormt.close();
+					mnuContextFormt.getItemAt(currFormatSel).modifiers &amp;= ~MenuItem.Checked;
+					currFormatSel = mnuContextFormt.getInt();
+					mnuContextFormt.getItemAt(currFormatSel).modifiers |= MenuItem.Checked;
+					lblPosition.setText(myNavigation.gpsPos.toString(CoordsScreen.getLocalSystem(currFormatSel)));
 					btnGoto.setText(getGotoBtnText());
 				} // end lat-lon-format context menu
-				action = (MenuItem) mnuContextRose.getSelectedItem();
-				if (action != null) {
-					for (int i=0; i&lt;miLuminary.length; i++) {
-						if (action == miLuminary[i]) {
-							myNavigation.setLuminary(i);
-							miLuminary[i].modifiers |= MenuItem.Checked;
-							compassRose.setLuminaryName(SkyOrientation.getLuminaryName(myNavigation.luminary));
-						} else miLuminary[i].modifiers &amp;= ~MenuItem.Checked;
-					}
-					if (action == miNorthCentered) {
-						if (compassRose.isNorthCentered()) {
-							compassRose.setNorthCentered(false);
-							miNorthCentered.modifiers &amp;= ~MenuItem.Checked;							
+				if (((MenuEvent)ev).menu == mnuContextRose) {
+					MenuItem action = (MenuItem) mnuContextRose.getSelectedItem();
+					if (action != null) {
+						for (int i=0; i&lt;miLuminary.length; i++) {
+							if (action == miLuminary[i]) {
+								myNavigation.setLuminary(i);
+								miLuminary[i].modifiers |= MenuItem.Checked;
+								compassRose.setLuminaryName(SkyOrientation.getLuminaryName(myNavigation.luminary));
+							} else miLuminary[i].modifiers &amp;= ~MenuItem.Checked;
 						}
-						else
-						{
-							compassRose.setNorthCentered(true);
-							miNorthCentered.modifiers |= MenuItem.Checked;
+						if (action == miNorthCentered) {
+							if (compassRose.isNorthCentered()) {
+								compassRose.setNorthCentered(false);
+								miNorthCentered.modifiers &amp;= ~MenuItem.Checked;							
+							}
+							else
+							{
+								compassRose.setNorthCentered(true);
+								miNorthCentered.modifiers |= MenuItem.Checked;
+							}
 						}
 					}
 				}
@@ -398,10 +366,10 @@
 			// set current position as centre and recalculate distance of caches in MainTab 
 			if (ev.target == btnCenter){
 				if (myNavigation.gpsPos.isValid()) {
-				Vm.showWait(true);
-				pref.curCentrePt.set(myNavigation.gpsPos);
-				mainT.updateBearDist();
-				Vm.showWait(false);
+					Vm.showWait(true);
+					pref.curCentrePt.set(myNavigation.gpsPos);
+					mainT.updateBearDist();
+					Vm.showWait(false);
 				} else (new MessageBox(MyLocale.getMsg(312, &quot;Error&quot;), MyLocale.getMsg(1514, &quot;Cannot recalculate distances, because the GPS position is not set&quot;), FormBase.OKB)).execute();
 			}
 			//Start moving map
@@ -419,8 +387,8 @@
 			// change destination waypoint
 			if (ev.target == btnGoto){
 				CoordsScreen cs = new CoordsScreen();
-				if (myNavigation.destination.isValid())	cs.setFields(myNavigation.destination, currFormat);
-				else cs.setFields(new CWPoint(0,0), currFormat);
+				if (myNavigation.destination.isValid())	cs.setFields(myNavigation.destination, CoordsScreen.getLocalSystem(currFormatSel));
+				else cs.setFields(new CWPoint(0,0), CoordsScreen.getLocalSystem(currFormatSel));
 				if (cs.execute(null, CellConstants.TOP) == FormBase.IDOK)
 					setDestination(cs.getCoords());
 			}
@@ -437,23 +405,23 @@
 	float sunDir = -361;
 	float moveDir = -361;
 	float distance = -1;
-	
+
 	int m_fix = -1;
 	int m_sats = -1;
 	int m_satsInView = 0;
 	double m_hdop = -1;
 	float m_speed = -1;
-	
+
 	String m_Luminary = MyLocale.getMsg(6100, &quot;Sun&quot;);
-	
+
 	Font mainFont;
 	FontMetrics fm;
 	int lineHeight;
-	
+
 	int roseRadius;
-	
+
 	boolean northCentered = Global.getPref().northCenteredGoto;
-	
+
 	final static Color RED = new Color(255,0,0);
 	final static Color YELLOW = new Color(255,255,0);
 	final static Color GREEN = new Color(0,255,0);
@@ -471,23 +439,23 @@
 	public GotoRose(String fn){
 		super(fn);
 	}
-	
+
 	public GotoRose(){
 		super();
 	}
-	
+
 	public void setWaypointDirectionDist(float wd, float dist) {
 		gotoDir = wd;
 		distance = dist;
 	}
-	
+
 	public void setSunMoveDirections(float sd, float md, float speed ) {
 		sunDir = sd;
 		moveDir = md;
 		m_speed = speed;
 		refresh();
 	}
-	
+
 	public void setGpsStatus(int fix, int sats, int satsInView, double hdop) {
 		m_fix = fix;
 		m_sats = sats;
@@ -495,20 +463,20 @@
 		m_hdop = hdop;
 		refresh();
 	}
-	
+
 	public void setLuminaryName(String Luminary) {
 		m_Luminary = Luminary;
 		refresh();
 	}
 
-	
+
 	/**
 	 * draw arrows for the directions of movement and destination waypoint
 	 * @param ctrl the control to paint on
 	 * @param moveDir degrees of movement
 	 * @param destDir degrees of destination waypoint
 	 */
-	
+
 	public void doDraw(Graphics g,int options) {
 		g.setColor(Color.White);
 		g.fillRect(0, 0, location.width, location.height);
@@ -531,23 +499,23 @@
 			g.setPen(new Pen(new Color(150,150,150),Pen.SOLID,3));
 			g.drawEllipse(location.width/2 - radius, location.height/2 - radius, 2 * radius, 2 * radius );
 		}
-		
+
 		drawArrows(g);
 		drawWayPointData(g);
 		drawGpsData(g);
 		drawLuminaryData(g);
 		drawGpsStatus(g);
 	}
-		
+
 	private void drawWayPointData(Graphics g){
 		String strTemp = MyLocale.getMsg(1512, &quot;Waypoint&quot;);
 		g.setColor(Color.DarkBlue);
 		g.fillRect(0, 0, fm.getTextWidth(strTemp) + 4, lineHeight);
 		g.setColor(Color.White);		
 		g.drawText(strTemp, 2, 0);
-		
+
 		g.setColor(Color.Black);		
-		
+
 		int metricSystem = Global.getPref().metricSystem;
 		Double tmp = new Double();
 		strTemp = &quot;&quot;;
@@ -579,19 +547,19 @@
 		}
 		else strTemp = &quot;--- &quot;+Metrics.getUnit(bigUnit);
 		g.drawText(strTemp, 2, lineHeight);
-		
+
 		tmp.set(gotoDir);
 		if ((tmp.value &lt;= 360) &amp;&amp; (tmp.value &gt;= -360))
 			strTemp = tmp.toString(0,0,0) + &quot; &quot; + MyLocale.getMsg(1502,&quot;deg&quot;);
 		else strTemp = &quot;---&quot; + &quot; &quot; + MyLocale.getMsg(1502,&quot;deg&quot;);
 		g.drawText(strTemp, 2, 2*lineHeight);
 	}
-	
+
 	private void drawGpsData(Graphics g){
 		g.setColor(RED);
-		
+
 		String strHeadline = MyLocale.getMsg(1501,&quot;Current&quot;);
-		
+
 		Double tmp = new Double();
 
 		String strSpeed = null;
@@ -615,7 +583,7 @@
 				strSpeed = MyLocale.formatDouble(tmp,&quot;0.0&quot;) + unit;
 			}
 		}
-		
+
 		tmp.set(moveDir);
 		String strMoveDir = &quot;---&quot; + &quot; &quot; + MyLocale.getMsg(1502,&quot;deg&quot;);
 		if ((tmp.value &lt;= 360) &amp;&amp; (tmp.value &gt;= -360))
@@ -623,16 +591,16 @@
 
 		int textWidth = java.lang.Math.max(fm.getTextWidth(strSpeed), fm.getTextWidth(strMoveDir));
 		textWidth = java.lang.Math.max(textWidth, fm.getTextWidth(strHeadline));
-		
+
 		int startX = location.width - (textWidth + 4);
 		g.fillRect(startX, 0, location.width - startX, lineHeight);
-		
+
 		g.setColor(Color.Black);		
 		g.drawText(strHeadline, startX + 2, 0);		
 		g.drawText(strSpeed, startX + 2, lineHeight);
 		g.drawText(strMoveDir, startX + 2, 2*lineHeight);
 	}
-	
+
 	private void drawLuminaryData(Graphics g){
 		g.setColor(YELLOW);
 
@@ -651,20 +619,20 @@
 		g.drawText(m_Luminary, 2, startY);
 		g.drawText(strSunDir, 2, startY + lineHeight);
 	}
-	
+
 	private void drawGpsStatus(Graphics g){
 		if ((m_fix &gt; 0) &amp;&amp; (m_sats &gt;= 0)) {
 			// Set background to signal quality
 			g.setColor(GREEN);
 		}
 		else
-		// receiving data, but signal ist not good
-		if ((m_fix == 0) &amp;&amp; (m_sats &gt;= 0)) {
-			g.setColor(YELLOW);
-		}
-		else {
-			g.setColor(RED);
-		}
+			// receiving data, but signal ist not good
+			if ((m_fix == 0) &amp;&amp; (m_sats &gt;= 0)) {
+				g.setColor(YELLOW);
+			}
+			else {
+				g.setColor(RED);
+			}
 
 		String strSats = &quot;Sats: -&quot;;
 		if (m_sats &gt;= 0) {
@@ -688,7 +656,7 @@
 		{
 			// select moveDirColor according to difference to gotoDir
 			Color moveDirColor = RED;
-			
+
 			if (gotoDir &lt; 360 &amp;&amp; gotoDir &gt; -360 &amp;&amp; moveDir &lt; 360 &amp;&amp; moveDir &gt; -360)
 			{
 				float diff = java.lang.Math.abs(moveDir - gotoDir);
@@ -700,7 +668,7 @@
 				{
 					diff = 360.0f - diff;
 				}
-				
+
 				if (diff &lt;= 12.25f)
 				{
 					moveDirColor = GREEN;
@@ -731,11 +699,11 @@
 					//drawDoubleArrow(g, 360 - moveDir, BLUE, new Color(175,0,0), 1.0f);
 					//drawRose(g, 360 - moveDir, new Color(100,100,100), new Color(200,200,200), 1.0f);
 					drawFullRose(g, 360 - moveDir, new Color(255,255,255), new Color(200,200,200), new Color(150,150,150), new Color(200,200,200), new Color(200,200,200), new Color(75,75,75), 1.0f, false, false);
-					
+
 					int radius = (int)(roseRadius * 0.75f);
 					g.setPen(new Pen(RED,Pen.SOLID,3));
 					g.drawLine(location.width/2, location.height/2 - radius, location.width/2, location.height/2 + radius);
-					
+
 					if (gotoDir &lt; 360 &amp;&amp; gotoDir &gt; -360) drawThinArrow(g, gotoDir - moveDir, Color.DarkBlue, moveDirColor, 1.0f);
 					if (sunDir &lt; 360 &amp;&amp; sunDir &gt; -360) drawSunArrow(g, sunDir - moveDir, YELLOW, 0.75f);					
 				}				
@@ -765,23 +733,23 @@
 		pointsY[2] = centerY - new Float(halfArrowWidth * java.lang.Math.cos(angleRad + java.lang.Math.PI)).intValue();
 		pointsX[3] = centerX + new Float(halfArrowWidth * java.lang.Math.sin(angleRad - java.lang.Math.PI / 2.0)).intValue();
 		pointsY[3] = centerY - new Float(halfArrowWidth * java.lang.Math.cos(angleRad - java.lang.Math.PI / 2.0)).intValue();
-		
-//		g.setPen(new Pen(col,Pen.SOLID,3));
-//		g.drawLine(centerX,centerY,pointX,pointY);
-		
+
+		//		g.setPen(new Pen(col,Pen.SOLID,3));
+		//		g.drawLine(centerX,centerY,pointX,pointY);
+
 		g.setPen(new Pen(Color.Black,Pen.SOLID,1));
 		g.setBrush(new Brush(col, Brush.SOLID));
 		g.fillPolygon(pointsX, pointsY, 4);
 		g.fillEllipse(circleX - circleRadius, circleY - circleRadius, 2 * circleRadius, 2 * circleRadius);
 	}
-	
+
 	private void drawThinArrow(Graphics g, float angle, Color col, Color colPoint, float scale) {
 		float angleRad = (angle) * (float)java.lang.Math.PI / 180;
 		int centerX = location.width/2, centerY = location.height/2;
 		float arrowLength = roseRadius * scale;
 		float halfOpeningAngle = (float)(java.lang.Math.PI * 0.03);
 		float sideLineLength = arrowLength * 0.75f;
-		
+
 		int[] pointsX = new int[4];
 		int[] pointsY = new int[4];
 
@@ -793,7 +761,7 @@
 		pointsY[2] = centerY - new Float(sideLineLength * java.lang.Math.cos(angleRad + halfOpeningAngle)).intValue();
 		pointsX[3] = centerX;
 		pointsY[3] = centerY;
-		
+
 		g.setPen(new Pen(Color.Black,Pen.SOLID,1));
 		g.setBrush(new Brush(col, Brush.SOLID));
 		g.fillPolygon(pointsX, pointsY, 4);
@@ -802,7 +770,7 @@
 			g.fillPolygon(pointsX, pointsY, 3);			
 		}
 	}
-	
+
 	private void drawFullRose(Graphics g, float angle, Color colLeft, Color colRight, Color colNorthLeft, Color colNorthRight,
 			Color colBorder, Color colText, float scale, boolean bDrawText, boolean bDrawEightArrows) {
 		float subScale1 = 1.0f;
@@ -821,15 +789,15 @@
 		drawRosePart(g, 180 + angle, colLeft, colRight, colBorder, colText, scale * subScale1, innerScale, &quot;S&quot;, bDrawText);
 		drawRosePart(g, 270 + angle, colLeft, colRight, colBorder, colText, scale * subScale1, innerScale, &quot;W&quot;, bDrawText);
 	}
-	
+
 	private void drawRosePart(Graphics g, float angle, Color colLeft, Color colRight, Color colBorder, Color colText, float scale, float innerScale, String strDir, boolean bDrawText) {
 		float angleRad = angle * (float)java.lang.Math.PI / 180;
 		float angleRadText = (angle + 7.5f) * (float)java.lang.Math.PI / 180;
 		int centerX = location.width/2, centerY = location.height/2;
-				
+
 		float arrowLength = roseRadius * scale;
 		float halfArrowWidth = arrowLength * innerScale;
-		
+
 		int[] pointsX = new int[3];
 		int[] pointsY = new int[3];
 
@@ -839,17 +807,17 @@
 		pointsY[1] = centerY - new Float(arrowLength * java.lang.Math.cos(angleRad)).intValue();
 		pointsX[2] = centerX + new Float(halfArrowWidth * java.lang.Math.sin(angleRad - java.lang.Math.PI / 4.0)).intValue();
 		pointsY[2] = centerY - new Float(halfArrowWidth * java.lang.Math.cos(angleRad - java.lang.Math.PI / 4.0)).intValue();
-				
+
 		g.setPen(new Pen(colBorder,Pen.SOLID,1));
 		g.setBrush(new Brush(colLeft, Brush.SOLID));
 		g.fillPolygon(pointsX, pointsY, 3);
 
 		pointsX[2] = centerX + new Float(halfArrowWidth * java.lang.Math.sin(angleRad + java.lang.Math.PI / 4.0)).intValue();
 		pointsY[2] = centerY - new Float(halfArrowWidth * java.lang.Math.cos(angleRad + java.lang.Math.PI / 4.0)).intValue();
-		
+
 		g.setBrush(new Brush(colRight, Brush.SOLID));
 		g.fillPolygon(pointsX, pointsY, 3);
-					
+
 		if (bDrawText){
 			int tempFontSize = new Float(scale * mainFont.getSize()).intValue();
 			Font tempFont = new Font(mainFont.getName(), Font.BOLD, tempFontSize);
@@ -862,18 +830,18 @@
 			float stringPosition = arrowLength - stringGap / 2.0f;
 			g.setColor(colText);
 			g.drawText(strDir, centerX + new Float(stringPosition * java.lang.Math.sin(angleRadText) - stringWidth / 2.0f).intValue(),
-					           centerY - new Float(stringPosition * java.lang.Math.cos(angleRadText) + stringHeight / 2.0f).intValue());
-			
+					centerY - new Float(stringPosition * java.lang.Math.cos(angleRadText) + stringHeight / 2.0f).intValue());
+
 			g.setFont(mainFont);
 		}
 	}
-	
+
 	private void drawThickArrow(Graphics g, float angle, Color col, float scale) {
 		float angleRad = (angle) * (float)java.lang.Math.PI / 180;
 		int centerX = location.width/2, centerY = location.height/2;
 		float arrowLength = roseRadius * scale;
 		float halfArrowWidth = arrowLength * 0.1f;
-		
+
 		int[] pointsX = new int[4];
 		int[] pointsY = new int[4];
 
@@ -885,12 +853,12 @@
 		pointsY[2] = centerY - new Float(halfArrowWidth * java.lang.Math.cos(angleRad + java.lang.Math.PI)).intValue();
 		pointsX[3] = centerX + new Float(halfArrowWidth * java.lang.Math.sin(angleRad - java.lang.Math.PI / 2.0)).intValue();
 		pointsY[3] = centerY - new Float(halfArrowWidth * java.lang.Math.cos(angleRad - java.lang.Math.PI / 2.0)).intValue();
-		
+
 		g.setPen(new Pen(Color.Black,Pen.SOLID,1));
 		g.setBrush(new Brush(col, Brush.SOLID));
 		g.fillPolygon(pointsX, pointsY, 4);
 	}
-	
+
 	public void setNorthCentered(boolean nc) {
 		northCentered = nc;
 		if (northCentered != Global.getPref().northCenteredGoto) {
@@ -899,7 +867,7 @@
 		}
 		refresh();
 	}
-	
+
 	public boolean isNorthCentered() {
 		return northCentered;
 	}

Modified: trunk/src/CacheWolf/navi/LambertProjection.java
===================================================================
--- trunk/src/CacheWolf/navi/LambertProjection.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/LambertProjection.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -1,8 +1,8 @@
 package CacheWolf.navi;
 
 import CacheWolf.CWPoint;
-public class LambertProjection extends Projection{
-	
+public final class LambertProjection extends Projection{
+
 	double falseNorthing;
 	double falseEasting;
 	//double firstStandardParallel;
@@ -10,9 +10,9 @@
 	double centralLat;
 	double centralLon;
 	Ellipsoid ellip;
-	
+
 	double e, n, F0, Rb;
-	
+
 	/**
 	 * 
 	 * @param falseNorthing: in meters
@@ -23,29 +23,32 @@
 	 * @param centralLon
 	 */
 	public LambertProjection(int epsgcode_, double falseNorthing_, double falseEasting_, 
-			double firstStandardParallel_, double secondSandardParallel_,	
+			double firstStandardParallel_, double secondSandardParallel_, double scale_,
 			double centralLat_,	double centralLon_, Ellipsoid ellip_) {
 		epsgCode = epsgcode_;
-		falseNorthing = falseEasting_;
+		falseNorthing = falseNorthing_;
 		falseEasting = falseEasting_;
 		double firstStandardParallel = firstStandardParallel_ * java.lang.Math.PI / 180;
 		double secondSandardParallel = secondSandardParallel_* java.lang.Math.PI / 180;
 		centralLat = centralLat_ * java.lang.Math.PI / 180;
 		centralLon = centralLon_ * java.lang.Math.PI / 180;
 		ellip = ellip_;
-		
 
+
 		double f = ellip.getFlattening();
 		e = java.lang.Math.sqrt(2.0 * f - f*f);
 		double m1 = java.lang.Math.cos(firstStandardParallel) / java.lang.Math.sqrt(1.0 - e*e * java.lang.Math.pow(java.lang.Math.sin(firstStandardParallel),2));
 		double m2 = java.lang.Math.cos(secondSandardParallel) / java.lang.Math.sqrt(1.0 - e*e * java.lang.Math.pow(java.lang.Math.sin(secondSandardParallel),2));
-		double t0 = java.lang.Math.tan(java.lang.Math.PI/4 - centralLat / 2) / java.lang.Math.pow((1.0 - (e * java.lang.Math.sin(centralLat))) / (1.0 + (e * java.lang.Math.sin(centralLat))), e/2);
-		double t1 = java.lang.Math.tan(java.lang.Math.PI/4 - firstStandardParallel/ 2) / java.lang.Math.pow((1.0 - (e * java.lang.Math.sin(firstStandardParallel ))) / (1.0 + (e * java.lang.Math.sin(firstStandardParallel ))), e/2);
-		double t2 = java.lang.Math.tan(java.lang.Math.PI/4 - secondSandardParallel/ 2) / java.lang.Math.pow((1.0 - (e * java.lang.Math.sin(secondSandardParallel))) / (1.0 + (e * java.lang.Math.sin(secondSandardParallel))), e/2);
-		n = (java.lang.Math.log(m1) - java.lang.Math.log(m2)) / (java.lang.Math.log(t1) - java.lang.Math.log(t2));
+		double t0 = java.lang.Math.tan(java.lang.Math.PI/4 - centralLat           / 2) / java.lang.Math.pow((1.0 - (e * java.lang.Math.sin(centralLat           ))) / (1.0 + (e * java.lang.Math.sin(centralLat           ))), e/2);
+		double t1 = java.lang.Math.tan(java.lang.Math.PI/4 - firstStandardParallel/ 2) / java.lang.Math.pow((1.0 - (e * java.lang.Math.sin(firstStandardParallel))) / (1.0 + (e * java.lang.Math.sin(firstStandardParallel))), e/2);
+		if (firstStandardParallel == secondSandardParallel) n = java.lang.Math.sin(centralLat); // one standard parallel
+		else {
+			double t2 = java.lang.Math.tan(java.lang.Math.PI/4 - secondSandardParallel/ 2) / java.lang.Math.pow((1.0 - (e * java.lang.Math.sin(secondSandardParallel))) / (1.0 + (e * java.lang.Math.sin(secondSandardParallel))), e/2);
+			n = (java.lang.Math.log(m1) - java.lang.Math.log(m2)) / (java.lang.Math.log(t1) - java.lang.Math.log(t2));
+		}
 		// double nsin = java.lang.Math.sin(centralLat); // nsin and n should be equal
 		// Vm.debug(&quot;n-log: &quot; + n+ &quot; n-sin phi: &quot; + nsin);
-		F0 = m1 / (n * java.lang.Math.pow(t1, n)); // pow(t2???, n)
+		F0 = m1 / (n * java.lang.Math.pow(t1, n)) * scale_; // pow(t2???, n)
 		Rb = ellip.a * F0 * java.lang.Math.pow(t0, n);
 	}
 
@@ -60,7 +63,7 @@
 	 */
 	public ProjectedPoint project(CWPoint ll, ProjectedPoint pp) {
 		// formulas taken from <A HREF="http://surveying.wb.psu.edu/psu-surv/Projects/PASingleZone.pdf">http://surveying.wb.psu.edu/psu-surv/Projects/PASingleZone.pdf</A> page 7-9 (Appendix I), see also <A HREF="http://www.geoclub.de/viewtopic.php?f=54&amp;t=23912">http://www.geoclub.de/viewtopic.php?f=54&amp;t=23912</A> (German)
-		
+
 		double lat = ll.latDec * java.lang.Math.PI / 180;
 		double lon = ll.lonDec * java.lang.Math.PI / 180;
 		double t = java.lang.Math.tan(java.lang.Math.PI /4 - lat / 2) / java.lang.Math.pow((1.0 - (e * java.lang.Math.sin(lat))) / (1.0 + (e * java.lang.Math.sin(lat))), e/2);
@@ -80,10 +83,10 @@
 
 	public CWPoint unproject(ProjectedPoint pp) {
 		//Vm.debug(&quot;unproject: &quot;+pp.toString(0, &quot;&quot;, &quot; &quot;, AUSTRIAN_LAMBERT));
-		
+
 		double ns = Rb - pp.northing;
 		double es = pp.easting;
-		double R = java.lang.Math.sqrt(es*es + ns*ns);
+		double R = java.lang.Math.sqrt(es*es + ns*ns) * java.lang.Math.abs(n)/n;
 		double t = java.lang.Math.pow(R/(ellip.a*F0), 1/n);
 		double gamma = java.lang.Math.atan2(es, ns); // TODO unsure, whether always the correct sign is produced
 		double lambda = centralLon + gamma/n;
@@ -91,23 +94,23 @@
 		double phi1;
 		boolean iterate;
 		do {
-		  phi1 = java.lang.Math.PI / 2 - 2* java.lang.Math.atan(t*java.lang.Math.pow((1-e*java.lang.Math.sin(phi0))/(1+e*java.lang.Math.sin(phi0)),e/2));
-		  iterate = (java.lang.Math.abs(phi1 - phi0) &gt; 0.000001);
-		  phi0 = phi1;
+			phi1 = java.lang.Math.PI / 2 - 2* java.lang.Math.atan(t*java.lang.Math.pow((1-e*java.lang.Math.sin(phi0))/(1+e*java.lang.Math.sin(phi0)),e/2));
+			iterate = (java.lang.Math.abs(phi1 - phi0) &gt; 0.000001);
+			phi0 = phi1;
 		} while (iterate);
-		
+
 		CWPoint ret = new CWPoint(phi1 * 180 / java.lang.Math.PI, lambda * 180 / java.lang.Math.PI);
 		//Vm.debug(&quot;unproject: ret: &quot; + ret.toString(CWPoint.DD));
 		return ret;
 	}
-	
+
 	public double getNorthing(ProjectedPoint pp) {
 		return pp.northing + falseNorthing;
 	}
 	public double getEasting(ProjectedPoint pp) {
 		return pp.easting + falseEasting;
 	}
-	
+
 	public ProjectedPoint set(double northing_, double easting_, ProjectedPoint pp) {
 		if (pp == null) {pp = new ProjectedPoint(); pp.projection = this; }
 		pp.setRaw(northing_ - falseNorthing, easting_ - falseEasting);

Modified: trunk/src/CacheWolf/navi/MapImporter.java
===================================================================
--- trunk/src/CacheWolf/navi/MapImporter.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/MapImporter.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -51,7 +51,7 @@
 	public void updatePosition(int px, int py){
 		if(GCPs.size()&gt;=3  || (wfl.topleft.isValid())){
 			CWPoint p = wfl.calcLatLon(px,py);
-			infLabel.setText(&quot;--&gt; &quot; + p.getLatDeg(CWPoint.DMS) + &quot; &quot; +p.getLatMin(CWPoint.DMM) + &quot; / &quot; + p.getLonDeg(CWPoint.DMS) + &quot; &quot; + p.getLonMin(CWPoint.DMM));
+			infLabel.setText(&quot;--&gt; &quot; + p.getLatDeg(TransformCoordinates.DMS) + &quot; &quot; +p.getLatMin(TransformCoordinates.DMM) + &quot; / &quot; + p.getLonDeg(TransformCoordinates.DMS) + &quot; &quot; + p.getLonMin(TransformCoordinates.DMM));
 		}
 	}
 

Modified: trunk/src/CacheWolf/navi/MapInfoObject.java
===================================================================
--- trunk/src/CacheWolf/navi/MapInfoObject.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/MapInfoObject.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -433,8 +433,8 @@
 		public GCPoint(double lat, double lon){
 			this.latDec = lat;
 			this.lonDec = lon;
-			this.utmValid = false;
 		}
+		
 		public GCPoint(CWPoint ll, Point px) {
 			super(ll);
 			bitMapX = px.x;

Modified: trunk/src/CacheWolf/navi/MapLoader.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoader.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/MapLoader.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -222,7 +222,7 @@
 
 	public String createFilename(CWPoint center, float scale) {
 		String filename = Common.ClearForFileName(currentOnlineMapService.getNameForFileSystem()+&quot;_s&quot;+Common.DoubleToString(scale, 1)
-				+ &quot;_c&quot; + center.toString(CWPoint.LAT_LON).replace(',', '-'));
+				+ &quot;_c&quot; + center.toString(TransformCoordinates.LAT_LON).replace(',', '-'));
 		return filename;
 	}
 
@@ -557,13 +557,13 @@
 			bbox += TransformCoordinates.wgs84ToEpsg(buttomleft, coordinateReferenceSystem[crs]).toString(2, &quot;&quot;, &quot;,&quot;);
 			bbox += &quot;,&quot; + TransformCoordinates.wgs84ToEpsg(topright, coordinateReferenceSystem[crs]).toString(2, &quot;&quot;, &quot;,&quot;);
 		} else if (coordinateReferenceSystem[0] == TransformCoordinates.EPSG_WGS84) 
-			bbox += buttomleft.toString(CWPoint.LON_LAT)  + &quot;,&quot; + topright.toString(CWPoint.LON_LAT);
+			bbox += buttomleft.toString(TransformCoordinates.LON_LAT)  + &quot;,&quot; + topright.toString(TransformCoordinates.LON_LAT);
 		else throw new IllegalArgumentException(MyLocale.getMsg(4828, &quot;Coordinate system not supported by cachewolf:&quot;)+&quot; &quot; + coordinateReferenceSystem.toString());
 		String ret = MainUrl + &quot;SERVICE=WMS&quot; + &quot;&amp;&quot;+ versionUrlPart + &quot;&amp;&quot; + requestUrlPart + &quot;&amp;&quot; + 
 		coordinateReferenceSystemUrlPart[crs] + &quot;&amp;&quot; + bbox + 
 		&quot;&amp;WIDTH=&quot; + pixelsize.x + &quot;&amp;HEIGHT=&quot; + pixelsize.y + &quot;&amp;&quot; + 
 		layersUrlPart + &quot;&amp;&quot; + stylesUrlPart + &quot;&amp;&quot; + imageFormatUrlPart;
-		Global.getPref().log(ret + &quot; WGS84: Buttom left: &quot; + buttomleft.toString(CWPoint.DD) + &quot;top right: &quot; + topright.toString(CWPoint.DD));
+		Global.getPref().log(ret + &quot; WGS84: Buttom left: &quot; + buttomleft.toString(TransformCoordinates.DD) + &quot;top right: &quot; + topright.toString(TransformCoordinates.DD));
 		return ret;
 	}
 
@@ -691,7 +691,7 @@
 		if (     (center.lonDec &lt;= -30   &amp;&amp; center.lonDec &gt;= -170) || 
 				( center.lonDec &gt; 360-30 &amp;&amp; center.lonDec &lt;= 360-170) ) zone = &quot;USA0409&quot;; // TODO test which zone-code ist best for asia
 		else zone = &quot;EUR0809&quot;;
-		String quelle = MainUrl + &quot;&amp;CenP=&quot; + center.toString(CWPoint.LAT_LON);
+		String quelle = MainUrl + &quot;&amp;CenP=&quot; + center.toString(TransformCoordinates.LAT_LON);
 		quelle = quelle + &quot;&amp;Alti=&quot;+Convert.toString(zoomlevel)+&quot;&amp;Lang=&quot;+zone+&quot;&amp;Size=&quot;+Convert.toString(pixelsize.x)+&quot;,&quot;+Convert.toString(pixelsize.y)+&quot;&amp;Offs=0,0&amp;MapS=0&quot;; //&amp;Pins=|&quot; + latD.toString().replace(',', '.') + &quot;,&quot; + lonD.toString().replace(',', '.') + &quot;|5|&quot;;
 		return quelle;
 	}

Modified: trunk/src/CacheWolf/navi/MapLoaderGui.java
===================================================================
--- trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/MapLoaderGui.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -344,7 +344,7 @@
 			}
 			if (ev.target == coosBtn) {
 				CoordsScreen cs = new CoordsScreen();
-				cs.setFields(center, CWPoint.CW);
+				cs.setFields(center, TransformCoordinates.CW);
 				if (cs.execute() != FormBase.IDCANCEL) {
 					center = cs.getCoords();
 					coosBtn.setText(center.toString());

Modified: trunk/src/CacheWolf/navi/ProjectedPoint.java
===================================================================
--- trunk/src/CacheWolf/navi/ProjectedPoint.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/ProjectedPoint.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -2,21 +2,15 @@
 
 import CacheWolf.CWPoint;
 
-public class ProjectedPoint {
-	public final static int GK = 1;
-	public final static int LAMBERT = 2;
+public final class ProjectedPoint {
 
-	public static final int LOCALSYSTEM_GERMAN_GK            = 4900;
-	public static final int LOCALSYSTEM_ITALIAN_GB           = 3900; 
-	public static final int LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD = 4300;
-	public static final int LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW = 4301;
-	public static final int LOCALSYSTEMFRANCE_LAMBERT_I2IV   = 3300; // France not yet implemented
-	public static final int LOCALSYSTEM_DEFAULT = LOCALSYSTEM_GERMAN_GK;
-
-	public static final LambertProjection PJ_AUSTRIAN_LAMBERT_OLD = new LambertProjection(TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_OLD, 400000, 400000, 49.0, 46.0, 47.5, 13.333333, TransformCoordinates.BESSEL); 
-	public static final LambertProjection PJ_AUSTRIAN_LAMBERT_NEW = new LambertProjection(TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_OLD, 400000, 400000, 49.0, 46.0, 47.5, 13.333333, TransformCoordinates.WGS84);
-	public static final GkProjection PJ_GERMAN_GK  = new GkProjection(TransformCoordinates.EPSG_GK2 -2           , 0, 500000, 3, 1000000, 0, 1     , TransformCoordinates.BESSEL);
+	public static final LambertProjection PJ_AUSTRIAN_LAMBERT_OLD 	= new LambertProjection(TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_OLD,   400000, 400000, 49.0, 46.0, 1         , 47.5, 13.333333, TransformCoordinates.BESSEL); 
+	public static final LambertProjection PJ_AUSTRIAN_LAMBERT_NEW 	= new LambertProjection(TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_NEW,   400000, 400000, 49.0, 46.0, 1         , 47.5, 13.333333, TransformCoordinates.WGS84);
+	public static final LambertProjection PJ_FRENCH_LAMBERT_NTF_II 	= new LambertProjection(TransformCoordinates.EPSG_FRENCH_LAMBERT_NTF_II, 2200000, 600000, 46.8, 46.8, 0.99987742, 46.8, 2.337229172 /*(2+20/60+14.025/3600) */, TransformCoordinates.CLARKE1880IGN);
+	public static final LambertProjection PJ_TEST 	                = new LambertProjection(TransformCoordinates.EPSG_TEST,  150000, 250000, 18, 18, 1         , 18, -77, TransformCoordinates.CLARKE1866); 
+	public static final GkProjection PJ_GERMAN_GK  = new GkProjection(TransformCoordinates.EPSG_GERMAN_GK2 -2           , 0, 500000, 3, 1000000, 0, 1     , TransformCoordinates.BESSEL);
 	public static final GkProjection PJ_ITALIAN_GB = new GkProjection(TransformCoordinates.EPSG_ITALIAN_GB_EW1 -1, 0, 500000, 6, 1000000, 0, 0.9996, TransformCoordinates.HAYFORD1909);
+	public static final UTMProjection PJ_UTM_WGS84 = new UTMProjection(TransformCoordinates.WGS84);
 
 	protected double northing; // TODO make these private
 	protected double easting; // because it is not clear for routines from outside if the stripe number is included, make this available only through methods
@@ -53,13 +47,18 @@
 	 * if false p will be projected to epsg
 	 */
 	public ProjectedPoint(CWPoint p, int epsg_localsystem, boolean isProjected, boolean isLocalsystem) {
-		if (isProjected) set(p, epsg_localsystem, isLocalsystem); 
+		if (isProjected) set(p, null, epsg_localsystem, isLocalsystem); 
 		else {
 			projection = (isLocalsystem ? getProjectionFromLs(epsg_localsystem) : getProjection(epsg_localsystem) );
 			if (isLocalsystem)	projection.project(p, this);
 			else				projection.project(p, this, epsg_localsystem); // the epsg is requiered here because each zone has a different epsg, so the zone is already fixed
 		}
 	}
+	
+	public ProjectedPoint(CWPoint p, String zone, int epsg_localsystem, boolean isLocalsystem) {
+		set(p, zone, epsg_localsystem, isLocalsystem); 
+	}
+	
 
 
 
@@ -67,21 +66,24 @@
 		switch (epsg) {
 		case TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_OLD: return PJ_AUSTRIAN_LAMBERT_OLD;
 		case TransformCoordinates.EPSG_AUSTRIAN_LAMBERT_NEW: return PJ_AUSTRIAN_LAMBERT_NEW;
-		case TransformCoordinates.EPSG_GK2: 
-		case TransformCoordinates.EPSG_GK3: 
-		case TransformCoordinates.EPSG_GK4: return PJ_GERMAN_GK;
+		case TransformCoordinates.EPSG_GERMAN_GK2: 
+		case TransformCoordinates.EPSG_GERMAN_GK3: 
+		case TransformCoordinates.EPSG_GERMAN_GK4: return PJ_GERMAN_GK;
 		case TransformCoordinates.EPSG_ITALIAN_GB_EW1:
 		case TransformCoordinates.EPSG_ITALIAN_GB_EW2: return PJ_ITALIAN_GB;
+		case TransformCoordinates.EPSG_FRENCH_LAMBERT_NTF_II : return PJ_FRENCH_LAMBERT_NTF_II;
 		default: throw new IllegalArgumentException(&quot;ProjectedPoint.getProjection: epsg-code: &quot; + epsg + &quot;not supported&quot;);
 		}
 	}
 	
 	public static Projection getProjectionFromLs(int localsystem) {
 		switch (localsystem) {
-		case LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD:	return PJ_AUSTRIAN_LAMBERT_OLD;
-		case LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW:	return PJ_AUSTRIAN_LAMBERT_NEW;
-		case LOCALSYSTEM_GERMAN_GK:	          	return PJ_GERMAN_GK; 
-		case LOCALSYSTEM_ITALIAN_GB:			return PJ_ITALIAN_GB;	
+		case TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD:	return PJ_AUSTRIAN_LAMBERT_OLD;
+		case TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW:	return PJ_AUSTRIAN_LAMBERT_NEW;
+		case TransformCoordinates.LOCALSYSTEM_GERMAN_GK:	          	return PJ_GERMAN_GK; 
+		case TransformCoordinates.LOCALSYSTEM_ITALIAN_GB:			return PJ_ITALIAN_GB;
+		case TransformCoordinates.LOCALSYSTEM_FRANCE_LAMBERT_IIE:		return PJ_FRENCH_LAMBERT_NTF_II;
+		case TransformCoordinates.LOCALSYSTEM_UTM_WGS84:				return PJ_UTM_WGS84;
 		default: throw new IllegalArgumentException(&quot;ProjectedPoint(CWPoint, int): region &quot;+localsystem+&quot; not supported&quot;);
 		}
 	}
@@ -151,6 +153,11 @@
 		return zone;
 	}
 	
+	public String getZoneString() {
+		if (projection.zoneSeperately) return projection.getZone(this);
+		else return &quot;&quot;;
+	}
+	
 	public int getEpsgCode() {
 		return projection.getEpsgcode(this);
 	}
@@ -159,19 +166,31 @@
 	 * Set with local notation, incl. falsenorthing and -easting
 	 * @param northing_ 
 	 * @param easting_
+	 * @param zone only put something here if the zone is not included in easting or northing and must be known, otherwise zone should be null
 	 */
-	public void set(double northing_, double easting_) {
-		projection.set(northing_, easting_, this);
+	public void set(double northing_, double easting_, String zone) {
+		if (zone == null) projection.set(northing_, easting_, this);
+		else              projection.set(northing_, easting_, zone, this);
 	}
 
-	public void set(CWPoint projected, int epsg_localsystem, boolean isLocalsystem) {
+	/**
+	 * Set with local notation, incl. falsenorthing and -easting
+	 * @param northing_ 
+	 * @param easting_
+	 * @param zone only put something here if the zone is not included in easting or northing and must be known, otherwise zone should be null
+	 */
+	public void set(CWPoint projected, String zone, int epsg_localsystem, boolean isLocalsystem) {
 		projection = (isLocalsystem ? getProjectionFromLs(epsg_localsystem) : getProjection(epsg_localsystem) );
-		set(projected.latDec, projected.lonDec);
+		set(projected.latDec, projected.lonDec, zone);
 	}
 
 	public String toString() {
 		return toString(2, &quot;&quot;, &quot; &quot;);
 	}
+	
+	public String toHumanReadableString() {
+		return projection.toHumanReadableString(this);
+	}
 
 	public CWPoint unproject() {
 		return projection.unproject(this);
@@ -184,7 +203,8 @@
 		e.set(projection.getEasting(this));
 		n.decimalPlaces = decimalplaces;
 		e.decimalPlaces = decimalplaces;
-		return prefix + e.toString().replace(',', '.') + seperator + n.toString().replace(',', '.');
+		String z = (projection.zoneSeperately ? projection.getZone(this)+&quot; &quot; : &quot;&quot;);
+		return z + prefix + e.toString().replace(',', '.') + seperator + n.toString().replace(',', '.');
 	}
 
 	/**

Modified: trunk/src/CacheWolf/navi/Projection.java
===================================================================
--- trunk/src/CacheWolf/navi/Projection.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/Projection.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -10,6 +10,7 @@
 	 * corresponding epsg-codes (see method getEpsgcode)
 	 */
 	public int epsgCode;
+	public boolean zoneSeperately = false;
 
 	/**
 	 * The zone is automatically determined
@@ -40,4 +41,16 @@
 		return epsgCode + pp.zone;
 	}
 	public abstract ProjectedPoint set(double northing, double easting, ProjectedPoint pp);
+	public ProjectedPoint set(double northing, double easting, String zone, ProjectedPoint pp) {
+		throw new UnsupportedOperationException(&quot;Projection.set (double, double String, ProjectedPoint): This projection uses no seperate zones&quot;);
+	}
+	public String getZone(ProjectedPoint pp) {
+		throw new UnsupportedOperationException(&quot;Projection.getZone (double, double String, ProjectedPoint): This projection uses no seperate zones&quot;);
+		
+	}
+
+	public String toHumanReadableString(ProjectedPoint pp) {
+	 	return pp.toString(0, &quot;&quot;, &quot; &quot;);
+	}
+	
 }

Modified: trunk/src/CacheWolf/navi/TransformCoordinates.java
===================================================================
--- trunk/src/CacheWolf/navi/TransformCoordinates.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/TransformCoordinates.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -28,24 +28,78 @@
  */
 public final class TransformCoordinates {
 
-	public static final int EPSG_WGS84 = 4326; 
-	public static final int EPSG_ETRS89 = 25832; // TODO support it anyhow 
-	public static final int EPSG_GK2 = 31466; 
-	public static final int EPSG_GK3 = 31467; 
-	public static final int EPSG_GK4 = 31468; 
-	public static final int EPSG_GK5 = 31469;
+	public static final int EPSG_WGS84 					= 4326; 
+	public static final int EPSG_ETRS89 				= 25832; // TODO support it anyhow 
+	/** Gau&#223;-Kr&#252;ger, Bessel 1841, Potsdam (DHDN)  */
+	public static final int EPSG_GERMAN_GK2 			= 31466; 
+	public static final int EPSG_GERMAN_GK3 			= 31467; 
+	public static final int EPSG_GERMAN_GK4 			= 31468; 
+	public static final int EPSG_GERMAN_GK5 			= 31469;
 	/** Gau&#223;-Boaga, Monte Mario, Roma 1940, IT_ROMA1940 */
-	public static final int EPSG_ITALIAN_GB_EW1 = 3003; 
-	public static final int EPSG_ITALIAN_GB_EW2 = 3004;
+	public static final int EPSG_ITALIAN_GB_EW1 		= 3003; 
+	public static final int EPSG_ITALIAN_GB_EW2 		= 3004;
 	/** Austrian Lambert, Bessel 1841, Hermannskogel */
-	public static final int EPSG_AUSTRIAN_LAMBERT_OLD = 31287;
+	public static final int EPSG_AUSTRIAN_LAMBERT_OLD 	= 31287;
 	/** Austrian Lambert, ETRS89 */
-	public static final int EPSG_AUSTRIAN_LAMBERT_NEW = 3416;
+	public static final int EPSG_AUSTRIAN_LAMBERT_NEW 	= 3416;
+	/** French Lambert, Clarke 1880 IGN */
+	public static final int EPSG_FRENCH_LAMBERT_NTF_I 	= 27571;
+	public static final int EPSG_FRENCH_LAMBERT_NTF_II	= 27572;
+	public static final int EPSG_FRENCH_LAMBERT_NTF_III	= 27573;
+	public static final int EPSG_FRENCH_LAMBERT_NTF_IV 	= 27574;
+	public static final int EPSG_TEST				 	= -5;
+	
+	
+	public static final int LOCALSYSTEM_GERMAN_GK           	= 4900;
+	public static final int LOCALSYSTEM_ITALIAN_GB          	= 3900;
+	public static final int LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD	= 4300;
+	public static final int LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW	= 4301;
+	public static final int LOCALSYSTEM_FRANCE_LAMBERT_IIE  	= 3300;
+	public static final int LOCALSYSTEM_UTM_WGS84            	= 10000;
+	/** returned from some methods if not supported */
+	public static final int LOCALSYSTEM_NOT_SUPPORTED			= -1;
+	public static final int LOCALSYSTEM_DEFAULT = LOCALSYSTEM_GERMAN_GK;
+	public static final int DD      						 	= 10001; // these (10001+) may not conflict with LOCALSYSTEM_XXX,
+	public static final int DMM     							= 10002; // they are not used here, but in CWPoint
+	public static final int DMS     							= 10003;
+	public static final int LAT_LON 							= 10004;
+	public static final int LON_LAT 							= 10005;
+	/** it is a projected point or not WGS84 = none of the above */
+	public static final int CUSTOM  							= 10006;
+	/** define default */
+	public static final int CW      							= DMM;
+	/** only used as format to read */
+	public static final int REGEX   							= 10008;
+	public static final int UTM     							= LOCALSYSTEM_UTM_WGS84;
 
-	public static final Ellipsoid BESSEL      = new Ellipsoid(6377397.155, 6356078.962, true);
-	public static final Ellipsoid WGS84       = new Ellipsoid(6378137.000, 6356752.314, true);
-	public static final Ellipsoid HAYFORD1909 = new Ellipsoid(6378388    , 297        , false);
+	public static final Ellipsoid BESSEL      	= new Ellipsoid(6377397.155, 6356078.962, true);
+	public static final Ellipsoid WGS84       	= new Ellipsoid(6378137.000, 6356752.314, true);
+	public static final Ellipsoid HAYFORD1909 	= new Ellipsoid(6378388    , 297        , false);
+	public static final Ellipsoid CLARKE1880IGN = new Ellipsoid(6378249.2  , 293.4660213, false);
+	public static final Ellipsoid CLARKE1866    = new Ellipsoid(6378206.4  , 294.97870  , false);
 
+	public static final class LocalSystem {
+		public int code; 
+		public String friendlyShortname;
+		public String id;
+		public boolean zoneSeperatly;
+		public LocalSystem(int code_, String name_, String id_, boolean zoneSeperatly_) {
+			code = code_;
+			friendlyShortname = name_;
+			zoneSeperatly = zoneSeperatly_;
+			id = id_;
+		}
+	};
+
+	public static final LocalSystem[] localSystems = {
+		new LocalSystem(TransformCoordinates.LOCALSYSTEM_GERMAN_GK, 			&quot;de Gau&#223;-K.&quot;,  &quot;de.gk&quot;, ProjectedPoint.PJ_GERMAN_GK.zoneSeperately),
+		new LocalSystem(TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD,  &quot;at Lamb.&quot;,    &quot;at.lb&quot;, ProjectedPoint.PJ_AUSTRIAN_LAMBERT_OLD.zoneSeperately),
+		new LocalSystem(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB,            &quot;it Gau&#223;-B.&quot;,  &quot;it.gb&quot;, ProjectedPoint.PJ_ITALIAN_GB.zoneSeperately),
+		new LocalSystem(TransformCoordinates.LOCALSYSTEM_FRANCE_LAMBERT_IIE,    &quot;fr Lamb-IIe&quot;, &quot;fr.l2&quot;, ProjectedPoint.PJ_FRENCH_LAMBERT_NTF_II.zoneSeperately),
+		new LocalSystem(TransformCoordinates.LOCALSYSTEM_UTM_WGS84,             &quot;UTM&quot;,         &quot;utm&quot;,   ProjectedPoint.PJ_UTM_WGS84.zoneSeperately)
+	};
+	
+
 	//	 taken from <A HREF="http://www.crs-geo.eu/crseu/EN/Home/homepage__node.html?__nnn=true">http://www.crs-geo.eu/crseu/EN/Home/homepage__node.html?__nnn=true</A> click on &quot;national CRS&quot; -&gt; germany -&gt; DE_DHDN / GK_3 -&gt; DE_DHDN (North) to ETRS89
 	//	 they are the same as <A HREF="http://www.geoclub.de/files/GK_nach_GPS.xls">http://www.geoclub.de/files/GK_nach_GPS.xls</A> &quot;Parametersatz 4 = Deutschland Nord&quot; (rotation *-1)
 	/** use this for nord Germany, maximum deviation sub meter, valid in the former BRD (west germany) in 52&#176;20' N ... 55&#176;00' N */
@@ -59,7 +113,7 @@
 	/** use this for south Germany, maximum deviation sub meter, valid in the former BRD (west germany) in 47&#176;00' N ... 50&#176;20' N */
 	private static final TransformParameters GK_SOUTH_GERMANY_TO_WGS84 = new TransformParameters(597.1, 71.4, 412.1, -0.894, -0.068, 1.563, -7.580, BESSEL);
 
-	public static Area FORMER_GDR = new Area(new CWPoint(54.923414, 10.503013), new CWPoint(50.402578, 14.520637)); 
+	private static Area FORMER_GDR = new Area(new CWPoint(54.923414, 10.503013), new CWPoint(50.402578, 14.520637)); 
 
 	// taken from <A HREF="http://www.lverma.nrw.de/produkte/druckschriften/verwaltungsvorschriften/images/gps/TrafopsNRW.pdf">http://www.lverma.nrw.de/produkte/druckschriften/verwaltungsvorschriften/images/gps/TrafopsNRW.pdf</A> for NRW this transform has deviations lower than 34cm.
 	/** use this for NRW in Germany. Deviations less than 34 cm */
@@ -80,50 +134,97 @@
 
 	// taken from <A HREF="http://crs.bkg.bund.de/crs-eu/">http://crs.bkg.bund.de/crs-eu/</A> -&gt; italy -&gt; ROMA40 (change the sign of the rotation parameters!)
 	/** The italian variant of Gau&#223;-Kr&#252;ger (Gau&#223;-Boaga) */
-	public static final TransformParameters GB_ITALIAN_PENINSULAR_TO_WGS84 =  new TransformParameters(-104.1, -49.1, -9.9, -0.971, 2.917, -0.714, -11.68, HAYFORD1909);
+	private static final TransformParameters GB_ITALIAN_PENINSULAR_TO_WGS84 =  new TransformParameters(-104.1, -49.1, -9.9, -0.971, 2.917, -0.714, -11.68, HAYFORD1909);
 	//static final Area ITALY_PENINSULAR = new Area(new CWPoint());
-	public static final TransformParameters GB_ITALIAN_SARDINIA_TO_WGS84 =  new TransformParameters(-168.6, -34.0, 38.6, 0.374, 0.679, 1.379, 9.48, HAYFORD1909);
-	static final Area ITALY_SARDINIA = new Area(new CWPoint(42, 6), new CWPoint(38, 11));
-	static final Area ITALY_SARDINIA_GK = new Area(wgs84ToEpsg(ITALY_SARDINIA.topleft, EPSG_ITALIAN_GB_EW1).toTrackPoint(ProjectedPoint.LOCALSYSTEM_ITALIAN_GB),
-			wgs84ToEpsg(ITALY_SARDINIA.buttomright, EPSG_ITALIAN_GB_EW1).toTrackPoint(ProjectedPoint.LOCALSYSTEM_ITALIAN_GB));
+	private static final TransformParameters GB_ITALIAN_SARDINIA_TO_WGS84 =  new TransformParameters(-168.6, -34.0, 38.6, 0.374, 0.679, 1.379, 9.48, HAYFORD1909);
+	private static final Area ITALY_SARDINIA = new Area(new CWPoint(42, 6), new CWPoint(38, 11));
+	private static final Area ITALY_SARDINIA_GK = new Area(wgs84ToEpsg(ITALY_SARDINIA.topleft, EPSG_ITALIAN_GB_EW1).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB),
+			wgs84ToEpsg(ITALY_SARDINIA.buttomright, EPSG_ITALIAN_GB_EW1).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB));
 
-	public static final TransformParameters GB_ITALIAN_SICILIA_TO_WGS84 =  new TransformParameters(-50.2, -50.4, 84.8, 0.690, 2.012, -0.459, 28.08, HAYFORD1909);
-	static final Area ITALY_SICILIA = new Area(new CWPoint(39, 12), new CWPoint(36.3, 15.6));
-	static final Area ITALY_SICILIA_GK = new Area(wgs84ToEpsg(ITALY_SICILIA.topleft, EPSG_ITALIAN_GB_EW2).toTrackPoint(ProjectedPoint.LOCALSYSTEM_ITALIAN_GB),
-			wgs84ToEpsg(ITALY_SICILIA.buttomright, EPSG_ITALIAN_GB_EW2).toTrackPoint(ProjectedPoint.LOCALSYSTEM_ITALIAN_GB));
+	private static final TransformParameters GB_ITALIAN_SICILIA_TO_WGS84 =  new TransformParameters(-50.2, -50.4, 84.8, 0.690, 2.012, -0.459, 28.08, HAYFORD1909);
+	private static final Area ITALY_SICILIA = new Area(new CWPoint(39, 12), new CWPoint(36.3, 15.6));
+	private static final Area ITALY_SICILIA_GK = new Area(wgs84ToEpsg(ITALY_SICILIA.topleft, EPSG_ITALIAN_GB_EW2).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB),
+			wgs84ToEpsg(ITALY_SICILIA.buttomright, EPSG_ITALIAN_GB_EW2).toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB));
 
 	// see also <A HREF="http://hal.gis.univie.ac.at/karto/lehr/fachbereiche/geoinfo/givi0304/tutorials/ersteschritte/projectionen.htm#ParMGIWGS84">http://hal.gis.univie.ac.at/karto/lehr/fachbereiche/geoinfo/givi0304/tutorials/ersteschritte/projectionen.htm#ParMGIWGS84</A> 
 	// taken from taken from <A HREF="http://www.crs-geo.eu/crseu/EN/Home/homepage__node.html?__nnn=true">http://www.crs-geo.eu/crseu/EN/Home/homepage__node.html?__nnn=true</A> click on &quot;national CRS&quot; -&gt; Austria -&gt; AT (translation *-1 as of 11-8-2009)
 	/** Austria Datum Hermannskogel, AT_MGI accuracy about 1.5m */
-	public static final TransformParameters LAMBERT_AUSTRIAN_OLD_TO_WGS84 = new TransformParameters(577.326, 90.129, 463.919, -5.136599, -1.4742, -5.297044, 2.4232, BESSEL);
-	public static final TransformParameters LAMBERT_AUSTRIAN_NEW_TO_WGS84 = new TransformParameters(0      ,0      ,0       ,0         ,0       ,0         ,0      , WGS84);
+	private static final TransformParameters LAMBERT_AUSTRIAN_OLD_TO_WGS84 = new TransformParameters(577.326, 90.129, 463.919, -5.136599, -1.4742, -5.297044, 2.4232, BESSEL);
 	// &#220;bersicht &#252;ber alle Transformparameter und EPSG-COdes und Projektionenm (PORJ4):
 	// <A HREF="http://svn.osgeo.org/metacrs/proj/trunk/proj/nad/epsg">http://svn.osgeo.org/metacrs/proj/trunk/proj/nad/epsg</A>
 	//public static final TransformParameters WGS72_TO_WGS84 =  new TransformParameters(0, 0, 4.5, 0, 0, -0.554, 0.219);
+	private static final TransformParameters LAMBERT_FRENCH_NTF_TO_WGS84 = new TransformParameters(-168    ,    -60,320      ,0         ,0       ,0         ,0      , CLARKE1880IGN);
+	private static final TransformParameters NO_DATUM_SHIFT = new TransformParameters(0      ,0      ,0       ,0         ,0       ,0         ,0      , WGS84);
 
 	private TransformCoordinates() {
 		// as all members are static, so avoid instantiation
 	} 
 
+	/**
+	 * @return String[] of short friendly names all supported projected systems
+	 * the position in this array matches the position in localSystems[]
+	 */
+	public static final String[] getProjectedSystemNames() {
+		String[] ls = new String[TransformCoordinates.localSystems.length];
+		for (int i=0; i &lt; TransformCoordinates.localSystems.length; i++) {
+			ls[i] = TransformCoordinates.localSystems[i].friendlyShortname;
+		}
+		return ls;
+	}
+	
+	public static final int getLocalSystemCode(String id) {
+    	String idl = id.toLowerCase();
+    	if (idl.equals(&quot;dd&quot;)) 		return TransformCoordinates.DD;
+    	else if (idl.equals(&quot;dmm&quot;)) return TransformCoordinates.DMM;
+    	else if (idl.equals(&quot;dms&quot;)) return TransformCoordinates.DMS;
+    	else if (idl.equals(&quot;utm&quot;)) return TransformCoordinates.UTM;
+    	else if (idl.equals(&quot;cw&quot;)) return TransformCoordinates.CW;
+    	else {
+    		for (int i=0; i &lt; localSystems.length; i++) {
+    			if (localSystems[i].id.equals(idl)) return localSystems[i].code;
+    		}
+    	}
+    	return LOCALSYSTEM_NOT_SUPPORTED;
+	}
+	
+	public static final LocalSystem getLocalSystem(int localsystemcode) {
+		for (int i=0; i &lt; TransformCoordinates.localSystems.length; i++) {
+			if (TransformCoordinates.localSystems[i].code == localsystemcode) return TransformCoordinates.localSystems[i]; 
+		}
+		throw new IllegalArgumentException(&quot;TransformCoordinate.getLocalSystem(int): localsystemcode &quot; + localsystemcode + &quot; not supported&quot;);
+	}
 
 	/**
+	 * @return String[] of short friendly names all supported projected systems
+	 * the position in this array matches the position in localSystems[]
+	 */
+	public static final String[] getProjectedSystemIDs() {
+		String[] ls = new String[TransformCoordinates.localSystems.length];
+		for (int i=0; i &lt; TransformCoordinates.localSystems.length; i++) {
+			ls[i] = TransformCoordinates.localSystems[i].id;
+		}
+		return ls;
+	}
+
+	/**
 	 * 
 	 * @param epsgcode
 	 * @return region code as needed for GkPoint, -1 if not Gau&#223;-Kr&#252;ger or not supported
 	 * Inside one ProjectedRegion the epsg-code (zone / stripe) can be automatically choosen
 	 * depending on lat / lon.
 	 */
-	public static int getLocalProjectionSystem(int epsgcode) {
+	public static final int getLocalProjectionSystem(int epsgcode) {
 		int ret;
 		switch (epsgcode) {
-		case EPSG_GK2:
-		case EPSG_GK3:
-		case EPSG_GK4:
-		case EPSG_GK5: 					ret = ProjectedPoint.LOCALSYSTEM_GERMAN_GK; break;
+		case EPSG_GERMAN_GK2:
+		case EPSG_GERMAN_GK3:
+		case EPSG_GERMAN_GK4:
+		case EPSG_GERMAN_GK5: 					 ret = TransformCoordinates.LOCALSYSTEM_GERMAN_GK; break;
 		case EPSG_ITALIAN_GB_EW1:
-		case EPSG_ITALIAN_GB_EW2:       ret = ProjectedPoint.LOCALSYSTEM_ITALIAN_GB; break;
-		case EPSG_AUSTRIAN_LAMBERT_OLD: ret = ProjectedPoint.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD; break;
-		case EPSG_AUSTRIAN_LAMBERT_NEW: ret = ProjectedPoint.LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW; break;
+		case EPSG_ITALIAN_GB_EW2:        ret = TransformCoordinates.LOCALSYSTEM_ITALIAN_GB; break;
+		case EPSG_AUSTRIAN_LAMBERT_OLD:  ret = TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD; break;
+		case EPSG_AUSTRIAN_LAMBERT_NEW:  ret = TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW; break;
+		case EPSG_FRENCH_LAMBERT_NTF_II: ret = TransformCoordinates.LOCALSYSTEM_FRANCE_LAMBERT_IIE; break;
 		default: ret = -1;
 		}
 		return ret;
@@ -142,21 +243,15 @@
 	public static CWPoint ProjectedToWgs84(ProjectedPoint lp, int epsg_localsystem, boolean isLocalSystem) {
 		CWPoint ll = lp.unproject();
 		int ls = (isLocalSystem ? epsg_localsystem : getLocalProjectionSystem(epsg_localsystem));
-		TransformParameters transparams;
-		switch (ls) {
-		case ProjectedPoint.LOCALSYSTEM_GERMAN_GK:
-			transparams = getGermanTransformParams(lp);  break;
-		case ProjectedPoint.LOCALSYSTEM_ITALIAN_GB: 
-			transparams = getItalianTransformParams(lp); break;
-		case ProjectedPoint.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD:	
-			transparams = LAMBERT_AUSTRIAN_OLD_TO_WGS84; break; 
-		case ProjectedPoint.LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW: 	
-			transparams = LAMBERT_AUSTRIAN_NEW_TO_WGS84; break;
-		default: throw new IllegalArgumentException(&quot;ProjectedToWGS84: EPSG-code: &quot; + epsg_localsystem + &quot; not supported&quot;);
+		TransformParameters transparams = getTransParams(lp, ls);
+		CWPoint ret;
+		if (transparams == NO_DATUM_SHIFT) ret = ll; 
+		else {
+			XyzCoordinates xyzorig = latLon2xyz(ll, 0, transparams.ellip);
+			XyzCoordinates xyzwgs84 = transform(xyzorig, transparams);
+			ret = xyz2Latlon(xyzwgs84, WGS84);
 		}
-		XyzCoordinates xyzorig = latLon2xyz(ll, 0, transparams.ellip);
-		XyzCoordinates xyzwgs84 = transform(xyzorig, transparams);
-		return xyz2Latlon(xyzwgs84, WGS84);
+		return ret;
 	}
 
 
@@ -197,8 +292,8 @@
 		else return GB_ITALIAN_PENINSULAR_TO_WGS84;
 	}
 	public static TransformParameters getItalianTransformParams(ProjectedPoint gk) {
-		if (ITALY_SARDINIA_GK.isInBound(gk.toTrackPoint(ProjectedPoint.LOCALSYSTEM_ITALIAN_GB))) return GB_ITALIAN_SARDINIA_TO_WGS84;
-		if (ITALY_SICILIA_GK.isInBound(gk.toTrackPoint(ProjectedPoint.LOCALSYSTEM_ITALIAN_GB))) return GB_ITALIAN_SICILIA_TO_WGS84;
+		if (ITALY_SARDINIA_GK.isInBound(gk.toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB))) return GB_ITALIAN_SARDINIA_TO_WGS84;
+		if (ITALY_SICILIA_GK.isInBound(gk.toTrackPoint(TransformCoordinates.LOCALSYSTEM_ITALIAN_GB))) return GB_ITALIAN_SICILIA_TO_WGS84;
 		else return GB_ITALIAN_PENINSULAR_TO_WGS84;
 	}
 
@@ -237,17 +332,41 @@
 
 	private static TransformParameters getTransParams(TrackPoint wgs84, int localsystem) {
 		switch(localsystem) {
-		case ProjectedPoint.LOCALSYSTEM_GERMAN_GK: 
+		case TransformCoordinates.LOCALSYSTEM_GERMAN_GK: 
 			return getGermanGkTransformParameters(wgs84); 
-		case ProjectedPoint.LOCALSYSTEM_ITALIAN_GB: 
+		case TransformCoordinates.LOCALSYSTEM_ITALIAN_GB: 
 			return getItalianGkTransformParameters(wgs84);
-		case ProjectedPoint.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD:
+		case TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD:
 			return LAMBERT_AUSTRIAN_OLD_TO_WGS84;
+		case TransformCoordinates.LOCALSYSTEM_FRANCE_LAMBERT_IIE:
+			return LAMBERT_FRENCH_NTF_TO_WGS84;
+		case TransformCoordinates.LOCALSYSTEM_UTM_WGS84:
+		case TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW: 	
+			return NO_DATUM_SHIFT;
 		default: 
-			throw new IllegalArgumentException(&quot;getTransParams: localsystem: &quot; + localsystem + &quot;not supported&quot;);
+			throw new IllegalArgumentException(&quot;TransformCoordinates.getTransParams(wgs84): localsystem: &quot; + localsystem + &quot;not supported&quot;);
 		}
 	}
+	private static TransformParameters getTransParams(ProjectedPoint pp, int localsystem) {
+		TransformParameters transparams;
+		switch (localsystem) {
+		case TransformCoordinates.LOCALSYSTEM_GERMAN_GK:
+			transparams = getGermanTransformParams(pp);  break;
+		case TransformCoordinates.LOCALSYSTEM_ITALIAN_GB: 
+			transparams = getItalianTransformParams(pp); break;
+		case TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_OLD:	
+			transparams = LAMBERT_AUSTRIAN_OLD_TO_WGS84; break;
+		case TransformCoordinates.LOCALSYSTEM_FRANCE_LAMBERT_IIE:
+			transparams = LAMBERT_FRENCH_NTF_TO_WGS84; break;
+		case TransformCoordinates.LOCALSYSTEM_UTM_WGS84:
+		case TransformCoordinates.LOCALSYSTEM_AUSTRIAN_LAMBERT_NEW: 	
+			transparams = NO_DATUM_SHIFT; break;
+		default: throw new IllegalArgumentException(&quot;TransformCoordinates.getTransParams(ProjectedPoint): local projection system code: &quot; + localsystem + &quot; not supported&quot;);
+		}
+		return transparams;
+	}
 
+
 	private static XyzCoordinates latLon2xyz(TrackPoint ll, double alt, Ellipsoid ellipsoid) {
 		if (!ll.isValid()) throw new IllegalArgumentException(&quot;latLon2xyz: invalid lat-lon&quot;);
 		double e2 = (ellipsoid.a * ellipsoid.a - ellipsoid.b * ellipsoid.b)/(ellipsoid.a * ellipsoid.a);
@@ -364,3 +483,4 @@
 }
 
 
+

Added: trunk/src/CacheWolf/navi/UTMProjection.java
===================================================================
--- trunk/src/CacheWolf/navi/UTMProjection.java	2009-08-29 11:05:33 UTC (rev 2108)
+++ trunk/src/CacheWolf/navi/UTMProjection.java	2009-08-29 11:42:30 UTC (rev 2109)
@@ -0,0 +1,85 @@
+package CacheWolf.navi;
+
+import ewe.sys.Convert;
+import CacheWolf.CWPoint;
+
+
+public final class UTMProjection extends Projection {
+	Ellipsoid ellip;
+	
+	public UTMProjection(Ellipsoid ellip_) {
+		ellip = ellip_;
+		zoneSeperately = true;
+	}
+	public double getEasting(ProjectedPoint pp) {
+		return pp.easting + 500000;
+	}
+
+	public double getNorthing(ProjectedPoint pp) {
+		return (pp.northing &gt;=0 ? pp.northing : pp.northing + 10000000);
+	}
+	
+	public String getZone(ProjectedPoint pp) {
+		int zoneletter = (int)Math.floor(pp.zone / 200);
+		return Convert.formatInt(pp.zone - zoneletter * 200 +1) + getZoneLetter(zoneletter);
+	}
+	
+	private char getZoneLetter(int number){
+		if (((char)(number)) &gt;= 'i' - 'a') number++; // skip I
+		if (((char)(number)) &gt;= 'o' - 'a') number++; // skip O
+		char ret = (char)( number  + (int)'A' -1);
+		return ret;
+	}
+
+	public ProjectedPoint project(CWPoint wgs84, ProjectedPoint pp) {
+		int stripe = (int) Math.floor((wgs84.lonDec - 177) / 6); // we start with stripe 0, but officially this is stripe 1
+		if (stripe &lt; 0) stripe += 60;
+		GkProjection.project(wgs84, ellip, 6, stripe -30, 3, 0.9996, pp);
+		pp.zone = stripe;
+		pp.zone += (int) (Math.floor((wgs84.latDec)/8)+13) * 200; // zone letter
+		return pp;
+	}
+	
+	public String toHumanReadableString(ProjectedPoint pp) {
+	 	return pp.toString(0, &quot;&quot;, &quot; &quot;);
+	}
+
+	public ProjectedPoint project(CWPoint ll, ProjectedPoint pp, int epsg) {
+		throw new UnsupportedOperationException(&quot;UTMProjection: prject by epsg-code not supported&quot;);
+	}
+
+	public ProjectedPoint set(double northing, double easting, ProjectedPoint pp) {
+		throw new UnsupportedOperationException(&quot;UTMProjection.set: set() requires zone, use set with 1 more parameter&quot;);
+	}
+	
+	public ProjectedPoint set(double northing, double easting, String zone, ProjectedPoint pp) {
+		pp.easting = easting - 500000;
+		if (northing &gt; 10000000) pp.northing = northing - 10000000;
+		else pp.northing = northing;
+		if (zone.length() &gt; 3) throw new IllegalArgumentException(&quot;UTMProjection.set: zone must not have more than 3 letters&quot;);
+		char lastletter = zone.charAt(zone.length()-1); 
+		int zoneletter = -1;
+		if ( (lastletter &gt; 'a') &amp;&amp; ( lastletter &lt; 'z')) zoneletter = lastletter - 'a';   
+		if ( (lastletter &gt; 'A') &amp;&amp; ( lastletter &lt; 'Z')) zoneletter = lastletter - 'A';
+		if (zoneletter &gt; 'i' - 'a') zoneletter--;
+		if (zoneletter &gt; 'o' - 'a') zoneletter--;
+		int zonenumer = -1;
+		if (zoneletter == -1) {
+			zoneletter = 'n' - 'a'; // default to northern hemisphere
+			zonenumer = Convert.parseInt(zone);
+		} else {
+			zonenumer = Convert.parseInt(zone.substring(0, zone.length()-1));
+		}
+		if (zonenumer == -1) throw new IllegalArgumentException(&quot;UTMProjection.set: could not parse zone number&quot;);
+		pp.zone = zonenumer -1 + zoneletter * 200; // internally zone number starts with 0
+		return pp;
+	}
+
+	public CWPoint unproject(ProjectedPoint pp) {
+		int stripe = pp.zone - (int)Math.floor(pp.zone / 200) * 200;
+		int stripelon = stripe * 6 -177;
+		return GkProjection.unproject(pp, stripelon, ellip, 0.9996);
+
+	}
+
+}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002032.html">[Cachewolf-svn] [Bug #16194] invalid Character Entitiy bei	korruptem zip file
</A></li>
	<LI>Next message: <A HREF="002034.html">[Cachewolf-svn] r2110 - trunk/src/CacheWolf/navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2033">[ date ]</a>
              <a href="thread.html#2033">[ thread ]</a>
              <a href="subject.html#2033">[ subject ]</a>
              <a href="author.html#2033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
