From mik77 at mail.berlios.de  Fri Jun  1 19:47:51 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 1 Jun 2007 19:47:51 +0200
Subject: [Cachewolf-svn] r720 - trunk/resources
Message-ID: <200706011747.l51HlpaB029460@sheep.berlios.de>

Author: mik77
Date: 2007-06-01 19:47:48 +0200 (Fri, 01 Jun 2007)
New Revision: 720

Modified:
   trunk/resources/spider.def
Log:
Anpassung an GC-?\195?\132nderungen f?\195?\188r das TB spidern

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-05-31 10:42:17 UTC (rev 719)
+++ trunk/resources/spider.def	2007-06-01 17:47:48 UTC (rev 720)
@@ -2,6 +2,7 @@
 # spider.def - Definition file for reading caches from GC.COM
 # Version 1.0 - 20070526 skg
 # Version 2.0 - 20070531 nach GC ?nderungen
+# Version 2.1 - 20070601 TB Anpassung an GC ?nderung
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -73,7 +74,7 @@
 #Section2b: Bugs
 #--------------------------------------
 # blockEx extrahiert zun?chst den Bugbereich aus der gesamten Seite
-blockExStart       = >&nbsp;Inventory</td>
+blockExStart       = >&nbsp;<b>Inventory</b>
 blockExEnd         = What\ is\ a\ Travel\ Bug?
 # bugEx extrahiert die Namen der einzelnen Bugs aus dem Bugbereich
 bugExStart         = <a\ href='



From mik77 at mail.berlios.de  Fri Jun  1 20:00:31 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 1 Jun 2007 20:00:31 +0200
Subject: [Cachewolf-svn] r721 - branches/bugfix_09n/src/CacheWolf
Message-ID: <200706011800.l51I0Vh2030359@sheep.berlios.de>

Author: mik77
Date: 2007-06-01 20:00:29 +0200 (Fri, 01 Jun 2007)
New Revision: 721

Modified:
   branches/bugfix_09n/src/CacheWolf/SpiderGC.java
Log:
Anpassung an GC-?\195?\132nderungen f?\195?\188r das TB spidern

Modified: branches/bugfix_09n/src/CacheWolf/SpiderGC.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-06-01 17:47:48 UTC (rev 720)
+++ branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-06-01 18:00:29 UTC (rev 721)
@@ -514,7 +514,7 @@
 	}
 	
 	public String getBugs(String doc){	
-		Extractor exBlock = new Extractor(doc, ">&nbsp;Inventory</td>","What is a Travel Bug?",0,Extractor.EXCLUDESTARTEND);
+		Extractor exBlock = new Extractor(doc, ">&nbsp;<b>Inventory</b>","What is a Travel Bug?",0,Extractor.EXCLUDESTARTEND);
 		String bugBlock = exBlock.findNext();
 		//Vm.debug("Bugblock: "+bugBlock);
 		Extractor exBug = new Extractor(bugBlock, "<a href='", "</a></strong></td>",0,Extractor.EXCLUDESTARTEND);



From mik77 at mail.berlios.de  Sat Jun  2 12:51:51 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 2 Jun 2007 12:51:51 +0200
Subject: [Cachewolf-svn] r722 - trunk/src/CacheWolf
Message-ID: <200706021051.l52AppD5030184@sheep.berlios.de>

Author: mik77
Date: 2007-06-02 12:51:36 +0200 (Sat, 02 Jun 2007)
New Revision: 722

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Absoluter Pfad zur spider.def hinzugef?\195?\188gt. Jetzt klappts auch auf dem PDA.

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-01 18:00:29 UTC (rev 721)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-02 10:51:36 UTC (rev 722)
@@ -63,7 +63,7 @@
 		try {
 			if (p==null) {
 				p=new Properties();
-				p.load(new FileInputStream("spider.def"));
+				p.load(new FileInputStream(File.getProgramDirectory()+"/spider.def"));
 			}
 		} catch (Exception ex) {
 			p=null;



From mik77 at mail.berlios.de  Sat Jun  2 14:24:44 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 2 Jun 2007 14:24:44 +0200
Subject: [Cachewolf-svn] r723 - trunk/resources
Message-ID: <200706021224.l52COiEq000541@sheep.berlios.de>

Author: mik77
Date: 2007-06-02 14:24:39 +0200 (Sat, 02 Jun 2007)
New Revision: 723

Modified:
   trunk/resources/spider.def
Log:
fehlendes "firstLine" hinzugef?\195?\188gt. Jetzt kann auch mehr als die erste Seite gespidert werden

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-06-02 10:51:36 UTC (rev 722)
+++ trunk/resources/spider.def	2007-06-02 12:24:39 UTC (rev 723)
@@ -3,6 +3,7 @@
 # Version 1.0 - 20070526 skg
 # Version 2.0 - 20070531 nach GC ?nderungen
 # Version 2.1 - 20070601 TB Anpassung an GC ?nderung
+# Version 2.2 - 20070607 firstLine erg?nzt. Damit funktionieren jetzt auch die n?chsten Seiten.
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -25,6 +26,7 @@
 distRex            = <br\ />(.*?)(km|mi)</td>
 waypointRex        = </a> \\((.*?)\\)<br>
 showOnlyFound      = &f=1
+firstLine          = http://www.geocaching.com/seek/nearest.aspx?
 nextListPage       = /seek/nearest.aspx
 
 #--------------------------------------



From mik77 at mail.berlios.de  Sat Jun  2 20:41:23 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 2 Jun 2007 20:41:23 +0200
Subject: [Cachewolf-svn] r724 - trunk/resources
Message-ID: <200706021841.l52IfNBY024567@sheep.berlios.de>

Author: mik77
Date: 2007-06-02 20:41:21 +0200 (Sat, 02 Jun 2007)
New Revision: 724

Modified:
   trunk/resources/spider.def
Log:
sizeRex an GC-?\195?\132nderungen angepasst

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-06-02 12:24:39 UTC (rev 723)
+++ trunk/resources/spider.def	2007-06-02 18:41:21 UTC (rev 724)
@@ -3,7 +3,8 @@
 # Version 1.0 - 20070526 skg
 # Version 2.0 - 20070531 nach GC ?nderungen
 # Version 2.1 - 20070601 TB Anpassung an GC ?nderung
-# Version 2.2 - 20070607 firstLine erg?nzt. Damit funktionieren jetzt auch die n?chsten Seiten.
+# Version 2.2 - 20070602 firstLine erg?nzt. Damit funktionieren jetzt auch die n?chsten Seiten.
+# Version 2.3 - 20070602 sizeRex an GC ?nderungen angepasst
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -43,7 +44,7 @@
 cacheOwnerRex      = <span\ id="CacheOwner">by\ <a\ href=(?:(?s).*?)>((?s).*?)</a></span></b>
 dateHiddenRex      = <span\ id="DateHidden">((?s).*?)</span>
 hintsRex           = <span\ id="Hints"\ class="displayMe">((?s).*?)</span>
-sizeRex            = This\ is\ a\ <strong>((?s).*?)</strong>\ cache
+sizeRex            = alt="Size:\ ((?s).*?)"\ title="Size:
 difficultyRex      = <span\ id="Difficulty">.*?alt="(.*?)\ out\ of
 terrainRex         = <span\ id="Terrain">.*?alt="(.*?)\ out\ of
 cacheTypeRex       = <img\ src="../images/WptTypes/(.*?)\\.gif



From mik77 at mail.berlios.de  Sat Jun  2 20:44:41 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sat, 2 Jun 2007 20:44:41 +0200
Subject: [Cachewolf-svn] r725 - branches/bugfix_09n/src/CacheWolf
Message-ID: <200706021844.l52IifL6024715@sheep.berlios.de>

Author: mik77
Date: 2007-06-02 20:44:34 +0200 (Sat, 02 Jun 2007)
New Revision: 725

Modified:
   branches/bugfix_09n/src/CacheWolf/SpiderGC.java
Log:
size-Regex an GC-?\195?\132nderungen angepasst

Modified: branches/bugfix_09n/src/CacheWolf/SpiderGC.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-06-02 18:41:21 UTC (rev 724)
+++ branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-06-02 18:44:34 UTC (rev 725)
@@ -732,7 +732,7 @@
 	}
 	
 	private String getSize(String doc){
-		inRex = new Regex("This is a <strong>((?s).*?)</strong> cache");
+		inRex = new Regex("alt=\"Size: ((?s).*?)\" title=\"Size:");
 		inRex.search(doc);
 		if(inRex.didMatch()) return inRex.stringMatched(1);
 		else return "None";



From salzkammergut at mail.berlios.de  Sat Jun  2 23:06:27 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 2 Jun 2007 23:06:27 +0200
Subject: [Cachewolf-svn] r726 - trunk/src/CacheWolf
Message-ID: <200706022106.l52L6Rso003302@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-02 23:06:24 +0200 (Sat, 02 Jun 2007)
New Revision: 726

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
Trunk\spiderGC: Bugfix blauer Kreis wurde falsch angezeigt auch wenn keine Aenderung bei Logs 

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-02 18:44:34 UTC (rev 725)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-02 21:06:24 UTC (rev 726)
@@ -1,4 +1,4 @@
-    /*
+/*
     CacheWolf is a software for PocketPC, Win and Linux that 
     enables paperless caching. 
     It supports the sites geocaching.com and opencaching.de
@@ -355,6 +355,8 @@
 				chD.is_available = true;
 				chD.is_archived = false;
 				chD.is_incomplete = false;
+				// Save size of logs to be able to check whether any new logs were added
+				int logsz = chD.CacheLogs.size();
 				chD.CacheLogs.clear();
 				chD.addiWpts.clear();
 				chD.Images.clear();
@@ -420,7 +422,6 @@
 				// Logs
 				//==========
 				pref.log("Trying logs");
-				int logsz = chD.CacheLogs.size();
 				chD.CacheLogs = getLogs(completeWebPage, chD);
 				// Count the number of not-found logs
 				int countNoFoundLogs = 0;



From kalli at mail.berlios.de  Sun Jun  3 18:21:32 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Sun, 3 Jun 2007 18:21:32 +0200
Subject: [Cachewolf-svn] r727 - trunk/src/exp
Message-ID: <200706031621.l53GLW17011861@sheep.berlios.de>

Author: kalli
Date: 2007-06-03 18:21:29 +0200 (Sun, 03 Jun 2007)
New Revision: 727

Modified:
   trunk/src/exp/TomTomExporter.java
Log:
FR#3450: Beschreibungen bei TomTom .asc an .ov2 angeglichen

Modified: trunk/src/exp/TomTomExporter.java
===================================================================
--- trunk/src/exp/TomTomExporter.java	2007-06-02 21:06:24 UTC (rev 726)
+++ trunk/src/exp/TomTomExporter.java	2007-06-03 16:21:29 UTC (rev 727)
@@ -178,7 +178,20 @@
 			outp.writeBytes(",");
 			outp.writeBytes(lat);
 			outp.writeBytes(",");
-			outp.writeBytes("\"" + ch.CacheName.replace(',',' ') + "\"\r\n");
+			//outp.writeBytes("\"" + ch.CacheName.replace(',',' ') + "\"\r\n");
+			outp.writeBytes("\"");
+			outp.writeBytes(ch.wayPoint);
+			outp.writeBytes(" - ");
+			outp.writeBytes(ch.CacheName.replace(',',' '));
+			outp.writeBytes(" by ");
+			outp.writeBytes(ch.CacheOwner);
+			outp.writeBytes("- ");             
+			outp.writeBytes(ch.hard);
+			outp.writeBytes("/");
+			outp.writeBytes(ch.terrain);
+			outp.writeBytes(" - ");
+			outp.writeBytes(ch.CacheSize);
+			outp.writeBytes("\"\r\n");
 		} catch (IOException e) {
 			Vm.debug("Error writing to file");
 			e.printStackTrace();



From admin at berlios.de  Sun Jun  3 18:23:33 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 3 Jun 2007 18:23:33 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3450] Beschreibung in .asc wie in .ov2
Message-ID: <200706031623.l53GNXkc003737@unicorn.berlios.de>

Feature Request #3450, was updated on 2007-May-30 20:50
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3450&group_id=2211

Category: 1.0
Status: Closed
Priority: 5
Summary: Beschreibung in .asc wie in .ov2

By: kalli
Date: 2007-Jun-03 18:23

Message:
Logged In: YES 
user_id=24621
Browser: Opera/9.00 (Windows NT 5.1; U; de)

Erledigt, getestet mit Glopus

----------------------------------------------------------------------

By: kalli
Date: 2007-May-30 20:50

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

Der Name in den TomTom-asc-Dateien sollte so aufgebaut
sein wie in den ov2-Dateien.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3450&group_id=2211


From admin at berlios.de  Sun Jun  3 18:51:23 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 3 Jun 2007 18:51:23 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2877] Terracaching
Message-ID: <200706031651.l53GpNG7019663@unicorn.berlios.de>

Feature Request #2877, was updated on 2006-Nov-14 22:51
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2877&group_id=2211

Category: 1.0
Status: Open
Priority: 5
Summary: Terracaching

By: kalli
Date: 2007-Apr-05 21:03

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

Ich hab die Infos ?ber das Terracaching GPX zusammen, mache
den Request wieder auf.

----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Nov-23 15:48

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; CIO CU; .NET CLR 1.0.3705; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.1)

lohnt sich nicht...

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2877&group_id=2211


From kalli at mail.berlios.de  Sun Jun  3 20:47:04 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Sun, 3 Jun 2007 20:47:04 +0200
Subject: [Cachewolf-svn] r728 - trunk/src/CacheWolf
Message-ID: <200706031847.l53Il4VZ004290@sheep.berlios.de>

Author: kalli
Date: 2007-06-03 20:46:57 +0200 (Sun, 03 Jun 2007)
New Revision: 728

Modified:
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/GPXImporter.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
Feature Request #2877: Erste Version des GPX-Imports von TerraCaching Files.

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2007-06-03 16:21:29 UTC (rev 727)
+++ trunk/src/CacheWolf/CacheType.java	2007-06-03 18:46:57 UTC (rev 728)
@@ -144,8 +144,8 @@
 	}
 
 	public static String typeText2Number(String typeText){
-		if (typeText.equals("Traditional Cache") || typeText.equals("Traditional")) return "2";
-		if (typeText.equals("Multi-cache") || typeText.equals("Multi")) return "3";
+		if (typeText.equals("Traditional Cache") || typeText.equals("Traditional")|| typeText.equals("Classic")) return "2";
+		if (typeText.equals("Multi-cache") || typeText.equals("Multi") || typeText.equals("Offset")) return "3";
 		if (typeText.equals("Virtual Cache") || typeText.equals("Virtual")) return "4";
 		if (typeText.equals("Letterbox Hybrid")) return "5";
 		if (typeText.equals("Event Cache") || typeText.equals("Event")) return "6";

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-06-03 16:21:29 UTC (rev 727)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-06-03 18:46:57 UTC (rev 728)
@@ -30,6 +30,7 @@
 	boolean spiderOK = true;
 	boolean doSpider = false;
 	boolean fromOC = false;
+	boolean fromTC = false;
 	boolean nameFound = false;
 	int zaehlerGel = 0;
 	Hashtable DBindex = new Hashtable();
@@ -154,6 +155,9 @@
 			// check for opencaching
 			if (atts.getValue("creator").indexOf("opencaching")> 0) fromOC = true;
 			else fromOC = false;
+			if (atts.getValue("creator").startsWith("TerraCaching")) fromTC = true;
+			else fromTC = false;
+
 			if (fromOC && doSpider) (new MessageBox("Warnung", "GPX-Dateien von Opencaching enthalten keine Informationen zu Bildern, sie werden nicht heruntergeladen. Am besten Caches von Opencaching holen per Men? /Anwendung/Download von Opencaching", MessageBox.OKB)).execute();
 			zaehlerGel = 0;
 		}
@@ -167,6 +171,12 @@
 			nameFound = false;
 			return;
 		}
+		
+		if (name.equals("link")&& inWpt){
+			holder.URL = atts.getValue("href");
+			return;
+		}
+
 		if (name.equals("groundspeak:cache")) {
 			inCache = true;
 			if (atts.getValue("available").equals("True"))
@@ -193,6 +203,11 @@
 			return;
 		}
 		
+		if (name.equals("terra:terracache")) {
+			inCache=true;
+		}
+
+		
 		if (name.equals("groundspeak:long_description")) {
 			if (atts.getValue("html").toLowerCase().equals("true"))
 				holder.is_HTML= true;
@@ -200,12 +215,12 @@
 				holder.is_HTML = false;
 			
 		}
-		if (name.equals("description")) {
-			//set HTML always to true if from oc.de
+		if (name.equals("description") || name.equals("terra:description") ) {
+			//set HTML always to true if from oc.de or TC
 			holder.is_HTML= true;
 		}
 
-		if (name.equals("groundspeak:logs") || name.equals("log")) {
+		if (name.equals("groundspeak:logs") || name.equals("log") || name.equals("terra:logs")) {
 			inLogs = true;
 			return;
 		}
@@ -225,15 +240,15 @@
 		
 		// logs
 		if (inLogs){
-			if (name.equals("groundspeak:date")|| name.equals("time"))  {
+			if (name.equals("groundspeak:date")|| name.equals("time")|| name.equals("terra:date"))  {
 				logDate = new String(strData.substring(0,10));
 				return;
 			}
-			if (name.equals("groundspeak:type") || name.equals("type")){
+			if (name.equals("groundspeak:type") || name.equals("type") || name.equals("terra:type")){
 				logIcon = new String(typeText2Image(strData));
 				return;
 			}
-			if (name.equals("groundspeak:finder")|| name.equals("geocacher")){
+			if (name.equals("groundspeak:finder")|| name.equals("geocacher")|| name.equals("terra:user")){
 				logFinder = new String(strData);
 				if(logIcon.equals("<img src='icon_smile.gif'>&nbsp;") && 
 				  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
@@ -242,11 +257,11 @@
 				}
 				return;
 			}
-			if (name.equals("groundspeak:text") || name.equals("text")){ 
+			if (name.equals("groundspeak:text") || name.equals("text") || name.equals("terra:entry")){ 
 				logData = new String(strData);
 				return;
 			}
-			if (name.equals("groundspeak:log") || name.equals("log") ) {
+			if (name.equals("groundspeak:log") || name.equals("log") || name.equals("terra:log") ) {
 				holder.CacheLogs.add(logIcon + logDate + " by " + logFinder + "</strong><br>" + logData + "<br>");
 				return;
 			}
@@ -290,7 +305,7 @@
 								//mpl.loadTo(profile.dataDir + "/" + holder.wayPoint + "_map_2.gif", "10");
 							}
 						}
-					if(holder.wayPoint.startsWith("GC")) {
+					if(holder.wayPoint.startsWith("GC")|| fromTC) {
 						//spiderImages();
 						spiderImagesUsingSpider();
 						//Rename image sources
@@ -338,13 +353,11 @@
 			return;
 		}
 		if (name.equals("groundspeak:travelbugs")) {
+			holder.has_bug = true;
 			inBug = false;
 			return;
 		}
-		if (name.equals("groundspeak:travelbug")) {
-			holder.has_bug = true;
-			return;
-		}
+
 		if (name.equals("groundspeak:name")&& inBug) {
 			holder.Bugs += "<b>Name:</b> " + strData + "<br><hr>";  
 			return;
@@ -359,7 +372,7 @@
 			return;
 		}
 		// cache information
-		if (name.equals("groundspeak:cache") || name.equals("geocache")) {
+		if (name.equals("groundspeak:cache") || name.equals("geocache")|| name.equals("terra:terracache")) {
 			inCache = false;
 		}
 		
@@ -397,24 +410,24 @@
 		}
 
 		
-		if (name.equals("groundspeak:name")&& inCache) {
+		if ((name.equals("groundspeak:name")|| name.equals("terra:name")) && inCache) {
 			holder.CacheName = strData;
 			return;
 		}
-		if (name.equals("groundspeak:owner") || name.equals("owner")) {
+		if (name.equals("groundspeak:owner") || name.equals("owner")||name.equals("terra:owner")) {
 			holder.CacheOwner = strData;
 			if(pref.myAlias.equals(strData)) holder.is_owned = true;
 			return;
 		}
-		if (name.equals("groundspeak:difficulty") || name.equals("difficulty")) {
+		if (name.equals("groundspeak:difficulty") || name.equals("difficulty") || name.equals("terra:mental_challenge")) {
 			holder.hard = strData.replace('.',',');
 			return;
 		}
-		if (name.equals("groundspeak:terrain")|| name.equals("terrain")) {
+		if (name.equals("groundspeak:terrain")|| name.equals("terrain")|| name.equals("terra:physical_challenge")) {
 			holder.terrain = strData.replace('.',',');
 			return;
 		}
-		if ((name.equals("groundspeak:type") || name.equals("type"))&& inCache){
+		if ((name.equals("groundspeak:type") || name.equals("type")|| name.equals("terra:style"))&& inCache){
 			holder.type= CacheType.typeText2Number(strData);
 			return;
 		}
@@ -422,13 +435,18 @@
 			holder.CacheSize = strData;
 			return;
 		}
+		
+		if (name.equals("terra:size")){
+			holder.CacheSize = TCSizetoText(strData);
+		}
+
 		if (name.equals("groundspeak:short_description")|| name.equals("summary")) {
 			if (holder.is_HTML)	holder.LongDescription =SafeXML.cleanback(strData);
 			else holder.LongDescription =strData;
 			return;
 		}
 
-		if (name.equals("groundspeak:long_description")|| name.equals("description")) {
+		if (name.equals("groundspeak:long_description")|| name.equals("description")|| name.equals("terra:description")) {
 			if (holder.is_HTML)	holder.LongDescription +=SafeXML.cleanback(strData);
 			else holder.LongDescription +=strData;
 			return;
@@ -437,6 +455,13 @@
 			holder.Hints = Common.rot13(strData);
 			return;
 		}
+		
+		if (name.equals("terra:hint")) {
+			// remove "&lt;br&gt;<br>" from the end
+			int indexTrash = strData.indexOf("&lt;br&gt;<br>");
+			if (indexTrash > 0)	holder.Hints = Common.rot13(strData.substring(0,indexTrash));
+			return;
+		}
 
 
 	}
@@ -506,9 +531,9 @@
 	}
 
 	public static String typeText2Image(String typeText){
-		if (typeText.equals("Found it")||typeText.equals("Found")) return "<img src='icon_smile.gif'>&nbsp;";
-		if (typeText.equals("Didn't find it")||typeText.equals("Not Found")) return "<img src='icon_sad.gif'>&nbsp;";
-		if (typeText.equals("Write note")||typeText.equals("Note")
+		if (typeText.equals("Found it")||typeText.equals("Found")||typeText.equals("find")) return "<img src='icon_smile.gif'>&nbsp;";
+		if (typeText.equals("Didn't find it")||typeText.equals("Not Found")||typeText.equals("no_find")) return "<img src='icon_sad.gif'>&nbsp;";
+		if (typeText.equals("Write note")||typeText.equals("Note")||typeText.equals("note")
 			||typeText.equals("Not Attempted")||typeText.equals("Other")) return "<img src='icon_note.gif'>&nbsp;";
 		if (typeText.equals("Enable Listing")) return "<img src='icon_enabled.gif'>&nbsp;";
 		if (typeText.equals("Temporarily Disable Listing")) return "<img src='icon_disabled.gif'>&nbsp;";
@@ -525,7 +550,17 @@
 		//Vm.debug("Unknown Log Type:" + typeText);
 		return typeText +"&nbsp;";
 	}
+	
+	public static String TCSizetoText(String size){
+		if (size.equals("1")) return "Micro";
+		if (size.equals("2")) return "Medium";
+		if (size.equals("3")) return "Regular";
+		if (size.equals("4")) return "Large";
+		if (size.equals("5")) return "Very Large";
 
+		return "None";
+	}
+
 	/**
 	* Method to iterate through cache database and look for waypoint.
 	* Returns value >= 0 if waypoint is found, else -1
@@ -560,10 +595,15 @@
 		// just to be sure to have a spider object
 		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile, false);
 		
-		addr = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + holder.wayPoint ;
+		if (fromTC) {
+			imgSpider.getImages(holder.LongDescription, holder);
+		}
+		else {
+			addr = "http://www.geocaching.com/seek/cache_details.aspx?wp=" + holder.wayPoint ;
 			//Vm.debug(addr + "|");
-		cacheText = SpiderGC.fetch(addr);
-		imgSpider.getImages(cacheText, holder);
+			cacheText = SpiderGC.fetch(addr);
+			imgSpider.getImages(cacheText, holder);
+		}
 	}
 	
 	public static String replace(String source, String pattern, String replace){

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-03 16:21:29 UTC (rev 727)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-03 18:46:57 UTC (rev 728)
@@ -758,7 +758,8 @@
 		//In the long description
 		//========
 		String longDesc = "";
-		longDesc = getLongDesc(doc);
+		if (chD.wayPoint.startsWith("TC")) longDesc = doc;
+		else longDesc = getLongDesc(doc);
 		longDesc = STRreplace.replace(longDesc, "img", "IMG");
 		longDesc = STRreplace.replace(longDesc, "src", "SRC");
 		longDesc = STRreplace.replace(longDesc, "'", "\"");



From salzkammergut at mail.berlios.de  Mon Jun  4 00:59:41 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 4 Jun 2007 00:59:41 +0200
Subject: [Cachewolf-svn] r729 - trunk/src/CacheWolf
Message-ID: <200706032259.l53Mxf7C030016@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-04 00:59:34 +0200 (Mon, 04 Jun 2007)
New Revision: 729

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Bugfix beim Bilder spidern

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-03 18:46:57 UTC (rev 728)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-03 22:59:34 UTC (rev 729)
@@ -770,7 +770,7 @@
 		//Vm.debug("Test: \n" + tst);
 		Extractor exImgSrc = new Extractor(tst, "http://", "\"", 0, true);
 		while(exImgBlock.endOfSearch() == false){
-			imgUrl = exImgSrc.findNext();
+			imgUrl = exImgSrc.findNext().toLowerCase();
 			//Vm.debug("Img Url: " +imgUrl);
 			if(imgUrl.length()>0){
 				imgUrl = "http://" + imgUrl;
@@ -809,7 +809,7 @@
 		Extractor exImgName = new Extractor(tst,p.getProperty("imgNameExStart"),p.getProperty("imgNameExEnd"), 0 , true);
 		exImgSrc = new Extractor(tst,p.getProperty("imgSrcExStart"),p.getProperty("imgSrcExEnd"), 0, true);
 		while(exImgSrc.endOfSearch() == false){
-			imgUrl = exImgSrc.findNext();
+			imgUrl = exImgSrc.findNext().toLowerCase();
 			//Vm.debug("Img Url: " +imgUrl);
 			if(imgUrl.length()>0){
 				imgUrl = "http://" + imgUrl;
@@ -830,7 +830,6 @@
 							chD.Images.add(oldImgName+imgType); // Store name of old image as image to load
 						}
 						chD.ImagesText.add(exImgName.findNext()); // Keep the image description
-						chD.ImagesText.add(imgName); 
 						imgCounter++;
 					}
 				} catch (IndexOutOfBoundsException e) { 



From salzkammergut at mail.berlios.de  Tue Jun  5 22:12:48 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 5 Jun 2007 22:12:48 +0200
Subject: [Cachewolf-svn] r730 - trunk/src/CacheWolf
Message-ID: <200706052012.l55KCmx2025369@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-05 22:12:38 +0200 (Tue, 05 Jun 2007)
New Revision: 730

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Parser: Es kann geprueft werden ob Variable oder Wegpunkte definiert sind.
Syntax: IF varname THEN   oder
        IF $waypoint THEN
Dadurch koennen Berechungen in Multis vereinfacht werden

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2007-06-03 22:59:34 UTC (rev 729)
+++ trunk/src/CacheWolf/Parser.java	2007-06-05 20:12:38 UTC (rev 730)
@@ -281,6 +281,13 @@
 			scanpos++;
 		} else err(MyLocale.getMsg(1704,"Unexpected end of source"));
 	}
+	
+	private TokenObj peekToken() {
+		if(scanpos < tokenStack.size()){
+			return (TokenObj)tokenStack.get(scanpos);
+		} else
+			return new TokenObj();
+	}
 
 	private void getNextTokenOtherThanSemi() throws Exception {
 		do {
@@ -666,36 +673,52 @@
 		boolean compRes=false;
 		TokenObj ifToken=thisToken;
 		getToken();
-		parseStringExp();
-		compOp=thisToken.tt;
-		if (compOp<TokenObj.TT_LT || compOp>TokenObj.TT_NE) err(MyLocale.getMsg(1723,"Comparison operator expected"));
-		getToken();
-		parseStringExp();
-		checkNextSymIs("THEN");
-		getNextTokenOtherThanSemi();
-		// If the first expression is a string, compare as string.
-		if (calcStack.get(calcStack.size()-2) instanceof String) {
-			String b=popCalcStackAsString();
-			String a=popCalcStackAsString();
-			switch (compOp) {
-				case TokenObj.TT_EQ: compRes=a.equals(b); break;
-				case TokenObj.TT_NE: compRes=!a.equals(b); break;
-				case TokenObj.TT_LT: compRes=a.compareTo(b)<0; break;
-				case TokenObj.TT_GT: compRes=a.compareTo(b)>0; break;
-				case TokenObj.TT_LE: compRes=a.compareTo(b)<=0; break;
-				case TokenObj.TT_GE: compRes=a.compareTo(b)>=0; break;
+		// Check for "IF varName THEN" construct to check whether a variable is defined
+		if (thisToken.tt==TokenObj.TT_VARIABLE && peekToken().token.toUpperCase().equals("THEN")) {
+			String varName=thisToken.token;
+			getToken(); //THEN
+			Object result = symbolTable.get(Global.getPref().solverIgnoreCase?varName.toUpperCase():varName);
+			if(result == null) { // Var not found check whether it is a waypoint
+				if (varName.startsWith("$")) { // Could be a cachename
+					varName=varName.substring(1);
+					compRes=Global.getProfile().getCacheIndex(varName)!=-1;
+				} else 
+					compRes=false;
+			} else // Found the variable, it must have a value
+				compRes=true;
+			getNextTokenOtherThanSemi();
+		} else { // Normal: IF expression THEN
+			parseStringExp();
+			compOp=thisToken.tt;
+			if (compOp<TokenObj.TT_LT || compOp>TokenObj.TT_NE) err(MyLocale.getMsg(1723,"Comparison operator expected"));
+			getToken();
+			parseStringExp();
+			checkNextSymIs("THEN");
+			getNextTokenOtherThanSemi();
+			// If the first expression is a string, compare as string.
+			if (calcStack.get(calcStack.size()-2) instanceof String) {
+				String b=popCalcStackAsString();
+				String a=popCalcStackAsString();
+				switch (compOp) {
+					case TokenObj.TT_EQ: compRes=a.equals(b); break;
+					case TokenObj.TT_NE: compRes=!a.equals(b); break;
+					case TokenObj.TT_LT: compRes=a.compareTo(b)<0; break;
+					case TokenObj.TT_GT: compRes=a.compareTo(b)>0; break;
+					case TokenObj.TT_LE: compRes=a.compareTo(b)<=0; break;
+					case TokenObj.TT_GE: compRes=a.compareTo(b)>=0; break;
+				}
+			} else { // First expression is a number, compare as numbers
+				double b=popCalcStackAsNumber(0);
+				double a=popCalcStackAsNumber(0);
+				switch (compOp) {
+					case TokenObj.TT_EQ: compRes=a==b; break;
+					case TokenObj.TT_NE: compRes=a!=b; break;
+					case TokenObj.TT_LT: compRes=a<b; break;
+					case TokenObj.TT_GT: compRes=a>b; break;
+					case TokenObj.TT_LE: compRes=a<=b; break;
+					case TokenObj.TT_GE: compRes=a>=b; break;
+				}
 			}
-		} else { // First expression is a number, compare as numbers
-			double b=popCalcStackAsNumber(0);
-			double a=popCalcStackAsNumber(0);
-			switch (compOp) {
-				case TokenObj.TT_EQ: compRes=a==b; break;
-				case TokenObj.TT_NE: compRes=a!=b; break;
-				case TokenObj.TT_LT: compRes=a<b; break;
-				case TokenObj.TT_GT: compRes=a>b; break;
-				case TokenObj.TT_LE: compRes=a<=b; break;
-				case TokenObj.TT_GE: compRes=a>=b; break;
-			}
 		}
 		if (compRes) { // comparison resulted in TRUE
 			if (thisToken.tt!=TokenObj.TT_ENDIF) {



From salzkammergut at mail.berlios.de  Wed Jun  6 01:38:36 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 6 Jun 2007 01:38:36 +0200
Subject: [Cachewolf-svn] r731 - trunk/src/CacheWolf
Message-ID: <200706052338.l55NcaCK024395@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-06 01:38:33 +0200 (Wed, 06 Jun 2007)
New Revision: 731

Modified:
   trunk/src/CacheWolf/Parser.java
Log:
Parser: Verbesserter skeleton Befehl kennt jetzt 4 Variationen
sk("GCXXXXX")  beliebiger Cache mit Addis
sk() derzeitiger Cache mit Addis
sk(3) Mit Variablen ABC
sk("H")  Mit Variablen bis H

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2007-06-05 20:12:38 UTC (rev 730)
+++ trunk/src/CacheWolf/Parser.java	2007-06-05 23:38:33 UTC (rev 731)
@@ -123,7 +123,7 @@
     	new fnType("rot13","rot13",2),
     	new fnType("show","show",2),
     	new fnType("sin","sin",2),
-    	new fnType("skeleton","skeleton",2),
+    	new fnType("skeleton","skeleton",3),
     	new fnType("sqrt","sqrt",2),
     	new fnType("sval","sval",2),
     	new fnType("tolowercase","lc",2),
@@ -572,34 +572,68 @@
     	return res;
     }
     
-    /** Create a skeleton for multis */
-    private void funcSkeleton(String waypointName) throws Exception {
-   		int i=Global.getProfile().getCacheIndex(waypointName);
-		if (i<0) err(MyLocale.getMsg(1714,"Goto: Waypoint does not exist: ")+waypointName);
-   	    CacheHolder ch=(CacheHolder)Global.getProfile().cacheDB.get(i);
-		CacheHolder addiWpt;
-		StringBuffer op=new StringBuffer(1000);
-   	    if (ch.hasAddiWpt()){
-			for (int j=0; j<ch.addiWpts.getCount();j++){
-				addiWpt = (CacheHolder)ch.addiWpts.get(j);
-				op.append("IF $");
-				op.append(addiWpt.wayPoint);
-				op.append("=\"\" THEN\n   $");
-				op.append(addiWpt.wayPoint);
-				op.append("=\"\" # Pos=");
-				op.append(addiWpt.pos.toString());
-				op.append("\n   \"Punkt ");
-				op.append(addiWpt.wayPoint.substring(0,2));
-				op.append(" [");
-				op.append(addiWpt.CacheName);
-				op.append("] = \" $");
-				op.append(addiWpt.wayPoint);
-				op.append("\n   goto($");
-				op.append(addiWpt.wayPoint);
-				op.append("); STOP\nENDIF\n");
+    /** Create a skeleton for multis. This function can be called in three ways:<br>
+     *  <pre>sk("waypointname")  Create skeleton for a give waypointname (must have addi wpts)
+     *  sk()                Create skeleton for current cache (must have addi wpts) 
+     *  sk(number)          Create skeleton for number variables 
+     *  sk("letter")        Create skeleton for number of variables up to and including letter</pre>  
+     */
+    private void funcSkeleton(int nargs) throws Exception {
+   		String waypointName=Global.mainTab.lastselected;
+    	if (nargs==1) waypointName=popCalcStackAsString();
+    	int nVars=(int)Common.parseDouble(waypointName);
+    	// Check for case 4, i.e. sk("K")
+    	if (nVars==0 && waypointName.length()==1) nVars=((int)waypointName.toUpperCase().charAt(0)-(int)'A')+1;
+    	if (nVars>0 && nVars<100) { // e.g. sk(3)  or  sk("C") 
+			StringBuffer op=new StringBuffer(1000);
+    		// Write A=\n B=\n    etc.
+			for (int i=0; i<nVars; i++) op.append((char)(((int)'A')+i)+"=\n");
+			op.append("N0=\nE0=\n\ncls()\n");
+			for (int i=0; i<nVars; i++) {
+				op.append("IF "+((char)(((int)'A')+i))+ " THEN\n");
+				op.append("   N"+(char)(((int)'1')+i)+"=N"+(char)(((int)'0')+i)+"\n");
+				op.append("   E"+(char)(((int)'1')+i)+"=E"+(char)(((int)'0')+i)+"\n");
+				op.append("   NEXT=\"N \" N"+(char)(((int)'1')+i)+"\" E \" E"+(char)(((int)'1')+i)+"\n");
+				op.append("   STAGE=\"STAGE"+(char)(((int)'1')+i)+"\"\n");
+				op.append("\nENDIF\n"); //"STAGE1=" NEXT
 			}
+			op.append("IF NEXT THEN\n");
+			op.append("   STAGE \"=\" NEXT\n");
+			op.append("   goto(NEXT);\n");
+			op.append("ENDIF\n\n");
 			Global.mainTab.solverP.mText.appendText(op.toString(),true);
-		}// if hasAddiWpt
+    	} else {
+	    	int i=Global.getProfile().getCacheIndex(waypointName);
+			if (i<0) err(MyLocale.getMsg(1714,"Goto: Waypoint does not exist: ")+waypointName);
+	   	    CacheHolder ch=(CacheHolder)Global.getProfile().cacheDB.get(i);
+			CacheHolder addiWpt;
+			StringBuffer op=new StringBuffer(1000);
+	   	    if (ch.hasAddiWpt()){
+				for (int j=0; j<ch.addiWpts.getCount();j++){
+					addiWpt = (CacheHolder)ch.addiWpts.get(j);
+					op.append("IF $");
+					op.append(addiWpt.wayPoint);
+					op.append("=\"\" THEN\n   $");
+					op.append(addiWpt.wayPoint);
+					op.append("=\"\"");
+					//op.append(addiWpt.pos.toString());
+					op.append("\n   \"\"\n   \"Punkt ");
+					op.append(addiWpt.wayPoint.substring(0,2));
+					op.append(" [");
+					op.append(addiWpt.CacheName);
+					op.append("] = \" $");
+					op.append(addiWpt.wayPoint);
+					CacheHolderDetail chD=new CacheHolderDetail(addiWpt);
+					chD.readCache(Global.getProfile().dataDir);
+					if (chD.LongDescription.trim().length()>0)
+						op.append("\n   \""+STRreplace.replace(chD.LongDescription,"\"","\"\"")+"\"");
+					op.append("\n   goto($");
+					op.append(addiWpt.wayPoint);
+					op.append("); STOP\nENDIF\n\n");
+				}
+				Global.mainTab.solverP.mText.appendText(op.toString(),true);
+			}// if hasAddiWpt
+    	}
     }
     
     private double funcSqrt() throws Exception {
@@ -923,7 +957,7 @@
 //	    else if (funcDef.alias.equals("rs")) funcRequireSemicolon(nargs);
 	    else if (funcDef.alias.equals("show"));
 	    else if (funcDef.alias.equals("sin")) calcStack.add(new java.lang.Double(java.lang.Math.sin(popCalcStackAsNumber(0))));
-	    else if (funcDef.alias.equals("skeleton")) funcSkeleton(popCalcStackAsString());
+	    else if (funcDef.alias.equals("skeleton")) funcSkeleton(nargs);
 	    else if (funcDef.alias.equals("sqrt")) calcStack.add(new java.lang.Double(funcSqrt())); 
 	    else if (funcDef.alias.equals("sval")) calcStack.add(funcSval(popCalcStackAsString()));
 	    else if (funcDef.alias.equals("tan")) calcStack.add(new java.lang.Double(java.lang.Math.tan(popCalcStackAsNumber(0))));



From salzkammergut at mail.berlios.de  Wed Jun  6 21:10:17 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 6 Jun 2007 21:10:17 +0200
Subject: [Cachewolf-svn] r732 - trunk/src/CacheWolf
Message-ID: <200706061910.l56JAHjW025387@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-06 21:10:09 +0200 (Wed, 06 Jun 2007)
New Revision: 732

Modified:
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
Solver: Die Solverbefehle werden im Cache gespeichert und automatisch mit dem Cache geladen/gespeichert.
Es ist daher nicht mehr notwendig die Befehle in die Notes zu kopieren.

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2007-06-05 23:38:33 UTC (rev 731)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2007-06-06 19:10:09 UTC (rev 732)
@@ -27,10 +27,11 @@
 	  public Vector CacheIcons = new Vector();
 	  public String Bugs = EMPTY;
 	  public String URL = EMPTY;
+	  public String Solver = EMPTY;
 	  
 	 public CacheHolderDetail() {
 	 }
-	 public CacheHolderDetail(String wpt) {super(wpt); }
+	 //public CacheHolderDetail(String wpt) {super(wpt); }
 	 public CacheHolderDetail(CacheHolder ch) {
 		 super(ch);
 	 }
@@ -131,6 +132,7 @@
 			}else break;
 		 }
 		 noFindLogs = z;
+		 this.Solver=newCh.Solver;
 	 	return this;
 	  }
 	  
@@ -291,7 +293,8 @@
 					URL = "http://www.geocaching.com/seek/cache_details.aspx?wp="+ wayPoint + "&Submit6=Find&log=y";
 				}
 			}
-
+			ex = new Extractor(text, "<SOLVER><![CDATA[", "]]></SOLVER>", 0, true);
+			Solver=ex.findNext();
 		}
 		
 		/**
@@ -370,6 +373,7 @@
 				  detfile.print(Bugs+"\n");
 				  detfile.print("]]></BUGS>\n");
 				  detfile.print("<URL><![CDATA["+URL+"]]></URL>\r\n");
+				  detfile.print("<SOLVER><![CDATA["+Solver+"]]></SOLVER>\r\n");
 				  detfile.print("</CACHEDETAILS>\n");
 				} // if length
 			} catch (Exception e){

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-06-05 23:38:33 UTC (rev 731)
+++ trunk/src/CacheWolf/MainTab.java	2007-06-06 19:10:09 UTC (rev 732)
@@ -278,6 +278,10 @@
 		if(detP.isDirty()) {
 			detP.saveDirtyWaypoint();
 		}
+		if (solverP.isDirty()) {
+			chD.Solver=solverP.getInstructions();
+			chD.saveCacheDetails(Global.getProfile().dataDir);
+		}
 	}
 
 	/** Save the index file and any pending change in DetailsPanel

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2007-06-05 23:38:33 UTC (rev 731)
+++ trunk/src/CacheWolf/SolverPanel.java	2007-06-06 19:10:09 UTC (rev 732)
@@ -22,11 +22,26 @@
 	Preferences pref;
 	Profile profile;
 	String currFile;
-	CacheHolder currCh;
+	CacheHolder currChD;
 	Tokenizer tokenizer = new Tokenizer();
 	Parser parser = new Parser();
 	Vector msgFIFO = new Vector();
 	Menu mnuContext;
+	private boolean dirty=false;
+	
+	public boolean isDirty() {
+		return dirty;
+	}
+	
+	public String getInstructions() {
+		return mText.getText();
+	}
+	public void setInstructions(String text) {
+		mText.setText(text);
+		mText.repaint();
+	}
+	
+	
 	private class OutputPanel extends mTextPad {
 		MenuItem mnuClr;
 		OutputPanel() {
@@ -72,16 +87,18 @@
 
 		programPanel.addLast(new ScrollBarPanel(mText = new InputPanel()));
 		programPanel.addNext(mBtSolve= new mButton(MyLocale.getMsg(1735,"Solve!")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
-		programPanel.addNext(btnLoad= new mButton(MyLocale.getMsg(1736,"Load")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		/*programPanel.addNext(btnLoad= new mButton(MyLocale.getMsg(1736,"Load")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		programPanel.addNext(btnSave= new mButton(MyLocale.getMsg(1737,"Save")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		programPanel.addLast(btnSaveAs= new mButton(MyLocale.getMsg(1738,"SaveAs")),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		*/
 		outputPanel.addLast(new ScrollBarPanel(mOutput = new OutputPanel()));
 
 		this.addLast(split);
 	}
 	
-	public void setCh(CacheHolder ch) {
-		currCh=ch;
+	public void setCh(CacheHolderDetail chD) {
+		currChD=chD;
+		setInstructions(chD.Solver);
 	}
 
 	private void execDirectCommand() {
@@ -104,11 +121,12 @@
     }
 	
 	public void onEvent(Event ev){
+		if (ev.target==mText) {dirty=true; }
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if(ev.target == mBtSolve){
 				processCommand(mText.getText());
 			}
-			if(ev.target == btnLoad){
+/*			if(ev.target == btnLoad){
 				FileChooser fc = new FileChooser(FileChooser.OPEN, profile.dataDir);
 				
 				fc.addMask(currCh.wayPoint + ".wl");
@@ -153,7 +171,7 @@
 					}
 				}
 			}
-			
+*/			
 		}
 	}
 	



From kalli at mail.berlios.de  Wed Jun  6 21:29:45 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 6 Jun 2007 21:29:45 +0200
Subject: [Cachewolf-svn] r733 - trunk/src/CacheWolf
Message-ID: <200706061929.l56JTjQg027535@sheep.berlios.de>

Author: kalli
Date: 2007-06-06 21:29:44 +0200 (Wed, 06 Jun 2007)
New Revision: 733

Modified:
   trunk/src/CacheWolf/GPXImporter.java
Log:
Bugfix: GPX-Import von oc.de, Flag f?\195?\188r Travelbugs

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-06-06 19:10:09 UTC (rev 732)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-06-06 19:29:44 UTC (rev 733)
@@ -250,11 +250,6 @@
 			}
 			if (name.equals("groundspeak:finder")|| name.equals("geocacher")|| name.equals("terra:user")){
 				logFinder = new String(strData);
-				if(logIcon.equals("<img src='icon_smile.gif'>&nbsp;") && 
-				  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
-					holder.CacheStatus=logDate;
-					holder.is_found=true;
-				}
 				return;
 			}
 			if (name.equals("groundspeak:text") || name.equals("text") || name.equals("terra:entry")){ 
@@ -263,6 +258,11 @@
 			}
 			if (name.equals("groundspeak:log") || name.equals("log") || name.equals("terra:log") ) {
 				holder.CacheLogs.add(logIcon + logDate + " by " + logFinder + "</strong><br>" + logData + "<br>");
+				if(logIcon.equals("<img src='icon_smile.gif'>&nbsp;") && 
+						  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
+							holder.CacheStatus=logDate;
+							holder.is_found=true;
+				}
 				return;
 			}
 		}
@@ -353,13 +353,13 @@
 			return;
 		}
 		if (name.equals("groundspeak:travelbugs")) {
-			holder.has_bug = true;
 			inBug = false;
 			return;
 		}
 
 		if (name.equals("groundspeak:name")&& inBug) {
-			holder.Bugs += "<b>Name:</b> " + strData + "<br><hr>";  
+			holder.Bugs += "<b>Name:</b> " + strData + "<br><hr>";
+			holder.has_bug = true;
 			return;
 		}
 		



From kalli at mail.berlios.de  Wed Jun  6 21:35:32 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 6 Jun 2007 21:35:32 +0200
Subject: [Cachewolf-svn] r734 - branches/bugfix_09n/src/CacheWolf
Message-ID: <200706061935.l56JZWTe028046@sheep.berlios.de>

Author: kalli
Date: 2007-06-06 21:35:28 +0200 (Wed, 06 Jun 2007)
New Revision: 734

Modified:
   branches/bugfix_09n/src/CacheWolf/GPXImporter.java
Log:
Bugfix GPX-Import von oc.de

Modified: branches/bugfix_09n/src/CacheWolf/GPXImporter.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/GPXImporter.java	2007-06-06 19:29:44 UTC (rev 733)
+++ branches/bugfix_09n/src/CacheWolf/GPXImporter.java	2007-06-06 19:35:28 UTC (rev 734)
@@ -235,11 +235,6 @@
 			}
 			if (name.equals("groundspeak:finder")|| name.equals("geocacher")){
 				logFinder = new String(strData);
-				if(logIcon.equals("<img src='icon_smile.gif'>&nbsp;") && 
-				  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
-					holder.CacheStatus=logDate;
-					holder.is_found=true;
-				}
 				return;
 			}
 			if (name.equals("groundspeak:text") || name.equals("text")){ 
@@ -248,6 +243,11 @@
 			}
 			if (name.equals("groundspeak:log") || name.equals("log") ) {
 				holder.CacheLogs.add(logIcon + logDate + " by " + logFinder + "</strong><br>" + logData + "<br>");
+				if(logIcon.equals("<img src='icon_smile.gif'>&nbsp;") && 
+						  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && logFinder.equalsIgnoreCase(pref.myAlias2)))) {
+							holder.CacheStatus=logDate;
+							holder.is_found=true;
+				}
 				return;
 			}
 		}



From salzkammergut at mail.berlios.de  Wed Jun  6 21:50:59 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 6 Jun 2007 21:50:59 +0200
Subject: [Cachewolf-svn] r735 - in trunk: resources src/CacheWolf
Message-ID: <200706061950.l56Jox7D029079@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-06 21:50:46 +0200 (Wed, 06 Jun 2007)
New Revision: 735

Added:
   trunk/resources/GCTemplate.html
   trunk/resources/g.png
   trunk/resources/g2.png
   trunk/resources/y.png
   trunk/resources/y2.png
   trunk/src/CacheWolf/ShowCacheInBrowser.java
Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/CacheType.java
   trunk/src/CacheWolf/myTableControl.java
Log:
Neue Datei: ShowCacheInBrowser.java zeigt Cache offline im eingestellten Browser
(Derzeit nur fuer PC unter Windows verfuegbar).
Der Cache wird ueber ein Template GCTemplate.html dargestellt.
Diverse Elemente (Addi Wpts, Logs gesamt, einzelne Logs, Notes, Bugs und Solver-Befehle)
werden dargestellt und koennen individuell durch Klick auf (unterstrichene) Texte aus-/
eingeblendet werden um eine individuelle Darstellung (z.B. zum Ausdrucken) zu erreichen.

Added: trunk/resources/GCTemplate.html
===================================================================
--- trunk/resources/GCTemplate.html	2007-06-06 19:35:28 UTC (rev 734)
+++ trunk/resources/GCTemplate.html	2007-06-06 19:50:46 UTC (rev 735)
@@ -0,0 +1,149 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
+<!-- saved from url=(0014)http://localhost/ -->
+<!-- Note: The line above is needed to avoid the warning due to the javascript contained in this page.
+   Using javascript, various sections of the Cache listing can be hidden/unhidden. 
+   Try clicking on anything that is underlined.
+-->
+<html>
+<META HTTP-EQUIV="content-type" content="text/html; charset=utf-8" />
+<META HTTP-EQUIV="expires" CONTENT="Wed, 26 Feb 1997 08:21:57 GMT">
+<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
+<script type="text/javascript">
+function toggleDivOL( elemID ) { // Hide or show a DIV
+	var elem = document.getElementById( elemID );
+	if (!elem.style.display || elem.style.display=='block') {
+		elem.style.display='none';
+	} else {
+		elem.style.display='block';	
+	}
+}
+var logsVisible=true;
+function toggleAll() {
+	logsVisible=!logsVisible;
+	var logs = document.getElementsByName("log");
+	for (logElem=0; logElem<logs.length; logElem++) {
+		if (logsVisible) 
+			logs[logElem].style.display='block';
+		else
+			logs[logElem].style.display='none';
+	}
+}
+</script>
+<style type="text/css">
+body {
+	font-family: Verdana,sans-serif; font-size:80%;
+}
+.notes {
+	padding: 5px;
+	background-color: #EEEEEE;
+	border: 1px solid #000000;
+}
+.solver {
+	padding: 5px;
+	background-color: #EEEEEE;
+	border: 1px dashed #000000;
+}
+.logs {
+	padding: 5px;
+	background-color: #EEEEEE;
+}
+td { font-size:small;  }
+ at media screen {.clickHint {font-family: Arial; font-size:xx-small; padding-left:30px; display:inline; } }
+ at media print {.clickHint {font-family: Arial; font-size:xx-small; display:none; }
+</style>
+<head>
+	<title>Cache: <tmpl_var WAYPOINT> <tmpl_var CACHE_NAME> by <tmpl_var OWNER></title>
+</head>
+	
+<body bgcolor="#FFFFFF" LINK="#000000" VLINK="#000000" ALINK="#000000" TEXT="#000000" marginwidth="20" marginheight="0" leftmargin="20" topmargin="0">
+<div style="float:left;">
+	<img src=<tmpl_var TYPE> BORDER=0 WIDTH=32 HEIGHT=32><FONT face="Verdana" size="4"><strong> <tmpl_var CACHE_NAME></strong></FONT>
+	<FONT face="Verdana" size="2" style="font-size:X-Small;font-weight:bold;"> by <tmpl_var OWNER></FONT>
+	<br/><br/>
+    <strong><tmpl_var LATLON></strong> (WGS84)<br/>
+	Difficulty: <tmpl_var DIFFICULTY> 	Terrain: <tmpl_var TERRAIN>
+	<FONT face="Verdana" size="-2">&nbsp;&nbsp;&nbsp;(ratings out of 5 stars. 1 is easiest, 5 is hardest)</FONT><br/>
+	Container: <strong><tmpl_var SIZE></strong><br/><br/>
+	<table cellpadding=0>
+		<tr><td>Waypoint:</td><td> <tmpl_var WAYPOINT></td></tr>
+		<tr><td>Hidden:</td><td> <tmpl_var DATE></td></tr>
+		<tr><td>Distance:</td><td> <tmpl_var DISTANCE></td></tr>
+		<tr><td>Bearing:</td><td> <tmpl_var BEARING></td></tr>
+		<tr><td>Status:</td><td> <tmpl_var STATUS></td></tr>
+	</table>
+</div>
+<div style="float:right;margin:0; margin-top:10px"><FONT face="Verdana" size="4"><strong><tmpl_var WAYPOINT></strong></FONT></div>
+<div style="float:left">
+	<hr>
+<tmpl_if UNAVAILABLE>	
+	<FONT face="Verdana" color="red" size="+0">
+	<br/><strong>The cache is not currently available.<br/></strong>
+	</FONT>
+</tmpl_if>	
+
+	<br/>
+	<FONT face="Verdana" size="2">
+	<P><BLOCKQUOTE><span id="LongDescription"><tmpl_var DESCRIPTION></span></BLOCKQUOTE>
+	</FONT>
+<tmpl_if ADDIS><a href="javascript:toggleDivOL('addis');"><STRONG>Additional Waypoints</STRONG></a><BR/><br/>
+	<div id="addis"><TABLE cellSpacing=1 cellPadding=4 bgColor=#448e35 border=0>
+		<TBODY>
+			<TR bgColor=#c6e3c0>
+				<TH align=middle width=16>&nbsp;</TH>
+				<TH align=left>Waypoint</TH>
+				<TH align=left>Name</TH>
+				<TH align=left>Coordinate</TH>
+			<tmpl_loop ADDIS>	
+			<TR bgColor=#ffffff>
+				<TD vAlign=top align=middle width=16><tmpl_var IMG></TD>
+				<TD vAlign=top align=left><tmpl_var WAYPOINT></TD>
+				<TD vAlign=top align=left><tmpl_var NAME></TD>
+				<TD vAlign=top align=left><tmpl_var LATLON></TD></TR>
+			<TR bgColor=#ffffff>
+				<TD vAlign=top align=middle width=16>Note:</TD>
+				<TD vAlign=top align=left ColSpan=3><tmpl_var LONGDESC></TD>
+			</tmpl_loop>	
+		</TBODY>
+	</TABLE><BR/></div>	
+</tmpl_if>
+<tmpl_if IMAGES> 
+	<tmpl_loop IMAGES>
+		<a href="javascript:toggleDivOL(<tmpl_var I>);"><image src="images.gif" border=0> <tmpl_var IMAGETEXT></a><br/>
+		<div id=<tmpl_var I> style="display:none"><tmpl_var IMAGE></div>
+	</tmpl_loop>
+</tmpl_if>
+
+<tmpl_if HINT>
+	<br/><br/><STRONG>Additional Hints (Highlight blank area to see)</STRONG><br/>
+	<FONT face="Verdana" color="white" size="1"><tmpl_var HINT></FONT><br/><br/>
+</tmpl_if>
+
+<tmpl_if LOGS>
+	<br/><a href="javascript:toggleDivOL('logs');"><FONT face="Verdana" size="+0"><STRONG>Logs</STRONG></FONT></a><font class="clickHint" onClick="toggleAll();">Click 'Logs' to hide/unhide section; Click this to hide/unhide each log; Click any log to hide/unhide</font><br/><br/>
+	<div id="logs" class="logs">
+	<tmpl_loop LOGS>
+		<a href="javascript:toggleDivOL(<tmpl_var I>);"><tmpl_var LOGTYPE></a>
+		<div id=<tmpl_var I> name="log" style="display:block"><font face='Verdana' size='2'><tmpl_var LOG></font><br/>
+		<div><center><div style="width:66%"><hr></div></center></div></div>
+	</tmpl_loop>
+	</div>
+<tmpl_else><br/><STRONG>No logs</STRONG><br/>	
+</tmpl_if>
+<tmpl_if BUGS>
+	<hr>
+	<a href="javascript:toggleDivOL('bugs');"><FONT face="Verdana" size="+0"><STRONG>Bugs</STRONG></FONT></a><span class="clickHint">Click to hide/unhide section</span><br/><br/>
+	<div id="bugs" class="bugs"><tmpl_var BUGS></div>	
+</tmpl_if>
+<tmpl_if NOTES>
+<tmpl_if BUGS><TMPL_ELSE><hr></tmpl_if>
+    <a href="javascript:toggleDivOL('notes');"><FONT face="Verdana" size="+0"><STRONG>Personal Notes</STRONG></FONT></a><span class="clickHint">Click to hide/unhide section</span><br/><br/>
+	<div id="notes" class="notes"><br/><tmpl_var NOTES></div>
+</tmpl_if>
+<tmpl_if SOLVER>
+    <a href="javascript:toggleDivOL('solver');"><FONT face="Verdana" size="+0"><STRONG>Solver Instructions</STRONG></FONT></a><span class="clickHint">Click to hide/unhide section</span><br/><br/>
+	<div id="solver" class="solver"><br/><tmpl_var SOLVER></div>
+</tmpl_if>
+</div>
+</body>
+</html>
+

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-06-06 19:35:28 UTC (rev 734)
+++ trunk/resources/cachewolf.Languages.cfg	2007-06-06 19:50:46 UTC (rev 735)
@@ -218,6 +218,7 @@
 		1014=Markierte aktualisieren
 		1015=Alle w%e4hlen
 		1016=Alle abw%e4hlen
+		1018=Im Browser offline %f6ffnen
 		1019=Diesen als Zentrum setzen
 		1020=Im Browser online %f6ffnen
 		1021=Beschreibung %f6ffnen
@@ -562,6 +563,7 @@
 		1014=Update cache data
 		1015=Select all
 		1016=Deselect all
+		1018=Open offline in Browser
 		1019=Set this as center
 		1020=Open online in Browser
 		1021=Open cache description

Added: trunk/resources/g.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/g.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/g2.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/g2.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/y.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/y.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/y2.png
===================================================================
(Binary files differ)


Property changes on: trunk/resources/y2.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2007-06-06 19:35:28 UTC (rev 734)
+++ trunk/src/CacheWolf/CacheType.java	2007-06-06 19:50:46 UTC (rev 735)
@@ -133,6 +133,36 @@
 		return geo;
 	}
 	
+	/**
+	 * Returns the image name of a given internal type
+	 * @param type Type of cache
+	 * @return The image name of the cache
+	 */
+	public static String type2pic(int type) {
+		switch(type) {
+			case CW_TRADITIONAL:	return CW_PIC_TRADITIONAL;
+			case CW_MULTI:			return CW_PIC_MULTI;
+			case CW_VIRTUAL:		return CW_PIC_VIRTUAL;
+			case CW_LETTERBOX:		return CW_PIC_LETTERBOX;
+			case CW_EVENT:			return CW_PIC_EVENT;
+			case CW_QUIZ:			return CW_PIC_QUIZ;
+			case CW_UNKNOWN:		return CW_PIC_UNKNOWN;
+			case CW_MOVING:			return CW_PIC_MOVING;
+			case CW_DRIVE_IN:		return CW_PIC_DRIVE_IN;
+			case CW_WEBCAM:			return CW_PIC_WEBCAM;
+			case CW_LOCATIONLESS:	return CW_PIC_LOCATIONLESS;
+			case CW_CITO:			return CW_PIC_CITO;
+			case CW_MEGA_EVENT:		return CW_PIC_MEGA_EVENT;
+			case CW_PARKING:		return CW_PIC_PARKING;
+			case CW_STAGE_OF_MULTI:	return CW_PIC_STAGE_OF_MULTI;
+			case CW_QUESTION:		return CW_PIC_QUESTION;
+			case CW_FINAL:			return CW_PIC_FINAL;
+			case CW_TRAILHEAD:		return CW_PIC_TRAILHEAD;
+			case CW_REFERENCE:		return CW_PIC_REFERENCE;
+			default:		return "no_picture.png";
+		}
+	}
+
 	public static boolean isAddiWpt(String type){
 		if (type.equals("50")) return true;
 		if (type.equals("51")) return true;

Added: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-06 19:35:28 UTC (rev 734)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-06 19:50:46 UTC (rev 735)
@@ -0,0 +1,205 @@
+package CacheWolf;
+import com.stevesoft.ewe_pat.Regex;
+
+import ewe.io.BufferedWriter;
+import ewe.io.File;
+import ewe.io.FileWriter;
+import ewe.io.IOException;
+import ewe.io.PrintWriter;
+import ewe.sys.Convert;
+import ewe.sys.Vm;
+import ewe.ui.InputBox;
+import ewe.util.*;
+import ewe.util.Hashtable;
+import HTML.Template;
+
+
+public class ShowCacheInBrowser {
+	String saveTo=File.getProgramDirectory()+"/temp.html";
+	static Hashtable diff=null;
+	static Hashtable terr=null;
+	static Hashtable args=null;
+	
+	ShowCacheInBrowser() {
+		if (diff==null) {
+			diff=new Hashtable(15);
+			String y="<img src=\"./y.png\" border=0>";
+			String y2="<img src=\"./y2.png\" border=0>";
+			diff.put("1",y);
+			diff.put("1.5",y+y2);
+			diff.put("2",y+y);
+			diff.put("2.5",y+y+y2);
+			diff.put("3",y+y+y);
+			diff.put("3.5",y+y+y+y2);
+			diff.put("4",y+y+y+y);
+			diff.put("4.5",y+y+y+y+y2);
+			diff.put("5",y+y+y+y+y);
+	
+			terr=new Hashtable(15);
+			String g="<img src=\"./g.png\" border=0>";
+			String g2="<img src=\"./g2.png\" border=0>";
+			terr.put("1",g);
+			terr.put("1.5",g+g2);
+			terr.put("2",g+g);
+			terr.put("2.5",g+g+g2);
+			terr.put("3",g+g+g);
+			terr.put("3.5",g+g+g+g2);
+			terr.put("4",g+g+g+g);
+			terr.put("4.5",g+g+g+g+g2);
+			terr.put("5",g+g+g+g+g);
+			
+			args = new Hashtable();
+			args.put("filename", File.getProgramDirectory()+"/GCTemplate.html");
+			args.put("case_sensitive", "true");
+			args.put("loop_context_vars", Boolean.TRUE);
+			args.put("max_includes", new Integer(5));
+		}
+	}
+	
+	public void showCache(CacheHolderDetail chD) {
+		try {
+			Template tpl = new Template(args);
+			if(!chD.is_filtered){
+				Vm.showWait(true);
+				try{
+					chD.readCache(Global.getProfile().dataDir);
+				}catch(Exception e){
+					Vm.debug("Problem reading cache page");
+					Global.getPref().log("Problem reading Cache page");
+				}
+				try {
+					if (chD.wayPoint.startsWith("OC"))
+						tpl.setParam("TYPE", "\"./"+CacheType.transOCType(chD.type)+".gif\"");
+					else	
+						tpl.setParam("TYPE", "\"./"+chD.type+".gif\"");
+					tpl.setParam("SIZE", chD.CacheSize);
+					tpl.setParam("WAYPOINT", chD.wayPoint);
+					tpl.setParam("CACHE_NAME", chD.CacheName);
+					tpl.setParam("OWNER", chD.CacheOwner);
+					if (chD.hard.endsWith(".0")) chD.hard=chD.hard.substring(0,chD.hard.length()-2);
+					tpl.setParam("DIFFICULTY", (String) diff.get(chD.hard.replace(',','.')));
+					if (chD.terrain.endsWith(".0")) chD.terrain=chD.terrain.substring(0,chD.terrain.length()-2);
+					tpl.setParam("TERRAIN", (String) terr.get(chD.terrain.replace(',','.')));
+					tpl.setParam("DISTANCE", chD.distance.replace(',','.'));
+					tpl.setParam("BEARING", chD.bearing);
+					if (chD.pos!=null && chD.pos.isValid()) {
+						tpl.setParam("LATLON", chD.LatLon);
+					} else {
+						tpl.setParam("LATLON", "unknown");
+					}
+					// If status is of format yyyy-mm-dd prefix it with a "Found" message in local language
+					if (chD.CacheStatus.length()>=10 && chD.CacheStatus.charAt(4)=='-')
+						tpl.setParam("STATUS",MyLocale.getMsg(318,"Found")+" "+chD.CacheStatus);
+					else
+						tpl.setParam("STATUS", chD.CacheStatus);
+					tpl.setParam("DATE", chD.DateHidden);
+//					tpl.setParam("URL", ch.URL);
+					if (chD.Bugs!=null && chD.Bugs.trim().length()>0) tpl.setParam("BUGS",chD.Bugs);
+					if (chD.CacheNotes!=null && chD.CacheNotes.trim().length()>0) tpl.setParam("NOTES", STRreplace.replace(chD.CacheNotes,"\n","<br/>\n"));
+					if (chD.Solver!=null && chD.Solver.trim().length()>0) tpl.setParam("SOLVER", STRreplace.replace(chD.Solver,"\n","<br/>\n"));
+					// Look for images
+					
+					StringBuffer s=new StringBuffer(chD.LongDescription.length());
+					int start=0;
+					int pos;
+					int imageNo=0;
+					Regex imgRex = new Regex("src=(?:[^\"|']*?)(?:\"|')(.*?)(?:\"|')");
+					while (start>=0 && (pos=chD.LongDescription.indexOf("<img",start))>0) {
+						s.append(chD.LongDescription.substring(start,pos));
+						imgRex.searchFrom(chD.LongDescription,pos);
+						String imgUrl=imgRex.stringMatched(1);
+						Vm.debug("imgUrl "+imgUrl);
+						if (imgUrl.lastIndexOf('.')>0) {
+							String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
+							// If we have an image which we stored when spidering, we can display it
+							if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
+								s.append("<img src=\"file://"+
+								   Global.getProfile().dataDir+chD.Images.get(imageNo)+"\">");
+							}
+							imageNo++;
+						}
+						start=chD.LongDescription.indexOf(">",pos);
+						if (start>=0) start++;
+					}
+					if (start>=0) s.append(chD.LongDescription.substring(start));
+					tpl.setParam("DESCRIPTION", s.toString());
+					
+					// Do the remaining pictures which are not included in main body of text
+					// They will be hidden initially and can be displayed by clicking on a link
+					if (imageNo<chD.Images.size()) {
+						Vector imageVect=new Vector(chD.Images.size()-imageNo);
+						for (; imageNo<chD.Images.size(); imageNo++) {
+							Hashtable imgs=new Hashtable();
+							imgs.put("IMAGE","<img src=\"file://"+
+									   Global.getProfile().dataDir+chD.Images.get(imageNo)+"\" border=0>");
+							imgs.put("IMAGETEXT",chD.ImagesText.get(imageNo));
+							imgs.put("I","'img"+new Integer(imageNo).toString()+"'");
+							imageVect.add(imgs);
+						}
+						tpl.setParam("IMAGES",imageVect);
+					}
+					
+					Vector logVect=new Vector(chD.CacheLogs.size());
+					for (int i=0; i<chD.CacheLogs.size(); i++) {
+						Hashtable logs=new Hashtable();
+						String log=STRreplace.replace((String)chD.CacheLogs.get(i),"http://www.geocaching.com/images/icons/","");
+						int posGt=log.indexOf('>'); // Find the icon which defines the type of log
+						if (posGt<0) {
+							logs.put("LOG",log);
+							logs.put("LOGTYPE","");
+						} else {
+							int posBr=log.indexOf("<br>");
+							logs.put("LOG",log.substring(posBr));
+							logs.put("LOGTYPE",log.substring(0,posGt)+" border='0'"+log.substring(posGt,posBr+4));
+						}
+						logs.put("I","'log"+new Integer(i).toString()+"'");
+						logVect.add(logs);
+					}
+					tpl.setParam("LOGS",logVect);
+					if (!chD.is_available) tpl.setParam("UNAVAILABLE","1");
+					if (!chD.Hints.equals("null"))tpl.setParam("HINT",Common.rot13(chD.Hints));
+					
+					if (chD.hasAddiWpt()) {
+						Vector addiVect=new Vector(chD.addiWpts.size());
+						for (int i=0; i<chD.addiWpts.size(); i++) {
+							Hashtable addis=new Hashtable();
+							CacheHolder ch=(CacheHolder) chD.addiWpts.get(i);
+							addis.put("WAYPOINT",ch.wayPoint);
+							addis.put("NAME",ch.CacheName);
+							addis.put("LATLON",ch.LatLon);
+							addis.put("IMG","<img src=\""+CacheType.type2pic(Convert.parseInt(ch.type))+"\">");
+							CacheHolderDetail chDA=new CacheHolderDetail(ch);
+							chDA.readCache(Global.getProfile().dataDir);
+							addis.put("LONGDESC",chDA.LongDescription); // Do we need to treat longDesc as above ?
+							addiVect.add(addis);
+						}
+						tpl.setParam("ADDIS",addiVect);
+					}
+				}catch(Exception e){
+					Vm.debug("Problem getting Parameter, Cache: " + chD.wayPoint);
+					Global.getPref().log("Problem getting parameter "+e.toString()+", Cache: " + chD.wayPoint);
+					e.printStackTrace();
+				}
+			}
+			PrintWriter detfile; 
+			FileWriter fw = new FileWriter(saveTo);
+			detfile = new PrintWriter(new BufferedWriter(fw));
+			tpl.printTo(detfile);
+			//detfile.print(tpl.output());
+			detfile.close();
+			try {
+				String s = "\""+Global.getPref().browser+"\" \"file:"+saveTo+"\"";
+
+				Vm.exec(s,"",0,false); //Global.getPref().browser+" \"file:"+saveTo+"\"");
+				Global.getPref().log("Executing: "+s); //Global.getPref().browser+" \""+saveTo+"\"");
+			} catch (Exception ioex) {
+			}
+			
+		} catch(Exception e) {
+			e.printStackTrace();
+			Global.getPref().log("Error in ShowCache "+e.toString());
+		} finally {
+			Vm.showWait(false);
+		}
+	}
+}

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-06-06 19:35:28 UTC (rev 734)
+++ trunk/src/CacheWolf/myTableControl.java	2007-06-06 19:50:46 UTC (rev 735)
@@ -20,9 +20,11 @@
 		Menu m = new Menu(new String[]{
 				MyLocale.getMsg(1021,"Open description"),
 				MyLocale.getMsg(1010,"Goto"),
-				MyLocale.getMsg(1019,"enter"),
-				MyLocale.getMsg(1020,"open in $browser online"),
+				MyLocale.getMsg(1019,"Enter"),
 				"-",
+				MyLocale.getMsg(1020,"Open in $browser online"),
+				MyLocale.getMsg(1018,"Open in browser offline"),
+				"-",
 				MyLocale.getMsg(1011,"Filter"),
 				MyLocale.getMsg(1012,"Delete"),
 				MyLocale.getMsg(1014,"Update"),
@@ -31,6 +33,8 @@
 				MyLocale.getMsg(1016,"De-select all")},
 				MyLocale.getMsg(1013,"With selection"));
 		setMenu(m);
+		if (!Vm.getPlatform().equals("Win32") && !Vm.getPlatform().equals("Java"))
+		   ((MenuItem)m.items.get(5)).modifiers|=MenuItem.Disabled;
 		profile=Global.getProfile();
 		cacheDB = profile.cacheDB;
 		pref = Global.getPref();
@@ -186,6 +190,10 @@
 				(new MessageBox("Error", "Cannot start browser!\n"+ex.toString()+"\nThe are two possible reasons:\n * path to internet browser in \npreferences not correct\n * An bug in ewe VM, please be \npatient for an update",MessageBox.OKB)).execute();
 			}
 		}
+		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1018,"Open in browser offline"))) {
+			ShowCacheInBrowser sc=new ShowCacheInBrowser();
+			sc.showCache(new CacheHolderDetail((CacheHolder)cacheDB.get(tbp.getSelectedCache())));
+		}
 		if (selectedItem.toString().equalsIgnoreCase(MyLocale.getMsg(1021,"Open description"))){
 			penDoubleClicked(null);
 		}



From salzkammergut at mail.berlios.de  Wed Jun  6 22:58:47 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Wed, 6 Jun 2007 22:58:47 +0200
Subject: [Cachewolf-svn] r736 - trunk/src/CacheWolf
Message-ID: <200706062058.l56KwlVj001453@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-06 22:58:44 +0200 (Wed, 06 Jun 2007)
New Revision: 736

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
Solver: Bei Addis werden die Befehle des zugeh?\195?\182rigen Hauptcaches angezeigt

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-06-06 19:50:46 UTC (rev 735)
+++ trunk/src/CacheWolf/MainTab.java	2007-06-06 20:58:44 UTC (rev 736)
@@ -27,7 +27,7 @@
 	SolverPanel solverP;
 	String lastselected = new String();
 	CacheHolder ch=null;
-	CacheHolderDetail chD =null;
+	CacheHolderDetail chD =null, chMain=null;
 	MainMenu mnuMain;
 	StatusBar statBar;
 	MovingMap mm;
@@ -131,6 +131,7 @@
 			postEvent(new MultiPanelEvent(MultiPanelEvent.SELECTED,detP,0));
 		} else	
 			select(detP);
+		solverP.setInstructions("");
 		tbP.refreshTable();
 
 	}
@@ -219,7 +220,17 @@
 				break;
 			case 7:  // Solver Panel
 				MyLocale.setSIPButton();
-				solverP.setCh(chD);
+				if (chD.isAddiWpt()) { 
+					chMain=new CacheHolderDetail(chD.mainCache);
+					try {
+						chMain.readCache(profile.dataDir);
+					} catch(Exception e){pref.log("Error reading cache",e);}
+					//Vm.debug("mainT: AddiWaypoint:"+chD.wayPoint+", MainWp:"+chMain.wayPoint);
+					solverP.setInstructions(chMain.Solver);
+				} else {
+					//Vm.debug("mainT: Waypoint:"+chD.wayPoint);
+					solverP.setInstructions(chD.Solver);
+				}
 				break;
 			case 8:  // Cache Radar Panel
 				MyLocale.setSIPOff();
@@ -278,9 +289,15 @@
 		if(detP.isDirty()) {
 			detP.saveDirtyWaypoint();
 		}
-		if (solverP.isDirty()) {
-			chD.Solver=solverP.getInstructions();
-			chD.saveCacheDetails(Global.getProfile().dataDir);
+		if (chD!=null && solverP.isDirty()) {
+			if (chMain==null) {
+				chD.Solver=solverP.getInstructions();
+				chD.saveCacheDetails(Global.getProfile().dataDir);
+			} else {
+				chMain.Solver=solverP.getInstructions();
+				chMain.saveCacheDetails(Global.getProfile().dataDir);
+				chMain=null;
+			}
 		}
 	}
 

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2007-06-06 19:50:46 UTC (rev 735)
+++ trunk/src/CacheWolf/SolverPanel.java	2007-06-06 20:58:44 UTC (rev 736)
@@ -22,7 +22,6 @@
 	Preferences pref;
 	Profile profile;
 	String currFile;
-	CacheHolder currChD;
 	Tokenizer tokenizer = new Tokenizer();
 	Parser parser = new Parser();
 	Vector msgFIFO = new Vector();
@@ -96,11 +95,6 @@
 		this.addLast(split);
 	}
 	
-	public void setCh(CacheHolderDetail chD) {
-		currChD=chD;
-		setInstructions(chD.Solver);
-	}
-
 	private void execDirectCommand() {
 		InpScreen boxInp=new InpScreen(MyLocale.getMsg(1733,"Input command"));
 		boxInp.input(parent.getFrame(),"",100); //,MyLocale.getScreenWidth()*4/5);



From salzkammergut at mail.berlios.de  Thu Jun  7 00:10:25 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 7 Jun 2007 00:10:25 +0200
Subject: [Cachewolf-svn] r737 - trunk/src/CacheWolf
Message-ID: <200706062210.l56MAP1W007411@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-07 00:10:18 +0200 (Thu, 07 Jun 2007)
New Revision: 737

Modified:
   trunk/src/CacheWolf/ShowCacheInBrowser.java
Log:
ShowCacheInBrowser: Debug-Meldung entfernt, Bugfix bei Bilddarstellung

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-06 20:58:44 UTC (rev 736)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-06 22:10:18 UTC (rev 737)
@@ -108,15 +108,15 @@
 						s.append(chD.LongDescription.substring(start,pos));
 						imgRex.searchFrom(chD.LongDescription,pos);
 						String imgUrl=imgRex.stringMatched(1);
-						Vm.debug("imgUrl "+imgUrl);
+						//Vm.debug("imgUrl "+imgUrl);
 						if (imgUrl.lastIndexOf('.')>0) {
 							String imgType = (imgUrl.substring(imgUrl.lastIndexOf(".")).toLowerCase()+"    ").substring(0,4).trim();
 							// If we have an image which we stored when spidering, we can display it
 							if(!imgType.startsWith(".com") && !imgType.startsWith(".php") && !imgType.startsWith(".exe")){
 								s.append("<img src=\"file://"+
 								   Global.getProfile().dataDir+chD.Images.get(imageNo)+"\">");
+								imageNo++;
 							}
-							imageNo++;
 						}
 						start=chD.LongDescription.indexOf(">",pos);
 						if (start>=0) start++;
@@ -188,7 +188,7 @@
 			//detfile.print(tpl.output());
 			detfile.close();
 			try {
-				String s = "\""+Global.getPref().browser+"\" \"file:"+saveTo+"\"";
+				String s = "\""+Global.getPref().browser+"\" \"file://"+saveTo+"\"";
 
 				Vm.exec(s,"",0,false); //Global.getPref().browser+" \"file:"+saveTo+"\"");
 				Global.getPref().log("Executing: "+s); //Global.getPref().browser+" \""+saveTo+"\"");



From admin at berlios.de  Thu Jun  7 10:28:43 2007
From: admin at berlios.de (admin at berlios.de)
Date: Thu, 7 Jun 2007 10:28:43 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #1976] Meilen
Message-ID: <200706070828.l578ShwH001935@unicorn.berlios.de>

Feature Request #1976, was updated on 2006-Mar-16 21:19
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211

Category: Not planned
Status: Open
Priority: 5
Summary: Meilen

By: kalli
Date: 2007-Jun-07 10:28

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4

Bei der Gelegenheit auch an die Screens f?r die Entfernung
beim Spidern und OC-Sync denken.

----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Mar-16 21:19

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.1) Gecko/20060111 Firefox/1.5.0.1

Cachewolf sollte auch mit Meilen umgehen k?nnen.

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=1976&group_id=2211


From admin at berlios.de  Thu Jun  7 10:44:35 2007
From: admin at berlios.de (admin at berlios.de)
Date: Thu, 7 Jun 2007 10:44:35 +0200 (CEST)
Subject: [Cachewolf-svn] [Bug #11266] Bilder in Cachebeschreibungen OC-Sync
Message-ID: <200706070844.l578iZwM028762@unicorn.berlios.de>

Bug #11266, was updated on 2007-Jun-07 10:44
Here is a current snapshot of the bug.

Project: CacheWolf
Category: 1.0
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: kalli
Assigned to : none
Summary: Bilder in Cachebeschreibungen OC-Sync

Details: Beim Sync mit oc.de gibt es Probleme, wenn in den Beschreibungen Links auf externe Bilder gesetzt sind. Die Sinnhaftigkeit des Codes ist mir noch nicht so ganz klar.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=11266&group_id=2211


From admin at berlios.de  Thu Jun  7 14:08:27 2007
From: admin at berlios.de (admin at berlios.de)
Date: Thu, 7 Jun 2007 14:08:27 +0200 (CEST)
Subject: [Cachewolf-svn] [Bug #11266] Bilder in Cachebeschreibungen OC-Sync
Message-ID: <200706071208.l57C8RAN027599@unicorn.berlios.de>

Bug #11266, was updated on 2007-Jun-07 10:44
Here is a current snapshot of the bug.

Project: CacheWolf
Category: 1.0
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: kalli
Assigned to : none
Summary: Bilder in Cachebeschreibungen OC-Sync

Details: Beim Sync mit oc.de gibt es Probleme, wenn in den Beschreibungen Links auf externe Bilder gesetzt sind. Die Sinnhaftigkeit des Codes ist mir noch nicht so ganz klar.

Follow-Ups:

Date: 2007-Jun-07 14:08
By: pfeffer

Comment:
Wo gibt es da Probleme?
was ist Dir unklar?
Fragst Du am besten mit [DEV] im Forum, oder in #cachewolf auf freenet.

Sch?ne Gr??e,
   Pfeffer.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=11266&group_id=2211


From salzkammergut at mail.berlios.de  Thu Jun  7 20:45:10 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 7 Jun 2007 20:45:10 +0200
Subject: [Cachewolf-svn] r738 - trunk/src/CacheWolf
Message-ID: <200706071845.l57IjABf000061@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-07 20:45:06 +0200 (Thu, 07 Jun 2007)
New Revision: 738

Modified:
   trunk/src/CacheWolf/ShowCacheInBrowser.java
Log:
ShowCacheInBrowser: Aufruf der Vm.exec Funktion geaendert, da es im statisch gelinkten Exe nicht funktionierte

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-06 22:10:18 UTC (rev 737)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-07 18:45:06 UTC (rev 738)
@@ -190,7 +190,7 @@
 			try {
 				String s = "\""+Global.getPref().browser+"\" \"file://"+saveTo+"\"";
 
-				Vm.exec(s,"",0,false); //Global.getPref().browser+" \"file:"+saveTo+"\"");
+				Vm.exec(s); //Global.getPref().browser+" \"file:"+saveTo+"\"");
 				Global.getPref().log("Executing: "+s); //Global.getPref().browser+" \""+saveTo+"\"");
 			} catch (Exception ioex) {
 			}



From salzkammergut at mail.berlios.de  Thu Jun  7 22:35:24 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Thu, 7 Jun 2007 22:35:24 +0200
Subject: [Cachewolf-svn] r739 - in trunk: resources src/CacheWolf
Message-ID: <200706072035.l57KZOo9013107@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-07 22:35:18 +0200 (Thu, 07 Jun 2007)
New Revision: 739

Modified:
   trunk/resources/wolflang.html
   trunk/src/CacheWolf/Parser.java
Log:
Parser: Skeleton Befehl vereinfacht. Nur mehr zwei Aufrufe:
sk()  Fuer Caches mit Addis
sk(nStages)  Fuer Caches ohne Addis



Modified: trunk/resources/wolflang.html
===================================================================
--- trunk/resources/wolflang.html	2007-06-07 18:45:06 UTC (rev 738)
+++ trunk/resources/wolflang.html	2007-06-07 20:35:18 UTC (rev 739)
@@ -50,8 +50,9 @@
 project(coordinate,angle,distance)<br>
 goto(coordinate)<br>
 goto(coordinate,waypointname)<br><br>
-<b><u>Generate program for Multis</u></b><br>
-skeleton(waypointname)<br><br>
+<b><u>Generate program for Multis (with/without addi Wpts)</u></b><br>
+skeleton(waypointname)   also<br><br>
+skeleton(numberOfStages)<br><br>
 <b><u>IF THEN ENDIF</u></b><br>
 IF condition THEN statement; statement .... ENDIF<br><br>
 </font>

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2007-06-07 18:45:06 UTC (rev 738)
+++ trunk/src/CacheWolf/Parser.java	2007-06-07 20:35:18 UTC (rev 739)
@@ -45,6 +45,7 @@
 package CacheWolf;
 
 import ewe.util.*;
+import com.stevesoft.ewe_pat.*;
 import ewe.sys.*;
 import java.lang.Double;
 
@@ -573,42 +574,49 @@
     }
     
     /** Create a skeleton for multis. This function can be called in three ways:<br>
-     *  <pre>sk("waypointname")  Create skeleton for a give waypointname (must have addi wpts)
-     *  sk()                Create skeleton for current cache (must have addi wpts) 
+     *  <pre>sk()                Create skeleton for current cache (must have addi wpts) 
      *  sk(number)          Create skeleton for number variables 
-     *  sk("letter")        Create skeleton for number of variables up to and including letter</pre>  
      */
     private void funcSkeleton(int nargs) throws Exception {
    		String waypointName=Global.mainTab.lastselected;
-    	if (nargs==1) waypointName=popCalcStackAsString();
-    	int nVars=(int)Common.parseDouble(waypointName);
-    	// Check for case 4, i.e. sk("K")
-    	if (nVars==0 && waypointName.length()==1) nVars=((int)waypointName.toUpperCase().charAt(0)-(int)'A')+1;
-    	if (nVars>0 && nVars<100) { // e.g. sk(3)  or  sk("C") 
-			StringBuffer op=new StringBuffer(1000);
-    		// Write A=\n B=\n    etc.
-			for (int i=0; i<nVars; i++) op.append((char)(((int)'A')+i)+"=\n");
-			op.append("N0=\nE0=\n\ncls()\n");
-			for (int i=0; i<nVars; i++) {
-				op.append("IF "+((char)(((int)'A')+i))+ " THEN\n");
-				op.append("   N"+(char)(((int)'1')+i)+"=N"+(char)(((int)'0')+i)+"\n");
-				op.append("   E"+(char)(((int)'1')+i)+"=E"+(char)(((int)'0')+i)+"\n");
-				op.append("   NEXT=\"N \" N"+(char)(((int)'1')+i)+"\" E \" E"+(char)(((int)'1')+i)+"\n");
-				op.append("   STAGE=\"STAGE"+(char)(((int)'1')+i)+"\"\n");
-				op.append("\nENDIF\n"); //"STAGE1=" NEXT
-			}
-			op.append("IF NEXT THEN\n");
-			op.append("   STAGE \"=\" NEXT\n");
-			op.append("   goto(NEXT);\n");
-			op.append("ENDIF\n\n");
+    	int ci=Global.getProfile().getCacheIndex(waypointName);
+    	if (ci<0) return;
+    	// If it is an addi, find its main cache
+    	if (((CacheHolder) Global.getProfile().cacheDB.get(ci)).isAddiWpt()) {
+    		waypointName=((CacheHolder) Global.getProfile().cacheDB.get(ci)).mainCache.wayPoint;
+    	}
+   		int nStages=-1;
+    	if (nargs==1) {
+    		nStages=(int)popCalcStackAsNumber(-1.0);
+    	}
+    	// Remove the sk command from the instructions
+    	Regex rex=new Regex("sk\\(.*?\\)","");
+    	Global.mainTab.solverP.mText.setText(rex.replaceFirst(Global.mainTab.solverP.mText.getText()));
+		StringBuffer op=new StringBuffer(1000);
+    	// Check for sk(number)
+    	if (nStages>0 && nStages<30) { // e.g. sk(3)
+			/*IF $01xxxx="" THEN
+			   $01xxxx=""
+			   "Station 1 = " $01xxxx
+			   goto($01xxxx); STOP
+			ENDIF*/
+			for (int i=0; i<nStages; i++) {
+				String stage=MyLocale.formatLong(i+1,"00");
+				String stageWpt="$"+stage+waypointName.substring(2);
+				op.append("IF "+stageWpt+"=\"\" THEN\n");
+				op.append("  "+stageWpt+" = \"\"\n");
+				op.append("  \"Stage "+(i+1)+" = \" "+stageWpt+"\n");
+				op.append("  goto("+stageWpt+"); STOP\n");
+				op.append("ENDIF\n");
+			}		
 			Global.mainTab.solverP.mText.appendText(op.toString(),true);
     	} else {
 	    	int i=Global.getProfile().getCacheIndex(waypointName);
 			if (i<0) err(MyLocale.getMsg(1714,"Goto: Waypoint does not exist: ")+waypointName);
 	   	    CacheHolder ch=(CacheHolder)Global.getProfile().cacheDB.get(i);
 			CacheHolder addiWpt;
-			StringBuffer op=new StringBuffer(1000);
 	   	    if (ch.hasAddiWpt()){
+	   	    	op.append("cls()\n");
 				for (int j=0; j<ch.addiWpts.getCount();j++){
 					addiWpt = (CacheHolder)ch.addiWpts.get(j);
 					op.append("IF $");
@@ -617,7 +625,7 @@
 					op.append(addiWpt.wayPoint);
 					op.append("=\"\"");
 					//op.append(addiWpt.pos.toString());
-					op.append("\n   \"\"\n   \"Punkt ");
+					op.append("\n   \"Punkt ");
 					op.append(addiWpt.wayPoint.substring(0,2));
 					op.append(" [");
 					op.append(addiWpt.CacheName);



From salzkammergut at mail.berlios.de  Fri Jun  8 20:59:49 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Fri, 8 Jun 2007 20:59:49 +0200
Subject: [Cachewolf-svn] r740 - trunk/src/CacheWolf
Message-ID: <200706081859.l58Ixnpu014339@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-08 20:59:41 +0200 (Fri, 08 Jun 2007)
New Revision: 740

Modified:
   trunk/src/CacheWolf/Tokenizer.java
Log:
Tokenizer: Robusterer Tokenizer der auch mit diversen ungewoehnlichen Unicodezeichen fertig wird


Modified: trunk/src/CacheWolf/Tokenizer.java
===================================================================
--- trunk/src/CacheWolf/Tokenizer.java	2007-06-07 20:35:18 UTC (rev 739)
+++ trunk/src/CacheWolf/Tokenizer.java	2007-06-08 18:59:41 UTC (rev 740)
@@ -50,6 +50,22 @@
 		return "?!<>(){}*/,;^+-=".indexOf(c)!=-1;
 	}
 
+	/**
+	 * Convert Unicode version of special chars to normal
+	 * @param c Char to convert
+	 * @return Converted char
+	 */
+	private char standardizeSourceChar(char c) {
+		if (c=='\u00A0' || (c>='\u2002' && c<='\u200b')) c=' ';
+		if (c>='\u2010' && c<='\u2015') c='-';
+		if (c>='\u201c' && c<='\u201f') c='"';
+		if (c=='[') c='(';
+		if (c==']') c=')';
+		if (c=='\u00f7' || c=='\u2044') c='/';
+		if (c=='\u2024') c='.';
+		return c;
+	}
+
 	private boolean getChar(){
 		if(sourcePointer >= mySource.length()) {
 			look='\n';
@@ -63,8 +79,10 @@
 	private char lookAhead() {
 		if(sourcePointer >= mySource.length())
 			return '\n';
-		else
-			return mySource.charAt(sourcePointer);
+		else {
+			char c=standardizeSourceChar(mySource.charAt(sourcePointer));
+			return c;
+		}
 	}
 	
 	private void backUp() {
@@ -117,6 +135,7 @@
 		boolean foundDecSep=false; // To check that only one decimal point is allowed in a number
 		startToken();
 		while(getChar()){
+			look=standardizeSourceChar(look);
 			if(isDigit(look) || (look=='.' && !foundDecSep)) {
 				currentStream += look;
 				if (look=='.') foundDecSep=true;
@@ -194,6 +213,7 @@
 		currentStream="";
 		startToken();
 		while (getChar() && look!=':') {
+			look=standardizeSourceChar(look);
 			currentStream += look;
 			if (look!='.' && look!='0' && look!='#') err(MyLocale.getMsg(1731,"Invalid format character"));
 		}
@@ -210,12 +230,13 @@
 		currentStream="";
 		try {
 			while(getChar()){
-				if (look==' ' || look=='\u00A0') continue;
+				look=standardizeSourceChar(look);
+				if (look==' ') continue;
 				currentStream += look;
 				if(isAlpha(look) || look=='$') streamAlphas();
 				else if(isDigit(look)) streamDigits();
 				else if(isSymbol(look)) streamSymbol();
-				else if(look == '\"') streamString();  
+				else if(look == '"') streamString();  
 				else if(look == '\n') {
 					if (newLineIsSeparator && !currentStream.equals("\\\n") && !currentStream.equals("_\n")) { 
 						currentStream=";";



From salzkammergut at mail.berlios.de  Fri Jun  8 23:54:24 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Fri, 8 Jun 2007 23:54:24 +0200
Subject: [Cachewolf-svn] r741 - trunk/src/CacheWolf
Message-ID: <200706082154.l58LsOcm026332@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-08 23:54:21 +0200 (Fri, 08 Jun 2007)
New Revision: 741

Modified:
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Gelegentliche "null" am Anfang der Cachebeschreibung eliminiert

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-08 18:59:41 UTC (rev 740)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-08 21:54:21 UTC (rev 741)
@@ -531,7 +531,7 @@
 		Regex rex2 = new Regex(p.getProperty("longDescRex"));
 		inRex.search(doc);
 		rex2.search(doc);
-		res = inRex.stringMatched(1) + "<br>";
+		res = ((inRex.stringMatched(1)==null)?"":inRex.stringMatched(1)) + "<br>";
 		res += rex2.stringMatched(1); 
 		return SafeXML.cleanback(res);
 	}



From salzkammergut at mail.berlios.de  Sat Jun  9 22:49:09 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 9 Jun 2007 22:49:09 +0200
Subject: [Cachewolf-svn] r742 - trunk/src/CacheWolf
Message-ID: <200706092049.l59Kn97I012108@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-09 22:49:04 +0200 (Sat, 09 Jun 2007)
New Revision: 742

Modified:
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/Tokenizer.java
Log:
Solver: Bessere Anzeige der Fehlerstelle bei Syntax oder Ausfuehrungsfehlern.
In der betreffenden Zeile wird der Text vom Anfang der Zeile bis zum Fehler selektiert (=invertiert dargestellt).

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2007-06-08 21:54:21 UTC (rev 741)
+++ trunk/src/CacheWolf/Parser.java	2007-06-09 20:49:04 UTC (rev 742)
@@ -162,7 +162,7 @@
     	messageStack.add(MyLocale.getMsg(1700,"Error on line: ") + thisToken.line + "  "+MyLocale.getMsg(1701,"position: ") + thisToken.position);
     	messageStack.add(str);
     	// move cursor to error location
-    	Global.mainTab.solverP.mText.setSelectionRange(thisToken.position-1,thisToken.line-1,thisToken.position+thisToken.token.length()-1,thisToken.line-1);
+    	if (Global.mainTab.solverP.mText.setSelectionRange(0,thisToken.line-1,thisToken.position+thisToken.token.length()-1,thisToken.line-1))Global.mainTab.solverP.mText.repaintNow();
     	throw new Exception("Error "+str);
     }
     

Modified: trunk/src/CacheWolf/Tokenizer.java
===================================================================
--- trunk/src/CacheWolf/Tokenizer.java	2007-06-08 21:54:21 UTC (rev 741)
+++ trunk/src/CacheWolf/Tokenizer.java	2007-06-09 20:49:04 UTC (rev 742)
@@ -35,6 +35,7 @@
     private void err(String str) throws Exception {
     	messageStack.add(MyLocale.getMsg(1700,"Error on line: ") + currentLine + "  "+MyLocale.getMsg(1701," position: ") + currentPos);
     	messageStack.add(str);
+    	if (Global.mainTab.solverP.mText.setSelectionRange(0,currentLine-1,currentPos,currentLine-1))Global.mainTab.solverP.mText.repaintNow();
     	throw new Exception("Error "+str);
     }
 



From salzkammergut at mail.berlios.de  Sun Jun 10 11:18:02 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 10 Jun 2007 11:18:02 +0200
Subject: [Cachewolf-svn] r743 - trunk/src/CacheWolf
Message-ID: <200706100918.l5A9I2ni031403@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-10 11:17:58 +0200 (Sun, 10 Jun 2007)
New Revision: 743

Modified:
   trunk/src/CacheWolf/SearchCache.java
Log:
SearchCache: Bugfix. Klein geschriebene Waypoints wurden nicht gefunden

Modified: trunk/src/CacheWolf/SearchCache.java
===================================================================
--- trunk/src/CacheWolf/SearchCache.java	2007-06-09 20:49:04 UTC (rev 742)
+++ trunk/src/CacheWolf/SearchCache.java	2007-06-10 09:17:58 UTC (rev 743)
@@ -33,7 +33,7 @@
 			for(int i = 0;i < cacheDB.size();i++){
 				ch = (CacheHolder)cacheDB.get(i);
 				if (ch.is_filtered) break; // Reached end of visible records
-				if(ch.wayPoint.indexOf(searchStr) <0 && 
+				if(ch.wayPoint.toUpperCase().indexOf(searchStr) <0 && 
 				   ch.CacheName.toUpperCase().indexOf(searchStr) <0){
 					ch.is_flaged = false;
 					ch.is_filtered = true;



From salzkammergut at mail.berlios.de  Sun Jun 10 23:12:52 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 10 Jun 2007 23:12:52 +0200
Subject: [Cachewolf-svn] r744 - trunk/src/CacheWolf
Message-ID: <200706102112.l5ALCqQ4016312@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-10 23:12:49 +0200 (Sun, 10 Jun 2007)
New Revision: 744

Modified:
   trunk/src/CacheWolf/OCXMLImporter.java
Log:
OCXMLImporter: Anpassung an Umstellung auf CacheHolder/CacheHolderDetail.
  (Weitere Tests notwendig)

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2007-06-10 09:17:58 UTC (rev 743)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2007-06-10 21:12:49 UTC (rev 744)
@@ -32,7 +32,8 @@
 	boolean debugGPX = false;
 	Vector cacheDB;
 	InfoBox inf;
-	CacheHolderDetail holder;
+	CacheHolder ch;
+	CacheHolderDetail chD;
 	Preferences pref;
 	Profile profile;
 	Time dateOfthisSync;
@@ -65,11 +66,11 @@
 			incUpdate = false;
 		}
 		user = p.myAlias.toLowerCase();
-		CacheHolder ch;
 		for(int i = 0; i<cacheDB.size();i++){
 			ch = (CacheHolder)cacheDB.get(i);
 			DBindexWpt.put((String)ch.wayPoint, new Integer(i));
-			DBindexID.put((String)ch.ocCacheID, new Integer(i));
+			if (!ch.ocCacheID.equals(""))
+				DBindexID.put((String)ch.ocCacheID, new Integer(i));
 		}//for
 
 	}
@@ -102,7 +103,6 @@
 			}
 			profile.distOC = dist;
 			// Clear status of caches in db
-			CacheHolder ch;
 			for(int i = 0; i<cacheDB.size();i++){
 				ch = (CacheHolder)cacheDB.get(i);
 				ch.is_update = false;
@@ -111,19 +111,19 @@
 			}	
 			picCnt = 0;
 			//Build url
-			url ="http://" + OPENCACHING_HOST + "/xml/ocxml11.php?";
-			url += "modifiedsince=" + lastS;
-			url +="&cache=1";
-			url +="&cachedesc=1";
-			url +="&picture=1";
-			url +="&cachelog=1";
-			url +="&removedobject=0";
-			url +="&lat=" + center.getLatDeg(CWPoint.DD);
-			url +="&lon=" + center.getLonDeg(CWPoint.DD);
-			url +="&distance=" + dist;
-			url +="&charset=utf-8";
-			url +="&cdata=0";
-			url +="&session=0";
+			url ="http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
+				+ "modifiedsince=" + lastS
+				+ "&cache=1"
+				+ "&cachedesc=1"
+				+ "&picture=1"
+				+ "&cachelog=1"
+				+ "&removedobject=0"
+				+ "&lat=" + center.getLatDeg(CWPoint.DD)
+				+ "&lon=" + center.getLonDeg(CWPoint.DD)
+				+ "&distance=" + dist
+				+ "&charset=utf-8"
+				+ "&cdata=0"
+				+ "&session=0";
 			inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
 			inf.setPreferredSize(220, 300);
 			inf.relayout(false);
@@ -166,15 +166,15 @@
 				success = false;
 			}
 		}catch (IllegalArgumentException e) {
-			finalMessage = MyLocale.getMsg(1621,"Error parsing update file\n this is likely a bug in opencaching.de\nplease try again later\n, state:")+" "+state+", waypoint: "+ holder.wayPoint;
+			finalMessage = MyLocale.getMsg(1621,"Error parsing update file\n this is likely a bug in opencaching.de\nplease try again later\n, state:")+" "+state+", waypoint: "+ chD.wayPoint;
 			success = false;
-			Vm.debug("Parse error: " + state + " " + holder.wayPoint);
+			Vm.debug("Parse error: " + state + " " + chD.wayPoint);
 			e.printStackTrace();
 		}catch (Exception e){ // here schould be used the correct exepion
-			if (holder != null)	finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: "+ holder.wayPoint;
+			if (chD != null)	finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: "+ chD.wayPoint;
 			else finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: <unkown>";
 			success = false;
-			Vm.debug("Parse error: " + state + " " + holder.wayPoint);
+			Vm.debug("Parse error: " + state + " Exception:" + e.toString()+"   "+chD.ocCacheID);
 			e.printStackTrace();
 		}
 		Vm.showWait(false);
@@ -257,27 +257,27 @@
 			cacheID = atts.getValue("id");
 		}
 		if(name.equals("type")){
-			holder.type = CacheType.transOCType(atts.getValue("id"));
+			chD.type = CacheType.transOCType(atts.getValue("id"));
 			return;
 		}
 		if(name.equals("status")){
-			if(atts.getValue("id").equals("1")) holder.is_available = true;
-			if(atts.getValue("id").equals("2")) holder.is_available = false;
+			if(atts.getValue("id").equals("1")) chD.is_available = true;
+			if(atts.getValue("id").equals("2")) chD.is_available = false;
 			if(atts.getValue("id").equals("3")) {
-				holder.is_archived = true;
-				holder.is_available = false;
+				chD.is_archived = true;
+				chD.is_available = false;
 			}
-			if(atts.getValue("id").equals("4")) holder.is_available = false;
+			if(atts.getValue("id").equals("4")) chD.is_available = false;
 			return;
 		}
 		if(name.equals("size")){
-			holder.CacheSize = transSize(atts.getValue("id"));
+			chD.CacheSize = transSize(atts.getValue("id"));
 			return;
 		}
 
 		if(name.equals("waypoints")){
-			holder.wayPoint = atts.getValue("oc");
-			if (holder.wayPoint.length()==0) throw new IllegalArgumentException("empty waypointname"); // this should not happen - it is likey a bug in opencaching.de / it happens on 27-12-2006 on cache OC143E
+			chD.wayPoint = atts.getValue("oc");
+			if (chD.wayPoint.length()==0) throw new IllegalArgumentException("empty waypointname"); // this should not happen - it is likey a bug in opencaching.de / it happens on 27-12-2006 on cache OC143E
 			return;
 		}
 
@@ -289,11 +289,11 @@
 		}
 
 		if (name.equals("desc")){
-			holder.is_HTML = atts.getValue("html").equals("1")?true:false;
+			chD.is_HTML = atts.getValue("html").equals("1")?true:false;
 		}
 
 		if (name.equals("language") && !atts.getValue("id").equals("DE")){
-			if (holder.LongDescription.length()> 0) ignoreDesc = true; // TODO "DE" in preferences adjustable
+			if (chD.LongDescription.length()> 0) ignoreDesc = true; // TODO "DE" in preferences adjustable
 			else ignoreDesc = false;
 		}
 	}
@@ -312,12 +312,12 @@
 			case 1: 
 				logIcon = GPXImporter.typeText2Image("Found"); 
 				if (logFinder.equalsIgnoreCase(user) || logFinder.equalsIgnoreCase(pref.myAlias2)) { // see also endCacheLog
-					holder.is_found = true; 
-					holder.CacheStatus = MyLocale.getMsg(318,"Found");
+					chD.is_found = true; 
+					chD.CacheStatus = MyLocale.getMsg(318,"Found");
 				}
 				break;
 			case 2:	logIcon = GPXImporter.typeText2Image("Not Found"); 
-			holder.noFindLogs += 1;
+			chD.noFindLogs += 1;
 			break;
 			case 3: logIcon = GPXImporter.typeText2Image("Note");
 			}
@@ -333,25 +333,25 @@
 	private void endCache(String name){
 		if (name.equals("cache")){
 			int index;
-			index = searchWpt(holder.wayPoint);
+			index = searchWpt(chD.wayPoint);
 			if (index == -1){
-				holder.is_new = true;
-				cacheDB.add(holder);
-				DBindexWpt.put((String)holder.wayPoint, new Integer(cacheDB.size()-1));
-				DBindexID.put((String)holder.ocCacheID, new Integer(cacheDB.size()-1));
+				chD.is_new = true;
+				cacheDB.add(new CacheHolder(chD));
+				DBindexWpt.put((String)chD.wayPoint, new Integer(cacheDB.size()-1));
+				DBindexID.put((String)chD.ocCacheID, new Integer(cacheDB.size()-1));
 			}
 			// update (overwrite) data
 			else {
-				holder.is_new = false;
-				cacheDB.set(index, holder);
+				chD.is_new = false;
+				cacheDB.set(index, new CacheHolder(chD));
 				// save ocCacheID, in case, the previous data is from GPX
-				DBindexID.put((String)holder.ocCacheID, new Integer(index));
+				DBindexID.put((String)chD.ocCacheID, new Integer(index));
 			}
 			// clear data (picture, logs) if we do a complete Update
 			if (incUpdate == false){
-				holder.CacheLogs.clear();
-				holder.Images.clear();
-				holder.ImagesText.clear();
+				chD.CacheLogs.clear();
+				chD.Images.clear();
+				chD.ImagesText.clear();
 			}
 			/*			if(holder.LatLon.length() > 1 && holder.is_archived == false &&
 					pref.downloadMapsOC){
@@ -381,49 +381,46 @@
 			} */
 
 			// save all
-			holder.saveCacheDetails(profile.dataDir); 
+			chD.saveCacheDetails(profile.dataDir); 
 			// profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR); // this is done after .xml is completly processed
 			return;
 		}
-		if(name.equals("id")){
-			holder = getHolder(strData);
-			holder.URL = ocSeekUrl + cacheID;
+		if(name.equals("id")){ // </id>
+			chD = getHolder(strData); // Allocate a new CacheHolder object
+			chD.ocCacheID=strData;
+			chD.URL = ocSeekUrl + cacheID;
 			return;
 		}
 
 		if(name.equals("name")){
-			holder.CacheName = strData;
+			chD.CacheName = strData;
 			return;
 		}
 		if(name.equals("userid")) {
-			holder.CacheOwner = strData;
-			if(holder.CacheOwner.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && holder.CacheOwner.equalsIgnoreCase(pref.myAlias2))) holder.is_owned = true;
+			chD.CacheOwner = strData;
+			if(chD.CacheOwner.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()>0 && chD.CacheOwner.equalsIgnoreCase(pref.myAlias2))) chD.is_owned = true;
 			return;
 		}
 
 		if(name.equals("longitude")){
-			holder.LatLon = GPXImporter.londeg2min(strData);
+			chD.LatLon = GPXImporter.londeg2min(strData);
 			return;
 		}
 		if(name.equals("latitude")) {
-			holder.LatLon = GPXImporter.latdeg2min(strData) + " " + holder.LatLon;
-			holder.pos.set(holder.LatLon);
+			chD.LatLon = GPXImporter.latdeg2min(strData) + " " + chD.LatLon;
+			chD.pos.set(chD.LatLon);
 			return;
 		}
 		if(name.equals("difficulty")) {
-			holder.hard = strData;
+			chD.hard = strData;
 			return;
 		}
 		if(name.equals("terrain")) {
-			holder.terrain = strData;
+			chD.terrain = strData;
 			return;
 		}
 		if(name.equals("datehidden")) {
-			//String Date = new String();
-			//Date = strData.substring(5,7); // month
-			//Date += "/" + strData.substring(8,10); // day
-			//Date += "/" + strData.substring(0,4); // year
-			holder.DateHidden = strData.substring(0,10); //Date;
+			chD.DateHidden = strData.substring(0,10); //Date;
 			return;
 		}
 	}
@@ -432,7 +429,7 @@
 
 		if (!ignoreDesc){
 			if (name.equals("cachedesc")){
-				if (pref.downloadPicsOC && holder.is_HTML) {
+				if (pref.downloadPicsOC && chD.is_HTML) {
 					String fetchUrl, imgTag, imgAltText;
 					Regex imgRegexUrl = new Regex("(<img[^>]*src=[\"\']([^>^\"^\']*)[^>]*>|<img[^>]*src=([^>^\"^\'^ ]*)[^>]*>)"); //  Ergebnis enth?lt keine Anf?hrungszeichen
 					Regex imgRegexAlt = new Regex("(?:alt=[\"\']([^>^\"^\']*)|alt=([^>^\"^\'^ ]*))"); // get alternative text for Pic
@@ -440,12 +437,12 @@
 					imgRegexUrl.setIgnoreCase(true);
 					int descIndex=0;
 					int numDownloaded=1;
-					while (imgRegexUrl.searchFrom(holder.LongDescription, descIndex)) { // "img" found
+					while (imgRegexUrl.searchFrom(chD.LongDescription, descIndex)) { // "img" found
 						imgTag=imgRegexUrl.stringMatched(1); // (1) enth?lt das gesamte <img ...>-tag
 						fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anf?hrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anf?hrungszeichen 
 						if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
 						if (fetchUrl==null) { // TODO Fehler ausgeben: nicht abgedeckt ist der Fall, dass in einem Cache Links auf Bilder mit unterschiedlichen URL, aber gleichem Dateinamen sind.
-							inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+holder.wayPoint));
+							inf.addWarning(MyLocale.getMsg(1617, "Ignoriere Fehler in html-Cache-Description: \"<img\" without \"src=\" in cache "+chD.wayPoint));
 							continue;
 						}
 						inf.setInfo(MyLocale.getMsg(1611,"Importing cache description:")+" " + numDescImported + "\n"+MyLocale.getMsg(1620, "downloading embedded images: ") + numDownloaded++);
@@ -462,30 +459,30 @@
 						getPic(fetchUrl, imgAltText);
 					}
 				}
-				holder.saveCacheDetails(profile.dataDir);
+				chD.saveCacheDetails(profile.dataDir);
 				return;
 			}
 
 
 			if (name.equals("cacheid")){
 				// load cachedata
-				holder = getHolder(strData);
-				holder.is_update = true;
+				chD = getHolder(strData);
+				chD.is_update = true;
 				return;
 			}
 
 			if (name.equals("shortdesc")){
-				holder.LongDescription = strData;
+				chD.LongDescription = strData;
 				return;
 			}
 
-			if (name.equals("desc")){
-				if (holder.is_HTML)	holder.LongDescription +=SafeXML.cleanback(strData);
-				else holder.LongDescription +=strData;
+			if (name.equals("desc")){ // </desc>
+				if (chD.is_HTML)	chD.LongDescription +=SafeXML.cleanback(strData);
+				else chD.LongDescription +=strData;
 				return;
 			}
 			if (name.equals("hint")){
-				holder.Hints = Common.rot13(strData);
+				chD.Hints = Common.rot13(strData);
 				return;
 			}
 		}
@@ -493,25 +490,25 @@
 
 	private void getPic(String fetchURL, String picDesc){ // TODO handling of relativ URLs
 		if (!fetchURL.startsWith("http://")) fetchURL = "http://" + OPENCACHING_HOST + "/"+fetchURL; // TODO this is not quite correct: actually the "base" URL must be known... but anyway a different baseURL should not happen very often  - it doesn't in my area
-		String fileName = holder.wayPoint + "_" + fetchURL.substring(fetchURL.lastIndexOf("/")+1);
+		String fileName = chD.wayPoint + "_" + fetchURL.substring(fetchURL.lastIndexOf("/")+1);
 		fileName = Common.ClearForFileName(fileName);
 		// add title
-		holder.ImagesText.add(picDesc);
+		chD.ImagesText.add(picDesc);
 		try {
 			File ftest = new File(profile.dataDir + fileName);
 			if (ftest.exists()){
-				holder.Images.add(fileName);
+				chD.Images.add(fileName);
 			}
 			else {
 				if (pref.downloadPicsOC) {
-					holder.Images.add(fetch(fetchURL, fileName));
+					chD.Images.add(fetch(fetchURL, fileName));
 				}
 			}
 		} catch (IOException e) {
-			String ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ") + holder.wayPoint + ": ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
+			String ErrMessage = new String (MyLocale.getMsg(1618,"Ignoring error in cache: ") + chD.wayPoint + ": ignoring IOException: "+e.getMessage()+ " while downloading picture:"+fileName+" from URL:"+fetchURL); 
 			if (e.getMessage().toLowerCase().equalsIgnoreCase("could not connect") ||
 					e.getMessage().equalsIgnoreCase("unkown host")) { // is there a better way to find out what happened?
-				ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+holder.CacheName + " ("+holder.wayPoint+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
+				ErrMessage = MyLocale.getMsg(1618,"Ignoring error in cache: ")+chD.CacheName + " ("+chD.wayPoint+")"+MyLocale.getMsg(1619,": could not download image from URL: ")+fetchURL;
 			} 
 			inf.addWarning("\n"+ErrMessage);
 			//(new MessageBox(MyLocale.getMsg(144, "Warning"), ErrMessage, MessageBox.OKB)).exec();
@@ -539,42 +536,42 @@
 		}
 		if(name.equals("object")){
 			// get cachedata
-			holder = getHolder(strData);
+			chD = getHolder(strData);
 			return;
 		}
 		if(name.equals("picture")){ 
 			//String fileName = holder.wayPoint + "_" + picUrl.substring(picUrl.lastIndexOf("/")+1);
 			getPic(picUrl,picTitle);
-			holder.saveCacheDetails(profile.dataDir);
+			chD.saveCacheDetails(profile.dataDir);
 			return;
 		}
 	}
 
 	private void endCacheLog(String name){
-		if (name.equals("cachelog")){
-			holder.addLog(logIcon + logDate + " by " + logFinder + "</strong><br>" + logData + "<br>");
-			holder.saveCacheDetails(profile.dataDir);
+		if (name.equals("cachelog")){ // </cachelog>
+			chD.addLog(logIcon + logDate + " by " + logFinder + "</strong><br>" + logData + "<br>");
+			chD.saveCacheDetails(profile.dataDir);
 			return;
 		}
 
-		if (name.equals("cacheid")){
+		if (name.equals("cacheid")){ // </cacheid>
 			// load cachedata
-			holder = getHolder(strData);
+			chD = getHolder(strData);
 			return;
 		}
 
 		if (name.equals("date"))  {
 			logDate = new String(strData);
-			if (holder.is_found) {
-				holder.CacheStatus=strData.substring(0,10);
+			if (chD.is_found) {
+				chD.CacheStatus=strData.substring(0,10);
 			}
 			return;
 		}
 		if (name.equals("userid")){
 			logFinder = new String(strData);
 			if((logFinder.toLowerCase().compareTo(user) == 0 || logFinder.equalsIgnoreCase(pref.myAlias2)) && logtype == 1){
-				holder.is_found = true; // see startCacheLog - in the current .xml this is set by startCacheLog but we sequence in the xml from opencaching might change, so I leave this also here
-				holder.CacheStatus = MyLocale.getMsg(318,"Found");
+				chD.is_found = true; // see startCacheLog - in the current .xml this is set by startCacheLog but we sequence in the xml from opencaching might change, so I leave this also here
+				chD.CacheStatus = MyLocale.getMsg(318,"Found");
 			}
 			return;
 		}
@@ -607,7 +604,7 @@
 			sock = conn.connect();
 			address = conn.getRedirectTo();
 			if (address != null){
-				if (holder != null) fileName = holder.wayPoint + "_" + Common.ClearForFileName(address.substring(address.lastIndexOf("/")+1));
+				if (chD != null) fileName = chD.wayPoint + "_" + Common.ClearForFileName(address.substring(address.lastIndexOf("/")+1));
 				else fileName = Common.ClearForFileName(address.substring(address.lastIndexOf("/")+1));
 			}
 		}
@@ -674,19 +671,19 @@
 
 	private CacheHolderDetail getHolder(String wpt){// See also LOCXMLImporter
 		int index;
-		CacheHolderDetail ch;
 		
 		index = searchWpt(wpt);
+		if (index==-1) index = searchID(wpt);
 		if (index == -1){
-			ch = new CacheHolderDetail();
-			ch.wayPoint = wpt;
-			return ch;
+			chD = new CacheHolderDetail();
+			//chD.wayPoint = wpt;
+			return chD;
 		}
-		ch = new CacheHolderDetail((CacheHolder) cacheDB.get(index));
+		chD = new CacheHolderDetail((CacheHolder) cacheDB.get(index));
 		try {
-			ch.readCache(profile.dataDir);
+			chD.readCache(profile.dataDir);
 		} catch (Exception e) {Vm.debug("Could not open file: " + e.toString());};
-		return ch;
+		return chD;
 	}
 
 



From admin at berlios.de  Mon Jun 11 20:39:12 2007
From: admin at berlios.de (admin at berlios.de)
Date: Mon, 11 Jun 2007 20:39:12 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3495] Einzelne OC-Caches syncen
Message-ID: <200706111839.l5BIdCoH003911@unicorn.berlios.de>

Feature Request #3495, was updated on 2007-Jun-11 20:39
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3495&group_id=2211

Category: 1.0
Status: Open
Priority: 5
Summary: Einzelne OC-Caches syncen

By: kalli
Date: 2007-Jun-11 20:39

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4

siehe http://www.geoclub.de/viewtopic.php?p=261773#261773

Einzelne Caches ?ber die OC-XML-Schnittstelle laden
(wie SpiderSingle)

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3495&group_id=2211


From admin at berlios.de  Mon Jun 11 21:05:35 2007
From: admin at berlios.de (admin at berlios.de)
Date: Mon, 11 Jun 2007 21:05:35 +0200 (CEST)
Subject: [Cachewolf-svn] [Bug #11266] Bilder in Cachebeschreibungen OC-Sync
Message-ID: <200706111905.l5BJ5ZY3017577@unicorn.berlios.de>

Bug #11266, was updated on 2007-Jun-07 10:44
Here is a current snapshot of the bug.

Project: CacheWolf
Category: None
Status: Closed
Resolution: None
Bug Group: None
Priority: 5
Submitted by: kalli
Assigned to : none
Summary: Bilder in Cachebeschreibungen OC-Sync

Details: Beim Sync mit oc.de gibt es Probleme, wenn in den Beschreibungen Links auf externe Bilder gesetzt sind. Die Sinnhaftigkeit des Codes ist mir noch nicht so ganz klar.

Follow-Ups:

Date: 2007-Jun-11 21:05
By: kalli

Comment:
Bei den Caches (z.B. http://www.opencaching.de/viewcache.php?cacheid=106066) zeigt mir Opera und Firefox keine Bilder an (es geht um die Attribut-Icons in der Beschreibung). Will man die URL eines Icons direkt aufrufen, bekommt man einen Error 403.
Die Cachebeschreibung auf gc.com verweist auf andere Icons.

-------------------------------------------------------

Date: 2007-Jun-07 14:08
By: pfeffer

Comment:
Wo gibt es da Probleme?
was ist Dir unklar?
Fragst Du am besten mit [DEV] im Forum, oder in #cachewolf auf freenet.

Sch?ne Gr??e,
   Pfeffer.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=11266&group_id=2211


From admin at berlios.de  Wed Jun 13 20:20:31 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 13 Jun 2007 20:20:31 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3509] Erweiterung KML
Message-ID: <200706131820.l5DIKVZh000169@unicorn.berlios.de>

Feature Request #3509, was updated on 2007-Jun-13 20:20
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3509&group_id=2211

Category: 1.0
Status: Open
Priority: 5
Summary: Erweiterung KML

By: kalli
Date: 2007-Jun-13 20:20

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4

Sortierung in verschiedene Gruppen
1. Ebene: Found/not found
2. Ebene: Cachetypen

Unterscheidung der verschiedenen Cachetypen anhand von
Farben oder durch Icons (z.B. die von TomTom).

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3509&group_id=2211


From kalli at mail.berlios.de  Wed Jun 13 21:20:54 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Wed, 13 Jun 2007 21:20:54 +0200
Subject: [Cachewolf-svn] r745 - trunk/src/CacheWolf
Message-ID: <200706131920.l5DJKsYU031427@sheep.berlios.de>

Author: kalli
Date: 2007-06-13 21:20:51 +0200 (Wed, 13 Jun 2007)
New Revision: 745

Modified:
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/myTableControl.java
Log:
FR #3495: Einzelne OC-Caches syncen. Muss noch genauer getestet werden.

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2007-06-10 21:12:49 UTC (rev 744)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2007-06-13 19:20:51 UTC (rev 745)
@@ -74,7 +74,93 @@
 		}//for
 
 	}
+	
+	public boolean syncSingle(int number, InfoBox infB) {
+		String finalMessage = new String();
+		boolean success=true;
 
+		CacheHolder ch = (CacheHolder)cacheDB.get(number);
+		CacheHolderDetail chD=new CacheHolderDetail(ch);
+
+		try{
+			BufferedReader r;
+			String file = new String();
+			String url = new String();
+
+			picCnt = 0;
+			//Build url
+			url ="http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
+				+ "modifiedsince=" + "20050801000000"
+				+ "&cache=1"
+				+ "&cachedesc=1"
+				+ "&picture=1"
+				+ "&cachelog=1"
+				+ "&removedobject=0"
+				+ "&wp=" + ch.wayPoint
+				+ "&charset=utf-8"
+				+ "&cdata=0"
+				+ "&session=0";
+			inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
+//			inf = infB;
+			inf.setPreferredSize(220, 300);
+			inf.relayout(false);
+			inf.exec();
+			//Vm.debug(url);
+			//get file
+			file = fetch(url, "dummy");
+			//file = "628-0-1.zip";
+
+			//parse
+			File tmpFile = new File(profile.dataDir + file);
+			if (tmpFile.getLength() == 0 ) throw new IOException("no updates available");
+
+			ZipFile zif = new ZipFile (profile.dataDir + file);
+			ZipEntry zipEnt;
+			Enumeration zipEnum = zif.entries();
+			// there could be more than one file in the archive
+			inf.setInfo("...unzipping update file"); 
+			while (zipEnum.hasMoreElements())
+			{
+				zipEnt = (ZipEntry) zipEnum.nextElement();
+				// skip over PRC-files and empty files
+				if (zipEnt.getSize()> 0 && zipEnt.getName().endsWith("xml")){
+					r = new BufferedReader (new InputStreamReader(zif.getInputStream(zipEnt), IO.JAVA_UTF8_CODEC));
+					parse(r);
+					r.close();
+				}
+			}
+			zif.close();
+		}catch (ZipException e){
+			finalMessage = MyLocale.getMsg(1614,"Error while unzipping udpate file");
+			success = false;
+		}catch (IOException e){
+			if (e.getMessage().equalsIgnoreCase("no updates available")) { finalMessage = "No updates available"; success = false; }
+			else {
+				if (e.getMessage().equalsIgnoreCase("could not connect") ||
+						e.getMessage().equalsIgnoreCase("unkown host")) { // is there a better way to find out what happened?
+					finalMessage = MyLocale.getMsg(1616,"Error: could not download udpate file from opencaching.de");
+				} else { finalMessage = "IOException: "+e.getMessage(); }
+				success = false;
+			}
+		}catch (IllegalArgumentException e) {
+			finalMessage = MyLocale.getMsg(1621,"Error parsing update file\n this is likely a bug in opencaching.de\nplease try again later\n, state:")+" "+state+", waypoint: "+ chD.wayPoint;
+			success = false;
+			Vm.debug("Parse error: " + state + " " + chD.wayPoint);
+			e.printStackTrace();
+		}catch (Exception e){ // here schould be used the correct exepion
+			if (chD != null)	finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: "+ chD.wayPoint;
+			else finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: <unkown>";
+			success = false;
+			Vm.debug("Parse error: " + state + " Exception:" + e.toString()+"   "+chD.ocCacheID);
+			e.printStackTrace();
+		}
+		inf.setInfo(finalMessage);
+		if (success) inf.close(0);
+		else 		 inf.addOkButton();
+
+		return success;
+	}
+
 	public void doIt(){
 		String finalMessage = new String();
 		boolean success=true;

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-06-10 21:12:49 UTC (rev 744)
+++ trunk/src/CacheWolf/myTableControl.java	2007-06-13 19:20:51 UTC (rev 745)
@@ -114,6 +114,7 @@
 
 		if (selectedItem.toString().equals(MyLocale.getMsg(1014,"Update"))){
 			SpiderGC spider = new SpiderGC(pref, profile, false);
+			OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
 			//Vm.debug("ByPass? " + profile.byPassIndexActive);
 			Vm.showWait(true);
 			if (spider.login()==Form.IDOK) {
@@ -125,14 +126,18 @@
 				for(int i = 0; i <	cacheDB.size(); i++){
 					ch = (CacheHolder)cacheDB.get(i);
 					if(ch.is_Checked == true) {
-						if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
+						if ( ch.wayPoint.length()>1)
+
+//						if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
 	//						Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
 	//						Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
 	//						TODO: Diese Meldungen vor dem Einloggen darstellen						
 						{
 					    infB.setInfo("Loading: " + ch.wayPoint);
-						
-						test = spider.spiderSingle(i, infB); 
+					    if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))
+					    	test = spider.spiderSingle(i, infB);
+					    else
+					    	test = ocSync.syncSingle(i, infB);
 						if (!test) {
 							infB.close(0);
 							break;



From bilbowolf at mail.berlios.de  Thu Jun 14 07:57:39 2007
From: bilbowolf at mail.berlios.de (bilbowolf at mail.berlios.de)
Date: Thu, 14 Jun 2007 07:57:39 +0200
Subject: [Cachewolf-svn] r746 - branches/bugfix_09n/src/CacheWolf
	trunk/resources trunk/resources/attributes
Message-ID: <200706140557.l5E5vdn9003772@sheep.berlios.de>

Author: bilbowolf
Date: 2007-06-14 07:57:09 +0200 (Thu, 14 Jun 2007)
New Revision: 746

Added:
   trunk/resources/attributes/
   trunk/resources/attributes/available-yes.gif
   trunk/resources/attributes/available-yes.jpg
   trunk/resources/attributes/bicycles-yes.gif
   trunk/resources/attributes/bicycles-yes.jpg
   trunk/resources/attributes/boat-yes.gif
   trunk/resources/attributes/boat-yes.jpg
   trunk/resources/attributes/campfires-yes.gif
   trunk/resources/attributes/campfires-yes.jpg
   trunk/resources/attributes/camping-yes.gif
   trunk/resources/attributes/camping-yes.jpg
   trunk/resources/attributes/cliff-yes.gif
   trunk/resources/attributes/cliff-yes.jpg
   trunk/resources/attributes/climbing-yes.gif
   trunk/resources/attributes/climbing-yes.jpg
   trunk/resources/attributes/cow-yes.gif
   trunk/resources/attributes/cow-yes.jpg
   trunk/resources/attributes/danger-yes.gif
   trunk/resources/attributes/danger-yes.jpg
   trunk/resources/attributes/dogs-yes.gif
   trunk/resources/attributes/dogs-yes.jpg
   trunk/resources/attributes/fee-yes.gif
   trunk/resources/attributes/fee-yes.jpg
   trunk/resources/attributes/hiking-yes.gif
   trunk/resources/attributes/hiking-yes.jpg
   trunk/resources/attributes/horses-yes.gif
   trunk/resources/attributes/horses-yes.jpg
   trunk/resources/attributes/hunting-yes.gif
   trunk/resources/attributes/hunting-yes.jpg
   trunk/resources/attributes/jeeps-yes.gif
   trunk/resources/attributes/jeeps-yes.jpg
   trunk/resources/attributes/kids-yes.gif
   trunk/resources/attributes/kids-yes.jpg
   trunk/resources/attributes/mine-yes.gif
   trunk/resources/attributes/mine-yes.jpg
   trunk/resources/attributes/motorcycles-yes.gif
   trunk/resources/attributes/motorcycles-yes.jpg
   trunk/resources/attributes/night-yes.gif
   trunk/resources/attributes/night-yes.jpg
   trunk/resources/attributes/onehour-yes.gif
   trunk/resources/attributes/onehour-yes.jpg
   trunk/resources/attributes/parking-yes.gif
   trunk/resources/attributes/parking-yes.jpg
   trunk/resources/attributes/phone-yes.gif
   trunk/resources/attributes/phone-yes.jpg
   trunk/resources/attributes/picnic-yes.gif
   trunk/resources/attributes/picnic-yes.jpg
   trunk/resources/attributes/poisonoak-yes.gif
   trunk/resources/attributes/poisonoak-yes.jpg
   trunk/resources/attributes/public-yes.gif
   trunk/resources/attributes/public-yes.jpg
   trunk/resources/attributes/quads-yes.gif
   trunk/resources/attributes/quads-yes.jpg
   trunk/resources/attributes/rappelling-yes.gif
   trunk/resources/attributes/rappelling-yes.jpg
   trunk/resources/attributes/restrooms-yes.gif
   trunk/resources/attributes/restrooms-yes.jpg
   trunk/resources/attributes/scenic-yes.gif
   trunk/resources/attributes/scenic-yes.jpg
   trunk/resources/attributes/scuba-yes.gif
   trunk/resources/attributes/scuba-yes.jpg
   trunk/resources/attributes/snakes-yes.gif
   trunk/resources/attributes/snakes-yes.jpg
   trunk/resources/attributes/snowmobiles-yes.gif
   trunk/resources/attributes/snowmobiles-yes.jpg
   trunk/resources/attributes/stealth-yes.gif
   trunk/resources/attributes/stealth-yes.jpg
   trunk/resources/attributes/stroller-yes.gif
   trunk/resources/attributes/stroller-yes.jpg
   trunk/resources/attributes/swimming-yes.gif
   trunk/resources/attributes/swimming-yes.jpg
   trunk/resources/attributes/thorn-yes.gif
   trunk/resources/attributes/thorn-yes.jpg
   trunk/resources/attributes/ticks-yes.gif
   trunk/resources/attributes/ticks-yes.jpg
   trunk/resources/attributes/wading-yes.gif
   trunk/resources/attributes/wading-yes.jpg
   trunk/resources/attributes/water-yes.gif
   trunk/resources/attributes/water-yes.jpg
   trunk/resources/attributes/wheelchair-yes.gif
   trunk/resources/attributes/wheelchair-yes.jpg
   trunk/resources/attributes/winter-yes.gif
   trunk/resources/attributes/winter-yes.jpg
Modified:
   branches/bugfix_09n/src/CacheWolf/Version.java
Log:
Attributicons hinzugef?\195?\188gt

Modified: branches/bugfix_09n/src/CacheWolf/Version.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/Version.java	2007-06-13 19:20:51 UTC (rev 745)
+++ branches/bugfix_09n/src/CacheWolf/Version.java	2007-06-14 05:57:09 UTC (rev 746)
@@ -8,7 +8,7 @@
 
 public class Version {
 	static final String VER_MAJOR = "0.9n";
-	static final String VER_MINOR = " patch 1";
+	static final String VER_MINOR = " patch 3";
 	static final String VER_BUILD = " RC ";
 	static final String VER_SVN ="$LastChangedRevision$"; //the  number is automatically replaced by subversion to the latest versionnumer of this file (svn:keywords LastChangedRevision)
 	

Added: trunk/resources/attributes/available-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/available-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/available-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/available-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/bicycles-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/bicycles-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/bicycles-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/bicycles-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/boat-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/boat-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/boat-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/boat-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/campfires-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/campfires-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/campfires-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/campfires-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/camping-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/camping-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/camping-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/camping-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cliff-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cliff-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cliff-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cliff-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/climbing-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/climbing-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/climbing-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/climbing-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cow-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cow-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cow-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cow-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/danger-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/danger-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/danger-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/danger-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/dogs-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/dogs-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/dogs-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/dogs-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/fee-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/fee-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/fee-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/fee-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hiking-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hiking-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hiking-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hiking-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/horses-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/horses-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/horses-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/horses-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hunting-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hunting-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hunting-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hunting-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/jeeps-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/jeeps-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/jeeps-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/jeeps-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/kids-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/kids-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/kids-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/kids-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/mine-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/mine-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/mine-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/mine-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/motorcycles-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/motorcycles-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/motorcycles-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/motorcycles-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/night-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/night-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/night-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/night-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/onehour-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/onehour-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/onehour-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/onehour-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/parking-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/parking-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/parking-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/parking-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/phone-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/phone-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/phone-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/phone-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/picnic-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/picnic-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/picnic-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/picnic-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/poisonoak-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/poisonoak-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/poisonoak-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/poisonoak-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/public-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/public-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/public-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/public-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/quads-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/quads-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/quads-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/quads-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/rappelling-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/rappelling-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/rappelling-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/rappelling-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/restrooms-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/restrooms-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/restrooms-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/restrooms-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scenic-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scenic-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scenic-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scenic-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scuba-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scuba-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scuba-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scuba-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snakes-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snakes-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snakes-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snakes-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snowmobiles-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snowmobiles-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snowmobiles-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snowmobiles-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stealth-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stealth-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stealth-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stealth-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stroller-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stroller-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stroller-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stroller-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/swimming-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/swimming-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/swimming-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/swimming-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/thorn-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/thorn-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/thorn-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/thorn-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/ticks-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/ticks-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/ticks-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/ticks-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wading-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wading-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wading-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wading-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/water-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/water-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/water-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/water-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wheelchair-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wheelchair-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wheelchair-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wheelchair-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/winter-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/winter-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/winter-yes.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/winter-yes.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From kalli at mail.berlios.de  Fri Jun 15 20:09:47 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Fri, 15 Jun 2007 20:09:47 +0200
Subject: [Cachewolf-svn] r747 - trunk/src/CacheWolf
Message-ID: <200706151809.l5FI9lX5025779@sheep.berlios.de>

Author: kalli
Date: 2007-06-15 20:09:36 +0200 (Fri, 15 Jun 2007)
New Revision: 747

Modified:
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/OCXMLImporterScreen.java
   trunk/src/CacheWolf/Profile.java
   trunk/src/CacheWolf/SpiderGC.java
   trunk/src/CacheWolf/myTableControl.java
Log:
FR #3495: Einzelne OC-Caches syncen. Die Anzeigen in der InfoBox k?\195?\182nnten noch verbessert werden.

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2007-06-14 05:57:09 UTC (rev 746)
+++ trunk/src/CacheWolf/CacheHolder.java	2007-06-15 18:09:36 UTC (rev 747)
@@ -57,6 +57,7 @@
 public Vector addiWpts = new Vector();
 public CacheHolder mainCache;
 public String sort;
+public String lastSyncOC = EMPTY;
 
 CacheHolder() {}
 CacheHolder(String wpt) {this.wayPoint=wpt; }
@@ -97,6 +98,7 @@
 	this.has_bug = ch.has_bug;
 	this.is_HTML = ch.is_HTML;
 	this.sort=ch.sort;
+	this.lastSyncOC = ch.lastSyncOC;
 	
 }
 

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2007-06-14 05:57:09 UTC (rev 746)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2007-06-15 18:09:36 UTC (rev 747)
@@ -41,6 +41,7 @@
 	int picCnt;
 	boolean incUpdate = true; // complete or incremental Update
 	boolean ignoreDesc = false;
+	boolean askForOptions = true;
 	Hashtable DBindexWpt = new Hashtable();
 	Hashtable DBindexID = new Hashtable();
 
@@ -76,157 +77,136 @@
 	}
 	
 	public boolean syncSingle(int number, InfoBox infB) {
-		String finalMessage = new String();
 		boolean success=true;
 
-		CacheHolder ch = (CacheHolder)cacheDB.get(number);
-		CacheHolderDetail chD=new CacheHolderDetail(ch);
+		ch = (CacheHolder)cacheDB.get(number);
+		chD= new CacheHolderDetail(ch);
 
-		try{
-			BufferedReader r;
-			String file = new String();
-			String url = new String();
+		if (askForOptions) {
+			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.SINGLE);
+			if (importOpt.execute() == OCXMLImporterScreen.IDCANCEL) {	return false; }
+			askForOptions = false;
+		}
 
-			picCnt = 0;
-			//Build url
-			url ="http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
-				+ "modifiedsince=" + "20050801000000"
-				+ "&cache=1"
-				+ "&cachedesc=1"
-				+ "&picture=1"
-				+ "&cachelog=1"
-				+ "&removedobject=0"
-				+ "&wp=" + ch.wayPoint
-				+ "&charset=utf-8"
-				+ "&cdata=0"
-				+ "&session=0";
-			inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
-//			inf = infB;
-			inf.setPreferredSize(220, 300);
-			inf.relayout(false);
-			inf.exec();
-			//Vm.debug(url);
-			//get file
-			file = fetch(url, "dummy");
-			//file = "628-0-1.zip";
+		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
+		inf.setPreferredSize(220, 300);
+		inf.relayout(false);
+		inf.exec();
 
-			//parse
-			File tmpFile = new File(profile.dataDir + file);
-			if (tmpFile.getLength() == 0 ) throw new IOException("no updates available");
+		
+		String lastS = ch.lastSyncOC;
+		if (lastS.length() < 14) lastS = "20050801000000";
 
-			ZipFile zif = new ZipFile (profile.dataDir + file);
-			ZipEntry zipEnt;
-			Enumeration zipEnum = zif.entries();
-			// there could be more than one file in the archive
-			inf.setInfo("...unzipping update file"); 
-			while (zipEnum.hasMoreElements())
-			{
-				zipEnt = (ZipEntry) zipEnum.nextElement();
-				// skip over PRC-files and empty files
-				if (zipEnt.getSize()> 0 && zipEnt.getName().endsWith("xml")){
-					r = new BufferedReader (new InputStreamReader(zif.getInputStream(zipEnt), IO.JAVA_UTF8_CODEC));
-					parse(r);
-					r.close();
-				}
-			}
-			zif.close();
-		}catch (ZipException e){
-			finalMessage = MyLocale.getMsg(1614,"Error while unzipping udpate file");
-			success = false;
-		}catch (IOException e){
-			if (e.getMessage().equalsIgnoreCase("no updates available")) { finalMessage = "No updates available"; success = false; }
-			else {
-				if (e.getMessage().equalsIgnoreCase("could not connect") ||
-						e.getMessage().equalsIgnoreCase("unkown host")) { // is there a better way to find out what happened?
-					finalMessage = MyLocale.getMsg(1616,"Error: could not download udpate file from opencaching.de");
-				} else { finalMessage = "IOException: "+e.getMessage(); }
-				success = false;
-			}
-		}catch (IllegalArgumentException e) {
-			finalMessage = MyLocale.getMsg(1621,"Error parsing update file\n this is likely a bug in opencaching.de\nplease try again later\n, state:")+" "+state+", waypoint: "+ chD.wayPoint;
-			success = false;
-			Vm.debug("Parse error: " + state + " " + chD.wayPoint);
-			e.printStackTrace();
-		}catch (Exception e){ // here schould be used the correct exepion
-			if (chD != null)	finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: "+ chD.wayPoint;
-			else finalMessage = MyLocale.getMsg(1615,"Error parsing update file, state:")+" "+state+", waypoint: <unkown>";
-			success = false;
-			Vm.debug("Parse error: " + state + " Exception:" + e.toString()+"   "+chD.ocCacheID);
-			e.printStackTrace();
-		}
-		inf.setInfo(finalMessage);
-		if (success) inf.close(0);
-		else 		 inf.addOkButton();
+		dateOfthisSync = new Time();
+		dateOfthisSync.parse(lastS, "yyyyMMddHHmmss");
+	
 
+		String url = new String();
+		picCnt = 0;
+		//Build url
+		url ="http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
+			+ "modifiedsince=" + lastS
+			+ "&cache=1"
+			+ "&cachedesc=1"
+			+ "&picture=1"
+			+ "&cachelog=1"
+			+ "&removedobject=0"
+			+ "&wp=" + ch.wayPoint
+			+ "&charset=utf-8"
+			+ "&cdata=0"
+			+ "&session=0";
+		success = syncOC(url);
+		inf.close(0);
 		return success;
 	}
 
 	public void doIt(){
+		boolean success=true;
+		String finalMessage;
+
+		
+		String url = new String();
+
+		String lastS =  profile.last_sync_opencaching;
+		CWPoint center = pref.curCentrePt; // No need to clone curCentrePt as center is only read
+		if (!center.isValid()) {
+			(new MessageBox("Error", "Coordinates for center must be set", MessageBox.OKB)).execute();
+			return;
+		}
+		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.ALL);
+		if (importOpt.execute() == OCXMLImporterScreen.IDCANCEL) {	return; }
+		Vm.showWait(true);
+		String dist = importOpt.distanceInput.getText();
+		if (dist.length()== 0) return;
+		//check, if distance is greater than before
+		if (Convert.toInt(dist) > Convert.toInt(profile.distOC) ||
+				pref.downloadmissingOC  ){
+			// resysnc
+			lastS = "20050801000000";
+			incUpdate = false;
+		}
+		profile.distOC = dist;
+		// Clear status of caches in db
+		for(int i = 0; i<cacheDB.size();i++){
+			ch = (CacheHolder)cacheDB.get(i);
+			ch.is_update = false;
+			ch.is_new = false;
+			ch.is_log_update = false;
+		}	
+		picCnt = 0;
+		//Build url
+		url ="http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
+			+ "modifiedsince=" + lastS
+			+ "&cache=1"
+			+ "&cachedesc=1"
+			+ "&picture=1"
+			+ "&cachelog=1"
+			+ "&removedobject=0"
+			+ "&lat=" + center.getLatDeg(CWPoint.DD)
+			+ "&lon=" + center.getLonDeg(CWPoint.DD)
+			+ "&distance=" + dist
+			+ "&charset=utf-8"
+			+ "&cdata=0"
+			+ "&session=0";
+		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
+		inf.setPreferredSize(220, 300);
+		inf.relayout(false);
+		inf.exec();
+
+		success = syncOC(url);
+		Vm.showWait(false);
+		if (success) {
+			profile.last_sync_opencaching = dateOfthisSync.format("yyyyMMddHHmmss");
+			//pref.savePreferences();
+			finalMessage = MyLocale.getMsg(1607,"Update from opencaching successful");
+			inf.setInfo(finalMessage);
+		}
+		profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
+		inf.addOkButton();
+	}
+	
+	private boolean syncOC(String url) {
 		String finalMessage = new String();
 		boolean success=true;
-		try{
-			BufferedReader r;
-			String file = new String();
-			String url = new String();
+		File tmpFile = null;
+		BufferedReader r;
+		String file = new String();
 
-			String lastS =  profile.last_sync_opencaching;
-			CWPoint center = pref.curCentrePt; // No need to clone curCentrePt as center is only read
-			if (!center.isValid()) {
-				(new MessageBox("Error", "Coordinates for center must be set", MessageBox.OKB)).execute();
-				return;
-			}
-			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.ALL);
-			if (importOpt.execute() == OCXMLImporterScreen.IDCANCEL) {	return; }
-			Vm.showWait(true);
-			String dist = importOpt.distanceInput.getText();
-			if (dist.length()== 0) return;
-			//check, if distance is greater than before
-			if (Convert.toInt(dist) > Convert.toInt(profile.distOC) ||
-					pref.downloadmissingOC  ){
-				// resysnc
-				lastS = "20050801000000";
-				incUpdate = false;
-			}
-			profile.distOC = dist;
-			// Clear status of caches in db
-			for(int i = 0; i<cacheDB.size();i++){
-				ch = (CacheHolder)cacheDB.get(i);
-				ch.is_update = false;
-				ch.is_new = false;
-				ch.is_log_update = false;
-			}	
-			picCnt = 0;
-			//Build url
-			url ="http://" + OPENCACHING_HOST + "/xml/ocxml11.php?"
-				+ "modifiedsince=" + lastS
-				+ "&cache=1"
-				+ "&cachedesc=1"
-				+ "&picture=1"
-				+ "&cachelog=1"
-				+ "&removedobject=0"
-				+ "&lat=" + center.getLatDeg(CWPoint.DD)
-				+ "&lon=" + center.getLonDeg(CWPoint.DD)
-				+ "&distance=" + dist
-				+ "&charset=utf-8"
-				+ "&cdata=0"
-				+ "&session=0";
-			inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
-			inf.setPreferredSize(220, 300);
-			inf.relayout(false);
-			inf.exec();
-			//Vm.debug(url);
-			//get file
+		//inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
+		
+		picCnt = 0;
+		try{
 			file = fetch(url, "dummy");
-			//file = "628-0-1.zip";
 
 			//parse
-			File tmpFile = new File(profile.dataDir + file);
-			if (tmpFile.getLength() == 0 ) throw new IOException("no updates available");
+			tmpFile = new File(profile.dataDir + file);
+			if (tmpFile.getLength() == 0 ) {
+				throw new IOException("no updates available");
+			}
 
 			ZipFile zif = new ZipFile (profile.dataDir + file);
 			ZipEntry zipEnt;
 			Enumeration zipEnum = zif.entries();
-			// there could be more than one file in the archive
 			inf.setInfo("...unzipping update file"); 
 			while (zipEnum.hasMoreElements())
 			{
@@ -262,19 +242,12 @@
 			success = false;
 			Vm.debug("Parse error: " + state + " Exception:" + e.toString()+"   "+chD.ocCacheID);
 			e.printStackTrace();
+		} finally {
+			if (tmpFile != null) tmpFile.delete();
 		}
-		Vm.showWait(false);
-		if (success) {
-			profile.last_sync_opencaching = dateOfthisSync.format("yyyyMMddHHmmss");
-			//pref.savePreferences();
-			finalMessage = MyLocale.getMsg(1607,"Update from opencaching successful");
-		}
-		profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 		inf.setInfo(finalMessage);
-		inf.addOkButton();
-		//inf.close(0);
-//		MessageBox mb = new MessageBox("Opencaching",finalMessage,MessageBox.OKB);
-		//	mb.execute();
+
+		return success;
 	}
 
 	public void startElement(String name, AttributeList atts){
@@ -418,6 +391,7 @@
 
 	private void endCache(String name){
 		if (name.equals("cache")){
+			chD.lastSyncOC = dateOfthisSync.format("yyyyMMddHHmmss");
 			int index;
 			index = searchWpt(chD.wayPoint);
 			if (index == -1){
@@ -439,33 +413,7 @@
 				chD.Images.clear();
 				chD.ImagesText.clear();
 			}
-			/*			if(holder.LatLon.length() > 1 && holder.is_archived == false &&
-					pref.downloadMapsOC){
 
-				ParseLatLon pll = new ParseLatLon(holder.LatLon,".");
-				pll.parse();
-
- 				MapLoader mpl = new MapLoader(pref.myproxy, pref.myproxyport);
-				// MapLoader tests itself if the file already exists and doesnt download if so.
-				String filename = Global.getPref().baseDir + "/maps/expedia/" + holder.wayPoint + "_map.gif";
-				if (!(new File(filename).getParentFile().isDirectory())) { // dir exists? 
-					if (new File(filename).getParentFile().mkdir() == false) // dir creation failed?
-					{ pref.downloadMapsOC = false;
-					(new MessageBox("Warning", "Ignoring error (stopping to download maps):\n cannot create maps directory: \n"+new File(filename).getParentFile(), MessageBox.OKB)).exec(); 
-					}
-				}
-				if (!fileExits(filename)){
-					inf.setInfo(MyLocale.getMsg(1609,"Importing Cache:")+" " + numCacheImported + "\n"+MyLocale.getMsg(1610,"Downloading missing map")+" 1");
-					//mpl.loadTo(filename, "3"); 
-					}
-				//filename = profile.dataDir + "/" + holder.wayPoint + "_map_2.gif";
-				filename = Global.getPref().baseDir + "/maps/expedia/" + holder.wayPoint + "_map_2.gif";
-				if (!fileExits(filename)){
-					inf.setInfo(MyLocale.getMsg(1609,"Importing Cache: ")+" " + numCacheImported + "\n"+MyLocale.getMsg(1610,"Downloading missing map")+" 2");
-					//mpl.loadTo(filename, "10"); 
-					}
-			} */
-
 			// save all
 			chD.saveCacheDetails(profile.dataDir); 
 			// profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR); // this is done after .xml is completly processed

Modified: trunk/src/CacheWolf/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporterScreen.java	2007-06-14 05:57:09 UTC (rev 746)
+++ trunk/src/CacheWolf/OCXMLImporterScreen.java	2007-06-15 18:09:36 UTC (rev 747)
@@ -18,9 +18,12 @@
 	mInput distanceInput;
 	mCheckBox imagesCheckBox, /*mapsCheckBox, */ missingCheckBox, foundCheckBox;
 	mLabel distLbl;
+	mLabel distUnit;
 	static int IMAGESANDMAPS = 0;
 	static int ALL = 1;
 	static int INCLUDEFOUND = 2;
+	static int SINGLE = 3;
+
 	
 	public OCXMLImporterScreen(String title, int options) {
 		super();
@@ -28,10 +31,13 @@
 		
 
 		this.title = title;
-		this.addNext(distLbl = new mLabel(MyLocale.getMsg(1601,"Distance:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		distanceInput = new mInput();
-		distanceInput.setText(Global.getProfile().distOC);
-		this.addLast(distanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));	
+		if (options != SINGLE) {
+			this.addNext(distLbl = new mLabel(MyLocale.getMsg(1601,"Distance:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			distanceInput = new mInput();
+			distanceInput.setText(Global.getProfile().distOC);
+			this.addNext(distanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+			this.addLast(distUnit = new mLabel(" km"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		}
 		
 		imagesCheckBox = new mCheckBox();
 		imagesCheckBox.setText(MyLocale.getMsg(1602,"Download Images"));

Modified: trunk/src/CacheWolf/Profile.java
===================================================================
--- trunk/src/CacheWolf/Profile.java	2007-06-14 05:57:09 UTC (rev 746)
+++ trunk/src/CacheWolf/Profile.java	2007-06-15 18:09:36 UTC (rev 747)
@@ -152,7 +152,7 @@
 					detfile.print("    <CACHE name = \""+SafeXML.clean(ch.CacheName)+"\" owner = \""+SafeXML.clean(ch.CacheOwner)+
 							//"\" lat = \""+ SafeXML.clean(ch.LatLon) +
 							"\" lat = \""+ ch.pos.latDec + "\" lon = \""+ch.pos.lonDec+
-							"\" hidden = \""+ch.DateHidden+"\" wayp = \""+SafeXML.clean(ch.wayPoint)+"\" status = \""+ch.CacheStatus+"\" type = \""+ch.type+"\" dif = \""+ch.hard+"\" terrain = \"" + ch.terrain + "\" dirty = \"" + ch.dirty + "\" size = \""+ch.CacheSize+"\" online = \"" + Convert.toString(ch.is_available) + "\" archived = \"" + Convert.toString(ch.is_archived) + "\" has_bug = \"" + Convert.toString(ch.has_bug) + "\" black = \"" + Convert.toString(ch.is_black) + "\" owned = \"" + Convert.toString(ch.is_owned) + "\" found = \"" + Convert.toString(ch.is_found) + "\" is_new = \"" + Convert.toString(ch.is_new) +"\" is_log_update = \"" + Convert.toString(ch.is_log_update) + "\" is_update = \"" + Convert.toString(ch.is_update) + "\" is_HTML = \"" + Convert.toString(ch.is_HTML) + "\" DNFLOGS = \"" + ch.noFindLogs + "\" ocCacheID = \"" + ch.ocCacheID + "\" is_INCOMPLETE = \""+Convert.toString(ch.is_incomplete)+"\" />\n");
+							"\" hidden = \""+ch.DateHidden+"\" wayp = \""+SafeXML.clean(ch.wayPoint)+"\" status = \""+ch.CacheStatus+"\" type = \""+ch.type+"\" dif = \""+ch.hard+"\" terrain = \"" + ch.terrain + "\" dirty = \"" + ch.dirty + "\" size = \""+ch.CacheSize+"\" online = \"" + Convert.toString(ch.is_available) + "\" archived = \"" + Convert.toString(ch.is_archived) + "\" has_bug = \"" + Convert.toString(ch.has_bug) + "\" black = \"" + Convert.toString(ch.is_black) + "\" owned = \"" + Convert.toString(ch.is_owned) + "\" found = \"" + Convert.toString(ch.is_found) + "\" is_new = \"" + Convert.toString(ch.is_new) +"\" is_log_update = \"" + Convert.toString(ch.is_log_update) + "\" is_update = \"" + Convert.toString(ch.is_update) + "\" is_HTML = \"" + Convert.toString(ch.is_HTML) + "\" DNFLOGS = \"" + ch.noFindLogs + "\" ocCacheID = \"" + ch.ocCacheID + "\" is_INCOMPLETE = \""+Convert.toString(ch.is_incomplete)+ "\" lastSyncOC = \"" + ch.lastSyncOC + "\" />\n");
 				}
 			}
 			detfile.print("</CACHELIST>\n");
@@ -224,6 +224,7 @@
 					ch.noFindLogs = Convert.toInt(ex.findNext());
 					ch.ocCacheID = ex.findNext();
 					ch.is_incomplete = ex.findNext().equals("true") ? true : false;
+					ch.lastSyncOC = ex.findNext();
 					// remove "/>
 					ch.ocCacheID = STRreplace.replace(ch.ocCacheID,"\"/>", null);
 					// remove additional " if present

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-14 05:57:09 UTC (rev 746)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-15 18:09:36 UTC (rev 747)
@@ -54,6 +54,7 @@
 	Vector cachesToLoad = new Vector();
 	Hashtable indexDB;
 	InfoBox infB;
+	private boolean loggedIn = false;
 	private static Properties p=null; 
 	
 	public SpiderGC(Preferences prf, Profile profile, boolean bypass){
@@ -79,6 +80,7 @@
 	 */
 	public int login(){
 		pref.logInit();
+		loggedIn = false;
 		//Access the page once to get a viewstate
 		String start,doc,loginPage;
 		//Get password
@@ -138,8 +140,10 @@
 		infB.close(0);
 		if (loginAborted)
 			return Form.IDCANCEL;
-		else
+		else {
+			loggedIn = true;
 			return Form.IDOK;
+		}
 	}
 	
 	/**
@@ -157,6 +161,11 @@
 		CacheHolder ch = (CacheHolder)cacheDB.get(number);
 		if (ch.isAddiWpt()) return false;  // No point re-spidering an addi waypoint, comes with parent
 
+		// check if we need to login
+		if (!loggedIn){
+			if (this.login()==Form.IDOK) loggedIn = true;
+			else return false;
+		}
 		CacheHolderDetail chD=new CacheHolderDetail(ch);
 		try{
 			// Get all existing details of the cache

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-06-14 05:57:09 UTC (rev 746)
+++ trunk/src/CacheWolf/myTableControl.java	2007-06-15 18:09:36 UTC (rev 747)
@@ -117,43 +117,42 @@
 			OCXMLImporter ocSync = new OCXMLImporter(pref, profile);
 			//Vm.debug("ByPass? " + profile.byPassIndexActive);
 			Vm.showWait(true);
-			if (spider.login()==Form.IDOK) {
-				boolean alreadySaid = false;
-				boolean alreadySaid2 = false;
-				boolean test = true;
-				InfoBox infB = new InfoBox("Info", "Loading");
-				infB.exec();
-				for(int i = 0; i <	cacheDB.size(); i++){
-					ch = (CacheHolder)cacheDB.get(i);
-					if(ch.is_Checked == true) {
-						if ( ch.wayPoint.length()>1)
+			boolean alreadySaid = false;
+			boolean alreadySaid2 = false;
+			boolean test = true;
+			InfoBox infB = new InfoBox("Info", "Loading", InfoBox.PROGRESS_WITH_WARNINGS);
+			infB.exec();
+			for(int i = 0; i <	cacheDB.size(); i++){
+				ch = (CacheHolder)cacheDB.get(i);
+				if(ch.is_Checked == true) {
+					if ( ch.wayPoint.length()>1)
 
 //						if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
-	//						Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
-	//						Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
-	//						TODO: Diese Meldungen vor dem Einloggen darstellen						
-						{
-					    infB.setInfo("Loading: " + ch.wayPoint);
-					    if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))
-					    	test = spider.spiderSingle(i, infB);
-					    else
-					    	test = ocSync.syncSingle(i, infB);
-						if (!test) {
-							infB.close(0);
-							break;
-						}
-						} else if (ch.isAddiWpt() && !ch.mainCache.is_Checked) { // Is the father ticked?
-							if (!alreadySaid2) {
-								alreadySaid2=true;
-								(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).exec();
-							}
-						} else if (ch.mainCache != null &&	ch.mainCache.wayPoint.length() > 1 	&& !ch.mainCache.wayPoint.substring(0,2).equalsIgnoreCase("GC") && 
-								!alreadySaid) {
+//						Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
+//						Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
+//						TODO: Diese Meldungen vor dem Einloggen darstellen						
+					{
+				    infB.setInfo("Loading: " + ch.wayPoint);
+				    if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))
+				    	test = spider.spiderSingle(i, infB);
+				    else if ((ch.wayPoint.substring(0,2).equalsIgnoreCase("OC"))) 
+				    		test = ocSync.syncSingle(i, infB);
+				    	else {
 							alreadySaid = true;
-							(new MessageBox("Information",ch.wayPoint+">"+ch.mainCache.wayPoint+": Diese Funktion steht gegenw?rtig nur f?r Geocaching.com zur Verf?gung", MessageBox.OKB)).exec();
-						}
+							(new MessageBox("Information",ch.wayPoint+ ": Diese Funktion steht gegenw?rtig nur f?r Geocaching.com und Opencaching.de zur Verf?gung", MessageBox.OKB)).exec();
+				    	}
+					if (!test) {
+						infB.close(0);
+						break;
 					}
+					} else if (ch.isAddiWpt() && !ch.mainCache.is_Checked) { // Is the father ticked?
+						if (!alreadySaid2) {
+							alreadySaid2=true;
+							(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).exec();
+						}
+					} 
 				}
+
 				infB.close(0);
 				profile.hasUnsavedChanges=true;	
 				profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);



From kalli at mail.berlios.de  Fri Jun 15 20:53:21 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Fri, 15 Jun 2007 20:53:21 +0200
Subject: [Cachewolf-svn] r748 - trunk/src/CacheWolf
Message-ID: <200706151853.l5FIrLbN029265@sheep.berlios.de>

Author: kalli
Date: 2007-06-15 20:53:15 +0200 (Fri, 15 Jun 2007)
New Revision: 748

Modified:
   trunk/src/CacheWolf/GPXImporter.java
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/OCXMLImporterScreen.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
An-/Ausschalten der Optionen des OCXMLImpoertScreens uebersichtlicher gemacht.

Modified: trunk/src/CacheWolf/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/GPXImporter.java	2007-06-15 18:09:36 UTC (rev 747)
+++ trunk/src/CacheWolf/GPXImporter.java	2007-06-15 18:53:15 UTC (rev 748)
@@ -92,9 +92,7 @@
 			ewe.io.Reader r;
 			String file;
 			
-			OCXMLImporterScreen options = new OCXMLImporterScreen("Spider Options", OCXMLImporterScreen.IMAGESANDMAPS);
-			options.distanceInput.modify(ewe.ui.ControlConstants.Invisible,0);
-			options.distLbl.modify(ewe.ui.ControlConstants.Invisible,0);
+			OCXMLImporterScreen options = new OCXMLImporterScreen("Spider Options", OCXMLImporterScreen.IMAGES);
 			if (options.execute() == OCXMLImporterScreen.IDCANCEL) {	return; }
 			//String dist = options.distanceInput.getText();
 			//if (dist.length()== 0) return;

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2007-06-15 18:09:36 UTC (rev 747)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2007-06-15 18:53:15 UTC (rev 748)
@@ -83,7 +83,7 @@
 		chD= new CacheHolderDetail(ch);
 
 		if (askForOptions) {
-			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.SINGLE);
+			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.IMAGES);
 			if (importOpt.execute() == OCXMLImporterScreen.IDCANCEL) {	return false; }
 			askForOptions = false;
 		}
@@ -133,7 +133,8 @@
 			(new MessageBox("Error", "Coordinates for center must be set", MessageBox.OKB)).execute();
 			return;
 		}
-		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.ALL);
+		OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),
+																 OCXMLImporterScreen.ALL | OCXMLImporterScreen.DIST | OCXMLImporterScreen.IMAGES);
 		if (importOpt.execute() == OCXMLImporterScreen.IDCANCEL) {	return; }
 		Vm.showWait(true);
 		String dist = importOpt.distanceInput.getText();

Modified: trunk/src/CacheWolf/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporterScreen.java	2007-06-15 18:09:36 UTC (rev 747)
+++ trunk/src/CacheWolf/OCXMLImporterScreen.java	2007-06-15 18:53:15 UTC (rev 748)
@@ -19,43 +19,43 @@
 	mCheckBox imagesCheckBox, /*mapsCheckBox, */ missingCheckBox, foundCheckBox;
 	mLabel distLbl;
 	mLabel distUnit;
-	static int IMAGESANDMAPS = 0;
-	static int ALL = 1;
-	static int INCLUDEFOUND = 2;
-	static int SINGLE = 3;
+	static int DIST = 1;
+	static int IMAGES = 2;
+	static int ALL = 4;
+	static int INCLUDEFOUND = 8;
 
 	
 	public OCXMLImporterScreen(String title, int options) {
 		super();
 		pref = Global.getPref(); // myPreferences sollte sp?ter auch diese Einstellungen speichern
 		
+		switch (options){
+		
+		}
 
 		this.title = title;
-		if (options != SINGLE) {
+		if ((options & DIST) > 0) {
 			this.addNext(distLbl = new mLabel(MyLocale.getMsg(1601,"Distance:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 			distanceInput = new mInput();
 			distanceInput.setText(Global.getProfile().distOC);
 			this.addNext(distanceInput,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 			this.addLast(distUnit = new mLabel(" km"),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		}
-		
-		imagesCheckBox = new mCheckBox();
-		imagesCheckBox.setText(MyLocale.getMsg(1602,"Download Images"));
-		imagesCheckBox.setState(true); // @ToDo: aus Prefs
-		this.addLast(imagesCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
-		if(options == INCLUDEFOUND){
+
+		if ((options & IMAGES) > 0) {
+			imagesCheckBox = new mCheckBox();
+			imagesCheckBox.setText(MyLocale.getMsg(1602,"Download Images"));
+			imagesCheckBox.setState(true); // @ToDo: aus Prefs
+			this.addLast(imagesCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
+		}
+		if((options & INCLUDEFOUND) > 0){
 			foundCheckBox = new mCheckBox();
 			foundCheckBox.setText(MyLocale.getMsg(1622,"Exclude found caches"));
 			foundCheckBox.setState(true);
 			this.addLast(foundCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
 		}
-/*		
-		mapsCheckBox = new mCheckBox();
-		mapsCheckBox.setText(MyLocale.getMsg(1603,"Download Maps"));
-		mapsCheckBox.setState(true); // @ToDo: aus Prefs
-		this.addLast(mapsCheckBox, CellConstants.DONTSTRETCH, CellConstants.DONTFILL|CellConstants.WEST);
-	*/	
-		if(options == ALL){
+
+		if((options & ALL) > 0){
 			missingCheckBox = new mCheckBox();
 			missingCheckBox.setText(MyLocale.getMsg(1606,"Alle erneut downloaden"));
 			missingCheckBox.setState(false); // @ToDo: aus Prefs

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-15 18:09:36 UTC (rev 747)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-15 18:53:15 UTC (rev 748)
@@ -221,7 +221,7 @@
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5501,"Login failed!"), MessageBox.OKB)).execute();
 			return;
 		}
-		OCXMLImporterScreen options = new OCXMLImporterScreen("Spider Options", OCXMLImporterScreen.INCLUDEFOUND);
+		OCXMLImporterScreen options = new OCXMLImporterScreen("Spider Options",	OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST);
 		options.distanceInput.setText("");
 		if (options.execute() == OCXMLImporterScreen.IDCANCEL) {return; }
 		String dist = options.distanceInput.getText();



From kalli at mail.berlios.de  Fri Jun 15 21:29:08 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Fri, 15 Jun 2007 21:29:08 +0200
Subject: [Cachewolf-svn] r749 - trunk/src/CacheWolf
Message-ID: <200706151929.l5FJT8TM031826@sheep.berlios.de>

Author: kalli
Date: 2007-06-15 21:29:05 +0200 (Fri, 15 Jun 2007)
New Revision: 749

Modified:
   trunk/src/CacheWolf/myTableControl.java
Log:
FR #3495: Einzelne OC-Caches syncen. Die Anzeigen in der InfoBox k?\195?\182nnten noch verbessert werden.

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-06-15 18:53:15 UTC (rev 748)
+++ trunk/src/CacheWolf/myTableControl.java	2007-06-15 19:29:05 UTC (rev 749)
@@ -125,32 +125,32 @@
 			for(int i = 0; i <	cacheDB.size(); i++){
 				ch = (CacheHolder)cacheDB.get(i);
 				if(ch.is_Checked == true) {
-					if ( ch.wayPoint.length()>1)
-
+					if ( ch.wayPoint.length()>1 && (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC") 
+							 					 || ch.wayPoint.substring(0,2).equalsIgnoreCase("OC")))
 //						if ( (ch.wayPoint.length() > 1 && ch.wayPoint.substring(0,2).equalsIgnoreCase("GC")))
 //						Notiz: Wenn es ein addi Wpt ist, sollte eigentlich der Maincache gespidert werden
 //						Alter code pr?ft aber nur ob ein Maincache von GC existiert und versucht dann den addi direkt zu spidern, was nicht funktioniert
 //						TODO: Diese Meldungen vor dem Einloggen darstellen						
 					{
-				    infB.setInfo("Loading: " + ch.wayPoint);
-				    if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))
-				    	test = spider.spiderSingle(i, infB);
-				    else if ((ch.wayPoint.substring(0,2).equalsIgnoreCase("OC"))) 
-				    		test = ocSync.syncSingle(i, infB);
-				    	else {
+					    infB.setInfo("Loading: " + ch.wayPoint);
+					    if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))   
+					    	test = spider.spiderSingle(i, infB);
+					    else  
+					    	test = ocSync.syncSingle(i, infB);
+						if (!test) {
+							infB.close(0);
+							break;
+						}
+					} else { 
+						if (ch.isAddiWpt() && !ch.mainCache.is_Checked && !alreadySaid2) { // Is the father ticked?
+							alreadySaid2=true;
+							(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).exec();
+						}
+						if (!ch.isAddiWpt() && !alreadySaid) {
 							alreadySaid = true;
 							(new MessageBox("Information",ch.wayPoint+ ": Diese Funktion steht gegenw?rtig nur f?r Geocaching.com und Opencaching.de zur Verf?gung", MessageBox.OKB)).exec();
-				    	}
-					if (!test) {
-						infB.close(0);
-						break;
+			    		}
 					}
-					} else if (ch.isAddiWpt() && !ch.mainCache.is_Checked) { // Is the father ticked?
-						if (!alreadySaid2) {
-							alreadySaid2=true;
-							(new MessageBox("Information","Hilfswegpunkte k?nnnen nicht direkt gespidert werden\nBitte zus?tzlich den Vater anhaken", MessageBox.OKB)).exec();
-						}
-					} 
 				}
 
 				infB.close(0);
@@ -158,10 +158,10 @@
 				profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 //				cacheDB.clear();
 //				profile.readIndex();
-				profile.restoreFilter();
-				profile.updateBearingDistance();
-				tbp.refreshTable();
 			}
+			profile.restoreFilter();
+			profile.updateBearingDistance();
+			tbp.refreshTable();
 			Vm.showWait(false);
 		}
 		if (selectedItem.toString().equals(MyLocale.getMsg(1019,"Center"))){



From salzkammergut at mail.berlios.de  Sat Jun 16 14:44:46 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 16 Jun 2007 14:44:46 +0200
Subject: [Cachewolf-svn] r750 - trunk/resources/attributes
Message-ID: <200706161244.l5GCikoh009361@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-16 14:44:07 +0200 (Sat, 16 Jun 2007)
New Revision: 750

Added:
   trunk/resources/attributes/available-no.gif
   trunk/resources/attributes/bicycles-no.gif
   trunk/resources/attributes/boat-no.gif
   trunk/resources/attributes/cactus-no.gif
   trunk/resources/attributes/cactus-yes.gif
   trunk/resources/attributes/campfires-no.gif
   trunk/resources/attributes/camping-no.gif
   trunk/resources/attributes/cliff-no.gif
   trunk/resources/attributes/climbing-no.gif
   trunk/resources/attributes/compass-no.gif
   trunk/resources/attributes/compass-yes.gif
   trunk/resources/attributes/cow-no.gif
   trunk/resources/attributes/danger-no.gif
   trunk/resources/attributes/dogs-no.gif
   trunk/resources/attributes/error.gif
   trunk/resources/attributes/fee-no.gif
   trunk/resources/attributes/hiking-no.gif
   trunk/resources/attributes/horses-no.gif
   trunk/resources/attributes/hunting-no.gif
   trunk/resources/attributes/jeeps-no.gif
   trunk/resources/attributes/kids-no.gif
   trunk/resources/attributes/mine-no.gif
   trunk/resources/attributes/motorcycles-no.gif
   trunk/resources/attributes/night-no.gif
   trunk/resources/attributes/onehour-no.gif
   trunk/resources/attributes/parking-no.gif
   trunk/resources/attributes/phone-no.gif
   trunk/resources/attributes/picnic-no.gif
   trunk/resources/attributes/poisonoak-no.gif
   trunk/resources/attributes/public-no.gif
   trunk/resources/attributes/quads-no.gif
   trunk/resources/attributes/rappelling-no.gif
   trunk/resources/attributes/restrooms-no.gif
   trunk/resources/attributes/scenic-no.gif
   trunk/resources/attributes/scuba-no.gif
   trunk/resources/attributes/snakes-no.gif
   trunk/resources/attributes/snowmobiles-no.gif
   trunk/resources/attributes/stealth-no.gif
   trunk/resources/attributes/stroller-no.gif
   trunk/resources/attributes/swimming-no.gif
   trunk/resources/attributes/thorn-no.gif
   trunk/resources/attributes/ticks-no.gif
   trunk/resources/attributes/wading-no.gif
   trunk/resources/attributes/water-no.gif
   trunk/resources/attributes/wheelchair-no.gif
   trunk/resources/attributes/winter-no.gif
Log:
Weitere Icons fuer Cache-Attribute

Added: trunk/resources/attributes/available-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/available-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/bicycles-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/bicycles-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/boat-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/boat-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cactus-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cactus-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cactus-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cactus-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/campfires-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/campfires-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/camping-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/camping-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cliff-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cliff-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/climbing-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/climbing-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/compass-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/compass-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/compass-yes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/compass-yes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/cow-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/cow-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/danger-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/danger-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/dogs-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/dogs-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/error.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/error.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/fee-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/fee-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hiking-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hiking-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/horses-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/horses-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/hunting-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/hunting-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/jeeps-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/jeeps-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/kids-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/kids-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/mine-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/mine-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/motorcycles-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/motorcycles-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/night-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/night-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/onehour-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/onehour-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/parking-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/parking-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/phone-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/phone-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/picnic-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/picnic-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/poisonoak-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/poisonoak-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/public-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/public-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/quads-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/quads-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/rappelling-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/rappelling-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/restrooms-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/restrooms-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scenic-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scenic-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/scuba-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/scuba-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snakes-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snakes-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/snowmobiles-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/snowmobiles-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stealth-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stealth-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/stroller-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/stroller-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/swimming-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/swimming-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/thorn-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/thorn-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/ticks-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/ticks-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wading-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wading-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/water-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/water-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/wheelchair-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/wheelchair-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/resources/attributes/winter-no.gif
===================================================================
(Binary files differ)


Property changes on: trunk/resources/attributes/winter-no.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From salzkammergut at mail.berlios.de  Sat Jun 16 18:59:11 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 16 Jun 2007 18:59:11 +0200
Subject: [Cachewolf-svn] r751 - trunk/src/CacheWolf
Message-ID: <200706161659.l5GGxBlp007576@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-16 18:59:02 +0200 (Sat, 16 Jun 2007)
New Revision: 751

Modified:
   trunk/src/CacheWolf/OCXMLImporterScreen.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
SpiderGC: Bugfix

Modified: trunk/src/CacheWolf/OCXMLImporterScreen.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporterScreen.java	2007-06-16 12:44:07 UTC (rev 750)
+++ trunk/src/CacheWolf/OCXMLImporterScreen.java	2007-06-16 16:59:02 UTC (rev 751)
@@ -77,7 +77,7 @@
 			}
 			if (ev.target == okB){
 				    // distOC wird hier noch nicht in Pref eingetragen, damit noch gepr?ft werden kann, ob es gr??er oder kleiner ist als vorher
-					pref.downloadPicsOC = imagesCheckBox.state;
+					if (imagesCheckBox!=null) pref.downloadPicsOC = imagesCheckBox.state;
 					if (missingCheckBox!=null) pref.downloadmissingOC = missingCheckBox.state;
 					// TODO: sofort speichern?
 				this.close(Form.IDOK);

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-16 12:44:07 UTC (rev 750)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-16 16:59:02 UTC (rev 751)
@@ -221,7 +221,7 @@
 			(new MessageBox(MyLocale.getMsg(5500,"Error"), MyLocale.getMsg(5501,"Login failed!"), MessageBox.OKB)).execute();
 			return;
 		}
-		OCXMLImporterScreen options = new OCXMLImporterScreen("Spider Options",	OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST);
+		OCXMLImporterScreen options = new OCXMLImporterScreen("Spider Options",	OCXMLImporterScreen.INCLUDEFOUND | OCXMLImporterScreen.DIST| OCXMLImporterScreen.IMAGES);
 		options.distanceInput.setText("");
 		if (options.execute() == OCXMLImporterScreen.IDCANCEL) {return; }
 		String dist = options.distanceInput.getText();



From salzkammergut at mail.berlios.de  Sun Jun 17 00:27:34 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 17 Jun 2007 00:27:34 +0200
Subject: [Cachewolf-svn] r752 - trunk/src/CacheWolf
Message-ID: <200706162227.l5GMRYN8010591@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-17 00:27:31 +0200 (Sun, 17 Jun 2007)
New Revision: 752

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
Solver: Bugfix Speichern der Solverinstruktionen im Cache

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-06-16 16:59:02 UTC (rev 751)
+++ trunk/src/CacheWolf/MainTab.java	2007-06-16 22:27:31 UTC (rev 752)
@@ -26,12 +26,13 @@
 	ImagePanel imageP;
 	SolverPanel solverP;
 	String lastselected = new String();
-	CacheHolder ch=null;
+	CacheHolder ch=null,chNew=null;
 	CacheHolderDetail chD =null, chMain=null;
 	MainMenu mnuMain;
 	StatusBar statBar;
 	MovingMap mm;
 	Navigate nav;
+	boolean cacheChanged;
 
 	public MainTab(MainMenu mainMenu,StatusBar statBar){
 		Global.mainTab=this;
@@ -139,8 +140,8 @@
 
 	public void onEvent(Event ev)
 	{
-		//Vm.debug(ev.toString()+"/"+this.getSelectedItem());
-		if(ev instanceof MultiPanelEvent){
+		if(ev instanceof MultiPanelEvent){ 
+			// A panel is selected.
 			mnuMain.allowProfileChange(false);	  
 			if(this.getSelectedItem() == 0){// List view selected
 				mnuMain.allowProfileChange(true);	  
@@ -148,25 +149,33 @@
 //				Vm.setSIP(0);
 				MyLocale.setSIPOff();
 			}
-			updatePendingChanges();
-			if(this.getSelectedItem() != 0){// any panel other than list view
-				if (tbP.getSelectedCache()>=cacheDB.size() || tbP.getSelectedCache()<0) {
-					ch=null; chD=null;
-				} else {
-					ch = (CacheHolder)cacheDB.get(tbP.getSelectedCache());
-					try {
-						if(ch.wayPoint.equals(lastselected) == false){
-							chD=new CacheHolderDetail(ch);
-							chD.readCache(profile.dataDir);
-							lastselected = ch.wayPoint;
-						}
-					} catch(Exception e){
-						//Vm.debug("Error loading: "+ch.wayPoint);
-					}
+			// Get current cacheHolder
+			if (tbP.getSelectedCache()>=cacheDB.size() || tbP.getSelectedCache()<0) {
+				chNew=null; chD=null;
+			}
+			else
+				chNew = (CacheHolder)cacheDB.get(tbP.getSelectedCache());
+			// Is it the same as the last one?
+			cacheChanged=chNew!=ch;
+			if (cacheChanged) { // new object not same reference as old
+				updatePendingChanges(); // Save dirty data
+	            ch=chNew;		
+	            chD=null;
+			}
+			// Only load the details if we leave the list view and the details
+			// have not already been loaded
+			if(this.getSelectedItem() != 0 && chD==null){// any panel other than list view without detail
+				try {
+					chD=new CacheHolderDetail(ch);
+					chD.readCache(profile.dataDir);//Vm.debug("MainTab:readCache "+chD.wayPoint+"/S:"+chD.Solver);
+					//lastselected = ch.wayPoint;
+				} catch(Exception e){
+					//Vm.debug("Error loading: "+ch.wayPoint);
 				}
-			} else statBar.updateDisplay();
-			// If no cache is selected, create a new one
-			switch (this.getSelectedItem()) {
+			}
+			// We are in list view, update the status display
+			else statBar.updateDisplay();
+			switch (this.getSelectedItem()) {// Switch by panel number
 			case 0:
 				if (detP.hasBlackStatusChanged()) {
 					// Restore the filter status (this automatically sets the status for blacklisted caches)
@@ -220,16 +229,17 @@
 				break;
 			case 7:  // Solver Panel
 				MyLocale.setSIPButton();
-				if (chD.isAddiWpt()) { 
-					chMain=new CacheHolderDetail(chD.mainCache);
-					try {
-						chMain.readCache(profile.dataDir);
-					} catch(Exception e){pref.log("Error reading cache",e);}
-					//Vm.debug("mainT: AddiWaypoint:"+chD.wayPoint+", MainWp:"+chMain.wayPoint);
-					solverP.setInstructions(chMain.Solver);
-				} else {
-					//Vm.debug("mainT: Waypoint:"+chD.wayPoint);
-					solverP.setInstructions(chD.Solver);
+				if (chD!=null) {
+					if (chD.isAddiWpt()) { 
+						chMain=new CacheHolderDetail(chD.mainCache);
+						try {
+							chMain.readCache(profile.dataDir);//Vm.debug("mainT:readCache "+chD.wayPoint+"=>Main=>"+chMain.wayPoint+"/S:"+chMain.Solver);
+						} catch(Exception e){pref.log("Error reading cache",e);}
+						solverP.setInstructions(chMain.Solver);
+					} else {
+						//Vm.debug("mainT: Waypoint:"+chD.wayPoint);
+						solverP.setInstructions(chD.Solver);
+					}
 				}
 				break;
 			case 8:  // Cache Radar Panel
@@ -292,10 +302,12 @@
 		if (chD!=null && solverP.isDirty()) {
 			if (chMain==null) {
 				chD.Solver=solverP.getInstructions();
-				chD.saveCacheDetails(Global.getProfile().dataDir);
+				chD.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chD.wayPoint+"/S:"+chD.Solver);
+				solverP.setInstructions("");
 			} else {
 				chMain.Solver=solverP.getInstructions();
-				chMain.saveCacheDetails(Global.getProfile().dataDir);
+				chMain.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chMain.wayPoint+"/S:"+chMain.Solver);
+				solverP.setInstructions("");
 				chMain=null;
 			}
 		}

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2007-06-16 16:59:02 UTC (rev 751)
+++ trunk/src/CacheWolf/SolverPanel.java	2007-06-16 22:27:31 UTC (rev 752)
@@ -38,6 +38,7 @@
 	public void setInstructions(String text) {
 		mText.setText(text);
 		mText.repaint();
+		dirty=false;
 	}
 	
 	



From salzkammergut at mail.berlios.de  Sun Jun 17 00:38:28 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 17 Jun 2007 00:38:28 +0200
Subject: [Cachewolf-svn] r753 - trunk/src/CacheWolf
Message-ID: <200706162238.l5GMcSNd027207@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-17 00:38:26 +0200 (Sun, 17 Jun 2007)
New Revision: 753

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
Nachtrag zu vorherigem Commit

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-06-16 22:27:31 UTC (rev 752)
+++ trunk/src/CacheWolf/MainTab.java	2007-06-16 22:38:26 UTC (rev 753)
@@ -32,7 +32,6 @@
 	StatusBar statBar;
 	MovingMap mm;
 	Navigate nav;
-	boolean cacheChanged;
 
 	public MainTab(MainMenu mainMenu,StatusBar statBar){
 		Global.mainTab=this;
@@ -152,12 +151,14 @@
 			// Get current cacheHolder
 			if (tbP.getSelectedCache()>=cacheDB.size() || tbP.getSelectedCache()<0) {
 				chNew=null; chD=null;
+				lastselected="";
 			}
-			else
+			else {
 				chNew = (CacheHolder)cacheDB.get(tbP.getSelectedCache());
+				lastselected=chNew.wayPoint;  // Used in Parser.Skeleton
+			}
 			// Is it the same as the last one?
-			cacheChanged=chNew!=ch;
-			if (cacheChanged) { // new object not same reference as old
+			if (chNew!=ch) { // new object not same reference as old
 				updatePendingChanges(); // Save dirty data
 	            ch=chNew;		
 	            chD=null;
@@ -168,7 +169,6 @@
 				try {
 					chD=new CacheHolderDetail(ch);
 					chD.readCache(profile.dataDir);//Vm.debug("MainTab:readCache "+chD.wayPoint+"/S:"+chD.Solver);
-					//lastselected = ch.wayPoint;
 				} catch(Exception e){
 					//Vm.debug("Error loading: "+ch.wayPoint);
 				}



From salzkammergut at mail.berlios.de  Sun Jun 17 01:21:27 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sun, 17 Jun 2007 01:21:27 +0200
Subject: [Cachewolf-svn] r754 - in trunk: resources src/CacheWolf
Message-ID: <200706162321.l5GNLRe7009306@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-17 01:21:19 +0200 (Sun, 17 Jun 2007)
New Revision: 754

Added:
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/AttributesViewer.java
Modified:
   trunk/resources/GCTemplate.html
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/SpiderGC.java
Log:
GC Attribute: Erste Implementation.
Attribute werden gespidert und im Detailpanel angezeigt. 
Beim Ueberfahren des Attributs mit dem Cursor wird ein Infotext angezeigt (Infotexte noch zu erstellen).
Die Infotexte liegen ab Nummer 2500 in Languages.cfg
Die Attribute muessen im 'attributes' Verzeichnis unterhalb von 'work' liegen.

Modified: trunk/resources/GCTemplate.html
===================================================================
--- trunk/resources/GCTemplate.html	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/resources/GCTemplate.html	2007-06-16 23:21:19 UTC (rev 754)
@@ -64,6 +64,11 @@
 	Difficulty: <tmpl_var DIFFICULTY> 	Terrain: <tmpl_var TERRAIN>
 	<FONT face="Verdana" size="-2">&nbsp;&nbsp;&nbsp;(ratings out of 5 stars. 1 is easiest, 5 is hardest)</FONT><br/>
 	Container: <strong><tmpl_var SIZE></strong><br/><br/>
+</div>
+<div style="float:right;margin:0; margin-top:10px"><FONT face="Verdana" size="4"><strong><tmpl_var WAYPOINT></strong></FONT><br/></div>
+
+<div style="float:left">
+	<div style="float:left;">
 	<table cellpadding=0>
 		<tr><td>Waypoint:</td><td> <tmpl_var WAYPOINT></td></tr>
 		<tr><td>Hidden:</td><td> <tmpl_var DATE></td></tr>
@@ -71,8 +76,12 @@
 		<tr><td>Bearing:</td><td> <tmpl_var BEARING></td></tr>
 		<tr><td>Status:</td><td> <tmpl_var STATUS></td></tr>
 	</table>
+	</div>
+	<div style="float:right;">
+		<tmpl_loop ATTRIBUTES><tmpl_var IMAGE><tmpl_var BR><!--<tmpl_var INFO>-->
+		</tmpl_loop>
+	</div>
 </div>
-<div style="float:right;margin:0; margin-top:10px"><FONT face="Verdana" size="4"><strong><tmpl_var WAYPOINT></strong></FONT></div>
 <div style="float:left">
 	<hr>
 <tmpl_if UNAVAILABLE>	

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/resources/cachewolf.Languages.cfg	2007-06-16 23:21:19 UTC (rev 754)
@@ -325,6 +325,93 @@
 		1801=Kacheln herunterladen
 		2000=GPX Export
 		2001=von
+		2500=Fehler beim Laden des Attributs oder unbekanntes Attribut
+		2501=available-no
+		2502=available-yes
+		2503=bicycles-no
+		2504=bicycles-yes
+		2505=boat-no
+		2506=boat-yes
+		2507=cactus-no
+		2508=cactus-yes
+		2509=campfires-no
+		2510=campfires-yes
+		2511=camping-no
+		2512=camping-yes
+		2513=cliff-no
+		2514=cliff-yes
+		2515=climbing-no
+		2516=climbing-yes
+		2517=compass-no
+		2518=compass-yes
+		2519=cow-no
+		2520=cow-yes
+		2521=danger-no
+		2522=danger-yes
+		2523=dogs-no
+		2524=dogs-yes
+		2525=fee-no
+		2526=fee-yes
+		2527=hiking-no
+		2528=hiking-yes
+		2529=horses-no
+		2530=horses-yes
+		2531=hunting-no
+		2532=hunting-yes
+		2533=jeeps-no
+		2534=jeeps-yes
+		2535=kids-no
+		2536=kids-yes
+		2537=mine-no
+		2538=mine-yes
+		2539=motorcycles-no
+		2540=motorcycles-yes
+		2541=night-no
+		2542=night-yes
+		2543=onehour-no
+		2544=onehour-yes
+		2545=parking-no
+		2546=parking-yes
+		2547=phone-no
+		2548=phone-yes
+		2549=picnic-no
+		2550=picnic-yes
+		2551=poisonoak-no
+		2552=poisonoak-yes
+		2553=public-no
+		2554=public-yes
+		2555=quads-no
+		2556=quads-yes
+		2557=rappelling-no
+		2558=rappelling-yes
+		2559=restrooms-no
+		2560=restrooms-yes
+		2561=scenic-no
+		2562=scenic-yes
+		2563=scuba-no
+		2564=scuba-yes
+		2565=snakes-no
+		2566=snakes-yes
+		2567=snowmobiles-no
+		2568=snowmobiles-yes
+		2569=stealth-no
+		2570=stealth-yes
+		2571=stroller-no
+		2572=stroller-yes
+		2573=swimming-no
+		2574=swimming-yes
+		2575=thorn-no
+		2576=thorn-yes
+		2577=ticks-no
+		2578=ticks-yes
+		2579=wading-no
+		2580=wading-yes
+		2581=water-no
+		2582=water-yes
+		2583=wheelchair-no
+		2584=wheelchair-yes
+		2585=winter-no
+		2586=winter-yes
 		3000=Schlie%dfen
 		4000=Geladene Caches:
 		4100=Verzeichnis w%e4hlen:
@@ -669,6 +756,93 @@
 		1801=Download tiles
 		2000=GPX Export
 		2001=of
+		2500=Error loading attributes or unknown attribute
+		2501=available-no
+		2502=available-yes
+		2503=bicycles-no
+		2504=bicycles-yes
+		2505=boat-no
+		2506=boat-yes
+		2507=cactus-no
+		2508=cactus-yes
+		2509=campfires-no
+		2510=campfires-yes
+		2511=camping-no
+		2512=camping-yes
+		2513=cliff-no
+		2514=cliff-yes
+		2515=climbing-no
+		2516=climbing-yes
+		2517=compass-no
+		2518=compass-yes
+		2519=cow-no
+		2520=cow-yes
+		2521=danger-no
+		2522=danger-yes
+		2523=dogs-no
+		2524=dogs-yes
+		2525=fee-no
+		2526=fee-yes
+		2527=hiking-no
+		2528=hiking-yes
+		2529=horses-no
+		2530=horses-yes
+		2531=hunting-no
+		2532=hunting-yes
+		2533=jeeps-no
+		2534=jeeps-yes
+		2535=kids-no
+		2536=kids-yes
+		2537=mine-no
+		2538=mine-yes
+		2539=motorcycles-no
+		2540=motorcycles-yes
+		2541=night-no
+		2542=night-yes
+		2543=onehour-no
+		2544=onehour-yes
+		2545=parking-no
+		2546=parking-yes
+		2547=phone-no
+		2548=phone-yes
+		2549=picnic-no
+		2550=picnic-yes
+		2551=poisonoak-no
+		2552=poisonoak-yes
+		2553=public-no
+		2554=public-yes
+		2555=quads-no
+		2556=quads-yes
+		2557=rappelling-no
+		2558=rappelling-yes
+		2559=restrooms-no
+		2560=restrooms-yes
+		2561=scenic-no
+		2562=scenic-yes
+		2563=scuba-no
+		2564=scuba-yes
+		2565=snakes-no
+		2566=snakes-yes
+		2567=snowmobiles-no
+		2568=snowmobiles-yes
+		2569=stealth-no
+		2570=stealth-yes
+		2571=stroller-no
+		2572=stroller-yes
+		2573=swimming-no
+		2574=swimming-yes
+		2575=thorn-no
+		2576=thorn-yes
+		2577=ticks-no
+		2578=ticks-yes
+		2579=wading-no
+		2580=wading-yes
+		2581=water-no
+		2582=water-yes
+		2583=wheelchair-no
+		2584=wheelchair-yes
+		2585=winter-no
+		2586=winter-yes
 		3000=Close
 		4000=Loaded caches
 		4101=Maps

Added: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/Attribute.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -0,0 +1,162 @@
+package CacheWolf;
+
+import ewe.fx.mImage;
+import ewe.io.File;
+
+/**
+ * This class represents a single attribute
+ * @author skg
+ *
+ */
+public class Attribute {
+	// Constructors
+	public Attribute() { attNo=0; }
+	public Attribute(String attributeName) { attNo=attName2int(attributeName); }
+	
+	private int attNo;
+
+	/**
+	 * The attribute names are identical to the image names.
+	 * Internally the first image name has number 0, the next number 1 and so on.
+	 */
+	private String [] attributeNames= {
+			"error.gif",			//00 Unknown attribute
+			"available-no.gif", 	//01
+			"available-yes.gif", 	//02 available 24-7
+			"bicycles-no.gif", 		//03 no bikes
+			"bicycles-yes.gif", 	//04 bikes allowed
+			"boat-no.gif", 			//05
+			"boat-yes.gif", 		//06
+			"cactus-no.gif", 		//07
+			"cactus-yes.gif",		//08
+			"campfires-no.gif", 	//09 no campfires
+			"campfires-yes.gif", 	//10
+			"camping-no.gif", 		//11
+			"camping-yes.gif", 		//12
+			"cliff-no.gif", 		//13
+			"cliff-yes.gif", 		//14
+			"climbing-no.gif", 		//15
+			"climbing-yes.gif", 	//16
+			"compass-no.gif", 		//17
+			"compass-yes.gif",		//18
+			"cow-no.gif", 			//19
+			"cow-yes.gif", 			//20
+			"danger-no.gif", 		//21
+			"danger-yes.gif", 		//22
+			"dogs-no.gif", 			//23
+			"dogs-yes.gif", 		//24 dogs allowed
+			"fee-no.gif", 			//25
+			"fee-yes.gif", 			//26
+			"hiking-no.gif", 		//27
+			"hiking-yes.gif", 		//28
+			"horses-no.gif", 		//29 no horses
+			"horses-yes.gif", 		//30
+			"hunting-no.gif", 		//31
+			"hunting-yes.gif", 		//32
+			"jeeps-no.gif", 		//33
+			"jeeps-yes.gif", 		//34
+			"kids-no.gif", 			//35
+			"kids-yes.gif", 		//36 kid friendly
+			"mine-no.gif", 			//37
+			"mine-yes.gif", 		//38
+			"motorcycles-no.gif", 	//39
+			"motorcycles-yes.gif", 	//40
+			"night-no.gif", 		//41 not recommended at night
+			"night-yes.gif", 		//42
+			"onehour-no.gif", 		//43 takes more than one hour
+			"onehour-yes.gif", 		//44 takes less than one hour
+			"parking-no.gif", 		//45
+			"parking-yes.gif", 		//46 parking available
+			"phone-no.gif", 		//47
+			"phone-yes.gif", 		//48
+			"picnic-no.gif", 		//49
+			"picnic-yes.gif", 		//50
+			"poisonoak-no.gif", 	//51
+			"poisonoak-yes.gif", 	//52
+			"public-no.gif", 		//53
+			"public-yes.gif", 		//54 public transit available
+			"quads-no.gif", 		//55
+			"quads-yes.gif", 		//56 quads allowed
+			"rappelling-no.gif", 	//57
+			"rappelling-yes.gif", 	//58
+			"restrooms-no.gif", 	//59
+			"restrooms-yes.gif", 	//60
+			"scenic-no.gif", 		//61
+			"scenic-yes.gif", 		//62 scenic view
+			"scuba-no.gif", 		//63
+			"scuba-yes.gif", 		//64
+			"snakes-no.gif", 		//65
+			"snakes-yes.gif", 		//66
+			"snowmobiles-no.gif", 	//67
+			"snowmobiles-yes.gif", 	//68
+			"stealth-no.gif", 		//69
+			"stealth-yes.gif", 		//70 stealth required
+			"stroller-no.gif",		//71 not stroller accessible
+			"stroller-yes.gif", 	//72 stroller accessible
+			"swimming-no.gif", 		//73
+			"swimming-yes.gif", 	//74
+			"thorn-no.gif", 		//75
+			"thorn-yes.gif", 		//76 thorns!
+			"ticks-no.gif", 		//77
+			"ticks-yes.gif", 		//78 ticks!
+			"wading-no.gif", 		//79
+			"wading-yes.gif", 		//80
+			"water-no.gif", 		//81
+			"water-yes.gif", 		//82
+			"wheelchair-no.gif", 	//83 not wheelchair accessible
+			"wheelchair-yes.gif", 	//84
+			"winter-no.gif", 		//85 not available for winter
+			"winter-yes.gif"}; 		//86 available in winter
+	private mImage [] attributeImages=new mImage[87];
+	private static String IMAGEDIR=File.getProgramDirectory()+"\\Attributes\\";
+	
+	public static String getImageDir() {
+		return IMAGEDIR; 
+	}
+    
+    
+	public String getImageName(){
+		if (attNo>attributeNames.length)
+			return "error.gif";
+		else return attributeNames[attNo];
+	}
+	
+	public String getInfo(){
+		return MyLocale.getMsg(2500+attNo,"No attribute info found");
+	}
+	
+    /**
+     * Get the image for a given attribute number. We use lazy initialisation here, i.e. the images are only
+     * loaded when they are requested. 
+     * @param attNo The attribute number
+     * @return
+     */
+    public mImage getImage() {
+    	if (attNo<0 || attNo>=attributeNames.length) {
+    		return attributeImages[0];
+    	}
+    	if (attributeImages[attNo]==null) {
+    		attributeImages[attNo]=new mImage(IMAGEDIR+attributeNames[attNo]);
+    	}
+    	return attributeImages[attNo];
+    }
+    
+	/**
+     * Encode an attribute name with the internal attribute number
+     * @param attributeName The attribute name (=filename) to encode
+     * @return The number of the attribute
+     */
+    private int attName2int(String attributeName) {
+    	int size=attributeNames.length;
+    	for (int i=1; i<size; i++) {
+    		if (attributeName.equalsIgnoreCase(attributeNames[i])) return i;
+    	}
+    	return 0; // Error
+    }
+
+    { // Static initialisation of error image
+		attributeImages[0]=new mImage(IMAGEDIR+"error.gif");
+	}
+
+	
+}

Added: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/Attributes.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -0,0 +1,85 @@
+package CacheWolf;
+
+import ewe.ui.*;
+import ewe.fx.*;
+import ewe.graphics.*;
+import ewe.util.*;
+
+public class Attributes {
+	private static int MAXATTRIBS=10;
+	/**
+	 * The number of attributes for this cache (=number of array elements in use in attribs)
+	 */
+	private int count=0;
+	/**
+	 * The attributes are represented as a byte array with each element encoding one attribute
+	 */
+	private Attribute attribs[]=new Attribute[MAXATTRIBS];
+
+	public Attributes() { 
+//		attribs[0]=new Attribute("camping-no.gif"); attribs[1]=new Attribute("dogs-yes.gif"); attribs[2]=new Attribute("onehour-yes.gif"); count=3; //TODO REMOVE THIS
+	}
+
+	public int getCount(){
+		return count;
+	}
+	
+	public void clear() {
+		count=0;
+	}
+	
+    ////////////////////////////////////////////////
+    // Attribute set functions
+    ////////////////////////////////////////////////
+	
+	public void XmlAttributesStart() {}
+	public void XmlAttributesEnd(String elem){
+		clear();
+		Extractor ex=new Extractor(elem,"<ATT>","</ATT>",0,true);
+		String dummy = ex.findNext();
+		while(ex.endOfSearch()==false){
+			add(dummy);
+			dummy = ex.findNext();
+		}
+	}
+
+	public void XmlAttributeStart(){}
+	public void XmlAttributeEnd(String elem){
+		add(elem);
+	}
+
+	/*
+	 * Prepare for attributes to be written to cache.xml file 
+	 */
+	public String XmlAttributesWrite(){
+		StringBuffer sb=new StringBuffer(1000);
+		sb.append("<ATTRIBUTES>\n");
+		for (int i=0; i<count; i++) {
+			sb.append("   <ATT>");
+			sb.append(attribs[i].getImageName());
+			sb.append("</ATT>\n");
+		}
+		sb.append("</ATTRIBUTES>\n");
+		return sb.toString();
+	}
+	
+	public void add(String attributeName){
+		if (count<attribs.length) attribs[count++]=new Attribute(attributeName);
+    }
+
+	public String getName(int i) {
+		if (i>=0 && i<count) return attribs[i].getImageName();
+		return "error.gif";
+	}
+	
+	public mImage getImage(int i) {
+		if (i>=0 && i<count) return attribs[i].getImage();
+		return new Attribute().getImage();
+	}
+
+	public String getInfo(int i) {
+		if (i>=0 && i<count) return attribs[i].getInfo();
+		return "No info";
+	}
+}
+

Added: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/AttributesViewer.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -0,0 +1,57 @@
+package CacheWolf;
+
+import ewe.fx.*;
+import ewe.graphics.*;
+import ewe.sys.*;
+import ewe.ui.*;
+
+public class AttributesViewer extends CellPanel {
+	private final static int ICONS_PER_ROW=5;
+	private static int TILESIZE=32;
+	private mLabel mInfo;
+
+	private class attInteractivePanel extends InteractivePanel {
+		public boolean imageMovedOn(AniImage which) {
+			mInfo.setText(((attAniImage)which).info);
+			mInfo.repaintNow();
+			return true;
+		}
+		public boolean imageMovedOff(AniImage which) {
+			mInfo.setText("Attributes:");
+			mInfo.repaintNow();
+			return true;
+		}
+	}
+	
+	private class attAniImage extends AniImage {
+		public String info;
+		attAniImage (mImage img) {
+			super(img);
+		}
+	}
+	
+	public AttributesViewer (){
+		Rect r = new Rect(0,0,TILESIZE * 5,TILESIZE * 2); // As on GC: 5 wide, 2 high
+		iap.virtualSize = r;
+		iap.setFixedSize(TILESIZE * 5,TILESIZE * 2);
+		addLast(mInfo=new mLabel("Attributes:"),HSTRETCH,HFILL);
+		addLast(iap,CellConstants.HSTRETCH,CellConstants.FILL);
+	}
+	private InteractivePanel iap=new attInteractivePanel();
+	
+	public void showImages(Attributes att) {
+		iap.images.clear();
+		for (int i=0; i<att.getCount(); i++) {
+			attAniImage img=new attAniImage( att.getImage(i));
+			img.info=att.getInfo(i);
+			img.location=new Rect((i % ICONS_PER_ROW)*TILESIZE,(i / ICONS_PER_ROW)*TILESIZE,TILESIZE,TILESIZE);
+			iap.addImage(img);			
+		}
+		iap.repaintNow();
+	}
+	
+/*	public void resizeTo(int width, int height) {
+		super.resizeTo(width,height);
+	}
+*/	
+}

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/CacheHolder.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -59,9 +59,11 @@
 public String sort;
 public String lastSyncOC = EMPTY;
 
-CacheHolder() {}
-CacheHolder(String wpt) {this.wayPoint=wpt; }
-CacheHolder(CacheHolder ch) {
+//static int nObjects=0;
+CacheHolder() {//nObjects++;Vm.debug("CacheHolder() nO="+nObjects);
+}
+
+CacheHolder(CacheHolder ch) {//nObjects++;Vm.debug("CacheHolder(ch) nO="+nObjects);
 	this.CacheStatus=ch.CacheStatus;
 	this.wayPoint = ch.wayPoint;
 	this.CacheName = ch.CacheName;
@@ -143,9 +145,10 @@
 		   }
 	   }
    }
-
-//public void finalize() {
-//   Vm.debug("Destroying CacheHolderBase "+wayPoint);
-//}
-
+/*
+public void finalize() {nObjects--;
+   Vm.debug("Destroying CacheHolder "+wayPoint);
+   Vm.debug("CacheHolder: "+nObjects+" objects left");
+}
+*/
 }
\ No newline at end of file

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -23,7 +23,7 @@
 	  public Vector LogImagesText = new Vector();
 	  public Vector UserImages = new Vector();
 	  public Vector UserImagesText = new Vector();
-	  public Vector attributes = new Vector();
+	  public Attributes attributes=new Attributes();
 	  public Vector CacheIcons = new Vector();
 	  public String Bugs = EMPTY;
 	  public String URL = EMPTY;
@@ -221,6 +221,10 @@
 			LongDescription = ex.findNext();
 			ex = new Extractor(text, "<HINTS><![CDATA[", "]]></HINTS>", 0, true);
 			Hints = ex.findNext();
+			// Attributes
+			ex = new Extractor(text,"<ATTRIBUTES>","</ATTRIBUTES>",0,true);
+			attributes.XmlAttributesEnd(ex.findNext());
+			
 			ex = new Extractor(text, "<LOGS>","</LOGS>", 0, true);
 			dummy = ex.findNext();
 			CacheLogs.clear();
@@ -328,6 +332,7 @@
 				  detfile.print("<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n");
 				  detfile.print("<CACHEDETAILS>\r\n");
 				  detfile.print("<DETAILS><![CDATA["+LongDescription+"]]></DETAILS>\r\n");
+				  detfile.print(attributes.XmlAttributesWrite());
 				  detfile.print("<HINTS><![CDATA["+Hints+"]]></HINTS>\r\n");
 				  detfile.print("<LOGS>\r\n");
 				  for(int i = 0; i < CacheLogs.size(); i++){

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -27,6 +27,7 @@
 	Vector cacheDB;
 	CacheHolderDetail thisCache;
 	CellPanel pnlTools = new CellPanel(); 
+	AttributesViewer attV;
 	
 	private boolean dirty_notes = false;
 	private boolean dirty_details = false;
@@ -120,7 +121,10 @@
 		//this.addNext(new mLabel(MyLocale.getMsg(308,"Notes:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		//this.addLast(btnCenter = new mButton(MyLocale.getMsg(309,"Make Center")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 //		this.addLast(btnDelete = new mButton(MyLocale.getMsg(310,"Delete")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		attV=new AttributesViewer();
+		this.addLast(attV);
 		
+		
 	}
 	
 	public boolean isDirty() {
@@ -134,32 +138,32 @@
 	/**
 	*	Set the values to display.
 	*/
-	public void setDetails(CacheHolderDetail ch){
-		thisCache = ch;
+	public void setDetails(CacheHolderDetail chD){
+		thisCache = chD;
 		dirty_notes = false;
 		dirty_details = false;
-		inpWaypoint.setText(ch.wayPoint);
-		inpName.setText(ch.CacheName);
-	    btnWayLoc.setText(ch.pos.toString());
-		inpHidden.setText(ch.DateHidden);
-		inpOwner.setText(ch.CacheOwner);
-		if (ch.CacheStatus.length()>=10 && ch.CacheStatus.charAt(4)=='-')
-			chcStatus.setText(MyLocale.getMsg(318,"Found")+" "+ch.CacheStatus);
+		inpWaypoint.setText(chD.wayPoint);
+		inpName.setText(chD.CacheName);
+	    btnWayLoc.setText(chD.pos.toString());
+		inpHidden.setText(chD.DateHidden);
+		inpOwner.setText(chD.CacheOwner);
+		if (chD.CacheStatus.length()>=10 && chD.CacheStatus.charAt(4)=='-')
+			chcStatus.setText(MyLocale.getMsg(318,"Found")+" "+chD.CacheStatus);
 		else {
-			chcStatus.setText(ch.CacheStatus);
+			chcStatus.setText(chD.CacheStatus);
 			// If the cache status contains a date, do not overwrite it with 'found' message
-			if(ch.is_found == true) chcStatus.setText(MyLocale.getMsg(318,"Found"));
+			if(chD.is_found == true) chcStatus.setText(MyLocale.getMsg(318,"Found"));
 		}
-		chcType.setInt(transType(ch.type));
-		if(ch.is_black){
+		chcType.setInt(transType(chD.type));
+		if(chD.is_black){
 			btnBlack.image = imgBlack;
 		} else {
 			btnBlack.image = imgBlackNo;
 		}
-		blackStatus=ch.is_black; 
+		blackStatus=chD.is_black; 
 		blackStatusChanged=false;
 		btnBlack.repaintNow();
-		if(ch.has_bug == true) {
+		if(chD.has_bug == true) {
 			btnShowBug.modify(Control.Disabled,1);
 			btnShowBug.image = imgShowBug;
 		} else {
@@ -167,14 +171,15 @@
 			btnShowBug.image = imgShowBugNo;
 		}
 		btnShowBug.repaintNow();
-		if(ch.CacheSize.equals("Micro")) chcSize.setInt(1);
-		if(ch.CacheSize.equals("Small")) chcSize.setInt(2);
-		if(ch.CacheSize.equals("Regular")) chcSize.setInt(3);
-		if(ch.CacheSize.equals("Large")) chcSize.setInt(4);
-		if(ch.CacheSize.equals("Other")) chcSize.setInt(5);
-		if(ch.CacheSize.equals("Very Large")) chcSize.setInt(6);
-		if(ch.CacheSize.equals("None")) chcSize.setInt(7);
-		if(ch.CacheSize.equals("Not chosen")) chcSize.setInt(7);
+		if(chD.CacheSize.equals("Micro")) chcSize.setInt(1);
+		if(chD.CacheSize.equals("Small")) chcSize.setInt(2);
+		if(chD.CacheSize.equals("Regular")) chcSize.setInt(3);
+		if(chD.CacheSize.equals("Large")) chcSize.setInt(4);
+		if(chD.CacheSize.equals("Other")) chcSize.setInt(5);
+		if(chD.CacheSize.equals("Very Large")) chcSize.setInt(6);
+		if(chD.CacheSize.equals("None")) chcSize.setInt(7);
+		if(chD.CacheSize.equals("Not chosen")) chcSize.setInt(7);
+		attV.showImages(chD.attributes);
 	}
 	
 	

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -92,6 +92,25 @@
 						tpl.setParam("STATUS",MyLocale.getMsg(318,"Found")+" "+chD.CacheStatus);
 					else
 						tpl.setParam("STATUS", chD.CacheStatus);
+					
+					// Cache attributes
+					if (chD.attributes.getCount()>0) {
+						Vector attVect=new Vector(chD.attributes.getCount()+1);
+						for (int i=0; i<chD.attributes.getCount(); i++) {
+							Hashtable atts=new Hashtable();
+							atts.put("IMAGE","<img src=\"file://"+
+									   Attribute.getImageDir()+chD.attributes.getName(i)+
+									   "\" border=0 alt=\""+chD.attributes.getInfo(i)+"\">");
+							if (i % 5 ==4) 
+								atts.put("BR","<br/>");
+							else
+								atts.put("BR","");
+							atts.put("INFO",chD.attributes.getInfo(i));
+							attVect.add(atts);
+						}
+						tpl.setParam("ATTRIBUTES",attVect);
+					}
+					
 					tpl.setParam("DATE", chD.DateHidden);
 //					tpl.setParam("URL", ch.URL);
 					if (chD.Bugs!=null && chD.Bugs.trim().length()>0) tpl.setParam("BUGS",chD.Bugs);
@@ -148,9 +167,14 @@
 							logs.put("LOG",log);
 							logs.put("LOGTYPE","");
 						} else {
-							int posBr=log.indexOf("<br>");
-							logs.put("LOG",log.substring(posBr));
-							logs.put("LOGTYPE",log.substring(0,posGt)+" border='0'"+log.substring(posGt,posBr+4));
+							int posBr=log.indexOf("<br>"); 
+							if(posBr<0) {
+								logs.put("LOG",log);
+								logs.put("LOGTYPE","");
+							} else {
+								logs.put("LOG",log.substring(posBr));
+								logs.put("LOGTYPE",log.substring(0,posGt)+" border='0'"+log.substring(posGt,posBr+4));
+							}
 						}
 						logs.put("I","'log"+new Integer(i).toString()+"'");
 						logVect.add(logs);

Modified: trunk/src/CacheWolf/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/SpiderGC.java	2007-06-16 22:38:26 UTC (rev 753)
+++ trunk/src/CacheWolf/SpiderGC.java	2007-06-16 23:21:19 UTC (rev 754)
@@ -471,7 +471,15 @@
 				getAddWaypoints(completeWebPage, chD.wayPoint, chD.is_found);
 				pref.log("Got additional waypoints");
 
+				//==========
+				// Attributes
+				//==========
+				pref.log("Getting attributes");
+				getAttributes(completeWebPage, chD);
+				pref.log("Got attributes");
 
+
+
 			}catch(Exception ex){
 				pref.log("Error reading cache: "+chD.wayPoint);
 				pref.log("Exception in getCacheByWaypointName: ",ex);
@@ -941,7 +949,19 @@
 		}
 	}
 	
-
+	private void getAttributes(String doc, CacheHolderDetail chD) {
+		Extractor attBlock = new Extractor(doc,p.getProperty("attBlockExStart"),p.getProperty("attBlockExEnd"), 0 , true);
+		String atts = attBlock.findNext();
+		Extractor attEx = new Extractor(atts,p.getProperty("attExStart"),p.getProperty("attExEnd"), 0 , true);
+		String attribute=attEx.findNext();
+		chD.attributes.clear();
+		while (attEx.endOfSearch()==false) {
+			chD.attributes.add(attribute);
+			attribute=attEx.findNext();
+		}
+	}
+	
+	
 	/**
 	*	Performs an initial fetch to a given address. In this case
 	*	it will be a gc.com address. This method is used to obtain



From kalli at mail.berlios.de  Sun Jun 17 16:54:15 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Sun, 17 Jun 2007 16:54:15 +0200
Subject: [Cachewolf-svn] r755 - trunk/src/CacheWolf
Message-ID: <200706171454.l5HEsFmh023629@sheep.berlios.de>

Author: kalli
Date: 2007-06-17 16:54:08 +0200 (Sun, 17 Jun 2007)
New Revision: 755

Modified:
   trunk/src/CacheWolf/OCXMLImporter.java
   trunk/src/CacheWolf/myTableControl.java
Log:
FR #3495: Einzelne OC-Caches syncen. An der Anzeige der Infoboxen geschraubt.

Modified: trunk/src/CacheWolf/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/OCXMLImporter.java	2007-06-16 23:21:19 UTC (rev 754)
+++ trunk/src/CacheWolf/OCXMLImporter.java	2007-06-17 14:54:08 UTC (rev 755)
@@ -82,16 +82,18 @@
 		ch = (CacheHolder)cacheDB.get(number);
 		chD= new CacheHolderDetail(ch);
 
+		if (infB.isClosed) return false; 
 		if (askForOptions) {
 			OCXMLImporterScreen importOpt = new OCXMLImporterScreen( MyLocale.getMsg(1600, "Opencaching.de Download"),OCXMLImporterScreen.IMAGES);
 			if (importOpt.execute() == OCXMLImporterScreen.IDCANCEL) {	return false; }
 			askForOptions = false;
 		}
 
+		// this is only a dummy-InfoBox for capturing the output
 		inf = new InfoBox("Opencaching download", MyLocale.getMsg(1608,"downloading data\n from opencaching"), InfoBox.PROGRESS_WITH_WARNINGS, false);
-		inf.setPreferredSize(220, 300);
-		inf.relayout(false);
-		inf.exec();
+//		inf.setPreferredSize(220, 300);
+//		inf.relayout(false);
+//		inf.exec();
 
 		
 		String lastS = ch.lastSyncOC;
@@ -117,7 +119,7 @@
 			+ "&session=0";
 		success = syncOC(url);
 		inf.close(0);
-		return success;
+		return true;
 	}
 
 	public void doIt(){

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2007-06-16 23:21:19 UTC (rev 754)
+++ trunk/src/CacheWolf/myTableControl.java	2007-06-17 14:54:08 UTC (rev 755)
@@ -133,14 +133,16 @@
 //						TODO: Diese Meldungen vor dem Einloggen darstellen						
 					{
 					    infB.setInfo("Loading: " + ch.wayPoint);
+					    infB.redisplay();
 					    if (ch.wayPoint.substring(0,2).equalsIgnoreCase("GC"))   
 					    	test = spider.spiderSingle(i, infB);
 					    else  
 					    	test = ocSync.syncSingle(i, infB);
-						if (!test) {
+					    if (!test) {
 							infB.close(0);
 							break;
-						}
+						} else 
+							profile.hasUnsavedChanges=true;	
 					} else { 
 						if (ch.isAddiWpt() && !ch.mainCache.is_Checked && !alreadySaid2) { // Is the father ticked?
 							alreadySaid2=true;
@@ -153,12 +155,12 @@
 					}
 				}
 
-				infB.close(0);
-				profile.hasUnsavedChanges=true;	
-				profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 //				cacheDB.clear();
 //				profile.readIndex();
 			}
+			infB.close(0);
+//			profile.hasUnsavedChanges=true;	
+			profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR);
 			profile.restoreFilter();
 			profile.updateBearingDistance();
 			tbp.refreshTable();



From admin at berlios.de  Sun Jun 17 17:08:14 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 17 Jun 2007 17:08:14 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2877] Terracaching
Message-ID: <200706171508.l5HF8EYt024723@unicorn.berlios.de>

Feature Request #2877, was updated on 2006-Nov-14 22:51
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2877&group_id=2211

Category: 1.0
Status: Closed
Priority: 5
Summary: Terracaching

By: kalli
Date: 2007-Apr-05 21:03

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.3) Gecko/20070309 Firefox/2.0.0.3

Ich hab die Infos ?ber das Terracaching GPX zusammen, mache
den Request wieder auf.

----------------------------------------------------------------------

By: bilbowolf
Date: 2006-Nov-23 15:48

Message:
Logged In: YES 
user_id=10718
Browser: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; CIO CU; .NET CLR 1.0.3705; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.1)

lohnt sich nicht...

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2877&group_id=2211


From admin at berlios.de  Sun Jun 17 17:08:55 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 17 Jun 2007 17:08:55 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3495] Einzelne OC-Caches syncen
Message-ID: <200706171508.l5HF8tBr026079@unicorn.berlios.de>

Feature Request #3495, was updated on 2007-Jun-11 20:39
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3495&group_id=2211

Category: 1.0
Status: Closed
Priority: 5
Summary: Einzelne OC-Caches syncen

By: kalli
Date: 2007-Jun-11 20:39

Message:
Logged In: YES 
user_id=24621
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.4) Gecko/20070515 Firefox/2.0.0.4

siehe http://www.geoclub.de/viewtopic.php?p=261773#261773

Einzelne Caches ?ber die OC-XML-Schnittstelle laden
(wie SpiderSingle)

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3495&group_id=2211


From salzkammergut at mail.berlios.de  Mon Jun 18 23:35:53 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 18 Jun 2007 23:35:53 +0200
Subject: [Cachewolf-svn] r756 - trunk/src/CacheWolf
Message-ID: <200706182135.l5ILZrhU008731@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-18 23:35:45 +0200 (Mon, 18 Jun 2007)
New Revision: 756

Modified:
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/SolverPanel.java
Log:
Maintab: Anordnung der Tabs geaendert: Solver kommt jetzt gleich nach den cache-spezifischen
Panels wie Details,Beschreibung, Bilder, Hints. Anschliessend kommen die eher allgemeinen Panels
wie Calc, Goto, Radar. Ausserdem Bugfix speichern von Details.

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-06-17 14:54:08 UTC (rev 755)
+++ trunk/src/CacheWolf/MainTab.java	2007-06-18 21:35:45 UTC (rev 756)
@@ -59,6 +59,9 @@
 		c = this.addCard(hintLP, MyLocale.getMsg(1204,"Hints & Logs"), null);
 		c.iconize(new Image("more.gif"),true);
 
+		c = this.addCard(solverP = new SolverPanel(pref, profile), MyLocale.getMsg(1205,"Solver"), null);
+		c.iconize(new Image("solver.gif"),true);
+
 		c = this.addCard(calcP, MyLocale.getMsg(1206,"Calc"), null);
 		c.iconize(new Image("ewe/HandHeld.bmp"),true);
 
@@ -67,9 +70,6 @@
 		c.iconize(new Image("goto.gif"),true);
 		nav.setGotoPanel(gotoP);
 
-		c = this.addCard(solverP = new SolverPanel(pref, profile), MyLocale.getMsg(1205,"Solver"), null);
-		c.iconize(new Image("solver.gif"),true);
-
 		c = this.addCard(radarP, "Radar", null);
 		radarP.setMainTab(this);
 		c.iconize(new Image("radar.gif"),true);
@@ -157,12 +157,15 @@
 				chNew = (CacheHolder)cacheDB.get(tbP.getSelectedCache());
 				lastselected=chNew.wayPoint;  // Used in Parser.Skeleton
 			}
-			// Is it the same as the last one?
-			if (chNew!=ch) { // new object not same reference as old
-				updatePendingChanges(); // Save dirty data
-	            ch=chNew;		
-	            chD=null;
+			// Are we back in Listview
+			if(this.getSelectedItem() == 0) {
+				updatePendingChanges(); // Save dirty data from Details/Solver
+				// Is it the same as the last one?
 			}
+		    if (chNew!=ch) { // new object not same reference as old
+	            chD=null; // Throw away the details, not longer valid
+			}
+            ch=chNew;		
 			// Only load the details if we leave the list view and the details
 			// have not already been loaded
 			if(this.getSelectedItem() != 0 && chD==null){// any panel other than list view without detail
@@ -217,18 +220,8 @@
 					hintLP.setText(chD);
 				}
 				break;
-			case 5:  // CalcPanel
-				if (chD!=null) {
-					MyLocale.setSIPButton();
-					calcP.setFields(chD);
-				}
-				break;
-
-			case 6: // GotoPanel
+			case 5:  // Solver Panel
 				MyLocale.setSIPButton();
-				break;
-			case 7:  // Solver Panel
-				MyLocale.setSIPButton();
 				if (chD!=null) {
 					if (chD.isAddiWpt()) { 
 						chMain=new CacheHolderDetail(chD.mainCache);
@@ -242,6 +235,16 @@
 					}
 				}
 				break;
+			case 6:  // CalcPanel
+				if (chD!=null) {
+					MyLocale.setSIPButton();
+					calcP.setFields(chD);
+				}
+				break;
+
+			case 7: // GotoPanel
+				MyLocale.setSIPButton();
+				break;
 			case 8:  // Cache Radar Panel
 				MyLocale.setSIPOff();
 				radarP.setParam(pref, cacheDB, chD==null?"":chD.wayPoint);
@@ -303,11 +306,11 @@
 			if (chMain==null) {
 				chD.Solver=solverP.getInstructions();
 				chD.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chD.wayPoint+"/S:"+chD.Solver);
-				solverP.setInstructions("");
+				solverP.clearDirty();
 			} else {
 				chMain.Solver=solverP.getInstructions();
 				chMain.saveCacheDetails(Global.getProfile().dataDir);//Vm.debug("mainT:SaveCache "+chMain.wayPoint+"/S:"+chMain.Solver);
-				solverP.setInstructions("");
+				solverP.clearDirty();
 				chMain=null;
 			}
 		}

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2007-06-17 14:54:08 UTC (rev 755)
+++ trunk/src/CacheWolf/SolverPanel.java	2007-06-18 21:35:45 UTC (rev 756)
@@ -31,6 +31,9 @@
 	public boolean isDirty() {
 		return dirty;
 	}
+	public void clearDirty() {
+		dirty=false;
+	}
 	
 	public String getInstructions() {
 		return mText.getText();



From salzkammergut at mail.berlios.de  Mon Jun 18 23:44:41 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Mon, 18 Jun 2007 23:44:41 +0200
Subject: [Cachewolf-svn] r757 - trunk/resources
Message-ID: <200706182144.l5ILifZN009438@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-18 23:44:39 +0200 (Mon, 18 Jun 2007)
New Revision: 757

Modified:
   trunk/resources/spider.def
Log:
Spider.def fuer attribute (Bei Rev 754 vergessen - Danke Kalli)

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-06-18 21:35:45 UTC (rev 756)
+++ trunk/resources/spider.def	2007-06-18 21:44:39 UTC (rev 757)
@@ -5,6 +5,7 @@
 # Version 2.1 - 20070601 TB Anpassung an GC ?nderung
 # Version 2.2 - 20070602 firstLine erg?nzt. Damit funktionieren jetzt auch die n?chsten Seiten.
 # Version 2.3 - 20070602 sizeRex an GC ?nderungen angepasst
+# Version 2.4 - 20070616 neu: Attribute
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -27,7 +28,7 @@
 distRex            = <br\ />(.*?)(km|mi)</td>
 waypointRex        = </a> \\((.*?)\\)<br>
 showOnlyFound      = &f=1
-firstLine          = http://www.geocaching.com/seek/nearest.aspx?
+firstLine          = http://www.geocaching.com/seek/nearest.aspx
 nextListPage       = /seek/nearest.aspx
 
 #--------------------------------------
@@ -110,3 +111,11 @@
 typeRex            = </a>\ \\((.*)\\)</td>
 rowBlockExStart    = <tr
 rowBlockExEnd      = </tr>
+
+#--------------------------------------
+#Section2e: Attributes
+#--------------------------------------
+attBlockExStart = &nbsp;<b>Attributes</b><br/><table
+attBlockExEnd  = </td></tr></table>
+attExStart = src="../images/attributes/
+attExEnd = " Alt="



From salzkammergut at mail.berlios.de  Tue Jun 19 22:22:57 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Tue, 19 Jun 2007 22:22:57 +0200
Subject: [Cachewolf-svn] r758 - trunk/src/CacheWolf
Message-ID: <200706192022.l5JKMvNh000338@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-19 22:22:52 +0200 (Tue, 19 Jun 2007)
New Revision: 758

Modified:
   trunk/src/CacheWolf/MainTab.java
Log:
mainTab: Bugfix

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-06-18 21:44:39 UTC (rev 757)
+++ trunk/src/CacheWolf/MainTab.java	2007-06-19 20:22:52 UTC (rev 758)
@@ -158,10 +158,10 @@
 				lastselected=chNew.wayPoint;  // Used in Parser.Skeleton
 			}
 			// Are we back in Listview
-			if(this.getSelectedItem() == 0) {
+			//if(this.getSelectedItem() == 0) {
 				updatePendingChanges(); // Save dirty data from Details/Solver
 				// Is it the same as the last one?
-			}
+			//}
 		    if (chNew!=ch) { // new object not same reference as old
 	            chD=null; // Throw away the details, not longer valid
 			}



From mik77 at mail.berlios.de  Sun Jun 24 12:16:24 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Sun, 24 Jun 2007 12:16:24 +0200
Subject: [Cachewolf-svn] r759 - trunk/resources
Message-ID: <200706241016.l5OAGOOT005403@sheep.berlios.de>

Author: mik77
Date: 2007-06-24 12:16:20 +0200 (Sun, 24 Jun 2007)
New Revision: 759

Modified:
   trunk/resources/spider.def
Log:
verschwundenes "?" wieder hinzugef?\195?\188gt

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-06-19 20:22:52 UTC (rev 758)
+++ trunk/resources/spider.def	2007-06-24 10:16:20 UTC (rev 759)
@@ -28,7 +28,7 @@
 distRex            = <br\ />(.*?)(km|mi)</td>
 waypointRex        = </a> \\((.*?)\\)<br>
 showOnlyFound      = &f=1
-firstLine          = http://www.geocaching.com/seek/nearest.aspx
+firstLine          = http://www.geocaching.com/seek/nearest.aspx?
 nextListPage       = /seek/nearest.aspx
 
 #--------------------------------------



From kalli at mail.berlios.de  Thu Jun 28 20:24:02 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Thu, 28 Jun 2007 20:24:02 +0200
Subject: [Cachewolf-svn] r760 - in trunk/src: CacheWolf exp
Message-ID: <200706281824.l5SIO2Rj012987@sheep.berlios.de>

Author: kalli
Date: 2007-06-28 20:23:55 +0200 (Thu, 28 Jun 2007)
New Revision: 760

Modified:
   trunk/src/CacheWolf/Preferences.java
   trunk/src/exp/Exporter.java
   trunk/src/exp/HTMLExporter.java
   trunk/src/exp/TPLExporter.java
   trunk/src/exp/TomTomExporter.java
Log:
Letzter Exportpfad wird in der pref.xml gespeichert

Modified: trunk/src/CacheWolf/Preferences.java
===================================================================
--- trunk/src/CacheWolf/Preferences.java	2007-06-24 10:16:20 UTC (rev 759)
+++ trunk/src/CacheWolf/Preferences.java	2007-06-28 18:23:55 UTC (rev 760)
@@ -6,6 +6,8 @@
 import ewesoft.xml.*;
 import ewesoft.xml.sax.*;
 import ewe.filechooser.*;
+import ewe.util.*;
+import ewe.util.Map.MapEntry;
 
 /**
  *	A class to hold the preferences that were loaded upon start up of CacheWolf.
@@ -85,6 +87,8 @@
 	//public String mydatadir = new String();  //Redundant ??
 	/** The centre as read from the profile */
 
+	// Hashtable for storing the last export path
+	private Hashtable exporterPaths = new Hashtable();
 	/**
 	 * Singleton pattern - return reference to Preferences
 	 * @return Singleton Preferences object
@@ -417,6 +421,10 @@
 			customMapsPath=atts.getValue("dir");
 		}
 		if (name.equals("debug")) debug=Boolean.valueOf(atts.getValue("value")).booleanValue();
+		
+		if (name.equals("expPath")){
+			exporterPaths.put(atts.getValue("key"),atts.getValue("value"));
+		}
 	}
 
 	public void characters( char ch[], int start, int length )
@@ -489,6 +497,13 @@
 			outp.print("	<location lat = \""+curCentrePt.getLatDeg(CWPoint.DD)+"\" long = \""+curCentrePt.getLonDeg(CWPoint.DD)+"\"/>\n");
 			if (customMapsPath!=null) outp.print("	<mapspath dir = \""+ customMapsPath +"\"/>\n");
 			if (debug) outp.print("    <debug value=\"true\" />\n"); // Keep the debug switch if it is set
+			// save last path of different exporters
+			Iterator itPath = exporterPaths.entries();
+			MapEntry entry;
+			while(itPath.hasNext()){
+				entry = (MapEntry) itPath.next();
+				outp.print("    <expPath key = \"" + entry.getKey().toString() + "\" value = \"" + entry.getValue().toString().replace('\\', '/') + "\"/>\n");
+			}
 			outp.print("</preferences>");
 			outp.close();
 		} catch (Exception e) {
@@ -564,4 +579,21 @@
 		log (message,e,false);
 	}
 		
+	public void setExportPath(String exporter,String path){
+		exporterPaths.put(exporter, path);
+	}
+
+	public void setExportPathFromFileName(String exporter,String filename){
+		File tmpfile = new File (filename);
+		exporterPaths.put(exporter, tmpfile.getPath());
+	}
+
+	public String getExportPath(String exporter){
+		String dir = (String) exporterPaths.get(exporter);
+		if (dir == null){
+			dir = Global.getProfile().dataDir;
+		}
+		return dir;
+	}
+
 }

Modified: trunk/src/exp/Exporter.java
===================================================================
--- trunk/src/exp/Exporter.java	2007-06-24 10:16:20 UTC (rev 759)
+++ trunk/src/exp/Exporter.java	2007-06-28 18:23:55 UTC (rev 760)
@@ -46,11 +46,17 @@
 	// selection, which method should be called
 	int howManyParams = 0;
 	
+	//name of exporter for saving pathname
+	String expName;
+	
 	public Exporter() {
 		profile = Global.getProfile();
 		pref = Global.getPref();
 		cacheDB = profile.cacheDB;
 		howManyParams = LAT_LON;
+		expName = this.getClass().getName(); 
+		// remove package
+		expName = expName.substring(expName.indexOf(".") + 1);
 	}
 	
 	public void doIt(){
@@ -190,11 +196,14 @@
 	 * @return
 	 */
 	public File getOutputFile (){
-		FileChooser fc = new FileChooser(FileChooser.SAVE, profile.dataDir);
+		File file;
+		FileChooser fc = new FileChooser(FileChooser.SAVE, pref.getExportPath(expName));
 		fc.setTitle("Select target file:");
 		fc.addMask(mask);
 		if(fc.execute() != FileChooser.IDCANCEL){
-			return  fc.getChosenFile();
+			file = fc.getChosenFile();
+			pref.setExportPath(expName, file.getPath());
+			return file;
 		} else {
 			return null;
 		}

Modified: trunk/src/exp/HTMLExporter.java
===================================================================
--- trunk/src/exp/HTMLExporter.java	2007-06-24 10:16:20 UTC (rev 759)
+++ trunk/src/exp/HTMLExporter.java	2007-06-28 18:23:55 UTC (rev 760)
@@ -29,6 +29,8 @@
 	 		"case_sensitive", "true",
 	 		"max_includes",   "5"
 	 	};
+	public final static String expName = "HTML";
+
 	public HTMLExporter(Preferences p, Profile prof){
 		pref = p;
 		profile=prof;
@@ -43,11 +45,12 @@
 
 		//need directory only!!!!
 		String dummy = new String();
-		FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, profile.dataDir);
+		FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, pref.getExportPath(expName));
 		fc.setTitle("Select target directory:");
 		String targetDir;
 		if(fc.execute() != FileChooser.IDCANCEL){
 			targetDir = fc.getChosen() + "/";
+			pref.setExportPath(expName, targetDir);
 			Vector cache_index = new Vector();
 			Vector cacheImg = new Vector();
 			Vector logImg = new Vector();

Modified: trunk/src/exp/TPLExporter.java
===================================================================
--- trunk/src/exp/TPLExporter.java	2007-06-24 10:16:20 UTC (rev 759)
+++ trunk/src/exp/TPLExporter.java	2007-06-28 18:23:55 UTC (rev 760)
@@ -130,12 +130,16 @@
 	Preferences pref;
 	Profile profile;
 	String tplFile;
+	String expName;
 
 	public TPLExporter(Preferences p, Profile prof, String tpl){
 		pref = p;
 		profile=prof;
 		cacheDB = profile.cacheDB;
 		tplFile = tpl;
+		File tmpFile = new File(tpl);
+		expName = tmpFile.getName();
+		expName = expName.substring(0, expName.indexOf("."));
 	}
 	
 	public void doIt(){
@@ -144,11 +148,11 @@
 		ProgressBarForm pbf = new ProgressBarForm();
 		ewe.sys.Handle h = new ewe.sys.Handle();
 
-		FileChooser fc = new FileChooser(FileChooser.SAVE, profile.dataDir);
+		FileChooser fc = new FileChooser(FileChooser.SAVE, pref.getExportPath(expName));
 		fc.setTitle("Select target file:");
 		if(fc.execute() == FileChooser.IDCANCEL) return;
 		File saveTo = fc.getChosenFile();
-		
+		pref.setExportPath(expName, saveTo.getPath());
 		int counter = 0;
 		for(int i = 0; i<cacheDB.size();i++){
 			ch = (CacheHolder)cacheDB.get(i);

Modified: trunk/src/exp/TomTomExporter.java
===================================================================
--- trunk/src/exp/TomTomExporter.java	2007-06-24 10:16:20 UTC (rev 759)
+++ trunk/src/exp/TomTomExporter.java	2007-06-28 18:23:55 UTC (rev 760)
@@ -14,6 +14,7 @@
 	public final static int TT_OV2 = 1;
 	public final static int TT_WPT_TEXT = 0;
 	public final static int TT_WPT_NUM = 1;
+	public final static String expName = "TomTom";
 
 	Vector cacheDB;
 	Preferences pref;
@@ -44,16 +45,19 @@
 		TomTomExporterScreen infoScreen = new TomTomExporterScreen("TomTomExport");
 		if (infoScreen.execute() == Form.IDCANCEL) return;
 		fileFormat = infoScreen.getFormat();
+
+		dirName = pref.getExportPath(expName);
 		
 		if (infoScreen.oneFilePerType()==true){
-			FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, profile.dataDir);
+			FileChooser fc = new FileChooser(FileChooser.DIRECTORY_SELECT, dirName);
 			fc.setTitle("Select target dir:");
 			if(fc.execute() == FileChooser.IDCANCEL) return;
 			dirName = fc.getChosen();
+			pref.setExportPath(expName, dirName);
 			prefix = infoScreen.getPrefix();
 			writeOneFilePerType(fileFormat, dirName, prefix);
 		} else{
-			FileChooser fc = new FileChooser(FileChooser.SAVE, profile.dataDir);
+			FileChooser fc = new FileChooser(FileChooser.SAVE, dirName);
 			fc.setTitle("Select target file:");
 	
 			if (fileFormat == TT_ASC) fc.addMask("*.asc");
@@ -61,6 +65,7 @@
 			
 			if(fc.execute() == FileChooser.IDCANCEL) return;
 			fileName = fc.getChosen();
+			pref.setExportPathFromFileName(expName, fileName);
 			writeSingleFile(fileFormat, fileName);
 		}
 	}



From admin at berlios.de  Fri Jun 29 02:21:57 2007
From: admin at berlios.de (admin at berlios.de)
Date: Fri, 29 Jun 2007 02:21:57 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3062] MovingMap: Kartendownload von
	Expedia
Message-ID: <200706290021.l5T0LvN8008311@unicorn.berlios.de>

Feature Request #3062, was updated on 2007-Jan-19 03:09
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3062&group_id=2211

Category: Not planned
Status: Closed
Priority: 5
Summary: MovingMap: Kartendownload von Expedia

By: pfeffer
Date: 2007-Jan-19 03:09

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

MovingMap: automatischer Kartendownload von 
Expedia

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3062&group_id=2211


From admin at berlios.de  Fri Jun 29 02:22:18 2007
From: admin at berlios.de (admin at berlios.de)
Date: Fri, 29 Jun 2007 02:22:18 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #3062] MovingMap: Kartendownload von
	Expedia
Message-ID: <200706290022.l5T0MI8U009028@unicorn.berlios.de>

Feature Request #3062, was updated on 2007-Jan-19 03:09
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3062&group_id=2211

Category: 0.9n
Status: Closed
Priority: 5
Summary: MovingMap: Kartendownload von Expedia

By: pfeffer
Date: 2007-Jan-19 03:09

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

MovingMap: automatischer Kartendownload von 
Expedia

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=3062&group_id=2211


From admin at berlios.de  Fri Jun 29 02:23:52 2007
From: admin at berlios.de (admin at berlios.de)
Date: Fri, 29 Jun 2007 02:23:52 +0200 (CEST)
Subject: [Cachewolf-svn] [Feature #2928] Sonnenrichtung in MovingMap anzeigen
Message-ID: <200706290023.l5T0NqLP012440@unicorn.berlios.de>

Feature Request #2928, was updated on 2006-Dec-03 16:35
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2928&group_id=2211

Category: Not planned
Status: Closed
Priority: 5
Summary: Sonnenrichtung in MovingMap anzeigen

By: pfeffer
Date: 2007-Jan-12 15:54

Message:
Logged In: YES 
user_id=30639
Browser: Opera/9.02 (Windows NT 5.1; U; de)

erledigtr mit SVN 381. Auch die Nordrichtung wird 
(dunkelblau) angezeigt.

----------------------------------------------------------------------

By: pfeffer
Date: 2006-Dec-03 16:35

Message:
Logged In: YES 
user_id=30639
Browser: Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0

Sonnenrichtung in MovingMap anzeigen durch kleines am
Rand entland wanderndes Sonnensymbol

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2928&group_id=2211


From kalli at mail.berlios.de  Fri Jun 29 19:08:43 2007
From: kalli at mail.berlios.de (kalli at mail.berlios.de)
Date: Fri, 29 Jun 2007 19:08:43 +0200
Subject: [Cachewolf-svn] r761 - in trunk/src: CacheWolf exp
Message-ID: <200706291708.l5TH8hc5025914@sheep.berlios.de>

Author: kalli
Date: 2007-06-29 19:08:39 +0200 (Fri, 29 Jun 2007)
New Revision: 761

Modified:
   trunk/src/CacheWolf/CacheType.java
   trunk/src/exp/KMLExporter.java
Log:
KML-Export um Icons und Textdarben erweitert

Modified: trunk/src/CacheWolf/CacheType.java
===================================================================
--- trunk/src/CacheWolf/CacheType.java	2007-06-28 18:23:55 UTC (rev 760)
+++ trunk/src/CacheWolf/CacheType.java	2007-06-29 17:08:39 UTC (rev 761)
@@ -38,6 +38,7 @@
 	static protected final int GC_WEBCAM = 11;
 	static protected final int GC_LOCATIONLESS = 12;
 	static protected final int GC_CITO = 13;
+	static protected final int GC_EARTH = 137;
 	static protected final int GC_MEGA_EVENT = 453;
 	// additional waypoints have no numbers in GPX Files, so lets use our own.
 	static protected final int GC_AW_PARKING = 50;
@@ -73,6 +74,7 @@
 	static protected final int CW_WEBCAM = 11;
 	static protected final int CW_LOCATIONLESS = 12;
 	static protected final int CW_CITO = 13;
+	static protected final int CW_EARTH = 137;
 	static protected final int CW_MEGA_EVENT = 453;
 	static protected final int CW_PARKING = 50;
 	static protected final int CW_STAGE_OF_MULTI = 51;
@@ -101,6 +103,7 @@
 	static protected final String CW_PIC_LETTERBOX = "5.png";
 	static protected final String CW_PIC_LOCATIONLESS = "12.png";
 	static protected final String CW_PIC_CITO = "13.png";
+	static protected final String CW_PIC_EARTH = "137.png";
 	static protected final String CW_PIC_MEGA_EVENT = "453.png";
 	static protected final String CW_PIC_PARKING = "pkg.png";
 	static protected final String CW_PIC_STAGE_OF_MULTI = "stage.png";
@@ -123,6 +126,7 @@
 		if(geoNum.equals("8")) geo = "Unknown Cache";
 		if(geoNum.equals("12")) geo = "Locationless Cache";
 		if(geoNum.equals("13")) geo = "Cache In Trash Out Event";
+		if(geoNum.equals("137")) geo = "Earthcache";
 		if(geoNum.equals("453")) geo = "Mega Event Cache";
 		if(geoNum.equals("50")) geo = "Parking Area";
 		if(geoNum.equals("51")) geo = "Stages of a Multicache";
@@ -152,6 +156,7 @@
 			case CW_WEBCAM:			return CW_PIC_WEBCAM;
 			case CW_LOCATIONLESS:	return CW_PIC_LOCATIONLESS;
 			case CW_CITO:			return CW_PIC_CITO;
+			case CW_EARTH:			return CW_PIC_EARTH;
 			case CW_MEGA_EVENT:		return CW_PIC_MEGA_EVENT;
 			case CW_PARKING:		return CW_PIC_PARKING;
 			case CW_STAGE_OF_MULTI:	return CW_PIC_STAGE_OF_MULTI;

Modified: trunk/src/exp/KMLExporter.java
===================================================================
--- trunk/src/exp/KMLExporter.java	2007-06-28 18:23:55 UTC (rev 760)
+++ trunk/src/exp/KMLExporter.java	2007-06-29 17:08:39 UTC (rev 761)
@@ -1,4 +1,7 @@
 package exp;
+import ewe.fx.Color;
+import ewe.io.File;
+import ewe.sys.Convert;
 import CacheWolf.*;
 
 /**
@@ -7,7 +10,12 @@
 *   
 */
 public class KMLExporter extends Exporter {
+	private static final String COLOR_FOUND = "ff98fb98"; 
+	private static final String COLOR_OWNED = "ffffaa55"; 
+	private static final String COLOR_AVAILABLE = "ffffffff";
+	private static final String COLOR_ARCHIVED = "ff0000ff";
 
+
 	public KMLExporter(){
 		super();
 		this.setMask("*.kml");
@@ -23,11 +31,11 @@
 	public String header () {
 		StringBuffer strBuf = new StringBuffer(200);
 				
-		strBuf.append("<?xml version=\"1.0\" encoding=\"utf-8\"?>");
-		strBuf.append("<kml xmlns=\"http://earth.google.com/kml/2.0\">");
-		strBuf.append("<Folder>");
-		strBuf.append("<name>CacheWolf</name>");
-		strBuf.append("<open>1</open>");
+		strBuf.append("<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n");
+		strBuf.append("<kml xmlns=\"http://earth.google.com/kml/2.0\">\r\n");
+		strBuf.append("<Folder>\r\n");
+		strBuf.append("<name>CacheWolf</name>\r\n");
+		strBuf.append("<open>1</open>\r\n");
 
 		return strBuf.toString();
 	}
@@ -46,62 +54,36 @@
 		strBuf.append("      <Point>\r\n");
 		strBuf.append("         <coordinates>"  + lon + "," + lat + "</coordinates>\r\n");
 		strBuf.append("      </Point>\r\n");
+		strBuf.append("      <Style>\r\n");
+		strBuf.append("      <IconStyle>\r\n");
+		strBuf.append("         <Icon>\r\n");
+		strBuf.append("            <href>"+ File.getProgramDirectory()+ "/" + CacheType.type2pic(Convert.parseInt(ch.type))+ "</href>\r\n");
+		strBuf.append("         </Icon>\r\n");
+		strBuf.append("      </IconStyle>\r\n");
+		strBuf.append("      <LabelStyle>\r\n");
+		strBuf.append("         <color>" + getColor(ch) + "</color>\r\n");
+		strBuf.append("      </LabelStyle>\r\n");
+		strBuf.append("      </Style>\r\n");
 		strBuf.append("   </Placemark>\r\n");
-
+	
 		return strBuf.toString();
 	}
 	
 	public String trailer(){
 		StringBuffer strBuf = new StringBuffer(50);
 
-		strBuf.append("</Folder>");
-		strBuf.append("</kml>");
+		strBuf.append("</Folder>\r\n");
+		strBuf.append("</kml>\r\n");
 
 		return strBuf.toString();
 	}
 	
-/*	public void doIt(){
-		CacheHolder holder;
-		ParseLatLon pll;
-		FileChooser fc = new FileChooser(FileChooser.SAVE, profile.dataDir);
-		fc.setTitle("Select target file:");
-		if(fc.execute() != fc.IDCANCEL){
-			File saveTo = fc.getChosenFile();
-			try{
-				PrintWriter outp =  new PrintWriter(new BufferedWriter(new FileWriter(saveTo)));
-				//Create Header for KML-File
-				outp.println("<?xml version=\"1.0\" encoding=\"utf-8\"?>");
-				outp.println("<kml xmlns=\"http://earth.google.com/kml/2.0\">");
-				outp.println("<Folder>");
-				outp.println("<name>CacheWolf</name>");
-				outp.println("<open>1</open>");
-				//loop through database
-				for(int i = 0; i<cacheDB.size(); i++){
-					holder=(CacheHolder)cacheDB.get(i);
-					if(holder.is_black == false && holder.is_filtered == false){
-						pll = new ParseLatLon(holder.LatLon,".");
-						pll.parse();
-						outp.println("   <Placemark>");
-						outp.println("      <description>http://www.geocaching.com/seek/cache_details.aspx?wp="+holder.wayPoint+"</description>");
-						outp.println("      <name>"+ holder.wayPoint + " - " + SafeXML.clean(holder.CacheName) +"</name>");
-						outp.println("      <LookAt>");
-						outp.println("         <latitude>" + pll.getLatDeg() + "</latitude>");
-						outp.println("         <longitude>" + pll.getLonDeg() + "</longitude>");
-						outp.println("         <range>10000</range><tilt>0</tilt><heading>0</heading>");
-						outp.println("      </LookAt>");
-						outp.println("      <Point>");
-						outp.println("         <coordinates>"  + pll.getLonDeg() + "," + pll.getLatDeg() + "</coordinates>");
-						outp.println("      </Point>");
-						outp.println("   </Placemark>");
-					}//if holder...
-				}//for ... i < cacheDB ...			
-				// footer
-				outp.println("</Folder>");
-				outp.println("</kml>");
-				outp.close();
-			}catch(Exception e){
-				//Vm.debug("Error writing to OVL file!");
-			}
-		} // if execute
+	private String getColor(CacheHolderDetail ch){
+		if (ch.is_found) return COLOR_FOUND;
+		if (ch.is_owned) return COLOR_OWNED;
+		if (ch.is_archived) return COLOR_ARCHIVED;
+		
+		return COLOR_AVAILABLE;
 	}
-*/}
+	
+}



From mik77 at mail.berlios.de  Fri Jun 29 21:29:19 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 29 Jun 2007 21:29:19 +0200
Subject: [Cachewolf-svn] r762 - trunk/resources
Message-ID: <200706291929.l5TJTJAP003261@sheep.berlios.de>

Author: mik77
Date: 2007-06-29 21:29:15 +0200 (Fri, 29 Jun 2007)
New Revision: 762

Modified:
   trunk/resources/spider.def
Log:
Anpassung an Werbung in Liste bei GC

Modified: trunk/resources/spider.def
===================================================================
--- trunk/resources/spider.def	2007-06-29 17:08:39 UTC (rev 761)
+++ trunk/resources/spider.def	2007-06-29 19:29:15 UTC (rev 762)
@@ -6,6 +6,7 @@
 # Version 2.2 - 20070602 firstLine erg?nzt. Damit funktionieren jetzt auch die n?chsten Seiten.
 # Version 2.3 - 20070602 sizeRex an GC ?nderungen angepasst
 # Version 2.4 - 20070616 neu: Attribute
+# Version 2.5 - 20070629 Anpassungen an Listen?nderung bei GC
 #============================================================
 # A suffix of Rex indicates a regular expression
 # A suffix of ExStart indicates the start of an Extractor search pattern
@@ -23,7 +24,7 @@
 firstPage          = http://www.geocaching.com/seek/nearest.aspx?lat=
 firstPage2         = &lon=
 # Regex to search for cachenames 
-lineRex            = <tr bgcolor=((?s).*?)</tr>
+lineRex            = images/icons/compass((?s).*?)</tr>
 listBlockRex       = <table id="dlResults"((?s).*?)</table>
 distRex            = <br\ />(.*?)(km|mi)</td>
 waypointRex        = </a> \\((.*?)\\)<br>



From mik77 at mail.berlios.de  Fri Jun 29 21:36:12 2007
From: mik77 at mail.berlios.de (mik77 at mail.berlios.de)
Date: Fri, 29 Jun 2007 21:36:12 +0200
Subject: [Cachewolf-svn] r763 - branches/bugfix_09n/src/CacheWolf
Message-ID: <200706291936.l5TJaCfH003716@sheep.berlios.de>

Author: mik77
Date: 2007-06-29 21:36:07 +0200 (Fri, 29 Jun 2007)
New Revision: 763

Modified:
   branches/bugfix_09n/src/CacheWolf/SpiderGC.java
Log:
Anpassung an Werbung in Liste bei GC

Modified: branches/bugfix_09n/src/CacheWolf/SpiderGC.java
===================================================================
--- branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-06-29 19:29:15 UTC (rev 762)
+++ branches/bugfix_09n/src/CacheWolf/SpiderGC.java	2007-06-29 19:36:07 UTC (rev 763)
@@ -314,7 +314,7 @@
 		dummy = "";
 		//String lineBlck = "";
 		int page_number = 4;		
-		rexLine = new Regex("<tr bgcolor=((?s).*?)</tr>");
+		rexLine = new Regex("images/icons/compass((?s).*?)</tr>");
 		int found_on_page = 0;
 		//Loop till maximum distance has been found or no more caches are in the list
 		while(distance > 0){



From salzkammergut at mail.berlios.de  Sat Jun 30 11:38:45 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 30 Jun 2007 11:38:45 +0200
Subject: [Cachewolf-svn] r764 - in trunk: resources resources/attributes
	src/CacheWolf
Message-ID: <200706300938.l5U9cj5X013843@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-30 11:38:24 +0200 (Sat, 30 Jun 2007)
New Revision: 764

Removed:
   trunk/resources/attributes/available-yes.jpg
   trunk/resources/attributes/bicycles-yes.jpg
   trunk/resources/attributes/boat-yes.jpg
   trunk/resources/attributes/campfires-yes.jpg
   trunk/resources/attributes/camping-yes.jpg
   trunk/resources/attributes/cliff-yes.jpg
   trunk/resources/attributes/climbing-yes.jpg
   trunk/resources/attributes/cow-yes.jpg
   trunk/resources/attributes/danger-yes.jpg
   trunk/resources/attributes/dogs-yes.jpg
   trunk/resources/attributes/fee-yes.jpg
   trunk/resources/attributes/hiking-yes.jpg
   trunk/resources/attributes/horses-yes.jpg
   trunk/resources/attributes/hunting-yes.jpg
   trunk/resources/attributes/jeeps-yes.jpg
   trunk/resources/attributes/kids-yes.jpg
   trunk/resources/attributes/mine-yes.jpg
   trunk/resources/attributes/motorcycles-yes.jpg
   trunk/resources/attributes/night-yes.jpg
   trunk/resources/attributes/onehour-yes.jpg
   trunk/resources/attributes/parking-yes.jpg
   trunk/resources/attributes/phone-yes.jpg
   trunk/resources/attributes/picnic-yes.jpg
   trunk/resources/attributes/poisonoak-yes.jpg
   trunk/resources/attributes/public-yes.jpg
   trunk/resources/attributes/quads-yes.jpg
   trunk/resources/attributes/rappelling-yes.jpg
   trunk/resources/attributes/restrooms-yes.jpg
   trunk/resources/attributes/scenic-yes.jpg
   trunk/resources/attributes/scuba-yes.jpg
   trunk/resources/attributes/snakes-yes.jpg
   trunk/resources/attributes/snowmobiles-yes.jpg
   trunk/resources/attributes/stealth-yes.jpg
   trunk/resources/attributes/stroller-yes.jpg
   trunk/resources/attributes/swimming-yes.jpg
   trunk/resources/attributes/thorn-yes.jpg
   trunk/resources/attributes/ticks-yes.jpg
   trunk/resources/attributes/wading-yes.jpg
   trunk/resources/attributes/water-yes.jpg
   trunk/resources/attributes/wheelchair-yes.jpg
   trunk/resources/attributes/winter-yes.jpg
Modified:
   trunk/resources/attributes/bicycles-no.gif
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/AttributesViewer.java
Log:
Attribute: Update mit Texten zu den haeufigsten Attributen

Deleted: trunk/resources/attributes/available-yes.jpg
===================================================================
(Binary files differ)

Modified: trunk/resources/attributes/bicycles-no.gif
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/bicycles-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/boat-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/campfires-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/camping-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/cliff-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/climbing-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/cow-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/danger-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/dogs-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/fee-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/hiking-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/horses-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/hunting-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/jeeps-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/kids-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/mine-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/motorcycles-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/night-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/onehour-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/parking-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/phone-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/picnic-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/poisonoak-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/public-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/quads-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/rappelling-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/restrooms-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/scenic-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/scuba-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/snakes-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/snowmobiles-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/stealth-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/stroller-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/swimming-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/thorn-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/ticks-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/wading-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/water-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/wheelchair-yes.jpg
===================================================================
(Binary files differ)

Deleted: trunk/resources/attributes/winter-yes.jpg
===================================================================
(Binary files differ)

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-06-29 19:36:07 UTC (rev 763)
+++ trunk/resources/cachewolf.Languages.cfg	2007-06-30 09:38:24 UTC (rev 764)
@@ -325,93 +325,94 @@
 		1801=Kacheln herunterladen
 		2000=GPX Export
 		2001=von
-		2500=Fehler beim Laden des Attributs oder unbekanntes Attribut
-		2501=available-no
-		2502=available-yes
-		2503=bicycles-no
-		2504=bicycles-yes
-		2505=boat-no
-		2506=boat-yes
-		2507=cactus-no
-		2508=cactus-yes
-		2509=campfires-no
-		2510=campfires-yes
-		2511=camping-no
-		2512=camping-yes
-		2513=cliff-no
-		2514=cliff-yes
-		2515=climbing-no
-		2516=climbing-yes
-		2517=compass-no
-		2518=compass-yes
-		2519=cow-no
-		2520=cow-yes
-		2521=danger-no
-		2522=danger-yes
-		2523=dogs-no
-		2524=dogs-yes
-		2525=fee-no
-		2526=fee-yes
-		2527=hiking-no
-		2528=hiking-yes
-		2529=horses-no
-		2530=horses-yes
-		2531=hunting-no
-		2532=hunting-yes
-		2533=jeeps-no
-		2534=jeeps-yes
-		2535=kids-no
-		2536=kids-yes
-		2537=mine-no
-		2538=mine-yes
-		2539=motorcycles-no
-		2540=motorcycles-yes
-		2541=night-no
-		2542=night-yes
-		2543=onehour-no
-		2544=onehour-yes
-		2545=parking-no
-		2546=parking-yes
-		2547=phone-no
-		2548=phone-yes
-		2549=picnic-no
-		2550=picnic-yes
-		2551=poisonoak-no
-		2552=poisonoak-yes
-		2553=public-no
-		2554=public-yes
-		2555=quads-no
-		2556=quads-yes
-		2557=rappelling-no
-		2558=rappelling-yes
-		2559=restrooms-no
-		2560=restrooms-yes
-		2561=scenic-no
-		2562=scenic-yes
-		2563=scuba-no
-		2564=scuba-yes
-		2565=snakes-no
-		2566=snakes-yes
-		2567=snowmobiles-no
-		2568=snowmobiles-yes
-		2569=stealth-no
-		2570=stealth-yes
-		2571=stroller-no
-		2572=stroller-yes
-		2573=swimming-no
-		2574=swimming-yes
-		2575=thorn-no
-		2576=thorn-yes
-		2577=ticks-no
-		2578=ticks-yes
-		2579=wading-no
-		2580=wading-yes
-		2581=water-no
-		2582=water-yes
-		2583=wheelchair-no
-		2584=wheelchair-yes
-		2585=winter-no
-		2586=winter-yes
+		2500=Fehler beim Laden oder unkekanntes Attribut
+		2501=Nicht immer zug%e4nglich
+		2502=Immer zug%e4nglich (24/7)
+		2503=Keine Fahrr%e4der
+		2504=Fahrr%e4der erlaubt
+		2505=*boat-no
+		2506=*boat-yes
+		2507=*cactus-no
+		2508=*cactus-yes
+		2509=Keine Lagerfeuer
+		2510=Lagerfeuer erlaubt
+		2511=*camping-no
+		2512=*camping-yes
+		2513=*cliff-no
+		2514=Gefahr durch Steinfall
+		2515=Kein schwieriges Klettern
+		2516=Schwieriges Klettern
+		2517=*compass-no
+		2518=*compass-yes
+		2519=*cow-no
+		2520=Auchtung auf Weidevieh
+		2521=*danger-no
+		2522=Gef%e4hrliches Gebiet
+		2523=Keine Hunde
+		2524=Hunde erlaubt
+		2525=*fee-no
+		2526=Eintritts-/Parkgeb%fchr
+		2527=*hiking-no
+		2528=Anstrengende Wanderung
+		2529=Keine Pferde
+		2530=Pferde erlaubt
+		2531=*hunting-no
+		2532=Jagdgebiet
+		2533=Keine Gel%e4ndefahrzeuge
+		2534=Gel%e4ndefahrzeuge erlaubt
+		2535=Keine Kinder
+		2536=Kinderfreundlich
+		2537=*mine-no
+		2538=*mine-yes
+		2539=Keine Motorr%e4der
+		2540=Motorr%e4der erlaubt
+		2541=Nicht bei Nacht empfohlen
+		2542=Auch bei Nacht m%f6glich
+		2543=Dauert l%e4nger als eine Stunde
+		2544=In weniger als 1 Stunde m%f6glich
+		2545=*parking-no
+		2546=Parkplatz verf%fcgbar
+		2547=*phone-no
+		2548=Telefon verf%fcgbar
+		2549=*picnic-no
+		2550=Picnictische verf%fcgbar
+		2551=*poisonoak-no
+		2552=*poisonoak-yes
+		2553=*public-no
+		2554=%d6ffentliches Verkehrsmittel verf%fcgbar
+		2555=Keine Quadbikes
+		2556=Quadbikes erlaubt
+		2557=*rappelling-no
+		2558=Kletterausr%fcstung notwendig
+		2559=*restrooms-no
+		2560=Toiletten verf%fcgbar
+		2561=*scenic-no
+		2562=Sch%f6ner Ausblick
+		2563=*scuba-no
+		2564=*scuba-yes
+		2565=*snakes-no
+		2566=*snakes-yes
+		2567=Keine Snowmobile
+		2568=*snowmobiles-yes
+		2569=Kein heimliches Agieren notwendig
+		2570=Heimliches Agieren notwendig
+		2571=F%fcr Kinderwagen nicht geeignet
+		2572=F%fcr Kinderwagen geeignet
+		2573=*swimming-no
+		2574=*swimming-yes
+		2575=*thorn-no
+		2576=Dornen!
+		2577=*ticks-no
+		2578=Zecken!
+		2579=*wading-no
+		2580=Waten m%e4glich
+		2581=*water-no
+		2582=Trinkwasser verf%fcgbar
+		2583=F%fcr Rollst%fchle nicht geeignet
+		2584=Geeignet f%fc Rollst%fchle
+		2585=Im Winter nicht verf%fcgbar
+		2586=Auch im Winter verf%fcgbar
+		2600=Attribute:
 		3000=Schlie%dfen
 		4000=Geladene Caches:
 		4100=Verzeichnis w%e4hlen:
@@ -757,92 +758,93 @@
 		2000=GPX Export
 		2001=of
 		2500=Error loading attributes or unknown attribute
-		2501=available-no
-		2502=available-yes
-		2503=bicycles-no
-		2504=bicycles-yes
-		2505=boat-no
-		2506=boat-yes
-		2507=cactus-no
-		2508=cactus-yes
-		2509=campfires-no
-		2510=campfires-yes
-		2511=camping-no
-		2512=camping-yes
-		2513=cliff-no
-		2514=cliff-yes
-		2515=climbing-no
-		2516=climbing-yes
-		2517=compass-no
-		2518=compass-yes
-		2519=cow-no
-		2520=cow-yes
-		2521=danger-no
-		2522=danger-yes
-		2523=dogs-no
-		2524=dogs-yes
-		2525=fee-no
-		2526=fee-yes
-		2527=hiking-no
-		2528=hiking-yes
-		2529=horses-no
-		2530=horses-yes
-		2531=hunting-no
-		2532=hunting-yes
-		2533=jeeps-no
-		2534=jeeps-yes
-		2535=kids-no
-		2536=kids-yes
-		2537=mine-no
-		2538=mine-yes
-		2539=motorcycles-no
-		2540=motorcycles-yes
-		2541=night-no
-		2542=night-yes
-		2543=onehour-no
-		2544=onehour-yes
-		2545=parking-no
-		2546=parking-yes
-		2547=phone-no
-		2548=phone-yes
-		2549=picnic-no
-		2550=picnic-yes
-		2551=poisonoak-no
-		2552=poisonoak-yes
-		2553=public-no
-		2554=public-yes
-		2555=quads-no
-		2556=quads-yes
-		2557=rappelling-no
-		2558=rappelling-yes
-		2559=restrooms-no
-		2560=restrooms-yes
-		2561=scenic-no
-		2562=scenic-yes
-		2563=scuba-no
-		2564=scuba-yes
-		2565=snakes-no
-		2566=snakes-yes
-		2567=snowmobiles-no
-		2568=snowmobiles-yes
-		2569=stealth-no
-		2570=stealth-yes
-		2571=stroller-no
-		2572=stroller-yes
-		2573=swimming-no
-		2574=swimming-yes
-		2575=thorn-no
-		2576=thorn-yes
-		2577=ticks-no
-		2578=ticks-yes
-		2579=wading-no
-		2580=wading-yes
-		2581=water-no
-		2582=water-yes
-		2583=wheelchair-no
-		2584=wheelchair-yes
-		2585=winter-no
-		2586=winter-yes
+		2501=not 24-7
+		2502=available 24-7
+		2503=no bikes
+		2504=bikes allowed
+		2505=*boat-no
+		2506=*boat-yes
+		2507=*cactus-no
+		2508=*cactus-yes
+		2509=no campfires
+		2510=campfires allowed
+		2511=*camping-no
+		2512=*camping-yes
+		2513=*cliff-no
+		2514=falling rocks nearby
+		2515=no difficult climbing
+		2516=difficult climbing
+		2517=*compass-no
+		2518=*compass-yes
+		2519=*cow-no
+		2520=watch for livestock
+		2521=*danger-no
+		2522=dangerous area
+		2523=no dogs
+		2524=dogs allowed
+		2525=*fee-no
+		2526=access/parking fees
+		2527=*hiking-no
+		2528=significant hike
+		2529=no horses
+		2530=horses allowed
+		2531=*hunting-no
+		2532=hunting area
+		2533=no off-road vehicles
+		2534=off-road vehicles allowed
+		2535=no kids
+		2536=kid friendly
+		2537=*mine-no
+		2538=*mine-yes
+		2539=no motorcycles
+		2540=motorcycles allowed
+		2541=not recommended at night
+		2542=recommended at night
+		2543=takes more than one hour
+		2544=takes less than one hour
+		2545=*parking-no
+		2546=parking available
+		2547=*phone-no
+		2548=telephone nearby
+		2549=*picnic-no
+		2550=picnic tables available
+		2551=*poisonoak-no
+		2552=*poisonoak-yes
+		2553=*public-no
+		2554=public transit available
+		2555=no quads
+		2556=quads allowed
+		2557=*rappelling-no
+		2558=climbing gear
+		2559=*restrooms-no
+		2560=restrooms available
+		2561=*scenic-no
+		2562=scenic view
+		2563=*scuba-no
+		2564=*scuba-yes
+		2565=*snakes-no
+		2566=*snakes-yes
+		2567=no snowmobiles
+		2568=*snowmobiles-yes
+		2569=no stealth required
+		2570=stealth required
+		2571=not stroller accessible
+		2572=stroller accessible
+		2573=*swimming-no
+		2574=*swimming-yes
+		2575=*thorn-no
+		2576=thorns!
+		2577=*ticks-no
+		2578=ticks!
+		2579=*wading-no
+		2580=may require wading
+		2581=*water-no
+		2582=drinking water nearby
+		2583=not wheelchair accessible
+		2584=wheelchair accessible
+		2585=not available in winter
+		2586=available in winter
+		2600=Attributes:
 		3000=Close
 		4000=Loaded caches
 		4101=Maps

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2007-06-29 19:36:07 UTC (rev 763)
+++ trunk/src/CacheWolf/Attribute.java	2007-06-30 09:38:24 UTC (rev 764)
@@ -21,7 +21,7 @@
 	 */
 	private String [] attributeNames= {
 			"error.gif",			//00 Unknown attribute
-			"available-no.gif", 	//01
+			"available-no.gif", 	//01 not 24-7
 			"available-yes.gif", 	//02 available 24-7
 			"bicycles-no.gif", 		//03 no bikes
 			"bicycles-yes.gif", 	//04 bikes allowed
@@ -30,66 +30,66 @@
 			"cactus-no.gif", 		//07
 			"cactus-yes.gif",		//08
 			"campfires-no.gif", 	//09 no campfires
-			"campfires-yes.gif", 	//10
+			"campfires-yes.gif", 	//10 campfires allowed
 			"camping-no.gif", 		//11
 			"camping-yes.gif", 		//12
 			"cliff-no.gif", 		//13
-			"cliff-yes.gif", 		//14
-			"climbing-no.gif", 		//15
-			"climbing-yes.gif", 	//16
-			"compass-no.gif", 		//17
+			"cliff-yes.gif", 		//14 falling-rocks nearby
+			"climbing-no.gif", 		//15 no difficult climbing
+			"climbing-yes.gif", 	//16 difficult climbing
+			"compass-no.gif", 		//17 
 			"compass-yes.gif",		//18
 			"cow-no.gif", 			//19
-			"cow-yes.gif", 			//20
+			"cow-yes.gif", 			//20 watch for livestock
 			"danger-no.gif", 		//21
-			"danger-yes.gif", 		//22
-			"dogs-no.gif", 			//23
+			"danger-yes.gif", 		//22 dangerous area
+			"dogs-no.gif", 			//23 no dogs
 			"dogs-yes.gif", 		//24 dogs allowed
 			"fee-no.gif", 			//25
-			"fee-yes.gif", 			//26
+			"fee-yes.gif", 			//26 access/parking fees
 			"hiking-no.gif", 		//27
-			"hiking-yes.gif", 		//28
+			"hiking-yes.gif", 		//28 significant hike
 			"horses-no.gif", 		//29 no horses
-			"horses-yes.gif", 		//30
+			"horses-yes.gif", 		//30 horses allowed
 			"hunting-no.gif", 		//31
-			"hunting-yes.gif", 		//32
-			"jeeps-no.gif", 		//33
-			"jeeps-yes.gif", 		//34
-			"kids-no.gif", 			//35
+			"hunting-yes.gif", 		//32 hunting area
+			"jeeps-no.gif", 		//33 no off-road vehicles
+			"jeeps-yes.gif", 		//34 off-road vehicles allowed
+			"kids-no.gif", 			//35 no kids
 			"kids-yes.gif", 		//36 kid friendly
 			"mine-no.gif", 			//37
 			"mine-yes.gif", 		//38
-			"motorcycles-no.gif", 	//39
-			"motorcycles-yes.gif", 	//40
+			"motorcycles-no.gif", 	//39 no motorcycles
+			"motorcycles-yes.gif", 	//40 motorcycles allowed
 			"night-no.gif", 		//41 not recommended at night
-			"night-yes.gif", 		//42
+			"night-yes.gif", 		//42 recommended at night
 			"onehour-no.gif", 		//43 takes more than one hour
 			"onehour-yes.gif", 		//44 takes less than one hour
 			"parking-no.gif", 		//45
 			"parking-yes.gif", 		//46 parking available
 			"phone-no.gif", 		//47
-			"phone-yes.gif", 		//48
+			"phone-yes.gif", 		//48 telephone nearby
 			"picnic-no.gif", 		//49
-			"picnic-yes.gif", 		//50
+			"picnic-yes.gif", 		//50 picnic tables available
 			"poisonoak-no.gif", 	//51
 			"poisonoak-yes.gif", 	//52
 			"public-no.gif", 		//53
 			"public-yes.gif", 		//54 public transit available
-			"quads-no.gif", 		//55
+			"quads-no.gif", 		//55 no quads
 			"quads-yes.gif", 		//56 quads allowed
 			"rappelling-no.gif", 	//57
-			"rappelling-yes.gif", 	//58
+			"rappelling-yes.gif", 	//58 climbing gear
 			"restrooms-no.gif", 	//59
-			"restrooms-yes.gif", 	//60
+			"restrooms-yes.gif", 	//60 restrooms available
 			"scenic-no.gif", 		//61
 			"scenic-yes.gif", 		//62 scenic view
 			"scuba-no.gif", 		//63
 			"scuba-yes.gif", 		//64
 			"snakes-no.gif", 		//65
 			"snakes-yes.gif", 		//66
-			"snowmobiles-no.gif", 	//67
+			"snowmobiles-no.gif", 	//67 no snowmobiles
 			"snowmobiles-yes.gif", 	//68
-			"stealth-no.gif", 		//69
+			"stealth-no.gif", 		//69 no stealth required
 			"stealth-yes.gif", 		//70 stealth required
 			"stroller-no.gif",		//71 not stroller accessible
 			"stroller-yes.gif", 	//72 stroller accessible
@@ -100,11 +100,11 @@
 			"ticks-no.gif", 		//77
 			"ticks-yes.gif", 		//78 ticks!
 			"wading-no.gif", 		//79
-			"wading-yes.gif", 		//80
+			"wading-yes.gif", 		//80 may require wading
 			"water-no.gif", 		//81
-			"water-yes.gif", 		//82
+			"water-yes.gif", 		//82 drinking water nearby
 			"wheelchair-no.gif", 	//83 not wheelchair accessible
-			"wheelchair-yes.gif", 	//84
+			"wheelchair-yes.gif", 	//84 wheelchair accessible
 			"winter-no.gif", 		//85 not available for winter
 			"winter-yes.gif"}; 		//86 available in winter
 	private mImage [] attributeImages=new mImage[87];

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2007-06-29 19:36:07 UTC (rev 763)
+++ trunk/src/CacheWolf/AttributesViewer.java	2007-06-30 09:38:24 UTC (rev 764)
@@ -6,18 +6,21 @@
 import ewe.ui.*;
 
 public class AttributesViewer extends CellPanel {
-	private final static int ICONS_PER_ROW=5;
+	private final static int ICONS_PER_ROW=6;
+	private final static int ICONROWS=2;
 	private static int TILESIZE=32;
 	private mLabel mInfo;
 
 	private class attInteractivePanel extends InteractivePanel {
 		public boolean imageMovedOn(AniImage which) {
-			mInfo.setText(((attAniImage)which).info);
-			mInfo.repaintNow();
+			if (!((attAniImage)which).info.startsWith("*")) { // If text starts with * we have no explanation yet
+				mInfo.setText(((attAniImage)which).info);
+				mInfo.repaintNow();
+			}
 			return true;
 		}
 		public boolean imageMovedOff(AniImage which) {
-			mInfo.setText("Attributes:");
+			mInfo.setText(MyLocale.getMsg(2600,"Attributes:"));
 			mInfo.repaintNow();
 			return true;
 		}
@@ -31,9 +34,9 @@
 	}
 	
 	public AttributesViewer (){
-		Rect r = new Rect(0,0,TILESIZE * 5,TILESIZE * 2); // As on GC: 5 wide, 2 high
+		Rect r = new Rect(0,0,TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS); // As on GC: 6 wide, 2 high
 		iap.virtualSize = r;
-		iap.setFixedSize(TILESIZE * 5,TILESIZE * 2);
+		iap.setFixedSize(TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS);
 		addLast(mInfo=new mLabel("Attributes:"),HSTRETCH,HFILL);
 		addLast(iap,CellConstants.HSTRETCH,CellConstants.FILL);
 	}



From salzkammergut at mail.berlios.de  Sat Jun 30 13:12:49 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 30 Jun 2007 13:12:49 +0200
Subject: [Cachewolf-svn] r765 - in trunk: resources src/CacheWolf
Message-ID: <200706301112.l5UBCn8d014113@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-30 13:12:41 +0200 (Sat, 30 Jun 2007)
New Revision: 765

Modified:
   trunk/resources/cachewolf.Languages.cfg
   trunk/src/CacheWolf/AttributesViewer.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/myTableModel.java
Log:
DetailPanel: Button fuer Notizen als Icon zur obersten Zeile hinzufuegt. 
Difficulty/Terrain werden jetzt auch angezeigt (nicht editierbar).

Modified: trunk/resources/cachewolf.Languages.cfg
===================================================================
--- trunk/resources/cachewolf.Languages.cfg	2007-06-30 09:38:24 UTC (rev 764)
+++ trunk/resources/cachewolf.Languages.cfg	2007-06-30 11:12:41 UTC (rev 765)
@@ -109,6 +109,7 @@
 		348=Eigene Bilder hinzuf%fcgen
 		349=Blacklist-Status umschalten
 		350=Zeitstempel zu Notizen hinzuf%fcgen
+		351=Notizen hinzuf%fcgen/%e4ndern
 		400=Dekodieren
 		500=Umschalten
 		600=Pr%e4ferenzen
@@ -542,6 +543,7 @@
 		348=Add user pictures
 		349=Toggle Blacklist status
 		350=Add timestamp to notes
+		351=Add/Edit notes
 		400=Dekode
 		500=Switch
 		600=Preferences

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2007-06-30 09:38:24 UTC (rev 764)
+++ trunk/src/CacheWolf/AttributesViewer.java	2007-06-30 11:12:41 UTC (rev 765)
@@ -37,7 +37,7 @@
 		Rect r = new Rect(0,0,TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS); // As on GC: 6 wide, 2 high
 		iap.virtualSize = r;
 		iap.setFixedSize(TILESIZE * ICONS_PER_ROW,TILESIZE * ICONROWS);
-		addLast(mInfo=new mLabel("Attributes:"),HSTRETCH,HFILL);
+		addLast(mInfo=new mLabel(MyLocale.getMsg(2600,"Attributes:")),HSTRETCH,HFILL);
 		addLast(iap,CellConstants.HSTRETCH,CellConstants.FILL);
 	}
 	private InteractivePanel iap=new attInteractivePanel();

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-06-30 09:38:24 UTC (rev 764)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-06-30 11:12:41 UTC (rev 765)
@@ -39,7 +39,8 @@
 	mImage imgBlack;
 	mImage imgBlackNo;
 	mImage imgShowBug, imgShowBugNo,imgNewWpt,imgGoto;
-	mImage imgShowMaps,imgAddImages;
+	mImage imgShowMaps,imgAddImages,imgNotes;
+	mLabel lblDiff, lblTerr;
 	
 	public DetailsPanel(){
 		pref = Global.getPref();
@@ -74,7 +75,10 @@
 		imgBlack = new mImage("is_black.png"); imgBlack.transparentColor=Color.White;
 		pnlTools.addNext(btnBlack=new mButton(imgBlackNo)); 
 		btnBlack.setToolTip(MyLocale.getMsg(349,"Toggle Blacklist status"));
-		// Button 7: Date/time stamp
+		// Button 7: Notes
+		pnlTools.addNext(btnNotes=new mButton(imgNotes=new mImage("notes.gif"))); imgNotes.transparentColor=Color.DarkBlue;
+		btnNotes.setToolTip(MyLocale.getMsg(351,"Add/Edit notes"));
+		// Button 8: Date/time stamp
 		pnlTools.addLast(btnAddDateTime = new mButton(new mImage("date_time.png"))); 
 		btnAddDateTime.setToolTip(MyLocale.getMsg(350,"Add timestamp to notes"));
 		//showMap.modify(Control.Disabled,0);
@@ -86,9 +90,12 @@
 		////////////////////
 
 		this.addNext(new mLabel(MyLocale.getMsg(300,"Type:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.NORTHWEST));
-		this.addLast(chcType,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		this.addNext(chcType,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		this.addLast(lblDiff=new mLabel(MyLocale.getMsg(1000,"D")+": 5.5"),CellConstants.DONTSTRETCH,(CellConstants.DONTFILL|CellConstants.EAST));
+		
 		this.addNext(new mLabel(MyLocale.getMsg(301,"Size:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
-		this.addLast(chcSize,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		this.addNext(chcSize,CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
+		this.addLast(lblTerr=new mLabel(MyLocale.getMsg(1001,"T")+": 5.5"),CellConstants.DONTSTRETCH,(CellConstants.DONTFILL|CellConstants.EAST));
 		
 		this.addNext(new mLabel(MyLocale.getMsg(302,"Waypoint:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		this.addLast(inpWaypoint.setTag(Control.SPAN, new Dimension(2,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
@@ -116,8 +123,8 @@
 		cp.addLast(btnFoundDate=new mButton(new mImage("calendar.png")),DONTSTRETCH,DONTFILL);
 		this.addLast(cp,DONTSTRETCH,HFILL).setTag(Control.SPAN, new Dimension(2,1));
 		
-		btnNotes = new mButton("Notes");
-		this.addLast(btnNotes.setTag(Control.SPAN, new Dimension(3,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
+		//btnNotes = new mButton("Notes");
+		//this.addLast(btnNotes.setTag(Control.SPAN, new Dimension(3,1)),CellConstants.DONTSTRETCH, (CellConstants.HFILL|CellConstants.WEST));
 		//this.addNext(new mLabel(MyLocale.getMsg(308,"Notes:")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 		//this.addLast(btnCenter = new mButton(MyLocale.getMsg(309,"Make Center")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
 //		this.addLast(btnDelete = new mButton(MyLocale.getMsg(310,"Delete")),CellConstants.DONTSTRETCH, (CellConstants.DONTFILL|CellConstants.WEST));
@@ -180,6 +187,8 @@
 		if(chD.CacheSize.equals("None")) chcSize.setInt(7);
 		if(chD.CacheSize.equals("Not chosen")) chcSize.setInt(7);
 		attV.showImages(chD.attributes);
+		lblTerr.setText((chD.terrain.length()>0) ? (MyLocale.getMsg(1001,"T")+": "+chD.terrain) : "");
+		lblDiff.setText((chD.hard.length()>0)    ? (MyLocale.getMsg(1000,"D")+": "+chD.hard) : ""); 
 	}
 	
 	

Modified: trunk/src/CacheWolf/myTableModel.java
===================================================================
--- trunk/src/CacheWolf/myTableModel.java	2007-06-30 09:38:24 UTC (rev 764)
+++ trunk/src/CacheWolf/myTableModel.java	2007-06-30 11:12:41 UTC (rev 765)
@@ -100,7 +100,7 @@
 	 *
 	 */
 	public void setColumnNamesAndWidths() {
-		String [] spName = {" ","?",MyLocale.getMsg(1000,"D"),"T",MyLocale.getMsg(1002,"Waypoint"),"Name",MyLocale.getMsg(1004,"Location"),MyLocale.getMsg(1005,"Owner"),MyLocale.getMsg(1006,"Hidden"),MyLocale.getMsg(1007,"Status"),MyLocale.getMsg(1008,"Dist"),MyLocale.getMsg(1009,"Bear")};
+		String [] spName = {" ","?",MyLocale.getMsg(1000,"D"),MyLocale.getMsg(1001,"T"),MyLocale.getMsg(1002,"Waypoint"),"Name",MyLocale.getMsg(1004,"Location"),MyLocale.getMsg(1005,"Owner"),MyLocale.getMsg(1006,"Hidden"),MyLocale.getMsg(1007,"Status"),MyLocale.getMsg(1008,"Dist"),MyLocale.getMsg(1009,"Bear")};
 		// [0]TickBox, [1]Type, [2]Distance, [3]Terrain, [4]waypoint, [5]name, [6]coordinates, 
 		// [7]owner, [8]datehidden, [9]status, [10]distance, [11]bearing
 		Preferences pref=Global.getPref();



From salzkammergut at mail.berlios.de  Sat Jun 30 18:18:56 2007
From: salzkammergut at mail.berlios.de (salzkammergut at mail.berlios.de)
Date: Sat, 30 Jun 2007 18:18:56 +0200
Subject: [Cachewolf-svn] r766 - trunk/src/CacheWolf
Message-ID: <200706301618.l5UGIurE031741@sheep.berlios.de>

Author: salzkammergut
Date: 2007-06-30 18:18:52 +0200 (Sat, 30 Jun 2007)
New Revision: 766

Modified:
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/MainTab.java
Log:
Feature: Detailpanel: Neue Addis automatisch richtig benennen
Wenn ein neuer Wegpunkt angelegt wird und der Typ auf einen Addi-Typ geaendert wird,
wird der Name von CWxxxx auf zzyyyy geaendert, wobei die Buchstaben yyyy vom Hauptcache kommen
und zz eine noch freie fortlaufende Nummer ist.
Bugfix: Beim Aendern des Typs von Addi auf Standard, wurde der Wegpunkt dupliziert.


Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2007-06-30 11:12:41 UTC (rev 765)
+++ trunk/src/CacheWolf/DetailsPanel.java	2007-06-30 16:18:52 UTC (rev 766)
@@ -19,7 +19,7 @@
 	mInput inpHidden = new mInput();
 	mInput inpOwner = new mInput();
 	mButton btnDelete,btnCenter, btnAddDateTime;
-	mChoice chcType = new mChoice(new String[]{"Custom", "Traditional", "Multi", "Virtual", "Letterbox", "Event", "Mega Event", "Mystery", "Webcam", "Locationless", "CITO", "Earthcache", "Parking", "Stage", "Question", "Final","Trailhead","Reference"},0);
+	mChoice chcType = new mChoice(new String[]{"Custom", "Traditional", "Multi", "Virtual", "Letterbox", "Event", "Mega Event", "Mystery", "Webcam", "Locationless", "CITO", "Earthcache", "Addi: Parking", "Addi: Stage", "Addi: Question", "Addi: Final","Addi: Trailhead","Addi: Reference"},0);
 	mChoice chcSize = new mChoice(new String[]{"", "Micro", "Small", "Regular", "Large","Other","Very Large","None"},0);
 	mComboBox chcStatus = new mComboBox(new String[]{"", MyLocale.getMsg(313,"Flag 1"), MyLocale.getMsg(314,"Flag 2"), MyLocale.getMsg(315,"Flag 3"), MyLocale.getMsg(316,"Flag 4"), MyLocale.getMsg(317,"Search"), MyLocale.getMsg(318,"Found"), MyLocale.getMsg(319,"Not Found"), MyLocale.getMsg(320,"Owner")},0);
 	mButton btnNewWpt, btnShowBug, btnShowMap, btnGoto, btnAddPicture, btnBlack, btnNotes, btnSave, btnCancel;
@@ -268,6 +268,19 @@
 		if (ev instanceof DataChangeEvent ) {
 			dirty_details = true;
 			profile.hasUnsavedChanges=true;
+			if (ev.target==chcType) {
+				if (CacheType.isAddiWpt(transSelect(chcType.getInt())) && 
+					(Global.mainTab.mainCache.startsWith("GC")||Global.mainTab.mainCache.startsWith("OC")) &&
+					inpWaypoint.getText().startsWith("CW")) {
+						Global.mainTab.lastselected=Global.mainTab.mainCache;
+						int wptNo=-1;
+						String waypoint;
+						do {
+							waypoint=MyLocale.formatLong(++wptNo,"00")+Global.mainTab.mainCache.substring(2);
+						} while (Global.getProfile().getCacheIndex(waypoint)>=0);
+						inpWaypoint.setText(waypoint);
+				}
+			}
 		}
 		if(ev instanceof ControlEvent && ev.type == ControlEvent.PRESSED){
 			if(ev.target == btnNotes){
@@ -430,16 +443,21 @@
 		  ch.LatLon=thisCache.LatLon;
 		  ch.DateHidden=thisCache.DateHidden;
 		  ch.CacheOwner=thisCache.CacheOwner;
+		  String oldType=ch.type;
 		  ch.type=thisCache.type;
-		  if (CacheType.isAddiWpt(ch.type)) {
-			  int idx;
-			  if (ch.wayPoint.length()<5)
-				  idx=-1;
-			  else
-				  idx=profile.getCacheIndex("GC"+ ch.wayPoint.substring(ch.wayPoint.length() == 5?1:2));
-			  if (idx<0) (new MessageBox(MyLocale.getMsg(144,"Warning"),
-					  MyLocale.getMsg(734,"No main cache found for addi waypoint ")+" "+ch.wayPoint+
-					  "\n"+MyLocale.getMsg(735,"Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),FormBase.OKB)).execute();
+		  // If the type has changed from/to an addi waypoint, rebuild the references
+		  if (CacheType.isAddiWpt(ch.type)!=CacheType.isAddiWpt(oldType)) {
+			  // If we changed the type to addi, check that a parent exists
+			  if (CacheType.isAddiWpt(ch.type)) {
+				  int idx;
+				  if (ch.wayPoint.length()<5)
+					  idx=-1;
+				  else
+					  idx=profile.getCacheIndex("GC"+ ch.wayPoint.substring(ch.wayPoint.length() == 5?1:2));
+				  if (idx<0) (new MessageBox(MyLocale.getMsg(144,"Warning"),
+						  MyLocale.getMsg(734,"No main cache found for addi waypoint ")+" "+ch.wayPoint+
+						  "\n"+MyLocale.getMsg(735,"Addi Waypoints must have the format xxYYYY, where xx are any 2 chars and YYYY are the main cache's chars after the GC"),FormBase.OKB)).execute();
+			  }
 			  profile.buildReferences();
 		  }
 		  // set status also on addi wpts

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2007-06-30 11:12:41 UTC (rev 765)
+++ trunk/src/CacheWolf/MainTab.java	2007-06-30 16:18:52 UTC (rev 766)
@@ -32,6 +32,7 @@
 	StatusBar statBar;
 	MovingMap mm;
 	Navigate nav;
+	String mainCache="";
 
 	public MainTab(MainMenu mainMenu,StatusBar statBar){
 		Global.mainTab=this;
@@ -118,6 +119,7 @@
 	 * @param ch
 	 */
 	public void newWaypoint(CacheHolder ch){
+		mainCache=lastselected;
 		if (detP.isDirty()) detP.saveDirtyWaypoint();
 		Global.getProfile().hasUnsavedChanges=true;
 		String waypoint= ch.wayPoint = profile.getNewWayPointName();
@@ -139,13 +141,13 @@
 
 	public void onEvent(Event ev)
 	{
-		if(ev instanceof MultiPanelEvent){ 
+    	if(ev instanceof MultiPanelEvent){
 			// A panel is selected.
 			mnuMain.allowProfileChange(false);	  
 			if(this.getSelectedItem() == 0){// List view selected
 				mnuMain.allowProfileChange(true);	  
-//				Vm.setParameter(Vm.SET_ALWAYS_SHOW_SIP_BUTTON,0);
-//				Vm.setSIP(0);
+	//			Vm.setParameter(Vm.SET_ALWAYS_SHOW_SIP_BUTTON,0);
+	//			Vm.setSIP(0);
 				MyLocale.setSIPOff();
 			}
 			// Get current cacheHolder
@@ -165,7 +167,7 @@
 		    if (chNew!=ch) { // new object not same reference as old
 	            chD=null; // Throw away the details, not longer valid
 			}
-            ch=chNew;		
+	        ch=chNew;		
 			// Only load the details if we leave the list view and the details
 			// have not already been loaded
 			if(this.getSelectedItem() != 0 && chD==null){// any panel other than list view without detail



