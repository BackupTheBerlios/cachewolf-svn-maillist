<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2517 - in trunk/src/CacheWolf: . exp imp navi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2517%20-%20in%20trunk/src/CacheWolf%3A%20.%20exp%20imp%20navi&In-Reply-To=%3C201003161624.o2GGODun002471%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002441.html">
   <LINK REL="Next"  HREF="002443.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2517 - in trunk/src/CacheWolf: . exp imp navi</H1>
    <B>araber95 at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2517%20-%20in%20trunk/src/CacheWolf%3A%20.%20exp%20imp%20navi&In-Reply-To=%3C201003161624.o2GGODun002471%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2517 - in trunk/src/CacheWolf: . exp imp navi">araber95 at mail.berlios.de
       </A><BR>
    <I>Tue Mar 16 17:24:13 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002441.html">[Cachewolf-svn] r2516 - in trunk/src/CacheWolf: . navi
</A></li>
        <LI>Next message: <A HREF="002443.html">[Cachewolf-svn] r2518 - in trunk/src/CacheWolf: . exp imp navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2442">[ date ]</a>
              <a href="thread.html#2442">[ thread ]</a>
              <a href="subject.html#2442">[ subject ]</a>
              <a href="author.html#2442">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: araber95
Date: 2010-03-16 17:23:55 +0100 (Tue, 16 Mar 2010)
New Revision: 2517

Modified:
   trunk/src/CacheWolf/Attribute.java
   trunk/src/CacheWolf/Attributes.java
   trunk/src/CacheWolf/AttributesViewer.java
   trunk/src/CacheWolf/CacheHolder.java
   trunk/src/CacheWolf/CacheHolderDetail.java
   trunk/src/CacheWolf/DescriptionPanel.java
   trunk/src/CacheWolf/DetailsPanel.java
   trunk/src/CacheWolf/MainMenu.java
   trunk/src/CacheWolf/MainTab.java
   trunk/src/CacheWolf/Parser.java
   trunk/src/CacheWolf/SearchCache.java
   trunk/src/CacheWolf/ShowCacheInBrowser.java
   trunk/src/CacheWolf/SolverPanel.java
   trunk/src/CacheWolf/TravelbugJourneyScreen.java
   trunk/src/CacheWolf/exp/ExploristExporter.java
   trunk/src/CacheWolf/exp/GPXExporter.java
   trunk/src/CacheWolf/exp/GpxExportNg.java
   trunk/src/CacheWolf/exp/HTMLExporter.java
   trunk/src/CacheWolf/exp/KMLExporter.java
   trunk/src/CacheWolf/exp/LocExporter.java
   trunk/src/CacheWolf/exp/MSARCSVExporter.java
   trunk/src/CacheWolf/exp/SpoilerPOIExporter.java
   trunk/src/CacheWolf/exp/TPLExporter.java
   trunk/src/CacheWolf/imp/GPXImporter.java
   trunk/src/CacheWolf/imp/LOCXMLImporter.java
   trunk/src/CacheWolf/imp/OCXMLImporter.java
   trunk/src/CacheWolf/imp/SpiderGC.java
   trunk/src/CacheWolf/myTableControl.java
   trunk/src/CacheWolf/navi/MovingMap.java
Log:
1. ExporterNG exporting attributes and travelbugs
2. internal : getting cachedetails

Modified: trunk/src/CacheWolf/Attribute.java
===================================================================
--- trunk/src/CacheWolf/Attribute.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/Attribute.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -76,10 +76,15 @@
     	}
     	return bit;
     }    
-    //
-	//public int getAttId () { return _Id; }
-	//
     /**
+     * get GC_ID string
+	 */
+    public String getGCText () { return attRef[_Id][GC_TEXT]; }
+    /**
+     * get GC_ID string
+	 */
+    public String getGCId () { return attRef[_Id][GC_ID]; }
+    /**
      * getting attribute given=0,negative=1,not specified=2  
      */
 	public int getInc () { return _Inc; }
@@ -145,22 +150,22 @@
 	private final static int PIC_NAME = 2;
 	private final static int OC_ID = 3;
 	private final static int GC_ID = 4;
-	//private final static int GC_TEXT = 5; // for export , didn't extract by myself, copied from forum	
+	private final static int GC_TEXT = 5; // for export , didn't extract by myself, copied from forum	
 	private static final String[][] attRef = {
-		// Empfehlungen / Personen
+		// Empfehlungen / Personen - Conditions (Yes/No)
 		{&quot;30&quot;,&quot;2562&quot;,&quot;scenic&quot;,&quot;&quot;,&quot;8&quot;,&quot;Scenic view&quot;},//62 scenic view
 		{&quot;17&quot;,&quot;2536&quot;,&quot;kids&quot;,&quot;59&quot;,&quot;6&quot;,&quot;Recommended for kids&quot;},//36 kid friendly
 		{&quot;35&quot;,&quot;2572&quot;,&quot;stroller&quot;,&quot;&quot;,&quot;41&quot;,&quot;Stroller accessible&quot;},//72 stroller accessible	
 		{&quot;41&quot;,&quot;2584&quot;,&quot;wheelchair&quot;,&quot;&quot;,&quot;24&quot;,&quot;Wheelchair accessible&quot;},//84 wheelchair accessible
-		//  vorhanden / Eigenschaften / Infrastruktur
+		//  vorhanden / Eigenschaften / Infrastruktur - Facilities (Yes/No)
 		{&quot;22&quot;,&quot;2546&quot;,&quot;parking&quot;,&quot;18&quot;,&quot;25&quot;,&quot;Parking available&quot;},//46 parking available
 		{&quot;26&quot;,&quot;2554&quot;,&quot;public&quot;,&quot;19&quot;,&quot;26&quot;,&quot;Public transportation&quot;},//54 public transit available
 		{&quot;40&quot;,&quot;2582&quot;,&quot;water&quot;,&quot;20&quot;,&quot;27&quot;,&quot;Drinking water nearby&quot;},//82 drinking water nearby
 		{&quot;29&quot;,&quot;2560&quot;,&quot;restrooms&quot;,&quot;21&quot;,&quot;28&quot;,&quot;Public restrooms nearby&quot;},//60 restrooms available
 		{&quot;23&quot;,&quot;2548&quot;,&quot;phone&quot;,&quot;22&quot;,&quot;29&quot;,&quot;Telephone nearby&quot;},//48 telephone nearby
 		{&quot;24&quot;,&quot;2550&quot;,&quot;picnic&quot;,&quot;&quot;,&quot;30&quot;,&quot;Picnic tables nearby&quot;},//50 picnic tables available
-		{&quot;43&quot;,&quot;2588&quot;,&quot;firstaid&quot;,&quot;23&quot;,&quot;42&quot;,&quot;Firstaid&quot;}, //88 erste Hilfe
-		// Erlaubt
+		{&quot;43&quot;,&quot;2588&quot;,&quot;firstaid&quot;,&quot;23&quot;,&quot;42&quot;,&quot;Firstaid&quot;}, //88 erste Hilfe !!! da 
+		// Erlaubt - Permissions (Allowed/Not Allowed)
 		{&quot;11&quot;,&quot;2524&quot;,&quot;dogs&quot;,&quot;&quot;,&quot;1&quot;,&quot;Dogs&quot;},//24 dogs allowed
 		{&quot;05&quot;,&quot;2512&quot;,&quot;camping&quot;,&quot;&quot;,&quot;31&quot;,&quot;Camping available&quot;},//12 Camping allowed
 		{&quot;01&quot;,&quot;2504&quot;,&quot;bicycles&quot;,&quot;&quot;,&quot;32&quot;,&quot;Bicycles&quot;},//04 bikes allowed
@@ -170,7 +175,7 @@
 		{&quot;33&quot;,&quot;2568&quot;,&quot;snowmobiles&quot;,&quot;&quot;,&quot;36&quot;,&quot;Snowmobiles&quot;},//68
 		{&quot;14&quot;,&quot;2530&quot;,&quot;horses&quot;,&quot;&quot;,&quot;37&quot;,&quot;Horses&quot;},//30 horses allowed
 		{&quot;04&quot;,&quot;2510&quot;,&quot;campfires&quot;,&quot;&quot;,&quot;38&quot;,&quot;Campfires&quot;},//10 campfires allowed
-		// Eigenschaften / Gefahren
+		// Eigenschaften / Gefahren - Hazards (Present/Not Present)
 		{&quot;10&quot;,&quot;2522&quot;,&quot;danger&quot;,&quot;9&quot;,&quot;23&quot;,&quot;Dangerous area&quot;},//22 dangerous area
 		{&quot;62&quot;,&quot;2644&quot;,&quot;train&quot;,&quot;10&quot;,&quot;&quot;,&quot;&quot;},// 144 aktive Eisenbahnlinien in der N&#228;he
 		{&quot;06&quot;,&quot;2514&quot;,&quot;cliff&quot;,&quot;11&quot;,&quot;21&quot;,&quot;Cliff / falling rocks&quot;},//14 falling-rocks nearby
@@ -183,7 +188,7 @@
 		{&quot;03&quot;,&quot;2508&quot;,&quot;cactus&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;},//08
 		{&quot;32&quot;,&quot;2566&quot;,&quot;snakes&quot;,&quot;&quot;,&quot;18&quot;,&quot;Snakes&quot;},//66
 		{&quot;09&quot;,&quot;2520&quot;,&quot;cow&quot;,&quot;&quot;,&quot;43&quot;,&quot;Watch for livestock&quot;},//20 watch for livestock
-		// Eigenschaften / Der Weg
+		// Eigenschaften / Der Weg - Conditions (Yes/No)
 		{&quot;49&quot;,&quot;2600&quot;,&quot;car&quot;,&quot;24&quot;,&quot;&quot;,&quot;&quot;},// 100 Nahe beim Auto
 		{&quot;21&quot;,&quot;2544&quot;,&quot;onehour&quot;,&quot;&quot;,&quot;7&quot;,&quot;Takes less than an hour&quot;},//44 takes less than one hour
 		{&quot;13&quot;,&quot;2528&quot;,&quot;hiking&quot;,&quot;25&quot;,&quot;9&quot;,&quot;Significant hike&quot;},//28 significant hike
@@ -191,7 +196,7 @@
 		{&quot;65&quot;,&quot;2634&quot;,&quot;steep&quot;,&quot;27&quot;,&quot;&quot;,&quot;&quot;},// 134 H&#252;geliges Gel&#228;nde
 		{&quot;07&quot;,&quot;2516&quot;,&quot;climbing&quot;,&quot;28&quot;,&quot;10&quot;,&quot;Difficult climbing&quot;},//16 easy climbing(OC-28), difficult climbing(GC-10) 
 		{&quot;36&quot;,&quot;2574&quot;,&quot;swimming&quot;,&quot;29&quot;,&quot;12&quot;,&quot;May require swimming&quot;},//74
-		// Eigenschaften / Wegpunkte
+		// Eigenschaften / Wegpunkte  - Conditions (Yes/No)
 		{&quot;55&quot;,&quot;2612&quot;,&quot;letter&quot;,&quot;8&quot;,&quot;&quot;,&quot;&quot;},// 112 Letterbox (ben&#246;tigt Stempel)
 		{&quot;54&quot;,&quot;2610&quot;,&quot;interestsign&quot;,&quot;30&quot;,&quot;&quot;,&quot;&quot;},// 110 Interessanter Ort ev mit scenic zusammenfassen?
 		{&quot;56&quot;,&quot;2614&quot;,&quot;moving&quot;,&quot;31&quot;,&quot;&quot;,&quot;&quot;},// 114 Bewegliches Ziel
@@ -216,7 +221,7 @@
 		// Einschr&#228;nkungen und Voraussetzungen / Systembedingt
 		{&quot;59&quot;,&quot;2620&quot;,&quot;oconly&quot;,&quot;6&quot;,&quot;&quot;,&quot;&quot;},// 120 Nur bei Opencaching logbar
 		{&quot;71&quot;,&quot;2650&quot;,&quot;wwwlink&quot;,&quot;7&quot;,&quot;&quot;,&quot;&quot;},// 150 Nur Hyperlink zu OC-externen Portalen
-		// Einschr&#228;nkungen und Voraussetzungen / Ben&#246;tigt Werkzeug
+		// Einschr&#228;nkungen und Voraussetzungen / Ben&#246;tigt Werkzeug - Special Equipment (Required/Not Required)
 		{&quot;69&quot;,&quot;2642&quot;,&quot;tools&quot;,&quot;46&quot;,&quot;&quot;,&quot;&quot;},// 142 Spezielle Ausr&#252;stung
 		{&quot;08&quot;,&quot;2518&quot;,&quot;compass&quot;,&quot;47&quot;,&quot;&quot;,&quot;&quot;},//18 Kompass
 		{&quot;44&quot;,&quot;2590&quot;,&quot;flashlight&quot;,&quot;48&quot;,&quot;44&quot;,&quot;Flashlight required&quot;}, // 90 Flashlight required

Modified: trunk/src/CacheWolf/Attributes.java
===================================================================
--- trunk/src/CacheWolf/Attributes.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/Attributes.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -5,7 +5,7 @@
 	/**
 	 * The number of attributes for this cache (=number of array elements in use in attribs)
 	 */
-	private int count=0;
+	private int _count=0;
 	/**
 	 * The attributes as array of MAXATTRIBS Attribute
 	 */
@@ -19,12 +19,12 @@
 	 * Get the number of attributes in the list
 	 * @return number of attributes
 	 */
-	public int getCount(){return count;}	
+	public int count(){return _count;}	
 	/**
 	 * getting an empty attributes list for this Cache 
 	 */
 	public void clear() {
-		count=0;
+		_count=0;
 		attrYes[0]=0l;
 		attrYes[1]=0l;
 		attrNo[0]=0l;
@@ -50,7 +50,7 @@
 	public String XmlAttributesWrite(){
 		StringBuffer sb=new StringBuffer(1000);
 		sb.append(&quot;&lt;ATTRIBUTES&gt;\n&quot;);
-		for (int i=0; i&lt;count; i++) {
+		for (int i=0; i&lt;_count; i++) {
 			sb.append(&quot;   &lt;ATT&gt;&quot;);
 			sb.append(attribs[i].getImageName());
 			sb.append(&quot;&lt;/ATT&gt;\n&quot;);
@@ -63,10 +63,10 @@
 	 * @param attributeName
 	 */
 	public void add(String attributeName){
-		if (count&lt;attribs.length) {
+		if (_count&lt;attribs.length) {
 			if ( !attributeName.equalsIgnoreCase( &quot;attribute-blank.gif&quot; ) ) {
 				Attribute attr = new Attribute(attributeName);
-				attribs[count++] = attr;
+				attribs[_count++] = attr;
 				attrYes=attr.getYesBit(attrYes);
 				attrNo=attr.getNoBit(attrNo);
 			}
@@ -78,9 +78,9 @@
 	 * @param GC attribute Inc (attribute set = 0 ,attribute  not set = 1)
 	 */
 	public void add(int attIdGC, String Yes0No1) {
-		if (count&lt;attribs.length) {
+		if (_count&lt;attribs.length) {
 			Attribute attr = new Attribute(attIdGC, Yes0No1);
-			attribs[count++] = attr;
+			attribs[_count++] = attr;
 			attrYes=attr.getYesBit(attrYes);
 			attrNo=attr.getNoBit(attrNo);			
 		}
@@ -90,9 +90,9 @@
 	 * @param OC attribute ID
 	 */
 	public void add(int attIdOC) {
-		if (count&lt;attribs.length) {
+		if (_count&lt;attribs.length) {
 			Attribute attr = new Attribute(attIdOC);
-			attribs[count++] = attr;
+			attribs[_count++] = attr;
 			attrYes=attr.getYesBit(attrYes);
 		}
 	}

Modified: trunk/src/CacheWolf/AttributesViewer.java
===================================================================
--- trunk/src/CacheWolf/AttributesViewer.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/AttributesViewer.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -43,7 +43,7 @@
 	
 	public void showImages(Attributes atts) {
 		iap.images.clear();
-		for (int i=0; i&lt;atts.getCount(); i++) {
+		for (int i=0; i&lt;atts.count(); i++) {
 			attAniImage img=new attAniImage( atts.getAttribute(i).getImage());
 			img.info=atts.getAttribute(i).getMsg();
 			img.location=new Rect((i % ICONS_PER_ROW)*TILESIZE,(i / ICONS_PER_ROW)*TILESIZE,TILESIZE,TILESIZE);

Modified: trunk/src/CacheWolf/CacheHolder.java
===================================================================
--- trunk/src/CacheWolf/CacheHolder.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/CacheHolder.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -105,7 +105,7 @@
 	private boolean hasSolver = false;
 	/** True if a note is entered for the cache */
 	private boolean hasNote = false;
-	public CacheHolderDetail details = null;
+	private CacheHolderDetail details = null;
 	/** When sorting the cacheDB this field is used. The relevant field is copied here and
 	 *  the sort is always done on this field to speed up the sorting process 
 	 */
@@ -383,7 +383,7 @@
 	            }
 				if (version &lt; Profile.CURRENTFILEFORMAT) {
 		            // forceload of details, creates waypoint.xml if missing
-		            details = getCacheDetails(true, false);
+		            details = getCacheDetails(false);
 		            // make sure details get (re)written in new format
 		            details.hasUnsavedChanges = true;
 		            // update information on notes and solver info
@@ -506,7 +506,7 @@
 
 		this.setAttribsAsBits(ch.getAttributesBits());
 		if (ch.detailsLoaded()) {
-			this.getFreshDetails().update(ch.getFreshDetails());
+			this.getCacheDetails(false).update(ch.getCacheDetails(false));
 		}	
 	}
 	/**
@@ -519,7 +519,7 @@
 			// are already loaded. When they aren't loaded, then we assume
 			// that there is no change, so nothing to do.
 			if (this.detailsLoaded()) {
-				CacheHolderDetail chD = getCacheDetails(false, false);
+				CacheHolderDetail chD = getCacheDetails(true);
 				if (chD != null) {
 					chD.CacheLogs.calcRecommendations();
 					recommendationScore = chD.CacheLogs.recommendationRating;
@@ -662,19 +662,7 @@
 	public boolean detailsLoaded() {
 		return details!=null;
 	}
-	
-	/** 
-	 * Call this method to get the long-description and so on.
-	 * If the according .xml-file is already read, it will return
-	 * that one, otherwise it will be loaded.
-	 * To avoid memory problems this routine loads not for more caches than maxDetails
-	 * the details. If maxdetails is reached, it will remove from RAM the details 
-	 * of the 5 caches that were loaded most long ago.
-	 */
-	public CacheHolderDetail getCacheDetails(boolean maybenew) {
-		return getCacheDetails(maybenew, true);
-	}
-	
+
 	/**
 	 * Gets the detail object of a cache. The detail object stores information which is not needed
 	 * for every cache instantaneously, but can be loaded if the user decides to look at this cache.
@@ -684,66 +672,33 @@
 	 * or the user is warned that the file doesn't exist.
 	 * If more than &lt;code&gt;maxdetails&lt;/code&gt; details are loaded, then the 5 last recently loaded 
 	 * caches are unloaded (to save ram). 
-	 * 
-	 * @param maybenew
-	 * 			  If true and the cache file could not be read, then an empty detail object is 
-	 *            returned.
 	 * @param alarmuser
 	 *            If true an error message will be displayed to the user, if the details could not
 	 *            be read, and the method returns null 
 	 * @return The respective CacheHolderDetail, or null
 	 */
-
-	public CacheHolderDetail getCacheDetails(boolean maybenew, boolean alarmuser) {
+	public CacheHolderDetail getCacheDetails(boolean alarmuser) {
 		if (details == null) {
-
 			details = new CacheHolderDetail(this);
 			try {
 				details.readCache(Global.getProfile().dataDir);
 			} catch (IOException e) {
-				if (! maybenew ) {
-					if (alarmuser) {
-						//FIXME: put a message to languages file
-						(new MessageBox(MyLocale.getMsg(31415,&quot;Error&quot;), MyLocale.getMsg(31415, &quot;Could not read cache details for cache: &quot;)
-						        + this.getWayPoint(), FormBase.OKB)).execute();
-					} else {
-				//		Global.getPref().log(&quot;Could not read details for waypoint &quot; + getWayPoint());
-					}
-					details = null;
-					this.setIncomplete(true);
+				if (alarmuser) {
+					//FIXME: put a message to languages file
+					(new MessageBox(MyLocale.getMsg(31415,&quot;Error&quot;), MyLocale.getMsg(31415, &quot;Could not read cache details for cache: &quot;)
+					        + this.getWayPoint(), FormBase.OKB)).execute();
 				}
+				details = null;
+				this.setIncomplete(true);
 			}
-			if (details != null
-					  // for importing/spidering reasons helper objects with same waypoint are created
-					&amp;&amp; !cachesWithLoadedDetails.contains(this)
-					  // helper objects may have empty waypoint
-					//&amp;&amp; !this.getWayPoint().equals(CacheHolder.EMPTY)
-					) {
+			// for importing/spidering reasons helper objects with same waypoint are created
+			if (details != null &amp;&amp; !cachesWithLoadedDetails.contains(this)) {
 				cachesWithLoadedDetails.add(this);
 				if (cachesWithLoadedDetails.size() &gt;= Global.getPref().maxDetails) removeOldestDetails();
 			}
 		}
 		return details;
 	}
-	
-	/**
-	 * Gets a detail object for the cache. If the object is already created, then this object is
-	 * returned, otherwise it's created from the cache.xml file. If no such file is found, an empty
-	 * object is returned.
-	 * @return The object representing the cache details
-	 */
-	public CacheHolderDetail getFreshDetails() {
-		return this.getCacheDetails(true, false);
-	}
-	/**
-	 * Gets a detail object for the cache. If the object is already created, then this object is
-	 * returned, otherwise it's created from the cache.xml file. If no such file is found, an error
-	 * message is displayed and &lt;code&gt;null&lt;/code&gt; is returned.
-	 * @return The object representing the cache details, or &lt;code&gt;null&lt;/code&gt;.
-	 */
-	public CacheHolderDetail getExistingDetails() {
-		return this.getCacheDetails(false, true);
-	}
 
 	/**
 	 * Saves the cache to the corresponding &lt;waypoint&gt;.xml file, located in the profiles
@@ -752,7 +707,7 @@
 	 */
 	public void save() {
 		checkIncomplete();
-		this.getFreshDetails().saveCacheDetails(Global.getProfile().dataDir);
+		this.getCacheDetails(false).saveCacheDetails(Global.getProfile().dataDir);
 	}
 	
 	void releaseCacheDetails() {
@@ -798,7 +753,7 @@
 //			ch = Global.getProfile().cacheDB.get(wp);
 			ch = (CacheHolder) cachesWithLoadedDetails.get(i);
 			if (ch != null) {
-	            chD = ch.getExistingDetails();
+	            chD = ch.getCacheDetails(true);
 	            if (chD!=null &amp;&amp; chD.hasUnsavedChanges) {
 		            //ch.calcRecommendationScore();
 		            chD.saveCacheDetails(Global.getProfile().dataDir);
@@ -1564,7 +1519,7 @@
 	 */
 	public boolean rename(String newWptId) {
 		newWptId = newWptId.toUpperCase();
-		getFreshDetails();
+		getCacheDetails(false);
 		if (details.rename(newWptId)) {
 			setWayPoint(newWptId);
 			save();

Modified: trunk/src/CacheWolf/CacheHolderDetail.java
===================================================================
--- trunk/src/CacheWolf/CacheHolderDetail.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/CacheHolderDetail.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -121,7 +121,7 @@
 		  }
 		  this.Travelbugs = newCh.Travelbugs;
 		  
-		  if (newCh.attributes.getCount() &gt; 0) this.attributes = newCh.attributes;
+		  if (newCh.attributes.count() &gt; 0) this.attributes = newCh.attributes;
 		  
 		  // URL
 		  this.URL = newCh.URL;

Modified: trunk/src/CacheWolf/DescriptionPanel.java
===================================================================
--- trunk/src/CacheWolf/DescriptionPanel.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/DescriptionPanel.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -49,14 +49,14 @@
             isHtml = cache.is_HTML();
             if (cache.isAddiWpt()) {
                 isHtml = cache.mainCache.is_HTML();
-                if (cache.getExistingDetails().LongDescription != null &amp;&amp; cache.getExistingDetails().LongDescription.length() &gt; 0)
-                    desc = cache.getExistingDetails().LongDescription + (isHtml ? &quot;&lt;hr&gt;\n&quot; : &quot;\n&quot;)
-                            + cache.mainCache.getExistingDetails().LongDescription;
+                if (cache.getCacheDetails(true).LongDescription != null &amp;&amp; cache.getCacheDetails(true).LongDescription.length() &gt; 0)
+                    desc = cache.getCacheDetails(true).LongDescription + (isHtml ? &quot;&lt;hr&gt;\n&quot; : &quot;\n&quot;)
+                            + cache.mainCache.getCacheDetails(true).LongDescription;
                 else
-                    desc = cache.mainCache.getExistingDetails().LongDescription;
+                    desc = cache.mainCache.getCacheDetails(true).LongDescription;
             } else
                 // not an addi-wpt
-                desc = cache.getExistingDetails().LongDescription;
+                desc = cache.getCacheDetails(true).LongDescription;
         }
         // HtmlDisplay does not show the &lt;sup&gt; tag correctly, so we need to replace with ^
         if (desc.indexOf(&quot;&lt;sup&gt;&quot;)&gt;=0) {
@@ -74,7 +74,7 @@
                 } else {
                     chImages=cache;
                 }
-            	Images = chImages.getExistingDetails().images;
+            	Images = chImages.getCacheDetails(true).images;
                 StringBuffer s = new StringBuffer(desc.length() + Images.size() * 100);
                 int start = 0;
                 int pos;
@@ -108,7 +108,7 @@
                     s.append(desc.substring(start));
                 desc = s.toString();
                 if (imageNo&lt;Images.size()) {
-                    desc += getPicDesc(imageNo, chImages.getExistingDetails());
+                    desc += getPicDesc(imageNo, chImages.getCacheDetails(true));
                 }
             }
             //disp.setHtml(desc);

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/DetailsPanel.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -416,7 +416,7 @@
 		lblAddiCount.setText(MyLocale.getMsg(1044, &quot;Addis&quot;) + &quot;: &quot; + addiCount);
 
 		if (isBigScreen) {
-			waypointNotes.setText(ch.getExistingDetails().getCacheNotes());
+			waypointNotes.setText(ch.getCacheDetails(true).getCacheNotes());
 		}
 	}
 
@@ -806,10 +806,10 @@
 		dirtyNotes = false;
 		dirtyDetails = false;
 		needsTableUpdate = false;
-		cache.getFreshDetails().hasUnsavedChanges = true;
+		cache.getCacheDetails(false).hasUnsavedChanges = true;
 		if (!oldWaypoint.equals(cache.getWayPoint())){
 		 // Delete old XML - File
-			cache.getFreshDetails().deleteFile(Global.getProfile().dataDir+oldWaypoint+&quot;.xml&quot;);
+			cache.getCacheDetails(false).deleteFile(Global.getProfile().dataDir+oldWaypoint+&quot;.xml&quot;);
 		}
 	}
 

Modified: trunk/src/CacheWolf/MainMenu.java
===================================================================
--- trunk/src/CacheWolf/MainMenu.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/MainMenu.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -668,8 +668,8 @@
 					cwp.setPosition(i);
 					CacheHolder ch = cacheDB.get(i);
 					if (ch.mainCache==null) {
-						ch.setHasNote(!ch.getFreshDetails().getCacheNotes().equals(&quot;&quot;));
-						ch.setHasSolver(!ch.getFreshDetails().getSolver().equals(&quot;&quot;));
+						ch.setHasNote(!ch.getCacheDetails(false).getCacheNotes().equals(&quot;&quot;));
+						ch.setHasSolver(!ch.getCacheDetails(false).getSolver().equals(&quot;&quot;));
 					}
 					if (cwp.isClosed()) break;
 				} // for

Modified: trunk/src/CacheWolf/MainTab.java
===================================================================
--- trunk/src/CacheWolf/MainTab.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/MainTab.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -179,7 +179,7 @@
 					if (oldHasSolver != chD.getParent().hasSolver()) tbP.tc.update(true);
 				} else {
 					boolean oldHasSolver = chMain.hasSolver();
-					chMain.getExistingDetails().setSolver(solverP.getInstructions());
+					chMain.getCacheDetails(true).setSolver(solverP.getInstructions());
 					if (oldHasSolver != chMain.hasSolver()) tbP.tc.update(true);
 					chMain.save();//Vm.debug(&quot;mainT:SaveCache &quot;+chMain.wayPoint+&quot;/S:&quot;+chMain.Solver);
 					chMain=null;

Modified: trunk/src/CacheWolf/Parser.java
===================================================================
--- trunk/src/CacheWolf/Parser.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/Parser.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -834,8 +834,8 @@
 					op.append(addiWpt.getCacheName());
 					op.append(&quot;] = \&quot; $&quot;);
 					op.append(addiWpt.getWayPoint());
-					if (addiWpt.getExistingDetails().LongDescription.trim().length()&gt;0)
-						op.append(&quot;\n   \&quot;&quot;+STRreplace.replace(addiWpt.getExistingDetails().LongDescription,&quot;\&quot;&quot;,&quot;\&quot;\&quot;&quot;)+&quot;\&quot;&quot;);
+					if (addiWpt.getCacheDetails(true).LongDescription.trim().length()&gt;0)
+						op.append(&quot;\n   \&quot;&quot;+STRreplace.replace(addiWpt.getCacheDetails(true).LongDescription,&quot;\&quot;&quot;,&quot;\&quot;\&quot;&quot;)+&quot;\&quot;&quot;);
 					op.append(&quot;\n   goto($&quot;);
 					op.append(addiWpt.getWayPoint());
 					op.append(&quot;); STOP\nENDIF\n\n&quot;);

Modified: trunk/src/CacheWolf/SearchCache.java
===================================================================
--- trunk/src/CacheWolf/SearchCache.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/SearchCache.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -44,10 +44,10 @@
 				   ch.getCacheName().toUpperCase().indexOf(searchStr) &lt;0 &amp;&amp; 
 				   ch.getCacheStatus().toUpperCase().indexOf(searchStr)&lt;0 &amp;&amp;
 				   (! searchInDescriptionAndNotes || 
-					ch.getExistingDetails().LongDescription.toUpperCase().indexOf(searchStr)&lt;0 &amp;&amp;
-					ch.getExistingDetails().getCacheNotes().toUpperCase().indexOf(searchStr)&lt;0)&amp;&amp;
+					ch.getCacheDetails(true).LongDescription.toUpperCase().indexOf(searchStr)&lt;0 &amp;&amp;
+					ch.getCacheDetails(true).getCacheNotes().toUpperCase().indexOf(searchStr)&lt;0)&amp;&amp;
 				   (! searchInLogs ||
-					ch.getExistingDetails().CacheLogs.allMessages().toUpperCase().indexOf(searchStr)&lt;0)){
+					ch.getCacheDetails(true).CacheLogs.allMessages().toUpperCase().indexOf(searchStr)&lt;0)){
 					ch.is_flaged = false;
 				} else
 					ch.is_flaged=true;

Modified: trunk/src/CacheWolf/ShowCacheInBrowser.java
===================================================================
--- trunk/src/CacheWolf/ShowCacheInBrowser.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/ShowCacheInBrowser.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -89,39 +89,39 @@
 						tpl.setParam(&quot;STATUS&quot;, chD.getCacheStatus());
 
 					// Cache attributes
-					if (chD.getExistingDetails().attributes.getCount()&gt;0) {
-						Vector attVect=new Vector(chD.getExistingDetails().attributes.getCount()+1);
-						for (int i=0; i&lt;chD.getExistingDetails().attributes.getCount(); i++) {
+					if (chD.getCacheDetails(true).attributes.count()&gt;0) {
+						Vector attVect=new Vector(chD.getCacheDetails(true).attributes.count()+1);
+						for (int i=0; i&lt;chD.getCacheDetails(true).attributes.count(); i++) {
 							Hashtable atts=new Hashtable();
 							atts.put(&quot;IMAGE&quot;,&quot;&lt;img src=\&quot;<A HREF="file://">file://</A>&quot;+
-									 chD.getExistingDetails().attributes.getAttribute(i).getPathAndImageName()+
-									 &quot;\&quot; border=0 alt=\&quot;&quot;+chD.getExistingDetails().attributes.getAttribute(i).getMsg()+&quot;\&quot;&gt;&quot;);
+									 chD.getCacheDetails(true).attributes.getAttribute(i).getPathAndImageName()+
+									 &quot;\&quot; border=0 alt=\&quot;&quot;+chD.getCacheDetails(true).attributes.getAttribute(i).getMsg()+&quot;\&quot;&gt;&quot;);
 							if (i % 5 ==4)
 								atts.put(&quot;BR&quot;,&quot;&lt;br/&gt;&quot;);
 							else
 								atts.put(&quot;BR&quot;,&quot;&quot;);
-							atts.put(&quot;INFO&quot;,chD.getExistingDetails().attributes.getAttribute(i).getMsg());
+							atts.put(&quot;INFO&quot;,chD.getCacheDetails(true).attributes.getAttribute(i).getMsg());
 							attVect.add(atts);
 						}
 						tpl.setParam(&quot;ATTRIBUTES&quot;,attVect);
 					}
 
 					tpl.setParam(&quot;DATE&quot;, chD.getDateHidden());
-					tpl.setParam(&quot;URL&quot;, chD.getExistingDetails().URL);
-					if (chD.getExistingDetails().Travelbugs.size()&gt;0) tpl.setParam(&quot;BUGS&quot;,chD.getExistingDetails().Travelbugs.toHtml());
-					if (chD.getExistingDetails().getCacheNotes().trim().length()&gt;0) tpl.setParam(&quot;NOTES&quot;, STRreplace.replace(chD.getExistingDetails().getCacheNotes(),&quot;\n&quot;,&quot;&lt;br/&gt;\n&quot;));
-					if (chD.getExistingDetails().getSolver()!=null &amp;&amp; chD.getExistingDetails().getSolver().trim().length()&gt;0) tpl.setParam(&quot;SOLVER&quot;, STRreplace.replace(chD.getExistingDetails().getSolver(),&quot;\n&quot;,&quot;&lt;br/&gt;\n&quot;));
+					tpl.setParam(&quot;URL&quot;, chD.getCacheDetails(true).URL);
+					if (chD.getCacheDetails(true).Travelbugs.size()&gt;0) tpl.setParam(&quot;BUGS&quot;,chD.getCacheDetails(true).Travelbugs.toHtml());
+					if (chD.getCacheDetails(true).getCacheNotes().trim().length()&gt;0) tpl.setParam(&quot;NOTES&quot;, STRreplace.replace(chD.getCacheDetails(true).getCacheNotes(),&quot;\n&quot;,&quot;&lt;br/&gt;\n&quot;));
+					if (chD.getCacheDetails(true).getSolver()!=null &amp;&amp; chD.getCacheDetails(true).getSolver().trim().length()&gt;0) tpl.setParam(&quot;SOLVER&quot;, STRreplace.replace(chD.getCacheDetails(true).getSolver(),&quot;\n&quot;,&quot;&lt;br/&gt;\n&quot;));
 					// Look for images
 
-					StringBuffer s=new StringBuffer(chD.getExistingDetails().LongDescription.length());
+					StringBuffer s=new StringBuffer(chD.getCacheDetails(true).LongDescription.length());
 					int start=0;
 					int pos;
 					int imageNo=0;
 					Regex imgRex = new Regex(&quot;src=(?:\\s*[^\&quot;|']*?)(?:\&quot;|')(.*?)(?:\&quot;|')&quot;);
-					while (start&gt;=0 &amp;&amp; (pos=chD.getExistingDetails().LongDescription.indexOf(&quot;&lt;img&quot;,start))&gt;0) {
-						if (imageNo &gt;= chD.getExistingDetails().images.size())break;
-						s.append(chD.getExistingDetails().LongDescription.substring(start,pos));
-						imgRex.searchFrom(chD.getExistingDetails().LongDescription,pos);
+					while (start&gt;=0 &amp;&amp; (pos=chD.getCacheDetails(true).LongDescription.indexOf(&quot;&lt;img&quot;,start))&gt;0) {
+						if (imageNo &gt;= chD.getCacheDetails(true).images.size())break;
+						s.append(chD.getCacheDetails(true).LongDescription.substring(start,pos));
+						imgRex.searchFrom(chD.getCacheDetails(true).LongDescription,pos);
 						String imgUrl=imgRex.stringMatched(1);
 						//Vm.debug(&quot;imgUrl &quot;+imgUrl);
 						if (imgUrl.lastIndexOf('.')&gt;0 &amp;&amp; imgUrl.toLowerCase().startsWith(&quot;http&quot;)) {
@@ -129,27 +129,27 @@
 							// If we have an image which we stored when spidering, we can display it
         					if(imgType.startsWith(&quot;.png&quot;) || imgType.startsWith(&quot;.jpg&quot;) || imgType.startsWith(&quot;.gif&quot;)){
 								s.append(&quot;&lt;img src=\&quot;<A HREF="file://">file://</A>&quot;+
-								   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getFilename()+&quot;\&quot;&gt;&quot;);
+								   Global.getProfile().dataDir+chD.getCacheDetails(true).images.get(imageNo).getFilename()+&quot;\&quot;&gt;&quot;);
 								imageNo++;
 							}
 						}
-						start=chD.getExistingDetails().LongDescription.indexOf(&quot;&gt;&quot;,pos);
+						start=chD.getCacheDetails(true).LongDescription.indexOf(&quot;&gt;&quot;,pos);
 						if (start&gt;=0) start++;
 					}
-					if (start&gt;=0) s.append(chD.getExistingDetails().LongDescription.substring(start));
+					if (start&gt;=0) s.append(chD.getCacheDetails(true).LongDescription.substring(start));
 					tpl.setParam(&quot;DESCRIPTION&quot;, s.toString());
 
 					// Do the remaining pictures which are not included in main body of text
 					// They will be hidden initially and can be displayed by clicking on a link
-					if (imageNo&lt;chD.getExistingDetails().images.size()) {
-						Vector imageVect=new Vector(chD.getExistingDetails().images.size()-imageNo);
-						for (; imageNo&lt;chD.getExistingDetails().images.size(); imageNo++) {
+					if (imageNo&lt;chD.getCacheDetails(true).images.size()) {
+						Vector imageVect=new Vector(chD.getCacheDetails(true).images.size()-imageNo);
+						for (; imageNo&lt;chD.getCacheDetails(true).images.size(); imageNo++) {
 							Hashtable imgs=new Hashtable();
 							imgs.put(&quot;IMAGE&quot;,&quot;&lt;img src=\&quot;<A HREF="file://">file://</A>&quot;+
-									   Global.getProfile().dataDir+chD.getExistingDetails().images.get(imageNo).getFilename()+&quot;\&quot; border=0&gt;&quot;);
-							imgs.put(&quot;IMAGETEXT&quot;,chD.getExistingDetails().images.get(imageNo).getTitle());
-							if (imageNo&lt;chD.getExistingDetails().images.size() &amp;&amp; chD.getExistingDetails().images.get(imageNo).getComment()!=null)
-								imgs.put(&quot;IMAGECOMMENT&quot;,chD.getExistingDetails().images.get(imageNo).getComment());
+									   Global.getProfile().dataDir+chD.getCacheDetails(true).images.get(imageNo).getFilename()+&quot;\&quot; border=0&gt;&quot;);
+							imgs.put(&quot;IMAGETEXT&quot;,chD.getCacheDetails(true).images.get(imageNo).getTitle());
+							if (imageNo&lt;chD.getCacheDetails(true).images.size() &amp;&amp; chD.getCacheDetails(true).images.get(imageNo).getComment()!=null)
+								imgs.put(&quot;IMAGECOMMENT&quot;,chD.getCacheDetails(true).images.get(imageNo).getComment());
 							else
 								imgs.put(&quot;IMAGECOMMENT&quot;,&quot;&quot;);
 							imgs.put(&quot;I&quot;,&quot;'img&quot;+new Integer(imageNo).toString()+&quot;'&quot;);
@@ -158,10 +158,10 @@
 						tpl.setParam(&quot;IMAGES&quot;,imageVect);
 					}
 
-					Vector logVect=new Vector(chD.getExistingDetails().CacheLogs.size());
-					for (int i=0; i&lt;chD.getExistingDetails().CacheLogs.size(); i++) {
+					Vector logVect=new Vector(chD.getCacheDetails(true).CacheLogs.size());
+					for (int i=0; i&lt;chD.getCacheDetails(true).CacheLogs.size(); i++) {
 						Hashtable logs=new Hashtable();
-						String log=STRreplace.replace(chD.getExistingDetails().CacheLogs.getLog(i).toHtml(),&quot;<A HREF="http://www.geocaching.com/images/icons/">http://www.geocaching.com/images/icons/</A>&quot;,&quot;&quot;);
+						String log=STRreplace.replace(chD.getCacheDetails(true).CacheLogs.getLog(i).toHtml(),&quot;<A HREF="http://www.geocaching.com/images/icons/">http://www.geocaching.com/images/icons/</A>&quot;,&quot;&quot;);
 						int posGt=log.indexOf('&gt;'); // Find the icon which defines the type of log
 						if (posGt&lt;0) {
 							logs.put(&quot;LOG&quot;,log);
@@ -181,7 +181,7 @@
 					}
 					tpl.setParam(&quot;LOGS&quot;,logVect);
 					if (!chD.is_available()) tpl.setParam(&quot;UNAVAILABLE&quot;,&quot;1&quot;);
-					if (!chD.getExistingDetails().Hints.equals(&quot;null&quot;))tpl.setParam(&quot;HINT&quot;,Common.rot13(chD.getExistingDetails().Hints));
+					if (!chD.getCacheDetails(true).Hints.equals(&quot;null&quot;))tpl.setParam(&quot;HINT&quot;,Common.rot13(chD.getCacheDetails(true).Hints));
 
 					if (chD.hasAddiWpt()) {
 						Vector addiVect=new Vector(chD.addiWpts.size());
@@ -192,7 +192,7 @@
 							addis.put(&quot;NAME&quot;,ch.getCacheName());
 							addis.put(&quot;LATLON&quot;,ch.LatLon);
 							addis.put(&quot;IMG&quot;,&quot;&lt;img src=\&quot;&quot;+CacheType.typeImageForId(ch.getType())+&quot;\&quot;&gt;&quot;);
-							addis.put(&quot;LONGDESC&quot;,ch.getExistingDetails().LongDescription); // Do we need to treat longDesc as above ?
+							addis.put(&quot;LONGDESC&quot;,ch.getCacheDetails(true).LongDescription); // Do we need to treat longDesc as above ?
 							addiVect.add(addis);
 						}
 						tpl.setParam(&quot;ADDIS&quot;,addiVect);

Modified: trunk/src/CacheWolf/SolverPanel.java
===================================================================
--- trunk/src/CacheWolf/SolverPanel.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/SolverPanel.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -67,7 +67,7 @@
 	 */
 	public void setInstructions(CacheHolder pCh) {
 		if (pCh != null) {
-	        this.setInstructions(pCh.getFreshDetails().getSolver());
+	        this.setInstructions(pCh.getCacheDetails(false).getSolver());
 	        if (!pCh.hasSameMainCache(ch)) {
 		        this.clearOutput();
 	        }

Modified: trunk/src/CacheWolf/TravelbugJourneyScreen.java
===================================================================
--- trunk/src/CacheWolf/TravelbugJourneyScreen.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/TravelbugJourneyScreen.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -67,8 +67,8 @@
 			ch=cacheDB.get(curCacheNo);
 			cache=MyLocale.getMsg(6022,&quot;: Current cache: &quot;)+ch.getWayPoint()+&quot; - &quot;+ch.getCacheName();
 			waypoint=ch.getWayPoint();
-			chD=ch.getExistingDetails();
-			tblSrcCache=ch.getExistingDetails().Travelbugs;
+			chD=ch.getCacheDetails(true);
+			tblSrcCache=ch.getCacheDetails(true).Travelbugs;
 		}
 		title=&quot;Travelbugs&quot;+cache;
 		tcTbJourneyList=new tbListControl();

Modified: trunk/src/CacheWolf/exp/ExploristExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/ExploristExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/ExploristExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -193,7 +193,7 @@
 	 * @return formated cache data
 	 */
 	public String record(CacheHolder ch) {
-		CacheHolderDetail det = ch.getExistingDetails();
+		CacheHolderDetail det = ch.getCacheDetails(true);
 		/*
 		static protected final int GC_AW_PARKING = 50;
 		static protected final int GC_AW_STAGE_OF_MULTI = 51;

Modified: trunk/src/CacheWolf/exp/GPXExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/GPXExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/GPXExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -52,7 +52,7 @@
 
 	public String record(CacheHolder ch, String lat, String lon, int counter) {
 		StringBuffer strBuf = new StringBuffer(1000);
-		CacheHolderDetail det = ch.getExistingDetails();
+		CacheHolderDetail det = ch.getCacheDetails(true);
 		try{
 			strBuf.append(&quot;  &lt;wpt lat=\&quot;&quot;+lat+&quot;\&quot; lon=\&quot;&quot;+lon+&quot;\&quot;&gt;\r\n&quot;);
 

Modified: trunk/src/CacheWolf/exp/GpxExportNg.java
===================================================================
--- trunk/src/CacheWolf/exp/GpxExportNg.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/GpxExportNg.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -1,5 +1,6 @@
 package CacheWolf.exp;
 
+import CacheWolf.Attribute;
 import CacheWolf.CWPoint;
 import CacheWolf.CacheHolder;
 import CacheWolf.CacheSize;
@@ -11,6 +12,7 @@
 import CacheWolf.LogList;
 import CacheWolf.MyLocale;
 import CacheWolf.SafeXML;
+import CacheWolf.Travelbug;
 import CacheWolf.utils.FileBugfix;
 
 import com.stevesoft.ewe_pat.Regex;
@@ -511,7 +513,7 @@
 			return &quot;&quot;;
 
 		StringBuffer ret = new StringBuffer();
-		ch.getFreshDetails();
+		ch.getCacheDetails(true);
 
 		try {
 			ret.append(formatCompact(ch));
@@ -589,15 +591,15 @@
 		if (!ch.isCustomWpt()) {
 			if (exportIds == WPNAME_ID_SMART &amp;&amp; exportStyle == STYLE_GPX_COMPACT) {
 				if (ch.isAddiWpt()) {
-					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + ch.getFreshDetails().LongDescription)).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
+					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + ch.getCacheDetails(true).LongDescription)).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
 				} else {
-					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + Common.rot13(ch.getFreshDetails().Hints))).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
+					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName() + &quot; &quot; + Common.rot13(ch.getCacheDetails(true).Hints))).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
 				}
 			} else if (exportIds == WPNAME_NAME_SMART) {
 				// TBD
 			} else {
 				if (ch.isAddiWpt()) {
-					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getFreshDetails().LongDescription)).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
+					ret.append(&quot;    &lt;cmt&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheDetails(true).LongDescription)).concat(&quot;&lt;/cmt&gt;&quot;.concat(newLine)));
 				} // caches have no &lt;cmt&gt; in gc.com PQs
 			}
 		}
@@ -614,7 +616,7 @@
 
 		if (exportStyle != STYLE_GPX_COMPACT) {
 			if (!ch.isCustomWpt()) {
-				ret.append(&quot;    &lt;url&gt;&quot;.concat(ch.details.URL).concat(&quot;&lt;/url&gt;&quot;.concat(newLine)));
+				ret.append(&quot;    &lt;url&gt;&quot;.concat(ch.getCacheDetails(true).URL).concat(&quot;&lt;/url&gt;&quot;.concat(newLine)));
 				ret.append(&quot;    &lt;urlname&gt;&quot;.concat(SafeXML.cleanGPX(ch.getCacheName())).concat(&quot;&lt;/urlname&gt;&quot;.concat(newLine)));
 			}
 		}
@@ -658,29 +660,71 @@
 		.concat(&quot;      &lt;groundspeak:container&gt;&quot;).concat(CacheSize.cw2ExportString(ch.getCacheSize())).concat(&quot;&lt;/groundspeak:container&gt;&quot;.concat(newLine))
 		.concat(&quot;      &lt;groundspeak:difficulty&gt;&quot;).concat(CacheTerrDiff.shortDT(ch.getHard())).concat(&quot;&lt;/groundspeak:difficulty&gt;&quot;.concat(newLine))
 		.concat(&quot;      &lt;groundspeak:terrain&gt;&quot;).concat(CacheTerrDiff.shortDT(ch.getTerrain())).concat(&quot;&lt;/groundspeak:terrain&gt;&quot;.concat(newLine))
-		.concat(&quot;      &lt;groundspeak:country&gt;&quot;).concat(SafeXML.cleanGPX(ch.details.Country)).concat(&quot;&lt;/groundspeak:country&gt;&quot;.concat(newLine))
-		.concat(&quot;      &lt;groundspeak:state&gt;&quot;).concat(SafeXML.cleanGPX(ch.details.State)).concat(&quot;&lt;/groundspeak:state&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:country&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheDetails(true).Country)).concat(&quot;&lt;/groundspeak:country&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:state&gt;&quot;).concat(SafeXML.cleanGPX(ch.getCacheDetails(true).State)).concat(&quot;&lt;/groundspeak:state&gt;&quot;.concat(newLine))
 		.concat(&quot;      &lt;groundspeak:short_description html=\&quot;&quot;).concat(ch.is_HTML() ? TRUE : FALSE).concat(&quot;\&quot;&gt;&lt;/groundspeak:short_description&gt;&quot;.concat(newLine))
 		.concat(&quot;      &lt;groundspeak:long_description html=\&quot;&quot;).concat(ch.is_HTML() ? TRUE : FALSE).concat(&quot;\&quot;&gt;&quot;).concat(SafeXML.cleanGPX(formatLongDescription(ch))).concat(&quot;&lt;/groundspeak:long_description&gt;&quot;.concat(newLine))
-		.concat(&quot;      &lt;groundspeak:encoded_hints&gt;&quot;).concat(SafeXML.cleanGPX(Common.rot13(ch.details.Hints))).concat(&quot;&lt;/groundspeak:encoded_hints&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:encoded_hints&gt;&quot;).concat(SafeXML.cleanGPX(Common.rot13(ch.getCacheDetails(true).Hints))).concat(&quot;&lt;/groundspeak:encoded_hints&gt;&quot;.concat(newLine))
+		.concat(&quot;      &lt;groundspeak:attributes&gt;&quot;.concat(newLine))
+		.concat(formatAttributes(ch))
+		.concat(&quot;      &lt;/groundspeak:attributes&gt;&quot;.concat(newLine))
 		.concat(&quot;      &lt;groundspeak:logs&gt;&quot;.concat(newLine))
 		.concat(formatLogs(ch))
 		.concat(&quot;      &lt;/groundspeak:logs&gt;&quot;.concat(newLine))
 		.concat(&quot;      &lt;groundspeak:travelbugs&gt;&quot;.concat(newLine))
-//		.concat(formatTbs(ch))
+		.concat(formatTbs(ch))
 		.concat(&quot;      &lt;/groundspeak:travelbugs&gt;&quot;.concat(newLine))
 		.concat(&quot;    &lt;/groundspeak:cache&gt;&quot;.concat(newLine));
-
 	}
-
-
 	/**
+	 * 
+	 */
+	private String formatTbs(CacheHolder ch) {
+		StringBuffer ret = new StringBuffer();
+		Travelbug Tb;
+		for (int i = 0; i &lt; ch.getCacheDetails(true).Travelbugs.size(); i++) {
+			Tb=ch.getCacheDetails(true).Travelbugs.getTB(i);
+			ret.append(&quot;        &lt;groundspeak:travelbug id=\&quot;&quot;).
+			append(Integer.toString(i)).
+			append(&quot;\&quot; ref=\&quot;TB\&quot;&gt;&quot;).
+			// append(newLine).
+			// append(&quot;          &lt;groundspeak:name&gt;&quot;).
+			append(&quot;&lt;groundspeak:name&gt;&quot;).
+			append(SafeXML.cleanGPX(Tb.getName())).
+			append(&quot;&lt;/groundspeak:name&gt;&quot;).
+			// append(newLine).
+			// append(&quot;        &lt;/groundspeak:travelbug&gt;\r\n&quot;);
+			append(&quot;&lt;/groundspeak:travelbug&gt;\r\n&quot;);
+		}
+		return ret.toString();
+	}
+	/**
+	 * 
+	 */
+	private String formatAttributes(CacheHolder ch){
+		StringBuffer ret = new StringBuffer();
+		Attribute attrib;
+		for (int i = 0; i &lt; ch.getCacheDetails(true).attributes.count(); i++) {
+			// &lt;groundspeak:attribute id=&quot;X&quot; inc=&quot;Y&quot;&gt;text f&#252;r X&lt;/groundspeak:attribute&gt;
+			attrib=ch.getCacheDetails(true).attributes.getAttribute(i);
+			ret.append(&quot;        &lt;groundspeak:attribute id=\&quot;&quot;).
+			append(attrib.getGCId()).
+			append(&quot;\&quot; inc=\&quot;&quot;).
+			append(attrib.getInc()).
+			append(&quot;\&quot;&gt;&quot;).
+			append(attrib.getGCText()).
+			append(&quot;&lt;/groundspeak:attribute&gt;&quot;).
+			append(newLine);
+		}
+		return ret.toString();
+	}
+	/**
 	 * format cache logs as found in a gc.com GPX file
 	 * @param ch CacheHolder containing the logs
 	 * @return formatted logs or empty string if no logs are present
 	 */
-	public String formatLogs(CacheHolder ch) {
-		LogList logs = ch.getFreshDetails().CacheLogs;
+	private String formatLogs(CacheHolder ch) {
+		LogList logs = ch.getCacheDetails(true).CacheLogs;
 		StringBuffer ret = new StringBuffer();
 		int exportlogs;
 		if (exportStyle == STYLE_GPX_PQLIKE &amp;&amp; maxLogs &lt; logs.size())
@@ -688,11 +732,11 @@
 		else {exportlogs = logs.size();}
 		if (exportStyle == STYLE_GPX_MYFINDS) {
 			// only own log
-			if (ch.details.OwnLogId.equals(&quot;&quot;)) 
+			if (ch.getCacheDetails(true).OwnLogId.equals(&quot;&quot;)) 
 				return &quot;&quot;;
-			if(ch.details.OwnLog == null) 
+			if(ch.getCacheDetails(true).OwnLog == null) 
 				return &quot;&quot;;
-			addLog(ch.details.OwnLogId, ch.details.OwnLog, finderid ,ret);
+			addLog(ch.getCacheDetails(true).OwnLogId, ch.getCacheDetails(true).OwnLog, finderid ,ret);
 		}
 		else {
 			for (int i = 0; i &lt; exportlogs; i++) {
@@ -719,7 +763,7 @@
 	 * format the header of the GPX file
 	 * @return
 	 */
-	public String formatHeader() {
+	private String formatHeader() {
 		//FIXME: extend profile to add &lt;bounds minlat=\&quot;50.91695\&quot; minlon=\&quot;6.876383\&quot; maxlat=\&quot;50.935183\&quot; maxlon=\&quot;6.918817\&quot; /&gt;
 		//Global.getProfile().getSourroundingArea(false);
 		Transformer trans = new Transformer(true);
@@ -742,13 +786,13 @@
 	 * @param ch CacheHolder to format
 	 * @return formatted output
 	 */
-	public String formatLongDescription(CacheHolder ch) {
+	private String formatLongDescription(CacheHolder ch) {
 		if (ch.isAddiWpt() || ch.isCustomWpt()) {
-			return ch.details.LongDescription;
+			return ch.getCacheDetails(true).LongDescription;
 		} else {
 			StringBuffer ret = new StringBuffer();
 			String delim = &quot;&quot;;
-			ret.append(ch.details.LongDescription);
+			ret.append(ch.getCacheDetails(true).LongDescription);
 			if (ch.is_HTML()) {
 				delim = &quot;&lt;br /&gt;&quot;;
 			} else {
@@ -772,7 +816,7 @@
 					trans.add(new Regex(&quot;@@ADDIDELIM@@&quot;, delim));
 					trans.add(new Regex(&quot;@@ADDILAT@@&quot;,formatAddiLatLon(addi.pos)));
 					trans.add(new Regex(&quot;@@ADDILON@@&quot;, &quot;&quot;));
-					trans.add(new Regex(&quot;@@ADDILONG@@&quot;,addi.getFreshDetails().LongDescription));
+					trans.add(new Regex(&quot;@@ADDILONG@@&quot;,addi.getCacheDetails(true).LongDescription));
 					ret.append(trans.replaceAll(GPXADDIINMAIN));
 				}
 				ret.append(delim).append(newLine);
@@ -786,7 +830,7 @@
 	 * @param image name of the image to display
 	 * @return log type. will default to &quot;Write note&quot; for unknown logtypes
 	 */
-	public String image2TypeText(String image) {
+	private String image2TypeText(String image) {
 		if (image.equals(&quot;icon_smile.gif&quot;))
 			return &quot;Found it&quot;;
 		if (image.equals(&quot;icon_sad.gif&quot;))
@@ -925,13 +969,12 @@
 		/**
 		 * set up the form / dialog
 		 */
-		public GpxExportNgForm(boolean hasGarminMap, boolean hasBitmaps, boolean hasGpsbabel) {
+		private GpxExportNgForm(boolean hasGarminMap, boolean hasBitmaps, boolean hasGpsbabel) {
 
 			this.hasBitmapsFrm = hasBitmaps;
 			this.hasGarminMapFrm = hasGarminMap;
 			this.hasGpsbabelFrm = hasGpsbabel;
 
-			// TODO: get/set defaults from profile
 			chosenStyle = Global.getProfile().getGpxStyle();
 			chosenTarget = Global.getProfile().getGpxTarget();
 			chosenIds = Global.getProfile().getGpxId();
@@ -1202,7 +1245,7 @@
 		 * amount of data to be exported
 		 * @return 0 Compact, 1 PQ like, 2 MyFinds
 		 */
-		public int getExportStyle () {
+		private int getExportStyle () {
 			return chosenStyle;
 		}
 
@@ -1210,7 +1253,7 @@
 		 * style of waypoint identifiers
 		 * @return 0 Classic IDs, 1 Smart IDs, 3 Smart Names (should only be used with gpsbabel)
 		 */
-		public int getWpNameStyle() {
+		private int getWpNameStyle() {
 			return chosenIds;
 		}
 
@@ -1218,7 +1261,7 @@
 		 * what kind of output should be generated
 		 * @return 0 single file, 1 separate files, 2 POI (GPI) files
 		 */
-		public int getOutputTarget() {
+		private int getOutputTarget() {
 			return chosenTarget;
 		}
 
@@ -1227,7 +1270,7 @@
 		 *
 		 * @return true for GPSr transfer, false otherwise
 		 */
-		public boolean getSendToGarmin() {
+		private boolean getSendToGarmin() {
 			return cbSendToGarmin.state;
 		}
 
@@ -1236,7 +1279,7 @@
 		 *
 		 * @return true if user wants custom icons, false otherwise
 		 */
-		public boolean getCustomIcons() {
+		private boolean getCustomIcons() {
 			return cbCustomIcons.state;
 		}
 
@@ -1245,7 +1288,7 @@
 		 *
 		 * @return number of logs to export
 		 */
-		public int getMaxLogs() {
+		private int getMaxLogs() {
 			return Convert.parseInt(ibMaxLogs.getText());
 		}
 
@@ -1254,7 +1297,7 @@
 		 *
 		 * @return prefix for separate file export
 		 */
-		public String getPrefix() {
+		private String getPrefix() {
 			return ibPrefix.getText();
 		}
 

Modified: trunk/src/CacheWolf/exp/HTMLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/HTMLExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/HTMLExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -88,7 +88,7 @@
 						Global.getPref().log(&quot;HTMLExport: skipping export of incomplete waypoint &quot;+ch.getWayPoint());
 						continue;
 					}
-					det=ch.getCacheDetails(false,false);
+					det=ch.getCacheDetails(true);
 					varParams = new Hashtable();
 					varParams.put(&quot;TYPE&quot;, CacheType.type2TypeTag(ch.getType())); //&lt;type&gt;
 					varParams.put(&quot;SYM&quot;, CacheType.type2SymTag(ch.getType())); //&lt;sym&gt;

Modified: trunk/src/CacheWolf/exp/KMLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/KMLExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/KMLExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -271,7 +271,7 @@
 
 	public String record(CacheHolder ch, String lat, String lon){
 		StringBuffer strBuf = new StringBuffer(200);
-		CacheHolderDetail det = ch.getExistingDetails();
+		CacheHolderDetail det = ch.getCacheDetails(true);
 
 		strBuf.append(&quot;   &lt;Placemark&gt;\r\n&quot;);
 		if (det.URL != null){

Modified: trunk/src/CacheWolf/exp/LocExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/LocExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/LocExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -57,7 +57,7 @@
 			if ( !Global.getPref().addDetailsToWaypoint ) {
 				strBuf.append( getShortDetails( ch ) );
 			}
-			CacheHolderDetail det = ch.getExistingDetails();
+			CacheHolderDetail det = ch.getCacheDetails(true);
 			if ( (!det.Hints.equals(&quot;null&quot;)) &amp;&amp; (det.Hints.length() &gt; 0) ) {
 				strBuf.append(&quot;:&quot;);
 				strBuf.append( simplifyString(Common.rot13(det.Hints)) );

Modified: trunk/src/CacheWolf/exp/MSARCSVExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/MSARCSVExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/MSARCSVExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -30,7 +30,7 @@
 		str.append(&quot;\&quot;&quot; + CacheSize.cw2ExportString(ch.getCacheSize()) + &quot;\&quot;;&quot;);
 		str.append(&quot;\&quot;&quot; + ch.getWayPoint() + &quot;\&quot;;&quot;);
 		str.append(&quot;\&quot;&quot; + ch.getDateHidden() + &quot;\&quot;;&quot;);
-		str.append(&quot;\&quot;&quot; + ch.getExistingDetails().URL + &quot;\&quot;\r\n&quot;);
+		str.append(&quot;\&quot;&quot; + ch.getCacheDetails(true).URL + &quot;\&quot;\r\n&quot;);
 
 		return str.toString();
 	}

Modified: trunk/src/CacheWolf/exp/SpoilerPOIExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/SpoilerPOIExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/SpoilerPOIExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -59,11 +59,11 @@
 		if (ch.isAddiWpt()) return null;
 		
 		// First check, if there a any pictures in the db for the wpt
-		ch.getCacheDetails(false);
+		ch.getCacheDetails(true);
 		if (! ch.detailsLoaded()) return null;
-		if (ch.details.images.size() == 0) return null;
+		if (ch.getCacheDetails(true).images.size() == 0) return null;
 		
-		images = ch.details.images.getDisplayImages(ch.getWayPoint());
+		images = ch.getCacheDetails(true).images.getDisplayImages(ch.getWayPoint());
 		picCounter = 0;
 		for (int i=0; i &lt; images.size(); i++ ) {
 			filename = images.get(i).getFilename();
@@ -81,8 +81,8 @@
 			strBuf.append(&quot;&lt;wpt lat=\&quot;&quot; + lat + &quot;\&quot; lon=\&quot;&quot; + lon + &quot;\&quot;&gt;\r\n&quot;);
 			strBuf.append(&quot;  &lt;name&gt;Sp &quot; + picCounter + &quot;: &quot; + SafeXML.cleanGPX(ch.cacheName) + &quot;&lt;/name&gt;\r\n&quot;);
 			strBuf.append(&quot;  &lt;cmt&gt;\r\n&quot;);
-			if (ch.details.Hints.length()&gt; 0){
-				strBuf.append(&quot;  Hint: &quot; + SafeXML.cleanGPX(Common.rot13(ch.details.Hints)) + &quot;\r\n&quot;);
+			if (ch.getCacheDetails(true).Hints.length()&gt; 0){
+				strBuf.append(&quot;  Hint: &quot; + SafeXML.cleanGPX(Common.rot13(ch.getCacheDetails(true).Hints)) + &quot;\r\n&quot;);
 			}
 			if (comment != null){
 				strBuf.append(&quot;  Comment: &quot; + SafeXML.cleanGPX(SafeXML.cleanback(comment)) + &quot;\r\n&quot;);

Modified: trunk/src/CacheWolf/exp/TPLExporter.java
===================================================================
--- trunk/src/CacheWolf/exp/TPLExporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/exp/TPLExporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -164,18 +164,14 @@
 	}
 
 	public void doIt(){
-		CacheHolderDetail det;
-		CacheHolder ch;
+
 		ProgressBarForm pbf = new ProgressBarForm();
 		ewe.sys.Handle h = new ewe.sys.Handle();
 		int counter = cacheDB.countVisible();
 		pbf.showMainTask = false;
 		pbf.setTask(h,&quot;Exporting ...&quot;);
 		pbf.exec();
-		// Vm.gc(); // all this doesn't really work :-(
-		// System.runFinalization();
-		// Vm.gc();
-		//Vm.debug(&quot;v: &quot;+Vm.countObjects(true));
+
 		String selbstLaute=&quot;aeiouAEIOU&quot;;
 		StringBuffer lower=new StringBuffer(26);// region/language dependent ?
 		for (int i=97; i&lt;=122; i++ ) {
@@ -183,11 +179,8 @@
 		}
 		String mitLauteKlein=lower.toString();
 		try {
-			Vector cache_index = new Vector(); // declare variables inside try {} -&gt; in case of OutOfMemoryError, they can be garbage collected - anyhow it doesn't work :-(
-			Hashtable varParams;
-			TplFilter myFilter;
+			TplFilter myFilter = new TplFilter();			
 			Hashtable args = new Hashtable();
-			myFilter = new TplFilter();
 			//args.put(&quot;debug&quot;, &quot;true&quot;);
 			args.put(&quot;filename&quot;, tplFile);
 			args.put(&quot;case_sensitive&quot;, &quot;true&quot;);
@@ -202,14 +195,16 @@
 			if(fc.execute() == FormBase.IDCANCEL) return;
 			File saveTo = fc.getChosenFile();
 			pref.setExportPath(expName, saveTo.getPath());
+			
 			Time nowdate = new Time();
 			nowdate = nowdate.setFormat(&quot;yyyy-MM-dd&quot;);
 			Time nowtime = new Time();
 			nowtime = nowtime.setFormat(&quot;HH:mm&quot;);
 
+			Vector cache_index = new Vector(); 			
 			for(int i = 0; i&lt;counter;i++){
-				ch = cacheDB.get(i);
-				det = ch.getExistingDetails();
+				CacheHolder ch = cacheDB.get(i);
+				CacheHolderDetail det = ch.getCacheDetails(true);
 				h.progress = (float)i/(float)counter;
 				h.changed();
 				if(ch.isVisible()){
@@ -217,7 +212,7 @@
 					try {
 						Regex dec = new Regex(&quot;[,.]&quot;,myFilter.decSep);
 						if (myFilter.badChars != null) rex = new Regex(&quot;[&quot;+myFilter.badChars+&quot;]&quot;,&quot;&quot;);
-						varParams = new Hashtable();
+						Hashtable varParams = new Hashtable();
 						varParams.put(&quot;TYPE&quot;, CacheType.type2TypeTag(ch.getType())); //&lt;type&gt;
 						varParams.put(&quot;SYM&quot;, CacheType.type2SymTag(ch.getType())); //&lt;sym&gt;
 						varParams.put(&quot;GSTYPE&quot;, CacheType.type2GSTypeTag(ch.getType())); //&lt;groundspeak:type&gt;

Modified: trunk/src/CacheWolf/imp/GPXImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/GPXImporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/imp/GPXImporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -201,7 +201,7 @@
 		}
 		
 		if (name.equals(&quot;link&quot;)&amp;&amp; inWpt){
-			holder.getFreshDetails().URL = atts.getValue(&quot;href&quot;);
+			holder.getCacheDetails(false).URL = atts.getValue(&quot;href&quot;);
 			return;
 		}
 
@@ -260,8 +260,8 @@
 		}	
 		if (name.equals(&quot;attribute&quot;)) {
 			int id = Integer.parseInt(atts.getValue(&quot;id&quot;));
-			holder.getFreshDetails().attributes.add(id,atts.getValue(&quot;inc&quot;)); // from GC!
-			holder.setAttribsAsBits(holder.getFreshDetails().attributes.getAttribsAsBits());
+			holder.getCacheDetails(false).attributes.add(id,atts.getValue(&quot;inc&quot;)); // from GC!
+			holder.setAttribsAsBits(holder.getCacheDetails(false).attributes.getAttribsAsBits());
 			return;
 		}		
 	}
@@ -289,13 +289,13 @@
 				return;
 			}
 			if (name.equals(&quot;groundspeak:log&quot;) || name.equals(&quot;log&quot;) || name.equals(&quot;terra:log&quot;) ) {
-				holder.getFreshDetails().CacheLogs.add(new Log(logIcon,logDate,logFinder,logData));
+				holder.getCacheDetails(false).CacheLogs.add(new Log(logIcon,logDate,logFinder,logData));
 				if((logIcon.equals(&quot;icon_smile.gif&quot;) || logIcon.equals(&quot;icon_camera.gif&quot;) || logIcon.equals(&quot;icon_attended.gif&quot;)) &amp;&amp; 
 						  (logFinder.equalsIgnoreCase(pref.myAlias) || (pref.myAlias2.length()&gt;0 &amp;&amp; logFinder.equalsIgnoreCase(pref.myAlias2)))) {
 							holder.setCacheStatus(logDate);
 							holder.setFound(true);
-							holder.getFreshDetails().OwnLogId = logId;
-							holder.getFreshDetails().OwnLog = new Log(logIcon,logDate,logFinder,logData);
+							holder.getCacheDetails(false).OwnLogId = logId;
+							holder.getCacheDetails(false).OwnLog = new Log(logIcon,logDate,logFinder,logData);
 				}
 				return;
 			}
@@ -308,7 +308,7 @@
 			//Vm.debug(&quot;here ?!?!?&quot;);
 			//Vm.debug(&quot;could be new!!!!&quot;);
 			if (index == -1){
-				holder.setNoFindLogs(holder.getFreshDetails().CacheLogs.countNotFoundLogs());
+				holder.setNoFindLogs(holder.getCacheDetails(false).CacheLogs.countNotFoundLogs());
 				holder.setNew(true);
 				cacheDB.add(holder);
 				// don't spider additional waypoints, so check
@@ -331,15 +331,15 @@
 							String text;
 							String orig;
 							String imgName;
-							orig = holder.getFreshDetails().LongDescription;
+							orig = holder.getCacheDetails(false).LongDescription;
 							Extractor ex = new Extractor(orig, &quot;&lt;img src=\&quot;&quot;, &quot;&gt;&quot;, 0, false);
 							text = ex.findNext();
 							int num = 0;
 							while(ex.endOfSearch() == false &amp;&amp; spiderOK){
 								//Vm.debug(&quot;Replacing: &quot; + text);
-								if (num &gt;= holder.getFreshDetails().images.size())break;
-								imgName = holder.getFreshDetails().images.get(num).getTitle();
-								holder.getFreshDetails().LongDescription = replace(holder.getFreshDetails().LongDescription, text, &quot;[[Image: &quot; + imgName + &quot;]]&quot;);
+								if (num &gt;= holder.getCacheDetails(false).images.size())break;
+								imgName = holder.getCacheDetails(false).images.get(num).getTitle();
+								holder.getCacheDetails(false).LongDescription = replace(holder.getCacheDetails(false).LongDescription, text, &quot;[[Image: &quot; + imgName + &quot;]]&quot;);
 								num++;
 								text = ex.findNext();
 							}
@@ -354,7 +354,7 @@
 				CacheHolder oldCh= cacheDB.get(index);
 				// Preserve images: Copy images from old cache version because here we didn't add
 				// any image information to the holder object.
-				holder.getFreshDetails().images = oldCh.getExistingDetails().images;
+				holder.getCacheDetails(false).images = oldCh.getCacheDetails(true).images;
 				oldCh.update(holder);
 				oldCh.save();
 			}
@@ -374,7 +374,7 @@
 
 		if (name.equals(&quot;groundspeak:name&quot;)&amp;&amp; inBug) {
 			Travelbug tb=new Travelbug(strData);
-			holder.getFreshDetails().Travelbugs.add(tb);
+			holder.getCacheDetails(false).Travelbugs.add(tb);
 			holder.setHas_bugs(true);
 			return;
 		}
@@ -419,13 +419,13 @@
 			return;
 		}
 		if (name.equals(&quot;url&quot;)&amp;&amp; inWpt){
-			holder.getFreshDetails().URL = strData;
+			holder.getCacheDetails(false).URL = strData;
 			return;
 		}
 		
 		// Text for additional waypoints, no HTML
 		if (name.equals(&quot;cmt&quot;)&amp;&amp; inWpt){
-			holder.getFreshDetails().LongDescription = strData;
+			holder.getCacheDetails(false).LongDescription = strData;
 			holder.setHTML(false);
 			return;
 		}
@@ -470,11 +470,11 @@
 			return;
 		}
 		if (name.equals(&quot;groundspeak:country&quot;)|| name.equals(&quot;country&quot;)){
-			holder.getFreshDetails().Country = strData;
+			holder.getCacheDetails(false).Country = strData;
 			return;
 		}
 		if (name.equals(&quot;groundspeak:state&quot;)|| name.equals(&quot;state&quot;)){
-			holder.getFreshDetails().State = strData;
+			holder.getCacheDetails(false).State = strData;
 			return;
 		}
 		if (name.equals(&quot;terra:size&quot;)){
@@ -482,25 +482,25 @@
 		}
 
 		if (name.equals(&quot;groundspeak:short_description&quot;)|| name.equals(&quot;summary&quot;)) {
-			if (holder.is_HTML())	holder.getFreshDetails().LongDescription =SafeXML.cleanback(strData)+&quot;&lt;br&gt;&quot;; // &lt;br&gt; needed because we also use a &lt;br&gt; in SpiderGC. Without it the comparison in ch.update fails
-			else holder.getFreshDetails().LongDescription =strData+&quot;\n&quot;;
+			if (holder.is_HTML())	holder.getCacheDetails(false).LongDescription =SafeXML.cleanback(strData)+&quot;&lt;br&gt;&quot;; // &lt;br&gt; needed because we also use a &lt;br&gt; in SpiderGC. Without it the comparison in ch.update fails
+			else holder.getCacheDetails(false).LongDescription =strData+&quot;\n&quot;;
 			return;
 		}
 
 		if (name.equals(&quot;groundspeak:long_description&quot;)|| name.equals(&quot;description&quot;)|| name.equals(&quot;terra:description&quot;)) {
-			if (holder.is_HTML())	holder.getFreshDetails().LongDescription +=SafeXML.cleanback(strData);
-			else holder.getFreshDetails().LongDescription +=strData;
+			if (holder.is_HTML())	holder.getCacheDetails(false).LongDescription +=SafeXML.cleanback(strData);
+			else holder.getCacheDetails(false).LongDescription +=strData;
 			return;
 		}
 		if (name.equals(&quot;groundspeak:encoded_hints&quot;) || name.equals(&quot;hints&quot;)) {
-			holder.getFreshDetails().Hints = Common.rot13(strData);
+			holder.getCacheDetails(false).Hints = Common.rot13(strData);
 			return;
 		}
 		
 		if (name.equals(&quot;terra:hint&quot;)) {
 			// remove &quot;&lt;br&gt;&lt;br&gt;&quot; from the end
 			int indexTrash = strData.indexOf(&quot;&lt;br&gt;&lt;br&gt;&quot;);
-			if (indexTrash &gt; 0)	holder.getFreshDetails().Hints = Common.rot13(strData.substring(0,indexTrash));
+			if (indexTrash &gt; 0)	holder.getCacheDetails(false).Hints = Common.rot13(strData.substring(0,indexTrash));
 			return;
 		}
 
@@ -574,15 +574,15 @@
 		if (imgSpider == null) imgSpider = new SpiderGC(pref, profile, false);
 		
 		if (fromTC) {
-				imgSpider.getImages(holder.getFreshDetails().LongDescription, holder.getFreshDetails());
+				imgSpider.getImages(holder.getCacheDetails(false).LongDescription, holder.getCacheDetails(false));
 		}
 		else {
 			addr = &quot;<A HREF="http://www.geocaching.com/seek/cache_details.aspx?wp=">http://www.geocaching.com/seek/cache_details.aspx?wp=</A>&quot; + holder.getWayPoint() ;
 			//Vm.debug(addr + &quot;|&quot;);
 			cacheText = SpiderGC.fetch(addr);
-			imgSpider.getImages(cacheText, holder.getFreshDetails());
+			imgSpider.getImages(cacheText, holder.getCacheDetails(false));
 			try {
-				imgSpider.getAttributes(cacheText, holder.getFreshDetails());
+				imgSpider.getAttributes(cacheText, holder.getCacheDetails(false));
 			} catch (Exception e) {
 				if (Global.getPref().debug) Global.getPref().log(&quot;unable to fetch attrivbutes for&quot;+holder.getWayPoint(), e);
 			}

Modified: trunk/src/CacheWolf/imp/LOCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/LOCXMLImporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/imp/LOCXMLImporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -121,7 +121,7 @@
 		}
 
 		if (name.equals(&quot;link&quot;)) {
-			holder.getFreshDetails().URL = strData;
+			holder.getCacheDetails(false).URL = strData;
 			return;
 		}
 	}

Modified: trunk/src/CacheWolf/imp/OCXMLImporter.java
===================================================================
--- trunk/src/CacheWolf/imp/OCXMLImporter.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/imp/OCXMLImporter.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -380,7 +380,7 @@
 		}
 		if(name.equals(&quot;type&quot;)){
 			holder.setType(CacheType.ocType2CwType(atts.getValue(&quot;id&quot;)));
-			holder.getFreshDetails().attributes.clear();
+			holder.getCacheDetails(false).attributes.clear();
 			return;
 		}
 		if(name.equals(&quot;status&quot;)){
@@ -415,8 +415,8 @@
 		
 		if (name.equals(&quot;attribute&quot;)) {
 			int id = Integer.parseInt(atts.getValue(&quot;id&quot;));
-			holder.getFreshDetails().attributes.add(id);
-			holder.setAttribsAsBits(holder.getFreshDetails().attributes.getAttribsAsBits());
+			holder.getCacheDetails(false).attributes.add(id);
+			holder.setAttribsAsBits(holder.getCacheDetails(false).attributes.getAttribsAsBits());
 			return;
 		}
 
@@ -488,12 +488,12 @@
 			}
 			// clear data (picture, logs) if we do a complete Update
 			if (incUpdate == false){
-				holder.getFreshDetails().CacheLogs.clear();
-				holder.getFreshDetails().images.clear();
+				holder.getCacheDetails(false).CacheLogs.clear();
+				holder.getCacheDetails(false).images.clear();
 			}
 
 			// save all
-			holder.getFreshDetails().hasUnsavedChanges = true; // this makes CachHolder save the details in case that they are unloaded from memory
+			holder.getCacheDetails(false).hasUnsavedChanges = true; // this makes CachHolder save the details in case that they are unloaded from memory
 			// chD.saveCacheDetails(profile.dataDir);
 			// profile.saveIndex(pref,Profile.NO_SHOW_PROGRESS_BAR); // this is done after .xml is completly processed
 			return;
@@ -502,7 +502,7 @@
 			holder = getHolder(strData); // Allocate a new CacheHolder object
 			holder.setOcCacheID(strData);
 			String ocSeekUrl = new String(&quot;<A HREF="http://">http://</A>&quot; + hostname + &quot;/viewcache.php?cacheid=&quot;);
-			holder.getFreshDetails().URL = ocSeekUrl + cacheID;
+			holder.getCacheDetails(false).URL = ocSeekUrl + cacheID;
 			return;
 		}
 
@@ -538,7 +538,7 @@
 			return;
 		}
 		if (name.equals(&quot;country&quot;)){
-			holder.getFreshDetails().Country = strData;
+			holder.getCacheDetails(false).Country = strData;
 			return;
 		}
 	}
@@ -553,7 +553,7 @@
 				imgRegexUrl.setIgnoreCase(true);
 				int descIndex=0;
 				int numDownloaded=1;
-				while (imgRegexUrl.searchFrom(holder.getFreshDetails().LongDescription, descIndex)) { // &quot;img&quot; found
+				while (imgRegexUrl.searchFrom(holder.getCacheDetails(false).LongDescription, descIndex)) { // &quot;img&quot; found
 					imgTag=imgRegexUrl.stringMatched(1); // (1) enthlt das gesamte &lt;img ...&gt;-tag
 					fetchUrl=imgRegexUrl.stringMatched(2); // URL in Anfhrungszeichen in (2) falls ohne in (3) Ergebnis ist auf jeden Fall ohne Anfhrungszeichen
 					if (fetchUrl==null) { fetchUrl=imgRegexUrl.stringMatched(3); }
@@ -575,7 +575,7 @@
 					getPic(fetchUrl, imgAltText);
 				}
 			}
-			holder.getFreshDetails().hasUnsavedChanges = true;
+			holder.getCacheDetails(false).hasUnsavedChanges = true;
 			return;
 		}
 
@@ -592,17 +592,17 @@
 			if (holder.is_HTML())	linebraek = &quot;&lt;br&gt;\n&quot;;
 			else 					linebraek = &quot;\n&quot;;
 
-			holder.getFreshDetails().LongDescription =              processingDescLang + &quot;:&quot; +  linebraek + strData;
+			holder.getCacheDetails(false).LongDescription =              processingDescLang + &quot;:&quot; +  linebraek + strData;
 			return;
 		}
 
 		if (name.equals(&quot;desc&quot;)){ // &lt;/desc&gt;
-			if (holder.is_HTML())	holder.getFreshDetails().LongDescription +=SafeXML.cleanback(strData);
-			else holder.getFreshDetails().LongDescription +=strData;
+			if (holder.is_HTML())	holder.getCacheDetails(false).LongDescription +=SafeXML.cleanback(strData);
+			else holder.getCacheDetails(false).LongDescription +=strData;
 			return;
 		}
 		if (name.equals(&quot;hint&quot;)){
-			holder.getFreshDetails().Hints = Common.rot13(strData);
+			holder.getCacheDetails(false).Hints = Common.rot13(strData);
 			holder.setUpdated(true); // remark: this is used in &quot;shortdesc&quot; to decide weather the description should be appended or replaced
 			return;
 		}
@@ -623,7 +623,7 @@
 			ImageInfo imageInfo = new ImageInfo();
 			// add title
 			imageInfo.setTitle(picDesc);
-			holder.getFreshDetails().images.add(imageInfo);
+			holder.getCacheDetails(false).images.add(imageInfo);
 			try {
 				File ftest = new FileBugfix(profile.dataDir + fileName);
 				if (ftest.exists()){
@@ -688,21 +688,21 @@
 		if(name.equals(&quot;picture&quot;)){
 			//String fileName = holder.wayPoint + &quot;_&quot; + picUrl.substring(picUrl.lastIndexOf(&quot;/&quot;)+1);
 			getPic(picUrl,picTitle);
-			holder.getFreshDetails().hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
+			holder.getCacheDetails(false).hasUnsavedChanges = true; //saveCacheDetails(profile.dataDir);
 			return;
 		}
 	}
 
 	private void endCacheLog(String name){
 		if (name.equals(&quot;cachelog&quot;)){ // &lt;/cachelog&gt;
-			holder.getFreshDetails().CacheLogs.merge(new Log(logIcon, logDate, logFinder, logData, loggerRecommended));
+			holder.getCacheDetails(false).CacheLogs.merge(new Log(logIcon, logDate, logFinder, logData, loggerRecommended));
 			if((logFinder.toLowerCase().compareTo(user) == 0 || logFinder.equalsIgnoreCase(pref.myAlias2)) &amp;&amp; logtype == 1) {
 						holder.setCacheStatus(logDate);
 						holder.setFound(true);
-						holder.getFreshDetails().OwnLogId = logId;
-						holder.getFreshDetails().OwnLog = new Log(logIcon, logDate, logFinder, logData, loggerRecommended);
+						holder.getCacheDetails(false).OwnLogId = logId;
+						holder.getCacheDetails(false).OwnLog = new Log(logIcon, logDate, logFinder, logData, loggerRecommended);
 			}
-			holder.getFreshDetails().hasUnsavedChanges = true; //chD.saveCacheDetails(profile.dataDir);
+			holder.getCacheDetails(false).hasUnsavedChanges = true; //chD.saveCacheDetails(profile.dataDir);
 			return;
 		}
 

Modified: trunk/src/CacheWolf/imp/SpiderGC.java
===================================================================
--- trunk/src/CacheWolf/imp/SpiderGC.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/imp/SpiderGC.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -525,10 +525,10 @@
 				ch.setNumRecommended(cacheInDB.getNumRecommended());
 				if (pref.downloadPics) {
 					// delete obsolete images when we have current set
-					CacheImages.cleanupOldImages(cacheInDB.getExistingDetails().images, ch.getFreshDetails().images);
+					CacheImages.cleanupOldImages(cacheInDB.getCacheDetails(true).images, ch.getCacheDetails(false).images);
 				} else {
 					// preserve images if not downloaded
-					ch.getFreshDetails().images = cacheInDB.getExistingDetails().images;
+					ch.getCacheDetails(false).images = cacheInDB.getCacheDetails(true).images;
 				}
 				cacheInDB.update(ch);
 				cacheInDB.save();
@@ -847,7 +847,7 @@
 		boolean save = false;
 		boolean is_archived_GC=false;
 		boolean is_found_GC=false;
-		CacheHolderDetail chd = ch.getFreshDetails();
+		CacheHolderDetail chd = ch.getCacheDetails(false);
 		if (spiderAllFinds) {
 			if(!ch.is_found()) { ch.setFound(true); save=true; numFoundUpdates+=1; ret=true;}
 			is_archived_GC=CacheDescription.indexOf(propArchived)!=-1;
@@ -1018,7 +1018,7 @@
 		if(!pref.checkLog) return false;
 		// String[] CacheDesc=mString.split(cacheDescrition,'\n');
 		Time lastLogCW = new Time();
-		String slastLogCW=ch.details.CacheLogs.getLog(0).getDate();
+		String slastLogCW=ch.getCacheDetails(true).CacheLogs.getLog(0).getDate();
 		if (slastLogCW.equals(&quot;&quot;)) return true; // or check cacheDescGC also no log?
 		lastLogCW.parse(slastLogCW,&quot;yyyy-MM-dd&quot;);
 
@@ -1134,14 +1134,14 @@
 						// int logsz = chD.CacheLogs.size();
 						//chD.CacheLogs.clear();
 						ch.addiWpts.clear();
-						ch.getFreshDetails().images.clear();
+						ch.getCacheDetails(false).images.clear();
 
 						ch.setAvailable(!(completeWebPage.indexOf(p.getProp(&quot;cacheUnavailable&quot;)) &gt;= 0));
 						ch.setArchived(completeWebPage.indexOf(p.getProp(&quot;cacheArchived&quot;)) &gt;= 0);
 						//==========
 						// Logs first (for check early for break)
 						//==========
-						ch.getFreshDetails().setCacheLogs(getLogs(completeWebPage, ch.getFreshDetails()));
+						ch.getCacheDetails(false).setCacheLogs(getLogs(completeWebPage, ch.getCacheDetails(false)));
 						pref.log(&quot;Got logs&quot;);
 						// If the switch is set to not store found caches and we found the cache =&gt; return
 						if (ch.is_found() &amp;&amp; doNotGetFound) {
@@ -1157,7 +1157,7 @@
 						ch.setLatLon(latLon);
 						pref.log(&quot;LatLon: &quot; + ch.LatLon);
 
-						ch.getFreshDetails().setLongDescription(getLongDesc(completeWebPage));
+						ch.getCacheDetails(false).setLongDescription(getLongDesc(completeWebPage));
 						pref.log(&quot;Got description&quot;);
 
 						ch.setCacheName(SafeXML.cleanback(getName(completeWebPage)));
@@ -1167,16 +1167,16 @@
 						if (location.length() != 0) {
 							int countryStart = location.indexOf(&quot;,&quot;);
 							if (countryStart &gt; -1) {
-								ch.getFreshDetails().Country = SafeXML.cleanback(location.substring(countryStart + 1).trim());
-								ch.getFreshDetails().State = SafeXML.cleanback(location.substring(0, countryStart).trim());
+								ch.getCacheDetails(false).Country = SafeXML.cleanback(location.substring(countryStart + 1).trim());
+								ch.getCacheDetails(false).State = SafeXML.cleanback(location.substring(0, countryStart).trim());
 							} else {
-								ch.getFreshDetails().Country = location.trim();
-								ch.getFreshDetails().State = &quot;&quot;;
+								ch.getCacheDetails(false).Country = location.trim();
+								ch.getCacheDetails(false).State = &quot;&quot;;
 							}
 							pref.log(&quot;Got location (country/state)&quot;);
 						} else {
-							ch.getFreshDetails().Country = &quot;&quot;;
-							ch.getFreshDetails().State = &quot;&quot;;
+							ch.getCacheDetails(false).Country = &quot;&quot;;
+							ch.getCacheDetails(false).State = &quot;&quot;;
 							pref.log(&quot;No location (country/state) found&quot;);
 						}
 
@@ -1187,8 +1187,8 @@
 						ch.setDateHidden(DateFormat.MDY2YMD(getDateHidden(completeWebPage)));
 						pref.log(&quot;Hidden: &quot; + ch.getDateHidden());
 
-						ch.getFreshDetails().setHints(getHints(completeWebPage));
-						pref.log(&quot;Hints: &quot; + ch.getFreshDetails().Hints);
+						ch.getCacheDetails(false).setHints(getHints(completeWebPage));
+						pref.log(&quot;Hints: &quot; + ch.getCacheDetails(false).Hints);
 
 						ch.setCacheSize(CacheSize.gcSpiderString2Cw(getSize(completeWebPage)));
 						pref.log(&quot;Size: &quot; + ch.getCacheSize());
@@ -1204,14 +1204,14 @@
 						//==========
 						// Bugs
 						//==========
-						if (fetchTBs) getBugs(ch.getFreshDetails(),completeWebPage);
-						ch.setHas_bugs(ch.getFreshDetails().Travelbugs.size()&gt;0);
+						if (fetchTBs) getBugs(ch.getCacheDetails(false),completeWebPage);
+						ch.setHas_bugs(ch.getCacheDetails(false).Travelbugs.size()&gt;0);
 						pref.log(&quot;Got TBs&quot;);
 						//==========
 						// Images
 						//==========
 						if(fetchImages){
-							getImages(completeWebPage, ch.getFreshDetails());
+							getImages(completeWebPage, ch.getCacheDetails(false));
 							pref.log(&quot;Got images&quot;);
 						}
 						//==========
@@ -1222,7 +1222,7 @@
 						//==========
 						// Attributes
 						//==========
-						getAttributes(completeWebPage, ch.getFreshDetails());
+						getAttributes(completeWebPage, ch.getCacheDetails(false));
 						pref.log(&quot;Got attributes&quot;);
 						//==========
 						// Last sync date
@@ -1526,7 +1526,7 @@
 		// First: Get current image object of waypoint before spidering images.
 		CacheHolder oldCh = Global.getProfile().cacheDB.get(chD.getParent().getWayPoint());
 		if (oldCh != null) {
-			lastImages = oldCh.getFreshDetails().images;
+			lastImages = oldCh.getCacheDetails(false).images;
 		}
 
 		//========
@@ -1795,7 +1795,7 @@
 					// Creating new CacheHolder, but accessing old cache.xml file
 					hd=new CacheHolder();
 					hd.setWayPoint(adWayPoint);
-					hd.getExistingDetails(); // Accessing Details reads file if not yet done
+					hd.getCacheDetails(true); // Accessing Details reads file if not yet done
 				} else {
 					hd=new CacheHolder();
 					hd.setWayPoint(adWayPoint);
@@ -1809,7 +1809,7 @@
 				if(typeRex.didMatch()) hd.setType(CacheType.gpxType2CwType(&quot;Waypoint|&quot;+typeRex.stringMatched(1)));
 				rowBlock = exRowBlock.findNext();
 				descRex.search(rowBlock);
-				hd.getFreshDetails().setLongDescription(descRex.stringMatched(1));
+				hd.getCacheDetails(false).setLongDescription(descRex.stringMatched(1));
 				hd.setFound(is_found);
 				hd.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
 				hd.setHard(CacheTerrDiff.CW_DT_UNSET);

Modified: trunk/src/CacheWolf/myTableControl.java
===================================================================
--- trunk/src/CacheWolf/myTableControl.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/myTableControl.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -268,7 +268,7 @@
 
 		if (selectedItem == miOpenOnline){
 				ch = cacheDB.get(tbp.getSelectedCache());
-				CacheHolderDetail chD=ch.getCacheDetails(false, true);
+				CacheHolderDetail chD=ch.getCacheDetails(true);
 				if (chD != null) { callExternalProgram(pref.browser, chD.URL); }
 		} else
 
@@ -296,7 +296,7 @@
 					mainCache = ch.mainCache;
 				}
 				if (mainCache.isCacheWpt()) {
-					CacheHolderDetail chD=mainCache.getCacheDetails(false, true);
+					CacheHolderDetail chD=mainCache.getCacheDetails(true);
 						if (chD != null) {
 							String URL = &quot;&quot;;
 							if (ch.isOC()) {

Modified: trunk/src/CacheWolf/navi/MovingMap.java
===================================================================
--- trunk/src/CacheWolf/navi/MovingMap.java	2010-03-10 21:16:45 UTC (rev 2516)
+++ trunk/src/CacheWolf/navi/MovingMap.java	2010-03-16 16:23:55 UTC (rev 2517)
@@ -2125,58 +2125,64 @@
 	}
 
 	public void onPenEvent(PenEvent ev) {
-		if (!mm.zoomingMode &amp;&amp; ev.type == PenEvent.PEN_DOWN) {
-			saveMapLoc = new Point (ev.x, ev.y);
-		}
-		if (mm.zoomingMode &amp;&amp; ev.type == PenEvent.PEN_DOWN) {
-			saveGpsIgnoreStatus = mm.dontUpdatePos;
-			mm.dontUpdatePos = true;
-			saveMapLoc = new Point (ev.x, ev.y);
-			paintingZoomArea = true;
-			mm.zoomingMode = true;
-		}		
-		if (!mm.zoomingMode &amp;&amp; ev.type == PenEvent.PEN_DOWN &amp;&amp; ev.modifiers == PenEvent.RIGHT_BUTTON) {
-			// context penHeld is fired on PDA but not on PC (Java)
-			penHeld(new Point (ev.x, ev.y));
-		}		
-		if (mm.zoomingMode &amp;&amp; ev.type == PenEvent.PEN_UP ) {
-			paintingZoomArea = false;
-			mm.zoomingMode = false;
-			mm.getControlsLayer().changeRoleState(&quot;zoom_manually&quot;, false);
-			mm.dontUpdatePos = saveGpsIgnoreStatus;
-			if (java.lang.Math.abs(lastZoomWidth) &lt; 15 || java.lang.Math.abs(lastZoomHeight) &lt; 15)  {
-				repaintNow();
-				return; // dont make to big zoom jumps - it is most probable not an intentional zoom
-			}
-			mm.zoomScreenRect(saveMapLoc, lastZoomWidth, lastZoomHeight);
-		}
-
-		if (mm.zoomingMode &amp;&amp; paintingZoomArea &amp;&amp; (ev.type == PenEvent.PEN_MOVED_ON || ev.type == PenEvent.PEN_MOVE || ev.type == PenEvent.PEN_DRAG)) {
-			int left, top;
-			Graphics dr = this.getGraphics();
-			if (lastZoomWidth &lt; 0)left = saveMapLoc.x + lastZoomWidth;
-			else left = saveMapLoc.x;
-			if (lastZoomHeight &lt; 0)top = saveMapLoc.y + lastZoomHeight;
-			else top = saveMapLoc.y;
-			left -= 2;
-			top -= 2;
-			if (top &lt; 0) top = 0;
-			if (left &lt; 0) left = 0;
-			this.repaintNow(dr, new Rect(left, top, java.lang.Math.abs(lastZoomWidth)+4, java.lang.Math.abs(lastZoomHeight)+4));
-			lastZoomWidth = ev.x - saveMapLoc.x;
-			lastZoomHeight =  ev.y - saveMapLoc.y;
-			if (lastZoomWidth &lt; 0) left = saveMapLoc.x + lastZoomWidth;
-			else left = saveMapLoc.x;
-			if (lastZoomHeight &lt; 0)top = saveMapLoc.y + lastZoomHeight;
-			else top = saveMapLoc.y;
-			dr.setPen(new Pen(new Color(255,0,0),Pen.SOLID,3));
-			dr.drawRect(left, top, java.lang.Math.abs(lastZoomWidth), java.lang.Math.abs(lastZoomHeight), 0); // bug in ewe: thickness parameter is ignored
-		}
 		if (ignoreNextDrag) {
 			// On PDA next event after a Kontext ist a drag, that will move the map unwanted
 			ignoreNextDrag=false;
 			if (ev.type == PenEvent.PEN_DRAG) return; // ignoring now
 		}
+		if (ev.type == PenEvent.PEN_DOWN) {
+			if (mm.zoomingMode) {
+				saveGpsIgnoreStatus = mm.dontUpdatePos;
+				mm.dontUpdatePos = true;
+				saveMapLoc = new Point (ev.x, ev.y);
+				paintingZoomArea = true;
+				mm.zoomingMode = true;
+			}
+			else {
+				saveMapLoc = new Point (ev.x, ev.y);
+				if (ev.modifiers == PenEvent.RIGHT_BUTTON) {
+					// context penHeld is fired on PDA but not on PC (Java)
+					penHeld(new Point (ev.x, ev.y));
+				}
+			}
+		}
+		else {
+			if (mm.zoomingMode) {
+				if ( ev.type == PenEvent.PEN_UP ) {
+					paintingZoomArea = false;
+					mm.zoomingMode = false;
+					mm.getControlsLayer().changeRoleState(&quot;zoom_manually&quot;, false);
+					mm.dontUpdatePos = saveGpsIgnoreStatus;
+					if (java.lang.Math.abs(lastZoomWidth) &lt; 15 || java.lang.Math.abs(lastZoomHeight) &lt; 15)  {
+						repaintNow();
+						return; // dont make to big zoom jumps - it is most probable not an intentional zoom
+					}
+					mm.zoomScreenRect(saveMapLoc, lastZoomWidth, lastZoomHeight);
+				}
+				if (paintingZoomArea &amp;&amp; 
+					(ev.type == PenEvent.PEN_MOVED_ON || ev.type == PenEvent.PEN_MOVE || ev.type == PenEvent.PEN_DRAG)) {
+					int left, top;
+					Graphics dr = this.getGraphics();
+					if (lastZoomWidth &lt; 0)left = saveMapLoc.x + lastZoomWidth;
+					else left = saveMapLoc.x;
+					if (lastZoomHeight &lt; 0)top = saveMapLoc.y + lastZoomHeight;
+					else top = saveMapLoc.y;
+					left -= 2;
+					top -= 2;
+					if (top &lt; 0) top = 0;
+					if (left &lt; 0) left = 0;
+					this.repaintNow(dr, new Rect(left, top, java.lang.Math.abs(lastZoomWidth)+4, java.lang.Math.abs(lastZoomHeight)+4));
+					lastZoomWidth = ev.x - saveMapLoc.x;
+					lastZoomHeight =  ev.y - saveMapLoc.y;
+					if (lastZoomWidth &lt; 0) left = saveMapLoc.x + lastZoomWidth;
+					else left = saveMapLoc.x;
+					if (lastZoomHeight &lt; 0)top = saveMapLoc.y + lastZoomHeight;
+					else top = saveMapLoc.y;
+					dr.setPen(new Pen(new Color(255,0,0),Pen.SOLID,3));
+					dr.drawRect(left, top, java.lang.Math.abs(lastZoomWidth), java.lang.Math.abs(lastZoomHeight), 0); // bug in ewe: thickness parameter is ignored
+				}
+			}
+		}
 		super.onPenEvent(ev);
 	}
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002441.html">[Cachewolf-svn] r2516 - in trunk/src/CacheWolf: . navi
</A></li>
	<LI>Next message: <A HREF="002443.html">[Cachewolf-svn] r2518 - in trunk/src/CacheWolf: . exp imp navi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2442">[ date ]</a>
              <a href="thread.html#2442">[ thread ]</a>
              <a href="subject.html#2442">[ subject ]</a>
              <a href="author.html#2442">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
