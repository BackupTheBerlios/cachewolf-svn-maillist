<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cachewolf-svn] r2539 - in trunk: res_noewe/languages src/CacheWolf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cachewolf-svn/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2539%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf&In-Reply-To=%3C201004101042.o3AAg9kI023881%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002465.html">
   <LINK REL="Next"  HREF="002467.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cachewolf-svn] r2539 - in trunk: res_noewe/languages src/CacheWolf</H1>
    <B>salzkammergut at mail.berlios.de</B> 
    <A HREF="mailto:cachewolf-svn%40lists.berlios.de?Subject=Re%3A%20%5BCachewolf-svn%5D%20r2539%20-%20in%20trunk%3A%20res_noewe/languages%20src/CacheWolf&In-Reply-To=%3C201004101042.o3AAg9kI023881%40sheep.berlios.de%3E"
       TITLE="[Cachewolf-svn] r2539 - in trunk: res_noewe/languages src/CacheWolf">salzkammergut at mail.berlios.de
       </A><BR>
    <I>Sat Apr 10 12:42:09 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002465.html">[Cachewolf-svn] r2538 - trunk/src/CacheWolf
</A></li>
        <LI>Next message: <A HREF="002467.html">[Cachewolf-svn] r2540 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2466">[ date ]</a>
              <a href="thread.html#2466">[ thread ]</a>
              <a href="subject.html#2466">[ subject ]</a>
              <a href="author.html#2466">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: salzkammergut
Date: 2010-04-10 12:42:04 +0200 (Sat, 10 Apr 2010)
New Revision: 2539

Modified:
   trunk/res_noewe/languages/DE.cfg
   trunk/res_noewe/languages/EN.cfg
   trunk/res_noewe/languages/FR.cfg
   trunk/res_noewe/languages/NL.cfg
   trunk/res_noewe/languages/PL.cfg
   trunk/res_noewe/languages/SV.cfg
   trunk/src/CacheWolf/DetailsPanel.java
Log:
Bugfix and enhancement of Rev 2448: Not Found with date
A date for DNFs can now be set in two ways: By exiting the DT Dialog with x (if status is empty) (as implemented in rev 2448) or by presetting status to DNF and then calling the DT dialog and exiting it properly.

Modified: trunk/res_noewe/languages/DE.cfg
===================================================================
--- trunk/res_noewe/languages/DE.cfg	2010-04-09 18:29:25 UTC (rev 2538)
+++ trunk/res_noewe/languages/DE.cfg	2010-04-10 10:42:04 UTC (rev 2539)
@@ -177,6 +177,7 @@
 		327=Information
 		328=Gefunden am
 		329=Versteckt am
+		330=Nicht gefunden am
 		340=Cachebilder:
 		341=Eigene Bilder:
 		342=Gel%f6scht

Modified: trunk/res_noewe/languages/EN.cfg
===================================================================
--- trunk/res_noewe/languages/EN.cfg	2010-04-09 18:29:25 UTC (rev 2538)
+++ trunk/res_noewe/languages/EN.cfg	2010-04-10 10:42:04 UTC (rev 2539)
@@ -177,6 +177,7 @@
 		327=Information
 		328=Date found
 		329=Hidden on
+		330=Date not found
 		340=Cache Images:
 		341=User Images:
 		342=Deleted

Modified: trunk/res_noewe/languages/FR.cfg
===================================================================
--- trunk/res_noewe/languages/FR.cfg	2010-04-09 18:29:25 UTC (rev 2538)
+++ trunk/res_noewe/languages/FR.cfg	2010-04-10 10:42:04 UTC (rev 2539)
@@ -177,6 +177,7 @@
 		327=Information
 		328=Trouv%e9e le
 		329=Cach%e9e le
+		328=Pas trouv%e9e le
 		340=Images de cache:
 		341=Propre images:
 		342=Effac%e9

Modified: trunk/res_noewe/languages/NL.cfg
===================================================================
--- trunk/res_noewe/languages/NL.cfg	2010-04-09 18:29:25 UTC (rev 2538)
+++ trunk/res_noewe/languages/NL.cfg	2010-04-10 10:42:04 UTC (rev 2539)
@@ -176,6 +176,7 @@
 		327=Notities
 		328=Gegevens gevonden
 		329=Verborgen op
+		330=Gegevens niet gevonden
 		340=Cache afbeeldingen
 		341=Eigen afbeeldingen
 		342=Verwijderd

Modified: trunk/res_noewe/languages/PL.cfg
===================================================================
--- trunk/res_noewe/languages/PL.cfg	2010-04-09 18:29:25 UTC (rev 2538)
+++ trunk/res_noewe/languages/PL.cfg	2010-04-10 10:42:04 UTC (rev 2539)
@@ -177,6 +177,7 @@
                 327=Informacje
                 328=Data znalezienia
                 329=Ukryta
+                330=Data nie znalezienia
                 340=Obrazki skrzynki:
                 341=Obrazki uzytkownika:
                 342=usuniete

Modified: trunk/res_noewe/languages/SV.cfg
===================================================================
--- trunk/res_noewe/languages/SV.cfg	2010-04-09 18:29:25 UTC (rev 2538)
+++ trunk/res_noewe/languages/SV.cfg	2010-04-10 10:42:04 UTC (rev 2539)
@@ -177,6 +177,7 @@
         	327=Information
         	328=Datum hittades
         	329=Dold p%e5
+        	330=Datum hittades inte
         	340=Cache Bilder:
         	341=User Bilder:
         	342=bort
@@ -991,4 +992,3 @@
 		{..}
 	{..}
 {..}
-        	
\ No newline at end of file

Modified: trunk/src/CacheWolf/DetailsPanel.java
===================================================================
--- trunk/src/CacheWolf/DetailsPanel.java	2010-04-09 18:29:25 UTC (rev 2538)
+++ trunk/src/CacheWolf/DetailsPanel.java	2010-04-10 10:42:04 UTC (rev 2539)
@@ -445,281 +445,294 @@
 		}
 	}
 
-	/**
-	 * Method to react to a user input.
-	 */
-	public void onEvent(final Event ev) {
-		if (ev instanceof DataChangeEvent) {
-			if (ev.target == inpWaypoint) {
-				if (evWaypointChanged) {
-					String iTmp=inpWaypoint.getText();
-					String uTmp=iTmp.toUpperCase();
-					if (!iTmp.equals(uTmp)){
-						inpWaypoint.setText(uTmp); // If user entered LowerCase -&gt; convert directly to UpperCase
-						evWaypointChanged=false; //next DataChangeEvent fired by change to UpperCase will be ignored
-					}
-					// already warned(multi same DataChangeEvents) or same waypointname as before edit !!!
-					if(!warnedForWaypoint.equals(uTmp) &amp;&amp; !uTmp.equals(this.cache.getWayPoint())){
-						if ((new File(profile.dataDir + iTmp.toLowerCase()+&quot;.xml&quot;)).exists()) {
-							warnedForWaypoint=uTmp; // before MessageBox cause Multithread DataChangeEvents
-							// filename is LowerCase
-							new MessageBox(&quot;Warning :&quot;,uTmp+&quot;\n&quot;+MyLocale.getMsg(275,&quot;Waypoint already exists!&quot;),MessageBox.OKB).execute();
-							// revert waypointname
-							inpWaypoint.setText(this.cache.getWayPoint());
-						}
-					}
-				}
-				else {
-					// first DataChangeEvent is fired by Klick into (after reload). 
-					// that really didn't change anything
-					evWaypointChanged=true;
-				}
-				// FIXME: if name was changed, we should rename the waypoint.xml file. how? where?
-			} else if (ev.target == chcType) {
-				createWptName();
-				if (CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.selectedIndex))) {
-					activateControl(btnTerr);
-					activateControl(btnDiff);
-					activateControl(chcSize);
-					activateControl(inpOwner);
-					activateControl(inpHidden);
-					activateControl(btnShowBug);
-					activateControl(btnBlack);
-				} else {
-					deactivateControl(btnTerr);
-					deactivateControl(btnDiff);
-					deactivateControl(chcSize);
-					deactivateControl(inpOwner);
-					deactivateControl(inpHidden);
-					deactivateControl(btnShowBug);
-					deactivateControl(btnBlack);
-					chcSize.select(0);
-					btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + DTINVALID);
-					btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + DTINVALID);
-				}
-			}
-			//FIXME: check if something was actually changed, since datacachnge events also occur if you just hop through the fileds with the tab key (Why? don't know!)
-			dirtyDetails = true;
-			needsTableUpdate = true;
-		}
-		if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED) {
-			if (ev.target == btnNotes) {
-				dirtyNotes = true; // TODO I think this is redundant, because
-									// the notes are saved separately by the notes screen itself
-				final NotesScreen nsc = new NotesScreen(cache
-						.getCacheDetails(true));
-				nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
-				if (isBigScreen) {
-					waypointNotes.setText(cache.getCacheDetails(true).getCacheNotes());
-				}
-			} else if (ev.target == btnShowMap) {
-				Global.mainTab.SwitchToMovingMap(cache.pos, true);
-				/*
-				 * try { MapDetailForm mdf = new
-				 * MapDetailForm(thisCache.wayPoint, pref, profile);
-				 * mdf.execute(); } catch (IllegalArgumentException e) {
-				 * MessageBox tmp = new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;),
-				 * MyLocale.getMsg(322,&quot;Kann Bild/Karte nicht finden&quot;)+&quot;:
-				 * &quot;+e.getMessage(), MessageBox.OKB); tmp.exec(); }
-				 */
-			} else if (ev.target == btnShowBug) {
-				// InfoScreen is = new InfoScreen(thisCache.Travelbugs.toHtml(),
-				// &quot;Travelbugs&quot;,
-				// false, pref);
-				// is.execute();
-				final TravelbugInCacheScreen ts = new TravelbugInCacheScreen(cache.getCacheDetails(true).Travelbugs.toHtml(),	&quot;Travelbugs&quot;);
-				ts.execute(this.getFrame(), Gui.CENTER_FRAME);
-			/* not fully implemented
-			} else if (ev.target == btnCenter) {
-				final CWPoint cp = new CWPoint(cache.LatLon);
-				if (cp.isValid()) {
-					pref.setCurCentrePt(cp);
-				} else {
-					final MessageBox tmpMB = new MessageBox(
-							MyLocale.getMsg(312, &quot;Error&quot;),
-							MyLocale.getMsg(4111, &quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;),
-							FormBase.OKB);
-					tmpMB.exec();
-				}
-			*/
+    /**
+     * Method to react to a user input.
+     */
+    public void onEvent(final Event ev) {
+        if (ev instanceof DataChangeEvent) {
+            if (ev.target == inpWaypoint) {
+                if (evWaypointChanged) {
+                    String iTmp=inpWaypoint.getText();
+                    String uTmp=iTmp.toUpperCase();
+                    if (!iTmp.equals(uTmp)){
+                        inpWaypoint.setText(uTmp); // If user entered LowerCase -&gt; convert directly to UpperCase
+                        evWaypointChanged=false; //next DataChangeEvent fired by change to UpperCase will be ignored
+                    }
+                    // already warned(multi same DataChangeEvents) or same waypointname as before edit !!!
+                    if(!warnedForWaypoint.equals(uTmp) &amp;&amp; !uTmp.equals(this.cache.getWayPoint())){
+                        if ((new File(profile.dataDir + iTmp.toLowerCase()+&quot;.xml&quot;)).exists()) {
+                            warnedForWaypoint=uTmp; // before MessageBox cause Multithread DataChangeEvents
+                            // filename is LowerCase
+                            new MessageBox(&quot;Warning :&quot;,uTmp+&quot;\n&quot;+MyLocale.getMsg(275,&quot;Waypoint already exists!&quot;),MessageBox.OKB).execute();
+                            // revert waypointname
+                            inpWaypoint.setText(this.cache.getWayPoint());
+                        }
+                    }
+                }
+                else {
+                    // first DataChangeEvent is fired by Klick into (after reload).
+                    // that really didn't change anything
+                    evWaypointChanged=true;
+                }
+                // FIXME: if name was changed, we should rename the waypoint.xml file. how? where?
+            } else if (ev.target == chcType) {
+                createWptName();
+                if (CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.selectedIndex))) {
+                    activateControl(btnTerr);
+                    activateControl(btnDiff);
+                    activateControl(chcSize);
+                    activateControl(inpOwner);
+                    activateControl(inpHidden);
+                    activateControl(btnShowBug);
+                    activateControl(btnBlack);
+                } else {
+                    deactivateControl(btnTerr);
+                    deactivateControl(btnDiff);
+                    deactivateControl(chcSize);
+                    deactivateControl(inpOwner);
+                    deactivateControl(inpHidden);
+                    deactivateControl(btnShowBug);
+                    deactivateControl(btnBlack);
+                    chcSize.select(0);
+                    btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + DTINVALID);
+                    btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + DTINVALID);
+                }
+            }
+            //FIXME: check if something was actually changed, since datacachnge events also occur if you just hop through the fileds with the tab key (Why? don't know!)
+            dirtyDetails = true;
+            needsTableUpdate = true;
+        }
+        if (ev instanceof ControlEvent &amp;&amp; ev.type == ControlEvent.PRESSED) {
+            if (ev.target == btnNotes) {
+                dirtyNotes = true; // TODO I think this is redundant, because
+                                    // the notes are saved separately by the notes screen itself
+                final NotesScreen nsc = new NotesScreen(cache
+                        .getCacheDetails(true));
+                nsc.execute(this.getFrame(), Gui.CENTER_FRAME);
+                if (isBigScreen) {
+                    waypointNotes.setText(cache.getCacheDetails(true).getCacheNotes());
+                }
+            } else if (ev.target == btnShowMap) {
+                Global.mainTab.SwitchToMovingMap(cache.pos, true);
+                /*
+                 * try { MapDetailForm mdf = new
+                 * MapDetailForm(thisCache.wayPoint, pref, profile);
+                 * mdf.execute(); } catch (IllegalArgumentException e) {
+                 * MessageBox tmp = new MessageBox(MyLocale.getMsg(321,&quot;Error&quot;),
+                 * MyLocale.getMsg(322,&quot;Kann Bild/Karte nicht finden&quot;)+&quot;:
+                 * &quot;+e.getMessage(), MessageBox.OKB); tmp.exec(); }
+                 */
+            } else if (ev.target == btnShowBug) {
+                // InfoScreen is = new InfoScreen(thisCache.Travelbugs.toHtml(),
+                // &quot;Travelbugs&quot;,
+                // false, pref);
+                // is.execute();
+                final TravelbugInCacheScreen ts = new TravelbugInCacheScreen(cache.getCacheDetails(true).Travelbugs.toHtml(),	&quot;Travelbugs&quot;);
+                ts.execute(this.getFrame(), Gui.CENTER_FRAME);
+            /* not fully implemented
+            } else if (ev.target == btnCenter) {
+                final CWPoint cp = new CWPoint(cache.LatLon);
+                if (cp.isValid()) {
+                    pref.setCurCentrePt(cp);
+                } else {
+                    final MessageBox tmpMB = new MessageBox(
+                            MyLocale.getMsg(312, &quot;Error&quot;),
+                            MyLocale.getMsg(4111, &quot;Coordinates must be entered in the format N DD MM.MMM E DDD MM.MMM&quot;),
+                            FormBase.OKB);
+                    tmpMB.exec();
+                }
+            */
 
-			} else if (ev.target == btnAddDateTime) {
-				dirtyNotes = true;
+            } else if (ev.target == btnAddDateTime) {
+                dirtyNotes = true;
 
-				final StringBuffer newNote = new StringBuffer();
-				newNote.append(cache.getCacheDetails(true).getCacheNotes());
+                final StringBuffer newNote = new StringBuffer();
+                newNote.append(cache.getCacheDetails(true).getCacheNotes());
 
-				final Time dtm = new Time();
-				dtm.getTime();
-				dtm.setFormat(&quot;E dd.MM.yyyy '/' HH:mm&quot;);
+                final Time dtm = new Time();
+                dtm.getTime();
+                dtm.setFormat(&quot;E dd.MM.yyyy '/' HH:mm&quot;);
 
-				if (newNote.length() &gt; 0) {
-					newNote.append('\n');
-				}
-				newNote.append(dtm.toString()).append('\n');
+                if (newNote.length() &gt; 0) {
+                    newNote.append('\n');
+                }
+                newNote.append(dtm.toString()).append('\n');
 
-				cache.getCacheDetails(true).setCacheNotes(newNote.toString());
-				//FIXME: better use saveDirtyWaypoint()?
-				cache.save();
-			} else if (ev.target == btnAddPicture) {
-				cache.getCacheDetails(true).addUserImage(profile);
-			} else if (ev.target == btnBlack) {
-				if (cache.is_black()) {
-					cache.setBlack(false);
-					btnBlack.image = imgBlackNo;
-				} else {
-					cache.setBlack(true);
-					btnBlack.image = imgBlack;
-				}
-				blackStatus = cache.is_black();
-				cache.setAttributesToAddiWpts();
-				btnBlack.repaintNow();
-				dirtyDetails = true;
-				blackStatusChanged = true;
-			} else if (ev.target == btnNewWpt) {
-				final CacheHolder ch = new CacheHolder();
-				ch.setLatLon(cache.getLatLon());
-				ch.pos = new CWPoint(cache.pos);
-				ch.setType(CacheType.CW_TYPE_STAGE);
-				ch.setHard(CacheTerrDiff.CW_DT_UNSET);
-				ch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
-				ch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
-				Global.mainTab.newWaypoint(ch);
-			} else if (ev.target == btnGoto) {
-				// FIXME: if something changed saveDirtyWaypoint();
-				Global.mainTab.gotoP.setDestinationAndSwitch(cache);
-			} else if (ev.target == btnCoordinates) {
-				CWPoint coords = new CWPoint(btnCoordinates.getText(), TransformCoordinates.CW);
-				if(Vm.isMobile()){
-					InputScreen InScr = new InputScreen(TransformCoordinates.CW);
-					if (coords.isValid())	InScr.setCcords(coords);
-						else InScr.setCcords(new CWPoint(0,0));
-					if (InScr.execute(null, CellConstants.TOP) == FormBase.IDOK)
-					{
-						dirtyDetails = true;
-						coords = InScr.getCoords();
-						Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
-						cache.pos.set(coords);
-						btnCoordinates.setText(coords.toString());
-						cache.setLatLon(coords.toString());
-						// If the current centre is valid, calculate the distance and bearing to it
-						final CWPoint centre = Global.getPref().getCurCentrePt();
-						if (centre.isValid()) {
-							cache.calcDistance(centre); // todo perhaps sortTable
-						}
-					}
-				}else{
-					final CoordsScreen cs = new CoordsScreen(true);
-					cs.setFields(coords, TransformCoordinates.CW);
-					if (cs.execute() == FormBase.IDOK) {
-						dirtyDetails = true;
-						coords = cs.getCoords();
-						Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
-						cache.pos.set(coords);
-						btnCoordinates.setText(coords.toString());
-						cache.setLatLon(coords.toString());
-						// If the current centre is valid, calculate the distance and bearing to it
-						final CWPoint centre = Global.getPref().getCurCentrePt();
-						if (centre.isValid()) {
-							cache.calcDistance(centre); // todo perhaps sortTable
-						}
-					}
-				}
-			} else if (ev.target == btnFoundDate) {
-				// DateChooser.dayFirst=true;
-				final DateTimeChooser dc = new DateTimeChooser(Vm.getLocale());
-				dc.title = MyLocale.getMsg(328, &quot;Date found&quot;);
-				dc.setPreferredSize(240, 240);
-				String foundDate = chcStatus.getText();
-				if (foundDate.startsWith(MyLocale.getMsg(318, &quot;Found&quot;) + &quot; &quot;)) {
-					foundDate = foundDate.substring(MyLocale.getMsg(318, &quot;Found&quot;).length() + 1);
-				}
-				else if (foundDate.endsWith(&quot; &quot;+MyLocale.getMsg(319, &quot;not Found&quot;))) {
-					foundDate = foundDate.substring(0,16);					
-				}
-				final Time t = new Time();
-				try {
-					t.parse(foundDate, &quot;y-M-d H:m&quot;);
-				} catch (IllegalArgumentException e) {
-					try {
-						t.parse(foundDate, &quot;y-M-d&quot;);
-					} catch (IllegalArgumentException e1) {
-						Global.getPref().log(&quot;No parsable date given - should not appear&quot;, e1, true);
-					}
-				}
+                cache.getCacheDetails(true).setCacheNotes(newNote.toString());
+                //FIXME: better use saveDirtyWaypoint()?
+                cache.save();
+            } else if (ev.target == btnAddPicture) {
+                cache.getCacheDetails(true).addUserImage(profile);
+            } else if (ev.target == btnBlack) {
+                if (cache.is_black()) {
+                    cache.setBlack(false);
+                    btnBlack.image = imgBlackNo;
+                } else {
+                    cache.setBlack(true);
+                    btnBlack.image = imgBlack;
+                }
+                blackStatus = cache.is_black();
+                cache.setAttributesToAddiWpts();
+                btnBlack.repaintNow();
+                dirtyDetails = true;
+                blackStatusChanged = true;
+            } else if (ev.target == btnNewWpt) {
+                final CacheHolder ch = new CacheHolder();
+                ch.setLatLon(cache.getLatLon());
+                ch.pos = new CWPoint(cache.pos);
+                ch.setType(CacheType.CW_TYPE_STAGE);
+                ch.setHard(CacheTerrDiff.CW_DT_UNSET);
+                ch.setTerrain(CacheTerrDiff.CW_DT_UNSET);
+                ch.setCacheSize(CacheSize.CW_SIZE_NOTCHOSEN);
+                Global.mainTab.newWaypoint(ch);
+            } else if (ev.target == btnGoto) {
+                // FIXME: if something changed saveDirtyWaypoint();
+                Global.mainTab.gotoP.setDestinationAndSwitch(cache);
+            } else if (ev.target == btnCoordinates) {
+                CWPoint coords = new CWPoint(btnCoordinates.getText(), TransformCoordinates.CW);
+                if(Vm.isMobile()){
+                    InputScreen InScr = new InputScreen(TransformCoordinates.CW);
+                    if (coords.isValid())	InScr.setCcords(coords);
+                        else InScr.setCcords(new CWPoint(0,0));
+                    if (InScr.execute(null, CellConstants.TOP) == FormBase.IDOK)
+                    {
+                        dirtyDetails = true;
+                        coords = InScr.getCoords();
+                        Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
+                        cache.pos.set(coords);
+                        btnCoordinates.setText(coords.toString());
+                        cache.setLatLon(coords.toString());
+                        // If the current centre is valid, calculate the distance and bearing to it
+                        final CWPoint centre = Global.getPref().getCurCentrePt();
+                        if (centre.isValid()) {
+                            cache.calcDistance(centre); // todo perhaps sortTable
+                        }
+                    }
+                }else{
+                    final CoordsScreen cs = new CoordsScreen(true);
+                    cs.setFields(coords, TransformCoordinates.CW);
+                    if (cs.execute() == FormBase.IDOK) {
+                        dirtyDetails = true;
+                        coords = cs.getCoords();
+                        Global.getProfile().notifyUnsavedChanges(!cache.pos.toString().equals(coords.toString()));
+                        cache.pos.set(coords);
+                        btnCoordinates.setText(coords.toString());
+                        cache.setLatLon(coords.toString());
+                        // If the current centre is valid, calculate the distance and bearing to it
+                        final CWPoint centre = Global.getPref().getCurCentrePt();
+                        if (centre.isValid()) {
+                            cache.calcDistance(centre); // todo perhaps sortTable
+                        }
+                    }
+                }
+            } else if (ev.target == btnFoundDate) {
+                // DateChooser.dayFirst=true;
+                final DateTimeChooser dc = new DateTimeChooser(Vm.getLocale());
+                dc.title = MyLocale.getMsg(328, &quot;Date found&quot;);
+                dc.setPreferredSize(240, 240);
+                String foundDate = chcStatus.getText();
+                if (foundDate.startsWith(MyLocale.getMsg(318, &quot;Found&quot;) + &quot; &quot;)) {
+                    foundDate = foundDate.substring(MyLocale.getMsg(318, &quot;Found&quot;).length() + 1);
+                }
+                else if (foundDate.endsWith(MyLocale.getMsg(319, &quot;not Found&quot;))) {
+                    foundDate = foundDate.substring(0,foundDate.length()-MyLocale.getMsg(319, &quot;not Found&quot;).length());
+                    dc.title=MyLocale.getMsg(330,&quot;Date Not Found&quot;);
+                }
+                foundDate=foundDate.trim();
+                if (foundDate.length()&gt;0 &amp;&amp; foundDate.indexOf('-')&gt;0) { //Don't try and parse empty date
+                    final Time t = new Time();
+                    try {
+                        t.parse(foundDate, &quot;y-M-d H:m&quot;);
+                    } catch (IllegalArgumentException e) {
+                        try {
+                            t.parse(foundDate, &quot;y-M-d&quot;);
+                        } catch (IllegalArgumentException e1) {
+                            Global.getPref().log(&quot;No parsable date given - should not appear (&quot;+foundDate+&quot;)&quot;, e1, true);
+                        }
+                    }
 
-				dc.reset(t);
-				if (dc.execute() == ewe.ui.FormBase.IDOK) {
-					chcStatus.setText(MyLocale.getMsg(318, &quot;Found&quot;) + &quot; &quot;
-									+ Convert.toString(dc.year) + &quot;-&quot;
-									+ MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-									+ MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
-									+ dc.time);
-					dirtyDetails = true;
-				}
-				else {
-					chcStatus.setText(Convert.toString(dc.year) + &quot;-&quot;
-							+ MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-							+ MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
-							+ dc.time + &quot; &quot;
-							+ MyLocale.getMsg(319, &quot;not Found&quot;)
-							);
-					dirtyDetails = true;
-				}
-			} else if (ev.target == btnHiddenDate) {
-				DateChooser.dayFirst = true;
-				final DateChooser dc = new DateChooser(Vm.getLocale());
-				dc.title = MyLocale.getMsg(329, &quot;Hidden date&quot;);
-				dc.setPreferredSize(240, 240);
-				if (inpHidden.getText().length() == 10)
-					try {
-						dc.setDate(new Time(Convert.parseInt(inpHidden
-								.getText().substring(8)), Convert
-								.parseInt(inpHidden.getText().substring(5, 7)),
-								Convert.parseInt(inpHidden.getText().substring(
-										0, 4))));
-					} catch (NumberFormatException e) {
-						dc.reset(new Time());
-					}
-				if (dc.execute() == ewe.ui.FormBase.IDOK) {
-					inpHidden.setText(Convert.toString(dc.year) + &quot;-&quot;
-							+ MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
-							+ MyLocale.formatLong(dc.day, &quot;00&quot;));
-					dirtyDetails = true;
-					// profile.hasUnsavedChanges=true;
-				}
-			} else if (ev.target == btnTerr) {
-				int returnValue;
-				final TerrDiffForm tdf = new TerrDiffForm(true,
-						decodeTerrDiff(btnTerr,
-								MyLocale.getMsg(1001, &quot;T&quot;),
-								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-							)
-						);
-				returnValue = tdf.execute();
-				if (returnValue == 1) {
-					btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + &quot;: &quot; + CacheTerrDiff.longDT(tdf.getDT()));
-					dirtyDetails = true;
-				}
-			} else if (ev.target == btnDiff) {
-				int returnValue;
-				final TerrDiffForm tdf = new TerrDiffForm(false,
-						decodeTerrDiff(btnDiff,
-								MyLocale.getMsg(1001, &quot;D&quot;),
-								CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
-							)
-						);
+                    dc.reset(t);
+                }
+                // We can create a not found log with date in two ways:
+                //   1) Exiting the date-time dialog by clicking the x if the status is empty (somewhat
+                //      non-standard but quick and dirty)
+                //   2) Exiting the date-time dialog by clicking the tick. Then we check whether
+                //      the status field was preset with the not-found text. If yes it stays a not found
+                //      but the date is prepended
+                //TODO: The functions for extracting the date and the found/not-found text should not be in the GUI
+                int retCode=dc.execute();
+                if (retCode == ewe.ui.FormBase.IDOK &amp;&amp; !chcStatus.getText().endsWith(MyLocale.getMsg(319, &quot;not Found&quot;))) {
+                    chcStatus.setText(MyLocale.getMsg(318, &quot;Found&quot;) + &quot; &quot;
+                                    + Convert.toString(dc.year) + &quot;-&quot;
+                                    + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
+                                    + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
+                                    + dc.time);
+                    dirtyDetails = true;
+                }
+                else if (chcStatus.getText().length()==0 ||
+                		(retCode==ewe.ui.FormBase.IDOK &amp;&amp; chcStatus.getText().endsWith(MyLocale.getMsg(319, &quot;not Found&quot;)) )) {
+                    chcStatus.setText(Convert.toString(dc.year) + &quot;-&quot;
+                            + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
+                            + MyLocale.formatLong(dc.day, &quot;00&quot;) + &quot; &quot;
+                            + dc.time + &quot; &quot;
+                            + MyLocale.getMsg(319, &quot;not Found&quot;)
+                            );
+                    dirtyDetails = true;
+                }
+            } else if (ev.target == btnHiddenDate) {
+                DateChooser.dayFirst = true;
+                final DateChooser dc = new DateChooser(Vm.getLocale());
+                dc.title = MyLocale.getMsg(329, &quot;Hidden date&quot;);
+                dc.setPreferredSize(240, 240);
+                if (inpHidden.getText().length() == 10)
+                    try {
+                        dc.setDate(new Time(Convert.parseInt(inpHidden
+                                .getText().substring(8)), Convert
+                                .parseInt(inpHidden.getText().substring(5, 7)),
+                                Convert.parseInt(inpHidden.getText().substring(
+                                        0, 4))));
+                    } catch (NumberFormatException e) {
+                        dc.reset(new Time());
+                    }
+                if (dc.execute() == ewe.ui.FormBase.IDOK) {
+                    inpHidden.setText(Convert.toString(dc.year) + &quot;-&quot;
+                            + MyLocale.formatLong(dc.month, &quot;00&quot;) + &quot;-&quot;
+                            + MyLocale.formatLong(dc.day, &quot;00&quot;));
+                    dirtyDetails = true;
+                    // profile.hasUnsavedChanges=true;
+                }
+            } else if (ev.target == btnTerr) {
+                int returnValue;
+                final TerrDiffForm tdf = new TerrDiffForm(true,
+                        decodeTerrDiff(btnTerr,
+                                MyLocale.getMsg(1001, &quot;T&quot;),
+                                CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
+                            )
+                        );
+                returnValue = tdf.execute();
+                if (returnValue == 1) {
+                    btnTerr.setText(MyLocale.getMsg(1001, &quot;T&quot;) + &quot;: &quot; + CacheTerrDiff.longDT(tdf.getDT()));
+                    dirtyDetails = true;
+                }
+            } else if (ev.target == btnDiff) {
+                int returnValue;
+                final TerrDiffForm tdf = new TerrDiffForm(false,
+                        decodeTerrDiff(btnDiff,
+                                MyLocale.getMsg(1001, &quot;D&quot;),
+                                CacheType.isCacheWpt(CacheType.guiSelect2Cw(chcType.getInt()))
+                            )
+                        );
 
-				returnValue = tdf.execute();
-				if (returnValue == 1) {
-					btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: &quot;
-							+ CacheTerrDiff.longDT(tdf.getDT()));
-					dirtyDetails = true;
-				}
-			}
-			ev.consumed = true;
-		}
-	}
+                returnValue = tdf.execute();
+                if (returnValue == 1) {
+                    btnDiff.setText(MyLocale.getMsg(1000, &quot;D&quot;) + &quot;: &quot;
+                            + CacheTerrDiff.longDT(tdf.getDT()));
+                    dirtyDetails = true;
+                }
+            }
+            ev.consumed = true;
+        }
+    }
 
 	/** allow user input on control item */
 	private void activateControl(final Control ctrl) {
@@ -752,7 +765,7 @@
 		} else {
 			cache.setCacheStatus(chcStatus.getText());
 		}
-		
+
 		if (chcStatus.getText().startsWith(MyLocale.getMsg(318, &quot;Found&quot;)) ||
 			chcStatus.getText().startsWith(MyLocale.getMsg(355, &quot;Attended&quot;)) ||
 			(cache.getCacheStatus().length() == 10 || cache.getCacheStatus().length() == 16) &amp;&amp;
@@ -764,7 +777,7 @@
 			cache.setFound(true);
 		}
 		else cache.setFound(false);
-		
+
 		if (!cache.isAddiWpt()) {
 			cache.setCacheOwner(inpOwner.getText().trim());
 		}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002465.html">[Cachewolf-svn] r2538 - trunk/src/CacheWolf
</A></li>
	<LI>Next message: <A HREF="002467.html">[Cachewolf-svn] r2540 - trunk/src/CacheWolf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2466">[ date ]</a>
              <a href="thread.html#2466">[ thread ]</a>
              <a href="subject.html#2466">[ subject ]</a>
              <a href="author.html#2466">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cachewolf-svn">More information about the Cachewolf-svn
mailing list</a><br>
</body></html>
